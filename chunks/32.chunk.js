/*! For license information please see duieqg.32.3edb301d.chunk.js.LICENSE.txt */
(self.vfdo5lmva5i=self.vfdo5lmva5i||[]).push([[32],{13769:(w,o,H)=>{"use strict";var h=H(13778),E=H(13782),e=H(13784);H.g.__TYPEDARRAY_POOL||(H.g.__TYPEDARRAY_POOL={UINT8:E([32,0]),UINT16:E([32,0]),UINT32:E([32,0]),INT8:E([32,0]),INT16:E([32,0]),INT32:E([32,0]),FLOAT:E([32,0]),DOUBLE:E([32,0]),DATA:E([32,0]),UINT8C:E([32,0]),BUFFER:E([32,0])});var D="undefined"!==typeof Uint8ClampedArray,t=H.g.__TYPEDARRAY_POOL;t.UINT8C||(t.UINT8C=E([32,0])),t.BUFFER||(t.BUFFER=E([32,0]));var X=t.DATA,L=t.BUFFER;function A(w){if(w){var o=w.length||w.byteLength,H=h.log2(o);X[H].push(w)}}function y(w){w=h.nextPow2(w);var o=h.log2(w),H=X[o];return H.length>0?H.pop():new ArrayBuffer(w)}function z(w){return new Uint8Array(y(w),0,w)}function C(w){return new Uint16Array(y(2*w),0,w)}function Q(w){return new Uint32Array(y(4*w),0,w)}function M(w){return new Int8Array(y(w),0,w)}function i(w){return new Int16Array(y(2*w),0,w)}function s(w){return new Int32Array(y(4*w),0,w)}function V(w){return new Float32Array(y(4*w),0,w)}function r(w){return new Float64Array(y(8*w),0,w)}function k(w){return D?new Uint8ClampedArray(y(w),0,w):z(w)}function P(w){return new DataView(y(w),0,w)}o.free=function(w){if(e(w))L[h.log2(w.length)].push(w);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(w)&&(w=w.buffer),!w)return;var o=w.length||w.byteLength,H=0|h.log2(o);X[H].push(w)}},o.freeUint8=o.freeUint16=o.freeUint32=o.freeInt8=o.freeInt16=o.freeInt32=o.freeFloat32=o.freeFloat=o.freeFloat64=o.freeDouble=o.freeUint8Clamped=o.freeDataView=function(w){A(w.buffer)},o.freeArrayBuffer=A,o.freeBuffer=function(w){L[h.log2(w.length)].push(w)},o.malloc=function(w,o){if(void 0===o||"arraybuffer"===o)return y(w);switch(o){case"uint8":return z(w);case"uint16":return C(w);case"uint32":return Q(w);case"int8":return M(w);case"int16":return i(w);case"int32":return s(w);case"float":case"float32":return V(w);case"double":case"float64":return r(w);case"uint8_clamped":return k(w);case"buffer":throw"Buffer not supported";case"data":case"dataview":return P(w);default:return null}return null},o.mallocArrayBuffer=y,o.mallocUint8=z,o.mallocUint16=C,o.mallocUint32=Q,o.mallocInt8=M,o.mallocInt16=i,o.mallocInt32=s,o.mallocFloat32=o.mallocFloat=V,o.mallocFloat64=o.mallocDouble=r,o.mallocUint8Clamped=k,o.mallocDataView=P,o.clearCache=function(){for(var w=0;w<32;++w)t.UINT8[w].length=0,t.UINT16[w].length=0,t.UINT32[w].length=0,t.INT8[w].length=0,t.INT16[w].length=0,t.INT32[w].length=0,t.FLOAT[w].length=0,t.DOUBLE[w].length=0,t.UINT8C[w].length=0,X[w].length=0,L[w].length=0}},13860:(w,o,H)=>{w.exports=E;var h=H(12523);function E(w,o){if(!(this instanceof E))return new E(w,o);var H=h.create();h.add(H,w,o),this.base=h.min(h.create(),w,H),this.YL=h.clone(o),this.max=h.max(h.create(),w,H),this.mag=h.length(this.YL)}var e=E.prototype;e.width=function(){return this.YL[0]},e.height=function(){return this.YL[1]},e.depth=function(){return this.YL[2]},e.x0=function(){return this.base[0]},e.y0=function(){return this.base[1]},e.z0=function(){return this.base[2]},e.x1=function(){return this.max[0]},e.y1=function(){return this.max[1]},e.z1=function(){return this.max[2]},e.translate=function(w){return h.add(this.max,this.max,w),h.add(this.base,this.base,w),this},e.setPosition=function(w){return h.add(this.max,w,this.YL),h.j(this.base,w),this},e.expand=function(w){var o=h.create(),H=h.create();return h.max(o,w.max,this.max),h.min(H,w.base,this.base),h.so(o,o,H),new E(H,o)},e.intersects=function(w){return!(w.base[0]>this.max[0])&&(!(w.base[1]>this.max[1])&&(!(w.base[2]>this.max[2])&&(!(w.max[0]<this.base[0])&&(!(w.max[1]<this.base[1])&&!(w.max[2]<this.base[2])))))},e.touches=function(w){var o=this.union(w);return null!==o&&(0==o.width()||0==o.height()||0==o.depth())},e.union=function(w){if(!this.intersects(w))return null;var o=Math.max(w.base[0],this.base[0]),H=Math.max(w.base[1],this.base[1]),h=Math.max(w.base[2],this.base[2]);return new E([o,H,h],[Math.min(w.max[0],this.max[0])-o,Math.min(w.max[1],this.max[1])-H,Math.min(w.max[2],this.max[2])-h])}},13778:(w,o)=>{"use strict";function H(w){var o=32;return(w&=-w)&&o--,65535&w&&(o-=16),16711935&w&&(o-=8),252645135&w&&(o-=4),858993459&w&&(o-=2),1431655765&w&&(o-=1),o}o.INT_BITS=32,o.INT_MAX=2147483647,o.INT_MIN=-1<<31,o.sign=function(w){return(w>0)-(w<0)},o.abs=function(w){var o=w>>31;return(w^o)-o},o.min=function(w,o){return o^(w^o)&-(w<o)},o.max=function(w,o){return w^(w^o)&-(w<o)},o.isPow2=function(w){return!(w&w-1)&&!!w},o.log2=function(w){var o,H;return o=(w>65535)<<4,o|=H=((w>>>=o)>255)<<3,o|=H=((w>>>=H)>15)<<2,(o|=H=((w>>>=H)>3)<<1)|(w>>>=H)>>1},o.log10=function(w){return w>=1e9?9:w>=1e8?8:w>=1e7?7:w>=1e6?6:w>=1e5?5:w>=1e4?4:w>=1e3?3:w>=100?2:w>=10?1:0},o.popCount=function(w){return 16843009*((w=(858993459&(w-=w>>>1&1431655765))+(w>>>2&858993459))+(w>>>4)&252645135)>>>24},o.countTrailingZeros=H,o.nextPow2=function(w){return w+=0===w,--w,w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)+1},o.prevPow2=function(w){return w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)-(w>>>1)},o.parity=function(w){return w^=w>>>16,w^=w>>>8,w^=w>>>4,27030>>>(w&=15)&1};var h=new Array(256);!function(w){for(var o=0;o<256;++o){var H=o,h=o,E=7;for(H>>>=1;H;H>>>=1)h<<=1,h|=1&H,--E;w[o]=h<<E&255}}(h),o.reverse=function(w){return h[255&w]<<24|h[w>>>8&255]<<16|h[w>>>16&255]<<8|h[w>>>24&255]},o.interleave2=function(w,o){return(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w&=65535)|w<<8))|w<<4))|w<<2))|w<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o&=65535)|o<<8))|o<<4))|o<<2))|o<<1))<<1},o.deinterleave2=function(w,o){return(w=65535&((w=16711935&((w=252645135&((w=858993459&((w=w>>>o&1431655765)|w>>>1))|w>>>2))|w>>>4))|w>>>16))<<16>>16},o.interleave3=function(w,o,H){return w=1227133513&((w=3272356035&((w=251719695&((w=4278190335&((w&=1023)|w<<16))|w<<8))|w<<4))|w<<2),(w|=(o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2))<<1)|(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<2},o.deinterleave3=function(w,o){return(w=1023&((w=4278190335&((w=251719695&((w=3272356035&((w=w>>>o&1227133513)|w>>>2))|w>>>4))|w>>>8))|w>>>16))<<22>>22},o.nextCombination=function(w){var o=w|w-1;return o+1|(~o&-~o)-1>>>H(w)+1}},13764:(w,o,H)=>{"use strict";w.exports=function(w,o,H){switch(arguments.length){case 1:return h=[],L(E=w,E,A,!0),h;case 2:return"function"===typeof o?L(w,w,o,!0):function(w,o){return h=[],L(w,o,A,!1),h}(w,o);case 3:return L(w,o,H,!1);default:throw new Error("box-intersect: Invalid arguments")}var E};var h,E=H(13769),e=H(13787),D=H(13793);function t(w,o){for(var H=0;H<w;++H)if(!(o[H]<=o[H+w]))return!0;return!1}function X(w,o,H,h){for(var E=0,e=0,D=0,X=w.length;D<X;++D){var L=w[D];if(!t(o,L)){for(var A=0;A<2*o;++A)H[E++]=L[A];h[e++]=D}}return e}function L(w,o,H,h){var t=w.length,L=o.length;if(!(t<=0||L<=0)){var A=w[0].length>>>1;if(!(A<=0)){var y,z=E.mallocDouble(2*A*t),C=E.mallocInt32(t);if((t=X(w,A,z,C))>0){if(1===A&&h)e.init(t),y=e.sweepComplete(A,H,0,t,z,C,0,t,z,C);else{var Q=E.mallocDouble(2*A*L),M=E.mallocInt32(L);(L=X(o,A,Q,M))>0&&(e.init(t+L),y=1===A?e.sweepBipartite(A,H,0,t,z,C,0,L,Q,M):D(A,H,h,t,z,C,L,Q,M),E.free(Q),E.free(M))}E.free(z),E.free(C)}return y}}}function A(w,o){h.push([w,o])}},13801:(w,o)=>{"use strict";var H="d",h="ax",E="fp",e="es",D="rs",t="re",X="rb",L="bs",A="be",y="bb",z=[H,h,"vv",D,t,X,"ri",L,A,y,"bi"];function C(w){var o="bruteForce"+(w?"Full":"Partial"),h=[],D=z.slice();w||D.splice(3,0,E);var t=["function "+o+"("+D.join()+"){"];function X(o,E){var D=function(w,o,h){var E="bruteForce"+(w?"Red":"Blue")+(o?"Flip":"")+(h?"Full":""),D=["function ",E,"(",z.join(),"){","var ",e,"=2*",H,";"],t="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",X="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(h?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return w?D.push(t,"Q",":",X):D.push(X,"Q",":",t),h?D.push("if(y1<x0||x1<y0)continue;"):o?D.push("if(y0<=x0||x1<y0)continue;"):D.push("if(y0<x0||x1<y0)continue;"),D.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),o?D.push("yi,xi"):D.push("xi,yi"),D.push(");if(rv!==void 0)return rv;}}}"),{name:E,code:D.join("")}}(o,E,w);h.push(D.code),t.push("return "+D.name+"("+z.join()+");")}t.push("if(re-rs>be-bs){"),w?(X(!0,!1),t.push("}else{"),X(!1,!1)):(t.push("if(fp){"),X(!0,!0),t.push("}else{"),X(!0,!1),t.push("}}else{if(fp){"),X(!1,!0),t.push("}else{"),X(!1,!1),t.push("}")),t.push("}}return "+o);var L=h.join("")+t.join("");return new Function(L)()}o.partial=C(!1),o.full=C(!0)},13793:(w,o,H)=>{"use strict";w.exports=function(w,o,H,e,A,W,B,J,g){!function(w,o){var H=8*E.log2(o+1)*(w+1)|0,e=E.nextPow2(k*H);l.length<e&&(h.free(l),l=h.mallocInt32(e));var D=E.nextPow2(P*H);O.length<D&&(h.free(O),O=h.mallocDouble(D))}(w,e+B);var b,p=0,f=2*w;T(p++,0,0,e,0,B,H?16:0,-1/0,1/0),H||T(p++,0,0,B,0,e,1,-1/0,1/0);for(;p>0;){var N=(p-=1)*k,j=l[N],q=l[N+1],u=l[N+2],n=l[N+3],G=l[N+4],R=l[N+5],a=p*P,d=O[a],I=O[a+1],U=1&R,Z=!!(16&R),K=A,F=W,v=J,mw=g;if(U&&(K=J,F=g,v=A,mw=W),!(2&R&&q>=(u=i(w,j,q,u,K,F,I)))&&!(4&R&&(q=s(w,j,q,u,K,F,d))>=u)){var Y=u-q,x=G-n;if(Z){if(w*Y*(Y+x)<C){if(void 0!==(b=X.scanComplete(w,j,o,q,u,K,F,n,G,v,mw)))return b;continue}}else{if(w*Math.min(Y,x)<y){if(void 0!==(b=D(w,j,o,U,q,u,K,F,n,G,v,mw)))return b;continue}if(w*Y*x<z){if(void 0!==(b=X.scanBipartite(w,j,o,U,q,u,K,F,n,G,v,mw)))return b;continue}}var ww=Q(w,j,q,u,K,F,d,I);if(q<ww)if(w*(ww-q)<y){if(void 0!==(b=t(w,j+1,o,q,ww,K,F,n,G,v,mw)))return b}else if(j===w-2){if(void 0!==(b=U?X.sweepBipartite(w,o,n,G,v,mw,q,ww,K,F):X.sweepBipartite(w,o,q,ww,K,F,n,G,v,mw)))return b}else T(p++,j+1,q,ww,n,G,U,-1/0,1/0),T(p++,j+1,n,G,q,ww,1^U,-1/0,1/0);if(ww<u){var ow=L(w,j,n,G,v,mw),Hw=v[f*ow+j],hw=M(w,j,ow,G,v,mw,Hw);if(hw<G&&T(p++,j,ww,u,hw,G,(4|U)+(Z?16:0),Hw,I),n<ow&&T(p++,j,ww,u,n,ow,(2|U)+(Z?16:0),d,Hw),ow+1===hw){if(void 0!==(b=Z?c(w,j,o,ww,u,K,F,ow,v,mw[ow]):S(w,j,o,U,ww,u,K,F,ow,v,mw[ow])))return b}else if(ow<hw){var Ew;if(Z){if(ww<(Ew=V(w,j,ww,u,K,F,Hw))){var ew=M(w,j,ww,Ew,K,F,Hw);if(j===w-2){if(ww<ew&&void 0!==(b=X.sweepComplete(w,o,ww,ew,K,F,ow,hw,v,mw)))return b;if(ew<Ew&&void 0!==(b=X.sweepBipartite(w,o,ew,Ew,K,F,ow,hw,v,mw)))return b}else ww<ew&&T(p++,j+1,ww,ew,ow,hw,16,-1/0,1/0),ew<Ew&&(T(p++,j+1,ew,Ew,ow,hw,0,-1/0,1/0),T(p++,j+1,ow,hw,ew,Ew,1,-1/0,1/0))}}else ww<(Ew=U?r(w,j,ww,u,K,F,Hw):V(w,j,ww,u,K,F,Hw))&&(j===w-2?b=U?X.sweepBipartite(w,o,ow,hw,v,mw,ww,Ew,K,F):X.sweepBipartite(w,o,ww,Ew,K,F,ow,hw,v,mw):(T(p++,j+1,ww,Ew,ow,hw,U,-1/0,1/0),T(p++,j+1,ow,hw,ww,Ew,1^U,-1/0,1/0)))}}}}};var h=H(13769),E=H(13778),e=H(13801),D=e.partial,t=e.full,X=H(13787),L=H(13803),A=H(13807),y=128,z=1<<22,C=1<<22,Q=A("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),M=A("lo===p0",["p0"]),i=A("lo<p0",["p0"]),s=A("hi<=p0",["p0"]),V=A("lo<=p0&&p0<=hi",["p0"]),r=A("lo<p0&&p0<=hi",["p0"]),k=6,P=2,l=h.mallocInt32(1024),O=h.mallocDouble(1024);function T(w,o,H,h,E,e,D,t,X){var L=k*w;l[L]=o,l[L+1]=H,l[L+2]=h,l[L+3]=E,l[L+4]=e,l[L+5]=D;var A=P*w;O[A]=t,O[A+1]=X}function S(w,o,H,h,E,e,D,t,X,L,A){var y=2*w,z=X*y,C=L[z+o];w:for(var Q=E,M=E*y;Q<e;++Q,M+=y){var i=D[M+o],s=D[M+o+w];if(!(C<i||s<C)&&(!h||C!==i)){for(var V,r=t[Q],k=o+1;k<w;++k){i=D[M+k],s=D[M+k+w];var P=L[z+k],l=L[z+k+w];if(s<P||l<i)continue w}if(void 0!==(V=h?H(A,r):H(r,A)))return V}}}function c(w,o,H,h,E,e,D,t,X,L){var A=2*w,y=t*A,z=X[y+o];w:for(var C=h,Q=h*A;C<E;++C,Q+=A){var M=D[C];if(M!==L){var i=e[Q+o],s=e[Q+o+w];if(!(z<i||s<z)){for(var V=o+1;V<w;++V){i=e[Q+V],s=e[Q+V+w];var r=X[y+V],k=X[y+V+w];if(s<r||k<i)continue w}var P=H(M,L);if(void 0!==P)return P}}}}},13803:(w,o,H)=>{"use strict";w.exports=function(w,o,H,D,t,X){if(D<=H+1)return H;var L=H,A=D,y=D+H>>>1,z=2*w,C=y,Q=t[z*y+o];for(;L<A;){if(A-L<E){e(w,o,L,A,t,X),Q=t[z*y+o];break}var M=A-L,i=Math.random()*M+L|0,s=t[z*i+o],V=Math.random()*M+L|0,r=t[z*V+o],k=Math.random()*M+L|0,P=t[z*k+o];s<=r?P>=r?(C=V,Q=r):s>=P?(C=i,Q=s):(C=k,Q=P):r>=P?(C=V,Q=r):P>=s?(C=i,Q=s):(C=k,Q=P);for(var l=z*(A-1),O=z*C,T=0;T<z;++T,++l,++O){var S=t[l];t[l]=t[O],t[O]=S}var c=X[A-1];X[A-1]=X[C],X[C]=c;for(l=z*(A-1),O=z*(C=h(w,o,L,A-1,t,X,Q)),T=0;T<z;++T,++l,++O){S=t[l];t[l]=t[O],t[O]=S}c=X[A-1];if(X[A-1]=X[C],X[C]=c,y<C){for(A=C-1;L<A&&t[z*(A-1)+o]===Q;)A-=1;A+=1}else{if(!(C<y))break;for(L=C+1;L<A&&t[z*L+o]===Q;)L+=1}}return h(w,o,H,y,t,X,t[z*y+o])};var h=H(13807)("lo<p0",["p0"]),E=8;function e(w,o,H,h,E,e){for(var D=2*w,t=D*(H+1)+o,X=H+1;X<h;++X,t+=D)for(var L=E[t],A=X,y=D*(X-1);A>H&&E[y+o]>L;--A,y-=D){for(var z=y,C=y+D,Q=0;Q<D;++Q,++z,++C){var M=E[z];E[z]=E[C],E[C]=M}var i=e[A];e[A]=e[A-1],e[A-1]=i}}},13807:w=>{"use strict";w.exports=function(w,H){var h="abcdef".split("").concat(H),E=[];w.indexOf("lo")>=0&&E.push("lo=e[k+n]");w.indexOf("hi")>=0&&E.push("hi=e[k+o]");return h.push(o.replace("_",E.join()).replace("$",w)),Function.apply(void 0,h)};var o="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13789:w=>{"use strict";w.exports=function(w,h){h<=4*o?H(0,h-1,w):L(0,h-1,w)};var o=32;function H(w,o,H){for(var h=2*(w+1),E=w+1;E<=o;++E){for(var e=H[h++],D=H[h++],t=E,X=h-2;t-- >w;){var L=H[X-2],A=H[X-1];if(L<e)break;if(L===e&&A<D)break;H[X]=L,H[X+1]=A,X-=2}H[X]=e,H[X+1]=D}}function h(w,o,H){o*=2;var h=H[w*=2],E=H[w+1];H[w]=H[o],H[w+1]=H[o+1],H[o]=h,H[o+1]=E}function E(w,o,H){o*=2,H[w*=2]=H[o],H[w+1]=H[o+1]}function e(w,o,H,h){o*=2,H*=2;var E=h[w*=2],e=h[w+1];h[w]=h[o],h[w+1]=h[o+1],h[o]=h[H],h[o+1]=h[H+1],h[H]=E,h[H+1]=e}function D(w,o,H,h,E){o*=2,E[w*=2]=E[o],E[o]=H,E[w+1]=E[o+1],E[o+1]=h}function t(w,o,H){o*=2;var h=H[w*=2],E=H[o];return!(h<E)&&(h!==E||H[w+1]>H[o+1])}function X(w,o,H,h){var E=h[w*=2];return E<o||E===o&&h[w+1]<H}function L(w,A,y){var z=(A-w+1)/6|0,C=w+z,Q=A-z,M=w+A>>1,i=M-z,s=M+z,V=C,r=i,k=M,P=s,l=Q,O=w+1,T=A-1,S=0;t(V,r,y)&&(S=V,V=r,r=S),t(P,l,y)&&(S=P,P=l,l=S),t(V,k,y)&&(S=V,V=k,k=S),t(r,k,y)&&(S=r,r=k,k=S),t(V,P,y)&&(S=V,V=P,P=S),t(k,P,y)&&(S=k,k=P,P=S),t(r,l,y)&&(S=r,r=l,l=S),t(r,k,y)&&(S=r,r=k,k=S),t(P,l,y)&&(S=P,P=l,l=S);for(var c=y[2*r],W=y[2*r+1],B=y[2*P],J=y[2*P+1],g=2*V,b=2*k,p=2*l,f=2*C,N=2*M,j=2*Q,q=0;q<2;++q){var u=y[g+q],n=y[b+q],G=y[p+q];y[f+q]=u,y[N+q]=n,y[j+q]=G}E(i,w,y),E(s,A,y);for(var R=O;R<=T;++R)if(X(R,c,W,y))R!==O&&h(R,O,y),++O;else if(!X(R,B,J,y))for(;;){if(X(T,B,J,y)){X(T,c,W,y)?(e(R,O,T,y),++O,--T):(h(R,T,y),--T);break}if(--T<R)break}D(w,O-1,c,W,y),D(A,T+1,B,J,y),O-2-w<=o?H(w,O-2,y):L(w,O-2,y),A-(T+2)<=o?H(T+2,A,y):L(T+2,A,y),T-O<=o?H(O,T,y):L(O,T,y)}},13787:(w,o,H)=>{"use strict";w.exports={init:function(w){var o=E.nextPow2(w);X.length<o&&(h.free(X),X=h.mallocInt32(o));L.length<o&&(h.free(L),L=h.mallocInt32(o));A.length<o&&(h.free(A),A=h.mallocInt32(o));y.length<o&&(h.free(y),y=h.mallocInt32(o));z.length<o&&(h.free(z),z=h.mallocInt32(o));C.length<o&&(h.free(C),C=h.mallocInt32(o));var H=8*o;Q.length<H&&(h.free(Q),Q=h.mallocDouble(H))},sweepBipartite:function(w,o,H,h,E,t,z,C,s,V){for(var r=0,k=2*w,P=w-1,l=k-1,O=H;O<h;++O){var T=t[O],S=k*O;Q[r++]=E[S+P],Q[r++]=-(T+1),Q[r++]=E[S+l],Q[r++]=T}for(O=z;O<C;++O){T=V[O]+D;var c=k*O;Q[r++]=s[c+P],Q[r++]=-T,Q[r++]=s[c+l],Q[r++]=T}var W=r>>>1;e(Q,W);var B=0,J=0;for(O=0;O<W;++O){var g=0|Q[2*O+1];if(g>=D)M(A,y,J--,g=g-D|0);else if(g>=0)M(X,L,B--,g);else if(g<=-D){g=-g-D|0;for(var b=0;b<B;++b){if(void 0!==(p=o(X[b],g)))return p}i(A,y,J++,g)}else{g=-g-1|0;for(b=0;b<J;++b){var p;if(void 0!==(p=o(g,A[b])))return p}i(X,L,B++,g)}}},sweepComplete:function(w,o,H,h,E,D,t,s,V,r){for(var k=0,P=2*w,l=w-1,O=P-1,T=H;T<h;++T){var S=D[T]+1<<1,c=P*T;Q[k++]=E[c+l],Q[k++]=-S,Q[k++]=E[c+O],Q[k++]=S}for(T=t;T<s;++T){S=r[T]+1<<1;var W=P*T;Q[k++]=V[W+l],Q[k++]=1|-S,Q[k++]=V[W+O],Q[k++]=1|S}var B=k>>>1;e(Q,B);var J=0,g=0,b=0;for(T=0;T<B;++T){var p=0|Q[2*T+1],f=1&p;if(T<B-1&&p>>1===Q[2*T+3]>>1&&(f=2,T+=1),p<0){for(var N=-(p>>1)-1,j=0;j<b;++j){if(void 0!==(q=o(z[j],N)))return q}if(0!==f)for(j=0;j<J;++j){if(void 0!==(q=o(X[j],N)))return q}if(1!==f)for(j=0;j<g;++j){var q;if(void 0!==(q=o(A[j],N)))return q}0===f?i(X,L,J++,N):1===f?i(A,y,g++,N):2===f&&i(z,C,b++,N)}else{N=(p>>1)-1;0===f?M(X,L,J--,N):1===f?M(A,y,g--,N):2===f&&M(z,C,b--,N)}}},scanBipartite:function(w,o,H,h,E,t,A,y,z,C,s,V){var r=0,k=2*w,P=o,l=o+w,O=1,T=1;h?T=D:O=D;for(var S=E;S<t;++S){var c=S+O,W=k*S;Q[r++]=A[W+P],Q[r++]=-c,Q[r++]=A[W+l],Q[r++]=c}for(S=z;S<C;++S){c=S+T;var B=k*S;Q[r++]=s[B+P],Q[r++]=-c}var J=r>>>1;e(Q,J);var g=0;for(S=0;S<J;++S){var b=0|Q[2*S+1];if(b<0){var p=!1;if((c=-b)>=D?(p=!h,c-=D):(p=!!h,c-=1),p)i(X,L,g++,c);else{var f=V[c],N=k*c,j=s[N+o+1],q=s[N+o+1+w];w:for(var u=0;u<g;++u){var n=X[u],G=k*n;if(!(q<A[G+o+1]||A[G+o+1+w]<j)){for(var R=o+2;R<w;++R)if(s[N+R+w]<A[G+R]||A[G+R+w]<s[N+R])continue w;var a,d=y[n];if(void 0!==(a=h?H(f,d):H(d,f)))return a}}}}else M(X,L,g--,b-O)}},scanComplete:function(w,o,H,h,E,t,L,A,y,z,C){for(var M=0,i=2*w,s=o,V=o+w,r=h;r<E;++r){var k=r+D,P=i*r;Q[M++]=t[P+s],Q[M++]=-k,Q[M++]=t[P+V],Q[M++]=k}for(r=A;r<y;++r){k=r+1;var l=i*r;Q[M++]=z[l+s],Q[M++]=-k}var O=M>>>1;e(Q,O);var T=0;for(r=0;r<O;++r){var S=0|Q[2*r+1];if(S<0){if((k=-S)>=D)X[T++]=k-D;else{var c=C[k-=1],W=i*k,B=z[W+o+1],J=z[W+o+1+w];w:for(var g=0;g<T;++g){var b=X[g],p=L[b];if(p===c)break;var f=i*b;if(!(J<t[f+o+1]||t[f+o+1+w]<B)){for(var N=o+2;N<w;++N)if(z[W+N+w]<t[f+N]||t[f+N+w]<z[W+N])continue w;var j=H(p,c);if(void 0!==j)return j}}}}else{for(k=S-D,g=T-1;g>=0;--g)if(X[g]===k){for(N=g+1;N<T;++N)X[N-1]=X[N];break}--T}}}};var h=H(13769),E=H(13778),e=H(13789),D=1<<28,t=1024,X=h.mallocInt32(t),L=h.mallocInt32(t),A=h.mallocInt32(t),y=h.mallocInt32(t),z=h.mallocInt32(t),C=h.mallocInt32(t),Q=h.mallocDouble(8192);function M(w,o,H,h){var E=o[h],e=w[H-1];w[E]=e,o[e]=E}function i(w,o,H,h){w[H]=h,o[h]=H}},13782:w=>{"use strict";function o(w,H,h){var E=0|w[h];if(E<=0)return[];var e,D=new Array(E);if(h===w.length-1)for(e=0;e<E;++e)D[e]=H;else for(e=0;e<E;++e)D[e]=o(w,H,h+1);return D}w.exports=function(w,H){switch("undefined"===typeof H&&(H=0),typeof w){case"number":if(w>0)return function(w,o){var H,h;for(H=new Array(w),h=0;h<w;++h)H[h]=o;return H}(0|w,H);break;case"object":if("number"===typeof w.length)return o(w,H,0)}return[]}},13726:(w,o,H)=>{w.exports=function(){var w=this;this.components={},this.comps=this.components;var o=this.components,H=1,E={},e=[],D=[],t={timeout:!1,removals:[],multiComps:[]};function X(w,H){var h=o[H],e=E[H],D=e.hash[w];D&&(e.remove(w),h.th&&(h.multi?(D.forEach((o=>{o&&h.th(w,o)})),D.length=0):h.th(w,D)),t.removals.push(e),L())}function L(){t.timeout||(t.timeout=!0,setTimeout(A,1))}function A(){t.timeout=!1,y()}function y(){t.multiComps.length&&function(w){for(var o=0;o<w.length;o++){var{entID:H,data:h}=w[o],E=h.hash[H];if(E){for(var e=0;e<E.length;e++)E[e]||(E.splice(e,1),e--);0===E.length&&(h.remove(H),t.removals.push(h))}}w.length=0}(t.multiComps),t.removals.length&&function(w){for(var o=0;o<w.length;o++){w[o].flush()}w.length=0}(t.removals)}this.zy=E,this._systems=e,this._renderSystems=D,this.oA=function(o){var h=H++;return Array.isArray(o)&&o.forEach((o=>w.qX(h,o))),h},this.deleteEntity=function(o){return Object.keys(E).forEach((w=>{E[w].hash[o]&&X(o,w)})),w},this.iA=function(w){if(!w)throw new Error("Missing component definition");var H=w.name;if(!H)throw new Error("Component definition must have a name property.");if("string"!==typeof H)throw new Error("Component name must be a string.");if(""===H)throw new Error("Component name must be a non-empty string.");if(E[H])throw new Error(`Component ${H} already exists.`);var t={};return t.name=H,t.multi=!!w.multi,t.order=isNaN(w.order)?99:w.order,t.stateConstructor=w.stateConstructor||null,t.state=w.state||{},t.ft=w.ft||null,t.th=w.th||null,t.system=w.system||null,t.Gt=w.Gt||null,o[H]=t,E[H]=new h,E[H]._pendingMultiCleanup=!1,E[H]._multiCleanupIDs=t.multi?[]:null,t.system&&(e.push(H),e.sort(((w,H)=>o[w].order-o[H].order))),t.Gt&&(D.push(H),D.sort(((w,H)=>o[w].order-o[H].order))),H},this.overwriteComponent=function(w,H){var h=o[w];if(!h)throw new Error(`Unknown component: ${w}`);if(!H)throw new Error("Missing component definition");if(h.name!==H.name)throw new Error("Overwriting component must use the same name property.");var t={};t.name=w,t.multi=!!H.multi,t.order=isNaN(H.order)?99:H.order,t.state=H.state||{},t.ft=H.ft||null,t.th=H.th||null,t.system=H.system||null,t.Gt=H.Gt||null,o[w]=t,E[w]._pendingMultiCleanup=!1,E[w]._multiCleanupIDs=t.multi?[]:null;var X=e.indexOf(w);t.system&&X<0&&e.push(w),!t.system&&X>=0&&e.splice(X,1),e.sort(((w,H)=>o[w].order-o[H].order));var L=D.indexOf(w);t.Gt&&L<0&&D.push(w),!t.Gt&&L>=0&&D.splice(L,1),D.sort(((w,H)=>o[w].order-o[H].order));var A=t.state;return this.jL(w).forEach((w=>{for(var o in A)o in w||(w[o]=A[o]);t.ft&&t.ft(w.ut,w)})),w},this.deleteComponent=function(H){var h=E[H];if(!h)throw new Error(`Unknown component: ${H}`);h.flush(),h.list.forEach((w=>{w&&X(w.ut||w[0].ut,H)}));var t=e.indexOf(H),L=D.indexOf(H);return t>-1&&e.splice(t,1),L>-1&&D.splice(L,1),E[H].dispose(),delete E[H],delete o[H],w},this.qX=function(w,H,h){var e,D=o[H],t=E[H];if(!t)throw new Error(`Unknown component: ${H}.`);if(t.hash[w]&&!D.multi)throw new Error(`Entity ${w} already has component: ${H}.`);if(D.stateConstructor){if(!(e=new D.stateConstructor).hasOwnProperty("ut"))throw new Error(`Component ${D.name} stateConstructor type does not have property __id`)}else e=Object.assign({},{ut:w},D.state,h);if(e.ut=w,D.multi){var X=t.hash[w];X||(X=[],t.add(w,X)),X.push(e)}else t.add(w,e);return D.ft&&D.ft(w,e),this},this.FX=function(w,o){var H=E[o];if(!H)throw new Error(`Unknown component: ${o}.`);return!!H.hash[w]},this.RX=function(o,H){if(!E[H])throw new Error(`Unknown component: ${H}.`);return X(o,H),w},this.getState=function(w,o){var H=E[o];if(!H)throw new Error(`Unknown component: ${o}.`);return H.hash[w]},this.jL=function(w){var o=E[w];if(!o)throw new Error(`Unknown component: ${w}.`);return y(),o.list},this.AC=function(w){if(!E[w])throw new Error(`Unknown component: ${w}.`);var o=E[w].hash;return w=>o[w]},this.CC=function(w){if(!E[w])throw new Error(`Unknown component: ${w}.`);var o=E[w].hash;return w=>!!o[w]},this.Bt=function(H){y();for(var h=0;h<e.length;h++){var D=e[h],t=o[D],X=E[D];t.system(H,X.list),y()}return w},this.render=function(H){y();for(var h=0;h<D.length;h++){var e=D[h],t=o[e],X=E[e];t.Gt(H,X.list),y()}return w},this.removeMultiComponent=function(H,h,e){var D=o[h],X=E[h];if(!X)throw new Error(`Unknown component: ${h}.`);if(!D.multi)throw new Error("removeMultiComponent called on non-multi component");return function(w,o,H,h){var E=H.hash[w];if(E){var e=E[h];e&&(E[h]=null,o.th&&o.th(w,e),t.multiComps.push({entID:w,data:H}),L())}}(H,D,X,e),w}};var h=H(13734)},13734:w=>{function o(w,o){var H=w._map[o];if(delete w.hash[o],delete w._map[o],H===w.list.length-1)w.list.pop();else{var h=w.list.pop();if(w.list[H]=h,null===h||null===h[0]){var E=w.list.length;for(var e in w._map)if(w._map[e]===E)return void(w._map[e]=H)}else{var D=h.ut||h[0].ut;w._map[D]=H}}}w.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(w,o){if("number"===typeof this._map[w]){var H=this._map[w];this.hash[w]=o,this.list[H]=o}else this._map[w]=this.list.length,this.hash[w]=o,this.list.push(o)}remove(w){var o=this._map[w];this.hash[w]=null,this.list[o]=null,this._pendingRemovals.push(w)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var w=0;w<this._pendingRemovals.length;w++){var H=this._pendingRemovals[w];null===this.hash[H]&&o(this,H)}this._pendingRemovals.length=0}}},13683:w=>{"use strict";var o,H="object"===typeof Reflect?Reflect:null,h=function(w,o,H){return Function.prototype.apply.call(w,o,H)};o=H&&"function"===typeof H.ownKeys?H.ownKeys:Object.getOwnPropertySymbols?function(w){return Object.getOwnPropertyNames(w).concat(Object.getOwnPropertySymbols(w))}:function(w){return Object.getOwnPropertyNames(w)};var E=Number.isNaN||function(w){return w!==w};function e(){e.init.call(this)}w.exports=e,w.exports.once=function(w,o){return new Promise((function(H,h){function E(H){w.removeListener(o,e),h(H)}function e(){"function"===typeof w.removeListener&&w.removeListener("error",E),H([].slice.call(arguments))}M(w,o,e,{once:!0}),"error"!==o&&function(w,o,H){"function"===typeof w.on&&M(w,"error",o,H)}(w,E,{once:!0})}))},e.EventEmitter=e,e.prototype._events=void 0,e.prototype._eventsCount=0,e.prototype._maxListeners=void 0;var D=10;function t(w){if("function"!==typeof w)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}function X(w){return void 0===w._maxListeners?e.defaultMaxListeners:w._maxListeners}function L(w,o,H,h){var E,e,D,L;if(t(H),void 0===(e=w._events)?(e=w._events=Object.create(null),w._eventsCount=0):(void 0!==e.newListener&&(w.emit("newListener",o,H.listener?H.listener:H),e=w._events),D=e[o]),void 0===D)D=e[o]=H,++w._eventsCount;else if("function"===typeof D?D=e[o]=h?[H,D]:[D,H]:h?D.unshift(H):D.push(H),(E=X(w))>0&&D.length>E&&!D.warned){D.warned=!0;var A=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(o)+" listeners added. Use emitter.setMaxListeners() to increase limit");A.name="MaxListenersExceededWarning",A.Eo=w,A.type=o,A.count=D.length,L=A,console&&console.warn&&console.warn(L)}return w}function A(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(w,o,H){var h={fired:!1,wrapFn:void 0,target:w,type:o,listener:H},E=A.bind(h);return E.listener=H,h.wrapFn=E,E}function z(w,o,H){var h=w._events;if(void 0===h)return[];var E=h[o];return void 0===E?[]:"function"===typeof E?H?[E.listener||E]:[E]:H?function(w){for(var o=new Array(w.length),H=0;H<o.length;++H)o[H]=w[H].listener||w[H];return o}(E):Q(E,E.length)}function C(w){var o=this._events;if(void 0!==o){var H=o[w];if("function"===typeof H)return 1;if(void 0!==H)return H.length}return 0}function Q(w,o){for(var H=new Array(o),h=0;h<o;++h)H[h]=w[h];return H}function M(w,o,H,h){if("function"===typeof w.on)h.once?w.once(o,H):w.on(o,H);else{if("function"!==typeof w.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w);w.addEventListener(o,(function E(e){h.once&&w.removeEventListener(o,E),H(e)}))}}Object.defineProperty(e,"defaultMaxListeners",{enumerable:!0,get:function(){return D},set:function(w){if("number"!==typeof w||w<0||E(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");D=w}}),e.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},e.prototype.setMaxListeners=function(w){if("number"!==typeof w||w<0||E(w))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+w+".");return this._maxListeners=w,this},e.prototype.getMaxListeners=function(){return X(this)},e.prototype.emit=function(w){for(var o=[],H=1;H<arguments.length;H++)o.push(arguments[H]);var E="error"===w,e=this._events;if(void 0!==e)E=E&&void 0===e.error;else if(!E)return!1;if(E){var D;if(o.length>0&&(D=o[0]),D instanceof Error)throw D;var t=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw t.context=D,t}var X=e[w];if(void 0===X)return!1;if("function"===typeof X)h(X,this,o);else{var L=X.length,A=Q(X,L);for(H=0;H<L;++H)h(A[H],this,o)}return!0},e.prototype.addListener=function(w,o){return L(this,w,o,!1)},e.prototype.on=e.prototype.addListener,e.prototype.prependListener=function(w,o){return L(this,w,o,!0)},e.prototype.once=function(w,o){return t(o),this.on(w,y(this,w,o)),this},e.prototype.prependOnceListener=function(w,o){return t(o),this.prependListener(w,y(this,w,o)),this},e.prototype.removeListener=function(w,o){var H,h,E,e,D;if(t(o),void 0===(h=this._events))return this;if(void 0===(H=h[w]))return this;if(H===o||H.listener===o)0===--this._eventsCount?this._events=Object.create(null):(delete h[w],h.removeListener&&this.emit("removeListener",w,H.listener||o));else if("function"!==typeof H){for(E=-1,e=H.length-1;e>=0;e--)if(H[e]===o||H[e].listener===o){D=H[e].listener,E=e;break}if(E<0)return this;0===E?H.shift():function(w,o){for(;o+1<w.length;o++)w[o]=w[o+1];w.pop()}(H,E),1===H.length&&(h[w]=H[0]),void 0!==h.removeListener&&this.emit("removeListener",w,D||o)}return this},e.prototype.off=e.prototype.removeListener,e.prototype.eo=function(w){var o,H,h;if(void 0===(H=this._events))return this;if(void 0===H.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==H[w]&&(0===--this._eventsCount?this._events=Object.create(null):delete H[w]),this;if(0===arguments.length){var E,e=Object.keys(H);for(h=0;h<e.length;++h)"removeListener"!==(E=e[h])&&this.eo(E);return this.eo("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(o=H[w]))this.removeListener(w,o);else if(void 0!==o)for(h=o.length-1;h>=0;h--)this.removeListener(w,o[h]);return this},e.prototype.listeners=function(w){return z(this,w,!0)},e.prototype.rawListeners=function(w){return z(this,w,!1)},e.listenerCount=function(w,o){return"function"===typeof w.listenerCount?w.listenerCount(o):C.call(w,o)},e.prototype.listenerCount=C,e.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]}},13987:w=>{"use strict";w.exports=function(w,o,H,h,E,e){var D=+o[0],t=+o[1],X=+o[2],L=+H[0],A=+H[1],y=+H[2],z=Math.sqrt(L*L+A*A+y*y);if(0===z)throw new Error("Can't raycast along a zero vector");return function(w,o,H,h,E,e,D,t,X,L){for(var A=0,y=Math.floor,z=0|y(o),C=0|y(H),Q=0|y(h),M=E>0?1:-1,i=e>0?1:-1,s=D>0?1:-1,V=Math.abs(1/E),r=Math.abs(1/e),k=Math.abs(1/D),P=V<1/0?V*(M>0?z+1-o:o-z):1/0,l=r<1/0?r*(i>0?C+1-H:H-C):1/0,O=k<1/0?k*(s>0?Q+1-h:h-Q):1/0,T=-1;A<=t;){var S=w(z,C,Q);if(S)return X&&(X[0]=o+A*E,X[1]=H+A*e,X[2]=h+A*D),L&&(L[0]=L[1]=L[2]=0,0===T&&(L[0]=-M),1===T&&(L[1]=-i),2===T&&(L[2]=-s)),S;P<l?P<O?(z+=M,A=P,P+=V,T=0):(Q+=s,A=O,O+=k,T=2):l<O?(C+=i,A=l,l+=r,T=1):(Q+=s,A=O,O+=k,T=2)}return X&&(X[0]=o+A*E,X[1]=H+A*e,X[2]=h+A*D),L&&(L[0]=L[1]=L[2]=0),0}(w,D,t,X,L/=z,A/=z,y/=z,h="undefined"===typeof h?64:+h,E,e)}},14026:(w,o,H)=>{"use strict";H.d(o,{c:()=>e});var h=H(13683);function E(){this.Lz=!1,this.stopPropagation=!1,this.Az=!1,this.disabled=!1}class e{constructor(w,o){this.version="0.7.0";var H=Object.assign({},new E,o||{});this.element=w||document,this.Lz=!!H.Lz,this.stopPropagation=!!H.stopPropagation,this.Az=!!H.Az,this.disabled=!!H.disabled,this.filterEvents=(w,o)=>!0,this.down=new h.EventEmitter,this.up=new h.EventEmitter,this.state={},this.JL={dx:0,dy:0,oC:0,BL:0,HC:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?t(this):document.addEventListener("DOMContentLoaded",(w=>{t(this)}),{once:!0})}bind(w){for(var o=arguments.length,H=new Array(o>1?o-1:0),h=1;h<o;h++)H[h-1]=arguments[h];H.forEach((o=>{var H=this._keyBindmap[o]||[];H.includes(w)||(H.push(w),this._keyBindmap[o]=H)})),this.state[w]=!!this.state[w],this.pressCount[w]=this.pressCount[w]||0,this.releaseCount[w]=this.releaseCount[w]||0}unbind(w){for(var o in this._keyBindmap){var H=this._keyBindmap[o],h=H.indexOf(w);h>-1&&H.splice(h,1)}}getBindings(){var w={};for(var o in this._keyBindmap){this._keyBindmap[o].forEach((H=>{w[H]=w[H]||[],w[H].push(o)}))}return w}Bt(){D(this.JL),D(this.pressCount),D(this.releaseCount)}}function D(w){for(var o in w)w[o]=0}function t(w){window.addEventListener("keydown",Q.bind(null,w,!0),!1),window.addEventListener("keyup",Q.bind(null,w,!1),!1);var o={passive:!0};w.element.addEventListener("touchstart",y.bind(void 0,w),{passive:!1}),w.element.addEventListener("touchend",C.bind(void 0,w),o),w.element.addEventListener("mousedown",M.bind(null,w,!0),o),window.document.addEventListener("mouseup",M.bind(null,w,!1),o),w.element.addEventListener("touchmove",i.bind(null,w),o),w.element.addEventListener("mousemove",i.bind(null,w),o),window.PointerEvent,w.element.addEventListener("wheel",s.bind(null,w),o),w.element.addEventListener("contextmenu",V.bind(null,w),!1),window.addEventListener("blur",r.bind(null,w),!1)}var X=0,L=0,A=null;function y(w,o){o.preventDefault(),z(o)}function z(w){let o=!1;for(let H=0;H<w.touches.length;++H)if(w.touches[H].identifier===A){o=!0;break}if(!o){const o=w.changedTouches[0];X=o.clientX,L=o.clientY,A=o.identifier}}function C(w,o){for(var H=o.changedTouches,h=0;h<H.length;++h)H[h].identifier===A&&(A=null)}function Q(w,o,H){k(H.code,o,w,H)}function M(w,o,H){if("pointerId"in H)if(o){if(null!==w._touches.currID)return;w._touches.currID=H.pointerId}else{if(w._touches.currID!==H.pointerId)return;w._touches.currID=null}return k("Mouse"+("button"in H?H.button+1:1),o,w,H),!1}function i(w,o){var H=o.movementX||o.mozMovementX||0,h=o.movementY||o.mozMovementY||0;if(o.touches&&0===(H|h)){var E=function(w){z(w);for(let o=0;o<w.changedTouches.length;++o)if(w.changedTouches[o].identifier==A){const H=w.changedTouches[o],h=[H.clientX-X,H.clientY-L];return X=H.clientX,L=H.clientY,h}return console.error(`Did not find touch id ${A}`),[0,0]}(o);H=E[0],h=E[1]}w.JL.dx+=H,w.JL.dy+=h}function s(w,o){var H=1;switch(o.deltaMode){case 0:H=1;break;case 1:H=12;break;case 2:H=w.element.clientHeight||window.innerHeight}w.JL.oC+=(o.deltaX||0)*H,w.JL.BL+=(o.deltaY||0)*H,w.JL.HC+=(o.deltaZ||0)*H}function V(w,o){if(!w.Az)return o.preventDefault(),!1}function r(w){for(var o in w._keyStates)w._keyStates[o]&&(/^Mouse\d/.test(o)||k(o,!1,w,{code:o,note:"z5snvnzhtkb",preventDefault:()=>{},stopPropagation:()=>{}}))}function k(w,o,H,h){var E=H._keyBindmap[w];E&&(P(H._keyStates[w],o)&&(H._keyStates[w]=o,E.forEach((w=>{(!H.filterEvents||H.filterEvents(h,w))&&function(w,o,H,h){var E=o?H.pressCount:H.releaseCount;E[w]=(E[w]||0)+1;var e=H._bindPressCount[w]||0;(e+=o?1:-1)<0&&(e=0);H._bindPressCount[w]=e;var D=H.state[w];if(P(D,e)){H.state[w]=e>0;var t=o?H.down:H.up;H.disabled||t.emit(w,h)}}(w,o,H,h)}))),"button"in h||(H.Lz&&!h.defaultPrevented&&h.preventDefault(),H.stopPropagation&&h.stopPropagation()))}function P(w,o){return w?!o:o}},12590:w=>{w.exports=function(w,o,H){return w[0]=o[0]+H[0],w[1]=o[1]+H[1],w[2]=o[2]+H[2],w}},12543:(w,o,H)=>{w.exports=function(w,o){var H=h(w[0],w[1],w[2]),D=h(o[0],o[1],o[2]);E(H,H),E(D,D);var t=e(H,D);return t>1?0:Math.acos(t)};var h=H(12549),E=H(12554),e=H(12561)},12658:w=>{w.exports=function(w,o){return w[0]=Math.ceil(o[0]),w[1]=Math.ceil(o[1]),w[2]=Math.ceil(o[2]),w}},12534:w=>{w.exports=function(w){var o=new Float32Array(3);return o[0]=w[0],o[1]=w[1],o[2]=w[2],o}},12570:w=>{w.exports=function(w,o){return w[0]=o[0],w[1]=o[1],w[2]=o[2],w}},12529:w=>{w.exports=function(){var w=new Float32Array(3);return w[0]=0,w[1]=0,w[2]=0,w}},12733:w=>{w.exports=function(w,o,H){var h=o[0],E=o[1],e=o[2],D=H[0],t=H[1],X=H[2];return w[0]=E*X-e*t,w[1]=e*D-h*X,w[2]=h*t-E*D,w}},12684:(w,o,H)=>{w.exports=H(12679)},12679:w=>{w.exports=function(w,o){var H=o[0]-w[0],h=o[1]-w[1],E=o[2]-w[2];return Math.sqrt(H*H+h*h+E*E)}},12628:(w,o,H)=>{w.exports=H(12619)},12619:w=>{w.exports=function(w,o,H){return w[0]=o[0]/H[0],w[1]=o[1]/H[1],w[2]=o[2]/H[2],w}},12561:w=>{w.exports=function(w,o){return w[0]*o[0]+w[1]*o[1]+w[2]*o[2]}},12525:w=>{w.exports=1e-6},12575:(w,o,H)=>{w.exports=function(w,o){var H=w[0],E=w[1],e=w[2],D=o[0],t=o[1],X=o[2];return Math.abs(H-D)<=h*Math.max(1,Math.abs(H),Math.abs(D))&&Math.abs(E-t)<=h*Math.max(1,Math.abs(E),Math.abs(t))&&Math.abs(e-X)<=h*Math.max(1,Math.abs(e),Math.abs(X))};var h=H(12525)},12581:w=>{w.exports=function(w,o){return w[0]===o[0]&&w[1]===o[1]&&w[2]===o[2]}},12650:w=>{w.exports=function(w,o){return w[0]=Math.floor(o[0]),w[1]=Math.floor(o[1]),w[2]=Math.floor(o[2]),w}},12780:(w,o,H)=>{w.exports=function(w,o,H,E,e,D){var t,X;o||(o=3);H||(H=0);X=E?Math.min(E*o+H,w.length):w.length;for(t=H;t<X;t+=o)h[0]=w[t],h[1]=w[t+1],h[2]=w[t+2],e(h,h,D),w[t]=h[0],w[t+1]=h[1],w[t+2]=h[2];return w};var h=H(12529)()},12549:w=>{w.exports=function(w,o,H){var h=new Float32Array(3);return h[0]=w,h[1]=o,h[2]=H,h}},12523:(w,o,H)=>{w.exports={EPSILON:H(12525),create:H(12529),clone:H(12534),angle:H(12543),Vt:H(12549),j:H(12570),set:H(12573),equals:H(12575),exactEquals:H(12581),add:H(12590),so:H(12593),sub:H(12600),multiply:H(12608),mul:H(12610),divide:H(12619),div:H(12628),min:H(12635),max:H(12643),floor:H(12650),ceil:H(12658),round:H(12665),scale:H(12669),rt:H(12675),distance:H(12679),i:H(12684),squaredDistance:H(12693),sqrDist:H(12697),length:H(12700),len:H(12709),squaredLength:H(12711),kt:H(12716),negate:H(12723),inverse:H(12728),normalize:H(12554),dot:H(12561),cross:H(12733),Mt:H(12741),random:H(12749),transformMat4:H(12753),transformMat3:H(12759),transformQuat:H(12762),Pt:H(12768),Ot:H(12774),Tt:H(12778),forEach:H(12780)}},12728:w=>{w.exports=function(w,o){return w[0]=1/o[0],w[1]=1/o[1],w[2]=1/o[2],w}},12709:(w,o,H)=>{w.exports=H(12700)},12700:w=>{w.exports=function(w){var o=w[0],H=w[1],h=w[2];return Math.sqrt(o*o+H*H+h*h)}},12741:w=>{w.exports=function(w,o,H,h){var E=o[0],e=o[1],D=o[2];return w[0]=E+h*(H[0]-E),w[1]=e+h*(H[1]-e),w[2]=D+h*(H[2]-D),w}},12643:w=>{w.exports=function(w,o,H){return w[0]=Math.max(o[0],H[0]),w[1]=Math.max(o[1],H[1]),w[2]=Math.max(o[2],H[2]),w}},12635:w=>{w.exports=function(w,o,H){return w[0]=Math.min(o[0],H[0]),w[1]=Math.min(o[1],H[1]),w[2]=Math.min(o[2],H[2]),w}},12610:(w,o,H)=>{w.exports=H(12608)},12608:w=>{w.exports=function(w,o,H){return w[0]=o[0]*H[0],w[1]=o[1]*H[1],w[2]=o[2]*H[2],w}},12723:w=>{w.exports=function(w,o){return w[0]=-o[0],w[1]=-o[1],w[2]=-o[2],w}},12554:w=>{w.exports=function(w,o){var H=o[0],h=o[1],E=o[2],e=H*H+h*h+E*E;e>0&&(e=1/Math.sqrt(e),w[0]=o[0]*e,w[1]=o[1]*e,w[2]=o[2]*e);return w}},12749:w=>{w.exports=function(w,o){o=o||1;var H=2*Math.random()*Math.PI,h=2*Math.random()-1,E=Math.sqrt(1-h*h)*o;return w[0]=Math.cos(H)*E,w[1]=Math.sin(H)*E,w[2]=h*o,w}},12768:w=>{w.exports=function(w,o,H,h){var E=H[1],e=H[2],D=o[1]-E,t=o[2]-e,X=Math.sin(h),L=Math.cos(h);return w[0]=o[0],w[1]=E+D*L-t*X,w[2]=e+D*X+t*L,w}},12774:w=>{w.exports=function(w,o,H,h){var E=H[0],e=H[2],D=o[0]-E,t=o[2]-e,X=Math.sin(h),L=Math.cos(h);return w[0]=E+t*X+D*L,w[1]=o[1],w[2]=e+t*L-D*X,w}},12778:w=>{w.exports=function(w,o,H,h){var E=H[0],e=H[1],D=o[0]-E,t=o[1]-e,X=Math.sin(h),L=Math.cos(h);return w[0]=E+D*L-t*X,w[1]=e+D*X+t*L,w[2]=o[2],w}},12665:w=>{w.exports=function(w,o){return w[0]=Math.round(o[0]),w[1]=Math.round(o[1]),w[2]=Math.round(o[2]),w}},12669:w=>{w.exports=function(w,o,H){return w[0]=o[0]*H,w[1]=o[1]*H,w[2]=o[2]*H,w}},12675:w=>{w.exports=function(w,o,H,h){return w[0]=o[0]+H[0]*h,w[1]=o[1]+H[1]*h,w[2]=o[2]+H[2]*h,w}},12573:w=>{w.exports=function(w,o,H,h){return w[0]=o,w[1]=H,w[2]=h,w}},12697:(w,o,H)=>{w.exports=H(12693)},12716:(w,o,H)=>{w.exports=H(12711)},12693:w=>{w.exports=function(w,o){var H=o[0]-w[0],h=o[1]-w[1],E=o[2]-w[2];return H*H+h*h+E*E}},12711:w=>{w.exports=function(w){var o=w[0],H=w[1],h=w[2];return o*o+H*H+h*h}},12600:(w,o,H)=>{w.exports=H(12593)},12593:w=>{w.exports=function(w,o,H){return w[0]=o[0]-H[0],w[1]=o[1]-H[1],w[2]=o[2]-H[2],w}},12759:w=>{w.exports=function(w,o,H){var h=o[0],E=o[1],e=o[2];return w[0]=h*H[0]+E*H[3]+e*H[6],w[1]=h*H[1]+E*H[4]+e*H[7],w[2]=h*H[2]+E*H[5]+e*H[8],w}},12753:w=>{w.exports=function(w,o,H){var h=o[0],E=o[1],e=o[2],D=H[3]*h+H[7]*E+H[11]*e+H[15];return D=D||1,w[0]=(H[0]*h+H[4]*E+H[8]*e+H[12])/D,w[1]=(H[1]*h+H[5]*E+H[9]*e+H[13])/D,w[2]=(H[2]*h+H[6]*E+H[10]*e+H[14])/D,w}},12762:w=>{w.exports=function(w,o,H){var h=o[0],E=o[1],e=o[2],D=H[0],t=H[1],X=H[2],L=H[3],A=L*h+t*e-X*E,y=L*E+X*h-D*e,z=L*e+D*E-t*h,C=-D*h-t*E-X*e;return w[0]=A*L+C*-D+y*-X-z*-t,w[1]=y*L+C*-t+z*-D-A*-X,w[2]=z*L+C*-X+A*-t-y*-D,w}},13708:w=>{"use strict";w.exports=function(w){for(var o=new Array(w),H=0;H<w;++H)o[H]=H;return o}},13784:w=>{w.exports=function(w){return null!=w&&null!=w.constructor&&"function"===typeof w.constructor.isBuffer&&w.constructor.isBuffer(w)}},13994:(w,o,H)=>{"use strict";H.d(o,{e:()=>h});class h{constructor(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.qA=!1,this.uA=!1,this.NA=30,this.jA=0,this.ZA=!1,this.fullscreen=!1,this.GA=function(w){},this.RA=function(){},this.IA=function(){},this.kh=function(){},this.aA=function(w){},this.onFullscreenChanged=function(w){},L((()=>{!function(w,o){w._nowObject=performance||Date,w._lastTick=0,w._renderAccum=0,w._rt=0,w._frameCB=t.bind(null,w),requestAnimationFrame(w._frameCB),o>0&&(w._intervalCB=D.bind(null,w),w._interval=setInterval(w._intervalCB,Math.max(o,1e3/w.NA/2)))}(this,o),function(w,o){if(!o)return;var H=!1,h=!1;document.addEventListener("pointerlockchange",(h=>{H=document.pointerLockElement===o,w.aA(H)})),document.addEventListener("fullscreenchange",(H=>{h=document.fullscreenElement===o,w.onFullscreenChanged(h)})),Object.defineProperty(w,"ZA",{get:()=>H,set:w=>{w&&!H?X(o):H&&!w&&function(w){w.exitPointerLock&&w.exitPointerLock()}(document)}}),Object.defineProperty(w,"fullscreen",{get:()=>h,set:w=>{w&&!h?o.requestFullscreen():h&&!w&&document.exitFullscreen()}}),o.addEventListener("click",(E=>{w.qA&&!H&&X(o),w.uA&&!h&&o.requestFullscreen()}));var E=()=>w.kh();if(window.ResizeObserver){new ResizeObserver(E).observe(o)}else window.addEventListener("resize",E)}(this,w),this.IA()}))}}var E=3,e=20;function D(w){for(var o=1e3/w.NA,H=w._nowObject.now()+e,h=0;w._nowObject.now()>=w._lastTick+o&&w._nowObject.now()<H&&++h<=E;)w.GA(o),w._lastTick+=o;var D=5*(o+5),t=w._nowObject.now();if(t-w._lastTick>D)for(;t>=w._lastTick+o;)w._lastTick+=o}function t(w){requestAnimationFrame(w._frameCB),D(w);var o=w._nowObject.now(),H=o-w._rt;if(w._rt=o,w.jA>0){w._renderAccum+=H;var h=1e3/w.jA;if(w._renderAccum<h)return;w._renderAccum=Math.min(w._renderAccum-h,h)}var E=1e3/w.NA,e=(o-w._lastTick)/E;w.RA(H,e,E)}function X(w){w.requestPointerLock&&w.requestPointerLock()}var L=w=>{if("loading"===document.readyState){var o=()=>{document.removeEventListener("readystatechange",o),w()};document.addEventListener("readystatechange",o)}else setTimeout(w,1)}},13701:(w,o,H)=>{var h=H(13708),E=H(13710),e="undefined"!==typeof Float64Array;function D(w,o){return w[0]-o[0]}function t(){var w,o=this.stride,H=new Array(o.length);for(w=0;w<H.length;++w)H[w]=[Math.abs(o[w]),w];H.sort(D);var h=new Array(H.length);for(w=0;w<h.length;++w)h[w]=H[w][1];return h}function X(w,o){var H=["View",o,"d",w].join("");o<0&&(H="View_Nil"+w);var E="generic"===w;if(-1===o){var e="function "+H+"(a){this.data=a;};var proto="+H+".prototype;proto.dtype='"+w+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+H+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+H+"(a){return new "+H+"(a);}";return new Function(e)()}if(0===o){e="function "+H+"(a,d) {this.data = a;this.offset = d};var proto="+H+".prototype;proto.dtype='"+w+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+H+"_copy() {return new "+H+"(this.data,this.offset)};proto.pick=function "+H+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+H+"_get(){return "+(E?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+H+"_set(v){return "+(E?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+H+"(a,b,c,d){return new "+H+"(a,d)}";return new Function("TrivialArray",e)(L[w][0])}e=["'use strict'"];var D=h(o),X=D.map((function(w){return"i"+w})),A="this.offset+"+D.map((function(w){return"this.stride["+w+"]*i"+w})).join("+"),y=D.map((function(w){return"b"+w})).join(","),z=D.map((function(w){return"c"+w})).join(",");e.push("function "+H+"(a,"+y+","+z+",d){this.data=a","this.shape=["+y+"]","this.stride=["+z+"]","this.offset=d|0}","var proto="+H+".prototype","proto.dtype='"+w+"'","proto.dimension="+o),e.push("Object.defineProperty(proto,'size',{get:function "+H+"_size(){return "+D.map((function(w){return"this.shape["+w+"]"})).join("*"),"}})"),1===o?e.push("proto.order=[0]"):(e.push("Object.defineProperty(proto,'order',{get:"),o<4?(e.push("function "+H+"_order(){"),2===o?e.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===o&&e.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):e.push("ORDER})")),e.push("proto.set=function "+H+"_set("+X.join(",")+",v){"),E?e.push("return this.data.set("+A+",v)}"):e.push("return this.data["+A+"]=v}"),e.push("proto.get=function "+H+"_get("+X.join(",")+"){"),E?e.push("return this.data.get("+A+")}"):e.push("return this.data["+A+"]}"),e.push("proto.index=function "+H+"_index(",X.join(),"){return "+A+"}"),e.push("proto.hi=function "+H+"_hi("+X.join(",")+"){return new "+H+"(this.data,"+D.map((function(w){return["(typeof i",w,"!=='number'||i",w,"<0)?this.shape[",w,"]:i",w,"|0"].join("")})).join(",")+","+D.map((function(w){return"this.stride["+w+"]"})).join(",")+",this.offset)}");var C=D.map((function(w){return"a"+w+"=this.shape["+w+"]"})),Q=D.map((function(w){return"c"+w+"=this.stride["+w+"]"}));e.push("proto.lo=function "+H+"_lo("+X.join(",")+"){var b=this.offset,d=0,"+C.join(",")+","+Q.join(","));for(var M=0;M<o;++M)e.push("if(typeof i"+M+"==='number'&&i"+M+">=0){d=i"+M+"|0;b+=c"+M+"*d;a"+M+"-=d}");e.push("return new "+H+"(this.data,"+D.map((function(w){return"a"+w})).join(",")+","+D.map((function(w){return"c"+w})).join(",")+",b)}"),e.push("proto.step=function "+H+"_step("+X.join(",")+"){var "+D.map((function(w){return"a"+w+"=this.shape["+w+"]"})).join(",")+","+D.map((function(w){return"b"+w+"=this.stride["+w+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(M=0;M<o;++M)e.push("if(typeof i"+M+"==='number'){d=i"+M+"|0;if(d<0){c+=b"+M+"*(a"+M+"-1);a"+M+"=ceil(-a"+M+"/d)}else{a"+M+"=ceil(a"+M+"/d)}b"+M+"*=d}");e.push("return new "+H+"(this.data,"+D.map((function(w){return"a"+w})).join(",")+","+D.map((function(w){return"b"+w})).join(",")+",c)}");var i=new Array(o),s=new Array(o);for(M=0;M<o;++M)i[M]="a[i"+M+"]",s[M]="b[i"+M+"]";e.push("proto.transpose=function "+H+"_transpose("+X+"){"+X.map((function(w,o){return w+"=("+w+"===undefined?"+o+":"+w+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+H+"(this.data,"+i.join(",")+","+s.join(",")+",this.offset)}"),e.push("proto.pick=function "+H+"_pick("+X+"){var a=[],b=[],c=this.offset");for(M=0;M<o;++M)e.push("if(typeof i"+M+"==='number'&&i"+M+">=0){c=(c+this.stride["+M+"]*i"+M+")|0}else{a.push(this.shape["+M+"]);b.push(this.stride["+M+"])}");return e.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),e.push("return function construct_"+H+"(data,shape,stride,offset){return new "+H+"(data,"+D.map((function(w){return"shape["+w+"]"})).join(",")+","+D.map((function(w){return"stride["+w+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",e.join("\n"))(L[w],t)}var L={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};w.exports=function(w,o,H,h){if(void 0===w)return(0,L.array[0])([]);"number"===typeof w&&(w=[w]),void 0===o&&(o=[w.length]);var D=o.length;if(void 0===H){H=new Array(D);for(var t=D-1,A=1;t>=0;--t)H[t]=A,A*=o[t]}if(void 0===h){h=0;for(t=0;t<D;++t)H[t]<0&&(h-=(o[t]-1)*H[t])}for(var y=function(w){if(E(w))return"buffer";if(e)switch(Object.prototype.toString.call(w)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(w)?"array":"generic"}(w),z=L[y];z.length<=D+1;)z.push(X(y,z.length-1));return(0,z[D+1])(w,o,H,h)}},13710:w=>{function o(w){return!!w.constructor&&"function"===typeof w.constructor.isBuffer&&w.constructor.isBuffer(w)}w.exports=function(w){return null!=w&&(o(w)||function(w){return"function"===typeof w.readFloatLE&&"function"===typeof w.slice&&o(w.slice(0,0))}(w)||!!w._isBuffer)}},13862:w=>{"use strict";var o=[],H=[],h=[],E=[],e=[],D=[],t=[],X=[],L=[],A=[],y=[],z=[];w.exports=function(w,C,Q,M,i,s){for(var V=t,r=L,k=A,P=z,l=0;l<3;l++)V[l]=+Q[l],k[l]=+C.max[l],r[l]=+C.base[l];s||(s=1e-10);var O=function(w,t,L,A,z,C){var Q=o,M=H,i=h,s=E,V=e,r=D,k=X,P=Math.floor,l=0,O=0,T=0,S=0,c=0;if(W(),0===T)return 0;for(S=g();O<=T;){if(B(S)&&J())return l;S=g()}for(l+=T,c=0;c<3;c++)A[c]+=L[c],z[c]+=L[c];return l;function W(){if(O=0,0!==(T=Math.sqrt(L[0]*L[0]+L[1]*L[1]+L[2]*L[2])))for(var w=0;w<3;w++){var o=L[w]>=0;s[w]=o?1:-1;var H=o?z[w]:A[w];Q[w]=o?A[w]:z[w],M[w]=b(H,s[w]),i[w]=p(Q[w],s[w]),k[w]=L[w]/T,V[w]=Math.abs(1/k[w]);var h=o?M[w]+1-H:H-M[w];r[w]=V[w]<1/0?V[w]*h:1/0}}function B(o){for(var H=s[0],h=0===o?M[0]:i[0],E=M[0]+H,e=s[1],D=1===o?M[1]:i[1],t=M[1]+e,X=s[2],L=2===o?M[2]:i[2],A=M[2]+X,y=h;y!=E;y+=H)for(var z=D;z!=t;z+=e)for(var C=L;C!=A;C+=X)if(w(y,z,C))return!0;return!1}function J(){l+=O;var w=s[S],o=O/T,H=y;for(c=0;c<3;c++){var h=L[c]*o;A[c]+=h,z[c]+=h,H[c]=L[c]-h}if(w>0?z[S]=Math.round(z[S]):A[S]=Math.round(A[S]),t(l,S,w,H))return!0;for(c=0;c<3;c++)L[c]=H[c];return W(),0===T}function g(){var w=r[0]<r[1]?r[0]<r[2]?0:2:r[1]<r[2]?1:2,o=r[w]-O;for(O=r[w],M[w]+=s[w],r[w]+=V[w],c=0;c<3;c++)Q[c]+=o*k[c],i[c]=p(Q[c],s[c]);return w}function b(w,o){return P(w-o*C)}function p(w,o){return P(w+o*C)}}(w,M,V,r,k,s);if(!i){for(l=0;l<3;l++)P[l]=Q[l]>0?k[l]-C.max[l]:r[l]-C.base[l];C.translate(P)}return O}},14035:(w,o,H)=>{"use strict";H.d(o,{d:()=>y});var h=H(13860),E=H(12523);class e{constructor(w,o,H,e,D,t,X){this.NL=new h(w.base,w.YL),this.CE=o,this.friction=H,this.restitution=e,this.Xt=D,this.PC=t,this.Lt=!!X,this.mA=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.XQ=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.AL=E.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=E.create(),this._impulses=E.create(),this._sleepFrameCount=10}loadFromCopy(w){E.j(this.NL.base,w.NL.base),E.j(this.NL.YL,w.NL.YL),E.j(this.NL.max,w.NL.max),this.NL.mag=w.NL.mag,this.CE=w.CE,this.friction=w.friction,this.restitution=w.restitution,this.Xt=w.Xt,this.PC=w.PC,this.Lt=w.Lt,this.mA=w.mA,this.fluidDrag=w.fluidDrag,this.XQ=w.XQ,this.preventFallOffEdge=w.preventFallOffEdge,this.rolledBackLastTick=w.rolledBackLastTick,E.j(this.AL,w.AL),E.j(this.resting,w.resting),this.inFluid=w.inFluid,this._ratioInFluid=w._ratioInFluid,E.j(this._forces,w._forces),E.j(this._impulses,w._impulses),this._sleepFrameCount=w._sleepFrameCount}setPosition(w){D(w),E.so(w,w,this.NL.base),this.NL.translate(w),this.CL()}gh(){return E.clone(this.NL.base)}applyForce(w){D(w),E.add(this._forces,this._forces,w),this.CL()}applyImpulse(w){D(w),E.add(this._impulses,this._impulses,w),this.CL()}CL(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var D=w=>{};var t=H(13860),X=H(12523),L=H(13862);function A(){this.mA=.1,this.fluidDrag=.4,this.Qt=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function y(w,o,H){w=Object.assign(new A,w),this.gravity=w.gravity||[0,-10,0],this.mA=w.mA||.1,this.Qt=w.Qt||2,this.fluidDrag=w.fluidDrag||.4,this.minBounceImpulse=w.minBounceImpulse,this.bodies=[],this.Iz=w.Iz,this.testSolid=o,this.testFluid=H}y.prototype.BC=function(w,o,H,h,E,D){w=w||new t([0,0,0],[1,1,1]),"undefined"==typeof o&&(o=1),"undefined"==typeof H&&(H=1),"undefined"==typeof h&&(h=0),"undefined"==typeof E&&(E=1);var X=new e(w,o,H,h,E,D);return this.bodies.push(X),X},y.prototype.JC=function(w){var o=this.bodies.indexOf(w);o<0||(this.bodies.splice(o,1),w.NL=w.PC=null)};var z=X.create(),C=X.create(),Q=X.create(),M=X.create(),i=X.create(),s=X.create(),V=X.create(),r=new t([0,0,0],[1,1,1]),k=new e(r,1,1,0,1,(()=>{}),!1);function P(w,o,H){return o=H,o*=1-(1-w.ratioInFluid)**2}y.prototype.Bt=function(w){w/=1e3;var o=u(0,X.squaredLength(this.gravity));this.bodies.forEach((H=>function(w,o,H,h){X.j(i,o.resting),w.Iz&&k.loadFromCopy(o);if(o.CE<=0)return X.set(o.AL,0,0,0),X.set(o._forces,0,0,0),void X.set(o._impulses,0,0,0);var E=h||0===o.Xt;if(function(w,o,H,h){if(o._sleepFrameCount>0)return!1;if(h)return!0;var E=!1,e=.5*H*H*o.Xt;return X.scale(q,w.gravity,e),L(w.testSolid,o.NL,q,(function(){return E=!0,!0}),!0),E}(w,o,H,E))return;o._sleepFrameCount--,function(w,o){var H=o.NL,h=Math.floor(H.base[0]),E=Math.floor(H.base[2]),e=Math.floor(H.base[1]),D=Math.floor(H.max[1]);if(!w.testFluid(h,e,E))return o.inFluid=!1,void(o.ratioInFluid=0);var t=1,L=e+1;for(;L<=D&&w.testFluid(h,L,E);)t++,L++;var A=(e+t-H.base[1])/H.YL[1];A>1&&(A=1);var y=H.YL[0]*H.YL[1]*H.YL[2]*A,z=O;X.scale(z,w.gravity,-w.Qt*y*o.Xt),o.applyForce(z),o.inFluid=!0,o.ratioInFluid=A}(w,o),G(o._forces),G(o._impulses),G(o.AL),G(o.resting),X.scale(z,o._forces,1/o.CE),X.rt(z,z,w.gravity,o.Xt),X.scale(C,o._impulses,1/o.CE),X.rt(C,C,z,H),X.add(o.AL,o.AL,C),o.friction&&(T(w,0,o,C,H),T(w,1,o,C,H),T(w,2,o,C,H));var e=o.fluidDrag>=0?o.fluidDrag:w.fluidDrag,D=o.mA>=0?o.mA:w.mA,t=D,A=D;o.inFluid&&(t=P(o,t,o.fluidDragHoriz>=0?o.fluidDragHoriz:e),A=P(o,A,o.fluidDragVert>=0?o.fluidDragVert:e));t=Math.max(1-t*H/o.CE,0),A=Math.max(1-A*H/o.CE,0),X.set(l,t,A,t),X.multiply(o.AL,o.AL,l),X.scale(Q,o.AL,H),X.set(o._forces,0,0,0),X.set(o._impulses,0,0,0),o.Lt&&n(W,o.NL);X.j(s,Q),X.set(V,0,0,0),o.preventFallOffEdge&&function(w,o,H,h){if(!o.resting[1]||H[1]>0)return;var E=f;n(E,o.NL);for(var e=0;e<3;e+=2){X.set(p,0,0,0),p[e]=H[e];var D=!0;(D=(D=(D=(D=D&&!j(w,E.base[0]+p[0]+1e-5,E.base[1],E.base[2]+p[2]+1e-5))&&!j(w,E.max[0]+p[0]-1e-5,E.base[1],E.base[2]+p[2]+1e-5))&&!j(w,E.base[0]+p[0]+1e-5,E.base[1],E.max[2]+p[2]-1e-5))&&!j(w,E.max[0]+p[0]-1e-5,E.base[1],E.max[2]+p[2]-1e-5))?(h[e]=H[e]>0?1:-1,H[e]=0):0===e&&(X.set(N,H[0],0,0),c(w,E,N,h,o.slideOnCollision))}}(w,o,Q,V);c(w,o.NL,Q,o.resting,o.slideOnCollision),o.Lt&&function(w,o,H,h){if(o.resting[1]>=0&&!o.inFluid)return;var E=0!==o.resting[0],e=0!==o.resting[2];if(!E&&!e)return;var D=Math.abs(h[0]/h[2]),t=4;if(!E&&D>t)return;if(!e&&D<1/t)return;X.add(J,H.base,h);var A=w.testSolid;L(A,H,h,(function(w,o,H,h){if(1!==o)return!0;h[o]=0}));var y=H.base[1],z=o.inFluid?1.951:1.001,C=Math.floor(y+z)-y;X.set(g,0,C,0);var Q=!1;if(L(A,H,g,(function(w,o,H,h){return Q=!0,!0})),Q)return;X.so(b,J,H.base),b[1]=0,c(w,H,b,B,!0);var M=u(H.base[0],J[0]),i=u(H.base[2],J[2]);if(E&&!M&&(!i||!e))return;if(e&&(!M||!E)&&!i)return;var s=!0;if(s=s&&!j(w,H.base[0]+1e-5,H.base[1],H.base[2]+1e-5),s=s&&!j(w,H.max[0]-1e-5,H.base[1],H.base[2]+1e-5),s=s&&!j(w,H.base[0]+1e-5,H.base[1],H.max[2]-1e-5),s=s&&!j(w,H.max[0]-1e-5,H.base[1],H.max[2]-1e-5),s)return;n(o.NL,H),o.resting[0]=B[0],o.resting[2]=B[2],o.XQ&&o.XQ()}(w,o,W,s);for(var y=0;y<3;++y)o.resting[y]=o.resting[y]||V[y],M[y]=0,o.resting[y]&&(i[y]||(M[y]=-o.AL[y]),o.AL[y]=0);var r=X.length(M);r>.001&&(X.scale(M,M,o.CE),o.PC&&o.PC(M),o.restitution>0&&r>w.minBounceImpulse&&(X.scale(M,M,o.restitution),o.applyImpulse(M)));var S=X.squaredLength(o.AL);S>1e-5&&o.CL();w.Iz&&w.Iz(o)?(o.loadFromCopy(k),o.rolledBackLastTick=!0):o.rolledBackLastTick=!1}(this,H,w,o)))};var l=X.create([0,0,0]);var O=X.create();function T(w,o,H,h,E){var e=H.resting[o],D=h[o];if(!H.alwaysApplyHorizFriction||1!==o){if(0===e)return;if(e*D<=0)return}X.j(S,H.AL),S[o]=0;var t=X.length(S);if(!u(t,0)){var L=Math.abs(H.friction*w.gravity[o]*E),A=t>L?(t-L)/t:0;H.AL[(o+1)%3]*=A,H.AL[(o+2)%3]*=A}}var S=X.create();function c(w,o,H,h,E){return X.set(h,0,0,0),L(w.testSolid,o,H,(function(w,o,H,e){h[o]=H,e[o]=0,E||(e[0]=0,e[1]=0,e[2]=0)}))}var W=new t([],[]),B=X.create(),J=X.create(),g=X.create(),b=X.create();var p=X.create(),f=new t([],[]),N=X.create();function j(w,o,H,h){return w.testSolid(Math.floor(o),Math.floor(H-1),Math.floor(h))}var q=X.create();function u(w,o){return Math.abs(w-o)<1e-5}function n(w,o){for(var H=0;H<3;H++)w.base[H]=o.base[H],w.max[H]=o.max[H],w.YL[H]=o.YL[H]}var G=function(w){}},12409:function(w,o){!function(w){"use strict";var o=function(w,H){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,o){w.__proto__=o}||function(w,o){for(var H in o)Object.prototype.hasOwnProperty.call(o,H)&&(w[H]=o[H])},o(w,H)};function H(w,H){if("function"!==typeof H&&null!==H)throw new TypeError("Class extends value "+String(H)+" is not a constructor or null");function h(){this.constructor=w}o(w,H),w.prototype=null===H?Object.create(H):(h.prototype=H.prototype,new h)}function h(w,o,H,h){var E,e=arguments.length,D=e<3?o:null===h?h=Object.getOwnPropertyDescriptor(o,H):h;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)D=Reflect.decorate(w,o,H,h);else for(var t=w.length-1;t>=0;t--)(E=w[t])&&(D=(e<3?E(D):e>3?E(o,H,D):E(o,H))||D);return e>3&&D&&Object.defineProperty(o,H,D),D}function E(w,o,H){if(H||2===arguments.length)for(var h,E=0,e=o.length;E<e;E++)!h&&E in o||(h||(h=Array.prototype.slice.call(o,0,E)),h[E]=o[E]);return w.concat(h||Array.prototype.slice.call(o))}var e,D=255,t=213;w.OPERATION=void 0,(e=w.OPERATION||(w.OPERATION={}))[e.ADD=128]="ADD",e[e.REPLACE=0]="REPLACE",e[e.DELETE=64]="DELETE",e[e.DELETE_AND_ADD=192]="DELETE_AND_ADD",e[e.TOUCH=1]="TOUCH",e[e.CLEAR=10]="CLEAR";var X=function(){function o(w,o,H){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=w,this.setParent(o,H)}return o.prototype.setParent=function(w,o,H){var h=this;if(this.indexes||(this.indexes=this.ref instanceof bw?this.ref._definition.indexes:{}),this.parent=w,this.parentIndex=H,o)if(this.root=o,this.ref instanceof bw){var E=this.ref._definition;for(var e in E.schema){var D=this.ref[e];if(D&&D.$changes){var t=E.indexes[e];D.$changes.setParent(this.ref,o,t)}}}else"object"===typeof this.ref&&this.ref.forEach((function(w,o){if(w instanceof bw){var H=w.$changes,E=h.ref.$changes.indexes[o];H.setParent(h.ref,h.root,E)}}))},o.prototype.operation=function(w){this.changes.set(--this.currentCustomOperation,w)},o.prototype.change=function(o,H){void 0===H&&(H=w.OPERATION.ADD);var h="number"===typeof o?o:this.indexes[o];this.assertValidIndex(h,o);var E=this.changes.get(h);E&&E.op!==w.OPERATION.DELETE&&E.op!==w.OPERATION.TOUCH||this.changes.set(h,{op:E&&E.op===w.OPERATION.DELETE?w.OPERATION.DELETE_AND_ADD:H,index:h}),this.allChanges.add(h),this.changed=!0,this.touchParents()},o.prototype.touch=function(o){var H="number"===typeof o?o:this.indexes[o];this.assertValidIndex(H,o),this.changes.has(H)||this.changes.set(H,{op:w.OPERATION.TOUCH,index:H}),this.allChanges.add(H),this.touchParents()},o.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},o.prototype.getType=function(w){if(this.ref._definition)return(o=this.ref._definition).schema[o.fieldsByIndex[w]];var o,H=(o=this.parent._definition).schema[o.fieldsByIndex[this.parentIndex]];return Object.values(H)[0]},o.prototype.getChildrenFilter=function(){var w=this.parent._definition.childFilters;return w&&w[this.parentIndex]},o.prototype.getValue=function(w){return this.ref.getByIndex(w)},o.prototype.delete=function(o){var H="number"===typeof o?o:this.indexes[o];if(void 0!==H){var h=this.getValue(H);this.changes.set(H,{op:w.OPERATION.DELETE,index:H}),this.allChanges.delete(H),delete this.caches[H],h&&h.$changes&&(h.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(o," (").concat(H,")"))},o.prototype.discard=function(o,H){var h=this;void 0===o&&(o=!1),void 0===H&&(H=!1),this.ref instanceof bw||this.changes.forEach((function(o){if(o.op===w.OPERATION.DELETE){var H=h.ref.getIndex(o.index);delete h.indexes[H]}})),this.changes.clear(),this.changed=o,H&&this.allChanges.clear(),this.currentCustomOperation=0},o.prototype.discardAll=function(){var w=this;this.changes.forEach((function(o){var H=w.getValue(o.index);H&&H.$changes&&H.$changes.discardAll()})),this.discard()},o.prototype.cache=function(w,o){this.caches[w]=o},o.prototype.clone=function(){return new o(this.ref,this.parent,this.root)},o.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},o.prototype.assertValidIndex=function(w,o){if(void 0===w)throw new Error('ChangeTree: missing index for field "'.concat(o,'"'))},o}();function L(w,o,H,h){return w[o]||(w[o]=[]),w[o].push(H),null===h||void 0===h||h.forEach((function(w,o){return H(w,o)})),function(){return y(w[o],w[o].indexOf(H))}}function A(o){var H=this,h="string"!==typeof this.$changes.getType();this.$items.forEach((function(E,e){o.push({refId:H.$changes.refId,op:w.OPERATION.DELETE,field:e,value:void 0,previousValue:E}),h&&H.$changes.root.removeRef(E.$changes.refId)}))}function y(w,o){if(-1===o||o>=w.length)return!1;for(var H=w.length-1,h=o;h<H;h++)w[h]=w[h+1];return w.length=H,!0}var z=function(w,o){var H=w.toString(),h=o.toString();return H<h?-1:H>h?1:0};function C(w){return w.$proxy=!0,w=new Proxy(w,{get:function(w,o){return"symbol"===typeof o||isNaN(o)?w[o]:w.at(o)},set:function(w,o,H){if("symbol"===typeof o||isNaN(o))w[o]=H;else{var h=Array.from(w.$items.keys()),E=parseInt(h[o]||o);void 0===H||null===H?w.deleteAt(E):w.setAt(E,H)}return!0},deleteProperty:function(w,o){return"number"===typeof o?w.deleteAt(o):delete w[o],!0}})}var Q=function(){function o(){for(var w=[],o=0;o<arguments.length;o++)w[o]=arguments[o];this.$changes=new X(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,w)}return o.prototype.ft=function(o,H){return void 0===H&&(H=!0),L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,o,H?this.$items:void 0)},o.prototype.th=function(o){return L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,o)},o.prototype.onChange=function(o){return L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,o)},o.is=function(w){return Array.isArray(w)||void 0!==w.array},Object.defineProperty(o.prototype,"length",{get:function(){return this.$items.size},set:function(w){0===w?this.clear():this.splice(w,this.length-w)},enumerable:!1,configurable:!0}),o.prototype.push=function(){for(var w,o=this,H=[],h=0;h<arguments.length;h++)H[h]=arguments[h];return H.forEach((function(H){w=o.$refId++,o.setAt(w,H)})),w},o.prototype.pop=function(){var w=Array.from(this.$indexes.values()).pop();if(void 0!==w){this.$changes.delete(w),this.$indexes.delete(w);var o=this.$items.get(w);return this.$items.delete(w),o}},o.prototype.at=function(w){var o=Array.from(this.$items.keys())[w];return this.$items.get(o)},o.prototype.setAt=function(o,H){var h,E;if(void 0!==H&&null!==H){if(this.$items.get(o)!==H){void 0!==H.$changes&&H.$changes.setParent(this,this.$changes.root,o);var e=null!==(E=null===(h=this.$changes.indexes[o])||void 0===h?void 0:h.op)&&void 0!==E?E:w.OPERATION.ADD;this.$changes.indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,H),this.$changes.change(o,e)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},o.prototype.deleteAt=function(w){var o=Array.from(this.$items.keys())[w];return void 0!==o&&this.$deleteAt(o)},o.prototype.$deleteAt=function(w){return this.$changes.delete(w),this.$indexes.delete(w),this.$items.delete(w)},o.prototype.clear=function(o){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&A.call(this,o),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},o.prototype.concat=function(){for(var w,H=[],h=0;h<arguments.length;h++)H[h]=arguments[h];return new(o.bind.apply(o,E([void 0],(w=Array.from(this.$items.values())).concat.apply(w,H),!1)))},o.prototype.join=function(w){return Array.from(this.$items.values()).join(w)},o.prototype.reverse=function(){var w=this,o=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(H,h){w.setAt(o[h],H)})),this},o.prototype.shift=function(){var w=Array.from(this.$items.keys()).shift();if(void 0!==w){var o=this.$items.get(w);return this.$deleteAt(w),o}},o.prototype.slice=function(w,H){var h=new o;return h.push.apply(h,Array.from(this.$items.values()).slice(w,H)),h},o.prototype.sort=function(w){var o=this;void 0===w&&(w=z);var H=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(w).forEach((function(w,h){o.setAt(H[h],w)})),this},o.prototype.splice=function(w,o){void 0===o&&(o=this.length-w);for(var H=Array.from(this.$items.keys()),h=[],E=w;E<w+o;E++)h.push(this.$items.get(H[E])),this.$deleteAt(H[E]);return h},o.prototype.unshift=function(){for(var w=this,o=[],H=0;H<arguments.length;H++)o[H]=arguments[H];var h=this.length,E=o.length,e=Array.from(this.$items.values());return o.forEach((function(o,H){w.setAt(H,o)})),e.forEach((function(o,H){w.setAt(E+H,o)})),h+E},o.prototype.indexOf=function(w,o){return Array.from(this.$items.values()).indexOf(w,o)},o.prototype.lastIndexOf=function(w,o){return void 0===o&&(o=this.length-1),Array.from(this.$items.values()).lastIndexOf(w,o)},o.prototype.every=function(w,o){return Array.from(this.$items.values()).every(w,o)},o.prototype.some=function(w,o){return Array.from(this.$items.values()).some(w,o)},o.prototype.forEach=function(w,o){Array.from(this.$items.values()).forEach(w,o)},o.prototype.map=function(w,o){return Array.from(this.$items.values()).map(w,o)},o.prototype.filter=function(w,o){return Array.from(this.$items.values()).filter(w,o)},o.prototype.reduce=function(w,o){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},o.prototype.reduceRight=function(w,o){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},o.prototype.find=function(w,o){return Array.from(this.$items.values()).find(w,o)},o.prototype.findIndex=function(w,o){return Array.from(this.$items.values()).findIndex(w,o)},o.prototype.fill=function(w,o,H){throw new Error("ArraySchema#fill() not implemented")},o.prototype.copyWithin=function(w,o,H){throw new Error("ArraySchema#copyWithin() not implemented")},o.prototype.toString=function(){return this.$items.toString()},o.prototype.toLocaleString=function(){return this.$items.toLocaleString()},o.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(o,Symbol.species,{get:function(){return o},enumerable:!1,configurable:!0}),o.prototype.entries=function(){return this.$items.entries()},o.prototype.keys=function(){return this.$items.keys()},o.prototype.values=function(){return this.$items.values()},o.prototype.includes=function(w,o){return Array.from(this.$items.values()).includes(w,o)},o.prototype.flatMap=function(w,o){throw new Error("ArraySchema#flatMap() is not supported.")},o.prototype.flat=function(w){throw new Error("ArraySchema#flat() is not supported.")},o.prototype.findLast=function(){var w=Array.from(this.$items.values());return w.findLast.apply(w,arguments)},o.prototype.findLastIndex=function(){var w=Array.from(this.$items.values());return w.findLastIndex.apply(w,arguments)},o.prototype.setIndex=function(w,o){this.$indexes.set(w,o)},o.prototype.getIndex=function(w){return this.$indexes.get(w)},o.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},o.prototype.deleteByIndex=function(w){var o=this.$indexes.get(w);this.$items.delete(o),this.$indexes.delete(w)},o.prototype.toArray=function(){return Array.from(this.$items.values())},o.prototype.toJSON=function(){return this.toArray().map((function(w){return"function"===typeof w.toJSON?w.toJSON():w}))},o.prototype.clone=function(w){return w?new(o.bind.apply(o,E([void 0],Array.from(this.$items.values()),!1))):new(o.bind.apply(o,E([void 0],this.map((function(w){return w.$changes?w.clone():w})),!1)))},o}();function M(w){return w.$proxy=!0,w=new Proxy(w,{get:function(w,o){return"symbol"!==typeof o&&"undefined"===typeof w[o]?w.get(o):w[o]},set:function(w,o,H){return"symbol"!==typeof o&&-1===o.indexOf("$")&&"ft"!==o&&"th"!==o&&"onChange"!==o?w.set(o,H):w[o]=H,!0},deleteProperty:function(w,o){return w.delete(o),!0}})}var i=function(){function o(w){var H=this;if(this.$changes=new X(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,w)if(w instanceof Map||w instanceof o)w.forEach((function(w,o){return H.set(o,w)}));else for(var h in w)this.set(h,w[h])}return o.prototype.ft=function(o,H){return void 0===H&&(H=!0),L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,o,H?this.$items:void 0)},o.prototype.th=function(o){return L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,o)},o.prototype.onChange=function(o){return L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,o)},o.is=function(w){return void 0!==w.map},o.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(o.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(o,Symbol.species,{get:function(){return o},enumerable:!1,configurable:!0}),o.prototype.set=function(o,H){if(void 0===H||null===H)throw new Error("MapSchema#set('".concat(o,"', ").concat(H,"): trying to set ").concat(H," value on '").concat(o,"'."));o=o.toString();var h="undefined"!==typeof this.$changes.indexes[o],E=h?this.$changes.indexes[o]:this.$refId++,e=h?w.OPERATION.REPLACE:w.OPERATION.ADD,D=void 0!==H.$changes;if(D&&H.$changes.setParent(this,this.$changes.root,E),h){if(!D&&this.$items.get(o)===H)return;D&&this.$items.get(o)!==H&&(e=w.OPERATION.ADD)}else this.$changes.indexes[o]=E,this.$indexes.set(E,o);return this.$items.set(o,H),this.$changes.change(o,e),this},o.prototype.get=function(w){return this.$items.get(w)},o.prototype.delete=function(w){return this.$changes.delete(w),this.$items.delete(w)},o.prototype.clear=function(o){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&A.call(this,o),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},o.prototype.has=function(w){return this.$items.has(w)},o.prototype.forEach=function(w){this.$items.forEach(w)},o.prototype.entries=function(){return this.$items.entries()},o.prototype.keys=function(){return this.$items.keys()},o.prototype.values=function(){return this.$items.values()},Object.defineProperty(o.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),o.prototype.setIndex=function(w,o){this.$indexes.set(w,o)},o.prototype.getIndex=function(w){return this.$indexes.get(w)},o.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},o.prototype.deleteByIndex=function(w){var o=this.$indexes.get(w);this.$items.delete(o),this.$indexes.delete(w)},o.prototype.toJSON=function(){var w={};return this.forEach((function(o,H){w[H]="function"===typeof o.toJSON?o.toJSON():o})),w},o.prototype.clone=function(w){var H;return w?H=Object.assign(new o,this):(H=new o,this.forEach((function(w,o){w.$changes?H.set(o,w.clone()):H.set(o,w)}))),H},o}(),s={};function V(w,o){s[w]=o}function r(w){return s[w]}var k=function(){function w(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return w.create=function(o){var H=new w;return H.schema=Object.assign({},o&&o.schema||{}),H.indexes=Object.assign({},o&&o.indexes||{}),H.fieldsByIndex=Object.assign({},o&&o.fieldsByIndex||{}),H.descriptors=Object.assign({},o&&o.descriptors||{}),H.deprecated=Object.assign({},o&&o.deprecated||{}),H},w.prototype.addField=function(w,o){var H=this.getNextFieldIndex();this.fieldsByIndex[H]=w,this.indexes[w]=H,this.schema[w]=Array.isArray(o)?{array:o[0]}:o},w.prototype.hasField=function(w){return void 0!==this.indexes[w]},w.prototype.addFilter=function(w,o){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[w]]=o,this.indexesWithFilters.push(this.indexes[w]),!0},w.prototype.addChildrenFilter=function(w,o){var H=this.indexes[w],h=this.schema[w];if(r(Object.keys(h)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[H]=o,!0;console.warn("@filterChildren: field '".concat(w,"' can't have children. Ignoring filter."))},w.prototype.getChildrenFilter=function(w){return this.childFilters&&this.childFilters[this.indexes[w]]},w.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},w}();function P(w){return w._context&&w._context.useFilters}var l=function(){function w(){this.types={},this.schemas=new Map,this.useFilters=!1}return w.prototype.has=function(w){return this.schemas.has(w)},w.prototype.get=function(w){return this.types[w]},w.prototype.add=function(w,o){void 0===o&&(o=this.schemas.size),w._definition=k.create(w._definition),w._typeid=o,this.types[o]=w,this.schemas.set(w,o)},w.create=function(o){return void 0===o&&(o={}),function(H){return o.context||(o.context=new w),T(H,o)}},w}(),O=new l;function T(w,o){return void 0===o&&(o={}),function(H,h){var e=o.context||O,D=H.constructor;if(D._context=e,!w)throw new Error("".concat(D.name,': @type() reference provided for "').concat(h,"\" is undefined. Make sure you don't have any circular dependencies."));e.has(D)||e.add(D);var t=D._definition;if(t.addField(h,w),t.descriptors[h]){if(t.deprecated[h])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(h,"' definition on '").concat(D.name,"'.\nCheck @type() annotation"))}catch(s){var X=s.stack.split("\n")[4].trim();throw new Error("".concat(s.message," ").concat(X))}}var L=Q.is(w),A=!L&&i.is(w);if("string"!==typeof w&&!bw.is(w)){var y=Object.values(w)[0];"string"===typeof y||e.has(y)||e.add(y)}if(o.manual)t.descriptors[h]={enumerable:!0,configurable:!0,writable:!0};else{var z="_".concat(h);t.descriptors[z]={enumerable:!1,configurable:!1,writable:!0},t.descriptors[h]={get:function(){return this[z]},set:function(w){w!==this[z]&&(void 0!==w&&null!==w?(!L||w instanceof Q||(w=new(Q.bind.apply(Q,E([void 0],w,!1)))),!A||w instanceof i||(w=new i(w)),void 0===w.$proxy&&(A?w=M(w):L&&(w=C(w))),this.$changes.change(h),w.$changes&&w.$changes.setParent(this,this.$changes.root,this._definition.indexes[h])):this[z]&&this.$changes.delete(h),this[z]=w)},enumerable:!0,configurable:!0}}}}function S(w){return function(o,H){var h=o.constructor;h._definition.addFilter(H,w)&&(h._context.useFilters=!0)}}function c(w){return function(o,H){var h=o.constructor;h._definition.addChildrenFilter(H,w)&&(h._context.useFilters=!0)}}function W(w){return void 0===w&&(w=!0),function(o,H){var h=o.constructor._definition;h.deprecated[H]=!0,w&&(h.descriptors[H]={get:function(){throw new Error("".concat(H," is deprecated."))},set:function(w){},enumerable:!1,configurable:!0})}}function B(w,o,H){for(var h in void 0===H&&(H={}),H.context||(H.context=w._context||H.context||O),o)T(o[h],H)(w.prototype,h);return w}function J(w){for(var o=0,H=0,h=0,E=w.length;h<E;h++)(o=w.charCodeAt(h))<128?H+=1:o<2048?H+=2:o<55296||o>=57344?H+=3:(h++,H+=4);return H}function g(w,o,H){for(var h=0,E=0,e=H.length;E<e;E++)(h=H.charCodeAt(E))<128?w[o++]=h:h<2048?(w[o++]=192|h>>6,w[o++]=128|63&h):h<55296||h>=57344?(w[o++]=224|h>>12,w[o++]=128|h>>6&63,w[o++]=128|63&h):(E++,h=65536+((1023&h)<<10|1023&H.charCodeAt(E)),w[o++]=240|h>>18,w[o++]=128|h>>12&63,w[o++]=128|h>>6&63,w[o++]=128|63&h)}function b(w,o){w.push(255&o)}function p(w,o){w.push(255&o)}function f(w,o){w.push(255&o),w.push(o>>8&255)}function N(w,o){w.push(255&o),w.push(o>>8&255)}function j(w,o){w.push(255&o),w.push(o>>8&255),w.push(o>>16&255),w.push(o>>24&255)}function q(w,o){var H=o>>24,h=o>>16,E=o>>8,e=o;w.push(255&e),w.push(255&E),w.push(255&h),w.push(255&H)}function u(w,o){var H=Math.floor(o/Math.pow(2,32));q(w,o>>>0),q(w,H)}function n(w,o){var H=o/Math.pow(2,32)|0;q(w,o>>>0),q(w,H)}function G(w,o){U(w,o)}function R(w,o){Z(w,o)}var a=new Int32Array(2),d=new Float32Array(a.buffer),I=new Float64Array(a.buffer);function U(w,o){d[0]=o,j(w,a[0])}function Z(w,o){I[0]=o,j(w,a[0]),j(w,a[1])}function K(w,o){return p(w,o?1:0)}function F(w,o){o||(o="");var H=J(o),h=0;if(H<32)w.push(160|H),h=1;else if(H<256)w.push(217),p(w,H),h=2;else if(H<65536)w.push(218),N(w,H),h=3;else{if(!(H<4294967296))throw new Error("String too long");w.push(219),q(w,H),h=5}return g(w,w.length,o),h+H}function v(w,o){return isNaN(o)?v(w,0):isFinite(o)?o!==(0|o)?(w.push(203),Z(w,o),9):o>=0?o<128?(p(w,o),1):o<256?(w.push(204),p(w,o),2):o<65536?(w.push(205),N(w,o),3):o<4294967296?(w.push(206),q(w,o),5):(w.push(207),n(w,o),9):o>=-32?(w.push(224|o+32),1):o>=-128?(w.push(208),b(w,o),2):o>=-32768?(w.push(209),f(w,o),3):o>=-2147483648?(w.push(210),j(w,o),5):(w.push(211),u(w,o),9):v(w,o>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var mw=Object.freeze({__proto__:null,utf8Write:g,int8:b,uint8:p,int16:f,uint16:N,int32:j,uint32:q,int64:u,uint64:n,float32:G,float64:R,writeFloat32:U,writeFloat64:Z,boolean:K,string:F,number:v});function Y(w,o,H){for(var h="",E=0,e=o,D=o+H;e<D;e++){var t=w[e];0!==(128&t)?192!==(224&t)?224!==(240&t)?240!==(248&t)?console.error("Invalid byte "+t.toString(16)):(E=(7&t)<<18|(63&w[++e])<<12|(63&w[++e])<<6|63&w[++e])>=65536?(E-=65536,h+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):h+=String.fromCharCode(E):h+=String.fromCharCode((15&t)<<12|(63&w[++e])<<6|63&w[++e]):h+=String.fromCharCode((31&t)<<6|63&w[++e]):h+=String.fromCharCode(t)}return h}function x(w,o){return ww(w,o)<<24>>24}function ww(w,o){return w[o.offset++]}function ow(w,o){return Hw(w,o)<<16>>16}function Hw(w,o){return w[o.offset++]|w[o.offset++]<<8}function hw(w,o){return w[o.offset++]|w[o.offset++]<<8|w[o.offset++]<<16|w[o.offset++]<<24}function Ew(w,o){return hw(w,o)>>>0}function ew(w,o){return zw(w,o)}function Dw(w,o){return Cw(w,o)}function tw(w,o){var H=Ew(w,o);return hw(w,o)*Math.pow(2,32)+H}function Xw(w,o){var H=Ew(w,o);return Ew(w,o)*Math.pow(2,32)+H}var Lw=new Int32Array(2),Aw=new Float32Array(Lw.buffer),yw=new Float64Array(Lw.buffer);function zw(w,o){return Lw[0]=hw(w,o),Aw[0]}function Cw(w,o){return Lw[0]=hw(w,o),Lw[1]=hw(w,o),yw[0]}function Qw(w,o){return ww(w,o)>0}function Mw(w,o){var H,h=w[o.offset++];h<192?H=31&h:217===h?H=ww(w,o):218===h?H=Hw(w,o):219===h&&(H=Ew(w,o));var E=Y(w,o.offset,H);return o.offset+=H,E}function iw(w,o){var H=w[o.offset];return H<192&&H>160||217===H||218===H||219===H}function sw(w,o){var H=w[o.offset++];return H<128?H:202===H?zw(w,o):203===H?Cw(w,o):204===H?ww(w,o):205===H?Hw(w,o):206===H?Ew(w,o):207===H?Xw(w,o):208===H?x(w,o):209===H?ow(w,o):210===H?hw(w,o):211===H?tw(w,o):H>223?-1*(255-H+1):void 0}function Vw(w,o){var H=w[o.offset];return H<128||H>=202&&H<=211}function rw(w,o){return w[o.offset]<160}function kw(w,o){return w[o.offset-1]===D&&(w[o.offset]<128||w[o.offset]>=202&&w[o.offset]<=211)}var Pw=Object.freeze({__proto__:null,int8:x,uint8:ww,int16:ow,uint16:Hw,int32:hw,uint32:Ew,float32:ew,float64:Dw,int64:tw,uint64:Xw,readFloat32:zw,readFloat64:Cw,boolean:Qw,string:Mw,stringCheck:iw,number:sw,numberCheck:Vw,arrayCheck:rw,switchStructureCheck:kw}),lw=function(){function o(w){var o=this;this.$changes=new X(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,w&&w.forEach((function(w){return o.add(w)}))}return o.prototype.ft=function(o,H){return void 0===H&&(H=!0),L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,o,H?this.$items:void 0)},o.prototype.th=function(o){return L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,o)},o.prototype.onChange=function(o){return L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,o)},o.is=function(w){return void 0!==w.collection},o.prototype.add=function(w){var o=this.$refId++;return void 0!==w.$changes&&w.$changes.setParent(this,this.$changes.root,o),this.$changes.indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,w),this.$changes.change(o),o},o.prototype.at=function(w){var o=Array.from(this.$items.keys())[w];return this.$items.get(o)},o.prototype.entries=function(){return this.$items.entries()},o.prototype.delete=function(w){for(var o,H,h=this.$items.entries();(H=h.next())&&!H.done;)if(w===H.value[1]){o=H.value[0];break}return void 0!==o&&(this.$changes.delete(o),this.$indexes.delete(o),this.$items.delete(o))},o.prototype.clear=function(o){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&A.call(this,o),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},o.prototype.has=function(w){return Array.from(this.$items.values()).some((function(o){return o===w}))},o.prototype.forEach=function(w){var o=this;this.$items.forEach((function(H,h,E){return w(H,h,o)}))},o.prototype.values=function(){return this.$items.values()},Object.defineProperty(o.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),o.prototype.setIndex=function(w,o){this.$indexes.set(w,o)},o.prototype.getIndex=function(w){return this.$indexes.get(w)},o.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},o.prototype.deleteByIndex=function(w){var o=this.$indexes.get(w);this.$items.delete(o),this.$indexes.delete(w)},o.prototype.toArray=function(){return Array.from(this.$items.values())},o.prototype.toJSON=function(){var w=[];return this.forEach((function(o,H){w.push("function"===typeof o.toJSON?o.toJSON():o)})),w},o.prototype.clone=function(w){var H;return w?H=Object.assign(new o,this):(H=new o,this.forEach((function(w){w.$changes?H.add(w.clone()):H.add(w)}))),H},o}(),Ow=function(){function o(w){var o=this;this.$changes=new X(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,w&&w.forEach((function(w){return o.add(w)}))}return o.prototype.ft=function(o,H){return void 0===H&&(H=!0),L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.ADD,o,H?this.$items:void 0)},o.prototype.th=function(o){return L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,o)},o.prototype.onChange=function(o){return L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,o)},o.is=function(w){return void 0!==w.set},o.prototype.add=function(o){var H,h;if(this.has(o))return!1;var E=this.$refId++;void 0!==o.$changes&&o.$changes.setParent(this,this.$changes.root,E);var e=null!==(h=null===(H=this.$changes.indexes[E])||void 0===H?void 0:H.op)&&void 0!==h?h:w.OPERATION.ADD;return this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,o),this.$changes.change(E,e),E},o.prototype.entries=function(){return this.$items.entries()},o.prototype.delete=function(w){for(var o,H,h=this.$items.entries();(H=h.next())&&!H.done;)if(w===H.value[1]){o=H.value[0];break}return void 0!==o&&(this.$changes.delete(o),this.$indexes.delete(o),this.$items.delete(o))},o.prototype.clear=function(o){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&A.call(this,o),this.$items.clear(),this.$changes.operation({index:0,op:w.OPERATION.CLEAR}),this.$changes.touchParents()},o.prototype.has=function(w){for(var o,H=this.$items.values(),h=!1;(o=H.next())&&!o.done;)if(w===o.value){h=!0;break}return h},o.prototype.forEach=function(w){var o=this;this.$items.forEach((function(H,h,E){return w(H,h,o)}))},o.prototype.values=function(){return this.$items.values()},Object.defineProperty(o.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),o.prototype.setIndex=function(w,o){this.$indexes.set(w,o)},o.prototype.getIndex=function(w){return this.$indexes.get(w)},o.prototype.getByIndex=function(w){return this.$items.get(this.$indexes.get(w))},o.prototype.deleteByIndex=function(w){var o=this.$indexes.get(w);this.$items.delete(o),this.$indexes.delete(w)},o.prototype.toArray=function(){return Array.from(this.$items.values())},o.prototype.toJSON=function(){var w=[];return this.forEach((function(o,H){w.push("function"===typeof o.toJSON?o.toJSON():o)})),w},o.prototype.clone=function(w){var H;return w?H=Object.assign(new o,this):(H=new o,this.forEach((function(w){w.$changes?H.add(w.clone()):H.add(w)}))),H},o}(),Tw=function(){function w(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return w.prototype.addRefId=function(w){this.refIds.has(w)||(this.refIds.add(w),this.containerIndexes.set(w,new Set))},w.get=function(o){return void 0===o.$filterState&&(o.$filterState=new w),o.$filterState},w}(),Sw=function(){function w(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return w.prototype.getNextUniqueId=function(){return this.nextUniqueId++},w.prototype.addRef=function(w,o,H){void 0===H&&(H=!0),this.refs.set(w,o),H&&(this.refCounts[w]=(this.refCounts[w]||0)+1)},w.prototype.removeRef=function(w){this.refCounts[w]=this.refCounts[w]-1,this.deletedRefs.add(w)},w.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},w.prototype.garbageCollectDeletedRefs=function(){var w=this;this.deletedRefs.forEach((function(o){if(!(w.refCounts[o]>0)){var H=w.refs.get(o);if(H instanceof bw)for(var h in H._definition.schema)"string"!==typeof H._definition.schema[h]&&H[h]&&H[h].$changes&&w.removeRef(H[h].$changes.refId);else{var E=H.$changes.parent._definition,e=E.schema[E.fieldsByIndex[H.$changes.parentIndex]];"function"===typeof Object.values(e)[0]&&Array.from(H.values()).forEach((function(o){return w.removeRef(o.$changes.refId)}))}w.refs.delete(o),delete w.refCounts[o]}})),this.deletedRefs.clear()},w}(),cw=function(w){function o(){return null!==w&&w.apply(this,arguments)||this}return H(o,w),o}(Error);function Ww(w,o,H,h){var E,e=!1;switch(o){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":E="number",isNaN(w)&&console.log('trying to encode "NaN" in '.concat(H.constructor.name,"#").concat(h));break;case"string":E="string",e=!0;break;case"boolean":return}if(typeof w!==E&&(!e||e&&null!==w)){var D="'".concat(JSON.stringify(w),"'").concat(w&&w.constructor&&" (".concat(w.constructor.name,")")||"");throw new cw("a '".concat(E,"' was expected, but ").concat(D," was provided in ").concat(H.constructor.name,"#").concat(h))}}function Bw(w,o,H,h){if(!(w instanceof o))throw new cw("a '".concat(o.name,"' was expected, but '").concat(w.constructor.name,"' was provided in ").concat(H.constructor.name,"#").concat(h))}function Jw(w,o,H,h,E){Ww(H,w,h,E);var e=mw[w];if(!e)throw new cw("a '".concat(w,"' was expected, but ").concat(H," was provided in ").concat(h.constructor.name,"#").concat(E));e(o,H)}function gw(w,o,H){return Pw[w](o,H)}var bw=function(){function o(){for(var w=[],o=0;o<arguments.length;o++)w[o]=arguments[o];Object.defineProperties(this,{$changes:{value:new X(this,void 0,new Sw),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var H=this._definition.descriptors;H&&Object.defineProperties(this,H),w[0]&&this.assign(w[0])}return o.onError=function(w){console.error(w)},o.is=function(w){return w._definition&&void 0!==w._definition.schema},o.prototype.onChange=function(o){return L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.REPLACE,o)},o.prototype.th=function(o){return L(this.$callbacks||(this.$callbacks=[]),w.OPERATION.DELETE,o)},o.prototype.assign=function(w){return Object.assign(this,w),this},Object.defineProperty(o.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),o.prototype.setDirty=function(w,o){this.$changes.change(w,o)},o.prototype.listen=function(w,o,H){var h=this;return void 0===H&&(H=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[w]||(this.$callbacks[w]=[]),this.$callbacks[w].push(o),H&&void 0!==this[w]&&o(this[w],void 0),function(){return y(h.$callbacks[w],h.$callbacks[w].indexOf(o))}},o.prototype.decode=function(H,h,E){var e;void 0===h&&(h={offset:0}),void 0===E&&(E=this);var t=[],X=this.$changes.root,L=H.length,A=0;for(X.refs.set(A,this);h.offset<L;){var y=H[h.offset++];if(y!=D){var z=E.$changes,C=void 0!==E._definition,M=C?y>>6<<6:y;if(M!==w.OPERATION.CLEAR){var s=C?y%(M||255):sw(H,h),V=C?E._definition.fieldsByIndex[s]:"",k=z.getType(s),P=void 0,l=void 0,O=void 0;if(C?l=E["_".concat(V)]:(l=E.getByIndex(s),(M&w.OPERATION.ADD)===w.OPERATION.ADD?(O=E instanceof i?Mw(H,h):s,E.setIndex(s,O)):O=E.getIndex(s)),(M&w.OPERATION.DELETE)===w.OPERATION.DELETE&&(M!==w.OPERATION.DELETE_AND_ADD&&E.deleteByIndex(s),l&&l.$changes&&X.removeRef(l.$changes.refId),P=null),void 0!==V){if(M===w.OPERATION.DELETE);else if(o.is(k)){var T=sw(H,h);if(P=X.refs.get(T),M!==w.OPERATION.REPLACE){var S=this.getSchemaType(H,h,k);P||((P=this.createTypeInstance(S)).$changes.refId=T,l&&(P.$callbacks=l.$callbacks,l.$changes.refId&&T!==l.$changes.refId&&X.removeRef(l.$changes.refId))),X.addRef(T,P,P!==l)}}else if("string"===typeof k)P=gw(k,H,h);else{var c=r(Object.keys(k)[0]),W=sw(H,h),B=X.refs.has(W)?l||X.refs.get(W):new c.constructor;if((P=B.clone(!0)).$changes.refId=W,l&&(P.$callbacks=l.$callbacks,l.$changes.refId&&W!==l.$changes.refId)){X.removeRef(l.$changes.refId);for(var J=l.entries(),g=void 0;(g=J.next())&&!g.done;){var b=(e=g.value)[0],p=e[1];t.push({refId:W,op:w.OPERATION.DELETE,field:b,value:void 0,previousValue:p})}}X.addRef(W,P,B!==l)}if(null!==P&&void 0!==P)if(P.$changes&&P.$changes.setParent(z.ref,z.root,s),E instanceof o)E[V]=P;else if(E instanceof i)b=O,E.$items.set(b,P),E.$changes.allChanges.add(s);else if(E instanceof Q)E.setAt(s,P);else if(E instanceof lw){var f=E.add(P);E.setIndex(s,f)}else E instanceof Ow&&!1!==(f=E.add(P))&&E.setIndex(s,f);l!==P&&t.push({refId:A,op:M,field:V,dynamicIndex:O,value:P,previousValue:l})}else{console.warn("@colyseus/schema: definition mismatch");for(var N={offset:h.offset};h.offset<L&&(!kw(H,h)||(N.offset=h.offset+1,!X.refs.has(sw(H,N))));)h.offset++}}else E.clear(t)}else{A=sw(H,h);var j=X.refs.get(A);if(!j)throw new Error('"refId" not found: '.concat(A));E=j}}return this._triggerChanges(t),X.garbageCollectDeletedRefs(),t},o.prototype.encode=function(H,h,E){void 0===H&&(H=!1),void 0===h&&(h=[]),void 0===E&&(E=!1);for(var e=this.$changes,t=new WeakSet,X=[e],L=1,A=0;A<L;A++){var y=X[A],z=y.ref,C=z instanceof o;y.ensureRefId(),t.add(y),y!==e&&(y.changed||H)&&(p(h,D),v(h,y.refId));for(var Q=H?Array.from(y.allChanges):Array.from(y.changes.values()),M=0,s=Q.length;M<s;M++){var V=H?{op:w.OPERATION.ADD,index:Q[M]}:Q[M],k=V.index,P=C?z._definition.fieldsByIndex&&z._definition.fieldsByIndex[k]:k,l=h.length;if(V.op!==w.OPERATION.TOUCH)if(C)p(h,k|V.op);else{if(p(h,V.op),V.op===w.OPERATION.CLEAR)continue;v(h,k)}if(C||(V.op&w.OPERATION.ADD)!=w.OPERATION.ADD||z instanceof i&&F(h,y.ref.$indexes.get(k)),V.op!==w.OPERATION.DELETE){var O=y.getType(k),T=y.getValue(k);if(T&&T.$changes&&!t.has(T.$changes)&&(X.push(T.$changes),T.$changes.ensureRefId(),L++),V.op!==w.OPERATION.TOUCH){if(o.is(O))Bw(T,O,z,P),v(h,T.$changes.refId),(V.op&w.OPERATION.ADD)===w.OPERATION.ADD&&this.tryEncodeTypeId(h,O,T.constructor);else if("string"===typeof O)Jw(O,h,T,z,P);else{var S=r(Object.keys(O)[0]);Bw(z["_".concat(P)],S.constructor,z,P),v(h,T.$changes.refId)}E&&y.cache(k,h.slice(l))}}}H||E||y.discard()}return h},o.prototype.encodeAll=function(w){return this.encode(!0,[],w)},o.prototype.applyFilters=function(H,h){var E,e;void 0===h&&(h=!1);for(var t=this,X=new Set,L=Tw.get(H),A=[this.$changes],y=1,z=[],C=function(C){var Q=A[C];if(X.has(Q.refId))return"continue";var M=Q.ref,s=M instanceof o;p(z,D),v(z,Q.refId);var V=L.refIds.has(Q),r=h||!V;L.addRefId(Q);var k=L.containerIndexes.get(Q),P=r?Array.from(Q.allChanges):Array.from(Q.changes.values());!h&&s&&M._definition.indexesWithFilters&&M._definition.indexesWithFilters.forEach((function(o){!k.has(o)&&Q.allChanges.has(o)&&(r?P.push(o):P.push({op:w.OPERATION.ADD,index:o}))}));for(var l=0,O=P.length;l<O;l++){var T=r?{op:w.OPERATION.ADD,index:P[l]}:P[l];if(T.op!==w.OPERATION.CLEAR){var S=T.index;if(T.op!==w.OPERATION.DELETE){var c=Q.getValue(S),W=Q.getType(S);if(s){if((B=M._definition.filters&&M._definition.filters[S])&&!B.call(M,H,c,t)){c&&c.$changes&&X.add(c.$changes.refId);continue}}else{var B,J=Q.parent;if((B=Q.getChildrenFilter())&&!B.call(J,H,M.$indexes.get(S),c,t)){c&&c.$changes&&X.add(c.$changes.refId);continue}}if(c.$changes&&(A.push(c.$changes),y++),T.op!==w.OPERATION.TOUCH)if(T.op===w.OPERATION.ADD||s)z.push.apply(z,null!==(E=Q.caches[S])&&void 0!==E?E:[]),k.add(S);else if(k.has(S))z.push.apply(z,null!==(e=Q.caches[S])&&void 0!==e?e:[]);else{if(k.add(S),p(z,w.OPERATION.ADD),v(z,S),M instanceof i){var g=Q.ref.$indexes.get(S);F(z,g)}c.$changes?v(z,c.$changes.refId):mw[W](z,c)}else c.$changes&&!s&&(p(z,w.OPERATION.ADD),v(z,S),M instanceof i&&(g=Q.ref.$indexes.get(S),F(z,g)),v(z,c.$changes.refId))}else s?p(z,T.op|S):(p(z,T.op),v(z,S))}else p(z,T.op)}},Q=0;Q<y;Q++)C(Q);return z},o.prototype.clone=function(){var w,o=new this.constructor,H=this._definition.schema;for(var h in H)"object"===typeof this[h]&&"function"===typeof(null===(w=this[h])||void 0===w?void 0:w.clone)?o[h]=this[h].clone():o[h]=this[h];return o},o.prototype.toJSON=function(){var w=this._definition.schema,o=this._definition.deprecated,H={};for(var h in w)o[h]||null===this[h]||"undefined"===typeof this[h]||(H[h]="function"===typeof this[h].toJSON?this[h].toJSON():this["_".concat(h)]);return H},o.prototype.discardAllChanges=function(){this.$changes.discardAll()},o.prototype.getByIndex=function(w){return this[this._definition.fieldsByIndex[w]]},o.prototype.deleteByIndex=function(w){this[this._definition.fieldsByIndex[w]]=void 0},o.prototype.tryEncodeTypeId=function(w,o,H){o._typeid!==H._typeid&&(p(w,t),v(w,H._typeid))},o.prototype.getSchemaType=function(w,o,H){var h;return w[o.offset]===t&&(o.offset++,h=this.constructor._context.get(sw(w,o))),h||H},o.prototype.createTypeInstance=function(w){var o=new w;return o.$changes.root=this.$changes.root,o},o.prototype._triggerChanges=function(H){for(var h,E,e,D,t,X,L,A,y,z=new Set,C=this.$changes.root.refs,Q=function(Q){var M=H[Q],i=M.refId,s=C.get(i),V=s.$callbacks;if((M.op&w.OPERATION.DELETE)===w.OPERATION.DELETE&&M.previousValue instanceof o&&(null===(E=null===(h=M.previousValue.$callbacks)||void 0===h?void 0:h[w.OPERATION.DELETE])||void 0===E||E.forEach((function(w){return w()}))),!V)return"continue";if(s instanceof o){if(!z.has(i))try{null===(e=null===V||void 0===V?void 0:V[w.OPERATION.REPLACE])||void 0===e||e.forEach((function(w){return w()}))}catch(r){o.onError(r)}try{V.hasOwnProperty(M.field)&&(null===(D=V[M.field])||void 0===D||D.forEach((function(w){return w(M.value,M.previousValue)})))}catch(r){o.onError(r)}}else M.op===w.OPERATION.ADD&&void 0===M.previousValue?null===(t=V[w.OPERATION.ADD])||void 0===t||t.forEach((function(w){var o;return w(M.value,null!==(o=M.dynamicIndex)&&void 0!==o?o:M.field)})):M.op===w.OPERATION.DELETE?void 0!==M.previousValue&&(null===(X=V[w.OPERATION.DELETE])||void 0===X||X.forEach((function(w){var o;return w(M.previousValue,null!==(o=M.dynamicIndex)&&void 0!==o?o:M.field)}))):M.op===w.OPERATION.DELETE_AND_ADD&&(void 0!==M.previousValue&&(null===(L=V[w.OPERATION.DELETE])||void 0===L||L.forEach((function(w){var o;return w(M.previousValue,null!==(o=M.dynamicIndex)&&void 0!==o?o:M.field)}))),null===(A=V[w.OPERATION.ADD])||void 0===A||A.forEach((function(w){var o;return w(M.value,null!==(o=M.dynamicIndex)&&void 0!==o?o:M.field)}))),M.value!==M.previousValue&&(null===(y=V[w.OPERATION.REPLACE])||void 0===y||y.forEach((function(w){var o;return w(M.value,null!==(o=M.dynamicIndex)&&void 0!==o?o:M.field)})));z.add(i)},M=0;M<H.length;M++)Q(M)},o._definition=k.create(),o}();function pw(w){for(var o=[w.$changes],H=1,h={},E=h,e=function(w){var H=o[w];H.changes.forEach((function(w){var o=H.ref,h=w.index,e=o._definition?o._definition.fieldsByIndex[h]:o.$indexes.get(h);E[e]=H.getValue(h)}))},D=0;D<H;D++)e(D);return h}var fw={context:new l},Nw=function(w){function o(){return null!==w&&w.apply(this,arguments)||this}return H(o,w),h([T("string",fw)],o.prototype,"name",void 0),h([T("string",fw)],o.prototype,"type",void 0),h([T("number",fw)],o.prototype,"referencedType",void 0),o}(bw),jw=function(w){function o(){var o=null!==w&&w.apply(this,arguments)||this;return o.fields=new Q,o}return H(o,w),h([T("number",fw)],o.prototype,"id",void 0),h([T([Nw],fw)],o.prototype,"fields",void 0),o}(bw),qw=function(w){function o(){var o=null!==w&&w.apply(this,arguments)||this;return o.types=new Q,o}return H(o,w),o.encode=function(w){var H=w.constructor,h=new o;h.rootType=H._typeid;var E=function(w,o){for(var H in o){var E=new Nw;E.name=H;var e=void 0;if("string"===typeof o[H])e=o[H];else{var D=o[H],t=void 0;bw.is(D)?(e="ref",t=o[H]):"string"===typeof D[e=Object.keys(D)[0]]?e+=":"+D[e]:t=D[e],E.referencedType=t?t._typeid:-1}E.type=e,w.fields.push(E)}h.types.push(w)},e=H._context.types;for(var D in e){var t=new jw;t.id=Number(D),E(t,e[D]._definition.schema)}return h.encodeAll()},o.decode=function(w,h){var E=new l,e=new o;e.decode(w,h);var D=e.types.reduce((function(w,o){var h=function(w){function o(){return null!==w&&w.apply(this,arguments)||this}return H(o,w),o}(bw),e=o.id;return w[e]=h,E.add(h,e),w}),{});e.types.forEach((function(w){var o=D[w.id];w.fields.forEach((function(w){var H;if(void 0!==w.referencedType){var h=w.type,e=D[w.referencedType];if(!e){var t=w.type.split(":");h=t[0],e=t[1]}"ref"===h?T(e,{context:E})(o.prototype,w.name):T(((H={})[h]=e,H),{context:E})(o.prototype,w.name)}else T(w.type,{context:E})(o.prototype,w.name)}))}));var t=D[e.rootType],X=new t;for(var L in t._definition.schema){var A=t._definition.schema[L];"string"!==typeof A&&(X[L]="function"===typeof A?new A:new(r(Object.keys(A)[0]).constructor))}return X},h([T([jw],fw)],o.prototype,"types",void 0),h([T("number",fw)],o.prototype,"rootType",void 0),o}(bw);V("map",{constructor:i}),V("array",{constructor:Q}),V("set",{constructor:Ow}),V("collection",{constructor:lw}),w.ArraySchema=Q,w.CollectionSchema=lw,w.Context=l,w.MapSchema=i,w.Reflection=qw,w.ReflectionField=Nw,w.ReflectionType=jw,w.Schema=bw,w.SchemaDefinition=k,w.SetSchema=Ow,w.decode=Pw,w.defineTypes=B,w.deprecated=W,w.dumpChanges=pw,w.encode=mw,w.filter=S,w.filterChildren=c,w.hasFilter=P,w.registerType=V,w.type=T,Object.defineProperty(w,"__esModule",{value:!0})}(o)},13901:w=>{"use strict";w.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13897:(w,o,H)=>{var h=H(13901),E=H(13904),e=Object.hasOwnProperty,D=Object.create(null);for(var t in h)e.call(h,t)&&(D[h[t]]=t);var X=w.exports={to:{},get:{}};function L(w,o,H){return Math.min(Math.max(o,w),H)}function A(w){var o=Math.round(w).toString(16).toUpperCase();return o.length<2?"0"+o:o}X.get=function(w){var o,H;switch(w.substring(0,3).toLowerCase()){case"hsl":o=X.get.hsl(w),H="hsl";break;case"hwb":o=X.get.hwb(w),H="hwb";break;default:o=X.get.rgb(w),H="rgb"}return o?{model:H,value:o}:null},X.get.rgb=function(w){if(!w)return null;var o,H,E,D=[0,0,0,1];if(o=w.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(E=o[2],o=o[1],H=0;H<3;H++){var t=2*H;D[H]=parseInt(o.slice(t,t+2),16)}E&&(D[3]=parseInt(E,16)/255)}else if(o=w.match(/^#([a-f0-9]{3,4})$/i)){for(E=(o=o[1])[3],H=0;H<3;H++)D[H]=parseInt(o[H]+o[H],16);E&&(D[3]=parseInt(E+E,16)/255)}else if(o=w.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(H=0;H<3;H++)D[H]=parseInt(o[H+1],0);o[4]&&(o[5]?D[3]=.01*parseFloat(o[4]):D[3]=parseFloat(o[4]))}else{if(!(o=w.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(o=w.match(/^(\w+)$/))?"transparent"===o[1]?[0,0,0,0]:e.call(h,o[1])?((D=h[o[1]])[3]=1,D):null:null;for(H=0;H<3;H++)D[H]=Math.round(2.55*parseFloat(o[H+1]));o[4]&&(o[5]?D[3]=.01*parseFloat(o[4]):D[3]=parseFloat(o[4]))}for(H=0;H<3;H++)D[H]=L(D[H],0,255);return D[3]=L(D[3],0,1),D},X.get.hsl=function(w){if(!w)return null;var o=w.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(o){var H=parseFloat(o[4]);return[(parseFloat(o[1])%360+360)%360,L(parseFloat(o[2]),0,100),L(parseFloat(o[3]),0,100),L(isNaN(H)?1:H,0,1)]}return null},X.get.hwb=function(w){if(!w)return null;var o=w.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(o){var H=parseFloat(o[4]);return[(parseFloat(o[1])%360+360)%360,L(parseFloat(o[2]),0,100),L(parseFloat(o[3]),0,100),L(isNaN(H)?1:H,0,1)]}return null},X.to.hex=function(){var w=E(arguments);return"#"+A(w[0])+A(w[1])+A(w[2])+(w[3]<1?A(Math.round(255*w[3])):"")},X.to.rgb=function(){var w=E(arguments);return w.length<4||1===w[3]?"rgb("+Math.round(w[0])+", "+Math.round(w[1])+", "+Math.round(w[2])+")":"rgba("+Math.round(w[0])+", "+Math.round(w[1])+", "+Math.round(w[2])+", "+w[3]+")"},X.to.rgb.percent=function(){var w=E(arguments),o=Math.round(w[0]/255*100),H=Math.round(w[1]/255*100),h=Math.round(w[2]/255*100);return w.length<4||1===w[3]?"rgb("+o+"%, "+H+"%, "+h+"%)":"rgba("+o+"%, "+H+"%, "+h+"%, "+w[3]+")"},X.to.hsl=function(){var w=E(arguments);return w.length<4||1===w[3]?"hsl("+w[0]+", "+w[1]+"%, "+w[2]+"%)":"hsla("+w[0]+", "+w[1]+"%, "+w[2]+"%, "+w[3]+")"},X.to.hwb=function(){var w=E(arguments),o="";return w.length>=4&&1!==w[3]&&(o=", "+w[3]),"hwb("+w[0]+", "+w[1]+"%, "+w[2]+"%"+o+")"},X.to.keyword=function(w){return D[w.slice(0,3)]}},13894:(w,o,H)=>{const h=H(13897),E=H(13916),e=["keyword","gray","hex"],D={};for(const C of Object.keys(E))D[[...E[C].labels].sort().join("")]=C;const t={};function X(w,o){if(!(this instanceof X))return new X(w,o);if(o&&o in e&&(o=null),o&&!(o in E))throw new Error("Unknown model: "+o);let H,L;if(null==w)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(w instanceof X)this.model=w.model,this.color=[...w.color],this.valpha=w.valpha;else if("string"===typeof w){const o=h.get(w);if(null===o)throw new Error("Unable to parse color from string: "+w);this.model=o.model,L=E[this.model].channels,this.color=o.value.slice(0,L),this.valpha="number"===typeof o.value[L]?o.value[L]:1}else if(w.length>0){this.model=o||"rgb",L=E[this.model].channels;const H=Array.prototype.slice.call(w,0,L);this.color=z(H,L),this.valpha="number"===typeof w[L]?w[L]:1}else if("number"===typeof w)this.model="rgb",this.color=[w>>16&255,w>>8&255,255&w],this.valpha=1;else{this.valpha=1;const o=Object.keys(w);"alpha"in w&&(o.splice(o.indexOf("alpha"),1),this.valpha="number"===typeof w.alpha?w.alpha:0);const h=o.sort().join("");if(!(h in D))throw new Error("Unable to parse color from object: "+JSON.stringify(w));this.model=D[h];const{labels:e}=E[this.model],t=[];for(H=0;H<e.length;H++)t.push(w[e[H]]);this.color=z(t)}if(t[this.model])for(L=E[this.model].channels,H=0;H<L;H++){const w=t[this.model][H];w&&(this.color[H]=w(this.color[H]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}X.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(w){let o=this.model in h.to?this:this.rgb();o=o.round("number"===typeof w?w:1);const H=1===o.valpha?o.color:[...o.color,this.valpha];return h.to[o.model](H)},percentString(w){const o=this.rgb().round("number"===typeof w?w:1),H=1===o.valpha?o.color:[...o.color,this.valpha];return h.to.rgb.percent(H)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const w={},{channels:o}=E[this.model],{labels:H}=E[this.model];for(let h=0;h<o;h++)w[H[h]]=this.color[h];return 1!==this.valpha&&(w.alpha=this.valpha),w},unitArray(){const w=this.rgb().color;return w[0]/=255,w[1]/=255,w[2]/=255,1!==this.valpha&&w.push(this.valpha),w},unitObject(){const w=this.rgb().object();return w.r/=255,w.g/=255,w.b/=255,1!==this.valpha&&(w.alpha=this.valpha),w},round(w){return w=Math.max(w||0,0),new X([...this.color.map(L(w)),this.valpha],this.model)},alpha(w){return void 0!==w?new X([...this.color,Math.max(0,Math.min(1,w))],this.model):this.valpha},red:A("rgb",0,y(255)),green:A("rgb",1,y(255)),blue:A("rgb",2,y(255)),hue:A(["hsl","hsv","hsl","hwb","hcg"],0,(w=>(w%360+360)%360)),saturationl:A("hsl",1,y(100)),lightness:A("hsl",2,y(100)),saturationv:A("hsv",1,y(100)),value:A("hsv",2,y(100)),chroma:A("hcg",1,y(100)),gray:A("hcg",2,y(100)),white:A("hwb",1,y(100)),wblack:A("hwb",2,y(100)),cyan:A("cmyk",0,y(100)),magenta:A("cmyk",1,y(100)),yellow:A("cmyk",2,y(100)),black:A("cmyk",3,y(100)),x:A("xyz",0,y(95.047)),y:A("xyz",1,y(100)),z:A("xyz",2,y(108.833)),l:A("lab",0,y(100)),a:A("lab",1),b:A("lab",2),keyword(w){return void 0!==w?new X(w):E[this.model].keyword(this.color)},hex(w){return void 0!==w?new X(w):h.to.hex(this.rgb().round().color)},hexa(w){if(void 0!==w)return new X(w);const o=this.rgb().round().color;let H=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===H.length&&(H="0"+H),h.to.hex(o)+H},rgbNumber(){const w=this.rgb().color;return(255&w[0])<<16|(255&w[1])<<8|255&w[2]},luminosity(){const w=this.rgb().color,o=[];for(const[H,h]of w.entries()){const w=h/255;o[H]=w<=.04045?w/12.92:((w+.055)/1.055)**2.4}return.2126*o[0]+.7152*o[1]+.0722*o[2]},contrast(w){const o=this.luminosity(),H=w.luminosity();return o>H?(o+.05)/(H+.05):(H+.05)/(o+.05)},level(w){const o=this.contrast(w);return o>=7?"AAA":o>=4.5?"AA":""},isDark(){const w=this.rgb().color;return(2126*w[0]+7152*w[1]+722*w[2])/1e4<128},isLight(){return!this.isDark()},negate(){const w=this.rgb();for(let o=0;o<3;o++)w.color[o]=255-w.color[o];return w},lighten(w){const o=this.hsl();return o.color[2]+=o.color[2]*w,o},darken(w){const o=this.hsl();return o.color[2]-=o.color[2]*w,o},saturate(w){const o=this.hsl();return o.color[1]+=o.color[1]*w,o},desaturate(w){const o=this.hsl();return o.color[1]-=o.color[1]*w,o},whiten(w){const o=this.hwb();return o.color[1]+=o.color[1]*w,o},blacken(w){const o=this.hwb();return o.color[2]+=o.color[2]*w,o},grayscale(){const w=this.rgb().color,o=.3*w[0]+.59*w[1]+.11*w[2];return X.rgb(o,o,o)},fade(w){return this.alpha(this.valpha-this.valpha*w)},opaquer(w){return this.alpha(this.valpha+this.valpha*w)},rotate(w){const o=this.hsl();let H=o.color[0];return H=(H+w)%360,H=H<0?360+H:H,o.color[0]=H,o},mix(w,o){if(!w||!w.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof w);const H=w.rgb(),h=this.rgb(),E=void 0===o?.5:o,e=2*E-1,D=H.alpha()-h.alpha(),t=((e*D===-1?e:(e+D)/(1+e*D))+1)/2,L=1-t;return X.rgb(t*H.red()+L*h.red(),t*H.green()+L*h.green(),t*H.blue()+L*h.blue(),H.alpha()*E+h.alpha()*(1-E))}};for(const C of Object.keys(E)){if(e.includes(C))continue;const{channels:w}=E[C];X.prototype[C]=function(){if(this.model===C)return new X(this);for(var w=arguments.length,o=new Array(w),H=0;H<w;H++)o[H]=arguments[H];return o.length>0?new X(o,C):new X([...(h=E[this.model][C].raw(this.color),Array.isArray(h)?h:[h]),this.valpha],C);var h},X[C]=function(){for(var o=arguments.length,H=new Array(o),h=0;h<o;h++)H[h]=arguments[h];let E=H[0];return"number"===typeof E&&(E=z(H,w)),new X(E,C)}}function L(w){return function(o){return function(w,o){return Number(w.toFixed(o))}(o,w)}}function A(w,o,H){w=Array.isArray(w)?w:[w];for(const h of w)(t[h]||(t[h]=[]))[o]=H;return w=w[0],function(h){let E;return void 0!==h?(H&&(h=H(h)),E=this[w](),E.color[o]=h,E):(E=this[w]().color[o],H&&(E=H(E)),E)}}function y(w){return function(o){return Math.max(0,Math.min(w,o))}}function z(w,o){for(let H=0;H<o;H++)"number"!==typeof w[H]&&(w[H]=0);return w}w.exports=X},13925:(w,o,H)=>{const h=H(13930),E={};for(const D of Object.keys(h))E[h[D]]=D;const e={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};w.exports=e;for(const D of Object.keys(e)){if(!("channels"in e[D]))throw new Error("missing channels property: "+D);if(!("labels"in e[D]))throw new Error("missing channel labels property: "+D);if(e[D].labels.length!==e[D].channels)throw new Error("channel and label counts mismatch: "+D);const{channels:w,labels:o}=e[D];delete e[D].channels,delete e[D].labels,Object.defineProperty(e[D],"channels",{value:w}),Object.defineProperty(e[D],"labels",{value:o})}e.rgb.hsl=function(w){const o=w[0]/255,H=w[1]/255,h=w[2]/255,E=Math.min(o,H,h),e=Math.max(o,H,h),D=e-E;let t,X;e===E?t=0:o===e?t=(H-h)/D:H===e?t=2+(h-o)/D:h===e&&(t=4+(o-H)/D),t=Math.min(60*t,360),t<0&&(t+=360);const L=(E+e)/2;return X=e===E?0:L<=.5?D/(e+E):D/(2-e-E),[t,100*X,100*L]},e.rgb.hsv=function(w){let o,H,h,E,e;const D=w[0]/255,t=w[1]/255,X=w[2]/255,L=Math.max(D,t,X),A=L-Math.min(D,t,X),y=function(w){return(L-w)/6/A+.5};return 0===A?(E=0,e=0):(e=A/L,o=y(D),H=y(t),h=y(X),D===L?E=h-H:t===L?E=1/3+o-h:X===L&&(E=2/3+H-o),E<0?E+=1:E>1&&(E-=1)),[360*E,100*e,100*L]},e.rgb.hwb=function(w){const o=w[0],H=w[1];let h=w[2];const E=e.rgb.hsl(w)[0],D=1/255*Math.min(o,Math.min(H,h));return h=1-1/255*Math.max(o,Math.max(H,h)),[E,100*D,100*h]},e.rgb.cmyk=function(w){const o=w[0]/255,H=w[1]/255,h=w[2]/255,E=Math.min(1-o,1-H,1-h);return[100*((1-o-E)/(1-E)||0),100*((1-H-E)/(1-E)||0),100*((1-h-E)/(1-E)||0),100*E]},e.rgb.keyword=function(w){const o=E[w];if(o)return o;let H,e=1/0;for(const E of Object.keys(h)){const o=h[E],X=(t=o,((D=w)[0]-t[0])**2+(D[1]-t[1])**2+(D[2]-t[2])**2);X<e&&(e=X,H=E)}var D,t;return H},e.keyword.rgb=function(w){return h[w]},e.rgb.xyz=function(w){let o=w[0]/255,H=w[1]/255,h=w[2]/255;o=o>.04045?((o+.055)/1.055)**2.4:o/12.92,H=H>.04045?((H+.055)/1.055)**2.4:H/12.92,h=h>.04045?((h+.055)/1.055)**2.4:h/12.92;return[100*(.4124*o+.3576*H+.1805*h),100*(.2126*o+.7152*H+.0722*h),100*(.0193*o+.1192*H+.9505*h)]},e.rgb.lab=function(w){const o=e.rgb.xyz(w);let H=o[0],h=o[1],E=o[2];H/=95.047,h/=100,E/=108.883,H=H>.008856?H**(1/3):7.787*H+16/116,h=h>.008856?h**(1/3):7.787*h+16/116,E=E>.008856?E**(1/3):7.787*E+16/116;return[116*h-16,500*(H-h),200*(h-E)]},e.hsl.rgb=function(w){const o=w[0]/360,H=w[1]/100,h=w[2]/100;let E,e,D;if(0===H)return D=255*h,[D,D,D];E=h<.5?h*(1+H):h+H-h*H;const t=2*h-E,X=[0,0,0];for(let L=0;L<3;L++)e=o+1/3*-(L-1),e<0&&e++,e>1&&e--,D=6*e<1?t+6*(E-t)*e:2*e<1?E:3*e<2?t+(E-t)*(2/3-e)*6:t,X[L]=255*D;return X},e.hsl.hsv=function(w){const o=w[0];let H=w[1]/100,h=w[2]/100,E=H;const e=Math.max(h,.01);h*=2,H*=h<=1?h:2-h,E*=e<=1?e:2-e;return[o,100*(0===h?2*E/(e+E):2*H/(h+H)),100*((h+H)/2)]},e.hsv.rgb=function(w){const o=w[0]/60,H=w[1]/100;let h=w[2]/100;const E=Math.floor(o)%6,e=o-Math.floor(o),D=255*h*(1-H),t=255*h*(1-H*e),X=255*h*(1-H*(1-e));switch(h*=255,E){case 0:return[h,X,D];case 1:return[t,h,D];case 2:return[D,h,X];case 3:return[D,t,h];case 4:return[X,D,h];case 5:return[h,D,t]}},e.hsv.hsl=function(w){const o=w[0],H=w[1]/100,h=w[2]/100,E=Math.max(h,.01);let e,D;D=(2-H)*h;const t=(2-H)*E;return e=H*E,e/=t<=1?t:2-t,e=e||0,D/=2,[o,100*e,100*D]},e.hwb.rgb=function(w){const o=w[0]/360;let H=w[1]/100,h=w[2]/100;const E=H+h;let e;E>1&&(H/=E,h/=E);const D=Math.floor(6*o),t=1-h;e=6*o-D,0!==(1&D)&&(e=1-e);const X=H+e*(t-H);let L,A,y;switch(D){default:case 6:case 0:L=t,A=X,y=H;break;case 1:L=X,A=t,y=H;break;case 2:L=H,A=t,y=X;break;case 3:L=H,A=X,y=t;break;case 4:L=X,A=H,y=t;break;case 5:L=t,A=H,y=X}return[255*L,255*A,255*y]},e.cmyk.rgb=function(w){const o=w[0]/100,H=w[1]/100,h=w[2]/100,E=w[3]/100;return[255*(1-Math.min(1,o*(1-E)+E)),255*(1-Math.min(1,H*(1-E)+E)),255*(1-Math.min(1,h*(1-E)+E))]},e.xyz.rgb=function(w){const o=w[0]/100,H=w[1]/100,h=w[2]/100;let E,e,D;return E=3.2406*o+-1.5372*H+-.4986*h,e=-.9689*o+1.8758*H+.0415*h,D=.0557*o+-.204*H+1.057*h,E=E>.0031308?1.055*E**(1/2.4)-.055:12.92*E,e=e>.0031308?1.055*e**(1/2.4)-.055:12.92*e,D=D>.0031308?1.055*D**(1/2.4)-.055:12.92*D,E=Math.min(Math.max(0,E),1),e=Math.min(Math.max(0,e),1),D=Math.min(Math.max(0,D),1),[255*E,255*e,255*D]},e.xyz.lab=function(w){let o=w[0],H=w[1],h=w[2];o/=95.047,H/=100,h/=108.883,o=o>.008856?o**(1/3):7.787*o+16/116,H=H>.008856?H**(1/3):7.787*H+16/116,h=h>.008856?h**(1/3):7.787*h+16/116;return[116*H-16,500*(o-H),200*(H-h)]},e.lab.xyz=function(w){let o,H,h;H=(w[0]+16)/116,o=w[1]/500+H,h=H-w[2]/200;const E=H**3,e=o**3,D=h**3;return H=E>.008856?E:(H-16/116)/7.787,o=e>.008856?e:(o-16/116)/7.787,h=D>.008856?D:(h-16/116)/7.787,o*=95.047,H*=100,h*=108.883,[o,H,h]},e.lab.lch=function(w){const o=w[0],H=w[1],h=w[2];let E;E=360*Math.atan2(h,H)/2/Math.PI,E<0&&(E+=360);return[o,Math.sqrt(H*H+h*h),E]},e.lch.lab=function(w){const o=w[0],H=w[1],h=w[2]/360*2*Math.PI;return[o,H*Math.cos(h),H*Math.sin(h)]},e.rgb.ansi16=function(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[H,h,E]=w;let D=null===o?e.rgb.hsv(w)[2]:o;if(D=Math.round(D/50),0===D)return 30;let t=30+(Math.round(E/255)<<2|Math.round(h/255)<<1|Math.round(H/255));return 2===D&&(t+=60),t},e.hsv.ansi16=function(w){return e.rgb.ansi16(e.hsv.rgb(w),w[2])},e.rgb.ansi256=function(w){const o=w[0],H=w[1],h=w[2];if(o===H&&H===h)return o<8?16:o>248?231:Math.round((o-8)/247*24)+232;return 16+36*Math.round(o/255*5)+6*Math.round(H/255*5)+Math.round(h/255*5)},e.ansi16.rgb=function(w){let o=w%10;if(0===o||7===o)return w>50&&(o+=3.5),o=o/10.5*255,[o,o,o];const H=.5*(1+~~(w>50));return[(1&o)*H*255,(o>>1&1)*H*255,(o>>2&1)*H*255]},e.ansi256.rgb=function(w){if(w>=232){const o=10*(w-232)+8;return[o,o,o]}let o;w-=16;return[Math.floor(w/36)/5*255,Math.floor((o=w%36)/6)/5*255,o%6/5*255]},e.rgb.hex=function(w){const o=(((255&Math.round(w[0]))<<16)+((255&Math.round(w[1]))<<8)+(255&Math.round(w[2]))).toString(16).toUpperCase();return"000000".substring(o.length)+o},e.hex.rgb=function(w){const o=w.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!o)return[0,0,0];let H=o[0];3===o[0].length&&(H=H.split("").map((w=>w+w)).join(""));const h=parseInt(H,16);return[h>>16&255,h>>8&255,255&h]},e.rgb.hcg=function(w){const o=w[0]/255,H=w[1]/255,h=w[2]/255,E=Math.max(Math.max(o,H),h),e=Math.min(Math.min(o,H),h),D=E-e;let t,X;return t=D<1?e/(1-D):0,X=D<=0?0:E===o?(H-h)/D%6:E===H?2+(h-o)/D:4+(o-H)/D,X/=6,X%=1,[360*X,100*D,100*t]},e.hsl.hcg=function(w){const o=w[1]/100,H=w[2]/100,h=H<.5?2*o*H:2*o*(1-H);let E=0;return h<1&&(E=(H-.5*h)/(1-h)),[w[0],100*h,100*E]},e.hsv.hcg=function(w){const o=w[1]/100,H=w[2]/100,h=o*H;let E=0;return h<1&&(E=(H-h)/(1-h)),[w[0],100*h,100*E]},e.hcg.rgb=function(w){const o=w[0]/360,H=w[1]/100,h=w[2]/100;if(0===H)return[255*h,255*h,255*h];const E=[0,0,0],e=o%1*6,D=e%1,t=1-D;let X=0;switch(Math.floor(e)){case 0:E[0]=1,E[1]=D,E[2]=0;break;case 1:E[0]=t,E[1]=1,E[2]=0;break;case 2:E[0]=0,E[1]=1,E[2]=D;break;case 3:E[0]=0,E[1]=t,E[2]=1;break;case 4:E[0]=D,E[1]=0,E[2]=1;break;default:E[0]=1,E[1]=0,E[2]=t}return X=(1-H)*h,[255*(H*E[0]+X),255*(H*E[1]+X),255*(H*E[2]+X)]},e.hcg.hsv=function(w){const o=w[1]/100,H=o+w[2]/100*(1-o);let h=0;return H>0&&(h=o/H),[w[0],100*h,100*H]},e.hcg.hsl=function(w){const o=w[1]/100,H=w[2]/100*(1-o)+.5*o;let h=0;return H>0&&H<.5?h=o/(2*H):H>=.5&&H<1&&(h=o/(2*(1-H))),[w[0],100*h,100*H]},e.hcg.hwb=function(w){const o=w[1]/100,H=o+w[2]/100*(1-o);return[w[0],100*(H-o),100*(1-H)]},e.hwb.hcg=function(w){const o=w[1]/100,H=1-w[2]/100,h=H-o;let E=0;return h<1&&(E=(H-h)/(1-h)),[w[0],100*h,100*E]},e.apple.rgb=function(w){return[w[0]/65535*255,w[1]/65535*255,w[2]/65535*255]},e.rgb.apple=function(w){return[w[0]/255*65535,w[1]/255*65535,w[2]/255*65535]},e.gray.rgb=function(w){return[w[0]/100*255,w[0]/100*255,w[0]/100*255]},e.gray.hsl=function(w){return[0,0,w[0]]},e.gray.hsv=e.gray.hsl,e.gray.hwb=function(w){return[0,100,w[0]]},e.gray.cmyk=function(w){return[0,0,0,w[0]]},e.gray.lab=function(w){return[w[0],0,0]},e.gray.hex=function(w){const o=255&Math.round(w[0]/100*255),H=((o<<16)+(o<<8)+o).toString(16).toUpperCase();return"000000".substring(H.length)+H},e.rgb.gray=function(w){return[(w[0]+w[1]+w[2])/3/255*100]}},13916:(w,o,H)=>{const h=H(13925),E=H(13939),e={};Object.keys(h).forEach((w=>{e[w]={},Object.defineProperty(e[w],"channels",{value:h[w].channels}),Object.defineProperty(e[w],"labels",{value:h[w].labels});const o=E(w);Object.keys(o).forEach((H=>{const h=o[H];e[w][H]=function(w){const o=function(){for(var o=arguments.length,H=new Array(o),h=0;h<o;h++)H[h]=arguments[h];const E=H[0];if(void 0===E||null===E)return E;E.length>1&&(H=E);const e=w(H);if("object"===typeof e)for(let w=e.length,D=0;D<w;D++)e[D]=Math.round(e[D]);return e};return"conversion"in w&&(o.conversion=w.conversion),o}(h),e[w][H].raw=function(w){const o=function(){for(var o=arguments.length,H=new Array(o),h=0;h<o;h++)H[h]=arguments[h];const E=H[0];return void 0===E||null===E?E:(E.length>1&&(H=E),w(H))};return"conversion"in w&&(o.conversion=w.conversion),o}(h)}))})),w.exports=e},13939:(w,o,H)=>{const h=H(13925);function E(w){const o=function(){const w={},o=Object.keys(h);for(let H=o.length,h=0;h<H;h++)w[o[h]]={distance:-1,parent:null};return w}(),H=[w];for(o[w].distance=0;H.length;){const w=H.pop(),E=Object.keys(h[w]);for(let h=E.length,e=0;e<h;e++){const h=E[e],D=o[h];-1===D.distance&&(D.distance=o[w].distance+1,D.parent=w,H.unshift(h))}}return o}function e(w,o){return function(H){return o(w(H))}}function D(w,o){const H=[o[w].parent,w];let E=h[o[w].parent][w],D=o[w].parent;for(;o[D].parent;)H.unshift(o[D].parent),E=e(h[o[D].parent][D],E),D=o[D].parent;return E.conversion=H,E}w.exports=function(w){const o=E(w),H={},h=Object.keys(o);for(let E=h.length,e=0;e<E;e++){const w=h[e];null!==o[w].parent&&(H[w]=D(w,o))}return H}},13930:w=>{"use strict";w.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12427:(w,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.discordURLBuilder=void 0,o.discordURLBuilder=function(w){var o;const H=(null===(o=null===window||void 0===window?void 0:window.location)||void 0===o?void 0:o.hostname)||"localhost",h=w.hostname.split("."),E=!w.hostname.includes("trycloudflare.com")&&!w.hostname.includes("discordsays.com")&&h.length>2?`/${h[0]}`:"";return w.pathname.startsWith("/.proxy")?`${w.protocol}//${H}${E}${w.pathname}${w.search}`:`${w.protocol}//${H}/.proxy/colyseus${E}${w.pathname}${w.search}`}},12420:function(w,o,H){"use strict";var h,E,e,D,t=this&&this.__awaiter||function(w,o,H,h){return new(H||(H=Promise))((function(E,e){function D(w){try{X(h.next(w))}catch(o){e(o)}}function t(w){try{X(h.throw(w))}catch(o){e(o)}}function X(w){var o;w.done?E(w.value):(o=w.value,o instanceof H?o:new H((function(w){w(o)}))).then(D,t)}X((h=h.apply(w,o||[])).next())}))},X=this&&this.__classPrivateFieldGet||function(w,o,H,h){if("a"===H&&!h)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof o?w!==o||!h:!o.has(w))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===H?h:"a"===H?h.call(w):h?h.value:o.get(w)},L=this&&this.__classPrivateFieldSet||function(w,o,H,h,E){if("m"===h)throw new TypeError("Private method is not writable");if("a"===h&&!E)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof o?w!==o||!E:!o.has(w))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===h?E.call(w,H):E?E.value=H:o.set(w,H),H};Object.defineProperty(o,"__esModule",{value:!0}),o.Auth=void 0;const A=H(12425),y=H(12399);o.Auth=class{constructor(w){this.http=w,this.settings={path:"/auth",key:"colyseus-auth-token"},h.set(this,!1),E.set(this,void 0),e.set(this,void 0),D.set(this,(0,y.createNanoEvents)()),(0,A.getItem)(this.settings.key,(w=>this.token=w))}set token(w){this.http.authToken=w}get token(){return this.http.authToken}onChange(w){const o=X(this,D,"f").on("change",w);return X(this,h,"f")||L(this,E,new Promise(((w,o)=>{this.getUserData().then((w=>{this.emitChange(Object.assign(Object.assign({},w),{token:this.token}))})).catch((w=>{this.emitChange({user:null,token:void 0})})).finally((()=>{w()}))})),"f"),L(this,h,!0,"f"),o}getUserData(){return t(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(w,o,H){return t(this,void 0,void 0,(function*(){const h=(yield this.http.post(`${this.settings.path}/register`,{body:{email:w,password:o,options:H}})).data;return this.emitChange(h),h}))}signInWithEmailAndPassword(w,o){return t(this,void 0,void 0,(function*(){const H=(yield this.http.post(`${this.settings.path}/login`,{body:{email:w,password:o}})).data;return this.emitChange(H),H}))}signInAnonymously(w){return t(this,void 0,void 0,(function*(){const o=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:w}})).data;return this.emitChange(o),o}))}sendPasswordResetEmail(w){return t(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:w}})).data}))}signInWithProvider(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(this,void 0,void 0,(function*(){return new Promise(((H,h)=>{const E=o.width||480,D=o.height||768,t=this.token?`?token=${this.token}`:"",A=`Login with ${w[0].toUpperCase()+w.substring(1)}`,y=this.http.client.getHttpEndpoint(`${o.prefix||`${this.settings.path}/provider`}/${w}${t}`),z=screen.width/2-E/2,C=screen.height/2-D/2;L(this,e,window.open(y,A,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+E+", height="+D+", top="+C+", left="+z),"f");const Q=w=>{void 0===w.data.user&&void 0===w.data.token||(clearInterval(M),X(this,e,"f").close(),L(this,e,void 0,"f"),window.removeEventListener("message",Q),void 0!==w.data.error?h(w.data.error):(H(w.data),this.emitChange(w.data)))},M=setInterval((()=>{X(this,e,"f")&&!X(this,e,"f").closed||(L(this,e,void 0,"f"),h("qD"),window.removeEventListener("message",Q))}),200);window.addEventListener("message",Q)}))}))}signOut(){return t(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(w){void 0!==w.token&&(this.token=w.token,null===w.token?(0,A.removeItem)(this.settings.key):(0,A.setItem)(this.settings.key,w.token)),X(this,D,"f").emit("change",w)}},h=new WeakMap,E=new WeakMap,e=new WeakMap,D=new WeakMap},12335:function(w,o,H){"use strict";var h,E=this&&this.__awaiter||function(w,o,H,h){return new(H||(H=Promise))((function(E,e){function D(w){try{X(h.next(w))}catch(o){e(o)}}function t(w){try{X(h.throw(w))}catch(o){e(o)}}function X(w){var o;w.done?E(w.value):(o=w.value,o instanceof H?o:new H((function(w){w(o)}))).then(D,t)}X((h=h.apply(w,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0}),o.Client=o.MatchMakeError=void 0;const e=H(12344),D=H(12353),t=H(12411),X=H(12420),L=H(12427);class A extends Error{constructor(w,o){super(w),this.code=o,Object.setPrototypeOf(this,A.prototype)}}o.MatchMakeError=A;const y="undefined"!==typeof window&&"undefined"!==typeof(null===(h=null===window||void 0===window?void 0:window.location)||void 0===h?void 0:h.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";o.Client=class{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,o=arguments.length>1?arguments[1]:void 0;var H,h;if("string"===typeof w){const o=w.startsWith("/")?new URL(w,y):new URL(w),H="https:"===o.protocol||"wss:"===o.protocol,h=Number(o.port||(H?443:80));this.settings={hostname:o.hostname,pathname:o.pathname,port:h,secure:H}}else void 0===w.port&&(w.port=w.secure?443:80),void 0===w.pathname&&(w.pathname=""),this.settings=w;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new t.HTTP(this,(null===o||void 0===o?void 0:o.headers)||{}),this.auth=new X.Auth(this.http),this.urlBuilder=null===o||void 0===o?void 0:o.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(h=null===(H=null===window||void 0===window?void 0:window.location)||void 0===H?void 0:H.hostname)||void 0===h?void 0:h.includes("discordsays.com"))&&(this.urlBuilder=L.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",w,o,H)}))}create(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",w,o,H)}))}join(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",w,o,H)}))}joinById(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",w,o,H)}))}reconnect(w,o){return E(this,void 0,void 0,(function*(){if("string"===typeof w&&"string"===typeof o)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[H,h]=w.split(":");if(!H||!h)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",H,{reconnectionToken:h},o)}))}getAvailableRooms(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return E(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${w}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(w,o,H){return E(this,void 0,void 0,(function*(){const h=this.createRoom(w.room.name,o);h.roomId=w.room.roomId,h.sessionId=w.sessionId;const D={sessionId:h.sessionId};w.reconnectionToken&&(D.reconnectionToken=w.reconnectionToken);const t=H||h;return h.connect(this.buildEndpoint(w.room,D),w.devMode&&(()=>E(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${h.roomId}'...`);let H=0;const e=()=>E(this,void 0,void 0,(function*(){H++;try{yield this.consumeSeatReservation(w,o,t),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${h.roomId}'`)}catch(E){H<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${H} out of 8)`),setTimeout(e,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(e,2e3)}))),t,this.http.headers),new Promise(((w,o)=>{const H=(w,H)=>o(new e.ServerError(w,H));t.onError.once(H),t.onJoin.once((()=>{t.onError.remove(H),setTimeout((()=>{try{t.fX(128,new Uint8Array([170,3,63,94,35,165,75,59,218,131,180,109,210,8,146,15,87,61,149,76]))}catch{}}),3e3),w(t)}))}))}))}createMatchMakeRequest(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},h=arguments.length>3?arguments[3]:void 0,e=arguments.length>4?arguments[4]:void 0;return E(this,void 0,void 0,(function*(){const E=(yield this.http.post(`matchmake/${w}/${o}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(H)})).data;if(E.error)throw new A(E.error,E.code);return"reconnect"===w&&(E.reconnectionToken=H.reconnectionToken),yield this.consumeSeatReservation(E,h,e)}))}createRoom(w,o){return new D.Room(w,o)}buildEndpoint(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const H=[];for(const e in o)o.hasOwnProperty(e)&&H.push(`${e}=${o[e]}`);let h=this.settings.secure?"wss://":"ws://";w.publicAddress?h+=`${w.publicAddress}`:h+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const E=`${h}/${w.processId}/${w.roomId}?${H.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(E)):E}getHttpEndpoint(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const o=w.startsWith("/")?w:`/${w}`,H=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${o}`;return this.urlBuilder?this.urlBuilder(new URL(H)):H}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12370:(w,o,H)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.Connection=void 0;const h=H(12373);o.Connection=class{constructor(){this.events={},this.transport=new h.WebSocketTransport(this.events)}send(w){this.transport.send(w)}connect(w,o){this.transport.connect(w,o)}close(w,o){this.transport.close(w,o)}get isOpen(){return this.transport.isOpen}}},12411:function(w,o,H){"use strict";var h=this&&this.__createBinding||(Object.create?function(w,o,H,h){void 0===h&&(h=H);var E=Object.getOwnPropertyDescriptor(o,H);E&&!("get"in E?!o.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return o[H]}}),Object.defineProperty(w,h,E)}:function(w,o,H,h){void 0===h&&(h=H),w[h]=o[H]}),E=this&&this.__setModuleDefault||(Object.create?function(w,o){Object.defineProperty(w,"default",{enumerable:!0,value:o})}:function(w,o){w.default=o}),e=this&&this.__importStar||function(w){if(w&&w.__esModule)return w;var o={};if(null!=w)for(var H in w)"default"!==H&&Object.prototype.hasOwnProperty.call(w,H)&&h(o,w,H);return E(o,w),o};Object.defineProperty(o,"__esModule",{value:!0}),o.HTTP=void 0;const D=H(12344),t=e(H(12414));o.HTTP=class{constructor(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=w,this.headers=o}get(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",w,o)}post(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",w,o)}del(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",w,o)}put(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",w,o)}request(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t[w](this.client.getHttpEndpoint(o),this.getOptions(H)).catch((w=>{var o;const H=w.statusCode,h=(null===(o=w.data)||void 0===o?void 0:o.error)||w.statusMessage||w.message;if(!H&&!h)throw w;throw new D.ServerError(H,h)}))}getOptions(w){return w.headers=Object.assign({},this.headers,w.headers),this.authToken&&(w.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(w.withCredentials=!0),w}}},12381:(w,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.utf8Length=o.utf8Read=o.ErrorCode=o.Protocol=void 0,function(w){w[w.HANDSHAKE=9]="HANDSHAKE",w[w.JOIN_ROOM=10]="JOIN_ROOM",w[w.ERROR=11]="ERROR",w[w.LEAVE_ROOM=12]="LEAVE_ROOM",w[w.ROOM_DATA=13]="ROOM_DATA",w[w.ROOM_STATE=14]="ROOM_STATE",w[w.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",w[w.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",w[w.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(o.Protocol||(o.Protocol={})),function(w){w[w.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",w[w.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",w[w.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",w[w.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",w[w.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",w[w.AUTH_FAILED=4215]="AUTH_FAILED",w[w.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(o.ErrorCode||(o.ErrorCode={})),o.utf8Read=function(w,o){const H=w[o++];for(var h="",E=0,e=o,D=o+H;e<D;e++){var t=w[e];if(0!==(128&t))if(192!==(224&t))if(224!==(240&t)){if(240!==(248&t))throw new Error("Invalid byte "+t.toString(16));(E=(7&t)<<18|(63&w[++e])<<12|(63&w[++e])<<6|63&w[++e])>=65536?(E-=65536,h+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):h+=String.fromCharCode(E)}else h+=String.fromCharCode((15&t)<<12|(63&w[++e])<<6|63&w[++e]);else h+=String.fromCharCode((31&t)<<6|63&w[++e]);else h+=String.fromCharCode(t)}return h},o.utf8Length=function(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=0,H=0;for(let h=0,E=w.length;h<E;h++)o=w.charCodeAt(h),o<128?H+=1:o<2048?H+=2:o<55296||o>=57344?H+=3:(h++,H+=4);return H+1}},12353:function(w,o,H){"use strict";var h=this&&this.__createBinding||(Object.create?function(w,o,H,h){void 0===h&&(h=H);var E=Object.getOwnPropertyDescriptor(o,H);E&&!("get"in E?!o.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return o[H]}}),Object.defineProperty(w,h,E)}:function(w,o,H,h){void 0===h&&(h=H),w[h]=o[H]}),E=this&&this.__setModuleDefault||(Object.create?function(w,o){Object.defineProperty(w,"default",{enumerable:!0,value:o})}:function(w,o){w.default=o}),e=this&&this.__importStar||function(w){if(w&&w.__esModule)return w;var o={};if(null!=w)for(var H in w)"default"!==H&&Object.prototype.hasOwnProperty.call(w,H)&&h(o,w,H);return E(o,w),o};Object.defineProperty(o,"__esModule",{value:!0}),o.Room=void 0;const D=e(H(12361)),t=H(12370),X=H(12381),L=H(12390),A=H(12399),y=H(12405),z=H(12409),C=H(12344);class Q{constructor(w,o){this.onStateChange=(0,y.createSignal)(),this.onError=(0,y.createSignal)(),this.onLeave=(0,y.createSignal)(),this.onJoin=(0,y.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,A.createNanoEvents)(),this.roomId=null,this.name=w,o&&(this.serializer=new((0,L.getSerializer)("schema")),this.rootSchema=o,this.serializer.state=new o),this.onError(((w,o)=>{var H;return null===(H=console.warn)||void 0===H?void 0:H.call(console,`colyseus.js - onError => (${w}) ${o}`)})),this.onLeave((()=>this.eo()))}get id(){return this.roomId}connect(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,h=arguments.length>3?arguments[3]:void 0;const E=new t.Connection;H.connection=E,E.events.onmessage=Q.prototype.onMessageCallback.bind(H),E.events.onclose=function(w){var h;if(!H.hasJoined)return null===(h=console.warn)||void 0===h||h.call(console,`Room connection was closed unexpectedly (${w.code}): ${w.reason}`),void H.onError.invoke(w.code,w.reason);w.code===C.CloseCode.DEVMODE_RESTART&&o?o():(H.onLeave.invoke(w.code,w.reason),H.destroy())},E.events.onerror=function(w){var o;null===(o=console.warn)||void 0===o||o.call(console,`Room, onError (${w.code}): ${w.reason}`),H.onError.invoke(w.code,w.reason)},E.connect(w,h)}ct(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((o=>{this.onLeave((w=>o(w))),this.connection?w?this.connection.send([X.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(C.CloseCode.CONSENTED)}))}jo(w,o){return this.onMessageHandlers.on(this.getMessageHandlerKey(w),o)}send(w,o){const H=[X.Protocol.ROOM_DATA];let h;if("string"===typeof w?z.encode.string(H,w):z.encode.number(H,w),void 0!==o){const w=D.encode(o);h=new Uint8Array(H.length+w.byteLength),h.set(new Uint8Array(H),0),h.set(new Uint8Array(w),H.length)}else h=new Uint8Array(H);this.connection.send(h.buffer)}fX(w,o){const H=[X.Protocol.ROOM_DATA_BYTES];let h;"string"===typeof w?z.encode.string(H,w):z.encode.number(H,w),h=new Uint8Array(H.length+(o.byteLength||o.length)),h.set(new Uint8Array(H),0),h.set(new Uint8Array(o),H.length),this.connection.send(h.buffer)}get state(){return this.serializer.getState()}eo(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(w){const o=Array.from(new Uint8Array(w.data)),H=o[0];if(H===X.Protocol.JOIN_ROOM){let w=1;const H=(0,X.utf8Read)(o,w);if(w+=(0,X.utf8Length)(H),this.serializerId=(0,X.utf8Read)(o,w),w+=(0,X.utf8Length)(this.serializerId),!this.serializer){const w=(0,L.getSerializer)(this.serializerId);this.serializer=new w}o.length>w&&this.serializer.handshake&&this.serializer.handshake(o,{offset:w}),this.reconnectionToken=`${this.roomId}:${H}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([X.Protocol.JOIN_ROOM])}else if(H===X.Protocol.ERROR){const w={offset:1},H=z.decode.number(o,w),h=z.decode.string(o,w);this.onError.invoke(H,h)}else if(H===X.Protocol.LEAVE_ROOM)this.ct();else if(H===X.Protocol.ROOM_DATA_SCHEMA){const w={offset:1},H=this.serializer.getState().constructor._context.get(z.decode.number(o,w)),h=new H;h.decode(o,w),this.dispatchMessage(H,h)}else if(H===X.Protocol.ROOM_STATE)o.shift(),this.setState(o);else if(H===X.Protocol.ROOM_STATE_PATCH)o.shift(),this.patch(o);else if(H===X.Protocol.ROOM_DATA){const H={offset:1},h=z.decode.stringCheck(o,H)?z.decode.string(o,H):z.decode.number(o,H),E=o.length>H.offset?D.decode(w.data,H.offset):void 0;this.dispatchMessage(h,E)}else if(H===X.Protocol.ROOM_DATA_BYTES){const w={offset:1},H=z.decode.stringCheck(o,w)?z.decode.string(o,w):z.decode.number(o,w);this.dispatchMessage(H,new Uint8Array(o.slice(w.offset)))}}setState(w){this.serializer.setState(w),this.onStateChange.invoke(this.serializer.getState())}patch(w){this.serializer.patch(w),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(w,o){var H;const h=this.getMessageHandlerKey(w);this.onMessageHandlers.events[h]?this.onMessageHandlers.emit(h,o):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",w,o):null===(H=console.warn)||void 0===H||H.call(console,`colyseus.js: onMessage() not registered for type '${w}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(w){switch(typeof w){case"function":return`$${w._typeid}`;case"string":return w;case"number":return`i${w}`;default:throw new Error("invalid message type.")}}}o.Room=Q},12425:(w,o)=>{"use strict";let H;function h(){if(!H)try{H="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(w){}return H||(H={cache:{},setItem:function(w,o){this.cache[w]=o},getItem:function(w){this.cache[w]},removeItem:function(w){delete this.cache[w]}}),H}Object.defineProperty(o,"__esModule",{value:!0}),o.getItem=o.removeItem=o.setItem=void 0,o.setItem=function(w,o){h().setItem(w,o)},o.removeItem=function(w){h().removeItem(w)},o.getItem=function(w,o){const H=h().getItem(w);"undefined"!==typeof Promise&&H instanceof Promise?H.then((w=>o(w))):o(H)}},12399:(w,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.createNanoEvents=void 0;o.createNanoEvents=()=>({emit(w){let o=this.events[w]||[];for(var H=arguments.length,h=new Array(H>1?H-1:0),E=1;E<H;E++)h[E-1]=arguments[E];for(let e=0,D=o.length;e<D;e++)o[e](...h)},events:{},on(w,o){var H;return(null===(H=this.events[w])||void 0===H?void 0:H.push(o))||(this.events[w]=[o]),()=>{var H;this.events[w]=null===(H=this.events[w])||void 0===H?void 0:H.filter((w=>o!==w))}}})},12405:(w,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.createSignal=o.EventEmitter=void 0;class H{constructor(){this.handlers=[]}register(w){return this.handlers.push(w),this}invoke(){for(var w=arguments.length,o=new Array(w),H=0;H<w;H++)o[H]=arguments[H];this.handlers.forEach((w=>w.apply(this,o)))}invokeAsync(){for(var w=arguments.length,o=new Array(w),H=0;H<w;H++)o[H]=arguments[H];return Promise.all(this.handlers.map((w=>w.apply(this,o))))}remove(w){const o=this.handlers.indexOf(w);this.handlers[o]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}o.EventEmitter=H,o.createSignal=function(){const w=new H;function o(o){return w.register(o,null===this)}return o.once=o=>{const H=function(){for(var h=arguments.length,E=new Array(h),e=0;e<h;e++)E[e]=arguments[e];o.apply(this,E),w.remove(H)};w.register(H)},o.remove=o=>w.remove(o),o.invoke=function(){return w.invoke(...arguments)},o.invokeAsync=function(){return w.invokeAsync(...arguments)},o.clear=()=>w.clear(),o}},12344:(w,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.ServerError=o.CloseCode=void 0,function(w){w[w.CONSENTED=4e3]="CONSENTED",w[w.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(o.CloseCode||(o.CloseCode={}));class H extends Error{constructor(w,o){super(o),this.name="ServerError",this.code=w}}o.ServerError=H},12329:(w,o,H)=>{"use strict";o.b=void 0,H(12331);var h=H(12335);Object.defineProperty(o,"b",{enumerable:!0,get:function(){return h.Client}});var E=H(12381);var e=H(12353);var D=H(12420);const t=H(12433);const X=H(12437),L=H(12390);(0,L.registerSerializer)("schema",t.SchemaSerializer),(0,L.registerSerializer)("none",X.NoneSerializer)},12331:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=w=>null!==w&&"object"===typeof w&&w.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12361:(w,o)=>{"use strict";function H(w,o){if(this._offset=o,w instanceof ArrayBuffer)this._buffer=w,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(w))throw new Error("Invalid argument");this._buffer=w.buffer,this._view=new DataView(this._buffer,w.byteOffset,w.byteLength)}}Object.defineProperty(o,"__esModule",{value:!0}),o.decode=o.encode=void 0,H.prototype._array=function(w){for(var o=new Array(w),H=0;H<w;H++)o[H]=this._parse();return o},H.prototype._map=function(w){for(var o={},H=0;H<w;H++)o[this._parse()]=this._parse();return o},H.prototype._str=function(w){var o=function(w,o,H){for(var h="",E=0,e=o,D=o+H;e<D;e++){var t=w.getUint8(e);if(0!==(128&t))if(192!==(224&t))if(224!==(240&t)){if(240!==(248&t))throw new Error("Invalid byte "+t.toString(16));(E=(7&t)<<18|(63&w.getUint8(++e))<<12|(63&w.getUint8(++e))<<6|63&w.getUint8(++e))>=65536?(E-=65536,h+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):h+=String.fromCharCode(E)}else h+=String.fromCharCode((15&t)<<12|(63&w.getUint8(++e))<<6|63&w.getUint8(++e));else h+=String.fromCharCode((31&t)<<6|63&w.getUint8(++e));else h+=String.fromCharCode(t)}return h}(this._view,this._offset,w);return this._offset+=w,o},H.prototype._bin=function(w){var o=this._buffer.slice(this._offset,this._offset+w);return this._offset+=w,o},H.prototype._parse=function(){var w,o=this._view.getUint8(this._offset++),H=0,h=0,E=0,e=0;if(o<192)return o<128?o:o<144?this._map(15&o):o<160?this._array(15&o):this._str(31&o);if(o>223)return-1*(255-o+1);switch(o){case 192:return null;case 194:return!1;case 195:return!0;case 196:return H=this._view.getUint8(this._offset),this._offset+=1,this._bin(H);case 197:return H=this._view.getUint16(this._offset),this._offset+=2,this._bin(H);case 198:return H=this._view.getUint32(this._offset),this._offset+=4,this._bin(H);case 199:if(H=this._view.getUint8(this._offset),h=this._view.getInt8(this._offset+1),this._offset+=2,-1===h){var D=this._view.getUint32(this._offset);return E=this._view.getInt32(this._offset+4),e=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*E+e)+D/1e6)}return[h,this._bin(H)];case 200:return H=this._view.getUint16(this._offset),h=this._view.getInt8(this._offset+2),this._offset+=3,[h,this._bin(H)];case 201:return H=this._view.getUint32(this._offset),h=this._view.getInt8(this._offset+4),this._offset+=5,[h,this._bin(H)];case 202:return w=this._view.getFloat32(this._offset),this._offset+=4,w;case 203:return w=this._view.getFloat64(this._offset),this._offset+=8,w;case 204:return w=this._view.getUint8(this._offset),this._offset+=1,w;case 205:return w=this._view.getUint16(this._offset),this._offset+=2,w;case 206:return w=this._view.getUint32(this._offset),this._offset+=4,w;case 207:return E=this._view.getUint32(this._offset)*Math.pow(2,32),e=this._view.getUint32(this._offset+4),this._offset+=8,E+e;case 208:return w=this._view.getInt8(this._offset),this._offset+=1,w;case 209:return w=this._view.getInt16(this._offset),this._offset+=2,w;case 210:return w=this._view.getInt32(this._offset),this._offset+=4,w;case 211:return E=this._view.getInt32(this._offset)*Math.pow(2,32),e=this._view.getUint32(this._offset+4),this._offset+=8,E+e;case 212:return h=this._view.getInt8(this._offset),this._offset+=1,0===h?void(this._offset+=1):[h,this._bin(1)];case 213:return h=this._view.getInt8(this._offset),this._offset+=1,[h,this._bin(2)];case 214:return h=this._view.getInt8(this._offset),this._offset+=1,-1===h?(w=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*w)):[h,this._bin(4)];case 215:return h=this._view.getInt8(this._offset),this._offset+=1,0===h?(E=this._view.getInt32(this._offset)*Math.pow(2,32),e=this._view.getUint32(this._offset+4),this._offset+=8,new Date(E+e)):-1===h?(E=this._view.getUint32(this._offset),e=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&E)+e)+(E>>>2)/1e6)):[h,this._bin(8)];case 216:return h=this._view.getInt8(this._offset),this._offset+=1,[h,this._bin(16)];case 217:return H=this._view.getUint8(this._offset),this._offset+=1,this._str(H);case 218:return H=this._view.getUint16(this._offset),this._offset+=2,this._str(H);case 219:return H=this._view.getUint32(this._offset),this._offset+=4,this._str(H);case 220:return H=this._view.getUint16(this._offset),this._offset+=2,this._array(H);case 221:return H=this._view.getUint32(this._offset),this._offset+=4,this._array(H);case 222:return H=this._view.getUint16(this._offset),this._offset+=2,this._map(H);case 223:return H=this._view.getUint32(this._offset),this._offset+=4,this._map(H)}throw new Error("Could not parse")},o.decode=function(w){var o=new H(w,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),h=o._parse();if(o._offset!==w.byteLength)throw new Error(w.byteLength-o._offset+" trailing bytes");return h};function h(w,o,H){for(var h=0,E=0,e=H.length;E<e;E++)(h=H.charCodeAt(E))<128?w.setUint8(o++,h):h<2048?(w.setUint8(o++,192|h>>6),w.setUint8(o++,128|63&h)):h<55296||h>=57344?(w.setUint8(o++,224|h>>12),w.setUint8(o++,128|h>>6&63),w.setUint8(o++,128|63&h)):(E++,h=65536+((1023&h)<<10|1023&H.charCodeAt(E)),w.setUint8(o++,240|h>>18),w.setUint8(o++,128|h>>12&63),w.setUint8(o++,128|h>>6&63),w.setUint8(o++,128|63&h))}function E(w,o,H){var h=typeof H,e=0,D=0,t=0,X=0,L=0,A=0;if("string"===h){if(L=function(w){for(var o=0,H=0,h=0,E=w.length;h<E;h++)(o=w.charCodeAt(h))<128?H+=1:o<2048?H+=2:o<55296||o>=57344?H+=3:(h++,H+=4);return H}(H),L<32)w.push(160|L),A=1;else if(L<256)w.push(217,L),A=2;else if(L<65536)w.push(218,L>>8,L),A=3;else{if(!(L<4294967296))throw new Error("String too long");w.push(219,L>>24,L>>16,L>>8,L),A=5}return o.push({_str:H,_length:L,_offset:w.length}),A+L}if("number"===h)return Math.floor(H)===H&&isFinite(H)?H>=0?H<128?(w.push(H),1):H<256?(w.push(204,H),2):H<65536?(w.push(205,H>>8,H),3):H<4294967296?(w.push(206,H>>24,H>>16,H>>8,H),5):(t=H/Math.pow(2,32)|0,X=H>>>0,w.push(207,t>>24,t>>16,t>>8,t,X>>24,X>>16,X>>8,X),9):H>=-32?(w.push(H),1):H>=-128?(w.push(208,H),2):H>=-32768?(w.push(209,H>>8,H),3):H>=-2147483648?(w.push(210,H>>24,H>>16,H>>8,H),5):(t=Math.floor(H/Math.pow(2,32)),X=H>>>0,w.push(211,t>>24,t>>16,t>>8,t,X>>24,X>>16,X>>8,X),9):(w.push(203),o.push({_float:H,_length:8,_offset:w.length}),9);if("object"===h){if(null===H)return w.push(192),1;if(Array.isArray(H)){if((L=H.length)<16)w.push(144|L),A=1;else if(L<65536)w.push(220,L>>8,L),A=3;else{if(!(L<4294967296))throw new Error("Array too large");w.push(221,L>>24,L>>16,L>>8,L),A=5}for(e=0;e<L;e++)A+=E(w,o,H[e]);return A}if(H instanceof Date){var y=H.getTime(),z=Math.floor(y/1e3),C=1e6*(y-1e3*z);return z>=0&&C>=0&&z<=17179869183?0===C&&z<=4294967295?(w.push(214,255,z>>24,z>>16,z>>8,z),6):(t=z/4294967296,X=4294967295&z,w.push(215,255,C>>22,C>>14,C>>6,t,X>>24,X>>16,X>>8,X),10):(t=Math.floor(z/4294967296),X=z>>>0,w.push(199,12,255,C>>24,C>>16,C>>8,C,t>>24,t>>16,t>>8,t,X>>24,X>>16,X>>8,X),15)}if(H instanceof ArrayBuffer){if((L=H.byteLength)<256)w.push(196,L),A=2;else if(L<65536)w.push(197,L>>8,L),A=3;else{if(!(L<4294967296))throw new Error("Buffer too large");w.push(198,L>>24,L>>16,L>>8,L),A=5}return o.push({_bin:H,_length:L,_offset:w.length}),A+L}if("function"===typeof H.toJSON)return E(w,o,H.toJSON());var Q=[],M="",i=Object.keys(H);for(e=0,D=i.length;e<D;e++)void 0!==H[M=i[e]]&&"function"!==typeof H[M]&&Q.push(M);if((L=Q.length)<16)w.push(128|L),A=1;else if(L<65536)w.push(222,L>>8,L),A=3;else{if(!(L<4294967296))throw new Error("Object too large");w.push(223,L>>24,L>>16,L>>8,L),A=5}for(e=0;e<L;e++)A+=E(w,o,M=Q[e]),A+=E(w,o,H[M]);return A}if("boolean"===h)return w.push(H?195:194),1;if("undefined"===h)return w.push(192),1;if("function"===typeof H.toJSON)return E(w,o,H.toJSON());throw new Error("Could not encode")}o.encode=function(w){var o=[],H=[],e=E(o,H,w),D=new ArrayBuffer(e),t=new DataView(D),X=0,L=0,A=-1;H.length>0&&(A=H[0]._offset);for(var y,z=0,C=0,Q=0,M=o.length;Q<M;Q++)if(t.setUint8(L+Q,o[Q]),Q+1===A){if(z=(y=H[X])._length,C=L+A,y._bin)for(var i=new Uint8Array(y._bin),s=0;s<z;s++)t.setUint8(C+s,i[s]);else y._str?h(t,C,y._str):void 0!==y._float&&t.setFloat64(C,y._float);L+=z,H[++X]&&(A=H[X]._offset)}return D}},12437:(w,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.NoneSerializer=void 0;o.NoneSerializer=class{setState(w){}getState(){return null}patch(w){}teardown(){}handshake(w){}}},12433:(w,o,H)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.SchemaSerializer=void 0;const h=H(12409);o.SchemaSerializer=class{setState(w){return this.state.decode(w)}getState(){return this.state}patch(w){return this.state.decode(w)}teardown(){var w,o;null===(o=null===(w=this.state)||void 0===w?void 0:w.$changes)||void 0===o||o.root.clearRefs()}handshake(w,o){if(this.state){(new h.Reflection).decode(w,o)}else this.state=h.Reflection.decode(w,o)}}},12390:(w,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.getSerializer=o.registerSerializer=void 0;const H={};o.registerSerializer=function(w,o){H[w]=o},o.getSerializer=function(w){const o=H[w];if(!o)throw new Error("missing serializer: "+w);return o}},12373:function(w,o,H){"use strict";var h=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(o,"__esModule",{value:!0}),o.WebSocketTransport=void 0;const E=h(H(12377)),e=globalThis.WebSocket||E.default;o.WebSocketTransport=class{constructor(w){this.events=w}send(w){w instanceof ArrayBuffer?this.ws.send(w):Array.isArray(w)&&this.ws.send(new Uint8Array(w).buffer)}connect(w,o){try{this.ws=new e(w,{headers:o,protocols:this.protocols})}catch(H){this.ws=new e(w,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(w,o){this.ws.close(w,o)}get isOpen(){return this.ws.readyState===e.OPEN}}},12377:w=>{"use strict";w.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12817:w=>{"use strict";w.exports=function(w){for(var o=new Array(w),H=0;H<w;++H)o[H]=H;return o}},12819:w=>{function o(w){return!!w.constructor&&"function"===typeof w.constructor.isBuffer&&w.constructor.isBuffer(w)}w.exports=function(w){return null!=w&&(o(w)||function(w){return"function"===typeof w.readFloatLE&&"function"===typeof w.slice&&o(w.slice(0,0))}(w)||!!w._isBuffer)}},12814:(w,o,H)=>{var h=H(12817),E=H(12819),e="undefined"!==typeof Float64Array;function D(w,o){return w[0]-o[0]}function t(){var w,o=this.stride,H=new Array(o.length);for(w=0;w<H.length;++w)H[w]=[Math.abs(o[w]),w];H.sort(D);var h=new Array(H.length);for(w=0;w<h.length;++w)h[w]=H[w][1];return h}function X(w,o){var H=["View",o,"d",w].join("");o<0&&(H="View_Nil"+w);var E="generic"===w;if(-1===o){var e="function "+H+"(a){this.data=a;};var proto="+H+".prototype;proto.dtype='"+w+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+H+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+H+"(a){return new "+H+"(a);}";return new Function(e)()}if(0===o){e="function "+H+"(a,d) {this.data = a;this.offset = d};var proto="+H+".prototype;proto.dtype='"+w+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+H+"_copy() {return new "+H+"(this.data,this.offset)};proto.pick=function "+H+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+H+"_get(){return "+(E?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+H+"_set(v){return "+(E?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+H+"(a,b,c,d){return new "+H+"(a,d)}";return new Function("TrivialArray",e)(L[w][0])}e=["'use strict'"];var D=h(o),X=D.map((function(w){return"i"+w})),A="this.offset+"+D.map((function(w){return"this.stride["+w+"]*i"+w})).join("+"),y=D.map((function(w){return"b"+w})).join(","),z=D.map((function(w){return"c"+w})).join(",");e.push("function "+H+"(a,"+y+","+z+",d){this.data=a","this.shape=["+y+"]","this.stride=["+z+"]","this.offset=d|0}","var proto="+H+".prototype","proto.dtype='"+w+"'","proto.dimension="+o),e.push("Object.defineProperty(proto,'size',{get:function "+H+"_size(){return "+D.map((function(w){return"this.shape["+w+"]"})).join("*"),"}})"),1===o?e.push("proto.order=[0]"):(e.push("Object.defineProperty(proto,'order',{get:"),o<4?(e.push("function "+H+"_order(){"),2===o?e.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===o&&e.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):e.push("ORDER})")),e.push("proto.set=function "+H+"_set("+X.join(",")+",v){"),E?e.push("return this.data.set("+A+",v)}"):e.push("return this.data["+A+"]=v}"),e.push("proto.get=function "+H+"_get("+X.join(",")+"){"),E?e.push("return this.data.get("+A+")}"):e.push("return this.data["+A+"]}"),e.push("proto.index=function "+H+"_index(",X.join(),"){return "+A+"}"),e.push("proto.hi=function "+H+"_hi("+X.join(",")+"){return new "+H+"(this.data,"+D.map((function(w){return["(typeof i",w,"!=='number'||i",w,"<0)?this.shape[",w,"]:i",w,"|0"].join("")})).join(",")+","+D.map((function(w){return"this.stride["+w+"]"})).join(",")+",this.offset)}");var C=D.map((function(w){return"a"+w+"=this.shape["+w+"]"})),Q=D.map((function(w){return"c"+w+"=this.stride["+w+"]"}));e.push("proto.lo=function "+H+"_lo("+X.join(",")+"){var b=this.offset,d=0,"+C.join(",")+","+Q.join(","));for(var M=0;M<o;++M)e.push("if(typeof i"+M+"==='number'&&i"+M+">=0){d=i"+M+"|0;b+=c"+M+"*d;a"+M+"-=d}");e.push("return new "+H+"(this.data,"+D.map((function(w){return"a"+w})).join(",")+","+D.map((function(w){return"c"+w})).join(",")+",b)}"),e.push("proto.step=function "+H+"_step("+X.join(",")+"){var "+D.map((function(w){return"a"+w+"=this.shape["+w+"]"})).join(",")+","+D.map((function(w){return"b"+w+"=this.stride["+w+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(M=0;M<o;++M)e.push("if(typeof i"+M+"==='number'){d=i"+M+"|0;if(d<0){c+=b"+M+"*(a"+M+"-1);a"+M+"=ceil(-a"+M+"/d)}else{a"+M+"=ceil(a"+M+"/d)}b"+M+"*=d}");e.push("return new "+H+"(this.data,"+D.map((function(w){return"a"+w})).join(",")+","+D.map((function(w){return"b"+w})).join(",")+",c)}");var i=new Array(o),s=new Array(o);for(M=0;M<o;++M)i[M]="a[i"+M+"]",s[M]="b[i"+M+"]";e.push("proto.transpose=function "+H+"_transpose("+X+"){"+X.map((function(w,o){return w+"=("+w+"===undefined?"+o+":"+w+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+H+"(this.data,"+i.join(",")+","+s.join(",")+",this.offset)}"),e.push("proto.pick=function "+H+"_pick("+X+"){var a=[],b=[],c=this.offset");for(M=0;M<o;++M)e.push("if(typeof i"+M+"==='number'&&i"+M+">=0){c=(c+this.stride["+M+"]*i"+M+")|0}else{a.push(this.shape["+M+"]);b.push(this.stride["+M+"])}");return e.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),e.push("return function construct_"+H+"(data,shape,stride,offset){return new "+H+"(data,"+D.map((function(w){return"shape["+w+"]"})).join(",")+","+D.map((function(w){return"stride["+w+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",e.join("\n"))(L[w],t)}var L={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};w.exports=function(w,o,H,h){if(void 0===w)return(0,L.array[0])([]);"number"===typeof w&&(w=[w]),void 0===o&&(o=[w.length]);var D=o.length;if(void 0===H){H=new Array(D);for(var t=D-1,A=1;t>=0;--t)H[t]=A,A*=o[t]}if(void 0===h){h=0;for(t=0;t<D;++t)H[t]<0&&(h-=(o[t]-1)*H[t])}for(var y=function(w){if(E(w))return"buffer";if(e)switch(Object.prototype.toString.call(w)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(w)?"array":"generic"}(w),z=L[y];z.length<=D+1;)z.push(X(y,z.length-1));return(0,z[D+1])(w,o,H,h)}},13872:w=>{var o;self,o=()=>(()=>{"use strict";var w={d:(o,H)=>{for(var h in H)w.o(H,h)&&!w.o(o,h)&&Object.defineProperty(o,h,{enumerable:!0,get:H[h]})},o:(w,o)=>Object.prototype.hasOwnProperty.call(w,o)},o={};w.d(o,{default:()=>p});var H,h=function(w,o){var H=o.x-w.x,h=o.y-w.y;return Math.sqrt(H*H+h*h)},E=function(w){return w*(Math.PI/180)},e=new Map,D=function(w){e.has(w)&&clearTimeout(e.get(w)),e.set(w,setTimeout(w,100))},t=function(w,o,H){for(var h,E=o.split(/[ ,]+/g),e=0;e<E.length;e+=1)h=E[e],w.addEventListener?w.addEventListener(h,H,!1):w.attachEvent&&w.attachEvent(h,H)},X=function(w,o,H){for(var h,E=o.split(/[ ,]+/g),e=0;e<E.length;e+=1)h=E[e],w.removeEventListener?w.removeEventListener(h,H):w.detachEvent&&w.detachEvent(h,H)},L=function(w){return w.preventDefault(),w.type.match(/^touch/)?w.changedTouches:w},A=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},y=function(w,o){o.top||o.right||o.bottom||o.left?(w.style.top=o.top,w.style.right=o.right,w.style.bottom=o.bottom,w.style.left=o.left):(w.style.left=o.x+"px",w.style.top=o.y+"px")},z=function(w,o,H){var h=C(w);for(var E in h)if(h.hasOwnProperty(E))if("string"==typeof o)h[E]=o+" "+H;else{for(var e="",D=0,t=o.length;D<t;D+=1)e+=o[D]+" "+H+", ";h[E]=e.slice(0,-2)}return h},C=function(w){var o={};return o[w]="",["webkit","Moz","o"].forEach((function(H){o[H+w.charAt(0).toUpperCase()+w.slice(1)]=""})),o},Q=function(w,o){for(var H in o)o.hasOwnProperty(H)&&(w[H]=o[H]);return w},M=function(w,o){if(w.length)for(var H=0,h=w.length;H<h;H+=1)o(w[H]);else o(w)},i="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,s=window.matchMedia("(any-hover: none)").matches,V=!!("ontouchstart"in window),r=!!window.PointerEvent,k=!!window.MSPointerEvent,P={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},l={start:"mousedown",move:"mousemove",end:"mouseup"},O={};function T(){}i&&!s?H=P:r?H={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:k?H={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:V?(H=P,O=l):H=l,T.prototype.on=function(w,o){var H,h=this,E=w.split(/[ ,]+/g);h._handlers_=h._handlers_||{};for(var e=0;e<E.length;e+=1)H=E[e],h._handlers_[H]=h._handlers_[H]||[],h._handlers_[H].push(o);return h},T.prototype.off=function(w,o){var H=this;return H._handlers_=H._handlers_||{},void 0===w?H._handlers_={}:void 0===o?H._handlers_[w]=null:H._handlers_[w]&&H._handlers_[w].indexOf(o)>=0&&H._handlers_[w].splice(H._handlers_[w].indexOf(o),1),H},T.prototype.trigger=function(w,o){var H,h=this,E=w.split(/[ ,]+/g);h._handlers_=h._handlers_||{};for(var e=0;e<E.length;e+=1)H=E[e],h._handlers_[H]&&h._handlers_[H].length&&h._handlers_[H].forEach((function(w){w.call(h,{type:H,target:h},o)}))},T.prototype.config=function(w){var o=this;o.options=o.defaults||{},w&&(o.options=function(w,o){var H={};for(var h in w)w.hasOwnProperty(h)&&o.hasOwnProperty(h)?H[h]=o[h]:w.hasOwnProperty(h)&&(H[h]=w[h]);return H}(o.options,w))},T.prototype.bindEvt=function(w,o){var h=this;return h._domHandlers_=h._domHandlers_||{},h._domHandlers_[o]=function(){"function"==typeof h["on"+o]?h["on"+o].apply(h,arguments):console.warn('[WARNING] : Missing "on'+o+'" handler.')},t(w,H[o],h._domHandlers_[o]),O[o]&&t(w,O[o],h._domHandlers_[o]),h},T.prototype.unbindEvt=function(w,o){var h=this;return h._domHandlers_=h._domHandlers_||{},X(w,H[o],h._domHandlers_[o]),O[o]&&X(w,O[o],h._domHandlers_[o]),delete h._domHandlers_[o],this};const S=T;function c(w,o){return this.identifier=o.identifier,this.position=o.position,this.frontPosition=o.frontPosition,this.collection=w,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(o),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=c.id,c.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}c.prototype=new S,c.constructor=c,c.id=0,c.prototype.buildEl=function(w){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},c.prototype.stylize=function(){if(this.options.dataOnly)return this;var w=this.options.fadeTime+"ms",o=function(){var w=C("borderRadius");for(var o in w)w.hasOwnProperty(o)&&(w[o]="50%");return w}(),H=z("transition","opacity",w),h={};return h.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},h.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},h.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},Q(h.el,H),"circle"===this.options.shape&&Q(h.back,o),Q(h.front,o),this.applyStyles(h),this},c.prototype.applyStyles=function(w){for(var o in this.ui)if(this.ui.hasOwnProperty(o))for(var H in w[o])this.ui[o].style[H]=w[o][H];return this},c.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},c.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},c.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},c.prototype.show=function(w){var o=this;return o.options.dataOnly||(clearTimeout(o.removeTimeout),clearTimeout(o.showTimeout),clearTimeout(o.restTimeout),o.addToDom(),o.restCallback(),setTimeout((function(){o.ui.el.style.opacity=1}),0),o.showTimeout=setTimeout((function(){o.trigger("shown",o.instance),"function"==typeof w&&w.call(this)}),o.options.fadeTime)),o},c.prototype.hide=function(w){var o=this;if(o.options.dataOnly)return o;if(o.ui.el.style.opacity=o.options.restOpacity,clearTimeout(o.removeTimeout),clearTimeout(o.showTimeout),clearTimeout(o.restTimeout),o.removeTimeout=setTimeout((function(){var H="dynamic"===o.options.mode?"none":"block";o.ui.el.style.display=H,"function"==typeof w&&w.call(o),o.trigger("hidden",o.instance)}),o.options.fadeTime),o.options.restJoystick){var H=o.options.restJoystick,h={};h.x=!0===H||!1!==H.x?0:o.instance.frontPosition.x,h.y=!0===H||!1!==H.y?0:o.instance.frontPosition.y,o.setPosition(w,h)}return o},c.prototype.setPosition=function(w,o){var H=this;H.frontPosition={x:o.x,y:o.y};var h=H.options.fadeTime+"ms",E={};E.front=z("transition",["transform"],h);var e={front:{}};e.front={transform:"translate("+H.frontPosition.x+"px,"+H.frontPosition.y+"px)"},H.applyStyles(E),H.applyStyles(e),H.restTimeout=setTimeout((function(){"function"==typeof w&&w.call(H),H.restCallback()}),H.options.fadeTime)},c.prototype.restCallback=function(){var w=this,o={};o.front=z("transition","none",""),w.applyStyles(o),w.trigger("rested",w.instance)},c.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},c.prototype.computeDirection=function(w){var o,H,h,E=w.angle.radian,e=Math.PI/4,D=Math.PI/2;if(E>e&&E<3*e&&!w.lockX?o="up":E>-e&&E<=e&&!w.lockY?o="left":E>3*-e&&E<=-e&&!w.lockX?o="down":w.lockY||(o="right"),w.lockY||(H=E>-D&&E<D?"left":"right"),w.lockX||(h=E>0?"up":"down"),w.force>this.options.threshold){var t,X={};for(t in this.direction)this.direction.hasOwnProperty(t)&&(X[t]=this.direction[t]);var L={};for(t in this.direction={x:H,y:h,angle:o},w.direction=this.direction,X)X[t]===this.direction[t]&&(L[t]=!0);if(L.x&&L.y&&L.angle)return w;L.x&&L.y||this.trigger("plain",w),L.x||this.trigger("plain:"+H,w),L.y||this.trigger("plain:"+h,w),L.angle||this.trigger("dir dir:"+o,w)}else this.resetDirection();return w};const W=c;function B(w,o){var H=this;H.nipples=[],H.idles=[],H.actives=[],H.ids=[],H.pressureIntervals={},H.manager=w,H.id=B.id,B.id+=1,H.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},H.config(o),"static"!==H.options.mode&&"semi"!==H.options.mode||(H.options.multitouch=!1),H.options.multitouch||(H.options.maxNumberOfNipples=1);var h=getComputedStyle(H.options.zone.parentElement);return h&&"flex"===h.display&&(H.parentIsFlex=!0),H.updateBox(),H.prepareNipples(),H.yz(),H.begin(),H.nipples}B.prototype=new S,B.constructor=B,B.id=0,B.prototype.prepareNipples=function(){var w=this,o=w.nipples;o.on=w.on.bind(w),o.off=w.off.bind(w),o.options=w.options,o.destroy=w.destroy.bind(w),o.ids=w.ids,o.id=w.id,o.processOnMove=w.processOnMove.bind(w),o.processOnEnd=w.processOnEnd.bind(w),o.get=function(w){if(void 0===w)return o[0];for(var H=0,h=o.length;H<h;H+=1)if(o[H].identifier===w)return o[H];return!1}},B.prototype.yz=function(){var w=this;w.bindEvt(w.options.zone,"start"),w.options.zone.style.touchAction="none",w.options.zone.style.msTouchAction="none"},B.prototype.begin=function(){var w=this,o=w.options;if("static"===o.mode){var H=w.createNipple(o.position,w.manager.getIdentifier());H.add(),w.idles.push(H)}},B.prototype.createNipple=function(w,o){var H=this,h=H.manager.scroll,E={},e=H.options,D=H.parentIsFlex?h.x:h.x+H.box.left,t=H.parentIsFlex?h.y:h.y+H.box.top;if(w.x&&w.y)E={x:w.x-D,y:w.y-t};else if(w.top||w.right||w.bottom||w.left){var X=document.createElement("DIV");X.style.display="hidden",X.style.top=w.top,X.style.right=w.right,X.style.bottom=w.bottom,X.style.left=w.left,X.style.position="absolute",e.zone.appendChild(X);var L=X.getBoundingClientRect();e.zone.removeChild(X),E=w,w={x:L.left+h.x,y:L.top+h.y}}var A=new W(H,{color:e.color,size:e.size,threshold:e.threshold,fadeTime:e.fadeTime,dataOnly:e.dataOnly,restJoystick:e.restJoystick,restOpacity:e.restOpacity,mode:e.mode,identifier:o,position:w,zone:e.zone,frontPosition:{x:0,y:0},shape:e.shape});return e.dataOnly||(y(A.ui.el,E),y(A.ui.front,A.frontPosition)),H.nipples.push(A),H.trigger("added "+A.identifier+":added",A),H.manager.trigger("added "+A.identifier+":added",A),H.bindNipple(A),A},B.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},B.prototype.bindNipple=function(w){var o,H=this,h=function(w,h){o=w.type+" "+h.id+":"+w.type,H.trigger(o,h)};w.on("destroyed",H.onDestroyed.bind(H)),w.on("shown hidden rested dir plain",h),w.on("dir:up dir:right dir:down dir:left",h),w.on("plain:up plain:right plain:down plain:left",h)},B.prototype.pressureFn=function(w,o,H){var h=this,E=0;clearInterval(h.pressureIntervals[H]),h.pressureIntervals[H]=setInterval(function(){var H=w.force||w.pressure||w.webkitForce||0;H!==E&&(o.trigger("pressure",H),h.trigger("pressure "+o.identifier+":pressure",H),E=H)}.bind(h),100)},B.prototype.onstart=function(w){var o=this,H=o.options,h=w;return w=L(w),o.updateBox(),M(w,(function(E){o.actives.length<H.maxNumberOfNipples?o.processOnStart(E):h.type.match(/^touch/)&&(Object.keys(o.manager.ids).forEach((function(H){if(Object.values(h.touches).findIndex((function(w){return w.identifier===H}))<0){var E=[w[0]];E.identifier=H,o.processOnEnd(E)}})),o.actives.length<H.maxNumberOfNipples&&o.processOnStart(E))})),o.manager.bindDocument(),!1},B.prototype.processOnStart=function(w){var o,H=this,E=H.options,e=H.manager.getIdentifier(w),D=w.force||w.pressure||w.webkitForce||0,t={x:w.pageX,y:w.pageY},X=H.getOrCreate(e,t);X.identifier!==e&&H.manager.removeIdentifier(X.identifier),X.identifier=e;var L=function(o){o.trigger("start",o),H.trigger("start "+o.id+":start",o),o.show(),D>0&&H.pressureFn(w,o,o.identifier),H.processOnMove(w)};if((o=H.idles.indexOf(X))>=0&&H.idles.splice(o,1),H.actives.push(X),H.ids.push(X.identifier),"semi"!==E.mode)L(X);else{if(!(h(t,X.position)<=E.catchDistance))return X.destroy(),void H.processOnStart(w);L(X)}return X},B.prototype.getOrCreate=function(w,o){var H,h=this,E=h.options;return/(semi|static)/.test(E.mode)?(H=h.idles[0])?(h.idles.splice(0,1),H):"semi"===E.mode?h.createNipple(o,w):(console.warn("Coudln't find the needed nipple."),!1):H=h.createNipple(o,w)},B.prototype.processOnMove=function(w){var o=this,H=o.options,e=o.manager.getIdentifier(w),D=o.nipples.get(e),t=o.manager.scroll;if(function(w){return isNaN(w.buttons)?0!==w.pressure:0!==w.buttons}(w)){if(!D)return console.error("Found zombie joystick with ID "+e),void o.manager.removeIdentifier(e);if(H.dynamicPage){var X=D.el.getBoundingClientRect();D.position={x:t.x+X.left,y:t.y+X.top}}D.identifier=e;var L=D.options.size/2,A={x:w.pageX,y:w.pageY};H.lockX&&(A.y=D.position.y),H.lockY&&(A.x=D.position.x);var y,z,C,Q,M,i,s,V,r,k,P=h(A,D.position),l=(y=A,C=(z=D.position).x-y.x,Q=z.y-y.y,function(w){return w*(180/Math.PI)}(Math.atan2(Q,C))),O=E(l),T=P/L,S={distance:P,position:A};if("circle"===D.options.shape?(M=Math.min(P,L),s=D.position,V=M,k={x:0,y:0},r=E(r=l),k.x=s.x-V*Math.cos(r),k.y=s.y-V*Math.sin(r),i=k):(i=function(w,o,H){return{x:Math.min(Math.max(w.x,o.x-H),o.x+H),y:Math.min(Math.max(w.y,o.y-H),o.y+H)}}(A,D.position,L),M=h(i,D.position)),H.follow){if(P>L){var c=A.x-i.x,W=A.y-i.y;D.position.x+=c,D.position.y+=W,D.el.style.top=D.position.y-(o.box.top+t.y)+"px",D.el.style.left=D.position.x-(o.box.left+t.x)+"px",P=h(A,D.position)}}else A=i,P=M;var B=A.x-D.position.x,J=A.y-D.position.y;D.frontPosition={x:B,y:J},H.dataOnly||(D.ui.front.style.transform="translate("+B+"px,"+J+"px)");var g={identifier:D.identifier,position:A,force:T,pressure:w.force||w.pressure||w.webkitForce||0,distance:P,angle:{radian:O,degree:l},vector:{x:B/L,y:-J/L},raw:S,instance:D,lockX:H.lockX,lockY:H.lockY};(g=D.computeDirection(g)).angle={radian:E(180-l),degree:180-l},D.trigger("move",g),o.trigger("move "+D.id+":move",g)}else this.processOnEnd(w)},B.prototype.processOnEnd=function(w){var o=this,H=o.options,h=o.manager.getIdentifier(w),E=o.nipples.get(h),e=o.manager.removeIdentifier(E.identifier);E&&(H.dataOnly||E.hide((function(){"dynamic"===H.mode&&(E.trigger("removed",E),o.trigger("removed "+E.id+":removed",E),o.manager.trigger("removed "+E.id+":removed",E),E.destroy())})),clearInterval(o.pressureIntervals[E.identifier]),E.resetDirection(),E.trigger("end",E),o.trigger("end "+E.id+":end",E),o.ids.indexOf(E.identifier)>=0&&o.ids.splice(o.ids.indexOf(E.identifier),1),o.actives.indexOf(E)>=0&&o.actives.splice(o.actives.indexOf(E),1),/(semi|static)/.test(H.mode)?o.idles.push(E):o.nipples.indexOf(E)>=0&&o.nipples.splice(o.nipples.indexOf(E),1),o.manager.unbindDocument(),/(semi|static)/.test(H.mode)&&(o.manager.ids[e.id]=e.identifier))},B.prototype.onDestroyed=function(w,o){var H=this;H.nipples.indexOf(o)>=0&&H.nipples.splice(H.nipples.indexOf(o),1),H.actives.indexOf(o)>=0&&H.actives.splice(H.actives.indexOf(o),1),H.idles.indexOf(o)>=0&&H.idles.splice(H.idles.indexOf(o),1),H.ids.indexOf(o.identifier)>=0&&H.ids.splice(H.ids.indexOf(o.identifier),1),H.manager.removeIdentifier(o.identifier),H.manager.unbindDocument()},B.prototype.destroy=function(){var w=this;for(var o in w.unbindEvt(w.options.zone,"start"),w.nipples.forEach((function(w){w.destroy()})),w.pressureIntervals)w.pressureIntervals.hasOwnProperty(o)&&clearInterval(w.pressureIntervals[o]);w.trigger("destroyed",w.nipples),w.manager.unbindDocument(),w.off()};const J=B;function g(w){var o=this;o.ids={},o.index=0,o.collections=[],o.scroll=A(),o.config(w),o.prepareCollections();var H=function(){var w;o.collections.forEach((function(H){H.forEach((function(H){w=H.el.getBoundingClientRect(),H.position={x:o.scroll.x+w.left,y:o.scroll.y+w.top}}))}))};t(window,"resize",(function(){D(H)}));var h=function(){o.scroll=A()};return t(window,"scroll",(function(){D(h)})),o.collections}g.prototype=new S,g.constructor=g,g.prototype.prepareCollections=function(){var w=this;w.collections.create=w.create.bind(w),w.collections.on=w.on.bind(w),w.collections.off=w.off.bind(w),w.collections.destroy=w.destroy.bind(w),w.collections.get=function(o){var H;return w.collections.every((function(w){return!(H=w.get(o))})),H}},g.prototype.create=function(w){return this.createCollection(w)},g.prototype.createCollection=function(w){var o=this,H=new J(o,w);return o.bindCollection(H),o.collections.push(H),H},g.prototype.bindCollection=function(w){var o,H=this,h=function(w,h){o=w.type+" "+h.id+":"+w.type,H.trigger(o,h)};w.on("destroyed",H.onDestroyed.bind(H)),w.on("shown hidden rested dir plain",h),w.on("dir:up dir:right dir:down dir:left",h),w.on("plain:up plain:right plain:down plain:left",h)},g.prototype.bindDocument=function(){var w=this;w.binded||(w.bindEvt(document,"move").bindEvt(document,"end"),w.binded=!0)},g.prototype.unbindDocument=function(w){var o=this;Object.keys(o.ids).length&&!0!==w||(o.unbindEvt(document,"move").unbindEvt(document,"end"),o.binded=!1)},g.prototype.getIdentifier=function(w){var o;return w?void 0===(o=void 0===w.identifier?w.pointerId:w.identifier)&&(o=this.latest||0):o=this.index,void 0===this.ids[o]&&(this.ids[o]=this.index,this.index+=1),this.latest=o,this.ids[o]},g.prototype.removeIdentifier=function(w){var o={};for(var H in this.ids)if(this.ids[H]===w){o.id=H,o.identifier=this.ids[H],delete this.ids[H];break}return o},g.prototype.onmove=function(w){return this.onAny("move",w),!1},g.prototype.onend=function(w){return this.onAny("end",w),!1},g.prototype.oncancel=function(w){return this.onAny("end",w),!1},g.prototype.onAny=function(w,o){var H,h=this,E="processOn"+w.charAt(0).toUpperCase()+w.slice(1);o=L(o);var e=function(w,o,H){H.ids.indexOf(o)>=0&&(H[E](w),w._found_=!0)};return M(o,(function(w){H=h.getIdentifier(w),M(h.collections,e.bind(null,w,H)),w._found_||h.removeIdentifier(H)})),!1},g.prototype.destroy=function(){var w=this;w.unbindDocument(!0),w.ids={},w.index=0,w.collections.forEach((function(w){w.destroy()})),w.off()},g.prototype.onDestroyed=function(w,o){var H=this;if(H.collections.indexOf(o)<0)return!1;H.collections.splice(H.collections.indexOf(o),1)};var b=new g;const p={create:function(w){return b.create(w)},factory:b};return o.default})(),w.exports=o()},12836:(w,o,H)=>{"use strict";const{Deflate:h,deflate:E,deflateRaw:e,gzip:D}=H(12844),{Inflate:t,inflate:X,inflateRaw:L,ungzip:A}=H(12900),y=H(12875);w.exports.Deflate=h,w.exports.deflate=E,w.exports.deflateRaw=e,w.exports.gzip=D,w.exports.Inflate=t,w.exports.inflate=X,w.exports.inflateRaw=L,w.exports.ungzip=A,w.exports.constants=y},12844:(w,o,H)=>{"use strict";const h=H(12850),E=H(12882),e=H(12890),D=H(12869),t=H(12894),X=Object.prototype.toString,{Z_NO_FLUSH:L,Z_SYNC_FLUSH:A,Z_FULL_FLUSH:y,Z_FINISH:z,Z_OK:C,Z_STREAM_END:Q,Z_DEFAULT_COMPRESSION:M,Z_DEFAULT_STRATEGY:i,Z_DEFLATED:s}=H(12875);function V(w){this.options=E.assign({level:M,method:s,uw:16384,windowBits:15,memLevel:8,strategy:i},w||{});let o=this.options;o.raw&&o.windowBits>0?o.windowBits=-o.windowBits:o.gzip&&o.windowBits>0&&o.windowBits<16&&(o.windowBits+=16),this.err=0,this.yo="",this.ended=!1,this.chunks=[],this.strm=new t,this.strm.avail_out=0;let H=h.deflateInit2(this.strm,o.level,o.method,o.windowBits,o.memLevel,o.strategy);if(H!==C)throw new Error(D[H]);if(o.header&&h.deflateSetHeader(this.strm,o.header),o.dictionary){let w;if(w="string"===typeof o.dictionary?e.string2buf(o.dictionary):"[object ArrayBuffer]"===X.call(o.dictionary)?new Uint8Array(o.dictionary):o.dictionary,H=h.deflateSetDictionary(this.strm,w),H!==C)throw new Error(D[H]);this._dict_set=!0}}function r(w,o){const H=new V(o);if(H.push(w,!0),H.err)throw H.yo||D[H.err];return H.result}V.prototype.push=function(w,o){const H=this.strm,E=this.options.uw;let D,t;if(this.ended)return!1;for(t=o===~~o?o:!0===o?z:L,"string"===typeof w?H.input=e.string2buf(w):"[object ArrayBuffer]"===X.call(w)?H.input=new Uint8Array(w):H.input=w,H.next_in=0,H.avail_in=H.input.length;;)if(0===H.avail_out&&(H.output=new Uint8Array(E),H.next_out=0,H.avail_out=E),(t===A||t===y)&&H.avail_out<=6)this.onData(H.output.subarray(0,H.next_out)),H.avail_out=0;else{if(D=h.deflate(H,t),D===Q)return H.next_out>0&&this.onData(H.output.subarray(0,H.next_out)),D=h.deflateEnd(this.strm),this.onEnd(D),this.ended=!0,D===C;if(0!==H.avail_out){if(t>0&&H.next_out>0)this.onData(H.output.subarray(0,H.next_out)),H.avail_out=0;else if(0===H.avail_in)break}else this.onData(H.output)}return!0},V.prototype.onData=function(w){this.chunks.push(w)},V.prototype.onEnd=function(w){w===C&&(this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.yo=this.strm.yo},w.exports.Deflate=V,w.exports.deflate=r,w.exports.deflateRaw=function(w,o){return(o=o||{}).raw=!0,r(w,o)},w.exports.gzip=function(w,o){return(o=o||{}).gzip=!0,r(w,o)},w.exports.constants=H(12875)},12900:(w,o,H)=>{"use strict";const h=H(12907),E=H(12882),e=H(12890),D=H(12869),t=H(12894),X=H(12925),L=Object.prototype.toString,{Z_NO_FLUSH:A,Z_FINISH:y,Z_OK:z,Z_STREAM_END:C,Z_NEED_DICT:Q,Z_STREAM_ERROR:M,Z_DATA_ERROR:i,Z_MEM_ERROR:s}=H(12875);function V(w){this.options=E.assign({uw:65536,windowBits:15,to:""},w||{});const o=this.options;o.raw&&o.windowBits>=0&&o.windowBits<16&&(o.windowBits=-o.windowBits,0===o.windowBits&&(o.windowBits=-15)),!(o.windowBits>=0&&o.windowBits<16)||w&&w.windowBits||(o.windowBits+=32),o.windowBits>15&&o.windowBits<48&&0===(15&o.windowBits)&&(o.windowBits|=15),this.err=0,this.yo="",this.ended=!1,this.chunks=[],this.strm=new t,this.strm.avail_out=0;let H=h.inflateInit2(this.strm,o.windowBits);if(H!==z)throw new Error(D[H]);if(this.header=new X,h.inflateGetHeader(this.strm,this.header),o.dictionary&&("string"===typeof o.dictionary?o.dictionary=e.string2buf(o.dictionary):"[object ArrayBuffer]"===L.call(o.dictionary)&&(o.dictionary=new Uint8Array(o.dictionary)),o.raw&&(H=h.inflateSetDictionary(this.strm,o.dictionary),H!==z)))throw new Error(D[H])}function r(w,o){const H=new V(o);if(H.push(w),H.err)throw H.yo||D[H.err];return H.result}V.prototype.push=function(w,o){const H=this.strm,E=this.options.uw,D=this.options.dictionary;let t,X,V;if(this.ended)return!1;for(X=o===~~o?o:!0===o?y:A,"[object ArrayBuffer]"===L.call(w)?H.input=new Uint8Array(w):H.input=w,H.next_in=0,H.avail_in=H.input.length;;){for(0===H.avail_out&&(H.output=new Uint8Array(E),H.next_out=0,H.avail_out=E),t=h.inflate(H,X),t===Q&&D&&(t=h.inflateSetDictionary(H,D),t===z?t=h.inflate(H,X):t===i&&(t=Q));H.avail_in>0&&t===C&&H.state.wrap>0&&0!==w[H.next_in];)h.inflateReset(H),t=h.inflate(H,X);switch(t){case M:case i:case Q:case s:return this.onEnd(t),this.ended=!0,!1}if(V=H.avail_out,H.next_out&&(0===H.avail_out||t===C))if("string"===this.options.to){let w=e.utf8border(H.output,H.next_out),o=H.next_out-w,h=e.buf2string(H.output,w);H.next_out=o,H.avail_out=E-o,o&&H.output.set(H.output.subarray(w,w+o),0),this.onData(h)}else this.onData(H.output.length===H.next_out?H.output:H.output.subarray(0,H.next_out));if(t!==z||0!==V){if(t===C)return t=h.inflateEnd(this.strm),this.onEnd(t),this.ended=!0,!0;if(0===H.avail_in)break}}return!0},V.prototype.onData=function(w){this.chunks.push(w)},V.prototype.onEnd=function(w){w===z&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.yo=this.strm.yo},w.exports.Inflate=V,w.exports.inflate=r,w.exports.inflateRaw=function(w,o){return(o=o||{}).raw=!0,r(w,o)},w.exports.ungzip=r,w.exports.constants=H(12875)},12882:w=>{"use strict";const o=(w,o)=>Object.prototype.hasOwnProperty.call(w,o);w.exports.assign=function(w){const H=Array.prototype.slice.call(arguments,1);for(;H.length;){const h=H.shift();if(h){if("object"!==typeof h)throw new TypeError(h+"must be non-object");for(const H in h)o(h,H)&&(w[H]=h[H])}}return w},w.exports.flattenChunks=w=>{let o=0;for(let h=0,E=w.length;h<E;h++)o+=w[h].length;const H=new Uint8Array(o);for(let h=0,E=0,e=w.length;h<e;h++){let o=w[h];H.set(o,E),E+=o.length}return H}},12890:w=>{"use strict";let o=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){o=!1}const H=new Uint8Array(256);for(let E=0;E<256;E++)H[E]=E>=252?6:E>=248?5:E>=240?4:E>=224?3:E>=192?2:1;H[254]=H[254]=1,w.exports.string2buf=w=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(w);let o,H,h,E,e,D=w.length,t=0;for(E=0;E<D;E++)H=w.charCodeAt(E),55296===(64512&H)&&E+1<D&&(h=w.charCodeAt(E+1),56320===(64512&h)&&(H=65536+(H-55296<<10)+(h-56320),E++)),t+=H<128?1:H<2048?2:H<65536?3:4;for(o=new Uint8Array(t),e=0,E=0;e<t;E++)H=w.charCodeAt(E),55296===(64512&H)&&E+1<D&&(h=w.charCodeAt(E+1),56320===(64512&h)&&(H=65536+(H-55296<<10)+(h-56320),E++)),H<128?o[e++]=H:H<2048?(o[e++]=192|H>>>6,o[e++]=128|63&H):H<65536?(o[e++]=224|H>>>12,o[e++]=128|H>>>6&63,o[e++]=128|63&H):(o[e++]=240|H>>>18,o[e++]=128|H>>>12&63,o[e++]=128|H>>>6&63,o[e++]=128|63&H);return o};w.exports.buf2string=(w,h)=>{const E=h||w.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(w.subarray(0,h));let e,D;const t=new Array(2*E);for(D=0,e=0;e<E;){let o=w[e++];if(o<128){t[D++]=o;continue}let h=H[o];if(h>4)t[D++]=65533,e+=h-1;else{for(o&=2===h?31:3===h?15:7;h>1&&e<E;)o=o<<6|63&w[e++],h--;h>1?t[D++]=65533:o<65536?t[D++]=o:(o-=65536,t[D++]=55296|o>>10&1023,t[D++]=56320|1023&o)}}return((w,H)=>{if(H<65534&&w.subarray&&o)return String.fromCharCode.apply(null,w.length===H?w:w.subarray(0,H));let h="";for(let o=0;o<H;o++)h+=String.fromCharCode(w[o]);return h})(t,D)},w.exports.utf8border=(w,o)=>{(o=o||w.length)>w.length&&(o=w.length);let h=o-1;for(;h>=0&&128===(192&w[h]);)h--;return h<0||0===h?o:h+H[w[h]]>o?h:o}},12861:w=>{"use strict";w.exports=(w,o,H,h)=>{let E=65535&w,e=w>>>16&65535,D=0;for(;0!==H;){D=H>2e3?2e3:H,H-=D;do{E=E+o[h++]|0,e=e+E|0}while(--D);E%=65521,e%=65521}return E|e<<16}},12875:w=>{"use strict";w.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12865:w=>{"use strict";const o=new Uint32Array((()=>{let w,o=[];for(var H=0;H<256;H++){w=H;for(var h=0;h<8;h++)w=1&w?3988292384^w>>>1:w>>>1;o[H]=w}return o})());w.exports=(w,H,h,E)=>{const e=o,D=E+h;w^=-1;for(let o=E;o<D;o++)w=w>>>8^e[255&(w^H[o])];return~w}},12850:(w,o,H)=>{"use strict";const{_tr_init:h,_tr_stored_block:E,_tr_flush_block:e,_tr_tally:D,_tr_align:t}=H(12856),X=H(12861),L=H(12865),A=H(12869),{Z_NO_FLUSH:y,Z_PARTIAL_FLUSH:z,Z_FULL_FLUSH:C,Z_FINISH:Q,Z_BLOCK:M,Z_OK:i,Z_STREAM_END:s,Z_STREAM_ERROR:V,Z_DATA_ERROR:r,Z_BUF_ERROR:k,Z_DEFAULT_COMPRESSION:P,Z_FILTERED:l,Z_HUFFMAN_ONLY:O,Z_RLE:T,Z_FIXED:S,Z_DEFAULT_STRATEGY:c,Z_UNKNOWN:W,Z_DEFLATED:B}=H(12875),J=258,g=262,b=103,p=113,f=666,N=(w,o)=>(w.yo=A[o],o),j=w=>(w<<1)-(w>4?9:0),q=w=>{let o=w.length;for(;--o>=0;)w[o]=0};let u=(w,o,H)=>(o<<w.hash_shift^H)&w.hash_mask;const n=w=>{const o=w.state;let H=o.pending;H>w.avail_out&&(H=w.avail_out),0!==H&&(w.output.set(o.pending_buf.subarray(o.pending_out,o.pending_out+H),w.next_out),w.next_out+=H,o.pending_out+=H,w.total_out+=H,w.avail_out-=H,o.pending-=H,0===o.pending&&(o.pending_out=0))},G=(w,o)=>{e(w,w.block_start>=0?w.block_start:-1,w.strstart-w.block_start,o),w.block_start=w.strstart,n(w.strm)},R=(w,o)=>{w.pending_buf[w.pending++]=o},a=(w,o)=>{w.pending_buf[w.pending++]=o>>>8&255,w.pending_buf[w.pending++]=255&o},d=(w,o,H,h)=>{let E=w.avail_in;return E>h&&(E=h),0===E?0:(w.avail_in-=E,o.set(w.input.subarray(w.next_in,w.next_in+E),H),1===w.state.wrap?w.adler=X(w.adler,o,E,H):2===w.state.wrap&&(w.adler=L(w.adler,o,E,H)),w.next_in+=E,w.total_in+=E,E)},I=(w,o)=>{let H,h,E=w.max_chain_length,e=w.strstart,D=w.prev_length,t=w.nice_match;const X=w.strstart>w.w_size-g?w.strstart-(w.w_size-g):0,L=w.window,A=w.w_mask,y=w.prev,z=w.strstart+J;let C=L[e+D-1],Q=L[e+D];w.prev_length>=w.good_match&&(E>>=2),t>w.lookahead&&(t=w.lookahead);do{if(H=o,L[H+D]===Q&&L[H+D-1]===C&&L[H]===L[e]&&L[++H]===L[e+1]){e+=2,H++;do{}while(L[++e]===L[++H]&&L[++e]===L[++H]&&L[++e]===L[++H]&&L[++e]===L[++H]&&L[++e]===L[++H]&&L[++e]===L[++H]&&L[++e]===L[++H]&&L[++e]===L[++H]&&e<z);if(h=J-(z-e),e=z-J,h>D){if(w.match_start=o,D=h,h>=t)break;C=L[e+D-1],Q=L[e+D]}}}while((o=y[o&A])>X&&0!==--E);return D<=w.lookahead?D:w.lookahead},U=w=>{const o=w.w_size;let H,h,E,e,D;do{if(e=w.window_size-w.lookahead-w.strstart,w.strstart>=o+(o-g)){w.window.set(w.window.subarray(o,o+o),0),w.match_start-=o,w.strstart-=o,w.block_start-=o,h=w.hash_size,H=h;do{E=w.head[--H],w.head[H]=E>=o?E-o:0}while(--h);h=o,H=h;do{E=w.prev[--H],w.prev[H]=E>=o?E-o:0}while(--h);e+=o}if(0===w.strm.avail_in)break;if(h=d(w.strm,w.window,w.strstart+w.lookahead,e),w.lookahead+=h,w.lookahead+w.insert>=3)for(D=w.strstart-w.insert,w.ins_h=w.window[D],w.ins_h=u(w,w.ins_h,w.window[D+1]);w.insert&&(w.ins_h=u(w,w.ins_h,w.window[D+3-1]),w.prev[D&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=D,D++,w.insert--,!(w.lookahead+w.insert<3)););}while(w.lookahead<g&&0!==w.strm.avail_in)},Z=(w,o)=>{let H,h;for(;;){if(w.lookahead<g){if(U(w),w.lookahead<g&&o===y)return 1;if(0===w.lookahead)break}if(H=0,w.lookahead>=3&&(w.ins_h=u(w,w.ins_h,w.window[w.strstart+3-1]),H=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),0!==H&&w.strstart-H<=w.w_size-g&&(w.match_length=I(w,H)),w.match_length>=3)if(h=D(w,w.strstart-w.match_start,w.match_length-3),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=3){w.match_length--;do{w.strstart++,w.ins_h=u(w,w.ins_h,w.window[w.strstart+3-1]),H=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart}while(0!==--w.match_length);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=u(w,w.ins_h,w.window[w.strstart+1]);else h=D(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(h&&(G(w,!1),0===w.strm.avail_out))return 1}return w.insert=w.strstart<2?w.strstart:2,o===Q?(G(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(G(w,!1),0===w.strm.avail_out)?1:2},K=(w,o)=>{let H,h,E;for(;;){if(w.lookahead<g){if(U(w),w.lookahead<g&&o===y)return 1;if(0===w.lookahead)break}if(H=0,w.lookahead>=3&&(w.ins_h=u(w,w.ins_h,w.window[w.strstart+3-1]),H=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=2,0!==H&&w.prev_length<w.max_lazy_match&&w.strstart-H<=w.w_size-g&&(w.match_length=I(w,H),w.match_length<=5&&(w.strategy===l||3===w.match_length&&w.strstart-w.match_start>4096)&&(w.match_length=2)),w.prev_length>=3&&w.match_length<=w.prev_length){E=w.strstart+w.lookahead-3,h=D(w,w.strstart-1-w.prev_match,w.prev_length-3),w.lookahead-=w.prev_length-1,w.prev_length-=2;do{++w.strstart<=E&&(w.ins_h=u(w,w.ins_h,w.window[w.strstart+3-1]),H=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart)}while(0!==--w.prev_length);if(w.match_available=0,w.match_length=2,w.strstart++,h&&(G(w,!1),0===w.strm.avail_out))return 1}else if(w.match_available){if(h=D(w,0,w.window[w.strstart-1]),h&&G(w,!1),w.strstart++,w.lookahead--,0===w.strm.avail_out)return 1}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(h=D(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<2?w.strstart:2,o===Q?(G(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(G(w,!1),0===w.strm.avail_out)?1:2};function F(w,o,H,h,E){this.good_length=w,this.max_lazy=o,this.nice_length=H,this.max_chain=h,this.func=E}const v=[new F(0,0,0,0,((w,o)=>{let H=65535;for(H>w.pending_buf_size-5&&(H=w.pending_buf_size-5);;){if(w.lookahead<=1){if(U(w),0===w.lookahead&&o===y)return 1;if(0===w.lookahead)break}w.strstart+=w.lookahead,w.lookahead=0;const h=w.block_start+H;if((0===w.strstart||w.strstart>=h)&&(w.lookahead=w.strstart-h,w.strstart=h,G(w,!1),0===w.strm.avail_out))return 1;if(w.strstart-w.block_start>=w.w_size-g&&(G(w,!1),0===w.strm.avail_out))return 1}return w.insert=0,o===Q?(G(w,!0),0===w.strm.avail_out?3:4):(w.strstart>w.block_start&&(G(w,!1),w.strm.avail_out),1)})),new F(4,4,8,4,Z),new F(4,5,16,8,Z),new F(4,6,32,32,Z),new F(4,4,16,16,K),new F(8,16,32,32,K),new F(8,16,128,128,K),new F(8,32,128,256,K),new F(32,128,258,1024,K),new F(32,258,258,4096,K)];function mw(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=B,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),q(this.dyn_ltree),q(this.dyn_dtree),q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Y=w=>{if(!w||!w.state)return N(w,V);w.total_in=w.total_out=0,w.data_type=W;const o=w.state;return o.pending=0,o.pending_out=0,o.wrap<0&&(o.wrap=-o.wrap),o.status=o.wrap?42:p,w.adler=2===o.wrap?0:1,o.last_flush=y,h(o),i},x=w=>{const o=Y(w);var H;return o===i&&((H=w.state).window_size=2*H.w_size,q(H.head),H.max_lazy_match=v[H.level].max_lazy,H.good_match=v[H.level].good_length,H.nice_match=v[H.level].nice_length,H.max_chain_length=v[H.level].max_chain,H.strstart=0,H.block_start=0,H.lookahead=0,H.insert=0,H.match_length=H.prev_length=2,H.match_available=0,H.ins_h=0),o},ww=(w,o,H,h,E,e)=>{if(!w)return V;let D=1;if(o===P&&(o=6),h<0?(D=0,h=-h):h>15&&(D=2,h-=16),E<1||E>9||H!==B||h<8||h>15||o<0||o>9||e<0||e>S)return N(w,V);8===h&&(h=9);const t=new mw;return w.state=t,t.strm=w,t.wrap=D,t.gzhead=null,t.w_bits=h,t.w_size=1<<t.w_bits,t.w_mask=t.w_size-1,t.hash_bits=E+7,t.hash_size=1<<t.hash_bits,t.hash_mask=t.hash_size-1,t.hash_shift=~~((t.hash_bits+3-1)/3),t.window=new Uint8Array(2*t.w_size),t.head=new Uint16Array(t.hash_size),t.prev=new Uint16Array(t.w_size),t.lit_bufsize=1<<E+6,t.pending_buf_size=4*t.lit_bufsize,t.pending_buf=new Uint8Array(t.pending_buf_size),t.d_buf=1*t.lit_bufsize,t.l_buf=3*t.lit_bufsize,t.level=o,t.strategy=e,t.method=H,x(w)};w.exports.deflateInit=(w,o)=>ww(w,o,B,15,8,c),w.exports.deflateInit2=ww,w.exports.deflateReset=x,w.exports.deflateResetKeep=Y,w.exports.deflateSetHeader=(w,o)=>w&&w.state?2!==w.state.wrap?V:(w.state.gzhead=o,i):V,w.exports.deflate=(w,o)=>{let H,h;if(!w||!w.state||o>M||o<0)return w?N(w,V):V;const e=w.state;if(!w.output||!w.input&&0!==w.avail_in||e.status===f&&o!==Q)return N(w,0===w.avail_out?k:V);e.strm=w;const X=e.last_flush;if(e.last_flush=o,42===e.status)if(2===e.wrap)w.adler=0,R(e,31),R(e,139),R(e,8),e.gzhead?(R(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),R(e,255&e.gzhead.time),R(e,e.gzhead.time>>8&255),R(e,e.gzhead.time>>16&255),R(e,e.gzhead.time>>24&255),R(e,9===e.level?2:e.strategy>=O||e.level<2?4:0),R(e,255&e.gzhead.os),e.gzhead.extra&&e.gzhead.extra.length&&(R(e,255&e.gzhead.extra.length),R(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(w.adler=L(w.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=69):(R(e,0),R(e,0),R(e,0),R(e,0),R(e,0),R(e,9===e.level?2:e.strategy>=O||e.level<2?4:0),R(e,3),e.status=p);else{let o=B+(e.w_bits-8<<4)<<8,H=-1;H=e.strategy>=O||e.level<2?0:e.level<6?1:6===e.level?2:3,o|=H<<6,0!==e.strstart&&(o|=32),o+=31-o%31,e.status=p,a(e,o),0!==e.strstart&&(a(e,w.adler>>>16),a(e,65535&w.adler)),w.adler=1}if(69===e.status)if(e.gzhead.extra){for(H=e.pending;e.gzindex<(65535&e.gzhead.extra.length)&&(e.pending!==e.pending_buf_size||(e.gzhead.hcrc&&e.pending>H&&(w.adler=L(w.adler,e.pending_buf,e.pending-H,H)),n(w),H=e.pending,e.pending!==e.pending_buf_size));)R(e,255&e.gzhead.extra[e.gzindex]),e.gzindex++;e.gzhead.hcrc&&e.pending>H&&(w.adler=L(w.adler,e.pending_buf,e.pending-H,H)),e.gzindex===e.gzhead.extra.length&&(e.gzindex=0,e.status=73)}else e.status=73;if(73===e.status)if(e.gzhead.name){H=e.pending;do{if(e.pending===e.pending_buf_size&&(e.gzhead.hcrc&&e.pending>H&&(w.adler=L(w.adler,e.pending_buf,e.pending-H,H)),n(w),H=e.pending,e.pending===e.pending_buf_size)){h=1;break}h=e.gzindex<e.gzhead.name.length?255&e.gzhead.name.charCodeAt(e.gzindex++):0,R(e,h)}while(0!==h);e.gzhead.hcrc&&e.pending>H&&(w.adler=L(w.adler,e.pending_buf,e.pending-H,H)),0===h&&(e.gzindex=0,e.status=91)}else e.status=91;if(91===e.status)if(e.gzhead.comment){H=e.pending;do{if(e.pending===e.pending_buf_size&&(e.gzhead.hcrc&&e.pending>H&&(w.adler=L(w.adler,e.pending_buf,e.pending-H,H)),n(w),H=e.pending,e.pending===e.pending_buf_size)){h=1;break}h=e.gzindex<e.gzhead.comment.length?255&e.gzhead.comment.charCodeAt(e.gzindex++):0,R(e,h)}while(0!==h);e.gzhead.hcrc&&e.pending>H&&(w.adler=L(w.adler,e.pending_buf,e.pending-H,H)),0===h&&(e.status=b)}else e.status=b;if(e.status===b&&(e.gzhead.hcrc?(e.pending+2>e.pending_buf_size&&n(w),e.pending+2<=e.pending_buf_size&&(R(e,255&w.adler),R(e,w.adler>>8&255),w.adler=0,e.status=p)):e.status=p),0!==e.pending){if(n(w),0===w.avail_out)return e.last_flush=-1,i}else if(0===w.avail_in&&j(o)<=j(X)&&o!==Q)return N(w,k);if(e.status===f&&0!==w.avail_in)return N(w,k);if(0!==w.avail_in||0!==e.lookahead||o!==y&&e.status!==f){let H=e.strategy===O?((w,o)=>{let H;for(;;){if(0===w.lookahead&&(U(w),0===w.lookahead)){if(o===y)return 1;break}if(w.match_length=0,H=D(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++,H&&(G(w,!1),0===w.strm.avail_out))return 1}return w.insert=0,o===Q?(G(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(G(w,!1),0===w.strm.avail_out)?1:2})(e,o):e.strategy===T?((w,o)=>{let H,h,E,e;const t=w.window;for(;;){if(w.lookahead<=J){if(U(w),w.lookahead<=J&&o===y)return 1;if(0===w.lookahead)break}if(w.match_length=0,w.lookahead>=3&&w.strstart>0&&(E=w.strstart-1,h=t[E],h===t[++E]&&h===t[++E]&&h===t[++E])){e=w.strstart+J;do{}while(h===t[++E]&&h===t[++E]&&h===t[++E]&&h===t[++E]&&h===t[++E]&&h===t[++E]&&h===t[++E]&&h===t[++E]&&E<e);w.match_length=J-(e-E),w.match_length>w.lookahead&&(w.match_length=w.lookahead)}if(w.match_length>=3?(H=D(w,1,w.match_length-3),w.lookahead-=w.match_length,w.strstart+=w.match_length,w.match_length=0):(H=D(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++),H&&(G(w,!1),0===w.strm.avail_out))return 1}return w.insert=0,o===Q?(G(w,!0),0===w.strm.avail_out?3:4):w.last_lit&&(G(w,!1),0===w.strm.avail_out)?1:2})(e,o):v[e.level].func(e,o);if(3!==H&&4!==H||(e.status=f),1===H||3===H)return 0===w.avail_out&&(e.last_flush=-1),i;if(2===H&&(o===z?t(e):o!==M&&(E(e,0,0,!1),o===C&&(q(e.head),0===e.lookahead&&(e.strstart=0,e.block_start=0,e.insert=0))),n(w),0===w.avail_out))return e.last_flush=-1,i}return o!==Q?i:e.wrap<=0?s:(2===e.wrap?(R(e,255&w.adler),R(e,w.adler>>8&255),R(e,w.adler>>16&255),R(e,w.adler>>24&255),R(e,255&w.total_in),R(e,w.total_in>>8&255),R(e,w.total_in>>16&255),R(e,w.total_in>>24&255)):(a(e,w.adler>>>16),a(e,65535&w.adler)),n(w),e.wrap>0&&(e.wrap=-e.wrap),0!==e.pending?i:s)},w.exports.deflateEnd=w=>{if(!w||!w.state)return V;const o=w.state.status;return 42!==o&&69!==o&&73!==o&&91!==o&&o!==b&&o!==p&&o!==f?N(w,V):(w.state=null,o===p?N(w,r):i)},w.exports.deflateSetDictionary=(w,o)=>{let H=o.length;if(!w||!w.state)return V;const h=w.state,E=h.wrap;if(2===E||1===E&&42!==h.status||h.lookahead)return V;if(1===E&&(w.adler=X(w.adler,o,H,0)),h.wrap=0,H>=h.w_size){0===E&&(q(h.head),h.strstart=0,h.block_start=0,h.insert=0);let w=new Uint8Array(h.w_size);w.set(o.subarray(H-h.w_size,H),0),o=w,H=h.w_size}const e=w.avail_in,D=w.next_in,t=w.input;for(w.avail_in=H,w.next_in=0,w.input=o,U(h);h.lookahead>=3;){let w=h.strstart,o=h.lookahead-2;do{h.ins_h=u(h,h.ins_h,h.window[w+3-1]),h.prev[w&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=w,w++}while(--o);h.strstart=w,h.lookahead=2,U(h)}return h.strstart+=h.lookahead,h.block_start=h.strstart,h.insert=h.lookahead,h.lookahead=0,h.match_length=h.prev_length=2,h.match_available=0,w.next_in=D,w.input=t,w.avail_in=e,h.wrap=E,i},w.exports.deflateInfo="pako deflate (from Nodeca project)"},12925:w=>{"use strict";w.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12909:w=>{"use strict";w.exports=function(w,o){let H,h,E,e,D,t,X,L,A,y,z,C,Q,M,i,s,V,r,k,P,l,O,T,S;const c=w.state;H=w.next_in,T=w.input,h=H+(w.avail_in-5),E=w.next_out,S=w.output,e=E-(o-w.avail_out),D=E+(w.avail_out-257),t=c.dmax,X=c.wsize,L=c.whave,A=c.wnext,y=c.window,z=c.hold,C=c.bits,Q=c.lencode,M=c.distcode,i=(1<<c.lenbits)-1,s=(1<<c.distbits)-1;w:do{C<15&&(z+=T[H++]<<C,C+=8,z+=T[H++]<<C,C+=8),V=Q[z&i];o:for(;;){if(r=V>>>24,z>>>=r,C-=r,r=V>>>16&255,0===r)S[E++]=65535&V;else{if(!(16&r)){if(0===(64&r)){V=Q[(65535&V)+(z&(1<<r)-1)];continue o}if(32&r){c.mode=12;break w}w.yo="invalid literal/length code",c.mode=30;break w}k=65535&V,r&=15,r&&(C<r&&(z+=T[H++]<<C,C+=8),k+=z&(1<<r)-1,z>>>=r,C-=r),C<15&&(z+=T[H++]<<C,C+=8,z+=T[H++]<<C,C+=8),V=M[z&s];H:for(;;){if(r=V>>>24,z>>>=r,C-=r,r=V>>>16&255,!(16&r)){if(0===(64&r)){V=M[(65535&V)+(z&(1<<r)-1)];continue H}w.yo="invalid distance code",c.mode=30;break w}if(P=65535&V,r&=15,C<r&&(z+=T[H++]<<C,C+=8,C<r&&(z+=T[H++]<<C,C+=8)),P+=z&(1<<r)-1,P>t){w.yo="invalid distance too far back",c.mode=30;break w}if(z>>>=r,C-=r,r=E-e,P>r){if(r=P-r,r>L&&c.sane){w.yo="invalid distance too far back",c.mode=30;break w}if(l=0,O=y,0===A){if(l+=X-r,r<k){k-=r;do{S[E++]=y[l++]}while(--r);l=E-P,O=S}}else if(A<r){if(l+=X+A-r,r-=A,r<k){k-=r;do{S[E++]=y[l++]}while(--r);if(l=0,A<k){r=A,k-=r;do{S[E++]=y[l++]}while(--r);l=E-P,O=S}}}else if(l+=A-r,r<k){k-=r;do{S[E++]=y[l++]}while(--r);l=E-P,O=S}for(;k>2;)S[E++]=O[l++],S[E++]=O[l++],S[E++]=O[l++],k-=3;k&&(S[E++]=O[l++],k>1&&(S[E++]=O[l++]))}else{l=E-P;do{S[E++]=S[l++],S[E++]=S[l++],S[E++]=S[l++],k-=3}while(k>2);k&&(S[E++]=S[l++],k>1&&(S[E++]=S[l++]))}break}}break}}while(H<h&&E<D);k=C>>3,H-=k,C-=k<<3,z&=(1<<C)-1,w.next_in=H,w.next_out=E,w.avail_in=H<h?h-H+5:5-(H-h),w.avail_out=E<D?D-E+257:257-(E-D),c.hold=z,c.bits=C}},12907:(w,o,H)=>{"use strict";const h=H(12861),E=H(12865),e=H(12909),D=H(12918),{Z_FINISH:t,Z_BLOCK:X,Z_TREES:L,Z_OK:A,Z_STREAM_END:y,Z_NEED_DICT:z,Z_STREAM_ERROR:C,Z_DATA_ERROR:Q,Z_MEM_ERROR:M,Z_BUF_ERROR:i,Z_DEFLATED:s}=H(12875),V=12,r=30,k=w=>(w>>>24&255)+(w>>>8&65280)+((65280&w)<<8)+((255&w)<<24);function P(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const l=w=>{if(!w||!w.state)return C;const o=w.state;return w.total_in=w.total_out=o.total=0,w.yo="",o.wrap&&(w.adler=1&o.wrap),o.mode=1,o.last=0,o.havedict=0,o.dmax=32768,o.head=null,o.hold=0,o.bits=0,o.lencode=o.lendyn=new Int32Array(852),o.distcode=o.distdyn=new Int32Array(592),o.sane=1,o.back=-1,A},O=w=>{if(!w||!w.state)return C;const o=w.state;return o.wsize=0,o.whave=0,o.wnext=0,l(w)},T=(w,o)=>{let H;if(!w||!w.state)return C;const h=w.state;return o<0?(H=0,o=-o):(H=1+(o>>4),o<48&&(o&=15)),o&&(o<8||o>15)?C:(null!==h.window&&h.wbits!==o&&(h.window=null),h.wrap=H,h.wbits=o,O(w))},S=(w,o)=>{if(!w)return C;const H=new P;w.state=H,H.window=null;const h=T(w,o);return h!==A&&(w.state=null),h};let c,W,B=!0;const J=w=>{if(B){c=new Int32Array(512),W=new Int32Array(32);let o=0;for(;o<144;)w.lens[o++]=8;for(;o<256;)w.lens[o++]=9;for(;o<280;)w.lens[o++]=7;for(;o<288;)w.lens[o++]=8;for(D(1,w.lens,0,288,c,0,w.work,{bits:9}),o=0;o<32;)w.lens[o++]=5;D(2,w.lens,0,32,W,0,w.work,{bits:5}),B=!1}w.lencode=c,w.lenbits=9,w.distcode=W,w.distbits=5},g=(w,o,H,h)=>{let E;const e=w.state;return null===e.window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new Uint8Array(e.wsize)),h>=e.wsize?(e.window.set(o.subarray(H-e.wsize,H),0),e.wnext=0,e.whave=e.wsize):(E=e.wsize-e.wnext,E>h&&(E=h),e.window.set(o.subarray(H-h,H-h+E),e.wnext),(h-=E)?(e.window.set(o.subarray(H-h,H),0),e.wnext=h,e.whave=e.wsize):(e.wnext+=E,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=E))),0};w.exports.inflateReset=O,w.exports.inflateReset2=T,w.exports.inflateResetKeep=l,w.exports.inflateInit=w=>S(w,15),w.exports.inflateInit2=S,w.exports.inflate=(w,o)=>{let H,P,l,O,T,S,c,W,B,b,p,f,N,j,q,u,n,G,R,a,d,I,U=0;const Z=new Uint8Array(4);let K,F;const v=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!w||!w.state||!w.output||!w.input&&0!==w.avail_in)return C;H=w.state,H.mode===V&&(H.mode=13),T=w.next_out,l=w.output,c=w.avail_out,O=w.next_in,P=w.input,S=w.avail_in,W=H.hold,B=H.bits,b=S,p=c,I=A;w:for(;;)switch(H.mode){case 1:if(0===H.wrap){H.mode=13;break}for(;B<16;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}if(2&H.wrap&&35615===W){H.check=0,Z[0]=255&W,Z[1]=W>>>8&255,H.check=E(H.check,Z,2,0),W=0,B=0,H.mode=2;break}if(H.flags=0,H.head&&(H.head.done=!1),!(1&H.wrap)||(((255&W)<<8)+(W>>8))%31){w.yo="incorrect header check",H.mode=r;break}if((15&W)!==s){w.yo="unknown compression method",H.mode=r;break}if(W>>>=4,B-=4,d=8+(15&W),0===H.wbits)H.wbits=d;else if(d>H.wbits){w.yo="invalid window size",H.mode=r;break}H.dmax=1<<H.wbits,w.adler=H.check=1,H.mode=512&W?10:V,W=0,B=0;break;case 2:for(;B<16;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}if(H.flags=W,(255&H.flags)!==s){w.yo="unknown compression method",H.mode=r;break}if(57344&H.flags){w.yo="unknown header flags set",H.mode=r;break}H.head&&(H.head.text=W>>8&1),512&H.flags&&(Z[0]=255&W,Z[1]=W>>>8&255,H.check=E(H.check,Z,2,0)),W=0,B=0,H.mode=3;case 3:for(;B<32;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}H.head&&(H.head.time=W),512&H.flags&&(Z[0]=255&W,Z[1]=W>>>8&255,Z[2]=W>>>16&255,Z[3]=W>>>24&255,H.check=E(H.check,Z,4,0)),W=0,B=0,H.mode=4;case 4:for(;B<16;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}H.head&&(H.head.xflags=255&W,H.head.os=W>>8),512&H.flags&&(Z[0]=255&W,Z[1]=W>>>8&255,H.check=E(H.check,Z,2,0)),W=0,B=0,H.mode=5;case 5:if(1024&H.flags){for(;B<16;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}H.length=W,H.head&&(H.head.extra_len=W),512&H.flags&&(Z[0]=255&W,Z[1]=W>>>8&255,H.check=E(H.check,Z,2,0)),W=0,B=0}else H.head&&(H.head.extra=null);H.mode=6;case 6:if(1024&H.flags&&(f=H.length,f>S&&(f=S),f&&(H.head&&(d=H.head.extra_len-H.length,H.head.extra||(H.head.extra=new Uint8Array(H.head.extra_len)),H.head.extra.set(P.subarray(O,O+f),d)),512&H.flags&&(H.check=E(H.check,P,f,O)),S-=f,O+=f,H.length-=f),H.length))break w;H.length=0,H.mode=7;case 7:if(2048&H.flags){if(0===S)break w;f=0;do{d=P[O+f++],H.head&&d&&H.length<65536&&(H.head.name+=String.fromCharCode(d))}while(d&&f<S);if(512&H.flags&&(H.check=E(H.check,P,f,O)),S-=f,O+=f,d)break w}else H.head&&(H.head.name=null);H.length=0,H.mode=8;case 8:if(4096&H.flags){if(0===S)break w;f=0;do{d=P[O+f++],H.head&&d&&H.length<65536&&(H.head.comment+=String.fromCharCode(d))}while(d&&f<S);if(512&H.flags&&(H.check=E(H.check,P,f,O)),S-=f,O+=f,d)break w}else H.head&&(H.head.comment=null);H.mode=9;case 9:if(512&H.flags){for(;B<16;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}if(W!==(65535&H.check)){w.yo="header crc mismatch",H.mode=r;break}W=0,B=0}H.head&&(H.head.hcrc=H.flags>>9&1,H.head.done=!0),w.adler=H.check=0,H.mode=V;break;case 10:for(;B<32;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}w.adler=H.check=k(W),W=0,B=0,H.mode=11;case 11:if(0===H.havedict)return w.next_out=T,w.avail_out=c,w.next_in=O,w.avail_in=S,H.hold=W,H.bits=B,z;w.adler=H.check=1,H.mode=V;case V:if(o===X||o===L)break w;case 13:if(H.last){W>>>=7&B,B-=7&B,H.mode=27;break}for(;B<3;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}switch(H.last=1&W,W>>>=1,B-=1,3&W){case 0:H.mode=14;break;case 1:if(J(H),H.mode=20,o===L){W>>>=2,B-=2;break w}break;case 2:H.mode=17;break;case 3:w.yo="invalid block type",H.mode=r}W>>>=2,B-=2;break;case 14:for(W>>>=7&B,B-=7&B;B<32;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}if((65535&W)!==(W>>>16^65535)){w.yo="invalid stored block lengths",H.mode=r;break}if(H.length=65535&W,W=0,B=0,H.mode=15,o===L)break w;case 15:H.mode=16;case 16:if(f=H.length,f){if(f>S&&(f=S),f>c&&(f=c),0===f)break w;l.set(P.subarray(O,O+f),T),S-=f,O+=f,c-=f,T+=f,H.length-=f;break}H.mode=V;break;case 17:for(;B<14;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}if(H.nlen=257+(31&W),W>>>=5,B-=5,H.ndist=1+(31&W),W>>>=5,B-=5,H.ncode=4+(15&W),W>>>=4,B-=4,H.nlen>286||H.ndist>30){w.yo="too many length or distance symbols",H.mode=r;break}H.have=0,H.mode=18;case 18:for(;H.have<H.ncode;){for(;B<3;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}H.lens[v[H.have++]]=7&W,W>>>=3,B-=3}for(;H.have<19;)H.lens[v[H.have++]]=0;if(H.lencode=H.lendyn,H.lenbits=7,K={bits:H.lenbits},I=D(0,H.lens,0,19,H.lencode,0,H.work,K),H.lenbits=K.bits,I){w.yo="invalid code lengths set",H.mode=r;break}H.have=0,H.mode=19;case 19:for(;H.have<H.nlen+H.ndist;){for(;U=H.lencode[W&(1<<H.lenbits)-1],q=U>>>24,u=U>>>16&255,n=65535&U,!(q<=B);){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}if(n<16)W>>>=q,B-=q,H.lens[H.have++]=n;else{if(16===n){for(F=q+2;B<F;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}if(W>>>=q,B-=q,0===H.have){w.yo="invalid bit length repeat",H.mode=r;break}d=H.lens[H.have-1],f=3+(3&W),W>>>=2,B-=2}else if(17===n){for(F=q+3;B<F;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}W>>>=q,B-=q,d=0,f=3+(7&W),W>>>=3,B-=3}else{for(F=q+7;B<F;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}W>>>=q,B-=q,d=0,f=11+(127&W),W>>>=7,B-=7}if(H.have+f>H.nlen+H.ndist){w.yo="invalid bit length repeat",H.mode=r;break}for(;f--;)H.lens[H.have++]=d}}if(H.mode===r)break;if(0===H.lens[256]){w.yo="invalid code -- missing end-of-block",H.mode=r;break}if(H.lenbits=9,K={bits:H.lenbits},I=D(1,H.lens,0,H.nlen,H.lencode,0,H.work,K),H.lenbits=K.bits,I){w.yo="invalid literal/lengths set",H.mode=r;break}if(H.distbits=6,H.distcode=H.distdyn,K={bits:H.distbits},I=D(2,H.lens,H.nlen,H.ndist,H.distcode,0,H.work,K),H.distbits=K.bits,I){w.yo="invalid distances set",H.mode=r;break}if(H.mode=20,o===L)break w;case 20:H.mode=21;case 21:if(S>=6&&c>=258){w.next_out=T,w.avail_out=c,w.next_in=O,w.avail_in=S,H.hold=W,H.bits=B,e(w,p),T=w.next_out,l=w.output,c=w.avail_out,O=w.next_in,P=w.input,S=w.avail_in,W=H.hold,B=H.bits,H.mode===V&&(H.back=-1);break}for(H.back=0;U=H.lencode[W&(1<<H.lenbits)-1],q=U>>>24,u=U>>>16&255,n=65535&U,!(q<=B);){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}if(u&&0===(240&u)){for(G=q,R=u,a=n;U=H.lencode[a+((W&(1<<G+R)-1)>>G)],q=U>>>24,u=U>>>16&255,n=65535&U,!(G+q<=B);){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}W>>>=G,B-=G,H.back+=G}if(W>>>=q,B-=q,H.back+=q,H.length=n,0===u){H.mode=26;break}if(32&u){H.back=-1,H.mode=V;break}if(64&u){w.yo="invalid literal/length code",H.mode=r;break}H.extra=15&u,H.mode=22;case 22:if(H.extra){for(F=H.extra;B<F;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}H.length+=W&(1<<H.extra)-1,W>>>=H.extra,B-=H.extra,H.back+=H.extra}H.was=H.length,H.mode=23;case 23:for(;U=H.distcode[W&(1<<H.distbits)-1],q=U>>>24,u=U>>>16&255,n=65535&U,!(q<=B);){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}if(0===(240&u)){for(G=q,R=u,a=n;U=H.distcode[a+((W&(1<<G+R)-1)>>G)],q=U>>>24,u=U>>>16&255,n=65535&U,!(G+q<=B);){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}W>>>=G,B-=G,H.back+=G}if(W>>>=q,B-=q,H.back+=q,64&u){w.yo="invalid distance code",H.mode=r;break}H.offset=n,H.extra=15&u,H.mode=24;case 24:if(H.extra){for(F=H.extra;B<F;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}H.offset+=W&(1<<H.extra)-1,W>>>=H.extra,B-=H.extra,H.back+=H.extra}if(H.offset>H.dmax){w.yo="invalid distance too far back",H.mode=r;break}H.mode=25;case 25:if(0===c)break w;if(f=p-c,H.offset>f){if(f=H.offset-f,f>H.whave&&H.sane){w.yo="invalid distance too far back",H.mode=r;break}f>H.wnext?(f-=H.wnext,N=H.wsize-f):N=H.wnext-f,f>H.length&&(f=H.length),j=H.window}else j=l,N=T-H.offset,f=H.length;f>c&&(f=c),c-=f,H.length-=f;do{l[T++]=j[N++]}while(--f);0===H.length&&(H.mode=21);break;case 26:if(0===c)break w;l[T++]=H.length,c--,H.mode=21;break;case 27:if(H.wrap){for(;B<32;){if(0===S)break w;S--,W|=P[O++]<<B,B+=8}if(p-=c,w.total_out+=p,H.total+=p,p&&(w.adler=H.check=H.flags?E(H.check,l,p,T-p):h(H.check,l,p,T-p)),p=c,(H.flags?W:k(W))!==H.check){w.yo="incorrect data check",H.mode=r;break}W=0,B=0}H.mode=28;case 28:if(H.wrap&&H.flags){for(;B<32;){if(0===S)break w;S--,W+=P[O++]<<B,B+=8}if(W!==(4294967295&H.total)){w.yo="incorrect length check",H.mode=r;break}W=0,B=0}H.mode=29;case 29:I=y;break w;case r:I=Q;break w;case 31:return M;default:return C}return w.next_out=T,w.avail_out=c,w.next_in=O,w.avail_in=S,H.hold=W,H.bits=B,(H.wsize||p!==w.avail_out&&H.mode<r&&(H.mode<27||o!==t))&&g(w,w.output,w.next_out,p-w.avail_out)?(H.mode=31,M):(b-=w.avail_in,p-=w.avail_out,w.total_in+=b,w.total_out+=p,H.total+=p,H.wrap&&p&&(w.adler=H.check=H.flags?E(H.check,l,p,w.next_out-p):h(H.check,l,p,w.next_out-p)),w.data_type=H.bits+(H.last?64:0)+(H.mode===V?128:0)+(20===H.mode||15===H.mode?256:0),(0===b&&0===p||o===t)&&I===A&&(I=i),I)},w.exports.inflateEnd=w=>{if(!w||!w.state)return C;let o=w.state;return o.window&&(o.window=null),w.state=null,A},w.exports.inflateGetHeader=(w,o)=>{if(!w||!w.state)return C;const H=w.state;return 0===(2&H.wrap)?C:(H.head=o,o.done=!1,A)},w.exports.inflateSetDictionary=(w,o)=>{const H=o.length;let E,e,D;return w&&w.state?(E=w.state,0!==E.wrap&&11!==E.mode?C:11===E.mode&&(e=1,e=h(e,o,H,0),e!==E.check)?Q:(D=g(w,o,H,H),D?(E.mode=31,M):(E.havedict=1,A))):C},w.exports.inflateInfo="pako inflate (from Nodeca project)"},12918:w=>{"use strict";const o=15,H=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),h=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),E=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),e=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);w.exports=(w,D,t,X,L,A,y,z)=>{const C=z.bits;let Q,M,i,s,V,r,k=0,P=0,l=0,O=0,T=0,S=0,c=0,W=0,B=0,J=0,g=null,b=0;const p=new Uint16Array(16),f=new Uint16Array(16);let N,j,q,u=null,n=0;for(k=0;k<=o;k++)p[k]=0;for(P=0;P<X;P++)p[D[t+P]]++;for(T=C,O=o;O>=1&&0===p[O];O--);if(T>O&&(T=O),0===O)return L[A++]=20971520,L[A++]=20971520,z.bits=1,0;for(l=1;l<O&&0===p[l];l++);for(T<l&&(T=l),W=1,k=1;k<=o;k++)if(W<<=1,W-=p[k],W<0)return-1;if(W>0&&(0===w||1!==O))return-1;for(f[1]=0,k=1;k<o;k++)f[k+1]=f[k]+p[k];for(P=0;P<X;P++)0!==D[t+P]&&(y[f[D[t+P]]++]=P);if(0===w?(g=u=y,r=19):1===w?(g=H,b-=257,u=h,n-=257,r=256):(g=E,u=e,r=-1),J=0,P=0,k=l,V=A,S=T,c=0,i=-1,B=1<<T,s=B-1,1===w&&B>852||2===w&&B>592)return 1;for(;;){N=k-c,y[P]<r?(j=0,q=y[P]):y[P]>r?(j=u[n+y[P]],q=g[b+y[P]]):(j=96,q=0),Q=1<<k-c,M=1<<S,l=M;do{M-=Q,L[V+(J>>c)+M]=N<<24|j<<16|q}while(0!==M);for(Q=1<<k-1;J&Q;)Q>>=1;if(0!==Q?(J&=Q-1,J+=Q):J=0,P++,0===--p[k]){if(k===O)break;k=D[t+y[P]]}if(k>T&&(J&s)!==i){for(0===c&&(c=T),V+=l,S=k-c,W=1<<S;S+c<O&&(W-=p[S+c],!(W<=0));)S++,W<<=1;if(B+=1<<S,1===w&&B>852||2===w&&B>592)return 1;i=J&s,L[i]=T<<24|S<<16|V-A}}return 0!==J&&(L[V+J]=k-c<<24|64<<16),z.bits=T,0}},12869:w=>{"use strict";w.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12856:w=>{"use strict";function o(w){let o=w.length;for(;--o>=0;)w[o]=0}const H=256,h=286,E=30,e=15,D=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),t=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),X=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),A=new Array(576);o(A);const y=new Array(60);o(y);const z=new Array(512);o(z);const C=new Array(256);o(C);const Q=new Array(29);o(Q);const M=new Array(E);function i(w,o,H,h,E){this.static_tree=w,this.extra_bits=o,this.extra_base=H,this.elems=h,this.max_length=E,this.has_stree=w&&w.length}let s,V,r;function k(w,o){this.dyn_tree=w,this.max_code=0,this.stat_desc=o}o(M);const P=w=>w<256?z[w]:z[256+(w>>>7)],l=(w,o)=>{w.pending_buf[w.pending++]=255&o,w.pending_buf[w.pending++]=o>>>8&255},O=(w,o,H)=>{w.bi_valid>16-H?(w.bi_buf|=o<<w.bi_valid&65535,l(w,w.bi_buf),w.bi_buf=o>>16-w.bi_valid,w.bi_valid+=H-16):(w.bi_buf|=o<<w.bi_valid&65535,w.bi_valid+=H)},T=(w,o,H)=>{O(w,H[2*o],H[2*o+1])},S=(w,o)=>{let H=0;do{H|=1&w,w>>>=1,H<<=1}while(--o>0);return H>>>1},c=(w,o,H)=>{const h=new Array(16);let E,D,t=0;for(E=1;E<=e;E++)h[E]=t=t+H[E-1]<<1;for(D=0;D<=o;D++){let o=w[2*D+1];0!==o&&(w[2*D]=S(h[o]++,o))}},W=w=>{let o;for(o=0;o<h;o++)w.dyn_ltree[2*o]=0;for(o=0;o<E;o++)w.dyn_dtree[2*o]=0;for(o=0;o<19;o++)w.bl_tree[2*o]=0;w.dyn_ltree[512]=1,w.opt_len=w.static_len=0,w.last_lit=w.matches=0},B=w=>{w.bi_valid>8?l(w,w.bi_buf):w.bi_valid>0&&(w.pending_buf[w.pending++]=w.bi_buf),w.bi_buf=0,w.bi_valid=0},J=(w,o,H,h)=>{const E=2*o,e=2*H;return w[E]<w[e]||w[E]===w[e]&&h[o]<=h[H]},g=(w,o,H)=>{const h=w.heap[H];let E=H<<1;for(;E<=w.heap_len&&(E<w.heap_len&&J(o,w.heap[E+1],w.heap[E],w.depth)&&E++,!J(o,h,w.heap[E],w.depth));)w.heap[H]=w.heap[E],H=E,E<<=1;w.heap[H]=h},b=(w,o,h)=>{let E,e,X,L,A=0;if(0!==w.last_lit)do{E=w.pending_buf[w.d_buf+2*A]<<8|w.pending_buf[w.d_buf+2*A+1],e=w.pending_buf[w.l_buf+A],A++,0===E?T(w,e,o):(X=C[e],T(w,X+H+1,o),L=D[X],0!==L&&(e-=Q[X],O(w,e,L)),E--,X=P(E),T(w,X,h),L=t[X],0!==L&&(E-=M[X],O(w,E,L)))}while(A<w.last_lit);T(w,256,o)},p=(w,o)=>{const H=o.dyn_tree,h=o.stat_desc.static_tree,E=o.stat_desc.has_stree,D=o.stat_desc.elems;let t,X,L,A=-1;for(w.heap_len=0,w.heap_max=573,t=0;t<D;t++)0!==H[2*t]?(w.heap[++w.heap_len]=A=t,w.depth[t]=0):H[2*t+1]=0;for(;w.heap_len<2;)L=w.heap[++w.heap_len]=A<2?++A:0,H[2*L]=1,w.depth[L]=0,w.opt_len--,E&&(w.static_len-=h[2*L+1]);for(o.max_code=A,t=w.heap_len>>1;t>=1;t--)g(w,H,t);L=D;do{t=w.heap[1],w.heap[1]=w.heap[w.heap_len--],g(w,H,1),X=w.heap[1],w.heap[--w.heap_max]=t,w.heap[--w.heap_max]=X,H[2*L]=H[2*t]+H[2*X],w.depth[L]=(w.depth[t]>=w.depth[X]?w.depth[t]:w.depth[X])+1,H[2*t+1]=H[2*X+1]=L,w.heap[1]=L++,g(w,H,1)}while(w.heap_len>=2);w.heap[--w.heap_max]=w.heap[1],((w,o)=>{const H=o.dyn_tree,h=o.max_code,E=o.stat_desc.static_tree,D=o.stat_desc.has_stree,t=o.stat_desc.extra_bits,X=o.stat_desc.extra_base,L=o.stat_desc.max_length;let A,y,z,C,Q,M,i=0;for(C=0;C<=e;C++)w.bl_count[C]=0;for(H[2*w.heap[w.heap_max]+1]=0,A=w.heap_max+1;A<573;A++)y=w.heap[A],C=H[2*H[2*y+1]+1]+1,C>L&&(C=L,i++),H[2*y+1]=C,y>h||(w.bl_count[C]++,Q=0,y>=X&&(Q=t[y-X]),M=H[2*y],w.opt_len+=M*(C+Q),D&&(w.static_len+=M*(E[2*y+1]+Q)));if(0!==i){do{for(C=L-1;0===w.bl_count[C];)C--;w.bl_count[C]--,w.bl_count[C+1]+=2,w.bl_count[L]--,i-=2}while(i>0);for(C=L;0!==C;C--)for(y=w.bl_count[C];0!==y;)z=w.heap[--A],z>h||(H[2*z+1]!==C&&(w.opt_len+=(C-H[2*z+1])*H[2*z],H[2*z+1]=C),y--)}})(w,o),c(H,A,w.bl_count)},f=(w,o,H)=>{let h,E,e=-1,D=o[1],t=0,X=7,L=4;for(0===D&&(X=138,L=3),o[2*(H+1)+1]=65535,h=0;h<=H;h++)E=D,D=o[2*(h+1)+1],++t<X&&E===D||(t<L?w.bl_tree[2*E]+=t:0!==E?(E!==e&&w.bl_tree[2*E]++,w.bl_tree[32]++):t<=10?w.bl_tree[34]++:w.bl_tree[36]++,t=0,e=E,0===D?(X=138,L=3):E===D?(X=6,L=3):(X=7,L=4))},N=(w,o,H)=>{let h,E,e=-1,D=o[1],t=0,X=7,L=4;for(0===D&&(X=138,L=3),h=0;h<=H;h++)if(E=D,D=o[2*(h+1)+1],!(++t<X&&E===D)){if(t<L)do{T(w,E,w.bl_tree)}while(0!==--t);else 0!==E?(E!==e&&(T(w,E,w.bl_tree),t--),T(w,16,w.bl_tree),O(w,t-3,2)):t<=10?(T(w,17,w.bl_tree),O(w,t-3,3)):(T(w,18,w.bl_tree),O(w,t-11,7));t=0,e=E,0===D?(X=138,L=3):E===D?(X=6,L=3):(X=7,L=4)}};let j=!1;const q=(w,o,H,h)=>{O(w,0+(h?1:0),3),((w,o,H,h)=>{B(w),h&&(l(w,H),l(w,~H)),w.pending_buf.set(w.window.subarray(o,o+H),w.pending),w.pending+=H})(w,o,H,!0)};w.exports._tr_init=w=>{j||((()=>{let w,o,H,L,k;const P=new Array(16);for(H=0,L=0;L<28;L++)for(Q[L]=H,w=0;w<1<<D[L];w++)C[H++]=L;for(C[H-1]=L,k=0,L=0;L<16;L++)for(M[L]=k,w=0;w<1<<t[L];w++)z[k++]=L;for(k>>=7;L<E;L++)for(M[L]=k<<7,w=0;w<1<<t[L]-7;w++)z[256+k++]=L;for(o=0;o<=e;o++)P[o]=0;for(w=0;w<=143;)A[2*w+1]=8,w++,P[8]++;for(;w<=255;)A[2*w+1]=9,w++,P[9]++;for(;w<=279;)A[2*w+1]=7,w++,P[7]++;for(;w<=287;)A[2*w+1]=8,w++,P[8]++;for(c(A,287,P),w=0;w<E;w++)y[2*w+1]=5,y[2*w]=S(w,5);s=new i(A,D,257,h,e),V=new i(y,t,0,E,e),r=new i(new Array(0),X,0,19,7)})(),j=!0),w.l_desc=new k(w.dyn_ltree,s),w.d_desc=new k(w.dyn_dtree,V),w.bl_desc=new k(w.bl_tree,r),w.bi_buf=0,w.bi_valid=0,W(w)},w.exports._tr_stored_block=q,w.exports._tr_flush_block=(w,o,h,E)=>{let e,D,t=0;w.level>0?(2===w.strm.data_type&&(w.strm.data_type=(w=>{let o,h=4093624447;for(o=0;o<=31;o++,h>>>=1)if(1&h&&0!==w.dyn_ltree[2*o])return 0;if(0!==w.dyn_ltree[18]||0!==w.dyn_ltree[20]||0!==w.dyn_ltree[26])return 1;for(o=32;o<H;o++)if(0!==w.dyn_ltree[2*o])return 1;return 0})(w)),p(w,w.l_desc),p(w,w.d_desc),t=(w=>{let o;for(f(w,w.dyn_ltree,w.l_desc.max_code),f(w,w.dyn_dtree,w.d_desc.max_code),p(w,w.bl_desc),o=18;o>=3&&0===w.bl_tree[2*L[o]+1];o--);return w.opt_len+=3*(o+1)+5+5+4,o})(w),e=w.opt_len+3+7>>>3,D=w.static_len+3+7>>>3,D<=e&&(e=D)):e=D=h+5,h+4<=e&&-1!==o?q(w,o,h,E):4===w.strategy||D===e?(O(w,2+(E?1:0),3),b(w,A,y)):(O(w,4+(E?1:0),3),((w,o,H,h)=>{let E;for(O(w,o-257,5),O(w,H-1,5),O(w,h-4,4),E=0;E<h;E++)O(w,w.bl_tree[2*L[E]+1],3);N(w,w.dyn_ltree,o-1),N(w,w.dyn_dtree,H-1)})(w,w.l_desc.max_code+1,w.d_desc.max_code+1,t+1),b(w,w.dyn_ltree,w.dyn_dtree)),W(w),E&&B(w)},w.exports._tr_tally=(w,o,h)=>(w.pending_buf[w.d_buf+2*w.last_lit]=o>>>8&255,w.pending_buf[w.d_buf+2*w.last_lit+1]=255&o,w.pending_buf[w.l_buf+w.last_lit]=255&h,w.last_lit++,0===o?w.dyn_ltree[2*h]++:(w.matches++,o--,w.dyn_ltree[2*(C[h]+H+1)]++,w.dyn_dtree[2*P(o)]++),w.last_lit===w.lit_bufsize-1),w.exports._tr_align=w=>{O(w,2,3),T(w,256,A),(w=>{16===w.bi_valid?(l(w,w.bi_buf),w.bi_buf=0,w.bi_valid=0):w.bi_valid>=8&&(w.pending_buf[w.pending++]=255&w.bi_buf,w.bi_buf>>=8,w.bi_valid-=8)})(w)}},12894:w=>{"use strict";w.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.yo="",this.state=null,this.data_type=2,this.adler=0}},12515:w=>{function o(w,o,H){for(var h=w.length,E=-1/0,e=1/0,D=0;D<h;D++){var t=(H[0][D]-w[D])/o[D],X=(H[1][D]-w[D])/o[D];if(t>X){var L=t;t=X,X=L}if(X<E||t>e)return 1/0;t>E&&(E=t),X<e&&(e=X)}return E>e?1/0:E}w.exports=function(w,H,h,E){var e=o(H,h,E);if(e===1/0)w=null;else{w=w||[];for(var D=0;D<H.length;D++)w[D]=H[D]+h[D]*e}return w},w.exports.distance=o},13952:(w,o,H)=>{"use strict";H.d(o,{b:()=>D});var h=H(24);const E=h.useLayoutEffect;const e=function(w){var o=(0,h.useRef)(w);return E((function(){o.current=w})),o};var D=function(w){var o=e(w);(0,h.Xo)((function(){var w=function(w){var H;if(null!=o.current&&(H=o.current(w)),w.defaultPrevented&&(w.returnValue=""),"string"===typeof H)return w.returnValue=H,H};return window.addEventListener("beforeunload",w),function(){window.removeEventListener("beforeunload",w)}}),[])}},13904:(w,o,H)=>{"use strict";var h=H(13913),E=Array.prototype.concat,e=Array.prototype.slice,D=w.exports=function(w){for(var o=[],H=0,D=w.length;H<D;H++){var t=w[H];h(t)?o=E.call(o,e.call(t)):o.push(t)}return o};D.wrap=function(w){return function(){return w(D(arguments))}}},13913:w=>{w.exports=function(w){return!(!w||"string"===typeof w)&&(w instanceof Array||Array.isArray(w)||w.length>=0&&(w.splice instanceof Function||Object.getOwnPropertyDescriptor(w,w.length-1)&&"String"!==w.constructor.name))}},12802:(w,o,H)=>{var h=H(12807);function E(w){for(var o,H,E=0,e=w.length,D=0;D<w.length;){for(o=w[D],H=0;D<e&&w[D]===o;)++D,++H;E+=h.log2(H)/7|0,E+=h.log2(o>>>0)/7|0,E+=2}return E}o.size=E,o.encode=function(w,o){o||(o=new Uint8Array(E(w)));for(var H,h,e=0,D=o.length,t=0;t<w.length;){for(H=w[t],h=0;t<w.length&&w[t]===H;)++t,++h;for(;e<D&&h>=128;)o[e++]=128+(127&h),h>>>=7;if(e>=D)throw new Error("RLE buffer overflow");for(o[e++]=h,H>>>=0;e<D&&H>=128;)o[e++]=128+(127&H),H>>>=7;if(e>=D)throw new Error("RLE buffer overflow");o[e++]=H}return o},o.decode=function(w,o){for(var H,h,E,e,D=o.length,t=w.length,X=0,L=0;L<t;){for(H=0,h=0;L<t&&w[L]>=128;)H+=(127&w[L++])<<h,h+=7;if(H+=w[L++]<<h,L>=t)throw new Error("RLE buffer underrun");if(X+H>D)throw new Error("Chunk buffer overflow");for(E=0,h=0;L<t&&w[L]>=128;)E+=(127&w[L++])<<h,h+=7;if(L>=t)throw new Error("RLE buffer underrun");for(E+=w[L++]<<h,e=0;e<H;++e)o[X++]=E}return o}},12807:(w,o)=>{"use strict";function H(w){var o=32;return(w&=-w)&&o--,65535&w&&(o-=16),16711935&w&&(o-=8),252645135&w&&(o-=4),858993459&w&&(o-=2),1431655765&w&&(o-=1),o}o.INT_BITS=32,o.INT_MAX=2147483647,o.INT_MIN=-1<<31,o.sign=function(w){return(w>0)-(w<0)},o.abs=function(w){var o=w>>31;return(w^o)-o},o.min=function(w,o){return o^(w^o)&-(w<o)},o.max=function(w,o){return w^(w^o)&-(w<o)},o.isPow2=function(w){return!(w&w-1)&&!!w},o.log2=function(w){var o,H;return o=(w>65535)<<4,o|=H=((w>>>=o)>255)<<3,o|=H=((w>>>=H)>15)<<2,(o|=H=((w>>>=H)>3)<<1)|(w>>>=H)>>1},o.log10=function(w){return w>=1e9?9:w>=1e8?8:w>=1e7?7:w>=1e6?6:w>=1e5?5:w>=1e4?4:w>=1e3?3:w>=100?2:w>=10?1:0},o.popCount=function(w){return 16843009*((w=(858993459&(w-=w>>>1&1431655765))+(w>>>2&858993459))+(w>>>4)&252645135)>>>24},o.countTrailingZeros=H,o.nextPow2=function(w){return w+=0===w,--w,w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)+1},o.prevPow2=function(w){return w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,(w|=w>>>16)-(w>>>1)},o.parity=function(w){return w^=w>>>16,w^=w>>>8,w^=w>>>4,27030>>>(w&=15)&1};var h=new Array(256);!function(w){for(var o=0;o<256;++o){var H=o,h=o,E=7;for(H>>>=1;H;H>>>=1)h<<=1,h|=1&H,--E;w[o]=h<<E&255}}(h),o.reverse=function(w){return h[255&w]<<24|h[w>>>8&255]<<16|h[w>>>16&255]<<8|h[w>>>24&255]},o.interleave2=function(w,o){return(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w&=65535)|w<<8))|w<<4))|w<<2))|w<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o&=65535)|o<<8))|o<<4))|o<<2))|o<<1))<<1},o.deinterleave2=function(w,o){return(w=65535&((w=16711935&((w=252645135&((w=858993459&((w=w>>>o&1431655765)|w>>>1))|w>>>2))|w>>>4))|w>>>16))<<16>>16},o.interleave3=function(w,o,H){return w=1227133513&((w=3272356035&((w=251719695&((w=4278190335&((w&=1023)|w<<16))|w<<8))|w<<4))|w<<2),(w|=(o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2))<<1)|(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<2},o.deinterleave3=function(w,o){return(w=1023&((w=4278190335&((w=251719695&((w=3272356035&((w=w>>>o&1227133513)|w>>>2))|w>>>4))|w>>>8))|w>>>16))<<22>>22},o.nextCombination=function(w){var o=w|w-1;return o+1|(~o&-~o)-1>>>H(w)+1}},12829:w=>{"use strict";w.exports=function(w,o,H,h){var E=self||window;try{try{var e;try{e=new E.Blob([w])}catch(L){(e=new(E.BlobBuilder||E.WebKitBlobBuilder||E.MozBlobBuilder||E.MSBlobBuilder)).append(w),e=e.getBlob()}var D=E.URL||E.webkitURL,t=D.createObjectURL(e),X=new E[o](t,H);return D.revokeObjectURL(t),X}catch(L){return new E[o]("data:application/javascript,".concat(encodeURIComponent(w)),H)}}catch(L){if(!h)throw Error("Inline worker is not supported");return new E[o](h,H)}}},12498:(w,o,H)=>{"use strict";function h(w,o,H,h,E){var e={};return Object.keys(h).forEach((function(w){e[w]=h[w]})),e.enumerable=!!e.enumerable,e.configurable=!!e.configurable,("value"in e||e.initializer)&&(e.writable=!0),e=H.slice().reverse().reduce((function(H,h){return h(w,o,H)||H}),e),E&&void 0!==e.initializer&&(e.value=e.initializer?e.initializer.call(E):void 0,e.initializer=void 0),void 0===e.initializer&&(Object.defineProperty(w,o,e),e=null),e}H.d(o,{e:()=>h})},12493:(w,o,H)=>{"use strict";function h(w,o,H,h){H&&Object.defineProperty(w,o,{enumerable:H.enumerable,configurable:H.configurable,writable:H.writable,value:H.initializer?H.initializer.call(h):void 0})}H.d(o,{c:()=>h})},13944:(w,o,H)=>{"use strict";H.d(o,{e:()=>D,h:()=>y,i:()=>t,m:()=>e,o:()=>X,p:()=>E,q:()=>L,r:()=>A});var h=H(11923);class E{constructor(){this._easingMode=E.EASINGMODE_EASEIN}setEasingMode(w){const o=Math.min(Math.max(w,0),2);this._easingMode=o}getEasingMode(){return this._easingMode}easeInCore(w){throw new Error("You must implement this method")}ease(w){switch(this._easingMode){case E.EASINGMODE_EASEIN:return this.easeInCore(w);case E.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-w)}return w>=.5?.5*(1-this.easeInCore(2*(1-w)))+.5:.5*this.easeInCore(2*w)}}E.EASINGMODE_EASEIN=0,E.EASINGMODE_EASEOUT=1,E.EASINGMODE_EASEINOUT=2;class e extends E{easeInCore(w){return w=Math.max(0,Math.min(1,w)),1-Math.sqrt(1-w*w)}}class D extends E{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=w}easeInCore(w){const o=Math.max(0,this.amplitude);return Math.pow(w,3)-w*o*Math.sin(3.141592653589793*w)}}class t extends E{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=w,this.bounciness=o}easeInCore(w){const o=Math.max(0,this.bounces);let H=this.bounciness;H<=1&&(H=1.001);const h=Math.pow(H,o),E=1-H,e=(1-h)/E+.5*h,D=w*e,t=Math.log(-D*(1-H)+1)/Math.log(H),X=Math.floor(t),L=X+1,A=(1-Math.pow(H,X))/(E*e),y=.5*(A+(1-Math.pow(H,L))/(E*e)),z=w-y,C=y-A;return-Math.pow(1/H,o-X)/(C*C)*(z-C)*(z+C)}}class X extends E{easeInCore(w){return w*w*w}}class L extends E{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=w,this.springiness=o}easeInCore(w){let o;const H=Math.max(0,this.oscillations),h=Math.max(0,this.springiness);return o=0==h?w:(Math.exp(h*w)-1)/(Math.exp(h)-1),o*Math.sin((6.283185307179586*H+1.5707963267948966)*w)}}class A extends E{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=w}easeInCore(w){return this.exponent<=0?w:(Math.exp(this.exponent*w)-1)/(Math.exp(this.exponent)-1)}}class y extends E{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=w,this.y1=o,this.x2=H,this.y2=h}easeInCore(w){return h.c.Interpolate(w,this.x1,this.y1,this.x2,this.y2)}}},13371:(w,o,H)=>{"use strict";H.d(o,{c:()=>D});var h=H(11720),E=H(11727),e=H(12133);class D extends e.c{get _matrix(){return this._compose(),this.cz}set _matrix(w){(w.updateFlag!==this.cz.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.cz.t(w),this._markAsDirtyAndDecompose())}constructor(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(w,o.Ow(),!1),this.name=w,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=o,this.cz=(null===E||void 0===E?void 0:E.clone())??h.Matrix.Identity(),this._restMatrix=e??this.cz.clone(),this._bindMatrix=D??this.cz.clone(),this._index=t,this._absoluteMatrix=new h.Matrix,this._absoluteBindMatrix=new h.Matrix,this._absoluteInverseBindMatrix=new h.Matrix,this._finalMatrix=new h.Matrix,o.bones.push(this),this.setParent(H,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(w){this.setParent(w)}setParent(w){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==w){if(this.parent){const w=this.parent.children.indexOf(this);-1!==w&&this.parent.children.splice(w,1)}this._parentNode=w,this.parent&&this.parent.children.push(this),o&&this._updateAbsoluteBindMatrices(),this.dL()}}getLocalMatrix(){return this._compose(),this.cz}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(w){this._restMatrix.t(w)}setRestPose(w){this.setRestMatrix(w)}getBindPose(){return this.getBindMatrix()}setBindMatrix(w){this.ie(w)}setBindPose(w){this.setBindMatrix(w)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const w=h.TmpVectors.io[0],o=h.TmpVectors.Quaternion[0],H=h.TmpVectors.io[1];this.getRestMatrix().decompose(w,o,H),this._linkedTransformNode.position.t(H),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??h.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.t(o),this._linkedTransformNode.Je.t(w)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(w){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=w,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Kt}set position(w){this._decompose(),this.Kt.t(w),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(w){this.setRotation(w)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(w){this.setRotationQuaternion(w)}get Je(){return this.getScale()}set Je(w){this.setScale(w)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=h.io.Zero(),this._localRotation=h.Quaternion.Zero(),this.Kt=h.io.Zero()),this.cz.decompose(this._localScaling,this._localRotation,this.Kt))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,h.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Kt,this.cz)):this._needToCompose=!1)}ie(w){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.t(w),o&&this._updateAbsoluteBindMatrices(),H?this._matrix=w:this.dL()}_updateAbsoluteBindMatrices(w){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(w||(w=this._bindMatrix),this.parent?w.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.t(w),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),o)for(let H=0;H<this.children.length;H++)this.children[H]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}dL(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.dL(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.dL(),this._needToDecompose=!0}_updatePosition(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0,E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const e=this.getLocalMatrix();if(0==o)E?(e.addAtIndex(12,w.x),e.addAtIndex(13,w.y),e.addAtIndex(14,w.z)):e.setTranslationFromFloats(w.x,w.y,w.z);else{let o=null;H&&(o=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=D._TmpMats[0],X=D._TmpVecs[0];this.parent?H&&o?(t.t(this.parent.getAbsoluteMatrix()),t.multiplyToRef(o,t)):t.t(this.parent.getAbsoluteMatrix()):h.Matrix.IdentityToRef(t),E&&t.setTranslationFromFloats(0,0,0),t.invert(),h.io.TransformCoordinatesToRef(w,t,X),E?(e.addAtIndex(12,X.x),e.addAtIndex(13,X.y),e.addAtIndex(14,X.z)):e.setTranslationFromFloats(X.x,X.y,X.z)}this._markAsDirtyAndDecompose()}translate(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this._updatePosition(w,o,H,!0)}setPosition(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this._updatePosition(w,o,H,!1)}setAbsolutePosition(w,o){this.setPosition(w,1,o)}scale(w,o,H){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const e=this.getLocalMatrix(),t=D._TmpMats[0];h.Matrix.ScalingToRef(w,o,H,t),t.multiplyToRef(e,e),t.invert();for(const h of this.children){const E=h.getLocalMatrix();E.multiplyToRef(t,E),E.multiplyAtIndex(12,w),E.multiplyAtIndex(13,o),E.multiplyAtIndex(14,H),h._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),E)for(const h of this.children)h.scale(w,o,H,E)}setScale(w){this._decompose(),this._localScaling.t(w),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(w){this._decompose(),w.t(this._localScaling)}setYawPitchRoll(w,o,H){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,e=arguments.length>4?arguments[4]:void 0;if(0===E){const t=D._TmpQuat;return h.Quaternion.RotationYawPitchRollToRef(w,o,H,t),void this.setRotationQuaternion(t,E,e)}const t=D._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,e))return;const X=D._TmpMats[1];h.Matrix.RotationYawPitchRollToRef(w,o,H,X),t.multiplyToRef(X,X),this._rotateWithMatrix(X,E,e)}rotate(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,E=arguments.length>3?arguments[3]:void 0;const e=D._TmpMats[0];e.setTranslationFromFloats(0,0,0),h.Matrix.RotationAxisToRef(w,o,e),this._rotateWithMatrix(e,H,E)}setAxisAngle(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,E=arguments.length>3?arguments[3]:void 0;if(0===H){const e=D._TmpQuat;return h.Quaternion.RotationAxisToRef(w,o,e),void this.setRotationQuaternion(e,H,E)}const e=D._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(e,E))return;const t=D._TmpMats[1];h.Matrix.RotationAxisToRef(w,o,t),e.multiplyToRef(t,t),this._rotateWithMatrix(t,H,E)}setRotation(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(w.y,w.x,w.z,o,H)}setRotationQuaternion(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;if(0===o)return this._decompose(),this._localRotation.t(w),void this._markAsDirtyAndCompose();const E=D._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,H))return;const e=D._TmpMats[1];h.Matrix.FromQuaternionToRef(w,e),E.multiplyToRef(e,e),this._rotateWithMatrix(e,o,H)}setRotationMatrix(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;if(0===o){const E=D._TmpQuat;return h.Quaternion.FromRotationMatrixToRef(w,E),void this.setRotationQuaternion(E,o,H)}const E=D._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,H))return;const e=D._TmpMats[1];e.t(w),E.multiplyToRef(w,e),this._rotateWithMatrix(e,o,H)}_rotateWithMatrix(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;const h=this.getLocalMatrix(),E=h.m[12],e=h.m[13],t=h.m[14],X=this.getParent(),L=D._TmpMats[3],A=D._TmpMats[4];X&&1==o?(H?(L.t(H.getWorldMatrix()),X.getAbsoluteMatrix().multiplyToRef(L,L)):L.t(X.getAbsoluteMatrix()),A.t(L),A.invert(),h.multiplyToRef(L,h),h.multiplyToRef(w,h),h.multiplyToRef(A,h)):1==o&&H?(L.t(H.getWorldMatrix()),A.t(L),A.invert(),h.multiplyToRef(L,h),h.multiplyToRef(w,h),h.multiplyToRef(A,h)):h.multiplyToRef(w,h),h.setTranslationFromFloats(E,e,t),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(w,o){const H=D._TmpMats[2];return w.t(this.getAbsoluteMatrix()),o?(w.multiplyToRef(o.getWorldMatrix(),w),h.Matrix.ScalingToRef(o.Je.x,o.Je.y,o.Je.z,H)):h.Matrix.IdentityToRef(H),w.invert(),!isNaN(w.m[0])&&(H.multiplyAtIndex(0,this._scalingDeterminant),w.multiplyToRef(H,w),!0)}gh(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=h.io.Zero();return this.getPositionToRef(w,o,H),H}getPositionToRef(){let w=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const w=this.getLocalMatrix();o.x=w.m[12],o.y=w.m[13],o.z=w.m[14]}else{let H=null;w&&(H=w.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let h=D._TmpMats[0];w&&H?(h.t(this.getAbsoluteMatrix()),h.multiplyToRef(H,h)):h=this.getAbsoluteMatrix(),o.x=h.m[12],o.y=h.m[13],o.z=h.m[14]}}getAbsolutePosition(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const o=h.io.Zero();return this.getPositionToRef(1,w,o),o}getAbsolutePositionToRef(w,o){this.getPositionToRef(1,w,o)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.cz.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.t(this.cz);const w=this._skeleton.getPoseMatrix();w&&this._absoluteMatrix.multiplyToRef(w,this._absoluteMatrix)}const w=this.children,o=w.length;for(let H=0;H<o;H++)w[H].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}PX(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=h.io.Zero();return this.getDirectionToRef(w,o,H),H}getDirectionToRef(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,E=null;o&&(E=o.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const e=D._TmpMats[0];e.t(this.getAbsoluteMatrix()),o&&E&&e.multiplyToRef(E,e),h.io.TransformNormalToRef(w,e,H),H.normalize()}getRotation(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=h.io.Zero();return this.getRotationToRef(w,o,H),H}getRotationToRef(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;const h=D._TmpQuat;this.getRotationQuaternionToRef(w,o,h),h.toEulerAnglesToRef(H)}getRotationQuaternion(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=h.Quaternion.Identity();return this.getRotationQuaternionToRef(w,o,H),H}getRotationQuaternionToRef(){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),o.t(this._localRotation);else{const H=D._TmpMats[0],h=this.getAbsoluteMatrix();w?h.multiplyToRef(w.getWorldMatrix(),H):H.t(h),H.multiplyAtIndex(0,this._scalingDeterminant),H.multiplyAtIndex(1,this._scalingDeterminant),H.multiplyAtIndex(2,this._scalingDeterminant),H.decompose(void 0,o,void 0)}}getRotationMatrix(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1?arguments[1]:void 0;const H=h.Matrix.Identity();return this.getRotationMatrixToRef(w,o,H),H}getRotationMatrixToRef(){let w=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(o);else{const H=D._TmpMats[0],h=this.getAbsoluteMatrix();w?h.multiplyToRef(w.getWorldMatrix(),H):H.t(h),H.multiplyAtIndex(0,this._scalingDeterminant),H.multiplyAtIndex(1,this._scalingDeterminant),H.multiplyAtIndex(2,this._scalingDeterminant),H.getRotationMatrixToRef(o)}}getAbsolutePositionFromLocal(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=h.io.Zero();return this.getAbsolutePositionFromLocalToRef(w,o,H),H}getAbsolutePositionFromLocalToRef(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,E=null;o&&(E=o.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const e=D._TmpMats[0];e.t(this.getAbsoluteMatrix()),o&&E&&e.multiplyToRef(E,e),h.io.TransformCoordinatesToRef(w,e,H)}getLocalPositionFromAbsolute(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=h.io.Zero();return this.getLocalPositionFromAbsoluteToRef(w,o,H),H}getLocalPositionFromAbsoluteToRef(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,E=null;o&&(E=o.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const e=D._TmpMats[0];e.t(this.getAbsoluteMatrix()),o&&E&&e.multiplyToRef(E,e),e.invert(),h.io.TransformCoordinatesToRef(w,e,H)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const w=this._skeleton.bones.indexOf(this);if(-1!==w&&this._skeleton.bones.splice(w,1),this._parentNode&&this._parentNode.children){const w=this._parentNode.children,o=w.indexOf(this);-1!==o&&w.splice(o,1)}super.dispose()}}D._TmpVecs=(0,E.c)(2,h.io.Zero),D._TmpQuat=h.Quaternion.Identity(),D._TmpMats=(0,E.c)(5,h.Matrix.Identity)},13942:(w,o,H)=>{"use strict";H.d(o,{c:()=>p});var h=H(11697),E=H(11702),e=H(11540),D=H(11720),t=H(11729),X=H(12133),L=H(12165),A=H(11991),y=H(11560),z=H(11722);class C{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(w){this._zoomStopsAnimation=w}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(w){this._idleRotationSpeed=w}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(w){this._idleRotationWaitTime=w}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(w){this._idleRotationSpinupTime=w}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(w){this._attachedCamera=w;const o=this._attachedCamera.Ow();this._onPrePointerObservableObserver=o.onPrePointerObservable.add((w=>{w.type!==A.d.POINTERDOWN?w.type===A.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=w.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const w=y.c.Now;let o=0;null!=this._lastFrameTime&&(o=w-this._lastFrameTime),this._lastFrameTime=w,this._applyUserInteraction();const H=w-this._lastInteractionTime-this._idleRotationWaitTime,h=Math.max(Math.min(H/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*h,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(o/1e3))}))}detach(){if(!this._attachedCamera)return;const w=this._attachedCamera.Ow();this._onPrePointerObservableObserver&&w.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(w){this._lastInteractionTime=w??y.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<z.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let w=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(w=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?w:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=y.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var Q=H(13944),M=H(12247);class i{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(w){if(this._autoTransitionRange===w)return;this._autoTransitionRange=w;const o=this._attachedCamera;o&&(w?this._onMeshTargetChangedObserver=o.onMeshTargetChangedObservable.add((w=>{if(w&&(w.se(!0),w.getBoundingInfo)){const o=w.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*o,this.upperRadiusTransitionRange=.05*o}})):this._onMeshTargetChangedObserver&&o.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(w){this._attachedCamera=w,this._onAfterCheckInputsObserver=w.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(w){return!!this._attachedCamera&&(this._attachedCamera.radius===w&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(w){if(!this._attachedCamera)return;this._radiusBounceTransition||(i.EasingFunction.setEasingMode(i.EasingMode),this._radiusBounceTransition=M.b.CreateAnimation("radius",M.b.ANIMATIONTYPE_FLOAT,60,i.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const o=M.b.TransitionTo("radius",this._attachedCamera.radius+w,this._attachedCamera,this._attachedCamera.Ow(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));o&&this._animatables.push(o)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}i.EasingFunction=new Q.e(.3),i.EasingMode=Q.p.EASINGMODE_EASEOUT;class s{constructor(){this.onTargetFramingAnimationEndObservable=new e.b,this._mode=s.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(w){this._mode=w}get mode(){return this._mode}set radiusScale(w){this._radiusScale=w}get radiusScale(){return this._radiusScale}set positionScale(w){this._positionScale=w}get positionScale(){return this._positionScale}set defaultElevation(w){this._defaultElevation=w}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(w){this._elevationReturnTime=w}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(w){this._elevationReturnWaitTime=w}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(w){this._zoomStopsAnimation=w}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(w){this._framingTime=w}get framingTime(){return this._framingTime}init(){}attach(w){this._attachedCamera=w;const o=this._attachedCamera.Ow();s.EasingFunction.setEasingMode(s.EasingMode),this._onPrePointerObservableObserver=o.onPrePointerObservable.add((w=>{w.type!==A.d.POINTERDOWN?w.type===A.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=w.onMeshTargetChangedObservable.add((w=>{w&&w.getBoundingInfo&&this.zoomOnMesh(w,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=w.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const w=this._attachedCamera.Ow();this._onPrePointerObservableObserver&&w.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(w){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;w.se(!0);const h=w.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(h.minimumWorld,h.maximumWorld,o,H)}zoomOnMeshHierarchy(w){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;w.se(!0);const h=w.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(h.min,h.max,o,H)}zoomOnMeshesHierarchy(w){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new D.io(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),E=new D.io(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let e=0;e<w.length;e++){const o=w[e].getHierarchyBoundingVectors(!0);D.io.CheckExtends(o.min,h,E),D.io.CheckExtends(o.max,h,E)}this.zoomOnBoundingInfo(h,E,o,H)}zoomOnBoundingInfo(w,o){let H,h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const e=w.y,t=e+(o.y-e)*this._positionScale,X=o.so(w).scale(.5);if(!isFinite(t))return!1;if(h)H=new D.io(0,t,0);else{const o=w.add(X);H=new D.io(o.x,t,o.z)}this._vectorTransition||(this._vectorTransition=M.b.CreateAnimation("target",M.b.ANIMATIONTYPE_VECTOR3,60,s.EasingFunction)),this._betaIsAnimating=!0;let L=M.b.TransitionTo("target",H,this._attachedCamera,this._attachedCamera.Ow(),60,this._vectorTransition,this._framingTime);L&&this._animatables.push(L);let A=0;if(this._mode===s.FitFrustumSidesMode){const H=this._calculateLowerRadiusFromModelBoundingSphere(w,o);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=X.length()+this._attachedCamera.Qe),A=H}else this._mode===s.IgnoreBoundsSizeMode&&(A=this._calculateLowerRadiusFromModelBoundingSphere(w,o),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Qe));if(this.autoCorrectCameraLimitsAndSensibility){const H=o.so(w).length();this._attachedCamera.panningSensibility=5e3/H,this._attachedCamera.wheelPrecision=100/A}return this._radiusTransition||(this._radiusTransition=M.b.CreateAnimation("radius",M.b.ANIMATIONTYPE_FLOAT,60,s.EasingFunction)),L=M.b.TransitionTo("radius",A,this._attachedCamera,this._attachedCamera.Ow(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),E&&E(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),L&&this._animatables.push(L),!0}_calculateLowerRadiusFromModelBoundingSphere(w,o){const H=this._attachedCamera;if(!H)return 0;let h=H._calculateLowerRadiusFromModelBoundingSphere(w,o,this._radiusScale);return H.lowerRadiusLimit&&this._mode===s.IgnoreBoundsSizeMode&&(h=h<H.lowerRadiusLimit?H.lowerRadiusLimit:h),H.upperRadiusLimit&&(h=h>H.upperRadiusLimit?H.upperRadiusLimit:h),h}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const w=y.c.Now-this._lastInteractionTime,o=.5*Math.PI-this._defaultElevation,H=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>H&&w>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=M.b.CreateAnimation("beta",M.b.ANIMATIONTYPE_FLOAT,60,s.EasingFunction));const w=M.b.TransitionTo("beta",o,this._attachedCamera,this._attachedCamera.Ow(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));w&&this._animatables.push(w)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=y.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}s.EasingFunction=new Q.r,s.EasingMode=Q.p.EASINGMODE_EASEINOUT,s.IgnoreBoundsSizeMode=0,s.FitFrustumSidesMode=1;var V=H(12167),r=H(12196),k=H(13364),P=H(11531);class l{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(w){w=P.Tools.BackCompatCameraNoPreventDefault(arguments);const o=this.camera.getEngine(),H=o.getInputElement();let h=0,E=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=e=>{var D,t;const X=e.event,L="touch"===X.pointerType;if(e.type!==A.d.POINTERMOVE&&-1===this.buttons.indexOf(X.button))return;const y=X.target;if(this._altKey=X.altKey,this._ctrlKey=X.ctrlKey,this._metaKey=X.metaKey,this._shiftKey=X.shiftKey,this._buttonsPressed=X.buttons,o.isPointerLock){const w=X.movementX,o=X.movementY;this.onTouch(null,w,o),this._pointA=null,this._pointB=null}else{if(e.type!==A.d.POINTERDOWN&&e.type!==A.d.POINTERDOUBLETAP&&L&&(null===(D=this._pointA)||void 0===D?void 0:D.pointerId)!==X.pointerId&&(null===(t=this._pointB)||void 0===t?void 0:t.pointerId)!==X.pointerId)return;if(e.type!==A.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!L)if(e.type===A.d.POINTERDOUBLETAP)this.onDoubleTap(X.pointerType);else if(e.type!==A.d.POINTERUP||this._currentMousePointerIdDown!==X.pointerId&&!L){if(e.type===A.d.POINTERMOVE)if(w||X.preventDefault(),this._pointA&&null===this._pointB){const w=X.clientX-this._pointA.x,o=X.clientY-this._pointA.y;this._pointA.x=X.clientX,this._pointA.y=X.clientY,this.onTouch(this._pointA,w,o)}else if(this._pointA&&this._pointB){const w=this._pointA.pointerId===X.pointerId?this._pointA:this._pointB;w.x=X.clientX,w.y=X.clientY;const o=this._pointA.x-this._pointB.x,H=this._pointA.y-this._pointB.y,D=o*o+H*H,t={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:X.pointerId,type:e.type};this.onMultiTouch(this._pointA,this._pointB,h,D,E,t),E=t,h=D}}else{try{null===y||void 0===y||y.releasePointerCapture(X.pointerId)}catch(z){}L||(this._pointB=null),o._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==X.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==X.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==h||E)&&(this.onMultiTouch(this._pointA,this._pointB,h,0,E,null),h=0,E=null),this._currentMousePointerIdDown=-1,this.onButtonUp(X),w||X.preventDefault()}else{try{null===y||void 0===y||y.setPointerCapture(X.pointerId)}catch(z){}if(null===this._pointA)this._pointA={x:X.clientX,y:X.clientY,pointerId:X.pointerId,type:X.pointerType};else{if(null!==this._pointB)return;this._pointB={x:X.clientX,y:X.clientY,pointerId:X.pointerId,type:X.pointerType}}-1!==this._currentMousePointerIdDown||L||(this._currentMousePointerIdDown=X.pointerId),this.onButtonDown(X),w||(X.preventDefault(),H&&H.focus())}}},this._observer=this.camera.Ow()._inputManager._addCameraPointerObserver(this._pointerInput,A.d.POINTERDOWN|A.d.POINTERUP|A.d.POINTERMOVE|A.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,h=0,E=null,this.onLostFocus()},this._contextMenuBind=w=>this.onContextMenu(w),H&&H.addEventListener("contextmenu",this._contextMenuBind,!1);const e=this.camera.Ow().getEngine().getHostWindow();e&&P.Tools.RegisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}by(){if(this._onLostFocus){const w=this.camera.Ow().getEngine().getHostWindow();w&&P.Tools.UnregisterTopRootEvents(w,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Ow()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const w=this.camera.Ow().getEngine().getInputElement();w&&w.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(w){}onTouch(w,o,H){}onMultiTouch(w,o,H,h,E,e){}onContextMenu(w){w.preventDefault()}onButtonDown(w){}onButtonUp(w){}onLostFocus(){}}(0,h.b)([(0,E.B)()],l.prototype,"buttons",void 0);class O extends l{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(w,o){if(0!==this.panningSensibility&&w&&o){const H=o.x-w.x,h=o.y-w.y;this.camera.inertialPanningX+=-H/this.panningSensibility,this.camera.inertialPanningY+=h/this.panningSensibility}}_computePinchZoom(w,o){const H=this.camera.radius||O.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=H*Math.sqrt(w)/Math.sqrt(o):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(o-w)*H*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(o-w)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(w,o,H){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-o/this.panningSensibility,this.camera.inertialPanningY+=H/this.panningSensibility):(this.camera.inertialAlphaOffset-=o/this.angularSensibilityX,this.camera.inertialBetaOffset-=H/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(w,o,H,h,E,e){0===H&&null===E||0===h&&null===e||(this.multiTouchPanAndZoom?(this._computePinchZoom(H,h),this._computeMultiTouchPanning(E,e)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(h)-Math.sqrt(H))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(H,h),this._isPinching=!0):this._computeMultiTouchPanning(E,e)):this.multiTouchPanning?this._computeMultiTouchPanning(E,e):this.pinchZoom&&this._computePinchZoom(H,h))}onButtonDown(w){this._isPanClick=w.button===this.camera._panningMouseButton}onButtonUp(w){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}O.MinimumRadiusForPinch=.001,(0,h.b)([(0,E.B)()],O.prototype,"buttons",void 0),(0,h.b)([(0,E.B)()],O.prototype,"angularSensibilityX",void 0),(0,h.b)([(0,E.B)()],O.prototype,"angularSensibilityY",void 0),(0,h.b)([(0,E.B)()],O.prototype,"pinchPrecision",void 0),(0,h.b)([(0,E.B)()],O.prototype,"pinchDeltaPercentage",void 0),(0,h.b)([(0,E.B)()],O.prototype,"useNaturalPinchZoom",void 0),(0,h.b)([(0,E.B)()],O.prototype,"pinchZoom",void 0),(0,h.b)([(0,E.B)()],O.prototype,"panningSensibility",void 0),(0,h.b)([(0,E.B)()],O.prototype,"multiTouchPanning",void 0),(0,h.b)([(0,E.B)()],O.prototype,"multiTouchPanAndZoom",void 0),k.d.ArcRotateCameraPointersInput=O;var T=H(11994);class S{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(w){w=P.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ow(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((o=>{const H=o.event;if(!H.metaKey)if(o.type===T.e.KEYDOWN){if(this._ctrlPressed=H.ctrlKey,this._altPressed=H.altKey,-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysReset.indexOf(H.keyCode)){-1===this._keys.indexOf(H.keyCode)&&this._keys.push(H.keyCode),H.preventDefault&&(w||H.preventDefault())}}else if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysReset.indexOf(H.keyCode)){const o=this._keys.indexOf(H.keyCode);o>=0&&this._keys.splice(o,1),H.preventDefault&&(w||H.preventDefault())}})))}by(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const w=this.camera;for(let o=0;o<this._keys.length;o++){const H=this._keys[o];-1!==this.keysLeft.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningX-=1/this.panningSensibility:w.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?w.inertialRadiusOffset+=1/this.zoomingSensibility:w.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningX+=1/this.panningSensibility:w.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?w.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?w.inertialRadiusOffset-=1/this.zoomingSensibility:w.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(H)&&w.useInputToRestoreState&&w.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,h.b)([(0,E.B)()],S.prototype,"keysUp",void 0),(0,h.b)([(0,E.B)()],S.prototype,"keysDown",void 0),(0,h.b)([(0,E.B)()],S.prototype,"keysLeft",void 0),(0,h.b)([(0,E.B)()],S.prototype,"keysRight",void 0),(0,h.b)([(0,E.B)()],S.prototype,"keysReset",void 0),(0,h.b)([(0,E.B)()],S.prototype,"panningSensibility",void 0),(0,h.b)([(0,E.B)()],S.prototype,"zoomingSensibility",void 0),(0,h.b)([(0,E.B)()],S.prototype,"useAltToZoom",void 0),(0,h.b)([(0,E.B)()],S.prototype,"angularSpeed",void 0),k.d.ArcRotateCameraKeyboardMoveInput=S;var c=H(11766),W=H(11997);class B{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new D.io(0,0,0),this._globalOffset=new D.io(0,0,0),this._inertialPanning=D.io.Zero()}_computeDeltaFromMouseWheelLegacyEvent(w,o){let H=0;const h=.01*w*this.wheelDeltaPercentage*o;return H=w>0?h/(1+this.wheelDeltaPercentage):h*(1+this.wheelDeltaPercentage),H}attachControl(w){w=P.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=o=>{if(o.type!==A.d.POINTERWHEEL)return;const H=o.event;let h=0;const E=H.deltaMode===W.c.DOM_DELTA_LINE?40:1,e=-H.deltaY*E;if(this.customComputeDeltaFromMouseWheel)h=this.customComputeDeltaFromMouseWheel(e,this,H);else if(this.wheelDeltaPercentage){if(h=this._computeDeltaFromMouseWheelLegacyEvent(e,this.camera.radius),h>0){let w=this.camera.radius,o=this.camera.inertialRadiusOffset+h;for(let H=0;H<20&&!(w<=o)&&!(Math.abs(o*this.camera.inertia)<.001);H++)w-=o,o*=this.camera.inertia;w=(0,t.Clamp)(w,0,Number.MAX_VALUE),h=this._computeDeltaFromMouseWheelLegacyEvent(e,w)}}else h=e/(40*this.wheelPrecision);h&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(h)):this.camera.inertialRadiusOffset+=h),H.preventDefault&&(w||H.preventDefault())},this._observer=this.camera.Ow()._inputManager._addCameraPointerObserver(this._wheel,A.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Ge(0)}by(){this._observer&&(this.camera.Ow()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const w=this.camera;0+w.inertialAlphaOffset+w.inertialBetaOffset+w.inertialRadiusOffset&&(this._updateHitPlane(),w.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(w.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const w=this.camera,o=w.target.so(w.position);this._hitPlane=c.c.FromPositionAndNormal(w.target,o)}_getPosition(){const w=this.camera,o=w.Ow(),H=o.createPickingRay(o.pointerX,o.pointerY,D.Matrix.Identity(),w,!1);0===w.targetScreenOffset.x&&0===w.targetScreenOffset.y||(this._viewOffset.set(w.targetScreenOffset.x,w.targetScreenOffset.y,0),w.getViewMatrix().invertToRef(w._cameraTransformMatrix),this._globalOffset=D.io.TransformNormal(this._viewOffset,w._cameraTransformMatrix),H.origin.addInPlace(this._globalOffset));let h=0;return this._hitPlane&&(h=H.intersectsPlane(this._hitPlane)??0),H.origin.addInPlace(H.direction.scaleInPlace(h))}_zoomToMouse(w){const o=this.camera,H=1-o.inertia;if(o.lowerRadiusLimit){const h=o.lowerRadiusLimit??0;o.radius-(o.inertialRadiusOffset+w)/H<h&&(w=(o.radius-h)*H-o.inertialRadiusOffset)}if(o.upperRadiusLimit){const h=o.upperRadiusLimit??0;o.radius-(o.inertialRadiusOffset+w)/H>h&&(w=(o.radius-h)*H-o.inertialRadiusOffset)}const h=w/H/o.radius,E=this._getPosition(),e=D.TmpVectors.io[6];E.subtractToRef(o.target,e),e.scaleInPlace(h),e.scaleInPlace(H),this._inertialPanning.addInPlace(e),o.inertialRadiusOffset+=w}_zeroIfClose(w){Math.abs(w.x)<z.c&&(w.x=0),Math.abs(w.y)<z.c&&(w.y=0),Math.abs(w.z)<z.c&&(w.z=0)}}(0,h.b)([(0,E.B)()],B.prototype,"wheelPrecision",void 0),(0,h.b)([(0,E.B)()],B.prototype,"zoomToMouseLocation",void 0),(0,h.b)([(0,E.B)()],B.prototype,"wheelDeltaPercentage",void 0),k.d.ArcRotateCameraMouseWheelInput=B;class J extends k.g{constructor(w){super(w)}addMouseWheel(){return this.add(new B),this}addPointers(){return this.add(new O),this}addKeyboard(){return this.add(new S),this}}var g=H(11666);function b(w,o){return isNaN(w)?o:w}X.c.AddNodeConstructor("ArcRotateCamera",((w,o)=>()=>new p(w,0,0,1,D.io.Zero(),o)));class p extends r.e{get target(){return this._target}set target(w){this.setTarget(w)}get targetHost(){return this._targetHost}set targetHost(w){w&&this.setTarget(w)}getTarget(){return this.target}get position(){return this._position}set position(w){this.setPosition(w)}set upVector(w){this._upToYMatrix||(this._yToUpMatrix=new D.Matrix,this._upToYMatrix=new D.Matrix,this._upVector=D.io.Zero()),w.normalize(),this._upVector.t(w),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){D.Matrix.RotationAlignToRef(D.io.UpReadOnly,this._upVector,this._yToUpMatrix),D.Matrix.RotationAlignToRef(this._upVector,D.io.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const w=this.inputs.attached.pointers;return w?w.angularSensibilityX:0}set angularSensibilityX(w){const o=this.inputs.attached.pointers;o&&(o.angularSensibilityX=w)}get angularSensibilityY(){const w=this.inputs.attached.pointers;return w?w.angularSensibilityY:0}set angularSensibilityY(w){const o=this.inputs.attached.pointers;o&&(o.angularSensibilityY=w)}get pinchPrecision(){const w=this.inputs.attached.pointers;return w?w.pinchPrecision:0}set pinchPrecision(w){const o=this.inputs.attached.pointers;o&&(o.pinchPrecision=w)}get pinchDeltaPercentage(){const w=this.inputs.attached.pointers;return w?w.pinchDeltaPercentage:0}set pinchDeltaPercentage(w){const o=this.inputs.attached.pointers;o&&(o.pinchDeltaPercentage=w)}get useNaturalPinchZoom(){const w=this.inputs.attached.pointers;return!!w&&w.useNaturalPinchZoom}set useNaturalPinchZoom(w){const o=this.inputs.attached.pointers;o&&(o.useNaturalPinchZoom=w)}get panningSensibility(){const w=this.inputs.attached.pointers;return w?w.panningSensibility:0}set panningSensibility(w){const o=this.inputs.attached.pointers;o&&(o.panningSensibility=w)}get keysUp(){const w=this.inputs.attached.keyboard;return w?w.keysUp:[]}set keysUp(w){const o=this.inputs.attached.keyboard;o&&(o.keysUp=w)}get keysDown(){const w=this.inputs.attached.keyboard;return w?w.keysDown:[]}set keysDown(w){const o=this.inputs.attached.keyboard;o&&(o.keysDown=w)}get keysLeft(){const w=this.inputs.attached.keyboard;return w?w.keysLeft:[]}set keysLeft(w){const o=this.inputs.attached.keyboard;o&&(o.keysLeft=w)}get keysRight(){const w=this.inputs.attached.keyboard;return w?w.keysRight:[]}set keysRight(w){const o=this.inputs.attached.keyboard;o&&(o.keysRight=w)}get wheelPrecision(){const w=this.inputs.attached.mousewheel;return w?w.wheelPrecision:0}set wheelPrecision(w){const o=this.inputs.attached.mousewheel;o&&(o.wheelPrecision=w)}get zoomToMouseLocation(){const w=this.inputs.attached.mousewheel;return!!w&&w.zoomToMouseLocation}set zoomToMouseLocation(w){const o=this.inputs.attached.mousewheel;o&&(o.zoomToMouseLocation=w)}get wheelDeltaPercentage(){const w=this.inputs.attached.mousewheel;return w?w.wheelDeltaPercentage:0}set wheelDeltaPercentage(w){const o=this.inputs.attached.mousewheel;o&&(o.wheelDeltaPercentage=w)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(w){w!==this.useBouncingBehavior&&(w?(this._bouncingBehavior=new i,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(w){w!==this.useFramingBehavior&&(w?(this._framingBehavior=new s,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(w){w!==this.useAutoRotationBehavior&&(w?(this._autoRotationBehavior=new C,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(w,o,H,h,E,t){var X;let L=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(w,D.io.Zero(),t,L),X=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=D.io.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=D.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new D.Matrix,this.panningAxis=new D.io(1,1,0),this._transformedDirection=new D.io,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new e.b,this.checkCollisions=!1,this.collisionRadius=new D.io(.5,.5,.5),this._previousPosition=D.io.Zero(),this._collisionVelocity=D.io.Zero(),this._newPosition=D.io.Zero(),this._computationVector=D.io.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new D.io(NaN,NaN,NaN),this._goalTargetScreenOffset=new D.Vector2(NaN,NaN),this._onCollisionPositionChange=function(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H?(X.setPosition(o),X.PC&&X.PC(H)):X._previousPosition.t(X._position);const h=Math.cos(X.alpha),E=Math.sin(X.alpha),e=Math.cos(X.beta);let D=Math.sin(X.beta);0===D&&(D=1e-4);const t=X._getTargetPosition();X._computationVector.We(X.radius*h*D,X.radius*e,X.radius*E*D),t.addToRef(X._computationVector,X._newPosition),X._position.t(X._newPosition);let L=X.upVector;X.allowUpsideDown&&X.beta<0&&(L=L.clone(),L=L.negate()),X._computeViewMatrix(X._position,t,L),X._viewMatrix.addAtIndex(12,X.targetScreenOffset.x),X._viewMatrix.addAtIndex(13,X.targetScreenOffset.y),X._collisionTriggered=!1},this._target=D.io.Zero(),E&&this.setTarget(E),this.alpha=o,this.beta=H,this.radius=h,this.getViewMatrix(),this.inputs=new J(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new D.io(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=D.Vector2.Zero()}_updateCache(w){w||super._updateCache(),this._cache._target.t(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.t(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const w=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?w.addToRef(this._targetBoundingCenter,this._target):this._target.t(w)}const w=this._getLockedTargetPosition();return w||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>z.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,e=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=e?this._currentInterpolationFactor=e:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=b(w,this._goalAlpha),this._goalBeta=b(o,this._goalBeta),this._goalRadius=b(H,this._goalRadius),this._goalTarget.set(b(h.x,this._goalTarget.x),b(h.y,this._goalTarget.y),b(h.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(b(E.x,this._goalTargetScreenOffset.x),b(E.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,t.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,t.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,t.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,t.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(w,o){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const E=arguments;o=P.Tools.BackCompatCameraNoPreventDefault(E),this._useCtrlForPanning=H,this._panningMouseButton=h,"boolean"===typeof E[0]&&(E.length>1&&(this._useCtrlForPanning=E[1]),E.length>2&&(this._panningMouseButton=E[2])),this.inputs.attachElement(o),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}by(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let w=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){w=!0;const o=this.invertRotation?-1:1,H=this._calculateHandednessMultiplier();let h=this.inertialAlphaOffset*H;this.beta<0&&(h*=-1),this.alpha+=h*o,this.beta+=this.inertialBetaOffset*o,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<z.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<z.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*z.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){w=!0;const o=new D.io(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),o.multiplyInPlace(this.panningAxis),D.io.TransformNormalToRef(o,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const w=this.upVector,o=D.io.CrossToRef(this._transformedDirection,w,this._transformedDirection);D.io.CrossToRef(w,o,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);D.io.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.t(this._transformedDirection)}else{if(this.parent){const w=D.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(w),w.transposeToRef(w),D.io.TransformCoordinatesToRef(this._transformedDirection,w,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*z.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*z.c&&(this.inertialPanningY=0)}if(w)this.stopInterpolation();else if(this._isInterpolating){let w=!1;const o=this._scene.getEngine().getDeltaTime()/1e3,H=1-Math.pow(2,-o/this._currentInterpolationFactor),h=b(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const o=D.TmpVectors.io[0].set(b(this._goalTarget.x,this._target.x),b(this._goalTarget.y,this._target.y),b(this._goalTarget.z,this._target.z));D.io.LerpToRef(this.target,o,H,this._target),10*D.io.Distance(this.target,o)/h<z.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.t(o),this.setTarget(this.target,!1,!0,!0)):w=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const o=D.Quaternion.RotationAlphaBetaGammaToRef(b(this._goalAlpha,this.alpha),b(this._goalBeta,this.beta),0,D.TmpVectors.Quaternion[0]),h=D.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,D.TmpVectors.Quaternion[1]),E=D.Quaternion.SlerpToRef(h,o,H,D.TmpVectors.Quaternion[2]);E.normalize();const e=E.toAlphaBetaGammaToRef(D.TmpVectors.io[0]);if(this.alpha=e.x,this.beta=e.y,E.isApprox(o,z.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const w=o.toAlphaBetaGammaToRef(D.TmpVectors.io[0]);this.alpha=w.x,this.beta=w.y}else w=!0}if(isNaN(this._goalRadius)||(this.radius+=(h-this.radius)*H,Math.abs(h/this.radius-1)<z.c?(this._goalRadius=NaN,this.radius=h):w=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const o=D.TmpVectors.Vector2[0].set(b(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),b(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));D.Vector2.LerpToRef(this.targetScreenOffset,o,H,this.targetScreenOffset),D.Vector2.Distance(this.targetScreenOffset,o)<z.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.t(o)):w=!0}this._isInterpolating=w}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||D.io.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const w=this.alpha;var o,H;this.alpha=function(w){let o=Math.PI/2;return 0===w.x&&0===w.z||(o=Math.acos(w.x/Math.sqrt(Math.pow(w.x,2)+Math.pow(w.z,2)))),w.z<0&&(o=2*Math.PI-o),o}(this._computationVector),this.beta=(o=this._computationVector.y,H=this.radius,Math.acos(o/H));const h=Math.round((w-this.alpha)/(2*Math.PI));this.alpha+=2*h*Math.PI,this._checkLimits()}setPosition(w){this._position.equals(w)||(this._position.t(w),this.rebuildAnglesAndRadius())}setTarget(w){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(h=this.overrideCloneAlphaBetaRadius??h,w.se)o&&w.getBoundingInfo?this._targetBoundingCenter=w.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,w.se(),this._targetHost=w,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const o=w,h=this._getTargetPosition();if(h&&!H&&h.equals(o))return;this._targetHost=null,this._target=o,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}h||this.rebuildAnglesAndRadius()}_getViewMatrix(){const w=Math.cos(this.alpha),o=Math.sin(this.alpha),H=Math.cos(this.beta);let h=Math.sin(this.beta);0===h&&(h=1e-4),0===this.radius&&(this.radius=1e-4);const E=this._getTargetPosition();if(this._computationVector.We(this.radius*w*h,this.radius*H,this.radius*o*h),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||D.io.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),E.addToRef(this._computationVector,this._newPosition),this.Ow().collisionsEnabled&&this.checkCollisions){const w=this.Ow().collisionCoordinator;this._collider||(this._collider=w.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,w.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.t(this._newPosition);let w=this.upVector;this.allowUpsideDown&&h<0&&(w=w.negate()),this._computeViewMatrix(this._position,E,w),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.t(E),this._viewMatrix}zoomOn(w){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];w=w||this.Ow().meshes;const H=L.d.MinMax(w);let h=this._calculateLowerRadiusFromModelBoundingSphere(H.min,H.max);if(h=Math.max(Math.min(h,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=h*this.zoomOnFactor,this.mode===V.e.ORTHOGRAPHIC_CAMERA){const w=this.Ow().getEngine().getAspectRatio(this),o=h*this.zoomOnFactor/2;this.orthoLeft=-o*w,this.orthoRight=o*w,this.orthoBottom=-o,this.orthoTop=o}this.focusOn({min:H.min,max:H.max,distance:h},o)}focusOn(w){let o,H,h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===w.min){const h=w||this.Ow().meshes;o=L.d.MinMax(h),H=D.io.Distance(o.min,o.max)}else{o=w,H=w.distance}this._target=L.d.Center(o),h||(this.maxZ=2*H)}createRigCamera(w,o){let H=0;switch(this.cameraRigMode){case V.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case V.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case V.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case V.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case V.e.RIG_MODE_VR:H=this._cameraRigParams.stereoHalfAngle*(0===o?1:-1);break;case V.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:H=this._cameraRigParams.stereoHalfAngle*(0===o?-1:1)}const h=new p(w,this.alpha+H,this.beta,this.radius,this._target,this.Ow());return h._cameraRigParams={},h.isRigCamera=!0,h.rigParent=this,h.upVector=this.upVector,h.mode=this.mode,h.orthoLeft=this.orthoLeft,h.orthoRight=this.orthoRight,h.orthoBottom=this.orthoBottom,h.orthoTop=this.orthoTop,h}_updateRigCameras(){const w=this._rigCameras[0],o=this._rigCameras[1];switch(w.beta=o.beta=this.beta,this.cameraRigMode){case V.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case V.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case V.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case V.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case V.e.RIG_MODE_VR:w.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,o.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case V.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:w.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,o.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const h=D.io.Distance(w,o),E=this.Ow().getEngine().getAspectRatio(this),e=Math.tan(this.fov/2),t=e*E,X=.5*h*H,L=X*Math.sqrt(1+1/(t*t)),A=X*Math.sqrt(1+1/(e*e));return Math.max(L,A)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,h.b)([(0,E.B)()],p.prototype,"alpha",void 0),(0,h.b)([(0,E.B)()],p.prototype,"beta",void 0),(0,h.b)([(0,E.B)()],p.prototype,"radius",void 0),(0,h.b)([(0,E.B)()],p.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,h.b)([(0,E.A)("target")],p.prototype,"_target",void 0),(0,h.b)([(0,E.r)("targetHost")],p.prototype,"_targetHost",void 0),(0,h.b)([(0,E.B)()],p.prototype,"inertialAlphaOffset",void 0),(0,h.b)([(0,E.B)()],p.prototype,"inertialBetaOffset",void 0),(0,h.b)([(0,E.B)()],p.prototype,"inertialRadiusOffset",void 0),(0,h.b)([(0,E.B)()],p.prototype,"lowerAlphaLimit",void 0),(0,h.b)([(0,E.B)()],p.prototype,"upperAlphaLimit",void 0),(0,h.b)([(0,E.B)()],p.prototype,"lowerBetaLimit",void 0),(0,h.b)([(0,E.B)()],p.prototype,"upperBetaLimit",void 0),(0,h.b)([(0,E.B)()],p.prototype,"lowerRadiusLimit",void 0),(0,h.b)([(0,E.B)()],p.prototype,"upperRadiusLimit",void 0),(0,h.b)([(0,E.B)()],p.prototype,"lowerTargetYLimit",void 0),(0,h.b)([(0,E.B)()],p.prototype,"inertialPanningX",void 0),(0,h.b)([(0,E.B)()],p.prototype,"inertialPanningY",void 0),(0,h.b)([(0,E.B)()],p.prototype,"pinchToPanMaxDistance",void 0),(0,h.b)([(0,E.B)()],p.prototype,"panningDistanceLimit",void 0),(0,h.b)([(0,E.A)()],p.prototype,"panningOriginTarget",void 0),(0,h.b)([(0,E.B)()],p.prototype,"panningInertia",void 0),(0,h.b)([(0,E.B)()],p.prototype,"zoomToMouseLocation",null),(0,h.b)([(0,E.B)()],p.prototype,"zoomOnFactor",void 0),(0,h.b)([(0,E.y)()],p.prototype,"targetScreenOffset",void 0),(0,h.b)([(0,E.B)()],p.prototype,"allowUpsideDown",void 0),(0,h.b)([(0,E.B)()],p.prototype,"useInputToRestoreState",void 0),(0,h.b)([(0,E.B)()],p.prototype,"restoreStateInterpolationFactor",void 0),(0,g.g)("BABYLON.ArcRotateCamera",p)},13364:(w,o,H)=>{"use strict";H.d(o,{d:()=>D,g:()=>t});var h=H(11551),E=H(11745),e=H(12167),D={};class t{constructor(w){this.attachedToElement=!1,this.attached={},this.camera=w,this.checkInputs=()=>{}}add(w){const o=w.getSimpleName();this.attached[o]?h.d.Warn("camera input of type "+o+" already exists on camera"):(this.attached[o]=w,w.camera=this.camera,w.checkInputs&&(this.checkInputs=this._addCheckInputs(w.checkInputs.bind(w))),this.attachedToElement&&w.attachControl(this.noPreventDefault))}remove(w){for(const o in this.attached){const H=this.attached[o];if(H===w)return H.by(),H.camera=null,delete this.attached[o],void this.rebuildInputCheck()}}removeByType(w){for(const o in this.attached){const H=this.attached[o];H.getClassName()===w&&(H.by(),H.camera=null,delete this.attached[o],this.rebuildInputCheck())}}_addCheckInputs(w){const o=this.checkInputs;return()=>{o(),w()}}attachInput(w){this.attachedToElement&&w.attachControl(this.noPreventDefault)}attachElement(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){w=!e.e.ForceAttachControlToAlwaysPreventDefault&&w,this.attachedToElement=!0,this.noPreventDefault=w;for(const o in this.attached)this.attached[o].attachControl(w)}}detachElement(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const o in this.attached)this.attached[o].by(),w&&(this.attached[o].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const w in this.attached){const o=this.attached[w];o.checkInputs&&(this.checkInputs=this._addCheckInputs(o.checkInputs.bind(o)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(w){const o={};for(const H in this.attached){const w=this.attached[H],h=E.e.Serialize(w);o[w.getClassName()]=h}w.inputsmgr=o}parse(w){const o=w.inputsmgr;if(o){this.clear();for(const w in o){const H=D[w];if(H){const h=o[w],e=E.e.Parse((()=>new H),h,null);this.add(e)}}}else for(const H in this.attached){const o=D[this.attached[H].getClassName()];if(o){const h=E.e.Parse((()=>new o),w,null);this.remove(this.attached[H]),this.add(h)}}}}},13355:(w,o,H)=>{"use strict";H.d(o,{c:()=>l});var h=H(11697),E=H(11702),e=H(11720),D=H(12196),t=H(13364),X=H(11994),L=H(11531);class A{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(w){w=L.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ow(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((o=>{const H=o.event;if(!H.metaKey)if(o.type===X.e.KEYDOWN){if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysUpward.indexOf(H.keyCode)||-1!==this.keysDownward.indexOf(H.keyCode)||-1!==this.keysRotateLeft.indexOf(H.keyCode)||-1!==this.keysRotateRight.indexOf(H.keyCode)||-1!==this.keysRotateUp.indexOf(H.keyCode)||-1!==this.keysRotateDown.indexOf(H.keyCode)){-1===this._keys.indexOf(H.keyCode)&&this._keys.push(H.keyCode),w||H.preventDefault()}}else if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysUpward.indexOf(H.keyCode)||-1!==this.keysDownward.indexOf(H.keyCode)||-1!==this.keysRotateLeft.indexOf(H.keyCode)||-1!==this.keysRotateRight.indexOf(H.keyCode)||-1!==this.keysRotateUp.indexOf(H.keyCode)||-1!==this.keysRotateDown.indexOf(H.keyCode)){const o=this._keys.indexOf(H.keyCode);o>=0&&this._keys.splice(o,1),w||H.preventDefault()}})))}by(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const w=this.camera;for(let o=0;o<this._keys.length;o++){const H=this._keys[o],h=w._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(H)?w._localDirection.We(-h,0,0):-1!==this.keysUp.indexOf(H)?w._localDirection.We(0,0,h):-1!==this.keysRight.indexOf(H)?w._localDirection.We(h,0,0):-1!==this.keysDown.indexOf(H)?w._localDirection.We(0,0,-h):-1!==this.keysUpward.indexOf(H)?w._localDirection.We(0,h,0):-1!==this.keysDownward.indexOf(H)?w._localDirection.We(0,-h,0):-1!==this.keysRotateLeft.indexOf(H)?(w._localDirection.We(0,0,0),w.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(H)?(w._localDirection.We(0,0,0),w.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(H)?(w._localDirection.We(0,0,0),w.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(H)&&(w._localDirection.We(0,0,0),w.cameraRotation.x+=this._getLocalRotation()),w.Ow().useRightHandedSystem&&(w._localDirection.z*=-1),w.getViewMatrix().invertToRef(w._cameraTransformMatrix),e.io.TransformNormalToRef(w._localDirection,w._cameraTransformMatrix,w._transformedDirection),w.cameraDirection.addInPlace(w._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const w=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*w}}(0,h.b)([(0,E.B)()],A.prototype,"keysUp",void 0),(0,h.b)([(0,E.B)()],A.prototype,"keysUpward",void 0),(0,h.b)([(0,E.B)()],A.prototype,"keysDown",void 0),(0,h.b)([(0,E.B)()],A.prototype,"keysDownward",void 0),(0,h.b)([(0,E.B)()],A.prototype,"keysLeft",void 0),(0,h.b)([(0,E.B)()],A.prototype,"keysRight",void 0),(0,h.b)([(0,E.B)()],A.prototype,"rotationSpeed",void 0),(0,h.b)([(0,E.B)()],A.prototype,"keysRotateLeft",void 0),(0,h.b)([(0,E.B)()],A.prototype,"keysRotateRight",void 0),(0,h.b)([(0,E.B)()],A.prototype,"keysRotateUp",void 0),(0,h.b)([(0,E.B)()],A.prototype,"keysRotateDown",void 0),t.d.FreeCameraKeyboardMoveInput=A;var y=H(11540),z=H(11991);class C{constructor(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=w,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new y.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(w){w=L.Tools.BackCompatCameraNoPreventDefault(arguments);const o=this.camera.getEngine(),H=o.getInputElement();this._pointerInput||(this._pointerInput=h=>{const E=h.event,e="touch"===E.pointerType;if(!this.touchEnabled&&e)return;if(h.type!==z.d.POINTERMOVE&&-1===this.buttons.indexOf(E.button))return;const D=E.target;if(h.type===z.d.POINTERDOWN){if(e&&-1!==this._activePointerId||!e&&-1!==this._currentActiveButton)return;this._activePointerId=E.pointerId;try{null===D||void 0===D||D.setPointerCapture(E.pointerId)}catch(t){}-1===this._currentActiveButton&&(this._currentActiveButton=E.button),this._previousPosition={x:E.clientX,y:E.clientY},w||(E.preventDefault(),H&&H.focus()),o.isPointerLock&&this._onMouseMove&&this._onMouseMove(h.event)}else if(h.type===z.d.POINTERUP){if(e&&this._activePointerId!==E.pointerId||!e&&this._currentActiveButton!==E.button)return;try{null===D||void 0===D||D.releasePointerCapture(E.pointerId)}catch(t){}this._currentActiveButton=-1,this._previousPosition=null,w||E.preventDefault(),this._activePointerId=-1}else if(h.type===z.d.POINTERMOVE&&(this._activePointerId===E.pointerId||!e))if(o.isPointerLock&&this._onMouseMove)this._onMouseMove(h.event);else if(this._previousPosition){const o=this.camera._calculateHandednessMultiplier(),H=(E.clientX-this._previousPosition.x)*o,h=E.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=H/this.angularSensibility,this.camera.cameraRotation.x+=h/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:H,offsetY:h}),this._previousPosition={x:E.clientX,y:E.clientY},w||E.preventDefault()}}),this._onMouseMove=H=>{if(!o.isPointerLock)return;const h=this.camera._calculateHandednessMultiplier(),E=H.movementX*h;this.camera.cameraRotation.y+=E/this.angularSensibility;const e=H.movementY;this.camera.cameraRotation.x+=e/this.angularSensibility,this._previousPosition=null,w||H.preventDefault()},this._observer=this.camera.Ow()._inputManager._addCameraPointerObserver(this._pointerInput,z.d.POINTERDOWN|z.d.POINTERUP|z.d.POINTERMOVE),H&&(this._contextMenuBind=w=>this.onContextMenu(w),H.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(w){w.preventDefault()}by(){if(this._observer){if(this.camera.Ow()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const w=this.camera.getEngine().getInputElement();w&&w.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,h.b)([(0,E.B)()],C.prototype,"buttons",void 0),(0,h.b)([(0,E.B)()],C.prototype,"angularSensibility",void 0),t.d.FreeCameraMouseInput=C;var Q,M=H(11997);class i{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new y.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(w){w=L.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=o=>{if(o.type!==z.d.POINTERWHEEL)return;const H=o.event,h=H.deltaMode===M.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*h*H.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*h*H.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*h*H.deltaZ/this._normalize,H.preventDefault&&(w||H.preventDefault())},this._observer=this.camera.Ow()._inputManager._addCameraPointerObserver(this._wheel,z.d.POINTERWHEEL)}by(){this._observer&&(this.camera.Ow()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,h.b)([(0,E.B)()],i.prototype,"wheelPrecisionX",void 0),(0,h.b)([(0,E.B)()],i.prototype,"wheelPrecisionY",void 0),(0,h.b)([(0,E.B)()],i.prototype,"wheelPrecisionZ",void 0),function(w){w[w.MoveRelative=0]="MoveRelative",w[w.RotateRelative=1]="RotateRelative",w[w.MoveScene=2]="MoveScene"}(Q||(Q={}));class s extends i{constructor(){super(...arguments),this._moveRelative=e.io.Zero(),this._rotateRelative=e.io.Zero(),this._moveScene=e.io.Zero(),this._wheelXAction=Q.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=Q.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(w){null===w&&this._wheelXAction!==Q.MoveRelative||(this._wheelXAction=Q.MoveRelative,this._wheelXActionCoordinate=w)}get wheelXMoveRelative(){return this._wheelXAction!==Q.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(w){null===w&&this._wheelYAction!==Q.MoveRelative||(this._wheelYAction=Q.MoveRelative,this._wheelYActionCoordinate=w)}get wheelYMoveRelative(){return this._wheelYAction!==Q.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(w){null===w&&this._wheelZAction!==Q.MoveRelative||(this._wheelZAction=Q.MoveRelative,this._wheelZActionCoordinate=w)}get wheelZMoveRelative(){return this._wheelZAction!==Q.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(w){null===w&&this._wheelXAction!==Q.RotateRelative||(this._wheelXAction=Q.RotateRelative,this._wheelXActionCoordinate=w)}get wheelXRotateRelative(){return this._wheelXAction!==Q.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(w){null===w&&this._wheelYAction!==Q.RotateRelative||(this._wheelYAction=Q.RotateRelative,this._wheelYActionCoordinate=w)}get wheelYRotateRelative(){return this._wheelYAction!==Q.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(w){null===w&&this._wheelZAction!==Q.RotateRelative||(this._wheelZAction=Q.RotateRelative,this._wheelZActionCoordinate=w)}get wheelZRotateRelative(){return this._wheelZAction!==Q.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(w){null===w&&this._wheelXAction!==Q.MoveScene||(this._wheelXAction=Q.MoveScene,this._wheelXActionCoordinate=w)}get wheelXMoveScene(){return this._wheelXAction!==Q.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(w){null===w&&this._wheelYAction!==Q.MoveScene||(this._wheelYAction=Q.MoveScene,this._wheelYActionCoordinate=w)}get wheelYMoveScene(){return this._wheelYAction!==Q.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(w){null===w&&this._wheelZAction!==Q.MoveScene||(this._wheelZAction=Q.MoveScene,this._wheelZActionCoordinate=w)}get wheelZMoveScene(){return this._wheelZAction!==Q.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Ge(0),this._rotateRelative.Ge(0),this._moveScene.Ge(0),this._updateCamera(),this.camera.Ow().useRightHandedSystem&&(this._moveRelative.z*=-1);const w=e.Matrix.Zero();this.camera.getViewMatrix().invertToRef(w);const o=e.io.Zero();e.io.TransformNormalToRef(this._moveRelative,w,o),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(o),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(w,o,H){if(0===w)return;if(null===o||null===H)return;let h=null;switch(o){case Q.MoveRelative:h=this._moveRelative;break;case Q.RotateRelative:h=this._rotateRelative;break;case Q.MoveScene:h=this._moveScene}switch(H){case 0:h.set(w,0,0);break;case 1:h.set(0,w,0);break;case 2:h.set(0,0,w)}}}(0,h.b)([(0,E.B)()],s.prototype,"wheelXMoveRelative",null),(0,h.b)([(0,E.B)()],s.prototype,"wheelYMoveRelative",null),(0,h.b)([(0,E.B)()],s.prototype,"wheelZMoveRelative",null),(0,h.b)([(0,E.B)()],s.prototype,"wheelXRotateRelative",null),(0,h.b)([(0,E.B)()],s.prototype,"wheelYRotateRelative",null),(0,h.b)([(0,E.B)()],s.prototype,"wheelZRotateRelative",null),(0,h.b)([(0,E.B)()],s.prototype,"wheelXMoveScene",null),(0,h.b)([(0,E.B)()],s.prototype,"wheelYMoveScene",null),(0,h.b)([(0,E.B)()],s.prototype,"wheelZMoveScene",null),t.d.FreeCameraMouseWheelInput=s;class V{constructor(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=w,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=L.Tools.IsSafari()}attachControl(w){w=L.Tools.BackCompatCameraNoPreventDefault(arguments);let o=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=H=>{const h=H.event,E="mouse"===h.pointerType||this._isSafari&&"undefined"===typeof h.pointerType;if(this.allowMouse||!E)if(H.type===z.d.POINTERDOWN){if(w||h.preventDefault(),this._pointerPressed.push(h.pointerId),1!==this._pointerPressed.length)return;o={x:h.clientX,y:h.clientY}}else if(H.type===z.d.POINTERUP){w||h.preventDefault();const H=this._pointerPressed.indexOf(h.pointerId);if(-1===H)return;if(this._pointerPressed.splice(H,1),0!=H)return;o=null,this._offsetX=null,this._offsetY=null}else if(H.type===z.d.POINTERMOVE){if(w||h.preventDefault(),!o)return;if(0!=this._pointerPressed.indexOf(h.pointerId))return;this._offsetX=h.clientX-o.x,this._offsetY=-(h.clientY-o.y)}}),this._observer=this.camera.Ow()._inputManager._addCameraPointerObserver(this._pointerInput,z.d.POINTERDOWN|z.d.POINTERUP|z.d.POINTERMOVE),this._onLostFocus){const w=this.camera.getEngine().getInputElement();w&&w.addEventListener("blur",this._onLostFocus)}}by(){if(this._pointerInput){if(this._observer&&(this.camera.Ow()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const w=this.camera.getEngine().getInputElement();w&&w.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const w=this.camera,o=w._calculateHandednessMultiplier();w.cameraRotation.y=o*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)w.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const o=w._computeLocalCameraSpeed(),H=new e.io(0,0,0!==this.touchMoveSensibility?o*this._offsetY/this.touchMoveSensibility:0);e.Matrix.RotationYawPitchRollToRef(w.rotation.y,w.rotation.x,0,w._cameraRotationMatrix),w.cameraDirection.addInPlace(e.io.TransformCoordinates(H,w._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,h.b)([(0,E.B)()],V.prototype,"touchAngularSensibility",void 0),(0,h.b)([(0,E.B)()],V.prototype,"touchMoveSensibility",void 0),t.d.FreeCameraTouchInput=V;class r extends t.g{constructor(w){super(w),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new A),this}addMouse(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new C(w),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new s,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new V),this}clear(){super.clear(),this._mouseInput=null}}var k=H(11666),P=H(11615);class l extends D.e{get angularSensibility(){const w=this.inputs.attached.mouse;return w?w.angularSensibility:0}set angularSensibility(w){const o=this.inputs.attached.mouse;o&&(o.angularSensibility=w)}get keysUp(){const w=this.inputs.attached.keyboard;return w?w.keysUp:[]}set keysUp(w){const o=this.inputs.attached.keyboard;o&&(o.keysUp=w)}get keysUpward(){const w=this.inputs.attached.keyboard;return w?w.keysUpward:[]}set keysUpward(w){const o=this.inputs.attached.keyboard;o&&(o.keysUpward=w)}get keysDown(){const w=this.inputs.attached.keyboard;return w?w.keysDown:[]}set keysDown(w){const o=this.inputs.attached.keyboard;o&&(o.keysDown=w)}get keysDownward(){const w=this.inputs.attached.keyboard;return w?w.keysDownward:[]}set keysDownward(w){const o=this.inputs.attached.keyboard;o&&(o.keysDownward=w)}get keysLeft(){const w=this.inputs.attached.keyboard;return w?w.keysLeft:[]}set keysLeft(w){const o=this.inputs.attached.keyboard;o&&(o.keysLeft=w)}get keysRight(){const w=this.inputs.attached.keyboard;return w?w.keysRight:[]}set keysRight(w){const o=this.inputs.attached.keyboard;o&&(o.keysRight=w)}get keysRotateLeft(){const w=this.inputs.attached.keyboard;return w?w.keysRotateLeft:[]}set keysRotateLeft(w){const o=this.inputs.attached.keyboard;o&&(o.keysRotateLeft=w)}get keysRotateRight(){const w=this.inputs.attached.keyboard;return w?w.keysRotateRight:[]}set keysRotateRight(w){const o=this.inputs.attached.keyboard;o&&(o.keysRotateRight=w)}get keysRotateUp(){const w=this.inputs.attached.keyboard;return w?w.keysRotateUp:[]}set keysRotateUp(w){const o=this.inputs.attached.keyboard;o&&(o.keysRotateUp=w)}get keysRotateDown(){const w=this.inputs.attached.keyboard;return w?w.keysRotateDown:[]}set keysRotateDown(w){const o=this.inputs.attached.keyboard;o&&(o.keysRotateDown=w)}constructor(w,o,H){var h;super(w,o,H,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),h=this,this.ellipsoid=new e.io(.5,1,.5),this.ellipsoidOffset=new e.io(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=e.io.Zero(),this._diffPosition=e.io.Zero(),this._newPosition=e.io.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h._newPosition.t(o),h._newPosition.subtractToRef(h._oldPosition,h._diffPosition),h._diffPosition.length()>P.c.CollisionsEpsilon&&(h.position.addToRef(h._diffPosition,h._deferredPositionUpdate),h._deferOnly?h._deferredUpdated=!0:h.position.t(h._deferredPositionUpdate),h.PC&&H&&h.PC(H))},this.inputs=new r(this),this.inputs.addKeyboard().addMouse()}attachControl(w,o){o=L.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(o)}by(){this.inputs.detachElement(),this.cameraDirection=new e.io(0,0,0),this.cameraRotation=new e.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(w){this._collisionMask=isNaN(w)?-1:w}_collideWithWorld(w){let o;o=this.parent?e.io.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,o.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const H=this.Ow().collisionCoordinator;this._collider||(this._collider=H.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let h=w;this.applyGravity&&(h=w.add(this.Ow().gravity)),H.getNewPosition(this._oldPosition,h,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=e.io.Zero(),this._transformedDirection=e.io.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(w){this._needMoveForGravity=w}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Ow().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"py"}}(0,h.b)([(0,E.A)()],l.prototype,"ellipsoid",void 0),(0,h.b)([(0,E.A)()],l.prototype,"ellipsoidOffset",void 0),(0,h.b)([(0,E.B)()],l.prototype,"checkCollisions",void 0),(0,h.b)([(0,E.B)()],l.prototype,"applyGravity",void 0),(0,k.g)("BABYLON.FreeCamera",l)},14002:(w,o,H)=>{"use strict";H.d(o,{b:()=>e});var h=H(11807),E=H(14005);class e{constructor(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=H,this.vA=[],this._maxBlockCapacity=o||64,this._selectionContent=new h.e(1024),this._creationFunc=w}update(w,o,H){E.d._CreateBlocks(w,o,H,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}hA(w){for(let o=0;o<this.MA.length;o++){this.MA[o].addEntry(w)}}HA(w){for(let o=0;o<this.MA.length;o++){this.MA[o].removeEntry(w)}}select(w,o){this._selectionContent.reset();for(let H=0;H<this.MA.length;H++){this.MA[H].select(w,this._selectionContent,o)}return o?this._selectionContent.concat(this.vA):this._selectionContent.concatWithNoDuplicate(this.vA),this._selectionContent}intersects(w,o,H){this._selectionContent.reset();for(let h=0;h<this.MA.length;h++){this.MA[h].intersects(w,o,this._selectionContent,H)}return H?this._selectionContent.concat(this.vA):this._selectionContent.concatWithNoDuplicate(this.vA),this._selectionContent}intersectsRay(w){this._selectionContent.reset();for(let o=0;o<this.MA.length;o++){this.MA[o].intersectsRay(w,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.vA),this._selectionContent}}e.CreationFuncForMeshes=(w,o)=>{const H=w.getBoundingInfo();!w.isBlocked&&H.boundingBox.intersectsMinMax(o.oy,o.Hy)&&o.entries.push(w)},e.CreationFuncForSubMeshes=(w,o)=>{w.getBoundingInfo().boundingBox.intersectsMinMax(o.oy,o.Hy)&&o.entries.push(w)}},14005:(w,o,H)=>{"use strict";H.d(o,{d:()=>e});var h=H(11720),E=H(12055);class e{constructor(w,o,H,h,E,e){this.entries=[],this.hy=new Array,this._capacity=H,this._depth=h,this._maxDepth=E,this._creationFunc=e,this._minPoint=w,this._maxPoint=o,this.hy.push(w.clone()),this.hy.push(o.clone()),this.hy.push(w.clone()),this.hy[2].x=o.x,this.hy.push(w.clone()),this.hy[3].y=o.y,this.hy.push(w.clone()),this.hy[4].z=o.z,this.hy.push(o.clone()),this.hy[5].z=w.z,this.hy.push(o.clone()),this.hy[6].x=w.x,this.hy.push(o.clone()),this.hy[7].y=w.y}get no(){return this._capacity}get oy(){return this._minPoint}get Hy(){return this._maxPoint}addEntry(w){if(this.MA)for(let o=0;o<this.MA.length;o++){this.MA[o].addEntry(w)}else this._creationFunc(w,this),this.entries.length>this.no&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(w){if(this.MA){for(let o=0;o<this.MA.length;o++){this.MA[o].removeEntry(w)}return}const o=this.entries.indexOf(w);o>-1&&this.entries.splice(o,1)}addEntries(w){for(let o=0;o<w.length;o++){const H=w[o];this.addEntry(H)}}select(w,o,H){if(E.c.IsInFrustum(this.hy,w)){if(this.MA){for(let h=0;h<this.MA.length;h++){this.MA[h].select(w,o,H)}return}H?o.concat(this.entries):o.concatWithNoDuplicate(this.entries)}}intersects(w,o,H,h){if(E.c.IntersectsSphere(this._minPoint,this._maxPoint,w,o)){if(this.MA){for(let E=0;E<this.MA.length;E++){this.MA[E].intersects(w,o,H,h)}return}h?H.concat(this.entries):H.concatWithNoDuplicate(this.entries)}}intersectsRay(w,o){if(w.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.MA){for(let H=0;H<this.MA.length;H++){this.MA[H].intersectsRay(w,o)}return}o.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){e._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(w,o,H,E,D,t,X,L){X.MA=new Array;const A=new h.io((o.x-w.x)/2,(o.y-w.y)/2,(o.z-w.z)/2);for(let h=0;h<2;h++)for(let o=0;o<2;o++)for(let y=0;y<2;y++){const z=w.add(A.multiplyByFloats(h,o,y)),C=w.add(A.multiplyByFloats(h+1,o+1,y+1)),Q=new e(z,C,E,D+1,t,L);Q.addEntries(H),X.MA.push(Q)}}}},14014:(w,o,H)=>{"use strict";H.d(o,{e:()=>A});var h=H(11957),E=H(11720),e=H(12135),D=H(13118),t=H(11987),X=H(14002),L=H(11571);h.e.prototype.createOrUpdateSelectionOctree=function(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,H=this._getComponent(t.c.NAME_OCTREE);H||(H=new A(this),this.o(H)),this.KA||(this.KA=new X.b(X.b.CreationFuncForMeshes,w,o));const h=this.getWorldExtends();return this.KA.update(h.min,h.max,this.meshes),this.KA},Object.defineProperty(h.e.prototype,"selectionOctree",{get:function(){return this.KA},enumerable:!0,configurable:!0}),e.c.prototype.createOrUpdateSubmeshesOctree=function(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const H=this.Ow();let h=H._getComponent(t.c.NAME_OCTREE);h||(h=new A(H),H.o(h)),this._submeshesOctree||(this._submeshesOctree=new X.b(X.b.CreationFuncForSubMeshes,w,o)),this.se(!0);const E=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(E.minimumWorld,E.maximumWorld,this.Le),this._submeshesOctree};class A{constructor(w){this.name=t.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new D.b(E.io.Zero(),new E.io(1,1,1)),(w=w||L.e.LastCreatedScene)&&(this.Vo=w,this.Vo.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Vo.getActiveSubMeshCandidates=w=>this.getActiveSubMeshCandidates(w),this.Vo.getCollidingSubMeshCandidates=(w,o)=>this.getCollidingSubMeshCandidates(w,o),this.Vo.getIntersectingSubMeshCandidates=(w,o)=>this.getIntersectingSubMeshCandidates(w,o))}register(){this.Vo.onMeshRemovedObservable.add((w=>{const o=this.Vo.selectionOctree;if(void 0!==o&&null!==o){const H=o.vA.indexOf(w);-1!==H&&o.vA.splice(H,1)}})),this.Vo.onMeshImportedObservable.add((w=>{const o=this.Vo.selectionOctree;void 0!==o&&null!==o&&o.hA(w)}))}getActiveMeshCandidates(){var w;return(null===(w=this.Vo.KA)||void 0===w?void 0:w.select(this.Vo.frustumPlanes))||this.Vo._getDefaultMeshCandidates()}getActiveSubMeshCandidates(w){if(w._submeshesOctree&&w.useOctreeForRenderingSelection){return w._submeshesOctree.select(this.Vo.frustumPlanes)}return this.Vo._getDefaultSubMeshCandidates(w)}getIntersectingSubMeshCandidates(w,o){if(w._submeshesOctree&&w.useOctreeForPicking){D.b.TransformToRef(o,w.getWorldMatrix(),this._tempRay);return w._submeshesOctree.intersectsRay(this._tempRay)}return this.Vo._getDefaultSubMeshCandidates(w)}getCollidingSubMeshCandidates(w,o){if(w._submeshesOctree&&w.useOctreeForCollisions){const H=o._velocityWorldLength+Math.max(o._radius.x,o._radius.y,o._radius.z);return w._submeshesOctree.intersects(o._basePointWorld,H)}return this.Vo._getDefaultSubMeshCandidates(w)}rebuild(){}dispose(){}}},13118:(w,o,H)=>{"use strict";H.d(o,{b:()=>C});var h=H(11957),E=H(12167),e=H(11722),D=H(11720),t=H(11727),X=H(12045),L=H(11980),A=H(11571),y=H(12006);const z={internalPickerForMesh:void 0};class C{constructor(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.c;this.origin=w,this.direction=o,this.length=H,this.epsilon=h}clone(){return new C(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const h=C._TmpVector3[0].We(w.x-H,w.y-H,w.z-H),E=C._TmpVector3[1].We(o.x+H,o.y+H,o.z+H);let e,D,t,X,L=0,A=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<h.x||this.origin.x>E.x)return!1}else if(e=1/this.direction.x,D=(h.x-this.origin.x)*e,t=(E.x-this.origin.x)*e,t===-1/0&&(t=1/0),D>t&&(X=D,D=t,t=X),L=Math.max(D,L),A=Math.min(t,A),L>A)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<h.y||this.origin.y>E.y)return!1}else if(e=1/this.direction.y,D=(h.y-this.origin.y)*e,t=(E.y-this.origin.y)*e,t===-1/0&&(t=1/0),D>t&&(X=D,D=t,t=X),L=Math.max(D,L),A=Math.min(t,A),L>A)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<h.z||this.origin.z>E.z)return!1}else if(e=1/this.direction.z,D=(h.z-this.origin.z)*e,t=(E.z-this.origin.z)*e,t===-1/0&&(t=1/0),D>t&&(X=D,D=t,t=X),L=Math.max(D,L),A=Math.min(t,A),L>A)return!1;return!0}intersectsBox(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(w.minimum,w.maximum,o)}intersectsSphere(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const H=w.center.x-this.origin.x,h=w.center.y-this.origin.y,E=w.center.z-this.origin.z,e=H*H+h*h+E*E,D=w.radius+o,t=D*D;if(e<=t)return!0;const X=H*this.direction.x+h*this.direction.y+E*this.direction.z;if(X<0)return!1;return e-X*X<=t}intersectsTriangle(w,o,H){const h=C._TmpVector3[0],E=C._TmpVector3[1],e=C._TmpVector3[2],t=C._TmpVector3[3],L=C._TmpVector3[4];o.subtractToRef(w,h),H.subtractToRef(w,E),D.io.CrossToRef(this.direction,E,e);const A=D.io.Dot(h,e);if(0===A)return null;const y=1/A;this.origin.subtractToRef(w,t);const z=D.io.Dot(t,e)*y;if(z<-this.epsilon||z>1+this.epsilon)return null;D.io.CrossToRef(t,h,L);const Q=D.io.Dot(this.direction,L)*y;if(Q<-this.epsilon||z+Q>1+this.epsilon)return null;const M=D.io.Dot(E,L)*y;return M>this.length?null:new X.b(1-z-Q,z,M)}intersectsPlane(w){let o;const H=D.io.Dot(w.normal,this.direction);if(Math.abs(H)<9.99999997475243e-7)return null;{const h=D.io.Dot(w.normal,this.origin);return o=(-w.d-h)/H,o<0?o<-9.99999997475243e-7?null:0:o}}intersectsAxis(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(w){case"y":{const w=(this.origin.y-o)/this.direction.y;return w>0?null:new D.io(this.origin.x+this.direction.x*-w,o,this.origin.z+this.direction.z*-w)}case"x":{const w=(this.origin.x-o)/this.direction.x;return w>0?null:new D.io(o,this.origin.y+this.direction.y*-w,this.origin.z+this.direction.z*-w)}case"z":{const w=(this.origin.z-o)/this.direction.z;return w>0?null:new D.io(this.origin.x+this.direction.x*-w,this.origin.y+this.direction.y*-w,o)}default:return null}}intersectsMesh(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,e=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const t=D.TmpVectors.Matrix[0];return w.getWorldMatrix().invertToRef(t),this._tmpRay?C.TransformToRef(this,t,this._tmpRay):this._tmpRay=C.Transform(this,t),w.intersects(this._tmpRay,o,H,h,E,e)}intersectsMeshes(w,o,H){H?H.length=0:H=[];for(let h=0;h<w.length;h++){const E=this.intersectsMesh(w[h],o);E.hit&&H.push(E)}return H.sort(this._comparePickingInfo),H}_comparePickingInfo(w,o){return w.distance<o.distance?-1:w.distance>o.distance?1:0}intersectionSegment(w,o,H){const h=this.origin,E=D.TmpVectors.io[0],e=D.TmpVectors.io[1],t=D.TmpVectors.io[2],X=D.TmpVectors.io[3];o.subtractToRef(w,E),this.direction.scaleToRef(C._Rayl,t),h.addToRef(t,e),w.subtractToRef(h,X);const L=D.io.Dot(E,E),A=D.io.Dot(E,t),y=D.io.Dot(t,t),z=D.io.Dot(E,X),Q=D.io.Dot(t,X),M=L*y-A*A;let i,s,V=M,r=M;M<C._Smallnum?(i=0,V=1,s=Q,r=y):(i=A*Q-y*z,s=L*Q-A*z,i<0?(i=0,s=Q,r=y):i>V&&(i=V,s=Q+A,r=y)),s<0?(s=0,-z<0?i=0:-z>L?i=V:(i=-z,V=L)):s>r&&(s=r,-z+A<0?i=0:-z+A>L?i=V:(i=-z+A,V=L));const k=Math.abs(i)<C._Smallnum?0:i/V,P=Math.abs(s)<C._Smallnum?0:s/r,l=D.TmpVectors.io[4];t.scaleToRef(P,l);const O=D.TmpVectors.io[5];E.scaleToRef(k,O),O.addInPlace(X);const T=D.TmpVectors.io[6];O.subtractToRef(l,T);return P>0&&P<=this.length&&T.lengthSquared()<H*H?O.length():-1}update(w,o,H,h,E,e,t){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){C._RayDistant||(C._RayDistant=C.Zero()),C._RayDistant.unprojectRayToRef(w,o,H,h,D.Matrix.IdentityReadOnly,e,t);const X=D.TmpVectors.Matrix[0];E.invertToRef(X),C.TransformToRef(C._RayDistant,X,this)}else this.unprojectRayToRef(w,o,H,h,E,e,t);return this}static Zero(){return new C(D.io.Zero(),D.io.Zero())}static CreateNew(w,o,H,h,E,e,D){return C.Zero().update(w,o,H,h,E,e,D)}static CreateNewFromTo(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D.Matrix.IdentityReadOnly;const h=new C(new D.io(0,0,0),new D.io(0,0,0));return C.CreateFromToToRef(w,o,h,H)}static CreateFromToToRef(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:D.Matrix.IdentityReadOnly;H.origin.t(w);const E=o.subtractToRef(w,H.direction),e=Math.sqrt(E.x*E.x+E.y*E.y+E.z*E.z);return H.length=e,H.direction.normalize(),C.TransformToRef(H,h,H)}static Transform(w,o){const H=new C(new D.io(0,0,0),new D.io(0,0,0));return C.TransformToRef(w,o,H),H}static TransformToRef(w,o,H){D.io.TransformCoordinatesToRef(w.origin,o,H.origin),D.io.TransformNormalToRef(w.direction,o,H.direction),H.length=w.length,H.epsilon=w.epsilon;const h=H.direction,E=h.length();if(0!==E&&1!==E){const w=1/E;h.x*=w,h.y*=w,h.z*=w,H.length*=E}return H}unprojectRayToRef(w,o,H,h,E,e,t){const X=D.TmpVectors.Matrix[0];E.multiplyToRef(e,X),X.multiplyToRef(t,X),X.invert();const L=A.e.LastCreatedEngine,y=D.TmpVectors.io[0];y.x=w/H*2-1,y.y=-(o/h*2-1),y.z=null!==L&&void 0!==L&&L.useReverseDepthBuffer?1:null!==L&&void 0!==L&&L.isNDCHalfZRange?0:-1;const z=D.TmpVectors.io[1].We(y.x,y.y,1-1e-8),C=D.TmpVectors.io[2],Q=D.TmpVectors.io[3];D.io._UnprojectFromInvertedMatrixToRef(y,X,C),D.io._UnprojectFromInvertedMatrixToRef(z,X,Q),this.origin.t(C),Q.subtractToRef(C,this.direction),this.direction.normalize()}}function Q(w,o,H,h,E){let e=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const D=C.Zero();return M(w,o,H,h,D,E,e),D}function M(w,o,H,h,E,e){let t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const L=w.getEngine();if(!e&&!(e=w.activeCamera))return w;const A=e.viewport,y=L.getRenderHeight(),{x:z,y:C,width:Q,height:M}=A.toGlobal(L.getRenderWidth(),y),i=1/L.getHardwareScalingLevel();return o=o*i-z,H=H*i-(y-C-M),E.update(o,H,Q,M,h||D.Matrix.IdentityReadOnly,t?D.Matrix.IdentityReadOnly:e.getViewMatrix(),e.getProjectionMatrix(),X),w}function i(w,o,H,h,E){if(!L.e)return w;const e=w.getEngine();if(!E&&!(E=w.activeCamera))throw new Error("Active camera not set");const t=E.viewport,X=e.getRenderHeight(),{x:A,y:y,width:z,height:C}=t.toGlobal(e.getRenderWidth(),X),Q=D.Matrix.Identity(),M=1/e.getHardwareScalingLevel();return o=o*M-A,H=H*M-(X-y-C),h.update(o,H,z,C,Q,Q,E.getProjectionMatrix()),w}function s(w,o,H,h,E,e,D,t){const X=o(h,H.enableDistantPicking),L=H.intersects(X,E,D,e,h,t);return L&&L.hit?!E&&null!=w&&L.distance>=w.distance?null:L:null}function V(w,o,H,h,E,e){let t=null;const X=!!(w.activeCameras&&w.activeCameras.length>1&&w.cameraToUseForPointers!==w.activeCamera),A=w.cameraToUseForPointers||w.activeCamera,y=z.internalPickerForMesh||s;for(let L=0;L<w.meshes.length;L++){const z=w.meshes[L];if(H){if(!H(z,-1))continue}else if(!z.isEnabled()||!z.isVisible||!z.nX)continue;const C=X&&z.isWorldMatrixCameraDependent(),Q=z.se(C,A);if(z.hasThinInstances&&z.rL){const w=y(t,o,z,Q,!0,!0,e);if(w){if(E)return w;const X=D.TmpVectors.Matrix[1],L=z.thinInstanceGetWorldMatrices();for(let w=0;w<L.length;w++){if(H&&!H(z,w))continue;L[w].multiplyToRef(Q,X);const D=y(t,o,z,X,h,E,e,!0);if(D&&(t=D,t.thinInstanceIndex=w,h))return t}}}else{const w=y(t,o,z,Q,h,E,e);if(w&&(t=w,h))return t}}return t||new L.e}function r(w,o,H,h){if(!L.e)return null;const E=[],e=!!(w.activeCameras&&w.activeCameras.length>1&&w.cameraToUseForPointers!==w.activeCamera),t=w.cameraToUseForPointers||w.activeCamera,X=z.internalPickerForMesh||s;for(let L=0;L<w.meshes.length;L++){const A=w.meshes[L];if(H){if(!H(A,-1))continue}else if(!A.isEnabled()||!A.isVisible||!A.nX)continue;const y=e&&A.isWorldMatrixCameraDependent(),z=A.se(y,t);if(A.hasThinInstances&&A.rL){if(X(null,o,A,z,!0,!0,h)){const w=D.TmpVectors.Matrix[1],e=A.thinInstanceGetWorldMatrices();for(let D=0;D<e.length;D++){if(H&&!H(A,D))continue;e[D].multiplyToRef(z,w);const t=X(null,o,A,w,!1,!1,h,!0);t&&(t.thinInstanceIndex=D,E.push(t))}}}else{const w=X(null,o,A,z,!1,!1,h);w&&E.push(w)}}return E}function k(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,h=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0;h||(h=w.getWorldMatrix()),o.length=H,E?o.origin.t(E):o.origin.t(w.position);const e=D.TmpVectors.io[2];e.set(0,0,w._scene.useRightHandedSystem?-1:1);const t=D.TmpVectors.io[3];return D.io.TransformNormalToRef(e,h,t),D.io.NormalizeToRef(t,o.direction),o}var P,l;C._TmpVector3=(0,t.c)(6,D.io.Zero),C._RayDistant=C.Zero(),C._Smallnum=1e-8,C._Rayl=1e9,P=h.e,(l=E.e)&&(l.prototype.getForwardRay=function(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,o=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;return k(this,new C(D.io.Zero(),D.io.Zero(),w),w,o,H)},l.prototype.getForwardRayToRef=function(w){return k(this,w,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),P&&(y.e._IsPickingAvailable=!0,P.prototype.createPickingRay=function(w,o,H,h){return Q(this,w,o,H,h,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),h.e.prototype.createPickingRayToRef=function(w,o,H,h,E){return M(this,w,o,H,h,E,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},h.e.prototype.createPickingRayInCameraSpace=function(w,o,H){return function(w,o,H,h){const E=C.Zero();return i(w,o,H,E,h),E}(this,w,o,H)},h.e.prototype.createPickingRayInCameraSpaceToRef=function(w,o,H,h){return i(this,w,o,H,h)},h.e.prototype.pickWithBoundingInfo=function(w,o,H,h,E){return function(w,o,H,h,E,e){if(!L.e)return null;const t=V(w,(h=>(w._tempPickingRay||(w._tempPickingRay=C.Zero()),M(w,o,H,h,w._tempPickingRay,e||null),w._tempPickingRay)),h,E,!0);return t&&(t.ray=Q(w,o,H,D.Matrix.Identity(),e||null)),t}(this,w,o,H,h,E)},h.e.prototype.MH=function(w,o,H,h,E,e){return function(w,o,H,h,E,e,t){const X=V(w,((h,E)=>(w._tempPickingRay||(w._tempPickingRay=C.Zero()),M(w,o,H,h,w._tempPickingRay,e||null,!1,E),w._tempPickingRay)),h,E,!1,t);return X&&(X.ray=Q(w,o,H,D.Matrix.Identity(),e||null)),X}(this,w,o,H,h,E,e)},h.e.prototype.pickWithRay=function(w,o,H,h){return function(w,o,H,h,E){const e=V(w,(H=>(w._pickWithRayInverseMatrix||(w._pickWithRayInverseMatrix=D.Matrix.Identity()),H.invertToRef(w._pickWithRayInverseMatrix),w._cachedRayForTransform||(w._cachedRayForTransform=C.Zero()),C.TransformToRef(o,w._pickWithRayInverseMatrix,w._cachedRayForTransform),w._cachedRayForTransform)),H,h,!1,E);return e&&(e.ray=o),e}(this,w,o,H,h)},h.e.prototype.multiPick=function(w,o,H,h,E){return function(w,o,H,h,E,e){return r(w,(h=>Q(w,o,H,h,E||null)),h,e)}(this,w,o,H,h,E)},h.e.prototype.multiPickWithRay=function(w,o,H){return function(w,o,H,h){return r(w,(H=>(w._pickWithRayInverseMatrix||(w._pickWithRayInverseMatrix=D.Matrix.Identity()),H.invertToRef(w._pickWithRayInverseMatrix),w._cachedRayForTransform||(w._cachedRayForTransform=C.Zero()),C.TransformToRef(o,w._pickWithRayInverseMatrix,w._cachedRayForTransform),w._cachedRayForTransform)),H,h)}(this,w,o,H)}},13415:(w,o,H)=>{"use strict";var h=H(11640),E=H(11551),e=H(11573),D=H(11675),t=H(11615),X=H(11656);t.c.prototype._partialLoadFile=function(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(w,(w=>{H[o]=w,H._internalCount++,6===H._internalCount&&h(H)}),void 0,void 0,!0,((w,o)=>{E&&w&&E(w.status+" "+w.statusText,o)}))},t.c.prototype._cascadeLoadFiles=function(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const E=[];E._internalCount=0;for(let e=0;e<6;e++)this._partialLoadFile(H[e],e,E,o,h)},t.c.prototype._cascadeLoadImgs=function(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5?arguments[5]:void 0;const D=[];D._internalCount=0;for(let t=0;t<6;t++)this._partialLoadImg(h[t],t,D,w,o,H,E,e)},t.c.prototype._partialLoadImg=function(w,o,H,h,E,t){let X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7?arguments[7]:void 0;const A=(0,D.e)();(0,e.q)(w,(w=>{H[o]=w,H._internalCount++,h&&h.removePendingData(A),6===H._internalCount&&t&&t(E,H)}),((w,o)=>{h&&h.removePendingData(A),X&&X(w,o)}),h?h.offlineProvider:null,L),h&&h.addPendingData(A)},t.c.prototype.createCubeTextureBase=function(w,o,H,e){let D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6?arguments[6]:void 0,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,C=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,Q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,M=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,i=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,s=arguments.length>14&&void 0!==arguments[14]&&arguments[14],V=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const r=Q||new h.c(this,7);r.isCube=!0,r.url=w,r.generateMipMaps=!e,r._lodGenerationScale=z,r._lodGenerationOffset=C,r._useSRGBBuffer=!!s&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!e),r!==Q&&(r.label=w.substring(0,60)),this._doNotHandleContextLost||(r._extension=A,r._files=H,r._buffer=V);const k=w;this._transformTextureUrl&&!Q&&(w=this._transformTextureUrl(w));const P=A??function(w){const o=w.split("?")[0],H=o.lastIndexOf(".");return H>-1?o.substring(H).toLowerCase():""}(w),l=(0,X.b)(P),O=(w,o)=>{r.dispose(),t?t(w,o):w&&E.d.Warn(w)},T=(h,t)=>{w===k?h&&O(h.status+" "+h.statusText,t):(E.d.Warn(`Failed to load ${w}, falling back to the ${k}`),this.createCubeTextureBase(k,o,H,!!e,D,O,L,A,y,z,C,r,M,i,s,V))};if(l)l.then((h=>{const E=w=>{M&&M(r,w),h.loadCubeData(w,r,y,D,((w,o)=>{O(w,o)}))};V?E(V):H&&6===H.length?h.supportCascades?this._cascadeLoadFiles(o,(w=>E(w.map((w=>new Uint8Array(w))))),H,O):O("Textures type does not support cascades."):this._loadFile(w,(w=>E(new Uint8Array(w))),void 0,void 0,!0,T)}));else{if(!H||0===H.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(o,r,((w,o)=>{i&&i(w,o)}),H,O)}return this._internalTexturesCache.push(r),r}},14018:(w,o,H)=>{"use strict";H(11551);var h=H(11837);H(11640),H(11785),H(11635),H(11884),H(11848);h.e},13446:(w,o,H)=>{"use strict";H.d(o,{d:()=>E});var h=H(11666);class E{constructor(w){this.value=this._toInt(w)}_toInt(w){return 0|w}add(w){return new E(this.value+w.value)}so(w){return new E(this.value-w.value)}multiply(w){return new E(Math.imul(this.value,w.value))}divide(w){return new E(this.value/w.value)}getClassName(){return E.ClassName}equals(w){return this.value===w.value}static FromValue(w){return new E(w)}toString(){return this.value.toString()}}E.ClassName="FlowGraphInteger",(0,h.g)("FlowGraphInteger",E)},13462:(w,o,H)=>{"use strict";H.d(o,{d:()=>E,g:()=>e});var h=H(11720);class E{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.we=w}get m(){return this.we}transformVector(w){return this.transformVectorToRef(w,new h.Vector2)}transformVectorToRef(w,o){return o.x=w.x*this.we[0]+w.y*this.we[1],o.y=w.x*this.we[2]+w.y*this.we[3],o}Ae(){return this.toArray()}toArray(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let o=0;o<4;o++)w[o]=this.we[o];return w}iH(w){for(let o=0;o<4;o++)this.we[o]=w[o];return this}multiplyToRef(w,o){const H=w.we,h=this.we,E=o.we;return E[0]=H[0]*h[0]+H[1]*h[2],E[1]=H[0]*h[1]+H[1]*h[3],E[2]=H[2]*h[0]+H[3]*h[2],E[3]=H[2]*h[1]+H[3]*h[3],o}multiply(w){return this.multiplyToRef(w,new E)}divideToRef(w,o){const H=this.we,h=w.we,E=o.we;return E[0]=H[0]/h[0],E[1]=H[1]/h[1],E[2]=H[2]/h[2],E[3]=H[3]/h[3],o}divide(w){return this.divideToRef(w,new E)}addToRef(w,o){const H=this.we,h=w.m,E=o.m;return E[0]=H[0]+h[0],E[1]=H[1]+h[1],E[2]=H[2]+h[2],E[3]=H[3]+h[3],o}add(w){return this.addToRef(w,new E)}subtractToRef(w,o){const H=this.we,h=w.m,E=o.m;return E[0]=H[0]-h[0],E[1]=H[1]-h[1],E[2]=H[2]-h[2],E[3]=H[3]-h[3],o}so(w){return this.subtractToRef(w,new E)}transpose(){const w=this.we;return new E([w[0],w[2],w[1],w[3]])}determinant(){const w=this.we;return w[0]*w[3]-w[1]*w[2]}inverse(){const w=this.determinant();if(0===w)throw new Error("Matrix is not invertible");const o=this.we,H=1/w;return new E([o[3]*H,-o[1]*H,-o[2]*H,o[0]*H])}equals(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const H=this.we,h=w.m;return 0===o?H[0]===h[0]&&H[1]===h[1]&&H[2]===h[2]&&H[3]===h[3]:Math.abs(H[0]-h[0])<o&&Math.abs(H[1]-h[1])<o&&Math.abs(H[2]-h[2])<o&&Math.abs(H[3]-h[3])<o}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.we.join(", ")})`}}class e{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.we=w}get m(){return this.we}transformVector(w){return this.transformVectorToRef(w,new h.io)}transformVectorToRef(w,o){const H=this.we;return o.x=w.x*H[0]+w.y*H[1]+w.z*H[2],o.y=w.x*H[3]+w.y*H[4]+w.z*H[5],o.z=w.x*H[6]+w.y*H[7]+w.z*H[8],o}multiplyToRef(w,o){const H=w.we,h=this.we,E=o.m;return E[0]=H[0]*h[0]+H[1]*h[3]+H[2]*h[6],E[1]=H[0]*h[1]+H[1]*h[4]+H[2]*h[7],E[2]=H[0]*h[2]+H[1]*h[5]+H[2]*h[8],E[3]=H[3]*h[0]+H[4]*h[3]+H[5]*h[6],E[4]=H[3]*h[1]+H[4]*h[4]+H[5]*h[7],E[5]=H[3]*h[2]+H[4]*h[5]+H[5]*h[8],E[6]=H[6]*h[0]+H[7]*h[3]+H[8]*h[6],E[7]=H[6]*h[1]+H[7]*h[4]+H[8]*h[7],E[8]=H[6]*h[2]+H[7]*h[5]+H[8]*h[8],o}multiply(w){return this.multiplyToRef(w,new e)}divideToRef(w,o){const H=this.we,h=w.m,E=o.m;return E[0]=H[0]/h[0],E[1]=H[1]/h[1],E[2]=H[2]/h[2],E[3]=H[3]/h[3],E[4]=H[4]/h[4],E[5]=H[5]/h[5],E[6]=H[6]/h[6],E[7]=H[7]/h[7],E[8]=H[8]/h[8],o}divide(w){return this.divideToRef(w,new e)}addToRef(w,o){const H=this.we,h=w.m,E=o.m;return E[0]=H[0]+h[0],E[1]=H[1]+h[1],E[2]=H[2]+h[2],E[3]=H[3]+h[3],E[4]=H[4]+h[4],E[5]=H[5]+h[5],E[6]=H[6]+h[6],E[7]=H[7]+h[7],E[8]=H[8]+h[8],o}add(w){return this.addToRef(w,new e)}subtractToRef(w,o){const H=this.we,h=w.m,E=o.m;return E[0]=H[0]-h[0],E[1]=H[1]-h[1],E[2]=H[2]-h[2],E[3]=H[3]-h[3],E[4]=H[4]-h[4],E[5]=H[5]-h[5],E[6]=H[6]-h[6],E[7]=H[7]-h[7],E[8]=H[8]-h[8],o}so(w){return this.subtractToRef(w,new e)}toArray(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let o=0;o<9;o++)w[o]=this.we[o];return w}Ae(){return this.toArray()}iH(w){for(let o=0;o<9;o++)this.we[o]=w[o];return this}transpose(){const w=this.we;return new e([w[0],w[3],w[6],w[1],w[4],w[7],w[2],w[5],w[8]])}determinant(){const w=this.we;return w[0]*(w[4]*w[8]-w[5]*w[7])-w[1]*(w[3]*w[8]-w[5]*w[6])+w[2]*(w[3]*w[7]-w[4]*w[6])}inverse(){const w=this.determinant();if(0===w)throw new Error("Matrix is not invertible");const o=this.we,H=1/w;return new e([(o[4]*o[8]-o[5]*o[7])*H,(o[2]*o[7]-o[1]*o[8])*H,(o[1]*o[5]-o[2]*o[4])*H,(o[5]*o[6]-o[3]*o[8])*H,(o[0]*o[8]-o[2]*o[6])*H,(o[2]*o[3]-o[0]*o[5])*H,(o[3]*o[7]-o[4]*o[6])*H,(o[1]*o[6]-o[0]*o[7])*H,(o[0]*o[4]-o[1]*o[3])*H])}equals(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const H=this.we,h=w.m;return 0===o?H[0]===h[0]&&H[1]===h[1]&&H[2]===h[2]&&H[3]===h[3]&&H[4]===h[4]&&H[5]===h[5]&&H[6]===h[6]&&H[7]===h[7]&&H[8]===h[8]:Math.abs(H[0]-h[0])<o&&Math.abs(H[1]-h[1])<o&&Math.abs(H[2]-h[2])<o&&Math.abs(H[3]-h[3])<o&&Math.abs(H[4]-h[4])<o&&Math.abs(H[5]-h[5])<o&&Math.abs(H[6]-h[6])<o&&Math.abs(H[7]-h[7])<o&&Math.abs(H[8]-h[8])<o}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.we.join(", ")})`}}},13465:(w,o,H)=>{"use strict";var h;function E(w,o,H,h){switch(o){case"Animation":return h?w.animations.find((w=>w.uniqueId===H))??null:w.animations[H]??null;case"AnimationGroup":return h?w.animationGroups.find((w=>w.uniqueId===H))??null:w.animationGroups[H]??null;case"Mesh":return h?w.meshes.find((w=>w.uniqueId===H))??null:w.meshes[H]??null;case"Material":return h?w.materials.find((w=>w.uniqueId===H))??null:w.materials[H]??null;case"yA":return h?w.cameras.find((w=>w.uniqueId===H))??null:w.cameras[H]??null;case"Light":return h?w.lights.find((w=>w.uniqueId===H))??null:w.lights[H]??null;default:return null}}H.d(o,{d:()=>E}),function(w){w.Animation="Animation",w.AnimationGroup="AnimationGroup",w.Mesh="Mesh",w.Material="Material",w.yA="yA",w.Light="Light"}(h||(h={}))},13500:(w,o,H)=>{"use strict";H.d(o,{d:()=>E});var h=H(13507);class E extends h.e{constructor(w,o){if(super(w),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),o)for(const H of o)this._eventsSignalOutputs[H]=this._registerSignalOutput(H+"Event")}_executeOnTick(w){}_startPendingTasks(w){w._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(w),this._resetAfterCanceled(w)),this._preparePendingTasks(w),w._addPendingBlock(this),this.out._activateSignal(w),w._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(w){w._deleteExecutionVariable(this,"_initialized"),w._removePendingBlock(this)}}},13475:(w,o,H)=>{"use strict";H.d(o,{c:()=>L});var h=H(11675),E=H(11666),e=H(13482),D=H(11540),t=H(13439);class X extends e.d{constructor(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:h.defaultValue,e=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(w,o,H),this.richType=h,this._defaultValue=E,this._optional=e,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new D.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(w){this._isDisabled!==w&&(this._isDisabled=w,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(w,o){o._getConnectionValue(this)!==w&&(o._setConnectionValue(this,w),this.onValueChangedObservable.notifyObservers(w))}resetToDefaultValue(w){w._setConnectionValue(this,this._defaultValue)}connectTo(w){this._isDisabled||super.connectTo(w)}_getValueOrDefault(w){const o=w._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(o):o}getValue(w){if(1===this.connectionType){w._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(w);const o=this._getValueOrDefault(w);return this._lastValue=o,this.richType.typeTransformer?this.richType.typeTransformer(o):o}const o=this.isConnected()?this._connectedPoint[0].getValue(w):this._getValueOrDefault(w);return this._lastValue=o,this.richType.typeTransformer?this.richType.typeTransformer(o):o}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(w),w.richType={},this.richType.serialize(w.richType),w.optional=this._optional,(0,t.d)("defaultValue",this._defaultValue,w)}}(0,E.g)("FlowGraphDataConnection",X);class L{constructor(w){var o;this.config=w,this.uniqueId=(0,h.e)(),this.name=(null===(o=this.config)||void 0===o?void 0:o.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(w){}registerDataInput(w,o,H){const h=new X(w,0,this,o,H);return this.dataInputs.push(h),h}registerDataOutput(w,o,H){const h=new X(w,1,this,o,H);return this.dataOutputs.push(h),h}getDataInput(w){return this.dataInputs.find((o=>o.name===w))}getDataOutput(w){return this.dataOutputs.find((o=>o.name===w))}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.d;if(w.uniqueId=this.uniqueId,w.config={},this.config){const H=this.config,h=Object.keys(H);for(const E of h)o(E,H[E],w.config)}w.dataInputs=[],w.dataOutputs=[],w.className=this.getClassName();for(const H of this.dataInputs){const o={};H.serialize(o),w.dataInputs.push(o)}for(const H of this.dataOutputs){const o={};H.serialize(o),w.dataOutputs.push(o)}}deserialize(w){}_log(w,o,H){var h;null===(h=w.logger)||void 0===h||h.addLogItem({action:o,sH:H,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13482:(w,o,H)=>{"use strict";H.d(o,{d:()=>e});var h,E=H(11675);!function(w){w[w.Input=0]="Input",w[w.Output=1]="Output"}(h||(h={}));class e{constructor(w,o,H){this._ownerBlock=H,this._connectedPoint=[],this.uniqueId=(0,E.e)(),this.connectedPointIds=[],this.name=w,this._connectionType=o}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(w){if(this._connectionType===w._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||w._isSingularConnection()&&w._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(w),w._connectedPoint.push(this)}disconnectFrom(w){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const H=this._connectedPoint.indexOf(w),h=w._connectedPoint.indexOf(this);-1!==H&&-1!==h&&(o&&this._connectedPoint.splice(H,1),w._connectedPoint.splice(h,1))}disconnectFromAll(){for(const w of this._connectedPoint)this.disconnectFrom(w,!1);this._connectedPoint.length=0}dispose(){for(const w of this._connectedPoint)this.disconnectFrom(w)}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w.uniqueId=this.uniqueId,w.name=this.name,w._connectionType=this._connectionType,w.connectedPointIds=[],w.className=this.getClassName();for(const o of this._connectedPoint)w.connectedPointIds.push(o.uniqueId)}getClassName(){return"FGConnection"}deserialize(w){this.uniqueId=w.uniqueId,this.name=w.name,this._connectionType=w._connectionType,this.connectedPointIds=w.connectedPointIds}}},13435:(w,o,H)=>{"use strict";H.d(o,{d:()=>r});var h,E=H(11540),e=H(11697),D=H(11702),t=H(11675),X=H(13439),L=H(13465),A=H(11551);!function(w){w.ExecuteBlock="ExecuteBlock",w.ExecuteEvent="ExecuteEvent",w.TriggerConnection="TriggerConnection",w.ContextVariableSet="ContextVariableSet",w.GlobalVariableSet="GlobalVariableSet",w.GlobalVariableDelete="GlobalVariableDelete",w.GlobalVariableGet="GlobalVariableGet",w.AddConnection="AddConnection",w.GetConnectionValue="GetConnectionValue",w.SetConnectionValue="SetConnectionValue",w.ActivateSignal="ActivateSignal",w.ContextVariableGet="ContextVariableGet"}(h||(h={}));class y{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(w){if(w.time||(w.time=Date.now()),this.log.push(w),this.logToConsole){var o;const H=null===(o=w.sH)||void 0===o?void 0:o.value;"object"===typeof H&&H.getClassName?A.d.Log(`[FGLog] ${w.className}:${w.uniqueId.split("-")[0]} ${w.action} - ${JSON.stringify(H.getClassName())}: ${H.toString()}`):A.d.Log(`[FGLog] ${w.className}:${w.uniqueId.split("-")[0]} ${w.action} - ${JSON.stringify(w.sH)}`)}}getItemsOfType(w){return this.log.filter((o=>o.action===w))}}class z{get enableLogging(){return this._enableLogging}set enableLogging(w){this._enableLogging!==w&&(this._enableLogging=w,this._enableLogging?(this.logger=new y,this.logger.logToConsole=!0):this.logger=null)}constructor(w){this.uniqueId=(0,t.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new E.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=w,this.assetsContext=w.assetsContext??w.Vo}hasVariable(w){return w in this._userVariables}setVariable(w,o){var H;this._userVariables[w]=o,null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",sH:{name:w,value:o}})}getAsset(w,o){return(0,L.d)(this.assetsContext,w,o)}getVariable(w){var o;return null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",sH:{name:w,value:this._userVariables[w]}}),this._userVariables[w]}get userVariables(){return this._userVariables}Ow(){return this._configuration.Vo}_getUniqueIdPrefixedName(w,o){return`${w.uniqueId}_${o}`}_getGlobalContextVariable(w,o){var H;return null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",sH:{name:w,defaultValue:o,possibleValue:this._globalContextVariables[w]}}),this._hasGlobalContextVariable(w)?this._globalContextVariables[w]:o}_setGlobalContextVariable(w,o){var H;null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",sH:{name:w,value:o}}),this._globalContextVariables[w]=o}_deleteGlobalContextVariable(w){var o;null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",sH:{name:w}}),delete this._globalContextVariables[w]}_hasGlobalContextVariable(w){return w in this._globalContextVariables}_setExecutionVariable(w,o,H){this._executionVariables[this._getUniqueIdPrefixedName(w,o)]=H}_getExecutionVariable(w,o,H){return this._hasExecutionVariable(w,o)?this._executionVariables[this._getUniqueIdPrefixedName(w,o)]:H}_deleteExecutionVariable(w,o){delete this._executionVariables[this._getUniqueIdPrefixedName(w,o)]}_hasExecutionVariable(w,o){return this._getUniqueIdPrefixedName(w,o)in this._executionVariables}_hasConnectionValue(w){return w.uniqueId in this._connectionValues}_setConnectionValue(w,o){var H;this._connectionValues[w.uniqueId]=o,null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",sH:{connectionPointId:w.uniqueId,value:o}})}_setConnectionValueByKey(w,o){this._connectionValues[w]=o}_getConnectionValue(w){var o;return null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",sH:{connectionPointId:w.uniqueId,value:this._connectionValues[w.uniqueId]}}),this._connectionValues[w.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(w){this._pendingBlocks.includes(w)||(this._pendingBlocks.push(w),this._pendingBlocks.sort(((w,o)=>w.priority-o.priority)))}_removePendingBlock(w){const o=this._pendingBlocks.indexOf(w);-1!==o&&this._pendingBlocks.splice(o,1)}_clearPendingBlocks(){for(const w of this._pendingBlocks)w._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(w){var o;this.onNodeExecutedObservable.notifyObservers(w),null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:w.getClassName(),uniqueId:w.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(w){this._setGlobalContextVariable("timeSinceStart",w.timeSinceStart),this._setGlobalContextVariable("deltaTime",w.deltaTime);for(const H of this._pendingBlocks){var o;null===(o=H._executeOnTick)||void 0===o||o.call(H,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.d;w.uniqueId=this.uniqueId,w._userVariables={};for(const h in this._userVariables)o(h,this._userVariables[h],w._userVariables);w._connectionValues={};for(const h in this._connectionValues)o(h,this._connectionValues[h],w._connectionValues);var H;this.assetsContext!==this.Ow()&&(w._assetsContext={meshes:this.assetsContext.meshes.map((w=>w.id)),materials:this.assetsContext.materials.map((w=>w.id)),textures:this.assetsContext.textures.map((w=>w.name)),animations:this.assetsContext.animations.map((w=>w.name)),lights:this.assetsContext.lights.map((w=>w.id)),cameras:this.assetsContext.cameras.map((w=>w.id)),Gz:null===(H=this.assetsContext.Gz)||void 0===H?void 0:H.map((w=>w.name)),skeletons:this.assetsContext.skeletons.map((w=>w.id)),Ez:this.assetsContext.Ez.map((w=>w.name)),geometries:this.assetsContext.geometries.map((w=>w.id)),multiMaterials:this.assetsContext.multiMaterials.map((w=>w.id)),transformNodes:this.assetsContext.transformNodes.map((w=>w.id))})}getClassName(){return"FlowGraphContext"}}(0,e.b)([(0,D.B)()],z.prototype,"uniqueId",void 0);var C=H(13469),Q=H(11991);class M{constructor(w){this.onEventTriggeredObservable=new E.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=w,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.me.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const w=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",sH:{timeSinceStart:this._startingTime,deltaTime:w}}),this._startingTime+=w})),this._meshPickedObserver=this._scene.onPointerObservable.add((w=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",sH:w})}),Q.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((w=>{const o=w.pointerId,H=w.mesh,h=this._pointerUnderMeshState[o];!h&&H?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",sH:{pointerId:o,mesh:H}}):h&&!H?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",sH:{pointerId:o,mesh:h}}):h&&H&&h!==H&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",sH:{pointerId:o,mesh:h,over:H}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",sH:{pointerId:o,mesh:H,out:h}})),this._pointerUnderMeshState[o]=H}),Q.d.POINTERMOVE)}dispose(){var w,o,H,h,E;null===(w=this._sceneDisposeObserver)||void 0===w||w.remove(),null===(o=this._sceneReadyObserver)||void 0===o||o.remove(),null===(H=this._sceneOnBeforeRenderObserver)||void 0===H||H.remove(),null===(h=this._meshPickedObserver)||void 0===h||h.remove(),null===(E=this._meshUnderPointerObserver)||void 0===E||E.remove(),this.onEventTriggeredObservable.clear()}}var i,s=H(13486);!function(w){w[w.Stopped=0]="Stopped",w[w.Started=1]="Started"}(i||(i={}));class V{get state(){return this._state}set state(w){this._state=w,this.onStateChangedObservable.notifyObservers(w)}constructor(w){this.onStateChangedObservable=new E.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=w.Vo,this._sceneEventCoordinator=new M(this._scene),this._coordinator=w.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((w=>{for(const o of this._executionContexts){const H=this._getContextualOrder(w.type,o);for(const h of H)if(!h._executeEvent(o,w.sH))break}switch(w.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const o of this._executionContexts)o._notifyOnTick(w.sH);break;case"SceneDispose":this.dispose()}}))}createContext(){const w=new z({Vo:this._scene,coordinator:this._coordinator});return this._executionContexts.push(w),w}getContext(w){return this._executionContexts[w]}addEventBlock(w){if("PointerOver"!==w.type&&"PointerOut"!==w.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==w.type&&this._eventBlocks[w.type].push(w),1===this.state)for(const o of this._executionContexts)w._startPendingTasks(o);else this.onStateChangedObservable.addOnce((o=>{if(1===o)for(const H of this._executionContexts)w._startPendingTasks(H)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((w=>{1===w&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const w of this._executionContexts)for(const o in this._eventBlocks){const H=this._getContextualOrder(o,w);for(const o of H)o._startPendingTasks(w)}}_getContextualOrder(w,o){const H=this._eventBlocks[w].sort(((w,o)=>o.initPriority-w.initPriority));if("MeshPick"===w){const w=[];for(const h of H){const E=h.asset.getValue(o);let e=0;for(;e<H.length;e++){const w=H[e].asset.getValue(o);if(E&&w&&(0,s.j)(E,w))break}w.splice(e,0,h)}return w}return H}dispose(){var w;if(0!==this.state){this.state=0;for(const w of this._executionContexts)w._clearPendingBlocks();this._executionContexts.length=0;for(const w in this._eventBlocks)this._eventBlocks[w].length=0;null===(w=this._eventObserver)||void 0===w||w.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(w){const o=[],H=new Set;for(const h in this._eventBlocks)for(const w of this._eventBlocks[h])o.push(w),H.add(w.uniqueId);for(;o.length>0;){const h=o.pop();w(h);for(const w of h.dataInputs)for(const h of w._connectedPoint)H.has(h._ownerBlock.uniqueId)||(o.push(h._ownerBlock),H.add(h._ownerBlock.uniqueId));if(h instanceof C.d)for(const w of h.signalOutputs)for(const h of w._connectedPoint)H.has(h._ownerBlock.uniqueId)||(o.push(h._ownerBlock),H.add(h._ownerBlock.uniqueId))}}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;w.allBlocks=[],this.visitAllBlocks((o=>{const H={};o.serialize(H),w.allBlocks.push(H)})),w.executionContexts=[];for(const H of this._executionContexts){const h={};H.serialize(h,o),w.executionContexts.push(h)}}}class r{constructor(w){this.config=w,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Vo.me.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Vo.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const w=this._executeOnNextFrame.slice(0);if(w.length)for(const o of w){this.notifyCustomEvent(o.id,o.data,!1);const w=this._executeOnNextFrame.findIndex((w=>w.uniqueId===o.uniqueId));-1!==w&&this._executeOnNextFrame.splice(w,1)}}));(r.SceneCoordinators.get(this.config.Vo)??[]).push(this)}createGraph(){const w=new V({Vo:this.config.Vo,coordinator:this});return this._flowGraphs.push(w),w}removeGraph(w){const o=this._flowGraphs.indexOf(w);-1!==o&&(w.dispose(),this._flowGraphs.splice(o,1))}start(){for(const w of this._flowGraphs)w.start()}dispose(){var w,o;for(const E of this._flowGraphs)E.dispose();this._flowGraphs.length=0,null===(w=this._disposeObserver)||void 0===w||w.remove(),null===(o=this._onBeforeRenderObserver)||void 0===o||o.remove();const H=r.SceneCoordinators.get(this.config.Vo)??[],h=H.indexOf(this);-1!==h&&H.splice(h,1)}serialize(w,o){w._flowGraphs=[];for(const H of this._flowGraphs){const h={};H.serialize(h,o),w._flowGraphs.push(h)}w.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(w){let o=this._customEventsMap.get(w);return o||(o=new E.b,this._customEventsMap.set(w,o)),o}notifyCustomEvent(w,o){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:w,data:o,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(w)){const o=this._eventExecutionCounter.get(w);if(this._eventExecutionCounter.set(w,o+1),o>=r.MaxEventTypeExecutionPerFrame)return void(o===r.MaxEventTypeExecutionPerFrame&&A.d.Warn(`FlowGraphCoordinator: Too many executions of event "${w}".`))}else this._eventExecutionCounter.set(w,1);const H=this._customEventsMap.get(w);H&&H.notifyObservers(o)}}r.MaxEventsPerType=30,r.MaxEventTypeExecutionPerFrame=30,r.SceneCoordinators=new Map},13494:(w,o,H)=>{"use strict";H.d(o,{c:()=>E});var h=H(13500);class E extends h.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(w){w._notifyExecuteNode(this),this.done._activateSignal(w)}}},13469:(w,o,H)=>{"use strict";H.d(o,{d:()=>t});var h=H(13475),E=H(13482),e=H(11666);class D extends E.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(w){super.connectTo(w),this._connectedPoint.sort(((w,o)=>o.priority-w.priority))}_activateSignal(w){var o;if(null===(o=w.logger)||void 0===o||o.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,sH:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)w._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(w,this),w._increaseExecutionId();else for(const H of this._connectedPoint)H._activateSignal(w)}}(0,e.g)("FlowGraphSignalConnection",D);class t extends h.c{constructor(w){super(w),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(w){const o=new D(w,0,this);return this.signalInputs.push(o),o}_registerSignalOutput(w){const o=new D(w,1,this);return this.signalOutputs.push(o),o}_unregisterSignalInput(w){const o=this.signalInputs.findIndex((o=>o.name===w));-1!==o&&(this.signalInputs[o].dispose(),this.signalInputs.splice(o,1))}_unregisterSignalOutput(w){const o=this.signalOutputs.findIndex((o=>o.name===w));-1!==o&&(this.signalOutputs[o].dispose(),this.signalOutputs.splice(o,1))}_reportError(w,o){this.error.sH="string"===typeof o?new Error(o):o,this.error._activateSignal(w)}getSignalInput(w){return this.signalInputs.find((o=>o.name===w))}getSignalOutput(w){return this.signalOutputs.find((o=>o.name===w))}serialize(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(w),w.signalInputs=[],w.signalOutputs=[];for(const o of this.signalInputs){const H={};o.serialize(H),w.signalInputs.push(H)}for(const o of this.signalOutputs){const H={};o.serialize(H),w.signalOutputs.push(H)}}deserialize(w){for(let o=0;o<w.signalInputs.length;o++){const H=this.getSignalInput(w.signalInputs[o].name);if(!H)throw new Error("Could not find signal input with name "+w.signalInputs[o].name+" in block "+w.className);H.deserialize(w.signalInputs[o])}for(let o=0;o<w.signalOutputs.length;o++){const H=this.getSignalOutput(w.signalOutputs[o].name);if(!H)throw new Error("Could not find signal output with name "+w.signalOutputs[o].name+" in block "+w.className);H.deserialize(w.signalOutputs[o])}}getClassName(){return"FlowGraphExecutionBlock"}}},13507:(w,o,H)=>{"use strict";H.d(o,{e:()=>E});var h=H(13469);class E extends h.d{constructor(w){super(w),this.out=this._registerSignalOutput("out")}}},13455:(w,o,H)=>{"use strict";H.d(o,{D:()=>S,E:()=>c,F:()=>T,I:()=>O,e:()=>L,f:()=>z,g:()=>l,k:()=>i,m:()=>s,n:()=>V,p:()=>y,q:()=>P,t:()=>A,x:()=>C,y:()=>Q,z:()=>M});var h,E=H(11720),e=H(11757),D=H(13446),t=H(13462);!function(w){w.Any="any",w.String="string",w.Number="number",w.Boolean="boolean",w.Object="object",w.Integer="FlowGraphInteger",w.Vector2="Vector2",w.io="io",w.Vector4="Vector4",w.Quaternion="Quaternion",w.Matrix="Matrix",w.Matrix2D="Matrix2D",w.Matrix3D="Matrix3D",w.ko="ko",w.ae="ae"}(h||(h={}));class X{constructor(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=w,this.defaultValue=o,this.animationType=H}serialize(w){w.typeName=this.typeName,w.defaultValue=this.defaultValue}}const L=new X("any",void 0),A=new X("string",""),y=new X("number",0,0),z=new X("boolean",!1),C=new X("Vector2",E.Vector2.Zero(),5),Q=new X("io",E.io.Zero(),1),M=new X("Vector4",E.Vector4.Zero()),i=new X("Matrix",E.Matrix.Identity(),3),s=new X("Matrix2D",new t.d),V=new X("Matrix3D",new t.g),r=new X("ko",e.ko.Black(),4),k=new X("ae",new e.ae(0,0,0,0),7),P=new X("Quaternion",E.Quaternion.Identity(),2);P.typeTransformer=w=>{if(w.getClassName){if("Vector4"===w.getClassName())return E.Quaternion.Po(w.Ae());if("io"===w.getClassName())return E.Quaternion.FromEulerVector(w);if("Matrix"===w.getClassName())return E.Quaternion.FromRotationMatrix(w)}return w};const l=new X("FlowGraphInteger",new D.d(0),0);function O(w){const o=w;switch(typeof w){case"string":return A;case"number":return y;case"boolean":return z;case"object":if(o.getClassName)switch(o.getClassName()){case"Vector2":return C;case"io":return Q;case"Vector4":return M;case"Matrix":return i;case"ko":return r;case"ae":return k;case"Quaternion":return P;case"FlowGraphInteger":return l;case"Matrix2D":return s;case"Matrix3D":return V}return L;default:return L}}function T(w){switch(w){case"string":return A;case"number":return y;case"boolean":return z;case"Vector2":return C;case"io":return Q;case"Vector4":return M;case"Matrix":return i;case"ko":return r;case"ae":return k;case"Quaternion":return P;case"FlowGraphInteger":return l;case"Matrix2D":return s;case"Matrix3D":return V;default:return L}}function S(w){switch(w){case"number":default:return 0;case"Vector2":return 5;case"io":return 1;case"Matrix":return 3;case"ko":return 4;case"ae":return 7;case"Quaternion":return 2}}function c(w){switch(w){case 0:return y;case 5:return C;case 1:return Q;case 3:return i;case 4:return r;case 7:return k;case 2:return P;default:return L}}},13439:(w,o,H)=>{"use strict";H.d(o,{b:()=>A,d:()=>L,g:()=>y});var h=H(11757),E=H(11720),e=H(13446),D=H(13455),t=H(13462);function X(w){return"Vector2"===w||"io"===w||"Vector4"===w||"Quaternion"===w||"ko"===w||"ae"===w}function L(w,o,H){var h;const E=(null===o||void 0===o||null===(h=o.getClassName)||void 0===h?void 0:h.call(o))??"";if(X(E)||function(w){return"Matrix"===w||"Matrix2D"===w||"Matrix3D"===w}(E))H[w]={value:o.Ae(),className:E};else if("FlowGraphInteger"===E)H[w]={value:o.value,className:E};else if(E&&(o.id||o.name))H[w]={id:o.id,name:o.name,className:E};else{if("object"===typeof o)throw new Error(`Could not serialize value ${o}`);H[w]=o}}function A(w,o,H,L){const y=o[w];let z;const C=(null===y||void 0===y?void 0:y.type)??(null===y||void 0===y?void 0:y.className);if(function(w){return"Mesh"===w||"AbstractMesh"===w||"GroundMesh"===w||"InstanceMesh"===w||"LinesMesh"===w||"GoldbergMesh"===w||"GreasedLineMesh"===w||"TrailMesh"===w}(C)){let w=L.meshes.filter((w=>y.id?w.id===y.id:w.name===y.name));0===w.length&&(w=L.transformNodes.filter((w=>y.id?w.id===y.id:w.name===y.name))),z=y.uniqueId?w.find((w=>w.uniqueId===y.uniqueId)):w[0]}else if(X(C))z=function(w,o){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===w)return E.Vector2.Po(o);if("io"===w)return H&&(o[2]*=-1),E.io.Po(o);if("Vector4"===w)return E.Vector4.Po(o);if("Quaternion"===w)return H&&(o[2]*=-1,o[3]*=-1),E.Quaternion.Po(o);if("ko"===w)return new h.ko(o[0],o[1],o[2]);if("ae"===w)return new h.ae(o[0],o[1],o[2],o[3]);throw new Error(`Unknown vector class name ${w}`)}(C,y.value);else if(function(w){return"AnimationGroup"===w}(C)){const w=L.animationGroups.filter((w=>w.name===y.name));z=1===w.length?w[0]:w.find((w=>w.uniqueId===y.uniqueId))}else z="Matrix"===C?E.Matrix.Po(y.value):"Matrix2D"===C?new t.d(y.value):"Matrix3D"===C?new t.g(y.value):"FlowGraphInteger"===C?e.d.FromValue(y.value):"number"===C||"string"===C||"boolean"===C?y.value[0]:y&&void 0!==y.value?y.value:Array.isArray(y)?y.reduce(((w,o)=>o.eventData?(w[o.id]={type:(0,D.F)(o.type)},"undefined"!==typeof o.value&&(w[o.id].value=A("value",o,H,L)),w):w),{}):y;return z}function y(w){return"FlowGraphJsonPointerParserBlock"===w}},13486:(w,o,H)=>{"use strict";function h(w,o){return!(!w.parent||w.parent!==o&&!h(w.parent,o))}function E(w){if(w.getClassName)return w.getClassName()}function e(w,o){return w===o&&("Vector2"===w||"io"===w||"Vector4"===w||"Quaternion"===w)}function D(w,o){return w===o&&("Matrix"===w||"Matrix2D"===w||"Matrix3D"===w)}function t(w,o){return"FlowGraphInteger"===w&&"FlowGraphInteger"===o}function X(w,o){const H="number"===typeof w||"number"===typeof(null===w||void 0===w?void 0:w.value);return H&&!o?!isNaN(L(w)):H}function L(w){return"number"===typeof w?w:w.value}H.d(o,{d:()=>t,e:()=>D,g:()=>e,i:()=>E,j:()=>h,n:()=>L,q:()=>X})},12824:(w,o,H)=>{"use strict";H.r(o),H.d(o,{SceneInstrumentation:()=>e});var h=H(11531),E=H(11929);class e{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(w){w!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=w,w?(this._onBeforeActiveMeshesEvaluationObserver=this.Vo.onBeforeActiveMeshesEvaluationObservable.add((()=>{h.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Vo.onAfterActiveMeshesEvaluationObservable.add((()=>{h.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Vo.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Vo.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(w){w!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=w,w?(this._onBeforeRenderTargetsRenderObserver=this.Vo.onBeforeRenderTargetsRenderObservable.add((()=>{h.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Vo.onAfterRenderTargetsRenderObservable.add((()=>{h.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Vo.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Vo.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(w){w!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=w,w?(this._onBeforeParticlesRenderingObserver=this.Vo.onBeforeParticlesRenderingObservable.add((()=>{h.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Vo.onAfterParticlesRenderingObservable.add((()=>{h.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Vo.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Vo.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(w){w!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=w,this.Vo.spriteManagers&&(w?(this._onBeforeSpritesRenderingObserver=this.Vo.onBeforeSpritesRenderingObservable.add((()=>{h.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Vo.onAfterSpritesRenderingObservable.add((()=>{h.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Vo.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Vo.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(w){w!==this._capturePhysicsTime&&this.Vo.onBeforePhysicsObservable&&(this._capturePhysicsTime=w,w?(this._onBeforePhysicsObserver=this.Vo.onBeforePhysicsObservable.add((()=>{h.Tools.StartPerformanceCounter("ny"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Vo.onAfterPhysicsObservable.add((()=>{h.Tools.EndPerformanceCounter("ny"),this._physicsTime.endMonitoring()}))):(this.Vo.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Vo.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(w){w!==this._captureAnimationsTime&&(this._captureAnimationsTime=w,w?this._onAfterAnimationsObserver=this.Vo.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Vo.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(w){this._captureFrameTime=w}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(w){this._captureInterFrameTime=w}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(w){w!==this._captureRenderTime&&(this._captureRenderTime=w,w?(this._onBeforeDrawPhaseObserver=this.Vo.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),h.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Vo.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),h.Tools.EndPerformanceCounter("Main render")}))):(this.Vo.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Vo.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(w){w!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=w,w?(this._onBeforeCameraRenderObserver=this.Vo.onBeforeCameraRenderObservable.add((w=>{this._cameraRenderTime.beginMonitoring(),h.Tools.StartPerformanceCounter(`Rendering camera ${w.name}`)})),this._onAfterCameraRenderObserver=this.Vo.onAfterCameraRenderObservable.add((w=>{this._cameraRenderTime.endMonitoring(!1),h.Tools.EndPerformanceCounter(`Rendering camera ${w.name}`)}))):(this.Vo.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Vo.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Vo.getEngine()._drawCalls}constructor(w){this.Vo=w,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new E.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new E.e,this._captureFrameTime=!1,this._frameTime=new E.e,this._captureRenderTime=!1,this._renderTime=new E.e,this._captureInterFrameTime=!1,this._interFrameTime=new E.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new E.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new E.e,this._capturePhysicsTime=!1,this._physicsTime=new E.e,this._captureAnimationsTime=!1,this._animationsTime=new E.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new E.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=w.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(h.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Vo.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=w.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(h.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.xh(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.xh(),this._captureParticlesRenderTime&&this._particlesRenderTime.xh(),this._captureSpritesRenderTime&&this._spritesRenderTime.xh(),this._captureRenderTime&&this._renderTime.xh(),this._captureCameraRenderTime&&this._cameraRenderTime.xh()}))}dispose(){this._disposed||(this.Vo.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Vo.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Vo.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Vo.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Vo.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Vo.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Vo.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Vo.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Vo.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Vo.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Vo.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Vo.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Vo.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Vo.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Vo.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Vo.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Vo.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Vo=null,this._disposed=!0)}}},13426:(w,o,H)=>{"use strict";H.d(o,{e:()=>A});var h=H(11697),E=H(11702),e=H(11720),D=H(12133),t=H(12262),X=H(12319),L=H(11666);D.c.AddNodeConstructor("Light_Type_1",((w,o)=>()=>new A(w,e.io.Zero(),o)));class A extends X.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(w){this._shadowFrustumSize=w,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(w){this._shadowOrthoScale=w,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(w){this._orthoLeft=w}get orthoRight(){return this._orthoRight}set orthoRight(w){this._orthoRight=w}get orthoTop(){return this._orthoTop}set orthoTop(w){this._orthoTop=w}get orthoBottom(){return this._orthoBottom}set orthoBottom(w){this._orthoBottom=w}constructor(w,o,H){super(w,H),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=o.scale(-1),this.direction=o}getClassName(){return"pz"}getTypeID(){return t.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(w,o,H){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(w):this._setDefaultAutoExtendShadowProjectionMatrix(w,o,H)}_setDefaultFixedFrustumShadowProjectionMatrix(w){const o=this.Ow().activeCamera;o&&e.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:o.Qe,void 0!==this.shadowMaxZ?this.shadowMaxZ:o.maxZ,w,this.Ow().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(w,o,H){const h=this.Ow().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const w=e.io.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let h=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let D=0;D<H.length;D++){const t=H[D];if(!t)continue;const X=t.getBoundingInfo().boundingBox;for(let H=0;H<X.vectorsWorld.length;H++)e.io.TransformCoordinatesToRef(X.vectorsWorld[H],o,w),w.x<this._orthoLeft&&(this._orthoLeft=w.x),w.y<this._orthoBottom&&(this._orthoBottom=w.y),w.x>this._orthoRight&&(this._orthoRight=w.x),w.y>this._orthoTop&&(this._orthoTop=w.y),this.autoCalcShadowZBounds&&(w.z<h&&(h=w.z),w.z>E&&(E=w.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=h,this._shadowMaxZ=E)}const E=this._orthoRight-this._orthoLeft,D=this._orthoTop-this._orthoBottom,t=void 0!==this.shadowMinZ?this.shadowMinZ:(null===h||void 0===h?void 0:h.Qe)||0,X=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===h||void 0===h?void 0:h.maxZ)||1e4,L=this.Ow().getEngine().useReverseDepthBuffer;e.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-E*this.shadowOrthoScale,this._orthoRight+E*this.shadowOrthoScale,this._orthoBottom-D*this.shadowOrthoScale,this._orthoTop+D*this.shadowOrthoScale,L?X:t,L?t:X,w,this.Ow().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(w,o){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,o),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,o),this)}transferToNodeMaterialEffect(w,o){return this.computeTransformedInformation()?(w.setFloat3(o,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(w.setFloat3(o,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(w){const o=this._scene.getEngine();return!o.useReverseDepthBuffer&&o.isNDCHalfZRange?0:1}getDepthMaxZ(w){const o=this._scene.getEngine();return o.useReverseDepthBuffer&&o.isNDCHalfZRange?0:1}prepareLightSpecificDefines(w,o){w["DIRLIGHT"+o]=!0}}(0,h.b)([(0,E.B)()],A.prototype,"shadowFrustumSize",null),(0,h.b)([(0,E.B)()],A.prototype,"shadowOrthoScale",null),(0,h.b)([(0,E.B)()],A.prototype,"autoUpdateExtends",void 0),(0,h.b)([(0,E.B)()],A.prototype,"autoCalcShadowZBounds",void 0),(0,h.b)([(0,E.B)("orthoLeft")],A.prototype,"_orthoLeft",void 0),(0,h.b)([(0,E.B)("orthoRight")],A.prototype,"_orthoRight",void 0),(0,h.b)([(0,E.B)("orthoTop")],A.prototype,"_orthoTop",void 0),(0,h.b)([(0,E.B)("orthoBottom")],A.prototype,"_orthoBottom",void 0),(0,L.g)("BABYLON.DirectionalLight",A)},13949:(w,o,H)=>{"use strict";H.d(o,{c:()=>A});var h=H(11697),E=H(11702),e=H(11720),D=H(11757),t=H(12133),X=H(12262),L=H(11666);t.c.AddNodeConstructor("Light_Type_3",((w,o)=>()=>new A(w,e.io.Zero(),o)));class A extends X.b{constructor(w,o,H){super(w,H),this.groundColor=new D.ko(0,0,0),this.direction=o||e.io.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"nz"}setDirectionToTarget(w){return this.direction=e.io.Normalize(w.so(e.io.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(w,o){const H=e.io.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",H.x,H.y,H.z,0,o),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Ue),o),this}transferToNodeMaterialEffect(w,o){const H=e.io.Normalize(this.direction);return w.setFloat3(o,H.x,H.y,H.z),this}se(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._worldMatrix}getTypeID(){return X.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(w,o){w["HEMILIGHT"+o]=!0}}(0,h.b)([(0,E.h)()],A.prototype,"groundColor",void 0),(0,h.b)([(0,E.A)()],A.prototype,"direction",void 0),(0,L.g)("BABYLON.HemisphericLight",A)},13392:(w,o,H)=>{"use strict";H.d(o,{c:()=>y});var h=H(11697),E=H(11702),e=H(11720),D=H(12133),t=H(12262),X=H(12319),L=H(11690),A=H(11666);D.c.AddNodeConstructor("Light_Type_2",((w,o)=>()=>new y(w,e.io.Zero(),e.io.Zero(),0,0,o)));class y extends X.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(w){this._iesProfileTexture!==w&&(this._iesProfileTexture=w,this._iesProfileTexture&&y._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(w){this._angle=w,this._cosHalfAngle=Math.cos(.5*w),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(w){this._innerAngle=w,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(w){this._shadowAngleScale=w,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(w){this._projectionTextureLightNear=w,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(w){this._projectionTextureLightFar=w,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(w){this._projectionTextureUpDirection=w,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(w){this._projectionTexture!==w&&(this._projectionTexture=w,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(y._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):y._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(w){return void 0!==w.onGeneratedObservable}static _IsTexture(w){return void 0!==w.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(w){this._projectionTextureProjectionLightMatrix=w,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(w,o,H,h,E,D){super(w,D),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=e.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=e.io.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=e.io.Zero(),this._projectionTextureViewLightMatrix=e.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=e.Matrix.Zero(),this._projectionTextureScalingMatrix=e.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=o,this.direction=H,this.angle=h,this.exponent=E}getClassName(){return"SpotLight"}getTypeID(){return t.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(w){super._setDirection(w),this._projectionTextureViewLightDirty=!0}_setPosition(w){super._setPosition(w),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(w,o,H){const h=this.Ow().activeCamera;if(!h)return;this._shadowAngleScale=this._shadowAngleScale||1;const E=this._shadowAngleScale*this._angle,D=void 0!==this.shadowMinZ?this.shadowMinZ:h.Qe,t=void 0!==this.shadowMaxZ?this.shadowMaxZ:h.maxZ,X=this.Ow().getEngine().useReverseDepthBuffer;e.Matrix.PerspectiveFovLHToRef(E,1,X?t:D,X?D:t,w,!0,this._scene.getEngine().isNDCHalfZRange,void 0,X)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),e.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const w=this.projectionTextureLightFar,o=this.projectionTextureLightNear,H=w/(w-o),h=-H*o,E=1/Math.tan(this._angle/2);e.Matrix.FromValuesToRef(E/1,0,0,0,0,E,0,0,0,0,H,1,0,0,h,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof L.d){const w=this._projectionTexture.uScale/2,o=this._projectionTexture.vScale/2;e.Matrix.FromValuesToRef(w,0,0,0,0,o,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(w,o){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),w.setMatrix("textureProjectionMatrix"+o,this._projectionTextureMatrix),w.setTexture("projectionLightTexture"+o,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&w.setTexture("iesLightTexture"+o,this._iesProfileTexture),this}transferToEffect(w,o){let H;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,o),H=e.io.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,o),H=e.io.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",H.x,H.y,H.z,this._cosHalfAngle,o),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,o),this}transferToNodeMaterialEffect(w,o){let H;return H=this.computeTransformedInformation()?e.io.Normalize(this.transformedDirection):e.io.Normalize(this.direction),this.Ow().useRightHandedSystem?w.setFloat3(o,-H.x,-H.y,-H.z):w.setFloat3(o,H.x,H.y,H.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(w){const o=this._scene.getEngine(),H=void 0!==this.shadowMinZ?this.shadowMinZ:(null===w||void 0===w?void 0:w.Qe)??0;return o.useReverseDepthBuffer&&o.isNDCHalfZRange?H:this._scene.getEngine().isNDCHalfZRange?0:H}getDepthMaxZ(w){const o=this._scene.getEngine(),H=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===w||void 0===w?void 0:w.maxZ)??1e4;return o.useReverseDepthBuffer&&o.isNDCHalfZRange?0:H}prepareLightSpecificDefines(w,o){w["SPOTLIGHT"+o]=!0,w["PROJECTEDLIGHTTEXTURE"+o]=!(!this.projectionTexture||!this.projectionTexture.isReady()),w["IESLIGHTTEXTURE"+o]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,h.b)([(0,E.B)()],y.prototype,"angle",null),(0,h.b)([(0,E.B)()],y.prototype,"innerAngle",null),(0,h.b)([(0,E.B)()],y.prototype,"shadowAngleScale",null),(0,h.b)([(0,E.B)()],y.prototype,"exponent",void 0),(0,h.b)([(0,E.B)()],y.prototype,"projectionTextureLightNear",null),(0,h.b)([(0,E.B)()],y.prototype,"projectionTextureLightFar",null),(0,h.b)([(0,E.B)()],y.prototype,"projectionTextureUpDirection",null),(0,h.b)([(0,E.w)("projectedLightTexture")],y.prototype,"_projectionTexture",void 0),(0,A.g)("BABYLON.SpotLight",y)},13113:(w,o,H)=>{"use strict";H.d(o,{b:()=>D,d:()=>e,h:()=>t});const h={},E={};function e(w,o){h[w]=o}function D(w,o){E[w]=o}function t(w){return E[w]?E[w]:null}},13001:(w,o,H)=>{"use strict";H.d(o,{c:()=>O,e:()=>N});var h,E=H(11531),e=H(11540),D=H(11957),t=H(11571),X=H(11551),L=H(12178),A=H(11573),y=H(11582),z=H(11675),C=H(11615),Q=H(11566);!function(w){w[w.Clean=0]="Clean",w[w.Stop=1]="Stop",w[w.Sync=2]="Sync",w[w.NoSync=3]="NoSync"}(h||(h={}));const M=new e.b,i={};let s=!1;function V(){return i[".babylon"]}function r(w,o){const H=i[w];return H||(X.d.Warn("Unable to find a plugin to load "+w+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),o?V():void 0)}function k(w,o,H){let h="Unable to load from "+(w.rawData?"binary data":w.url);return o?h+=`: ${o}`:H&&(h+=`: ${H}`),h}async function P(w,o,H,h,E,e,D,t,X){var L;const y="data:"===(z=w.url).substring(0,5)?z.substring(5):null;var z;if(w.rawData&&!D)throw"When using ArrayBufferView to load data the file extension must be provided.";const s=y||D?"":function(w){const o=w.indexOf("?");-1!==o&&(w=w.substring(0,o));const H=w.lastIndexOf(".");return w.substring(H,w.length).toLowerCase()}(w.url);let k=D?r(D,!0):y?function(w){for(const o in i){const H=i[o].plugin;if(H.canDirectLoad&&H.canDirectLoad(w))return i[o]}return V()}(w.url):r(s,!1);if(!k&&s){if(w.url&&!w.url.startsWith("blob:")){const o=await async function(w,o){const H=o.method||"GET";return await new Promise(((h,E)=>{const e=new Q.b;e.addEventListener("readystatechange",(()=>{if(4==e.readyState)if(200==e.status){const w={};if(o.responseHeaders)for(const H of o.responseHeaders)w[H]=e.getResponseHeader(H)||"";h({response:e.response,headerValues:w})}else E(`Unable to fetch data from ${w}. Error code: ${e.status}`)})),e.open(H,w),e.send()}))}(w.url,{method:"HEAD",responseHeaders:["Content-Type"]}),H=o.headerValues?o.headerValues["Content-Type"]:"";H&&(k=function(w){for(const o in i){const H=i[o];if(H.mimeType===w)return H}}(H))}k||(k=V())}if(!k)throw new Error(`No plugin or fallback for ${D??w.url}`);if(!1===(null===X||void 0===X||null===(L=X[k.plugin.name])||void 0===L?void 0:L.enabled))throw new Error(`The '${k.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(w.rawData&&!k.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(w=>{if(k.plugin.createPlugin){const o=k.plugin.createPlugin(X??{});return o instanceof Promise?(o.then(w).catch((w=>{E("Error instantiating plugin.",w)})),null):(w(o),o)}return w(k.plugin),k.plugin})((X=>{var L;if(!X)throw`The loader plugin corresponding to the '${D}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(M.notifyObservers(X),y&&(X.canDirectLoad&&X.canDirectLoad(w.url)||!(0,A.m)(w.url))){if(X.directLoad){const w=X.directLoad(o,y);w instanceof Promise?w.then((w=>{H(X,w)})).catch((w=>{E("Error in directLoad of _loadData: "+w,w)})):H(X,w)}else H(X,y);return}const z=k.isBinary,Q=(w,h)=>{o.A?E("Scene has been disposed"):H(X,w,h)};let i=null,s=!1;null===(L=X.me)||void 0===L||L.add((()=>{s=!0,i&&(i.abort(),i=null),e()}));const V=()=>{if(s)return;const H=(w,o)=>{E(null===w||void 0===w?void 0:w.statusText,o)};if(!X.loadFile&&w.rawData)throw"Plugin does not support loading ArrayBufferView.";i=X.loadFile?X.loadFile(o,w.rawData||w.file||w.url,w.rootUrl,Q,h,z,H,t):o._loadFile(w.file||w.url,Q,h,!0,z,H)},r=o.getEngine();let P=r.enableOfflineSupport;if(P){let H=!1;for(const h of o.disableOfflineSupportExceptionRules)if(h.test(w.url)){H=!0;break}P=!H}P&&C.c.OfflineProviderFactory?o.offlineProvider=C.c.OfflineProviderFactory(w.url,V,r.disableManifestCheck):V()}))}function l(w,o){let H,h,e=null,D=null;if(o)if(o.name)H=`file:${o.name}`,h=o.name,e=o;else if(ArrayBuffer.isView(o))H="",h=(0,z.e)(),D=o;else if(o.startsWith("data:"))H=o,h="";else if(w){const e=o;if("/"===e.substring(0,1))return E.Tools.Error("Wrong sceneFilename parameter"),null;H=w+e,h=e}else H=o,h=E.Tools.GetFilename(o),w=E.Tools.GetFolderPath(o);else H=w,h=E.Tools.GetFilename(w),w=E.Tools.GetFolderPath(w);return{url:H,rootUrl:w,name:h,file:e,rawData:D}}function O(w){if("string"===typeof w.extensions){const o=w.extensions;i[o.toLowerCase()]={plugin:w,isBinary:!1}}else{const o=w.extensions,H=Object.keys(o);for(const h of H)i[h.toLowerCase()]={plugin:w,isBinary:o[h].isBinary,mimeType:o[h].mimeType}}}async function T(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.e.LastCreatedScene,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!h)return X.d.Error("No scene available to import mesh to"),null;const C=l(o,H);if(!C)return null;const Q={};h.addPendingData(Q);const M=()=>{h.removePendingData(Q)},i=(w,o)=>{const H=k(C,w,o);D?D(h,H,new y.i(H,y.e.SceneLoaderError,o)):X.d.Error(H),M()},s=e?w=>{try{e(w)}catch(o){i("Error in onProgress callback: "+o,o)}}:void 0,V=(w,o,H,e,D,t,X,L)=>{if(h.importedMeshesFiles.push(C.url),E)try{E(w,o,H,e,D,t,X,L)}catch(A){i("Error in onSuccess callback: "+A,A)}h.removePendingData(Q)};return await P(C,h,((o,H,E)=>{if(o.rewriteRootURL&&(C.rootUrl=o.rewriteRootURL(C.rootUrl,E)),o.importMesh){const E=[],e=[],D=[];if(!o.importMesh(w,h,H,C.rootUrl,E,e,D,i))return;h.loadingPluginName=o.name,V(E,e,D,[],[],[],[],[])}else{o.importMeshAsync(w,h,H,C.rootUrl,s,C.name).then((w=>{h.loadingPluginName=o.name,V(w.meshes,w.Ez,w.skeletons,w.animationGroups,w.transformNodes,w.geometries,w.lights,w.spriteManagers)})).catch((w=>{i(w.message,w)}))}}),s,i,M,L,A,z)}async function S(w,o,H,h,E,e,D,t){return await new Promise(((X,L)=>{try{T(w,o,H,h,((w,o,H,h,E,e,D,t)=>{X({meshes:w,Ez:o,skeletons:H,animationGroups:h,transformNodes:E,geometries:e,lights:D,spriteManagers:t})}),E,((w,o,H)=>{L(H||new Error(o))}),e,D,t).catch(L)}catch(y){L(y)}}))}async function c(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.e.LastCreatedEngine,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};H?await B(w,o,new D.e(H),h,e,X,L,A,y):E.Tools.Error("No engine available")}async function W(w,o,H,h,E,e,D){return await new Promise(((t,X)=>{c(w,o,H,(w=>{t(w)}),h,((w,o,H)=>{X(H||new Error(o))}),E,e,D)}))}async function B(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.e.LastCreatedScene,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!H)return X.d.Error("No scene available to append to"),null;const C=l(w,o);if(!C)return null;const Q={};H.addPendingData(Q);const M=()=>{H.removePendingData(Q)};L.c.ShowLoadingScreen&&!s&&(s=!0,H.getEngine().displayLoadingUI(),H.executeWhenReady((()=>{H.getEngine().hideLoadingUI(),s=!1})));const i=(w,o)=>{const h=k(C,w,o);e?e(H,h,new y.i(h,y.e.SceneLoaderError,o)):X.d.Error(h),M()},V=E?w=>{try{E(w)}catch(o){i("Error in onProgress callback",o)}}:void 0,r=()=>{if(h)try{h(H)}catch(w){i("Error in onSuccess callback",w)}H.removePendingData(Q)};return await P(C,H,((w,o)=>{if(w.load){if(!w.load(H,o,C.rootUrl,i))return;H.loadingPluginName=w.name,r()}else{w.loadAsync(H,o,C.rootUrl,V,C.name).then((()=>{H.loadingPluginName=w.name,r()})).catch((w=>{i(w.message,w)}))}}),V,i,M,D,A,z)}async function J(w,o,H,h,E,e,D){return await new Promise(((t,X)=>{try{B(w,o,H,(w=>{t(w)}),h,((w,o,H)=>{X(H||new Error(o))}),E,e,D).catch(X)}catch(y){X(y)}}))}async function g(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.e.LastCreatedScene,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!H)return X.d.Error("No scene available to load asset container to"),null;const z=l(w,o);if(!z)return null;const C={};H.addPendingData(C);const Q=()=>{H.removePendingData(C)},M=(w,o)=>{const h=k(z,w,o);e?e(H,h,new y.i(h,y.e.SceneLoaderError,o)):X.d.Error(h),Q()},i=E?w=>{try{E(w)}catch(o){M("Error in onProgress callback",o)}}:void 0,s=w=>{if(h)try{h(w)}catch(o){M("Error in onSuccess callback",o)}H.removePendingData(C)};return await P(z,H,((w,o)=>{if(w.loadAssetContainer){const h=w.loadAssetContainer(H,o,z.rootUrl,M);if(!h)return;h.populateRootNodes(),H.loadingPluginName=w.name,s(h)}else if(w.loadAssetContainerAsync){w.loadAssetContainerAsync(H,o,z.rootUrl,i,z.name).then((o=>{o.populateRootNodes(),H.loadingPluginName=w.name,s(o)})).catch((w=>{M(w.message,w)}))}else M("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),i,M,Q,D,L,A)}async function b(w,o,H,h,E,e,D){return await new Promise(((t,X)=>{try{g(w,o,H,(w=>{t(w)}),h,((w,o,H)=>{X(H||new Error(o))}),E,e,D).catch(X)}catch(y){X(y)}}))}async function p(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.e.LastCreatedScene,h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",C=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!H)return void X.d.Error("No scene available to load animations to");if(h){for(const h of H.animatables)h.reset();H.stopAllAnimations();const w=H.animationGroups.slice();for(const H of w)H.dispose();const o=H.getNodes();for(const H of o)H.animations&&(H.animations=[])}else switch(E){case 0:const w=H.animationGroups.slice();for(const o of w)o.dispose();break;case 1:for(const o of H.animationGroups)o.stop();break;case 2:for(const o of H.animationGroups)o.reset(),o.restart();break;case 3:break;default:return void X.d.Error("Unknown animation group loading mode value '"+E+"'")}const Q=H.animatables.length;await g(w,o,H,(w=>{w.mergeAnimationsTo(H,H.animatables.slice(Q),e),w.dispose(),H.onAnimationFileImportedObservable.notifyObservers(H),D&&D(H)}),L,A,y,z,C)}async function f(w,o,H,h,E,e,D,t,X,L){return await new Promise(((A,z)=>{try{p(w,o,H,h,E,e,(w=>{A(w)}),D,((w,o,H)=>{z(H||new Error(o))}),t,X,L).catch(z)}catch(y){z(y)}}))}class N{static get ForceFullSceneLoadingForIncremental(){return L.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(w){L.c.ForceFullSceneLoadingForIncremental=w}static get ShowLoadingScreen(){return L.c.ShowLoadingScreen}static set ShowLoadingScreen(w){L.c.ShowLoadingScreen=w}static get loggingLevel(){return L.c.loggingLevel}static set loggingLevel(w){L.c.loggingLevel=w}static get CleanBoneMatrixWeights(){return L.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(w){L.c.CleanBoneMatrixWeights=w}static GetDefaultPlugin(){return V()}static GetPluginForExtension(w){var o;return null===(o=r(w,!0))||void 0===o?void 0:o.plugin}static IsPluginForExtensionAvailable(w){return function(w){return!!i[w]}(w)}static RegisterPlugin(w){O(w)}static ImportMesh(w,o,H,h,E,e,D,X,L){T(w,o,H,h,E,e,D,X,L).catch((w=>null===D||void 0===D?void 0:D(t.e.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async ImportMeshAsync(w,o,H,h,E,e,D){return await S(w,o,H,h,E,e,D)}static Load(w,o,H,h,E,e,D,X){c(w,o,H,h,E,e,D,X).catch((w=>null===e||void 0===e?void 0:e(t.e.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async LoadAsync(w,o,H,h,E,e){return await W(w,o,H,h,E,e)}static Append(w,o,H,h,E,e,D,X){B(w,o,H,h,E,e,D,X).catch((w=>null===e||void 0===e?void 0:e(H??t.e.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async AppendAsync(w,o,H,h,E,e){return await J(w,o,H,h,E,e)}static LoadAssetContainer(w,o,H,h,E,e,D,X){g(w,o,H,h,E,e,D,X).catch((w=>null===e||void 0===e?void 0:e(H??t.e.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async LoadAssetContainerAsync(w,o,H,h,E,e){return await b(w,o,H,h,E,e)}static ImportAnimations(w,o,H,h,E,e,D,X,L,A,y){p(w,o,H,h,E,e,D,X,L,A,y).catch((w=>null===L||void 0===L?void 0:L(H??t.e.LastCreatedScene,null===w||void 0===w?void 0:w.message,w)))}static async ImportAnimationsAsync(w,o,H,h,E,e,D,t,X,L,A){return await f(w,o,H,h,E,e,t,L,A)}}N.NO_LOGGING=0,N.MINIMAL_LOGGING=1,N.SUMMARY_LOGGING=2,N.DETAILED_LOGGING=3,N.OnPluginActivatedObservable=M},13412:(w,o,H)=>{"use strict";H.d(o,{d:()=>z});var h=H(11697),E=H(11702),e=H(11531),D=H(11720),t=H(11734),X=H(11690),L=H(11666),A=H(11540),y=H(11745);H(13415);class z extends t.c{set boundingBoxSize(w){if(this._boundingBoxSize&&this._boundingBoxSize.equals(w))return;this._boundingBoxSize=w;const o=this.Ow();o&&o.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(w){this._rotationY=w,this.setReflectionTextureMatrix(D.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(w,o,H){let h="";for(const E of w)h+=E;return new z(h,o,null,H,w)}static CreateFromPrefilteredData(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=o.useDelayedTextureLoading;o.useDelayedTextureLoading=!1;const e=new z(w,o,null,!1,null,null,null,void 0,!0,H,h);return o.useDelayedTextureLoading=E,e}constructor(w,o){var H;let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,z=arguments.length>8&&void 0!==arguments[8]&&arguments[8],C=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Q=arguments.length>10&&void 0!==arguments[10]&&arguments[10],M=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,i=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,s=arguments.length>13?arguments[13]:void 0,V=arguments.length>14?arguments[14]:void 0;super(o),this.onLoadObservable=new A.b,this.boundingBoxPosition=D.io.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new D.Matrix,this._buffer=null,this.name=w,this.url=w,this._noMipmap=E,this.ze=!1,this.isCube=!0,this._textureMatrix=D.Matrix.Identity(),this.coordinatesMode=X.d.CUBIC_MODE;let r=null,k=null;null===h||Array.isArray(h)?(this._noMipmap=E,this._format=y,this._createPolynomials=Q,r=h,this._loaderOptions=s,this._useSRGBBuffer=V,this._lodScale=M,this._lodOffset=i):(r=h.extensions??null,this._noMipmap=h.noMipmap??!1,e=h.files??null,k=h.buffer??null,this._format=h.format??5,z=h.prefiltered??!1,C=h.forcedExtension??null,this._createPolynomials=h.createPolynomials??!1,this._lodScale=h.lodScale??.8,this._lodOffset=h.lodOffset??0,this._loaderOptions=h.loaderOptions,this._useSRGBBuffer=h.useSRGBBuffer,t=h.v??null,L=h.onError??null),(w||e)&&this.updateURL(w,C,t,z,L,r,null===(H=this.Ow())||void 0===H?void 0:H.useDelayedTextureLoading,e,k)}getClassName(){return"CubeTexture"}updateURL(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,D=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=w),this.url=w,o&&(this._forcedExtension=o);const L=w.lastIndexOf("."),A=o||(L>-1?w.substring(L).toLowerCase():""),y=0===A.indexOf(".dds"),z=0===A.indexOf(".env"),C=0===A.indexOf(".basis");if(z?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=h,h&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),t)this._files=t;else if(C||z||y||e||(e=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,e){for(let o=0;o<e.length;o++)this._files.push(w+e[o]);this._extensions=e}this._buffer=X,D?(this.delayLoadState=4,this._delayedOnLoad=H,this._delayedOnError=E):this._loadTexture(H,E)}delayLoad(w){4===this.delayLoadState&&(w&&(this._forcedExtension=w),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(w){var o,H;if(w.updateFlag===this._textureMatrix.updateFlag)return;w.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(H=this.Ow())||void 0===H||H.markAllMaterialsAsDirty(1,(w=>-1!==w.getActiveTextures().indexOf(this))));if(this._textureMatrix=w,null===(o=this.Ow())||void 0===o||!o.useRightHandedSystem)return;const h=D.TmpVectors.io[0],E=D.TmpVectors.Quaternion[0],e=D.TmpVectors.io[1];this._textureMatrix.decompose(h,E,e),E.z*=-1,E.w*=-1,D.Matrix.ComposeToRef(h,E,e,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var w;return null!==(w=this.Ow())&&void 0!==w&&w.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=this.Ow(),h=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const E=()=>{var o;(this.onLoadObservable.notifyObservers(this),h)&&(h.dispose(),null===(o=this.Ow())||void 0===o||o.markAllMaterialsAsDirty(1));w&&w()},D=(w,H)=>{this._loadingError=!0,this._errorObject={message:w,exception:H},o&&o(w,H),X.d.OnTextureLoadErrorObservable.notifyObservers(this)};var t;this._texture?this._texture.isReady?e.Tools.SetImmediate((()=>E())):this._texture.onLoadedObservable.add((()=>E())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,H,this._lodScale,this._lodOffset,w,D,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,H,this._files,this._noMipmap,w,D,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(t=this._texture)||void 0===t||t.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(w,o,H){const h=y.e.Parse((()=>{let h=!1;return w.prefiltered&&(h=w.prefiltered),new z(H+(w.url??w.name),o,w.extensions,!1,w.files||null,null,null,void 0,h,w.forcedExtension)}),w,o);if(w.boundingBoxPosition&&(h.boundingBoxPosition=D.io.Po(w.boundingBoxPosition)),w.boundingBoxSize&&(h.boundingBoxSize=D.io.Po(w.boundingBoxSize)),w.animations)for(let E=0;E<w.animations.length;E++){const o=w.animations[E],H=(0,L.e)("BABYLON.Animation");H&&h.animations.push(H.Parse(o))}return h}clone(){let w=0;const o=y.e.Clone((()=>{const o=new z(this.url,this.Ow()||this._getEngine(),this._extensions,this._noMipmap,this._files);return w=o.uniqueId,o}),this);return o.uniqueId=w,o}}(0,h.b)([(0,E.B)()],z.prototype,"url",void 0),(0,h.b)([(0,E.A)()],z.prototype,"boundingBoxPosition",void 0),(0,h.b)([(0,E.A)()],z.prototype,"boundingBoxSize",null),(0,h.b)([(0,E.B)("rotationY")],z.prototype,"rotationY",null),(0,h.b)([(0,E.B)("files")],z.prototype,"_files",void 0),(0,h.b)([(0,E.B)("forcedExtension")],z.prototype,"_forcedExtension",void 0),(0,h.b)([(0,E.B)("extensions")],z.prototype,"_extensions",void 0),(0,h.b)([(0,E.p)("textureMatrix")],z.prototype,"_textureMatrix",void 0),(0,h.b)([(0,E.p)("textureMatrixRefraction")],z.prototype,"_textureMatrixRefraction",void 0),X.d._CubeTextureParser=z.Parse,(0,L.g)("BABYLON.CubeTexture",z)},13954:(w,o,H)=>{"use strict";H.d(o,{b:()=>X});var h=H(11551),E=H(11690),e=H(11683),D=H(11841),t=H(11640);D.ThinEngine.prototype.createDynamicTexture=function(w,o,H,h){const E=new t.c(this,4);return E.baseWidth=w,E.baseHeight=o,H&&(w=this.needPOTTextures?(0,e.e)(w,this._caps.maxTextureSize):w,o=this.needPOTTextures?(0,e.e)(o,this._caps.maxTextureSize):o),E.width=w,E.height=o,E.isReady=!1,E.generateMipMaps=H,E.samplingMode=h,this.updateTextureSamplingMode(h,E),this._internalTexturesCache.push(E),E},D.ThinEngine.prototype.updateDynamicTexture=function(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,e=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!w)return;const D=this._gl,t=D.TEXTURE_2D,X=this._bindTextureDirectly(t,w,!0,e);this._unpackFlipY(void 0===H?w.invertY:H),h&&D.pixelStorei(D.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const L=this._getWebGLTextureType(w.type),A=this._getInternalFormat(E||w.format),y=this._getRGBABufferInternalSizedFormat(w.type,A);D.texImage2D(t,0,y,A,L,o),w.generateMipMaps&&D.generateMipmap(t),X||this._bindTextureDirectly(t,null),h&&D.pixelStorei(D.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),E&&(w.format=E),w._dynamicTextureSource=o,w._premulAlpha=h,w.invertY=H||!1,w.isReady=!0};class X extends E.d{constructor(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,t=arguments.length>6?arguments[6]:void 0;const X=!H||H._isScene;super(null,X?H:null===H||void 0===H?void 0:H.Vo,X?!h:H,t,e,void 0,void 0,void 0,void 0,D),this.name=w,this.wrapU=E.d.CLAMP_ADDRESSMODE,this.wrapV=E.d.CLAMP_ADDRESSMODE,this._generateMipMaps=h;const L=this._getEngine();if(!L)return;if(o.getContext)this._canvas=o,this._ownCanvas=!1,this._texture=L.createDynamicTexture(this._canvas.width,this._canvas.height,h,e);else{this._canvas=L.createCanvas(1,1),this._ownCanvas=!0;const w=o;w.width||0===w.width?this._texture=L.createDynamicTexture(w.width,w.height,h,e):this._texture=L.createDynamicTexture(o,o,h,e)}const A=this.getSize();this._canvas.width!==A.width&&(this._canvas.width=A.width),this._canvas.height!==A.height&&(this._canvas.height=A.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(w){this._canvas.width=w.width,this._canvas.height=w.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(w.width,w.height,this._generateMipMaps,this.samplingMode)}scale(w){const o=this.getSize();o.width*=w,o.height*=w,this._recreate(o)}scaleTo(w,o){const H=this.getSize();H.width=w,H.height=o,this._recreate(H)}getContext(){return this._context}clear(w){const o=this.getSize();w&&(this._context.fillStyle=w),this._context.clearRect(0,0,o.width,o.height)}update(w){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===w||w,o,this._format||void 0,void 0,H)}drawText(w,o,H,h,E,e,D){let t=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const X=this.getSize();if(e&&(this._context.fillStyle=e,this._context.fillRect(0,0,X.width,X.height)),this._context.font=h,null===o||void 0===o){const H=this._context.measureText(w);o=(X.width-H.width)/2}if(null===H||void 0===H){const w=parseInt(h.replace(/\D/g,""));H=X.height/2+w/3.65}this._context.fillStyle=E||"",this._context.fillText(w,o,H),t&&this.update(D)}dispose(){var w,o;(super.dispose(),this._ownCanvas)&&(null===(w=this._canvas)||void 0===w||null===(o=w.remove)||void 0===o||o.call(w));this._canvas=null,this._context=null}clone(){const w=this.Ow();if(!w)return this;const o=this.getSize(),H=new X(this.name,o,w,this._generateMipMaps);return H.ze=this.ze,H.level=this.level,H.wrapU=this.wrapU,H.wrapV=this.wrapV,H}serialize(){const w=this.Ow();w&&!w.isReady()&&h.d.Warn("The scene must be ready before serializing the dynamic texture");const o=super.serialize();return X._IsCanvasElement(this._canvas)&&(o.base64String=this._canvas.toDataURL()),o.invertY=this._invertY,o.samplingMode=this.samplingMode,o}static _IsCanvasElement(w){return void 0!==w.toDataURL}_rebuild(){this.update()}}},13316:(w,o,H)=>{"use strict";H.d(o,{b:()=>E});var h=H(11690);class E extends h.d{get depth(){return this._depth}constructor(w,o,H,E,e,D){let t=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],X=arguments.length>7&&void 0!==arguments[7]&&arguments[7],L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:h.d.TRILINEAR_SAMPLINGMODE,A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,y=arguments.length>10?arguments[10]:void 0;super(null,D,!t,X),this.format=e,this._texture=D.getEngine().createRawTexture2DArray(w,o,H,E,e,t,X,L,null,A,y),this._depth=E,this.is2DArray=!0}update(w){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,w,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(w,o,H,h,e){return new E(w,o,H,h,5,e,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13121:(w,o,H)=>{"use strict";H.d(o,{d:()=>t,f:()=>X,g:()=>e,j:()=>D});var h=H(11729),E=H(11720);function e(w,o){return`{X: ${w.x.toFixed(o)} Y: ${w.y.toFixed(o)}}`}function D(w,o){return`{X: ${w._x.toFixed(o)} Y: ${w._y.toFixed(o)} Z: ${w._z.toFixed(o)}}`}function t(w,o){return 2*Math.acos((0,h.Clamp)(E.Quaternion.Dot(w,o)))}function X(w,o){const H=new E.Quaternion;return function(w,o,H){const e=E.io.Cross(w,o),D=Math.acos((0,h.Clamp)(E.io.Dot(w,o),-1,1));E.Quaternion.RotationAxisToRef(e,D,H)}(w,o,H),H}},12951:(w,o,H)=>{"use strict";H.d(o,{b:()=>L});var h=H(11720),E=H(11757),e=H(12165),D=H(12142),t=H(11770);H(12957);function X(w){let o=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const H=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],e=[];let X=[];const L=w.width||w.size||1,A=w.height||w.size||1,y=w.depth||w.size||1,z=w.wrap||!1;let C=void 0===w.topBaseAt?1:w.topBaseAt,Q=void 0===w.bottomBaseAt?0:w.bottomBaseAt;C=(C+4)%4,Q=(Q+4)%4;let M=[2,0,3,1][C],i=[2,0,1,3][Q],s=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(z){o=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],s=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let w=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],H=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const h=[17,18,19,16],E=[22,23,20,21];for(;M>0;)w.unshift(w.pop()),h.unshift(h.pop()),M--;for(;i>0;)H.unshift(H.pop()),E.unshift(E.pop()),i--;w=w.flat(),H=H.flat(),s=s.concat(w).concat(H),o.push(h[0],h[2],h[3],h[0],h[1],h[2]),o.push(E[0],E[2],E[3],E[0],E[1],E[2])}const V=[L/2,A/2,y/2];X=s.reduce(((w,o,H)=>w.concat(o*V[H%3])),[]);const r=0===w.sideOrientation?0:w.sideOrientation||D.b.DEFAULTSIDE,k=w.faceUV||new Array(6),P=w.faceColors,l=[];for(let D=0;D<6;D++)void 0===k[D]&&(k[D]=new h.Vector4(0,0,1,1)),P&&void 0===P[D]&&(P[D]=new E.ae(1,1,1,1));for(let h=0;h<6;h++)if(e.push(k[h].z,t.c?1-k[h].w:k[h].w),e.push(k[h].x,t.c?1-k[h].w:k[h].w),e.push(k[h].x,t.c?1-k[h].y:k[h].y),e.push(k[h].z,t.c?1-k[h].y:k[h].y),P)for(let w=0;w<4;w++)l.push(P[h].r,P[h].g,P[h].b,P[h].a);D.b._ComputeSides(r,X,o,H,e,w.frontUVs,w.backUVs);const O=new D.b;if(O.indices=o,O.Sw=X,O.cw=H,O.Bw=e,P){const w=r===D.b.DOUBLESIDE?l.concat(l):l;O.Ww=w}return O}function L(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new e.d(w,H);o.sideOrientation=e.d._GetDefaultSideOrientation(o.sideOrientation),h._originalBuilderSideOrientation=o.sideOrientation;return X(o).gw(h,o.updatable),h}D.b.CreateBox=X,e.d.CreateBox=function(w,o){return L(w,{size:o,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13115:(w,o,H)=>{"use strict";H.d(o,{e:()=>t});var h=H(12165),E=H(12142),e=H(11770);function D(w){const o=[],H=[],h=[],D=[],t=w.radius||.5,X=w.tessellation||64,L=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1,A=0===w.sideOrientation?0:w.sideOrientation||E.b.DEFAULTSIDE;o.push(0,0,0),D.push(.5,.5);const y=2*Math.PI*L,z=1===L?y/X:y/(X-1);let C=0;for(let E=0;E<X;E++){const w=Math.cos(C),H=Math.sin(C),h=(w+1)/2,E=(1-H)/2;o.push(t*w,t*H,0),D.push(h,e.c?1-E:E),C+=z}1===L&&(o.push(o[3],o[4],o[5]),D.push(D[2],e.c?1-D[3]:D[3]));const Q=o.length/3;for(let E=1;E<Q-1;E++)H.push(E+1,0,E);E.b.ComputeNormals(o,H,h),E.b._ComputeSides(A,o,H,h,D,w.frontUVs,w.backUVs);const M=new E.b;return M.indices=H,M.Sw=o,M.cw=h,M.Bw=D,M}function t(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new h.d(w,H);o.sideOrientation=h.d._GetDefaultSideOrientation(o.sideOrientation),E._originalBuilderSideOrientation=o.sideOrientation;return D(o).gw(E,o.updatable),E}E.b.CreateDisc=D,h.d.CreateDisc=function(w,o,H){return t(w,{radius:o,tessellation:H,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12957:(w,o,H)=>{"use strict";H.d(o,{g:()=>i,d:()=>V,i:()=>s});var h=H(11720),E=H(11757),e=H(12165),D=H(12142),t=H(11780);e.d._GroundMeshParser=(w,o)=>X.Parse(w,o);class X extends e.d{constructor(w,o){super(w,o),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=w,this._subdivisionsY=w,this.subdivide(w);const H=this;H.createOrUpdateSubmeshesOctree&&H.createOrUpdateSubmeshesOctree(o)}getHeightAtCoordinates(w,o){const H=this.getWorldMatrix(),E=h.TmpVectors.Matrix[5];H.invertToRef(E);const e=h.TmpVectors.io[8];if(h.io.TransformCoordinatesFromFloatsToRef(w,0,o,E,e),w=e.x,o=e.z,w<this._minX||w>=this._maxX||o<=this._minZ||o>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const D=this._getFacetAt(w,o),t=-(D.x*w+D.z*o+D.w)/D.y;return h.io.TransformCoordinatesFromFloatsToRef(0,t,0,H,e),e.y}getNormalAtCoordinates(w,o){const H=new h.io(0,1,0);return this.getNormalAtCoordinatesToRef(w,o,H),H}getNormalAtCoordinatesToRef(w,o,H){const E=this.getWorldMatrix(),e=h.TmpVectors.Matrix[5];E.invertToRef(e);const D=h.TmpVectors.io[8];if(h.io.TransformCoordinatesFromFloatsToRef(w,0,o,e,D),w=D.x,o=D.z,w<this._minX||w>this._maxX||o<this._minZ||o>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const t=this._getFacetAt(w,o);return h.io.TransformNormalFromFloatsToRef(t.x,t.y,t.z,E,H),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(w,o){const H=Math.floor((w+this._maxX)*this._subdivisionsX/this._width),h=Math.floor(-(o+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),E=this._heightQuads[h*this._subdivisionsX+H];let e;return e=o<E.slope.x*w+E.slope.y?E.facet1:E.facet2,e}_initHeightQuads(){const w=this._subdivisionsX,o=this._subdivisionsY;this._heightQuads=[];for(let H=0;H<o;H++)for(let o=0;o<w;o++){const E={slope:h.Vector2.Zero(),facet1:new h.Vector4(0,0,0,0),facet2:new h.Vector4(0,0,0,0)};this._heightQuads[H*w+o]=E}return this}_computeHeightQuads(){const w=this.getVerticesData(t.e.PositionKind);if(!w)return this;const o=h.TmpVectors.io[3],H=h.TmpVectors.io[2],E=h.TmpVectors.io[1],e=h.TmpVectors.io[0],D=h.TmpVectors.io[4],X=h.TmpVectors.io[5],L=h.TmpVectors.io[6],A=h.TmpVectors.io[7],y=h.TmpVectors.io[8];let z=0,C=0,Q=0,M=0,i=0,s=0,V=0;const r=this._subdivisionsX,k=this._subdivisionsY;for(let t=0;t<k;t++)for(let k=0;k<r;k++){z=3*k,C=t*(r+1)*3,Q=(t+1)*(r+1)*3,o.x=w[C+z],o.y=w[C+z+1],o.z=w[C+z+2],H.x=w[C+z+3],H.y=w[C+z+4],H.z=w[C+z+5],E.x=w[Q+z],E.y=w[Q+z+1],E.z=w[Q+z+2],e.x=w[Q+z+3],e.y=w[Q+z+4],e.z=w[Q+z+5],M=(e.z-o.z)/(e.x-o.x),i=o.z-M*o.x,H.subtractToRef(o,D),E.subtractToRef(o,X),e.subtractToRef(o,L),h.io.CrossToRef(L,X,A),h.io.CrossToRef(D,L,y),A.normalize(),y.normalize(),s=-(A.x*o.x+A.y*o.y+A.z*o.z),V=-(y.x*H.x+y.y*H.y+y.z*H.z);const P=this._heightQuads[t*r+k];P.slope.We(M,i),P.facet1.We(A.x,A.y,A.z,s),P.facet2.We(y.x,y.y,y.z,V)}return this}serialize(w){super.serialize(w),w.subdivisionsX=this._subdivisionsX,w.subdivisionsY=this._subdivisionsY,w.minX=this._minX,w.maxX=this._maxX,w.Qe=this._minZ,w.maxZ=this._maxZ,w.width=this._width,w.height=this._height}static Parse(w,o){const H=new X(w.name,o);return H._subdivisionsX=w.subdivisionsX||1,H._subdivisionsY=w.subdivisionsY||1,H._minX=w.minX,H._maxX=w.maxX,H._minZ=w.Qe,H._maxZ=w.maxZ,H._width=w.width,H._height=w.height,H}}var L=H(11531),A=H(11571),y=H(11722),z=H(11770);function C(w){const o=[],H=[],E=[],e=[];let t,X;const L=w.width||w.size||1,A=w.height||w.size||1,y=0|(w.subdivisionsX||w.subdivisions||1),C=0|(w.subdivisionsY||w.subdivisions||1);for(t=0;t<=C;t++)for(X=0;X<=y;X++){const w=new h.io(X*L/y-L/2,0,(C-t)*A/C-A/2),o=new h.io(0,1,0);H.push(w.x,w.y,w.z),E.push(o.x,o.y,o.z),e.push(X/y,z.c?t/C:1-t/C)}for(t=0;t<C;t++)for(X=0;X<y;X++)o.push(X+1+(t+1)*(y+1)),o.push(X+1+t*(y+1)),o.push(X+t*(y+1)),o.push(X+(t+1)*(y+1)),o.push(X+1+(t+1)*(y+1)),o.push(X+t*(y+1));const Q=new D.b;return Q.indices=o,Q.Sw=H,Q.cw=E,Q.Bw=e,Q}function Q(w){const o=void 0!==w.xmin&&null!==w.xmin?w.xmin:-1,H=void 0!==w.zmin&&null!==w.zmin?w.zmin:-1,E=void 0!==w.xmax&&null!==w.xmax?w.xmax:1,e=void 0!==w.zmax&&null!==w.zmax?w.zmax:1,t=w.subdivisions||{w:1,h:1},X=w.precision||{w:1,h:1},L=[],A=[],y=[],z=[];let C,Q,M,i;t.h=t.h<1?1:t.h,t.w=t.w<1?1:t.w,X.w=X.w<1?1:X.w,X.h=X.h<1?1:X.h;const s=(E-o)/t.w,V=(e-H)/t.h;function r(w,o,H,E){const e=A.length/3,D=X.w+1;for(C=0;C<X.h;C++)for(Q=0;Q<X.w;Q++){const w=[e+Q+C*D,e+(Q+1)+C*D,e+(Q+1)+(C+1)*D,e+Q+(C+1)*D];L.push(w[1]),L.push(w[2]),L.push(w[3]),L.push(w[0]),L.push(w[1]),L.push(w[3])}const t=h.io.Zero(),M=new h.io(0,1,0);for(C=0;C<=X.h;C++)for(t.z=C*(E-o)/X.h+o,Q=0;Q<=X.w;Q++)t.x=Q*(H-w)/X.w+w,t.y=0,A.push(t.x,t.y,t.z),y.push(M.x,M.y,M.z),z.push(Q/X.w,C/X.h)}for(M=0;M<t.h;M++)for(i=0;i<t.w;i++)r(o+i*s,H+M*V,o+(i+1)*s,H+(M+1)*V);const k=new D.b;return k.indices=L,k.Sw=A,k.cw=y,k.Bw=z,k}function M(w){const o=[],H=[],e=[],t=[];let X,L;const A=w.colorFilter||new E.ko(.3,.59,.11),z=w.alphaFilter||0;let C=!1;if(w.minHeight>w.maxHeight){C=!0;const o=w.maxHeight;w.maxHeight=w.minHeight,w.minHeight=o}for(X=0;X<=w.subdivisions;X++)for(L=0;L<=w.subdivisions;L++){const o=new h.io(L*w.width/w.subdivisions-w.width/2,0,(w.subdivisions-X)*w.height/w.subdivisions-w.height/2),E=4*(((o.x+w.width/2)/w.width*(w.bufferWidth-1)|0)+((1-(o.z+w.height/2)/w.height)*(w.bufferHeight-1)|0)*w.bufferWidth);let D=w.buffer[E]/255,Q=w.buffer[E+1]/255,M=w.buffer[E+2]/255;const i=w.buffer[E+3]/255;C&&(D=1-D,Q=1-Q,M=1-M);const s=D*A.r+Q*A.g+M*A.b;o.y=i>=z?w.minHeight+(w.maxHeight-w.minHeight)*s:w.minHeight-y.c,w.heightBuffer&&(w.heightBuffer[X*(w.subdivisions+1)+L]=o.y),H.push(o.x,o.y,o.z),e.push(0,0,0),t.push(L/w.subdivisions,1-X/w.subdivisions)}for(X=0;X<w.subdivisions;X++)for(L=0;L<w.subdivisions;L++){const h=L+1+(X+1)*(w.subdivisions+1),E=L+1+X*(w.subdivisions+1),e=L+X*(w.subdivisions+1),D=L+(X+1)*(w.subdivisions+1),t=H[3*h+1]>=w.minHeight,A=H[3*E+1]>=w.minHeight,y=H[3*e+1]>=w.minHeight;t&&A&&y&&(o.push(h),o.push(E),o.push(e));H[3*D+1]>=w.minHeight&&t&&y&&(o.push(D),o.push(h),o.push(e))}D.b.ComputeNormals(H,o,e);const Q=new D.b;return Q.indices=o,Q.Sw=H,Q.cw=e,Q.Bw=t,Q}function i(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const H=new X(w,arguments.length>2?arguments[2]:void 0);H._setReady(!1),H._subdivisionsX=o.subdivisionsX||o.subdivisions||1,H._subdivisionsY=o.subdivisionsY||o.subdivisions||1,H._width=o.width||1,H._height=o.height||1,H._maxX=H._width/2,H._maxZ=H._height/2,H._minX=-H._maxX,H._minZ=-H._maxZ;return C(o).gw(H,o.updatable),H._setReady(!0),H}function s(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new e.d(w,H);return Q(o).gw(h,o.updatable),h}function V(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const e=H.width||10,D=H.height||10,t=H.subdivisions||1,y=H.minHeight||0,z=H.maxHeight||1,C=H.colorFilter||new E.ko(.3,.59,.11),Q=H.alphaFilter||0,i=H.updatable,s=H.onReady;h=h||A.e.LastCreatedScene;const V=new X(w,h);let r;V._subdivisionsX=t,V._subdivisionsY=t,V._width=e,V._height=D,V._maxX=V._width/2,V._maxZ=V._height/2,V._minX=-V._maxX,V._minZ=-V._maxZ,V._setReady(!1),H.passHeightBufferInCallback&&(r=new Float32Array((t+1)*(t+1)));const k=(w,o,H)=>{M({width:e,height:D,subdivisions:t,minHeight:y,maxHeight:z,colorFilter:C,buffer:w,bufferWidth:o,bufferHeight:H,alphaFilter:Q,heightBuffer:r}).gw(V,i),s&&s(V,r),V._setReady(!0)};if("string"===typeof o){const w=w=>{var o;const H=w.width,E=w.height;if(h.A)return;const e=null===(o=h)||void 0===o?void 0:o.getEngine().resizeImageBitmap(w,H,E);k(e,H,E)};L.Tools.LoadImage(o,w,H.onError?H.onError:()=>{},h.offlineProvider)}else k(o.data,o.width,o.height);return V}D.b.CreateGround=C,D.b.CreateTiledGround=Q,D.b.CreateGroundFromHeightMap=M,e.d.CreateGround=(w,o,H,h,E,e)=>i(w,{width:o,height:H,subdivisions:h,updatable:e},E),e.d.CreateTiledGround=(w,o,H,h,E,e,D,t,X)=>s(w,{xmin:o,zmin:H,xmax:h,zmax:E,subdivisions:e,precision:D,updatable:X},t),e.d.CreateGroundFromHeightMap=(w,o,H,h,E,e,D,t,X,L,A)=>V(w,o,{width:H,height:h,subdivisions:E,minHeight:e,maxHeight:D,updatable:X,onReady:L,alphaFilter:A},t)},13659:(w,o,H)=>{"use strict";H.d(o,{e:()=>C,h:()=>y,i:()=>z});var h=H(11720),E=H(12165),e=H(12142),D=H(12266),t=H(11780),X=H(11551);function L(w){const o=[],H=[],h=w.lines,E=w.Ww,D=[];let t=0;for(let e=0;e<h.length;e++){const w=h[e];for(let h=0;h<w.length;h++){const{x:X,y:L,z:A}=w[h];if(H.push(X,L,A),E){const w=E[e],{r:o,g:H,b:t,a:X}=w[h];D.push(o,H,t,X)}h>0&&(o.push(t-1),o.push(t)),t++}}const X=new e.b;return X.indices=o,X.Sw=H,E&&(X.Ww=D),X}function A(w){const o=w.dashSize||3,H=w.gapSize||1,E=w.dashNb||200,D=w.points,t=[],X=[],L=h.io.Zero();let A=0,y=0,z=0,C=0,Q=0,M=0,i=0;for(i=0;i<D.length-1;i++)D[i+1].subtractToRef(D[i],L),A+=L.length();for(z=A/E,C=o*z/(o+H),i=0;i<D.length-1;i++){D[i+1].subtractToRef(D[i],L),y=Math.floor(L.length()/z),L.normalize();for(let w=0;w<y;w++)Q=z*w,t.push(D[i].x+Q*L.x,D[i].y+Q*L.y,D[i].z+Q*L.z),t.push(D[i].x+(Q+C)*L.x,D[i].y+(Q+C)*L.y,D[i].z+(Q+C)*L.z),X.push(M,M+1),M+=2}const s=new e.b;return s.Sw=t,s.indices=X,s}function y(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=o.instance,E=o.lines,e=o.Ww;if(h){const w=h.getVerticesData(t.e.PositionKind);let o,H;e&&(o=h.getVerticesData(t.e.ColorKind));let D=0,X=0;for(let h=0;h<E.length;h++){const t=E[h];for(let E=0;E<t.length;E++)w[D]=t[E].x,w[D+1]=t[E].y,w[D+2]=t[E].z,e&&o&&(H=e[h],o[X]=H[E].r,o[X+1]=H[E].g,o[X+2]=H[E].b,o[X+3]=H[E].a,X+=4),D+=3}return h.updateVerticesData(t.e.PositionKind,w,!1,!1),e&&o&&h.updateVerticesData(t.e.ColorKind,o,!1,!1),h.refreshBoundingInfo(),h}const X=!!e,A=new D.d(w,H,null,void 0,void 0,X,o.useVertexAlpha,o.material);return L(o).gw(A,o.updatable),A}function z(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=o.Ww?[o.Ww]:null;return y(w,{lines:[o.points],updatable:o.updatable,instance:o.instance,Ww:h,useVertexAlpha:o.useVertexAlpha,material:o.material},H)}function C(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=o.points,t=o.instance,L=o.gapSize||1,y=o.dashSize||3;if(t){const w=w=>{const o=h.io.Zero(),H=w.length/6;let E=0,D=0,X=0,L=0,A=0,y=0,z=0,C=0;for(z=0;z<e.length-1;z++)e[z+1].subtractToRef(e[z],o),E+=o.length();X=E/H;const Q=t._creationDataStorage.dashSize;for(L=Q*X/(Q+t._creationDataStorage.gapSize),z=0;z<e.length-1;z++)for(e[z+1].subtractToRef(e[z],o),D=Math.floor(o.length()/X),o.normalize(),C=0;C<D&&y<w.length;)A=X*C,w[y]=e[z].x+A*o.x,w[y+1]=e[z].y+A*o.y,w[y+2]=e[z].z+A*o.z,w[y+3]=e[z].x+(A+L)*o.x,w[y+4]=e[z].y+(A+L)*o.y,w[y+5]=e[z].z+(A+L)*o.z,y+=6,C++;for(;y<w.length;)w[y]=e[z].x,w[y+1]=e[z].y,w[y+2]=e[z].z,y+=3};return(o.dashNb||o.dashSize||o.gapSize||o.useVertexAlpha||o.material)&&X.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),t.updateMeshPositions(w,!1),t}const z=new D.d(w,H,null,void 0,void 0,void 0,o.useVertexAlpha,o.material);return A(o).gw(z,o.updatable),z._creationDataStorage=new E.h,z._creationDataStorage.dashSize=y,z._creationDataStorage.gapSize=L,z}e.b.CreateLineSystem=L,e.b.CreateDashedLines=A,E.d.VL=function(w,o){return z(w,{points:o,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},E.d.CreateDashedLines=function(w,o,H,h,E){return C(w,{points:o,dashSize:H,gapSize:h,dashNb:E,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13006:(w,o,H)=>{"use strict";H.d(o,{e:()=>t,i:()=>X});var h=H(12165),E=H(12142),e=H(11770);function D(w){const o=[],H=[],h=[],D=[],t=void 0!==w.width?w.width:void 0!==w.size?w.size:1,X=void 0!==w.height?w.height:void 0!==w.size?w.size:1,L=0===w.sideOrientation?0:w.sideOrientation||E.b.DEFAULTSIDE,A=t/2,y=X/2;H.push(-A,-y,0),h.push(0,0,-1),D.push(0,e.c?1:0),H.push(A,-y,0),h.push(0,0,-1),D.push(1,e.c?1:0),H.push(A,y,0),h.push(0,0,-1),D.push(1,e.c?0:1),H.push(-A,y,0),h.push(0,0,-1),D.push(0,e.c?0:1),o.push(0),o.push(1),o.push(2),o.push(0),o.push(2),o.push(3),E.b._ComputeSides(L,H,o,h,D,w.frontUVs,w.backUVs);const z=new E.b;return z.indices=o,z.Sw=H,z.cw=h,z.Bw=D,z}function t(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new h.d(w,H);o.sideOrientation=h.d._GetDefaultSideOrientation(o.sideOrientation),E._originalBuilderSideOrientation=o.sideOrientation;return D(o).gw(E,o.updatable),o.sourcePlane&&(E.translate(o.sourcePlane.normal,-o.sourcePlane.d),E.setDirection(o.sourcePlane.normal.scale(-1))),E}const X={PL:t};E.b.PL=D,h.d.PL=(w,o,H,h,E)=>t(w,{size:o,width:o,height:o,sideOrientation:E,updatable:h},H)},13110:(w,o,H)=>{"use strict";H.d(o,{e:()=>X});var h=H(11720),E=H(12165),e=H(12142),D=H(11770);function t(w){const o=0|(w.segments||32),H=w.diameterX||w.diameter||1,E=w.diameterY||w.diameter||1,t=w.diameterZ||w.diameter||1,X=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1,L=w.slice&&w.slice<=0?1:w.slice||1,A=0===w.sideOrientation?0:w.sideOrientation||e.b.DEFAULTSIDE,y=!!w.dedupTopBottomIndices,z=new h.io(H/2,E/2,t/2),C=2+o,Q=2*C,M=[],i=[],s=[],V=[];for(let e=0;e<=C;e++){const w=e/C,o=w*Math.PI*L;for(let H=0;H<=Q;H++){const E=H/Q,e=E*Math.PI*2*X,t=h.Matrix.RotationZ(-o),L=h.Matrix.RotationY(e),A=h.io.TransformCoordinates(h.io.Up(),t),y=h.io.TransformCoordinates(A,L),C=y.multiply(z),M=y.divide(z).normalize();i.push(C.x,C.y,C.z),s.push(M.x,M.y,M.z),V.push(E,D.c?1-w:w)}if(e>0){const w=i.length/3;for(let o=w-2*(Q+1);o+Q+2<w;o++)y?(e>1&&(M.push(o),M.push(o+1),M.push(o+Q+1)),(e<C||L<1)&&(M.push(o+Q+1),M.push(o+1),M.push(o+Q+2))):(M.push(o),M.push(o+1),M.push(o+Q+1),M.push(o+Q+1),M.push(o+1),M.push(o+Q+2))}}e.b._ComputeSides(A,i,M,s,V,w.frontUVs,w.backUVs);const r=new e.b;return r.indices=M,r.Sw=i,r.cw=s,r.Bw=V,r}function X(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new E.d(w,H);o.sideOrientation=E.d._GetDefaultSideOrientation(o.sideOrientation),h._originalBuilderSideOrientation=o.sideOrientation;return t(o).gw(h,o.updatable),h}e.b.CreateSphere=t,E.d.CreateSphere=(w,o,H,h,E,e)=>X(w,{segments:o,diameterX:H,diameterY:H,diameterZ:H,sideOrientation:e,updatable:E},h)},13967:(w,o,H)=>{"use strict";H.d(o,{c:()=>t});var h=H(12290),E=H(13423),e=H(12309),D=H(12142);class t{static get Configuration(){return{get decoder(){return E.d.DefaultConfiguration},set decoder(w){E.d.DefaultConfiguration=w}}}static set Configuration(w){E.d.DefaultConfiguration=w.decoder}static get DecoderAvailable(){return(0,h.h)(E.d.DefaultConfiguration)}static get Default(){return t._Default??(t._Default=new t),t._Default}static ResetDefault(w){t._Default&&(w||t._Default.dispose(),t._Default=null)}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.DefaultNumWorkers;const o="number"===typeof w?{...E.d.DefaultConfiguration,numWorkers:w}:{...E.d.DefaultConfiguration,...w};this._decoder=new E.d(o)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(w,o,H){return this._decoder.decodeMeshToMeshDataAsync(w,o,H)}async decodeMeshToGeometryAsync(w,o,H,h){return await this._decoder.decodeMeshToGeometryAsync(w,o,H,h)}async _decodeMeshToGeometryForGltfAsync(w,o,H,h,E,e){return await this._decoder._decodeMeshToGeometryForGltfAsync(w,o,H,h,E,e)}async decodeMeshAsync(w,o){const H=await this._decoder.decodeMeshToMeshDataAsync(w,o),h=new D.b;H.indices&&(h.indices=H.indices);for(const E of H.attributes){const w=e.b.GetFloatData(E.data,E.size,e.b.GetDataType(E.data),E.byteOffset,E.byteStride,E.normalized,H.totalVertices);h.set(w,E.kind)}return h}}t.DefaultNumWorkers=(0,h.g)(),t._Default=null},13423:(w,o,H)=>{"use strict";H.d(o,{d:()=>L});var h=H(12290),E=H(11531),e=H(12171),D=H(12309),t=H(11551),X=H(12301);class L extends h.d{static get DefaultAvailable(){return(0,h.h)(L.DefaultConfiguration)}static get Default(){return L._Default??(L._Default=new L),L._Default}static ResetDefault(w){L._Default&&(w||L._Default.dispose(),L._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(w,o){return{module:await(o||DracoDecoderModule)({wasmBinary:w})}}_getWorkerContent(){return`${X.b}(${X.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:L.DefaultConfiguration)}decodeMeshToMeshDataAsync(w,o,H){const h=w instanceof ArrayBuffer?new Int8Array(w):new Int8Array(w.buffer,w.byteOffset,w.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async w=>await new Promise(((E,e)=>{w.push(((w,D)=>{let X=null;const L=[],A=o=>{w.removeEventListener("error",A),w.removeEventListener("message",y),e(o),D()},y=o=>{const h=o.data;switch(h.id){case"indices":X=h.data;break;case"attribute":L.push({kind:h.kind,data:h.data,size:h.size,byteOffset:h.byteOffset,byteStride:h.byteStride,normalized:(e=h.kind,z=h.normalized,H&&void 0!==H[e]?(z!==H[e]&&t.d.Warn(`Normalized flag from Draco data (${z}) does not match normalized flag from glTF accessor (${H[e]}). Using flag from glTF accessor.`),H[e]):z)});break;case"decodeMeshDone":w.removeEventListener("error",A),w.removeEventListener("message",y),E({indices:X,attributes:L,totalVertices:h.totalVertices}),D()}var e,z};w.addEventListener("error",A),w.addEventListener("message",y);const z=h.slice();w.postMessage({id:"decodeMesh",dataView:z,attributes:o},[z.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((w=>{let H=null;const E=[],e=(0,X.b)(w.module,h,o,(w=>{H=w}),((w,o,H,h,e,D)=>{E.push({kind:w,data:o,size:H,byteOffset:h,byteStride:e,normalized:D})}));return{indices:H,attributes:E,totalVertices:e}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(w,o,H,h){const E=await this.decodeMeshToMeshDataAsync(H,h),t=new e.d(w,o);E.indices&&t.setIndices(E.indices);for(const e of E.attributes)t.setVerticesBuffer(new D.b(o.getEngine(),e.data,e.kind,!1,void 0,e.byteStride,void 0,e.byteOffset,e.size,void 0,e.normalized,!0),E.totalVertices);return t}async _decodeMeshToGeometryForGltfAsync(w,o,H,h,E,t){const X=await this.decodeMeshToMeshDataAsync(H,h,E),L=new e.d(w,o);t&&(L._boundingInfo=t,L.useBoundingInfoFromGeometry=!0),X.indices&&L.setIndices(X.indices);for(const e of X.attributes)L.setVerticesBuffer(new D.b(o.getEngine(),e.data,e.kind,!1,void 0,e.byteStride,void 0,e.byteOffset,e.size,void 0,e.normalized,!0),X.totalVertices);return L}}L.DefaultConfiguration={wasmUrl:`${E.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${E.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${E.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},L._Default=null},13657:(w,o,H)=>{"use strict";H.d(o,{c:()=>tw});var h=H(11720),E=H(12165),e=H(11780),D=H(12142),t=H(11770);function X(w){let o=w.pathArray;const H=w.closeArray||!1,h=w.closePath||!1,E=w.invertUV||!1,X=Math.floor(o[0].length/2);let L=w.offset||X;L=L>X?X:Math.floor(L);const A=0===w.sideOrientation?0:w.sideOrientation||D.b.DEFAULTSIDE,y=w.Bw,z=w.Ww,C=[],Q=[],M=[],i=[],s=[],V=[],r=[],k=[];let P;const l=[],O=[];let T,S,c;if(o.length<2){const w=[],H=[];for(S=0;S<o[0].length-L;S++)w.push(o[0][S]),H.push(o[0][S+L]);o=[w,H]}let W=0;const B=h?1:0,J=H?1:0;let g,b,p,f,N,j;for(P=o[0].length,T=0;T<o.length+J;T++){for(r[T]=0,s[T]=[0],g=T===o.length?o[0]:o[T],b=g.length,P=P<b?P:b,c=0;c<b;)C.push(g[c].x,g[c].y,g[c].z),c>0&&(p=g[c].so(g[c-1]).length(),f=p+r[T],s[T].push(f),r[T]=f),c++;h&&(c--,C.push(g[0].x,g[0].y,g[0].z),p=g[c].so(g[0]).length(),f=p+r[T],s[T].push(f),r[T]=f),l[T]=b+B,O[T]=W,W+=b+B}let q,u,n=null,G=null;for(S=0;S<P+B;S++)for(k[S]=0,V[S]=[0],T=0;T<o.length-1+J;T++)N=o[T],j=T===o.length-1?o[0]:o[T+1],S===P?(n=N[0],G=j[0]):(n=N[S],G=j[S]),p=G.so(n).length(),f=p+k[S],V[S].push(f),k[S]=f;if(y)for(T=0;T<y.length;T++)i.push(y[T].x,t.c?1-y[T].y:y[T].y);else for(T=0;T<o.length+J;T++)for(S=0;S<P+B;S++)q=0!=r[T]?s[T][S]/r[T]:0,u=0!=k[S]?V[S][T]/k[S]:0,E?i.push(u,q):i.push(q,t.c?1-u:u);T=0;let R=0,a=l[T]-1,d=l[T+1]-1,I=a<d?a:d,U=O[1]-O[0];const Z=l.length-1;for(;R<=I&&T<Z;)Q.push(R,R+U,R+1),Q.push(R+U+1,R+1,R+U),R+=1,R===I&&(T++,U=O[T+1]-O[T],a=l[T]-1,d=l[T+1]-1,R=O[T],I=a<d?a+R:d+R);if(D.b.ComputeNormals(C,Q,M),h){let w=0,H=0;for(T=0;T<o.length;T++){w=3*O[T],H=T+1<o.length?3*(O[T+1]-1):M.length-3,M[w]=.5*(M[w]+M[H]),M[w+1]=.5*(M[w+1]+M[H+1]),M[w+2]=.5*(M[w+2]+M[H+2]);const h=Math.sqrt(M[w]*M[w]+M[w+1]*M[w+1]+M[w+2]*M[w+2]);M[w]/=h,M[w+1]/=h,M[w+2]/=h,M[H]=M[w],M[H+1]=M[w+1],M[H+2]=M[w+2]}}if(H){let w=3*O[0],H=3*O[o.length];for(S=0;S<P+B;S++){M[w]=.5*(M[w]+M[H]),M[w+1]=.5*(M[w+1]+M[H+1]),M[w+2]=.5*(M[w+2]+M[H+2]);const o=Math.sqrt(M[w]*M[w]+M[w+1]*M[w+1]+M[w+2]*M[w+2]);M[w]/=o,M[w+1]/=o,M[w+2]/=o,M[H]=M[w],M[H+1]=M[w+1],M[H+2]=M[w+2],w+=3,H+=3}}D.b._ComputeSides(A,C,Q,M,i,w.frontUVs,w.backUVs);let K=null;if(z){K=new Float32Array(4*z.length);for(let w=0;w<z.length;w++)K[4*w]=z[w].r,K[4*w+1]=z[w].g,K[4*w+2]=z[w].b,K[4*w+3]=z[w].a}const F=new D.b,v=new Float32Array(C),mw=new Float32Array(M),Y=new Float32Array(i);return F.indices=Q,F.Sw=v,F.cw=mw,F.Bw=Y,K&&F.set(K,e.e.ColorKind),h&&(F._idx=O),F}function L(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=o.pathArray,A=o.closeArray,y=o.closePath,z=E.d._GetDefaultSideOrientation(o.sideOrientation),C=o.instance,Q=o.updatable;if(C){const w=h.TmpVectors.io[0].Ge(Number.MAX_VALUE),H=h.TmpVectors.io[1].Ge(-Number.MAX_VALUE),X=o=>{let h=L[0].length;const e=C;let D=0;const t=e._originalBuilderSideOrientation===E.d.DOUBLESIDE?2:1;for(let E=1;E<=t;++E)for(let t=0;t<L.length;++t){const E=L[t],X=E.length;h=h<X?h:X;for(let e=0;e<h;++e){const h=E[e];o[D]=h.x,o[D+1]=h.y,o[D+2]=h.z,w.minimizeInPlaceFromFloats(h.x,h.y,h.z),H.maximizeInPlaceFromFloats(h.x,h.y,h.z),D+=3}if(e._creationDataStorage&&e._creationDataStorage.closePath){const w=E[0];o[D]=w.x,o[D+1]=w.y,o[D+2]=w.z,D+=3}}},A=C.getVerticesData(e.e.PositionKind);if(X(A),C.hasBoundingInfo?C.getBoundingInfo().reConstruct(w,H,C._worldMatrix):C.buildBoundingInfo(w,H,C._worldMatrix),C.updateVerticesData(e.e.PositionKind,A,!1,!1),o.Ww){const w=C.getVerticesData(e.e.ColorKind);for(let H=0,h=0;H<o.Ww.length;H++,h+=4){const E=o.Ww[H];w[h]=E.r,w[h+1]=E.g,w[h+2]=E.b,w[h+3]=E.a}C.updateVerticesData(e.e.ColorKind,w,!1,!1)}if(o.Bw){const w=C.getVerticesData(e.e.UVKind);for(let H=0;H<o.Bw.length;H++)w[2*H]=o.Bw[H].x,w[2*H+1]=t.c?1-o.Bw[H].y:o.Bw[H].y;C.updateVerticesData(e.e.UVKind,w,!1,!1)}if(!C.areNormalsFrozen||C.isFacetDataEnabled){const w=C.ke(),o=C.getVerticesData(e.e.NormalKind),H=C.isFacetDataEnabled?C.getFacetDataParameters():null;if(D.b.ComputeNormals(A,w,o,H),C._creationDataStorage&&C._creationDataStorage.closePath){let w=0,H=0;for(let h=0;h<L.length;h++)w=3*C._creationDataStorage.idx[h],H=h+1<L.length?3*(C._creationDataStorage.idx[h+1]-1):o.length-3,o[w]=.5*(o[w]+o[H]),o[w+1]=.5*(o[w+1]+o[H+1]),o[w+2]=.5*(o[w+2]+o[H+2]),o[H]=o[w],o[H+1]=o[w+1],o[H+2]=o[w+2]}C.areNormalsFrozen||C.updateVerticesData(e.e.NormalKind,o,!1,!1)}return C}{const h=new E.d(w,H);h._originalBuilderSideOrientation=z,h._creationDataStorage=new E.h;const e=X(o);return y&&(h._creationDataStorage.idx=e._idx),h._creationDataStorage.closePath=y,h._creationDataStorage.closeArray=A,e.gw(h,Q),h}}D.b.CreateRibbon=X,E.d.CreateRibbon=function(w,o){return L(w,{pathArray:o,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var A=H(13115),y=H(12951),z=H(11757);function C(w){const o=w.pattern||E.d.NO_FLIP,H=w.tileWidth||w.tileSize||1,h=w.tileHeight||w.tileSize||1,e=w.alignHorizontal||0,t=w.alignVertical||0,X=w.width||w.size||1,L=Math.floor(X/H);let A=X-L*H;const y=w.height||w.size||1,z=Math.floor(y/h);let C=y-z*h;const Q=H*L/2,M=h*z/2;let i=0,s=0,V=0,r=0,k=0,P=0;if(A>0||C>0){switch(V=-Q,r=-M,k=Q,P=M,e){case E.d.CENTER:A/=2,V-=A,k+=A;break;case E.d.LEFT:k+=A,i=-A/2;break;case E.d.RIGHT:V-=A,i=A/2}switch(t){case E.d.CENTER:C/=2,r-=C,P+=C;break;case E.d.BOTTOM:P+=C,s=-C/2;break;case E.d.TOP:r-=C,s=C/2}}const l=[],O=[],T=[];T[0]=[0,0,1,0,1,1,0,1],T[1]=[0,0,1,0,1,1,0,1],o!==E.d.ROTATE_TILE&&o!==E.d.ROTATE_ROW||(T[1]=[1,1,0,1,0,0,1,0]),o!==E.d.FLIP_TILE&&o!==E.d.FLIP_ROW||(T[1]=[1,0,0,0,0,1,1,1]),o!==E.d.FLIP_N_ROTATE_TILE&&o!==E.d.FLIP_N_ROTATE_ROW||(T[1]=[0,1,1,1,1,0,0,0]);let S=[];const c=[],W=[];let B=0;for(let D=0;D<z;D++)for(let w=0;w<L;w++)l.push(w*H-Q+i,D*h-M+s,0),l.push((w+1)*H-Q+i,D*h-M+s,0),l.push((w+1)*H-Q+i,(D+1)*h-M+s,0),l.push(w*H-Q+i,(D+1)*h-M+s,0),W.push(B,B+1,B+3,B+1,B+2,B+3),S=o===E.d.FLIP_TILE||o===E.d.ROTATE_TILE||o===E.d.FLIP_N_ROTATE_TILE?S.concat(T[(w%2+D%2)%2]):o===E.d.FLIP_ROW||o===E.d.ROTATE_ROW||o===E.d.FLIP_N_ROTATE_ROW?S.concat(T[D%2]):S.concat(T[0]),c.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),B+=4;if(A>0||C>0){const w=C>0&&(t===E.d.CENTER||t===E.d.TOP),D=C>0&&(t===E.d.CENTER||t===E.d.BOTTOM),X=A>0&&(e===E.d.CENTER||e===E.d.RIGHT),y=A>0&&(e===E.d.CENTER||e===E.d.LEFT);let T,J,g,b,p=[];if(w&&X&&(l.push(V+i,r+s,0),l.push(-Q+i,r+s,0),l.push(-Q+i,r+C+s,0),l.push(V+i,r+C+s,0),W.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,T=1-A/H,J=1-C/h,g=1,b=1,p=[T,J,g,J,g,b,T,b],o===E.d.ROTATE_ROW&&(p=[1-T,1-J,1-g,1-J,1-g,1-b,1-T,1-b]),o===E.d.FLIP_ROW&&(p=[1-T,J,1-g,J,1-g,b,1-T,b]),o===E.d.FLIP_N_ROTATE_ROW&&(p=[T,1-J,g,1-J,g,1-b,T,1-b]),S=S.concat(p),c.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w&&y&&(l.push(Q+i,r+s,0),l.push(k+i,r+s,0),l.push(k+i,r+C+s,0),l.push(Q+i,r+C+s,0),W.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,T=0,J=1-C/h,g=A/H,b=1,p=[T,J,g,J,g,b,T,b],(o===E.d.ROTATE_ROW||o===E.d.ROTATE_TILE&&L%2===0)&&(p=[1-T,1-J,1-g,1-J,1-g,1-b,1-T,1-b]),(o===E.d.FLIP_ROW||o===E.d.FLIP_TILE&&L%2===0)&&(p=[1-T,J,1-g,J,1-g,b,1-T,b]),(o===E.d.FLIP_N_ROTATE_ROW||o===E.d.FLIP_N_ROTATE_TILE&&L%2===0)&&(p=[T,1-J,g,1-J,g,1-b,T,1-b]),S=S.concat(p),c.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),D&&X&&(l.push(V+i,M+s,0),l.push(-Q+i,M+s,0),l.push(-Q+i,P+s,0),l.push(V+i,P+s,0),W.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,T=1-A/H,J=0,g=1,b=C/h,p=[T,J,g,J,g,b,T,b],(o===E.d.ROTATE_ROW&&z%2===1||o===E.d.ROTATE_TILE&&z%1===0)&&(p=[1-T,1-J,1-g,1-J,1-g,1-b,1-T,1-b]),(o===E.d.FLIP_ROW&&z%2===1||o===E.d.FLIP_TILE&&z%2===0)&&(p=[1-T,J,1-g,J,1-g,b,1-T,b]),(o===E.d.FLIP_N_ROTATE_ROW&&z%2===1||o===E.d.FLIP_N_ROTATE_TILE&&z%2===0)&&(p=[T,1-J,g,1-J,g,1-b,T,1-b]),S=S.concat(p),c.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),D&&y&&(l.push(Q+i,M+s,0),l.push(k+i,M+s,0),l.push(k+i,P+s,0),l.push(Q+i,P+s,0),W.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,T=0,J=0,g=A/H,b=C/h,p=[T,J,g,J,g,b,T,b],(o===E.d.ROTATE_ROW&&z%2===1||o===E.d.ROTATE_TILE&&(z+L)%2===1)&&(p=[1-T,1-J,1-g,1-J,1-g,1-b,1-T,1-b]),(o===E.d.FLIP_ROW&&z%2===1||o===E.d.FLIP_TILE&&(z+L)%2===1)&&(p=[1-T,J,1-g,J,1-g,b,1-T,b]),(o===E.d.FLIP_N_ROTATE_ROW&&z%2===1||o===E.d.FLIP_N_ROTATE_TILE&&(z+L)%2===1)&&(p=[T,1-J,g,1-J,g,1-b,T,1-b]),S=S.concat(p),c.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w){const w=[];T=0,J=1-C/h,g=1,b=1,w[0]=[T,J,g,J,g,b,T,b],w[1]=[T,J,g,J,g,b,T,b],o!==E.d.ROTATE_TILE&&o!==E.d.ROTATE_ROW||(w[1]=[1-T,1-J,1-g,1-J,1-g,1-b,1-T,1-b]),o!==E.d.FLIP_TILE&&o!==E.d.FLIP_ROW||(w[1]=[1-T,J,1-g,J,1-g,b,1-T,b]),o!==E.d.FLIP_N_ROTATE_TILE&&o!==E.d.FLIP_N_ROTATE_ROW||(w[1]=[T,1-J,g,1-J,g,1-b,T,1-b]);for(let h=0;h<L;h++)l.push(h*H-Q+i,r+s,0),l.push((h+1)*H-Q+i,r+s,0),l.push((h+1)*H-Q+i,r+C+s,0),l.push(h*H-Q+i,r+C+s,0),W.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,S=o===E.d.FLIP_TILE||o===E.d.ROTATE_TILE||o===E.d.FLIP_N_ROTATE_TILE?S.concat(w[(h+1)%2]):o===E.d.FLIP_ROW||o===E.d.ROTATE_ROW||o===E.d.FLIP_N_ROTATE_ROW?S.concat(w[1]):S.concat(w[0]),c.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(D){const w=[];T=0,J=0,g=1,b=C/h,w[0]=[T,J,g,J,g,b,T,b],w[1]=[T,J,g,J,g,b,T,b],o!==E.d.ROTATE_TILE&&o!==E.d.ROTATE_ROW||(w[1]=[1-T,1-J,1-g,1-J,1-g,1-b,1-T,1-b]),o!==E.d.FLIP_TILE&&o!==E.d.FLIP_ROW||(w[1]=[1-T,J,1-g,J,1-g,b,1-T,b]),o!==E.d.FLIP_N_ROTATE_TILE&&o!==E.d.FLIP_N_ROTATE_ROW||(w[1]=[T,1-J,g,1-J,g,1-b,T,1-b]);for(let h=0;h<L;h++)l.push(h*H-Q+i,P-C+s,0),l.push((h+1)*H-Q+i,P-C+s,0),l.push((h+1)*H-Q+i,P+s,0),l.push(h*H-Q+i,P+s,0),W.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,S=o===E.d.FLIP_TILE||o===E.d.ROTATE_TILE||o===E.d.FLIP_N_ROTATE_TILE?S.concat(w[(h+z)%2]):o===E.d.FLIP_ROW||o===E.d.ROTATE_ROW||o===E.d.FLIP_N_ROTATE_ROW?S.concat(w[z%2]):S.concat(w[0]),c.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(X){const w=[];T=1-A/H,J=0,g=1,b=1,w[0]=[T,J,g,J,g,b,T,b],w[1]=[T,J,g,J,g,b,T,b],o!==E.d.ROTATE_TILE&&o!==E.d.ROTATE_ROW||(w[1]=[1-T,1-J,1-g,1-J,1-g,1-b,1-T,1-b]),o!==E.d.FLIP_TILE&&o!==E.d.FLIP_ROW||(w[1]=[1-T,J,1-g,J,1-g,b,1-T,b]),o!==E.d.FLIP_N_ROTATE_TILE&&o!==E.d.FLIP_N_ROTATE_ROW||(w[1]=[T,1-J,g,1-J,g,1-b,T,1-b]);for(let H=0;H<z;H++)l.push(V+i,H*h-M+s,0),l.push(V+A+i,H*h-M+s,0),l.push(V+A+i,(H+1)*h-M+s,0),l.push(V+i,(H+1)*h-M+s,0),W.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,S=o===E.d.FLIP_TILE||o===E.d.ROTATE_TILE||o===E.d.FLIP_N_ROTATE_TILE?S.concat(w[(H+1)%2]):o===E.d.FLIP_ROW||o===E.d.ROTATE_ROW||o===E.d.FLIP_N_ROTATE_ROW?S.concat(w[H%2]):S.concat(w[0]),c.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(y){const w=[];T=0,J=0,g=A/h,b=1,w[0]=[T,J,g,J,g,b,T,b],w[1]=[T,J,g,J,g,b,T,b],o!==E.d.ROTATE_TILE&&o!==E.d.ROTATE_ROW||(w[1]=[1-T,1-J,1-g,1-J,1-g,1-b,1-T,1-b]),o!==E.d.FLIP_TILE&&o!==E.d.FLIP_ROW||(w[1]=[1-T,J,1-g,J,1-g,b,1-T,b]),o!==E.d.FLIP_N_ROTATE_TILE&&o!==E.d.FLIP_N_ROTATE_ROW||(w[1]=[T,1-J,g,1-J,g,1-b,T,1-b]);for(let H=0;H<z;H++)l.push(k-A+i,H*h-M+s,0),l.push(k+i,H*h-M+s,0),l.push(k+i,(H+1)*h-M+s,0),l.push(k-A+i,(H+1)*h-M+s,0),W.push(B,B+1,B+3,B+1,B+2,B+3),B+=4,S=o===E.d.FLIP_TILE||o===E.d.ROTATE_TILE||o===E.d.FLIP_N_ROTATE_TILE?S.concat(w[(H+L)%2]):o===E.d.FLIP_ROW||o===E.d.ROTATE_ROW||o===E.d.FLIP_N_ROTATE_ROW?S.concat(w[H%2]):S.concat(w[0]),c.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),O.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const J=0===w.sideOrientation?0:w.sideOrientation||D.b.DEFAULTSIDE;D.b._ComputeSides(J,l,W,O,S,w.frontUVs,w.backUVs);const g=new D.b;g.indices=W,g.Sw=l,g.cw=O,g.Bw=S;const b=J===D.b.DOUBLESIDE?c.concat(c):c;return g.Ww=b,g}function Q(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new E.d(w,H);o.sideOrientation=E.d._GetDefaultSideOrientation(o.sideOrientation),h._originalBuilderSideOrientation=o.sideOrientation;return C(o).gw(h,o.updatable),h}function M(w){const o=w.faceUV||new Array(6),H=w.faceColors,e=w.pattern||E.d.NO_FLIP,X=w.width||w.size||1,L=w.height||w.size||1,A=w.depth||w.size||1,y=w.tileWidth||w.tileSize||1,Q=w.tileHeight||w.tileSize||1,M=w.alignHorizontal||0,i=w.alignVertical||0,s=0===w.sideOrientation?0:w.sideOrientation||D.b.DEFAULTSIDE;for(let E=0;E<6;E++)void 0===o[E]&&(o[E]=new h.Vector4(0,0,1,1)),H&&void 0===H[E]&&(H[E]=new z.ae(1,1,1,1));const V=X/2,r=L/2,k=A/2,P=[];for(let h=0;h<2;h++)P[h]=C({pattern:e,tileWidth:y,tileHeight:Q,width:X,height:L,alignVertical:i,alignHorizontal:M,sideOrientation:s});for(let h=2;h<4;h++)P[h]=C({pattern:e,tileWidth:y,tileHeight:Q,width:A,height:L,alignVertical:i,alignHorizontal:M,sideOrientation:s});let l=i;i===E.d.BOTTOM?l=E.d.TOP:i===E.d.TOP&&(l=E.d.BOTTOM);for(let h=4;h<6;h++)P[h]=C({pattern:e,tileWidth:y,tileHeight:Q,width:X,height:A,alignVertical:l,alignHorizontal:M,sideOrientation:s});let O=[],T=[],S=[],c=[];const W=[],B=[],J=[],g=[];let b=0,p=0;for(let E=0;E<6;E++){const w=P[E].Sw.length;B[E]=[],J[E]=[];for(let o=0;o<w/3;o++)B[E].push(new h.io(P[E].Sw[3*o],P[E].Sw[3*o+1],P[E].Sw[3*o+2])),J[E].push(new h.io(P[E].cw[3*o],P[E].cw[3*o+1],P[E].cw[3*o+2]));b=P[E].Bw.length,g[E]=[];for(let H=0;H<b;H+=2)g[E][H]=o[E].x+(o[E].z-o[E].x)*P[E].Bw[H],g[E][H+1]=o[E].y+(o[E].w-o[E].y)*P[E].Bw[H+1],t.c&&(g[E][H+1]=1-g[E][H+1]);if(S=S.concat(g[E]),c=c.concat(P[E].indices.map((w=>w+p))),p+=B[E].length,H)for(let o=0;o<4;o++)W.push(H[E].r,H[E].g,H[E].b,H[E].a)}const f=new h.io(0,0,k),N=h.Matrix.RotationY(Math.PI);O=B[0].map((w=>h.io.TransformNormal(w,N).add(f))).map((w=>[w.x,w.y,w.z])).reduce(((w,o)=>w.concat(o)),[]),T=J[0].map((w=>h.io.TransformNormal(w,N))).map((w=>[w.x,w.y,w.z])).reduce(((w,o)=>w.concat(o)),[]),O=O.concat(B[1].map((w=>w.so(f))).map((w=>[w.x,w.y,w.z])).reduce(((w,o)=>w.concat(o)),[])),T=T.concat(J[1].map((w=>[w.x,w.y,w.z])).reduce(((w,o)=>w.concat(o)),[]));const j=new h.io(V,0,0),q=h.Matrix.RotationY(-Math.PI/2);O=O.concat(B[2].map((w=>h.io.TransformNormal(w,q).add(j))).map((w=>[w.x,w.y,w.z])).reduce(((w,o)=>w.concat(o)),[])),T=T.concat(J[2].map((w=>h.io.TransformNormal(w,q))).map((w=>[w.x,w.y,w.z])).reduce(((w,o)=>w.concat(o)),[]));const u=h.Matrix.RotationY(Math.PI/2);O=O.concat(B[3].map((w=>h.io.TransformNormal(w,u).so(j))).map((w=>[w.x,w.y,w.z])).reduce(((w,o)=>w.concat(o)),[])),T=T.concat(J[3].map((w=>h.io.TransformNormal(w,u))).map((w=>[w.x,w.y,w.z])).reduce(((w,o)=>w.concat(o)),[]));const n=new h.io(0,r,0),G=h.Matrix.RotationX(Math.PI/2);O=O.concat(B[4].map((w=>h.io.TransformNormal(w,G).add(n))).map((w=>[w.x,w.y,w.z])).reduce(((w,o)=>w.concat(o)),[])),T=T.concat(J[4].map((w=>h.io.TransformNormal(w,G))).map((w=>[w.x,w.y,w.z])).reduce(((w,o)=>w.concat(o)),[]));const R=h.Matrix.RotationX(-Math.PI/2);O=O.concat(B[5].map((w=>h.io.TransformNormal(w,R).so(n))).map((w=>[w.x,w.y,w.z])).reduce(((w,o)=>w.concat(o)),[])),T=T.concat(J[5].map((w=>h.io.TransformNormal(w,R))).map((w=>[w.x,w.y,w.z])).reduce(((w,o)=>w.concat(o)),[])),D.b._ComputeSides(s,O,c,T,S);const a=new D.b;if(a.indices=c,a.Sw=O,a.cw=T,a.Bw=S,H){const w=s===D.b.DOUBLESIDE?W.concat(W):W;a.Ww=w}return a}function i(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new E.d(w,H);o.sideOrientation=E.d._GetDefaultSideOrientation(o.sideOrientation),h._originalBuilderSideOrientation=o.sideOrientation;return M(o).gw(h,o.updatable),h}D.b.CreateTiledPlane=C;D.b.CreateTiledBox=M;var s=H(13110),V=H(11957),r=H(11910);function k(w){const o=w.height||2;let H=0===w.diameterTop?0:w.diameterTop||w.diameter||1,e=0===w.diameterBottom?0:w.diameterBottom||w.diameter||1;H=H||1e-5,e=e||1e-5;const X=0|(w.tessellation||24),L=0|(w.subdivisions||1),A=!!w.hasRings,y=!!w.enclose,C=0===w.cap?0:w.cap||E.d.CAP_ALL,Q=w.arc&&(w.arc<=0||w.arc>1)?1:w.arc||1,M=0===w.sideOrientation?0:w.sideOrientation||D.b.DEFAULTSIDE,i=w.faceUV||new Array(3),s=w.faceColors,V=2+(1+(1!==Q&&y?2:0))*(A?L:1);let k;for(k=0;k<V;k++)s&&void 0===s[k]&&(s[k]=new z.ae(1,1,1,1));for(k=0;k<V;k++)i&&void 0===i[k]&&(i[k]=new h.Vector4(0,0,1,1));const P=[],l=[],O=[],T=[],S=[],c=2*Math.PI*Q/X;let W,B,J;const g=(e-H)/2/o,b=h.io.Zero(),p=h.io.Zero(),f=h.io.Zero(),N=h.io.Zero(),j=h.io.Zero(),q=r.b.Y;let u,n,G,R=1,a=1,d=0,I=0;for(u=0;u<=L;u++)for(B=u/L,J=(B*(H-e)+e)/2,R=A&&0!==u&&u!==L?2:1,G=0;G<R;G++){for(A&&(a+=G),y&&(a+=2*G),n=0;n<=X;n++)W=n*c,b.x=Math.cos(-W)*J,b.y=-o/2+B*o,b.z=Math.sin(-W)*J,0===H&&u===L?(p.x=O[O.length-3*(X+1)],p.y=O[O.length-3*(X+1)+1],p.z=O[O.length-3*(X+1)+2]):(p.x=b.x,p.z=b.z,p.y=Math.sqrt(p.x*p.x+p.z*p.z)*g,p.normalize()),0===n&&(f.t(b),N.t(p)),l.push(b.x,b.y,b.z),O.push(p.x,p.y,p.z),I=A?d!==a?i[a].y:i[a].w:i[a].y+(i[a].w-i[a].y)*B,T.push(i[a].x+(i[a].z-i[a].x)*n/X,t.c?1-I:I),s&&S.push(s[a].r,s[a].g,s[a].b,s[a].a);1!==Q&&y&&(l.push(b.x,b.y,b.z),l.push(0,b.y,0),l.push(0,b.y,0),l.push(f.x,f.y,f.z),h.io.CrossToRef(q,p,j),j.normalize(),O.push(j.x,j.y,j.z,j.x,j.y,j.z),h.io.CrossToRef(N,q,j),j.normalize(),O.push(j.x,j.y,j.z,j.x,j.y,j.z),I=A?d!==a?i[a+1].y:i[a+1].w:i[a+1].y+(i[a+1].w-i[a+1].y)*B,T.push(i[a+1].x,t.c?1-I:I),T.push(i[a+1].z,t.c?1-I:I),I=A?d!==a?i[a+2].y:i[a+2].w:i[a+2].y+(i[a+2].w-i[a+2].y)*B,T.push(i[a+2].x,t.c?1-I:I),T.push(i[a+2].z,t.c?1-I:I),s&&(S.push(s[a+1].r,s[a+1].g,s[a+1].b,s[a+1].a),S.push(s[a+1].r,s[a+1].g,s[a+1].b,s[a+1].a),S.push(s[a+2].r,s[a+2].g,s[a+2].b,s[a+2].a),S.push(s[a+2].r,s[a+2].g,s[a+2].b,s[a+2].a))),d!==a&&(d=a)}const U=1!==Q&&y?X+4:X;for(u=0,a=0;a<L;a++){let w=0,o=0,H=0,h=0;for(n=0;n<X;n++)w=u*(U+1)+n,o=(u+1)*(U+1)+n,H=u*(U+1)+(n+1),h=(u+1)*(U+1)+(n+1),P.push(w,o,H),P.push(h,H,o);1!==Q&&y&&(P.push(w+2,o+2,H+2),P.push(h+2,H+2,o+2),P.push(w+4,o+4,H+4),P.push(h+4,H+4,o+4)),u=A?u+2:u+1}const Z=w=>{const E=w?H/2:e/2;if(0===E)return;let D,L,A;const y=w?i[V-1]:i[0];let z=null;s&&(z=w?s[V-1]:s[0]);const C=l.length/3,M=w?o/2:-o/2,r=new h.io(0,M,0);l.push(r.x,r.y,r.z),O.push(0,w?1:-1,0);const k=y.y+.5*(y.w-y.y);T.push(y.x+.5*(y.z-y.x),t.c?1-k:k),z&&S.push(z.r,z.g,z.b,z.a);const c=new h.Vector2(.5,.5);for(A=0;A<=X;A++){D=2*Math.PI*A*Q/X;const o=Math.cos(-D),H=Math.sin(-D);L=new h.io(o*E,M,H*E);const e=new h.Vector2(o*c.x+.5,H*c.y+.5);l.push(L.x,L.y,L.z),O.push(0,w?1:-1,0);const C=y.y+(y.w-y.y)*e.y;T.push(y.x+(y.z-y.x)*e.x,t.c?1-C:C),z&&S.push(z.r,z.g,z.b,z.a)}for(A=0;A<X;A++)w?(P.push(C),P.push(C+(A+2)),P.push(C+(A+1))):(P.push(C),P.push(C+(A+1)),P.push(C+(A+2)))};C!==E.d.CAP_START&&C!==E.d.CAP_ALL||Z(!1),C!==E.d.CAP_END&&C!==E.d.CAP_ALL||Z(!0),D.b._ComputeSides(M,l,P,O,T,w.frontUVs,w.backUVs);const K=new D.b;return K.indices=P,K.Sw=l,K.cw=O,K.Bw=T,s&&(K.Ww=S),K}function P(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const h=new E.d(w,H);o.sideOrientation=E.d._GetDefaultSideOrientation(o.sideOrientation),h._originalBuilderSideOrientation=o.sideOrientation;return k(o).gw(h,o.updatable),h}function l(w){const o=[],H=[],E=[],e=[],X=w.diameter||1,L=w.thickness||.5,A=0|(w.tessellation||16),y=0===w.sideOrientation?0:w.sideOrientation||D.b.DEFAULTSIDE,z=A+1;for(let D=0;D<=A;D++){const w=D/A,y=D*Math.PI*2/A-Math.PI/2,C=h.Matrix.Translation(X/2,0,0).multiply(h.Matrix.RotationY(y));for(let X=0;X<=A;X++){const y=1-X/A,Q=X*Math.PI*2/A+Math.PI,M=Math.cos(Q),i=Math.sin(Q);let s=new h.io(M,i,0),V=s.scale(L/2);const r=new h.Vector2(w,y);V=h.io.TransformCoordinates(V,C),s=h.io.TransformNormal(s,C),H.push(V.x,V.y,V.z),E.push(s.x,s.y,s.z),e.push(r.x,t.c?1-r.y:r.y);const k=(D+1)%z,P=(X+1)%z;o.push(D*z+X),o.push(D*z+P),o.push(k*z+X),o.push(D*z+P),o.push(k*z+P),o.push(k*z+X)}}D.b._ComputeSides(y,H,o,E,e,w.frontUVs,w.backUVs);const C=new D.b;return C.indices=o,C.Sw=H,C.cw=E,C.Bw=e,C}function O(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const h=new E.d(w,H);o.sideOrientation=E.d._GetDefaultSideOrientation(o.sideOrientation),h._originalBuilderSideOrientation=o.sideOrientation;return l(o).gw(h,o.updatable),h}D.b.CreateCylinder=k,E.d.CreateCylinder=(w,o,H,h,e,D,t,X,L)=>{void 0!==t&&t instanceof V.e||(void 0!==t&&(L=X||E.d.DEFAULTSIDE,X=t),t=D,D=1);return P(w,{height:o,diameterTop:H,diameterBottom:h,tessellation:e,subdivisions:D,sideOrientation:L,updatable:X},t)};function T(w){const o=[],H=[],E=[],e=[],X=w.radius||2,L=w.tube||.5,A=w.radialSegments||32,y=w.tubularSegments||32,z=w.p||2,C=w.q||3,Q=0===w.sideOrientation?0:w.sideOrientation||D.b.DEFAULTSIDE,M=w=>{const o=Math.cos(w),H=Math.sin(w),E=C/z*w,e=Math.cos(E),D=X*(2+e)*.5*o,t=X*(2+e)*H*.5,L=X*Math.sin(E)*.5;return new h.io(D,t,L)};let i,s;for(i=0;i<=A;i++){const w=i%A/A*2*z*Math.PI,o=M(w),E=M(w+.01),D=E.so(o);let X=E.add(o);const C=h.io.Cross(D,X);for(X=h.io.Cross(C,D),C.normalize(),X.normalize(),s=0;s<y;s++){const w=s%y/y*2*Math.PI,h=-L*Math.cos(w),E=L*Math.sin(w);H.push(o.x+h*X.x+E*C.x),H.push(o.y+h*X.y+E*C.y),H.push(o.z+h*X.z+E*C.z),e.push(i/A),e.push(t.c?1-s/y:s/y)}}for(i=0;i<A;i++)for(s=0;s<y;s++){const w=(s+1)%y,H=i*y+s,h=(i+1)*y+s,E=(i+1)*y+w,e=i*y+w;o.push(e),o.push(h),o.push(H),o.push(e),o.push(E),o.push(h)}D.b.ComputeNormals(H,o,E),D.b._ComputeSides(Q,H,o,E,e,w.frontUVs,w.backUVs);const V=new D.b;return V.indices=o,V.Sw=H,V.cw=E,V.Bw=e,V}function S(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const h=new E.d(w,H);o.sideOrientation=E.d._GetDefaultSideOrientation(o.sideOrientation),h._originalBuilderSideOrientation=o.sideOrientation;return T(o).gw(h,o.updatable),h}D.b.CreateTorus=l,E.d.CreateTorus=(w,o,H,h,E,e,D)=>O(w,{diameter:o,thickness:H,tessellation:h,sideOrientation:D,updatable:e},E);D.b.CreateTorusKnot=T,E.d.CreateTorusKnot=(w,o,H,h,E,e,D,t,X,L)=>S(w,{radius:o,tube:H,radialSegments:h,tubularSegments:E,p:e,q:D,sideOrientation:L,updatable:X},t);var c=H(13659),W=H(12276),B=H(11923);function J(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=o.path,e=o.shape,D=o.scale||1,t=o.rotation||0,X=0===o.cap?0:o.cap||E.d.NO_CAP,L=o.updatable,A=E.d._GetDefaultSideOrientation(o.sideOrientation),y=o.instance||null,z=o.invertUV||!1,C=o.closeShape||!1,Q=o.closePath||!1,M=o.capFunction||null;return b(w,e,h,D,t,null,null,Q,C,X,!1,H,!!L,A,y,z,o.frontUVs||null,o.backUVs||null,o.firstNormal||null,!!o.adjustFrame,M)}function g(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=o.path,e=o.shape,D=o.scaleFunction||(()=>1),t=o.rotationFunction||(()=>0),X=o.closePath||o.ribbonCloseArray||!1,L=o.closeShape||o.ribbonClosePath||!1,A=0===o.cap?0:o.cap||E.d.NO_CAP,y=o.updatable,z=o.firstNormal||null,C=o.adjustFrame||!1,Q=E.d._GetDefaultSideOrientation(o.sideOrientation),M=o.instance,i=o.invertUV||!1,s=o.capFunction||null;return b(w,e,h,null,null,D,t,X,L,A,!0,H,!!y,Q,M||null,i,o.frontUVs||null,o.backUVs||null,z,C,s||null)}function b(w,o,H,e,D,t,X,A,y,z,C,Q,M,i,s,V,r,k,P,l,O){const T=(w,o,H,e,D,t,X,L,A,y,z)=>{const C=H.getTangents(),Q=H.getNormals(),M=H.getBinormals(),i=H.getDistances();if(z)for(let E=0;E<C.length;E++)if(0==C[E].x&&0==C[E].y&&0==C[E].z&&C[E].t(C[E-1]),0==Q[E].x&&0==Q[E].y&&0==Q[E].z&&Q[E].t(Q[E-1]),0==M[E].x&&0==M[E].y&&0==M[E].z&&M[E].t(M[E-1]),E>0){let w=C[E-1];h.io.Dot(w,C[E])<0&&C[E].scaleInPlace(-1),w=Q[E-1],h.io.Dot(w,Q[E])<0&&Q[E].scaleInPlace(-1),w=M[E-1],h.io.Dot(w,M[E])<0&&M[E].scaleInPlace(-1)}let s=0;const V=y&&L?L:()=>null!==t?t:0,r=y&&X?X:()=>null!==D?D:1;let k=A===E.d.NO_CAP||A===E.d.CAP_END?0:2;const P=h.TmpVectors.Matrix[0];for(let E=0;E<o.length;E++){const H=[],D=V(E,i[E]),t=r(E,i[E]);h.Matrix.RotationAxisToRef(C[E],s,P);for(let e=0;e<w.length;e++){const D=C[E].scale(w[e].z).add(Q[E].scale(w[e].x)).add(M[E].scale(w[e].y)),X=h.io.Zero();h.io.TransformCoordinatesToRef(D,P,X),X.scaleInPlace(t).addInPlace(o[E]),H[e]=X}e[k]=H,s+=D,k++}const l=O||(w=>{const o=Array(),H=h.io.Zero();let E;for(E=0;E<w.length;E++)H.addInPlace(w[E]);for(H.scaleInPlace(1/w.length),E=0;E<w.length;E++)o.push(H);return o});switch(A){case E.d.NO_CAP:break;case E.d.CAP_START:e[0]=l(e[2]),e[1]=e[2];break;case E.d.CAP_END:e[k]=e[k-1],e[k+1]=l(e[k-1]);break;case E.d.CAP_ALL:e[0]=l(e[2]),e[1]=e[2],e[k]=e[k-1],e[k+1]=l(e[k-1])}return e};let S,c;if(s){const w=s._creationDataStorage;return S=P?w.path3D.update(H,P):w.path3D.update(H),c=T(o,H,w.path3D,w.pathArray,e,D,t,X,w.cap,C,l),s=L("",{pathArray:c,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:s},Q||void 0)}S=P?new B.j(H,P):new B.j(H);c=T(o,H,S,new Array,e,D,t,X,z=z<0||z>3?0:z,C,l);const W=L(w,{pathArray:c,closeArray:A,closePath:y,updatable:M,sideOrientation:i,invertUV:V,frontUVs:r||void 0,backUVs:k||void 0},Q);return W._creationDataStorage.pathArray=c,W._creationDataStorage.path3D=S,W._creationDataStorage.cap=z,W}function p(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=o.arc?o.arc<=0||o.arc>1?1:o.arc:1,D=void 0===o.closed||o.closed,t=o.shape,X=o.radius||1,A=o.tessellation||64,y=o.clip||0,z=o.updatable,C=E.d._GetDefaultSideOrientation(o.sideOrientation),Q=o.cap||E.d.NO_CAP,M=2*Math.PI,i=[],s=o.invertUV||!1;let V=0,r=0;const k=M/A*e;let P,l;for(V=0;V<=A-y;V++){for(l=[],Q!=E.d.CAP_START&&Q!=E.d.CAP_ALL||(l.push(new h.io(0,t[0].y,0)),l.push(new h.io(Math.cos(V*k)*t[0].x*X,t[0].y,Math.sin(V*k)*t[0].x*X))),r=0;r<t.length;r++)P=new h.io(Math.cos(V*k)*t[r].x*X,t[r].y,Math.sin(V*k)*t[r].x*X),l.push(P);Q!=E.d.CAP_END&&Q!=E.d.CAP_ALL||(l.push(new h.io(Math.cos(V*k)*t[t.length-1].x*X,t[t.length-1].y,Math.sin(V*k)*t[t.length-1].x*X)),l.push(new h.io(0,t[t.length-1].y,0))),i.push(l)}return L(w,{pathArray:i,closeArray:D,sideOrientation:C,updatable:z,invertUV:s,frontUVs:o.frontUVs,backUVs:o.backUVs},H)}E.d.ExtrudeShape=function(w,o,H,h,e,D){let t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7?arguments[7]:void 0,L=arguments.length>8?arguments[8]:void 0,A=arguments.length>9?arguments[9]:void 0;return J(w,{shape:o,path:H,scale:h,rotation:e,cap:0===D?0:D||E.d.NO_CAP,sideOrientation:L,instance:A,updatable:X},t)},E.d.ExtrudeShapeCustom=(w,o,H,h,e,D,t,X,L,A,y,z)=>g(w,{shape:o,path:H,scaleFunction:h,rotationFunction:e,ribbonCloseArray:D,ribbonClosePath:t,cap:0===X?0:X||E.d.NO_CAP,sideOrientation:y,instance:z,updatable:A},L);E.d.CreateLathe=(w,o,H,h,E,e,D)=>p(w,{shape:o,radius:H,tessellation:h,sideOrientation:D,updatable:e},E);var f=H(13006),N=H(12957);function j(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=o.path;let D=o.instance,t=1;void 0!==o.radius?t=o.radius:D&&(t=D._creationDataStorage.radius);const X=o.tessellation||64,A=o.radiusFunction||null;let y=o.cap||E.d.NO_CAP;const z=o.invertUV||!1,C=o.updatable,Q=E.d._GetDefaultSideOrientation(o.sideOrientation);o.arc=o.arc&&(o.arc<=0||o.arc>1)?1:o.arc||1;const M=(w,o,H,e,D,t,X,L)=>{const A=o.getTangents(),y=o.getNormals(),z=o.getDistances(),C=2*Math.PI/D*L,Q=t||(()=>e);let M,i,s,V;const r=h.TmpVectors.Matrix[0];let k=X===E.d.NO_CAP||X===E.d.CAP_END?0:2;for(let E=0;E<w.length;E++){i=Q(E,z[E]),M=Array(),s=y[E];for(let o=0;o<D;o++)h.Matrix.RotationAxisToRef(A[E],C*o,r),V=M[o]?M[o]:h.io.Zero(),h.io.TransformCoordinatesToRef(s,r,V),V.scaleInPlace(i).addInPlace(w[E]),M[o]=V;H[k]=M,k++}const P=(o,H)=>{const h=Array();for(let E=0;E<o;E++)h.push(w[H]);return h};switch(X){case E.d.NO_CAP:break;case E.d.CAP_START:H[0]=P(D,0),H[1]=H[2].slice(0);break;case E.d.CAP_END:H[k]=H[k-1].slice(0),H[k+1]=P(D,w.length-1);break;case E.d.CAP_ALL:H[0]=P(D,0),H[1]=H[2].slice(0),H[k]=H[k-1].slice(0),H[k+1]=P(D,w.length-1)}return H};let i,s;if(D){const w=D._creationDataStorage,H=o.arc||w.arc;return i=w.path3D.update(e),s=M(e,i,w.pathArray,t,w.tessellation,A,w.cap,H),D=L("",{pathArray:s,instance:D}),w.path3D=i,w.pathArray=s,w.arc=H,w.radius=t,D}i=new B.j(e);y=y<0||y>3?0:y,s=M(e,i,new Array,t,X,A,y,o.arc);const V=L(w,{pathArray:s,closePath:!0,closeArray:!1,updatable:C,sideOrientation:Q,invertUV:z,frontUVs:o.frontUVs,backUVs:o.backUVs},H);return V._creationDataStorage.pathArray=s,V._creationDataStorage.path3D=i,V._creationDataStorage.tessellation=X,V._creationDataStorage.cap=y,V._creationDataStorage.arc=o.arc,V._creationDataStorage.radius=t,V}function q(w){const o=[];o[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},o[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},o[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},o[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},o[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},o[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},o[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},o[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},o[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},o[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},o[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},o[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},o[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},o[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},o[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const H=w.type&&(w.type<0||w.type>=o.length)?0:w.type||0,E=w.size,e=w.sizeX||E||1,X=w.sizeY||E||1,L=w.sizeZ||E||1,A=w.custom||o[H],y=A.face.length,C=w.faceUV||new Array(y),Q=w.faceColors,M=void 0===w.flat||w.flat,i=0===w.sideOrientation?0:w.sideOrientation||D.b.DEFAULTSIDE,s=[],V=[],r=[],k=[],P=[];let l=0,O=0;const T=[];let S,c,W,B,J,g,b=0,p=0;if(M)for(p=0;p<y;p++)Q&&void 0===Q[p]&&(Q[p]=new z.ae(1,1,1,1)),C&&void 0===C[p]&&(C[p]=new h.Vector4(0,0,1,1));if(M)for(p=0;p<y;p++){const w=A.face[p].length;for(W=2*Math.PI/w,B=.5*Math.tan(W/2),J=.5,b=0;b<w;b++)s.push(A.vertex[A.face[p][b]][0]*e,A.vertex[A.face[p][b]][1]*X,A.vertex[A.face[p][b]][2]*L),T.push(l),l++,S=C[p].x+(C[p].z-C[p].x)*(.5+B),c=C[p].y+(C[p].w-C[p].y)*(J-.5),k.push(S,t.c?1-c:c),g=B*Math.cos(W)-J*Math.sin(W),J=B*Math.sin(W)+J*Math.cos(W),B=g,Q&&P.push(Q[p].r,Q[p].g,Q[p].b,Q[p].a);for(b=0;b<w-2;b++)V.push(T[0+O],T[b+2+O],T[b+1+O]);O+=w}else{for(b=0;b<A.vertex.length;b++)s.push(A.vertex[b][0]*e,A.vertex[b][1]*X,A.vertex[b][2]*L),k.push(0,t.c?1:0);for(p=0;p<y;p++)for(b=0;b<A.face[p].length-2;b++)V.push(A.face[p][0],A.face[p][b+2],A.face[p][b+1])}D.b.ComputeNormals(s,V,r),D.b._ComputeSides(i,s,V,r,k,w.frontUVs,w.backUVs);const f=new D.b;return f.Sw=s,f.indices=V,f.cw=r,f.Bw=k,Q&&M&&(f.Ww=P),f}function u(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new E.d(w,H);o.sideOrientation=E.d._GetDefaultSideOrientation(o.sideOrientation),h._originalBuilderSideOrientation=o.sideOrientation;return q(o).gw(h,o.updatable),h}E.d.CreateTube=(w,o,H,h,E,e,D,t,X,L)=>j(w,{path:o,radius:H,tessellation:h,radiusFunction:E,arc:1,cap:e,updatable:t,sideOrientation:X,instance:L},D);function n(w){const o=w.sideOrientation||D.b.DEFAULTSIDE,H=w.radius||1,E=void 0===w.flat||w.flat,e=0|(w.subdivisions||4),X=w.radiusX||H,L=w.radiusY||H,A=w.radiusZ||H,y=(1+Math.sqrt(5))/2,z=[-1,y,-0,1,y,0,-1,-y,0,1,-y,0,0,-1,-y,0,1,-y,0,-1,y,0,1,y,y,0,1,y,0,-1,-y,0,1,-y,0,-1],C=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],Q=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],M=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],i=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],s=[],V=[],r=[],k=[];let P=0;const l=new Array(3),O=new Array(3);let T;for(T=0;T<3;T++)l[T]=h.io.Zero(),O[T]=h.Vector2.Zero();for(let D=0;D<20;D++){for(T=0;T<3;T++){const w=C[3*D+T];l[T].We(z[3*Q[w]],z[3*Q[w]+1],z[3*Q[w]+2]),l[T].normalize(),O[T].We(.134765625*M[2*w]+.05859375+-.0390625*i[D],.2333984375*M[2*w+1]+.025390625+.01953125*i[D])}const w=(w,o,H,D)=>{const y=h.io.Lerp(l[0],l[2],o/e),z=h.io.Lerp(l[1],l[2],o/e),C=e===o?l[2]:h.io.Lerp(y,z,w/(e-o));let Q;if(C.normalize(),E){const w=h.io.Lerp(l[0],l[2],D/e),o=h.io.Lerp(l[1],l[2],D/e);Q=h.io.Lerp(w,o,H/(e-D))}else Q=new h.io(C.x,C.y,C.z);Q.x/=X,Q.y/=L,Q.z/=A,Q.normalize();const M=h.Vector2.Lerp(O[0],O[2],o/e),i=h.Vector2.Lerp(O[1],O[2],o/e),T=e===o?O[2]:h.Vector2.Lerp(M,i,w/(e-o));V.push(C.x*X,C.y*L,C.z*A),r.push(Q.x,Q.y,Q.z),k.push(T.x,t.c?1-T.y:T.y),s.push(P),P++};for(let o=0;o<e;o++)for(let H=0;H+o<e;H++)w(H,o,H+1/3,o+1/3),w(H+1,o,H+1/3,o+1/3),w(H,o+1,H+1/3,o+1/3),H+o+1<e&&(w(H+1,o,H+2/3,o+2/3),w(H+1,o+1,H+2/3,o+2/3),w(H,o+1,H+2/3,o+2/3))}D.b._ComputeSides(o,V,s,r,k,w.frontUVs,w.backUVs);const S=new D.b;return S.indices=s,S.Sw=V,S.cw=r,S.Bw=k,S}function G(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new E.d(w,H);o.sideOrientation=E.d._GetDefaultSideOrientation(o.sideOrientation),h._originalBuilderSideOrientation=o.sideOrientation;return n(o).gw(h,o.updatable),h}D.b.CreatePolyhedron=q,E.d.CreatePolyhedron=(w,o,H)=>u(w,o,H);D.b.CreateIcoSphere=n,E.d.CreateIcoSphere=(w,o,H)=>G(w,o,H);var R=H(11729);const a=new h.io(1,0,0),d=new h.io(-1,0,0),I=new h.io(0,1,0),U=new h.io(0,-1,0),Z=new h.io(0,0,1),K=new h.io(0,0,-1);class F{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.io.Zero(),o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.io.Up(),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.Vector2.Zero(),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=w,this.normal=o,this.uv=H,this.vertexIdx=E,this.vertexIdxForBones=e,this.localPositionOverride=D,this.localNormalOverride=t,this.matrixIndicesOverride=X,this.matrixWeightsOverride=L}clone(){var w,o,H,h;return new F(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(w=this.localPositionOverride)||void 0===w?void 0:w.slice(),null===(o=this.localNormalOverride)||void 0===o?void 0:o.slice(),null===(H=this.matrixIndicesOverride)||void 0===H?void 0:H.slice(),null===(h=this.matrixWeightsOverride)||void 0===h?void 0:h.slice())}}function v(w,o,H){var X,L,A,y,z;const C=!!o.skeleton,Q=!(null===(X=o.morphTargetManager)||void 0===X||!X.numTargets),M=H.localMode||C,i=o.ke(),s=C||Q?o.jt(!0,!0):o.getVerticesData(e.e.PositionKind),V=C||Q?o.getNormalsData(!0,!0):o.getVerticesData(e.e.NormalKind),r=M?C?o.getVerticesData(e.e.PositionKind):s:null,k=M?C?o.getVerticesData(e.e.NormalKind):V:null,P=o.getVerticesData(e.e.UVKind),l=C?o.getVerticesData(e.e.MatricesIndicesKind):null,O=C?o.getVerticesData(e.e.MatricesWeightsKind):null,T=C?o.getVerticesData(e.e.MatricesIndicesExtraKind):null,S=C?o.getVerticesData(e.e.MatricesWeightsExtraKind):null,c=H.position||h.io.Zero();let W=H.normal||h.io.Up();const B=H.size||h.io.One(),J=H.angle||0;if(!W){const w=new h.io(0,0,1),H=o.Ow().activeCamera,E=h.io.TransformCoordinates(w,H.getWorldMatrix());W=H.globalPosition.so(E)}const g=-Math.atan2(W.z,W.x)-Math.PI/2,b=Math.sqrt(W.x*W.x+W.z*W.z),p=Math.atan2(W.y,b),f=new D.b;f.indices=[],f.Sw=[],f.cw=[],f.Bw=[],f.matricesIndices=C?[]:null,f.matricesWeights=C?[]:null,f.matricesIndicesExtra=T?[]:null,f.matricesWeightsExtra=S?[]:null;let N=0;const j=(w,o)=>{const E=new F;if(!i||!s||!V)return E;const e=i[w];if(E.vertexIdx=3*e,E.vertexIdxForBones=4*e,E.position=new h.io(s[3*e],s[3*e+1],s[3*e+2]),h.io.TransformCoordinatesToRef(E.position,o,E.position),E.normal=new h.io(V[3*e],V[3*e+1],V[3*e+2]),h.io.TransformNormalToRef(E.normal,o,E.normal),H.captureUVS&&P){const w=P[2*e+1];E.uv=new h.Vector2(P[2*e],t.c?1-w:w)}return E},q=[0,0,0,0],u=(w,o)=>{if(0===w.length)return w;const H=.5*Math.abs(h.io.Dot(B,o)),E=(w,o,H,h)=>{for(let E=0;E<h;++E)if(w[H+E]===o)return H+E;return-1},e=(w,e)=>{const D=h.io.GetClipFactor(w.position,e.position,o,H);let t=q,X=q;if(l&&O){const o=w.matrixIndicesOverride?0:w.vertexIdxForBones,H=w.matrixIndicesOverride??l,h=w.matrixWeightsOverride??O,L=e.matrixIndicesOverride?0:e.vertexIdxForBones,A=e.matrixIndicesOverride??l,y=e.matrixWeightsOverride??O;t=[0,0,0,0],X=[0,0,0,0];let z=0;for(let w=0;w<4;++w)if(h[o+w]>0){const e=E(A,H[o+w],L,4);t[z]=H[o+w],X[z]=(0,R.Lerp)(h[o+w],e>=0?y[e]:0,D),z++}for(let w=0;w<4&&z<4;++w){const h=A[L+w];-1===E(H,h,o,4)&&(t[z]=h,X[z]=(0,R.Lerp)(0,y[L+w],D),z++)}const C=X[0]+X[1]+X[2]+X[3];X[0]/=C,X[1]/=C,X[2]/=C,X[3]/=C}const L=w.localPositionOverride?w.localPositionOverride[0]:(null===r||void 0===r?void 0:r[w.vertexIdx])??0,A=w.localPositionOverride?w.localPositionOverride[1]:(null===r||void 0===r?void 0:r[w.vertexIdx+1])??0,y=w.localPositionOverride?w.localPositionOverride[2]:(null===r||void 0===r?void 0:r[w.vertexIdx+2])??0,z=e.localPositionOverride?e.localPositionOverride[0]:(null===r||void 0===r?void 0:r[e.vertexIdx])??0,C=e.localPositionOverride?e.localPositionOverride[1]:(null===r||void 0===r?void 0:r[e.vertexIdx+1])??0,Q=e.localPositionOverride?e.localPositionOverride[2]:(null===r||void 0===r?void 0:r[e.vertexIdx+2])??0,M=w.localNormalOverride?w.localNormalOverride[0]:(null===k||void 0===k?void 0:k[w.vertexIdx])??0,i=w.localNormalOverride?w.localNormalOverride[1]:(null===k||void 0===k?void 0:k[w.vertexIdx+1])??0,s=w.localNormalOverride?w.localNormalOverride[2]:(null===k||void 0===k?void 0:k[w.vertexIdx+2])??0,V=M+((e.localNormalOverride?e.localNormalOverride[0]:(null===k||void 0===k?void 0:k[e.vertexIdx])??0)-M)*D,P=i+((e.localNormalOverride?e.localNormalOverride[1]:(null===k||void 0===k?void 0:k[e.vertexIdx+1])??0)-i)*D,T=s+((e.localNormalOverride?e.localNormalOverride[2]:(null===k||void 0===k?void 0:k[e.vertexIdx+2])??0)-s)*D,S=Math.sqrt(V*V+P*P+T*T);return new F(h.io.Lerp(w.position,e.position,D),h.io.Lerp(w.normal,e.normal,D).normalize(),h.Vector2.Lerp(w.uv,e.uv,D),-1,-1,r?[L+(z-L)*D,A+(C-A)*D,y+(Q-y)*D]:null,k?[V/S,P/S,T/S]:null,t,X)};let D=null;w.length>3&&(D=[]);for(let t=0;t<w.length;t+=3){let E=0,X=null,L=null,A=null,y=null;const z=h.io.Dot(w[t].position,o)-H>0,C=h.io.Dot(w[t+1].position,o)-H>0,Q=h.io.Dot(w[t+2].position,o)-H>0;switch(E=(z?1:0)+(C?1:0)+(Q?1:0),E){case 0:w.length>3?(D.push(w[t]),D.push(w[t+1]),D.push(w[t+2])):D=w;break;case 1:if(D=D??new Array,z&&(X=w[t+1],L=w[t+2],A=e(w[t],X),y=e(w[t],L)),C){X=w[t],L=w[t+2],A=e(w[t+1],X),y=e(w[t+1],L),D.push(A),D.push(L.clone()),D.push(X.clone()),D.push(L.clone()),D.push(A.clone()),D.push(y);break}Q&&(X=w[t],L=w[t+1],A=e(w[t+2],X),y=e(w[t+2],L)),X&&L&&A&&y&&(D.push(X.clone()),D.push(L.clone()),D.push(A),D.push(y),D.push(A.clone()),D.push(L.clone()));break;case 2:D=D??new Array,z||(X=w[t].clone(),L=e(X,w[t+1]),A=e(X,w[t+2]),D.push(X),D.push(L),D.push(A)),C||(X=w[t+1].clone(),L=e(X,w[t+2]),A=e(X,w[t]),D.push(X),D.push(L),D.push(A)),Q||(X=w[t+2].clone(),L=e(X,w[t]),A=e(X,w[t+1]),D.push(X),D.push(L),D.push(A))}}return D},n=o instanceof E.d?o:null,G=null===n||void 0===n?void 0:n._thinInstanceDataStorage.matrixData,v=(null===n||void 0===n?void 0:n.Ie)||1,mw=h.TmpVectors.Matrix[0];mw.t(h.Matrix.IdentityReadOnly);for(let E=0;E<v;++E){if(null!==n&&void 0!==n&&n.hasThinInstances&&G){const w=16*E;mw.setRowFromFloats(0,G[w+0],G[w+1],G[w+2],G[w+3]),mw.setRowFromFloats(1,G[w+4],G[w+5],G[w+6],G[w+7]),mw.setRowFromFloats(2,G[w+8],G[w+9],G[w+10],G[w+11]),mw.setRowFromFloats(3,G[w+12],G[w+13],G[w+14],G[w+15])}const w=h.Matrix.RotationYawPitchRoll(g,p,J).multiply(h.Matrix.Translation(c.x,c.y,c.z)),e=h.Matrix.Invert(w),D=o.getWorldMatrix(),X=mw.multiply(D).multiply(e),L=new Array(3);for(let o=0;o<i.length;o+=3){let w=L;if(w[0]=j(o,X),w[1]=j(o+1,X),w[2]=j(o+2,X),!(H.cullBackFaces&&-w[0].normal.z<=0&&-w[1].normal.z<=0&&-w[2].normal.z<=0)&&(w=u(w,a),w&&(w=u(w,d),w&&(w=u(w,I),w&&(w=u(w,U),w&&(w=u(w,Z),w&&(w=u(w,K),w)))))))for(let o=0;o<w.length;o++){const h=w[o];if(f.indices.push(N),M?(h.localPositionOverride?(f.Sw[3*N]=h.localPositionOverride[0],f.Sw[3*N+1]=h.localPositionOverride[1],f.Sw[3*N+2]=h.localPositionOverride[2]):r&&(f.Sw[3*N]=r[h.vertexIdx],f.Sw[3*N+1]=r[h.vertexIdx+1],f.Sw[3*N+2]=r[h.vertexIdx+2]),h.localNormalOverride?(f.cw[3*N]=h.localNormalOverride[0],f.cw[3*N+1]=h.localNormalOverride[1],f.cw[3*N+2]=h.localNormalOverride[2]):k&&(f.cw[3*N]=k[h.vertexIdx],f.cw[3*N+1]=k[h.vertexIdx+1],f.cw[3*N+2]=k[h.vertexIdx+2])):(h.position.toArray(f.Sw,3*N),h.normal.toArray(f.cw,3*N)),f.matricesIndices&&f.matricesWeights&&(h.matrixIndicesOverride?(f.matricesIndices[4*N]=h.matrixIndicesOverride[0],f.matricesIndices[4*N+1]=h.matrixIndicesOverride[1],f.matricesIndices[4*N+2]=h.matrixIndicesOverride[2],f.matricesIndices[4*N+3]=h.matrixIndicesOverride[3]):(l&&(f.matricesIndices[4*N]=l[h.vertexIdxForBones],f.matricesIndices[4*N+1]=l[h.vertexIdxForBones+1],f.matricesIndices[4*N+2]=l[h.vertexIdxForBones+2],f.matricesIndices[4*N+3]=l[h.vertexIdxForBones+3]),T&&f.matricesIndicesExtra&&(f.matricesIndicesExtra[4*N]=T[h.vertexIdxForBones],f.matricesIndicesExtra[4*N+1]=T[h.vertexIdxForBones+1],f.matricesIndicesExtra[4*N+2]=T[h.vertexIdxForBones+2],f.matricesIndicesExtra[4*N+3]=T[h.vertexIdxForBones+3])),h.matrixWeightsOverride?(f.matricesWeights[4*N]=h.matrixWeightsOverride[0],f.matricesWeights[4*N+1]=h.matrixWeightsOverride[1],f.matricesWeights[4*N+2]=h.matrixWeightsOverride[2],f.matricesWeights[4*N+3]=h.matrixWeightsOverride[3]):(O&&(f.matricesWeights[4*N]=O[h.vertexIdxForBones],f.matricesWeights[4*N+1]=O[h.vertexIdxForBones+1],f.matricesWeights[4*N+2]=O[h.vertexIdxForBones+2],f.matricesWeights[4*N+3]=O[h.vertexIdxForBones+3]),S&&f.matricesWeightsExtra&&(f.matricesWeightsExtra[4*N]=S[h.vertexIdxForBones],f.matricesWeightsExtra[4*N+1]=S[h.vertexIdxForBones+1],f.matricesWeightsExtra[4*N+2]=S[h.vertexIdxForBones+2],f.matricesWeightsExtra[4*N+3]=S[h.vertexIdxForBones+3]))),H.captureUVS)h.uv.toArray(f.Bw,2*N);else{f.Bw.push(.5+h.position.x/B.x);const w=.5+h.position.y/B.y;f.Bw.push(t.c?1-w:w)}N++}}}0===f.indices.length&&(f.indices=null),0===f.Sw.length&&(f.Sw=null),0===f.cw.length&&(f.cw=null),0===f.Bw.length&&(f.Bw=null),0===(null===(L=f.matricesIndices)||void 0===L?void 0:L.length)&&(f.matricesIndices=null),0===(null===(A=f.matricesWeights)||void 0===A?void 0:A.length)&&(f.matricesWeights=null),0===(null===(y=f.matricesIndicesExtra)||void 0===y?void 0:y.length)&&(f.matricesIndicesExtra=null),0===(null===(z=f.matricesWeightsExtra)||void 0===z?void 0:z.length)&&(f.matricesWeightsExtra=null);const Y=new E.d(w,o.Ow());return f.gw(Y),M?(Y.skeleton=o.skeleton,Y.parent=o):(Y.position=c.clone(),Y.rotation=new h.io(p,g,J)),Y.se(!0),Y.refreshBoundingInfo(!0,!0),Y}function mw(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const o=0|Math.max(w.subdivisions?w.subdivisions:2,1),H=0|Math.max(w.tessellation?w.tessellation:16,3),E=Math.max(w.height?w.height:1,0),e=Math.max(w.radius?w.radius:.25,0),X=0|Math.max(w.capSubdivisions?w.capSubdivisions:6,1),L=H,A=o,y=Math.max(w.radiusTop?w.radiusTop:e,0),z=Math.max(w.radiusBottom?w.radiusBottom:e,0),C=E-(y+z),Q=2*Math.PI,M=Math.max(w.topCapSubdivisions?w.topCapSubdivisions:X,1),i=Math.max(w.bottomCapSubdivisions?w.bottomCapSubdivisions:X,1),s=Math.acos((z-y)/E);let V=[];const r=[],k=[],P=[];let l=0;const O=[],T=.5*C,S=.5*Math.PI;let c,W;const B=h.io.Zero(),J=h.io.Zero(),g=Math.cos(s),b=Math.sin(s),p=new h.Vector2(y*b,T+y*g).so(new h.Vector2(z*b,z*g-T)).length(),f=y*s+p+z*(S-s);let N=0;for(W=0;W<=M;W++){const w=[],o=S-s*(W/M);N+=y*s/M;const H=Math.cos(o),h=Math.sin(o),E=H*y;for(c=0;c<=L;c++){const o=c/L,e=o*Q+0,D=Math.sin(e),X=Math.cos(e);J.x=E*D,J.y=T+h*y,J.z=E*X,r.push(J.x,J.y,J.z),B.set(H*D,h,H*X),k.push(B.x,B.y,B.z),P.push(o,t.c?N/f:1-N/f),w.push(l),l++}O.push(w)}const j=E-y-z+g*y-g*z,q=b*(z-y)/j;for(W=1;W<=A;W++){const w=[];N+=p/A;const o=b*(W*(z-y)/A+y);for(c=0;c<=L;c++){const H=c/L,h=H*Q+0,E=Math.sin(h),e=Math.cos(h);J.x=o*E,J.y=T+g*y-W*j/A,J.z=o*e,r.push(J.x,J.y,J.z),B.set(E,q,e).normalize(),k.push(B.x,B.y,B.z),P.push(H,t.c?N/f:1-N/f),w.push(l),l++}O.push(w)}for(W=1;W<=i;W++){const w=[],o=S-s-(Math.PI-s)*(W/i);N+=z*s/i;const H=Math.cos(o),h=Math.sin(o),E=H*z;for(c=0;c<=L;c++){const o=c/L,e=o*Q+0,D=Math.sin(e),X=Math.cos(e);J.x=E*D,J.y=h*z-T,J.z=E*X,r.push(J.x,J.y,J.z),B.set(H*D,h,H*X),k.push(B.x,B.y,B.z),P.push(o,t.c?N/f:1-N/f),w.push(l),l++}O.push(w)}for(c=0;c<L;c++)for(W=0;W<M+A+i;W++){const w=O[W][c],o=O[W+1][c],H=O[W+1][c+1],h=O[W][c+1];V.push(w),V.push(o),V.push(h),V.push(o),V.push(H),V.push(h)}if(V=V.reverse(),w.orientation&&!w.orientation.equals(h.io.Up())){const o=new h.Matrix;w.orientation.clone().scale(.5*Math.PI).cross(h.io.Up()).toQuaternion().toRotationMatrix(o);const H=h.io.Zero();for(let w=0;w<r.length;w+=3)H.set(r[w],r[w+1],r[w+2]),h.io.TransformCoordinatesToRef(H.clone(),o,H),r[w]=H.x,r[w+1]=H.y,r[w+2]=H.z}const u=new D.b;return u.Sw=r,u.cw=k,u.Bw=P,u.indices=V,u}function Y(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:h.io.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new E.d(w,H);return mw(o).gw(e,o.updatable),e}E.d.CreateDecal=(w,o,H,h,E,e)=>v(w,o,{position:H,normal:h,size:E,angle:e});E.d.CreateCapsule=(w,o,H)=>Y(w,o,H),D.b.CreateCapsule=mw;var x=H(11551),ww=H(11722);class ow{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=w,this.y=o,w!==Math.floor(w)&&(w=Math.floor(w),x.d.Warn("x is not an integer, floor(x) used")),o!==Math.floor(o)&&(o=Math.floor(o),x.d.Warn("y is not an integer, floor(y) used"))}clone(){return new ow(this.x,this.y)}rotate60About(w){const o=this.x;return this.x=w.x+w.y-this.y,this.y=o+this.y-w.x,this}rotateNeg60About(w){const o=this.x;return this.x=o+this.y-w.y,this.y=w.x+w.y-o,this}rotate120(w,o){w!==Math.floor(w)&&(w=Math.floor(w),x.d.Warn("m not an integer only floor(m) used")),o!==Math.floor(o)&&(o=Math.floor(o),x.d.Warn("n not an integer only floor(n) used"));const H=this.x;return this.x=w-H-this.y,this.y=o+H,this}rotateNeg120(w,o){w!==Math.floor(w)&&(w=Math.floor(w),x.d.Warn("m is not an integer, floor(m) used")),o!==Math.floor(o)&&(o=Math.floor(o),x.d.Warn("n is not an integer,   floor(n) used"));const H=this.x;return this.x=this.y-o,this.y=w+o-H-this.y,this}toCartesianOrigin(w,o){const H=h.io.Zero();return H.x=w.x+2*this.x*o+this.y*o,H.y=w.y+Math.sqrt(3)*this.y*o,H}static Zero(){return new ow(0,0)}}class Hw{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new hw("icosahedron","Regular",[[0,ww.d,-1],[-ww.d,1,0],[-1,0,-ww.d],[1,0,-ww.d],[ww.d,1,0],[0,ww.d,1],[-1,0,ww.d],[-ww.d,-1,0],[0,-ww.d,-1],[ww.d,-1,0],[1,0,ww.d],[0,-ww.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let w=12;const o={},H=this.m,h=this.n;let E,e,D,t,X,L=H,A=1,y=0;0!==h&&(L=(0,R.HighestCommonFactor)(H,h)),A=H/L,y=h/L;const z=ow.Zero(),C=new ow(H,h),Q=new ow(-h,H+h),M=ow.Zero(),i=ow.Zero(),s=ow.Zero();let V,r,k,P,l=[];const O=[],T=this.vertByDist,S=(H,h,E,e)=>{V=H+"|"+E,r=h+"|"+e,V in o||r in o?V in o&&!(r in o)?o[r]=o[V]:r in o&&!(V in o)&&(o[V]=o[r]):(o[V]=w,o[r]=w,w++),T[E][0]>2?O[o[V]]=[-T[E][0],T[E][1],o[V]]:O[o[V]]=[l[T[E][0]],T[E][1],o[V]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let c=0;c<20;c++){if(l=this.IDATA.face[c],D=l[2],t=l[1],X=l[0],k=z.x+"|"+z.y,V=c+"|"+k,V in o||(o[V]=D,O[D]=[l[T[k][0]],T[k][1]]),k=C.x+"|"+C.y,V=c+"|"+k,V in o||(o[V]=t,O[t]=[l[T[k][0]],T[k][1]]),k=Q.x+"|"+Q.y,V=c+"|"+k,V in o||(o[V]=X,O[X]=[l[T[k][0]],T[k][1]]),E=this.IDATA.edgematch[c][0],e=this.IDATA.edgematch[c][1],"B"===e)for(let w=1;w<L;w++)i.x=H-w*(A+y),i.y=h+w*A,s.x=-w*y,s.y=w*(A+y),k=i.x+"|"+i.y,P=s.x+"|"+s.y,S(c,E,k,P);if("O"===e)for(let w=1;w<L;w++)s.x=-w*y,s.y=w*(A+y),M.x=w*A,M.y=w*y,k=s.x+"|"+s.y,P=M.x+"|"+M.y,S(c,E,k,P);if(E=this.IDATA.edgematch[c][2],e=this.IDATA.edgematch[c][3],e&&"A"===e)for(let w=1;w<L;w++)M.x=w*A,M.y=w*y,i.x=H-(L-w)*(A+y),i.y=h+(L-w)*A,k=M.x+"|"+M.y,P=i.x+"|"+i.y,S(c,E,k,P);for(let H=0;H<this.vertices.length;H++)k=this.vertices[H].x+"|"+this.vertices[H].y,V=c+"|"+k,V in o||(o[V]=w++,T[k][0]>2?O[o[V]]=[-T[k][0],T[k][1],o[V]]:O[o[V]]=[l[T[k][0]],T[k][1],o[V]])}this.closestTo=O,this.vecToidx=o}calcCoeffs(){const w=this.m,o=this.n,H=Math.sqrt(3)/3,h=w*w+o*o+w*o;this.coau=(w+o)/h,this.cobu=-o/h,this.coav=-H*(w-o)/h,this.cobv=H*(2*w+o)/h}createInnerFacets(){const w=this.m,o=this.n;for(let H=0;H<o+w+1;H++)for(let w=this.min[H];w<this.max[H]+1;w++)w<this.max[H]&&w<this.max[H+1]+1&&this.innerFacets.push(["|"+w+"|"+H,"|"+w+"|"+(H+1),"|"+(w+1)+"|"+H]),H>0&&w<this.max[H-1]&&w+1<this.max[H]+1&&this.innerFacets.push(["|"+w+"|"+H,"|"+(w+1)+"|"+H,"|"+(w+1)+"|"+(H-1)])}edgeVecsABOB(){const w=this.m,o=this.n,H=new ow(-o,w+o);for(let h=1;h<w+o;h++){const w=new ow(this.min[h],h),o=new ow(this.min[h-1],h-1),E=new ow(this.min[h+1],h+1),e=w.clone(),D=o.clone(),t=E.clone();e.rotate60About(H),D.rotate60About(H),t.rotate60About(H);const X=new ow(this.max[e.y],e.y),L=new ow(this.max[e.y-1],e.y-1),A=new ow(this.max[e.y-1]-1,e.y-1);e.x===X.x&&e.y===X.y||(e.x!==L.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([w,L,A]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([w,A,X])):e.y===t.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([w,o,L]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([w,L,E])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([w,o,L]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([w,L,X])))}}mapABOBtoOBOA(){const w=new ow(0,0);for(let o=0;o<this.isoVecsABOB.length;o++){const H=[];for(let h=0;h<3;h++)w.x=this.isoVecsABOB[o][h].x,w.y=this.isoVecsABOB[o][h].y,0===this.vertexTypes[o][h]&&w.rotateNeg120(this.m,this.n),H.push(w.clone());this.isoVecsOBOA.push(H)}}mapABOBtoBAOA(){const w=new ow(0,0);for(let o=0;o<this.isoVecsABOB.length;o++){const H=[];for(let h=0;h<3;h++)w.x=this.isoVecsABOB[o][h].x,w.y=this.isoVecsABOB[o][h].y,1===this.vertexTypes[o][h]&&w.rotate120(this.m,this.n),H.push(w.clone());this.isoVecsBAOA.push(H)}}MapToFace(w,o){const H=this.IDATA.face[w],E=H[2],e=H[1],D=H[0],t=h.io.Po(this.IDATA.vertex[E]),X=h.io.Po(this.IDATA.vertex[e]),L=h.io.Po(this.IDATA.vertex[D]),A=X.so(t),y=L.so(t),z=A.scale(this.coau).add(y.scale(this.cobu)),C=A.scale(this.coav).add(y.scale(this.cobv)),Q=[];let M,i=h.TmpVectors.io[0];for(let h=0;h<this.cartesian.length;h++)i=z.scale(this.cartesian[h].x).add(C.scale(this.cartesian[h].y)).add(t),Q[h]=[i.x,i.y,i.z],M=w+"|"+this.vertices[h].x+"|"+this.vertices[h].y,o.vertex[this.vecToidx[M]]=[i.x,i.y,i.z]}build(w,o){const H=[],h=ow.Zero(),E=new ow(w,o),e=new ow(-o,w+o);H.push(h,E,e);for(let k=o;k<w+1;k++)for(let o=0;o<w+1-k;o++)H.push(new ow(o,k));if(o>0){const h=(0,R.HighestCommonFactor)(w,o),E=w/h,e=o/h;for(let t=1;t<h;t++)H.push(new ow(t*E,t*e)),H.push(new ow(-t*e,t*(E+e))),H.push(new ow(w-t*(E+e),o+t*E));const D=w/o;for(let t=1;t<o;t++)for(let h=0;h<t*D;h++)H.push(new ow(h,t)),H.push(new ow(h,t).rotate120(w,o)),H.push(new ow(h,t).rotateNeg120(w,o))}H.sort(((w,o)=>w.x-o.x)),H.sort(((w,o)=>w.y-o.y));const D=new Array(w+o+1),t=new Array(w+o+1);for(let k=0;k<D.length;k++)D[k]=1/0,t[k]=-1/0;let X=0,L=0;const A=H.length;for(let k=0;k<A;k++)L=H[k].x,X=H[k].y,D[X]=Math.min(L,D[X]),t[X]=Math.max(L,t[X]);const y=(H,h)=>{const E=H.clone();return"A"===h&&E.rotateNeg120(w,o),"B"===h&&E.rotate120(w,o),E.x<0?E.y:E.x+E.y},z=[],C=[],Q=[],M=[],i={},s=[];let V=-1,r=-1;for(let k=0;k<A;k++)z[k]=H[k].toCartesianOrigin(new ow(0,0),.5),C[k]=y(H[k],"O"),Q[k]=y(H[k],"A"),M[k]=y(H[k],"B"),C[k]===Q[k]&&Q[k]===M[k]?(V=3,r=C[k]):C[k]===Q[k]?(V=4,r=C[k]):Q[k]===M[k]?(V=5,r=Q[k]):M[k]===C[k]&&(V=6,r=C[k]),C[k]<Q[k]&&C[k]<M[k]&&(V=2,r=C[k]),Q[k]<C[k]&&Q[k]<M[k]&&(V=1,r=Q[k]),M[k]<Q[k]&&M[k]<C[k]&&(V=0,r=M[k]),s.push([V,r,H[k].x,H[k].y]);s.sort(((w,o)=>w[2]-o[2])),s.sort(((w,o)=>w[3]-o[3])),s.sort(((w,o)=>w[1]-o[1])),s.sort(((w,o)=>w[0]-o[0]));for(let k=0;k<s.length;k++)i[s[k][2]+"|"+s[k][3]]=[s[k][0],s[k][1],k];return this.m=w,this.n=o,this.vertices=H,this.vertByDist=i,this.cartesian=z,this.min=D,this.max=t,this}}class hw{constructor(w,o,H,h){this.name=w,this.category=o,this.vertex=H,this.face=h}}class Ew extends hw{innerToData(w,o){for(let H=0;H<o.innerFacets.length;H++)this.face.push(o.innerFacets[H].map((H=>o.vecToidx[w+H])))}mapABOBtoDATA(w,o){const H=o.IDATA.edgematch[w][0];for(let h=0;h<o.isoVecsABOB.length;h++){const E=[];for(let e=0;e<3;e++)0===o.vertexTypes[h][e]?E.push(w+"|"+o.isoVecsABOB[h][e].x+"|"+o.isoVecsABOB[h][e].y):E.push(H+"|"+o.isoVecsABOB[h][e].x+"|"+o.isoVecsABOB[h][e].y);this.face.push([o.vecToidx[E[0]],o.vecToidx[E[1]],o.vecToidx[E[2]]])}}mapOBOAtoDATA(w,o){const H=o.IDATA.edgematch[w][0];for(let h=0;h<o.isoVecsOBOA.length;h++){const E=[];for(let e=0;e<3;e++)1===o.vertexTypes[h][e]?E.push(w+"|"+o.isoVecsOBOA[h][e].x+"|"+o.isoVecsOBOA[h][e].y):E.push(H+"|"+o.isoVecsOBOA[h][e].x+"|"+o.isoVecsOBOA[h][e].y);this.face.push([o.vecToidx[E[0]],o.vecToidx[E[1]],o.vecToidx[E[2]]])}}mapBAOAtoDATA(w,o){const H=o.IDATA.edgematch[w][2];for(let h=0;h<o.isoVecsBAOA.length;h++){const E=[];for(let e=0;e<3;e++)1===o.vertexTypes[h][e]?E.push(w+"|"+o.isoVecsBAOA[h][e].x+"|"+o.isoVecsBAOA[h][e].y):E.push(H+"|"+o.isoVecsBAOA[h][e].x+"|"+o.isoVecsBAOA[h][e].y);this.face.push([o.vecToidx[E[0]],o.vecToidx[E[1]],o.vecToidx[E[2]]])}}orderData(w){const o=[];for(let e=0;e<13;e++)o[e]=[];const H=w.closestTo;for(let e=0;e<H.length;e++)H[e][0]>-1?H[e][1]>0&&o[H[e][0]].push([e,H[e][1]]):o[12].push([e,H[e][0]]);const h=[];for(let e=0;e<12;e++)h[e]=e;let E=12;for(let e=0;e<12;e++){o[e].sort(((w,o)=>w[1]-o[1]));for(let w=0;w<o[e].length;w++)h[o[e][w][0]]=E++}for(let e=0;e<o[12].length;e++)h[o[12][e][0]]=E++;for(let e=0;e<this.vertex.length;e++)this.vertex[e].push(h[e]);this.vertex.sort(((w,o)=>w[3]-o[3]));for(let e=0;e<this.vertex.length;e++)this.vertex[e].pop();for(let e=0;e<this.face.length;e++)for(let w=0;w<this.face[e].length;w++)this.face[e][w]=h[this.face[e][w]];this.sharedNodes=o[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(w,o){const H=[],h=[];let E=o.pop();h.push(E);let e=this.face[E].indexOf(w);e=(e+2)%3;let D=this.face[E][e];H.push(D);let t=0;for(;o.length>0;)E=o[t],this.face[E].indexOf(D)>-1?(e=(this.face[E].indexOf(D)+1)%3,D=this.face[E][e],H.push(D),h.push(E),o.splice(t,1),t=0):t++;return this.adjacentFaces.push(H),h}toGoldbergPolyhedronData(){const w=new hw("GeoDual","Goldberg",[],[]);w.name="GD dual";const o=this.vertex.length,H=new Array(o);for(let X=0;X<o;X++)H[X]=[];for(let X=0;X<this.face.length;X++)for(let w=0;w<3;w++)H[this.face[X][w]].push(X);let h=0,E=0,e=0,D=[],t=[];this.adjacentFaces=[];for(let X=0;X<H.length;X++){w.face[X]=this.setOrder(X,H[X].concat([]));for(const o of H[X]){h=0,E=0,e=0,D=this.face[o];for(let w=0;w<3;w++)t=this.vertex[D[w]],h+=t[0],E+=t[1],e+=t[2];w.vertex[o]=[h/3,E/3,e/3]}}return w}static BuildGeodesicData(w){const o=new Ew("Geodesic-m-n","Geodesic",[[0,ww.d,-1],[-ww.d,1,0],[-1,0,-ww.d],[1,0,-ww.d],[ww.d,1,0],[0,ww.d,1],[-1,0,ww.d],[-ww.d,-1,0],[0,-ww.d,-1],[ww.d,-1,0],[1,0,ww.d],[0,-ww.d,1]],[]);w.setIndices(),w.calcCoeffs(),w.createInnerFacets(),w.edgeVecsABOB(),w.mapABOBtoOBOA(),w.mapABOBtoBAOA();for(let H=0;H<w.IDATA.face.length;H++)w.MapToFace(H,o),o.innerToData(H,w),"B"===w.IDATA.edgematch[H][1]&&o.mapABOBtoDATA(H,w),"O"===w.IDATA.edgematch[H][1]&&o.mapOBOAtoDATA(H,w),"A"===w.IDATA.edgematch[H][3]&&o.mapBAOAtoDATA(H,w);o.orderData(w);return o.vertex=o.vertex.map((function(w){const o=w[0],H=w[1],h=w[2],E=Math.sqrt(o*o+H*H+h*h);return w[0]*=1/E,w[1]*=1/E,w[2]*=1/E,w})),o}}E.d._GoldbergMeshParser=(w,o)=>ew.Parse(w,o);class ew extends E.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(w,o){return void 0===o?(w>this.goldbergData.nbUnsharedFaces-1&&(x.d.Warn("Maximum number of unshared faces used"),w=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+w):(w>11&&(x.d.Warn("Last pole used"),w=11),o>this.goldbergData.nbFacesAtPole-1&&(x.d.Warn("Maximum number of faces at a pole used"),o=this.goldbergData.nbFacesAtPole-1),12+w*this.goldbergData.nbFacesAtPole+o)}_changeGoldbergFaceColors(w){for(let H=0;H<w.length;H++){const o=w[H][0],h=w[H][1],E=w[H][2];for(let w=o;w<h+1;w++)this.goldbergData.faceColors[w]=E}const o=[];for(let H=0;H<12;H++)for(let w=0;w<5;w++)o.push(this.goldbergData.faceColors[H].r,this.goldbergData.faceColors[H].g,this.goldbergData.faceColors[H].b,this.goldbergData.faceColors[H].a);for(let H=12;H<this.goldbergData.faceColors.length;H++)for(let w=0;w<6;w++)o.push(this.goldbergData.faceColors[H].r,this.goldbergData.faceColors[H].g,this.goldbergData.faceColors[H].b,this.goldbergData.faceColors[H].a);return o}setGoldbergFaceColors(w){const o=this._changeGoldbergFaceColors(w);this.Nw(e.e.ColorKind,o)}updateGoldbergFaceColors(w){const o=this._changeGoldbergFaceColors(w);this.updateVerticesData(e.e.ColorKind,o)}_changeGoldbergFaceUVs(w){const o=this.getVerticesData(e.e.UVKind);for(let H=0;H<w.length;H++){const h=w[H][0],E=w[H][1],e=w[H][2],D=w[H][3],t=w[H][4],X=[],L=[];let A,y;for(let w=0;w<5;w++)A=e.x+D*Math.cos(t+w*Math.PI/2.5),y=e.y+D*Math.sin(t+w*Math.PI/2.5),A<0&&(A=0),A>1&&(A=1),X.push(A,y);for(let w=0;w<6;w++)A=e.x+D*Math.cos(t+w*Math.PI/3),y=e.y+D*Math.sin(t+w*Math.PI/3),A<0&&(A=0),A>1&&(A=1),L.push(A,y);for(let w=h;w<Math.min(12,E+1);w++)for(let H=0;H<5;H++)o[10*w+2*H]=X[2*H],o[10*w+2*H+1]=X[2*H+1];for(let w=Math.max(12,h);w<E+1;w++)for(let H=0;H<6;H++)o[12*w-24+2*H]=L[2*H],o[12*w-23+2*H]=L[2*H+1]}return o}setGoldbergFaceUVs(w){const o=this._changeGoldbergFaceUVs(w);this.Nw(e.e.UVKind,o)}updateGoldbergFaceUVs(w){const o=this._changeGoldbergFaceUVs(w);this.updateVerticesData(e.e.UVKind,o)}placeOnGoldbergFaceAt(w,o,H){const E=h.io.RotationFromAxis(this.goldbergData.faceXaxis[o],this.goldbergData.faceYaxis[o],this.goldbergData.faceZaxis[o]);w.rotation=E,w.position=this.goldbergData.faceCenters[o].add(this.goldbergData.faceXaxis[o].scale(H.x)).add(this.goldbergData.faceYaxis[o].scale(H.y)).add(this.goldbergData.faceZaxis[o].scale(H.z))}serialize(w){super.serialize(w),w.type="GoldbergMesh";const o={};if(o.adjacentFaces=this.goldbergData.adjacentFaces,o.nbSharedFaces=this.goldbergData.nbSharedFaces,o.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,o.nbFaces=this.goldbergData.nbFaces,o.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){o.faceColors=[];for(const w of this.goldbergData.faceColors)o.faceColors.push(w.Ae())}if(this.goldbergData.faceCenters){o.faceCenters=[];for(const w of this.goldbergData.faceCenters)o.faceCenters.push(w.Ae())}if(this.goldbergData.faceZaxis){o.faceZaxis=[];for(const w of this.goldbergData.faceZaxis)o.faceZaxis.push(w.Ae())}if(this.goldbergData.faceYaxis){o.faceYaxis=[];for(const w of this.goldbergData.faceYaxis)o.faceYaxis.push(w.Ae())}if(this.goldbergData.faceXaxis){o.faceXaxis=[];for(const w of this.goldbergData.faceXaxis)o.faceXaxis.push(w.Ae())}w.goldbergData=o}static Parse(w,o){const H=w.goldbergData;H.faceColors=H.faceColors.map((w=>z.ae.Po(w))),H.faceCenters=H.faceCenters.map((w=>h.io.Po(w))),H.faceZaxis=H.faceZaxis.map((w=>h.io.Po(w))),H.faceXaxis=H.faceXaxis.map((w=>h.io.Po(w))),H.faceYaxis=H.faceYaxis.map((w=>h.io.Po(w)));const E=new ew(w.name,o);return E.goldbergData=H,E}}var Dw=H(12271);const tw={CreateBox:y.b,CreateTiledBox:i,CreateSphere:s.e,CreateDisc:A.e,CreateIcoSphere:G,CreateRibbon:L,CreateCylinder:P,CreateTorus:O,CreateTorusKnot:S,CreateLineSystem:c.h,VL:c.i,CreateDashedLines:c.e,ExtrudeShape:J,ExtrudeShapeCustom:g,CreateLathe:p,CreateTiledPlane:Q,PL:f.e,CreateGround:N.g,CreateTiledGround:N.i,CreateGroundFromHeightMap:N.d,CreatePolygon:W.d,ExtrudePolygon:W.h,CreateTube:j,CreatePolyhedron:u,CreateGeodesic:function(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=o.m||1;h!==Math.floor(h)&&(h=Math.floor(h),x.d.Warn("m not an integer only floor(m) used"));let E=o.n||0;if(E!==Math.floor(E)&&(E=Math.floor(E),x.d.Warn("n not an integer only floor(n) used")),E>h){const w=E;E=h,h=w,x.d.Warn("n > m therefore m and n swapped")}const e=new Hw;return e.build(h,E),u(w,{custom:Ew.BuildGeodesicData(e),size:o.size,sizeX:o.sizeX,sizeY:o.sizeY,sizeZ:o.sizeZ,faceUV:o.faceUV,faceColors:o.faceColors,flat:o.flat,updatable:o.updatable,sideOrientation:o.sideOrientation,frontUVs:o.frontUVs,backUVs:o.backUVs},H)},CreateGoldberg:function(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=o.size,X=o.sizeX||e||1,L=o.sizeY||e||1,A=o.sizeZ||e||1;let y=o.m||1;y!==Math.floor(y)&&(y=Math.floor(y),x.d.Warn("m not an integer only floor(m) used"));let C=o.n||0;if(C!==Math.floor(C)&&(C=Math.floor(C),x.d.Warn("n not an integer only floor(n) used")),C>y){const w=C;C=y,y=w,x.d.Warn("n > m therefore m and n swapped")}const Q=new Hw;Q.build(y,C);const M=Ew.BuildGeodesicData(Q),i=M.toGoldbergPolyhedronData(),s=new ew(w,H);o.sideOrientation=E.d._GetDefaultSideOrientation(o.sideOrientation),s._originalBuilderSideOrientation=o.sideOrientation;(function(w,o){const H=w.size,E=w.sizeX||H||1,e=w.sizeY||H||1,X=w.sizeZ||H||1,L=0===w.sideOrientation?0:w.sideOrientation||D.b.DEFAULTSIDE,A=[],y=[],z=[],C=[];let Q=1/0,M=-1/0,i=1/0,s=-1/0;for(let h=0;h<o.vertex.length;h++)Q=Math.min(Q,o.vertex[h][0]*E),M=Math.max(M,o.vertex[h][0]*E),i=Math.min(i,o.vertex[h][1]*e),s=Math.max(s,o.vertex[h][1]*e);let V=0;for(let D=0;D<o.face.length;D++){const w=o.face[D],H=h.io.Po(o.vertex[w[0]]),L=h.io.Po(o.vertex[w[2]]),r=h.io.Po(o.vertex[w[1]]),k=L.so(H),P=r.so(H),l=h.io.Cross(P,k).normalize();for(let h=0;h<w.length;h++){z.push(l.x,l.y,l.z);const H=o.vertex[w[h]];A.push(H[0]*E,H[1]*e,H[2]*X);const D=(H[1]*e-i)/(s-i);C.push((H[0]*E-Q)/(M-Q),t.c?1-D:D)}for(let o=0;o<w.length-2;o++)y.push(V,V+o+2,V+o+1);V+=w.length}D.b._ComputeSides(L,A,y,z,C);const r=new D.b;return r.Sw=A,r.indices=y,r.cw=z,r.Bw=C,r})(o,i).gw(s,o.updatable),s.goldbergData.nbSharedFaces=M.sharedNodes,s.goldbergData.nbUnsharedFaces=M.poleNodes,s.goldbergData.adjacentFaces=M.adjacentFaces,s.goldbergData.nbFaces=s.goldbergData.nbSharedFaces+s.goldbergData.nbUnsharedFaces,s.goldbergData.nbFacesAtPole=(s.goldbergData.nbUnsharedFaces-12)/12;for(let E=0;E<M.vertex.length;E++)s.goldbergData.faceCenters.push(h.io.Po(M.vertex[E])),s.goldbergData.faceCenters[E].x*=X,s.goldbergData.faceCenters[E].y*=L,s.goldbergData.faceCenters[E].z*=A,s.goldbergData.faceColors.push(new z.ae(1,1,1,1));for(let E=0;E<i.face.length;E++){const w=i.face[E],o=h.io.Po(i.vertex[w[0]]),H=h.io.Po(i.vertex[w[2]]),e=h.io.Po(i.vertex[w[1]]),D=H.so(o),t=e.so(o),X=h.io.Cross(t,D).normalize(),L=h.io.Cross(t,X).normalize();s.goldbergData.faceXaxis.push(t.normalize()),s.goldbergData.faceYaxis.push(X),s.goldbergData.faceZaxis.push(L)}return s},CreateDecal:v,CreateCapsule:Y,CreateText:Dw.d}},13028:(w,o,H)=>{"use strict";H.d(o,{b:()=>to});var h=H(11720),E=H(12091);class e extends E.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var D=H(11757),t=(H(11873),H(11666));class X{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(w){this._targetStopDuration!==w&&(this._targetStopDuration=w)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(w){this._noiseTexture!==w&&(this._noiseTexture=w,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(w){this._animationSheetEnabled!==w&&(this._animationSheetEnabled=w)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(w){this._isAnimationSheetEnabled!=w&&(this._isAnimationSheetEnabled=w,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(w){this._useLogarithmicDepth=w&&this.Ow().getEngine().getCaps().fragmentDepthSupported}Ow(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(w){switch(w){case X.BLENDMODE_MULTIPLYADD:return;case X.BLENDMODE_ADD:w=1;break;case X.BLENDMODE_ONEONE:w=6;break;case X.BLENDMODE_STANDARD:w=2;break;case X.BLENDMODE_MULTIPLY:w=4;break;case X.BLENDMODE_SUBTRACT:w=3}this._engine.setAlphaMode(w)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:h.io.Zero()}set direction1(w){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=w)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:h.io.Zero()}set direction2(w){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=w)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:h.io.Zero()}set minEmitBox(w){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=w)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:h.io.Zero()}set maxEmitBox(w){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=w)}get billboardMode(){return this._billboardMode}set billboardMode(w){this._billboardMode!==w&&(this._billboardMode=w,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(w){this._isBillboardBased!==w&&(this._isBillboardBased=w,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(w){this._attachImageProcessingConfiguration(w)}_attachImageProcessingConfiguration(w){w!==this._imageProcessingConfiguration&&(!w&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=w)}_reset(){}_removeGradientAndTexture(w,o,H){if(!o)return this;let h=0;for(const E of o){if(E.gradient===w){o.splice(h,1);break}h++}return H&&H.dispose(),this}constructor(w){this.animations=[],this.renderingGroupId=0,this.Eo=h.io.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new h.io(10,10,10),this.onAnimationEnd=null,this.blendMode=X.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new h.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.ML=new h.io(0,0,0),this._useLogarithmicDepth=!1,this.gravity=h.io.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new D.ae(1,1,1,1),this.color2=new D.ae(1,1,1,1),this.colorDead=new D.ae(0,0,0,1),this.textureMask=new D.ae(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new e,this.id=w,this.name=w}createPointEmitter(w,o){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new h.io(0,1,0),arguments.length>2&&void 0!==arguments[2]||new h.io(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new h.io(0,1,0),arguments.length>4&&void 0!==arguments[4]||new h.io(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new h.io(0,1,0),arguments.length>3&&void 0!==arguments[3]||new h.io(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(w,o,H,h){throw new Error("Method not implemented.")}}X.BLENDMODE_ONEONE=0,X.BLENDMODE_STANDARD=1,X.BLENDMODE_ADD=2,X.BLENDMODE_MULTIPLY=3,X.BLENDMODE_MULTIPLYADD=4,X.BLENDMODE_SUBTRACT=-1,(0,t.g)("BABYLON.BaseParticleSystem",X);var L=H(11729),A=H(11556);class y{constructor(){this.direction1=new h.io(0,1,0),this.direction2=new h.io(0,1,0),this.minEmitBox=new h.io(-.5,-.5,-.5),this.maxEmitBox=new h.io(.5,.5,.5)}startDirectionFunction(w,o,H,E){const e=(0,L.RandomRange)(this.direction1.x,this.direction2.x),D=(0,L.RandomRange)(this.direction1.y,this.direction2.y),t=(0,L.RandomRange)(this.direction1.z,this.direction2.z);if(E)return o.x=e,o.y=D,void(o.z=t);h.io.TransformNormalFromFloatsToRef(e,D,t,w,o)}startPositionFunction(w,o,H,E){const e=(0,L.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),D=(0,L.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),t=(0,L.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(E)return o.x=e,o.y=D,void(o.z=t);h.io.TransformCoordinatesFromFloatsToRef(e,D,t,w,o)}clone(){const w=new y;return A.d.DeepCopy(this,w),w}applyToShader(w){w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2),w.setVector3("minEmitBox",this.minEmitBox),w.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(w){w.addUniform("direction1",3),w.addUniform("direction2",3),w.addUniform("minEmitBox",3),w.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.direction1=this.direction1.Ae(),w.direction2=this.direction2.Ae(),w.minEmitBox=this.minEmitBox.Ae(),w.maxEmitBox=this.maxEmitBox.Ae(),w}parse(w){h.io.FromArrayToRef(w.direction1,0,this.direction1),h.io.FromArrayToRef(w.direction2,0,this.direction2),h.io.FromArrayToRef(w.minEmitBox,0,this.minEmitBox),h.io.FromArrayToRef(w.maxEmitBox,0,this.maxEmitBox)}}class z{get radius(){return this._radius}set radius(w){this._radius=w,this._buildHeight()}get angle(){return this._angle}set angle(w){this._angle=w,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=H,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=o,this.radius=w}startDirectionFunction(w,o,H,E){E?h.TmpVectors.io[0].t(H.Kt).normalize():H.position.subtractToRef(w.getTranslation(),h.TmpVectors.io[0]).normalize();const e=(0,L.RandomRange)(0,this.directionRandomizer),D=(0,L.RandomRange)(0,this.directionRandomizer),t=(0,L.RandomRange)(0,this.directionRandomizer);o.x=h.TmpVectors.io[0].x+e,o.y=h.TmpVectors.io[0].y+D,o.z=h.TmpVectors.io[0].z+t,o.normalize()}startPositionFunction(w,o,H,E){const e=(0,L.RandomRange)(0,2*Math.PI);let D;this.emitFromSpawnPointOnly?D=1e-4:(D=(0,L.RandomRange)(0,this.heightRange),D=1-D*D);let t=this._radius-(0,L.RandomRange)(0,this._radius*this.radiusRange);t*=D;const X=t*Math.sin(e),A=t*Math.cos(e),y=D*this._height;if(E)return o.x=X,o.y=y,void(o.z=A);h.io.TransformCoordinatesFromFloatsToRef(X,y,A,w,o)}clone(){const w=new z(this._radius,this._angle,this.directionRandomizer);return A.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat2("radius",this._radius,this.radiusRange),w.setFloat("coneAngle",this._angle),w.setFloat2("height",this._height,this.heightRange),w.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(w){w.addUniform("radius",2),w.addUniform("coneAngle",1),w.addUniform("height",2),w.addUniform("directionRandomizer",1)}getEffectDefines(){let w="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(w+="\n#define CONEEMITTERSPAWNPOINT"),w}getClassName(){return"ConeParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.radius=this._radius,w.angle=this._angle,w.directionRandomizer=this.directionRandomizer,w.radiusRange=this.radiusRange,w.heightRange=this.heightRange,w.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,w}parse(w){this.radius=w.radius,this.angle=w.angle,this.directionRandomizer=w.directionRandomizer,this.radiusRange=void 0!==w.radiusRange?w.radiusRange:1,this.heightRange=void 0!==w.radiusRange?w.heightRange:1,this.emitFromSpawnPointOnly=void 0!==w.emitFromSpawnPointOnly&&w.emitFromSpawnPointOnly}}class C extends z{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.io(0,1,0),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.io(0,1,0);super(w,o),this.direction1=H,this.direction2=E}startDirectionFunction(w,o){const H=(0,L.RandomRange)(this.direction1.x,this.direction2.x),E=(0,L.RandomRange)(this.direction1.y,this.direction2.y),e=(0,L.RandomRange)(this.direction1.z,this.direction2.z);h.io.TransformNormalFromFloatsToRef(H,E,e,w,o)}clone(){const w=new C(this.radius,this.angle,this.direction1,this.direction2);return A.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const w=super.serialize();return w.direction1=this.direction1.Ae(),w.direction2=this.direction2.Ae(),w}parse(w){super.parse(w),this.direction1.t(w.direction1),this.direction2.t(w.direction2)}}class Q{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=w,this.height=o,this.radiusRange=H,this.directionRandomizer=E,this._tempVector=h.io.Zero()}startDirectionFunction(w,o,H,E,e){H.position.subtractToRef(w.getTranslation(),this._tempVector),this._tempVector.normalize(),h.io.TransformNormalToRef(this._tempVector,e,this._tempVector);const D=(0,L.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let t=Math.atan2(this._tempVector.x,this._tempVector.z);t+=(0,L.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=D,this._tempVector.x=Math.sin(t),this._tempVector.z=Math.cos(t),this._tempVector.normalize(),E?o.t(this._tempVector):h.io.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,w,o)}startPositionFunction(w,o,H,E){const e=(0,L.RandomRange)(-this.height/2,this.height/2),D=(0,L.RandomRange)(0,2*Math.PI),t=(0,L.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),X=Math.sqrt(t)*this.radius,A=X*Math.cos(D),y=X*Math.sin(D);E?o.We(A,e,y):h.io.TransformCoordinatesFromFloatsToRef(A,e,y,w,o)}clone(){const w=new Q(this.radius,this.directionRandomizer);return A.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("height",this.height),w.setFloat("radiusRange",this.radiusRange),w.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("height",1),w.addUniform("radiusRange",1),w.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.radius=this.radius,w.height=this.height,w.radiusRange=this.radiusRange,w.directionRandomizer=this.directionRandomizer,w}parse(w){this.radius=w.radius,this.height=w.height,this.radiusRange=w.radiusRange,this.directionRandomizer=w.directionRandomizer}}class M extends Q{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.io(0,1,0),e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new h.io(0,1,0);super(w,o,H),this.direction1=E,this.direction2=e}startDirectionFunction(w,o,H,E){const e=(0,L.RandomRange)(this.direction1.x,this.direction2.x),D=(0,L.RandomRange)(this.direction1.y,this.direction2.y),t=(0,L.RandomRange)(this.direction1.z,this.direction2.z);E?o.We(e,D,t):h.io.TransformNormalFromFloatsToRef(e,D,t,w,o)}clone(){const w=new M(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return A.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("height",this.height),w.setFloat("radiusRange",this.radiusRange),w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("height",1),w.addUniform("radiusRange",1),w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const w=super.serialize();return w.direction1=this.direction1.Ae(),w.direction2=this.direction2.Ae(),w}parse(w){super.parse(w),h.io.FromArrayToRef(w.direction1,0,this.direction1),h.io.FromArrayToRef(w.direction2,0,this.direction2)}}class i{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=w,this.radiusRange=o,this.directionRandomizer=H}startDirectionFunction(w,o,H,E){const e=H.position.so(w.getTranslation()).normalize(),D=(0,L.RandomRange)(0,this.directionRandomizer),t=(0,L.RandomRange)(0,this.directionRandomizer),X=(0,L.RandomRange)(0,this.directionRandomizer);e.x+=D,e.y+=t,e.z+=X,e.normalize(),E?o.t(e):h.io.TransformNormalFromFloatsToRef(e.x,e.y,e.z,w,o)}startPositionFunction(w,o,H,E){const e=this.radius-(0,L.RandomRange)(0,this.radius*this.radiusRange),D=(0,L.RandomRange)(0,1),t=(0,L.RandomRange)(0,2*Math.PI),X=Math.acos(2*D-1),A=e*Math.cos(t)*Math.sin(X),y=e*Math.cos(X),z=e*Math.sin(t)*Math.sin(X);E?o.We(A,Math.abs(y),z):h.io.TransformCoordinatesFromFloatsToRef(A,Math.abs(y),z,w,o)}clone(){const w=new i(this.radius,this.directionRandomizer);return A.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.radius=this.radius,w.radiusRange=this.radiusRange,w.directionRandomizer=this.directionRandomizer,w}parse(w){this.radius=w.radius,this.radiusRange=w.radiusRange,this.directionRandomizer=w.directionRandomizer}}class s{constructor(){this.direction1=new h.io(0,1,0),this.direction2=new h.io(0,1,0)}startDirectionFunction(w,o,H,E){const e=(0,L.RandomRange)(this.direction1.x,this.direction2.x),D=(0,L.RandomRange)(this.direction1.y,this.direction2.y),t=(0,L.RandomRange)(this.direction1.z,this.direction2.z);E?o.We(e,D,t):h.io.TransformNormalFromFloatsToRef(e,D,t,w,o)}startPositionFunction(w,o,H,E){E?o.We(0,0,0):h.io.TransformCoordinatesFromFloatsToRef(0,0,0,w,o)}clone(){const w=new s;return A.d.DeepCopy(this,w),w}applyToShader(w){w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.direction1=this.direction1.Ae(),w.direction2=this.direction2.Ae(),w}parse(w){h.io.FromArrayToRef(w.direction1,0,this.direction1),h.io.FromArrayToRef(w.direction2,0,this.direction2)}}class V{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=w,this.radiusRange=o,this.directionRandomizer=H}startDirectionFunction(w,o,H,E){const e=H.position.so(w.getTranslation()).normalize(),D=(0,L.RandomRange)(0,this.directionRandomizer),t=(0,L.RandomRange)(0,this.directionRandomizer),X=(0,L.RandomRange)(0,this.directionRandomizer);e.x+=D,e.y+=t,e.z+=X,e.normalize(),E?o.t(e):h.io.TransformNormalFromFloatsToRef(e.x,e.y,e.z,w,o)}startPositionFunction(w,o,H,E){const e=this.radius-(0,L.RandomRange)(0,this.radius*this.radiusRange),D=(0,L.RandomRange)(0,1),t=(0,L.RandomRange)(0,2*Math.PI),X=Math.acos(2*D-1),A=e*Math.cos(t)*Math.sin(X),y=e*Math.cos(X),z=e*Math.sin(t)*Math.sin(X);E?o.We(A,y,z):h.io.TransformCoordinatesFromFloatsToRef(A,y,z,w,o)}clone(){const w=new V(this.radius,this.directionRandomizer);return A.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.radius=this.radius,w.radiusRange=this.radiusRange,w.directionRandomizer=this.directionRandomizer,w}parse(w){this.radius=w.radius,this.radiusRange=w.radiusRange,this.directionRandomizer=w.directionRandomizer}}class r extends V{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.io(0,1,0),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.io(0,1,0);super(w),this.direction1=o,this.direction2=H}startDirectionFunction(w,o){const H=(0,L.RandomRange)(this.direction1.x,this.direction2.x),E=(0,L.RandomRange)(this.direction1.y,this.direction2.y),e=(0,L.RandomRange)(this.direction1.z,this.direction2.z);h.io.TransformNormalFromFloatsToRef(H,E,e,w,o)}clone(){const w=new r(this.radius,this.direction1,this.direction2);return A.d.DeepCopy(this,w),w}applyToShader(w){w.setFloat("radius",this.radius),w.setFloat("radiusRange",this.radiusRange),w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("radius",1),w.addUniform("radiusRange",1),w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const w=super.serialize();return w.direction1=this.direction1.Ae(),w.direction2=this.direction2.Ae(),w}parse(w){super.parse(w),this.direction1.t(w.direction1),this.direction2.t(w.direction2)}}class k{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(w,o,H,E){const e=h.TmpVectors.io[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,H,e);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,H,e);const w=h.TmpVectors.io[1];e.subtractToRef(H.position,w),w.scaleToRef(1/H.lifeTime,e)}else e.set(0,0,0);E?o.t(e):h.io.TransformNormalToRef(e,w,o)}startPositionFunction(w,o,H,E){const e=h.TmpVectors.io[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,H,e):e.set(0,0,0),E?o.t(e):h.io.TransformCoordinatesToRef(e,w,o)}clone(){const w=new k;return A.d.DeepCopy(this,w),w}applyToShader(w){}buildUniformLayout(w){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const w={};return w.type=this.getClassName(),w.particlePositionGenerator=this.particlePositionGenerator,w.particleDestinationGenerator=this.particleDestinationGenerator,w}parse(w){w.particlePositionGenerator&&(this.particlePositionGenerator=w.particlePositionGenerator),w.particleDestinationGenerator&&(this.particleDestinationGenerator=w.particleDestinationGenerator)}}var P=H(11780);class l{get mesh(){return this._mesh}set mesh(w){this._mesh!==w&&(this._mesh=w,w?(this._indices=w.ke(),this._positions=w.getVerticesData(P.e.PositionKind),this._normals=w.getVerticesData(P.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=h.io.Zero(),this._mesh=null,this.direction1=new h.io(0,1,0),this.direction2=new h.io(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=w}startDirectionFunction(w,o,H,E){if(this.useMeshNormalsForDirection&&this._normals)return void h.io.TransformNormalToRef(this._storedNormal,w,o);const e=(0,L.RandomRange)(this.direction1.x,this.direction2.x),D=(0,L.RandomRange)(this.direction1.y,this.direction2.y),t=(0,L.RandomRange)(this.direction1.z,this.direction2.z);E?o.We(e,D,t):h.io.TransformNormalFromFloatsToRef(e,D,t,w,o)}startPositionFunction(w,o,H,E){if(!this._indices||!this._positions)return;const e=3*(Math.random()*(this._indices.length/3)|0),D=Math.random(),t=Math.random()*(1-D),X=1-D-t,L=this._indices[e],A=this._indices[e+1],y=this._indices[e+2],z=h.TmpVectors.io[0],C=h.TmpVectors.io[1],Q=h.TmpVectors.io[2],M=h.TmpVectors.io[3];h.io.FromArrayToRef(this._positions,3*L,z),h.io.FromArrayToRef(this._positions,3*A,C),h.io.FromArrayToRef(this._positions,3*y,Q),M.x=D*z.x+t*C.x+X*Q.x,M.y=D*z.y+t*C.y+X*Q.y,M.z=D*z.z+t*C.z+X*Q.z,E?o.We(M.x,M.y,M.z):h.io.TransformCoordinatesFromFloatsToRef(M.x,M.y,M.z,w,o),this.useMeshNormalsForDirection&&this._normals&&(h.io.FromArrayToRef(this._normals,3*L,z),h.io.FromArrayToRef(this._normals,3*A,C),h.io.FromArrayToRef(this._normals,3*y,Q),this._storedNormal.x=D*z.x+t*C.x+X*Q.x,this._storedNormal.y=D*z.y+t*C.y+X*Q.y,this._storedNormal.z=D*z.z+t*C.z+X*Q.z)}clone(){const w=new l(this.mesh);return A.d.DeepCopy(this,w),w}applyToShader(w){w.setVector3("direction1",this.direction1),w.setVector3("direction2",this.direction2)}buildUniformLayout(w){w.addUniform("direction1",3),w.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var w;const o={};return o.type=this.getClassName(),o.direction1=this.direction1.Ae(),o.direction2=this.direction2.Ae(),o.meshId=null===(w=this.mesh)||void 0===w?void 0:w.id,o.useMeshNormalsForDirection=this.useMeshNormalsForDirection,o}parse(w,o){h.io.FromArrayToRef(w.direction1,0,this.direction1),h.io.FromArrayToRef(w.direction2,0,this.direction2),w.meshId&&o&&(this.mesh=o.getLastMeshById(w.meshId)),this.useMeshNormalsForDirection=w.useMeshNormalsForDirection}}class O{_isUbo(w){return void 0!==w.addUniform}constructor(w){this._isUbo(w)?(this.setMatrix3x3=w.updateMatrix3x3.bind(w),this.setMatrix2x2=w.updateMatrix2x2.bind(w),this.setFloat=w.updateFloat.bind(w),this.setFloat2=w.updateFloat2.bind(w),this.setFloat3=w.updateFloat3.bind(w),this.setFloat4=w.updateFloat4.bind(w),this.setFloatArray=w.updateFloatArray.bind(w),this.setArray=w.updateArray.bind(w),this.setIntArray=w.updateIntArray.bind(w),this.setMatrix=w.ie.bind(w),this.setMatrices=w.updateMatrices.bind(w),this.setVector3=w.updateVector3.bind(w),this.setVector4=w.updateVector4.bind(w),this.setColor3=w.updateColor3.bind(w),this.setColor4=w.updateColor4.bind(w),this.setDirectColor4=w.updateDirectColor4.bind(w),this.setInt=w.updateInt.bind(w),this.setInt2=w.updateInt2.bind(w),this.setInt3=w.updateInt3.bind(w),this.setInt4=w.updateInt4.bind(w)):(this.setMatrix3x3=w.setMatrix3x3.bind(w),this.setMatrix2x2=w.setMatrix2x2.bind(w),this.setFloat=w.setFloat.bind(w),this.setFloat2=w.setFloat2.bind(w),this.setFloat3=w.setFloat3.bind(w),this.setFloat4=w.setFloat4.bind(w),this.setFloatArray=w.setFloatArray.bind(w),this.setArray=w.setArray.bind(w),this.setIntArray=w.setIntArray.bind(w),this.setMatrix=w.setMatrix.bind(w),this.setMatrices=w.setMatrices.bind(w),this.setVector3=w.setVector3.bind(w),this.setVector4=w.setVector4.bind(w),this.setColor3=w.setColor3.bind(w),this.setColor4=w.setColor4.bind(w),this.setDirectColor4=w.setDirectColor4.bind(w),this.setInt=w.setInt.bind(w),this.setInt2=w.setInt2.bind(w),this.setInt3=w.setInt3.bind(w),this.setInt4=w.setInt4.bind(w))}}var T=H(11625);const S="gpuUpdateParticlesPixelShader",c="#version 300 es\nvoid main() {discard;}\n";T.d.ShadersStore[S]||(T.d.ShadersStore[S]=c);const W="gpuUpdateParticlesVertexShader",B="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";T.d.ShadersStore[W]||(T.d.ShadersStore[W]=B);(0,t.g)("BABYLON.WebGL2ParticleSystem",class{constructor(w,o){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=w,this._engine=o,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var w;return(null===(w=this._updateEffect)||void 0===w?void 0:w.isReady())??!1}createUpdateBuffer(w){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof k&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=w,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new O(this._updateEffect)}createVertexBuffers(w,o){this._updateVAO.push(this._createUpdateVAO(w)),this._renderVAO.push(this._engine.recordVertexArrayObject(o,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=o}createParticleBuffer(w){return w}bindDrawBuffers(w,o,H){H?this._engine.bindBuffers(this._renderVertexBuffers,H,o):this._engine.bindVertexArrayObject(this._renderVAO[w],null)}preUpdateParticleBuffer(){const w=this._engine;if(this._engine.enableEffect(this._updateEffect),!w.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(w,o,H){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[w],null);const h=this._engine;h.bindTransformFeedbackBuffer(o.getBuffer()),h.setRasterizerState(!1),h.beginTransformFeedback(!0),h.drawArraysType(3,0,H),h.endTransformFeedback(),h.setRasterizerState(!0),h.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let w=0;w<this._updateVAO.length;w++)this._engine.releaseVertexArrayObject(this._updateVAO[w]);this._updateVAO.length=0;for(let w=0;w<this._renderVAO.length;w++)this._engine.releaseVertexArrayObject(this._renderVAO[w]);this._renderVAO.length=0}_createUpdateVAO(w){const o={};o.position=w.createVertexBuffer("position",0,3);let H=3;o.age=w.createVertexBuffer("age",H,1),H+=1,o.size=w.createVertexBuffer("size",H,3),H+=3,o.life=w.createVertexBuffer("life",H,1),H+=1,o.seed=w.createVertexBuffer("seed",H,4),H+=4,o.direction=w.createVertexBuffer("direction",H,3),H+=3,this._parent.particleEmitterType instanceof k&&(o.initialPosition=w.createVertexBuffer("initialPosition",H,3),H+=3),this._parent._colorGradientsTexture||(o.color=w.createVertexBuffer("color",H,4),H+=4),this._parent._isBillboardBased||(o.initialDirection=w.createVertexBuffer("initialDirection",H,3),H+=3),this._parent.noiseTexture&&(o.noiseCoordinates1=w.createVertexBuffer("noiseCoordinates1",H,3),H+=3,o.noiseCoordinates2=w.createVertexBuffer("noiseCoordinates2",H,3),H+=3),this._parent._angularSpeedGradientsTexture?(o.angle=w.createVertexBuffer("angle",H,1),H+=1):(o.angle=w.createVertexBuffer("angle",H,2),H+=2),this._parent._isAnimationSheetEnabled&&(o.cellIndex=w.createVertexBuffer("cellIndex",H,1),H+=1,this._parent.spriteRandomStartCell&&(o.cellStartOffset=w.createVertexBuffer("cellStartOffset",H,1),H+=1));const h=this._engine.recordVertexArrayObject(o,null,this._updateEffect);return this._engine.bindArrayBuffer(null),h}});class J{constructor(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,h=arguments.length>3?arguments[3]:void 0;this._engine=w,this._label=h,this._engine._storageBuffers.push(this),this._create(o,H)}_create(w,o){this._bufferSize=w,this._creationFlags=o,this._buffer=this._engine.createStorageBuffer(w,o,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(w,o,H){this._buffer&&this._engine.updateStorageBuffer(this._buffer,w,o,H)}async read(w,o,H,h){return await this._engine.readFromStorageBuffer(this._buffer,w,o,H,h)}dispose(){const w=this._engine._storageBuffers,o=w.indexOf(this);-1!==o&&(w[o]=w[w.length-1],w.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var g=H(11697),b=H(11702),p=H(11745),f=H(11690),N=H(12009),j=H(11551),q=H(11648),u=H(11929);class n{constructor(){this._gpuTimeInFrameId=-1,this.counter=new u.e}_addDuration(w,o){w<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==w?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(o,!1),this._gpuTimeInFrameId=w):this.counter.addCount(o,!1))}}var G=H(11606);class R{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=w,this._engine=o,this.uniqueId=N.b.UniqueId,o.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new n),this._engine.getCaps().supportComputeShaders?h.bindingsMapping?(this._context=o.createComputeContext(),this._shaderPath=H,this._options={bindingsMapping:{},defines:[],...h}):j.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):j.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(w,o){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const h=this._bindings[w];this._bindings[w]={type:H?0:4,object:o,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!h||h.object!==o||h.type!==this._bindings[w].type)}setStorageTexture(w,o){const H=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==o),this._bindings[w]={type:1,object:o,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setExternalTexture(w,o){const H=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==o),this._bindings[w]={type:6,object:o,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setVideoTexture(w,o){return!!o.externalTexture&&(this.setExternalTexture(w,o.externalTexture),!0)}setUniformBuffer(w,o){const H=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==o),this._bindings[w]={type:R._BufferIsDataBuffer(o)?7:2,object:o,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setStorageBuffer(w,o){const H=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==o),this._bindings[w]={type:R._BufferIsDataBuffer(o)?7:3,object:o,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setTextureSampler(w,o){const H=this._bindings[w];this._contextIsDirty||(this._contextIsDirty=!H||!o.compareSampler(H.object)),this._bindings[w]={type:5,object:o,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}isReady(){let w=this._effect;for(const E in this._bindings){const w=this._bindings[E],o=w.type,H=w.object;switch(o){case 0:case 4:case 1:if(!H.isReady())return!1;break;case 6:if(!H.isReady())return!1;break}}const o=[],H=this._shaderPath;if(this._options.defines)for(let E=0;E<this._options.defines.length;E++)o.push(this._options.defines[E]);const h=o.join("\n");return this._cachedDefines!==h&&(this._cachedDefines=h,w=this._engine.createComputeEffect(H,{defines:h,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=w),!!w.isReady()}dispatch(w,o,H){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,w,o,H,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const H=R._BufferIsDataBuffer(w)?w:w.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,H,o,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const o in this._bindings){const H=this._bindings[o];if(!this._options.bindingsMapping[o])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+o+"'");switch(H.type){case 0:{const h=this._samplers[o],E=H.object;var w;if(!h||!E._texture||!h.compareSampler(E._texture))this._samplers[o]=(new q.e).setParameters(E.wrapU,E.wrapV,E.wrapR,E.anisotropicFilteringLevel,E._texture.samplingMode,null===(w=E._texture)||void 0===w?void 0:w._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const w=H.object;w.getBuffer()!==H.buffer&&(H.buffer=w.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((E=>{(0,G.h)((()=>this.dispatch(w,o,H)),E,void 0,h)}))}serialize(){const w=p.e.Serialize(this);w.options=this._options,w.shaderPath=this._shaderPath,w.yz={},w.textures={};for(const o in this._bindings){const H=this._bindings[o],h=H.object;switch(H.type){case 0:case 4:case 1:{const E=h.serialize();E&&(w.textures[o]=E,w.yz[o]={type:H.type});break}}}return w}static Parse(w,o,H){const h=p.e.Parse((()=>new R(w.name,o.getEngine(),w.shaderPath,w.options)),w,o,H);for(const E in w.textures){const e=w.yz[E],D=f.d.Parse(w.textures[E],o,H);0===e.type?h.setTexture(E,D):4===e.type?h.setTexture(E,D,!1):h.setStorageTexture(E,D)}return h}static _BufferIsDataBuffer(w){return void 0!==w.underlyingResource}}(0,g.b)([(0,b.B)()],R.prototype,"name",void 0),(0,g.b)([(0,b.B)()],R.prototype,"fastMode",void 0),(0,t.g)("BABYLON.ComputeShader",R);var a=H(11978);const d="gpuUpdateParticlesComputeShader",I="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";T.d.ShadersStoreWGSL[d]||(T.d.ShadersStoreWGSL[d]=I);(0,t.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(w,o){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=w,this._engine=o}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var w;return(null===(w=this._updateComputeShader)||void 0===w?void 0:w.isReady())??!1}createUpdateBuffer(w){var o;const H={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(H.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(H.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(H.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(H.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(H.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(H.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(H.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new R("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:H,defines:w.split("\n")}),null===(o=this._simParamsComputeShader)||void 0===o||o.dispose(),this._simParamsComputeShader=new a.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new O(this._simParamsComputeShader)}createVertexBuffers(w,o){this._renderVertexBuffers.push(o)}createParticleBuffer(w){const o=new J(this._engine,4*w.length,11,"ComputeShaderParticleSystemBuffer");return o.update(w),this._bufferComputeShader.push(o),o.getBuffer()}bindDrawBuffers(w,o,H){this._engine.bindBuffers(this._renderVertexBuffers[w],H,o)}preUpdateParticleBuffer(){}updateParticleBuffer(w,o,H){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[w]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^w]),this._updateComputeShader.dispatch(Math.ceil(H/64))}releaseBuffers(){var w;for(let o=0;o<this._bufferComputeShader.length;++o)this._bufferComputeShader[o].dispose();this._bufferComputeShader.length=0,null===(w=this._simParamsComputeShader)||void 0===w||w.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class U{constructor(w,o,H){this.gradient=w,this.color1=o,this.color2=H}getColorToRef(w){this.color2?D.ae.LerpToRef(this.color1,this.color2,Math.random(),w):w.t(this.color1)}}class Z{constructor(w,o){this.gradient=w,this.color=o}}class K{constructor(w,o,H){this.gradient=w,this.factor1=o,this.factor2=H}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class F{static GetCurrentGradient(w,o,H){if(o[0].gradient>w)return void H(o[0],o[0],1);for(let E=0;E<o.length-1;E++){const h=o[E],e=o[E+1];if(w>=h.gradient&&w<=e.gradient){return void H(h,e,(w-h.gradient)/(e.gradient-h.gradient))}}const h=o.length-1;H(o[h],o[h],1)}}var v=H(11540),mw=H(12186),Y=H(11571);class x{constructor(w){this.particleSystem=w,this.position=h.io.Zero(),this.direction=h.io.Zero(),this.color=new D.ae(0,0,0,0),this.colorStep=new D.ae(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new h.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new D.ae(0,0,0,0),this._currentColor2=new D.ae(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=x._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let w=this.age,o=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===o?(o=1,w=this._randomCellOffset):w+=this._randomCellOffset);const H=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let h;h=this._initialSpriteCellLoop?(0,L.Clamp)(w*o%this.lifeTime/this.lifeTime):(0,L.Clamp)(w*o/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+h*H|0}_inheritParticleInfoToSubEmitter(w){if(w.particleSystem.Eo.position){const o=w.particleSystem.Eo;if(o.position.t(this.position),w.inheritDirection){const w=h.TmpVectors.io[0];this.direction.normalizeToRef(w),o.setDirection(w,0,Math.PI/2)}}else{w.particleSystem.Eo.t(this.position)}this.direction.scaleToRef(w.inheritedVelocityAmount/2,h.TmpVectors.io[0]),w.particleSystem._inheritedVelocityOffset.t(h.TmpVectors.io[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const w of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(w)}_reset(){this.age=0,this.id=x._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(w){w.position.t(this.position),this._initialDirection?w._initialDirection?w._initialDirection.t(this._initialDirection):w._initialDirection=this._initialDirection.clone():w._initialDirection=null,w.direction.t(this.direction),this.Kt&&(w.Kt?w.Kt.t(this.Kt):w.Kt=this.Kt.clone()),w.color.t(this.color),w.colorStep.t(this.colorStep),w.lifeTime=this.lifeTime,w.age=this.age,w._randomCellOffset=this._randomCellOffset,w.size=this.size,w.scale.t(this.scale),w.angle=this.angle,w.angularSpeed=this.angularSpeed,w.particleSystem=this.particleSystem,w.cellIndex=this.cellIndex,w.id=this.id,w._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(w._currentColorGradient=this._currentColorGradient,w._currentColor1.t(this._currentColor1),w._currentColor2.t(this._currentColor2)),this._currentSizeGradient&&(w._currentSizeGradient=this._currentSizeGradient,w._currentSize1=this._currentSize1,w._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(w._currentAngularSpeedGradient=this._currentAngularSpeedGradient,w._currentAngularSpeed1=this._currentAngularSpeed1,w._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(w._currentVelocityGradient=this._currentVelocityGradient,w._currentVelocity1=this._currentVelocity1,w._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(w._currentLimitVelocityGradient=this._currentLimitVelocityGradient,w._currentLimitVelocity1=this._currentLimitVelocity1,w._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(w._currentDragGradient=this._currentDragGradient,w._currentDrag1=this._currentDrag1,w._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(w._initialStartSpriteCellId=this._initialStartSpriteCellId,w._initialEndSpriteCellId=this._initialEndSpriteCellId,w._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(w.remapData&&this.remapData?w.remapData.t(this.remapData):w.remapData=new h.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(w._randomNoiseCoordinates1?(w._randomNoiseCoordinates1.t(this._randomNoiseCoordinates1),w._randomNoiseCoordinates2.t(this._randomNoiseCoordinates2)):(w._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),w._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}x._Count=0;var ww=H(11831),ow=(H(11868),H(12077)),Hw=H(12072),hw=H(11972);function Ew(w,o){const H=(0,L.RandomRange)(0,1);D.ae.LerpToRef(o.color1,o.color2,H,w.color),o.colorDead.subtractToRef(w.color,o._colorDiff),o._colorDiff.scaleToRef(1/w.lifeTime,w.colorStep)}function ew(w,o){w._currentColorGradient=o._colorGradients[0],w._currentColorGradient.getColorToRef(w.color),w._currentColor1.t(w.color),o._colorGradients.length>1?o._colorGradients[1].getColorToRef(w._currentColor2):w._currentColor2.t(w.color)}function Dw(w,o){const H=o._colorGradients;F.GetCurrentGradient(o._ratio,H,((o,H,h)=>{o!==w._currentColorGradient&&(w._currentColor1.t(w._currentColor2),H.getColorToRef(w._currentColor2),w._currentColorGradient=o),D.ae.LerpToRef(w._currentColor1,w._currentColor2,h,w.color)}))}function tw(w,o){w.colorStep.scaleToRef(o._scaledUpdateSpeed,o._scaledColorStep),w.color.addInPlace(o._scaledColorStep),w.color.a<0&&(w.color.a=0)}function Xw(w,o){F.GetCurrentGradient(o._ratio,o._angularSpeedGradients,((o,H,h)=>{o!==w._currentAngularSpeedGradient&&(w._currentAngularSpeed1=w._currentAngularSpeed2,w._currentAngularSpeed2=H.getFactor(),w._currentAngularSpeedGradient=o),w.angularSpeed=(0,L.Lerp)(w._currentAngularSpeed1,w._currentAngularSpeed2,h)}))}function Lw(w,o){w.angle+=w.angularSpeed*o._scaledUpdateSpeed}function Aw(w,o){o.particleEmitterType.startDirectionFunction(o._emitterWorldMatrix,w.direction,w,o.isLocal,o._emitterInverseWorldMatrix)}function yw(w,o){o.startDirectionFunction(o._emitterWorldMatrix,w.direction,w,o.isLocal)}function zw(w,o){w._currentVelocityGradient=o._velocityGradients[0],w._currentVelocity1=w._currentVelocityGradient.getFactor(),o._velocityGradients.length>1?w._currentVelocity2=o._velocityGradients[1].getFactor():w._currentVelocity2=w._currentVelocity1}function Cw(w,o){w._currentLimitVelocityGradient=o._limitVelocityGradients[0],w._currentLimitVelocity1=w._currentLimitVelocityGradient.getFactor(),o._limitVelocityGradients.length>1?w._currentLimitVelocity2=o._limitVelocityGradients[1].getFactor():w._currentLimitVelocity2=w._currentLimitVelocity1}function Qw(w,o){F.GetCurrentGradient(o._ratio,o._velocityGradients,((H,h,E)=>{H!==w._currentVelocityGradient&&(w._currentVelocity1=w._currentVelocity2,w._currentVelocity2=h.getFactor(),w._currentVelocityGradient=H),o._directionScale*=(0,L.Lerp)(w._currentVelocity1,w._currentVelocity2,E)}))}function Mw(w,o){F.GetCurrentGradient(o._ratio,o._limitVelocityGradients,((H,h,E)=>{H!==w._currentLimitVelocityGradient&&(w._currentLimitVelocity1=w._currentLimitVelocity2,w._currentLimitVelocity2=h.getFactor(),w._currentLimitVelocityGradient=H);const e=(0,L.Lerp)(w._currentLimitVelocity1,w._currentLimitVelocity2,E);w.direction.length()>e&&w.direction.scaleInPlace(o.limitVelocityDamping)}))}function iw(w,o){w.direction.scaleToRef(o._directionScale,o._scaledDirection)}function sw(w,o){o.particleEmitterType.startPositionFunction(o._emitterWorldMatrix,w.position,w,o.isLocal)}function Vw(w,o){o.startPositionFunction(o._emitterWorldMatrix,w.position,w,o.isLocal)}function rw(w,o){w.Kt?w.Kt.t(w.position):w.Kt=w.position.clone(),h.io.TransformCoordinatesToRef(w.Kt,o._emitterWorldMatrix,w.position)}function kw(w,o){o.isLocal&&w.Kt?(w.Kt.addInPlace(o._scaledDirection),h.io.TransformCoordinatesToRef(w.Kt,o._emitterWorldMatrix,w.position)):w.position.addInPlace(o._scaledDirection)}function Pw(w,o){w._currentDragGradient=o._dragGradients[0],w._currentDrag1=w._currentDragGradient.getFactor(),o._dragGradients.length>1?w._currentDrag2=o._dragGradients[1].getFactor():w._currentDrag2=w._currentDrag1}function lw(w,o){F.GetCurrentGradient(o._ratio,o._dragGradients,((H,h,E)=>{H!==w._currentDragGradient&&(w._currentDrag1=w._currentDrag2,w._currentDrag2=h.getFactor(),w._currentDragGradient=H);const e=(0,L.Lerp)(w._currentDrag1,w._currentDrag2,E);o._scaledDirection.scaleInPlace(1-e)}))}function Ow(w,o){w._randomNoiseCoordinates1?(w._randomNoiseCoordinates1.We(Math.random(),Math.random(),Math.random()),w._randomNoiseCoordinates2.We(Math.random(),Math.random(),Math.random())):(w._randomNoiseCoordinates1=new h.io(Math.random(),Math.random(),Math.random()),w._randomNoiseCoordinates2=new h.io(Math.random(),Math.random(),Math.random()))}function Tw(w,o){const H=o._noiseTextureData,E=o._noiseTextureSize;if(H&&E&&w._randomNoiseCoordinates1){const e=o._fetchR(w._randomNoiseCoordinates1.x,w._randomNoiseCoordinates1.y,E.width,E.height,H),D=o._fetchR(w._randomNoiseCoordinates1.z,w._randomNoiseCoordinates2.x,E.width,E.height,H),t=o._fetchR(w._randomNoiseCoordinates2.y,w._randomNoiseCoordinates2.z,E.width,E.height,H),X=h.TmpVectors.io[0],L=h.TmpVectors.io[1];X.We((2*e-1)*o.noiseStrength.x,(2*D-1)*o.noiseStrength.y,(2*t-1)*o.noiseStrength.z),X.scaleToRef(o._tempScaledUpdateSpeed,L),w.direction.addInPlace(L)}}function Sw(w,o){o.gravity.scaleToRef(o._tempScaledUpdateSpeed,o._scaledGravity),w.direction.addInPlace(o._scaledGravity)}function cw(w,o){w.size=(0,L.RandomRange)(o.minSize,o.maxSize),w.scale.We((0,L.RandomRange)(o.minScaleX,o.maxScaleX),(0,L.RandomRange)(o.minScaleY,o.maxScaleY))}function Ww(w,o){w._currentSizeGradient=o._sizeGradients[0],w._currentSize1=w._currentSizeGradient.getFactor(),w.size=w._currentSize1,o._sizeGradients.length>1?w._currentSize2=o._sizeGradients[1].getFactor():w._currentSize2=w._currentSize1,w.scale.We((0,L.RandomRange)(o.minScaleX,o.maxScaleX),(0,L.RandomRange)(o.minScaleY,o.maxScaleY))}function Bw(w,o){const H=o._actualFrame/o.targetStopDuration;F.GetCurrentGradient(H,o._startSizeGradients,((H,h,E)=>{H!==o._currentStartSizeGradient&&(o._currentStartSize1=o._currentStartSize2,o._currentStartSize2=h.getFactor(),o._currentStartSizeGradient=H);const e=(0,L.Lerp)(o._currentStartSize1,o._currentStartSize2,E);w.scale.scaleInPlace(e)}))}function Jw(w,o){F.GetCurrentGradient(o._ratio,o._sizeGradients,((o,H,h)=>{o!==w._currentSizeGradient&&(w._currentSize1=w._currentSize2,w._currentSize2=H.getFactor(),w._currentSizeGradient=o),w.size=(0,L.Lerp)(w._currentSize1,w._currentSize2,h)}))}function gw(w,o){w.remapData=new h.Vector4(0,1,0,1)}function bw(w,o){o._colorRemapGradients&&o._colorRemapGradients.length>0&&F.GetCurrentGradient(o._ratio,o._colorRemapGradients,((o,H,h)=>{const E=(0,L.Lerp)(o.factor1,H.factor1,h),e=(0,L.Lerp)(o.factor2,H.factor2,h);w.remapData.x=E,w.remapData.y=e-E})),o._alphaRemapGradients&&o._alphaRemapGradients.length>0&&F.GetCurrentGradient(o._ratio,o._alphaRemapGradients,((o,H,h)=>{const E=(0,L.Lerp)(o.factor1,H.factor1,h),e=(0,L.Lerp)(o.factor2,H.factor2,h);w.remapData.z=E,w.remapData.w=e-E}))}function pw(w,o){const H=(0,L.Clamp)(o._actualFrame/o.targetStopDuration);F.GetCurrentGradient(H,o._lifeTimeGradients,((o,h)=>{const E=o,e=h,D=E.getFactor(),t=e.getFactor(),X=(H-E.gradient)/(e.gradient-E.gradient);w.lifeTime=(0,L.Lerp)(D,t,X)})),o._emitPower=(0,L.RandomRange)(o.minEmitPower,o.maxEmitPower)}function fw(w,o){w.lifeTime=(0,L.RandomRange)(o.minLifeTime,o.maxLifeTime),o._emitPower=(0,L.RandomRange)(o.minEmitPower,o.maxEmitPower)}function Nw(w,o){0===o._emitPower?(w._initialDirection?w._initialDirection.t(w.direction):w._initialDirection=w.direction.clone(),w.direction.set(0,0,0)):(w._initialDirection=null,w.direction.scaleInPlace(o._emitPower)),w.direction.addInPlace(o._inheritedVelocityOffset)}function jw(w,o){w.angularSpeed=(0,L.RandomRange)(o.minAngularSpeed,o.maxAngularSpeed),w.angle=(0,L.RandomRange)(o.minInitialRotation,o.maxInitialRotation)}function qw(w,o){w._currentAngularSpeedGradient=o._angularSpeedGradients[0],w.angularSpeed=w._currentAngularSpeedGradient.getFactor(),w._currentAngularSpeed1=w.angularSpeed,o._angularSpeedGradients.length>1?w._currentAngularSpeed2=o._angularSpeedGradients[1].getFactor():w._currentAngularSpeed2=w._currentAngularSpeed1,w.angle=(0,L.RandomRange)(o.minInitialRotation,o.maxInitialRotation)}function uw(w,o){w._initialStartSpriteCellId=o.startSpriteCellID,w._initialEndSpriteCellId=o.endSpriteCellID,w._initialSpriteCellLoop=o.spriteCellLoop}function nw(w,o){w.previousItem=o.previousItem,w.nextItem=o,o.previousItem&&(o.previousItem.nextItem=w),o.previousItem=w}function Gw(w,o){w.previousItem=o,w.nextItem=o.nextItem,o.nextItem&&(o.nextItem.previousItem=w),o.nextItem=w}function Rw(w,o){let H=o;for(;H.nextItem;)H=H.nextItem;w.previousItem=H,w.nextItem=H.nextItem,H.nextItem=w}function aw(w){w.previousItem&&(w.previousItem.nextItem=w.nextItem),w.nextItem&&(w.nextItem.previousItem=w.previousItem)}class dw extends X{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(w){this._startDirectionFunction!==w&&(this._startDirectionFunction=w,this._directionProcessing.process=w?yw:Aw)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(w){this._startPositionFunction!==w&&(this._startPositionFunction=w,this._positionCreation.process=w?Vw:sw)}set onDispose(w){this._onDisposeObserver&&this.me.remove(this._onDisposeObserver),this._onDisposeObserver=this.me.add(w)}get A(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(w){this._useRampGradients!==w&&(this._useRampGradients=w,this._resetEffect(),w?(this._rampCreation={process:gw,previousItem:null,nextItem:null},Gw(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:bw,previousItem:null,nextItem:null},Gw(this._remapGradientProcessing,this._gravityProcessing)):(aw(this._rampCreation),aw(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(w){this._isLocal!==w&&(this._isLocal=w,w?(this._isLocalCreation={process:rw,previousItem:null,nextItem:null},Gw(this._isLocalCreation,this._positionCreation)):aw(this._isLocalCreation))}get particles(){return this.Dz}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(w){this._animationSheetEnabled!==w&&(this._animationSheetEnabled=w,w?(this._sheetCreation={process:uw,previousItem:null,nextItem:null},Gw(this._sheetCreation,this._colorCreation)):aw(this._sheetCreation),this._reset())}getActiveCount(){return this.Dz.length}getClassName(){return"Ye"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var w;let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(w=this._customWrappers[o])||void 0===w?void 0:w.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[w]??this._customWrappers[0]}setCustomEffect(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[o]=new ww.e(this._engine),this._customWrappers[o].effect=w,this._customWrappers[o].drawContext&&(this._customWrappers[o].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new v.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(w){if(this.noiseTexture!==w){if(this._noiseTexture=w,!w)return aw(this._noiseCreation),void aw(this._noiseProcessing);this._noiseCreation={process:Ow,previousItem:null,nextItem:null},Gw(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Tw,previousItem:null,nextItem:null},Gw(this._noiseProcessing,this._positionProcessing)}}constructor(w,o,H){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=arguments.length>4&&void 0!==arguments[4]&&arguments[4],t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,X=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(w),this._emitterInverseWorldMatrix=h.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new h.io,this.me=new v.b,this.onStoppedObservable=new v.b,this.onStartedObservable=new v.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.Dz=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new D.ae(0,0,0,0),this._colorDiff=new D.ae(0,0,0,0),this._scaledDirection=h.io.Zero(),this._scaledGravity=h.io.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=w=>{},this.recycleParticle=w=>{const o=this.Dz.pop();o!==w&&o.copyTo(w),this._stockParticles.push(o)},this._createParticle=()=>{let w;return 0!==this._stockParticles.length?(w=this._stockParticles.pop(),w._reset()):w=new x(this),this._prepareParticle(w),w},this.paused=!1,this._shadersLoaded=!1,this._capacity=o,this._epsilon=t,H&&"Scene"!==H.getClassName()?(this._engine=H,this.defaultProjectionMatrix=h.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=H||Y.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ez.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:fw,previousItem:null,nextItem:null},this._positionCreation={process:sw,previousItem:null,nextItem:null},Gw(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Aw,previousItem:null,nextItem:null},Gw(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Nw,previousItem:null,nextItem:null},Gw(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:cw,previousItem:null,nextItem:null},Gw(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:jw,previousItem:null,nextItem:null},Gw(this._angleCreation,this._sizeCreation),this._colorCreation={process:Ew,previousItem:null,nextItem:null},Gw(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,X||(this._colorProcessing={process:tw,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Lw,previousItem:null,nextItem:null},Gw(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:iw,previousItem:null,nextItem:null},Gw(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:kw,previousItem:null,nextItem:null},Gw(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Sw,previousItem:null,nextItem:null},Gw(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=e,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ww.e(this._engine)},this._customWrappers[0].effect=E,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new y,this.updateFunction=w=>{var o;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(o=this.noiseTexture.getContent())||void 0===o||o.then((w=>{this._noiseTextureData=w})));const H=w===this.Dz;for(let h=0;h<w.length;h++){const o=w[h];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const E=o.age;if(o.age+=this._tempScaledUpdateSpeed,o.age>o.lifeTime){const w=o.age-E,H=o.lifeTime-E;this._tempScaledUpdateSpeed=H*this._tempScaledUpdateSpeed/w,o.age=o.lifeTime}this._ratio=o.age/o.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let e=this._updateQueueStart;for(;e;)e.process(o,this),e=e.nextItem;if(this._isAnimationSheetEnabled&&!X&&o.updateCellIndex(),o._inheritParticleInfoToSubEmitters(),o.age>=o.lifeTime){if(this._emitFromParticle(o),o._attachedSubEmitters){for(const w of o._attachedSubEmitters)w.particleSystem.disposeOnStop=!0,w.particleSystem.stop();o._attachedSubEmitters=null}this.recycleParticle(o),H&&h--}else;}}}serialize(w){throw new Error("Method not implemented.")}clone(w,o){throw new Error("Method not implemented.")}_addFactorGradient(w,o,H,h){const E=new K(o,H,h);w.push(E),w.sort(((w,o)=>w.gradient<o.gradient?-1:w.gradient>o.gradient?1:0))}_removeFactorGradient(w,o){if(!w)return;let H=0;for(const h of w){if(h.gradient===o){w.splice(H,1);break}H++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=pw:this._lifeTimeCreation.process=fw}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Bw,previousItem:null,nextItem:null},Gw(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(aw(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(w){this.targetStopDuration!==w&&(this._targetStopDuration=w,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(w,o,H){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,w,o,H),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(w){return this._removeFactorGradient(this._lifeTimeGradients,w),this._syncLifeTimeCreation(),this}addSizeGradient(w,o,H){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Ww,this._sizeGradientProcessing={process:Jw,previousItem:null,nextItem:null},nw(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,w,o,H),this}removeSizeGradient(w){var o;return this._removeFactorGradient(this._sizeGradients,w),0===(null===(o=this._sizeGradients)||void 0===o?void 0:o.length)&&(aw(this._sizeGradientProcessing),this._sizeCreation.process=cw),this}addColorRemapGradient(w,o,H){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,w,o,H),this}removeColorRemapGradient(w){return this._removeFactorGradient(this._colorRemapGradients,w),this}addAlphaRemapGradient(w,o,H){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,w,o,H),this}removeAlphaRemapGradient(w){return this._removeFactorGradient(this._alphaRemapGradients,w),this}addAngularSpeedGradient(w,o,H){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=qw,this._angularSpeedGradientProcessing={process:Xw,previousItem:null,nextItem:null},nw(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,w,o,H),this}removeAngularSpeedGradient(w){var o;return this._removeFactorGradient(this._angularSpeedGradients,w),0===(null===(o=this._angularSpeedGradients)||void 0===o?void 0:o.length)&&(this._angleCreation.process=jw,aw(this._angularSpeedGradientProcessing)),this}addVelocityGradient(w,o,H){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:zw,previousItem:null,nextItem:null},Gw(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Qw,previousItem:null,nextItem:null},nw(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,w,o,H),this}removeVelocityGradient(w){var o;return this._removeFactorGradient(this._velocityGradients,w),0===(null===(o=this._velocityGradients)||void 0===o?void 0:o.length)&&(aw(this._velocityCreation),aw(this._velocityGradientProcessing)),this}addLimitVelocityGradient(w,o,H){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Cw,previousItem:null,nextItem:null},Gw(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Mw,previousItem:null,nextItem:null},Gw(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,w,o,H),this}removeLimitVelocityGradient(w){var o;return this._removeFactorGradient(this._limitVelocityGradients,w),0===(null===(o=this._limitVelocityGradients)||void 0===o?void 0:o.length)&&(aw(this._limitVelocityCreation),aw(this._limitVelocityGradientProcessing)),this}addDragGradient(w,o,H){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Pw,previousItem:null,nextItem:null},nw(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:lw,previousItem:null,nextItem:null},nw(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,w,o,H),this}removeDragGradient(w){var o;return this._removeFactorGradient(this._dragGradients,w),0===(null===(o=this._dragGradients)||void 0===o?void 0:o.length)&&(aw(this._dragCreation),aw(this._dragGradientProcessing)),this}addEmitRateGradient(w,o,H){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,w,o,H),this}removeEmitRateGradient(w){return this._removeFactorGradient(this._emitRateGradients,w),this}addStartSizeGradient(w,o,H){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,w,o,H),this._syncStartSizeCreation(),this}removeStartSizeGradient(w){return this._removeFactorGradient(this._startSizeGradients,w),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const w=new Uint8Array(4*this._rawTextureWidth),o=D.TmpColors.ko[0];for(let H=0;H<this._rawTextureWidth;H++){const h=H/this._rawTextureWidth;F.GetCurrentGradient(h,this._rampGradients,((h,E,e)=>{D.ko.LerpToRef(h.color,E.color,e,o),w[4*H]=255*o.r,w[4*H+1]=255*o.g,w[4*H+2]=255*o.b,w[4*H+3]=255}))}this._rampGradientsTexture=mw.c.CreateRGBATexture(w,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((w,o)=>w.gradient<o.gradient?-1:w.gradient>o.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(w,o){this._rampGradients||(this._rampGradients=[]);const H=new Z(w,o);return this._rampGradients.push(H),this._syncRampGradientTexture(),this}removeRampGradient(w){return this._removeGradientAndTexture(w,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(w,o,H){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=ew,this._colorProcessing.process=Dw);const h=new U(w,o,H);return this._colorGradients.push(h),this._colorGradients.sort(((w,o)=>w.gradient<o.gradient?-1:w.gradient>o.gradient?1:0)),this}removeColorGradient(w){if(!this._colorGradients)return this;let o=0;for(const H of this._colorGradients){if(H.gradient===w){this._colorGradients.splice(o,1);break}o++}return 0===this._colorGradients.length&&(this._colorCreation.process=Ew,this._colorProcessing.process=tw),this}resetDrawCache(){if(this._drawWrappers){for(const w of this._drawWrappers)if(w)for(const o of w)null===o||void 0===o||o.dispose();this._drawWrappers=[]}}_fetchR(w,o,H,h,E){return E[4*(((w=.5*Math.abs(w)+.5)*H%H|0)+((o=.5*Math.abs(o)+.5)*h%h|0)*H)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const w=this._engine,o=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*o),this._vertexBuffer=new P.d(w,this._vertexData,!0,o);let H=0;const h=this._vertexBuffer.createVertexBuffer(P.e.PositionKind,H,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[P.e.PositionKind]=h,H+=3;const E=this._vertexBuffer.createVertexBuffer(P.e.ColorKind,H,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[P.e.ColorKind]=E,H+=4;const e=this._vertexBuffer.createVertexBuffer("angle",H,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=e,H+=1;const D=this._vertexBuffer.createVertexBuffer("size",H,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=D,H+=2,this._isAnimationSheetEnabled){const w=this._vertexBuffer.createVertexBuffer("cellIndex",H,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=w,H+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const w=this._vertexBuffer.createVertexBuffer("direction",H,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=w,H+=3}if(this._useRampGradients){const w=this._vertexBuffer.createVertexBuffer("remapData",H,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=w,H+=4}let t;if(this._useInstancing){const o=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new P.d(w,o,!1,2),t=this._spriteBuffer.createVertexBuffer("offset",0,2)}else t=this._vertexBuffer.createVertexBuffer("offset",H,2,this._vertexBufferSize,this._useInstancing),H+=2;this._vertexBuffers.offset=t,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const w=[],o=[];let H=0;for(let h=0;h<this._capacity;h++)w.push(H),w.push(H+1),w.push(H+2),w.push(H),w.push(H+2),w.push(H+3),o.push(H,H+1,H+1,H+2,H+2,H+3,H+3,H,H,H+3),H+=4;this._indexBuffer=this._engine.createIndexBuffer(w),this._linesIndexBuffer=this._engine.createIndexBuffer(o)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(w)setTimeout((()=>{this.start(0)}),w);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var o;-1!==(null===(o=this.Eo)||void 0===o?void 0:o.getClassName().indexOf("Mesh"))&&this.Eo.se(!0);const w=this.noiseTexture;if(w&&w.onGeneratedObservable)w.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let o=0;o<this.preWarmCycles;o++)this.animate(!0),w.render()}))}));else for(let o=0;o<this.preWarmCycles;o++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(w))}_postStop(w){}reset(){this._stockParticles.length=0,this.Dz.length=0}_appendParticleVertex(w,o,H,E){let e=w*this._vertexBufferSize;if(this._vertexData[e++]=o.position.x+this.ML.x,this._vertexData[e++]=o.position.y+this.ML.y,this._vertexData[e++]=o.position.z+this.ML.z,this._vertexData[e++]=o.color.r,this._vertexData[e++]=o.color.g,this._vertexData[e++]=o.color.b,this._vertexData[e++]=o.color.a,this._vertexData[e++]=o.angle,this._vertexData[e++]=o.scale.x*o.size,this._vertexData[e++]=o.scale.y*o.size,this._isAnimationSheetEnabled&&(this._vertexData[e++]=o.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[e++]=o.direction.x,this._vertexData[e++]=o.direction.y,this._vertexData[e++]=o.direction.z);else if(o._initialDirection){let w=o._initialDirection;this.isLocal&&(h.io.TransformNormalToRef(w,this._emitterWorldMatrix,h.TmpVectors.io[0]),w=h.TmpVectors.io[0]),0===w.x&&0===w.z&&(w.x=.001),this._vertexData[e++]=w.x,this._vertexData[e++]=w.y,this._vertexData[e++]=w.z}else{let w=o.direction;this.isLocal&&(h.io.TransformNormalToRef(w,this._emitterWorldMatrix,h.TmpVectors.io[0]),w=h.TmpVectors.io[0]),0===w.x&&0===w.z&&(w.x=.001),this._vertexData[e++]=w.x,this._vertexData[e++]=w.y,this._vertexData[e++]=w.z}this._useRampGradients&&o.remapData&&(this._vertexData[e++]=o.remapData.x,this._vertexData[e++]=o.remapData.y,this._vertexData[e++]=o.remapData.z,this._vertexData[e++]=o.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===H?H=this._epsilon:1===H&&(H=1-this._epsilon),0===E?E=this._epsilon:1===E&&(E=1-this._epsilon)),this._vertexData[e++]=H,this._vertexData[e++]=E)}_prepareParticle(w){}_createNewOnes(w){let o;for(let H=0;H<w&&this.Dz.length!==this._capacity;H++){o=this._createParticle(),this.Dz.push(o);let w=this._createQueueStart;for(;w;)w.process(o,this),w=w.nextItem;o._inheritParticleInfoToSubEmitters()}}_update(w){if(this._alive=this.Dz.length>0,this.Eo.position){const w=this.Eo;this._emitterWorldMatrix=w.getWorldMatrix()}else{const w=this.Eo;this._emitterWorldMatrix=h.Matrix.Translation(w.x,w.y,w.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Dz),this._createNewOnes(w)}static _GetAttributeNamesOrOptions(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const h=[P.e.PositionKind,P.e.ColorKind,"angle","offset","size"];return w&&h.push("cellIndex"),o||h.push("direction"),H&&h.push("remapData"),h}static _GetEffectCreationOptions(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const h=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,ow.c)(h),w&&h.push("particlesInfos"),o&&h.push("logarithmicDepthConstant"),H&&(h.push("vFogInfos"),h.push("vFogColor")),h}fillDefines(w,o){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,ow.j)(this,this._scene,w),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&w.push("#define FOG")),this._isAnimationSheetEnabled&&w.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&w.push("#define LOGARITHMICDEPTH"),o===X.BLENDMODE_MULTIPLY&&w.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&w.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(w.push("#define BILLBOARD"),this.billboardMode){case 2:w.push("#define BILLBOARDY");break;case 8:case 9:w.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&w.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:w.push("#define BILLBOARDMODE_ALL")}H&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),w.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(w,o,H){o.push(...dw._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),w.push(...dw._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),H.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,hw.i)(w,this._imageProcessingConfigurationDefines),(0,hw.e)(H,this._imageProcessingConfigurationDefines))}_getWrapper(w){const o=this._getCustomDrawWrapper(w);if(null!==o&&void 0!==o&&o.effect)return o;const H=[];this.fillDefines(H,w);const h=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let E=this._drawWrappers[h];E||(E=this._drawWrappers[h]=[]);let e=E[w];e||(e=new ww.e(this._engine),e.drawContext&&(e.drawContext.useInstancing=this._useInstancing),E[w]=e);const D=H.join("\n");if(e.defines!==D){const w=[],o=[],H=[];this.fillUniformsAttributesAndSamplerNames(o,w,H),e.setEffect(this._engine.createEffect("particles",w,o,H,D,void 0,void 0,void 0,void 0,this._shaderLanguage),D)}return e}animate(){var w;let o,H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!H&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(H?this.preWarmStepOffset:(null===(w=this._scene)||void 0===w?void 0:w.getAnimationRatio())||1),this.manualEmitCount>-1)o=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let w=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const o=this._actualFrame/this.targetStopDuration;F.GetCurrentGradient(o,this._emitRateGradients,((o,H,h)=>{o!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=H.getFactor(),this._currentEmitRateGradient=o),w=(0,L.Lerp)(this._currentEmitRate1,this._currentEmitRate2,h)}))}o=w*this._scaledUpdateSpeed|0,this._newPartsExcess+=w*this._scaledUpdateSpeed-o}if(this._newPartsExcess>1&&(o+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?o=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(o),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!H){let w=0;for(let o=0;o<this.Dz.length;o++){const H=this.Dz[o];this._appendParticleVertices(w,H),w+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Dz.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(w,o){this._appendParticleVertex(w++,o,0,0),this._useInstancing||(this._appendParticleVertex(w++,o,1,0),this._appendParticleVertex(w++,o,1,1),this._appendParticleVertex(w++,o,0,1))}rebuild(){var w;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(w=this._spriteBuffer)||void 0===w||w._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!dw.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(H.bind(H,13205)),Promise.resolve().then(H.bind(H,13147))])):await Promise.all([Promise.resolve().then(H.bind(H,13136)),Promise.resolve().then(H.bind(H,13126))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Eo||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==X.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(X.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(X.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(w){const o=this._getWrapper(w),H=o.effect,E=this._engine;E.enableEffect(o);const e=this.defaultViewMatrix??this._scene.getViewMatrix();if(H.setTexture("diffuseSampler",this.particleTexture),H.setMatrix("view",e),H.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const w=this.particleTexture.getBaseSize();H.setFloat3("particlesInfos",this.spriteCellWidth/w.width,this.spriteCellHeight/w.height,this.spriteCellWidth/w.width)}if(H.setVector2("translationPivot",this.translationPivot),H.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const w=this._scene.activeCamera;H.setVector3("eyePosition",w.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),H.setTexture("rampSampler",this._rampGradientsTexture));const D=H.defines;var t,X,L,A,y,z;(this._scene&&((0,ow.e)(H,this,this._scene),this.applyFog&&(0,Hw.f)(this._scene,void 0,H)),D.indexOf("#define BILLBOARDMODE_ALL")>=0&&(e.invertToRef(h.TmpVectors.Matrix[0]),H.setMatrix("invView",h.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?E.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,H):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,H)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?E.bindBuffers(this._vertexBuffers,null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._linesIndexBuffer:this._indexBuffer,H):E.bindBuffers(this._vertexBuffers,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBufferUseInstancing:null,H);(this.useLogarithmicDepth&&this._scene&&(0,Hw.h)(D,H,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(H),this._setEngineBasedOnBlendMode(w),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(H),this._useInstancing)?null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?E.drawElementsType(6,0,10,this.Dz.length):E.drawArraysType(7,0,4,this.Dz.length):null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?E.drawElementsType(1,0,10*this.Dz.length):E.drawElementsType(0,0,6*this.Dz.length);return this.Dz.length}render(){if(!this.isReady()||!this.Dz.length)return 0;const w=this._engine;w.setState&&(w.setState(!1),this.forceDepthWrite&&w.setDepthWrite(!0));let o=0;return o=this.blendMode===X.BLENDMODE_MULTIPLYADD?this._render(X.BLENDMODE_MULTIPLY)+this._render(X.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),o}_onDispose(){}dispose(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),w&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),w&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(o,H),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const w=this._scene.Ez.indexOf(this);w>-1&&this._scene.Ez.splice(w,1),this._scene._activeParticleSystems.dispose()}this.me.notifyObservers(this),this.me.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}dw.ForceGLSL=!1;var Iw,Uw=H(11564);!function(w){w[w.ATTACHED=0]="ATTACHED",w[w.END=1]="END"}(Iw||(Iw={}));class Zw{constructor(w){if(this.particleSystem=w,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!w.Eo||!w.Eo.dispose){const o=(0,t.e)("BABYLON.AbstractMesh");w.Eo=new o("SubemitterSystemEmitter",w.Ow()),w._disposeEmitterOnDispose=!0}}clone(){let w=this.particleSystem.Eo;if(w){if(w instanceof h.io)w=w.clone();else if(-1!==w.getClassName().indexOf("Mesh")){w=new((0,t.e)("BABYLON.Mesh"))("",w.Ow()),w.isVisible=!1}}else w=new h.io;const o=new Zw(this.particleSystem.clone(this.particleSystem.name,w));return o.particleSystem.name+="Clone",o.type=this.type,o.inheritDirection=this.inheritDirection,o.inheritedVelocityAmount=this.inheritedVelocityAmount,o.particleSystem._disposeEmitterOnDispose=!0,o.particleSystem.disposeOnStop=!0,o}serialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const o={};return o.type=this.type,o.inheritDirection=this.inheritDirection,o.inheritedVelocityAmount=this.inheritedVelocityAmount,o.particleSystem=this.particleSystem.serialize(w),o}static _ParseParticleSystem(w,o,H){throw(0,Uw.b)("ParseParticle")}static Parse(w,o,H){const h=w.particleSystem,E=new Zw(Zw._ParseParticleSystem(h,o,H,!0));return E.type=w.type,E.inheritDirection=w.inheritDirection,E.inheritedVelocityAmount=w.inheritedVelocityAmount,E.particleSystem._isSubEmitter=!0,E}dispose(){this.particleSystem.dispose()}}var Kw=H(11615);function Fw(w,o){const H=new s;return H.direction1=w,H.direction2=o,H}function vw(){return new i(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function mo(){return new V(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Yw(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.io(0,1,0),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.io(0,1,0);return new r(w,o,H)}function xw(){return new Q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function wo(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.io(0,1,0),e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new h.io(0,1,0);return new M(w,o,H,E,e)}function oo(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new z(w,o)}function Ho(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.io(0,1,0),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.io(0,1,0);return new C(w,o,H,E)}const ho=h.io.Zero(),Eo=h.io.Zero(),eo=h.io.Zero();class Do{constructor(){this.strength=0,this.position=h.io.Zero()}_processParticle(w,o){this.position.subtractToRef(w.position,ho);const H=ho.lengthSquared()+1;ho.normalize().scaleToRef(this.strength/H,Eo),Eo.scaleToRef(o._tempScaledUpdateSpeed,eo),w.direction.addInPlace(eo)}serialize(){return{position:this.position.Ae(),strength:this.strength}}}class to extends dw{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=w=>{if(!this._subEmitters||0===this._subEmitters.length)return;const o=Math.floor(Math.random()*this._subEmitters.length);for(const H of this._subEmitters[o])if(1===H.type){const o=H.clone();w._inheritParticleInfoToSubEmitter(o),o.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(o.particleSystem),o.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(w,o){const H=Fw(w,o);return this.particleEmitterType=H,H}get flowMap(){return this._flowMap}set flowMap(w){this._flowMap!==w&&(this._flowMap=w,this._flowMapUpdate&&(aw(this._flowMapUpdate),this._flowMapUpdate=null),w&&(this._flowMapUpdate={process:w=>{var o;const H=null===(o=this.Ow())||void 0===o?void 0:o.getTransformMatrix();this._flowMap._processParticle(w,this.flowMapStrength*this._tempScaledUpdateSpeed,H)},previousItem:null,nextItem:null},Gw(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(w){this._attractors.push(w),1===this._attractors.length&&(this._attractorUpdate={process:w=>{for(const o of this._attractors)o._processParticle(w,this)},previousItem:null,nextItem:null},Gw(this._attractorUpdate,this._directionProcessing))}removeAttractor(w){const o=this._attractors.indexOf(w);-1!==o&&this._attractors.splice(o,1),0===this._attractors.length&&aw(this._attractorUpdate)}start(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(w)}createHemisphericEmitter(){const w=vw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=w,w}createSphereEmitter(){const w=mo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=w,w}createDirectedSphereEmitter(){const w=Yw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.io(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.io(0,1,0));return this.particleEmitterType=w,w}createCylinderEmitter(){const w=xw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=w,w}createDirectedCylinderEmitter(){const w=wo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.io(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new h.io(0,1,0));return this.particleEmitterType=w,w}createConeEmitter(){const w=oo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=w,w}createDirectedConeEmitter(){const w=Ho(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.io(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.io(0,1,0));return this.particleEmitterType=w,w}createBoxEmitter(w,o,H,h){const E=new y;return this.particleEmitterType=E,this.direction1=w,this.direction2=o,this.minEmitBox=H,this.maxEmitBox=h,E}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const w of this.subEmitters)w instanceof to?this._subEmitters.push([new Zw(w)]):w instanceof Zw?this._subEmitters.push([w]):w instanceof Array&&this._subEmitters.push(w)}_stopSubEmitters(){if(this.activeSubSystems){for(const w of this.activeSubSystems)w.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const w=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==w&&this._rootParticleSystem.activeSubSystems.splice(w,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(w){w&&this._stopSubEmitters()}_prepareParticle(w){if(this._subEmitters&&this._subEmitters.length>0){const o=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];w._attachedSubEmitters=[];for(const H of o)if(0===H.type){const o=H.clone();w._attachedSubEmitters.push(o),o.particleSystem.start()}}}_onDispose(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),w&&this.particles)for(const H of this.particles)if(H._attachedSubEmitters)for(let w=H._attachedSubEmitters.length-1;w>=0;w-=1)H._attachedSubEmitters[w].dispose();if(o&&this.activeSubSystems)for(let H=this.activeSubSystems.length-1;H>=0;H-=1)this.activeSubSystems[H].dispose();if(this._subEmitters&&this._subEmitters.length){for(let w=0;w<this._subEmitters.length;w++)for(const o of this._subEmitters[w])o.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Eo&&this.Eo.dispose&&this.Eo.dispose(!0)}static _Parse(w,o,H,E){let e;e=H instanceof Kw.c?null:H;const X=(0,t.e)("BABYLON.Texture");if(X&&e&&(w.texture?o.particleTexture=X.Parse(w.texture,e,E):w.textureName&&(o.particleTexture=new X(E+w.textureName,e,!1,void 0===w.invertY||w.invertY),o.particleTexture.name=w.textureName)),w.emitterId||0===w.emitterId||void 0!==w.Eo?w.emitterId&&e?o.Eo=e.getLastMeshById(w.emitterId):o.Eo=h.io.Po(w.Eo):o.Eo=h.io.Zero(),o.isLocal=!!w.isLocal,void 0!==w.renderingGroupId&&(o.renderingGroupId=w.renderingGroupId),void 0!==w.isBillboardBased&&(o.isBillboardBased=w.isBillboardBased),void 0!==w.billboardMode&&(o.billboardMode=w.billboardMode),void 0!==w.useLogarithmicDepth&&(o.useLogarithmicDepth=w.useLogarithmicDepth),w.animations){for(let H=0;H<w.animations.length;H++){const h=w.animations[H],E=(0,t.e)("BABYLON.Animation");E&&o.animations.push(E.Parse(h))}o.beginAnimationOnStart=w.beginAnimationOnStart,o.beginAnimationFrom=w.beginAnimationFrom,o.beginAnimationTo=w.beginAnimationTo,o.beginAnimationLoop=w.beginAnimationLoop}if(w.autoAnimate&&e&&e.beginAnimation(o,w.autoAnimateFrom,w.autoAnimateTo,w.autoAnimateLoop,w.autoAnimateSpeed||1),o.startDelay=0|w.startDelay,o.minAngularSpeed=w.minAngularSpeed,o.maxAngularSpeed=w.maxAngularSpeed,o.minSize=w.minSize,o.maxSize=w.maxSize,w.minScaleX&&(o.minScaleX=w.minScaleX,o.maxScaleX=w.maxScaleX,o.minScaleY=w.minScaleY,o.maxScaleY=w.maxScaleY),void 0!==w.preWarmCycles&&(o.preWarmCycles=w.preWarmCycles,o.preWarmStepOffset=w.preWarmStepOffset),void 0!==w.minInitialRotation&&(o.minInitialRotation=w.minInitialRotation,o.maxInitialRotation=w.maxInitialRotation),o.minLifeTime=w.minLifeTime,o.maxLifeTime=w.maxLifeTime,o.minEmitPower=w.minEmitPower,o.maxEmitPower=w.maxEmitPower,o.emitRate=w.emitRate,o.gravity=h.io.Po(w.gravity),w.noiseStrength&&(o.noiseStrength=h.io.Po(w.noiseStrength)),o.color1=D.ae.Po(w.color1),o.color2=D.ae.Po(w.color2),o.colorDead=D.ae.Po(w.colorDead),o.updateSpeed=w.updateSpeed,o.targetStopDuration=w.targetStopDuration,o.blendMode=w.blendMode,w.colorGradients)for(const h of w.colorGradients)o.addColorGradient(h.gradient,D.ae.Po(h.color1),h.color2?D.ae.Po(h.color2):void 0);if(w.rampGradients){for(const H of w.rampGradients)o.addRampGradient(H.gradient,D.ko.Po(H.color));o.useRampGradients=w.useRampGradients}if(w.colorRemapGradients)for(const h of w.colorRemapGradients)o.addColorRemapGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(w.alphaRemapGradients)for(const h of w.alphaRemapGradients)o.addAlphaRemapGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(w.sizeGradients)for(const h of w.sizeGradients)o.addSizeGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(w.angularSpeedGradients)for(const h of w.angularSpeedGradients)o.addAngularSpeedGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(w.velocityGradients)for(const h of w.velocityGradients)o.addVelocityGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(w.dragGradients)for(const h of w.dragGradients)o.addDragGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(w.emitRateGradients)for(const h of w.emitRateGradients)o.addEmitRateGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(w.startSizeGradients)for(const h of w.startSizeGradients)o.addStartSizeGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(w.lifeTimeGradients)for(const h of w.lifeTimeGradients)o.addLifeTimeGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);if(w.limitVelocityGradients){for(const H of w.limitVelocityGradients)o.addLimitVelocityGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);o.limitVelocityDamping=w.limitVelocityDamping}if(w.noiseTexture&&e){const H=(0,t.e)("BABYLON.ProceduralTexture");o.noiseTexture=H.Parse(w.noiseTexture,e,E)}let L;if(w.particleEmitterType){switch(w.particleEmitterType.type){case"SphereParticleEmitter":L=new V;break;case"SphereDirectedParticleEmitter":L=new r;break;case"ConeEmitter":case"ConeParticleEmitter":L=new z;break;case"ConeDirectedParticleEmitter":L=new C;break;case"CylinderParticleEmitter":L=new Q;break;case"CylinderDirectedParticleEmitter":L=new M;break;case"HemisphericParticleEmitter":L=new i;break;case"PointParticleEmitter":L=new s;break;case"MeshParticleEmitter":L=new l;break;case"CustomParticleEmitter":L=new k;break;default:L=new y}L.parse(w.particleEmitterType,e)}else L=new y,L.parse(w,e);o.particleEmitterType=L,o.startSpriteCellID=w.startSpriteCellID,o.endSpriteCellID=w.endSpriteCellID,o.spriteCellLoop=w.spriteCellLoop??!0,o.spriteCellWidth=w.spriteCellWidth,o.spriteCellHeight=w.spriteCellHeight,o.spriteCellChangeSpeed=w.spriteCellChangeSpeed,o.spriteRandomStartCell=w.spriteRandomStartCell,o.disposeOnStop=w.disposeOnStop??!1,o.manualEmitCount=w.manualEmitCount??-1}static Parse(w,o,H){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],e=arguments.length>4?arguments[4]:void 0;const t=w.name;let X,L,A=null,y=null;if(o instanceof Kw.c?X=o:(L=o,X=L.getEngine()),w.customShader&&X.createEffectForParticles){y=w.customShader;const o=y.shaderOptions.defines.length>0?y.shaderOptions.defines.join("\n"):"";A=X.createEffectForParticles(y.shaderPath.fragmentElement,y.shaderOptions.uniforms,y.shaderOptions.samplers,o)}const z=new to(t,e||w.no,o,A,w.isAnimationSheetEnabled);if(z.customShader=y,z._rootUrl=H,w.id&&(z.id=w.id),w.subEmitters){z.subEmitters=[];for(const h of w.subEmitters){const w=[];for(const E of h)w.push(Zw.Parse(E,o,H));z.subEmitters.push(w)}}if(w.attractors)for(const D of w.attractors){const w=new Do;w.position=h.io.Po(D.position),w.strength=D.strength,z.addAttractor(w)}return to._Parse(w,z,o,H),w.textureMask&&(z.textureMask=D.ae.Po(w.textureMask)),w.ML&&(z.ML=h.io.Po(w.ML)),w.preventAutoStart&&(z.preventAutoStart=w.preventAutoStart),E||z.preventAutoStart||z.start(),z}serialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const o={};if(to._Serialize(o,this,w),o.textureMask=this.textureMask.Ae(),o.customShader=this.customShader,o.preventAutoStart=this.preventAutoStart,o.ML=this.ML.Ae(),this.subEmitters){o.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const H of this._subEmitters){const h=[];for(const o of H)h.push(o.serialize(w));o.subEmitters.push(h)}}if(this._attractors&&this._attractors.length){o.attractors=[];for(const w of this._attractors)o.attractors.push(w.serialize())}return o}static _Serialize(w,o,H){if(w.name=o.name,w.id=o.id,w.no=o.getCapacity(),w.disposeOnStop=o.disposeOnStop,w.manualEmitCount=o.manualEmitCount,o.Eo.position){const H=o.Eo;w.emitterId=H.id}else{const H=o.Eo;w.Eo=H.Ae()}o.particleEmitterType&&(w.particleEmitterType=o.particleEmitterType.serialize()),o.particleTexture&&(H?w.texture=o.particleTexture.serialize():(w.textureName=o.particleTexture.name,w.invertY=!!o.particleTexture._invertY)),w.isLocal=o.isLocal,p.e.AppendSerializedAnimations(o,w),w.beginAnimationOnStart=o.beginAnimationOnStart,w.beginAnimationFrom=o.beginAnimationFrom,w.beginAnimationTo=o.beginAnimationTo,w.beginAnimationLoop=o.beginAnimationLoop,w.startDelay=o.startDelay,w.renderingGroupId=o.renderingGroupId,w.isBillboardBased=o.isBillboardBased,w.billboardMode=o.billboardMode,w.minAngularSpeed=o.minAngularSpeed,w.maxAngularSpeed=o.maxAngularSpeed,w.minSize=o.minSize,w.maxSize=o.maxSize,w.minScaleX=o.minScaleX,w.maxScaleX=o.maxScaleX,w.minScaleY=o.minScaleY,w.maxScaleY=o.maxScaleY,w.minEmitPower=o.minEmitPower,w.maxEmitPower=o.maxEmitPower,w.minLifeTime=o.minLifeTime,w.maxLifeTime=o.maxLifeTime,w.emitRate=o.emitRate,w.gravity=o.gravity.Ae(),w.noiseStrength=o.noiseStrength.Ae(),w.color1=o.color1.Ae(),w.color2=o.color2.Ae(),w.colorDead=o.colorDead.Ae(),w.updateSpeed=o.updateSpeed,w.targetStopDuration=o.targetStopDuration,w.blendMode=o.blendMode,w.preWarmCycles=o.preWarmCycles,w.preWarmStepOffset=o.preWarmStepOffset,w.minInitialRotation=o.minInitialRotation,w.maxInitialRotation=o.maxInitialRotation,w.startSpriteCellID=o.startSpriteCellID,w.spriteCellLoop=o.spriteCellLoop,w.endSpriteCellID=o.endSpriteCellID,w.spriteCellChangeSpeed=o.spriteCellChangeSpeed,w.spriteCellWidth=o.spriteCellWidth,w.spriteCellHeight=o.spriteCellHeight,w.spriteRandomStartCell=o.spriteRandomStartCell,w.isAnimationSheetEnabled=o.isAnimationSheetEnabled,w.useLogarithmicDepth=o.useLogarithmicDepth;const h=o.getColorGradients();if(h){w.colorGradients=[];for(const o of h){const H={gradient:o.gradient,color1:o.color1.Ae()};o.color2?H.color2=o.color2.Ae():H.color2=o.color1.Ae(),w.colorGradients.push(H)}}const E=o.getRampGradients();if(E){w.rampGradients=[];for(const o of E){const H={gradient:o.gradient,color:o.color.Ae()};w.rampGradients.push(H)}w.useRampGradients=o.useRampGradients}const e=o.getColorRemapGradients();if(e){w.colorRemapGradients=[];for(const o of e){const H={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?H.factor2=o.factor2:H.factor2=o.factor1,w.colorRemapGradients.push(H)}}const D=o.getAlphaRemapGradients();if(D){w.alphaRemapGradients=[];for(const o of D){const H={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?H.factor2=o.factor2:H.factor2=o.factor1,w.alphaRemapGradients.push(H)}}const t=o.getSizeGradients();if(t){w.sizeGradients=[];for(const o of t){const H={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?H.factor2=o.factor2:H.factor2=o.factor1,w.sizeGradients.push(H)}}const X=o.getAngularSpeedGradients();if(X){w.angularSpeedGradients=[];for(const o of X){const H={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?H.factor2=o.factor2:H.factor2=o.factor1,w.angularSpeedGradients.push(H)}}const L=o.getVelocityGradients();if(L){w.velocityGradients=[];for(const o of L){const H={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?H.factor2=o.factor2:H.factor2=o.factor1,w.velocityGradients.push(H)}}const A=o.getDragGradients();if(A){w.dragGradients=[];for(const o of A){const H={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?H.factor2=o.factor2:H.factor2=o.factor1,w.dragGradients.push(H)}}const y=o.getEmitRateGradients();if(y){w.emitRateGradients=[];for(const o of y){const H={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?H.factor2=o.factor2:H.factor2=o.factor1,w.emitRateGradients.push(H)}}const z=o.getStartSizeGradients();if(z){w.startSizeGradients=[];for(const o of z){const H={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?H.factor2=o.factor2:H.factor2=o.factor1,w.startSizeGradients.push(H)}}const C=o.getLifeTimeGradients();if(C){w.lifeTimeGradients=[];for(const o of C){const H={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?H.factor2=o.factor2:H.factor2=o.factor1,w.lifeTimeGradients.push(H)}}const Q=o.getLimitVelocityGradients();if(Q){w.limitVelocityGradients=[];for(const o of Q){const H={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?H.factor2=o.factor2:H.factor2=o.factor1,w.limitVelocityGradients.push(H)}w.limitVelocityDamping=o.limitVelocityDamping}o.noiseTexture&&(w.noiseTexture=o.noiseTexture.serialize())}clone(w,o){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const h={...this._customWrappers};let E=null;const e=this._engine;if(e.createEffectForParticles&&null!=this.customShader){E=this.customShader;const w=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"",o=e.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,w);h[0]?h[0].effect=o:this.setCustomEffect(o,0)}const D=this.serialize(H),t=to.Parse(D,this._scene||this._engine,this._rootUrl);return t.name=w,t.customShader=E,t._customWrappers=h,void 0===o&&(o=this.Eo),this.noiseTexture&&(t.noiseTexture=this.noiseTexture.clone()),t.Eo=o,this.preventAutoStart||t.start(),t}}to.BILLBOARDMODE_Y=2,to.BILLBOARDMODE_ALL=7,to.BILLBOARDMODE_STRETCHED=8,to.BILLBOARDMODE_STRETCHED_LOCAL=9,Zw._ParseParticleSystem=to.Parse;var Xo=H(11964),Lo=H(11957),Ao=H(11837);Ao.e.prototype.createTransformFeedback=function(){const w=this._gl.createTransformFeedback();if(!w)throw new Error("Unable to create Transform Feedback");return w},Ao.e.prototype.deleteTransformFeedback=function(w){this._gl.deleteTransformFeedback(w)},Ao.e.prototype.bindTransformFeedback=function(w){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,w)},Ao.e.prototype.beginTransformFeedback=function(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(w?this._gl.POINTS:this._gl.TRIANGLES)},Ao.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Ao.e.prototype.setTranformFeedbackVaryings=function(w,o){this._gl.transformFeedbackVaryings(w,o,this._gl.INTERLEAVED_ATTRIBS)},Ao.e.prototype.bindTransformFeedbackBuffer=function(w){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,w?w.underlyingResource:null)},Ao.e.prototype.readTransformFeedbackBuffer=function(w){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,w)};const yo="clipPlaneFragmentDeclaration2",zo="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";T.d.IncludesShadersStore[yo]||(T.d.IncludesShadersStore[yo]=zo);H(13034),H(13037),H(13040),H(13042),H(13050),H(13056),H(13063),H(13066);const Co="gpuRenderParticlesPixelShader",Qo="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";T.d.ShadersStore[Co]||(T.d.ShadersStore[Co]=Qo);const Mo="clipPlaneVertexDeclaration2",io="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";T.d.IncludesShadersStore[Mo]||(T.d.IncludesShadersStore[Mo]=io);H(13075),H(13084),H(13093),H(13101);const so="gpuRenderParticlesVertexShader",Vo="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";T.d.ShadersStore[so]||(T.d.ShadersStore[so]=Vo);class ro extends X{static get IsSupported(){if(!Y.e.LastCreatedEngine)return!1;const w=Y.e.LastCreatedEngine.getCaps();return w.supportTransformFeedbacks||w.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(w){this._maxActiveParticleCount=Math.min(w,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(w){this.maxActiveParticleCount=w}createPointEmitter(w,o){const H=Fw(w,o);return this.particleEmitterType=H,H}createHemisphericEmitter(){const w=vw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=w,w}createSphereEmitter(){const w=mo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=w,w}createDirectedSphereEmitter(){const w=Yw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.io(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.io(0,1,0));return this.particleEmitterType=w,w}createCylinderEmitter(){const w=xw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=w,w}createDirectedCylinderEmitter(){const w=wo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.io(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new h.io(0,1,0));return this.particleEmitterType=w,w}createConeEmitter(){const w=oo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=w,w}createDirectedConeEmitter(){const w=Ho(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h.io(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h.io(0,1,0));return this.particleEmitterType=w,w}createBoxEmitter(w,o,H,h){const E=new y;return this.particleEmitterType=E,this.direction1=w,this.direction2=o,this.minEmitBox=H,this.maxEmitBox=h,E}get flowMap(){return this._flowMap}set flowMap(w){this._flowMap!==w&&(this._flowMap=w)}isReady(){if(!this.Eo||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==to.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(to.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(to.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";w?setTimeout((()=>{this.start(0)}),w):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var w;let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(w=this._customWrappers[o])||void 0===w?void 0:w.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[w]??this._customWrappers[0]}setCustomEffect(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[o]=new ww.e(this._engine),this._customWrappers[o].effect=w}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new v.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(w,o,H){return super._removeGradientAndTexture(w,o,H),this._releaseBuffers(),this}addColorGradient(w,o){this._colorGradients||(this._colorGradients=[]);const H=new U(w,o);return this._colorGradients.push(H),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(w&&this._colorGradients.sort(((w,o)=>w.gradient<o.gradient?-1:w.gradient>o.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(w){return this._removeGradientAndTexture(w,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const o in this._drawWrappers){var w;null===(w=this._drawWrappers[o].drawContext)||void 0===w||w.reset()}}_addFactorGradient(w,o,H){const h=new K(o,H);w.push(h),this._releaseBuffers()}addSizeGradient(w,o){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,w,o),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(w){return this._removeGradientAndTexture(w,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(w,o){if(!w)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&w.sort(((w,o)=>w.gradient<o.gradient?-1:w.gradient>o.gradient?1:0));const H=this;H[o]&&(H[o].dispose(),H[o]=null)}addAngularSpeedGradient(w,o){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,w,o),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(w){return this._removeGradientAndTexture(w,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(w,o){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,w,o),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(w){return this._removeGradientAndTexture(w,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(w,o){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,w,o),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(w){return this._removeGradientAndTexture(w,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(w,o){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,w,o),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(w){return this._removeGradientAndTexture(w,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(w){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(w,o,H){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(w),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.me=new v.b,this.onStoppedObservable=new v.b,this.onStartedObservable=new v.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,H&&"Scene"!==H.getClassName()?(this._engine=H,this.defaultProjectionMatrix=h.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=H||Y.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ez.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,t.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,t.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,t.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,t.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ww.e(this._engine)},this._customWrappers[0].effect=E,this._drawWrappers={0:new ww.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(o=o??{}).randomTextureSize||delete o.randomTextureSize;const D={no:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...o},X=o;isFinite(X)&&(D.no=X),this._capacity=D.no,this._maxActiveParticleCount=D.no,this._currentActiveCount=0,this._isAnimationSheetEnabled=e,this.particleEmitterType=new y;const L=Math.min(this._engine.getCaps().maxTextureSize,D.randomTextureSize);let A=[];for(let h=0;h<L;++h)A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random());this._randomTexture=new mw.c(new Float32Array(A),L,1,5,H,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,A=[];for(let h=0;h<L;++h)A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random());this._randomTexture2=new mw.c(new Float32Array(A),L,1,5,H,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=L}_reset(){this._releaseBuffers()}_createVertexBuffers(w,o,H){const h={};h.position=o.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let E=3;h.age=o.createVertexBuffer("age",E,1,this._attributesStrideSize,!0),E+=1,h.size=o.createVertexBuffer("size",E,3,this._attributesStrideSize,!0),E+=3,h.life=o.createVertexBuffer("life",E,1,this._attributesStrideSize,!0),E+=1,E+=4,this.billboardMode===to.BILLBOARDMODE_STRETCHED&&(h.direction=o.createVertexBuffer("direction",E,3,this._attributesStrideSize,!0)),E+=3,this._platform.alignDataInBuffer&&(E+=1),this.particleEmitterType instanceof k&&(E+=3,this._platform.alignDataInBuffer&&(E+=1)),this._colorGradientsTexture||(h.color=o.createVertexBuffer("color",E,4,this._attributesStrideSize,!0),E+=4),this._isBillboardBased||(h.initialDirection=o.createVertexBuffer("initialDirection",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1)),this.noiseTexture&&(h.noiseCoordinates1=o.createVertexBuffer("noiseCoordinates1",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1),h.noiseCoordinates2=o.createVertexBuffer("noiseCoordinates2",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1)),h.angle=o.createVertexBuffer("angle",E,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?E++:E+=2,this._isAnimationSheetEnabled&&(h.cellIndex=o.createVertexBuffer("cellIndex",E,1,this._attributesStrideSize,!0),E+=1,this.spriteRandomStartCell&&(h.cellStartOffset=o.createVertexBuffer("cellStartOffset",E,1,this._attributesStrideSize,!0),E+=1)),h.offset=H.createVertexBuffer("offset",0,2),h.uv=H.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(h),this._platform.createVertexBuffers(w,h),this.resetDrawCache()}_initialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!w)return;const o=this._engine,H=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof k&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const E=this.particleEmitterType instanceof k,e=h.TmpVectors.io[0];let D=0;for(let h=0;h<this._capacity;h++)if(H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),E?(this.particleEmitterType.particleDestinationGenerator(h,null,e),H.push(e.x),H.push(e.y),H.push(e.z)):(H.push(0),H.push(0),H.push(0)),this._platform.alignDataInBuffer&&H.push(0),D+=16,E&&(this.particleEmitterType.particlePositionGenerator(h,null,e),H.push(e.x),H.push(e.y),H.push(e.z),this._platform.alignDataInBuffer&&H.push(0),D+=4),this._colorGradientsTexture||(H.push(0),H.push(0),H.push(0),H.push(0),D+=4),this.isBillboardBased||(H.push(0),H.push(0),H.push(0),this._platform.alignDataInBuffer&&H.push(0),D+=4),this.noiseTexture&&(H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),this._platform.alignDataInBuffer&&H.push(0),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),this._platform.alignDataInBuffer&&H.push(0),D+=8),H.push(0),D+=1,this._angularSpeedGradientsTexture||(H.push(0),D+=1),this._isAnimationSheetEnabled&&(H.push(0),D+=1,this.spriteRandomStartCell&&(H.push(0),D+=1)),this._platform.alignDataInBuffer){let w=3-(D+3&3);for(D+=w;w-- >0;)H.push(0)}const t=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),X=this._platform.createParticleBuffer(H),L=this._platform.createParticleBuffer(H);this._buffer0=new P.d(o,X,!1,this._attributesStrideSize),this._buffer1=new P.d(o,L,!1,this._attributesStrideSize),this._spriteBuffer=new P.d(o,t,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let w=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(w+="\n#define BILLBOARD"),this._colorGradientsTexture&&(w+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(w+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(w+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(w+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(w+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(w+="\n#define DRAGGRADIENTS"),this._flowMap&&(w+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(w+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(w+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(w+="\n#define NOISE"),this.isLocal&&(w+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===w||(this._cachedUpdateDefines=w,this._updateBuffer=this._platform.createUpdateBuffer(w)),this._platform.isUpdateBufferReady()}_getWrapper(w){const o=this._getCustomDrawWrapper(w);if(null!==o&&void 0!==o&&o.effect)return o;const H=[];this.fillDefines(H,w);let h=this._drawWrappers[w];h||(h=new ww.e(this._engine),h.drawContext&&(h.drawContext.useInstancing=!0),this._drawWrappers[w]=h);const E=H.join("\n");if(h.defines!==E){const w=[],o=[],H=[];this.fillUniformsAttributesAndSamplerNames(o,w,H),h.setEffect(this._engine.createEffect("gpuRenderParticles",w,o,H,E),E)}return h}static _GetAttributeNamesOrOptions(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=[P.e.PositionKind,"age","life","size","angle"];return w||E.push(P.e.ColorKind),o&&E.push("cellIndex"),H||E.push("initialDirection"),h&&E.push("direction"),E.push("offset",P.e.UVKind),E}static _GetEffectCreationOptions(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const h=["emitterWM","ML","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,ow.c)(h),w&&h.push("sheetInfos"),o&&h.push("logarithmicDepthConstant"),H&&(h.push("vFogInfos"),h.push("vFogColor")),h}fillDefines(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,ow.j)(this,this._scene,w),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Lo.e.FOGMODE_NONE&&w.push("#define FOG")),o===to.BLENDMODE_MULTIPLY&&w.push("#define BLENDMULTIPLYMODE"),this.isLocal&&w.push("#define LOCAL"),this.useLogarithmicDepth&&w.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(w.push("#define BILLBOARD"),this.billboardMode){case to.BILLBOARDMODE_Y:w.push("#define BILLBOARDY");break;case to.BILLBOARDMODE_STRETCHED:w.push("#define BILLBOARDSTRETCHED");break;case to.BILLBOARDMODE_ALL:w.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&w.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&w.push("#define ANIMATESHEET"),H&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),w.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(w,o,H){o.push(...ro._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===to.BILLBOARDMODE_STRETCHED)),w.push(...ro._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),H.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Xo.c.PrepareUniforms(w,this._imageProcessingConfigurationDefines),Xo.c.PrepareSamplers(H,this._imageProcessingConfigurationDefines))}animate(){var w;let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(o?this.preWarmStepOffset:(null===(w=this._scene)||void 0===w?void 0:w.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(w,o){const H=this[o];if(!w||!w.length||H)return;const h=new Float32Array(this._rawTextureWidth);for(let E=0;E<this._rawTextureWidth;E++){const o=E/this._rawTextureWidth;F.GetCurrentGradient(o,w,((w,o,H)=>{h[E]=(0,L.Lerp)(w.factor1,o.factor1,H)}))}this[o]=mw.c.CreateRTexture(h,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[o].name=o.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const w=new Uint8Array(4*this._rawTextureWidth),o=D.TmpColors.ae[0];for(let H=0;H<this._rawTextureWidth;H++){const h=H/this._rawTextureWidth;F.GetCurrentGradient(h,this._colorGradients,((h,E,e)=>{D.ae.LerpToRef(h.color1,E.color1,e,o),w[4*H]=255*o.r,w[4*H+1]=255*o.g,w[4*H+2]=255*o.b,w[4*H+3]=255*o.a}))}this._colorGradientsTexture=mw.c.CreateRGBATexture(w,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(w,o){var H,E,e,D;const t=this._getWrapper(w),X=t.effect;this._engine.enableEffect(t);const L=(null===(H=this._scene)||void 0===H?void 0:H.getViewMatrix())||h.Matrix.IdentityReadOnly;if(X.setMatrix("view",L),X.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),X.setTexture("diffuseSampler",this.particleTexture),X.setVector2("translationPivot",this.translationPivot),X.setVector3("ML",this.ML),this.isLocal&&X.setMatrix("emitterWM",o),this._colorGradientsTexture?X.setTexture("colorGradientSampler",this._colorGradientsTexture):X.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const w=this.particleTexture.getBaseSize();X.setFloat3("sheetInfos",this.spriteCellWidth/w.width,this.spriteCellHeight/w.height,w.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const w=this._scene.activeCamera;X.setVector3("eyePosition",w.globalPosition)}const A=X.defines;if(this._scene&&((0,ow.e)(X,this,this._scene),this.applyFog&&(0,Hw.f)(this._scene,void 0,X)),A.indexOf("#define BILLBOARDMODE_ALL")>=0){const w=L.clone();w.invert(),X.setMatrix("invView",w)}return this.useLogarithmicDepth&&this._scene&&(0,Hw.h)(A,X,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(X),this._setEngineBasedOnBlendMode(w),this._platform.bindDrawBuffers(this._targetIndex,X,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(X),null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(D=this._scene)&&void 0!==D&&D.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(w){if(!this.Eo||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!w)if(this.Eo.position){w=this.Eo.getWorldMatrix()}else{const o=this.Eo;w=h.TmpVectors.Matrix[0],h.Matrix.TranslationToRef(o.x,o.y,o.z,w)}const o=this._engine,H=o.getDepthWrite();if(o.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const w=this.Ow();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",w.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",w),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const E=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=E,o.setDepthWrite(H)}render(){let w,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!o&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let w=0;w<this.preWarmCycles;w++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const w=0|this._accumulatedCount;this._accumulatedCount-=w,this._currentActiveCount+=w}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Eo.position){w=this.Eo.getWorldMatrix()}else{const o=this.Eo;w=h.TmpVectors.Matrix[0],h.Matrix.TranslationToRef(o.x,o.y,o.z,w)}const E=this._engine;this.updateInAnimate||this._update(w);let e=0;return o||H||(E.setState(!1),this.forceDepthWrite&&E.setDepthWrite(!0),e=this.blendMode===to.BLENDMODE_MULTIPLYADD?this._render(to.BLENDMODE_MULTIPLY,w)+this._render(to.BLENDMODE_ADD,w):this._render(this.blendMode,w),this._engine.setAlphaMode(0)),e}rebuild(){const w=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(w,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,w()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const o in this._drawWrappers){this._drawWrappers[o].dispose()}if(this._drawWrappers={},this._scene){const w=this._scene.Ez.indexOf(this);w>-1&&this._scene.Ez.splice(w,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let o=0;o<this._renderVertexBuffers.length;++o){const w=this._renderVertexBuffers[o];for(const o in w)w[o].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),w&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),w&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.me.notifyObservers(this),this.me.clear()}clone(w,o){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const h={...this._customWrappers};let E=null;const e=this._engine;if(e.createEffectForParticles&&null!=this.customShader){E=this.customShader;const w=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"";h[0]=e.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,w,void 0,void 0,void 0,this)}const D=this.serialize(H),t=ro.Parse(D,this._scene||this._engine,this._rootUrl);return t.name=w,t.customShader=E,t._customWrappers=h,void 0===o&&(o=this.Eo),this.noiseTexture&&(t.noiseTexture=this.noiseTexture.clone()),t.Eo=o,t}serialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const o={};return to._Serialize(o,this,w),o.activeParticleCount=this.activeParticleCount,o.randomTextureSize=this._randomTextureSize,o.customShader=this.customShader,o}static Parse(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0;const e=w.name;let D,t;o instanceof Kw.c?D=o:(t=o,D=t.getEngine());const X=new ro(e,{no:E||w.no,randomTextureSize:w.randomTextureSize},o,null,w.isAnimationSheetEnabled);if(X._rootUrl=H,w.customShader&&D.createEffectForParticles){const o=w.customShader,H=o.shaderOptions.defines.length>0?o.shaderOptions.defines.join("\n"):"",h=D.createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,H,void 0,void 0,void 0,X);X.setCustomEffect(h,0),X.customShader=o}return w.id&&(X.id=w.id),w.activeParticleCount&&(X.activeParticleCount=w.activeParticleCount),to._Parse(w,X,o,H),w.preventAutoStart&&(X.preventAutoStart=w.preventAutoStart),h||X.preventAutoStart||X.start(),X}}var ko=H(11531),Po=H(13110),lo=H(12081);class Oo{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(w){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const o of this.systems)o.Eo=w;this._emitterNode=w}setEmitterAsSphere(w,o,H){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:w,renderingGroupId:o};const h=(0,Po.e)("emitterSphere",{diameter:w.diameter,segments:w.segments},H);h.renderingGroupId=o;const E=new lo.ro("emitterSphereMaterial",H);E.emissiveColor=w.color,h.material=E;for(const e of this.systems)e.Eo=h;this._emitterNode=h}start(w){for(const o of this.systems)w&&(o.Eo=w),o.start()}dispose(){for(const w of this.systems)w.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const o={systems:[]};for(const H of this.systems)o.systems.push(H.serialize(w));return this._emitterNode&&(o.Eo=this._emitterCreationOptions),o}static Parse(w,o){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3?arguments[3]:void 0;const E=new Oo,e=this.BaseAssetsUrl+"/textures/";o=o||Y.e.LastCreatedScene;for(const D of w.systems)E.systems.push(H?ro.Parse(D,o,e,!0,h):to.Parse(D,o,e,!0,h));if(w.Eo){const H=w.Eo.options;if("Sphere"===w.Eo.kind)E.setEmitterAsSphere({diameter:H.diameter,segments:H.segments,color:D.ko.Po(H.color)},w.Eo.renderingGroupId,o)}return E}}Oo.BaseAssetsUrl="https://assets.babylonjs.com/particles";var To=H(11566);class So{static CreateDefault(w){let o,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,h=arguments.length>2?arguments[2]:void 0;o=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ro("default system",{no:H},h):new to("default system",H,h),o.Eo=w;const E=ko.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return o.particleTexture=new f.d(E,o.Ow()),o.createConeEmitter(.1,Math.PI/4),o.color1=new D.ae(1,1,1,1),o.color2=new D.ae(1,1,1,1),o.colorDead=new D.ae(1,1,1,0),o.minSize=.1,o.maxSize=.1,o.minEmitPower=2,o.maxEmitPower=2,o.updateSpeed=1/60,o.emitRate=30,o}static CreateAsync(w,o){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3?arguments[3]:void 0;o||(o=Y.e.LastCreatedScene);const E={};return o.addPendingData(E),new Promise(((e,D)=>{if(H&&!ro.IsSupported)return o.removePendingData(E),D("Particle system with GPU is not supported.");ko.Tools.LoadFile(`${So.BaseAssetsUrl}/systems/${w}.json`,(w=>{o.removePendingData(E);const D=JSON.parse(w.toString());return e(Oo.Parse(D,o,H,h))}),void 0,void 0,void 0,(()=>(o.removePendingData(E),D(`An error occurred with the creation of your particle system. Check if your type '${w}' exists.`))))}))}static ExportSet(w){const o=new Oo;for(const H of w)o.systems.push(H);return o}static ParseFromFileAsync(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",e=arguments.length>5?arguments[5]:void 0;return new Promise(((D,t)=>{const X=new To.b;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const o=JSON.parse(X.responseText);let t;t=h?ro.Parse(o,H,E,!1,e):to.Parse(o,H,E,!1,e),w&&(t.name=w),D(t)}else t("Unable to load the particle system")})),X.open("GET",o),X.send()}))}static ParseFromSnippetAsync(w,o){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",E=arguments.length>4?arguments[4]:void 0;if("_BLANK"===w){const w=this.CreateDefault(null);return w.start(),Promise.resolve(w)}return new Promise(((e,D)=>{const t=new To.b;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const D=JSON.parse(JSON.parse(t.responseText).jsonPayload),X=JSON.parse(D.particleSystem);let L;L=H?ro.Parse(X,o,h,!1,E):to.Parse(X,o,h,!1,E),L.snippetId=w,e(L)}else D("Unable to load the snippet "+w)})),t.open("GET",this.SnippetUrl+"/"+w.replace(/#/g,"/")),t.send()}))}}So.BaseAssetsUrl=Oo.BaseAssetsUrl,So.SnippetUrl="https://snippet.babylonjs.com",So.CreateFromSnippetAsync=So.ParseFromSnippetAsync;var co=H(12165),Wo=H(11987),Bo=H(13113);(0,Bo.d)(Wo.c.NAME_PARTICLESYSTEM,((w,o,H,h)=>{const E=(0,Bo.h)(Wo.c.NAME_PARTICLESYSTEM);if(E&&void 0!==w.Ez&&null!==w.Ez)for(let e=0,D=w.Ez.length;e<D;e++){const D=w.Ez[e];H.Ez.push(E(D,o,h))}})),(0,Bo.b)(Wo.c.NAME_PARTICLESYSTEM,((w,o,H)=>{if(w.activeParticleCount){return ro.Parse(w,o,H)}return to.Parse(w,o,H)})),Kw.c.prototype.createEffectForParticles=function(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",e=arguments.length>4?arguments[4]:void 0,D=arguments.length>5?arguments[5]:void 0,t=arguments.length>6?arguments[6]:void 0,X=arguments.length>7?arguments[7]:void 0,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,A=arguments.length>9?arguments[9]:void 0,y=[],z=[];const C=[];return X?X.fillUniformsAttributesAndSamplerNames(z,y,C):(y=to._GetAttributeNamesOrOptions(),z=to._GetEffectCreationOptions()),-1===E.indexOf(" BILLBOARD")&&(E+="\n#define BILLBOARD\n"),null!==X&&void 0!==X&&X.isAnimationSheetEnabled&&-1===E.indexOf(" ANIMATESHEET")&&(E+="\n#define ANIMATESHEET\n"),-1===h.indexOf("diffuseSampler")&&h.push("diffuseSampler"),this.createEffect({vertex:A??(null===X||void 0===X?void 0:X.vertexShaderName)??"particles",fragmentElement:w},y,z.concat(o),C.concat(h),E,e,D,t,void 0,L,(async()=>{0===L?await Promise.resolve().then(H.bind(H,13136)):await Promise.resolve().then(H.bind(H,13205))}))},co.d.prototype.getEmittedParticleSystems=function(){const w=[];for(let o=0;o<this.Ow().Ez.length;o++){const H=this.Ow().Ez[o];H.Eo===this&&w.push(H)}return w},co.d.prototype.getHierarchyEmittedParticleSystems=function(){const w=[],o=this.getDescendants();o.push(this);for(let H=0;H<this.Ow().Ez.length;H++){const h=this.Ow().Ez[H],E=h.Eo;E.position&&-1!==o.indexOf(E)&&w.push(h)}return w};H(12052),H(12063),H(12135);H(12142),H(13115),H(11910),H(12038),H(12183);H(11908);var Jo;H(13118),H(11734);!function(w){w[w.Color=2]="Color",w[w.UV=1]="UV",w[w.Random=0]="Random",w[w.Stated=3]="Stated"}(Jo||(Jo={}));var go=H(11945);const bo=new h.io(0,0,0),po=new h.io(0,0,0),fo=new h.io(0,0,0);class No{constructor(w,o,H){this.width=w,this.height=o,this.data=H}processFlowable(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2?arguments[2]:void 0;if(!H)return;H instanceof h.Matrix?h.io.TransformCoordinatesToRef(w.position,H,fo):(fo.x=H.x,fo.y=H.y,fo.z=H.z);const E=.5*fo.x+.5,e=1-(.5*fo.y+.5),D=Math.floor(E*this.width),t=Math.floor(e*this.height);if(D<0||D>=this.width||t<0||t>=this.height)return;const X=4*(t*this.width+D),L=this.data[X]/255*2-1,A=this.data[X+1]/255*2-1,y=this.data[X+2]/255*2-1,z=this.data[X+3]/255;bo.set(L,A,y),bo.scaleToRef(o*z,po),w.direction.addInPlace(po)}_processParticle(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2?arguments[2]:void 0;this.processFlowable(w,o,H)}static async FromUrlAsync(w){return await new Promise(((o,H)=>{const h=document.createElement("canvas"),E=h.getContext("2d");let e=null;const D=new Image;D.crossOrigin="anonymous",D.src=w,D.onerror=o=>{H(new Error(`Failed to load image: ${w} : ${o}`))},D.onload=()=>{h.width=D.width,h.height=D.height,E.drawImage(D,0,0),e=E.getImageData(0,0,h.width,h.height),o(new No(h.width,h.height,e.data))}}))}static async ExtractFromTextureAsync(w){return await new Promise(((o,H)=>{if(!w.isReady())return void w.onLoadObservable.addOnce((async()=>{try{const H=await this.ExtractFromTextureAsync(w);o(H)}catch(h){H(h)}}));const h=w.getSize();go.m.GetTextureDataAsync(w,h.width,h.height).then((w=>{o(new No(h.width,h.height,new Uint8ClampedArray(w)))})).catch(H)}))}}var jo,qo,uo,no,Go,Ro,ao,Io,Uo;!function(w){w[w.Int=1]="Int",w[w.Float=2]="Float",w[w.Vector2=4]="Vector2",w[w.io=8]="io",w[w.Matrix=16]="Matrix",w[w.Particle=32]="Particle",w[w.Texture=64]="Texture",w[w.ae=128]="ae",w[w.FloatGradient=256]="FloatGradient",w[w.Vector2Gradient=512]="Vector2Gradient",w[w.Vector3Gradient=1024]="Vector3Gradient",w[w.Color4Gradient=2048]="Color4Gradient",w[w.System=4096]="System",w[w.AutoDetect=8192]="AutoDetect",w[w.BasedOnInput=16384]="BasedOnInput",w[w.Undefined=32768]="Undefined",w[w.All=65535]="All"}(jo||(jo={})),function(w){w[w.Compatible=0]="Compatible",w[w.TypeIncompatible=1]="TypeIncompatible",w[w.HierarchyIssue=2]="HierarchyIssue"}(qo||(qo={})),function(w){w[w.Input=0]="Input",w[w.Output=1]="Output"}(uo||(uo={}));class Zo{get direction(){return this._direction}get type(){if(this._type===jo.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===jo.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(w){this._type=w}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((w=>w.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(w,o,H){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=jo.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new v.b,this.onDisconnectionObservable=new v.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=o,this.name=w,this._direction=H}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(w){var o;return this.isConnected?null!==(o=this._connectedPoint)&&void 0!==o&&o._storedFunction?this._connectedPoint._storedFunction(w):this._connectedPoint._storedValue:this.value}canConnectTo(w){return 0===this.checkCompatibilityState(w)}checkCompatibilityState(w){const o=this._ownerBlock,H=w.ownerBlock;if(this.type!==w.type&&w.innerType!==jo.AutoDetect)return w.acceptedConnectionPointTypes&&-1!==w.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(w.excludedConnectionPointTypes&&-1!==w.excludedConnectionPointTypes.indexOf(this.type))return 1;let h=H,E=o;return 0===this.direction&&(h=o,E=H),h.isAnAncestorOf(E)?2:0}connectTo(w){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(w))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${w.ownerBlock.name}".${w.name}`;return this._endpoints.push(w),w._connectedPoint=this,this.onConnectionObservable.notifyObservers(w),w.onConnectionObservable.notifyObservers(this),this}disconnectFrom(w){const o=this._endpoints.indexOf(w);return-1===o||(this._endpoints.splice(o,1),w._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(w),w.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(w){let o=1;for(;o<jo.All;)w&o||this.excludedConnectionPointTypes.push(o),o<<=1}serialize(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const o={};return o.name=this.name,o.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Ae?(o.valueType="BABYLON."+this.value.getClassName(),o.value=this.value.Ae()):(o.valueType="number",o.value=this.value)),w&&this.connectedPoint&&(o.inputName=this.name,o.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,o.targetConnectionName=this.connectedPoint.name,o.isExposedOnFrame=!0,o.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(o.isExposedOnFrame=!0,o.exposedPortPosition=this.exposedPortPosition),o}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Ko{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(w){this._name=w}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(w){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new v.b,this.me=new v.b,this.onInputChangedObservable=new v.b,this.visibleOnFrame=!1,this._name=w,this.uniqueId=N.b.UniqueId}_inputRename(w){return w}_outputRename(w){return w}isAnAncestorOf(w){for(const o of this._outputs)if(o.hasEndpoints)for(const H of o.endpoints){if(H.ownerBlock===w)return!0;if(H.ownerBlock.isAnAncestorOf(w))return!0}return!1}isAnAncestorOfType(w){if(this.getClassName()===w)return!0;for(const o of this._outputs)if(o.hasEndpoints)for(const H of o.endpoints)if(H.ownerBlock.isAnAncestorOfType(w))return!0;return!1}getInputByName(w){const o=this._inputs.filter((o=>o.name===w));return o.length?o[0]:null}_linkConnectionTypes(w,o){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[o]._acceptedConnectionPointType=this._inputs[w]:(this._inputs[w]._linkedConnectionSource=this._inputs[o],this._inputs[w]._isMainLinkSource=!0),this._inputs[o]._linkedConnectionSource=this._inputs[w]}registerInput(w,o){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,e=arguments.length>5?arguments[5]:void 0;const D=new Zo(w,this,0);return D.type=o,D.isOptional=H,D.defaultValue=h,D.value=h,D.valueMin=E,D.valueMax=e,this._inputs.push(D),this.onInputChangedObservable.notifyObservers(D),this}registerOutput(w,o,H){return(H=H??new Zo(w,this,1)).type=o,this._outputs.push(H),this}_build(w){}_customBuildStep(w){}build(w){if(this._buildId===w.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((w=>w.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=w.buildId;for(const o of this._inputs){if(!o.connectedPoint){o.isOptional||w.notConnectedNonOptionalInputs.push(o);continue}const H=o.connectedPoint.ownerBlock;H&&H!==this&&!H.isSystem&&H.build(w)}return this._customBuildStep(w),w.verbose&&j.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(w),this.onBuildObservable.notifyObservers(this),!1}serialize(){const w={};w.customType="BABYLON."+this.getClassName(),w.id=this.uniqueId,w.name=this.name,w.visibleOnFrame=this.visibleOnFrame,w.inputs=[],w.outputs=[];for(const o of this.inputs)w.inputs.push(o.serialize());for(const o of this.outputs)w.outputs.push(o.serialize(!1));return w}_deserialize(w){this._name=w.name,this.comments=w.comments,this.visibleOnFrame=!!w.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(w)}_deserializePortDisplayNamesAndExposedOnFrame(w){const o=w.inputs,H=w.outputs;if(o)for(const h of o){const w=this.inputs.find((w=>w.name===h.name));if(!w)return;if(h.displayName&&(w.displayName=h.displayName),h.isExposedOnFrame&&(w.isExposedOnFrame=h.isExposedOnFrame,w.exposedPortPosition=h.exposedPortPosition),void 0!==h.value&&null!==h.value)if("number"===h.valueType)w.value=h.value;else{const o=(0,t.e)(h.valueType);o&&(w.value=o.Po(h.value))}}if(H)for(let h=0;h<H.length;h++){const w=H[h];w.displayName&&(this.outputs[h].displayName=w.displayName),w.isExposedOnFrame&&(this.outputs[h].isExposedOnFrame=w.isExposedOnFrame,this.outputs[h].exposedPortPosition=w.exposedPortPosition)}}clone(){const w=this.serialize(),o=(0,t.e)(w.customType);if(o){const H=new o;return H._deserialize(w),H}return null}dispose(){this.me.notifyObservers(this),this.me.clear();for(const w of this.inputs)w.dispose();for(const w of this.outputs)w.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Fo(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",h=arguments.length>3?arguments[3]:void 0;return(E,e)=>{let D=E._propStore;D||(D=[],E._propStore=D),D.push({propertyName:e,displayName:w,type:o,groupName:H,options:h??{},className:E.getClassName()})}}(0,g.b)([(0,b.B)("comment")],Ko.prototype,"comments",void 0),function(w){w[w.Boolean=0]="Boolean",w[w.Float=1]="Float",w[w.Int=2]="Int",w[w.Vector2=3]="Vector2",w[w.List=4]="List",w[w.ae=5]="ae",w[w.SamplingMode=6]="SamplingMode",w[w.TextureFormat=7]="TextureFormat",w[w.TextureType=8]="TextureType"}(no||(no={})),function(w){w[w.None=0]="None",w[w.Position=1]="Position",w[w.Direction=2]="Direction",w[w.Age=3]="Age",w[w.Lifetime=4]="Lifetime",w[w.Color=5]="Color",w[w.ScaledDirection=6]="ScaledDirection",w[w.Scale=7]="Scale",w[w.AgeGradient=8]="AgeGradient",w[w.Angle=9]="Angle",w[w.SpriteCellIndex=16]="SpriteCellIndex",w[w.SpriteCellStart=17]="SpriteCellStart",w[w.SpriteCellEnd=18]="SpriteCellEnd"}(Go||(Go={})),function(w){w[w.None=0]="None",w[w.Time=1]="Time",w[w.Delta=2]="Delta",w[w.Emitter=3]="Emitter"}(Ro||(Ro={}));class vo{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let w="";for(const o of this.notConnectedNonOptionalInputs)w+=`input ${o.name} from block ${o.ownerBlock.name}[${o.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(w)throw"Build of Node Particle System Set failed:\n"+w}adapt(w,o){const H=w.getConnectedValue(this)||0;if(w.type===o)return H;switch(o){case jo.Vector2:return new h.Vector2(H,H);case jo.io:return new h.io(H,H,H);case jo.ae:return new D.ae(H,H,H,H)}return null}getContextualValue(w){if(!this.particleContext||!this.systemContext)return null;switch(w){case Go.Position:return this.particleContext.position;case Go.Direction:return this.particleContext.direction;case Go.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Go.Color:return this.particleContext.color;case Go.Age:return this.particleContext.age;case Go.Lifetime:return this.particleContext.lifeTime;case Go.Angle:return this.particleContext.angle;case Go.Scale:return this.particleContext.scale;case Go.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Go.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Go.SpriteCellIndex:return this.particleContext.cellIndex;case Go.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Eo.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Eo.absolutePosition:this.systemContext.Eo:null}getSystemValue(w){if(!this.particleContext||!this.systemContext)return null;switch(w){case Ro.Time:return this.systemContext._actualFrame;case Ro.Delta:return this.systemContext._scaledUpdateSpeed;case Ro.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Eo.absolutePosition}return this.systemContext.Eo}return null}}function mH(w,o,H){const h=new vo;h.Vo=o;const E=w.createSystem(h);return E.canStart=()=>!0,E.Eo=H.clone(),E.disposeOnStop=!0,E.start(),E}class Yo extends Ko{constructor(w){super(w),this.blendMode=X.BLENDMODE_ONEONE,this.no=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",jo.Particle),this.registerInput("texture",jo.Texture),this.registerInput("onStart",jo.System,!0),this.registerInput("onEnd",jo.System,!0),this.registerOutput("system",jo.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(w){w.no=this.no,w.buildId=this._buildId++,this.build(w);const o=this.particle.getConnectedValue(w);return o.particleTexture=this.texture.getConnectedValue(w),o.emitRate=this.emitRate,o.blendMode=this.blendMode,o.name=this.name,o._nodeGenerated=!0,o._targetStopDuration=this.targetStopDuration,o.startDelay=this.startDelay,this.system._storedValue=this,o.canStart=()=>!this.doNoStart,o.onStartedObservable.add((H=>{const h=this.onStart.getConnectedValue(w);h&&H.onStartedObservable.addOnce((()=>{w.systemContext=o;const H=mH(h,w.Vo,w.emitterPosition);this.me.addOnce((()=>{H.dispose()}))}));const E=this.onEnd.getConnectedValue(w);E&&H.onStoppedObservable.addOnce((()=>{w.systemContext=o;const H=mH(E,w.Vo,w.emitterPosition);this.me.addOnce((()=>{H.dispose()}))}))})),this.me.addOnce((()=>{o.dispose()})),o}serialize(){const w=super.serialize();return w.no=this.no,w.emitRate=this.emitRate,w.blendMode=this.blendMode,w.doNoStart=this.doNoStart,w.targetStopDuration=this.targetStopDuration,w.startDelay=this.startDelay,w}_deserialize(w){super._deserialize(w),this.no=w.no,this.emitRate=w.emitRate,this.doNoStart=!!w.doNoStart,void 0!==w.blendMode&&(this.blendMode=w.blendMode),void 0!==w.targetStopDuration&&(this.targetStopDuration=w.targetStopDuration),void 0!==w.startDelay&&(this.startDelay=w.startDelay)}}(0,g.b)([Fo("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:X.BLENDMODE_ONEONE},{label:"Standard",value:X.BLENDMODE_STANDARD},{label:"Add",value:X.BLENDMODE_ADD},{label:"Multiply",value:X.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:X.BLENDMODE_MULTIPLYADD}]})],Yo.prototype,"blendMode",void 0),(0,g.b)([Fo("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Yo.prototype,"no",void 0),(0,g.b)([Fo("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Yo.prototype,"emitRate",void 0),(0,g.b)([Fo("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Yo.prototype,"targetStopDuration",void 0),(0,g.b)([Fo("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Yo.prototype,"startDelay",void 0),(0,g.b)([Fo("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Yo.prototype,"doNoStart",void 0),(0,t.g)("BABYLON.SystemBlock",Yo);class xo extends Ko{get type(){if(this._type===jo.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=jo.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=jo.Vector2,this._type;case"io":return this._type=jo.io,this._type;case"ae":return this._type=jo.ae,this._type;case"Matrix":return this._type=jo.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Go.None&&this._systemSource!==Ro.None}get systemSource(){return this._systemSource}set systemSource(w){if(this._systemSource=w,w!==Ro.None){switch(this._contextualSource=Go.None,this._type=jo.Float,w){case Ro.Time:case Ro.Delta:this._type=jo.Float;break;case Ro.Emitter:this._type=jo.io}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Go.None}get contextualValue(){return this._contextualSource}set contextualValue(w){if(this._contextualSource=w,w!==Go.None){switch(this._systemSource=Ro.None,w){case Go.Scale:this._type=jo.Vector2;break;case Go.Position:case Go.Direction:case Go.ScaledDirection:this._type=jo.io;break;case Go.Color:this._type=jo.ae;break;case Go.Age:case Go.Lifetime:case Go.Angle:case Go.AgeGradient:this._type=jo.Float;break;case Go.SpriteCellEnd:case Go.SpriteCellStart:case Go.SpriteCellIndex:this._type=jo.Int}this.output&&(this.output.type=this._type)}}constructor(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jo.AutoDetect;super(w),this._type=jo.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new v.b,this._systemSource=Ro.None,this._contextualSource=Go.None,this._type=o,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",o)}get value(){return this._storedValue}set value(w){this.type===jo.Float&&this.min!==this.max&&(w=Math.max(this.min,w),w=Math.min(this.max,w)),this._storedValue=w,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(w){this._valueCallback=w}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case jo.Int:case jo.Float:this.value=0;break;case jo.Vector2:this.value=h.Vector2.Zero();break;case jo.io:this.value=h.io.Zero();break;case jo.ae:this.value=new D.ae(1,1,1,1);break;case jo.Matrix:this.value=h.Matrix.Identity()}}_build(w){super._build(w),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=w=>w.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=w=>w.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const w=super.serialize();return w.type=this.type,w.contextualValue=this.contextualValue,w.systemSource=this.systemSource,w.min=this.min,w.max=this.max,w.groupInInspector=this.groupInInspector,w.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Ae?(w.valueType="BABYLON."+this._storedValue.getClassName(),w.value=this._storedValue.Ae()):(w.valueType="number",w.value=this._storedValue)),w}_deserialize(w){if(super._deserialize(w),this._type=w.type,this.contextualValue=w.contextualValue,this.systemSource=w.systemSource||Ro.None,this.min=w.min||0,this.max=w.max||0,this.groupInInspector=w.groupInInspector||"",void 0!==w.displayInInspector&&(this.displayInInspector=w.displayInInspector),w.valueType)if("number"===w.valueType)this._storedValue=w.value;else{const o=(0,t.e)(w.valueType);o&&(this._storedValue=o.Po(w.value))}}}(0,t.g)("BABYLON.ParticleInputBlock",xo);class wH extends Ko{get url(){return this._url}set url(w){this._url!==w&&(this._cachedData=null,this._url=w,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(w){this._textureDataUrl!==w&&(this._cachedData=null,this._textureDataUrl=w,this._url="",this._sourceTexture=null)}set sourceTexture(w){this._sourceTexture!==w&&(this._cachedData=null,this._sourceTexture=w,this._url="",this._textureDataUrl="")}constructor(w){super(w),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",jo.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const w=this.texture._storedValue;return await new Promise(((o,H)=>{if(!w.isReady())return void w.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),o(this._cachedData)}catch(w){H(w)}}));const h=w.getSize();go.m.GetTextureDataAsync(w,h.width,h.height).then((H=>{this._cachedData={width:h.width,height:h.height,data:new Uint8ClampedArray(H)},w.dispose(),o(this._cachedData)})).catch(H)}))}_build(w){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new f.d(this._textureDataUrl,w.Vo):this.texture._storedValue=new f.d(this._url,w.Vo):this.texture._storedValue=null}serialize(){const w=super.serialize();return w.url=this.url,w.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(w.textureDataUrl=this.textureDataUrl),w}_deserialize(w){super._deserialize(w),this.url=w.url,this.serializedCachedData=!!w.serializedCachedData,w.textureDataUrl&&(this.textureDataUrl=w.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,t.g)("BABYLON.ParticleTextureSourceBlock",wH);class oH extends Ko{constructor(w){super(w),this.registerInput("particle",jo.Particle),this.registerInput("position",jo.io),this.registerOutput("output",jo.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(w){const o=this.particle.getConnectedValue(w);if(this.output._storedValue=o,!this.position.isConnected)return;const H={process:H=>{w.particleContext=H,w.systemContext=o,H.position.t(this.position.getConnectedValue(w))},previousItem:null,nextItem:null};o._updateQueueStart?Rw(H,o._updateQueueStart):o._updateQueueStart=H}}(0,t.g)("BABYLON.UpdatePositionBlock",oH),function(w){w[w.Add=0]="Add",w[w.Subtract=1]="Subtract",w[w.Multiply=2]="Multiply",w[w.Divide=3]="Divide",w[w.Max=4]="Max",w[w.Min=5]="Min"}(ao||(ao={}));class HH extends Ko{constructor(w){super(w),this.operation=ao.Add,this.registerInput("left",jo.AutoDetect),this.registerInput("right",jo.AutoDetect),this.registerOutput("output",jo.BasedOnInput),this.output._typeConnectionSource=this.left;const o=[jo.Matrix,jo.Particle,jo.Texture,jo.System,jo.FloatGradient,jo.Color4Gradient,jo.Vector2Gradient,jo.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...o),this.right.excludedConnectionPointTypes.push(...o),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(w){let o;const H=this.left,E=this.right;if(!H.isConnected||!E.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const e=H.type===jo.Float||H.type===jo.Int,t=E.type===jo.Float||E.type===jo.Int,X=e&&t;switch(this.operation){case ao.Add:o=X?w=>H.getConnectedValue(w)+E.getConnectedValue(w):e?w=>w.adapt(H,E.type).add(E.getConnectedValue(w)):w=>H.getConnectedValue(w).add(w.adapt(E,H.type));break;case ao.Subtract:o=X?w=>H.getConnectedValue(w)-E.getConnectedValue(w):e?w=>w.adapt(H,E.type).so(E.getConnectedValue(w)):w=>H.getConnectedValue(w).so(w.adapt(E,H.type));break;case ao.Multiply:o=X?w=>H.getConnectedValue(w)*E.getConnectedValue(w):e?w=>w.adapt(H,E.type).multiply(E.getConnectedValue(w)):w=>H.getConnectedValue(w).multiply(w.adapt(E,H.type));break;case ao.Divide:o=X?w=>H.getConnectedValue(w)/E.getConnectedValue(w):e?w=>w.adapt(H,E.type).divide(E.getConnectedValue(w)):w=>H.getConnectedValue(w).divide(w.adapt(E,H.type));break;case ao.Min:if(X)o=w=>Math.min(H.getConnectedValue(w),E.getConnectedValue(w));else{const[w,t]=e?[E,H]:[H,E];switch(w.type){case jo.Vector2:o=o=>h.Vector2.Minimize(w.getConnectedValue(o),o.adapt(t,w.type));break;case jo.io:o=o=>h.io.Minimize(w.getConnectedValue(o),o.adapt(t,w.type));break;case jo.ae:o=o=>{const H=w.getConnectedValue(o),{r:h,g:E,b:e,a:X}=o.adapt(t,w.type);return new D.ae(Math.min(H.r,h),Math.min(H.g,E),Math.min(H.b,e),Math.min(H.a,X))}}}break;case ao.Max:if(!X){const[w,t]=e?[E,H]:[H,E];switch(w.type){case jo.Vector2:o=o=>h.Vector2.Maximize(w.getConnectedValue(o),o.adapt(t,w.type));break;case jo.io:o=o=>h.io.Maximize(w.getConnectedValue(o),o.adapt(t,w.type));break;case jo.ae:o=o=>{const H=w.getConnectedValue(o),{r:h,g:E,b:e,a:X}=o.adapt(t,w.type);return new D.ae(Math.max(H.r,h),Math.min(H.g,E),Math.min(H.b,e),Math.min(H.a,X))}}break}o=w=>Math.max(H.getConnectedValue(w),E.getConnectedValue(w))}this.output._storedFunction=w=>H.type===jo.Int?0|o(w):o(w)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===jo.Int||this.left.type===jo.Float&&this.right.type!==jo.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[w,o]of[[this.left,this.right],[this.right,this.left]])w.acceptedConnectionPointTypes=[jo.Int,jo.Float],o.isConnected&&(w.acceptedConnectionPointTypes.push(o.type),o.type!==jo.Int&&o.type!==jo.Float||w.acceptedConnectionPointTypes.push(jo.Vector2,jo.io,jo.ae))}dispose(){super.dispose();for(const w of this._connectionObservers)w.remove();this._connectionObservers.length=0}serialize(){const w=super.serialize();return w.operation=this.operation,w}_deserialize(w){super._deserialize(w),this.operation=w.operation}}(0,g.b)([Fo("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:ao.Add},{label:"Subtract",value:ao.Subtract},{label:"Multiply",value:ao.Multiply},{label:"Divide",value:ao.Divide},{label:"Max",value:ao.Max},{label:"Min",value:ao.Min}]})],HH.prototype,"operation",void 0),(0,t.g)("BABYLON.ParticleMathBlock",HH);class hH extends Ko{constructor(w){super(w),this.registerInput("particle",jo.Particle),this.registerInput("direction1",jo.io,!0,new h.io(0,1,0)),this.registerInput("direction2",jo.io,!0,new h.io(0,1,0)),this.registerInput("minEmitBox",jo.io,!0,new h.io(-.5,-.5,-.5)),this.registerInput("maxEmitBox",jo.io,!0,new h.io(.5,.5,.5)),this.registerOutput("output",jo.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(w){const o=this.particle.getConnectedValue(w);o._directionCreation.process=H=>{w.particleContext=H,w.systemContext=o;const E=this.direction1.getConnectedValue(w),e=this.direction2.getConnectedValue(w),D=(0,L.RandomRange)(E.x,e.x),t=(0,L.RandomRange)(E.y,e.y),X=(0,L.RandomRange)(E.z,e.z);w.isEmitterTransformNode?h.io.TransformNormalFromFloatsToRef(D,t,X,w.emitterWorldMatrix,H.direction):H.direction.We(D,t,X)},o._positionCreation.process=H=>{w.particleContext=H,w.systemContext=o;const E=this.minEmitBox.getConnectedValue(w),e=this.maxEmitBox.getConnectedValue(w),D=(0,L.RandomRange)(E.x,e.x),t=(0,L.RandomRange)(E.y,e.y),X=(0,L.RandomRange)(E.z,e.z);w.isEmitterTransformNode?h.io.TransformCoordinatesFromFloatsToRef(D,t,X,w.emitterWorldMatrix,H.position):(H.position.We(D,t,X),H.position.addInPlace(w.emitterPosition))},this.output._storedValue=o}}(0,t.g)("BABYLON.BoxShapeBlock",hH);class EH extends Ko{constructor(w){super(w),this.registerInput("emitPower",jo.Float,!0,1),this.registerInput("lifeTime",jo.Float,!0,1),this.registerInput("color",jo.ae,!0,new D.ae(1,1,1,1)),this.registerInput("scale",jo.Vector2,!0,new h.Vector2(1,1)),this.registerInput("angle",jo.Float,!0,0),this.registerOutput("particle",jo.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(w){const o=new to(this.name,w.no,w.Vo,null,!1,void 0,!0);o.particleEmitterType=new s,o._lifeTimeCreation.process=(o,H)=>{w.particleContext=o,o.lifeTime=this.lifeTime.getConnectedValue(w),H._emitPower=this.emitPower.getConnectedValue(w)},o._colorCreation.process=o=>{w.particleContext=o,o.color.t(this.color.getConnectedValue(w))},o._sizeCreation.process=o=>{w.particleContext=o,o.size=1,o.scale.t(this.scale.getConnectedValue(w))},o._angleCreation.process=o=>{w.particleContext=o,o.angle=this.angle.getConnectedValue(w)},this.particle._storedValue=o}}(0,t.g)("BABYLON.CreateParticleBlock",EH);class eH{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const w=[];for(const o of this.attachedBlocks)o.isInput&&w.push(o);return w}constructor(w){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new v.b,this.name=w}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(w){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(w)&&this.attachedBlocks.push(w);for(const H of w.inputs){const h=H.connectedPoint;if(h){const H=h.ownerBlock;H!==w&&this._initializeBlock(H,o)}}}async buildAsync(w){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((H=>{const h=new Oo;for(const w of this._systemBlocks)this._initializeBlock(w);for(const E of this.systemBlocks){const H=new vo;H.buildId=this._buildId++,H.Vo=w,H.verbose=o;const e=E.createSystem(H);H.emitErrors(),h.systems.push(e)}this.onBuildObservable.notifyObservers(this),H(h)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const w=new Yo("Particle system"),o=new oH("Update position");o.output.connectTo(w.particle);const H=new xo("Position");H.contextualValue=Go.Position;const h=new xo("Scaled direction");h.contextualValue=Go.ScaledDirection;const E=new HH("Add");E.operation=ao.Add,H.output.connectTo(E.left),h.output.connectTo(E.right),E.output.connectTo(o.position);const e=new EH("Create particle"),D=new hH("Box shape");e.particle.connectTo(D.particle),D.output.connectTo(o.particle);const t=new wH("Texture");t.texture.connectTo(w.texture),t.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(w)}removeBlock(w){const o=this.attachedBlocks.indexOf(w);if(o>-1&&this.attachedBlocks.splice(o,1),w.isSystem){const o=this._systemBlocks.indexOf(w);o>-1&&this._systemBlocks.splice(o,1)}}parseSerializedObject(w){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o||this.clear();const H={};for(const h of w.MA){const w=(0,t.e)(h.customType);if(w){const o=new w;o._deserialize(h),H[h.id]=o,this.attachedBlocks.push(o),o.isSystem&&this._systemBlocks.push(o)}}for(const h of this.attachedBlocks)if(h.isTeleportOut){const w=h,o=w._tempEntryPointUniqueId;if(o){const h=H[o];h&&h.attachToEndpoint(w)}}for(let h=0;h<w.MA.length;h++){const E=w.MA[h],e=H[E.id];e&&(e.inputs.length&&E.inputs.some((w=>w.targetConnectionName))&&!o||this._restoreConnections(e,w,H))}if(w.locations||w.editorData&&w.editorData.locations){const h=w.locations||w.editorData.locations;for(const w of h)H[w.YH]&&(w.YH=H[w.YH].uniqueId);o&&this.editorData&&this.editorData.locations&&h.concat(this.editorData.locations),w.locations?this.editorData={locations:h}:(this.editorData=w.editorData,this.editorData.locations=h);const E=[];for(const w in H)E[w]=H[w].uniqueId;this.editorData.map=E}this.comment=w.comment}_restoreConnections(w,o,H){for(const h of w.outputs)for(const E of o.MA){const e=H[E.id];if(e)for(const D of E.inputs)if(H[D.targetBlockId]!==w||D.targetConnectionName!==h.name);else{const w=e.getInputByName(D.inputName);if(!w||w.isConnected)continue;h.connectTo(w,!0),this._restoreConnections(e,o,H)}}}serialize(w){const o=w?{}:p.e.Serialize(this);o.editorData=JSON.parse(JSON.stringify(this.editorData));let H=[];w?H=w:o.customType="BABYLON.NodeParticleSystemSet",o.MA=[];for(const h of H)o.MA.push(h.serialize());if(!w)for(const h of this.attachedBlocks)-1===H.indexOf(h)&&o.MA.push(h.serialize());return o}dispose(){for(const w of this.attachedBlocks)w.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(w){const o=new eH(w);return o.setToDefault(),o}static Parse(w){const o=p.e.Parse((()=>new eH(w.name)),w,null);return o.parseSerializedObject(w),o}static ParseFromSnippetAsync(w,o){return"_BLANK"===w?Promise.resolve(eH.CreateDefault("blank")):new Promise(((H,h)=>{const E=new To.b;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const D=JSON.parse(JSON.parse(E.responseText).jsonPayload),t=JSON.parse(D.nodeParticle);o||(o=p.e.Parse((()=>new eH(w)),t,null)),o.parseSerializedObject(t),o.snippetId=w;try{H(o)}catch(e){h(e)}}else h("Unable to load the snippet "+w)})),E.open("GET",this.SnippetUrl+"/"+w.replace(/#/g,"/")),E.send()}))}}eH.EditorURL=`${ko.Tools._DefaultCdnUrl}/v${Kw.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,eH.SnippetUrl="https://snippet.babylonjs.com",(0,g.b)([(0,b.B)()],eH.prototype,"name",void 0),(0,g.b)([(0,b.B)("comment")],eH.prototype,"comment",void 0),function(w){w[w.None=0]="None",w[w.PerParticle=1]="PerParticle",w[w.PerSystem=2]="PerSystem"}(Io||(Io={}));class DH extends Ko{constructor(w){super(w),this._currentLockId=-2,this.lockMode=Io.PerParticle,this.registerInput("min",jo.AutoDetect,!0,0),this.registerInput("max",jo.AutoDetect,!0,1),this.registerOutput("output",jo.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(jo.Float|jo.Int|jo.Vector2|jo.io|jo.ae),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(jo.Float|jo.Int|jo.Vector2|jo.io|jo.ae),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=jo.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let w=null;switch(this._currentLockId=-2,this.min.type){case jo.AutoDetect:case jo.Int:case jo.Float:w=w=>{const o=this.min.getConnectedValue(w)||0,H=this.max.getConnectedValue(w)||1;return o+Math.random()*(H-o)};break;case jo.Vector2:w=w=>{const o=this.min.getConnectedValue(w)||h.Vector2.Zero(),H=this.max.getConnectedValue(w)||h.Vector2.One();return new h.Vector2(o.x+Math.random()*(H.x-o.x),o.y+Math.random()*(H.y-o.y))};break;case jo.io:w=w=>{const o=this.min.getConnectedValue(w)||h.io.Zero(),H=this.max.getConnectedValue(w)||h.io.One();return new h.io(o.x+Math.random()*(H.x-o.x),o.y+Math.random()*(H.y-o.y),o.z+Math.random()*(H.z-o.z))};break;case jo.ae:w=w=>{const o=this.min.getConnectedValue(w)||new D.ae(0,0,0,0),H=this.max.getConnectedValue(w)||new D.ae(1,1,1,1);return new D.ae(o.x+Math.random()*(H.x-o.x),o.y+Math.random()*(H.y-o.y),o.z+Math.random()*(H.z-o.z),o.w+Math.random()*(H.w-o.w))}}this.output._storedFunction=o=>{var H;let h=0;switch(this.lockMode){case Io.PerParticle:h=(null===(H=o.particleContext)||void 0===H?void 0:H.id)||-1;break;case Io.PerSystem:h=o.buildId||0}return this._currentLockId!==h&&(this.lockMode!==Io.None&&(this._currentLockId=h),this.output._storedValue=w(o)),this.output._storedValue}}serialize(){const w=super.serialize();return w.lockMode=this.lockMode,w}_deserialize(w){super._deserialize(w),this.lockMode=w.lockMode}}(0,g.b)([Fo("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Io.None},{label:"Per particle",value:Io.PerParticle},{label:"Per system",value:Io.PerSystem}]})],DH.prototype,"lockMode",void 0),(0,t.g)("BABYLON.ParticleRandomBlock",DH);class tH extends Ko{constructor(w){super(w),this._currentLockId=-2,this.lockMode=Io.PerParticle,this.registerInput("min",jo.AutoDetect),this.registerInput("max",jo.AutoDetect),this.registerOutput("output",jo.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const o=[jo.Matrix,jo.Particle,jo.Texture,jo.System,jo.FloatGradient,jo.Color4Gradient,jo.Vector2Gradient,jo.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...o),this.max.excludedConnectionPointTypes.push(...o)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let w=null;switch(this._currentLockId=-2,this.min.type){case jo.Float:case jo.Int:w=w=>{const o=this.min.getConnectedValue(w),H=this.max.getConnectedValue(w);return Math.random()*(H-o)+o};break;case jo.Vector2:w=w=>{const o=this.min.getConnectedValue(w),H=this.max.getConnectedValue(w);return new h.Vector2(Math.random()*(H.x-o.x)+o.x,Math.random()*(H.y-o.y)+o.y)};break;case jo.io:w=w=>{const o=this.min.getConnectedValue(w),H=this.max.getConnectedValue(w);return new h.io(Math.random()*(H.x-o.x)+o.x,Math.random()*(H.y-o.y)+o.y,Math.random()*(H.z-o.z)+o.z)};break;case jo.ae:w=w=>{const o=this.min.getConnectedValue(w),H=this.max.getConnectedValue(w);return new D.ae(Math.random()*(H.r-o.r)+o.r,Math.random()*(H.g-o.g)+o.g,Math.random()*(H.b-o.b)+o.b,Math.random()*(H.a-o.a)+o.a)}}this.output._storedFunction=o=>{var H;let h=0;switch(this.lockMode){case Io.PerParticle:h=(null===(H=o.particleContext)||void 0===H?void 0:H.id)||-1;break;case Io.PerSystem:h=o.buildId||0}return this._currentLockId!==h&&(this.lockMode!==Io.None&&(this._currentLockId=h),this.output._storedValue=w(o)),this.output._storedValue}}serialize(){const w=super.serialize();return w.lockMode=this.lockMode,w}_deserialize(w){super._deserialize(w),void 0!==w.lockMode&&(this.lockMode=w.lockMode)}}(0,g.b)([Fo("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Io.None},{label:"Per particle",value:Io.PerParticle},{label:"Per system",value:Io.PerSystem}]})],tH.prototype,"lockMode",void 0),(0,t.g)("BABYLON.RandomRangeBlock",tH);(0,t.g)("BABYLON.ParticleLerpBlock",class extends Ko{constructor(w){super(w),this.registerInput("left",jo.AutoDetect),this.registerInput("right",jo.AutoDetect),this.registerInput("gradient",jo.Float,!0,0,0,1),this.registerOutput("output",jo.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(jo.Float|jo.Int|jo.Vector2|jo.io|jo.ae)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const w=(w,o,H)=>(1-w)*o+w*H;this.output._storedFunction=o=>{const H=this.left.getConnectedValue(o),E=this.right.getConnectedValue(o),e=this.gradient.getConnectedValue(o);switch(this.left.type){case jo.Int:case jo.Float:return w(e,H,E);case jo.Vector2:return new h.Vector2(w(e,H.x,E.x),w(e,H.y,E.y));case jo.io:return new h.io(w(e,H.x,E.x),w(e,H.y,E.y),w(e,H.z,E.z));case jo.ae:return new D.ae(w(e,H.r,E.r),w(e,H.g,E.g),w(e,H.b,E.b),w(e,H.a,E.a))}return 0}}});(0,t.g)("BABYLON.UpdateDirectionBlock",class extends Ko{constructor(w){super(w),this.registerInput("particle",jo.Particle),this.registerInput("direction",jo.io),this.registerOutput("output",jo.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(w){const o=this.particle.getConnectedValue(w);if(this.output._storedValue=o,!this.direction.isConnected)return;const H={process:H=>{w.particleContext=H,w.systemContext=o,H.direction.t(this.direction.getConnectedValue(w))},previousItem:null,nextItem:null};o._updateQueueStart?Rw(H,o._updateQueueStart):o._updateQueueStart=H}});(0,t.g)("BABYLON.UpdateColorBlock",class extends Ko{constructor(w){super(w),this.registerInput("particle",jo.Particle),this.registerInput("color",jo.ae),this.registerOutput("output",jo.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(w){const o=this.particle.getConnectedValue(w);if(this.output._storedValue=o,!this.color.isConnected)return;const H={process:H=>{w.particleContext=H,w.systemContext=o,H.color.t(this.color.getConnectedValue(w))},previousItem:null,nextItem:null};o._updateQueueStart?Rw(H,o._updateQueueStart):o._updateQueueStart=H}});(0,t.g)("BABYLON.UpdateScaleBlock",class extends Ko{constructor(w){super(w),this.registerInput("particle",jo.Particle),this.registerInput("scale",jo.Vector2),this.registerOutput("output",jo.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(w){const o=this.particle.getConnectedValue(w);if(this.output._storedValue=o,!this.scale.isConnected)return;const H={process:H=>{w.particleContext=H,w.systemContext=o,H.scale.t(this.scale.getConnectedValue(w))},previousItem:null,nextItem:null};o._updateQueueStart?Rw(H,o._updateQueueStart):o._updateQueueStart=H}});(0,t.g)("BABYLON.UpdateAngleBlock",class extends Ko{constructor(w){super(w),this.registerInput("particle",jo.Particle),this.registerInput("angle",jo.Float),this.registerOutput("output",jo.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(w){const o=this.particle.getConnectedValue(w);if(this.output._storedValue=o,!this.angle.isConnected)return;const H={process:H=>{w.particleContext=H,w.systemContext=o,H.angle=this.angle.getConnectedValue(w)},previousItem:null,nextItem:null};o._updateQueueStart?Rw(H,o._updateQueueStart):o._updateQueueStart=H}});(0,t.g)("BABYLON.BasicPositionUpdateBlock",class extends Ko{constructor(w){super(w),this.registerInput("particle",jo.Particle),this.registerOutput("output",jo.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(w){const o=this.particle.getConnectedValue(w),H={process:H=>{w.particleContext=H,w.systemContext=o,H.direction.scaleToRef(o._directionScale,o._scaledDirection),H.position.addInPlace(o._scaledDirection)},previousItem:null,nextItem:null};o._updateQueueStart?Rw(H,o._updateQueueStart):o._updateQueueStart=H,this.output._storedValue=o}});(0,t.g)("BABYLON.BasicSpriteUpdateBlock",class extends Ko{constructor(w){super(w),this.registerInput("particle",jo.Particle),this.registerOutput("output",jo.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(w){const o=this.particle.getConnectedValue(w),H={process:H=>{w.particleContext=H,w.systemContext=o,H.updateCellIndex()},previousItem:null,nextItem:null};o._updateQueueStart?Rw(H,o._updateQueueStart):o._updateQueueStart=H,this.output._storedValue=o}});(0,t.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends Ko{constructor(w){super(w),this.registerInput("particle",jo.Particle),this.registerInput("cellIndex",jo.Int),this.registerOutput("output",jo.Particle),this.cellIndex.acceptedConnectionPointTypes=[jo.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(w){const o=this.particle.getConnectedValue(w);if(this.output._storedValue=o,!this.cellIndex.isConnected)return;const H={process:H=>{w.particleContext=H,w.systemContext=o,H.cellIndex=Math.floor(this.cellIndex.getConnectedValue(w))},previousItem:null,nextItem:null};o._updateQueueStart?Rw(H,o._updateQueueStart):o._updateQueueStart=H}});class XH extends Ko{constructor(w){super(w),this.strength=1,this.registerInput("particle",jo.Particle),this.registerInput("flowMap",jo.Texture),this.registerOutput("output",jo.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(w){var o;const H=this.particle.getConnectedValue(w),h=w.Vo;let E;(null===(o=this.flowMap.connectedPoint)||void 0===o?void 0:o.ownerBlock).extractTextureContentAsync().then((w=>{w&&(E=new No(w.width,w.height,w.data))}));const e={process:w=>{const o=h.getTransformMatrix();E&&E._processParticle(w,this.strength*H._tempScaledUpdateSpeed,o)},previousItem:null,nextItem:null};H._updateQueueStart?Rw(e,H._updateQueueStart):H._updateQueueStart=e,this.output._storedValue=H}serialize(){const w=super.serialize();return w.strength=this.strength,w}_deserialize(w){super._deserialize(w),this.strength=w.strength}}(0,g.b)([Fo("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XH.prototype,"strength",void 0),(0,t.g)("BABYLON.UpdateFlowMapBlock",XH);(0,t.g)("BABYLON.SphereShapeBlock",class extends Ko{constructor(w){super(w),this.registerInput("input",jo.Particle),this.registerInput("radius",jo.Float,!0,1),this.registerInput("radiusRange",jo.Float,!0,1,0,1),this.registerInput("directionRandomizer",jo.Float,!0,0,0,1),this.registerOutput("output",jo.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(w){const o=this.input.getConnectedValue(w);o._directionCreation.process=H=>{w.particleContext=H,w.systemContext=o;const E=this.directionRandomizer.getConnectedValue(w),e=H.position.so(w.emitterPosition).normalize(),D=(0,L.RandomRange)(0,E),t=(0,L.RandomRange)(0,E),X=(0,L.RandomRange)(0,E);e.x+=D,e.y+=t,e.z+=X,e.normalize(),w.isEmitterTransformNode?h.io.TransformNormalFromFloatsToRef(D,t,X,w.emitterWorldMatrix,H.direction):H.direction.We(D,t,X)},o._positionCreation.process=H=>{w.particleContext=H,w.systemContext=o;const E=this.radius.getConnectedValue(w),e=this.radiusRange.getConnectedValue(w),D=E-(0,L.RandomRange)(0,E*e),t=(0,L.RandomRange)(0,1),X=(0,L.RandomRange)(0,2*Math.PI),A=Math.acos(2*t-1),y=D*Math.cos(X)*Math.sin(A),z=D*Math.cos(A),C=D*Math.sin(X)*Math.sin(A);w.isEmitterTransformNode?h.io.TransformCoordinatesFromFloatsToRef(y,z,C,w.emitterWorldMatrix,H.position):(H.position.We(y,z,C),H.position.addInPlace(w.emitterPosition))},this.output._storedValue=o}});(0,t.g)("BABYLON.PointShapeBlock",class extends Ko{constructor(w){super(w),this.registerInput("particle",jo.Particle),this.registerInput("direction1",jo.io,!0,new h.io(0,1,0)),this.registerInput("direction2",jo.io,!0,new h.io(0,1,0)),this.registerOutput("output",jo.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(w){const o=this.particle.getConnectedValue(w);o._directionCreation.process=H=>{w.particleContext=H,w.systemContext=o;const E=this.direction1.getConnectedValue(w),e=this.direction2.getConnectedValue(w),D=(0,L.RandomRange)(E.x,e.x),t=(0,L.RandomRange)(E.y,e.y),X=(0,L.RandomRange)(E.z,e.z);w.isEmitterTransformNode?h.io.TransformNormalFromFloatsToRef(D,t,X,w.emitterWorldMatrix,H.direction):H.direction.We(D,t,X)},o._positionCreation.process=H=>{w.systemContext=o,w.isEmitterTransformNode?h.io.TransformCoordinatesFromFloatsToRef(0,0,0,w.emitterWorldMatrix,H.position):H.position.t(w.emitterPosition)},this.output._storedValue=o}});(0,t.g)("BABYLON.CustomShapeBlock",class extends Ko{constructor(w){super(w),this.registerInput("particle",jo.Particle),this.registerInput("position",jo.io,!0,new h.io(0,0,0)),this.registerInput("direction",jo.io,!0,new h.io(0,1,0)),this.registerOutput("output",jo.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(w){const o=this.particle.getConnectedValue(w);o._directionCreation.process=H=>{w.particleContext=H,w.systemContext=o;const E=this.direction.getConnectedValue(w);w.isEmitterTransformNode?h.io.TransformNormalToRef(E,w.emitterWorldMatrix,H.direction):H.direction.t(E)},o._positionCreation.process=H=>{w.particleContext=H,w.systemContext=o;const E=this.position.getConnectedValue(w);w.isEmitterTransformNode?h.io.TransformCoordinatesToRef(E,w.emitterWorldMatrix,H.position):(H.position.t(E),H.position.addInPlace(w.emitterPosition))},this.output._storedValue=o}});(0,t.g)("BABYLON.CylinderShapeBlock",class extends Ko{constructor(w){super(w),this._tempVector=h.io.Zero(),this.registerInput("particle",jo.Particle),this.registerInput("radius",jo.Float,!0,1),this.registerInput("height",jo.Float,!0,1,0),this.registerInput("radiusRange",jo.Float,!0,1,0,1),this.registerInput("directionRandomizer",jo.Float,!0,0,0,1),this.registerOutput("output",jo.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(w){const o=this.particle.getConnectedValue(w);o._directionCreation.process=H=>{w.particleContext=H,w.systemContext=o;const E=this.directionRandomizer.getConnectedValue(w);H.position.subtractToRef(w.emitterPosition,this._tempVector),this._tempVector.normalize(),w.isEmitterTransformNode&&h.io.TransformNormalToRef(this._tempVector,w.emitterInverseWorldMatrix,this._tempVector);const e=(0,L.RandomRange)(-E/2,E/2);let D=Math.atan2(this._tempVector.x,this._tempVector.z);D+=(0,L.RandomRange)(-Math.PI/2,Math.PI/2)*E,this._tempVector.y=e,this._tempVector.x=Math.sin(D),this._tempVector.z=Math.cos(D),this._tempVector.normalize(),w.isEmitterTransformNode?h.io.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,w.emitterWorldMatrix,H.direction):H.direction.t(this._tempVector)},o._positionCreation.process=H=>{w.particleContext=H,w.systemContext=o;const E=this.height.getConnectedValue(w),e=this.radiusRange.getConnectedValue(w),D=this.radius.getConnectedValue(w),t=(0,L.RandomRange)(-E/2,E/2),X=(0,L.RandomRange)(0,2*Math.PI),A=(0,L.RandomRange)((1-e)*(1-e),1),y=Math.sqrt(A)*D,z=y*Math.cos(X),C=y*Math.sin(X);w.isEmitterTransformNode?h.io.TransformCoordinatesFromFloatsToRef(z,t,C,w.emitterWorldMatrix,H.position):(H.position.We(z,t,C),H.position.addInPlace(w.emitterPosition))},this.output._storedValue=o}});class LH extends Ko{constructor(w){super(w),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",jo.Particle),this.registerOutput("output",jo.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(w){super._build(w);const o=this.particle.getConnectedValue(w);o._isAnimationSheetEnabled=!0,o.spriteCellWidth=this.width,o.spriteCellHeight=this.height,o.startSpriteCellID=this.start,o.endSpriteCellID=this.end,o.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=o}serialize(){const w=super.serialize();return w.width=this.width,w.height=this.height,w.start=this.start,w.end=this.end,w.randomStartCell=this.randomStartCell,w}_deserialize(w){super._deserialize(w),this.width=w.width,this.height=w.height,this.start=w.start,this.end=w.end,this.randomStartCell=w.randomStartCell}}(0,g.b)([Fo("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LH.prototype,"start",void 0),(0,g.b)([Fo("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LH.prototype,"end",void 0),(0,g.b)([Fo("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LH.prototype,"width",void 0),(0,g.b)([Fo("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LH.prototype,"height",void 0),(0,g.b)([Fo("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],LH.prototype,"loop",void 0),(0,g.b)([Fo("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],LH.prototype,"randomStartCell",void 0),(0,t.g)("BABYLON.SetupSpriteSheetBlock",LH);class AH extends Ko{constructor(w){super(w),this.reference=0,this.registerInput("value",jo.AutoDetect),this.registerOutput("output",jo.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=w=>{switch(w){case jo.Float:return jo.FloatGradient;case jo.Vector2:return jo.Vector2Gradient;case jo.io:return jo.Vector3Gradient;case jo.ae:return jo.Color4Gradient}return w},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(jo.Float|jo.Vector2|jo.io|jo.ae)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=w=>null}serialize(){const w=super.serialize();return w.reference=this.reference,w}_deserialize(w){super._deserialize(w),this.reference=w.reference}}(0,g.b)([Fo("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],AH.prototype,"reference",void 0),(0,t.g)("BABYLON.ParticleGradientValueBlock",AH);(0,t.g)("BABYLON.ParticleGradientBlock",class extends Ko{constructor(w){super(w),this._entryCount=1,this.registerInput("gradient",jo.Float,!0,1,0,1),this.registerInput("value0",jo.AutoDetect),this.registerOutput("output",jo.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=w=>{switch(w){case jo.FloatGradient:return jo.Float;case jo.Vector2Gradient:return jo.Vector2;case jo.Vector3Gradient:return jo.io;case jo.Color4Gradient:return jo.ae}return w},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(jo.FloatGradient|jo.Vector2Gradient|jo.Vector3Gradient|jo.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(w){this._inputs[w].onConnectionObservable.add((()=>{this._entryCount>w||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),jo.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const w=[];for(let H=1;H<this._inputs.length;H++){var o;if(this._inputs[H].isConnected)w.push(null===(o=this._inputs[H].connectedPoint)||void 0===o?void 0:o.ownerBlock)}w.sort(((w,o)=>w.reference-o.reference)),this.output._storedFunction=o=>{const H=this.gradient.getConnectedValue(o);if(1===w.length)return w[0].value.getConnectedValue(o);let E=null;for(let e=w.length-1;e>=0;e--){const t=w[e];if(t.reference<=H){const w=t.value.getConnectedValue(o);if(E){const e=E.value.getConnectedValue(o),X=E.reference,A=t.reference,y=Math.max(0,Math.min(1,(H-A)/(X-A)));switch(this.output.type){case jo.Float:return(0,L.Lerp)(w,e,y);case jo.Vector2:return h.Vector2.Lerp(w,e,y);case jo.io:return h.io.Lerp(w,e,y);case jo.ae:return D.ae.Lerp(w,e,y)}}return w}E=t}return 0}}});(0,t.g)("BABYLON.ParticleConverterBlock",class extends Ko{constructor(w){super(w),this.registerInput("color ",jo.ae,!0),this.registerInput("xyz ",jo.io,!0),this.registerInput("xy ",jo.Vector2,!0),this.registerInput("zw ",jo.Vector2,!0),this.registerInput("x ",jo.Float,!0),this.registerInput("y ",jo.Float,!0),this.registerInput("z ",jo.Float,!0),this.registerInput("w ",jo.Float,!0),this.registerOutput("color",jo.ae),this.registerOutput("xyz",jo.io),this.registerOutput("xy",jo.Vector2),this.registerOutput("zw",jo.Vector2),this.registerOutput("x",jo.Float),this.registerOutput("y",jo.Float),this.registerOutput("z",jo.Float),this.registerOutput("w",jo.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(w){return"color "===w?"colorIn":"xyz "===w?"xyzIn":"xy "===w?"xyIn":"zw "===w?"zwIn":"x "===w?"xIn":"y "===w?"yIn":"z "===w?"zIn":"w "===w?"wIn":w}_outputRename(w){switch(w){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return w}}_build(w){super._build(w);const o=this.xIn,H=this.yIn,E=this.zIn,e=this.wIn,t=this.xyIn,X=this.zwIn,L=this.xyzIn,A=this.colorIn,y=this.colorOut,z=this.xyzOut,C=this.xyOut,Q=this.zwOut,M=this.xOut,i=this.yOut,s=this.zOut,V=this.wOut,r=w=>{if(A.isConnected)return A.getConnectedValue(w);let h=0,y=0,z=0,C=0;if(o.isConnected&&(h=o.getConnectedValue(w)),H.isConnected&&(y=H.getConnectedValue(w)),E.isConnected&&(z=E.getConnectedValue(w)),e.isConnected&&(C=e.getConnectedValue(w)),t.isConnected){const o=t.getConnectedValue(w);o&&(h=o.x,y=o.y)}if(X.isConnected){const o=X.getConnectedValue(w);o&&(z=o.x,C=o.y)}if(L.isConnected){const o=L.getConnectedValue(w);o&&(h=o.x,y=o.y,z=o.z)}return new D.ae(h,y,z,C)};y._storedFunction=w=>r(w),z._storedFunction=w=>{const o=r(w);return new h.io(o.r,o.g,o.b)},C._storedFunction=w=>{const o=r(w);return new h.Vector2(o.r,o.g)},Q._storedFunction=w=>{const o=r(w);return new h.Vector2(o.b,o.a)},M._storedFunction=w=>r(w).r,i._storedFunction=w=>r(w).g,s._storedFunction=w=>r(w).b,V._storedFunction=w=>r(w).a}}),function(w){w[w.Cos=0]="Cos",w[w.Sin=1]="Sin",w[w.Abs=2]="Abs",w[w.Exp=3]="Exp",w[w.Exp2=4]="Exp2",w[w.Round=5]="Round",w[w.Floor=6]="Floor",w[w.Ceiling=7]="Ceiling",w[w.Sqrt=8]="Sqrt",w[w.Log=9]="Log",w[w.Tan=10]="Tan",w[w.ArcTan=11]="ArcTan",w[w.ArcCos=12]="ArcCos",w[w.ArcSin=13]="ArcSin",w[w.Sign=14]="Sign",w[w.Negate=15]="Negate",w[w.OneMinus=16]="OneMinus",w[w.Reciprocal=17]="Reciprocal",w[w.ToDegrees=18]="ToDegrees",w[w.ToRadians=19]="ToRadians",w[w.Fract=20]="Fract"}(Uo||(Uo={}));class yH extends Ko{constructor(w){super(w),this.operation=Uo.Cos,this.registerInput("input",jo.AutoDetect),this.registerOutput("output",jo.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(jo.Float|jo.Int|jo.Vector2|jo.io|jo.ae)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(w){super._build(w);let o=null;switch(this.operation){case Uo.Cos:o=w=>Math.cos(w);break;case Uo.Sin:o=w=>Math.sin(w);break;case Uo.Abs:o=w=>Math.abs(w);break;case Uo.Exp:o=w=>Math.exp(w);break;case Uo.Exp2:o=w=>Math.pow(2,w);break;case Uo.Round:o=w=>Math.round(w);break;case Uo.Floor:o=w=>Math.floor(w);break;case Uo.Ceiling:o=w=>Math.ceil(w);break;case Uo.Sqrt:o=w=>Math.sqrt(w);break;case Uo.Log:o=w=>Math.log(w);break;case Uo.Tan:o=w=>Math.tan(w);break;case Uo.ArcTan:o=w=>Math.atan(w);break;case Uo.ArcCos:o=w=>Math.acos(w);break;case Uo.ArcSin:o=w=>Math.asin(w);break;case Uo.Sign:o=w=>Math.sign(w);break;case Uo.Negate:o=w=>-w;break;case Uo.OneMinus:o=w=>1-w;break;case Uo.Reciprocal:o=w=>1/w;break;case Uo.ToRadians:o=w=>w*Math.PI/180;break;case Uo.ToDegrees:o=w=>180*w/Math.PI;break;case Uo.Fract:o=w=>w>=0?w-Math.floor(w):w-Math.ceil(w)}if(!o)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case jo.Int:case jo.Float:this.output._storedFunction=w=>{const H=this.input.getConnectedValue(w);return o(H)};break;case jo.Vector2:this.output._storedFunction=w=>{const H=this.input.getConnectedValue(w);return new h.Vector2(o(H.x),o(H.y))};break;case jo.io:this.output._storedFunction=w=>{const H=this.input.getConnectedValue(w);return new h.io(o(H.x),o(H.y),o(H.z))};break;case jo.ae:this.output._storedFunction=w=>{const H=this.input.getConnectedValue(w);return new D.ae(o(H.r),o(H.g),o(H.b),o(H.a))}}return this}serialize(){const w=super.serialize();return w.operation=this.operation,w}_deserialize(w){super._deserialize(w),this.operation=w.operation}}(0,g.b)([Fo("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Uo.Cos},{label:"Sin",value:Uo.Sin},{label:"Abs",value:Uo.Abs},{label:"Exp",value:Uo.Exp},{label:"Exp2",value:Uo.Exp2},{label:"Round",value:Uo.Round},{label:"Floor",value:Uo.Floor},{label:"Ceiling",value:Uo.Ceiling},{label:"Sqrt",value:Uo.Sqrt},{label:"Log",value:Uo.Log},{label:"Tan",value:Uo.Tan},{label:"ArcTan",value:Uo.ArcTan},{label:"ArcCos",value:Uo.ArcCos},{label:"ArcSin",value:Uo.ArcSin},{label:"Sign",value:Uo.Sign},{label:"Negate",value:Uo.Negate},{label:"OneMinus",value:Uo.OneMinus},{label:"Reciprocal",value:Uo.Reciprocal},{label:"ToDegrees",value:Uo.ToDegrees},{label:"ToRadians",value:Uo.ToRadians},{label:"Fract",value:Uo.Fract}]})],yH.prototype,"operation",void 0),(0,t.g)("BABYLON.ParticleTrigonometryBlock",yH);var zH,CH=H(13121);class QH extends Ko{constructor(w){super(w),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",jo.AutoDetect),this.registerOutput("output",jo.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(jo.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(jo.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(jo.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(jo.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(jo.System),this._inputs[0].excludedConnectionPointTypes.push(jo.Particle),this._inputs[0].excludedConnectionPointTypes.push(jo.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(w){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const o=w=>{const o=this.input.getConnectedValue(w);if(this.log.length>=this.stackSize)return o;if(null===o||void 0===o)return this.log.push(["null",""]),o;switch(this.input.type){case jo.Vector2:this.log.push([(0,CH.g)(o,4),o.toString()]);break;case jo.io:this.log.push([(0,CH.j)(o,4),o.toString()]);break;case jo.ae:this.log.push([`{R: ${o.r.toFixed(4)} G: ${o.g.toFixed(4)} B: ${o.b.toFixed(4)} A: ${o.a.toFixed(4)}}`,o.toString()]);break;default:this.log.push([o.toString(),o.toString()])}return o};this.output.isConnected?this.output._storedFunction=o:this.output._storedValue=o(w)}serialize(){const w=super.serialize();return w.stackSize=this.stackSize,w}_deserialize(w){super._deserialize(w),this.stackSize=w.stackSize}}(0,g.b)([Fo("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],QH.prototype,"stackSize",void 0),(0,t.g)("BABYLON.ParticleDebugBlock",QH);(0,t.g)("BABYLON.ParticleElbowBlock",class extends Ko{constructor(w){super(w),this.registerInput("input",jo.AutoDetect),this.registerOutput("output",jo.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(w){super._build(w);const o=this._outputs[0],H=this._inputs[0];o._storedFunction=w=>H.getConnectedValue(w)}});(0,t.g)("BABYLON.ParticleTeleportInBlock",class extends Ko{get endpoints(){return this._endpoints}constructor(w){super(w),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",jo.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(w){if(this.getClassName()===w)return!0;for(const o of this.endpoints)if(o.isAnAncestorOfType(w))return!0;return!1}isAnAncestorOf(w){for(const o of this.endpoints){if(o===w)return!0;if(o.isAnAncestorOf(w))return!0}return!1}attachToEndpoint(w){w.detach(),this._endpoints.push(w),w._entryPoint=this,w._outputs[0]._typeConnectionSource=this._inputs[0],w._tempEntryPointUniqueId=null,w.name="> "+this.name}detachFromEndpoint(w){const o=this._endpoints.indexOf(w);-1!==o&&(this._endpoints.splice(o,1),w._outputs[0]._typeConnectionSource=null,w._entryPoint=null)}_build(){for(const w of this._endpoints)w.output._storedFunction=w=>this.input.getConnectedValue(w)}});(0,t.g)("BABYLON.ParticleTeleportOutBlock",class extends Ko{constructor(w){super(w),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",jo.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(w){this.entryPoint&&this.entryPoint.build(w)}clone(){const w=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(w),w}serialize(){var w;const o=super.serialize();return o.entryPoint=(null===(w=this.entryPoint)||void 0===w?void 0:w.uniqueId)??"",o}_deserialize(w){super._deserialize(w),this._tempEntryPointUniqueId=w.entryPoint}}),function(w){w[w.Equal=0]="Equal",w[w.NotEqual=1]="NotEqual",w[w.LessThan=2]="LessThan",w[w.GreaterThan=3]="GreaterThan",w[w.LessOrEqual=4]="LessOrEqual",w[w.GreaterOrEqual=5]="GreaterOrEqual",w[w.Xor=6]="Xor",w[w.Or=7]="Or",w[w.And=8]="And"}(zH||(zH={}));class MH extends Ko{constructor(w){super(w),this.test=zH.Equal,this.epsilon=0,this.registerInput("left",jo.Float),this.registerInput("right",jo.Float,!0,0),this.registerInput("ifTrue",jo.AutoDetect,!0,1),this.registerInput("ifFalse",jo.AutoDetect,!0,0),this.registerOutput("output",jo.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=jo.Float,this._inputs[0].acceptedConnectionPointTypes.push(jo.Int),this._inputs[1].acceptedConnectionPointTypes.push(jo.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const w=w=>{const o=this.left.getConnectedValue(w),H=this.right.getConnectedValue(w);let h=!1;switch(this.test){case zH.Equal:h=(0,L.WithinEpsilon)(o,H,this.epsilon);break;case zH.NotEqual:h=!(0,L.WithinEpsilon)(o,H,this.epsilon);break;case zH.LessThan:h=o<H+this.epsilon;break;case zH.GreaterThan:h=o>H-this.epsilon;break;case zH.LessOrEqual:h=o<=H+this.epsilon;break;case zH.GreaterOrEqual:h=o>=H-this.epsilon;break;case zH.Xor:h=!!o&&!H||!o&&!!H;break;case zH.Or:h=!!o||!!H;break;case zH.And:h=!!o&&!!H}return h};this.output._storedFunction=o=>w(o)?this.ifTrue.getConnectedValue(o):this.ifFalse.getConnectedValue(o)}serialize(){const w=super.serialize();return w.test=this.test,w.epsilon=this.epsilon,w}_deserialize(w){super._deserialize(w),this.test=w.test,void 0!==w.epsilon&&(this.epsilon=w.epsilon)}}(0,g.b)([Fo("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:zH.Equal},{label:"NotEqual",value:zH.NotEqual},{label:"LessThan",value:zH.LessThan},{label:"GreaterThan",value:zH.GreaterThan},{label:"LessOrEqual",value:zH.LessOrEqual},{label:"GreaterOrEqual",value:zH.GreaterOrEqual},{label:"Xor",value:zH.Xor},{label:"Or",value:zH.Or},{label:"And",value:zH.And}]})],MH.prototype,"test",void 0),(0,g.b)([Fo("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],MH.prototype,"epsilon",void 0),(0,t.g)("BABYLON.ParticleConditionBlock",MH);class iH extends Ko{constructor(w){super(w),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",jo.Particle),this.registerInput("condition",jo.Float,!0,0),this.registerInput("system",jo.System),this.registerOutput("output",jo.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(w){this._triggerCount=0;const o=this.input.getConnectedValue(w),H={process:H=>{if(w.particleContext=H,w.systemContext=o,0!==this.condition.getConnectedValue(w)&&(0===this.limit||this._triggerCount<this.limit)){const h=(new Date).getTime();if(this._previousOne&&h-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=h;const E=this.system.getConnectedValue(w);if(E){const h=mH(E,w.Vo,H.position);h.me.addOnce((()=>{this._triggerCount--})),o.me.addOnce((()=>{h.dispose()}))}}},previousItem:null,nextItem:null};o._updateQueueStart?Rw(H,o._updateQueueStart):o._updateQueueStart=H,this.output._storedValue=o}serialize(){const w=super.serialize();return w.limit=this.limit,w.delay=this.delay,w}_deserialize(w){super._deserialize(w),void 0!==w.limit&&(this.limit=w.limit),void 0!==w.delay&&(this.delay=w.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,g.b)([Fo("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],iH.prototype,"limit",void 0),(0,g.b)([Fo("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],iH.prototype,"delay",void 0),(0,t.g)("BABYLON.ParticleTriggerBlock",iH);H(13126),H(13136),H(13147),H(13205)},13191:(w,o,H)=>{"use strict";var h=H(11625);const E="clipPlaneFragment",e="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13155:(w,o,H)=>{"use strict";var h=H(11625);const E="clipPlaneFragmentDeclaration",e="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13221:(w,o,H)=>{"use strict";var h=H(11625);const E="clipPlaneVertex",e="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13210:(w,o,H)=>{"use strict";var h=H(11625);const E="clipPlaneVertexDeclaration",e="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13199:(w,o,H)=>{"use strict";var h=H(11625);const E="fogFragment",e="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13182:(w,o,H)=>{"use strict";var h=H(11625);const E="fogFragmentDeclaration",e="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13225:(w,o,H)=>{"use strict";var h=H(11625);const E="fogVertex",e="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13218:(w,o,H)=>{"use strict";var h=H(11625);const E="fogVertexDeclaration",e="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13175:(w,o,H)=>{"use strict";var h=H(11625);const E="helperFunctions",e="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13164:(w,o,H)=>{"use strict";var h=H(11625);const E="imageProcessingDeclaration",e="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13178:(w,o,H)=>{"use strict";var h=H(11625);const E="imageProcessingFunctions",e="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13166:(w,o,H)=>{"use strict";var h=H(11625);const E="logDepthDeclaration",e="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13195:(w,o,H)=>{"use strict";var h=H(11625);const E="logDepthFragment",e="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13229:(w,o,H)=>{"use strict";var h=H(11625);const E="logDepthVertex",e="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";h.d.IncludesShadersStoreWGSL[E]||(h.d.IncludesShadersStoreWGSL[E]=e)},13147:(w,o,H)=>{"use strict";H.r(o),H.d(o,{particlesPixelShaderWGSL:()=>D});var h=H(11625);H(13155),H(13164),H(13166),H(13175),H(13178),H(13182),H(13191),H(13195),H(13199);const E="particlesPixelShader",e="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";h.d.ShadersStoreWGSL[E]||(h.d.ShadersStoreWGSL[E]=e);const D={name:E,shader:e}},13205:(w,o,H)=>{"use strict";H.r(o),H.d(o,{particlesVertexShaderWGSL:()=>D});var h=H(11625);H(13210),H(13218),H(13166),H(13221),H(13225),H(13229);const E="particlesVertexShader",e="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";h.d.ShadersStoreWGSL[E]||(h.d.ShadersStoreWGSL[E]=e);const D={name:E,shader:e}},13056:(w,o,H)=>{"use strict";var h=H(11625);const E="clipPlaneFragment",e="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13129:(w,o,H)=>{"use strict";var h=H(11625);const E="clipPlaneFragmentDeclaration",e="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13084:(w,o,H)=>{"use strict";var h=H(11625);const E="clipPlaneVertex",e="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13139:(w,o,H)=>{"use strict";var h=H(11625);const E="clipPlaneVertexDeclaration",e="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13066:(w,o,H)=>{"use strict";var h=H(11625);const E="fogFragment",e="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13050:(w,o,H)=>{"use strict";var h=H(11625);const E="fogFragmentDeclaration",e="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13093:(w,o,H)=>{"use strict";var h=H(11625);const E="fogVertex",e="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13075:(w,o,H)=>{"use strict";var h=H(11625);const E="fogVertexDeclaration",e="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13040:(w,o,H)=>{"use strict";var h=H(11625);const E="helperFunctions",e="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13034:(w,o,H)=>{"use strict";var h=H(11625);const E="imageProcessingDeclaration",e="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13042:(w,o,H)=>{"use strict";var h=H(11625);const E="imageProcessingFunctions",e="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13037:(w,o,H)=>{"use strict";var h=H(11625);const E="logDepthDeclaration",e="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13063:(w,o,H)=>{"use strict";var h=H(11625);const E="logDepthFragment",e="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13101:(w,o,H)=>{"use strict";var h=H(11625);const E="logDepthVertex",e="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";h.d.IncludesShadersStore[E]||(h.d.IncludesShadersStore[E]=e)},13126:(w,o,H)=>{"use strict";H.r(o),H.d(o,{particlesPixelShader:()=>D});var h=H(11625);H(13129),H(13034),H(13037),H(13040),H(13042),H(13050),H(13056),H(13063),H(13066);const E="particlesPixelShader",e="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";h.d.ShadersStore[E]||(h.d.ShadersStore[E]=e);const D={name:E,shader:e}},13136:(w,o,H)=>{"use strict";H.r(o),H.d(o,{particlesVertexShader:()=>D});var h=H(11625);H(13139),H(13075),H(13037),H(13084),H(13093),H(13101);const E="particlesVertexShader",e="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";h.d.ShadersStore[E]||(h.d.ShadersStore[E]=e);const D={name:E,shader:e}},13513:(w,o,H)=>{"use strict";H.r(o),H.d(o,{FlowGraphGLTFDataProvider:()=>e});var h=H(13475),E=H(13455);class e extends h.c{constructor(w){var o,H;super();const h=w.glTF,e=(null===(o=h.animations)||void 0===o?void 0:o.map((w=>w._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",E.e,e);const D=(null===(H=h.nodes)||void 0===H?void 0:H.map((w=>w._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",E.e,D)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13385:(w,o,H)=>{"use strict";H.d(o,{d:()=>i,h:()=>Q,l:()=>C,p:()=>M});var h=H(11720),E=H(12189),e=H(11757),D=H(13392);const t=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class X{constructor(w,o){this._gltf=w,this._infoTree=o}convert(w){let o,H=this._gltf,h=this._infoTree;if(!w.startsWith("/"))throw new Error("Path must start with a /");const E=w.split("/");if(E.shift(),E[E.length-1].includes(".length")){const w=E[E.length-1].split(".");E.pop(),E.push(...w)}let e=!1;for(const X of E){const E="length"===X;if(E&&!h.__array__)throw new Error(`Path ${w} is invalid`);if(h.__ignoreObjectTree__&&(e=!0),h.__array__&&!E)h=h.__array__;else if(h=h[X],!h)throw new Error(`Path ${w} is invalid`);if(!e)if(void 0===H){if(!t.find((o=>o.regex.test(w))))throw new Error(`Path ${w} is invalid`)}else if(!E){var D;H=null===(D=H)||void 0===D?void 0:D[X]}(h.__target__||E)&&(o=H)}return{object:o,info:h}}}function L(w,o,H,h){const E=A(w,o);return h?E[H][h]:E[H]}function A(w,o,H){var h,e;return null===(h=w._data)||void 0===h||null===(e=h[(null===H||void 0===H?void 0:H.fillMode)??E.e.MATERIAL_TriangleFillMode])||void 0===e?void 0:e.babylonMaterial}function y(w,o){return{offset:{componentsCount:2,type:"Vector2",get:(H,E,e)=>{const D=L(H,e,w,o);return new h.Vector2(null===D||void 0===D?void 0:D.uOffset,null===D||void 0===D?void 0:D.vOffset)},getTarget:A,set:(H,h,E,e)=>{const D=L(h,e,w,o);D.uOffset=H.x,D.vOffset=H.y},getPropertyName:[()=>`${w}${o?"."+o:""}.uOffset`,()=>`${w}${o?"."+o:""}.vOffset`]},rotation:{type:"number",get:(H,h,E)=>{var e;return null===(e=L(H,E,w,o))||void 0===e?void 0:e.wAng},getTarget:A,set:(H,h,E,e)=>L(h,e,w,o).wAng=H,getPropertyName:[()=>`${w}${o?"."+o:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(H,E,e)=>{const D=L(H,e,w,o);return new h.Vector2(null===D||void 0===D?void 0:D.uScale,null===D||void 0===D?void 0:D.vScale)},getTarget:A,set:(H,h,E,e)=>{const D=L(h,e,w,o);D.uScale=H.x,D.vScale=H.y},getPropertyName:[()=>`${w}${o?"."+o:""}.uScale`,()=>`${w}${o?"."+o:""}.vScale`]}}}const z={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:w=>{var o,H;return new h.Vector2((null===(o=w._babylonCamera)||void 0===o?void 0:o.orthoLeft)??0,(null===(H=w._babylonCamera)||void 0===H?void 0:H.orthoRight)??0)},set:(w,o)=>{o._babylonCamera&&(o._babylonCamera.orthoLeft=w.x,o._babylonCamera.orthoRight=w.y)},getTarget:w=>w,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:w=>{var o,H;return new h.Vector2((null===(o=w._babylonCamera)||void 0===o?void 0:o.orthoBottom)??0,(null===(H=w._babylonCamera)||void 0===H?void 0:H.orthoTop)??0)},set:(w,o)=>{o._babylonCamera&&(o._babylonCamera.orthoBottom=w.x,o._babylonCamera.orthoTop=w.y)},getTarget:w=>w,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:w=>{var o;return null===(o=w._babylonCamera)||void 0===o?void 0:o.maxZ},set:(w,o)=>{o._babylonCamera&&(o._babylonCamera.maxZ=w)},getTarget:w=>w,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:w=>{var o;return null===(o=w._babylonCamera)||void 0===o?void 0:o.Qe},set:(w,o)=>{o._babylonCamera&&(o._babylonCamera.Qe=w)},getTarget:w=>w,getPropertyName:[()=>"Qe"]}},perspective:{aspectRatio:{type:"number",get:w=>{var o;return null===(o=w._babylonCamera)||void 0===o?void 0:o.getEngine().getAspectRatio(w._babylonCamera)},getTarget:w=>w,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:w=>{var o;return null===(o=w._babylonCamera)||void 0===o?void 0:o.fov},set:(w,o)=>{o._babylonCamera&&(o._babylonCamera.fov=w)},getTarget:w=>w,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:w=>{var o;return null===(o=w._babylonCamera)||void 0===o?void 0:o.maxZ},set:(w,o)=>{o._babylonCamera&&(o._babylonCamera.maxZ=w)},getTarget:w=>w,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:w=>{var o;return null===(o=w._babylonCamera)||void 0===o?void 0:o.Qe},set:(w,o)=>{o._babylonCamera&&(o._babylonCamera.Qe=w)},getTarget:w=>w,getPropertyName:[()=>"Qe"]}}}},nodes:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"io",get:w=>{var o;return null===(o=w._babylonTransformNode)||void 0===o?void 0:o.position},set:(w,o)=>{var H;return null===(H=o._babylonTransformNode)||void 0===H?void 0:H.position.t(w)},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:w=>{var o;return null===(o=w._babylonTransformNode)||void 0===o?void 0:o.rotationQuaternion},set:(w,o)=>{var H,h;return null===(H=o._babylonTransformNode)||void 0===H||null===(h=H.rotationQuaternion)||void 0===h?void 0:h.t(w)},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"io",get:w=>{var o;return null===(o=w._babylonTransformNode)||void 0===o?void 0:o.Je},set:(w,o)=>{var H;return null===(H=o._babylonTransformNode)||void 0===H?void 0:H.Je.t(w)},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"Je"]},weights:{length:{type:"number",get:w=>w._numMorphTargets,getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(w,o)=>{var H,h;return void 0!==o?null===(H=w._primitiveBabylonMeshes)||void 0===H||null===(h=H[0].morphTargetManager)||void 0===h?void 0:h.getTarget(o).influence:void 0},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(w,o)=>[0],getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:w=>{var o,H,E;return h.Matrix.Compose(null===(o=w._babylonTransformNode)||void 0===o?void 0:o.Je,null===(H=w._babylonTransformNode)||void 0===H?void 0:H.rotationQuaternion,null===(E=w._babylonTransformNode)||void 0===E?void 0:E.position)},getTarget:w=>w._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:w=>{var o,H,E,e;const D=h.Matrix.Identity();let t=w.parent;for(;t&&t.parent;)t=t.parent;const X=(null===(o=w._babylonTransformNode)||void 0===o?void 0:o.position._isDirty)||(null===(H=w._babylonTransformNode)||void 0===H||null===(E=H.rotationQuaternion)||void 0===E?void 0:E._isDirty)||(null===(e=w._babylonTransformNode)||void 0===e?void 0:e.Je._isDirty);if(t){var L;const o=null===(L=t._babylonTransformNode)||void 0===L?void 0:L.se(!0).invert();var A,y;if(o)null===(A=w._babylonTransformNode)||void 0===A||null===(y=A.se(X))||void 0===y||y.multiplyToRef(o,D)}else w._babylonTransformNode&&D.t(w._babylonTransformNode.se(X));return D},getTarget:w=>w._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:w=>{var o,H;return null===(o=w._babylonTransformNode)||void 0===o||null===(H=o.getChildren((w=>w instanceof D.c),!0)[0])||void 0===H?void 0:H.Ue},getTarget:w=>{var o;return null===(o=w._babylonTransformNode)||void 0===o?void 0:o.getChildren((w=>w instanceof D.c),!0)[0]},set:(w,o)=>{if(o._babylonTransformNode){const H=o._babylonTransformNode.getChildren((w=>w instanceof D.c),!0)[0];H&&(H.Ue=w)}}},color:{type:"ko",get:w=>{var o,H;return null===(o=w._babylonTransformNode)||void 0===o||null===(H=o.getChildren((w=>w instanceof D.c),!0)[0])||void 0===H?void 0:H.Ze},getTarget:w=>{var o;return null===(o=w._babylonTransformNode)||void 0===o?void 0:o.getChildren((w=>w instanceof D.c),!0)[0]},set:(w,o)=>{if(o._babylonTransformNode){const H=o._babylonTransformNode.getChildren((w=>w instanceof D.c),!0)[0];H&&(H.Ze=w)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"ko",get:(w,o,H)=>A(w,o,H).emissiveColor,set:(w,o,H,h)=>A(o,H,h).emissiveColor.t(w),getTarget:(w,o,H)=>A(w,o,H),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:y("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(w,o,H)=>{var h;return null===(h=L(w,H,"bumpTexture"))||void 0===h?void 0:h.level},set:(w,o,H,h)=>{const E=L(o,h,"bumpTexture");E&&(E.level=w)},getTarget:(w,o,H)=>A(w,o,H),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:y("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(w,o,H)=>A(w,o,H).ambientTextureStrength,set:(w,o,H,h)=>{const E=A(o,H,h);E&&(E.ambientTextureStrength=w)},getTarget:(w,o,H)=>A(w,o,H),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:y("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"ae",get:(w,o,H)=>{const h=A(w,o,H);return e.ae.FromColor3(h.albedoColor,h.alpha)},set:(w,o,H,h)=>{const E=A(o,H,h);E.albedoColor.set(w.r,w.g,w.b),E.alpha=w.a},getTarget:(w,o,H)=>A(w,o,H),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:y("albedoTexture")}},metallicFactor:{type:"number",get:(w,o,H)=>A(w,o,H).metallic,set:(w,o,H,h)=>{const E=A(o,H,h);E&&(E.metallic=w)},getTarget:(w,o,H)=>A(w,o,H),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(w,o,H)=>A(w,o,H).roughness,set:(w,o,H,h)=>{const E=A(o,H,h);E&&(E.roughness=w)},getTarget:(w,o,H)=>A(w,o,H),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:y("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(w,o,H)=>A(w,o,H).anisotropy.Ue,set:(w,o,H,h)=>{A(o,H,h).anisotropy.Ue=w},getTarget:(w,o,H)=>A(w,o,H),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(w,o,H)=>A(w,o,H).anisotropy.angle,set:(w,o,H,h)=>{A(o,H,h).anisotropy.angle=w},getTarget:(w,o,H)=>A(w,o,H),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:y("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(w,o,H)=>A(w,o,H).clearCoat.Ue,set:(w,o,H,h)=>{A(o,H,h).clearCoat.Ue=w},getTarget:(w,o,H)=>A(w,o,H),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(w,o,H)=>A(w,o,H).clearCoat.roughness,set:(w,o,H,h)=>{A(o,H,h).clearCoat.roughness=w},getTarget:(w,o,H)=>A(w,o,H),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:y("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(w,o,H)=>{var h;return null===(h=A(w,o,H).clearCoat.bumpTexture)||void 0===h?void 0:h.level},getTarget:A,set:(w,o,H,h)=>A(o,H,h).clearCoat.bumpTexture.level=w},extensions:{KHR_texture_transform:y("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:y("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(w,o,H)=>A(w,o,H).subSurface.dispersion,getTarget:A,set:(w,o,H,h)=>A(o,H,h).subSurface.dispersion=w}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(w,o,H)=>A(w,o,H).emissiveIntensity,getTarget:A,set:(w,o,H,h)=>A(o,H,h).emissiveIntensity=w}},KHR_materials_ior:{ior:{type:"number",get:(w,o,H)=>A(w,o,H).indexOfRefraction,getTarget:A,set:(w,o,H,h)=>A(o,H,h).indexOfRefraction=w}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(w,o,H)=>A(w,o,H).iridescence.Ue,getTarget:A,set:(w,o,H,h)=>A(o,H,h).iridescence.Ue=w},iridescenceIor:{type:"number",get:(w,o,H)=>A(w,o,H).iridescence.indexOfRefraction,getTarget:A,set:(w,o,H,h)=>A(o,H,h).iridescence.indexOfRefraction=w},iridescenceTexture:{extensions:{KHR_texture_transform:y("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(w,o,H)=>A(w,o,H).iridescence.maximumThickness,getTarget:A,set:(w,o,H,h)=>A(o,H,h).iridescence.maximumThickness=w},iridescenceThicknessMinimum:{type:"number",get:(w,o,H)=>A(w,o,H).iridescence.minimumThickness,getTarget:A,set:(w,o,H,h)=>A(o,H,h).iridescence.minimumThickness=w},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:y("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"ko",get:(w,o,H)=>A(w,o,H).sheen.color,getTarget:A,set:(w,o,H,h)=>A(o,H,h).sheen.color.t(w)},sheenColorTexture:{extensions:{KHR_texture_transform:y("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(w,o,H)=>A(w,o,H).sheen.Ue,getTarget:A,set:(w,o,H,h)=>A(o,H,h).sheen.Ue=w},sheenRoughnessTexture:{extensions:{KHR_texture_transform:y("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(w,o,H)=>A(w,o,H).metallicF0Factor,getTarget:A,set:(w,o,H,h)=>A(o,H,h).metallicF0Factor=w,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"ko",get:(w,o,H)=>A(w,o,H).metallicReflectanceColor,getTarget:A,set:(w,o,H,h)=>A(o,H,h).metallicReflectanceColor.t(w),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:y("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:y("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(w,o,H)=>A(w,o,H).subSurface.refractionIntensity,getTarget:A,set:(w,o,H,h)=>A(o,H,h).subSurface.refractionIntensity=w,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:y("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(w,o,H)=>A(w,o,H).subSurface.translucencyIntensity,getTarget:A,set:(w,o,H,h)=>A(o,H,h).subSurface.translucencyIntensity=w},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:y("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"ko",get:(w,o,H)=>A(w,o,H).subSurface.translucencyColor,getTarget:A,set:(w,o,H,h)=>{var E;return w&&(null===(E=A(o,H,h).subSurface.translucencyColor)||void 0===E?void 0:E.t(w))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:y("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"ko",get:(w,o,H)=>A(w,o,H).subSurface.tintColor,getTarget:A,set:(w,o,H,h)=>A(o,H,h).subSurface.tintColor.t(w)},attenuationDistance:{type:"number",get:(w,o,H)=>A(w,o,H).subSurface.tintColorAtDistance,getTarget:A,set:(w,o,H,h)=>A(o,H,h).subSurface.tintColorAtDistance=w},thicknessFactor:{type:"number",get:(w,o,H)=>A(w,o,H).subSurface.maximumThickness,getTarget:A,set:(w,o,H,h)=>A(o,H,h).subSurface.maximumThickness=w},thicknessTexture:{extensions:{KHR_texture_transform:y("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonLight)),getPropertyName:[w=>"length"]},__array__:{__target__:!0,color:{type:"ko",get:w=>{var o;return null===(o=w._babylonLight)||void 0===o?void 0:o.Ze},set:(w,o)=>{var H;return null===(H=o._babylonLight)||void 0===H?void 0:H.Ze.t(w)},getTarget:w=>w._babylonLight,getPropertyName:[w=>"diffuse"]},Ue:{type:"number",get:w=>{var o;return null===(o=w._babylonLight)||void 0===o?void 0:o.Ue},set:(w,o)=>o._babylonLight?o._babylonLight.Ue=w:void 0,getTarget:w=>w._babylonLight,getPropertyName:[w=>"intensity"]},range:{type:"number",get:w=>{var o;return null===(o=w._babylonLight)||void 0===o?void 0:o.range},set:(w,o)=>o._babylonLight?o._babylonLight.range=w:void 0,getTarget:w=>w._babylonLight,getPropertyName:[w=>"range"]},spot:{innerConeAngle:{type:"number",get:w=>{var o;return null===(o=w._babylonLight)||void 0===o?void 0:o.innerAngle},set:(w,o)=>o._babylonLight?o._babylonLight.innerAngle=w:void 0,getTarget:w=>w._babylonLight,getPropertyName:[w=>"innerConeAngle"]},outerConeAngle:{type:"number",get:w=>{var o;return null===(o=w._babylonLight)||void 0===o?void 0:o.angle},set:(w,o)=>o._babylonLight?o._babylonLight.angle=w:void 0,getTarget:w=>w._babylonLight,getPropertyName:[w=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonLight)),getPropertyName:[w=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonTexture)),getPropertyName:[w=>"length"]},__array__:{__target__:!0,Ue:{type:"number",get:w=>{var o;return null===(o=w._babylonTexture)||void 0===o?void 0:o.level},set:(w,o)=>{o._babylonTexture&&(o._babylonTexture.level=w)},getTarget:w=>w._babylonTexture},rotation:{type:"Quaternion",get:w=>{var o;return w._babylonTexture&&h.Quaternion.FromRotationMatrix(null===(o=w._babylonTexture)||void 0===o?void 0:o.getReflectionTextureMatrix())},set:(w,o)=>{var H;o._babylonTexture&&(null!==(H=o._babylonTexture.Ow())&&void 0!==H&&H.useRightHandedSystem||(w=h.Quaternion.Inverse(w)),h.Matrix.FromQuaternionToRef(w,o._babylonTexture.getReflectionTextureMatrix()))},getTarget:w=>w._babylonTexture}}}}},animations:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>w._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:w=>w.length,getTarget:w=>w.map((w=>{var o;return null===(o=w.primitives[0]._instanceData)||void 0===o?void 0:o.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function C(w){return new X(w,z)}function Q(w){const o=w.split("/").map((w=>w.replace(/{}/g,"__array__")));let H=z;for(const h of o)h&&(H=H[h]);if(H&&H.type&&H.get)return H}function M(w,o){const H=w.split("/").map((w=>w.replace(/{}/g,"__array__")));let h=z;for(const E of H)E&&(h=h[E]);h&&h.type&&h.get&&(h.interpolation=o)}function i(w,o){const H=w.split("/").map((w=>w.replace(/{}/g,"__array__")));let h=z;for(const E of H)if(E){if(!h[E]){if("?"===E){h.__ignoreObjectTree__=!0;continue}h[E]={},"__array__"===E&&(h[E].__target__=!0)}h=h[E]}Object.assign(h,o)}},13400:(w,o,H)=>{"use strict";H.r(o),H.d(o,{AnimationPropertyInfo:()=>L,TransformNodeAnimationPropertyInfo:()=>A,WeightAnimationPropertyInfo:()=>y,getQuaternion:()=>t,getVector3:()=>D,getWeights:()=>X});var h=H(12247),E=H(11720),e=H(13385);function D(w,o,H,h){return E.io.Po(o,H).scaleInPlace(h)}function t(w,o,H,h){return E.Quaternion.Po(o,H).scaleInPlace(h)}function X(w,o,H,h){const E=new Array(w._numMorphTargets);for(let e=0;e<E.length;e++)E[e]=o[H++]*h;return E}class L{constructor(w,o,H,h){this.type=w,this.name=o,this.getValue=H,this.getStride=h}_buildAnimation(w,o,H){const E=new h.b(w,this.name,o,this.type);return E.setKeys(H),E}}class A extends L{buildAnimations(w,o,H,h){const E=[];return E.push({babylonAnimatable:w._babylonTransformNode,babylonAnimation:this._buildAnimation(o,H,h)}),E}}class y extends L{buildAnimations(w,o,H,E){const e=[];if(w._numMorphTargets)for(let D=0;D<w._numMorphTargets;D++){const t=new h.b(`${o}_${D}`,this.name,H,this.type);if(t.setKeys(E.map((w=>({frame:w.frame,inTangent:w.inTangent?w.inTangent[D]:void 0,value:w.value[D],outTangent:w.outTangent?w.outTangent[D]:void 0,interpolation:w.interpolation})))),w._primitiveBabylonMeshes)for(const o of w._primitiveBabylonMeshes)if(o.morphTargetManager){const w=o.morphTargetManager.getTarget(D),H=t.clone();w.animations.push(H),e.push({babylonAnimatable:w,babylonAnimation:H})}}return e}}(0,e.p)("/nodes/{}/translation",[new A(h.b.ANIMATIONTYPE_VECTOR3,"position",D,(()=>3))]),(0,e.p)("/nodes/{}/rotation",[new A(h.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",t,(()=>4))]),(0,e.p)("/nodes/{}/scale",[new A(h.b.ANIMATIONTYPE_VECTOR3,"Je",D,(()=>3))]),(0,e.p)("/nodes/{}/weights",[new y(h.b.ANIMATIONTYPE_FLOAT,"influence",X,(w=>w._numMorphTargets))])},13349:(w,o,H)=>{"use strict";class h{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((w,o)=>{this._resolve=w,this._reject=o}))}}var E=H(11720),e=H(11757),D=H(11531),t=H(12167),X=H(13355),L=H(13371),A=H(11540),y=H(12186),z=H(12247),C=H(12254),Q=H(11571),M=H(11551),i=H(11556);class s{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(w){this._useTextureToStoreBoneMatrices=w,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(w){this._animationPropertiesOverride=w}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(w,o,H){this.name=w,this.id=o,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=E.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new A.b,this.bones=[],this._scene=H||Q.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const h=this._scene.getEngine().getCaps();this._canUseTextureForBones=h.textureFloat&&h.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((w=>!w.getParent()))}getTransformMatrices(w){if(this.needInitialSkinMatrix){if(!w)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return w._bonesTransformMatrices||this.prepare(!0),w._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(w){return this.needInitialSkinMatrix&&w._transformMatrixTexture?w._transformMatrixTexture:this._transformMatrixTexture}Ow(){return this._scene}toString(w){let o=`Name: ${this.name}, nBones: ${this.bones.length}`;if(o+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,w){o+=", Ranges: {";let w=!0;for(const H in this._ranges)w&&(o+=", ",w=!1),o+=H;o+="}"}return o}getBoneIndexByName(w){for(let o=0,H=this.bones.length;o<H;o++)if(this.bones[o].name===w)return o;return-1}createAnimationRange(w,o,H){if(!this._ranges[w]){this._ranges[w]=new C.e(w,o,H);for(let h=0,E=this.bones.length;h<E;h++)this.bones[h].animations[0]&&this.bones[h].animations[0].createRange(w,o,H)}}deleteAnimationRange(w){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let H=0,h=this.bones.length;H<h;H++)this.bones[H].animations[0]&&this.bones[H].animations[0].deleteRange(w,o);this._ranges[w]=null}getAnimationRange(w){return this._ranges[w]||null}getAnimationRanges(){const w=[];let o;for(o in this._ranges)w.push(this._ranges[o]);return w}copyAnimationRange(w,o){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[o]||!w.getAnimationRange(o))return!1;let h=!0;const E=this._getHighestAnimationFrame()+1,e={},D=w.bones;let t,X;for(X=0,t=D.length;X<t;X++)e[D[X].name]=D[X];this.bones.length!==D.length&&(M.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${D.length}`),h=!1);const L=H&&this.dimensionsAtRest&&w.dimensionsAtRest?this.dimensionsAtRest.divide(w.dimensionsAtRest):null;for(X=0,t=this.bones.length;X<t;X++){const w=this.bones[X].name,D=e[w];D?h=h&&this.bones[X].copyAnimationRange(D,o,E,H,L):(M.d.Warn("copyAnimationRange: not same rig, missing source bone "+w),h=!1)}const A=w.getAnimationRange(o);return A&&(this._ranges[o]=new C.e(o,A.from+E,A.to+E)),h}returnToRest(){for(const w of this.bones)-1!==w._index&&w.returnToRest()}_getHighestAnimationFrame(){let w=0;for(let o=0,H=this.bones.length;o<H;o++)if(this.bones[o].animations[0]){const H=this.bones[o].animations[0].getHighestFrame();w<H&&(w=H)}return w}beginAnimation(w,o,H,h){const E=this.getAnimationRange(w);return E?this._scene.beginAnimation(this,E.from,E.to,o,H,h):null}static MakeAnimationAdditive(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;const h=w.getAnimationRange(H);if(!h)return null;const E=w._scene.getAllAnimatablesByTarget(w);let e=null;for(let t=0;t<E.length;t++){const w=E[t];if(w.fromFrame===(null===h||void 0===h?void 0:h.from)&&w.toFrame===(null===h||void 0===h?void 0:h.to)){e=w;break}}const D=w.getAnimatables();for(let t=0;t<D.length;t++){const w=D[t].animations;if(w)for(let h=0;h<w.length;h++)z.b.MakeAnimationAdditive(w[h],o,H)}return e&&(e.isAdditive=!0),w}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(w){this._meshesWithPoseMatrix.push(w)}_unregisterMeshWithPoseMatrix(w){const o=this._meshesWithPoseMatrix.indexOf(w);o>-1&&this._meshesWithPoseMatrix.splice(o,1)}_computeTransformMatrices(w,o){this.onBeforeComputeObservable.notifyObservers(this);for(let H=0;H<this.bones.length;H++){const h=this.bones[H];h._childUpdateId++;const E=h.getParent();if(E?h.getLocalMatrix().multiplyToRef(E.getFinalMatrix(),h.getFinalMatrix()):o?h.getLocalMatrix().multiplyToRef(o,h.getFinalMatrix()):h.getFinalMatrix().t(h.getLocalMatrix()),-1!==h._index){const o=null===h._index?H:h._index;h.getAbsoluteInverseBindMatrix().multiplyToArray(h.getFinalMatrix(),w,16*o)}}this._identity.copyToArray(w,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const w=this.Ow().getRenderId();if(this._currentRenderId===w)return;this._currentRenderId=w}if(this._numBonesWithLinkedTransformNode>0)for(const w of this.bones)if(w._linkedTransformNode){const o=w._linkedTransformNode;w.position=o.position,o.rotationQuaternion?w.rotationQuaternion=o.rotationQuaternion:w.rotation=o.rotation,w.Je=o.Je}if(this.needInitialSkinMatrix)for(const w of this._meshesWithPoseMatrix){const o=w.getPoseMatrix();let H=this._isDirty;if(w._bonesTransformMatrices&&w._bonesTransformMatrices.length===16*(this.bones.length+1)||(w._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),H=!0),H){if(this._synchronizedWithMesh!==w){this._synchronizedWithMesh=w;for(const w of this.bones)if(!w.getParent()){w.getBindMatrix().multiplyToRef(o,E.TmpVectors.Matrix[1]),w._updateAbsoluteBindMatrices(E.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const o=4*(this.bones.length+1);w._transformMatrixTexture&&w._transformMatrixTexture.getSize().width===o||(w._transformMatrixTexture&&w._transformMatrixTexture.dispose(),w._transformMatrixTexture=y.c.CreateRGBATexture(w._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(w._bonesTransformMatrices,o),this.isUsingTextureForMatrices&&w._transformMatrixTexture&&w._transformMatrixTexture.update(w._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=y.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let w=0;w<this.bones.length;w++)this._animatables.push(this.bones[w])}return this._animatables}clone(w,o){const H=new s(w,o||w,this._scene);H.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let h=0;h<this.bones.length;h++){const w=this.bones[h];let o=null;const E=w.getParent();if(E){const w=this.bones.indexOf(E);o=H.bones[w]}const e=new L.c(w.name,H,o,w.getBindMatrix().clone(),w.getRestMatrix().clone());e._index=w._index,w._linkedTransformNode&&e.linkTransformNode(w._linkedTransformNode),i.d.DeepCopy(w.animations,e.animations)}if(this._ranges){H._ranges={};for(const w in this._ranges){const o=this._ranges[w];o&&(H._ranges[w]=o.clone())}}return this._isDirty=!0,H.prepare(!0),H}enableBlending(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const o of this.bones)for(const H of o.animations)H.enableBlending=!0,H.blendingSpeed=w}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Ow().stopAnimation(this),this.Ow().removeSkeleton(this),this._parentContainer){const w=this._parentContainer.skeletons.indexOf(this);w>-1&&this._parentContainer.skeletons.splice(w,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const w={};w.name=this.name,w.id=this.id,this.dimensionsAtRest&&(w.dimensionsAtRest=this.dimensionsAtRest.Ae()),w.bones=[],w.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let H=0;H<this.bones.length;H++){var o;const h=this.bones[H],E=h.getParent(),e={parentBoneIndex:E?this.bones.indexOf(E):-1,index:h.getIndex(),name:h.name,id:h.id,matrix:h.getBindMatrix().Ae(),rest:h.getRestMatrix().Ae(),linkedTransformNodeId:null===(o=h.getTransformNode())||void 0===o?void 0:o.id};w.bones.push(e),h.length&&(e.length=h.length),h.metadata&&(e.metadata=h.metadata),h.animations&&h.animations.length>0&&(e.animation=h.animations[0].serialize()),w.ranges=[];for(const o in this._ranges){const H=this._ranges[o];if(!H)continue;const h={};h.name=o,h.from=H.from,h.to=H.to,w.ranges.push(h)}}return w}static Parse(w,o){const H=new s(w.name,w.id,o);let h;for(w.dimensionsAtRest&&(H.dimensionsAtRest=E.io.Po(w.dimensionsAtRest)),H.needInitialSkinMatrix=w.needInitialSkinMatrix,h=0;h<w.bones.length;h++){const o=w.bones[h],e=w.bones[h].index;let D=null;o.parentBoneIndex>-1&&(D=H.bones[o.parentBoneIndex]);const t=o.rest?E.Matrix.Po(o.rest):null,X=new L.c(o.name,H,D,E.Matrix.Po(o.matrix),t,null,e);void 0!==o.id&&null!==o.id&&(X.id=o.id),o.length&&(X.length=o.length),o.metadata&&(X.metadata=o.metadata),o.animation&&X.animations.push(z.b.Parse(o.animation)),void 0!==o.linkedTransformNodeId&&null!==o.linkedTransformNodeId&&(H._hasWaitingData=!0,X._waitingTransformNodeId=o.linkedTransformNodeId)}if(w.ranges)for(h=0;h<w.ranges.length;h++){const o=w.ranges[h];H.createAnimationRange(o.name,o.from,o.to)}return H}computeAbsoluteMatrices(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||w)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(w)}getPoseMatrix(){let w=null;return this._meshesWithPoseMatrix.length>0&&(w=this._meshesWithPoseMatrix[0].getPoseMatrix()),w}sortBones(){const w=[],o=new Array(this.bones.length);for(let H=0;H<this.bones.length;H++)this._sortBones(H,w,o);this.bones=w}_sortBones(w,o,H){if(H[w])return;H[w]=!0;const h=this.bones[w];if(!h)return;void 0===h._index&&(h._index=w);const E=h.getParent();E&&this._sortBones(this.bones.indexOf(E),o,H),o.push(h)}setCurrentPoseAsRest(){for(const w of this.bones)w.setCurrentPoseAsRest()}}var V=H(12033),r=H(12201),k=H(11690),P=H(12128),l=H(11780),O=H(12171),T=H(12135),S=H(12165),c=H(12256),W=H(11807),B=H(13316);class J{set areUpdatesFrozen(w){w?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new W.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,w||(w=Q.e.LastCreatedScene),this._scene=w,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const w=this._scene.getEngine().getCaps();this._canUseTextureForTargets=w.canUseGLVertexID&&w.textureFloat&&w.maxVertexTextureImageUnits>0&&w.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return J.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?J.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(w){this._numMaxInfluencers!==w&&(this._numMaxInfluencers=w,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(w){this._useTextureToStoreTargets!==w&&(this._useTextureToStoreTargets=w,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var w;return J.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(w=this._scene)&&void 0!==w&&w.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(w){return this._activeTargets.data[w]}getTarget(w){return this._targets[w]}getTargetByName(w){for(const o of this._targets)if(o.name===w)return o;return null}addTarget(w){this._targets.push(w),this._targetInfluenceChangedObservers.push(w.onInfluenceChanged.add((w=>{this.areUpdatesFrozen&&w&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(w)}))),this._targetDataLayoutChangedObservers.push(w._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(w){const o=this._targets.indexOf(w);o>=0&&(this._targets.splice(o,1),w.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(o,1)[0]),w._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(o,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(w)}_bind(w){w.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),w.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),w.setTexture("morphTargets",this._targetStoreTexture),w.setInt("morphTargetCount",this.numInfluencers)}clone(){const w=new J(this._scene);for(const o of this._targets)w.addTarget(o.clone());return w.enablePositionMorphing=this.enablePositionMorphing,w.enableNormalMorphing=this.enableNormalMorphing,w.enableTangentMorphing=this.enableTangentMorphing,w.enableUVMorphing=this.enableUVMorphing,w.enableUV2Morphing=this.enableUV2Morphing,w.enableColorMorphing=this.enableColorMorphing,w}serialize(){const w={};w.id=this.uniqueId,w.targets=[];for(const o of this._targets)w.targets.push(o.serialize());return w}_syncActiveTargets(){let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const o=!!this._targetStoreTexture,H=this.isUsingTextureForTargets;(this._mustSynchronize||o!==H)&&(this._mustSynchronize=!1,this.synchronize());let h=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let E=-1;for(const e of this._targets)if(E++,0!==e.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=J.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(e),this._morphTargetTextureIndices[h]=E,this._tempInfluences[h++]=e.influence}this._morphTargetTextureIndices.length!==h&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,h)),this._influences&&this._influences.length===h||(this._influences=new Float32Array(h));for(let e=0;e<h;e++)this._influences[e]=this._tempInfluences[e];if(w&&this._scene)for(const e of this._scene.meshes)e.morphTargetManager===this&&(H?e._markSubMeshesAsAttributesDirty():e._syncGeometryWithMorphTargetManager())}synchronize(){var w;if(!this._scene||this.areUpdatesFrozen)return;const o=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(w=this._targetStoreTexture)||void 0===w||w.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>o.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const H of this._targets){this._supportsPositions=this._supportsPositions&&H.hasPositions,this._supportsNormals=this._supportsNormals&&H.hasNormals,this._supportsTangents=this._supportsTangents&&H.hasTangents,this._supportsUVs=this._supportsUVs&&H.hasUVs,this._supportsUV2s=this._supportsUV2s&&H.hasUV2s,this._supportsColors=this._supportsColors&&H.hasColors;const w=H.vertexCount;if(0===this._vertexCount)this._vertexCount=w;else if(this._vertexCount!==w)return void M.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${H.name}": ${w}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const w=o.getCaps().maxTextureSize;this._textureWidth>w&&(this._textureHeight=Math.ceil(this._textureWidth/w),this._textureWidth=w);const H=this._targets.length,h=new Float32Array(H*this._textureWidth*this._textureHeight*4);let E=0;for(let o=0;o<H;o++){const w=this._targets[o],H=w.getPositions(),e=w.getNormals(),D=w.getUVs(),t=w.getTangents(),X=w.getUV2s(),L=w.getColors();E=o*this._textureWidth*this._textureHeight*4;for(let o=0;o<this._vertexCount;o++)this._supportsPositions&&H&&(h[E]=H[3*o],h[E+1]=H[3*o+1],h[E+2]=H[3*o+2],E+=4),this._supportsNormals&&e&&(h[E]=e[3*o],h[E+1]=e[3*o+1],h[E+2]=e[3*o+2],E+=4),this._supportsUVs&&D&&(h[E]=D[2*o],h[E+1]=D[2*o+1],E+=4),this._supportsTangents&&t&&(h[E]=t[3*o],h[E+1]=t[3*o+1],h[E+2]=t[3*o+2],E+=4),this._supportsUV2s&&X&&(h[E]=X[2*o],h[E+1]=X[2*o+1],E+=4),this._supportsColors&&L&&(h[E]=L[4*o],h[E+1]=L[4*o+1],h[E+2]=L[4*o+2],h[E+3]=L[4*o+3],E+=4)}this._targetStoreTexture=B.b.CreateRGBATexture(h,this._textureWidth,this._textureHeight,H,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const H of this._scene.meshes)H.morphTargetManager===this&&H._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const w=this._parentContainer.morphTargetManagers.indexOf(this);w>-1&&this._parentContainer.morphTargetManagers.splice(w,1),this._parentContainer=null}for(const w of this._targets)this._scene.stopAnimation(w)}}static Parse(w,o){const H=new J(o);for(const h of w.targets)H.addTarget(c.e.Parse(h,o));return H}}J.EnableTextureStorage=!0,J.MaxActiveMorphTargetsInVertexAttributeMode=8,J.ConstantTargetCountForTextureMode=0;var g=H(13379),b=H(11573),p=H(12052);const f=new Map,N=f;function j(w,o,H){q(w)&&M.d.Warn(`Extension with the name '${w}' already exists`),f.set(w,{isGLTFExtension:o,factory:H})}function q(w){return f.delete(w)}var u=H(13385),n=H(12315),G=H(11794);class R{static Get(w,o,H){if(!o||void 0==H||!o[H])throw new Error(`${w}: Failed to find index (${H})`);return o[H]}static TryGet(w,o){return w&&void 0!=o&&w[o]?w[o]:null}static Assign(w){if(w)for(let o=0;o<w.length;o++)w[o].index=o}}function a(w){if(w.min&&w.max){const o=w.min,H=w.max,h=E.TmpVectors.io[0].We(o[0],o[1],o[2]),e=E.TmpVectors.io[1].We(H[0],H[1],H[2]);if(w.normalized&&5126!==w.componentType){let o=1;switch(w.componentType){case 5120:o=127;break;case 5121:o=255;break;case 5122:o=32767;break;case 5123:o=65535}const H=1/o;h.scaleInPlace(H),e.scaleInPlace(H)}return new p.c(h,e)}return null}class d{static RegisterExtension(w,o){j(w,!1,o)}static UnregisterExtension(w){return q(w)}get he(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(w){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=w}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((w=>w.dispose&&w.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(w,o,H,h,E,e){let D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=o,this._assetContainer=H,this._loadData(h);let e=null;if(w){const o={};if(this._gltf.nodes)for(const w of this._gltf.nodes)w.name&&(o[w.name]=w.index);e=(w instanceof Array?w:[w]).map((w=>{const H=o[w];if(void 0===H)throw new Error(`Failed to find node '${w}'`);return H}))}return await this._loadAsync(E,D,e,(()=>({meshes:this._getMeshes(),Ez:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=w,this._loadData(o),await this._loadAsync(H,E,null,(()=>{}))}async _loadAsync(w,o,H,h){return await Promise.resolve().then((async()=>{this._rootUrl=w,this._uniqueRootUrl=!w.startsWith("file:")&&o?w:`${w}${Date.now()}/`,this._fileName=o,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const E=`${g.m[g.m.LOADING]} => ${g.m[g.m.READY]}`,e=`${g.m[g.m.LOADING]} => ${g.m[g.m.COMPLETE]}`;this._parent._startPerformanceCounter(E),this._parent._startPerformanceCounter(e),this._parent._setState(g.m.LOADING),this._extensionsOnLoading();const t=new Array;if(!this.parent.loadOnlyMaterials)if(H)t.push(this.loadSceneAsync("/nodes",{nodes:H,index:-1}));else if(void 0!=this._gltf.Vo||this._gltf.scenes&&this._gltf.scenes[0]){const w=R.Get("/scene",this._gltf.scenes,this._gltf.Vo||0);t.push(this.loadSceneAsync(`/scenes/${w.index}`,w))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let w=0;w<this._gltf.materials.length;++w){const o=this._gltf.materials[w],H="/materials/"+w,h=V.e.TriangleFillMode;t.push(this._loadMaterialAsync(H,o,null,h,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&t.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&t.push(this._compileShadowGeneratorsAsync());const X=Promise.all(t).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Ut(!0);for(const w of this._babylonScene.materials){const o=w;void 0!==o.maxSimultaneousLights&&(o.maxSimultaneousLights=Math.max(o.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(g.m.READY),this._skipStartAnimationStep||this._startAnimations(),h()}));return await X.then((w=>(this._parent._endPerformanceCounter(E),D.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(e),this._parent._setState(g.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(w=>{this._parent.onErrorObservable.notifyObservers(w),this._parent.onErrorObservable.clear(),this.dispose()}))})),w)))})).catch((w=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(w),this._parent.onErrorObservable.clear(),this.dispose()),w}))}_loadData(w){if(this._gltf=w.json,this._setupData(),w.bin){const o=this._gltf.buffers;if(o&&o[0]&&!o[0].uri){const H=o[0];(H.byteLength<w.bin.byteLength-3||H.byteLength>w.bin.byteLength)&&M.d.Warn(`Binary buffer length (${H.byteLength}) from JSON does not match chunk length (${w.bin.byteLength})`),this._bin=w.bin}else M.d.Warn("Unexpected BIN chunk")}}_setupData(){if(R.Assign(this._gltf.accessors),R.Assign(this._gltf.animations),R.Assign(this._gltf.buffers),R.Assign(this._gltf.bufferViews),R.Assign(this._gltf.cameras),R.Assign(this._gltf.images),R.Assign(this._gltf.materials),R.Assign(this._gltf.meshes),R.Assign(this._gltf.nodes),R.Assign(this._gltf.samplers),R.Assign(this._gltf.scenes),R.Assign(this._gltf.skins),R.Assign(this._gltf.textures),this._gltf.nodes){const w={};for(const H of this._gltf.nodes)if(H.children)for(const o of H.children)w[o]=H.index;const o=this._createRootNode();for(const H of this._gltf.nodes){const h=w[H.index];H.parent=void 0===h?o:this._gltf.nodes[h]}}}async _loadExtensionsAsync(){const w=[];if(N.forEach(((o,H)=>{var h;!1===(null===(h=this.parent.extensionOptions[H])||void 0===h?void 0:h.enabled)?o.isGLTFExtension&&this.isExtensionUsed(H)&&M.d.Warn(`Extension ${H} is used but has been explicitly disabled.`):o.isGLTFExtension&&!this.isExtensionUsed(H)||w.push((async()=>{const w=await o.factory(this);return w.name!==H&&M.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${w.name} !== ${H}`),this._parent.onExtensionLoadedObservable.notifyObservers(w),w})())})),this._extensions.push(...await Promise.all(w)),this._extensions.sort(((w,o)=>(w.order||Number.MAX_VALUE)-(o.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const H of this._gltf.extensionsRequired){if(!this._extensions.some((w=>w.name===H&&w.enabled))){var o;if(!1===(null===(o=this.parent.extensionOptions[H])||void 0===o?void 0:o.enabled))throw new Error(`Required extension ${H} is disabled`);throw new Error(`Required extension ${H} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new S.d("__root__",this._babylonScene);this._rootBabylonMesh=w,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Ut(!1);const o={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case g.k.AUTO:this._babylonScene.useRightHandedSystem||(o.rotation=[0,1,0,0],o.scale=[1,1,-1],d._LoadTransform(o,this._rootBabylonMesh));break;case g.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(w),o}loadSceneAsync(w,o){const H=this._extensionsLoadSceneAsync(w,o);if(H)return H;const h=new Array;if(this.logOpen(`${w} ${o.name||""}`),o.nodes)for(const E of o.nodes){const o=R.Get(`${w}/nodes/${E}`,this._gltf.nodes,E);h.push(this.loadNodeAsync(`/nodes/${o.index}`,o,(w=>{w.parent=this._rootBabylonMesh})))}for(const E of this._postSceneLoadActions)E();return h.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(h).then((()=>{}))}_forEachPrimitive(w,o){if(w._primitiveBabylonMeshes)for(const H of w._primitiveBabylonMeshes)o(H)}_getGeometries(){const w=[],o=this._gltf.nodes;if(o)for(const H of o)this._forEachPrimitive(H,(o=>{const H=o.re;H&&-1===w.indexOf(H)&&w.push(H)}));return w}_getMeshes(){const w=[];this._rootBabylonMesh instanceof T.c&&w.push(this._rootBabylonMesh);const o=this._gltf.nodes;if(o)for(const H of o)this._forEachPrimitive(H,(o=>{w.push(o)}));return w}_getTransformNodes(){const w=[],o=this._gltf.nodes;if(o)for(const H of o)H._babylonTransformNode&&"dX"===H._babylonTransformNode.getClassName()&&w.push(H._babylonTransformNode),H._babylonTransformNodeForSkin&&w.push(H._babylonTransformNodeForSkin);return w}_getSkeletons(){const w=[],o=this._gltf.skins;if(o)for(const H of o)H._data&&w.push(H._data.babylonSkeleton);return w}_getAnimationGroups(){const w=[],o=this._gltf.animations;if(o)for(const H of o)H._babylonAnimationGroup&&w.push(H._babylonAnimationGroup);return w}_startAnimations(){switch(this._parent.animationStartMode){case g.h.NONE:break;case g.h.FIRST:{const w=this._getAnimationGroups();0!==w.length&&w[0].start(!0);break}case g.h.ALL:{const w=this._getAnimationGroups();for(const o of w)o.start(!0);break}default:return void M.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const h=this._extensionsLoadNodeAsync(w,o,H);if(h)return h;if(o._babylonTransformNode)throw new Error(`${w}: Invalid recursive node hierarchy`);const E=new Array;this.logOpen(`${w} ${o.name||""}`);const e=h=>{if(d.AddPointerMetadata(h,w),d._LoadTransform(o,h),void 0!=o.camera){const H=R.Get(`${w}/camera`,this._gltf.cameras,o.camera);E.push(this.loadCameraAsync(`/cameras/${H.index}`,H,(w=>{w.parent=h,this._babylonScene.useRightHandedSystem||(h.Je.x=-1)})))}if(o.children)for(const H of o.children){const o=R.Get(`${w}/children/${H}`,this._gltf.nodes,H);E.push(this.loadNodeAsync(`/nodes/${o.index}`,o,(w=>{w.parent=h})))}H(h)},D=void 0!=o.mesh,t=this._parent.loadSkins&&void 0!=o.skin;if(!D||t){const w=o.name||`node${o.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new P.b(w,this._babylonScene);H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==o.mesh?o._babylonTransformNode=H:o._babylonTransformNodeForSkin=H,e(H)}if(D)if(t){const H=R.Get(`${w}/mesh`,this._gltf.meshes,o.mesh);E.push(this._loadMeshAsync(`/meshes/${H.index}`,o,H,(H=>{const h=o._babylonTransformNodeForSkin;H.metadata=(0,n.d)(h.metadata,H.metadata||{});const e=R.Get(`${w}/skin`,this._gltf.skins,o.skin);E.push(this._loadSkinAsync(`/skins/${e.index}`,o,e,(w=>{this._forEachPrimitive(o,(o=>{o.skeleton=w})),this._postSceneLoadActions.push((()=>{if(void 0!=e.skeleton){const w=R.Get(`/skins/${e.index}/skeleton`,this._gltf.nodes,e.skeleton).parent;o.index===w.index?H.parent=h.parent:H.parent=w._babylonTransformNode}else H.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:h,skinnedNode:H})}))})))})))}else{const H=R.Get(`${w}/mesh`,this._gltf.meshes,o.mesh);E.push(this._loadMeshAsync(`/meshes/${H.index}`,o,H,e))}return this.logClose(),Promise.all(E).then((()=>(this._forEachPrimitive(o,(w=>{const o=w;!o.isAnInstance&&o.re&&o.re.useBoundingInfoFromGeometry?w.pw():w.refreshBoundingInfo(!0,!0)})),o._babylonTransformNode)))}_loadMeshAsync(w,o,H,h){const E=H.primitives;if(!E||!E.length)throw new Error(`${w}: Primitives are missing`);void 0==E[0].index&&R.Assign(E);const e=new Array;this.logOpen(`${w} ${H.name||""}`);const D=o.name||`node${o.index}`;if(1===E.length){const h=H.primitives[0];e.push(this._loadMeshPrimitiveAsync(`${w}/primitives/${h.index}`,D,o,H,h,(w=>{o._babylonTransformNode=w,o._primitiveBabylonMeshes=[w]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,o._babylonTransformNode=new P.b(D,this._babylonScene),o._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o._primitiveBabylonMeshes=[];for(const h of E)e.push(this._loadMeshPrimitiveAsync(`${w}/primitives/${h.index}`,`${D}_primitive${h.index}`,o,H,h,(w=>{w.parent=o._babylonTransformNode,o._primitiveBabylonMeshes.push(w)})))}return h(o._babylonTransformNode),this.logClose(),Promise.all(e).then((()=>o._babylonTransformNode))}_loadMeshPrimitiveAsync(w,o,H,h,E,e){const D=this._extensionsLoadMeshPrimitiveAsync(w,o,H,h,E,e);if(D)return D;this.logOpen(`${w}`);const t=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==H.skin&&!h.primitives[0].targets;let X,L;if(t&&E._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,X=E._instanceData.babylonSourceMesh.createInstance(o),X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L=E._instanceData.promise;else{const e=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const D=new S.d(o,this._babylonScene);D._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,D.sideOrientation=this._babylonScene.useRightHandedSystem?V.e.CounterClockWiseSideOrientation:V.e.ClockWiseSideOrientation,this._createMorphTargets(w,H,h,E,D),e.push(this._loadVertexDataAsync(w,E,D).then((async o=>await this._loadMorphTargetsAsync(w,E,D,o).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,o.gw(D),o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const A=d._GetDrawMode(w,E.mode);if(void 0==E.material){let w=this._defaultBabylonMaterialData[A];w||(w=this._createDefaultMaterial("__GLTFLoader._default",A),this._parent.onMaterialLoadedObservable.notifyObservers(w),this._defaultBabylonMaterialData[A]=w),D.material=w}else if(!this.parent.skipMaterials){const o=R.Get(`${w}/material`,this._gltf.materials,E.material);e.push(this._loadMaterialAsync(`/materials/${o.index}`,o,D,A,(w=>{D.material=w})))}L=Promise.all(e),t&&(E._instanceData={babylonSourceMesh:D,promise:L}),X=D}return d.AddPointerMetadata(X,w),this._parent.onMeshLoadedObservable.notifyObservers(X),e(X),this.logClose(),L.then((()=>X))}_loadVertexDataAsync(w,o,H){const h=this._extensionsLoadVertexDataAsync(w,o,H);if(h)return h;const E=o.attributes;if(!E)throw new Error(`${w}: Attributes are missing`);const e=new Array,D=new O.d(H.name,this._babylonScene);if(void 0==o.indices)H.isUnIndexed=!0;else{const H=R.Get(`${w}/indices`,this._gltf.accessors,o.indices);e.push(this._loadIndicesAccessorAsync(`/accessors/${H.index}`,H).then((w=>{D.setIndices(w)})))}const t=(o,h,t)=>{if(void 0==E[o])return;H._delayInfo=H._delayInfo||[],-1===H._delayInfo.indexOf(h)&&H._delayInfo.push(h);const X=R.Get(`${w}/attributes/${o}`,this._gltf.accessors,E[o]);e.push(this._loadVertexAccessorAsync(`/accessors/${X.index}`,X,h).then((w=>{if(w.getKind()===l.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!H.skeleton){const w=a(X);w&&(D._boundingInfo=w,D.useBoundingInfoFromGeometry=!0)}D.setVerticesBuffer(w,X.count)}))),h==l.e.MatricesIndicesExtraKind&&(H.numBoneInfluencers=8),t&&t(X)};return t("POSITION",l.e.PositionKind),t("NORMAL",l.e.NormalKind),t("TANGENT",l.e.TangentKind),t("TEXCOORD_0",l.e.UVKind),t("TEXCOORD_1",l.e.UV2Kind),t("TEXCOORD_2",l.e.UV3Kind),t("TEXCOORD_3",l.e.UV4Kind),t("TEXCOORD_4",l.e.UV5Kind),t("TEXCOORD_5",l.e.UV6Kind),t("JOINTS_0",l.e.MatricesIndicesKind),t("WEIGHTS_0",l.e.MatricesWeightsKind),t("JOINTS_1",l.e.MatricesIndicesExtraKind),t("WEIGHTS_1",l.e.MatricesWeightsExtraKind),t("COLOR_0",l.e.ColorKind,(w=>{"VEC4"===w.type&&(H.hasVertexAlpha=!0)})),Promise.all(e).then((()=>D))}_createMorphTargets(w,o,H,h,E){if(!h.targets||!this._parent.loadMorphTargets)return;if(void 0==o._numMorphTargets)o._numMorphTargets=h.targets.length;else if(h.targets.length!==o._numMorphTargets)throw new Error(`${w}: Primitives do not have the same number of targets`);const e=H.extras?H.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,E.morphTargetManager=new J(this._babylonScene),E.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E.morphTargetManager.areUpdatesFrozen=!0;for(let D=0;D<h.targets.length;D++){const w=o.weights?o.weights[D]:H.weights?H.weights[D]:0,h=e?e[D]:`morphTarget${D}`;E.morphTargetManager.addTarget(new c.e(h,w,E.Ow()))}}_loadMorphTargetsAsync(w,o,H,h){if(!o.targets||!this._parent.loadMorphTargets)return Promise.resolve();const E=new Array,e=H.morphTargetManager;for(let D=0;D<e.numTargets;D++){const H=e.getTarget(D);E.push(this._loadMorphTargetVertexDataAsync(`${w}/targets/${D}`,h,o.targets[D],H))}return Promise.all(E).then((()=>{e.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(w,o,H,h){const E=new Array,e=(h,e,D)=>{if(void 0==H[h])return;const t=o.getVertexBuffer(e);if(!t)return;const X=R.Get(`${w}/${h}`,this._gltf.accessors,H[h]);E.push(this._loadFloatAccessorAsync(`/accessors/${X.index}`,X).then((w=>{D(t,w)})))};return e("POSITION",l.e.PositionKind,((w,o)=>{const H=new Float32Array(o.length);w.forEach(o.length,((w,h)=>{H[h]=o[h]+w})),h.setPositions(H)})),e("NORMAL",l.e.NormalKind,((w,o)=>{const H=new Float32Array(o.length);w.forEach(H.length,((w,h)=>{H[h]=o[h]+w})),h.setNormals(H)})),e("TANGENT",l.e.TangentKind,((w,o)=>{const H=new Float32Array(o.length/3*4);let E=0;w.forEach(o.length/3*4,((w,h)=>{(h+1)%4!==0&&(H[E]=o[E]+w,E++)})),h.setTangents(H)})),e("TEXCOORD_0",l.e.UVKind,((w,o)=>{const H=new Float32Array(o.length);w.forEach(o.length,((w,h)=>{H[h]=o[h]+w})),h.setUVs(H)})),e("TEXCOORD_1",l.e.UV2Kind,((w,o)=>{const H=new Float32Array(o.length);w.forEach(o.length,((w,h)=>{H[h]=o[h]+w})),h.setUV2s(H)})),e("COLOR_0",l.e.ColorKind,((o,H)=>{let E=null;const e=o.getSize();if(3===e){E=new Float32Array(H.length/3*4),o.forEach(H.length,((w,o)=>{const h=Math.floor(o/3),e=o%3;E[4*h+e]=H[3*h+e]+w}));for(let w=0;w<H.length/3;++w)E[4*w+3]=1}else{if(4!==e)throw new Error(`${w}: Invalid number of components (${e}) for COLOR_0 attribute`);E=new Float32Array(H.length),o.forEach(H.length,((w,o)=>{E[o]=H[o]+w}))}h.setColors(E)})),await Promise.all(E).then((()=>{}))}static _LoadTransform(w,o){if(void 0!=w.skin)return;let H=E.io.Zero(),h=E.Quaternion.Identity(),e=E.io.One();if(w.matrix){E.Matrix.Po(w.matrix).decompose(e,h,H)}else w.translation&&(H=E.io.Po(w.translation)),w.rotation&&(h=E.Quaternion.Po(w.rotation)),w.scale&&(e=E.io.Po(w.scale));o.position=H,o.rotationQuaternion=h,o.Je=e}_loadSkinAsync(w,o,H,h){if(!this._parent.loadSkins)return Promise.resolve();const E=this._extensionsLoadSkinAsync(w,o,H);if(E)return E;if(H._data)return h(H._data.babylonSkeleton),H._data.promise;const e=`skeleton${H.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const D=new s(H.name||e,e,this._babylonScene);D._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(w,H,D);const t=this._loadSkinInverseBindMatricesDataAsync(w,H).then((w=>{this._updateBoneMatrices(D,w)}));return H._data={babylonSkeleton:D,promise:t},h(D),t}_loadBones(w,o,H){if(void 0==o.skeleton||this._parent.alwaysComputeSkeletonRootNode){const H=this._findSkeletonRootNode(`${w}/joints`,o.joints);if(H)if(void 0===o.skeleton)o.skeleton=H.index;else{const h=(w,o)=>{for(;o.parent;o=o.parent)if(o.parent===w)return!0;return!1},E=R.Get(`${w}/skeleton`,this._gltf.nodes,o.skeleton);E===H||h(E,H)||(M.d.Warn(`${w}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),o.skeleton=H.index)}else M.d.Warn(`${w}: Failed to find common root`)}const h={};for(const E of o.joints){const e=R.Get(`${w}/joints/${E}`,this._gltf.nodes,E);this._loadBone(e,o,H,h)}}_findSkeletonRootNode(w,o){if(0===o.length)return null;const H={};for(const E of o){const o=[];let h=R.Get(`${w}/${E}`,this._gltf.nodes,E);for(;-1!==h.index;)o.unshift(h),h=h.parent;H[E]=o}let h=null;for(let E=0;;++E){let w=H[o[0]];if(E>=w.length)return h;const e=w[E];for(let D=1;D<o.length;++D)if(w=H[o[D]],E>=w.length||e!==w[E])return h;h=e}}_loadBone(w,o,H,h){w._isJoint=!0;let E=h[w.index];if(E)return E;let e=null;w.index!==o.skeleton&&(w.parent&&-1!==w.parent.index?e=this._loadBone(w.parent,o,H,h):void 0!==o.skeleton&&M.d.Warn(`/skins/${o.index}/skeleton: Skeleton node is not a common root`));const D=o.joints.indexOf(w.index);return E=new L.c(w.name||`joint${w.index}`,H,e,this._getNodeMatrix(w),null,null,D),h[w.index]=E,this._postSceneLoadActions.push((()=>{E.linkTransformNode(w._babylonTransformNode)})),E}_loadSkinInverseBindMatricesDataAsync(w,o){if(void 0==o.inverseBindMatrices)return Promise.resolve(null);const H=R.Get(`${w}/inverseBindMatrices`,this._gltf.accessors,o.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${H.index}`,H)}_updateBoneMatrices(w,o){for(const H of w.bones){const w=E.Matrix.Identity(),h=H._index;o&&-1!==h&&(E.Matrix.FromArrayToRef(o,16*h,w),w.invertToRef(w));const e=H.getParent();e&&w.multiplyToRef(e.getAbsoluteInverseBindMatrix(),w),H.ie(w,!1,!1),H._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(w){return w.matrix?E.Matrix.Po(w.matrix):E.Matrix.Compose(w.scale?E.io.Po(w.scale):E.io.One(),w.rotation?E.Quaternion.Po(w.rotation):E.Quaternion.Identity(),w.translation?E.io.Po(w.translation):E.io.Zero())}loadCameraAsync(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const h=this._extensionsLoadCameraAsync(w,o,H);if(h)return h;const e=new Array;this.logOpen(`${w} ${o.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const D=new X.c(o.name||`camera${o.index}`,E.io.Zero(),this._babylonScene,!1);switch(D._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o._babylonCamera=D,D.setTarget(new E.io(0,0,-1)),o.type){case"perspective":{const H=o.perspective;if(!H)throw new Error(`${w}: Camera perspective properties are missing`);D.fov=H.yfov,D.Qe=H.znear,D.maxZ=H.zfar||0;break}case"orthographic":if(!o.orthographic)throw new Error(`${w}: Camera orthographic properties are missing`);D.mode=t.e.ORTHOGRAPHIC_CAMERA,D.orthoLeft=-o.orthographic.xmag,D.orthoRight=o.orthographic.xmag,D.orthoBottom=-o.orthographic.ymag,D.orthoTop=o.orthographic.ymag,D.Qe=o.orthographic.znear,D.maxZ=o.orthographic.zfar;break;default:throw new Error(`${w}: Invalid camera type (${o.type})`)}return d.AddPointerMetadata(D,w),this._parent.onCameraLoadedObservable.notifyObservers(D),H(D),this.logClose(),Promise.all(e).then((()=>D))}_loadAnimationsAsync(){const w=this._gltf.animations;if(!w)return Promise.resolve();const o=new Array;for(let H=0;H<w.length;H++){const h=w[H];o.push(this.loadAnimationAsync(`/animations/${h.index}`,h).then((w=>{0===w.targetedAnimations.length&&w.dispose()})))}return Promise.all(o).then((()=>{}))}loadAnimationAsync(w,o){const h=this._extensionsLoadAnimationAsync(w,o);return h||H.e(78).then(H.bind(H,14986)).then((H=>{let{AnimationGroup:h}=H;this._babylonScene._blockEntityCollection=!!this._assetContainer;const E=new h(o.name||`animation${o.index}`,this._babylonScene);E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o._babylonAnimationGroup=E;const e=new Array;R.Assign(o.channels),R.Assign(o.samplers);for(const D of o.channels)e.push(this._loadAnimationChannelAsync(`${w}/channels/${D.index}`,w,o,D,((w,o)=>{w.animations=w.animations||[],w.animations.push(o),E.addTargetedAnimation(o,w)})));return Promise.all(e).then((()=>(E.normalize(0),E)))}))}async _loadAnimationChannelAsync(w,o,h,E,e){const D=this._extensionsLoadAnimationChannelAsync(w,o,h,E,e);if(D)return await D;if(void 0==E.target.node)return await Promise.resolve();const t=R.Get(`${w}/target/node`,this._gltf.nodes,E.target.node),X=E.target.path,L="weights"===X;if(L&&!t._numMorphTargets||!L&&!t._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!L&&!t._isJoint)return await Promise.resolve();let A;switch(await Promise.resolve().then(H.bind(H,13400)),X){case"translation":var y;A=null===(y=(0,u.h)("/nodes/{}/translation"))||void 0===y?void 0:y.interpolation;break;case"rotation":var z;A=null===(z=(0,u.h)("/nodes/{}/rotation"))||void 0===z?void 0:z.interpolation;break;case"scale":var C;A=null===(C=(0,u.h)("/nodes/{}/scale"))||void 0===C?void 0:C.interpolation;break;case"weights":var Q;A=null===(Q=(0,u.h)("/nodes/{}/weights"))||void 0===Q?void 0:Q.interpolation;break;default:throw new Error(`${w}/target/path: Invalid value (${E.target.path})`)}if(!A)throw new Error(`${w}/target/path: Could not find interpolation properties for target path (${E.target.path})`);const M={object:t,info:A};return await this._loadAnimationChannelFromTargetInfoAsync(w,o,h,E,M,e)}_loadAnimationChannelFromTargetInfoAsync(w,o,H,h,E,e){const D=this.parent.targetFps,t=1/D,X=R.Get(`${w}/sampler`,H.samplers,h.sampler);return this._loadAnimationSamplerAsync(`${o}/samplers/${h.sampler}`,X).then((w=>{let o=0;const X=E.object,L=E.info;for(const E of L){const L=E.getStride(X),A=w.input,y=w.output,z=new Array(A.length);let C=0;switch(w.interpolation){case"STEP":for(let w=0;w<A.length;w++){const o=E.getValue(X,y,C,1);C+=L,z[w]={frame:A[w]*D,value:o,interpolation:1}}break;case"CUBICSPLINE":for(let w=0;w<A.length;w++){const o=E.getValue(X,y,C,t);C+=L;const H=E.getValue(X,y,C,1);C+=L;const h=E.getValue(X,y,C,t);C+=L,z[w]={frame:A[w]*D,inTangent:o,value:H,outTangent:h}}break;case"LINEAR":for(let w=0;w<A.length;w++){const o=E.getValue(X,y,C,1);C+=L,z[w]={frame:A[w]*D,value:o}}}if(C>0){const w=`${H.name||`animation${H.index}`}_channel${h.index}_${o}`,t=E.buildAnimations(X,w,D,z);for(const H of t)o++,e(H.babylonAnimatable,H.babylonAnimation)}}}))}_loadAnimationSamplerAsync(w,o){if(o._data)return o._data;const H=o.interpolation||"LINEAR";switch(H){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${w}/interpolation: Invalid value (${o.interpolation})`)}const h=R.Get(`${w}/input`,this._gltf.accessors,o.input),E=R.Get(`${w}/output`,this._gltf.accessors,o.output);return o._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${h.index}`,h),this._loadFloatAccessorAsync(`/accessors/${E.index}`,E)]).then((w=>{let[o,h]=w;return{input:o,interpolation:H,output:h}})),o._data}loadBufferAsync(w,o,H,h){const E=this._extensionsLoadBufferAsync(w,o,H,h);if(E)return E;if(!o._data)if(o.uri)o._data=this.loadUriAsync(`${w}/uri`,o,o.uri);else{if(!this._bin)throw new Error(`${w}: Uri is missing or the binary glTF is missing its binary chunk`);o._data=this._bin.readAsync(0,o.byteLength)}return o._data.then((o=>{try{return new Uint8Array(o.buffer,o.byteOffset+H,h)}catch(E){throw new Error(`${w}: ${E.message}`)}}))}loadBufferViewAsync(w,o){const H=this._extensionsLoadBufferViewAsync(w,o);if(H)return H;if(o._data)return o._data;const h=R.Get(`${w}/buffer`,this._gltf.buffers,o.buffer);return o._data=this.loadBufferAsync(`/buffers/${h.index}`,h,o.byteOffset||0,o.byteLength),o._data}_loadAccessorAsync(w,o,H){if(o._data)return o._data;const h=d._GetNumComponents(w,o.type),E=h*l.e.GetTypeByteLength(o.componentType),e=h*o.count;if(void 0==o.bufferView)o._data=Promise.resolve(new H(e));else{const D=R.Get(`${w}/bufferView`,this._gltf.bufferViews,o.bufferView);o._data=this.loadBufferViewAsync(`/bufferViews/${D.index}`,D).then((t=>{if(5126!==o.componentType||o.normalized||D.byteStride&&D.byteStride!==E){const w=new H(e);return l.e.ForEach(t,o.byteOffset||0,D.byteStride||E,h,o.componentType,w.length,o.normalized||!1,((o,H)=>{w[H]=o})),w}return d._GetTypedArray(w,o.componentType,t,o.byteOffset,e)}))}if(o.sparse){const e=o.sparse;o._data=o._data.then((D=>{const t=D,X=R.Get(`${w}/sparse/indices/bufferView`,this._gltf.bufferViews,e.indices.bufferView),L=R.Get(`${w}/sparse/values/bufferView`,this._gltf.bufferViews,e.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${X.index}`,X),this.loadBufferViewAsync(`/bufferViews/${L.index}`,L)]).then((D=>{let[X,L]=D;const A=d._GetTypedArray(`${w}/sparse/indices`,e.indices.componentType,X,e.indices.byteOffset,e.count),y=h*e.count;let z;if(5126!==o.componentType||o.normalized){const D=d._GetTypedArray(`${w}/sparse/values`,o.componentType,L,e.values.byteOffset,y);z=new H(y),l.e.ForEach(D,0,E,h,o.componentType,z.length,o.normalized||!1,((w,o)=>{z[o]=w}))}else z=d._GetTypedArray(`${w}/sparse/values`,o.componentType,L,e.values.byteOffset,y);let C=0;for(let w=0;w<A.length;w++){let o=A[w]*h;for(let w=0;w<h;w++)t[o++]=z[C++]}return t}))}))}return o._data}_loadFloatAccessorAsync(w,o){return this._loadAccessorAsync(w,o,Float32Array)}_loadIndicesAccessorAsync(w,o){if("SCALAR"!==o.type)throw new Error(`${w}/type: Invalid value ${o.type}`);if(5121!==o.componentType&&5123!==o.componentType&&5125!==o.componentType)throw new Error(`${w}/componentType: Invalid value ${o.componentType}`);if(o._data)return o._data;if(o.sparse){const H=d._GetTypedArrayConstructor(`${w}/componentType`,o.componentType);o._data=this._loadAccessorAsync(w,o,H)}else{const H=R.Get(`${w}/bufferView`,this._gltf.bufferViews,o.bufferView);o._data=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((H=>d._GetTypedArray(w,o.componentType,H,o.byteOffset,o.count)))}return o._data}_loadVertexBufferViewAsync(w){if(w._babylonBuffer)return w._babylonBuffer;const o=this._babylonScene.getEngine();return w._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${w.index}`,w).then((w=>new l.d(o,w,!1))),w._babylonBuffer}_loadVertexAccessorAsync(w,o,H){var h;if(null!==(h=o._babylonVertexBuffer)&&void 0!==h&&h[H])return o._babylonVertexBuffer[H];o._babylonVertexBuffer||(o._babylonVertexBuffer={});const E=this._babylonScene.getEngine();if(o.sparse||void 0==o.bufferView)o._babylonVertexBuffer[H]=this._loadFloatAccessorAsync(w,o).then((w=>new l.e(E,w,H,!1)));else{const h=R.Get(`${w}/bufferView`,this._gltf.bufferViews,o.bufferView);o._babylonVertexBuffer[H]=this._loadVertexBufferViewAsync(h).then((e=>{const D=d._GetNumComponents(w,o.type);return new l.e(E,e,H,!1,void 0,h.byteStride,void 0,o.byteOffset,D,o.componentType,o.normalized,!0,void 0,!0)}))}return o._babylonVertexBuffer[H]}_loadMaterialMetallicRoughnessPropertiesAsync(w,o,H){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);const h=new Array;return o&&(o.baseColorFactor?(H.albedoColor=e.ko.Po(o.baseColorFactor),H.alpha=o.baseColorFactor[3]):H.albedoColor=e.ko.White(),H.metallic=void 0==o.metallicFactor?1:o.metallicFactor,H.roughness=void 0==o.roughnessFactor?1:o.roughnessFactor,o.baseColorTexture&&h.push(this.loadTextureInfoAsync(`${w}/baseColorTexture`,o.baseColorTexture,(w=>{w.name=`${H.name} (Base Color)`,H.albedoTexture=w}))),o.metallicRoughnessTexture&&(o.metallicRoughnessTexture.nonColorData=!0,h.push(this.loadTextureInfoAsync(`${w}/metallicRoughnessTexture`,o.metallicRoughnessTexture,(w=>{w.name=`${H.name} (Metallic Roughness)`,H.metallicTexture=w}))),H.useMetallnessFromMetallicTextureBlue=!0,H.useRoughnessFromMetallicTextureGreen=!0,H.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(h).then((()=>{}))}_loadMaterialAsync(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const e=this._extensionsLoadMaterialAsync(w,o,H,h,E);if(e)return e;o._data=o._data||{};let D=o._data[h];if(!D){this.logOpen(`${w} ${o.name||""}`);const H=this.createMaterial(w,o,h);D={babylonMaterial:H,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(w,o,H)},o._data[h]=D,d.AddPointerMetadata(H,w),this._parent.onMaterialLoadedObservable.notifyObservers(H),this.logClose()}return H&&(D.babylonMeshes.push(H),H.me.addOnce((()=>{const w=D.babylonMeshes.indexOf(H);-1!==w&&D.babylonMeshes.splice(w,1)}))),E(D.babylonMaterial),D.promise.then((()=>D.babylonMaterial))}_createDefaultMaterial(w,o){this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new r.c(w,this._babylonScene);return H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.fillMode=o,H.enableSpecularAntiAliasing=!0,H.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,H.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,H.transparencyMode=r.c.PBRMATERIAL_OPAQUE,H.metallic=1,H.roughness=1,H}createMaterial(w,o,H){const h=this._extensionsCreateMaterial(w,o,H);if(h)return h;const E=o.name||`material${o.index}`;return this._createDefaultMaterial(E,H)}loadMaterialPropertiesAsync(w,o,H){const h=this._extensionsLoadMaterialPropertiesAsync(w,o,H);if(h)return h;const E=new Array;return E.push(this.loadMaterialBasePropertiesAsync(w,o,H)),o.pbrMetallicRoughness&&E.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${w}/pbrMetallicRoughness`,o.pbrMetallicRoughness,H)),this.loadMaterialAlphaProperties(w,o,H),Promise.all(E).then((()=>{}))}loadMaterialBasePropertiesAsync(w,o,H){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);const h=new Array;return H.emissiveColor=o.emissiveFactor?e.ko.Po(o.emissiveFactor):new e.ko(0,0,0),o.doubleSided&&(H.Oe=!1,H.twoSidedLighting=!0),o.normalTexture&&(o.normalTexture.nonColorData=!0,h.push(this.loadTextureInfoAsync(`${w}/normalTexture`,o.normalTexture,(w=>{w.name=`${H.name} (Normal)`,H.bumpTexture=w}))),H.invertNormalMapX=!this._babylonScene.useRightHandedSystem,H.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=o.normalTexture.scale&&H.bumpTexture&&(H.bumpTexture.level=o.normalTexture.scale),H.forceIrradianceInFragment=!0),o.occlusionTexture&&(o.occlusionTexture.nonColorData=!0,h.push(this.loadTextureInfoAsync(`${w}/occlusionTexture`,o.occlusionTexture,(w=>{w.name=`${H.name} (Occlusion)`,H.ambientTexture=w}))),H.useAmbientInGrayScale=!0,void 0!=o.occlusionTexture.strength&&(H.ambientTextureStrength=o.occlusionTexture.strength)),o.emissiveTexture&&h.push(this.loadTextureInfoAsync(`${w}/emissiveTexture`,o.emissiveTexture,(w=>{w.name=`${H.name} (Emissive)`,H.emissiveTexture=w}))),Promise.all(h).then((()=>{}))}loadMaterialAlphaProperties(w,o,H){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);switch(o.alphaMode||"OPAQUE"){case"OPAQUE":H.transparencyMode=r.c.PBRMATERIAL_OPAQUE,H.alpha=1;break;case"MASK":H.transparencyMode=r.c.PBRMATERIAL_ALPHATEST,H.alphaCutOff=void 0==o.alphaCutoff?.5:o.alphaCutoff,H.albedoTexture&&(H.albedoTexture.ze=!0);break;case"BLEND":H.transparencyMode=r.c.PBRMATERIAL_ALPHABLEND,H.albedoTexture&&(H.albedoTexture.ze=!0,H.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${w}/alphaMode: Invalid value (${o.alphaMode})`)}}loadTextureInfoAsync(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const h=this._extensionsLoadTextureInfoAsync(w,o,H);if(h)return h;if(this.logOpen(`${w}`),o.texCoord>=6)throw new Error(`${w}/texCoord: Invalid value (${o.texCoord})`);const E=R.Get(`${w}/index`,this._gltf.textures,o.index);E._textureInfo=o;const e=this._loadTextureAsync(`/textures/${o.index}`,E,(h=>{h.coordinatesIndex=o.texCoord||0,d.AddPointerMetadata(h,w),this._parent.onTextureLoadedObservable.notifyObservers(h),H(h)}));return this.logClose(),e}_loadTextureAsync(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const h=this._extensionsLoadTextureAsync(w,o,H);if(h)return h;this.logOpen(`${w} ${o.name||""}`);const E=void 0==o.sampler?d.DefaultSampler:R.Get(`${w}/sampler`,this._gltf.samplers,o.sampler),e=R.Get(`${w}/source`,this._gltf.images,o.source),D=this._createTextureAsync(w,E,e,H,void 0,!o._textureInfo.nonColorData);return this.logClose(),D}_createTextureAsync(w,o,H){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},e=arguments.length>4?arguments[4]:void 0,D=arguments.length>5?arguments[5]:void 0;const t=this._loadSampler(`/samplers/${o.index}`,o),X=new Array,L=new h;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A={noMipmap:t.noMipMaps,invertY:!1,samplingMode:t.samplingMode,v:()=>{this._disposed||L.resolve()},onError:(o,H)=>{this._disposed||L.reject(new Error(`${w}: ${H&&H.message?H.message:o||"Failed to load texture"}`))},mimeType:H.mimeType??(0,b.k)(H.uri??""),loaderOptions:e,useSRGBBuffer:!!D&&this._parent.useSRGBBuffers},y=new k.d(null,this._babylonScene,A);return y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X.push(L.promise),X.push(this.loadImageAsync(`/images/${H.index}`,H).then((w=>{const o=H.uri||`${this._fileName}#image${H.index}`,h=`data:${this._uniqueRootUrl}${o}`;y.updateURL(h,w);const E=y.getInternalTexture();E&&(E.label=H.name)}))),y.wrapU=t.wrapU,y.wrapV=t.wrapV,E(y),this._parent.useGltfTextureNames&&(y.name=H.name||H.uri||`image${H.index}`),Promise.all(X).then((()=>y))}_loadSampler(w,o){return o._data||(o._data={noMipMaps:9728===o.minFilter||9729===o.minFilter,samplingMode:d._GetTextureSamplingMode(w,o),wrapU:d._GetTextureWrapMode(`${w}/wrapS`,o.wrapS),wrapV:d._GetTextureWrapMode(`${w}/wrapT`,o.wrapT)}),o._data}loadImageAsync(w,o){if(!o._data){if(this.logOpen(`${w} ${o.name||""}`),o.uri)o._data=this.loadUriAsync(`${w}/uri`,o,o.uri);else{const H=R.Get(`${w}/bufferView`,this._gltf.bufferViews,o.bufferView);o._data=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H)}this.logClose()}return o._data}loadUriAsync(w,o,H){const h=this._extensionsLoadUriAsync(w,o,H);if(h)return h;if(!d._ValidateUri(H))throw new Error(`${w}: '${H}' is invalid`);if((0,b.m)(H)){const o=new Uint8Array((0,b.d)(H));return this.log(`${w}: Decoded ${H.substring(0,64)}... (${o.length} bytes)`),Promise.resolve(o)}return this.log(`${w}: Loading ${H}`),this._parent.preprocessUrlAsync(this._rootUrl+H).then((o=>new Promise(((h,E)=>{this._parent._loadFile(this._babylonScene,o,(o=>{this._disposed||(this.log(`${w}: Loaded ${H} (${o.byteLength} bytes)`),h(new Uint8Array(o)))}),!0,(o=>{E(new b.n(`${w}: Failed to load '${H}'${o?": "+o.status+" "+o.statusText:""}`,o))}))}))))}static AddPointerMetadata(w,o){w.metadata=w.metadata||{};const H=w._internalMetadata=w._internalMetadata||{},h=H.he=H.he||{};(h.pointers=h.pointers||[]).push(o)}static _GetTextureWrapMode(w,o){switch(o=void 0==o?10497:o){case 33071:return k.d.CLAMP_ADDRESSMODE;case 33648:return k.d.MIRROR_ADDRESSMODE;case 10497:return k.d.WRAP_ADDRESSMODE;default:return M.d.Warn(`${w}: Invalid value (${o})`),k.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(w,o){const H=void 0==o.magFilter?9729:o.magFilter,h=void 0==o.minFilter?9987:o.minFilter;if(9729===H)switch(h){case 9728:return k.d.LINEAR_NEAREST;case 9729:return k.d.LINEAR_LINEAR;case 9984:return k.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return k.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return k.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return k.d.LINEAR_LINEAR_MIPLINEAR;default:return M.d.Warn(`${w}/minFilter: Invalid value (${h})`),k.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==H&&M.d.Warn(`${w}/magFilter: Invalid value (${H})`),h){case 9728:return k.d.NEAREST_NEAREST;case 9729:return k.d.NEAREST_LINEAR;case 9984:return k.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return k.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return k.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return k.d.NEAREST_LINEAR_MIPLINEAR;default:return M.d.Warn(`${w}/minFilter: Invalid value (${h})`),k.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(w,o){try{return(0,G.q)(o)}catch(H){throw new Error(`${w}: ${H.message}`)}}static _GetTypedArray(w,o,H,h,E){const e=H.buffer;h=H.byteOffset+(h||0);const D=d._GetTypedArrayConstructor(`${w}/componentType`,o),t=l.e.GetTypeByteLength(o);return h%t!==0?(M.d.Warn(`${w}: Copying buffer as byte offset (${h}) is not a multiple of component type byte length (${t})`),new D(e.slice(h,h+E*t),0)):new D(e,h,E)}static _GetNumComponents(w,o){switch(o){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${w}: Invalid type (${o})`)}static _ValidateUri(w){return D.Tools.IsBase64(w)||-1===w.indexOf("..")}static _GetDrawMode(w,o){switch(void 0==o&&(o=4),o){case 0:return V.e.PointListDrawMode;case 1:return V.e.LineListDrawMode;case 2:return V.e.LineLoopDrawMode;case 3:return V.e.LineStripDrawMode;case 4:return V.e.TriangleFillMode;case 5:return V.e.TriangleStripDrawMode;case 6:return V.e.TriangleFanDrawMode}throw new Error(`${w}: Invalid mesh primitive mode (${o})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const w=new Array;if(this._gltf.materials)for(const o of this._gltf.materials)if(o._data)for(const H in o._data){const h=o._data[H];for(const o of h.babylonMeshes){o.se(!0);const H=h.babylonMaterial;w.push(H.forceCompilationAsync(o)),w.push(H.forceCompilationAsync(o,{useInstances:!0})),this._parent.useClipPlane&&(w.push(H.forceCompilationAsync(o,{clipPlane:!0})),w.push(H.forceCompilationAsync(o,{clipPlane:!0,useInstances:!0})))}}return Promise.all(w).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const w=new Array,o=this._babylonScene.lights;for(const H of o){const o=H.getShadowGenerator();o&&w.push(o.forceCompilationAsync())}return Promise.all(w).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(w){for(const o of this._extensions)o.enabled&&w(o)}_applyExtensions(w,o,H){for(const h of this._extensions)if(h.enabled){const E=`${h.name}.${o}`,e=w;e._activeLoaderExtensionFunctions=e._activeLoaderExtensionFunctions||{};const D=e._activeLoaderExtensionFunctions;if(!D[E]){D[E]=!0;try{const w=H(h);if(w)return w}finally{delete D[E]}}}return null}_extensionsOnLoading(){this._forEachExtensions((w=>w.onLoading&&w.onLoading()))}_extensionsOnReady(){this._forEachExtensions((w=>w.onReady&&w.onReady()))}_extensionsLoadSceneAsync(w,o){return this._applyExtensions(o,"loadScene",(H=>H.loadSceneAsync&&H.loadSceneAsync(w,o)))}_extensionsLoadNodeAsync(w,o,H){return this._applyExtensions(o,"loadNode",(h=>h.loadNodeAsync&&h.loadNodeAsync(w,o,H)))}_extensionsLoadCameraAsync(w,o,H){return this._applyExtensions(o,"loadCamera",(h=>h.loadCameraAsync&&h.loadCameraAsync(w,o,H)))}_extensionsLoadVertexDataAsync(w,o,H){return this._applyExtensions(o,"loadVertexData",(h=>h._loadVertexDataAsync&&h._loadVertexDataAsync(w,o,H)))}_extensionsLoadMeshPrimitiveAsync(w,o,H,h,E,e){return this._applyExtensions(E,"loadMeshPrimitive",(D=>D._loadMeshPrimitiveAsync&&D._loadMeshPrimitiveAsync(w,o,H,h,E,e)))}_extensionsLoadMaterialAsync(w,o,H,h,E){return this._applyExtensions(o,"loadMaterial",(e=>e._loadMaterialAsync&&e._loadMaterialAsync(w,o,H,h,E)))}_extensionsCreateMaterial(w,o,H){return this._applyExtensions(o,"createMaterial",(h=>h.createMaterial&&h.createMaterial(w,o,H)))}_extensionsLoadMaterialPropertiesAsync(w,o,H){return this._applyExtensions(o,"loadMaterialProperties",(h=>h.loadMaterialPropertiesAsync&&h.loadMaterialPropertiesAsync(w,o,H)))}_extensionsLoadTextureInfoAsync(w,o,H){return this._applyExtensions(o,"loadTextureInfo",(h=>h.loadTextureInfoAsync&&h.loadTextureInfoAsync(w,o,H)))}_extensionsLoadTextureAsync(w,o,H){return this._applyExtensions(o,"loadTexture",(h=>h._loadTextureAsync&&h._loadTextureAsync(w,o,H)))}_extensionsLoadAnimationAsync(w,o){return this._applyExtensions(o,"loadAnimation",(H=>H.loadAnimationAsync&&H.loadAnimationAsync(w,o)))}_extensionsLoadAnimationChannelAsync(w,o,H,h,E){return this._applyExtensions(H,"loadAnimationChannel",(e=>e._loadAnimationChannelAsync&&e._loadAnimationChannelAsync(w,o,H,h,E)))}_extensionsLoadSkinAsync(w,o,H){return this._applyExtensions(H,"loadSkin",(h=>h._loadSkinAsync&&h._loadSkinAsync(w,o,H)))}_extensionsLoadUriAsync(w,o,H){return this._applyExtensions(o,"loadUri",(h=>h._loadUriAsync&&h._loadUriAsync(w,o,H)))}_extensionsLoadBufferViewAsync(w,o){return this._applyExtensions(o,"loadBufferView",(H=>H.loadBufferViewAsync&&H.loadBufferViewAsync(w,o)))}_extensionsLoadBufferAsync(w,o,H,h){return this._applyExtensions(o,"loadBuffer",(E=>E.loadBufferAsync&&E.loadBufferAsync(w,o,H,h)))}static LoadExtensionAsync(w,o,H,h){if(!o.extensions)return null;const E=o.extensions[H];return E?h(`${w}/extensions/${H}`,E):null}static LoadExtraAsync(w,o,H,h){if(!o.extras)return null;const E=o.extras[H];return E?h(`${w}/extras/${H}`,E):null}isExtensionUsed(w){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(w)}logOpen(w){this._parent._logOpen(w)}logClose(){this._parent._logClose()}log(w){this._parent._log(w)}startPerformanceCounter(w){this._parent._startPerformanceCounter(w)}endPerformanceCounter(w){this._parent._endPerformanceCounter(w)}}d.DefaultSampler={index:-1},g.e._CreateGLTF2Loader=w=>new d(w);var I=H(13400),U=H(11902),Z=H(11745),K=H(13404),F=H(13412);class v extends F.d{constructor(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,e=arguments.length>5&&void 0!==arguments[5]&&arguments[5],D=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",w),this._texture=w.getEngine().createRawCubeTexture(o,H,h,E,e,D,t,X)}update(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,w,o,H,h,E)}updateRGBDAsync(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,K.k)(this._texture,w,o,H,h).then((()=>{}))}clone(){return Z.e.Clone((()=>{const w=this.Ow(),o=this._texture,H=new v(w,o._bufferViewArray,o.width,o.format,o.type,o.generateMipMaps,o.invertY,o.samplingMode,o._compression);return 13===o.source&&H.updateRGBDAsync(o._bufferViewArrayArray,o._sphericalPolynomial,o._lodGenerationScale,o._lodGenerationOffset),H}),this)}}const mw="EXT_lights_image_based";class Y{constructor(w){this.name=mw,this._loader=w,this.enabled=this._loader.isExtensionUsed(mw)}dispose(){this._loader=null,delete this._lights}onLoading(){const w=this._loader.he.extensions;if(w&&w[this.name]){const o=w[this.name];this._lights=o.lights}}loadSceneAsync(w,o){return d.LoadExtensionAsync(w,o,this.name,(async(H,h)=>{this._loader._allMaterialsDirtyRequired=!0;const E=new Array;E.push(this._loader.loadSceneAsync(w,o)),this._loader.logOpen(`${H}`);const e=R.Get(`${H}/light`,this._lights,h.qh);return E.push(this._loadLightAsync(`/extensions/${this.name}/lights/${h.qh}`,e).then((w=>{this._loader.babylonScene.environmentTexture=w}))),this._loader.logClose(),await Promise.all(E).then((()=>{}))}))}_loadLightAsync(w,o){if(!o._loaded){const H=new Array;this._loader.logOpen(`${w}`);const h=new Array(o.specularImages.length);for(let E=0;E<o.specularImages.length;E++){const e=o.specularImages[E];h[E]=new Array(e.length);for(let o=0;o<e.length;o++){const D=`${w}/specularImages/${E}/${o}`;this._loader.logOpen(`${D}`);const t=e[o],X=R.Get(D,this._loader.he.images,t);H.push(this._loader.loadImageAsync(`/images/${t}`,X).then((w=>{h[E][o]=w}))),this._loader.logClose()}}this._loader.logClose(),o._loaded=Promise.all(H).then((async()=>{const H=new v(this._loader.babylonScene,null,o.specularImageSize);if(H.name=o.name||"environment",o._babylonTexture=H,void 0!=o.Ue&&(H.level=o.Ue),o.rotation){let w=E.Quaternion.Po(o.rotation);this._loader.babylonScene.useRightHandedSystem||(w=E.Quaternion.Inverse(w)),E.Matrix.FromQuaternionToRef(w,H.getReflectionTextureMatrix())}if(!o.irradianceCoefficients)throw new Error(`${w}: Irradiance coefficients are missing`);const e=U.d.Po(o.irradianceCoefficients);e.scaleInPlace(o.Ue),e.convertIrradianceToLambertianRadiance();const D=U.h.FromHarmonics(e),t=(h.length-1)/Math.log2(o.specularImageSize);return await H.updateRGBDAsync(h,D,t)}))}return o._loaded.then((()=>o._babylonTexture))}}q(mw),j(mw,!0,(w=>new Y(w)));H(12285);const x="EXT_mesh_gpu_instancing";class ww{constructor(w){this.name=x,this._loader=w,this.enabled=this._loader.isExtensionUsed(x)}dispose(){this._loader=null}loadNodeAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(w,h)=>{this._loader._disableInstancedMesh++;const e=this._loader.loadNodeAsync(`/nodes/${o.index}`,o,H);if(this._loader._disableInstancedMesh--,!o._primitiveBabylonMeshes)return await e;const D=new Array;let t=0;const X=o=>{if(void 0==h.attributes[o])return void D.push(Promise.resolve(null));const H=R.Get(`${w}/attributes/${o}`,this._loader.he.accessors,h.attributes[o]);if(D.push(this._loader._loadFloatAccessorAsync(`/accessors/${H.bufferView}`,H)),0===t)t=H.count;else if(t!==H.count)throw new Error(`${w}/attributes: Instance buffer accessors do not have the same count.`)};return X("TRANSLATION"),X("ROTATION"),X("SCALE"),await e.then((async w=>{const[H,h,e]=await Promise.all(D),X=new Float32Array(16*t);E.TmpVectors.io[0].We(0,0,0),E.TmpVectors.Quaternion[0].We(0,0,0,1),E.TmpVectors.io[1].We(1,1,1);for(let o=0;o<t;++o)H&&E.io.FromArrayToRef(H,3*o,E.TmpVectors.io[0]),h&&E.Quaternion.FromArrayToRef(h,4*o,E.TmpVectors.Quaternion[0]),e&&E.io.FromArrayToRef(e,3*o,E.TmpVectors.io[1]),E.Matrix.ComposeToRef(E.TmpVectors.io[1],E.TmpVectors.Quaternion[0],E.TmpVectors.io[0],E.TmpVectors.Matrix[0]),E.TmpVectors.Matrix[0].copyToArray(X,16*o);for(const E of o._primitiveBabylonMeshes)E.iy("matrix",X,16,!0);return w}))}))}}q(x),j(x,!0,(w=>new ww(w)));let ow=0,Hw=null;class hw{static get Default(){return hw._Default||(hw._Default=new hw),hw._Default}constructor(){const w=hw.Configuration.decoder;this._decoderModulePromise=D.Tools.LoadBabylonScriptAsync(w.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(w,o,H,h,E){await this._decoderModulePromise,0===ow&&(MeshoptDecoder.useWorkers(1),ow=1);const e=await MeshoptDecoder.decodeGltfBufferAsync(o,H,w,h,E);return null!==Hw&&clearTimeout(Hw),Hw=setTimeout((()=>{MeshoptDecoder.useWorkers(0),ow=0,Hw=null}),1e3),e}}hw.Configuration={decoder:{url:`${D.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},hw._Default=null;const Ew="EXT_meshopt_compression";class ew{constructor(w){this.name=Ew,this.enabled=w.isExtensionUsed(Ew),this._loader=w}dispose(){this._loader=null}loadBufferViewAsync(w,o){return d.LoadExtensionAsync(w,o,this.name,(async(H,h)=>{const E=o;if(E._meshOptData)return await E._meshOptData;const e=R.Get(`${w}/buffer`,this._loader.he.buffers,h.buffer);return E._meshOptData=this._loader.loadBufferAsync(`/buffers/${e.index}`,e,h.byteOffset||0,h.byteLength).then((async w=>await hw.Default.decodeGltfBufferAsync(w,h.count,h.byteStride,h.mode,h.filter))),await E._meshOptData}))}}q(Ew),j(Ew,!0,(w=>new ew(w)));const Dw="EXT_texture_webp";class tw{constructor(w){this.name=Dw,this._loader=w,this.enabled=w.isExtensionUsed(Dw)}dispose(){this._loader=null}_loadTextureAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=void 0==o.sampler?d.DefaultSampler:R.Get(`${w}/sampler`,this._loader.he.samplers,o.sampler),D=R.Get(`${h}/source`,this._loader.he.images,E.source);return await this._loader._createTextureAsync(w,e,D,(w=>{H(w)}),void 0,!o._textureInfo.nonColorData)}))}}q(Dw),j(Dw,!0,(w=>new tw(w)));const Xw="EXT_texture_avif";class Lw{constructor(w){this.name=Xw,this._loader=w,this.enabled=w.isExtensionUsed(Xw)}dispose(){this._loader=null}_loadTextureAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=void 0==o.sampler?d.DefaultSampler:R.Get(`${w}/sampler`,this._loader.he.samplers,o.sampler),D=R.Get(`${h}/source`,this._loader.he.images,E.source);return await this._loader._createTextureAsync(w,e,D,(w=>{H(w)}),void 0,!o._textureInfo.nonColorData)}))}}q(Xw),j(Xw,!0,(w=>new Lw(w)));var Aw=H(13392),yw=H(12262);const zw="EXT_lights_ies";class Cw{constructor(w){this.name=zw,this._loader=w,this.enabled=this._loader.isExtensionUsed(zw)}dispose(){this._loader=null,delete this._lights}onLoading(){const w=this._loader.he.extensions;if(w&&w[this.name]){const o=w[this.name];this._lights=o.lights,R.Assign(this._lights)}}loadNodeAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,D)=>{let t,X;this._loader._allMaterialsDirtyRequired=!0;const L=await this._loader.loadNodeAsync(w,o,(w=>{X=R.Get(h,this._lights,D.qh);const o=X.name||w.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,t=new Aw.c(o,E.io.Zero(),E.io.Backward(),0,1,this._loader.babylonScene),t.angle=Math.PI/2,t.innerAngle=0,t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,X._babylonLight=t,t.falloffType=yw.b.FALLOFF_GLTF,t.Ze=D.color?e.ko.Po(D.color):e.ko.White(),t.Ue=D.multiplier||1,t.range=Number.MAX_VALUE,t.parent=w,this._loader._babylonLights.push(t),d.AddPointerMetadata(t,h),H(w)}));let A;if(X.uri)A=await this._loader.loadUriAsync(w,X,X.uri);else{const o=R.Get(`${w}/bufferView`,this._loader.he.bufferViews,X.bufferView);A=await this._loader.loadBufferViewAsync(`/bufferViews/${o.index}`,o)}return t.iesProfileTexture=new k.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,A,!0,void 0,void 0,void 0,void 0,".ies"),L}))}}q(zw),j(zw,!0,(w=>new Cw(w)));var Qw=H(13423);const Mw="KHR_draco_mesh_compression";class iw{constructor(w){this.name=Mw,this.useNormalizedFlagFromAccessor=!0,this._loader=w,this.enabled=Qw.d.DefaultAvailable&&this._loader.isExtensionUsed(Mw)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{if(void 0!=o.mode&&4!==o.mode&&5!==o.mode)throw new Error(`${w}: Unsupported mode ${o.mode}`);const e={},D={},t=(w,h)=>{const t=E.attributes[w];if(void 0!=t&&(H._delayInfo=H._delayInfo||[],-1===H._delayInfo.indexOf(h)&&H._delayInfo.push(h),e[h]=t,this.useNormalizedFlagFromAccessor)){const H=R.TryGet(this._loader.he.accessors,o.attributes[w]);H&&(D[h]=H.normalized||!1)}};t("POSITION",l.e.PositionKind),t("NORMAL",l.e.NormalKind),t("TANGENT",l.e.TangentKind),t("TEXCOORD_0",l.e.UVKind),t("TEXCOORD_1",l.e.UV2Kind),t("TEXCOORD_2",l.e.UV3Kind),t("TEXCOORD_3",l.e.UV4Kind),t("TEXCOORD_4",l.e.UV5Kind),t("TEXCOORD_5",l.e.UV6Kind),t("JOINTS_0",l.e.MatricesIndicesKind),t("WEIGHTS_0",l.e.MatricesWeightsKind),t("COLOR_0",l.e.ColorKind);const X=R.Get(h,this._loader.he.bufferViews,E.bufferView);return X._dracoBabylonGeometry||(X._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${X.index}`,X).then((async h=>{const E=this.dracoDecoder||Qw.d.Default,t=R.TryGet(this._loader.he.accessors,o.attributes.POSITION),X=this._loader.parent.alwaysComputeBoundingBox||H.skeleton||!t?null:a(t);return await E._decodeMeshToGeometryForGltfAsync(H.name,this._loader.babylonScene,h,e,D,X).catch((o=>{throw new Error(`${w}: ${o.message}`)}))}))),await X._dracoBabylonGeometry}))}}q(Mw),j(Mw,!0,(w=>new iw(w)));var sw=H(13426),Vw=H(11697),rw=H(11702),kw=H(12133),Pw=H(12319),lw=H(11666);kw.c.AddNodeConstructor("Light_Type_0",((w,o)=>()=>new Ow(w,E.io.Zero(),o)));class Ow extends Pw.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(w){this._shadowAngle=w,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(w){const o=this.needCube();if(this._direction=w,this.needCube()!==o&&this._shadowGenerators){const w=this._shadowGenerators.values();for(let o=w.next();!0!==o.done;o=w.next()){o.value.recreateShadowMap()}}}constructor(w,o,H){super(w,H),this._shadowAngle=Math.PI/2,this.position=o}getClassName(){return"PointLight"}getTypeID(){return yw.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(w){if(this.direction)return super.getShadowDirection(w);switch(w){case 0:return new E.io(1,0,0);case 1:return new E.io(-1,0,0);case 2:return new E.io(0,-1,0);case 3:return new E.io(0,1,0);case 4:return new E.io(0,0,1);case 5:return new E.io(0,0,-1)}return E.io.Zero()}_setDefaultShadowProjectionMatrix(w,o,H){const h=this.Ow().activeCamera;if(!h)return;const e=void 0!==this.shadowMinZ?this.shadowMinZ:h.Qe,D=void 0!==this.shadowMaxZ?this.shadowMaxZ:h.maxZ,t=this.Ow().getEngine().useReverseDepthBuffer;E.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,t?D:e,t?e:D,w,!0,this._scene.getEngine().isNDCHalfZRange,void 0,t)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(w,o){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,o):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,o),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,o),this}transferToNodeMaterialEffect(w,o){return this.computeTransformedInformation()?w.setFloat3(o,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):w.setFloat3(o,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(w,o){w["POINTLIGHT"+o]=!0}}(0,Vw.b)([(0,rw.B)()],Ow.prototype,"shadowAngle",null),(0,lw.g)("BABYLON.PointLight",Ow);const Tw="KHR_lights_punctual";class Sw{constructor(w){this.name=Tw,this._loader=w,this.enabled=this._loader.isExtensionUsed(Tw)}dispose(){this._loader=null,delete this._lights}onLoading(){const w=this._loader.he.extensions;if(w&&w[this.name]){const o=w[this.name];this._lights=o.lights,R.Assign(this._lights)}}loadNodeAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,D)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(w,o,(w=>{let o;const t=R.Get(h,this._lights,D.qh),X=t.name||w.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,t.type){case"directional":{const w=new sw.e(X,E.io.Backward(),this._loader.babylonScene);w.position.Ge(0),o=w;break}case"point":o=new Ow(X,E.io.Zero(),this._loader.babylonScene);break;case"spot":{const w=new Aw.c(X,E.io.Zero(),E.io.Backward(),0,1,this._loader.babylonScene);w.angle=2*(t.spot&&t.spot.outerConeAngle||Math.PI/4),w.innerAngle=2*(t.spot&&t.spot.innerConeAngle||0),o=w;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${h}: Invalid light type (${t.type})`)}o._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,t._babylonLight=o,o.falloffType=yw.b.FALLOFF_GLTF,o.Ze=t.color?e.ko.Po(t.color):e.ko.White(),o.Ue=void 0==t.Ue?1:t.Ue,o.range=void 0==t.range?Number.MAX_VALUE:t.range,o.parent=w,this._loader._babylonLights.push(o),d.AddPointerMetadata(o,h),H(w)})))))}}q(Tw),j(Tw,!0,(w=>new Sw(w)));const cw="KHR_materials_pbrSpecularGlossiness";class Ww{constructor(w){this.name=cw,this.order=200,this._loader=w,this.enabled=this._loader.isExtensionUsed(cw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=new Array;return e.push(this._loader.loadMaterialBasePropertiesAsync(w,o,H)),e.push(this._loadSpecularGlossinessPropertiesAsync(h,E,H)),this._loader.loadMaterialAlphaProperties(w,o,H),await Promise.all(e).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(w,o,H){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);const h=new Array;return H.metallic=null,H.roughness=null,o.diffuseFactor?(H.albedoColor=e.ko.Po(o.diffuseFactor),H.alpha=o.diffuseFactor[3]):H.albedoColor=e.ko.White(),H.reflectivityColor=o.specularFactor?e.ko.Po(o.specularFactor):e.ko.White(),H.microSurface=void 0==o.glossinessFactor?1:o.glossinessFactor,o.diffuseTexture&&h.push(this._loader.loadTextureInfoAsync(`${w}/diffuseTexture`,o.diffuseTexture,(w=>{w.name=`${H.name} (Diffuse)`,H.albedoTexture=w}))),o.specularGlossinessTexture&&(h.push(this._loader.loadTextureInfoAsync(`${w}/specularGlossinessTexture`,o.specularGlossinessTexture,(w=>{w.name=`${H.name} (Specular Glossiness)`,H.reflectivityTexture=w,H.reflectivityTexture.ze=!0}))),H.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(h).then((()=>{}))}}q(cw),j(cw,!0,(w=>new Ww(w)));const Bw="KHR_materials_unlit";class Jw{constructor(w){this.name=Bw,this.order=210,this._loader=w,this.enabled=this._loader.isExtensionUsed(Bw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async()=>await this._loadUnlitPropertiesAsync(w,o,H)))}_loadUnlitPropertiesAsync(w,o,H){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);const h=new Array;H.unlit=!0;const E=o.pbrMetallicRoughness;return E&&(E.baseColorFactor?(H.albedoColor=e.ko.Po(E.baseColorFactor),H.alpha=E.baseColorFactor[3]):H.albedoColor=e.ko.White(),E.baseColorTexture&&h.push(this._loader.loadTextureInfoAsync(`${w}/baseColorTexture`,E.baseColorTexture,(w=>{w.name=`${H.name} (Base Color)`,H.albedoTexture=w})))),o.doubleSided&&(H.Oe=!1,H.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(w,o,H),Promise.all(h).then((()=>{}))}}q(Bw),j(Bw,!0,(w=>new Jw(w)));const gw="KHR_materials_clearcoat";class bw{constructor(w){this.name=gw,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(gw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=new Array;e.push(this._loader.loadMaterialPropertiesAsync(w,o,H)),e.push(this._loadClearCoatPropertiesAsync(h,E,H)),await Promise.all(e)}))}_loadClearCoatPropertiesAsync(w,o,H){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);const h=new Array;return H.clearCoat.isEnabled=!0,H.clearCoat.useRoughnessFromMainTexture=!1,H.clearCoat.remapF0OnInterfaceChange=!1,void 0!=o.clearcoatFactor?H.clearCoat.Ue=o.clearcoatFactor:H.clearCoat.Ue=0,o.clearcoatTexture&&h.push(this._loader.loadTextureInfoAsync(`${w}/clearcoatTexture`,o.clearcoatTexture,(w=>{w.name=`${H.name} (ClearCoat)`,H.clearCoat.texture=w}))),void 0!=o.clearcoatRoughnessFactor?H.clearCoat.roughness=o.clearcoatRoughnessFactor:H.clearCoat.roughness=0,o.clearcoatRoughnessTexture&&(o.clearcoatRoughnessTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${w}/clearcoatRoughnessTexture`,o.clearcoatRoughnessTexture,(w=>{w.name=`${H.name} (ClearCoat Roughness)`,H.clearCoat.textureRoughness=w})))),o.clearcoatNormalTexture&&(o.clearcoatNormalTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${w}/clearcoatNormalTexture`,o.clearcoatNormalTexture,(w=>{w.name=`${H.name} (ClearCoat Normal)`,H.clearCoat.bumpTexture=w}))),H.invertNormalMapX=!H.Ow().useRightHandedSystem,H.invertNormalMapY=H.Ow().useRightHandedSystem,void 0!=o.clearcoatNormalTexture.scale&&(H.clearCoat.bumpTexture.level=o.clearcoatNormalTexture.scale)),Promise.all(h).then((()=>{}))}}q(gw),j(gw,!0,(w=>new bw(w)));const pw="KHR_materials_iridescence";class fw{constructor(w){this.name=pw,this.order=195,this._loader=w,this.enabled=this._loader.isExtensionUsed(pw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=new Array;return e.push(this._loader.loadMaterialPropertiesAsync(w,o,H)),e.push(this._loadIridescencePropertiesAsync(h,E,H)),await Promise.all(e).then((()=>{}))}))}_loadIridescencePropertiesAsync(w,o,H){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);const h=new Array;return H.iridescence.isEnabled=!0,H.iridescence.Ue=o.iridescenceFactor??0,H.iridescence.indexOfRefraction=o.iridescenceIor??o.iridescenceIOR??1.3,H.iridescence.minimumThickness=o.iridescenceThicknessMinimum??100,H.iridescence.maximumThickness=o.iridescenceThicknessMaximum??400,o.iridescenceTexture&&h.push(this._loader.loadTextureInfoAsync(`${w}/iridescenceTexture`,o.iridescenceTexture,(w=>{w.name=`${H.name} (Iridescence)`,H.iridescence.texture=w}))),o.iridescenceThicknessTexture&&h.push(this._loader.loadTextureInfoAsync(`${w}/iridescenceThicknessTexture`,o.iridescenceThicknessTexture,(w=>{w.name=`${H.name} (Iridescence Thickness)`,H.iridescence.thicknessTexture=w}))),Promise.all(h).then((()=>{}))}}q(pw),j(pw,!0,(w=>new fw(w)));const Nw="KHR_materials_anisotropy";class jw{constructor(w){this.name=Nw,this.order=195,this._loader=w,this.enabled=this._loader.isExtensionUsed(Nw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=new Array;e.push(this._loader.loadMaterialPropertiesAsync(w,o,H)),e.push(this._loadIridescencePropertiesAsync(h,E,H)),await Promise.all(e)}))}async _loadIridescencePropertiesAsync(w,o,H){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);const h=new Array;H.anisotropy.isEnabled=!0,H.anisotropy.Ue=o.anisotropyStrength??0,H.anisotropy.angle=o.anisotropyRotation??0,o.anisotropyTexture&&(o.anisotropyTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${w}/anisotropyTexture`,o.anisotropyTexture,(w=>{w.name=`${H.name} (Anisotropy Intensity)`,H.anisotropy.texture=w})))),await Promise.all(h)}}q(Nw),j(Nw,!0,(w=>new jw(w)));const qw="KHR_materials_emissive_strength";class uw{constructor(w){this.name=qw,this.order=170,this._loader=w,this.enabled=this._loader.isExtensionUsed(qw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>await this._loader.loadMaterialPropertiesAsync(w,o,H).then((()=>{this._loadEmissiveProperties(h,E,H)}))))}_loadEmissiveProperties(w,o,H){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);void 0!==o.emissiveStrength&&(H.emissiveIntensity=o.emissiveStrength)}}q(qw),j(qw,!0,(w=>new uw(w)));const nw="KHR_materials_sheen";class Gw{constructor(w){this.name=nw,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(nw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=new Array;return e.push(this._loader.loadMaterialPropertiesAsync(w,o,H)),e.push(this._loadSheenPropertiesAsync(h,E,H)),await Promise.all(e).then((()=>{}))}))}_loadSheenPropertiesAsync(w,o,H){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);const h=new Array;return H.sheen.isEnabled=!0,H.sheen.Ue=1,void 0!=o.sheenColorFactor?H.sheen.color=e.ko.Po(o.sheenColorFactor):H.sheen.color=e.ko.Black(),o.sheenColorTexture&&h.push(this._loader.loadTextureInfoAsync(`${w}/sheenColorTexture`,o.sheenColorTexture,(w=>{w.name=`${H.name} (Sheen Color)`,H.sheen.texture=w}))),void 0!==o.sheenRoughnessFactor?H.sheen.roughness=o.sheenRoughnessFactor:H.sheen.roughness=0,o.sheenRoughnessTexture&&(o.sheenRoughnessTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${w}/sheenRoughnessTexture`,o.sheenRoughnessTexture,(w=>{w.name=`${H.name} (Sheen Roughness)`,H.sheen.textureRoughness=w})))),H.sheen.albedoScaling=!0,H.sheen.useRoughnessFromMainTexture=!1,Promise.all(h).then((()=>{}))}}q(nw),j(nw,!0,(w=>new Gw(w)));var Rw=H(12189);const aw="KHR_materials_specular";class dw{constructor(w){this.name=aw,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(aw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=new Array;if(e.push(this._loader.loadMaterialPropertiesAsync(w,o,H)),e.push(this._loadSpecularPropertiesAsync(h,E,H)),E.extensions&&E.extensions.EXT_materials_specular_edge_color&&H instanceof r.c){E.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(H.brdf.dielectricSpecularModel=Rw.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,H.brdf.conductorSpecularModel=Rw.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(e).then((()=>{}))}))}_loadSpecularPropertiesAsync(w,o,H){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);const h=new Array;return void 0!==o.specularFactor&&(H.metallicF0Factor=o.specularFactor),void 0!==o.specularColorFactor&&(H.metallicReflectanceColor=e.ko.Po(o.specularColorFactor)),o.specularTexture&&(o.specularTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${w}/specularTexture`,o.specularTexture,(w=>{w.name=`${H.name} (Specular)`,H.metallicReflectanceTexture=w,H.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),o.specularColorTexture&&h.push(this._loader.loadTextureInfoAsync(`${w}/specularColorTexture`,o.specularColorTexture,(w=>{w.name=`${H.name} (Specular Color)`,H.reflectanceTexture=w}))),Promise.all(h).then((()=>{}))}}q(aw),j(aw,!0,(w=>new dw(w)));const Iw="KHR_materials_ior";class Uw{constructor(w){this.name=Iw,this.order=180,this._loader=w,this.enabled=this._loader.isExtensionUsed(Iw)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=new Array;return e.push(this._loader.loadMaterialPropertiesAsync(w,o,H)),e.push(this._loadIorPropertiesAsync(h,E,H)),await Promise.all(e).then((()=>{}))}))}_loadIorPropertiesAsync(w,o,H){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);return void 0!==o.ior?H.indexOfRefraction=o.ior:H.indexOfRefraction=Uw._DEFAULT_IOR,Promise.resolve()}}Uw._DEFAULT_IOR=1.5,q(Iw),j(Iw,!0,(w=>new Uw(w)));const Zw="KHR_materials_variants";class Kw{constructor(w){this.name=Zw,this._loader=w,this.enabled=this._loader.isExtensionUsed(Zw)}dispose(){this._loader=null}static GetAvailableVariants(w){const o=this._GetExtensionMetadata(w);return o?Object.keys(o.variants):[]}getAvailableVariants(w){return Kw.GetAvailableVariants(w)}static SelectVariant(w,o){const H=this._GetExtensionMetadata(w);if(!H)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Zw} extension`);const h=w=>{const o=H.variants[w];if(o)for(const H of o)H.mesh.material=H.material};if(o instanceof Array)for(const E of o)h(E);else h(o);H.lastSelected=o}selectVariant(w,o){Kw.SelectVariant(w,o)}static Reset(w){const o=this._GetExtensionMetadata(w);if(!o)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Zw} extension`);for(const H of o.original)H.mesh.material=H.material;o.lastSelected=null}reset(w){Kw.Reset(w)}static GetLastSelectedVariant(w){const o=this._GetExtensionMetadata(w);if(!o)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Zw} extension`);return o.lastSelected}getLastSelectedVariant(w){return Kw.GetLastSelectedVariant(w)}static _GetExtensionMetadata(w){var o,H;return(null===w||void 0===w||null===(o=w._internalMetadata)||void 0===o||null===(H=o.he)||void 0===H?void 0:H[Zw])||null}onLoading(){const w=this._loader.he.extensions;if(w&&w[this.name]){const o=w[this.name];this._variants=o.variants}}onReady(){const w=this._loader.rootBabylonMesh;if(w){var o;const H=this._loader.parent.extensionOptions[Zw];null!==H&&void 0!==H&&H.defaultVariant&&Kw.SelectVariant(w,H.defaultVariant),null===H||void 0===H||null===(o=H.onLoaded)||void 0===o||o.call(H,{get variants(){return Kw.GetAvailableVariants(w)},get selectedVariant(){const o=Kw.GetLastSelectedVariant(w);return o?Array.isArray(o)?o[0]:o:Kw.GetAvailableVariants(w)[0]},set selectedVariant(o){Kw.SelectVariant(w,o)}})}}_loadMeshPrimitiveAsync(w,o,H,h,E,e){return d.LoadExtensionAsync(w,E,this.name,(async(D,t)=>{const X=new Array;return X.push(this._loader._loadMeshPrimitiveAsync(w,o,H,h,E,(o=>{if(e(o),o instanceof S.d){const H=d._GetDrawMode(w,E.mode),h=this._loader.rootBabylonMesh,e=h?h._internalMetadata=h._internalMetadata||{}:{},L=e.he=e.he||{},A=L[Zw]=L[Zw]||{lastSelected:null,original:[],variants:{}};A.original.push({mesh:o,material:o.material});for(let w=0;w<t.mappings.length;++w){const E=t.mappings[w],e=R.Get(`${D}/mappings/${w}/material`,this._loader.he.materials,E.material);X.push(this._loader._loadMaterialAsync(`#/materials/${E.material}`,e,o,H,(w=>{for(let H=0;H<E.variants.length;++H){const e=E.variants[H],D=R.Get(`/extensions/${Zw}/variants/${e}`,this._variants,e);A.variants[D.name]=A.variants[D.name]||[],A.variants[D.name].push({mesh:o,material:w}),o.onClonedObservable.add((w=>{const H=w;let E=null,e=H;do{if(e=e.parent,!e)return;E=Kw._GetExtensionMetadata(e)}while(null===E);if(h&&E===Kw._GetExtensionMetadata(h)){e._internalMetadata={};for(const w in h._internalMetadata)e._internalMetadata[w]=h._internalMetadata[w];e._internalMetadata.he=[];for(const w in h._internalMetadata.he)e._internalMetadata.he[w]=h._internalMetadata.he[w];e._internalMetadata.he[Zw]={lastSelected:null,original:[],variants:{}};for(const w of E.original)e._internalMetadata.he[Zw].original.push({mesh:w.mesh,material:w.material});for(const w in E.variants)if(Object.prototype.hasOwnProperty.call(E.variants,w)){e._internalMetadata.he[Zw].variants[w]=[];for(const o of E.variants[w])e._internalMetadata.he[Zw].variants[w].push({mesh:o.mesh,material:o.material})}E=e._internalMetadata.he[Zw]}for(const h of E.original)h.mesh===o&&(h.mesh=H);for(const h of E.variants[D.name])h.mesh===o&&(h.mesh=H)}))}})))}}}))),await Promise.all(X).then((w=>{let[o]=w;return o}))}))}}q(Zw),j(Zw,!0,(w=>new Kw(w)));var Fw=H(11772);class vw{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Rw.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(w,o){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...vw._GetDefaultOptions(),...w},this._scene=o,this._scene._transmissionHelper=this,this.onErrorObservable=new A.b,this._scene.me.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(w){if(!Object.keys(w).filter((o=>this._options[o]!==w[o])).length)return;const o={...this._options,...w},H=this._options;this._options=o,o.renderSize===H.renderSize&&o.renderTargetTextureType===H.renderTargetTextureType&&o.generateMipmaps===H.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=o.samples,this._opaqueRenderTarget.lodGenerationScale=o.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=o.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(w){return!!w&&!!(w instanceof r.c&&w.subSurface.isRefractionEnabled)}_addMesh(w){this._materialObservers[w.uniqueId]=w.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),D.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(w.material)?(w.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(w)&&this._transparentMeshesCache.push(w)):-1===this._opaqueMeshesCache.indexOf(w)&&this._opaqueMeshesCache.push(w)}))}_removeMesh(w){w.onMaterialChangedObservable.remove(this._materialObservers[w.uniqueId]),delete this._materialObservers[w.uniqueId];let o=this._transparentMeshesCache.indexOf(w);-1!==o&&this._transparentMeshesCache.splice(o,1),o=this._opaqueMeshesCache.indexOf(w),-1!==o&&this._opaqueMeshesCache.splice(o,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(w){const o=this._transparentMeshesCache.indexOf(w),H=this._opaqueMeshesCache.indexOf(w);this._shouldRenderAsTransmission(w.material)?(w.material instanceof r.c&&(w.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==H?(this._opaqueMeshesCache.splice(H,1),this._transparentMeshesCache.push(w)):-1===o&&this._transparentMeshesCache.push(w)):-1!==o?(this._transparentMeshesCache.splice(o,1),this._opaqueMeshesCache.push(w)):-1===H&&this._opaqueMeshesCache.push(w)}_isRenderTargetValid(){var w;return null!==(null===(w=this._opaqueRenderTarget)||void 0===w?void 0:w.getInternalTexture())}_setupRenderTargets(){var w;let o;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Fw.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(w=this._options.clearColor)||void 0===w?void 0:w.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((w=>{o=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?w.clearColor.t(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(w.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=o}));for(const H of this._transparentMeshesCache)this._shouldRenderAsTransmission(H.material)&&(H.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const mo="KHR_materials_transmission";class Yw{constructor(w){this.name=mo,this.order=175,this._loader=w,this.enabled=this._loader.isExtensionUsed(mo),this.enabled&&(w.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=new Array;return e.push(this._loader.loadMaterialPropertiesAsync(w,o,H)),e.push(this._loadTransparentPropertiesAsync(h,o,H,E)),await Promise.all(e).then((()=>{}))}))}_loadTransparentPropertiesAsync(w,o,H,h){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);const E=H;if(E.subSurface.isRefractionEnabled=!0,E.subSurface.volumeIndexOfRefraction=1,E.subSurface.useAlbedoToTintRefraction=!0,void 0===h.transmissionFactor)return E.subSurface.refractionIntensity=0,E.subSurface.isRefractionEnabled=!1,Promise.resolve();{var e;E.subSurface.refractionIntensity=h.transmissionFactor;const w=E.Ow();if(E.subSurface.refractionIntensity&&!w._transmissionHelper)new vw({},E.Ow());else if(E.subSurface.refractionIntensity&&(null===(e=w._transmissionHelper)||void 0===e||!e._isRenderTargetValid())){var D;null===(D=w._transmissionHelper)||void 0===D||D._setupRenderTargets()}}return E.subSurface.minimumThickness=0,E.subSurface.maximumThickness=0,h.transmissionTexture?(h.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${w}/transmissionTexture`,h.transmissionTexture,void 0).then((w=>{w.name=`${H.name} (Transmission)`,E.subSurface.refractionIntensityTexture=w,E.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}q(mo),j(mo,!0,(w=>new Yw(w)));const xw="KHR_materials_diffuse_transmission";class wo{constructor(w){this.name=xw,this.order=174,this._loader=w,this.enabled=this._loader.isExtensionUsed(xw),this.enabled&&(w.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=new Array;return e.push(this._loader.loadMaterialPropertiesAsync(w,o,H)),e.push(this._loadTranslucentPropertiesAsync(h,o,H,E)),await Promise.all(e).then((()=>{}))}))}_loadTranslucentPropertiesAsync(w,o,H,h){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);const E=H;if(E.subSurface.isTranslucencyEnabled=!0,E.subSurface.volumeIndexOfRefraction=1,E.subSurface.minimumThickness=0,E.subSurface.maximumThickness=0,E.subSurface.useAlbedoToTintTranslucency=!1,void 0===h.diffuseTransmissionFactor)return E.subSurface.translucencyIntensity=0,E.subSurface.isTranslucencyEnabled=!1,Promise.resolve();E.subSurface.translucencyIntensity=h.diffuseTransmissionFactor;const D=new Array;return E.subSurface.useGltfStyleTextures=!0,h.diffuseTransmissionTexture&&(h.diffuseTransmissionTexture.nonColorData=!0,D.push(this._loader.loadTextureInfoAsync(`${w}/diffuseTransmissionTexture`,h.diffuseTransmissionTexture).then((w=>{w.name=`${H.name} (Diffuse Transmission)`,E.subSurface.translucencyIntensityTexture=w})))),void 0!==h.diffuseTransmissionColorFactor?E.subSurface.translucencyColor=e.ko.Po(h.diffuseTransmissionColorFactor):E.subSurface.translucencyColor=e.ko.White(),h.diffuseTransmissionColorTexture&&D.push(this._loader.loadTextureInfoAsync(`${w}/diffuseTransmissionColorTexture`,h.diffuseTransmissionColorTexture).then((w=>{w.name=`${H.name} (Diffuse Transmission Color)`,E.subSurface.translucencyColorTexture=w}))),Promise.all(D).then((()=>{}))}}q(xw),j(xw,!0,(w=>new wo(w)));const oo="KHR_materials_volume";class Ho{constructor(w){this.name=oo,this.order=173,this._loader=w,this.enabled=this._loader.isExtensionUsed(oo),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=new Array;return e.push(this._loader.loadMaterialPropertiesAsync(w,o,H)),e.push(this._loadVolumePropertiesAsync(h,o,H,E)),await Promise.all(e).then((()=>{}))}))}_loadVolumePropertiesAsync(w,o,H,h){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);if(!H.subSurface.isRefractionEnabled&&!H.subSurface.isTranslucencyEnabled||!h.thicknessFactor)return Promise.resolve();H.subSurface.volumeIndexOfRefraction=H.indexOfRefraction;const E=void 0!==h.attenuationDistance?h.attenuationDistance:Number.MAX_VALUE;return H.subSurface.tintColorAtDistance=E,void 0!==h.attenuationColor&&3==h.attenuationColor.length&&H.subSurface.tintColor.We(h.attenuationColor[0],h.attenuationColor[1],h.attenuationColor[2]),H.subSurface.minimumThickness=0,H.subSurface.maximumThickness=h.thicknessFactor,H.subSurface.useThicknessAsDepth=!0,h.thicknessTexture?(h.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${w}/thicknessTexture`,h.thicknessTexture).then((w=>{w.name=`${H.name} (Thickness)`,H.subSurface.thicknessTexture=w,H.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}q(oo),j(oo,!0,(w=>new Ho(w)));const ho="KHR_materials_dispersion";class Eo{constructor(w){this.name=ho,this.order=174,this._loader=w,this.enabled=this._loader.isExtensionUsed(ho)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=new Array;return e.push(this._loader.loadMaterialPropertiesAsync(w,o,H)),e.push(this._loadDispersionPropertiesAsync(h,o,H,E)),await Promise.all(e).then((()=>{}))}))}_loadDispersionPropertiesAsync(w,o,H,h){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);return H.subSurface.isRefractionEnabled&&h.dispersion?(H.subSurface.isDispersionEnabled=!0,H.subSurface.dispersion=h.dispersion,Promise.resolve()):Promise.resolve()}}q(ho),j(ho,!0,(w=>new Eo(w)));const eo="EXT_materials_diffuse_roughness";class Do{constructor(w){this.name=eo,this.order=190,this._loader=w,this.enabled=this._loader.isExtensionUsed(eo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=new Array;return e.push(this._loader.loadMaterialPropertiesAsync(w,o,H)),e.push(this._loadDiffuseRoughnessPropertiesAsync(h,E,H)),await Promise.all(e).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(w,o,H){if(!(H instanceof r.c))throw new Error(`${w}: Material type not supported`);const h=new Array;return H.brdf.baseDiffuseModel=Rw.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=o.diffuseRoughnessFactor?H.baseDiffuseRoughness=o.diffuseRoughnessFactor:H.baseDiffuseRoughness=0,o.diffuseRoughnessTexture&&h.push(this._loader.loadTextureInfoAsync(`${w}/diffuseRoughnessTexture`,o.diffuseRoughnessTexture,(w=>{w.name=`${H.name} (Diffuse Roughness)`,H.baseDiffuseRoughnessTexture=w}))),Promise.all(h).then((()=>{}))}}q(eo),j(eo,!0,(w=>new Do(w)));const to="KHR_mesh_quantization";class Xo{constructor(w){this.name=to,this.enabled=w.isExtensionUsed(to)}dispose(){}}q(to),j(to,!0,(w=>new Xo(w)));const Lo="KHR_texture_basisu";class Ao{constructor(w){this.name=Lo,this._loader=w,this.enabled=w.isExtensionUsed(Lo)}dispose(){this._loader=null}_loadTextureAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>{const e=void 0==o.sampler?d.DefaultSampler:R.Get(`${w}/sampler`,this._loader.he.samplers,o.sampler),D=R.Get(`${h}/source`,this._loader.he.images,E.source);return await this._loader._createTextureAsync(w,e,D,(w=>{H(w)}),o._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!o._textureInfo.nonColorData)}))}}q(Lo),j(Lo,!0,(w=>new Ao(w)));const yo="KHR_texture_transform";class zo{constructor(w){this.name=yo,this._loader=w,this.enabled=this._loader.isExtensionUsed(yo)}dispose(){this._loader=null}loadTextureInfoAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(h,E)=>await this._loader.loadTextureInfoAsync(w,o,(w=>{if(!(w instanceof k.d))throw new Error(`${h}: Texture type not supported`);E.offset&&(w.uOffset=E.offset[0],w.vOffset=E.offset[1]),w.uRotationCenter=0,w.vRotationCenter=0,E.rotation&&(w.wAng=-E.rotation),E.scale&&(w.uScale=E.scale[0],w.vScale=E.scale[1]),void 0!=E.texCoord&&(w.coordinatesIndex=E.texCoord),H(w)}))))}}q(yo),j(yo,!0,(w=>new zo(w)));const Co="KHR_xmp_json_ld";class Qo{constructor(w){this.name=Co,this.order=100,this._loader=w,this.enabled=this._loader.isExtensionUsed(Co)}dispose(){this._loader=null}onLoading(){var w,o,H;if(null===this._loader.rootBabylonMesh)return;const h=null===(w=this._loader.he.extensions)||void 0===w?void 0:w.KHR_xmp_json_ld,E=null===(o=this._loader.he.asset)||void 0===o||null===(H=o.extensions)||void 0===H?void 0:H.KHR_xmp_json_ld;if(h&&E){const w=+E.packet;h.packets&&w<h.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=h.packets[w])}}}function Mo(w,o,H,h){return e.ko.Po(o,H).scale(h)}function io(w,o,H,h){return o[H]*h}function so(w,o,H,h){return-o[H]*h}function Vo(w,o,H,h){return o[H+1]*h}function ro(w,o,H,h){return o[H]*h*2}function ko(w){return{scale:[new lo(z.b.ANIMATIONTYPE_FLOAT,`${w}.uScale`,io,(()=>2)),new lo(z.b.ANIMATIONTYPE_FLOAT,`${w}.vScale`,Vo,(()=>2))],offset:[new lo(z.b.ANIMATIONTYPE_FLOAT,`${w}.uOffset`,io,(()=>2)),new lo(z.b.ANIMATIONTYPE_FLOAT,`${w}.vOffset`,Vo,(()=>2))],rotation:[new lo(z.b.ANIMATIONTYPE_FLOAT,`${w}.wAng`,so,(()=>1))]}}q(Co),j(Co,!0,(w=>new Qo(w)));class Po extends I.AnimationPropertyInfo{buildAnimations(w,o,H,h){return[{babylonAnimatable:w._babylonCamera,babylonAnimation:this._buildAnimation(o,H,h)}]}}class lo extends I.AnimationPropertyInfo{buildAnimations(w,o,H,h){const E=[];for(const e in w._data)E.push({babylonAnimatable:w._data[e].babylonMaterial,babylonAnimation:this._buildAnimation(o,H,h)});return E}}class Oo extends I.AnimationPropertyInfo{buildAnimations(w,o,H,h){return[{babylonAnimatable:w._babylonLight,babylonAnimation:this._buildAnimation(o,H,h)}]}}(0,u.p)("/cameras/{}/orthographic/xmag",[new Po(z.b.ANIMATIONTYPE_FLOAT,"orthoLeft",so,(()=>1)),new Po(z.b.ANIMATIONTYPE_FLOAT,"orthoRight",Vo,(()=>1))]),(0,u.p)("/cameras/{}/orthographic/ymag",[new Po(z.b.ANIMATIONTYPE_FLOAT,"orthoBottom",so,(()=>1)),new Po(z.b.ANIMATIONTYPE_FLOAT,"orthoTop",Vo,(()=>1))]),(0,u.p)("/cameras/{}/orthographic/zfar",[new Po(z.b.ANIMATIONTYPE_FLOAT,"maxZ",io,(()=>1))]),(0,u.p)("/cameras/{}/orthographic/znear",[new Po(z.b.ANIMATIONTYPE_FLOAT,"Qe",io,(()=>1))]),(0,u.p)("/cameras/{}/perspective/yfov",[new Po(z.b.ANIMATIONTYPE_FLOAT,"fov",io,(()=>1))]),(0,u.p)("/cameras/{}/perspective/zfar",[new Po(z.b.ANIMATIONTYPE_FLOAT,"maxZ",io,(()=>1))]),(0,u.p)("/cameras/{}/perspective/znear",[new Po(z.b.ANIMATIONTYPE_FLOAT,"Qe",io,(()=>1))]),(0,u.p)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new lo(z.b.ANIMATIONTYPE_COLOR3,"albedoColor",Mo,(()=>4)),new lo(z.b.ANIMATIONTYPE_FLOAT,"alpha",(function(w,o,H,h){return o[H+3]*h}),(()=>4))]),(0,u.p)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new lo(z.b.ANIMATIONTYPE_FLOAT,"metallic",io,(()=>1))]),(0,u.p)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new lo(z.b.ANIMATIONTYPE_FLOAT,"roughness",io,(()=>1))]);const To=ko("albedoTexture");(0,u.p)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",To.scale),(0,u.p)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",To.offset),(0,u.p)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",To.rotation);const So=ko("metallicTexture");(0,u.p)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",So.scale),(0,u.p)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",So.offset),(0,u.p)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",So.rotation),(0,u.p)("/materials/{}/emissiveFactor",[new lo(z.b.ANIMATIONTYPE_COLOR3,"emissiveColor",Mo,(()=>3))]);const co=ko("bumpTexture");(0,u.p)("/materials/{}/normalTexture/scale",[new lo(z.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",io,(()=>1))]),(0,u.p)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",co.scale),(0,u.p)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",co.offset),(0,u.p)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",co.rotation),(0,u.p)("/materials/{}/occlusionTexture/strength",[new lo(z.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",io,(()=>1))]);const Wo=ko("ambientTexture");(0,u.p)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Wo.scale),(0,u.p)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Wo.offset),(0,u.p)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Wo.rotation);const Bo=ko("emissiveTexture");(0,u.p)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Bo.scale),(0,u.p)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Bo.offset),(0,u.p)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Bo.rotation),(0,u.p)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new lo(z.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",io,(()=>1))]),(0,u.p)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new lo(z.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",io,(()=>1))]);const Jo=ko("anisotropy.texture");(0,u.p)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Jo.scale),(0,u.p)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Jo.offset),(0,u.p)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Jo.rotation),(0,u.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new lo(z.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",io,(()=>1))]),(0,u.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new lo(z.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",io,(()=>1))]);const go=ko("clearCoat.texture");(0,u.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",go.scale),(0,u.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",go.offset),(0,u.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",go.rotation);const bo=ko("clearCoat.bumpTexture");(0,u.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new lo(z.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",io,(()=>1))]),(0,u.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",bo.scale),(0,u.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",bo.offset),(0,u.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",bo.rotation);const po=ko("clearCoat.textureRoughness");(0,u.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",po.scale),(0,u.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",po.offset),(0,u.p)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",po.rotation),(0,u.p)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new lo(z.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",io,(()=>1))]),(0,u.p)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new lo(z.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",io,(()=>1))]),(0,u.p)("/materials/{}/extensions/KHR_materials_ior/ior",[new lo(z.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",io,(()=>1))]),(0,u.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new lo(z.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",io,(()=>1))]),(0,u.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new lo(z.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",io,(()=>1))]),(0,u.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new lo(z.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",io,(()=>1))]),(0,u.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new lo(z.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",io,(()=>1))]);const fo=ko("iridescence.texture");(0,u.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",fo.scale),(0,u.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",fo.offset),(0,u.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",fo.rotation);const No=ko("iridescence.thicknessTexture");(0,u.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",No.scale),(0,u.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",No.offset),(0,u.p)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",No.rotation),(0,u.p)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new lo(z.b.ANIMATIONTYPE_COLOR3,"sheen.color",Mo,(()=>3))]),(0,u.p)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new lo(z.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",io,(()=>1))]);const jo=ko("sheen.texture");(0,u.p)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",jo.scale),(0,u.p)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",jo.offset),(0,u.p)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",jo.rotation);const qo=ko("sheen.textureRoughness");(0,u.p)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",qo.scale),(0,u.p)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",qo.offset),(0,u.p)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",qo.rotation),(0,u.p)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new lo(z.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",io,(()=>1))]),(0,u.p)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new lo(z.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Mo,(()=>3))]);const uo=ko("metallicReflectanceTexture");(0,u.p)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",uo.scale),(0,u.p)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",uo.offset),(0,u.p)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",uo.rotation);const no=ko("reflectanceTexture");(0,u.p)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",no.scale),(0,u.p)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",no.offset),(0,u.p)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",no.rotation),(0,u.p)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new lo(z.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",io,(()=>1))]);const Go=ko("subSurface.refractionIntensityTexture");(0,u.p)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Go.scale),(0,u.p)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Go.offset),(0,u.p)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Go.rotation),(0,u.p)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new lo(z.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Mo,(()=>3))]),(0,u.p)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new lo(z.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",io,(()=>1))]),(0,u.p)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new lo(z.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",io,(()=>1))]);const Ro=ko("subSurface.thicknessTexture");(0,u.p)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Ro.scale),(0,u.p)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Ro.offset),(0,u.p)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Ro.rotation),(0,u.p)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new lo(z.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",io,(()=>1))]);const ao=ko("subSurface.translucencyIntensityTexture");(0,u.p)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",ao.scale),(0,u.p)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",ao.offset),(0,u.p)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",ao.rotation),(0,u.p)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new lo(z.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Mo,(()=>3))]);const Io=ko("subSurface.translucencyColorTexture");(0,u.p)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Io.scale),(0,u.p)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Io.offset),(0,u.p)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Io.rotation),(0,u.p)("/extensions/KHR_lights_punctual/lights/{}/color",[new Oo(z.b.ANIMATIONTYPE_COLOR3,"diffuse",Mo,(()=>3))]),(0,u.p)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Oo(z.b.ANIMATIONTYPE_FLOAT,"intensity",io,(()=>1))]),(0,u.p)("/extensions/KHR_lights_punctual/lights/{}/range",[new Oo(z.b.ANIMATIONTYPE_FLOAT,"range",io,(()=>1))]),(0,u.p)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Oo(z.b.ANIMATIONTYPE_FLOAT,"innerAngle",ro,(()=>1))]),(0,u.p)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Oo(z.b.ANIMATIONTYPE_FLOAT,"angle",ro,(()=>1))]),(0,u.p)("/nodes/{}/extensions/EXT_lights_ies/color",[new Oo(z.b.ANIMATIONTYPE_COLOR3,"diffuse",Mo,(()=>3))]),(0,u.p)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Oo(z.b.ANIMATIONTYPE_FLOAT,"intensity",io,(()=>1))]);const Uo="KHR_animation_pointer";class Zo{constructor(w){this.name=Uo,this._loader=w,this._pathToObjectConverter=(0,u.l)(this._loader.he)}get enabled(){return this._loader.isExtensionUsed(Uo)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(w,o,H,h,E){var e;const D=null===(e=h.target.extensions)||void 0===e?void 0:e.KHR_animation_pointer;if(!D||!this._pathToObjectConverter)return null;"pointer"!==h.target.path&&M.d.Warn(`${w}/target/path: Value (${h.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=h.target.node&&M.d.Warn(`${w}/target/node: Value (${h.target.node}) must not be present when using the ${this.name} extension`);const t=`${w}/extensions/${this.name}`,X=D.pointer;if(!X)throw new Error(`${t}: Pointer is missing`);try{const e=this._pathToObjectConverter.convert(X);if(!e.info.interpolation)throw new Error(`${t}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(w,o,H,h,{object:e.object,info:e.info.interpolation},E)}catch(L){return M.d.Warn(`${t}/pointer: Invalid pointer (${X}) skipped`),null}}}q(Uo),j(Uo,!0,(w=>new Zo(w)));class Ko{constructor(w,o,H){this.frame=w,this.action=o,this.onlyOnce=H,this.isDone=!1}_clone(){return new Ko(this.frame,this.action,this.onlyOnce)}}var Fo=H(11564),vo=H(11615),mH=H(11606);class Yo{get loop(){return this._loop}set loop(w){w!==this._loop&&(this._loop=w,this.updateOptions({loop:w}))}get currentTime(){var w;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(w=vo.c.audioEngine)&&void 0!==w&&w.audioContext&&(this.isPlaying||this.isPaused)){const w=this.isPaused?0:vo.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+w}return 0}get spatialSound(){return this._spatialSound}set spatialSound(w){if(w==this._spatialSound)return;const o=this.isPlaying;this.pause(),w?(this._spatialSound=w,this._updateSpatialParameters()):this._disableSpatialSound(),o&&this.play()}constructor(w,o,H){var h;let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new A.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=E.io.Zero(),this._localDirection=new E.io(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=w,H=H||Q.e.LastCreatedScene)if(this._scene=H,Yo._SceneComponentInitialization(H),this._readyToPlayCallback=e,this._customAttenuationFunction=(w,o,H,h,E)=>o<H?w*(1-o/H):0,t&&(this.autoplay=t.autoplay||!1,this._loop=t.loop||!1,void 0!==t.volume&&(this._volume=t.volume),this._spatialSound=t.spatialSound??!1,this.maxDistance=t.maxDistance??100,this.useCustomAttenuation=t.useCustomAttenuation??!1,this.rolloffFactor=t.rolloffFactor||1,this.refDistance=t.refDistance||1,this.distanceModel=t.distanceModel||"linear",this._playbackRate=t.playbackRate||1,this._streaming=t.streaming??!1,this._length=t.length,this._offset=t.offset),null!==(h=vo.c.audioEngine)&&void 0!==h&&h.canUseWebAudio&&vo.c.audioEngine.audioContext){this._soundGain=vo.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let w=!0;if(o)try{"string"===typeof o?(this._urlType="String",this._url=o):o instanceof ArrayBuffer?this._urlType="ArrayBuffer":o instanceof HTMLMediaElement?this._urlType="MediaElement":o instanceof MediaStream?this._urlType="MediaStream":o instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(o)&&(this._urlType="Array");let H=[],h=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=vo.c.audioEngine.audioContext.createMediaElementSource(o),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=vo.c.audioEngine.audioContext.createMediaStreamSource(o),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":o.byteLength>0&&(h=!0,this._soundLoaded(o));break;case"AudioBuffer":this._audioBufferLoaded(o);break;case"String":H.push(o);case"Array":0===H.length&&(H=o);for(let w=0;w<H.length;w++){const o=H[w];if(h=t&&t.skipCodecCheck||-1!==o.indexOf(".mp3",o.length-4)&&vo.c.audioEngine.isMP3supported||-1!==o.indexOf(".ogg",o.length-4)&&vo.c.audioEngine.isOGGsupported||-1!==o.indexOf(".wav",o.length-4)||-1!==o.indexOf(".m4a",o.length-4)||-1!==o.indexOf(".mp4",o.length-4)||-1!==o.indexOf("blob:"),h){this._streaming?(this._htmlAudioElement=new Audio(o),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,D.Tools.SetCorsBehavior(o,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(o,(w=>{this._soundLoaded(w)}),void 0,!0,!0,(w=>{w&&M.d.Error("XHR "+w.status+" error on: "+o+"."),M.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:w=!1}w?h||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):M.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(X){M.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),vo.c.audioEngine&&!vo.c.audioEngine.WarnedWebAudioUnsupported&&(M.d.Error("Web Audio is not supported by your browser."),vo.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var w;null!==(w=vo.c.audioEngine)&&void 0!==w&&w.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(w){var o;null!==(o=vo.c.audioEngine)&&void 0!==o&&o.audioContext&&(this._audioBuffer=w,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(w){var o;null!==(o=vo.c.audioEngine)&&void 0!==o&&o.audioContext&&vo.c.audioEngine.audioContext.decodeAudioData(w,(w=>{this._audioBufferLoaded(w)}),(w=>{M.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+w)}))}setAudioBuffer(w){var o;null!==(o=vo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&(this._audioBuffer=w,this._isReadyToPlay=!0)}updateOptions(w){w&&(this.loop=w.loop??this.loop,this.maxDistance=w.maxDistance??this.maxDistance,this.useCustomAttenuation=w.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=w.rolloffFactor??this.rolloffFactor,this.refDistance=w.refDistance??this.refDistance,this.distanceModel=w.distanceModel??this.distanceModel,this._playbackRate=w.playbackRate??this._playbackRate,this._length=w.length??void 0,this.spatialSound=w.spatialSound??this._spatialSound,this._setOffset(w.offset??void 0),this.setVolume(w.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var w;null!==(w=vo.c.audioEngine)&&void 0!==w&&w.canUseWebAudio&&vo.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??vo.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var w;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(w=this._soundPanner)||void 0===w||w.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var w;null!==(w=vo.c.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(w){var o;null!==(o=vo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(w),this._isOutputConnected=!0)}setDirectionalCone(w,o,H){o<w?M.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=w,this._coneOuterAngle=o,this._coneOuterGain=H,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(w){if(w!=this._coneInnerAngle){var o;if(this._coneOuterAngle<w)return void M.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=w,null!==(o=vo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(w){if(w!=this._coneOuterAngle){var o;if(w<this._coneInnerAngle)return void M.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=w,null!==(o=vo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(w){var o;w.equals(this._position)||(this._position.t(w),null!==(o=vo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(w){var o;this._localDirection=w,null!==(o=vo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const w=this._connectedTransformNode.getWorldMatrix(),o=E.io.TransformNormal(this._localDirection,w);o.normalize(),this._soundPanner.orientationX.value=o.x,this._soundPanner.orientationY.value=o.y,this._soundPanner.orientationZ.value=o.z}updateDistanceFromListener(){var w;if(null!==(w=vo.c.audioEngine)&&void 0!==w&&w.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const w=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.so(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,w,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(w){this._customAttenuationFunction=w}play(w,o,H){var h;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(h=vo.c.audioEngine)&&void 0!==h&&h.audioContext)try{var E,e;this._clearTimeoutsAndObservers();let h=w?(null===(E=vo.c.audioEngine)||void 0===E?void 0:E.audioContext.currentTime)+w:null===(e=vo.c.audioEngine)||void 0===e?void 0:e.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=vo.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const w=()=>{var H;if(null!==(H=vo.c.audioEngine)&&void 0!==H&&H.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=o??0;const H=this._htmlAudioElement.play();void 0!==H&&H.catch((()=>{var o,H;(null===(o=vo.c.audioEngine)||void 0===o||o.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(H=vo.c.audioEngine)||void 0===H?void 0:H.onAudioUnlockedObservable.addOnce((()=>{w()})))}))}else{var h;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(h=vo.c.audioEngine)||void 0===h?void 0:h.onAudioUnlockedObservable.addOnce((()=>{w()}))}};w()}}else{var D;const E=()=>{var E;if(null!==(E=vo.c.audioEngine)&&void 0!==E&&E.audioContext){var e;if(H=H||this._length,void 0!==o&&this._setOffset(o),this._soundSource){const w=this._soundSource;w.onended=()=>{w.disconnect()}}if(this._soundSource=null===(e=vo.c.audioEngine)||void 0===e?void 0:e.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var D;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==o&&(this._soundSource.loopStart=o),void 0!==H&&(this._soundSource.loopEnd=(0|o)+H),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},h=w?(null===(D=vo.c.audioEngine)||void 0===D?void 0:D.audioContext.currentTime)+w:vo.c.audioEngine.audioContext.currentTime;const E=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(h,E,this.loop?void 0:H)}}};"suspended"===(null===(D=vo.c.audioEngine)||void 0===D?void 0:D.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var w;"suspended"===(null===(w=vo.c.audioEngine)||void 0===w?void 0:w.audioContext.state)?(vo.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=vo.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{E()})))):E()}),500):E()}this._startTime=h,this.isPlaying=!0,this.isPaused=!1}catch(t){M.d.Error("Error while trying to play audio: "+this.name+", "+t.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(w){var o;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var H;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(H=this._streamingSource)||void 0===H||H.disconnect();this.isPlaying=!1}else if(null!==(o=vo.c.audioEngine)&&void 0!==o&&o.audioContext&&this._soundSource){const o=w?vo.c.audioEngine.audioContext.currentTime+w:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(o)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var w;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var o;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(o=this._streamingSource)||void 0===o||o.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(w=vo.c.audioEngine)&&void 0!==w&&w.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=vo.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(w,o){var H;null!==(H=vo.c.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._soundGain&&(o&&vo.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(vo.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,vo.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(w,vo.c.audioEngine.audioContext.currentTime+o)):this._soundGain.gain.value=w),this._volume=w}setPlaybackRate(w){this._playbackRate=w,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(w){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=w,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=w=>this._onRegisterAfterWorldMatrixUpdate(w),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(w){var o;if(w.getBoundingInfo){const o=w.getBoundingInfo();this.setPosition(o.boundingSphere.centerWorld)}else this.setPosition(w.absolutePosition);null!==(o=vo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const w=()=>{(0,mH.h)((()=>this._isReadyToPlay),(()=>{H._audioBuffer=this.getAudioBuffer(),H._isReadyToPlay=!0,H.autoplay&&H.play(0,this._offset,this._length)}),void 0,300)},o={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},H=new Yo(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,o);return this.useCustomAttenuation&&H.setAttenuationFunction(this._customAttenuationFunction),H.setPosition(this._position),H.setPlaybackRate(this._playbackRate),w(),H}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const w={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(w.connectedMeshId=this._connectedTransformNode.id),w.position=this._position.Ae(),w.refDistance=this.refDistance,w.distanceModel=this.distanceModel,w.isDirectional=this._isDirectional,w.localDirectionToMesh=this._localDirection.Ae(),w.coneInnerAngle=this._coneInnerAngle,w.coneOuterAngle=this._coneOuterAngle,w.coneOuterGain=this._coneOuterGain),w}static Parse(w,o,H,h){const e=w.name;let D;D=w.url?H+w.url:H+e;const t={autoplay:w.autoplay,loop:w.loop,volume:w.volume,spatialSound:w.spatialSound,maxDistance:w.maxDistance,rolloffFactor:w.rolloffFactor,refDistance:w.refDistance,distanceModel:w.distanceModel,playbackRate:w.playbackRate};let X;if(h){const w=()=>{(0,mH.h)((()=>h._isReadyToPlay),(()=>{X._audioBuffer=h.getAudioBuffer(),X._isReadyToPlay=!0,X.autoplay&&X.play(0,X._offset,X._length)}),void 0,300)};X=new Yo(e,new ArrayBuffer(0),o,null,t),w()}else X=new Yo(e,D,o,(()=>{o.removePendingData(X)}),t),o.addPendingData(X);if(w.position){const o=E.io.Po(w.position);X.setPosition(o)}if(w.isDirectional&&(X.setDirectionalCone(w.coneInnerAngle||360,w.coneOuterAngle||360,w.coneOuterGain||0),w.localDirectionToMesh)){const o=E.io.Po(w.localDirectionToMesh);X.setLocalDirectionToMesh(o)}if(w.connectedMeshId){const H=o.getMeshById(w.connectedMeshId);H&&X.attachToMesh(H)}return w.metadata&&(X.metadata=w.metadata),X}_setOffset(w){this._offset!==w&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=w)}_clearTimeoutsAndObservers(){var w;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(w=vo.c.audioEngine)||void 0===w||w.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Yo._SceneComponentInitialization=w=>{throw(0,Fo.b)("AudioSceneComponent")},(0,lw.g)("BABYLON.Sound",Yo);class xo{constructor(w,o,H){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],o.length!==H.length)throw new Error("Sounds length does not equal weights length");this.loop=w,this._weights=H;let h=0;for(const e of H)h+=e;const E=h>0?1/h:0;for(let e=0;e<this._weights.length;e++)this._weights[e]*=E;this._sounds=o;for(const e of this._sounds)e.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(w){if(w!==this._coneInnerAngle){if(this._coneOuterAngle<w)return void M.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=w;for(const o of this._sounds)o.directionalConeInnerAngle=w}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(w){if(w!==this._coneOuterAngle){if(w<this._coneInnerAngle)return void M.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=w;for(const o of this._sounds)o.directionalConeOuterAngle=w}}get volume(){return this._volume}set volume(w){if(w!==this._volume)for(const o of this._sounds)o.setVolume(w)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(w){if(!this.isPaused){this.stop();const w=Math.random();let o=0;for(let H=0;H<this._weights.length;H++)if(o+=this._weights[H],w<=o){this._currentIndex=H;break}}const o=this._sounds[this._currentIndex??0];o.isReady()?o.play(0,this.isPaused?void 0:w):o.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class wH{constructor(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(w=w||Q.e.LastCreatedScene)&&(this._scene=w,this.soundCollection=[],this._options=o,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var w;null!==(w=vo.c.audioEngine)&&void 0!==w&&w.canUseWebAudio&&vo.c.audioEngine.audioContext&&(this._outputAudioNode=vo.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(vo.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(vo.c.audioEngine&&vo.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(w){var o;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(o=vo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._outputAudioNode&&w.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==w.soundTrackId&&(-1===w.soundTrackId?this._scene.mainSoundTrack.removeSound(w):this._scene.soundTracks&&this._scene.soundTracks[w.soundTrackId].removeSound(w)),this.soundCollection.push(w),w.soundTrackId=this.id}removeSound(w){const o=this.soundCollection.indexOf(w);-1!==o&&this.soundCollection.splice(o,1)}setVolume(w){var o;null!==(o=vo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=w)}switchPanningModelToHRTF(){var w;if(null!==(w=vo.c.audioEngine)&&void 0!==w&&w.canUseWebAudio)for(let o=0;o<this.soundCollection.length;o++)this.soundCollection[o].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var w;if(null!==(w=vo.c.audioEngine)&&void 0!==w&&w.canUseWebAudio)for(let o=0;o<this.soundCollection.length;o++)this.soundCollection[o].switchPanningModelToEqualPower()}connectToAnalyser(w){var o;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=w,null!==(o=vo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,vo.c.audioEngine.masterGain))}}var oH=H(11987),HH=H(11957),hH=H(11545);vo.c.AudioEngineFactory=(w,o,H)=>new EH(w,o,H);class EH{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new A.b,this.onAudioLockedObservable=new A.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,hH.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const h=document.createElement("audio");this._hostElement=w,this._audioContext=o,this._audioDestination=H;try{h&&h.canPlayType&&(h.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||h.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(E){}try{h&&h.canPlayType&&h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(E){}}lock(){this._triggerSuspendedState()}unlock(){var w,o;if("running"===(null===(w=this._audioContext)||void 0===w?void 0:w.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(o=this._audioContext)||void 0===o||o.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{M.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var w;null===(w=this._audioContext)||void 0===w||w.addEventListener("statechange",(()=>{var w;this.unlocked&&"running"!==(null===(w=this._audioContext)||void 0===w?void 0:w.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var w;return null!==(w=this._audioContext)&&void 0!==w&&w.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(w){this.canUseWebAudio=!1,M.d.Error("Web Audio: "+w.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(w){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const w=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",o=document.createElement("style");o.appendChild(document.createTextNode(w)),document.getElementsByTagName("head")[0].appendChild(o),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var w;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(w=this._audioContext)||void 0===w||w.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(w){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=w)}connectToAnalyser(w){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=w,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var eH=H(11560);(0,H(13113).d)(oH.c.NAME_AUDIO,((w,o,H,h)=>{let E,e=[];if(H.Gz=H.Gz||[],void 0!==w.Gz&&null!==w.Gz)for(let t=0,X=w.Gz.length;t<X;t++){var D;const X=w.Gz[t];null!==(D=vo.c.audioEngine)&&void 0!==D&&D.canUseWebAudio?(X.url||(X.url=X.name),e[X.url]?H.Gz.push(Yo.Parse(X,o,h,e[X.url])):(E=Yo.Parse(X,o,h),e[X.url]=E,H.Gz.push(E))):H.Gz.push(new Yo(X.name,null,o))}e=[]})),Object.defineProperty(HH.e.prototype,"mainSoundTrack",{get:function(){let w=this._getComponent(oH.c.NAME_AUDIO);return w||(w=new DH(this),this.o(w)),this._mainSoundTrack||(this._mainSoundTrack=new wH(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),HH.e.prototype.getSoundByName=function(w){let o;for(o=0;o<this.mainSoundTrack.soundCollection.length;o++)if(this.mainSoundTrack.soundCollection[o].name===w)return this.mainSoundTrack.soundCollection[o];if(this.soundTracks)for(let H=0;H<this.soundTracks.length;H++)for(o=0;o<this.soundTracks[H].soundCollection.length;o++)if(this.soundTracks[H].soundCollection[o].name===w)return this.soundTracks[H].soundCollection[o];return null},Object.defineProperty(HH.e.prototype,"audioEnabled",{get:function(){let w=this._getComponent(oH.c.NAME_AUDIO);return w||(w=new DH(this),this.o(w)),w.audioEnabled},set:function(w){let o=this._getComponent(oH.c.NAME_AUDIO);o||(o=new DH(this),this.o(o)),w?o.enableAudio():o.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(HH.e.prototype,"headphone",{get:function(){let w=this._getComponent(oH.c.NAME_AUDIO);return w||(w=new DH(this),this.o(w)),w.headphone},set:function(w){let o=this._getComponent(oH.c.NAME_AUDIO);o||(o=new DH(this),this.o(o)),w?o.switchAudioModeForHeadphones():o.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(HH.e.prototype,"audioListenerPositionProvider",{get:function(){let w=this._getComponent(oH.c.NAME_AUDIO);return w||(w=new DH(this),this.o(w)),w.audioListenerPositionProvider},set:function(w){let o=this._getComponent(oH.c.NAME_AUDIO);if(o||(o=new DH(this),this.o(o)),w&&"function"!==typeof w)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");o.audioListenerPositionProvider=w},enumerable:!0,configurable:!0}),Object.defineProperty(HH.e.prototype,"audioListenerRotationProvider",{get:function(){let w=this._getComponent(oH.c.NAME_AUDIO);return w||(w=new DH(this),this.o(w)),w.audioListenerRotationProvider},set:function(w){let o=this._getComponent(oH.c.NAME_AUDIO);if(o||(o=new DH(this),this.o(o)),w&&"function"!==typeof w)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");o.audioListenerRotationProvider=w},enumerable:!0,configurable:!0}),Object.defineProperty(HH.e.prototype,"audioPositioningRefreshRate",{get:function(){let w=this._getComponent(oH.c.NAME_AUDIO);return w||(w=new DH(this),this.o(w)),w.audioPositioningRefreshRate},set:function(w){let o=this._getComponent(oH.c.NAME_AUDIO);o||(o=new DH(this),this.o(o)),o.audioPositioningRefreshRate=w},enumerable:!0,configurable:!0});class DH{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(w){this.name=oH.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new E.io,this._cachedCameraPosition=new E.io,this._lastCheck=0,this._invertMatrixTemp=new E.Matrix,this._cameraDirectionTemp=new E.io,(w=w||Q.e.LastCreatedScene)&&(this.Vo=w,w.soundTracks=[],w.Gz=[])}register(){this.Vo._afterRenderStage.registerStep(oH.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(w){if(w.Gz=[],this.Vo.soundTracks)for(let o=0;o<this.Vo.soundTracks.length;o++){const H=this.Vo.soundTracks[o];for(let o=0;o<H.soundCollection.length;o++)w.Gz.push(H.soundCollection[o].serialize())}}addFromContainer(w){if(w.Gz)for(const o of w.Gz)o.play(),o.autoplay=!0,this.Vo.mainSoundTrack.addSound(o)}removeFromContainer(w){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(w.Gz)for(const H of w.Gz)H.stop(),H.autoplay=!1,this.Vo.mainSoundTrack.removeSound(H),o&&H.dispose()}dispose(){const w=this.Vo;if(w._mainSoundTrack&&w.mainSoundTrack.dispose(),w.soundTracks)for(let o=0;o<w.soundTracks.length;o++)w.soundTracks[o].dispose()}disableAudio(){const w=this.Vo;let o;for(this._audioEnabled=!1,vo.c.audioEngine&&vo.c.audioEngine.audioContext&&vo.c.audioEngine.audioContext.suspend(),o=0;o<w.mainSoundTrack.soundCollection.length;o++)w.mainSoundTrack.soundCollection[o].pause();if(w.soundTracks)for(o=0;o<w.soundTracks.length;o++)for(let H=0;H<w.soundTracks[o].soundCollection.length;H++)w.soundTracks[o].soundCollection[H].pause()}enableAudio(){const w=this.Vo;let o;for(this._audioEnabled=!0,vo.c.audioEngine&&vo.c.audioEngine.audioContext&&vo.c.audioEngine.audioContext.resume(),o=0;o<w.mainSoundTrack.soundCollection.length;o++)w.mainSoundTrack.soundCollection[o].isPaused&&w.mainSoundTrack.soundCollection[o].play();if(w.soundTracks)for(o=0;o<w.soundTracks.length;o++)for(let H=0;H<w.soundTracks[o].soundCollection.length;H++)w.soundTracks[o].soundCollection[H].isPaused&&w.soundTracks[o].soundCollection[H].play()}switchAudioModeForHeadphones(){const w=this.Vo;if(this._headphone=!0,w.mainSoundTrack.switchPanningModelToHRTF(),w.soundTracks)for(let o=0;o<w.soundTracks.length;o++)w.soundTracks[o].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const w=this.Vo;if(this._headphone=!1,w.mainSoundTrack.switchPanningModelToEqualPower(),w.soundTracks)for(let o=0;o<w.soundTracks.length;o++)w.soundTracks[o].switchPanningModelToEqualPower()}_afterRender(){const w=eH.c.Now;if(this._lastCheck&&w-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=w;const o=this.Vo;if(!this._audioEnabled||!o._mainSoundTrack||!o.soundTracks||0===o._mainSoundTrack.soundCollection.length&&1===o.soundTracks.length)return;const H=vo.c.audioEngine;if(H&&H.audioContext){let w,h=o.activeCamera;if(o.activeCameras&&o.activeCameras.length>0&&(h=o.activeCameras[0]),this.audioListenerPositionProvider){const w=this.audioListenerPositionProvider();H.audioContext.listener.setPosition(w.x||0,w.y||0,w.z||0)}else h?this._cachedCameraPosition.equals(h.globalPosition)||(this._cachedCameraPosition.t(h.globalPosition),H.audioContext.listener.setPosition(h.globalPosition.x,h.globalPosition.y,h.globalPosition.z)):H.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const w=this.audioListenerRotationProvider();H.audioContext.listener.setOrientation(w.x||0,w.y||0,w.z||0,0,1,0)}else h?(h.rigCameras&&h.rigCameras.length>0&&(h=h.rigCameras[0]),h.getViewMatrix().invertToRef(this._invertMatrixTemp),E.io.TransformNormalToRef(DH._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.t(this._cameraDirectionTemp),H.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):H.audioContext.listener.setOrientation(0,0,0,0,1,0);for(w=0;w<o.mainSoundTrack.soundCollection.length;w++){const H=o.mainSoundTrack.soundCollection[w];H.useCustomAttenuation&&H.updateDistanceFromListener()}if(o.soundTracks)for(w=0;w<o.soundTracks.length;w++)for(let H=0;H<o.soundTracks[w].soundCollection.length;H++){const h=o.soundTracks[w].soundCollection[H];h.useCustomAttenuation&&h.updateDistanceFromListener()}}}}DH._CameraDirection=new E.io(0,0,-1),Yo._SceneComponentInitialization=w=>{let o=w._getComponent(oH.c.NAME_AUDIO);o||(o=new DH(w),w.o(o))};const tH="MSFT_audio_emitter";class XH{constructor(w){this.name=tH,this._loader=w,this.enabled=this._loader.isExtensionUsed(tH)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const w=this._loader.he.extensions;if(w&&w[this.name]){const o=w[this.name];this._clips=o.clips,this._emitters=o.emitters,R.Assign(this._clips),R.Assign(this._emitters)}}loadSceneAsync(w,o){return d.LoadExtensionAsync(w,o,this.name,(async(H,h)=>{const E=new Array;E.push(this._loader.loadSceneAsync(w,o));for(const w of h.emitters){const o=R.Get(`${H}/emitters`,this._emitters,w);if(void 0!=o.refDistance||void 0!=o.maxDistance||void 0!=o.rolloffFactor||void 0!=o.distanceModel||void 0!=o.innerAngle||void 0!=o.outerAngle)throw new Error(`${H}: Direction or Distance properties are not allowed on emitters attached to a scene`);E.push(this._loadEmitterAsync(`${H}/emitters/${o.index}`,o))}await Promise.all(E)}))}loadNodeAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(w,h)=>{const e=new Array,t=await this._loader.loadNodeAsync(w,o,(o=>{for(const H of h.emitters){const h=R.Get(`${w}/emitters`,this._emitters,H);e.push(this._loadEmitterAsync(`${w}/emitters/${h.index}`,h).then((()=>{for(const w of h._babylonSounds)w.attachToMesh(o),void 0==h.innerAngle&&void 0==h.outerAngle||(w.setLocalDirectionToMesh(E.io.Forward()),w.setDirectionalCone(2*D.Tools.ToDegrees(void 0==h.innerAngle?Math.PI:h.innerAngle),2*D.Tools.ToDegrees(void 0==h.outerAngle?Math.PI:h.outerAngle),0))})))}H(o)}));return await Promise.all(e),t}))}loadAnimationAsync(w,o){return d.LoadExtensionAsync(w,o,this.name,(async(H,h)=>{const E=await this._loader.loadAnimationAsync(w,o),e=new Array;R.Assign(h.events);for(const D of h.events)e.push(this._loadAnimationEventAsync(`${H}/events/${D.index}`,w,o,D,E));return await Promise.all(e),E}))}_loadClipAsync(w,o){if(o._objectURL)return o._objectURL;let H;if(o.uri)H=this._loader.loadUriAsync(w,o,o.uri);else{const h=R.Get(`${w}/bufferView`,this._loader.he.bufferViews,o.bufferView);H=this._loader.loadBufferViewAsync(`/bufferViews/${h.index}`,h)}return o._objectURL=H.then((w=>URL.createObjectURL(new Blob([w],{type:o.mimeType})))),o._objectURL}_loadEmitterAsync(w,o){if(o._babylonSounds=o._babylonSounds||[],!o._babylonData){const w=new Array,H=o.name||`emitter${o.index}`,h={loop:!1,autoplay:!1,volume:void 0==o.volume?1:o.volume};for(let e=0;e<o.clips.length;e++){const E=`/extensions/${this.name}/clips`,D=R.Get(E,this._clips,o.clips[e].clip);w.push(this._loadClipAsync(`${E}/${o.clips[e].clip}`,D).then((w=>{const E=o._babylonSounds[e]=new Yo(H,w,this._loader.babylonScene,null,h);E.refDistance=o.refDistance||1,E.maxDistance=o.maxDistance||256,E.rolloffFactor=o.rolloffFactor||1,E.distanceModel=o.distanceModel||"exponential"})))}const E=Promise.all(w).then((()=>{const w=o.clips.map((w=>w.weight||1)),H=new xo(o.loop||!1,o._babylonSounds,w);o.innerAngle&&(H.directionalConeInnerAngle=2*D.Tools.ToDegrees(o.innerAngle)),o.outerAngle&&(H.directionalConeOuterAngle=2*D.Tools.ToDegrees(o.outerAngle)),o.volume&&(H.volume=o.volume),o._babylonData.sound=H}));o._babylonData={loaded:E}}return o._babylonData.loaded}_getEventAction(w,o,H,h,E){switch(H){case"play":return w=>{const H=(E||0)+(w-h);o.play(H)};case"stop":return()=>{o.stop()};case"pause":return()=>{o.pause()};default:throw new Error(`${w}: Unsupported action ${H}`)}}_loadAnimationEventAsync(w,o,H,h,E){if(0==E.targetedAnimations.length)return Promise.resolve();const e=E.targetedAnimations[0],D=h.Eo,t=R.Get(`/extensions/${this.name}/emitters`,this._emitters,D);return this._loadEmitterAsync(w,t).then((()=>{const o=t._babylonData.sound;if(o){const H=new Ko(h.time,this._getEventAction(w,o,h.action,h.time,h.startOffset));e.animation.addEvent(H),E.onAnimationGroupEndObservable.add((()=>{o.stop()})),E.onAnimationGroupPauseObservable.add((()=>{o.pause()}))}}))}}q(tH),j(tH,!0,(w=>new XH(w)));const LH="MSFT_lod";class AH{constructor(w){var o;this.name=LH,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new A.b,this.onMaterialLODsLoadedObservable=new A.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=w,this.maxLODsToLoad=(null===(o=this._loader.parent.extensionOptions[LH])||void 0===o?void 0:o.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(LH)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let w=0;w<this._nodePromiseLODs.length;w++){const o=Promise.all(this._nodePromiseLODs[w]).then((()=>{0!==w&&(this._loader.endPerformanceCounter(`Node LOD ${w}`),this._loader.log(`Loaded node LOD ${w}`)),this.onNodeLODsLoadedObservable.notifyObservers(w),w!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${w+1}`),this._loadBufferLOD(this._nodeBufferLODs,w+1),this._nodeSignalLODs[w]&&this._nodeSignalLODs[w].resolve())}));this._loader._completePromises.push(o)}for(let w=0;w<this._materialPromiseLODs.length;w++){const o=Promise.all(this._materialPromiseLODs[w]).then((()=>{0!==w&&(this._loader.endPerformanceCounter(`Material LOD ${w}`),this._loader.log(`Loaded material LOD ${w}`)),this.onMaterialLODsLoadedObservable.notifyObservers(w),w!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${w+1}`),this._loadBufferLOD(this._materialBufferLODs,w+1),this._materialSignalLODs[w]&&this._materialSignalLODs[w].resolve())}));this._loader._completePromises.push(o)}}loadSceneAsync(w,o){const H=this._loader.loadSceneAsync(w,o);return this._loadBufferLOD(this._bufferLODs,0),H}loadNodeAsync(w,o,H){return d.LoadExtensionAsync(w,o,this.name,(async(w,E)=>{let e;const D=this._getLODs(w,o,this._loader.he.nodes,E.ids);this._loader.logOpen(`${w}`);for(let o=0;o<D.length;o++){const w=D[o];0!==o&&(this._nodeIndexLOD=o,this._nodeSignalLODs[o]=this._nodeSignalLODs[o]||new h);const E=w=>{H(w),w.Ut(!1)},t=this._loader.loadNodeAsync(`/nodes/${w.index}`,w,E).then((w=>{if(0!==o){const w=D[o-1];w._babylonTransformNode&&(this._disposeTransformNode(w._babylonTransformNode),delete w._babylonTransformNode)}return w.Ut(!0),w}));this._nodePromiseLODs[o]=this._nodePromiseLODs[o]||[],0===o?e=t:(this._nodeIndexLOD=null,this._nodePromiseLODs[o].push(t))}return this._loader.logClose(),await e}))}_loadMaterialAsync(w,o,H,h,E){return this._nodeIndexLOD?null:d.LoadExtensionAsync(w,o,this.name,(async(w,e)=>{let D;const t=this._getLODs(w,o,this._loader.he.materials,e.ids);this._loader.logOpen(`${w}`);for(let o=0;o<t.length;o++){const w=t[o];0!==o&&(this._materialIndexLOD=o);const e=this._loader._loadMaterialAsync(`/materials/${w.index}`,w,H,h,(w=>{0===o&&E(w)})).then((w=>{if(0!==o){E(w);const H=t[o-1]._data;H[h]&&(this._disposeMaterials([H[h].babylonMaterial]),delete H[h])}return w}));this._materialPromiseLODs[o]=this._materialPromiseLODs[o]||[],0===o?D=e:(this._materialIndexLOD=null,this._materialPromiseLODs[o].push(e))}return this._loader.logClose(),await D}))}_loadUriAsync(w,o,H){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const E=this._nodeIndexLOD-1;return this._nodeSignalLODs[E]=this._nodeSignalLODs[E]||new h,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(w,o,H)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const E=this._materialIndexLOD-1;return this._materialSignalLODs[E]=this._materialSignalLODs[E]||new h,this._materialSignalLODs[E].promise.then((async()=>await this._loader.loadUriAsync(w,o,H)))}return null}loadBufferAsync(w,o,H,E){if(this._loader.parent.useRangeRequests&&!o.uri){if(!this._loader.bin)throw new Error(`${w}: Uri is missing or the binary glTF is missing its binary chunk`);const o=async(w,o)=>{const e=H,D=e+E-1;let t=w[o];return t?(t.start=Math.min(t.start,e),t.end=Math.max(t.end,D)):(t={start:e,end:D,loaded:new h},w[o]=t),await t.loaded.promise.then((w=>new Uint8Array(w.buffer,w.byteOffset+H-t.start,E)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?o(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?o(this._materialBufferLODs,this._materialIndexLOD):o(this._bufferLODs,0)}return null}_loadBufferLOD(w,o){const H=w[o];H&&(this._loader.log(`Loading buffer range [${H.start}-${H.end}]`),this._loader.bin.readAsync(H.start,H.end-H.start+1).then((w=>{H.loaded.resolve(w)}),(w=>{H.loaded.reject(w)})))}_getLODs(w,o,H,h){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const E=[];for(let e=h.length-1;e>=0;e--)if(E.push(R.Get(`${w}/ids/${h[e]}`,H,h[e])),E.length===this.maxLODsToLoad)return E;return E.push(o),E}_disposeTransformNode(w){const o=[],H=w.material;H&&o.push(H);for(const E of w.getChildMeshes())E.material&&o.push(E.material);w.dispose();const h=o.filter((w=>this._loader.babylonScene.meshes.every((o=>o.material!=w))));this._disposeMaterials(h)}_disposeMaterials(w){const o={};for(const H of w){for(const w of H.getActiveTextures())o[w.uniqueId]=w;H.dispose()}for(const H in o)for(const w of this._loader.babylonScene.materials)w.hasTexture(o[H])&&delete o[H];for(const H in o)o[H].dispose()}}q(LH),j(LH,!0,(w=>new AH(w)));const yH="MSFT_minecraftMesh";class zH{constructor(w){this.name=yH,this._loader=w,this.enabled=this._loader.isExtensionUsed(yH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtraAsync(w,o,this.name,(async(h,E)=>{if(E){if(!(H instanceof r.c))throw new Error(`${h}: Material type not supported`);const E=this._loader.loadMaterialPropertiesAsync(w,o,H);return H.needAlphaBlending()&&(H.forceDepthWrite=!0,H.separateCullingPass=!0),H.Oe=H.forceDepthWrite,H.twoSidedLighting=!0,await E}}))}}q(yH),j(yH,!0,(w=>new zH(w)));const CH="MSFT_sRGBFactors";class QH{constructor(w){this.name=CH,this._loader=w,this.enabled=this._loader.isExtensionUsed(CH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(w,o,H){return d.LoadExtraAsync(w,o,this.name,(async(h,E)=>{if(E){if(!(H instanceof r.c))throw new Error(`${h}: Material type not supported`);const E=this._loader.loadMaterialPropertiesAsync(w,o,H),e=H.Ow().getEngine().useExactSrgbConversions;return H.albedoTexture||H.albedoColor.toLinearSpaceToRef(H.albedoColor,e),H.reflectivityTexture||H.reflectivityColor.toLinearSpaceToRef(H.reflectivityColor,e),await E}}))}}q(CH),j(CH,!0,(w=>new QH(w)));var MH=H(13435);const iH={};var sH=H(13494),VH=H(13469),rH=H(13439),kH=H(13455);function PH(w,o){for(const H of w)for(const w of H.dataOutputs)if(w.uniqueId===o)return w;throw new Error("Could not find data out connection with unique id "+o)}function lH(w,o){for(const H of w)if(H instanceof VH.d)for(const w of H.signalInputs)if(w.uniqueId===o)return w;throw new Error("Could not find signal in connection with unique id "+o)}async function OH(w,o){const h=await Promise.all(w.allBlocks.map((async w=>{const o=function(w){switch(w){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([H.e(78),H.e(79)]).then(H.bind(H,14990))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await H.e(80).then(H.bind(H,14992))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await H.e(81).then(H.bind(H,14997))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await H.e(82).then(H.bind(H,15e3))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await H.e(83).then(H.bind(H,15004))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await H.e(84).then(H.bind(H,15013))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await H.e(85).then(H.bind(H,15020))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await H.e(86).then(H.bind(H,15025))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await H.e(87).then(H.bind(H,15033))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await H.e(89).then(H.bind(H,15064))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await H.e(89).then(H.bind(H,15064))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await H.e(89).then(H.bind(H,15064))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await H.e(89).then(H.bind(H,15064))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await H.e(89).then(H.bind(H,15064))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await H.e(89).then(H.bind(H,15064))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await H.e(90).then(H.bind(H,15071))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await H.e(90).then(H.bind(H,15071))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await H.e(90).then(H.bind(H,15071))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await H.e(90).then(H.bind(H,15071))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await H.e(95).then(H.bind(H,15079))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await H.e(96).then(H.bind(H,15085))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await H.e(97).then(H.bind(H,15087))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await H.e(98).then(H.bind(H,15096))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await H.e(99).then(H.bind(H,15104))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await H.e(100).then(H.bind(H,15113))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await H.e(101).then(H.bind(H,15115))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await H.e(102).then(H.bind(H,15124))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await H.e(103).then(H.bind(H,15133))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await H.e(104).then(H.bind(H,15139))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await H.e(105).then(H.bind(H,15143))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await H.e(106).then(H.bind(H,15146))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await H.e(107).then(H.bind(H,15152))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await H.e(108).then(H.bind(H,15161))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await H.e(109).then(H.bind(H,15169))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await H.e(110).then(H.bind(H,15175))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await H.e(111).then(H.bind(H,15182))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await H.e(112).then(H.bind(H,15190))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await H.e(113).then(H.bind(H,15198))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await H.e(92).then(H.bind(H,15204))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await H.e(114).then(H.bind(H,15208))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await H.e(115).then(H.bind(H,15210))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await H.e(116).then(H.bind(H,15214))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await H.e(93).then(H.bind(H,15219))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await H.e(88).then(H.bind(H,15037))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await H.e(94).then(H.bind(H,15225))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await H.e(94).then(H.bind(H,15225))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await H.e(94).then(H.bind(H,15225))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await H.e(94).then(H.bind(H,15225))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await H.e(94).then(H.bind(H,15225))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await H.e(94).then(H.bind(H,15225))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await H.e(94).then(H.bind(H,15225))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await H.e(94).then(H.bind(H,15225))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await H.e(89).then(H.bind(H,15064))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await H.e(89).then(H.bind(H,15064))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await H.e(89).then(H.bind(H,15064))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await H.e(89).then(H.bind(H,15064))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await H.e(89).then(H.bind(H,15064))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await H.e(89).then(H.bind(H,15064))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await H.e(89).then(H.bind(H,15064))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await H.e(90).then(H.bind(H,15071))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await H.e(90).then(H.bind(H,15071))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await H.e(91).then(H.bind(H,15227))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await H.e(91).then(H.bind(H,15227))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await H.e(91).then(H.bind(H,15227))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await H.e(91).then(H.bind(H,15227))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await H.e(91).then(H.bind(H,15227))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await H.e(91).then(H.bind(H,15227))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await H.e(117).then(H.bind(H,15232))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await H.e(118).then(H.bind(H,15241))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await H.e(119).then(H.bind(H,15244))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await H.e(120).then(H.bind(H,15252))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await H.e(121).then(H.bind(H,15256))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await H.e(122).then(H.bind(H,15259))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await H.e(123).then(H.bind(H,15263))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await H.e(124).then(H.bind(H,15271))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await H.e(125).then(H.bind(H,15278))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await H.e(126).then(H.bind(H,15280))).FlowGraphDataSwitchBlock;default:if(iH[w])return iH[w];throw new Error(`Unknown block name ${w}`)}}(w.className);return await o()})));return function(w,o,H){const h=o.coordinator.createGraph(),E=[],e=o.valueParseFunction??rH.b;for(let D=0;D<w.allBlocks.length;D++){const t=SH(w.allBlocks[D],{Vo:o.coordinator.config.Vo,pathConverter:o.pathConverter,assetsContainer:o.coordinator.config.Vo,valueParseFunction:e},H[D]);E.push(t),t instanceof sH.c&&h.addEventBlock(t)}for(const D of E){for(const w of D.dataInputs)for(const o of w.connectedPointIds){const H=PH(E,o);w.connectTo(H)}if(D instanceof VH.d)for(const w of D.signalOutputs)for(const o of w.connectedPointIds){const H=lH(E,o);w.connectTo(H)}}for(const D of w.executionContexts)TH(D,{graph:h,valueParseFunction:e},w.rightHanded);return h}(w,o,h)}function TH(w,o,H){const h=o.graph.createContext();w.enableLogging&&(h.enableLogging=!0),h.treatDataAsRightHanded=H||!1;const E=o.valueParseFunction??rH.b;h.uniqueId=w.uniqueId;const e=h.Ow();if(w._assetsContext){var D,t,X,L,A,y,z,C,Q,M;const o=w._assetsContext,H={meshes:null===(D=o.meshes)||void 0===D?void 0:D.map((w=>e.getMeshById(w))),lights:null===(t=o.lights)||void 0===t?void 0:t.map((w=>e.getLightByName(w))),cameras:null===(X=o.cameras)||void 0===X?void 0:X.map((w=>e.getCameraByName(w))),materials:null===(L=o.materials)||void 0===L?void 0:L.map((w=>e.getMaterialById(w))),textures:null===(A=o.textures)||void 0===A?void 0:A.map((w=>e.getTextureByName(w))),animations:null===(y=o.animations)||void 0===y?void 0:y.map((w=>e.animations.find((o=>o.name===w)))),skeletons:null===(z=o.skeletons)||void 0===z?void 0:z.map((w=>e.getSkeletonByName(w))),Ez:null===(C=o.Ez)||void 0===C?void 0:C.map((w=>e.getParticleSystemById(w))),animationGroups:null===(Q=o.animationGroups)||void 0===Q?void 0:Q.map((w=>e.getAnimationGroupByName(w))),transformNodes:null===(M=o.transformNodes)||void 0===M?void 0:M.map((w=>e.getTransformNodeById(w))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Gz:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};h.assetsContext=H}for(const i in w._userVariables){const o=E(i,w._userVariables,h.assetsContext,e);h.userVariables[i]=o}for(const i in w._connectionValues){const o=E(i,w._connectionValues,h.assetsContext,e);h._setConnectionValueByKey(i,o)}return h}function SH(w,o,H){const h={},E=o.valueParseFunction??rH.b;if(w.config)for(const D in w.config)h[D]=E(D,w.config,o.assetsContainer||o.Vo,o.Vo);if((0,rH.g)(w.className)){if(!o.pathConverter)throw new Error("Path converter is required for this block");h.pathConverter=o.pathConverter}const e=new H(h);e.uniqueId=w.uniqueId;for(let D=0;D<w.dataInputs.length;D++){const o=e.getDataInput(w.dataInputs[D].name);if(!o)throw new Error("Could not find data input with name "+w.dataInputs[D].name+" in block "+w.className);o.deserialize(w.dataInputs[D])}for(let D=0;D<w.dataOutputs.length;D++){const o=e.getDataOutput(w.dataOutputs[D].name);if(!o)throw new Error("Could not find data output with name "+w.dataOutputs[D].name+" in block "+w.className);o.deserialize(w.dataOutputs[D])}return e.metadata=w.metadata,e.deserialize&&e.deserialize(w),e}function cH(w){const[o,H]=w.split(":");return WH({op:o,extension:H})}function WH(w){var o;let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const h=w.extension?null===(o=JH[w.extension])||void 0===o?void 0:o[w.op]:gH[w.op];if(!h&&(M.d.Warn(`No mapping found for operation ${w.op} and extension ${w.extension||"KHR_interactivity"}`),H)){const o={},H={flows:{}};if(w.inputValueSockets){o.values={};for(const H in w.inputValueSockets)o.values[H]={name:H}}return w.outputValueSockets&&(H.values={},Object.keys(w.outputValueSockets).forEach((w=>{H.values[w]={name:w}}))),{MA:[],inputs:o,outputs:H}}return h}function BH(w,o,H){JH[o]||(JH[o]={}),JH[o][w]=H}const JH={BABYLON:{"flow/log":{MA:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},gH={"event/onStart":{MA:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{MA:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{MA:["FlowGraphSendCustomEventBlock"],extraProcessor(w,o,H,h,E){if("event/send"!==o.op||!w.configuration||1!==Object.keys(w.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const e=w.configuration.event.value[0];if("number"!==typeof e)throw new Error("Event id should be a number");const D=h.arrays.events[e],t=E[0];return t.config||(t.config={}),t.config.eventId=D.eventId,t.config.eventData=D.eventData,E}},"event/receive":{MA:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(w,o){var H;if(!w.configuration)return M.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const h=w.configuration.event;if(!h)return M.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const E=h.value[0];if("number"!==typeof E)return M.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(H=o.events)||void 0===H?void 0:H[E])?{valid:!0}:(M.d.Error(`Event with id ${E} not found`),{valid:!1,error:`Event with id ${E} not found`})},extraProcessor(w,o,H,h,E){if("event/receive"!==o.op||!w.configuration||1!==Object.keys(w.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const e=w.configuration.event.value[0];if("number"!==typeof e)throw new Error("Event id should be a number");const D=h.arrays.events[e],t=E[0];return t.config||(t.config={}),t.config.eventId=D.eventId,t.config.eventData=D.eventData,E}},"math/e":bH("FlowGraphEBlock"),"math/pi":bH("FlowGraphPIBlock"),"math/inf":bH("FlowGraphInfBlock"),"math/nan":bH("FlowGraphNaNBlock"),"math/abs":bH("FlowGraphAbsBlock"),"math/sign":bH("FlowGraphSignBlock"),"math/trunc":bH("FlowGraphTruncBlock"),"math/floor":bH("FlowGraphFloorBlock"),"math/ceil":bH("FlowGraphCeilBlock"),"math/round":{MA:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,o,H,h,E){var e;return(e=E[0]).config||(e.config={}),E[0].config.roundHalfAwayFromZero=!0,E}},"math/fract":bH("FlowGraphFractBlock"),"math/neg":bH("FlowGraphNegationBlock"),"math/add":bH("FlowGraphAddBlock",["a","b"],!0),"math/sub":bH("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{MA:["FlowGraphMultiplyBlock"],extraProcessor(w,o,H,h,E){var e;(e=E[0]).config||(e.config={}),E[0].config.useMatrixPerComponent=!0,E[0].config.preventIntegerFloatArithmetic=!0;let D=-1;return Object.keys(w.values||{}).find((o=>{var H;return void 0!==(null===(H=w.values)||void 0===H?void 0:H[o].type)&&(D=w.values[o].type,!0)})),-1!==D&&(E[0].config.type=h.arrays.types[D].flowGraphType),E},validation:w=>w.values?pH(w):{valid:!0}},"math/div":bH("FlowGraphDivideBlock",["a","b"],!0),"math/rem":bH("FlowGraphModuloBlock",["a","b"]),"math/min":bH("FlowGraphMinBlock",["a","b"]),"math/max":bH("FlowGraphMaxBlock",["a","b"]),"math/clamp":bH("FlowGraphClampBlock",["a","b","c"]),"math/saturate":bH("FlowGraphSaturateBlock"),"math/mix":bH("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":bH("FlowGraphEqualityBlock",["a","b"]),"math/lt":bH("FlowGraphLessThanBlock",["a","b"]),"math/le":bH("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":bH("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":bH("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":bH("FlowGraphIsNaNBlock"),"math/isinf":bH("FlowGraphIsInfBlock"),"math/select":{MA:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{MA:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":bH("FlowGraphSinBlock"),"math/cos":bH("FlowGraphCosBlock"),"math/tan":bH("FlowGraphTanBlock"),"math/asin":bH("FlowGraphASinBlock"),"math/acos":bH("FlowGraphACosBlock"),"math/atan":bH("FlowGraphATanBlock"),"math/atan2":bH("FlowGraphATan2Block",["a","b"]),"math/sinh":bH("FlowGraphSinhBlock"),"math/cosh":bH("FlowGraphCoshBlock"),"math/tanh":bH("FlowGraphTanhBlock"),"math/asinh":bH("FlowGraphASinhBlock"),"math/acosh":bH("FlowGraphACoshBlock"),"math/atanh":bH("FlowGraphATanhBlock"),"math/exp":bH("FlowGraphExponentialBlock"),"math/log":bH("FlowGraphLogBlock"),"math/log2":bH("FlowGraphLog2Block"),"math/log10":bH("FlowGraphLog10Block"),"math/sqrt":bH("FlowGraphSquareRootBlock"),"math/cbrt":bH("FlowGraphCubeRootBlock"),"math/pow":bH("FlowGraphPowerBlock",["a","b"]),"math/length":bH("FlowGraphLengthBlock"),"math/normalize":bH("FlowGraphNormalizeBlock"),"math/dot":bH("FlowGraphDotBlock",["a","b"]),"math/cross":bH("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":bH("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":bH("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{MA:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{MA:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{MA:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{MA:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{MA:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{MA:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{MA:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":bH("FlowGraphTransposeBlock"),"math/determinant":bH("FlowGraphDeterminantBlock"),"math/inverse":bH("FlowGraphInvertMatrixBlock"),"math/matmul":bH("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{MA:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Je",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,o,H,h,E,e){const D=E[0].dataInputs.find((w=>"rotationQuaternion"===w.name));if(!D)throw new Error("Rotation quaternion input not found");return e._connectionValues[D.uniqueId]&&(e._connectionValues[D.uniqueId].type="Quaternion"),E}},"math/matDecompose":{MA:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Je"}}}},"math/quatConjugate":bH("FlowGraphConjugateBlock",["a"]),"math/quatMul":{MA:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,o,H,h,E){var e;return(e=E[0]).config||(e.config={}),E[0].config.type="Quaternion",E}},"math/quatAngleBetween":bH("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{MA:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":bH("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":bH("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{MA:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,o,H,h,E){var e;return(e=E[0]).config||(e.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract2x2":{MA:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{MA:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,o,H,h,E){var e;return(e=E[0]).config||(e.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract3x3":{MA:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{MA:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,o,H,h,E){var e;return(e=E[0]).config||(e.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract4x4":{MA:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{MA:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,o,H,h,E,e){var D,t;(t=E[0]).config||(t.config={});const X=E[0].dataInputs[0];return E[0].config.valueType=(null===(D=e._connectionValues[X.uniqueId])||void 0===D?void 0:D.type)??"FlowGraphInteger",E}},"math/and":{MA:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,o,H,h,E,e){var D,t,X;(X=E[0]).config||(X.config={});const L=E[0].dataInputs[0],A=E[0].dataInputs[1];return E[0].config.valueType=(null===(D=e._connectionValues[L.uniqueId])||void 0===D?void 0:D.type)??(null===(t=e._connectionValues[A.uniqueId])||void 0===t?void 0:t.type)??"FlowGraphInteger",E}},"math/or":{MA:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,o,H,h,E,e){var D,t,X;(X=E[0]).config||(X.config={});const L=E[0].dataInputs[0],A=E[0].dataInputs[1];return E[0].config.valueType=(null===(D=e._connectionValues[L.uniqueId])||void 0===D?void 0:D.type)??(null===(t=e._connectionValues[A.uniqueId])||void 0===t?void 0:t.type)??"FlowGraphInteger",E}},"math/xor":{MA:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(w,o,H,h,E,e){var D,t,X;(X=E[0]).config||(X.config={});const L=E[0].dataInputs[0],A=E[0].dataInputs[1];return E[0].config.valueType=(null===(D=e._connectionValues[L.uniqueId])||void 0===D?void 0:D.type)??(null===(t=e._connectionValues[A.uniqueId])||void 0===t?void 0:t.type)??"FlowGraphInteger",E}},"math/asr":bH("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":bH("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":bH("FlowGraphLeadingZerosBlock"),"math/ctz":bH("FlowGraphTrailingZerosBlock"),"math/popcnt":bH("FlowGraphOneBitsCounterBlock"),"math/rad":bH("FlowGraphDegToRadBlock"),"math/deg":bH("FlowGraphRadToDegBlock"),"type/boolToInt":bH("FlowGraphBooleanToInt"),"type/boolToFloat":bH("FlowGraphBooleanToFloat"),"type/intToBool":bH("FlowGraphIntToBoolean"),"type/intToFloat":bH("FlowGraphIntToFloat"),"type/floatToInt":bH("FlowGraphFloatToInt"),"type/floatToBool":bH("FlowGraphFloatToBoolean"),"flow/sequence":{MA:["FlowGraphSequenceBlock"],extraProcessor(w,o,H,h,E){const e=E[0];return e.config||(e.config={}),e.config.outputSignalCount=Object.keys(w.flows||[]).length,e.signalOutputs.forEach(((w,o)=>{w.name="out_"+o})),E}},"flow/branch":{MA:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{MA:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(w){if(w.configuration&&w.configuration.cases){const o=w.configuration.cases.value;if(!o.every((w=>"number"===typeof w&&/^-?\d+$/.test(w.toString()))))return M.d.Warn("Switch cases should be integers. Using empty array instead."),w.configuration.cases.value=[],{valid:!0};const H=new Set(o);w.configuration.cases.value=Array.from(H)}return{valid:!0}},extraProcessor(w,o,H,h,E){if("flow/switch"!==o.op||!w.flows||0===Object.keys(w.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return E[0].signalOutputs.forEach((w=>{"default"!==w.name&&(w.name="out_"+w.name)})),E}},"flow/while":{MA:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{MA:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(w,o,H,h,E){const e=E[0];return e.config||(e.config={}),e.config.incrementIndexWhenLoopDone=!0,E}},"flow/doN":{MA:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{MA:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(w,o,H,h,E){if("flow/multiGate"!==o.op||!w.flows||0===Object.keys(w.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const e=E[0];return e.config||(e.config={}),e.config.outputSignalCount=Object.keys(w.flows).length,e.signalOutputs.forEach(((w,o)=>{w.name="out_"+o})),E}},"flow/waitAll":{MA:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(w){var o,H;return"number"!==typeof(null===(o=w.configuration)||void 0===o||null===(H=o.inputFlows)||void 0===H?void 0:H.value[0])&&(w.configuration=w.configuration||{inputFlows:{value:[0]}},w.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{MA:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{MA:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{MA:["FlowGraphCancelDelayBlock"]},"variable/get":{MA:["FlowGraphGetVariableBlock"],validation(w){var o,H;return null!==(o=w.configuration)&&void 0!==o&&null!==(H=o.variable)&&void 0!==H&&H.value?{valid:!0}:(M.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(w,o)=>[o.getVariableName(w[0])]}}},"variable/set":{MA:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(w,o)=>[o.getVariableName(w[0])]}}},"variable/setMultiple":{MA:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(w,o)=>[w[0].map((w=>o.getVariableName(w)))]}},extraProcessor:(w,o,H,h,E)=>(E[0].dataInputs.forEach((w=>{w.name=h.getVariableName(+w.name)})),E)},"variable/interpolate":{MA:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(w,o)=>[o.getVariableName(w[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:w=>!0===w[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",PH:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",PH:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",PH:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",PH:"FlowGraphPlayAnimationBlock"},out:{name:"out",PH:"FlowGraphPlayAnimationBlock"},done:{name:"done",PH:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(w,o,H,h,E){var e,D,t;const X=E[0],L=null===(e=w.configuration)||void 0===e?void 0:e.variable.value[0];if("number"!==typeof L)throw M.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const A=h.arrays.staticVariables[L];"undefined"===typeof X.config.animationType.value&&(h.arrays.staticVariables,X.config.animationType.value=(0,kH.D)(A.type));const y=E[4];return y.config||(y.config={}),(D=y.config).variable||(D.variable={}),y.config.variable.value=h.getVariableName(L),(t=E[3]).config||(t.config={}),E}},"pointer/get":{MA:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",PH:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",PH:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(w,o,H,h,E)=>(E.forEach((w=>{"FlowGraphJsonPointerParserBlock"===w.className&&(w.config||(w.config={}),w.config.outputValue=!0)})),E)},"pointer/set":{MA:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",PH:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",PH:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(w,o,H,h,E)=>(E.forEach((w=>{"FlowGraphJsonPointerParserBlock"===w.className&&(w.config||(w.config={}),w.config.outputValue=!0)})),E)},"pointer/interpolate":{MA:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",PH:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",PH:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",PH:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",PH:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",PH:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",PH:"FlowGraphPlayAnimationBlock"},out:{name:"out",PH:"FlowGraphPlayAnimationBlock"},done:{name:"done",PH:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(w,o,H,h,E)=>(E.forEach((o=>{"FlowGraphJsonPointerParserBlock"===o.className?(o.config||(o.config={}),o.config.outputValue=!0):"FlowGraphInterpolationBlock"===o.className&&(o.config||(o.config={}),Object.keys(w.values||[]).forEach((H=>{var E;const e=null===(E=w.values)||void 0===E?void 0:E[H];if("value"===H&&e){const w=e.type;void 0!==w&&(o.config.animationType=h.arrays.types[w].flowGraphType)}})))})),E)},"animation/start":{MA:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",PH:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(w,o)=>[w[0]*o._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(w,o)=>[w[0]*o._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(w,o,H,h,E,e,D){const t=E[E.length-1];return t.config||(t.config={}),t.config.glTF=D,E}},"animation/stop":{MA:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",PH:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(w,o,H,h,E,e,D){const t=E[E.length-1];return t.config||(t.config={}),t.config.glTF=D,E}},"animation/stopAt":{MA:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",PH:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(w,o)=>[w[0]*o._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(w,o,H,h,E,e,D){const t=E[E.length-1];return t.config||(t.config={}),t.config.glTF=D,E}},"math/switch":{MA:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(w){if(w.configuration&&w.configuration.cases){const o=w.configuration.cases.value;if(!o.every((w=>"number"===typeof w&&/^-?\d+$/.test(w.toString()))))return M.d.Warn("Switch cases should be integers. Using empty array instead."),w.configuration.cases.value=[],{valid:!0};const H=new Set(o);w.configuration.cases.value=Array.from(H)}return{valid:!0}},extraProcessor(w,o,H,h,E){const e=E[0];return e.dataInputs.forEach((w=>{"default"!==w.name&&"case"!==w.name&&(w.name="in_"+w.name)})),e.config||(e.config={}),e.config.treatCasesAsIntegers=!0,E}},"debug/log":{MA:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function bH(w){let o=arguments.length>2?arguments[2]:void 0;return{MA:[w],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((w,o)=>(w[o]={name:o},w)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(w,H,h,E,e){var D;if(o){(D=e[0]).config||(D.config={}),e[0].config.preventIntegerFloatArithmetic=!0;let o=-1;Object.keys(w.values||{}).find((H=>{var h;return void 0!==(null===(h=w.values)||void 0===h?void 0:h[H].type)&&(o=w.values[H].type,!0)})),-1!==o&&(e[0].config.type=E.arrays.types[o].flowGraphType)}return e},validation:w=>o?pH(w):{valid:!0}}}function pH(w){if(w.values){const o=Object.keys(w.values).map((o=>w.values[o].type)).filter((w=>void 0!==w));if(!o.every((w=>w===o[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}gH["math/compose"]=gH["math/matCompose"],gH["math/decompose"]=gH["math/matDecompose"];var fH=H(11675);const NH={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"io",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class jH{constructor(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=w,this._gltf=o,this._animationTargetFps=H,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const w of this._interactivityGraph.types)this._types.push(NH[w.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const w of this._interactivityGraph.declarations){const o=WH(w);if(!o)throw M.d.Error(["No mapping found for declaration",w]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:o,fullOperationName:w.extension?w.op+":"+w.extension:w.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const w of this._interactivityGraph.variables){const o=this._parseVariable(w);this._staticVariables.push(o)}}_parseVariable(w,o){const H=this._types[w.type];if(!H)throw M.d.Error(["No type found for variable",w]),new Error("Error parsing variables");if(w.value&&w.value.length!==H.length)throw M.d.Error(["Invalid value length for variable",w,H]),new Error("Error parsing variables");const h=w.value||[];if(!h.length)switch(H.flowGraphType){case"boolean":h.push(!1);break;case"FlowGraphInteger":h.push(0);break;case"number":h.push(NaN);break;case"Vector2":h.push(NaN,NaN);break;case"io":h.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":h.fill(NaN,0,4);break;case"Matrix":h.fill(NaN,0,16);break;case"Matrix3D":h.fill(NaN,0,9)}return"number"===H.elementType&&"string"===typeof h[0]&&(h[0]=parseFloat(h[0])),{type:H.flowGraphType,value:o?o(h,this):h}}_parseEvents(){if(this._interactivityGraph.events)for(const w of this._interactivityGraph.events){const o={eventId:w.id||"internalEvent_"+this._internalEventsCounter++};w.values&&(o.eventData=Object.keys(w.values).map((o=>{var H;const h=null===(H=w.values)||void 0===H?void 0:H[o];if(!h)throw M.d.Error(["No value found for event key",o]),new Error("Error parsing events");const E=this._types[h.type];if(!E)throw M.d.Error(["No type found for event value",h]),new Error("Error parsing events");const e="undefined"!==typeof h.value?this._parseVariable(h):void 0;return{id:o,type:E.flowGraphType,eventData:!0,value:e}}))),this._events.push(o)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const o of this._interactivityGraph.nodes){if("number"!==typeof o.declaration)throw M.d.Error(["No declaration found for node",o]),new Error("Error parsing nodes");const H=this._mappings[o.declaration];if(!H)throw M.d.Error(["No mapping found for node",o]),new Error("Error parsing nodes");if(H.flowGraphMapping.validation){const h=H.flowGraphMapping.validation(o,this._interactivityGraph,this._gltf);var w;if(!h.valid)throw new Error(`Error validating interactivity node ${null===(w=this._interactivityGraph.declarations)||void 0===w?void 0:w[o.declaration].op} - ${h.error}`)}const h=[];for(const w of H.flowGraphMapping.MA){const E=this._getEmptyBlock(w,H.fullOperationName);this._parseNodeConfiguration(o,E,H.flowGraphMapping,w),h.push(E)}this._nodes.push({MA:h,fullOperationName:H.fullOperationName})}}_getEmptyBlock(w,o){return{uniqueId:(0,fH.e)(),className:w,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:o,metadata:{}}}_parseNodeConfiguration(w,o,H,h){const E=o.config;if(w.configuration){const o=Object.keys(w.configuration);for(const t of o){var e,D;const o=null===(e=w.configuration)||void 0===e?void 0:e[t];if(!o)throw M.d.Error(["No value found for node configuration",t]),new Error("Error parsing node configuration");const X=null===(D=H.configuration)||void 0===D?void 0:D[t];if(X&&X.PH?X.PH===h:0===H.MA.indexOf(h)){const w=(null===X||void 0===X?void 0:X.name)||t;o&&"undefined"!==typeof o.value||"undefined"===typeof(null===X||void 0===X?void 0:X.defaultValue)?o.value.length>=0?E[w]={value:1===o.value.length?o.value[0]:o.value}:M.d.Warn(["Invalid value for node configuration",o]):E[w]={value:X.defaultValue},X&&X.dataTransformer&&(E[w].value=X.dataTransformer([E[w].value],this)[0])}}}}_parseNodeConnections(w){for(let l=0;l<this._nodes.length;l++){var o;const O=null===(o=this._interactivityGraph.nodes)||void 0===o?void 0:o[l];if(!O)throw M.d.Error(["No node found for interactivity node",this._nodes[l]]),new Error("Error parsing node connections");const T=this._nodes[l],S=this._mappings[O.declaration];if(!S)throw M.d.Error(["No mapping found for node",O]),new Error("Error parsing node connections");const c=O.flows||{},W=Object.keys(c).sort();for(const w of W){var H,h,E,e;const o=c[w],L=null===(H=S.flowGraphMapping.outputs)||void 0===H||null===(h=H.flows)||void 0===h?void 0:h[w],A=(null===L||void 0===L?void 0:L.name)||w,y=this._createNewSocketConnection(A,!0);(L&&L.PH&&T.MA.find((w=>w.className===L.PH))||T.MA[0]).signalOutputs.push(y);const z=o.node,C=this._nodes[z];if(!C)throw M.d.Error(["No node found for input node id",z]),new Error("Error parsing node connections");const Q=cH(C.fullOperationName);if(!Q)throw M.d.Error(["No mapping found for input node",C]),new Error("Error parsing node connections");let i=null===(E=Q.inputs)||void 0===E||null===(e=E.flows)||void 0===e?void 0:e[o.socket||"in"],s=!1;if(!i)for(const w in null===(D=Q.inputs)||void 0===D?void 0:D.flows){var D,t,X;if(w.startsWith("[")&&w.endsWith("]"))s=!0,i=null===(t=Q.inputs)||void 0===t||null===(X=t.flows)||void 0===X?void 0:X[w]}const V=i?s?i.name.replace("$1",o.socket||""):i.name:o.socket||"in",r=i&&i.PH&&C.MA.find((w=>w.className===i.PH))||C.MA[0];let k=r.signalInputs.find((w=>w.name===V));k||(k=this._createNewSocketConnection(V),r.signalInputs.push(k)),k.connectedPointIds.push(y.uniqueId),y.connectedPointIds.push(k.uniqueId)}const B=O.values||{},J=Object.keys(B);for(const o of J){var L,A;const H=B[o];let h=null===(L=S.flowGraphMapping.inputs)||void 0===L||null===(A=L.values)||void 0===A?void 0:A[o],E=!1;if(!h)for(const w in null===(y=S.flowGraphMapping.inputs)||void 0===y?void 0:y.values){var y,z,C;if(w.startsWith("[")&&w.endsWith("]"))E=!0,h=null===(z=S.flowGraphMapping.inputs)||void 0===z||null===(C=z.values)||void 0===C?void 0:C[w]}const e=h?E?h.name.replace("$1",o):h.name:o,D=this._createNewSocketConnection(e);if((h&&h.PH&&T.MA.find((w=>w.className===h.PH))||T.MA[0]).dataInputs.push(D),void 0!==H.value){const o=this._parseVariable(H,h&&h.dataTransformer);w._connectionValues[D.uniqueId]=o}else{if("undefined"===typeof H.node)throw M.d.Error(["Invalid value for value connection",H]),new Error("Error parsing node connections");{var Q,i,s;const w=H.node,o=H.socket||"value",h=this._nodes[w];if(!h)throw M.d.Error(["No node found for output socket reference",H]),new Error("Error parsing node connections");const E=cH(h.fullOperationName);if(!E)throw M.d.Error(["No mapping found for output socket reference",H]),new Error("Error parsing node connections");let e=null===(Q=E.outputs)||void 0===Q||null===(i=Q.values)||void 0===i?void 0:i[o],t=!1;if(!e)for(const H in null===(V=E.outputs)||void 0===V?void 0:V.values){var V,r,k;if(H.startsWith("[")&&H.endsWith("]"))t=!0,e=null===(r=E.outputs)||void 0===r||null===(k=r.values)||void 0===k?void 0:k[H]}const X=e?t?e.name.replace("$1",o):null===(s=e)||void 0===s?void 0:s.name:o,L=e&&e.PH&&h.MA.find((w=>w.className===e.PH))||h.MA[0];let A=L.dataOutputs.find((w=>w.name===X));A||(A=this._createNewSocketConnection(X,!0),L.dataOutputs.push(A)),D.connectedPointIds.push(A.uniqueId),A.connectedPointIds.push(D.uniqueId)}}}if(S.flowGraphMapping.interBlockConnectors)for(const w of S.flowGraphMapping.interBlockConnectors){const o=w.input,H=w.output,h=w.isVariable;this._connectFlowGraphNodes(o,H,T.MA[w.inputBlockIndex],T.MA[w.outputBlockIndex],h)}if(S.flowGraphMapping.extraProcessor){var P;const o=null===(P=this._interactivityGraph.declarations)||void 0===P?void 0:P[O.declaration];if(!o)throw M.d.Error(["No declaration found for extra processor",O]),new Error("Error parsing node connections");T.MA=S.flowGraphMapping.extraProcessor(O,o,S.flowGraphMapping,this,T.MA,w,this._gltf)}}}_createNewSocketConnection(w,o){return{uniqueId:(0,fH.e)(),name:w,_connectionType:o?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(w,o,H,h,E){const e=E?H.dataInputs:H.signalInputs,D=E?h.dataOutputs:h.signalOutputs,t=e.find((o=>o.name===w))||this._createNewSocketConnection(w),X=D.find((w=>w.name===o))||this._createNewSocketConnection(o,!0);e.find((o=>o.name===w))||e.push(t),D.find((w=>w.name===o))||D.push(X),t.connectedPointIds.push(X.uniqueId),X.connectedPointIds.push(t.uniqueId)}getVariableName(w){return"staticVariable_"+w}serializeToFlowGraph(){const w={uniqueId:(0,fH.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(w);for(let o=0;o<this._staticVariables.length;o++){const H=this._staticVariables[o];w._userVariables[this.getVariableName(o)]=H}return{rightHanded:!0,allBlocks:this._nodes.reduce(((w,o)=>w.concat(o.MA)),[]),executionContexts:[w]}}}const qH="KHR_interactivity";class uH{constructor(w){this._loader=w,this.name=qH,this.enabled=this._loader.isExtensionUsed(qH),this._pathConverter=(0,u.l)(this._loader.he),w._skipStartAnimationStep=!0;const o=w.babylonScene;o&&function(w){(0,u.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!w.activeCamera)return new E.Quaternion(NaN,NaN,NaN,NaN);const o=E.Quaternion.FromRotationMatrix(w.activeCamera.getWorldMatrix()).normalize();return w.useRightHandedSystem||(o.w*=-1,o.x*=-1),o},type:"Quaternion",getTarget:()=>w.activeCamera}),(0,u.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!w.activeCamera)return new E.io(NaN,NaN,NaN);const o=w.activeCamera.getWorldMatrix().getTranslation();return w.useRightHandedSystem||(o.x*=-1),o},type:"io",getTarget:()=>w.activeCamera}),(0,u.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:w=>{var o;return(null===(o=w._babylonAnimationGroup)||void 0===o?void 0:o.isPlaying)??!1},type:"boolean",getTarget:w=>w._babylonAnimationGroup}),(0,u.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:w=>{var o;return((null===(o=w._babylonAnimationGroup)||void 0===o?void 0:o.from)??0)/60},type:"number",getTarget:w=>w._babylonAnimationGroup}),(0,u.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:w=>{var o;return((null===(o=w._babylonAnimationGroup)||void 0===o?void 0:o.to)??0)/60},type:"number",getTarget:w=>w._babylonAnimationGroup}),(0,u.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:w=>{var o;return((null===(o=w._babylonAnimationGroup)||void 0===o?void 0:o.getCurrentFrame())??0)/60},type:"number",getTarget:w=>w._babylonAnimationGroup}),(0,u.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:w=>{var o;return((null===(o=w._babylonAnimationGroup)||void 0===o?void 0:o.getCurrentFrame())??0)/60},type:"number",getTarget:w=>w._babylonAnimationGroup})}(o)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var w;if(!this._loader.babylonScene||!this._pathConverter)return;const o=this._loader.babylonScene,H=null===(w=this._loader.he.extensions)||void 0===w?void 0:w.KHR_interactivity;if(!H)return;const h=new MH.d({Vo:o});h.dispatchEventsSynchronously=!1;const E=H.graphs.map((w=>new jH(w,this._loader.he,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(E.map((async w=>await OH(w,{coordinator:h,pathConverter:this._pathConverter})))),h.start()}}var nH;nH=async()=>(await Promise.resolve().then(H.bind(H,13513))).FlowGraphGLTFDataProvider,iH[`${qH}/${"FlowGraphGLTFDataProvider"}`]=nH,q(qH),j(qH,!0,(w=>new uH(w)));const GH="KHR_node_visibility";(0,u.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:w=>{const o=w._babylonTransformNode;return!o||void 0===o.isVisible||o.isVisible},set:(w,o)=>{var H,h;null===(H=o._primitiveBabylonMeshes)||void 0===H||H.forEach((w=>{w.inheritVisibility=!0})),o._babylonTransformNode&&(o._babylonTransformNode.isVisible=w),null===(h=o._primitiveBabylonMeshes)||void 0===h||h.forEach((o=>{o.isVisible=w}))},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class RH{constructor(w){this.name=GH,this._loader=w,this.enabled=w.isExtensionUsed(GH)}async onReady(){var w;null===(w=this._loader.he.nodes)||void 0===w||w.forEach((w=>{var o,H,h,E;(null===(o=w._primitiveBabylonMeshes)||void 0===o||o.forEach((w=>{w.inheritVisibility=!0})),null!==(H=w.extensions)&&void 0!==H&&H.KHR_node_visibility)&&(!1===(null===(h=w.extensions)||void 0===h?void 0:h.KHR_node_visibility.visible)&&(w._babylonTransformNode&&(w._babylonTransformNode.isVisible=!1),null===(E=w._primitiveBabylonMeshes)||void 0===E||E.forEach((w=>{w.isVisible=!1}))))}))}dispose(){this._loader=null}}q(GH),j(GH,!0,(w=>new RH(w)));const aH="KHR_node_selectability";BH("event/onSelect",aH,{MA:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",PH:"FlowGraphGetVariableBlock",dataTransformer:w=>["pickedMesh_"+w[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",PH:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(w,o,H,h,E,e,D){var t,X,L,A,y,z;const C=E[E.length-1];C.config=C.config||{},C.config.glTF=D;const Q=null===(t=w.configuration)||void 0===t||null===(X=t.nodeIndex)||void 0===X?void 0:X.value[0];if(void 0===Q||"number"!==typeof Q)throw new Error("nodeIndex not found in configuration");const M="pickedMesh_"+Q;return E[1].config.variable=M,e._userVariables[M]={className:"Mesh",id:null===D||void 0===D||null===(L=D.nodes)||void 0===L||null===(A=L[Q]._babylonTransformNode)||void 0===A?void 0:A.id,uniqueId:null===D||void 0===D||null===(y=D.nodes)||void 0===y||null===(z=y[Q]._babylonTransformNode)||void 0===z?void 0:z.uniqueId},E}}),(0,u.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:w=>{const o=w._babylonTransformNode;return!o||void 0===o.nX||o.nX},set:(w,o)=>{var H;null===(H=o._primitiveBabylonMeshes)||void 0===H||H.forEach((o=>{o.nX=w}))},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"nX"],type:"boolean"});class dH{constructor(w){this.name=aH,this._loader=w,this.enabled=w.isExtensionUsed(aH)}async onReady(){var w;null===(w=this._loader.he.nodes)||void 0===w||w.forEach((w=>{var o,H,h;null!==(o=w.extensions)&&void 0!==o&&o.KHR_node_selectability&&!1===(null===(H=w.extensions)||void 0===H?void 0:H.KHR_node_selectability.selectable)&&(null===(h=w._babylonTransformNode)||void 0===h||h.getChildMeshes().forEach((w=>{w.nX=!1})))}))}dispose(){this._loader=null}}q(aH),j(aH,!0,(w=>new dH(w)));const IH="KHR_node_hoverability",UH="targetMeshPointerOver_";BH("event/onHoverIn",IH,{MA:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",PH:"FlowGraphGetVariableBlock",dataTransformer:w=>[UH+w[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",PH:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(w,o,H,h,E,e,D){var t,X,L,A,y,z;const C=E[E.length-1];C.config=C.config||{},C.config.glTF=D;const Q=null===(t=w.configuration)||void 0===t||null===(X=t.nodeIndex)||void 0===X?void 0:X.value[0];if(void 0===Q||"number"!==typeof Q)throw new Error("nodeIndex not found in configuration");const M=UH+Q;return E[1].config.variable=M,e._userVariables[M]={className:"Mesh",id:null===D||void 0===D||null===(L=D.nodes)||void 0===L||null===(A=L[Q]._babylonTransformNode)||void 0===A?void 0:A.id,uniqueId:null===D||void 0===D||null===(y=D.nodes)||void 0===y||null===(z=y[Q]._babylonTransformNode)||void 0===z?void 0:z.uniqueId},E}});const ZH="targetMeshPointerOut_";BH("event/onHoverOut",IH,{MA:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",PH:"FlowGraphGetVariableBlock",dataTransformer:w=>[ZH+w[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",PH:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(w,o,H,h,E,e,D){var t,X,L,A,y,z;const C=E[E.length-1];C.config=C.config||{},C.config.glTF=D;const Q=null===(t=w.configuration)||void 0===t||null===(X=t.nodeIndex)||void 0===X?void 0:X.value[0];if(void 0===Q||"number"!==typeof Q)throw new Error("nodeIndex not found in configuration");const M=ZH+Q;return E[1].config.variable=M,e._userVariables[M]={className:"Mesh",id:null===D||void 0===D||null===(L=D.nodes)||void 0===L||null===(A=L[Q]._babylonTransformNode)||void 0===A?void 0:A.id,uniqueId:null===D||void 0===D||null===(y=D.nodes)||void 0===y||null===(z=y[Q]._babylonTransformNode)||void 0===z?void 0:z.uniqueId},E}}),(0,u.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:w=>{const o=w._babylonTransformNode;return!o||void 0===o.pointerOverDisableMeshTesting||o.pointerOverDisableMeshTesting},set:(w,o)=>{var H;null===(H=o._primitiveBabylonMeshes)||void 0===H||H.forEach((o=>{o.pointerOverDisableMeshTesting=!w}))},getTarget:w=>w._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class KH{constructor(w){this.name=IH,this._loader=w,this.enabled=w.isExtensionUsed(IH)}async onReady(){var w;null===(w=this._loader.he.nodes)||void 0===w||w.forEach((w=>{var o,H,h;null!==(o=w.extensions)&&void 0!==o&&o.KHR_node_hoverability&&!1===(null===(H=w.extensions)||void 0===H?void 0:H.KHR_node_hoverability.hoverable)&&(null===(h=w._babylonTransformNode)||void 0===h||h.getChildMeshes().forEach((w=>{w.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}q(IH),j(IH,!0,(w=>new KH(w)));const FH="ExtrasAsMetadata";class vH{_assignExtras(w,o){if(o.extras&&Object.keys(o.extras).length>0){const H=w.metadata=w.metadata||{};(H.he=H.he||{}).extras=o.extras}}constructor(w){this.name=FH,this.enabled=!0,this._loader=w}dispose(){this._loader=null}loadNodeAsync(w,o,H){return this._loader.loadNodeAsync(w,o,(w=>{this._assignExtras(w,o),H(w)}))}loadCameraAsync(w,o,H){return this._loader.loadCameraAsync(w,o,(w=>{this._assignExtras(w,o),H(w)}))}createMaterial(w,o,H){const h=this._loader.createMaterial(w,o,H);return this._assignExtras(h,o),h}}q(FH),j(FH,!1,(w=>new vH(w)));H(13513)},13379:(w,o,H)=>{"use strict";H.d(o,{e:()=>b,h:()=>S,k:()=>T,m:()=>c});var h=H(11540),E=H(11531),e=H(13001),D=H(12165),t=H(12128),X=H(12135),L=H(11551),A=H(11571),y=H(12157),z=H(12262),C=H(12167),Q=H(11753);class M{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Ez=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Gz=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(w){this._environmentTexture=w}getNodes(){let w=[];w=w.concat(this.meshes),w=w.concat(this.lights),w=w.concat(this.cameras),w=w.concat(this.transformNodes);for(const o of this.skeletons)w=w.concat(o.bones);return w}}class i extends M{}class s{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const w=this.rootNodes;for(const h of w)h.dispose();w.length=0;const o=this.skeletons;for(const h of o)h.dispose();o.length=0;const H=this.animationGroups;for(const h of H)h.dispose();H.length=0}}class V extends M{constructor(w){super(),this._wasAddedToScene=!1,(w=w||A.e.LastCreatedScene)&&(this.Vo=w,this.proceduralTextures=[],w.me.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=w.getEngine().onContextRestoredObservable.add((()=>{for(const w of this.geometries)w._rebuild();for(const w of this.meshes)w._rebuild();for(const w of this.Ez)w.rebuild();for(const w of this.textures)w._rebuild()})))}_topologicalSort(w){const o=new Map;for(const D of w)o.set(D.uniqueId,D);const H={dependsOn:new Map,dependedBy:new Map};for(const D of w){const w=D.uniqueId;H.dependsOn.set(w,new Set),H.dependedBy.set(w,new Set)}for(const D of w){const w=D.uniqueId,h=H.dependsOn.get(w);if(D instanceof y.c){const E=D.sourceMesh;o.has(E.uniqueId)&&(h.add(E.uniqueId),H.dependedBy.get(E.uniqueId).add(w))}const E=H.dependedBy.get(w);for(const e of D.getDescendants()){const h=e.uniqueId;if(o.has(h)){E.add(h);H.dependsOn.get(h).add(w)}}}const h=[],E=[];for(const D of w){const w=D.uniqueId;0===H.dependsOn.get(w).size&&(E.push(D),o.delete(w))}const e=E;for(;e.length>0;){const w=e.shift();h.push(w);const E=H.dependedBy.get(w.uniqueId);for(const h of Array.from(E.values())){const E=H.dependsOn.get(h);E.delete(w.uniqueId),0===E.size&&o.get(h)&&(e.push(o.get(h)),o.delete(h))}}return o.size>0&&(L.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),o.forEach((w=>{L.d.Error(w.name)}))),h}_addNodeAndDescendantsToList(w,o,H,h){if(H&&(!h||h(H))&&!o.has(H.uniqueId)){w.push(H),o.add(H.uniqueId);for(const E of H.getDescendants(!0))this._addNodeAndDescendantsToList(w,o,E,h)}}_isNodeInContainer(w){return w instanceof X.c&&-1!==this.meshes.indexOf(w)||(w instanceof t.b&&-1!==this.transformNodes.indexOf(w)||(w instanceof z.b&&-1!==this.lights.indexOf(w)||w instanceof C.e&&-1!==this.cameras.indexOf(w)))}_isValidHierarchy(){for(const w of this.meshes)if(w.parent&&!this._isNodeInContainer(w.parent))return L.d.Warn(`Node ${w.name} has a parent that is not in the container.`),!1;for(const w of this.transformNodes)if(w.parent&&!this._isNodeInContainer(w.parent))return L.d.Warn(`Node ${w.name} has a parent that is not in the container.`),!1;for(const w of this.lights)if(w.parent&&!this._isNodeInContainer(w.parent))return L.d.Warn(`Node ${w.name} has a parent that is not in the container.`),!1;for(const w of this.cameras)if(w.parent&&!this._isNodeInContainer(w.parent))return L.d.Warn(`Node ${w.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(w){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const h={},e={},t=new s,X=[],L=[],A={doNotInstantiate:!0,...H},y=[],z=new Set;for(const E of this.transformNodes)null===E.parent&&this._addNodeAndDescendantsToList(y,z,E,A.predicate);for(const E of this.meshes)null===E.parent&&this._addNodeAndDescendantsToList(y,z,E,A.predicate);const C=this._topologicalSort(y),Q=(H,E)=>{if(((o,H)=>{if(h[o.uniqueId]=H.uniqueId,e[H.uniqueId]=H,w&&(H.name=w(o.name)),H instanceof D.d){const w=H;if(w.morphTargetManager){const H=o.morphTargetManager;w.morphTargetManager=H.clone();for(let o=0;o<H.numTargets;o++){const E=H.getTarget(o),D=w.morphTargetManager.getTarget(o);h[E.uniqueId]=D.uniqueId,e[D.uniqueId]=D}}}})(H,E),H.parent){const w=h[H.parent.uniqueId],o=e[w];E.parent=o||H.parent}if(E.position&&H.position&&E.position.t(H.position),E.rotationQuaternion&&H.rotationQuaternion&&E.rotationQuaternion.t(H.rotationQuaternion),E.rotation&&H.rotation&&E.rotation.t(H.rotation),E.Je&&H.Je&&E.Je.t(H.Je),E.material){const D=E;if(D.material)if(o){const o=H.material;if(-1===L.indexOf(o)){let H=o.clone(w?w(o.name):"Clone of "+o.name);if(L.push(o),h[o.uniqueId]=H.uniqueId,e[H.uniqueId]=H,"MultiMaterial"===o.getClassName()){const E=o;for(const o of E.de)o&&(H=o.clone(w?w(o.name):"Clone of "+o.name),L.push(o),h[o.uniqueId]=H.uniqueId,e[H.uniqueId]=H);E.de=E.de.map((w=>w&&e[h[w.uniqueId]]))}}"InstancedMesh"!==D.getClassName()&&(D.material=e[h[o.uniqueId]])}else"MultiMaterial"===D.material.getClassName()?-1===this.Vo.multiMaterials.indexOf(D.material)&&this.Vo.addMultiMaterial(D.material):-1===this.Vo.materials.indexOf(D.material)&&this.Vo.addMaterial(D.material)}null===E.parent&&t.rootNodes.push(E)};for(const E of C)if("InstancedMesh"===E.getClassName()){const w=E,o=w.sourceMesh,H=h[o.uniqueId];Q(w,("number"===typeof H?e[H]:o).createInstance(w.name))}else{let w=!0;"dX"===E.getClassName()||"Node"===E.getClassName()||E.skeleton||!E.getTotalVertices||0===E.getTotalVertices()?w=!1:A.doNotInstantiate&&(w="function"===typeof A.doNotInstantiate?!A.doNotInstantiate(E):!A.doNotInstantiate);const o=w?E.createInstance(`instance of ${E.name}`):E.clone(`Clone of ${E.name}`,null,!0);if(!o)throw new Error(`Could not clone or instantiate node on Asset Container ${E.name}`);Q(E,o)}for(const E of this.skeletons){if(A.predicate&&!A.predicate(E))continue;const o=E.clone(w?w(E.name):"Clone of "+E.name);for(const w of this.meshes)if(w.skeleton===E&&!w.isAnInstance){const H=e[h[w.uniqueId]];if(!H||H.isAnInstance)continue;if(H.skeleton=o,-1!==X.indexOf(o))continue;X.push(o);for(const w of o.bones)w._linkedTransformNode&&(w._linkedTransformNode=e[h[w._linkedTransformNode.uniqueId]])}t.skeletons.push(o)}for(const E of this.animationGroups){if(A.predicate&&!A.predicate(E))continue;const o=E.clone(w?w(E.name):"Clone of "+E.name,(w=>e[h[w.uniqueId]]||w));t.animationGroups.push(o)}return t}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Vo.environmentTexture=this.environmentTexture);for(const w of this.Vo._serializableComponents)w.addFromContainer(this);this.Vo.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const o=[];for(const H of this.cameras)w&&!w(H)||(this.Vo.addCamera(H),o.push(H));for(const H of this.lights)w&&!w(H)||(this.Vo.addLight(H),o.push(H));for(const H of this.meshes)w&&!w(H)||(this.Vo.hA(H),o.push(H));for(const H of this.skeletons)w&&!w(H)||this.Vo.addSkeleton(H);for(const H of this.animations)w&&!w(H)||this.Vo.addAnimation(H);for(const H of this.animationGroups)w&&!w(H)||this.Vo.addAnimationGroup(H);for(const H of this.multiMaterials)w&&!w(H)||this.Vo.addMultiMaterial(H);for(const H of this.materials)w&&!w(H)||this.Vo.addMaterial(H);for(const H of this.morphTargetManagers)w&&!w(H)||this.Vo.addMorphTargetManager(H);for(const H of this.geometries)w&&!w(H)||this.Vo.addGeometry(H);for(const H of this.transformNodes)w&&!w(H)||(this.Vo.addTransformNode(H),o.push(H));for(const H of this.actionManagers)w&&!w(H)||this.Vo.addActionManager(H);for(const H of this.textures)w&&!w(H)||this.Vo.addTexture(H);for(const H of this.reflectionProbes)w&&!w(H)||this.Vo.addReflectionProbe(H);for(const H of o)H.parent&&-1===this.Vo.getNodes().indexOf(H.parent)&&(H.setParent?H.setParent(null):H.parent=null)}removeAllFromScene(){this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Vo.environmentTexture&&(this.Vo.environmentTexture=null);for(const w of this.Vo._serializableComponents)w.removeFromContainer(this)}removeFromScene(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const o of this.cameras)w&&!w(o)||this.Vo.removeCamera(o);for(const o of this.lights)w&&!w(o)||this.Vo.removeLight(o);for(const o of this.meshes)w&&!w(o)||this.Vo.HA(o,!0);for(const o of this.skeletons)w&&!w(o)||this.Vo.removeSkeleton(o);for(const o of this.animations)w&&!w(o)||this.Vo.removeAnimation(o);for(const o of this.animationGroups)w&&!w(o)||this.Vo.removeAnimationGroup(o);for(const o of this.multiMaterials)w&&!w(o)||this.Vo.removeMultiMaterial(o);for(const o of this.materials)w&&!w(o)||this.Vo.removeMaterial(o);for(const o of this.morphTargetManagers)w&&!w(o)||this.Vo.removeMorphTargetManager(o);for(const o of this.geometries)w&&!w(o)||this.Vo.removeGeometry(o);for(const o of this.transformNodes)w&&!w(o)||this.Vo.removeTransformNode(o);for(const o of this.actionManagers)w&&!w(o)||this.Vo.removeActionManager(o);for(const o of this.textures)w&&!w(o)||this.Vo.removeTexture(o);for(const o of this.reflectionProbes)w&&!w(o)||this.Vo.removeReflectionProbe(o)}dispose(){const w=this.cameras.slice(0);for(const C of w)C.dispose();this.cameras.length=0;const o=this.lights.slice(0);for(const C of o)C.dispose();this.lights.length=0;const H=this.meshes.slice(0);for(const C of H)C.dispose();this.meshes.length=0;const h=this.skeletons.slice(0);for(const C of h)C.dispose();this.skeletons.length=0;const E=this.animationGroups.slice(0);for(const C of E)C.dispose();this.animationGroups.length=0;const e=this.multiMaterials.slice(0);for(const C of e)C.dispose();this.multiMaterials.length=0;const D=this.materials.slice(0);for(const C of D)C.dispose();this.materials.length=0;const t=this.geometries.slice(0);for(const C of t)C.dispose();this.geometries.length=0;const X=this.transformNodes.slice(0);for(const C of X)C.dispose();this.transformNodes.length=0;const L=this.actionManagers.slice(0);for(const C of L)C.dispose();this.actionManagers.length=0;const A=this.textures.slice(0);for(const C of A)C.dispose();this.textures.length=0;const y=this.reflectionProbes.slice(0);for(const C of y)C.dispose();this.reflectionProbes.length=0;const z=this.morphTargetManagers.slice(0);for(const C of z)C.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const C of this.Vo._serializableComponents)C.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Vo.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(w,o,H){if(w&&o)for(const h of w){let w=!0;if(H)for(const o of H)if(h===o){w=!1;break}w&&(o.push(h),h._parentContainer=this)}}moveAllFromScene(w){this._wasAddedToScene=!1,void 0===w&&(w=new i);for(const o in this)Object.prototype.hasOwnProperty.call(this,o)&&(this[o]=this[o]||("_environmentTexture"===o?null:[]),this._moveAssets(this.Vo[o],this[o],w[o]));this.environmentTexture=this.Vo.environmentTexture,this.removeAllFromScene()}createRootMesh(){const w=new D.d("assetContainerRootMesh",this.Vo);for(const o of this.meshes)o.parent||w.addChild(o);return this.meshes.unshift(w),w}mergeAnimationsTo(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.e.LastCreatedScene,o=arguments.length>1?arguments[1]:void 0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!w)return L.d.Error("No scene available to merge animations to"),[];const h=H||(o=>{let H=null;const h=o.animations.length?o.animations[0].targetProperty:"",E=o.name.split(".").join("").split("_primitive")[0];switch(h){case"position":case"rotationQuaternion":H=w.getTransformNodeByName(o.name)||w.getTransformNodeByName(E);break;case"influence":H=w.getMorphTargetByName(o.name)||w.getMorphTargetByName(E);break;default:H=w.getNodeByName(o.name)||w.getNodeByName(E)}return H}),E=this.getNodes();for(const t of E){const w=h(t);if(null!==w){for(const o of t.animations){const H=w.animations.filter((w=>w.targetProperty===o.targetProperty));for(const o of H){const H=w.animations.indexOf(o,0);H>-1&&w.animations.splice(H,1)}}w.animations=w.animations.concat(t.animations)}}const e=[],D=this.animationGroups.slice();for(const t of D){e.push(t.clone(t.name,h));for(const w of t.animatables)w.stop()}for(const t of o){const o=h(t.target);o&&(w.beginAnimation(o,t.fromFrame,t.toFrame,t.loopAnimation,t.speedRatio,t.onAnimationEnd?t.onAnimationEnd:void 0,void 0,!0,void 0,t.onAnimationLoop?t.onAnimationLoop:void 0),w.stopAnimation(t.target))}return e}populateRootNodes(){this.rootNodes.length=0;for(const w of this.meshes)w.parent||-1!==this.rootNodes.indexOf(w)||this.rootNodes.push(w);for(const w of this.transformNodes)w.parent||-1!==this.rootNodes.indexOf(w)||this.rootNodes.push(w);for(const w of this.lights)w.parent||-1!==this.rootNodes.indexOf(w)||this.rootNodes.push(w);for(const w of this.cameras)w.parent||-1!==this.rootNodes.indexOf(w)||this.rootNodes.push(w)}addAllAssetsToContainer(w){if(!w)return;const o=[],H=new Set;for(o.push(w);o.length>0;){const w=o.pop();if(w instanceof D.d?(w.re&&-1===this.geometries.indexOf(w.re)&&this.geometries.push(w.re),this.meshes.push(w)):w instanceof y.c?this.meshes.push(w):w instanceof t.b?this.transformNodes.push(w):w instanceof z.b?this.lights.push(w):w instanceof C.e&&this.cameras.push(w),w instanceof X.c){if(w.material&&-1===this.materials.indexOf(w.material)){this.materials.push(w.material);for(const o of w.material.getActiveTextures())-1===this.textures.indexOf(o)&&this.textures.push(o)}w.skeleton&&-1===this.skeletons.indexOf(w.skeleton)&&this.skeletons.push(w.skeleton),w.morphTargetManager&&-1===this.morphTargetManagers.indexOf(w.morphTargetManager)&&this.morphTargetManagers.push(w.morphTargetManager)}for(const h of w.getChildren())H.has(h)||o.push(h);H.add(w)}this.populateRootNodes()}_getByTags(w,o,H){if(void 0===o)return w;const h=[];for(const E in w){const e=w[E];Q.c&&Q.c.MatchesQuery(e,o)&&(!H||H(e))&&h.push(e)}return h}getMeshesByTags(w,o){return this._getByTags(this.meshes,w,o)}getCamerasByTags(w,o){return this._getByTags(this.cameras,w,o)}getLightsByTags(w,o){return this._getByTags(this.lights,w,o)}getMaterialsByTags(w,o){return this._getByTags(this.materials,w,o).concat(this._getByTags(this.multiMaterials,w,o))}getTransformNodesByTags(w,o){return this._getByTags(this.transformNodes,w,o)}}var r=H(11589);class k{constructor(w){this.byteOffset=0,this.buffer=w}async loadAsync(w){const o=await this.buffer.readAsync(this.byteOffset,w);this._dataView=new DataView(o.buffer,o.byteOffset,o.byteLength),this._dataByteOffset=0}readUint32(){const w=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,w}readUint8Array(w){const o=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,w);return this._dataByteOffset+=w,this.byteOffset+=w,o}readString(w){return(0,r.e)(this.readUint8Array(w))}skipBytes(w){this._dataByteOffset+=w,this.byteOffset+=w}}var P=H(13383);const l="Z2xURg",O={name:"he",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:w=>-1!==w.indexOf("asset")&&-1!==w.indexOf("version")||w.startsWith("data:base64,"+l)||w.startsWith("data:;base64,"+l)||w.startsWith("data:application/octet-stream;base64,"+l)||w.startsWith("data:model/gltf-binary;base64,"+l)};var T,S,c,W=H(11573),B=H(11582);function J(w,o,H){try{return Promise.resolve(new Uint8Array(w,o,H))}catch(h){return Promise.reject(h)}}!function(w){w[w.AUTO=0]="AUTO",w[w.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(T||(T={})),function(w){w[w.NONE=0]="NONE",w[w.FIRST=1]="FIRST",w[w.ALL=2]="ALL"}(S||(S={})),function(w){w[w.LOADING=0]="LOADING",w[w.READY=1]="READY",w[w.COMPLETE=2]="COMPLETE"}(c||(c={}));class g{constructor(){this.coordinateSystemMode=T.AUTO,this.animationStartMode=S.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=w=>Promise.resolve(w),this.extensionOptions={}}t(w){w&&(this.onParsed=w.onParsed,this.coordinateSystemMode=w.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=w.animationStartMode??this.animationStartMode,this.loadNodeAnimations=w.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=w.loadSkins??this.loadSkins,this.loadMorphTargets=w.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=w.compileMaterials??this.compileMaterials,this.useClipPlane=w.useClipPlane??this.useClipPlane,this.compileShadowGenerators=w.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=w.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=w.useRangeRequests??this.useRangeRequests,this.createInstances=w.createInstances??this.createInstances,this.alwaysComputeBoundingBox=w.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=w.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=w.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=w.skipMaterials??this.skipMaterials,this.useSRGBBuffers=w.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=w.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=w.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=w.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=w.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=w.customRootNode,this.onMeshLoaded=w.onMeshLoaded,this.onSkinLoaded=w.onSkinLoaded,this.onTextureLoaded=w.onTextureLoaded,this.onMaterialLoaded=w.onMaterialLoaded,this.onCameraLoaded=w.onCameraLoaded,this.extensionOptions=w.extensionOptions??this.extensionOptions)}}class b extends g{constructor(w){super(),this.onParsedObservable=new h.b,this.onMeshLoadedObservable=new h.b,this.onSkinLoadedObservable=new h.b,this.onTextureLoadedObservable=new h.b,this.onMaterialLoadedObservable=new h.b,this.onCameraLoadedObservable=new h.b,this.onCompleteObservable=new h.b,this.onErrorObservable=new h.b,this.me=new h.b,this.onExtensionLoadedObservable=new h.b,this.validate=!1,this.onValidatedObservable=new h.b,this._loader=null,this._state=null,this._requests=new Array,this.name=O.name,this.extensions=O.extensions,this.onLoaderStateChangedObservable=new h.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.t(w)}set onParsed(w){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),w&&(this._onParsedObserver=this.onParsedObservable.add(w))}set onMeshLoaded(w){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),w&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(w))}set onSkinLoaded(w){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),w&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((o=>w(o.node,o.skinnedNode))))}set onTextureLoaded(w){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),w&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(w))}set onMaterialLoaded(w){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),w&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(w))}set onCameraLoaded(w){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),w&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(w))}set onComplete(w){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(w)}set onError(w){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(w)}set onDispose(w){this._onDisposeObserver&&this.me.remove(this._onDisposeObserver),this._onDisposeObserver=this.me.add(w)}set onExtensionLoaded(w){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(w)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(w){this._loggingEnabled!==w&&(this._loggingEnabled=w,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(w){this._capturePerformanceCounters!==w&&(this._capturePerformanceCounters=w,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(w){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(w)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const w of this._requests)w.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=w=>Promise.resolve(w),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.me.notifyObservers(void 0),this.me.clear()}loadFile(w,o,H,e,D,t,X,A){if(ArrayBuffer.isView(o))return this._loadBinary(w,o,H,e,X,A),null;this._progressCallback=D;const y=o.name||E.Tools.GetFilename(o);if(t){if(this.useRangeRequests){this.validate&&L.d.Warn("glTF validation is not supported when range requests are enabled");const H={abort:()=>{},onCompleteObservable:new h.b},E={readAsync:(H,h)=>new Promise(((E,e)=>{this._loadFile(w,o,(w=>{E(new Uint8Array(w))}),!0,(w=>{e(w)}),(w=>{w.setRequestHeader("Range",`bytes=${H}-${H+h-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new k(E)).then((w=>{H.onCompleteObservable.notifyObservers(H),e(w)}),X?w=>X(void 0,w):void 0),H}return this._loadFile(w,o,(o=>{this._validate(w,new Uint8Array(o,0,o.byteLength),H,y),this._unpackBinaryAsync(new k({readAsync:(w,H)=>J(o,w,H),byteLength:o.byteLength})).then((w=>{e(w)}),X?w=>X(void 0,w):void 0)}),!0,X)}return this._loadFile(w,o,(o=>{try{this._validate(w,o,H,y),e({json:this._parseJson(o)})}catch{X&&X()}}),!1,X)}_loadBinary(w,o,H,h,E,e){this._validate(w,new Uint8Array(o.buffer,o.byteOffset,o.byteLength),H,e),this._unpackBinaryAsync(new k({readAsync:(w,H)=>function(w,o,H){try{if(o<0||o>=w.byteLength)throw new RangeError("Offset is out of range.");if(o+H>w.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(w.buffer,w.byteOffset+o,H))}catch(h){return Promise.reject(h)}}(o,w,H),byteLength:o.byteLength})).then((w=>{h(w)}),E?w=>E(void 0,w):void 0)}importMeshAsync(w,o,H,h,E,e){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(H),this.onParsedObservable.clear(),this._log(`Loading ${e||""}`),this._loader=this._getLoader(H),this._loader.importMeshAsync(w,o,null,H,h,E,e))))}loadAsync(w,o,H,h,E){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(o),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(o),this._loader.loadAsync(w,o,H,h,E))))}loadAssetContainerAsync(w,o,H,h,E){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(o),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(o);const e=new V(w),D=[];this.onMaterialLoadedObservable.add((w=>{D.push(w)}));const t=[];this.onTextureLoadedObservable.add((w=>{t.push(w)}));const X=[];this.onCameraLoadedObservable.add((w=>{X.push(w)}));const L=[];return this.onMeshLoadedObservable.add((w=>{w.morphTargetManager&&L.push(w.morphTargetManager)})),this._loader.importMeshAsync(null,w,e,o,H,h,E).then((w=>(Array.prototype.push.apply(e.geometries,w.geometries),Array.prototype.push.apply(e.meshes,w.meshes),Array.prototype.push.apply(e.Ez,w.Ez),Array.prototype.push.apply(e.skeletons,w.skeletons),Array.prototype.push.apply(e.animationGroups,w.animationGroups),Array.prototype.push.apply(e.materials,D),Array.prototype.push.apply(e.textures,t),Array.prototype.push.apply(e.lights,w.lights),Array.prototype.push.apply(e.transformNodes,w.transformNodes),Array.prototype.push.apply(e.cameras,X),Array.prototype.push.apply(e.morphTargetManagers,L),e)))}))}canDirectLoad(w){return O.canDirectLoad(w)}directLoad(w,o){if(o.startsWith("base64,"+l)||o.startsWith(";base64,"+l)||o.startsWith("application/octet-stream;base64,"+l)||o.startsWith("model/gltf-binary;base64,"+l)){const H=(0,W.d)(o);return this._validate(w,new Uint8Array(H,0,H.byteLength)),this._unpackBinaryAsync(new k({readAsync:(w,o)=>J(H,w,o),byteLength:H.byteLength}))}return this._validate(w,o),Promise.resolve({json:this._parseJson(o)})}createPlugin(w){return new b(w[O.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((w,o)=>{this.onCompleteObservable.addOnce((()=>{w()})),this.onErrorObservable.addOnce((w=>{o(w)}))}))}_setState(w){this._state!==w&&(this._state=w,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(c[this._state]))}_loadFile(w,o,H,h,E,e){const D=w._loadFile(o,H,(w=>{this._onProgress(w,D)}),!0,h,E,e);return D.onCompleteObservable.add((()=>{D._lengthComputable=!0,D._total=D._loaded})),this._requests.push(D),D}_onProgress(w,o){if(!this._progressCallback)return;o._lengthComputable=w.lengthComputable,o._loaded=w.loaded,o._total=w.total;let H=!0,h=0,E=0;for(const e of this._requests){if(void 0===e._lengthComputable||void 0===e._loaded||void 0===e._total)return;H=H&&e._lengthComputable,h+=e._loaded,E+=e._total}this._progressCallback({lengthComputable:H,loaded:h,total:H?E:0})}_validate(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),P.e.ValidateAsync(o,H,h,(o=>this.preprocessUrlAsync(H+o).then((o=>w._loadFileAsync(o,void 0,!0,!0).then((w=>new Uint8Array(w,0,w.byteLength))))))).then((w=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(w),this.onValidatedObservable.clear()}),(w=>{this._endPerformanceCounter("Validate JSON"),E.Tools.Warn(`Failed to validate: ${w.message}`),this.onValidatedObservable.clear()})))}_getLoader(w){const o=w.json.asset||{};this._log(`Asset version: ${o.version}`),o.minVersion&&this._log(`Asset minimum version: ${o.minVersion}`),o.generator&&this._log(`Asset generator: ${o.generator}`);const H=b._parseVersion(o.version);if(!H)throw new Error("Invalid version: "+o.version);if(void 0!==o.minVersion){const w=b._parseVersion(o.minVersion);if(!w)throw new Error("Invalid minimum version: "+o.minVersion);if(b._compareVersion(w,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+o.minVersion)}const h={1:b._CreateGLTF1Loader,2:b._CreateGLTF2Loader}[H.major];if(!h)throw new Error("Unsupported version: "+o.version);return h(this)}_parseJson(w){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${w.length}`);const o=JSON.parse(w);return this._endPerformanceCounter("Parse JSON"),o}_unpackBinaryAsync(w){return this._startPerformanceCounter("Unpack Binary"),w.loadAsync(20).then((()=>{const o=w.readUint32();if(1179937895!==o)throw new B.i("Unexpected magic: "+o,B.e.GLTFLoaderUnexpectedMagicError);const H=w.readUint32();this.loggingEnabled&&this._log(`Binary version: ${H}`);const h=w.readUint32();let E;switch(this.useRangeRequests||h===w.buffer.byteLength||L.d.Warn(`Length in header does not match actual data length: ${h} != ${w.buffer.byteLength}`),H){case 1:E=this._unpackBinaryV1Async(w,h);break;case 2:E=this._unpackBinaryV2Async(w,h);break;default:throw new Error("Unsupported version: "+H)}return this._endPerformanceCounter("Unpack Binary"),E}))}_unpackBinaryV1Async(w,o){const H=w.readUint32(),h=w.readUint32();if(0!==h)throw new Error(`Unexpected content format: ${h}`);const E=o-w.byteOffset,e={json:this._parseJson(w.readString(H)),bin:null};if(0!==E){const o=w.byteOffset;e.bin={readAsync:(H,h)=>w.buffer.readAsync(o+H,h),byteLength:E}}return Promise.resolve(e)}_unpackBinaryV2Async(w,o){const H=1313821514,h=5130562,E=w.readUint32();if(w.readUint32()!==H)throw new Error("First chunk format is not JSON");return w.byteOffset+E===o?w.loadAsync(E).then((()=>({json:this._parseJson(w.readString(E)),bin:null}))):w.loadAsync(E+8).then((()=>{const e={json:this._parseJson(w.readString(E)),bin:null},D=()=>{const E=w.readUint32();switch(w.readUint32()){case H:throw new Error("Unexpected JSON chunk");case h:{const o=w.byteOffset;e.bin={readAsync:(H,h)=>w.buffer.readAsync(o+H,h),byteLength:E},w.skipBytes(E);break}default:w.skipBytes(E)}return w.byteOffset!==o?w.loadAsync(8).then(D):Promise.resolve(e)};return D()}))}static _parseVersion(w){if("1.0"===w||"1.0.1"===w)return{major:1,minor:0};const o=(w+"").match(/^(\d+)\.(\d+)/);return o?{major:parseInt(o[1]),minor:parseInt(o[2])}:null}static _compareVersion(w,o){return w.major>o.major?1:w.major<o.major?-1:w.minor>o.minor?1:w.minor<o.minor?-1:0}_logOpen(w){this._log(w),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(w){const o=b._logSpaces.substring(0,2*this._logIndentLevel);L.d.Log(`${o}${w}`)}_logDisabled(w){}_startPerformanceCounterEnabled(w){E.Tools.StartPerformanceCounter(w)}_startPerformanceCounterDisabled(w){}_endPerformanceCounterEnabled(w){E.Tools.EndPerformanceCounter(w)}_endPerformanceCounterDisabled(w){}}b.IncrementalLoading=!0,b.HomogeneousCoordinates=!1,b._logSpaces="                                ",(0,e.c)(new b)},13383:(w,o,H)=>{"use strict";H.d(o,{e:()=>D});var h=H(11531);function E(w,o,H,h){const E={externalResourceFunction:h};return H&&(E.uri="file:"===o?H:o+H),ArrayBuffer.isView(w)?GLTFValidator.validateBytes(w,E):GLTFValidator.validateString(w,E)}function e(){const w=[];onmessage=o=>{const H=o.data;switch(H.id){case"init":importScripts(H.url);break;case"validate":E(H.data,H.rootUrl,H.fileName,(o=>new Promise(((H,h)=>{const E=w.length;w.push({resolve:H,reject:h}),postMessage({id:"getExternalResource",index:E,uri:o})})))).then((w=>{postMessage({id:"validate.resolve",value:w})}),(w=>{postMessage({id:"validate.reject",reason:w})}));break;case"getExternalResource.resolve":w[H.index].resolve(H.value);break;case"getExternalResource.reject":w[H.index].reject(H.reason)}}}class D{static ValidateAsync(w,o,H,D){return"function"===typeof Worker?new Promise(((t,X)=>{const L=`${E}(${e})()`,A=URL.createObjectURL(new Blob([L],{type:"application/javascript"})),y=new Worker(A),z=w=>{y.removeEventListener("error",z),y.removeEventListener("message",C),X(w)},C=w=>{const o=w.data;switch(o.id){case"getExternalResource":D(o.uri).then((w=>{y.postMessage({id:"getExternalResource.resolve",index:o.index,value:w},[w.buffer])}),(w=>{y.postMessage({id:"getExternalResource.reject",index:o.index,reason:w})}));break;case"validate.resolve":y.removeEventListener("error",z),y.removeEventListener("message",C),t(o.value),y.terminate();break;case"validate.reject":y.removeEventListener("error",z),y.removeEventListener("message",C),X(o.reason),y.terminate()}};if(y.addEventListener("error",z),y.addEventListener("message",C),y.postMessage({id:"init",url:h.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(w)){const h=w.slice();y.postMessage({id:"validate",data:h,rootUrl:o,fileName:H},[h.buffer])}else y.postMessage({id:"validate",data:w,rootUrl:o,fileName:H})})):(this._LoadScriptPromise||(this._LoadScriptPromise=h.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>E(w,o,H,D))))}}D.Configuration={url:`${h.Tools._DefaultCdnUrl}/gltf_validator.js`}},13959:(w,o,H)=>{"use strict";H.d(o,{b:()=>O});var h=H(11697),E=H(11702),e=H(11745),D=H(11720),t=H(12091),X=H(12027),L=H(11780),A=H(11957),y=H(11666),z=H(11625);H(13129),H(13037),H(13050),H(13040),H(13056),H(13063),H(13066);const C="imageProcessingCompatibility",Q="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=Q);const M="skyPixelShader",i="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";z.d.ShadersStore[M]||(z.d.ShadersStore[M]=i);H(13139),H(13075),H(13084),H(13101),H(13093);const s="skyVertexShader",V="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";z.d.ShadersStore[s]||(z.d.ShadersStore[s]=V);var r=H(12022),k=H(12077),P=H(12072);class l extends t.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class O extends X.b{constructor(w,o){super(w,o),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new D.io(0,100,0),this.useSunPosition=!1,this.cameraOffset=D.io.Zero(),this.up=D.io.Up(),this.dithering=!1,this._cameraPosition=D.io.Zero(),this._skyOrientation=new D.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(w,o){const H=o._drawWrapper;if(this.isFrozen&&H.effect&&H._wasPreviouslyReady)return!0;o.materialDefines||(o.materialDefines=new l);const h=o.materialDefines,E=this.Ow();if(this._isReadyForSubMesh(o))return!0;if((0,P.P)(w,E,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,h),(0,P.I)(w,h,!0,!1),h.IMAGEPROCESSINGPOSTPROCESS!==E.imageProcessingConfiguration.applyByPostProcess&&h.markAsMiscDirty(),h.DITHER!==this.dithering&&h.markAsMiscDirty(),h.isDirty){h.markAsProcessed(),E.resetCachedMaterial();const w=new r.e;h.FOG&&w.addFallback(1,"FOG"),h.IMAGEPROCESSINGPOSTPROCESS=E.imageProcessingConfiguration.applyByPostProcess,h.DITHER=this.dithering;const H=[L.e.PositionKind];h.VERTEXCOLOR&&H.push(L.e.ColorKind);const e="sky",D=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,k.c)(D);const t=h.toString();o.setEffect(E.getEngine().createEffect(e,H,D,[],t,w,this.onCompiled,this.onError),h,this._materialContext)}return!(!o.effect||!o.effect.isReady())&&(h._renderId=E.getRenderId(),H._wasPreviouslyReady=!0,!0)}bindForSubMesh(w,o,H){const h=this.Ow(),E=H.materialDefines;if(!E)return;const e=H.effect;if(!e)return;this._activeEffect=e,this.bindOnlyWorldMatrix(w),this._activeEffect.setMatrix("viewProjection",h.getTransformMatrix()),this._mustRebind(h,e,H)&&((0,k.e)(e,this,h),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,P.h)(E,e,h)),h.fogEnabled&&o.applyFog&&h.fogMode!==A.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",h.getViewMatrix()),(0,P.f)(h,o,this._activeEffect);const t=h.activeCamera;if(t){const w=t.getWorldMatrix();this._cameraPosition.x=w.m[12],this._cameraPosition.y=w.m[13],this._cameraPosition.z=w.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const w=Math.PI*(this.inclination-.5),o=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(o)*Math.cos(w),this.sunPosition.y=this.distance*Math.sin(-w),this.sunPosition.z=this.distance*Math.sin(o)*Math.cos(w),D.Quaternion.FromUnitVectorsToRef(D.io.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(o,this._activeEffect,H)}getAnimatables(){return[]}dispose(w){super.dispose(w)}clone(w){return e.e.Clone((()=>new O(w,this.Ow())),this)}serialize(){const w=super.serialize();return w.customType="BABYLON.SkyMaterial",w}getClassName(){return"SkyMaterial"}static Parse(w,o,H){return e.e.Parse((()=>new O(w.name,o)),w,o,H)}}(0,h.b)([(0,E.B)()],O.prototype,"luminance",void 0),(0,h.b)([(0,E.B)()],O.prototype,"turbidity",void 0),(0,h.b)([(0,E.B)()],O.prototype,"rayleigh",void 0),(0,h.b)([(0,E.B)()],O.prototype,"mieCoefficient",void 0),(0,h.b)([(0,E.B)()],O.prototype,"mieDirectionalG",void 0),(0,h.b)([(0,E.B)()],O.prototype,"distance",void 0),(0,h.b)([(0,E.B)()],O.prototype,"inclination",void 0),(0,h.b)([(0,E.B)()],O.prototype,"azimuth",void 0),(0,h.b)([(0,E.A)()],O.prototype,"sunPosition",void 0),(0,h.b)([(0,E.B)()],O.prototype,"useSunPosition",void 0),(0,h.b)([(0,E.A)()],O.prototype,"cameraOffset",void 0),(0,h.b)([(0,E.A)()],O.prototype,"up",void 0),(0,h.b)([(0,E.B)()],O.prototype,"dithering",void 0),(0,y.g)("BABYLON.SkyMaterial",O)},12414:(w,o,H)=>{"use strict";function h(w,o){o.headers=w.headers||{},o.statusMessage=w.statusText,o.statusCode=w.status,o.data=w.response}function E(w,o,H){return new Promise((function(E,e){H=H||{};var D,t,X,L=new XMLHttpRequest,A=H.body,y=H.headers||{};for(D in H.timeout&&(L.timeout=H.timeout),L.ontimeout=L.onerror=function(w){w.timeout="timeout"==w.type,e(w)},L.open(w,o.href||o),L.onload=function(){for(X=L.getAllResponseHeaders().trim().split(/[\r\n]+/),h(L,L);t=X.shift();)t=t.split(": "),L.headers[t.shift().toLowerCase()]=t.join(": ");if((t=L.headers["content-type"])&&~t.indexOf("application/json"))try{L.data=JSON.parse(L.data,H.reviver)}catch(w){return h(L,w),e(w)}(L.status>=400?e:E)(L)},typeof FormData<"u"&&A instanceof FormData||A&&"object"==typeof A&&(y["content-type"]="application/json",A=JSON.stringify(A)),L.withCredentials=!!H.withCredentials,y)L.setRequestHeader(D,y[D]);L.send(A)}))}H.r(o),H.d(o,{del:()=>X,get:()=>e,patch:()=>t,post:()=>D,put:()=>L,send:()=>E});var e=E.bind(E,"GET"),D=E.bind(E,"POST"),t=E.bind(E,"PATCH"),X=E.bind(E,"DELETE"),L=E.bind(E,"PUT")},14082:(w,o,H)=>{"use strict";H.d(o,{d:()=>y});const h=.5*(Math.sqrt(3)-1),E=(3-Math.sqrt(3))/6,e=1/3,D=1/6,t=(Math.sqrt(5)-1)/4,X=(5-Math.sqrt(5))/20,L=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),A=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const y=class{constructor(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const o="function"==typeof w?w:function(w){let o=0,H=0,h=0,E=1;const e=function(){let w=4022871197;return function(o){o=o.toString();for(let H=0;H<o.length;H++){w+=o.charCodeAt(H);let h=.02519603282416938*w;w=h>>>0,h-=w,h*=w,w=h>>>0,h-=w,w+=4294967296*h}return 2.3283064365386963e-10*(w>>>0)}}();o=e(" "),H=e(" "),h=e(" "),o-=e(w),o<0&&(o+=1);H-=e(w),H<0&&(H+=1);h-=e(w),h<0&&(h+=1);return function(){const w=2091639*o+2.3283064365386963e-10*E;return o=H,H=h,h=w-(E=0|w)}}(w);this.p=function(w){const o=new Uint8Array(256);for(let H=0;H<256;H++)o[H]=H;for(let H=0;H<255;H++){const h=H+~~(w()*(256-H)),E=o[H];o[H]=o[h],o[h]=E}return o}(o),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let H=0;H<512;H++)this.perm[H]=this.p[255&H],this.permMod12[H]=this.perm[H]%12}noise2D(w,o){const H=this.permMod12,e=this.perm;let D=0,t=0,X=0;const A=(w+o)*h,y=Math.floor(w+A),z=Math.floor(o+A),C=(y+z)*E,Q=w-(y-C),M=o-(z-C);let i,s;Q>M?(i=1,s=0):(i=0,s=1);const V=Q-i+E,r=M-s+E,k=Q-1+2*E,P=M-1+2*E,l=255&y,O=255&z;let T=.5-Q*Q-M*M;if(T>=0){const w=3*H[l+e[O]];T*=T,D=T*T*(L[w]*Q+L[w+1]*M)}let S=.5-V*V-r*r;if(S>=0){const w=3*H[l+i+e[O+s]];S*=S,t=S*S*(L[w]*V+L[w+1]*r)}let c=.5-k*k-P*P;if(c>=0){const w=3*H[l+1+e[O+1]];c*=c,X=c*c*(L[w]*k+L[w+1]*P)}return 70*(D+t+X)}noise3D(w,o,H){const h=this.permMod12,E=this.perm;let t,X,A,y;const z=(w+o+H)*e,C=Math.floor(w+z),Q=Math.floor(o+z),M=Math.floor(H+z),i=(C+Q+M)*D,s=w-(C-i),V=o-(Q-i),r=H-(M-i);let k,P,l,O,T,S;s>=V?V>=r?(k=1,P=0,l=0,O=1,T=1,S=0):s>=r?(k=1,P=0,l=0,O=1,T=0,S=1):(k=0,P=0,l=1,O=1,T=0,S=1):V<r?(k=0,P=0,l=1,O=0,T=1,S=1):s<r?(k=0,P=1,l=0,O=0,T=1,S=1):(k=0,P=1,l=0,O=1,T=1,S=0);const c=s-k+D,W=V-P+D,B=r-l+D,J=s-O+2*D,g=V-T+2*D,b=r-S+2*D,p=s-1+.5,f=V-1+.5,N=r-1+.5,j=255&C,q=255&Q,u=255&M;let n=.6-s*s-V*V-r*r;if(n<0)t=0;else{const w=3*h[j+E[q+E[u]]];n*=n,t=n*n*(L[w]*s+L[w+1]*V+L[w+2]*r)}let G=.6-c*c-W*W-B*B;if(G<0)X=0;else{const w=3*h[j+k+E[q+P+E[u+l]]];G*=G,X=G*G*(L[w]*c+L[w+1]*W+L[w+2]*B)}let R=.6-J*J-g*g-b*b;if(R<0)A=0;else{const w=3*h[j+O+E[q+T+E[u+S]]];R*=R,A=R*R*(L[w]*J+L[w+1]*g+L[w+2]*b)}let a=.6-p*p-f*f-N*N;if(a<0)y=0;else{const w=3*h[j+1+E[q+1+E[u+1]]];a*=a,y=a*a*(L[w]*p+L[w+1]*f+L[w+2]*N)}return 32*(t+X+A+y)}noise4D(w,o,H,h){const E=this.perm;let e,D,L,y,z;const C=(w+o+H+h)*t,Q=Math.floor(w+C),M=Math.floor(o+C),i=Math.floor(H+C),s=Math.floor(h+C),V=(Q+M+i+s)*X,r=w-(Q-V),k=o-(M-V),P=H-(i-V),l=h-(s-V);let O=0,T=0,S=0,c=0;r>k?O++:T++,r>P?O++:S++,r>l?O++:c++,k>P?T++:S++,k>l?T++:c++,P>l?S++:c++;const W=O>=3?1:0,B=T>=3?1:0,J=S>=3?1:0,g=c>=3?1:0,b=O>=2?1:0,p=T>=2?1:0,f=S>=2?1:0,N=c>=2?1:0,j=O>=1?1:0,q=T>=1?1:0,u=S>=1?1:0,n=c>=1?1:0,G=r-W+X,R=k-B+X,a=P-J+X,d=l-g+X,I=r-b+2*X,U=k-p+2*X,Z=P-f+2*X,K=l-N+2*X,F=r-j+3*X,v=k-q+3*X,mw=P-u+3*X,Y=l-n+3*X,x=r-1+4*X,ww=k-1+4*X,ow=P-1+4*X,Hw=l-1+4*X,hw=255&Q,Ew=255&M,ew=255&i,Dw=255&s;let tw=.6-r*r-k*k-P*P-l*l;if(tw<0)e=0;else{const w=E[hw+E[Ew+E[ew+E[Dw]]]]%32*4;tw*=tw,e=tw*tw*(A[w]*r+A[w+1]*k+A[w+2]*P+A[w+3]*l)}let Xw=.6-G*G-R*R-a*a-d*d;if(Xw<0)D=0;else{const w=E[hw+W+E[Ew+B+E[ew+J+E[Dw+g]]]]%32*4;Xw*=Xw,D=Xw*Xw*(A[w]*G+A[w+1]*R+A[w+2]*a+A[w+3]*d)}let Lw=.6-I*I-U*U-Z*Z-K*K;if(Lw<0)L=0;else{const w=E[hw+b+E[Ew+p+E[ew+f+E[Dw+N]]]]%32*4;Lw*=Lw,L=Lw*Lw*(A[w]*I+A[w+1]*U+A[w+2]*Z+A[w+3]*K)}let Aw=.6-F*F-v*v-mw*mw-Y*Y;if(Aw<0)y=0;else{const w=E[hw+j+E[Ew+q+E[ew+u+E[Dw+n]]]]%32*4;Aw*=Aw,y=Aw*Aw*(A[w]*F+A[w+1]*v+A[w+2]*mw+A[w+3]*Y)}let yw=.6-x*x-ww*ww-ow*ow-Hw*Hw;if(yw<0)z=0;else{const w=E[hw+1+E[Ew+1+E[ew+1+E[Dw+1]]]]%32*4;yw*=yw,z=yw*yw*(A[w]*x+A[w+1]*ww+A[w+2]*ow+A[w+3]*Hw)}return 27*(e+D+L+y+z)}}}}]);