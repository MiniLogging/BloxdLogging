/*! For license information please see us89x8.32.0ab4b846.chunk.js.LICENSE.txt */
(self["80dd64vgxnn"]=self["80dd64vgxnn"]||[]).push([[32],{14465:(mm,o,u)=>{"use strict";var f=u(14472),B=u(14478),O=u(14482);u.g.__TYPEDARRAY_POOL||(u.g.__TYPEDARRAY_POOL={UINT8:B([32,0]),UINT16:B([32,0]),UINT32:B([32,0]),INT8:B([32,0]),INT16:B([32,0]),INT32:B([32,0]),FLOAT:B([32,0]),DOUBLE:B([32,0]),DATA:B([32,0]),UINT8C:B([32,0]),BUFFER:B([32,0])});var r="undefined"!==typeof Uint8ClampedArray,w=u.g.__TYPEDARRAY_POOL;w.UINT8C||(w.UINT8C=B([32,0])),w.BUFFER||(w.BUFFER=B([32,0]));var p=w.DATA,K=w.BUFFER;function z(mm){if(mm){var o=mm.length||mm.byteLength,u=f.log2(o);p[u].push(mm)}}function Y(mm){mm=f.nextPow2(mm);var o=f.log2(mm),u=p[o];return u.length>0?u.pop():new ArrayBuffer(mm)}function q(mm){return new Uint8Array(Y(mm),0,mm)}function x(mm){return new Uint16Array(Y(2*mm),0,mm)}function H(mm){return new Uint32Array(Y(4*mm),0,mm)}function E(mm){return new Int8Array(Y(mm),0,mm)}function M(mm){return new Int16Array(Y(2*mm),0,mm)}function l(mm){return new Int32Array(Y(4*mm),0,mm)}function t(mm){return new Float32Array(Y(4*mm),0,mm)}function Q(mm){return new Float64Array(Y(8*mm),0,mm)}function b(mm){return r?new Uint8ClampedArray(Y(mm),0,mm):q(mm)}function J(mm){return new DataView(Y(mm),0,mm)}o.free=function(mm){if(O(mm))K[f.log2(mm.length)].push(mm);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(mm)&&(mm=mm.buffer),!mm)return;var o=mm.length||mm.byteLength,u=0|f.log2(o);p[u].push(mm)}},o.freeUint8=o.freeUint16=o.freeUint32=o.freeInt8=o.freeInt16=o.freeInt32=o.freeFloat32=o.freeFloat=o.freeFloat64=o.freeDouble=o.freeUint8Clamped=o.freeDataView=function(mm){z(mm.buffer)},o.freeArrayBuffer=z,o.freeBuffer=function(mm){K[f.log2(mm.length)].push(mm)},o.malloc=function(mm,o){if(void 0===o||"arraybuffer"===o)return Y(mm);switch(o){case"uint8":return q(mm);case"uint16":return x(mm);case"uint32":return H(mm);case"int8":return E(mm);case"int16":return M(mm);case"int32":return l(mm);case"float":case"float32":return t(mm);case"double":case"float64":return Q(mm);case"uint8_clamped":return b(mm);case"buffer":throw"Buffer not supported";case"data":case"dataview":return J(mm);default:return null}return null},o.mallocArrayBuffer=Y,o.mallocUint8=q,o.mallocUint16=x,o.mallocUint32=H,o.mallocInt8=E,o.mallocInt16=M,o.mallocInt32=l,o.mallocFloat32=o.mallocFloat=t,o.mallocFloat64=o.mallocDouble=Q,o.mallocUint8Clamped=b,o.mallocDataView=J,o.clearCache=function(){for(var mm=0;mm<32;++mm)w.UINT8[mm].length=0,w.UINT16[mm].length=0,w.UINT32[mm].length=0,w.INT8[mm].length=0,w.INT16[mm].length=0,w.INT32[mm].length=0,w.FLOAT[mm].length=0,w.DOUBLE[mm].length=0,w.UINT8C[mm].length=0,p[mm].length=0,K[mm].length=0}},14551:(mm,o,u)=>{mm.exports=B;var f=u(13500);function B(mm,o){if(!(this instanceof B))return new B(mm,o);var u=f.create();f.add(u,mm,o),this.base=f.min(f.create(),mm,u),this.Gz=f.clone(o),this.max=f.max(f.create(),mm,u),this.mag=f.length(this.Gz)}var O=B.prototype;O.width=function(){return this.Gz[0]},O.height=function(){return this.Gz[1]},O.depth=function(){return this.Gz[2]},O.x0=function(){return this.base[0]},O.y0=function(){return this.base[1]},O.z0=function(){return this.base[2]},O.x1=function(){return this.max[0]},O.y1=function(){return this.max[1]},O.z1=function(){return this.max[2]},O.translate=function(mm){return f.add(this.max,this.max,mm),f.add(this.base,this.base,mm),this},O.setPosition=function(mm){return f.add(this.max,mm,this.Gz),f.i(this.base,mm),this},O.expand=function(mm){var o=f.create(),u=f.create();return f.max(o,mm.max,this.max),f.min(u,mm.base,this.base),f.Qo(o,o,u),new B(u,o)},O.intersects=function(mm){return!(mm.base[0]>this.max[0])&&(!(mm.base[1]>this.max[1])&&(!(mm.base[2]>this.max[2])&&(!(mm.max[0]<this.base[0])&&(!(mm.max[1]<this.base[1])&&!(mm.max[2]<this.base[2])))))},O.touches=function(mm){var o=this.union(mm);return null!==o&&(0==o.width()||0==o.height()||0==o.depth())},O.union=function(mm){if(!this.intersects(mm))return null;var o=Math.max(mm.base[0],this.base[0]),u=Math.max(mm.base[1],this.base[1]),f=Math.max(mm.base[2],this.base[2]);return new B([o,u,f],[Math.min(mm.max[0],this.max[0])-o,Math.min(mm.max[1],this.max[1])-u,Math.min(mm.max[2],this.max[2])-f])}},14472:(mm,o)=>{"use strict";function u(mm){var o=32;return(mm&=-mm)&&o--,65535&mm&&(o-=16),16711935&mm&&(o-=8),252645135&mm&&(o-=4),858993459&mm&&(o-=2),1431655765&mm&&(o-=1),o}o.INT_BITS=32,o.INT_MAX=2147483647,o.INT_MIN=-1<<31,o.sign=function(mm){return(mm>0)-(mm<0)},o.abs=function(mm){var o=mm>>31;return(mm^o)-o},o.min=function(mm,o){return o^(mm^o)&-(mm<o)},o.max=function(mm,o){return mm^(mm^o)&-(mm<o)},o.isPow2=function(mm){return!(mm&mm-1)&&!!mm},o.log2=function(mm){var o,u;return o=(mm>65535)<<4,o|=u=((mm>>>=o)>255)<<3,o|=u=((mm>>>=u)>15)<<2,(o|=u=((mm>>>=u)>3)<<1)|(mm>>>=u)>>1},o.log10=function(mm){return mm>=1e9?9:mm>=1e8?8:mm>=1e7?7:mm>=1e6?6:mm>=1e5?5:mm>=1e4?4:mm>=1e3?3:mm>=100?2:mm>=10?1:0},o.popCount=function(mm){return 16843009*((mm=(858993459&(mm-=mm>>>1&1431655765))+(mm>>>2&858993459))+(mm>>>4)&252645135)>>>24},o.countTrailingZeros=u,o.nextPow2=function(mm){return mm+=0===mm,--mm,mm|=mm>>>1,mm|=mm>>>2,mm|=mm>>>4,mm|=mm>>>8,(mm|=mm>>>16)+1},o.prevPow2=function(mm){return mm|=mm>>>1,mm|=mm>>>2,mm|=mm>>>4,mm|=mm>>>8,(mm|=mm>>>16)-(mm>>>1)},o.parity=function(mm){return mm^=mm>>>16,mm^=mm>>>8,mm^=mm>>>4,27030>>>(mm&=15)&1};var f=new Array(256);!function(mm){for(var o=0;o<256;++o){var u=o,f=o,B=7;for(u>>>=1;u;u>>>=1)f<<=1,f|=1&u,--B;mm[o]=f<<B&255}}(f),o.reverse=function(mm){return f[255&mm]<<24|f[mm>>>8&255]<<16|f[mm>>>16&255]<<8|f[mm>>>24&255]},o.interleave2=function(mm,o){return(mm=1431655765&((mm=858993459&((mm=252645135&((mm=16711935&((mm&=65535)|mm<<8))|mm<<4))|mm<<2))|mm<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o&=65535)|o<<8))|o<<4))|o<<2))|o<<1))<<1},o.deinterleave2=function(mm,o){return(mm=65535&((mm=16711935&((mm=252645135&((mm=858993459&((mm=mm>>>o&1431655765)|mm>>>1))|mm>>>2))|mm>>>4))|mm>>>16))<<16>>16},o.interleave3=function(mm,o,u){return mm=1227133513&((mm=3272356035&((mm=251719695&((mm=4278190335&((mm&=1023)|mm<<16))|mm<<8))|mm<<4))|mm<<2),(mm|=(o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2))<<1)|(u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2))<<2},o.deinterleave3=function(mm,o){return(mm=1023&((mm=4278190335&((mm=251719695&((mm=3272356035&((mm=mm>>>o&1227133513)|mm>>>2))|mm>>>4))|mm>>>8))|mm>>>16))<<22>>22},o.nextCombination=function(mm){var o=mm|mm-1;return o+1|(~o&-~o)-1>>>u(mm)+1}},14456:(mm,o,u)=>{"use strict";mm.exports=function(mm,o,u){switch(arguments.length){case 1:return f=[],K(B=mm,B,z,!0),f;case 2:return"function"===typeof o?K(mm,mm,o,!0):function(mm,o){return f=[],K(mm,o,z,!1),f}(mm,o);case 3:return K(mm,o,u,!1);default:throw new Error("box-intersect: Invalid arguments")}var B};var f,B=u(14465),O=u(14486),r=u(14496);function w(mm,o){for(var u=0;u<mm;++u)if(!(o[u]<=o[u+mm]))return!0;return!1}function p(mm,o,u,f){for(var B=0,O=0,r=0,p=mm.length;r<p;++r){var K=mm[r];if(!w(o,K)){for(var z=0;z<2*o;++z)u[B++]=K[z];f[O++]=r}}return O}function K(mm,o,u,f){var w=mm.length,K=o.length;if(!(w<=0||K<=0)){var z=mm[0].length>>>1;if(!(z<=0)){var Y,q=B.mallocDouble(2*z*w),x=B.mallocInt32(w);if((w=p(mm,z,q,x))>0){if(1===z&&f)O.init(w),Y=O.sweepComplete(z,u,0,w,q,x,0,w,q,x);else{var H=B.mallocDouble(2*z*K),E=B.mallocInt32(K);(K=p(o,z,H,E))>0&&(O.init(w+K),Y=1===z?O.sweepBipartite(z,u,0,w,q,x,0,K,H,E):r(z,u,f,w,q,x,K,H,E),B.free(H),B.free(E))}B.free(q),B.free(x)}return Y}}}function z(mm,o){f.push([mm,o])}},14503:(mm,o)=>{"use strict";var u="d",f="ax",B="fp",O="es",r="rs",w="re",p="rb",K="bs",z="be",Y="bb",q=[u,f,"vv",r,w,p,"ri",K,z,Y,"bi"];function x(mm){var o="bruteForce"+(mm?"Full":"Partial"),f=[],r=q.slice();mm||r.splice(3,0,B);var w=["function "+o+"("+r.join()+"){"];function p(o,B){var r=function(mm,o,f){var B="bruteForce"+(mm?"Red":"Blue")+(o?"Flip":"")+(f?"Full":""),r=["function ",B,"(",q.join(),"){","var ",O,"=2*",u,";"],w="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",p="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(f?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return mm?r.push(w,"Q",":",p):r.push(p,"Q",":",w),f?r.push("if(y1<x0||x1<y0)continue;"):o?r.push("if(y0<=x0||x1<y0)continue;"):r.push("if(y0<x0||x1<y0)continue;"),r.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),o?r.push("yi,xi"):r.push("xi,yi"),r.push(");if(rv!==void 0)return rv;}}}"),{name:B,code:r.join("")}}(o,B,mm);f.push(r.code),w.push("return "+r.name+"("+q.join()+");")}w.push("if(re-rs>be-bs){"),mm?(p(!0,!1),w.push("}else{"),p(!1,!1)):(w.push("if(fp){"),p(!0,!0),w.push("}else{"),p(!0,!1),w.push("}}else{if(fp){"),p(!1,!0),w.push("}else{"),p(!1,!1),w.push("}")),w.push("}}return "+o);var K=f.join("")+w.join("");return new Function(K)()}o.partial=x(!1),o.full=x(!0)},14496:(mm,o,u)=>{"use strict";mm.exports=function(mm,o,u,O,z,W,F,c,A){!function(mm,o){var u=8*B.log2(o+1)*(mm+1)|0,O=B.nextPow2(b*u);N.length<O&&(f.free(N),N=f.mallocInt32(O));var r=B.nextPow2(J*u);S.length<r&&(f.free(S),S=f.mallocDouble(r))}(mm,O+F);var y,I=0,s=2*mm;P(I++,0,0,O,0,F,u?16:0,-1/0,1/0),u||P(I++,0,0,F,0,O,1,-1/0,1/0);for(;I>0;){var j=(I-=1)*b,a=N[j],X=N[j+1],G=N[j+2],k=N[j+3],d=N[j+4],e=N[j+5],L=I*J,C=S[L],v=S[L+1],V=1&e,n=!!(16&e),U=z,h=W,Z=c,T=A;if(V&&(U=c,h=A,Z=z,T=W),!(2&e&&X>=(G=M(mm,a,X,G,U,h,v)))&&!(4&e&&(X=l(mm,a,X,G,U,h,C))>=G)){var D=G-X,i=d-k;if(n){if(mm*D*(D+i)<x){if(void 0!==(y=p.scanComplete(mm,a,o,X,G,U,h,k,d,Z,T)))return y;continue}}else{if(mm*Math.min(D,i)<Y){if(void 0!==(y=r(mm,a,o,V,X,G,U,h,k,d,Z,T)))return y;continue}if(mm*D*i<q){if(void 0!==(y=p.scanBipartite(mm,a,o,V,X,G,U,h,k,d,Z,T)))return y;continue}}var mo=H(mm,a,X,G,U,h,C,v);if(X<mo)if(mm*(mo-X)<Y){if(void 0!==(y=w(mm,a+1,o,X,mo,U,h,k,d,Z,T)))return y}else if(a===mm-2){if(void 0!==(y=V?p.sweepBipartite(mm,o,k,d,Z,T,X,mo,U,h):p.sweepBipartite(mm,o,X,mo,U,h,k,d,Z,T)))return y}else P(I++,a+1,X,mo,k,d,V,-1/0,1/0),P(I++,a+1,k,d,X,mo,1^V,-1/0,1/0);if(mo<G){var om=K(mm,a,k,d,Z,T),um=Z[s*om+a],fm=E(mm,a,om,d,Z,T,um);if(fm<d&&P(I++,a,mo,G,fm,d,(4|V)+(n?16:0),um,v),k<om&&P(I++,a,mo,G,k,om,(2|V)+(n?16:0),C,um),om+1===fm){if(void 0!==(y=n?g(mm,a,o,mo,G,U,h,om,Z,T[om]):R(mm,a,o,V,mo,G,U,h,om,Z,T[om])))return y}else if(om<fm){var Bm;if(n){if(mo<(Bm=t(mm,a,mo,G,U,h,um))){var Om=E(mm,a,mo,Bm,U,h,um);if(a===mm-2){if(mo<Om&&void 0!==(y=p.sweepComplete(mm,o,mo,Om,U,h,om,fm,Z,T)))return y;if(Om<Bm&&void 0!==(y=p.sweepBipartite(mm,o,Om,Bm,U,h,om,fm,Z,T)))return y}else mo<Om&&P(I++,a+1,mo,Om,om,fm,16,-1/0,1/0),Om<Bm&&(P(I++,a+1,Om,Bm,om,fm,0,-1/0,1/0),P(I++,a+1,om,fm,Om,Bm,1,-1/0,1/0))}}else mo<(Bm=V?Q(mm,a,mo,G,U,h,um):t(mm,a,mo,G,U,h,um))&&(a===mm-2?y=V?p.sweepBipartite(mm,o,om,fm,Z,T,mo,Bm,U,h):p.sweepBipartite(mm,o,mo,Bm,U,h,om,fm,Z,T):(P(I++,a+1,mo,Bm,om,fm,V,-1/0,1/0),P(I++,a+1,om,fm,mo,Bm,1^V,-1/0,1/0)))}}}}};var f=u(14465),B=u(14472),O=u(14503),r=O.partial,w=O.full,p=u(14486),K=u(14509),z=u(14518),Y=128,q=1<<22,x=1<<22,H=z("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),E=z("lo===p0",["p0"]),M=z("lo<p0",["p0"]),l=z("hi<=p0",["p0"]),t=z("lo<=p0&&p0<=hi",["p0"]),Q=z("lo<p0&&p0<=hi",["p0"]),b=6,J=2,N=f.mallocInt32(1024),S=f.mallocDouble(1024);function P(mm,o,u,f,B,O,r,w,p){var K=b*mm;N[K]=o,N[K+1]=u,N[K+2]=f,N[K+3]=B,N[K+4]=O,N[K+5]=r;var z=J*mm;S[z]=w,S[z+1]=p}function R(mm,o,u,f,B,O,r,w,p,K,z){var Y=2*mm,q=p*Y,x=K[q+o];mm:for(var H=B,E=B*Y;H<O;++H,E+=Y){var M=r[E+o],l=r[E+o+mm];if(!(x<M||l<x)&&(!f||x!==M)){for(var t,Q=w[H],b=o+1;b<mm;++b){M=r[E+b],l=r[E+b+mm];var J=K[q+b],N=K[q+b+mm];if(l<J||N<M)continue mm}if(void 0!==(t=f?u(z,Q):u(Q,z)))return t}}}function g(mm,o,u,f,B,O,r,w,p,K){var z=2*mm,Y=w*z,q=p[Y+o];mm:for(var x=f,H=f*z;x<B;++x,H+=z){var E=r[x];if(E!==K){var M=O[H+o],l=O[H+o+mm];if(!(q<M||l<q)){for(var t=o+1;t<mm;++t){M=O[H+t],l=O[H+t+mm];var Q=p[Y+t],b=p[Y+t+mm];if(l<Q||b<M)continue mm}var J=u(E,K);if(void 0!==J)return J}}}}},14509:(mm,o,u)=>{"use strict";mm.exports=function(mm,o,u,r,w,p){if(r<=u+1)return u;var K=u,z=r,Y=r+u>>>1,q=2*mm,x=Y,H=w[q*Y+o];for(;K<z;){if(z-K<B){O(mm,o,K,z,w,p),H=w[q*Y+o];break}var E=z-K,M=Math.random()*E+K|0,l=w[q*M+o],t=Math.random()*E+K|0,Q=w[q*t+o],b=Math.random()*E+K|0,J=w[q*b+o];l<=Q?J>=Q?(x=t,H=Q):l>=J?(x=M,H=l):(x=b,H=J):Q>=J?(x=t,H=Q):J>=l?(x=M,H=l):(x=b,H=J);for(var N=q*(z-1),S=q*x,P=0;P<q;++P,++N,++S){var R=w[N];w[N]=w[S],w[S]=R}var g=p[z-1];p[z-1]=p[x],p[x]=g;for(N=q*(z-1),S=q*(x=f(mm,o,K,z-1,w,p,H)),P=0;P<q;++P,++N,++S){R=w[N];w[N]=w[S],w[S]=R}g=p[z-1];if(p[z-1]=p[x],p[x]=g,Y<x){for(z=x-1;K<z&&w[q*(z-1)+o]===H;)z-=1;z+=1}else{if(!(x<Y))break;for(K=x+1;K<z&&w[q*K+o]===H;)K+=1}}return f(mm,o,u,Y,w,p,w[q*Y+o])};var f=u(14518)("lo<p0",["p0"]),B=8;function O(mm,o,u,f,B,O){for(var r=2*mm,w=r*(u+1)+o,p=u+1;p<f;++p,w+=r)for(var K=B[w],z=p,Y=r*(p-1);z>u&&B[Y+o]>K;--z,Y-=r){for(var q=Y,x=Y+r,H=0;H<r;++H,++q,++x){var E=B[q];B[q]=B[x],B[x]=E}var M=O[z];O[z]=O[z-1],O[z-1]=M}}},14518:mm=>{"use strict";mm.exports=function(mm,u){var f="abcdef".split("").concat(u),B=[];mm.indexOf("lo")>=0&&B.push("lo=e[k+n]");mm.indexOf("hi")>=0&&B.push("hi=e[k+o]");return f.push(o.replace("_",B.join()).replace("$",mm)),Function.apply(void 0,f)};var o="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14491:mm=>{"use strict";mm.exports=function(mm,f){f<=4*o?u(0,f-1,mm):K(0,f-1,mm)};var o=32;function u(mm,o,u){for(var f=2*(mm+1),B=mm+1;B<=o;++B){for(var O=u[f++],r=u[f++],w=B,p=f-2;w-- >mm;){var K=u[p-2],z=u[p-1];if(K<O)break;if(K===O&&z<r)break;u[p]=K,u[p+1]=z,p-=2}u[p]=O,u[p+1]=r}}function f(mm,o,u){o*=2;var f=u[mm*=2],B=u[mm+1];u[mm]=u[o],u[mm+1]=u[o+1],u[o]=f,u[o+1]=B}function B(mm,o,u){o*=2,u[mm*=2]=u[o],u[mm+1]=u[o+1]}function O(mm,o,u,f){o*=2,u*=2;var B=f[mm*=2],O=f[mm+1];f[mm]=f[o],f[mm+1]=f[o+1],f[o]=f[u],f[o+1]=f[u+1],f[u]=B,f[u+1]=O}function r(mm,o,u,f,B){o*=2,B[mm*=2]=B[o],B[o]=u,B[mm+1]=B[o+1],B[o+1]=f}function w(mm,o,u){o*=2;var f=u[mm*=2],B=u[o];return!(f<B)&&(f!==B||u[mm+1]>u[o+1])}function p(mm,o,u,f){var B=f[mm*=2];return B<o||B===o&&f[mm+1]<u}function K(mm,z,Y){var q=(z-mm+1)/6|0,x=mm+q,H=z-q,E=mm+z>>1,M=E-q,l=E+q,t=x,Q=M,b=E,J=l,N=H,S=mm+1,P=z-1,R=0;w(t,Q,Y)&&(R=t,t=Q,Q=R),w(J,N,Y)&&(R=J,J=N,N=R),w(t,b,Y)&&(R=t,t=b,b=R),w(Q,b,Y)&&(R=Q,Q=b,b=R),w(t,J,Y)&&(R=t,t=J,J=R),w(b,J,Y)&&(R=b,b=J,J=R),w(Q,N,Y)&&(R=Q,Q=N,N=R),w(Q,b,Y)&&(R=Q,Q=b,b=R),w(J,N,Y)&&(R=J,J=N,N=R);for(var g=Y[2*Q],W=Y[2*Q+1],F=Y[2*J],c=Y[2*J+1],A=2*t,y=2*b,I=2*N,s=2*x,j=2*E,a=2*H,X=0;X<2;++X){var G=Y[A+X],k=Y[y+X],d=Y[I+X];Y[s+X]=G,Y[j+X]=k,Y[a+X]=d}B(M,mm,Y),B(l,z,Y);for(var e=S;e<=P;++e)if(p(e,g,W,Y))e!==S&&f(e,S,Y),++S;else if(!p(e,F,c,Y))for(;;){if(p(P,F,c,Y)){p(P,g,W,Y)?(O(e,S,P,Y),++S,--P):(f(e,P,Y),--P);break}if(--P<e)break}r(mm,S-1,g,W,Y),r(z,P+1,F,c,Y),S-2-mm<=o?u(mm,S-2,Y):K(mm,S-2,Y),z-(P+2)<=o?u(P+2,z,Y):K(P+2,z,Y),P-S<=o?u(S,P,Y):K(S,P,Y)}},14486:(mm,o,u)=>{"use strict";mm.exports={init:function(mm){var o=B.nextPow2(mm);p.length<o&&(f.free(p),p=f.mallocInt32(o));K.length<o&&(f.free(K),K=f.mallocInt32(o));z.length<o&&(f.free(z),z=f.mallocInt32(o));Y.length<o&&(f.free(Y),Y=f.mallocInt32(o));q.length<o&&(f.free(q),q=f.mallocInt32(o));x.length<o&&(f.free(x),x=f.mallocInt32(o));var u=8*o;H.length<u&&(f.free(H),H=f.mallocDouble(u))},sweepBipartite:function(mm,o,u,f,B,w,q,x,l,t){for(var Q=0,b=2*mm,J=mm-1,N=b-1,S=u;S<f;++S){var P=w[S],R=b*S;H[Q++]=B[R+J],H[Q++]=-(P+1),H[Q++]=B[R+N],H[Q++]=P}for(S=q;S<x;++S){P=t[S]+r;var g=b*S;H[Q++]=l[g+J],H[Q++]=-P,H[Q++]=l[g+N],H[Q++]=P}var W=Q>>>1;O(H,W);var F=0,c=0;for(S=0;S<W;++S){var A=0|H[2*S+1];if(A>=r)E(z,Y,c--,A=A-r|0);else if(A>=0)E(p,K,F--,A);else if(A<=-r){A=-A-r|0;for(var y=0;y<F;++y){if(void 0!==(I=o(p[y],A)))return I}M(z,Y,c++,A)}else{A=-A-1|0;for(y=0;y<c;++y){var I;if(void 0!==(I=o(A,z[y])))return I}M(p,K,F++,A)}}},sweepComplete:function(mm,o,u,f,B,r,w,l,t,Q){for(var b=0,J=2*mm,N=mm-1,S=J-1,P=u;P<f;++P){var R=r[P]+1<<1,g=J*P;H[b++]=B[g+N],H[b++]=-R,H[b++]=B[g+S],H[b++]=R}for(P=w;P<l;++P){R=Q[P]+1<<1;var W=J*P;H[b++]=t[W+N],H[b++]=1|-R,H[b++]=t[W+S],H[b++]=1|R}var F=b>>>1;O(H,F);var c=0,A=0,y=0;for(P=0;P<F;++P){var I=0|H[2*P+1],s=1&I;if(P<F-1&&I>>1===H[2*P+3]>>1&&(s=2,P+=1),I<0){for(var j=-(I>>1)-1,a=0;a<y;++a){if(void 0!==(X=o(q[a],j)))return X}if(0!==s)for(a=0;a<c;++a){if(void 0!==(X=o(p[a],j)))return X}if(1!==s)for(a=0;a<A;++a){var X;if(void 0!==(X=o(z[a],j)))return X}0===s?M(p,K,c++,j):1===s?M(z,Y,A++,j):2===s&&M(q,x,y++,j)}else{j=(I>>1)-1;0===s?E(p,K,c--,j):1===s?E(z,Y,A--,j):2===s&&E(q,x,y--,j)}}},scanBipartite:function(mm,o,u,f,B,w,z,Y,q,x,l,t){var Q=0,b=2*mm,J=o,N=o+mm,S=1,P=1;f?P=r:S=r;for(var R=B;R<w;++R){var g=R+S,W=b*R;H[Q++]=z[W+J],H[Q++]=-g,H[Q++]=z[W+N],H[Q++]=g}for(R=q;R<x;++R){g=R+P;var F=b*R;H[Q++]=l[F+J],H[Q++]=-g}var c=Q>>>1;O(H,c);var A=0;for(R=0;R<c;++R){var y=0|H[2*R+1];if(y<0){var I=!1;if((g=-y)>=r?(I=!f,g-=r):(I=!!f,g-=1),I)M(p,K,A++,g);else{var s=t[g],j=b*g,a=l[j+o+1],X=l[j+o+1+mm];mm:for(var G=0;G<A;++G){var k=p[G],d=b*k;if(!(X<z[d+o+1]||z[d+o+1+mm]<a)){for(var e=o+2;e<mm;++e)if(l[j+e+mm]<z[d+e]||z[d+e+mm]<l[j+e])continue mm;var L,C=Y[k];if(void 0!==(L=f?u(s,C):u(C,s)))return L}}}}else E(p,K,A--,y-S)}},scanComplete:function(mm,o,u,f,B,w,K,z,Y,q,x){for(var E=0,M=2*mm,l=o,t=o+mm,Q=f;Q<B;++Q){var b=Q+r,J=M*Q;H[E++]=w[J+l],H[E++]=-b,H[E++]=w[J+t],H[E++]=b}for(Q=z;Q<Y;++Q){b=Q+1;var N=M*Q;H[E++]=q[N+l],H[E++]=-b}var S=E>>>1;O(H,S);var P=0;for(Q=0;Q<S;++Q){var R=0|H[2*Q+1];if(R<0){if((b=-R)>=r)p[P++]=b-r;else{var g=x[b-=1],W=M*b,F=q[W+o+1],c=q[W+o+1+mm];mm:for(var A=0;A<P;++A){var y=p[A],I=K[y];if(I===g)break;var s=M*y;if(!(c<w[s+o+1]||w[s+o+1+mm]<F)){for(var j=o+2;j<mm;++j)if(q[W+j+mm]<w[s+j]||w[s+j+mm]<q[W+j])continue mm;var a=u(I,g);if(void 0!==a)return a}}}}else{for(b=R-r,A=P-1;A>=0;--A)if(p[A]===b){for(j=A+1;j<P;++j)p[j-1]=p[j];break}--P}}}};var f=u(14465),B=u(14472),O=u(14491),r=1<<28,w=1024,p=f.mallocInt32(w),K=f.mallocInt32(w),z=f.mallocInt32(w),Y=f.mallocInt32(w),q=f.mallocInt32(w),x=f.mallocInt32(w),H=f.mallocDouble(8192);function E(mm,o,u,f){var B=o[f],O=mm[u-1];mm[B]=O,o[O]=B}function M(mm,o,u,f){mm[u]=f,o[f]=u}},14478:mm=>{"use strict";function o(mm,u,f){var B=0|mm[f];if(B<=0)return[];var O,r=new Array(B);if(f===mm.length-1)for(O=0;O<B;++O)r[O]=u;else for(O=0;O<B;++O)r[O]=o(mm,u,f+1);return r}mm.exports=function(mm,u){switch("undefined"===typeof u&&(u=0),typeof mm){case"number":if(mm>0)return function(mm,o){var u,f;for(u=new Array(mm),f=0;f<mm;++f)u[f]=o;return u}(0|mm,u);break;case"object":if("number"===typeof mm.length)return o(mm,u,0)}return[]}},14423:(mm,o,u)=>{mm.exports=function(){var mm=this;this.components={},this.comps=this.components;var o=this.components,u=1,B={},O=[],r=[],w={timeout:!1,removals:[],multiComps:[]};function p(mm,u){var f=o[u],O=B[u],r=O.hash[mm];r&&(O.remove(mm),f.ff&&(f.multi?(r.forEach((o=>{o&&f.ff(mm,o)})),r.length=0):f.ff(mm,r)),w.removals.push(O),K())}function K(){w.timeout||(w.timeout=!0,setTimeout(z,1))}function z(){w.timeout=!1,Y()}function Y(){w.multiComps.length&&function(mm){for(var o=0;o<mm.length;o++){var{entID:u,data:f}=mm[o],B=f.hash[u];if(B){for(var O=0;O<B.length;O++)B[O]||(B.splice(O,1),O--);0===B.length&&(f.remove(u),w.removals.push(f))}}mm.length=0}(w.multiComps),w.removals.length&&function(mm){for(var o=0;o<mm.length;o++){mm[o].flush()}mm.length=0}(w.removals)}this.oq=B,this._systems=O,this._renderSystems=r,this.AK=function(o){var f=u++;return Array.isArray(o)&&o.forEach((o=>mm.NK(f,o))),f},this.deleteEntity=function(o){return Object.keys(B).forEach((mm=>{B[mm].hash[o]&&p(o,mm)})),mm},this.BY=function(mm){if(!mm)throw new Error("Missing component definition");var u=mm.name;if(!u)throw new Error("Component definition must have a name property.");if("string"!==typeof u)throw new Error("Component name must be a string.");if(""===u)throw new Error("Component name must be a non-empty string.");if(B[u])throw new Error(`Component ${u} already exists.`);var w={};return w.name=u,w.multi=!!mm.multi,w.order=isNaN(mm.order)?99:mm.order,w.stateConstructor=mm.stateConstructor||null,w.state=mm.state||{},w.Qp=mm.Qp||null,w.ff=mm.ff||null,w.system=mm.system||null,w.Rp=mm.Rp||null,o[u]=w,B[u]=new f,B[u]._pendingMultiCleanup=!1,B[u]._multiCleanupIDs=w.multi?[]:null,w.system&&(O.push(u),O.sort(((mm,u)=>o[mm].order-o[u].order))),w.Rp&&(r.push(u),r.sort(((mm,u)=>o[mm].order-o[u].order))),u},this.overwriteComponent=function(mm,u){var f=o[mm];if(!f)throw new Error(`Unknown component: ${mm}`);if(!u)throw new Error("Missing component definition");if(f.name!==u.name)throw new Error("Overwriting component must use the same name property.");var w={};w.name=mm,w.multi=!!u.multi,w.order=isNaN(u.order)?99:u.order,w.state=u.state||{},w.Qp=u.Qp||null,w.ff=u.ff||null,w.system=u.system||null,w.Rp=u.Rp||null,o[mm]=w,B[mm]._pendingMultiCleanup=!1,B[mm]._multiCleanupIDs=w.multi?[]:null;var p=O.indexOf(mm);w.system&&p<0&&O.push(mm),!w.system&&p>=0&&O.splice(p,1),O.sort(((mm,u)=>o[mm].order-o[u].order));var K=r.indexOf(mm);w.Rp&&K<0&&r.push(mm),!w.Rp&&K>=0&&r.splice(K,1),r.sort(((mm,u)=>o[mm].order-o[u].order));var z=w.state;return this.Nz(mm).forEach((mm=>{for(var o in z)o in mm||(mm[o]=z[o]);w.Qp&&w.Qp(mm.Sp,mm)})),mm},this.deleteComponent=function(u){var f=B[u];if(!f)throw new Error(`Unknown component: ${u}`);f.flush(),f.list.forEach((mm=>{mm&&p(mm.Sp||mm[0].Sp,u)}));var w=O.indexOf(u),K=r.indexOf(u);return w>-1&&O.splice(w,1),K>-1&&r.splice(K,1),B[u].dispose(),delete B[u],delete o[u],mm},this.NK=function(mm,u,f){var O,r=o[u],w=B[u];if(!w)throw new Error(`Unknown component: ${u}.`);if(w.hash[mm]&&!r.multi)throw new Error(`Entity ${mm} already has component: ${u}.`);if(r.stateConstructor){if(!(O=new r.stateConstructor).hasOwnProperty("Sp"))throw new Error(`Component ${r.name} stateConstructor type does not have property __id`)}else O=Object.assign({},{Sp:mm},r.state,f);if(O.Sp=mm,r.multi){var p=w.hash[mm];p||(p=[],w.add(mm,p)),p.push(O)}else w.add(mm,O);return r.Qp&&r.Qp(mm,O),this},this.sK=function(mm,o){var u=B[o];if(!u)throw new Error(`Unknown component: ${o}.`);return!!u.hash[mm]},this.gK=function(o,u){if(!B[u])throw new Error(`Unknown component: ${u}.`);return p(o,u),mm},this.getState=function(mm,o){var u=B[o];if(!u)throw new Error(`Unknown component: ${o}.`);return u.hash[mm]},this.Nz=function(mm){var o=B[mm];if(!o)throw new Error(`Unknown component: ${mm}.`);return Y(),o.list},this.Tx=function(mm){if(!B[mm])throw new Error(`Unknown component: ${mm}.`);var o=B[mm].hash;return mm=>o[mm]},this.mE=function(mm){if(!B[mm])throw new Error(`Unknown component: ${mm}.`);var o=B[mm].hash;return mm=>!!o[mm]},this.fp=function(u){Y();for(var f=0;f<O.length;f++){var r=O[f],w=o[r],p=B[r];w.system(u,p.list),Y()}return mm},this.render=function(u){Y();for(var f=0;f<r.length;f++){var O=r[f],w=o[O],p=B[O];w.Rp(u,p.list),Y()}return mm},this.removeMultiComponent=function(u,f,O){var r=o[f],p=B[f];if(!p)throw new Error(`Unknown component: ${f}.`);if(!r.multi)throw new Error("removeMultiComponent called on non-multi component");return function(mm,o,u,f){var B=u.hash[mm];if(B){var O=B[f];O&&(B[f]=null,o.ff&&o.ff(mm,O),w.multiComps.push({entID:mm,data:u}),K())}}(u,r,p,O),mm}};var f=u(14427)},14427:mm=>{function o(mm,o){var u=mm._map[o];if(delete mm.hash[o],delete mm._map[o],u===mm.list.length-1)mm.list.pop();else{var f=mm.list.pop();if(mm.list[u]=f,null===f||null===f[0]){var B=mm.list.length;for(var O in mm._map)if(mm._map[O]===B)return void(mm._map[O]=u)}else{var r=f.Sp||f[0].Sp;mm._map[r]=u}}}mm.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(mm,o){if("number"===typeof this._map[mm]){var u=this._map[mm];this.hash[mm]=o,this.list[u]=o}else this._map[mm]=this.list.length,this.hash[mm]=o,this.list.push(o)}remove(mm){var o=this._map[mm];this.hash[mm]=null,this.list[o]=null,this._pendingRemovals.push(mm)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var mm=0;mm<this._pendingRemovals.length;mm++){var u=this._pendingRemovals[mm];null===this.hash[u]&&o(this,u)}this._pendingRemovals.length=0}}},14384:mm=>{"use strict";var o,u="object"===typeof Reflect?Reflect:null,f=function(mm,o,u){return Function.prototype.apply.call(mm,o,u)};o=u&&"function"===typeof u.ownKeys?u.ownKeys:Object.getOwnPropertySymbols?function(mm){return Object.getOwnPropertyNames(mm).concat(Object.getOwnPropertySymbols(mm))}:function(mm){return Object.getOwnPropertyNames(mm)};var B=Number.isNaN||function(mm){return mm!==mm};function O(){O.init.call(this)}mm.exports=O,mm.exports.once=function(mm,o){return new Promise((function(u,f){function B(u){mm.removeListener(o,O),f(u)}function O(){"function"===typeof mm.removeListener&&mm.removeListener("error",B),u([].slice.call(arguments))}E(mm,o,O,{once:!0}),"error"!==o&&function(mm,o,u){"function"===typeof mm.on&&E(mm,"error",o,u)}(mm,B,{once:!0})}))},O.EventEmitter=O,O.prototype._events=void 0,O.prototype._eventsCount=0,O.prototype._maxListeners=void 0;var r=10;function w(mm){if("function"!==typeof mm)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof mm)}function p(mm){return void 0===mm._maxListeners?O.defaultMaxListeners:mm._maxListeners}function K(mm,o,u,f){var B,O,r,K;if(w(u),void 0===(O=mm._events)?(O=mm._events=Object.create(null),mm._eventsCount=0):(void 0!==O.newListener&&(mm.emit("newListener",o,u.listener?u.listener:u),O=mm._events),r=O[o]),void 0===r)r=O[o]=u,++mm._eventsCount;else if("function"===typeof r?r=O[o]=f?[u,r]:[r,u]:f?r.unshift(u):r.push(u),(B=p(mm))>0&&r.length>B&&!r.warned){r.warned=!0;var z=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(o)+" listeners added. Use emitter.setMaxListeners() to increase limit");z.name="MaxListenersExceededWarning",z.ro=mm,z.type=o,z.count=r.length,K=z,console&&console.warn&&console.warn(K)}return mm}function z(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Y(mm,o,u){var f={fired:!1,wrapFn:void 0,target:mm,type:o,listener:u},B=z.bind(f);return B.listener=u,f.wrapFn=B,B}function q(mm,o,u){var f=mm._events;if(void 0===f)return[];var B=f[o];return void 0===B?[]:"function"===typeof B?u?[B.listener||B]:[B]:u?function(mm){for(var o=new Array(mm.length),u=0;u<o.length;++u)o[u]=mm[u].listener||mm[u];return o}(B):H(B,B.length)}function x(mm){var o=this._events;if(void 0!==o){var u=o[mm];if("function"===typeof u)return 1;if(void 0!==u)return u.length}return 0}function H(mm,o){for(var u=new Array(o),f=0;f<o;++f)u[f]=mm[f];return u}function E(mm,o,u,f){if("function"===typeof mm.on)f.once?mm.once(o,u):mm.on(o,u);else{if("function"!==typeof mm.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof mm);mm.addEventListener(o,(function B(O){f.once&&mm.removeEventListener(o,B),u(O)}))}}Object.defineProperty(O,"defaultMaxListeners",{enumerable:!0,get:function(){return r},set:function(mm){if("number"!==typeof mm||mm<0||B(mm))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+mm+".");r=mm}}),O.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},O.prototype.setMaxListeners=function(mm){if("number"!==typeof mm||mm<0||B(mm))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+mm+".");return this._maxListeners=mm,this},O.prototype.getMaxListeners=function(){return p(this)},O.prototype.emit=function(mm){for(var o=[],u=1;u<arguments.length;u++)o.push(arguments[u]);var B="error"===mm,O=this._events;if(void 0!==O)B=B&&void 0===O.error;else if(!B)return!1;if(B){var r;if(o.length>0&&(r=o[0]),r instanceof Error)throw r;var w=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw w.context=r,w}var p=O[mm];if(void 0===p)return!1;if("function"===typeof p)f(p,this,o);else{var K=p.length,z=H(p,K);for(u=0;u<K;++u)f(z[u],this,o)}return!0},O.prototype.addListener=function(mm,o){return K(this,mm,o,!1)},O.prototype.on=O.prototype.addListener,O.prototype.prependListener=function(mm,o){return K(this,mm,o,!0)},O.prototype.once=function(mm,o){return w(o),this.on(mm,Y(this,mm,o)),this},O.prototype.prependOnceListener=function(mm,o){return w(o),this.prependListener(mm,Y(this,mm,o)),this},O.prototype.removeListener=function(mm,o){var u,f,B,O,r;if(w(o),void 0===(f=this._events))return this;if(void 0===(u=f[mm]))return this;if(u===o||u.listener===o)0===--this._eventsCount?this._events=Object.create(null):(delete f[mm],f.removeListener&&this.emit("removeListener",mm,u.listener||o));else if("function"!==typeof u){for(B=-1,O=u.length-1;O>=0;O--)if(u[O]===o||u[O].listener===o){r=u[O].listener,B=O;break}if(B<0)return this;0===B?u.shift():function(mm,o){for(;o+1<mm.length;o++)mm[o]=mm[o+1];mm.pop()}(u,B),1===u.length&&(f[mm]=u[0]),void 0!==f.removeListener&&this.emit("removeListener",mm,r||o)}return this},O.prototype.off=O.prototype.removeListener,O.prototype.wo=function(mm){var o,u,f;if(void 0===(u=this._events))return this;if(void 0===u.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==u[mm]&&(0===--this._eventsCount?this._events=Object.create(null):delete u[mm]),this;if(0===arguments.length){var B,O=Object.keys(u);for(f=0;f<O.length;++f)"removeListener"!==(B=O[f])&&this.wo(B);return this.wo("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(o=u[mm]))this.removeListener(mm,o);else if(void 0!==o)for(f=o.length-1;f>=0;f--)this.removeListener(mm,o[f]);return this},O.prototype.listeners=function(mm){return q(this,mm,!0)},O.prototype.rawListeners=function(mm){return q(this,mm,!1)},O.listenerCount=function(mm,o){return"function"===typeof mm.listenerCount?mm.listenerCount(o):x.call(mm,o)},O.prototype.listenerCount=x,O.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]}},14835:mm=>{"use strict";mm.exports=function(mm,o,u,f,B,O){var r=+o[0],w=+o[1],p=+o[2],K=+u[0],z=+u[1],Y=+u[2],q=Math.sqrt(K*K+z*z+Y*Y);if(0===q)throw new Error("Can't raycast along a zero vector");return function(mm,o,u,f,B,O,r,w,p,K){for(var z=0,Y=Math.floor,q=0|Y(o),x=0|Y(u),H=0|Y(f),E=B>0?1:-1,M=O>0?1:-1,l=r>0?1:-1,t=Math.abs(1/B),Q=Math.abs(1/O),b=Math.abs(1/r),J=t<1/0?t*(E>0?q+1-o:o-q):1/0,N=Q<1/0?Q*(M>0?x+1-u:u-x):1/0,S=b<1/0?b*(l>0?H+1-f:f-H):1/0,P=-1;z<=w;){var R=mm(q,x,H);if(R)return p&&(p[0]=o+z*B,p[1]=u+z*O,p[2]=f+z*r),K&&(K[0]=K[1]=K[2]=0,0===P&&(K[0]=-E),1===P&&(K[1]=-M),2===P&&(K[2]=-l)),R;J<N?J<S?(q+=E,z=J,J+=t,P=0):(H+=l,z=S,S+=b,P=2):N<S?(x+=M,z=N,N+=Q,P=1):(H+=l,z=S,S+=b,P=2)}return p&&(p[0]=o+z*B,p[1]=u+z*O,p[2]=f+z*r),K&&(K[0]=K[1]=K[2]=0),0}(mm,r,w,p,K/=q,z/=q,Y/=q,f="undefined"===typeof f?64:+f,B,O)}},14871:(mm,o,u)=>{"use strict";u.d(o,{b:()=>O});var f=u(14384);function B(){this.vq=!1,this.stopPropagation=!1,this.Vq=!1,this.disabled=!1}class O{constructor(mm,o){this.version="0.7.0";var u=Object.assign({},new B,o||{});this.element=mm||document,this.vq=!!u.vq,this.stopPropagation=!!u.stopPropagation,this.Vq=!!u.Vq,this.disabled=!!u.disabled,this.filterEvents=(mm,o)=>!0,this.down=new f.EventEmitter,this.up=new f.EventEmitter,this.state={},this.lz={dx:0,dy:0,kx:0,Mz:0,Lx:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?w(this):document.addEventListener("DOMContentLoaded",(mm=>{w(this)}),{once:!0})}bind(mm){for(var o=arguments.length,u=new Array(o>1?o-1:0),f=1;f<o;f++)u[f-1]=arguments[f];u.forEach((o=>{var u=this._keyBindmap[o]||[];u.includes(mm)||(u.push(mm),this._keyBindmap[o]=u)})),this.state[mm]=!!this.state[mm],this.pressCount[mm]=this.pressCount[mm]||0,this.releaseCount[mm]=this.releaseCount[mm]||0}unbind(mm){for(var o in this._keyBindmap){var u=this._keyBindmap[o],f=u.indexOf(mm);f>-1&&u.splice(f,1)}}getBindings(){var mm={};for(var o in this._keyBindmap){this._keyBindmap[o].forEach((u=>{mm[u]=mm[u]||[],mm[u].push(o)}))}return mm}fp(){r(this.lz),r(this.pressCount),r(this.releaseCount)}}function r(mm){for(var o in mm)mm[o]=0}function w(mm){window.addEventListener("keydown",H.bind(null,mm,!0),!1),window.addEventListener("keyup",H.bind(null,mm,!1),!1);var o={passive:!0};mm.element.addEventListener("touchstart",Y.bind(void 0,mm),{passive:!1}),mm.element.addEventListener("touchend",x.bind(void 0,mm),o),mm.element.addEventListener("mousedown",E.bind(null,mm,!0),o),window.document.addEventListener("mouseup",E.bind(null,mm,!1),o),mm.element.addEventListener("touchmove",M.bind(null,mm),o),mm.element.addEventListener("mousemove",M.bind(null,mm),o),window.PointerEvent,mm.element.addEventListener("wheel",l.bind(null,mm),o),mm.element.addEventListener("contextmenu",t.bind(null,mm),!1),window.addEventListener("blur",Q.bind(null,mm),!1)}var p=0,K=0,z=null;function Y(mm,o){o.preventDefault(),q(o)}function q(mm){let o=!1;for(let u=0;u<mm.touches.length;++u)if(mm.touches[u].identifier===z){o=!0;break}if(!o){const o=mm.changedTouches[0];p=o.clientX,K=o.clientY,z=o.identifier}}function x(mm,o){for(var u=o.changedTouches,f=0;f<u.length;++f)u[f].identifier===z&&(z=null)}function H(mm,o,u){b(u.code,o,mm,u)}function E(mm,o,u){if("pointerId"in u)if(o){if(null!==mm._touches.currID)return;mm._touches.currID=u.pointerId}else{if(mm._touches.currID!==u.pointerId)return;mm._touches.currID=null}return b("Mouse"+("button"in u?u.button+1:1),o,mm,u),!1}function M(mm,o){var u=o.movementX||o.mozMovementX||0,f=o.movementY||o.mozMovementY||0;if(o.touches&&0===(u|f)){var B=function(mm){q(mm);for(let o=0;o<mm.changedTouches.length;++o)if(mm.changedTouches[o].identifier==z){const u=mm.changedTouches[o],f=[u.clientX-p,u.clientY-K];return p=u.clientX,K=u.clientY,f}return console.error(`Did not find touch id ${z}`),[0,0]}(o);u=B[0],f=B[1]}mm.lz.dx+=u,mm.lz.dy+=f}function l(mm,o){var u=1;switch(o.deltaMode){case 0:u=1;break;case 1:u=12;break;case 2:u=mm.element.clientHeight||window.innerHeight}mm.lz.kx+=(o.deltaX||0)*u,mm.lz.Mz+=(o.deltaY||0)*u,mm.lz.Lx+=(o.deltaZ||0)*u}function t(mm,o){if(!mm.Vq)return o.preventDefault(),!1}function Q(mm){for(var o in mm._keyStates)mm._keyStates[o]&&(/^Mouse\d/.test(o)||b(o,!1,mm,{code:o,note:"39bgsobxyrv",preventDefault:()=>{},stopPropagation:()=>{}}))}function b(mm,o,u,f){var B=u._keyBindmap[mm];B&&(J(u._keyStates[mm],o)&&(u._keyStates[mm]=o,B.forEach((mm=>{(!u.filterEvents||u.filterEvents(f,mm))&&function(mm,o,u,f){var B=o?u.pressCount:u.releaseCount;B[mm]=(B[mm]||0)+1;var O=u._bindPressCount[mm]||0;(O+=o?1:-1)<0&&(O=0);u._bindPressCount[mm]=O;var r=u.state[mm];if(J(r,O)){u.state[mm]=O>0;var w=o?u.down:u.up;u.disabled||w.emit(mm,f)}}(mm,o,u,f)}))),"button"in f||(u.vq&&!f.defaultPrevented&&f.preventDefault(),u.stopPropagation&&f.stopPropagation()))}function J(mm,o){return mm?!o:o}},13562:mm=>{mm.exports=function(mm,o,u){return mm[0]=o[0]+u[0],mm[1]=o[1]+u[1],mm[2]=o[2]+u[2],mm}},13514:(mm,o,u)=>{mm.exports=function(mm,o){var u=f(mm[0],mm[1],mm[2]),r=f(o[0],o[1],o[2]);B(u,u),B(r,r);var w=O(u,r);return w>1?0:Math.acos(w)};var f=u(13516),B=u(13525),O=u(13529)},13621:mm=>{mm.exports=function(mm,o){return mm[0]=Math.ceil(o[0]),mm[1]=Math.ceil(o[1]),mm[2]=Math.ceil(o[2]),mm}},13512:mm=>{mm.exports=function(mm){var o=new Float32Array(3);return o[0]=mm[0],o[1]=mm[1],o[2]=mm[2],o}},13537:mm=>{mm.exports=function(mm,o){return mm[0]=o[0],mm[1]=o[1],mm[2]=o[2],mm}},13508:mm=>{mm.exports=function(){var mm=new Float32Array(3);return mm[0]=0,mm[1]=0,mm[2]=0,mm}},13712:mm=>{mm.exports=function(mm,o,u){var f=o[0],B=o[1],O=o[2],r=u[0],w=u[1],p=u[2];return mm[0]=B*p-O*w,mm[1]=O*r-f*p,mm[2]=f*w-B*r,mm}},13650:(mm,o,u)=>{mm.exports=u(13644)},13644:mm=>{mm.exports=function(mm,o){var u=o[0]-mm[0],f=o[1]-mm[1],B=o[2]-mm[2];return Math.sqrt(u*u+f*f+B*B)}},13596:(mm,o,u)=>{mm.exports=u(13593)},13593:mm=>{mm.exports=function(mm,o,u){return mm[0]=o[0]/u[0],mm[1]=o[1]/u[1],mm[2]=o[2]/u[2],mm}},13529:mm=>{mm.exports=function(mm,o){return mm[0]*o[0]+mm[1]*o[1]+mm[2]*o[2]}},13506:mm=>{mm.exports=1e-6},13544:(mm,o,u)=>{mm.exports=function(mm,o){var u=mm[0],B=mm[1],O=mm[2],r=o[0],w=o[1],p=o[2];return Math.abs(u-r)<=f*Math.max(1,Math.abs(u),Math.abs(r))&&Math.abs(B-w)<=f*Math.max(1,Math.abs(B),Math.abs(w))&&Math.abs(O-p)<=f*Math.max(1,Math.abs(O),Math.abs(p))};var f=u(13506)},13553:mm=>{mm.exports=function(mm,o){return mm[0]===o[0]&&mm[1]===o[1]&&mm[2]===o[2]}},13613:mm=>{mm.exports=function(mm,o){return mm[0]=Math.floor(o[0]),mm[1]=Math.floor(o[1]),mm[2]=Math.floor(o[2]),mm}},13760:(mm,o,u)=>{mm.exports=function(mm,o,u,B,O,r){var w,p;o||(o=3);u||(u=0);p=B?Math.min(B*o+u,mm.length):mm.length;for(w=u;w<p;w+=o)f[0]=mm[w],f[1]=mm[w+1],f[2]=mm[w+2],O(f,f,r),mm[w]=f[0],mm[w+1]=f[1],mm[w+2]=f[2];return mm};var f=u(13508)()},13516:mm=>{mm.exports=function(mm,o,u){var f=new Float32Array(3);return f[0]=mm,f[1]=o,f[2]=u,f}},13500:(mm,o,u)=>{mm.exports={EPSILON:u(13506),create:u(13508),clone:u(13512),angle:u(13514),Uw:u(13516),i:u(13537),set:u(13539),equals:u(13544),exactEquals:u(13553),add:u(13562),Qo:u(13569),sub:u(13574),multiply:u(13579),mul:u(13587),divide:u(13593),div:u(13596),min:u(13601),max:u(13604),floor:u(13613),ceil:u(13621),round:u(13625),scale:u(13634),hw:u(13641),distance:u(13644),j:u(13650),squaredDistance:u(13657),sqrDist:u(13664),length:u(13670),len:u(13679),squaredLength:u(13687),Zw:u(13696),negate:u(13701),inverse:u(13708),normalize:u(13525),dot:u(13529),cross:u(13712),Iw:u(13721),random:u(13724),transformMat4:u(13731),transformMat3:u(13736),transformQuat:u(13741),Tw:u(13747),Dw:u(13749),iw:u(13758),forEach:u(13760)}},13708:mm=>{mm.exports=function(mm,o){return mm[0]=1/o[0],mm[1]=1/o[1],mm[2]=1/o[2],mm}},13679:(mm,o,u)=>{mm.exports=u(13670)},13670:mm=>{mm.exports=function(mm){var o=mm[0],u=mm[1],f=mm[2];return Math.sqrt(o*o+u*u+f*f)}},13721:mm=>{mm.exports=function(mm,o,u,f){var B=o[0],O=o[1],r=o[2];return mm[0]=B+f*(u[0]-B),mm[1]=O+f*(u[1]-O),mm[2]=r+f*(u[2]-r),mm}},13604:mm=>{mm.exports=function(mm,o,u){return mm[0]=Math.max(o[0],u[0]),mm[1]=Math.max(o[1],u[1]),mm[2]=Math.max(o[2],u[2]),mm}},13601:mm=>{mm.exports=function(mm,o,u){return mm[0]=Math.min(o[0],u[0]),mm[1]=Math.min(o[1],u[1]),mm[2]=Math.min(o[2],u[2]),mm}},13587:(mm,o,u)=>{mm.exports=u(13579)},13579:mm=>{mm.exports=function(mm,o,u){return mm[0]=o[0]*u[0],mm[1]=o[1]*u[1],mm[2]=o[2]*u[2],mm}},13701:mm=>{mm.exports=function(mm,o){return mm[0]=-o[0],mm[1]=-o[1],mm[2]=-o[2],mm}},13525:mm=>{mm.exports=function(mm,o){var u=o[0],f=o[1],B=o[2],O=u*u+f*f+B*B;O>0&&(O=1/Math.sqrt(O),mm[0]=o[0]*O,mm[1]=o[1]*O,mm[2]=o[2]*O);return mm}},13724:mm=>{mm.exports=function(mm,o){o=o||1;var u=2*Math.random()*Math.PI,f=2*Math.random()-1,B=Math.sqrt(1-f*f)*o;return mm[0]=Math.cos(u)*B,mm[1]=Math.sin(u)*B,mm[2]=f*o,mm}},13747:mm=>{mm.exports=function(mm,o,u,f){var B=u[1],O=u[2],r=o[1]-B,w=o[2]-O,p=Math.sin(f),K=Math.cos(f);return mm[0]=o[0],mm[1]=B+r*K-w*p,mm[2]=O+r*p+w*K,mm}},13749:mm=>{mm.exports=function(mm,o,u,f){var B=u[0],O=u[2],r=o[0]-B,w=o[2]-O,p=Math.sin(f),K=Math.cos(f);return mm[0]=B+w*p+r*K,mm[1]=o[1],mm[2]=O+w*K-r*p,mm}},13758:mm=>{mm.exports=function(mm,o,u,f){var B=u[0],O=u[1],r=o[0]-B,w=o[1]-O,p=Math.sin(f),K=Math.cos(f);return mm[0]=B+r*K-w*p,mm[1]=O+r*p+w*K,mm[2]=o[2],mm}},13625:mm=>{mm.exports=function(mm,o){return mm[0]=Math.round(o[0]),mm[1]=Math.round(o[1]),mm[2]=Math.round(o[2]),mm}},13634:mm=>{mm.exports=function(mm,o,u){return mm[0]=o[0]*u,mm[1]=o[1]*u,mm[2]=o[2]*u,mm}},13641:mm=>{mm.exports=function(mm,o,u,f){return mm[0]=o[0]+u[0]*f,mm[1]=o[1]+u[1]*f,mm[2]=o[2]+u[2]*f,mm}},13539:mm=>{mm.exports=function(mm,o,u,f){return mm[0]=o,mm[1]=u,mm[2]=f,mm}},13664:(mm,o,u)=>{mm.exports=u(13657)},13696:(mm,o,u)=>{mm.exports=u(13687)},13657:mm=>{mm.exports=function(mm,o){var u=o[0]-mm[0],f=o[1]-mm[1],B=o[2]-mm[2];return u*u+f*f+B*B}},13687:mm=>{mm.exports=function(mm){var o=mm[0],u=mm[1],f=mm[2];return o*o+u*u+f*f}},13574:(mm,o,u)=>{mm.exports=u(13569)},13569:mm=>{mm.exports=function(mm,o,u){return mm[0]=o[0]-u[0],mm[1]=o[1]-u[1],mm[2]=o[2]-u[2],mm}},13736:mm=>{mm.exports=function(mm,o,u){var f=o[0],B=o[1],O=o[2];return mm[0]=f*u[0]+B*u[3]+O*u[6],mm[1]=f*u[1]+B*u[4]+O*u[7],mm[2]=f*u[2]+B*u[5]+O*u[8],mm}},13731:mm=>{mm.exports=function(mm,o,u){var f=o[0],B=o[1],O=o[2],r=u[3]*f+u[7]*B+u[11]*O+u[15];return r=r||1,mm[0]=(u[0]*f+u[4]*B+u[8]*O+u[12])/r,mm[1]=(u[1]*f+u[5]*B+u[9]*O+u[13])/r,mm[2]=(u[2]*f+u[6]*B+u[10]*O+u[14])/r,mm}},13741:mm=>{mm.exports=function(mm,o,u){var f=o[0],B=o[1],O=o[2],r=u[0],w=u[1],p=u[2],K=u[3],z=K*f+w*O-p*B,Y=K*B+p*f-r*O,q=K*O+r*B-w*f,x=-r*f-w*B-p*O;return mm[0]=z*K+x*-r+Y*-p-q*-w,mm[1]=Y*K+x*-w+q*-r-z*-p,mm[2]=q*K+x*-p+z*-w-Y*-r,mm}},14407:mm=>{"use strict";mm.exports=function(mm){for(var o=new Array(mm),u=0;u<mm;++u)o[u]=u;return o}},14482:mm=>{mm.exports=function(mm){return null!=mm&&null!=mm.constructor&&"function"===typeof mm.constructor.isBuffer&&mm.constructor.isBuffer(mm)}},14841:(mm,o,u)=>{"use strict";u.d(o,{c:()=>f});class f{constructor(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.PY=!1,this.RY=!1,this.NY=30,this.SY=0,this.sY=!1,this.fullscreen=!1,this.WY=function(mm){},this.FY=function(){},this.yY=function(){},this.rf=function(){},this.cY=function(mm){},this.onFullscreenChanged=function(mm){},K((()=>{!function(mm,o){mm._nowObject=performance||Date,mm._lastTick=0,mm._renderAccum=0,mm._rt=0,mm._frameCB=w.bind(null,mm),requestAnimationFrame(mm._frameCB),o>0&&(mm._intervalCB=r.bind(null,mm),mm._interval=setInterval(mm._intervalCB,Math.max(o,1e3/mm.NY/2)))}(this,o),function(mm,o){if(!o)return;var u=!1,f=!1;document.addEventListener("pointerlockchange",(f=>{u=document.pointerLockElement===o,mm.cY(u)})),document.addEventListener("fullscreenchange",(u=>{f=document.fullscreenElement===o,mm.onFullscreenChanged(f)})),Object.defineProperty(mm,"sY",{get:()=>u,set:mm=>{mm&&!u?p(o):u&&!mm&&function(mm){mm.exitPointerLock&&mm.exitPointerLock()}(document)}}),Object.defineProperty(mm,"fullscreen",{get:()=>f,set:mm=>{mm&&!f?o.requestFullscreen():f&&!mm&&document.exitFullscreen()}}),o.addEventListener("click",(B=>{mm.PY&&!u&&p(o),mm.RY&&!f&&o.requestFullscreen()}));var B=()=>mm.rf();if(window.ResizeObserver){new ResizeObserver(B).observe(o)}else window.addEventListener("resize",B)}(this,mm),this.yY()}))}}var B=3,O=20;function r(mm){for(var o=1e3/mm.NY,u=mm._nowObject.now()+O,f=0;mm._nowObject.now()>=mm._lastTick+o&&mm._nowObject.now()<u&&++f<=B;)mm.WY(o),mm._lastTick+=o;var r=5*(o+5),w=mm._nowObject.now();if(w-mm._lastTick>r)for(;w>=mm._lastTick+o;)mm._lastTick+=o}function w(mm){requestAnimationFrame(mm._frameCB),r(mm);var o=mm._nowObject.now(),u=o-mm._rt;if(mm._rt=o,mm.SY>0){mm._renderAccum+=u;var f=1e3/mm.SY;if(mm._renderAccum<f)return;mm._renderAccum=Math.min(mm._renderAccum-f,f)}var B=1e3/mm.NY,O=(o-mm._lastTick)/B;mm.FY(u,O,B)}function p(mm){mm.requestPointerLock&&mm.requestPointerLock()}var K=mm=>{if("loading"===document.readyState){var o=()=>{document.removeEventListener("readystatechange",o),mm()};document.addEventListener("readystatechange",o)}else setTimeout(mm,1)}},14401:(mm,o,u)=>{var f=u(14407),B=u(14413),O="undefined"!==typeof Float64Array;function r(mm,o){return mm[0]-o[0]}function w(){var mm,o=this.stride,u=new Array(o.length);for(mm=0;mm<u.length;++mm)u[mm]=[Math.abs(o[mm]),mm];u.sort(r);var f=new Array(u.length);for(mm=0;mm<f.length;++mm)f[mm]=u[mm][1];return f}function p(mm,o){var u=["View",o,"d",mm].join("");o<0&&(u="View_Nil"+mm);var B="generic"===mm;if(-1===o){var O="function "+u+"(a){this.data=a;};var proto="+u+".prototype;proto.dtype='"+mm+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+u+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+u+"(a){return new "+u+"(a);}";return new Function(O)()}if(0===o){O="function "+u+"(a,d) {this.data = a;this.offset = d};var proto="+u+".prototype;proto.dtype='"+mm+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+u+"_copy() {return new "+u+"(this.data,this.offset)};proto.pick=function "+u+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+u+"_get(){return "+(B?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+u+"_set(v){return "+(B?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+u+"(a,b,c,d){return new "+u+"(a,d)}";return new Function("TrivialArray",O)(K[mm][0])}O=["'use strict'"];var r=f(o),p=r.map((function(mm){return"i"+mm})),z="this.offset+"+r.map((function(mm){return"this.stride["+mm+"]*i"+mm})).join("+"),Y=r.map((function(mm){return"b"+mm})).join(","),q=r.map((function(mm){return"c"+mm})).join(",");O.push("function "+u+"(a,"+Y+","+q+",d){this.data=a","this.shape=["+Y+"]","this.stride=["+q+"]","this.offset=d|0}","var proto="+u+".prototype","proto.dtype='"+mm+"'","proto.dimension="+o),O.push("Object.defineProperty(proto,'size',{get:function "+u+"_size(){return "+r.map((function(mm){return"this.shape["+mm+"]"})).join("*"),"}})"),1===o?O.push("proto.order=[0]"):(O.push("Object.defineProperty(proto,'order',{get:"),o<4?(O.push("function "+u+"_order(){"),2===o?O.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===o&&O.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):O.push("ORDER})")),O.push("proto.set=function "+u+"_set("+p.join(",")+",v){"),B?O.push("return this.data.set("+z+",v)}"):O.push("return this.data["+z+"]=v}"),O.push("proto.get=function "+u+"_get("+p.join(",")+"){"),B?O.push("return this.data.get("+z+")}"):O.push("return this.data["+z+"]}"),O.push("proto.index=function "+u+"_index(",p.join(),"){return "+z+"}"),O.push("proto.hi=function "+u+"_hi("+p.join(",")+"){return new "+u+"(this.data,"+r.map((function(mm){return["(typeof i",mm,"!=='number'||i",mm,"<0)?this.shape[",mm,"]:i",mm,"|0"].join("")})).join(",")+","+r.map((function(mm){return"this.stride["+mm+"]"})).join(",")+",this.offset)}");var x=r.map((function(mm){return"a"+mm+"=this.shape["+mm+"]"})),H=r.map((function(mm){return"c"+mm+"=this.stride["+mm+"]"}));O.push("proto.lo=function "+u+"_lo("+p.join(",")+"){var b=this.offset,d=0,"+x.join(",")+","+H.join(","));for(var E=0;E<o;++E)O.push("if(typeof i"+E+"==='number'&&i"+E+">=0){d=i"+E+"|0;b+=c"+E+"*d;a"+E+"-=d}");O.push("return new "+u+"(this.data,"+r.map((function(mm){return"a"+mm})).join(",")+","+r.map((function(mm){return"c"+mm})).join(",")+",b)}"),O.push("proto.step=function "+u+"_step("+p.join(",")+"){var "+r.map((function(mm){return"a"+mm+"=this.shape["+mm+"]"})).join(",")+","+r.map((function(mm){return"b"+mm+"=this.stride["+mm+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(E=0;E<o;++E)O.push("if(typeof i"+E+"==='number'){d=i"+E+"|0;if(d<0){c+=b"+E+"*(a"+E+"-1);a"+E+"=ceil(-a"+E+"/d)}else{a"+E+"=ceil(a"+E+"/d)}b"+E+"*=d}");O.push("return new "+u+"(this.data,"+r.map((function(mm){return"a"+mm})).join(",")+","+r.map((function(mm){return"b"+mm})).join(",")+",c)}");var M=new Array(o),l=new Array(o);for(E=0;E<o;++E)M[E]="a[i"+E+"]",l[E]="b[i"+E+"]";O.push("proto.transpose=function "+u+"_transpose("+p+"){"+p.map((function(mm,o){return mm+"=("+mm+"===undefined?"+o+":"+mm+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+u+"(this.data,"+M.join(",")+","+l.join(",")+",this.offset)}"),O.push("proto.pick=function "+u+"_pick("+p+"){var a=[],b=[],c=this.offset");for(E=0;E<o;++E)O.push("if(typeof i"+E+"==='number'&&i"+E+">=0){c=(c+this.stride["+E+"]*i"+E+")|0}else{a.push(this.shape["+E+"]);b.push(this.stride["+E+"])}");return O.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),O.push("return function construct_"+u+"(data,shape,stride,offset){return new "+u+"(data,"+r.map((function(mm){return"shape["+mm+"]"})).join(",")+","+r.map((function(mm){return"stride["+mm+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",O.join("\n"))(K[mm],w)}var K={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};mm.exports=function(mm,o,u,f){if(void 0===mm)return(0,K.array[0])([]);"number"===typeof mm&&(mm=[mm]),void 0===o&&(o=[mm.length]);var r=o.length;if(void 0===u){u=new Array(r);for(var w=r-1,z=1;w>=0;--w)u[w]=z,z*=o[w]}if(void 0===f){f=0;for(w=0;w<r;++w)u[w]<0&&(f-=(o[w]-1)*u[w])}for(var Y=function(mm){if(B(mm))return"buffer";if(O)switch(Object.prototype.toString.call(mm)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(mm)?"array":"generic"}(mm),q=K[Y];q.length<=r+1;)q.push(p(Y,q.length-1));return(0,q[r+1])(mm,o,u,f)}},14413:mm=>{function o(mm){return!!mm.constructor&&"function"===typeof mm.constructor.isBuffer&&mm.constructor.isBuffer(mm)}mm.exports=function(mm){return null!=mm&&(o(mm)||function(mm){return"function"===typeof mm.readFloatLE&&"function"===typeof mm.slice&&o(mm.slice(0,0))}(mm)||!!mm._isBuffer)}},14559:mm=>{"use strict";var o=[],u=[],f=[],B=[],O=[],r=[],w=[],p=[],K=[],z=[],Y=[],q=[];mm.exports=function(mm,x,H,E,M,l){for(var t=w,Q=K,b=z,J=q,N=0;N<3;N++)t[N]=+H[N],b[N]=+x.max[N],Q[N]=+x.base[N];l||(l=1e-10);var S=function(mm,w,K,z,q,x){var H=o,E=u,M=f,l=B,t=O,Q=r,b=p,J=Math.floor,N=0,S=0,P=0,R=0,g=0;if(W(),0===P)return 0;for(R=A();S<=P;){if(F(R)&&c())return N;R=A()}for(N+=P,g=0;g<3;g++)z[g]+=K[g],q[g]+=K[g];return N;function W(){if(S=0,0!==(P=Math.sqrt(K[0]*K[0]+K[1]*K[1]+K[2]*K[2])))for(var mm=0;mm<3;mm++){var o=K[mm]>=0;l[mm]=o?1:-1;var u=o?q[mm]:z[mm];H[mm]=o?z[mm]:q[mm],E[mm]=y(u,l[mm]),M[mm]=I(H[mm],l[mm]),b[mm]=K[mm]/P,t[mm]=Math.abs(1/b[mm]);var f=o?E[mm]+1-u:u-E[mm];Q[mm]=t[mm]<1/0?t[mm]*f:1/0}}function F(o){for(var u=l[0],f=0===o?E[0]:M[0],B=E[0]+u,O=l[1],r=1===o?E[1]:M[1],w=E[1]+O,p=l[2],K=2===o?E[2]:M[2],z=E[2]+p,Y=f;Y!=B;Y+=u)for(var q=r;q!=w;q+=O)for(var x=K;x!=z;x+=p)if(mm(Y,q,x))return!0;return!1}function c(){N+=S;var mm=l[R],o=S/P,u=Y;for(g=0;g<3;g++){var f=K[g]*o;z[g]+=f,q[g]+=f,u[g]=K[g]-f}if(mm>0?q[R]=Math.round(q[R]):z[R]=Math.round(z[R]),w(N,R,mm,u))return!0;for(g=0;g<3;g++)K[g]=u[g];return W(),0===P}function A(){var mm=Q[0]<Q[1]?Q[0]<Q[2]?0:2:Q[1]<Q[2]?1:2,o=Q[mm]-S;for(S=Q[mm],E[mm]+=l[mm],Q[mm]+=t[mm],g=0;g<3;g++)H[g]+=o*b[g],M[g]=I(H[g],l[g]);return mm}function y(mm,o){return J(mm-o*x)}function I(mm,o){return J(mm+o*x)}}(mm,E,t,Q,b,l);if(!M){for(N=0;N<3;N++)J[N]=H[N]>0?b[N]-x.max[N]:Q[N]-x.base[N];x.translate(J)}return S}},14873:(mm,o,u)=>{"use strict";u.d(o,{b:()=>Y});var f=u(14551),B=u(13500);class O{constructor(mm,o,u,O,r,w,p){this.Jz=new f(mm.base,mm.Gz),this.Rf=o,this.friction=u,this.restitution=O,this.Rw=r,this.pH=w,this.gw=!!p,this.Xz=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.UH=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.GK=B.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=B.create(),this._impulses=B.create(),this._sleepFrameCount=10}loadFromCopy(mm){B.i(this.Jz.base,mm.Jz.base),B.i(this.Jz.Gz,mm.Jz.Gz),B.i(this.Jz.max,mm.Jz.max),this.Jz.mag=mm.Jz.mag,this.Rf=mm.Rf,this.friction=mm.friction,this.restitution=mm.restitution,this.Rw=mm.Rw,this.pH=mm.pH,this.gw=mm.gw,this.Xz=mm.Xz,this.fluidDrag=mm.fluidDrag,this.UH=mm.UH,this.preventFallOffEdge=mm.preventFallOffEdge,this.rolledBackLastTick=mm.rolledBackLastTick,B.i(this.GK,mm.GK),B.i(this.resting,mm.resting),this.inFluid=mm.inFluid,this._ratioInFluid=mm._ratioInFluid,B.i(this._forces,mm._forces),B.i(this._impulses,mm._impulses),this._sleepFrameCount=mm._sleepFrameCount}setPosition(mm){r(mm),B.Qo(mm,mm,this.Jz.base),this.Jz.translate(mm),this.kK()}wf(){return B.clone(this.Jz.base)}applyForce(mm){r(mm),B.add(this._forces,this._forces,mm),this.kK()}applyImpulse(mm){r(mm),B.add(this._impulses,this._impulses,mm),this.kK()}kK(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var r=mm=>{};var w=u(14551),p=u(13500),K=u(14559);function z(){this.Xz=.1,this.fluidDrag=.4,this.yw=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function Y(mm,o,u){mm=Object.assign(new z,mm),this.gravity=mm.gravity||[0,-10,0],this.Xz=mm.Xz||.1,this.yw=mm.yw||2,this.fluidDrag=mm.fluidDrag||.4,this.minBounceImpulse=mm.minBounceImpulse,this.bodies=[],this.gx=mm.gx,this.testSolid=o,this.testFluid=u}Y.prototype.EH=function(mm,o,u,f,B,r){mm=mm||new w([0,0,0],[1,1,1]),"undefined"==typeof o&&(o=1),"undefined"==typeof u&&(u=1),"undefined"==typeof f&&(f=0),"undefined"==typeof B&&(B=1);var p=new O(mm,o,u,f,B,r);return this.bodies.push(p),p},Y.prototype.MH=function(mm){var o=this.bodies.indexOf(mm);o<0||(this.bodies.splice(o,1),mm.Jz=mm.pH=null)};var q=p.create(),x=p.create(),H=p.create(),E=p.create(),M=p.create(),l=p.create(),t=p.create(),Q=new w([0,0,0],[1,1,1]),b=new O(Q,1,1,0,1,(()=>{}),!1);function J(mm,o,u){return o=u,o*=1-(1-mm.ratioInFluid)**2}Y.prototype.fp=function(mm){mm/=1e3;var o=G(0,p.squaredLength(this.gravity));this.bodies.forEach((u=>function(mm,o,u,f){p.i(M,o.resting),mm.gx&&b.loadFromCopy(o);if(o.Rf<=0)return p.set(o.GK,0,0,0),p.set(o._forces,0,0,0),void p.set(o._impulses,0,0,0);var B=f||0===o.Rw;if(function(mm,o,u,f){if(o._sleepFrameCount>0)return!1;if(f)return!0;var B=!1,O=.5*u*u*o.Rw;return p.scale(X,mm.gravity,O),K(mm.testSolid,o.Jz,X,(function(){return B=!0,!0}),!0),B}(mm,o,u,B))return;o._sleepFrameCount--,function(mm,o){var u=o.Jz,f=Math.floor(u.base[0]),B=Math.floor(u.base[2]),O=Math.floor(u.base[1]),r=Math.floor(u.max[1]);if(!mm.testFluid(f,O,B))return o.inFluid=!1,void(o.ratioInFluid=0);var w=1,K=O+1;for(;K<=r&&mm.testFluid(f,K,B);)w++,K++;var z=(O+w-u.base[1])/u.Gz[1];z>1&&(z=1);var Y=u.Gz[0]*u.Gz[1]*u.Gz[2]*z,q=S;p.scale(q,mm.gravity,-mm.yw*Y*o.Rw),o.applyForce(q),o.inFluid=!0,o.ratioInFluid=z}(mm,o),d(o._forces),d(o._impulses),d(o.GK),d(o.resting),p.scale(q,o._forces,1/o.Rf),p.hw(q,q,mm.gravity,o.Rw),p.scale(x,o._impulses,1/o.Rf),p.hw(x,x,q,u),p.add(o.GK,o.GK,x),o.friction&&(P(mm,0,o,x,u),P(mm,1,o,x,u),P(mm,2,o,x,u));var O=o.fluidDrag>=0?o.fluidDrag:mm.fluidDrag,r=o.Xz>=0?o.Xz:mm.Xz,w=r,z=r;o.inFluid&&(w=J(o,w,o.fluidDragHoriz>=0?o.fluidDragHoriz:O),z=J(o,z,o.fluidDragVert>=0?o.fluidDragVert:O));w=Math.max(1-w*u/o.Rf,0),z=Math.max(1-z*u/o.Rf,0),p.set(N,w,z,w),p.multiply(o.GK,o.GK,N),p.scale(H,o.GK,u),p.set(o._forces,0,0,0),p.set(o._impulses,0,0,0),o.gw&&k(W,o.Jz);p.i(l,H),p.set(t,0,0,0),o.preventFallOffEdge&&function(mm,o,u,f){if(!o.resting[1]||u[1]>0)return;var B=s;k(B,o.Jz);for(var O=0;O<3;O+=2){p.set(I,0,0,0),I[O]=u[O];var r=!0;(r=(r=(r=(r=r&&!a(mm,B.base[0]+I[0]+1e-5,B.base[1],B.base[2]+I[2]+1e-5))&&!a(mm,B.max[0]+I[0]-1e-5,B.base[1],B.base[2]+I[2]+1e-5))&&!a(mm,B.base[0]+I[0]+1e-5,B.base[1],B.max[2]+I[2]-1e-5))&&!a(mm,B.max[0]+I[0]-1e-5,B.base[1],B.max[2]+I[2]-1e-5))?(f[O]=u[O]>0?1:-1,u[O]=0):0===O&&(p.set(j,u[0],0,0),g(mm,B,j,f,o.slideOnCollision))}}(mm,o,H,t);g(mm,o.Jz,H,o.resting,o.slideOnCollision),o.gw&&function(mm,o,u,f){if(o.resting[1]>=0&&!o.inFluid)return;var B=0!==o.resting[0],O=0!==o.resting[2];if(!B&&!O)return;var r=Math.abs(f[0]/f[2]),w=4;if(!B&&r>w)return;if(!O&&r<1/w)return;p.add(c,u.base,f);var z=mm.testSolid;K(z,u,f,(function(mm,o,u,f){if(1!==o)return!0;f[o]=0}));var Y=u.base[1],q=o.inFluid?1.951:1.001,x=Math.floor(Y+q)-Y;p.set(A,0,x,0);var H=!1;if(K(z,u,A,(function(mm,o,u,f){return H=!0,!0})),H)return;p.Qo(y,c,u.base),y[1]=0,g(mm,u,y,F,!0);var E=G(u.base[0],c[0]),M=G(u.base[2],c[2]);if(B&&!E&&(!M||!O))return;if(O&&(!E||!B)&&!M)return;var l=!0;if(l=l&&!a(mm,u.base[0]+1e-5,u.base[1],u.base[2]+1e-5),l=l&&!a(mm,u.max[0]-1e-5,u.base[1],u.base[2]+1e-5),l=l&&!a(mm,u.base[0]+1e-5,u.base[1],u.max[2]-1e-5),l=l&&!a(mm,u.max[0]-1e-5,u.base[1],u.max[2]-1e-5),l)return;k(o.Jz,u),o.resting[0]=F[0],o.resting[2]=F[2],o.UH&&o.UH()}(mm,o,W,l);for(var Y=0;Y<3;++Y)o.resting[Y]=o.resting[Y]||t[Y],E[Y]=0,o.resting[Y]&&(M[Y]||(E[Y]=-o.GK[Y]),o.GK[Y]=0);var Q=p.length(E);Q>.001&&(p.scale(E,E,o.Rf),o.pH&&o.pH(E),o.restitution>0&&Q>mm.minBounceImpulse&&(p.scale(E,E,o.restitution),o.applyImpulse(E)));var R=p.squaredLength(o.GK);R>1e-5&&o.kK();mm.gx&&mm.gx(o)?(o.loadFromCopy(b),o.rolledBackLastTick=!0):o.rolledBackLastTick=!1}(this,u,mm,o)))};var N=p.create([0,0,0]);var S=p.create();function P(mm,o,u,f,B){var O=u.resting[o],r=f[o];if(!u.alwaysApplyHorizFriction||1!==o){if(0===O)return;if(O*r<=0)return}p.i(R,u.GK),R[o]=0;var w=p.length(R);if(!G(w,0)){var K=Math.abs(u.friction*mm.gravity[o]*B),z=w>K?(w-K)/w:0;u.GK[(o+1)%3]*=z,u.GK[(o+2)%3]*=z}}var R=p.create();function g(mm,o,u,f,B){return p.set(f,0,0,0),K(mm.testSolid,o,u,(function(mm,o,u,O){f[o]=u,O[o]=0,B||(O[0]=0,O[1]=0,O[2]=0)}))}var W=new w([],[]),F=p.create(),c=p.create(),A=p.create(),y=p.create();var I=p.create(),s=new w([],[]),j=p.create();function a(mm,o,u,f){return mm.testSolid(Math.floor(o),Math.floor(u-1),Math.floor(f))}var X=p.create();function G(mm,o){return Math.abs(mm-o)<1e-5}function k(mm,o){for(var u=0;u<3;u++)mm.base[u]=o.base[u],mm.max[u]=o.max[u],mm.Gz[u]=o.Gz[u]}var d=function(mm){}},13390:function(mm,o){!function(mm){"use strict";var o=function(mm,u){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(mm,o){mm.__proto__=o}||function(mm,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(mm[u]=o[u])},o(mm,u)};function u(mm,u){if("function"!==typeof u&&null!==u)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");function f(){this.constructor=mm}o(mm,u),mm.prototype=null===u?Object.create(u):(f.prototype=u.prototype,new f)}function f(mm,o,u,f){var B,O=arguments.length,r=O<3?o:null===f?f=Object.getOwnPropertyDescriptor(o,u):f;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)r=Reflect.decorate(mm,o,u,f);else for(var w=mm.length-1;w>=0;w--)(B=mm[w])&&(r=(O<3?B(r):O>3?B(o,u,r):B(o,u))||r);return O>3&&r&&Object.defineProperty(o,u,r),r}function B(mm,o,u){if(u||2===arguments.length)for(var f,B=0,O=o.length;B<O;B++)!f&&B in o||(f||(f=Array.prototype.slice.call(o,0,B)),f[B]=o[B]);return mm.concat(f||Array.prototype.slice.call(o))}var O,r=255,w=213;mm.OPERATION=void 0,(O=mm.OPERATION||(mm.OPERATION={}))[O.ADD=128]="ADD",O[O.REPLACE=0]="REPLACE",O[O.DELETE=64]="DELETE",O[O.DELETE_AND_ADD=192]="DELETE_AND_ADD",O[O.TOUCH=1]="TOUCH",O[O.CLEAR=10]="CLEAR";var p=function(){function o(mm,o,u){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=mm,this.setParent(o,u)}return o.prototype.setParent=function(mm,o,u){var f=this;if(this.indexes||(this.indexes=this.ref instanceof ym?this.ref._definition.indexes:{}),this.parent=mm,this.parentIndex=u,o)if(this.root=o,this.ref instanceof ym){var B=this.ref._definition;for(var O in B.schema){var r=this.ref[O];if(r&&r.$changes){var w=B.indexes[O];r.$changes.setParent(this.ref,o,w)}}}else"object"===typeof this.ref&&this.ref.forEach((function(mm,o){if(mm instanceof ym){var u=mm.$changes,B=f.ref.$changes.indexes[o];u.setParent(f.ref,f.root,B)}}))},o.prototype.operation=function(mm){this.changes.set(--this.currentCustomOperation,mm)},o.prototype.change=function(o,u){void 0===u&&(u=mm.OPERATION.ADD);var f="number"===typeof o?o:this.indexes[o];this.assertValidIndex(f,o);var B=this.changes.get(f);B&&B.op!==mm.OPERATION.DELETE&&B.op!==mm.OPERATION.TOUCH||this.changes.set(f,{op:B&&B.op===mm.OPERATION.DELETE?mm.OPERATION.DELETE_AND_ADD:u,index:f}),this.allChanges.add(f),this.changed=!0,this.touchParents()},o.prototype.touch=function(o){var u="number"===typeof o?o:this.indexes[o];this.assertValidIndex(u,o),this.changes.has(u)||this.changes.set(u,{op:mm.OPERATION.TOUCH,index:u}),this.allChanges.add(u),this.touchParents()},o.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},o.prototype.getType=function(mm){if(this.ref._definition)return(o=this.ref._definition).schema[o.fieldsByIndex[mm]];var o,u=(o=this.parent._definition).schema[o.fieldsByIndex[this.parentIndex]];return Object.values(u)[0]},o.prototype.getChildrenFilter=function(){var mm=this.parent._definition.childFilters;return mm&&mm[this.parentIndex]},o.prototype.getValue=function(mm){return this.ref.getByIndex(mm)},o.prototype.delete=function(o){var u="number"===typeof o?o:this.indexes[o];if(void 0!==u){var f=this.getValue(u);this.changes.set(u,{op:mm.OPERATION.DELETE,index:u}),this.allChanges.delete(u),delete this.caches[u],f&&f.$changes&&(f.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(o," (").concat(u,")"))},o.prototype.discard=function(o,u){var f=this;void 0===o&&(o=!1),void 0===u&&(u=!1),this.ref instanceof ym||this.changes.forEach((function(o){if(o.op===mm.OPERATION.DELETE){var u=f.ref.getIndex(o.index);delete f.indexes[u]}})),this.changes.clear(),this.changed=o,u&&this.allChanges.clear(),this.currentCustomOperation=0},o.prototype.discardAll=function(){var mm=this;this.changes.forEach((function(o){var u=mm.getValue(o.index);u&&u.$changes&&u.$changes.discardAll()})),this.discard()},o.prototype.cache=function(mm,o){this.caches[mm]=o},o.prototype.clone=function(){return new o(this.ref,this.parent,this.root)},o.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},o.prototype.assertValidIndex=function(mm,o){if(void 0===mm)throw new Error('ChangeTree: missing index for field "'.concat(o,'"'))},o}();function K(mm,o,u,f){return mm[o]||(mm[o]=[]),mm[o].push(u),null===f||void 0===f||f.forEach((function(mm,o){return u(mm,o)})),function(){return Y(mm[o],mm[o].indexOf(u))}}function z(o){var u=this,f="string"!==typeof this.$changes.getType();this.$items.forEach((function(B,O){o.push({refId:u.$changes.refId,op:mm.OPERATION.DELETE,field:O,value:void 0,previousValue:B}),f&&u.$changes.root.removeRef(B.$changes.refId)}))}function Y(mm,o){if(-1===o||o>=mm.length)return!1;for(var u=mm.length-1,f=o;f<u;f++)mm[f]=mm[f+1];return mm.length=u,!0}var q=function(mm,o){var u=mm.toString(),f=o.toString();return u<f?-1:u>f?1:0};function x(mm){return mm.$proxy=!0,mm=new Proxy(mm,{get:function(mm,o){return"symbol"===typeof o||isNaN(o)?mm[o]:mm.at(o)},set:function(mm,o,u){if("symbol"===typeof o||isNaN(o))mm[o]=u;else{var f=Array.from(mm.$items.keys()),B=parseInt(f[o]||o);void 0===u||null===u?mm.deleteAt(B):mm.setAt(B,u)}return!0},deleteProperty:function(mm,o){return"number"===typeof o?mm.deleteAt(o):delete mm[o],!0}})}var H=function(){function o(){for(var mm=[],o=0;o<arguments.length;o++)mm[o]=arguments[o];this.$changes=new p(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,mm)}return o.prototype.Qp=function(o,u){return void 0===u&&(u=!0),K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.ADD,o,u?this.$items:void 0)},o.prototype.ff=function(o){return K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.DELETE,o)},o.prototype.onChange=function(o){return K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.REPLACE,o)},o.is=function(mm){return Array.isArray(mm)||void 0!==mm.array},Object.defineProperty(o.prototype,"length",{get:function(){return this.$items.size},set:function(mm){0===mm?this.clear():this.splice(mm,this.length-mm)},enumerable:!1,configurable:!0}),o.prototype.push=function(){for(var mm,o=this,u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];return u.forEach((function(u){mm=o.$refId++,o.setAt(mm,u)})),mm},o.prototype.pop=function(){var mm=Array.from(this.$indexes.values()).pop();if(void 0!==mm){this.$changes.delete(mm),this.$indexes.delete(mm);var o=this.$items.get(mm);return this.$items.delete(mm),o}},o.prototype.at=function(mm){var o=Array.from(this.$items.keys())[mm];return this.$items.get(o)},o.prototype.setAt=function(o,u){var f,B;if(void 0!==u&&null!==u){if(this.$items.get(o)!==u){void 0!==u.$changes&&u.$changes.setParent(this,this.$changes.root,o);var O=null!==(B=null===(f=this.$changes.indexes[o])||void 0===f?void 0:f.op)&&void 0!==B?B:mm.OPERATION.ADD;this.$changes.indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,u),this.$changes.change(o,O)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},o.prototype.deleteAt=function(mm){var o=Array.from(this.$items.keys())[mm];return void 0!==o&&this.$deleteAt(o)},o.prototype.$deleteAt=function(mm){return this.$changes.delete(mm),this.$indexes.delete(mm),this.$items.delete(mm)},o.prototype.clear=function(o){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&z.call(this,o),this.$items.clear(),this.$changes.operation({index:0,op:mm.OPERATION.CLEAR}),this.$changes.touchParents()},o.prototype.concat=function(){for(var mm,u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];return new(o.bind.apply(o,B([void 0],(mm=Array.from(this.$items.values())).concat.apply(mm,u),!1)))},o.prototype.join=function(mm){return Array.from(this.$items.values()).join(mm)},o.prototype.reverse=function(){var mm=this,o=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(u,f){mm.setAt(o[f],u)})),this},o.prototype.shift=function(){var mm=Array.from(this.$items.keys()).shift();if(void 0!==mm){var o=this.$items.get(mm);return this.$deleteAt(mm),o}},o.prototype.slice=function(mm,u){var f=new o;return f.push.apply(f,Array.from(this.$items.values()).slice(mm,u)),f},o.prototype.sort=function(mm){var o=this;void 0===mm&&(mm=q);var u=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(mm).forEach((function(mm,f){o.setAt(u[f],mm)})),this},o.prototype.splice=function(mm,o){void 0===o&&(o=this.length-mm);for(var u=Array.from(this.$items.keys()),f=[],B=mm;B<mm+o;B++)f.push(this.$items.get(u[B])),this.$deleteAt(u[B]);return f},o.prototype.unshift=function(){for(var mm=this,o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];var f=this.length,B=o.length,O=Array.from(this.$items.values());return o.forEach((function(o,u){mm.setAt(u,o)})),O.forEach((function(o,u){mm.setAt(B+u,o)})),f+B},o.prototype.indexOf=function(mm,o){return Array.from(this.$items.values()).indexOf(mm,o)},o.prototype.lastIndexOf=function(mm,o){return void 0===o&&(o=this.length-1),Array.from(this.$items.values()).lastIndexOf(mm,o)},o.prototype.every=function(mm,o){return Array.from(this.$items.values()).every(mm,o)},o.prototype.some=function(mm,o){return Array.from(this.$items.values()).some(mm,o)},o.prototype.forEach=function(mm,o){Array.from(this.$items.values()).forEach(mm,o)},o.prototype.map=function(mm,o){return Array.from(this.$items.values()).map(mm,o)},o.prototype.filter=function(mm,o){return Array.from(this.$items.values()).filter(mm,o)},o.prototype.reduce=function(mm,o){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},o.prototype.reduceRight=function(mm,o){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},o.prototype.find=function(mm,o){return Array.from(this.$items.values()).find(mm,o)},o.prototype.findIndex=function(mm,o){return Array.from(this.$items.values()).findIndex(mm,o)},o.prototype.fill=function(mm,o,u){throw new Error("ArraySchema#fill() not implemented")},o.prototype.copyWithin=function(mm,o,u){throw new Error("ArraySchema#copyWithin() not implemented")},o.prototype.toString=function(){return this.$items.toString()},o.prototype.toLocaleString=function(){return this.$items.toLocaleString()},o.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(o,Symbol.species,{get:function(){return o},enumerable:!1,configurable:!0}),o.prototype.entries=function(){return this.$items.entries()},o.prototype.keys=function(){return this.$items.keys()},o.prototype.values=function(){return this.$items.values()},o.prototype.includes=function(mm,o){return Array.from(this.$items.values()).includes(mm,o)},o.prototype.flatMap=function(mm,o){throw new Error("ArraySchema#flatMap() is not supported.")},o.prototype.flat=function(mm){throw new Error("ArraySchema#flat() is not supported.")},o.prototype.findLast=function(){var mm=Array.from(this.$items.values());return mm.findLast.apply(mm,arguments)},o.prototype.findLastIndex=function(){var mm=Array.from(this.$items.values());return mm.findLastIndex.apply(mm,arguments)},o.prototype.setIndex=function(mm,o){this.$indexes.set(mm,o)},o.prototype.getIndex=function(mm){return this.$indexes.get(mm)},o.prototype.getByIndex=function(mm){return this.$items.get(this.$indexes.get(mm))},o.prototype.deleteByIndex=function(mm){var o=this.$indexes.get(mm);this.$items.delete(o),this.$indexes.delete(mm)},o.prototype.toArray=function(){return Array.from(this.$items.values())},o.prototype.toJSON=function(){return this.toArray().map((function(mm){return"function"===typeof mm.toJSON?mm.toJSON():mm}))},o.prototype.clone=function(mm){return mm?new(o.bind.apply(o,B([void 0],Array.from(this.$items.values()),!1))):new(o.bind.apply(o,B([void 0],this.map((function(mm){return mm.$changes?mm.clone():mm})),!1)))},o}();function E(mm){return mm.$proxy=!0,mm=new Proxy(mm,{get:function(mm,o){return"symbol"!==typeof o&&"undefined"===typeof mm[o]?mm.get(o):mm[o]},set:function(mm,o,u){return"symbol"!==typeof o&&-1===o.indexOf("$")&&"Qp"!==o&&"ff"!==o&&"onChange"!==o?mm.set(o,u):mm[o]=u,!0},deleteProperty:function(mm,o){return mm.delete(o),!0}})}var M=function(){function o(mm){var u=this;if(this.$changes=new p(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,mm)if(mm instanceof Map||mm instanceof o)mm.forEach((function(mm,o){return u.set(o,mm)}));else for(var f in mm)this.set(f,mm[f])}return o.prototype.Qp=function(o,u){return void 0===u&&(u=!0),K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.ADD,o,u?this.$items:void 0)},o.prototype.ff=function(o){return K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.DELETE,o)},o.prototype.onChange=function(o){return K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.REPLACE,o)},o.is=function(mm){return void 0!==mm.map},o.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(o.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(o,Symbol.species,{get:function(){return o},enumerable:!1,configurable:!0}),o.prototype.set=function(o,u){if(void 0===u||null===u)throw new Error("MapSchema#set('".concat(o,"', ").concat(u,"): trying to set ").concat(u," value on '").concat(o,"'."));o=o.toString();var f="undefined"!==typeof this.$changes.indexes[o],B=f?this.$changes.indexes[o]:this.$refId++,O=f?mm.OPERATION.REPLACE:mm.OPERATION.ADD,r=void 0!==u.$changes;if(r&&u.$changes.setParent(this,this.$changes.root,B),f){if(!r&&this.$items.get(o)===u)return;r&&this.$items.get(o)!==u&&(O=mm.OPERATION.ADD)}else this.$changes.indexes[o]=B,this.$indexes.set(B,o);return this.$items.set(o,u),this.$changes.change(o,O),this},o.prototype.get=function(mm){return this.$items.get(mm)},o.prototype.delete=function(mm){return this.$changes.delete(mm),this.$items.delete(mm)},o.prototype.clear=function(o){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&z.call(this,o),this.$items.clear(),this.$changes.operation({index:0,op:mm.OPERATION.CLEAR}),this.$changes.touchParents()},o.prototype.has=function(mm){return this.$items.has(mm)},o.prototype.forEach=function(mm){this.$items.forEach(mm)},o.prototype.entries=function(){return this.$items.entries()},o.prototype.keys=function(){return this.$items.keys()},o.prototype.values=function(){return this.$items.values()},Object.defineProperty(o.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),o.prototype.setIndex=function(mm,o){this.$indexes.set(mm,o)},o.prototype.getIndex=function(mm){return this.$indexes.get(mm)},o.prototype.getByIndex=function(mm){return this.$items.get(this.$indexes.get(mm))},o.prototype.deleteByIndex=function(mm){var o=this.$indexes.get(mm);this.$items.delete(o),this.$indexes.delete(mm)},o.prototype.toJSON=function(){var mm={};return this.forEach((function(o,u){mm[u]="function"===typeof o.toJSON?o.toJSON():o})),mm},o.prototype.clone=function(mm){var u;return mm?u=Object.assign(new o,this):(u=new o,this.forEach((function(mm,o){mm.$changes?u.set(o,mm.clone()):u.set(o,mm)}))),u},o}(),l={};function t(mm,o){l[mm]=o}function Q(mm){return l[mm]}var b=function(){function mm(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return mm.create=function(o){var u=new mm;return u.schema=Object.assign({},o&&o.schema||{}),u.indexes=Object.assign({},o&&o.indexes||{}),u.fieldsByIndex=Object.assign({},o&&o.fieldsByIndex||{}),u.descriptors=Object.assign({},o&&o.descriptors||{}),u.deprecated=Object.assign({},o&&o.deprecated||{}),u},mm.prototype.addField=function(mm,o){var u=this.getNextFieldIndex();this.fieldsByIndex[u]=mm,this.indexes[mm]=u,this.schema[mm]=Array.isArray(o)?{array:o[0]}:o},mm.prototype.hasField=function(mm){return void 0!==this.indexes[mm]},mm.prototype.addFilter=function(mm,o){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[mm]]=o,this.indexesWithFilters.push(this.indexes[mm]),!0},mm.prototype.addChildrenFilter=function(mm,o){var u=this.indexes[mm],f=this.schema[mm];if(Q(Object.keys(f)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[u]=o,!0;console.warn("@filterChildren: field '".concat(mm,"' can't have children. Ignoring filter."))},mm.prototype.getChildrenFilter=function(mm){return this.childFilters&&this.childFilters[this.indexes[mm]]},mm.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},mm}();function J(mm){return mm._context&&mm._context.useFilters}var N=function(){function mm(){this.types={},this.schemas=new Map,this.useFilters=!1}return mm.prototype.has=function(mm){return this.schemas.has(mm)},mm.prototype.get=function(mm){return this.types[mm]},mm.prototype.add=function(mm,o){void 0===o&&(o=this.schemas.size),mm._definition=b.create(mm._definition),mm._typeid=o,this.types[o]=mm,this.schemas.set(mm,o)},mm.create=function(o){return void 0===o&&(o={}),function(u){return o.context||(o.context=new mm),P(u,o)}},mm}(),S=new N;function P(mm,o){return void 0===o&&(o={}),function(u,f){var O=o.context||S,r=u.constructor;if(r._context=O,!mm)throw new Error("".concat(r.name,': @type() reference provided for "').concat(f,"\" is undefined. Make sure you don't have any circular dependencies."));O.has(r)||O.add(r);var w=r._definition;if(w.addField(f,mm),w.descriptors[f]){if(w.deprecated[f])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(f,"' definition on '").concat(r.name,"'.\nCheck @type() annotation"))}catch(l){var p=l.stack.split("\n")[4].trim();throw new Error("".concat(l.message," ").concat(p))}}var K=H.is(mm),z=!K&&M.is(mm);if("string"!==typeof mm&&!ym.is(mm)){var Y=Object.values(mm)[0];"string"===typeof Y||O.has(Y)||O.add(Y)}if(o.manual)w.descriptors[f]={enumerable:!0,configurable:!0,writable:!0};else{var q="_".concat(f);w.descriptors[q]={enumerable:!1,configurable:!1,writable:!0},w.descriptors[f]={get:function(){return this[q]},set:function(mm){mm!==this[q]&&(void 0!==mm&&null!==mm?(!K||mm instanceof H||(mm=new(H.bind.apply(H,B([void 0],mm,!1)))),!z||mm instanceof M||(mm=new M(mm)),void 0===mm.$proxy&&(z?mm=E(mm):K&&(mm=x(mm))),this.$changes.change(f),mm.$changes&&mm.$changes.setParent(this,this.$changes.root,this._definition.indexes[f])):this[q]&&this.$changes.delete(f),this[q]=mm)},enumerable:!0,configurable:!0}}}}function R(mm){return function(o,u){var f=o.constructor;f._definition.addFilter(u,mm)&&(f._context.useFilters=!0)}}function g(mm){return function(o,u){var f=o.constructor;f._definition.addChildrenFilter(u,mm)&&(f._context.useFilters=!0)}}function W(mm){return void 0===mm&&(mm=!0),function(o,u){var f=o.constructor._definition;f.deprecated[u]=!0,mm&&(f.descriptors[u]={get:function(){throw new Error("".concat(u," is deprecated."))},set:function(mm){},enumerable:!1,configurable:!0})}}function F(mm,o,u){for(var f in void 0===u&&(u={}),u.context||(u.context=mm._context||u.context||S),o)P(o[f],u)(mm.prototype,f);return mm}function c(mm){for(var o=0,u=0,f=0,B=mm.length;f<B;f++)(o=mm.charCodeAt(f))<128?u+=1:o<2048?u+=2:o<55296||o>=57344?u+=3:(f++,u+=4);return u}function A(mm,o,u){for(var f=0,B=0,O=u.length;B<O;B++)(f=u.charCodeAt(B))<128?mm[o++]=f:f<2048?(mm[o++]=192|f>>6,mm[o++]=128|63&f):f<55296||f>=57344?(mm[o++]=224|f>>12,mm[o++]=128|f>>6&63,mm[o++]=128|63&f):(B++,f=65536+((1023&f)<<10|1023&u.charCodeAt(B)),mm[o++]=240|f>>18,mm[o++]=128|f>>12&63,mm[o++]=128|f>>6&63,mm[o++]=128|63&f)}function y(mm,o){mm.push(255&o)}function I(mm,o){mm.push(255&o)}function s(mm,o){mm.push(255&o),mm.push(o>>8&255)}function j(mm,o){mm.push(255&o),mm.push(o>>8&255)}function a(mm,o){mm.push(255&o),mm.push(o>>8&255),mm.push(o>>16&255),mm.push(o>>24&255)}function X(mm,o){var u=o>>24,f=o>>16,B=o>>8,O=o;mm.push(255&O),mm.push(255&B),mm.push(255&f),mm.push(255&u)}function G(mm,o){var u=Math.floor(o/Math.pow(2,32));X(mm,o>>>0),X(mm,u)}function k(mm,o){var u=o/Math.pow(2,32)|0;X(mm,o>>>0),X(mm,u)}function d(mm,o){V(mm,o)}function e(mm,o){n(mm,o)}var L=new Int32Array(2),C=new Float32Array(L.buffer),v=new Float64Array(L.buffer);function V(mm,o){C[0]=o,a(mm,L[0])}function n(mm,o){v[0]=o,a(mm,L[0]),a(mm,L[1])}function U(mm,o){return I(mm,o?1:0)}function h(mm,o){o||(o="");var u=c(o),f=0;if(u<32)mm.push(160|u),f=1;else if(u<256)mm.push(217),I(mm,u),f=2;else if(u<65536)mm.push(218),j(mm,u),f=3;else{if(!(u<4294967296))throw new Error("String too long");mm.push(219),X(mm,u),f=5}return A(mm,mm.length,o),f+u}function Z(mm,o){return isNaN(o)?Z(mm,0):isFinite(o)?o!==(0|o)?(mm.push(203),n(mm,o),9):o>=0?o<128?(I(mm,o),1):o<256?(mm.push(204),I(mm,o),2):o<65536?(mm.push(205),j(mm,o),3):o<4294967296?(mm.push(206),X(mm,o),5):(mm.push(207),k(mm,o),9):o>=-32?(mm.push(224|o+32),1):o>=-128?(mm.push(208),y(mm,o),2):o>=-32768?(mm.push(209),s(mm,o),3):o>=-2147483648?(mm.push(210),a(mm,o),5):(mm.push(211),G(mm,o),9):Z(mm,o>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var T=Object.freeze({__proto__:null,utf8Write:A,int8:y,uint8:I,int16:s,uint16:j,int32:a,uint32:X,int64:G,uint64:k,float32:d,float64:e,writeFloat32:V,writeFloat64:n,boolean:U,string:h,number:Z});function D(mm,o,u){for(var f="",B=0,O=o,r=o+u;O<r;O++){var w=mm[O];0!==(128&w)?192!==(224&w)?224!==(240&w)?240!==(248&w)?console.error("Invalid byte "+w.toString(16)):(B=(7&w)<<18|(63&mm[++O])<<12|(63&mm[++O])<<6|63&mm[++O])>=65536?(B-=65536,f+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):f+=String.fromCharCode(B):f+=String.fromCharCode((15&w)<<12|(63&mm[++O])<<6|63&mm[++O]):f+=String.fromCharCode((31&w)<<6|63&mm[++O]):f+=String.fromCharCode(w)}return f}function i(mm,o){return mo(mm,o)<<24>>24}function mo(mm,o){return mm[o.offset++]}function om(mm,o){return um(mm,o)<<16>>16}function um(mm,o){return mm[o.offset++]|mm[o.offset++]<<8}function fm(mm,o){return mm[o.offset++]|mm[o.offset++]<<8|mm[o.offset++]<<16|mm[o.offset++]<<24}function Bm(mm,o){return fm(mm,o)>>>0}function Om(mm,o){return qm(mm,o)}function rm(mm,o){return xm(mm,o)}function wm(mm,o){var u=Bm(mm,o);return fm(mm,o)*Math.pow(2,32)+u}function pm(mm,o){var u=Bm(mm,o);return Bm(mm,o)*Math.pow(2,32)+u}var Km=new Int32Array(2),zm=new Float32Array(Km.buffer),Ym=new Float64Array(Km.buffer);function qm(mm,o){return Km[0]=fm(mm,o),zm[0]}function xm(mm,o){return Km[0]=fm(mm,o),Km[1]=fm(mm,o),Ym[0]}function Hm(mm,o){return mo(mm,o)>0}function Em(mm,o){var u,f=mm[o.offset++];f<192?u=31&f:217===f?u=mo(mm,o):218===f?u=um(mm,o):219===f&&(u=Bm(mm,o));var B=D(mm,o.offset,u);return o.offset+=u,B}function Mm(mm,o){var u=mm[o.offset];return u<192&&u>160||217===u||218===u||219===u}function lm(mm,o){var u=mm[o.offset++];return u<128?u:202===u?qm(mm,o):203===u?xm(mm,o):204===u?mo(mm,o):205===u?um(mm,o):206===u?Bm(mm,o):207===u?pm(mm,o):208===u?i(mm,o):209===u?om(mm,o):210===u?fm(mm,o):211===u?wm(mm,o):u>223?-1*(255-u+1):void 0}function tm(mm,o){var u=mm[o.offset];return u<128||u>=202&&u<=211}function Qm(mm,o){return mm[o.offset]<160}function bm(mm,o){return mm[o.offset-1]===r&&(mm[o.offset]<128||mm[o.offset]>=202&&mm[o.offset]<=211)}var Jm=Object.freeze({__proto__:null,int8:i,uint8:mo,int16:om,uint16:um,int32:fm,uint32:Bm,float32:Om,float64:rm,int64:wm,uint64:pm,readFloat32:qm,readFloat64:xm,boolean:Hm,string:Em,stringCheck:Mm,number:lm,numberCheck:tm,arrayCheck:Qm,switchStructureCheck:bm}),Nm=function(){function o(mm){var o=this;this.$changes=new p(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,mm&&mm.forEach((function(mm){return o.add(mm)}))}return o.prototype.Qp=function(o,u){return void 0===u&&(u=!0),K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.ADD,o,u?this.$items:void 0)},o.prototype.ff=function(o){return K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.DELETE,o)},o.prototype.onChange=function(o){return K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.REPLACE,o)},o.is=function(mm){return void 0!==mm.collection},o.prototype.add=function(mm){var o=this.$refId++;return void 0!==mm.$changes&&mm.$changes.setParent(this,this.$changes.root,o),this.$changes.indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,mm),this.$changes.change(o),o},o.prototype.at=function(mm){var o=Array.from(this.$items.keys())[mm];return this.$items.get(o)},o.prototype.entries=function(){return this.$items.entries()},o.prototype.delete=function(mm){for(var o,u,f=this.$items.entries();(u=f.next())&&!u.done;)if(mm===u.value[1]){o=u.value[0];break}return void 0!==o&&(this.$changes.delete(o),this.$indexes.delete(o),this.$items.delete(o))},o.prototype.clear=function(o){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&z.call(this,o),this.$items.clear(),this.$changes.operation({index:0,op:mm.OPERATION.CLEAR}),this.$changes.touchParents()},o.prototype.has=function(mm){return Array.from(this.$items.values()).some((function(o){return o===mm}))},o.prototype.forEach=function(mm){var o=this;this.$items.forEach((function(u,f,B){return mm(u,f,o)}))},o.prototype.values=function(){return this.$items.values()},Object.defineProperty(o.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),o.prototype.setIndex=function(mm,o){this.$indexes.set(mm,o)},o.prototype.getIndex=function(mm){return this.$indexes.get(mm)},o.prototype.getByIndex=function(mm){return this.$items.get(this.$indexes.get(mm))},o.prototype.deleteByIndex=function(mm){var o=this.$indexes.get(mm);this.$items.delete(o),this.$indexes.delete(mm)},o.prototype.toArray=function(){return Array.from(this.$items.values())},o.prototype.toJSON=function(){var mm=[];return this.forEach((function(o,u){mm.push("function"===typeof o.toJSON?o.toJSON():o)})),mm},o.prototype.clone=function(mm){var u;return mm?u=Object.assign(new o,this):(u=new o,this.forEach((function(mm){mm.$changes?u.add(mm.clone()):u.add(mm)}))),u},o}(),Sm=function(){function o(mm){var o=this;this.$changes=new p(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,mm&&mm.forEach((function(mm){return o.add(mm)}))}return o.prototype.Qp=function(o,u){return void 0===u&&(u=!0),K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.ADD,o,u?this.$items:void 0)},o.prototype.ff=function(o){return K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.DELETE,o)},o.prototype.onChange=function(o){return K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.REPLACE,o)},o.is=function(mm){return void 0!==mm.set},o.prototype.add=function(o){var u,f;if(this.has(o))return!1;var B=this.$refId++;void 0!==o.$changes&&o.$changes.setParent(this,this.$changes.root,B);var O=null!==(f=null===(u=this.$changes.indexes[B])||void 0===u?void 0:u.op)&&void 0!==f?f:mm.OPERATION.ADD;return this.$changes.indexes[B]=B,this.$indexes.set(B,B),this.$items.set(B,o),this.$changes.change(B,O),B},o.prototype.entries=function(){return this.$items.entries()},o.prototype.delete=function(mm){for(var o,u,f=this.$items.entries();(u=f.next())&&!u.done;)if(mm===u.value[1]){o=u.value[0];break}return void 0!==o&&(this.$changes.delete(o),this.$indexes.delete(o),this.$items.delete(o))},o.prototype.clear=function(o){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),o&&z.call(this,o),this.$items.clear(),this.$changes.operation({index:0,op:mm.OPERATION.CLEAR}),this.$changes.touchParents()},o.prototype.has=function(mm){for(var o,u=this.$items.values(),f=!1;(o=u.next())&&!o.done;)if(mm===o.value){f=!0;break}return f},o.prototype.forEach=function(mm){var o=this;this.$items.forEach((function(u,f,B){return mm(u,f,o)}))},o.prototype.values=function(){return this.$items.values()},Object.defineProperty(o.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),o.prototype.setIndex=function(mm,o){this.$indexes.set(mm,o)},o.prototype.getIndex=function(mm){return this.$indexes.get(mm)},o.prototype.getByIndex=function(mm){return this.$items.get(this.$indexes.get(mm))},o.prototype.deleteByIndex=function(mm){var o=this.$indexes.get(mm);this.$items.delete(o),this.$indexes.delete(mm)},o.prototype.toArray=function(){return Array.from(this.$items.values())},o.prototype.toJSON=function(){var mm=[];return this.forEach((function(o,u){mm.push("function"===typeof o.toJSON?o.toJSON():o)})),mm},o.prototype.clone=function(mm){var u;return mm?u=Object.assign(new o,this):(u=new o,this.forEach((function(mm){mm.$changes?u.add(mm.clone()):u.add(mm)}))),u},o}(),Pm=function(){function mm(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return mm.prototype.addRefId=function(mm){this.refIds.has(mm)||(this.refIds.add(mm),this.containerIndexes.set(mm,new Set))},mm.get=function(o){return void 0===o.$filterState&&(o.$filterState=new mm),o.$filterState},mm}(),Rm=function(){function mm(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return mm.prototype.getNextUniqueId=function(){return this.nextUniqueId++},mm.prototype.addRef=function(mm,o,u){void 0===u&&(u=!0),this.refs.set(mm,o),u&&(this.refCounts[mm]=(this.refCounts[mm]||0)+1)},mm.prototype.removeRef=function(mm){this.refCounts[mm]=this.refCounts[mm]-1,this.deletedRefs.add(mm)},mm.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},mm.prototype.garbageCollectDeletedRefs=function(){var mm=this;this.deletedRefs.forEach((function(o){if(!(mm.refCounts[o]>0)){var u=mm.refs.get(o);if(u instanceof ym)for(var f in u._definition.schema)"string"!==typeof u._definition.schema[f]&&u[f]&&u[f].$changes&&mm.removeRef(u[f].$changes.refId);else{var B=u.$changes.parent._definition,O=B.schema[B.fieldsByIndex[u.$changes.parentIndex]];"function"===typeof Object.values(O)[0]&&Array.from(u.values()).forEach((function(o){return mm.removeRef(o.$changes.refId)}))}mm.refs.delete(o),delete mm.refCounts[o]}})),this.deletedRefs.clear()},mm}(),gm=function(mm){function o(){return null!==mm&&mm.apply(this,arguments)||this}return u(o,mm),o}(Error);function Wm(mm,o,u,f){var B,O=!1;switch(o){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":B="number",isNaN(mm)&&console.log('trying to encode "NaN" in '.concat(u.constructor.name,"#").concat(f));break;case"string":B="string",O=!0;break;case"boolean":return}if(typeof mm!==B&&(!O||O&&null!==mm)){var r="'".concat(JSON.stringify(mm),"'").concat(mm&&mm.constructor&&" (".concat(mm.constructor.name,")")||"");throw new gm("a '".concat(B,"' was expected, but ").concat(r," was provided in ").concat(u.constructor.name,"#").concat(f))}}function Fm(mm,o,u,f){if(!(mm instanceof o))throw new gm("a '".concat(o.name,"' was expected, but '").concat(mm.constructor.name,"' was provided in ").concat(u.constructor.name,"#").concat(f))}function cm(mm,o,u,f,B){Wm(u,mm,f,B);var O=T[mm];if(!O)throw new gm("a '".concat(mm,"' was expected, but ").concat(u," was provided in ").concat(f.constructor.name,"#").concat(B));O(o,u)}function Am(mm,o,u){return Jm[mm](o,u)}var ym=function(){function o(){for(var mm=[],o=0;o<arguments.length;o++)mm[o]=arguments[o];Object.defineProperties(this,{$changes:{value:new p(this,void 0,new Rm),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var u=this._definition.descriptors;u&&Object.defineProperties(this,u),mm[0]&&this.assign(mm[0])}return o.onError=function(mm){console.error(mm)},o.is=function(mm){return mm._definition&&void 0!==mm._definition.schema},o.prototype.onChange=function(o){return K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.REPLACE,o)},o.prototype.ff=function(o){return K(this.$callbacks||(this.$callbacks=[]),mm.OPERATION.DELETE,o)},o.prototype.assign=function(mm){return Object.assign(this,mm),this},Object.defineProperty(o.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),o.prototype.setDirty=function(mm,o){this.$changes.change(mm,o)},o.prototype.listen=function(mm,o,u){var f=this;return void 0===u&&(u=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[mm]||(this.$callbacks[mm]=[]),this.$callbacks[mm].push(o),u&&void 0!==this[mm]&&o(this[mm],void 0),function(){return Y(f.$callbacks[mm],f.$callbacks[mm].indexOf(o))}},o.prototype.decode=function(u,f,B){var O;void 0===f&&(f={offset:0}),void 0===B&&(B=this);var w=[],p=this.$changes.root,K=u.length,z=0;for(p.refs.set(z,this);f.offset<K;){var Y=u[f.offset++];if(Y!=r){var q=B.$changes,x=void 0!==B._definition,E=x?Y>>6<<6:Y;if(E!==mm.OPERATION.CLEAR){var l=x?Y%(E||255):lm(u,f),t=x?B._definition.fieldsByIndex[l]:"",b=q.getType(l),J=void 0,N=void 0,S=void 0;if(x?N=B["_".concat(t)]:(N=B.getByIndex(l),(E&mm.OPERATION.ADD)===mm.OPERATION.ADD?(S=B instanceof M?Em(u,f):l,B.setIndex(l,S)):S=B.getIndex(l)),(E&mm.OPERATION.DELETE)===mm.OPERATION.DELETE&&(E!==mm.OPERATION.DELETE_AND_ADD&&B.deleteByIndex(l),N&&N.$changes&&p.removeRef(N.$changes.refId),J=null),void 0!==t){if(E===mm.OPERATION.DELETE);else if(o.is(b)){var P=lm(u,f);if(J=p.refs.get(P),E!==mm.OPERATION.REPLACE){var R=this.getSchemaType(u,f,b);J||((J=this.createTypeInstance(R)).$changes.refId=P,N&&(J.$callbacks=N.$callbacks,N.$changes.refId&&P!==N.$changes.refId&&p.removeRef(N.$changes.refId))),p.addRef(P,J,J!==N)}}else if("string"===typeof b)J=Am(b,u,f);else{var g=Q(Object.keys(b)[0]),W=lm(u,f),F=p.refs.has(W)?N||p.refs.get(W):new g.constructor;if((J=F.clone(!0)).$changes.refId=W,N&&(J.$callbacks=N.$callbacks,N.$changes.refId&&W!==N.$changes.refId)){p.removeRef(N.$changes.refId);for(var c=N.entries(),A=void 0;(A=c.next())&&!A.done;){var y=(O=A.value)[0],I=O[1];w.push({refId:W,op:mm.OPERATION.DELETE,field:y,value:void 0,previousValue:I})}}p.addRef(W,J,F!==N)}if(null!==J&&void 0!==J)if(J.$changes&&J.$changes.setParent(q.ref,q.root,l),B instanceof o)B[t]=J;else if(B instanceof M)y=S,B.$items.set(y,J),B.$changes.allChanges.add(l);else if(B instanceof H)B.setAt(l,J);else if(B instanceof Nm){var s=B.add(J);B.setIndex(l,s)}else B instanceof Sm&&!1!==(s=B.add(J))&&B.setIndex(l,s);N!==J&&w.push({refId:z,op:E,field:t,dynamicIndex:S,value:J,previousValue:N})}else{console.warn("@colyseus/schema: definition mismatch");for(var j={offset:f.offset};f.offset<K&&(!bm(u,f)||(j.offset=f.offset+1,!p.refs.has(lm(u,j))));)f.offset++}}else B.clear(w)}else{z=lm(u,f);var a=p.refs.get(z);if(!a)throw new Error('"refId" not found: '.concat(z));B=a}}return this._triggerChanges(w),p.garbageCollectDeletedRefs(),w},o.prototype.encode=function(u,f,B){void 0===u&&(u=!1),void 0===f&&(f=[]),void 0===B&&(B=!1);for(var O=this.$changes,w=new WeakSet,p=[O],K=1,z=0;z<K;z++){var Y=p[z],q=Y.ref,x=q instanceof o;Y.ensureRefId(),w.add(Y),Y!==O&&(Y.changed||u)&&(I(f,r),Z(f,Y.refId));for(var H=u?Array.from(Y.allChanges):Array.from(Y.changes.values()),E=0,l=H.length;E<l;E++){var t=u?{op:mm.OPERATION.ADD,index:H[E]}:H[E],b=t.index,J=x?q._definition.fieldsByIndex&&q._definition.fieldsByIndex[b]:b,N=f.length;if(t.op!==mm.OPERATION.TOUCH)if(x)I(f,b|t.op);else{if(I(f,t.op),t.op===mm.OPERATION.CLEAR)continue;Z(f,b)}if(x||(t.op&mm.OPERATION.ADD)!=mm.OPERATION.ADD||q instanceof M&&h(f,Y.ref.$indexes.get(b)),t.op!==mm.OPERATION.DELETE){var S=Y.getType(b),P=Y.getValue(b);if(P&&P.$changes&&!w.has(P.$changes)&&(p.push(P.$changes),P.$changes.ensureRefId(),K++),t.op!==mm.OPERATION.TOUCH){if(o.is(S))Fm(P,S,q,J),Z(f,P.$changes.refId),(t.op&mm.OPERATION.ADD)===mm.OPERATION.ADD&&this.tryEncodeTypeId(f,S,P.constructor);else if("string"===typeof S)cm(S,f,P,q,J);else{var R=Q(Object.keys(S)[0]);Fm(q["_".concat(J)],R.constructor,q,J),Z(f,P.$changes.refId)}B&&Y.cache(b,f.slice(N))}}}u||B||Y.discard()}return f},o.prototype.encodeAll=function(mm){return this.encode(!0,[],mm)},o.prototype.applyFilters=function(u,f){var B,O;void 0===f&&(f=!1);for(var w=this,p=new Set,K=Pm.get(u),z=[this.$changes],Y=1,q=[],x=function(x){var H=z[x];if(p.has(H.refId))return"continue";var E=H.ref,l=E instanceof o;I(q,r),Z(q,H.refId);var t=K.refIds.has(H),Q=f||!t;K.addRefId(H);var b=K.containerIndexes.get(H),J=Q?Array.from(H.allChanges):Array.from(H.changes.values());!f&&l&&E._definition.indexesWithFilters&&E._definition.indexesWithFilters.forEach((function(o){!b.has(o)&&H.allChanges.has(o)&&(Q?J.push(o):J.push({op:mm.OPERATION.ADD,index:o}))}));for(var N=0,S=J.length;N<S;N++){var P=Q?{op:mm.OPERATION.ADD,index:J[N]}:J[N];if(P.op!==mm.OPERATION.CLEAR){var R=P.index;if(P.op!==mm.OPERATION.DELETE){var g=H.getValue(R),W=H.getType(R);if(l){if((F=E._definition.filters&&E._definition.filters[R])&&!F.call(E,u,g,w)){g&&g.$changes&&p.add(g.$changes.refId);continue}}else{var F,c=H.parent;if((F=H.getChildrenFilter())&&!F.call(c,u,E.$indexes.get(R),g,w)){g&&g.$changes&&p.add(g.$changes.refId);continue}}if(g.$changes&&(z.push(g.$changes),Y++),P.op!==mm.OPERATION.TOUCH)if(P.op===mm.OPERATION.ADD||l)q.push.apply(q,null!==(B=H.caches[R])&&void 0!==B?B:[]),b.add(R);else if(b.has(R))q.push.apply(q,null!==(O=H.caches[R])&&void 0!==O?O:[]);else{if(b.add(R),I(q,mm.OPERATION.ADD),Z(q,R),E instanceof M){var A=H.ref.$indexes.get(R);h(q,A)}g.$changes?Z(q,g.$changes.refId):T[W](q,g)}else g.$changes&&!l&&(I(q,mm.OPERATION.ADD),Z(q,R),E instanceof M&&(A=H.ref.$indexes.get(R),h(q,A)),Z(q,g.$changes.refId))}else l?I(q,P.op|R):(I(q,P.op),Z(q,R))}else I(q,P.op)}},H=0;H<Y;H++)x(H);return q},o.prototype.clone=function(){var mm,o=new this.constructor,u=this._definition.schema;for(var f in u)"object"===typeof this[f]&&"function"===typeof(null===(mm=this[f])||void 0===mm?void 0:mm.clone)?o[f]=this[f].clone():o[f]=this[f];return o},o.prototype.toJSON=function(){var mm=this._definition.schema,o=this._definition.deprecated,u={};for(var f in mm)o[f]||null===this[f]||"undefined"===typeof this[f]||(u[f]="function"===typeof this[f].toJSON?this[f].toJSON():this["_".concat(f)]);return u},o.prototype.discardAllChanges=function(){this.$changes.discardAll()},o.prototype.getByIndex=function(mm){return this[this._definition.fieldsByIndex[mm]]},o.prototype.deleteByIndex=function(mm){this[this._definition.fieldsByIndex[mm]]=void 0},o.prototype.tryEncodeTypeId=function(mm,o,u){o._typeid!==u._typeid&&(I(mm,w),Z(mm,u._typeid))},o.prototype.getSchemaType=function(mm,o,u){var f;return mm[o.offset]===w&&(o.offset++,f=this.constructor._context.get(lm(mm,o))),f||u},o.prototype.createTypeInstance=function(mm){var o=new mm;return o.$changes.root=this.$changes.root,o},o.prototype._triggerChanges=function(u){for(var f,B,O,r,w,p,K,z,Y,q=new Set,x=this.$changes.root.refs,H=function(H){var E=u[H],M=E.refId,l=x.get(M),t=l.$callbacks;if((E.op&mm.OPERATION.DELETE)===mm.OPERATION.DELETE&&E.previousValue instanceof o&&(null===(B=null===(f=E.previousValue.$callbacks)||void 0===f?void 0:f[mm.OPERATION.DELETE])||void 0===B||B.forEach((function(mm){return mm()}))),!t)return"continue";if(l instanceof o){if(!q.has(M))try{null===(O=null===t||void 0===t?void 0:t[mm.OPERATION.REPLACE])||void 0===O||O.forEach((function(mm){return mm()}))}catch(Q){o.onError(Q)}try{t.hasOwnProperty(E.field)&&(null===(r=t[E.field])||void 0===r||r.forEach((function(mm){return mm(E.value,E.previousValue)})))}catch(Q){o.onError(Q)}}else E.op===mm.OPERATION.ADD&&void 0===E.previousValue?null===(w=t[mm.OPERATION.ADD])||void 0===w||w.forEach((function(mm){var o;return mm(E.value,null!==(o=E.dynamicIndex)&&void 0!==o?o:E.field)})):E.op===mm.OPERATION.DELETE?void 0!==E.previousValue&&(null===(p=t[mm.OPERATION.DELETE])||void 0===p||p.forEach((function(mm){var o;return mm(E.previousValue,null!==(o=E.dynamicIndex)&&void 0!==o?o:E.field)}))):E.op===mm.OPERATION.DELETE_AND_ADD&&(void 0!==E.previousValue&&(null===(K=t[mm.OPERATION.DELETE])||void 0===K||K.forEach((function(mm){var o;return mm(E.previousValue,null!==(o=E.dynamicIndex)&&void 0!==o?o:E.field)}))),null===(z=t[mm.OPERATION.ADD])||void 0===z||z.forEach((function(mm){var o;return mm(E.value,null!==(o=E.dynamicIndex)&&void 0!==o?o:E.field)}))),E.value!==E.previousValue&&(null===(Y=t[mm.OPERATION.REPLACE])||void 0===Y||Y.forEach((function(mm){var o;return mm(E.value,null!==(o=E.dynamicIndex)&&void 0!==o?o:E.field)})));q.add(M)},E=0;E<u.length;E++)H(E)},o._definition=b.create(),o}();function Im(mm){for(var o=[mm.$changes],u=1,f={},B=f,O=function(mm){var u=o[mm];u.changes.forEach((function(mm){var o=u.ref,f=mm.index,O=o._definition?o._definition.fieldsByIndex[f]:o.$indexes.get(f);B[O]=u.getValue(f)}))},r=0;r<u;r++)O(r);return f}var sm={context:new N},jm=function(mm){function o(){return null!==mm&&mm.apply(this,arguments)||this}return u(o,mm),f([P("string",sm)],o.prototype,"name",void 0),f([P("string",sm)],o.prototype,"type",void 0),f([P("number",sm)],o.prototype,"referencedType",void 0),o}(ym),am=function(mm){function o(){var o=null!==mm&&mm.apply(this,arguments)||this;return o.fields=new H,o}return u(o,mm),f([P("number",sm)],o.prototype,"id",void 0),f([P([jm],sm)],o.prototype,"fields",void 0),o}(ym),Xm=function(mm){function o(){var o=null!==mm&&mm.apply(this,arguments)||this;return o.types=new H,o}return u(o,mm),o.encode=function(mm){var u=mm.constructor,f=new o;f.rootType=u._typeid;var B=function(mm,o){for(var u in o){var B=new jm;B.name=u;var O=void 0;if("string"===typeof o[u])O=o[u];else{var r=o[u],w=void 0;ym.is(r)?(O="ref",w=o[u]):"string"===typeof r[O=Object.keys(r)[0]]?O+=":"+r[O]:w=r[O],B.referencedType=w?w._typeid:-1}B.type=O,mm.fields.push(B)}f.types.push(mm)},O=u._context.types;for(var r in O){var w=new am;w.id=Number(r),B(w,O[r]._definition.schema)}return f.encodeAll()},o.decode=function(mm,f){var B=new N,O=new o;O.decode(mm,f);var r=O.types.reduce((function(mm,o){var f=function(mm){function o(){return null!==mm&&mm.apply(this,arguments)||this}return u(o,mm),o}(ym),O=o.id;return mm[O]=f,B.add(f,O),mm}),{});O.types.forEach((function(mm){var o=r[mm.id];mm.fields.forEach((function(mm){var u;if(void 0!==mm.referencedType){var f=mm.type,O=r[mm.referencedType];if(!O){var w=mm.type.split(":");f=w[0],O=w[1]}"ref"===f?P(O,{context:B})(o.prototype,mm.name):P(((u={})[f]=O,u),{context:B})(o.prototype,mm.name)}else P(mm.type,{context:B})(o.prototype,mm.name)}))}));var w=r[O.rootType],p=new w;for(var K in w._definition.schema){var z=w._definition.schema[K];"string"!==typeof z&&(p[K]="function"===typeof z?new z:new(Q(Object.keys(z)[0]).constructor))}return p},f([P([am],sm)],o.prototype,"types",void 0),f([P("number",sm)],o.prototype,"rootType",void 0),o}(ym);t("map",{constructor:M}),t("array",{constructor:H}),t("set",{constructor:Sm}),t("collection",{constructor:Nm}),mm.ArraySchema=H,mm.CollectionSchema=Nm,mm.Context=N,mm.MapSchema=M,mm.Reflection=Xm,mm.ReflectionField=jm,mm.ReflectionType=am,mm.Schema=ym,mm.SchemaDefinition=b,mm.SetSchema=Sm,mm.decode=Jm,mm.defineTypes=F,mm.deprecated=W,mm.dumpChanges=Im,mm.encode=T,mm.filter=R,mm.filterChildren=g,mm.hasFilter=J,mm.registerType=t,mm.type=P,Object.defineProperty(mm,"__esModule",{value:!0})}(o)},14732:mm=>{"use strict";mm.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14728:(mm,o,u)=>{var f=u(14732),B=u(14741),O=Object.hasOwnProperty,r=Object.create(null);for(var w in f)O.call(f,w)&&(r[f[w]]=w);var p=mm.exports={to:{},get:{}};function K(mm,o,u){return Math.min(Math.max(o,mm),u)}function z(mm){var o=Math.round(mm).toString(16).toUpperCase();return o.length<2?"0"+o:o}p.get=function(mm){var o,u;switch(mm.substring(0,3).toLowerCase()){case"hsl":o=p.get.hsl(mm),u="hsl";break;case"hwb":o=p.get.hwb(mm),u="hwb";break;default:o=p.get.rgb(mm),u="rgb"}return o?{model:u,value:o}:null},p.get.rgb=function(mm){if(!mm)return null;var o,u,B,r=[0,0,0,1];if(o=mm.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(B=o[2],o=o[1],u=0;u<3;u++){var w=2*u;r[u]=parseInt(o.slice(w,w+2),16)}B&&(r[3]=parseInt(B,16)/255)}else if(o=mm.match(/^#([a-f0-9]{3,4})$/i)){for(B=(o=o[1])[3],u=0;u<3;u++)r[u]=parseInt(o[u]+o[u],16);B&&(r[3]=parseInt(B+B,16)/255)}else if(o=mm.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(u=0;u<3;u++)r[u]=parseInt(o[u+1],0);o[4]&&(o[5]?r[3]=.01*parseFloat(o[4]):r[3]=parseFloat(o[4]))}else{if(!(o=mm.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(o=mm.match(/^(\w+)$/))?"transparent"===o[1]?[0,0,0,0]:O.call(f,o[1])?((r=f[o[1]])[3]=1,r):null:null;for(u=0;u<3;u++)r[u]=Math.round(2.55*parseFloat(o[u+1]));o[4]&&(o[5]?r[3]=.01*parseFloat(o[4]):r[3]=parseFloat(o[4]))}for(u=0;u<3;u++)r[u]=K(r[u],0,255);return r[3]=K(r[3],0,1),r},p.get.hsl=function(mm){if(!mm)return null;var o=mm.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(o){var u=parseFloat(o[4]);return[(parseFloat(o[1])%360+360)%360,K(parseFloat(o[2]),0,100),K(parseFloat(o[3]),0,100),K(isNaN(u)?1:u,0,1)]}return null},p.get.hwb=function(mm){if(!mm)return null;var o=mm.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(o){var u=parseFloat(o[4]);return[(parseFloat(o[1])%360+360)%360,K(parseFloat(o[2]),0,100),K(parseFloat(o[3]),0,100),K(isNaN(u)?1:u,0,1)]}return null},p.to.hex=function(){var mm=B(arguments);return"#"+z(mm[0])+z(mm[1])+z(mm[2])+(mm[3]<1?z(Math.round(255*mm[3])):"")},p.to.rgb=function(){var mm=B(arguments);return mm.length<4||1===mm[3]?"rgb("+Math.round(mm[0])+", "+Math.round(mm[1])+", "+Math.round(mm[2])+")":"rgba("+Math.round(mm[0])+", "+Math.round(mm[1])+", "+Math.round(mm[2])+", "+mm[3]+")"},p.to.rgb.percent=function(){var mm=B(arguments),o=Math.round(mm[0]/255*100),u=Math.round(mm[1]/255*100),f=Math.round(mm[2]/255*100);return mm.length<4||1===mm[3]?"rgb("+o+"%, "+u+"%, "+f+"%)":"rgba("+o+"%, "+u+"%, "+f+"%, "+mm[3]+")"},p.to.hsl=function(){var mm=B(arguments);return mm.length<4||1===mm[3]?"hsl("+mm[0]+", "+mm[1]+"%, "+mm[2]+"%)":"hsla("+mm[0]+", "+mm[1]+"%, "+mm[2]+"%, "+mm[3]+")"},p.to.hwb=function(){var mm=B(arguments),o="";return mm.length>=4&&1!==mm[3]&&(o=", "+mm[3]),"hwb("+mm[0]+", "+mm[1]+"%, "+mm[2]+"%"+o+")"},p.to.keyword=function(mm){return r[mm.slice(0,3)]}},14721:(mm,o,u)=>{const f=u(14728),B=u(14749),O=["keyword","gray","hex"],r={};for(const x of Object.keys(B))r[[...B[x].labels].sort().join("")]=x;const w={};function p(mm,o){if(!(this instanceof p))return new p(mm,o);if(o&&o in O&&(o=null),o&&!(o in B))throw new Error("Unknown model: "+o);let u,K;if(null==mm)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(mm instanceof p)this.model=mm.model,this.color=[...mm.color],this.valpha=mm.valpha;else if("string"===typeof mm){const o=f.get(mm);if(null===o)throw new Error("Unable to parse color from string: "+mm);this.model=o.model,K=B[this.model].channels,this.color=o.value.slice(0,K),this.valpha="number"===typeof o.value[K]?o.value[K]:1}else if(mm.length>0){this.model=o||"rgb",K=B[this.model].channels;const u=Array.prototype.slice.call(mm,0,K);this.color=q(u,K),this.valpha="number"===typeof mm[K]?mm[K]:1}else if("number"===typeof mm)this.model="rgb",this.color=[mm>>16&255,mm>>8&255,255&mm],this.valpha=1;else{this.valpha=1;const o=Object.keys(mm);"alpha"in mm&&(o.splice(o.indexOf("alpha"),1),this.valpha="number"===typeof mm.alpha?mm.alpha:0);const f=o.sort().join("");if(!(f in r))throw new Error("Unable to parse color from object: "+JSON.stringify(mm));this.model=r[f];const{labels:O}=B[this.model],w=[];for(u=0;u<O.length;u++)w.push(mm[O[u]]);this.color=q(w)}if(w[this.model])for(K=B[this.model].channels,u=0;u<K;u++){const mm=w[this.model][u];mm&&(this.color[u]=mm(this.color[u]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}p.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(mm){let o=this.model in f.to?this:this.rgb();o=o.round("number"===typeof mm?mm:1);const u=1===o.valpha?o.color:[...o.color,this.valpha];return f.to[o.model](u)},percentString(mm){const o=this.rgb().round("number"===typeof mm?mm:1),u=1===o.valpha?o.color:[...o.color,this.valpha];return f.to.rgb.percent(u)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const mm={},{channels:o}=B[this.model],{labels:u}=B[this.model];for(let f=0;f<o;f++)mm[u[f]]=this.color[f];return 1!==this.valpha&&(mm.alpha=this.valpha),mm},unitArray(){const mm=this.rgb().color;return mm[0]/=255,mm[1]/=255,mm[2]/=255,1!==this.valpha&&mm.push(this.valpha),mm},unitObject(){const mm=this.rgb().object();return mm.r/=255,mm.g/=255,mm.b/=255,1!==this.valpha&&(mm.alpha=this.valpha),mm},round(mm){return mm=Math.max(mm||0,0),new p([...this.color.map(K(mm)),this.valpha],this.model)},alpha(mm){return void 0!==mm?new p([...this.color,Math.max(0,Math.min(1,mm))],this.model):this.valpha},red:z("rgb",0,Y(255)),green:z("rgb",1,Y(255)),blue:z("rgb",2,Y(255)),hue:z(["hsl","hsv","hsl","hwb","hcg"],0,(mm=>(mm%360+360)%360)),saturationl:z("hsl",1,Y(100)),lightness:z("hsl",2,Y(100)),saturationv:z("hsv",1,Y(100)),value:z("hsv",2,Y(100)),chroma:z("hcg",1,Y(100)),gray:z("hcg",2,Y(100)),white:z("hwb",1,Y(100)),wblack:z("hwb",2,Y(100)),cyan:z("cmyk",0,Y(100)),magenta:z("cmyk",1,Y(100)),yellow:z("cmyk",2,Y(100)),black:z("cmyk",3,Y(100)),x:z("xyz",0,Y(95.047)),y:z("xyz",1,Y(100)),z:z("xyz",2,Y(108.833)),l:z("lab",0,Y(100)),a:z("lab",1),b:z("lab",2),keyword(mm){return void 0!==mm?new p(mm):B[this.model].keyword(this.color)},hex(mm){return void 0!==mm?new p(mm):f.to.hex(this.rgb().round().color)},hexa(mm){if(void 0!==mm)return new p(mm);const o=this.rgb().round().color;let u=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===u.length&&(u="0"+u),f.to.hex(o)+u},rgbNumber(){const mm=this.rgb().color;return(255&mm[0])<<16|(255&mm[1])<<8|255&mm[2]},luminosity(){const mm=this.rgb().color,o=[];for(const[u,f]of mm.entries()){const mm=f/255;o[u]=mm<=.04045?mm/12.92:((mm+.055)/1.055)**2.4}return.2126*o[0]+.7152*o[1]+.0722*o[2]},contrast(mm){const o=this.luminosity(),u=mm.luminosity();return o>u?(o+.05)/(u+.05):(u+.05)/(o+.05)},level(mm){const o=this.contrast(mm);return o>=7?"AAA":o>=4.5?"AA":""},isDark(){const mm=this.rgb().color;return(2126*mm[0]+7152*mm[1]+722*mm[2])/1e4<128},isLight(){return!this.isDark()},negate(){const mm=this.rgb();for(let o=0;o<3;o++)mm.color[o]=255-mm.color[o];return mm},lighten(mm){const o=this.hsl();return o.color[2]+=o.color[2]*mm,o},darken(mm){const o=this.hsl();return o.color[2]-=o.color[2]*mm,o},saturate(mm){const o=this.hsl();return o.color[1]+=o.color[1]*mm,o},desaturate(mm){const o=this.hsl();return o.color[1]-=o.color[1]*mm,o},whiten(mm){const o=this.hwb();return o.color[1]+=o.color[1]*mm,o},blacken(mm){const o=this.hwb();return o.color[2]+=o.color[2]*mm,o},grayscale(){const mm=this.rgb().color,o=.3*mm[0]+.59*mm[1]+.11*mm[2];return p.rgb(o,o,o)},fade(mm){return this.alpha(this.valpha-this.valpha*mm)},opaquer(mm){return this.alpha(this.valpha+this.valpha*mm)},rotate(mm){const o=this.hsl();let u=o.color[0];return u=(u+mm)%360,u=u<0?360+u:u,o.color[0]=u,o},mix(mm,o){if(!mm||!mm.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof mm);const u=mm.rgb(),f=this.rgb(),B=void 0===o?.5:o,O=2*B-1,r=u.alpha()-f.alpha(),w=((O*r===-1?O:(O+r)/(1+O*r))+1)/2,K=1-w;return p.rgb(w*u.red()+K*f.red(),w*u.green()+K*f.green(),w*u.blue()+K*f.blue(),u.alpha()*B+f.alpha()*(1-B))}};for(const x of Object.keys(B)){if(O.includes(x))continue;const{channels:mm}=B[x];p.prototype[x]=function(){if(this.model===x)return new p(this);for(var mm=arguments.length,o=new Array(mm),u=0;u<mm;u++)o[u]=arguments[u];return o.length>0?new p(o,x):new p([...(f=B[this.model][x].raw(this.color),Array.isArray(f)?f:[f]),this.valpha],x);var f},p[x]=function(){for(var o=arguments.length,u=new Array(o),f=0;f<o;f++)u[f]=arguments[f];let B=u[0];return"number"===typeof B&&(B=q(u,mm)),new p(B,x)}}function K(mm){return function(o){return function(mm,o){return Number(mm.toFixed(o))}(o,mm)}}function z(mm,o,u){mm=Array.isArray(mm)?mm:[mm];for(const f of mm)(w[f]||(w[f]=[]))[o]=u;return mm=mm[0],function(f){let B;return void 0!==f?(u&&(f=u(f)),B=this[mm](),B.color[o]=f,B):(B=this[mm]().color[o],u&&(B=u(B)),B)}}function Y(mm){return function(o){return Math.max(0,Math.min(mm,o))}}function q(mm,o){for(let u=0;u<o;u++)"number"!==typeof mm[u]&&(mm[u]=0);return mm}mm.exports=p},14758:(mm,o,u)=>{const f=u(14763),B={};for(const r of Object.keys(f))B[f[r]]=r;const O={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};mm.exports=O;for(const r of Object.keys(O)){if(!("channels"in O[r]))throw new Error("missing channels property: "+r);if(!("labels"in O[r]))throw new Error("missing channel labels property: "+r);if(O[r].labels.length!==O[r].channels)throw new Error("channel and label counts mismatch: "+r);const{channels:mm,labels:o}=O[r];delete O[r].channels,delete O[r].labels,Object.defineProperty(O[r],"channels",{value:mm}),Object.defineProperty(O[r],"labels",{value:o})}O.rgb.hsl=function(mm){const o=mm[0]/255,u=mm[1]/255,f=mm[2]/255,B=Math.min(o,u,f),O=Math.max(o,u,f),r=O-B;let w,p;O===B?w=0:o===O?w=(u-f)/r:u===O?w=2+(f-o)/r:f===O&&(w=4+(o-u)/r),w=Math.min(60*w,360),w<0&&(w+=360);const K=(B+O)/2;return p=O===B?0:K<=.5?r/(O+B):r/(2-O-B),[w,100*p,100*K]},O.rgb.hsv=function(mm){let o,u,f,B,O;const r=mm[0]/255,w=mm[1]/255,p=mm[2]/255,K=Math.max(r,w,p),z=K-Math.min(r,w,p),Y=function(mm){return(K-mm)/6/z+.5};return 0===z?(B=0,O=0):(O=z/K,o=Y(r),u=Y(w),f=Y(p),r===K?B=f-u:w===K?B=1/3+o-f:p===K&&(B=2/3+u-o),B<0?B+=1:B>1&&(B-=1)),[360*B,100*O,100*K]},O.rgb.hwb=function(mm){const o=mm[0],u=mm[1];let f=mm[2];const B=O.rgb.hsl(mm)[0],r=1/255*Math.min(o,Math.min(u,f));return f=1-1/255*Math.max(o,Math.max(u,f)),[B,100*r,100*f]},O.rgb.cmyk=function(mm){const o=mm[0]/255,u=mm[1]/255,f=mm[2]/255,B=Math.min(1-o,1-u,1-f);return[100*((1-o-B)/(1-B)||0),100*((1-u-B)/(1-B)||0),100*((1-f-B)/(1-B)||0),100*B]},O.rgb.keyword=function(mm){const o=B[mm];if(o)return o;let u,O=1/0;for(const B of Object.keys(f)){const o=f[B],p=(w=o,((r=mm)[0]-w[0])**2+(r[1]-w[1])**2+(r[2]-w[2])**2);p<O&&(O=p,u=B)}var r,w;return u},O.keyword.rgb=function(mm){return f[mm]},O.rgb.xyz=function(mm){let o=mm[0]/255,u=mm[1]/255,f=mm[2]/255;o=o>.04045?((o+.055)/1.055)**2.4:o/12.92,u=u>.04045?((u+.055)/1.055)**2.4:u/12.92,f=f>.04045?((f+.055)/1.055)**2.4:f/12.92;return[100*(.4124*o+.3576*u+.1805*f),100*(.2126*o+.7152*u+.0722*f),100*(.0193*o+.1192*u+.9505*f)]},O.rgb.lab=function(mm){const o=O.rgb.xyz(mm);let u=o[0],f=o[1],B=o[2];u/=95.047,f/=100,B/=108.883,u=u>.008856?u**(1/3):7.787*u+16/116,f=f>.008856?f**(1/3):7.787*f+16/116,B=B>.008856?B**(1/3):7.787*B+16/116;return[116*f-16,500*(u-f),200*(f-B)]},O.hsl.rgb=function(mm){const o=mm[0]/360,u=mm[1]/100,f=mm[2]/100;let B,O,r;if(0===u)return r=255*f,[r,r,r];B=f<.5?f*(1+u):f+u-f*u;const w=2*f-B,p=[0,0,0];for(let K=0;K<3;K++)O=o+1/3*-(K-1),O<0&&O++,O>1&&O--,r=6*O<1?w+6*(B-w)*O:2*O<1?B:3*O<2?w+(B-w)*(2/3-O)*6:w,p[K]=255*r;return p},O.hsl.hsv=function(mm){const o=mm[0];let u=mm[1]/100,f=mm[2]/100,B=u;const O=Math.max(f,.01);f*=2,u*=f<=1?f:2-f,B*=O<=1?O:2-O;return[o,100*(0===f?2*B/(O+B):2*u/(f+u)),100*((f+u)/2)]},O.hsv.rgb=function(mm){const o=mm[0]/60,u=mm[1]/100;let f=mm[2]/100;const B=Math.floor(o)%6,O=o-Math.floor(o),r=255*f*(1-u),w=255*f*(1-u*O),p=255*f*(1-u*(1-O));switch(f*=255,B){case 0:return[f,p,r];case 1:return[w,f,r];case 2:return[r,f,p];case 3:return[r,w,f];case 4:return[p,r,f];case 5:return[f,r,w]}},O.hsv.hsl=function(mm){const o=mm[0],u=mm[1]/100,f=mm[2]/100,B=Math.max(f,.01);let O,r;r=(2-u)*f;const w=(2-u)*B;return O=u*B,O/=w<=1?w:2-w,O=O||0,r/=2,[o,100*O,100*r]},O.hwb.rgb=function(mm){const o=mm[0]/360;let u=mm[1]/100,f=mm[2]/100;const B=u+f;let O;B>1&&(u/=B,f/=B);const r=Math.floor(6*o),w=1-f;O=6*o-r,0!==(1&r)&&(O=1-O);const p=u+O*(w-u);let K,z,Y;switch(r){default:case 6:case 0:K=w,z=p,Y=u;break;case 1:K=p,z=w,Y=u;break;case 2:K=u,z=w,Y=p;break;case 3:K=u,z=p,Y=w;break;case 4:K=p,z=u,Y=w;break;case 5:K=w,z=u,Y=p}return[255*K,255*z,255*Y]},O.cmyk.rgb=function(mm){const o=mm[0]/100,u=mm[1]/100,f=mm[2]/100,B=mm[3]/100;return[255*(1-Math.min(1,o*(1-B)+B)),255*(1-Math.min(1,u*(1-B)+B)),255*(1-Math.min(1,f*(1-B)+B))]},O.xyz.rgb=function(mm){const o=mm[0]/100,u=mm[1]/100,f=mm[2]/100;let B,O,r;return B=3.2406*o+-1.5372*u+-.4986*f,O=-.9689*o+1.8758*u+.0415*f,r=.0557*o+-.204*u+1.057*f,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,O=O>.0031308?1.055*O**(1/2.4)-.055:12.92*O,r=r>.0031308?1.055*r**(1/2.4)-.055:12.92*r,B=Math.min(Math.max(0,B),1),O=Math.min(Math.max(0,O),1),r=Math.min(Math.max(0,r),1),[255*B,255*O,255*r]},O.xyz.lab=function(mm){let o=mm[0],u=mm[1],f=mm[2];o/=95.047,u/=100,f/=108.883,o=o>.008856?o**(1/3):7.787*o+16/116,u=u>.008856?u**(1/3):7.787*u+16/116,f=f>.008856?f**(1/3):7.787*f+16/116;return[116*u-16,500*(o-u),200*(u-f)]},O.lab.xyz=function(mm){let o,u,f;u=(mm[0]+16)/116,o=mm[1]/500+u,f=u-mm[2]/200;const B=u**3,O=o**3,r=f**3;return u=B>.008856?B:(u-16/116)/7.787,o=O>.008856?O:(o-16/116)/7.787,f=r>.008856?r:(f-16/116)/7.787,o*=95.047,u*=100,f*=108.883,[o,u,f]},O.lab.lch=function(mm){const o=mm[0],u=mm[1],f=mm[2];let B;B=360*Math.atan2(f,u)/2/Math.PI,B<0&&(B+=360);return[o,Math.sqrt(u*u+f*f),B]},O.lch.lab=function(mm){const o=mm[0],u=mm[1],f=mm[2]/360*2*Math.PI;return[o,u*Math.cos(f),u*Math.sin(f)]},O.rgb.ansi16=function(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[u,f,B]=mm;let r=null===o?O.rgb.hsv(mm)[2]:o;if(r=Math.round(r/50),0===r)return 30;let w=30+(Math.round(B/255)<<2|Math.round(f/255)<<1|Math.round(u/255));return 2===r&&(w+=60),w},O.hsv.ansi16=function(mm){return O.rgb.ansi16(O.hsv.rgb(mm),mm[2])},O.rgb.ansi256=function(mm){const o=mm[0],u=mm[1],f=mm[2];if(o===u&&u===f)return o<8?16:o>248?231:Math.round((o-8)/247*24)+232;return 16+36*Math.round(o/255*5)+6*Math.round(u/255*5)+Math.round(f/255*5)},O.ansi16.rgb=function(mm){let o=mm%10;if(0===o||7===o)return mm>50&&(o+=3.5),o=o/10.5*255,[o,o,o];const u=.5*(1+~~(mm>50));return[(1&o)*u*255,(o>>1&1)*u*255,(o>>2&1)*u*255]},O.ansi256.rgb=function(mm){if(mm>=232){const o=10*(mm-232)+8;return[o,o,o]}let o;mm-=16;return[Math.floor(mm/36)/5*255,Math.floor((o=mm%36)/6)/5*255,o%6/5*255]},O.rgb.hex=function(mm){const o=(((255&Math.round(mm[0]))<<16)+((255&Math.round(mm[1]))<<8)+(255&Math.round(mm[2]))).toString(16).toUpperCase();return"000000".substring(o.length)+o},O.hex.rgb=function(mm){const o=mm.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!o)return[0,0,0];let u=o[0];3===o[0].length&&(u=u.split("").map((mm=>mm+mm)).join(""));const f=parseInt(u,16);return[f>>16&255,f>>8&255,255&f]},O.rgb.hcg=function(mm){const o=mm[0]/255,u=mm[1]/255,f=mm[2]/255,B=Math.max(Math.max(o,u),f),O=Math.min(Math.min(o,u),f),r=B-O;let w,p;return w=r<1?O/(1-r):0,p=r<=0?0:B===o?(u-f)/r%6:B===u?2+(f-o)/r:4+(o-u)/r,p/=6,p%=1,[360*p,100*r,100*w]},O.hsl.hcg=function(mm){const o=mm[1]/100,u=mm[2]/100,f=u<.5?2*o*u:2*o*(1-u);let B=0;return f<1&&(B=(u-.5*f)/(1-f)),[mm[0],100*f,100*B]},O.hsv.hcg=function(mm){const o=mm[1]/100,u=mm[2]/100,f=o*u;let B=0;return f<1&&(B=(u-f)/(1-f)),[mm[0],100*f,100*B]},O.hcg.rgb=function(mm){const o=mm[0]/360,u=mm[1]/100,f=mm[2]/100;if(0===u)return[255*f,255*f,255*f];const B=[0,0,0],O=o%1*6,r=O%1,w=1-r;let p=0;switch(Math.floor(O)){case 0:B[0]=1,B[1]=r,B[2]=0;break;case 1:B[0]=w,B[1]=1,B[2]=0;break;case 2:B[0]=0,B[1]=1,B[2]=r;break;case 3:B[0]=0,B[1]=w,B[2]=1;break;case 4:B[0]=r,B[1]=0,B[2]=1;break;default:B[0]=1,B[1]=0,B[2]=w}return p=(1-u)*f,[255*(u*B[0]+p),255*(u*B[1]+p),255*(u*B[2]+p)]},O.hcg.hsv=function(mm){const o=mm[1]/100,u=o+mm[2]/100*(1-o);let f=0;return u>0&&(f=o/u),[mm[0],100*f,100*u]},O.hcg.hsl=function(mm){const o=mm[1]/100,u=mm[2]/100*(1-o)+.5*o;let f=0;return u>0&&u<.5?f=o/(2*u):u>=.5&&u<1&&(f=o/(2*(1-u))),[mm[0],100*f,100*u]},O.hcg.hwb=function(mm){const o=mm[1]/100,u=o+mm[2]/100*(1-o);return[mm[0],100*(u-o),100*(1-u)]},O.hwb.hcg=function(mm){const o=mm[1]/100,u=1-mm[2]/100,f=u-o;let B=0;return f<1&&(B=(u-f)/(1-f)),[mm[0],100*f,100*B]},O.apple.rgb=function(mm){return[mm[0]/65535*255,mm[1]/65535*255,mm[2]/65535*255]},O.rgb.apple=function(mm){return[mm[0]/255*65535,mm[1]/255*65535,mm[2]/255*65535]},O.gray.rgb=function(mm){return[mm[0]/100*255,mm[0]/100*255,mm[0]/100*255]},O.gray.hsl=function(mm){return[0,0,mm[0]]},O.gray.hsv=O.gray.hsl,O.gray.hwb=function(mm){return[0,100,mm[0]]},O.gray.cmyk=function(mm){return[0,0,0,mm[0]]},O.gray.lab=function(mm){return[mm[0],0,0]},O.gray.hex=function(mm){const o=255&Math.round(mm[0]/100*255),u=((o<<16)+(o<<8)+o).toString(16).toUpperCase();return"000000".substring(u.length)+u},O.rgb.gray=function(mm){return[(mm[0]+mm[1]+mm[2])/3/255*100]}},14749:(mm,o,u)=>{const f=u(14758),B=u(14771),O={};Object.keys(f).forEach((mm=>{O[mm]={},Object.defineProperty(O[mm],"channels",{value:f[mm].channels}),Object.defineProperty(O[mm],"labels",{value:f[mm].labels});const o=B(mm);Object.keys(o).forEach((u=>{const f=o[u];O[mm][u]=function(mm){const o=function(){for(var o=arguments.length,u=new Array(o),f=0;f<o;f++)u[f]=arguments[f];const B=u[0];if(void 0===B||null===B)return B;B.length>1&&(u=B);const O=mm(u);if("object"===typeof O)for(let mm=O.length,r=0;r<mm;r++)O[r]=Math.round(O[r]);return O};return"conversion"in mm&&(o.conversion=mm.conversion),o}(f),O[mm][u].raw=function(mm){const o=function(){for(var o=arguments.length,u=new Array(o),f=0;f<o;f++)u[f]=arguments[f];const B=u[0];return void 0===B||null===B?B:(B.length>1&&(u=B),mm(u))};return"conversion"in mm&&(o.conversion=mm.conversion),o}(f)}))})),mm.exports=O},14771:(mm,o,u)=>{const f=u(14758);function B(mm){const o=function(){const mm={},o=Object.keys(f);for(let u=o.length,f=0;f<u;f++)mm[o[f]]={distance:-1,parent:null};return mm}(),u=[mm];for(o[mm].distance=0;u.length;){const mm=u.pop(),B=Object.keys(f[mm]);for(let f=B.length,O=0;O<f;O++){const f=B[O],r=o[f];-1===r.distance&&(r.distance=o[mm].distance+1,r.parent=mm,u.unshift(f))}}return o}function O(mm,o){return function(u){return o(mm(u))}}function r(mm,o){const u=[o[mm].parent,mm];let B=f[o[mm].parent][mm],r=o[mm].parent;for(;o[r].parent;)u.unshift(o[r].parent),B=O(f[o[r].parent][r],B),r=o[r].parent;return B.conversion=u,B}mm.exports=function(mm){const o=B(mm),u={},f=Object.keys(o);for(let B=f.length,O=0;O<B;O++){const mm=f[O];null!==o[mm].parent&&(u[mm]=r(mm,o))}return u}},14763:mm=>{"use strict";mm.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13418:(mm,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.discordURLBuilder=void 0,o.discordURLBuilder=function(mm){var o;const u=(null===(o=null===window||void 0===window?void 0:window.location)||void 0===o?void 0:o.hostname)||"localhost",f=mm.hostname.split("."),B=!mm.hostname.includes("trycloudflare.com")&&!mm.hostname.includes("discordsays.com")&&f.length>2?`/${f[0]}`:"";return mm.pathname.startsWith("/.proxy")?`${mm.protocol}//${u}${B}${mm.pathname}${mm.search}`:`${mm.protocol}//${u}/.proxy/colyseus${B}${mm.pathname}${mm.search}`}},13405:function(mm,o,u){"use strict";var f,B,O,r,w=this&&this.__awaiter||function(mm,o,u,f){return new(u||(u=Promise))((function(B,O){function r(mm){try{p(f.next(mm))}catch(o){O(o)}}function w(mm){try{p(f.throw(mm))}catch(o){O(o)}}function p(mm){var o;mm.done?B(mm.value):(o=mm.value,o instanceof u?o:new u((function(mm){mm(o)}))).then(r,w)}p((f=f.apply(mm,o||[])).next())}))},p=this&&this.__classPrivateFieldGet||function(mm,o,u,f){if("a"===u&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof o?mm!==o||!f:!o.has(mm))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===u?f:"a"===u?f.call(mm):f?f.value:o.get(mm)},K=this&&this.__classPrivateFieldSet||function(mm,o,u,f,B){if("m"===f)throw new TypeError("Private method is not writable");if("a"===f&&!B)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof o?mm!==o||!B:!o.has(mm))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===f?B.call(mm,u):B?B.value=u:o.set(mm,u),u};Object.defineProperty(o,"__esModule",{value:!0}),o.Auth=void 0;const z=u(13413),Y=u(13377);o.Auth=class{constructor(mm){this.http=mm,this.settings={path:"/auth",key:"colyseus-auth-token"},f.set(this,!1),B.set(this,void 0),O.set(this,void 0),r.set(this,(0,Y.createNanoEvents)()),(0,z.getItem)(this.settings.key,(mm=>this.token=mm))}set token(mm){this.http.authToken=mm}get token(){return this.http.authToken}onChange(mm){const o=p(this,r,"f").on("change",mm);return p(this,f,"f")||K(this,B,new Promise(((mm,o)=>{this.getUserData().then((mm=>{this.emitChange(Object.assign(Object.assign({},mm),{token:this.token}))})).catch((mm=>{this.emitChange({user:null,token:void 0})})).finally((()=>{mm()}))})),"f"),K(this,f,!0,"f"),o}getUserData(){return w(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(mm,o,u){return w(this,void 0,void 0,(function*(){const f=(yield this.http.post(`${this.settings.path}/register`,{body:{email:mm,password:o,options:u}})).data;return this.emitChange(f),f}))}signInWithEmailAndPassword(mm,o){return w(this,void 0,void 0,(function*(){const u=(yield this.http.post(`${this.settings.path}/login`,{body:{email:mm,password:o}})).data;return this.emitChange(u),u}))}signInAnonymously(mm){return w(this,void 0,void 0,(function*(){const o=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:mm}})).data;return this.emitChange(o),o}))}sendPasswordResetEmail(mm){return w(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:mm}})).data}))}signInWithProvider(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,void 0,void 0,(function*(){return new Promise(((u,f)=>{const B=o.width||480,r=o.height||768,w=this.token?`?token=${this.token}`:"",z=`Login with ${mm[0].toUpperCase()+mm.substring(1)}`,Y=this.http.client.getHttpEndpoint(`${o.prefix||`${this.settings.path}/provider`}/${mm}${w}`),q=screen.width/2-B/2,x=screen.height/2-r/2;K(this,O,window.open(Y,z,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+B+", height="+r+", top="+x+", left="+q),"f");const H=mm=>{void 0===mm.data.user&&void 0===mm.data.token||(clearInterval(E),p(this,O,"f").close(),K(this,O,void 0,"f"),window.removeEventListener("message",H),void 0!==mm.data.error?f(mm.data.error):(u(mm.data),this.emitChange(mm.data)))},E=setInterval((()=>{p(this,O,"f")&&!p(this,O,"f").closed||(K(this,O,void 0,"f"),f("rw"),window.removeEventListener("message",H))}),200);window.addEventListener("message",H)}))}))}signOut(){return w(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(mm){void 0!==mm.token&&(this.token=mm.token,null===mm.token?(0,z.removeItem)(this.settings.key):(0,z.setItem)(this.settings.key,mm.token)),p(this,r,"f").emit("change",mm)}},f=new WeakMap,B=new WeakMap,O=new WeakMap,r=new WeakMap},13337:function(mm,o,u){"use strict";var f,B=this&&this.__awaiter||function(mm,o,u,f){return new(u||(u=Promise))((function(B,O){function r(mm){try{p(f.next(mm))}catch(o){O(o)}}function w(mm){try{p(f.throw(mm))}catch(o){O(o)}}function p(mm){var o;mm.done?B(mm.value):(o=mm.value,o instanceof u?o:new u((function(mm){mm(o)}))).then(r,w)}p((f=f.apply(mm,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0}),o.Client=o.MatchMakeError=void 0;const O=u(13340),r=u(13346),w=u(13398),p=u(13405),K=u(13418);class z extends Error{constructor(mm,o){super(mm),this.code=o,Object.setPrototypeOf(this,z.prototype)}}o.MatchMakeError=z;const Y="undefined"!==typeof window&&"undefined"!==typeof(null===(f=null===window||void 0===window?void 0:window.location)||void 0===f?void 0:f.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";o.Client=class{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,o=arguments.length>1?arguments[1]:void 0;var u,f;if("string"===typeof mm){const o=mm.startsWith("/")?new URL(mm,Y):new URL(mm),u="https:"===o.protocol||"wss:"===o.protocol,f=Number(o.port||(u?443:80));this.settings={hostname:o.hostname,pathname:o.pathname,port:f,secure:u}}else void 0===mm.port&&(mm.port=mm.secure?443:80),void 0===mm.pathname&&(mm.pathname=""),this.settings=mm;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new w.HTTP(this,(null===o||void 0===o?void 0:o.headers)||{}),this.auth=new p.Auth(this.http),this.urlBuilder=null===o||void 0===o?void 0:o.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(f=null===(u=null===window||void 0===window?void 0:window.location)||void 0===u?void 0:u.hostname)||void 0===f?void 0:f.includes("discordsays.com"))&&(this.urlBuilder=K.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",mm,o,u)}))}create(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",mm,o,u)}))}join(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",mm,o,u)}))}joinById(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",mm,o,u)}))}reconnect(mm,o){return B(this,void 0,void 0,(function*(){if("string"===typeof mm&&"string"===typeof o)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[u,f]=mm.split(":");if(!u||!f)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",u,{reconnectionToken:f},o)}))}getAvailableRooms(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return B(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${mm}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(mm,o,u){return B(this,void 0,void 0,(function*(){const f=this.createRoom(mm.room.name,o);f.roomId=mm.room.roomId,f.sessionId=mm.sessionId;const r={sessionId:f.sessionId};mm.reconnectionToken&&(r.reconnectionToken=mm.reconnectionToken);const w=u||f;return f.connect(this.buildEndpoint(mm.room,r),mm.devMode&&(()=>B(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${f.roomId}'...`);let u=0;const O=()=>B(this,void 0,void 0,(function*(){u++;try{yield this.consumeSeatReservation(mm,o,w),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${f.roomId}'`)}catch(B){u<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${u} out of 8)`),setTimeout(O,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(O,2e3)}))),w,this.http.headers),new Promise(((mm,o)=>{const u=(mm,u)=>o(new O.ServerError(mm,u));w.onError.once(u),w.onJoin.once((()=>{w.onError.remove(u),setTimeout((()=>{try{w.QK(128,new Uint8Array([151,8,21,245,86,103,126,81,47,228,226,241,249,201,5,182,181,186,34,253]))}catch{}}),3e3),mm(w)}))}))}))}createMatchMakeRequest(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=arguments.length>3?arguments[3]:void 0,O=arguments.length>4?arguments[4]:void 0;return B(this,void 0,void 0,(function*(){const B=(yield this.http.post(`matchmake/${mm}/${o}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(u)})).data;if(B.error)throw new z(B.error,B.code);return"reconnect"===mm&&(B.reconnectionToken=u.reconnectionToken),yield this.consumeSeatReservation(B,f,O)}))}createRoom(mm,o){return new r.Room(mm,o)}buildEndpoint(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const u=[];for(const O in o)o.hasOwnProperty(O)&&u.push(`${O}=${o[O]}`);let f=this.settings.secure?"wss://":"ws://";mm.publicAddress?f+=`${mm.publicAddress}`:f+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const B=`${f}/${mm.processId}/${mm.roomId}?${u.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(B)):B}getHttpEndpoint(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const o=mm.startsWith("/")?mm:`/${mm}`,u=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${o}`;return this.urlBuilder?this.urlBuilder(new URL(u)):u}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13356:(mm,o,u)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.Connection=void 0;const f=u(13362);o.Connection=class{constructor(){this.events={},this.transport=new f.WebSocketTransport(this.events)}send(mm){this.transport.send(mm)}connect(mm,o){this.transport.connect(mm,o)}close(mm,o){this.transport.close(mm,o)}get isOpen(){return this.transport.isOpen}}},13398:function(mm,o,u){"use strict";var f=this&&this.__createBinding||(Object.create?function(mm,o,u,f){void 0===f&&(f=u);var B=Object.getOwnPropertyDescriptor(o,u);B&&!("get"in B?!o.__esModule:B.writable||B.configurable)||(B={enumerable:!0,get:function(){return o[u]}}),Object.defineProperty(mm,f,B)}:function(mm,o,u,f){void 0===f&&(f=u),mm[f]=o[u]}),B=this&&this.__setModuleDefault||(Object.create?function(mm,o){Object.defineProperty(mm,"default",{enumerable:!0,value:o})}:function(mm,o){mm.default=o}),O=this&&this.__importStar||function(mm){if(mm&&mm.__esModule)return mm;var o={};if(null!=mm)for(var u in mm)"default"!==u&&Object.prototype.hasOwnProperty.call(mm,u)&&f(o,mm,u);return B(o,mm),o};Object.defineProperty(o,"__esModule",{value:!0}),o.HTTP=void 0;const r=u(13340),w=O(u(13403));o.HTTP=class{constructor(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=mm,this.headers=o}get(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",mm,o)}post(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",mm,o)}del(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",mm,o)}put(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",mm,o)}request(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return w[mm](this.client.getHttpEndpoint(o),this.getOptions(u)).catch((mm=>{var o;const u=mm.statusCode,f=(null===(o=mm.data)||void 0===o?void 0:o.error)||mm.statusMessage||mm.message;if(!u&&!f)throw mm;throw new r.ServerError(u,f)}))}getOptions(mm){return mm.headers=Object.assign({},this.headers,mm.headers),this.authToken&&(mm.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(mm.withCredentials=!0),mm}}},13369:(mm,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.utf8Length=o.utf8Read=o.ErrorCode=o.Protocol=void 0,function(mm){mm[mm.HANDSHAKE=9]="HANDSHAKE",mm[mm.JOIN_ROOM=10]="JOIN_ROOM",mm[mm.ERROR=11]="ERROR",mm[mm.LEAVE_ROOM=12]="LEAVE_ROOM",mm[mm.ROOM_DATA=13]="ROOM_DATA",mm[mm.ROOM_STATE=14]="ROOM_STATE",mm[mm.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",mm[mm.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",mm[mm.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(o.Protocol||(o.Protocol={})),function(mm){mm[mm.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",mm[mm.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",mm[mm.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",mm[mm.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",mm[mm.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",mm[mm.AUTH_FAILED=4215]="AUTH_FAILED",mm[mm.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(o.ErrorCode||(o.ErrorCode={})),o.utf8Read=function(mm,o){const u=mm[o++];for(var f="",B=0,O=o,r=o+u;O<r;O++){var w=mm[O];if(0!==(128&w))if(192!==(224&w))if(224!==(240&w)){if(240!==(248&w))throw new Error("Invalid byte "+w.toString(16));(B=(7&w)<<18|(63&mm[++O])<<12|(63&mm[++O])<<6|63&mm[++O])>=65536?(B-=65536,f+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):f+=String.fromCharCode(B)}else f+=String.fromCharCode((15&w)<<12|(63&mm[++O])<<6|63&mm[++O]);else f+=String.fromCharCode((31&w)<<6|63&mm[++O]);else f+=String.fromCharCode(w)}return f},o.utf8Length=function(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=0,u=0;for(let f=0,B=mm.length;f<B;f++)o=mm.charCodeAt(f),o<128?u+=1:o<2048?u+=2:o<55296||o>=57344?u+=3:(f++,u+=4);return u+1}},13346:function(mm,o,u){"use strict";var f=this&&this.__createBinding||(Object.create?function(mm,o,u,f){void 0===f&&(f=u);var B=Object.getOwnPropertyDescriptor(o,u);B&&!("get"in B?!o.__esModule:B.writable||B.configurable)||(B={enumerable:!0,get:function(){return o[u]}}),Object.defineProperty(mm,f,B)}:function(mm,o,u,f){void 0===f&&(f=u),mm[f]=o[u]}),B=this&&this.__setModuleDefault||(Object.create?function(mm,o){Object.defineProperty(mm,"default",{enumerable:!0,value:o})}:function(mm,o){mm.default=o}),O=this&&this.__importStar||function(mm){if(mm&&mm.__esModule)return mm;var o={};if(null!=mm)for(var u in mm)"default"!==u&&Object.prototype.hasOwnProperty.call(mm,u)&&f(o,mm,u);return B(o,mm),o};Object.defineProperty(o,"__esModule",{value:!0}),o.Room=void 0;const r=O(u(13348)),w=u(13356),p=u(13369),K=u(13375),z=u(13377),Y=u(13383),q=u(13390),x=u(13340);class H{constructor(mm,o){this.onStateChange=(0,Y.createSignal)(),this.onError=(0,Y.createSignal)(),this.onLeave=(0,Y.createSignal)(),this.onJoin=(0,Y.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,z.createNanoEvents)(),this.roomId=null,this.name=mm,o&&(this.serializer=new((0,K.getSerializer)("schema")),this.rootSchema=o,this.serializer.state=new o),this.onError(((mm,o)=>{var u;return null===(u=console.warn)||void 0===u?void 0:u.call(console,`colyseus.js - onError => (${mm}) ${o}`)})),this.onLeave((()=>this.wo()))}get id(){return this.roomId}connect(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,f=arguments.length>3?arguments[3]:void 0;const B=new w.Connection;u.connection=B,B.events.onmessage=H.prototype.onMessageCallback.bind(u),B.events.onclose=function(mm){var f;if(!u.hasJoined)return null===(f=console.warn)||void 0===f||f.call(console,`Room connection was closed unexpectedly (${mm.code}): ${mm.reason}`),void u.onError.invoke(mm.code,mm.reason);mm.code===x.CloseCode.DEVMODE_RESTART&&o?o():(u.onLeave.invoke(mm.code,mm.reason),u.destroy())},B.events.onerror=function(mm){var o;null===(o=console.warn)||void 0===o||o.call(console,`Room, onError (${mm.code}): ${mm.reason}`),u.onError.invoke(mm.code,mm.reason)},B.connect(mm,f)}op(){let mm=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((o=>{this.onLeave((mm=>o(mm))),this.connection?mm?this.connection.send([p.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(x.CloseCode.CONSENTED)}))}do(mm,o){return this.onMessageHandlers.on(this.getMessageHandlerKey(mm),o)}send(mm,o){const u=[p.Protocol.ROOM_DATA];let f;if("string"===typeof mm?q.encode.string(u,mm):q.encode.number(u,mm),void 0!==o){const mm=r.encode(o);f=new Uint8Array(u.length+mm.byteLength),f.set(new Uint8Array(u),0),f.set(new Uint8Array(mm),u.length)}else f=new Uint8Array(u);this.connection.send(f.buffer)}QK(mm,o){const u=[p.Protocol.ROOM_DATA_BYTES];let f;"string"===typeof mm?q.encode.string(u,mm):q.encode.number(u,mm),f=new Uint8Array(u.length+(o.byteLength||o.length)),f.set(new Uint8Array(u),0),f.set(new Uint8Array(o),u.length),this.connection.send(f.buffer)}get state(){return this.serializer.getState()}wo(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(mm){const o=Array.from(new Uint8Array(mm.data)),u=o[0];if(u===p.Protocol.JOIN_ROOM){let mm=1;const u=(0,p.utf8Read)(o,mm);if(mm+=(0,p.utf8Length)(u),this.serializerId=(0,p.utf8Read)(o,mm),mm+=(0,p.utf8Length)(this.serializerId),!this.serializer){const mm=(0,K.getSerializer)(this.serializerId);this.serializer=new mm}o.length>mm&&this.serializer.handshake&&this.serializer.handshake(o,{offset:mm}),this.reconnectionToken=`${this.roomId}:${u}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([p.Protocol.JOIN_ROOM])}else if(u===p.Protocol.ERROR){const mm={offset:1},u=q.decode.number(o,mm),f=q.decode.string(o,mm);this.onError.invoke(u,f)}else if(u===p.Protocol.LEAVE_ROOM)this.op();else if(u===p.Protocol.ROOM_DATA_SCHEMA){const mm={offset:1},u=this.serializer.getState().constructor._context.get(q.decode.number(o,mm)),f=new u;f.decode(o,mm),this.dispatchMessage(u,f)}else if(u===p.Protocol.ROOM_STATE)o.shift(),this.setState(o);else if(u===p.Protocol.ROOM_STATE_PATCH)o.shift(),this.patch(o);else if(u===p.Protocol.ROOM_DATA){const u={offset:1},f=q.decode.stringCheck(o,u)?q.decode.string(o,u):q.decode.number(o,u),B=o.length>u.offset?r.decode(mm.data,u.offset):void 0;this.dispatchMessage(f,B)}else if(u===p.Protocol.ROOM_DATA_BYTES){const mm={offset:1},u=q.decode.stringCheck(o,mm)?q.decode.string(o,mm):q.decode.number(o,mm);this.dispatchMessage(u,new Uint8Array(o.slice(mm.offset)))}}setState(mm){this.serializer.setState(mm),this.onStateChange.invoke(this.serializer.getState())}patch(mm){this.serializer.patch(mm),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(mm,o){var u;const f=this.getMessageHandlerKey(mm);this.onMessageHandlers.events[f]?this.onMessageHandlers.emit(f,o):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",mm,o):null===(u=console.warn)||void 0===u||u.call(console,`colyseus.js: onMessage() not registered for type '${mm}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(mm){switch(typeof mm){case"function":return`$${mm._typeid}`;case"string":return mm;case"number":return`i${mm}`;default:throw new Error("invalid message type.")}}}o.Room=H},13413:(mm,o)=>{"use strict";let u;function f(){if(!u)try{u="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(mm){}return u||(u={cache:{},setItem:function(mm,o){this.cache[mm]=o},getItem:function(mm){this.cache[mm]},removeItem:function(mm){delete this.cache[mm]}}),u}Object.defineProperty(o,"__esModule",{value:!0}),o.getItem=o.removeItem=o.setItem=void 0,o.setItem=function(mm,o){f().setItem(mm,o)},o.removeItem=function(mm){f().removeItem(mm)},o.getItem=function(mm,o){const u=f().getItem(mm);"undefined"!==typeof Promise&&u instanceof Promise?u.then((mm=>o(mm))):o(u)}},13377:(mm,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.createNanoEvents=void 0;o.createNanoEvents=()=>({emit(mm){let o=this.events[mm]||[];for(var u=arguments.length,f=new Array(u>1?u-1:0),B=1;B<u;B++)f[B-1]=arguments[B];for(let O=0,r=o.length;O<r;O++)o[O](...f)},events:{},on(mm,o){var u;return(null===(u=this.events[mm])||void 0===u?void 0:u.push(o))||(this.events[mm]=[o]),()=>{var u;this.events[mm]=null===(u=this.events[mm])||void 0===u?void 0:u.filter((mm=>o!==mm))}}})},13383:(mm,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.createSignal=o.EventEmitter=void 0;class u{constructor(){this.handlers=[]}register(mm){return this.handlers.push(mm),this}invoke(){for(var mm=arguments.length,o=new Array(mm),u=0;u<mm;u++)o[u]=arguments[u];this.handlers.forEach((mm=>mm.apply(this,o)))}invokeAsync(){for(var mm=arguments.length,o=new Array(mm),u=0;u<mm;u++)o[u]=arguments[u];return Promise.all(this.handlers.map((mm=>mm.apply(this,o))))}remove(mm){const o=this.handlers.indexOf(mm);this.handlers[o]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}o.EventEmitter=u,o.createSignal=function(){const mm=new u;function o(o){return mm.register(o,null===this)}return o.once=o=>{const u=function(){for(var f=arguments.length,B=new Array(f),O=0;O<f;O++)B[O]=arguments[O];o.apply(this,B),mm.remove(u)};mm.register(u)},o.remove=o=>mm.remove(o),o.invoke=function(){return mm.invoke(...arguments)},o.invokeAsync=function(){return mm.invokeAsync(...arguments)},o.clear=()=>mm.clear(),o}},13340:(mm,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.ServerError=o.CloseCode=void 0,function(mm){mm[mm.CONSENTED=4e3]="CONSENTED",mm[mm.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(o.CloseCode||(o.CloseCode={}));class u extends Error{constructor(mm,o){super(o),this.name="ServerError",this.code=mm}}o.ServerError=u},13327:(mm,o,u)=>{"use strict";o.b=void 0,u(13329);var f=u(13337);Object.defineProperty(o,"b",{enumerable:!0,get:function(){return f.Client}});var B=u(13369);var O=u(13346);var r=u(13405);const w=u(13426);const p=u(13428),K=u(13375);(0,K.registerSerializer)("schema",w.SchemaSerializer),(0,K.registerSerializer)("none",p.NoneSerializer)},13329:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=mm=>null!==mm&&"object"===typeof mm&&mm.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13348:(mm,o)=>{"use strict";function u(mm,o){if(this._offset=o,mm instanceof ArrayBuffer)this._buffer=mm,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(mm))throw new Error("Invalid argument");this._buffer=mm.buffer,this._view=new DataView(this._buffer,mm.byteOffset,mm.byteLength)}}Object.defineProperty(o,"__esModule",{value:!0}),o.decode=o.encode=void 0,u.prototype._array=function(mm){for(var o=new Array(mm),u=0;u<mm;u++)o[u]=this._parse();return o},u.prototype._map=function(mm){for(var o={},u=0;u<mm;u++)o[this._parse()]=this._parse();return o},u.prototype._str=function(mm){var o=function(mm,o,u){for(var f="",B=0,O=o,r=o+u;O<r;O++){var w=mm.getUint8(O);if(0!==(128&w))if(192!==(224&w))if(224!==(240&w)){if(240!==(248&w))throw new Error("Invalid byte "+w.toString(16));(B=(7&w)<<18|(63&mm.getUint8(++O))<<12|(63&mm.getUint8(++O))<<6|63&mm.getUint8(++O))>=65536?(B-=65536,f+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):f+=String.fromCharCode(B)}else f+=String.fromCharCode((15&w)<<12|(63&mm.getUint8(++O))<<6|63&mm.getUint8(++O));else f+=String.fromCharCode((31&w)<<6|63&mm.getUint8(++O));else f+=String.fromCharCode(w)}return f}(this._view,this._offset,mm);return this._offset+=mm,o},u.prototype._bin=function(mm){var o=this._buffer.slice(this._offset,this._offset+mm);return this._offset+=mm,o},u.prototype._parse=function(){var mm,o=this._view.getUint8(this._offset++),u=0,f=0,B=0,O=0;if(o<192)return o<128?o:o<144?this._map(15&o):o<160?this._array(15&o):this._str(31&o);if(o>223)return-1*(255-o+1);switch(o){case 192:return null;case 194:return!1;case 195:return!0;case 196:return u=this._view.getUint8(this._offset),this._offset+=1,this._bin(u);case 197:return u=this._view.getUint16(this._offset),this._offset+=2,this._bin(u);case 198:return u=this._view.getUint32(this._offset),this._offset+=4,this._bin(u);case 199:if(u=this._view.getUint8(this._offset),f=this._view.getInt8(this._offset+1),this._offset+=2,-1===f){var r=this._view.getUint32(this._offset);return B=this._view.getInt32(this._offset+4),O=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*B+O)+r/1e6)}return[f,this._bin(u)];case 200:return u=this._view.getUint16(this._offset),f=this._view.getInt8(this._offset+2),this._offset+=3,[f,this._bin(u)];case 201:return u=this._view.getUint32(this._offset),f=this._view.getInt8(this._offset+4),this._offset+=5,[f,this._bin(u)];case 202:return mm=this._view.getFloat32(this._offset),this._offset+=4,mm;case 203:return mm=this._view.getFloat64(this._offset),this._offset+=8,mm;case 204:return mm=this._view.getUint8(this._offset),this._offset+=1,mm;case 205:return mm=this._view.getUint16(this._offset),this._offset+=2,mm;case 206:return mm=this._view.getUint32(this._offset),this._offset+=4,mm;case 207:return B=this._view.getUint32(this._offset)*Math.pow(2,32),O=this._view.getUint32(this._offset+4),this._offset+=8,B+O;case 208:return mm=this._view.getInt8(this._offset),this._offset+=1,mm;case 209:return mm=this._view.getInt16(this._offset),this._offset+=2,mm;case 210:return mm=this._view.getInt32(this._offset),this._offset+=4,mm;case 211:return B=this._view.getInt32(this._offset)*Math.pow(2,32),O=this._view.getUint32(this._offset+4),this._offset+=8,B+O;case 212:return f=this._view.getInt8(this._offset),this._offset+=1,0===f?void(this._offset+=1):[f,this._bin(1)];case 213:return f=this._view.getInt8(this._offset),this._offset+=1,[f,this._bin(2)];case 214:return f=this._view.getInt8(this._offset),this._offset+=1,-1===f?(mm=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*mm)):[f,this._bin(4)];case 215:return f=this._view.getInt8(this._offset),this._offset+=1,0===f?(B=this._view.getInt32(this._offset)*Math.pow(2,32),O=this._view.getUint32(this._offset+4),this._offset+=8,new Date(B+O)):-1===f?(B=this._view.getUint32(this._offset),O=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&B)+O)+(B>>>2)/1e6)):[f,this._bin(8)];case 216:return f=this._view.getInt8(this._offset),this._offset+=1,[f,this._bin(16)];case 217:return u=this._view.getUint8(this._offset),this._offset+=1,this._str(u);case 218:return u=this._view.getUint16(this._offset),this._offset+=2,this._str(u);case 219:return u=this._view.getUint32(this._offset),this._offset+=4,this._str(u);case 220:return u=this._view.getUint16(this._offset),this._offset+=2,this._array(u);case 221:return u=this._view.getUint32(this._offset),this._offset+=4,this._array(u);case 222:return u=this._view.getUint16(this._offset),this._offset+=2,this._map(u);case 223:return u=this._view.getUint32(this._offset),this._offset+=4,this._map(u)}throw new Error("Could not parse")},o.decode=function(mm){var o=new u(mm,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),f=o._parse();if(o._offset!==mm.byteLength)throw new Error(mm.byteLength-o._offset+" trailing bytes");return f};function f(mm,o,u){for(var f=0,B=0,O=u.length;B<O;B++)(f=u.charCodeAt(B))<128?mm.setUint8(o++,f):f<2048?(mm.setUint8(o++,192|f>>6),mm.setUint8(o++,128|63&f)):f<55296||f>=57344?(mm.setUint8(o++,224|f>>12),mm.setUint8(o++,128|f>>6&63),mm.setUint8(o++,128|63&f)):(B++,f=65536+((1023&f)<<10|1023&u.charCodeAt(B)),mm.setUint8(o++,240|f>>18),mm.setUint8(o++,128|f>>12&63),mm.setUint8(o++,128|f>>6&63),mm.setUint8(o++,128|63&f))}function B(mm,o,u){var f=typeof u,O=0,r=0,w=0,p=0,K=0,z=0;if("string"===f){if(K=function(mm){for(var o=0,u=0,f=0,B=mm.length;f<B;f++)(o=mm.charCodeAt(f))<128?u+=1:o<2048?u+=2:o<55296||o>=57344?u+=3:(f++,u+=4);return u}(u),K<32)mm.push(160|K),z=1;else if(K<256)mm.push(217,K),z=2;else if(K<65536)mm.push(218,K>>8,K),z=3;else{if(!(K<4294967296))throw new Error("String too long");mm.push(219,K>>24,K>>16,K>>8,K),z=5}return o.push({_str:u,_length:K,_offset:mm.length}),z+K}if("number"===f)return Math.floor(u)===u&&isFinite(u)?u>=0?u<128?(mm.push(u),1):u<256?(mm.push(204,u),2):u<65536?(mm.push(205,u>>8,u),3):u<4294967296?(mm.push(206,u>>24,u>>16,u>>8,u),5):(w=u/Math.pow(2,32)|0,p=u>>>0,mm.push(207,w>>24,w>>16,w>>8,w,p>>24,p>>16,p>>8,p),9):u>=-32?(mm.push(u),1):u>=-128?(mm.push(208,u),2):u>=-32768?(mm.push(209,u>>8,u),3):u>=-2147483648?(mm.push(210,u>>24,u>>16,u>>8,u),5):(w=Math.floor(u/Math.pow(2,32)),p=u>>>0,mm.push(211,w>>24,w>>16,w>>8,w,p>>24,p>>16,p>>8,p),9):(mm.push(203),o.push({_float:u,_length:8,_offset:mm.length}),9);if("object"===f){if(null===u)return mm.push(192),1;if(Array.isArray(u)){if((K=u.length)<16)mm.push(144|K),z=1;else if(K<65536)mm.push(220,K>>8,K),z=3;else{if(!(K<4294967296))throw new Error("Array too large");mm.push(221,K>>24,K>>16,K>>8,K),z=5}for(O=0;O<K;O++)z+=B(mm,o,u[O]);return z}if(u instanceof Date){var Y=u.getTime(),q=Math.floor(Y/1e3),x=1e6*(Y-1e3*q);return q>=0&&x>=0&&q<=17179869183?0===x&&q<=4294967295?(mm.push(214,255,q>>24,q>>16,q>>8,q),6):(w=q/4294967296,p=4294967295&q,mm.push(215,255,x>>22,x>>14,x>>6,w,p>>24,p>>16,p>>8,p),10):(w=Math.floor(q/4294967296),p=q>>>0,mm.push(199,12,255,x>>24,x>>16,x>>8,x,w>>24,w>>16,w>>8,w,p>>24,p>>16,p>>8,p),15)}if(u instanceof ArrayBuffer){if((K=u.byteLength)<256)mm.push(196,K),z=2;else if(K<65536)mm.push(197,K>>8,K),z=3;else{if(!(K<4294967296))throw new Error("Buffer too large");mm.push(198,K>>24,K>>16,K>>8,K),z=5}return o.push({_bin:u,_length:K,_offset:mm.length}),z+K}if("function"===typeof u.toJSON)return B(mm,o,u.toJSON());var H=[],E="",M=Object.keys(u);for(O=0,r=M.length;O<r;O++)void 0!==u[E=M[O]]&&"function"!==typeof u[E]&&H.push(E);if((K=H.length)<16)mm.push(128|K),z=1;else if(K<65536)mm.push(222,K>>8,K),z=3;else{if(!(K<4294967296))throw new Error("Object too large");mm.push(223,K>>24,K>>16,K>>8,K),z=5}for(O=0;O<K;O++)z+=B(mm,o,E=H[O]),z+=B(mm,o,u[E]);return z}if("boolean"===f)return mm.push(u?195:194),1;if("undefined"===f)return mm.push(192),1;if("function"===typeof u.toJSON)return B(mm,o,u.toJSON());throw new Error("Could not encode")}o.encode=function(mm){var o=[],u=[],O=B(o,u,mm),r=new ArrayBuffer(O),w=new DataView(r),p=0,K=0,z=-1;u.length>0&&(z=u[0]._offset);for(var Y,q=0,x=0,H=0,E=o.length;H<E;H++)if(w.setUint8(K+H,o[H]),H+1===z){if(q=(Y=u[p])._length,x=K+z,Y._bin)for(var M=new Uint8Array(Y._bin),l=0;l<q;l++)w.setUint8(x+l,M[l]);else Y._str?f(w,x,Y._str):void 0!==Y._float&&w.setFloat64(x,Y._float);K+=q,u[++p]&&(z=u[p]._offset)}return r}},13428:(mm,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.NoneSerializer=void 0;o.NoneSerializer=class{setState(mm){}getState(){return null}patch(mm){}teardown(){}handshake(mm){}}},13426:(mm,o,u)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.SchemaSerializer=void 0;const f=u(13390);o.SchemaSerializer=class{setState(mm){return this.state.decode(mm)}getState(){return this.state}patch(mm){return this.state.decode(mm)}teardown(){var mm,o;null===(o=null===(mm=this.state)||void 0===mm?void 0:mm.$changes)||void 0===o||o.root.clearRefs()}handshake(mm,o){if(this.state){(new f.Reflection).decode(mm,o)}else this.state=f.Reflection.decode(mm,o)}}},13375:(mm,o)=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.getSerializer=o.registerSerializer=void 0;const u={};o.registerSerializer=function(mm,o){u[mm]=o},o.getSerializer=function(mm){const o=u[mm];if(!o)throw new Error("missing serializer: "+mm);return o}},13362:function(mm,o,u){"use strict";var f=this&&this.__importDefault||function(mm){return mm&&mm.__esModule?mm:{default:mm}};Object.defineProperty(o,"__esModule",{value:!0}),o.WebSocketTransport=void 0;const B=f(u(13364)),O=globalThis.WebSocket||B.default;o.WebSocketTransport=class{constructor(mm){this.events=mm}send(mm){mm instanceof ArrayBuffer?this.ws.send(mm):Array.isArray(mm)&&this.ws.send(new Uint8Array(mm).buffer)}connect(mm,o){try{this.ws=new O(mm,{headers:o,protocols:this.protocols})}catch(u){this.ws=new O(mm,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(mm,o){this.ws.close(mm,o)}get isOpen(){return this.ws.readyState===O.OPEN}}},13364:mm=>{"use strict";mm.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14603:mm=>{"use strict";mm.exports=function(mm){for(var o=new Array(mm),u=0;u<mm;++u)o[u]=u;return o}},14605:mm=>{function o(mm){return!!mm.constructor&&"function"===typeof mm.constructor.isBuffer&&mm.constructor.isBuffer(mm)}mm.exports=function(mm){return null!=mm&&(o(mm)||function(mm){return"function"===typeof mm.readFloatLE&&"function"===typeof mm.slice&&o(mm.slice(0,0))}(mm)||!!mm._isBuffer)}},14594:(mm,o,u)=>{var f=u(14603),B=u(14605),O="undefined"!==typeof Float64Array;function r(mm,o){return mm[0]-o[0]}function w(){var mm,o=this.stride,u=new Array(o.length);for(mm=0;mm<u.length;++mm)u[mm]=[Math.abs(o[mm]),mm];u.sort(r);var f=new Array(u.length);for(mm=0;mm<f.length;++mm)f[mm]=u[mm][1];return f}function p(mm,o){var u=["View",o,"d",mm].join("");o<0&&(u="View_Nil"+mm);var B="generic"===mm;if(-1===o){var O="function "+u+"(a){this.data=a;};var proto="+u+".prototype;proto.dtype='"+mm+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+u+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+u+"(a){return new "+u+"(a);}";return new Function(O)()}if(0===o){O="function "+u+"(a,d) {this.data = a;this.offset = d};var proto="+u+".prototype;proto.dtype='"+mm+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+u+"_copy() {return new "+u+"(this.data,this.offset)};proto.pick=function "+u+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+u+"_get(){return "+(B?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+u+"_set(v){return "+(B?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+u+"(a,b,c,d){return new "+u+"(a,d)}";return new Function("TrivialArray",O)(K[mm][0])}O=["'use strict'"];var r=f(o),p=r.map((function(mm){return"i"+mm})),z="this.offset+"+r.map((function(mm){return"this.stride["+mm+"]*i"+mm})).join("+"),Y=r.map((function(mm){return"b"+mm})).join(","),q=r.map((function(mm){return"c"+mm})).join(",");O.push("function "+u+"(a,"+Y+","+q+",d){this.data=a","this.shape=["+Y+"]","this.stride=["+q+"]","this.offset=d|0}","var proto="+u+".prototype","proto.dtype='"+mm+"'","proto.dimension="+o),O.push("Object.defineProperty(proto,'size',{get:function "+u+"_size(){return "+r.map((function(mm){return"this.shape["+mm+"]"})).join("*"),"}})"),1===o?O.push("proto.order=[0]"):(O.push("Object.defineProperty(proto,'order',{get:"),o<4?(O.push("function "+u+"_order(){"),2===o?O.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===o&&O.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):O.push("ORDER})")),O.push("proto.set=function "+u+"_set("+p.join(",")+",v){"),B?O.push("return this.data.set("+z+",v)}"):O.push("return this.data["+z+"]=v}"),O.push("proto.get=function "+u+"_get("+p.join(",")+"){"),B?O.push("return this.data.get("+z+")}"):O.push("return this.data["+z+"]}"),O.push("proto.index=function "+u+"_index(",p.join(),"){return "+z+"}"),O.push("proto.hi=function "+u+"_hi("+p.join(",")+"){return new "+u+"(this.data,"+r.map((function(mm){return["(typeof i",mm,"!=='number'||i",mm,"<0)?this.shape[",mm,"]:i",mm,"|0"].join("")})).join(",")+","+r.map((function(mm){return"this.stride["+mm+"]"})).join(",")+",this.offset)}");var x=r.map((function(mm){return"a"+mm+"=this.shape["+mm+"]"})),H=r.map((function(mm){return"c"+mm+"=this.stride["+mm+"]"}));O.push("proto.lo=function "+u+"_lo("+p.join(",")+"){var b=this.offset,d=0,"+x.join(",")+","+H.join(","));for(var E=0;E<o;++E)O.push("if(typeof i"+E+"==='number'&&i"+E+">=0){d=i"+E+"|0;b+=c"+E+"*d;a"+E+"-=d}");O.push("return new "+u+"(this.data,"+r.map((function(mm){return"a"+mm})).join(",")+","+r.map((function(mm){return"c"+mm})).join(",")+",b)}"),O.push("proto.step=function "+u+"_step("+p.join(",")+"){var "+r.map((function(mm){return"a"+mm+"=this.shape["+mm+"]"})).join(",")+","+r.map((function(mm){return"b"+mm+"=this.stride["+mm+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(E=0;E<o;++E)O.push("if(typeof i"+E+"==='number'){d=i"+E+"|0;if(d<0){c+=b"+E+"*(a"+E+"-1);a"+E+"=ceil(-a"+E+"/d)}else{a"+E+"=ceil(a"+E+"/d)}b"+E+"*=d}");O.push("return new "+u+"(this.data,"+r.map((function(mm){return"a"+mm})).join(",")+","+r.map((function(mm){return"b"+mm})).join(",")+",c)}");var M=new Array(o),l=new Array(o);for(E=0;E<o;++E)M[E]="a[i"+E+"]",l[E]="b[i"+E+"]";O.push("proto.transpose=function "+u+"_transpose("+p+"){"+p.map((function(mm,o){return mm+"=("+mm+"===undefined?"+o+":"+mm+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+u+"(this.data,"+M.join(",")+","+l.join(",")+",this.offset)}"),O.push("proto.pick=function "+u+"_pick("+p+"){var a=[],b=[],c=this.offset");for(E=0;E<o;++E)O.push("if(typeof i"+E+"==='number'&&i"+E+">=0){c=(c+this.stride["+E+"]*i"+E+")|0}else{a.push(this.shape["+E+"]);b.push(this.stride["+E+"])}");return O.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),O.push("return function construct_"+u+"(data,shape,stride,offset){return new "+u+"(data,"+r.map((function(mm){return"shape["+mm+"]"})).join(",")+","+r.map((function(mm){return"stride["+mm+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",O.join("\n"))(K[mm],w)}var K={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};mm.exports=function(mm,o,u,f){if(void 0===mm)return(0,K.array[0])([]);"number"===typeof mm&&(mm=[mm]),void 0===o&&(o=[mm.length]);var r=o.length;if(void 0===u){u=new Array(r);for(var w=r-1,z=1;w>=0;--w)u[w]=z,z*=o[w]}if(void 0===f){f=0;for(w=0;w<r;++w)u[w]<0&&(f-=(o[w]-1)*u[w])}for(var Y=function(mm){if(B(mm))return"buffer";if(O)switch(Object.prototype.toString.call(mm)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(mm)?"array":"generic"}(mm),q=K[Y];q.length<=r+1;)q.push(p(Y,q.length-1));return(0,q[r+1])(mm,o,u,f)}},14567:mm=>{var o;self,o=()=>(()=>{"use strict";var mm={d:(o,u)=>{for(var f in u)mm.o(u,f)&&!mm.o(o,f)&&Object.defineProperty(o,f,{enumerable:!0,get:u[f]})},o:(mm,o)=>Object.prototype.hasOwnProperty.call(mm,o)},o={};mm.d(o,{default:()=>I});var u,f=function(mm,o){var u=o.x-mm.x,f=o.y-mm.y;return Math.sqrt(u*u+f*f)},B=function(mm){return mm*(Math.PI/180)},O=new Map,r=function(mm){O.has(mm)&&clearTimeout(O.get(mm)),O.set(mm,setTimeout(mm,100))},w=function(mm,o,u){for(var f,B=o.split(/[ ,]+/g),O=0;O<B.length;O+=1)f=B[O],mm.addEventListener?mm.addEventListener(f,u,!1):mm.attachEvent&&mm.attachEvent(f,u)},p=function(mm,o,u){for(var f,B=o.split(/[ ,]+/g),O=0;O<B.length;O+=1)f=B[O],mm.removeEventListener?mm.removeEventListener(f,u):mm.detachEvent&&mm.detachEvent(f,u)},K=function(mm){return mm.preventDefault(),mm.type.match(/^touch/)?mm.changedTouches:mm},z=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},Y=function(mm,o){o.top||o.right||o.bottom||o.left?(mm.style.top=o.top,mm.style.right=o.right,mm.style.bottom=o.bottom,mm.style.left=o.left):(mm.style.left=o.x+"px",mm.style.top=o.y+"px")},q=function(mm,o,u){var f=x(mm);for(var B in f)if(f.hasOwnProperty(B))if("string"==typeof o)f[B]=o+" "+u;else{for(var O="",r=0,w=o.length;r<w;r+=1)O+=o[r]+" "+u+", ";f[B]=O.slice(0,-2)}return f},x=function(mm){var o={};return o[mm]="",["webkit","Moz","o"].forEach((function(u){o[u+mm.charAt(0).toUpperCase()+mm.slice(1)]=""})),o},H=function(mm,o){for(var u in o)o.hasOwnProperty(u)&&(mm[u]=o[u]);return mm},E=function(mm,o){if(mm.length)for(var u=0,f=mm.length;u<f;u+=1)o(mm[u]);else o(mm)},M="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,l=window.matchMedia("(any-hover: none)").matches,t=!!("ontouchstart"in window),Q=!!window.PointerEvent,b=!!window.MSPointerEvent,J={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},N={start:"mousedown",move:"mousemove",end:"mouseup"},S={};function P(){}M&&!l?u=J:Q?u={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:b?u={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:t?(u=J,S=N):u=N,P.prototype.on=function(mm,o){var u,f=this,B=mm.split(/[ ,]+/g);f._handlers_=f._handlers_||{};for(var O=0;O<B.length;O+=1)u=B[O],f._handlers_[u]=f._handlers_[u]||[],f._handlers_[u].push(o);return f},P.prototype.off=function(mm,o){var u=this;return u._handlers_=u._handlers_||{},void 0===mm?u._handlers_={}:void 0===o?u._handlers_[mm]=null:u._handlers_[mm]&&u._handlers_[mm].indexOf(o)>=0&&u._handlers_[mm].splice(u._handlers_[mm].indexOf(o),1),u},P.prototype.trigger=function(mm,o){var u,f=this,B=mm.split(/[ ,]+/g);f._handlers_=f._handlers_||{};for(var O=0;O<B.length;O+=1)u=B[O],f._handlers_[u]&&f._handlers_[u].length&&f._handlers_[u].forEach((function(mm){mm.call(f,{type:u,target:f},o)}))},P.prototype.config=function(mm){var o=this;o.options=o.defaults||{},mm&&(o.options=function(mm,o){var u={};for(var f in mm)mm.hasOwnProperty(f)&&o.hasOwnProperty(f)?u[f]=o[f]:mm.hasOwnProperty(f)&&(u[f]=mm[f]);return u}(o.options,mm))},P.prototype.bindEvt=function(mm,o){var f=this;return f._domHandlers_=f._domHandlers_||{},f._domHandlers_[o]=function(){"function"==typeof f["on"+o]?f["on"+o].apply(f,arguments):console.warn('[WARNING] : Missing "on'+o+'" handler.')},w(mm,u[o],f._domHandlers_[o]),S[o]&&w(mm,S[o],f._domHandlers_[o]),f},P.prototype.unbindEvt=function(mm,o){var f=this;return f._domHandlers_=f._domHandlers_||{},p(mm,u[o],f._domHandlers_[o]),S[o]&&p(mm,S[o],f._domHandlers_[o]),delete f._domHandlers_[o],this};const R=P;function g(mm,o){return this.identifier=o.identifier,this.position=o.position,this.frontPosition=o.frontPosition,this.collection=mm,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(o),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=g.id,g.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}g.prototype=new R,g.constructor=g,g.id=0,g.prototype.buildEl=function(mm){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},g.prototype.stylize=function(){if(this.options.dataOnly)return this;var mm=this.options.fadeTime+"ms",o=function(){var mm=x("borderRadius");for(var o in mm)mm.hasOwnProperty(o)&&(mm[o]="50%");return mm}(),u=q("transition","opacity",mm),f={};return f.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},f.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},f.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},H(f.el,u),"circle"===this.options.shape&&H(f.back,o),H(f.front,o),this.applyStyles(f),this},g.prototype.applyStyles=function(mm){for(var o in this.ui)if(this.ui.hasOwnProperty(o))for(var u in mm[o])this.ui[o].style[u]=mm[o][u];return this},g.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},g.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},g.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},g.prototype.show=function(mm){var o=this;return o.options.dataOnly||(clearTimeout(o.removeTimeout),clearTimeout(o.showTimeout),clearTimeout(o.restTimeout),o.addToDom(),o.restCallback(),setTimeout((function(){o.ui.el.style.opacity=1}),0),o.showTimeout=setTimeout((function(){o.trigger("shown",o.instance),"function"==typeof mm&&mm.call(this)}),o.options.fadeTime)),o},g.prototype.hide=function(mm){var o=this;if(o.options.dataOnly)return o;if(o.ui.el.style.opacity=o.options.restOpacity,clearTimeout(o.removeTimeout),clearTimeout(o.showTimeout),clearTimeout(o.restTimeout),o.removeTimeout=setTimeout((function(){var u="dynamic"===o.options.mode?"none":"block";o.ui.el.style.display=u,"function"==typeof mm&&mm.call(o),o.trigger("hidden",o.instance)}),o.options.fadeTime),o.options.restJoystick){var u=o.options.restJoystick,f={};f.x=!0===u||!1!==u.x?0:o.instance.frontPosition.x,f.y=!0===u||!1!==u.y?0:o.instance.frontPosition.y,o.setPosition(mm,f)}return o},g.prototype.setPosition=function(mm,o){var u=this;u.frontPosition={x:o.x,y:o.y};var f=u.options.fadeTime+"ms",B={};B.front=q("transition",["transform"],f);var O={front:{}};O.front={transform:"translate("+u.frontPosition.x+"px,"+u.frontPosition.y+"px)"},u.applyStyles(B),u.applyStyles(O),u.restTimeout=setTimeout((function(){"function"==typeof mm&&mm.call(u),u.restCallback()}),u.options.fadeTime)},g.prototype.restCallback=function(){var mm=this,o={};o.front=q("transition","none",""),mm.applyStyles(o),mm.trigger("rested",mm.instance)},g.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},g.prototype.computeDirection=function(mm){var o,u,f,B=mm.angle.radian,O=Math.PI/4,r=Math.PI/2;if(B>O&&B<3*O&&!mm.lockX?o="up":B>-O&&B<=O&&!mm.lockY?o="left":B>3*-O&&B<=-O&&!mm.lockX?o="down":mm.lockY||(o="right"),mm.lockY||(u=B>-r&&B<r?"left":"right"),mm.lockX||(f=B>0?"up":"down"),mm.force>this.options.threshold){var w,p={};for(w in this.direction)this.direction.hasOwnProperty(w)&&(p[w]=this.direction[w]);var K={};for(w in this.direction={x:u,y:f,angle:o},mm.direction=this.direction,p)p[w]===this.direction[w]&&(K[w]=!0);if(K.x&&K.y&&K.angle)return mm;K.x&&K.y||this.trigger("plain",mm),K.x||this.trigger("plain:"+u,mm),K.y||this.trigger("plain:"+f,mm),K.angle||this.trigger("dir dir:"+o,mm)}else this.resetDirection();return mm};const W=g;function F(mm,o){var u=this;u.nipples=[],u.idles=[],u.actives=[],u.ids=[],u.pressureIntervals={},u.manager=mm,u.id=F.id,F.id+=1,u.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},u.config(o),"static"!==u.options.mode&&"semi"!==u.options.mode||(u.options.multitouch=!1),u.options.multitouch||(u.options.maxNumberOfNipples=1);var f=getComputedStyle(u.options.zone.parentElement);return f&&"flex"===f.display&&(u.parentIsFlex=!0),u.updateBox(),u.prepareNipples(),u.nq(),u.begin(),u.nipples}F.prototype=new R,F.constructor=F,F.id=0,F.prototype.prepareNipples=function(){var mm=this,o=mm.nipples;o.on=mm.on.bind(mm),o.off=mm.off.bind(mm),o.options=mm.options,o.destroy=mm.destroy.bind(mm),o.ids=mm.ids,o.id=mm.id,o.processOnMove=mm.processOnMove.bind(mm),o.processOnEnd=mm.processOnEnd.bind(mm),o.get=function(mm){if(void 0===mm)return o[0];for(var u=0,f=o.length;u<f;u+=1)if(o[u].identifier===mm)return o[u];return!1}},F.prototype.nq=function(){var mm=this;mm.bindEvt(mm.options.zone,"start"),mm.options.zone.style.touchAction="none",mm.options.zone.style.msTouchAction="none"},F.prototype.begin=function(){var mm=this,o=mm.options;if("static"===o.mode){var u=mm.createNipple(o.position,mm.manager.getIdentifier());u.add(),mm.idles.push(u)}},F.prototype.createNipple=function(mm,o){var u=this,f=u.manager.scroll,B={},O=u.options,r=u.parentIsFlex?f.x:f.x+u.box.left,w=u.parentIsFlex?f.y:f.y+u.box.top;if(mm.x&&mm.y)B={x:mm.x-r,y:mm.y-w};else if(mm.top||mm.right||mm.bottom||mm.left){var p=document.createElement("DIV");p.style.display="hidden",p.style.top=mm.top,p.style.right=mm.right,p.style.bottom=mm.bottom,p.style.left=mm.left,p.style.position="absolute",O.zone.appendChild(p);var K=p.getBoundingClientRect();O.zone.removeChild(p),B=mm,mm={x:K.left+f.x,y:K.top+f.y}}var z=new W(u,{color:O.color,size:O.size,threshold:O.threshold,fadeTime:O.fadeTime,dataOnly:O.dataOnly,restJoystick:O.restJoystick,restOpacity:O.restOpacity,mode:O.mode,identifier:o,position:mm,zone:O.zone,frontPosition:{x:0,y:0},shape:O.shape});return O.dataOnly||(Y(z.ui.el,B),Y(z.ui.front,z.frontPosition)),u.nipples.push(z),u.trigger("added "+z.identifier+":added",z),u.manager.trigger("added "+z.identifier+":added",z),u.bindNipple(z),z},F.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},F.prototype.bindNipple=function(mm){var o,u=this,f=function(mm,f){o=mm.type+" "+f.id+":"+mm.type,u.trigger(o,f)};mm.on("destroyed",u.onDestroyed.bind(u)),mm.on("shown hidden rested dir plain",f),mm.on("dir:up dir:right dir:down dir:left",f),mm.on("plain:up plain:right plain:down plain:left",f)},F.prototype.pressureFn=function(mm,o,u){var f=this,B=0;clearInterval(f.pressureIntervals[u]),f.pressureIntervals[u]=setInterval(function(){var u=mm.force||mm.pressure||mm.webkitForce||0;u!==B&&(o.trigger("pressure",u),f.trigger("pressure "+o.identifier+":pressure",u),B=u)}.bind(f),100)},F.prototype.onstart=function(mm){var o=this,u=o.options,f=mm;return mm=K(mm),o.updateBox(),E(mm,(function(B){o.actives.length<u.maxNumberOfNipples?o.processOnStart(B):f.type.match(/^touch/)&&(Object.keys(o.manager.ids).forEach((function(u){if(Object.values(f.touches).findIndex((function(mm){return mm.identifier===u}))<0){var B=[mm[0]];B.identifier=u,o.processOnEnd(B)}})),o.actives.length<u.maxNumberOfNipples&&o.processOnStart(B))})),o.manager.bindDocument(),!1},F.prototype.processOnStart=function(mm){var o,u=this,B=u.options,O=u.manager.getIdentifier(mm),r=mm.force||mm.pressure||mm.webkitForce||0,w={x:mm.pageX,y:mm.pageY},p=u.getOrCreate(O,w);p.identifier!==O&&u.manager.removeIdentifier(p.identifier),p.identifier=O;var K=function(o){o.trigger("start",o),u.trigger("start "+o.id+":start",o),o.show(),r>0&&u.pressureFn(mm,o,o.identifier),u.processOnMove(mm)};if((o=u.idles.indexOf(p))>=0&&u.idles.splice(o,1),u.actives.push(p),u.ids.push(p.identifier),"semi"!==B.mode)K(p);else{if(!(f(w,p.position)<=B.catchDistance))return p.destroy(),void u.processOnStart(mm);K(p)}return p},F.prototype.getOrCreate=function(mm,o){var u,f=this,B=f.options;return/(semi|static)/.test(B.mode)?(u=f.idles[0])?(f.idles.splice(0,1),u):"semi"===B.mode?f.createNipple(o,mm):(console.warn("Coudln't find the needed nipple."),!1):u=f.createNipple(o,mm)},F.prototype.processOnMove=function(mm){var o=this,u=o.options,O=o.manager.getIdentifier(mm),r=o.nipples.get(O),w=o.manager.scroll;if(function(mm){return isNaN(mm.buttons)?0!==mm.pressure:0!==mm.buttons}(mm)){if(!r)return console.error("Found zombie joystick with ID "+O),void o.manager.removeIdentifier(O);if(u.dynamicPage){var p=r.el.getBoundingClientRect();r.position={x:w.x+p.left,y:w.y+p.top}}r.identifier=O;var K=r.options.size/2,z={x:mm.pageX,y:mm.pageY};u.lockX&&(z.y=r.position.y),u.lockY&&(z.x=r.position.x);var Y,q,x,H,E,M,l,t,Q,b,J=f(z,r.position),N=(Y=z,x=(q=r.position).x-Y.x,H=q.y-Y.y,function(mm){return mm*(180/Math.PI)}(Math.atan2(H,x))),S=B(N),P=J/K,R={distance:J,position:z};if("circle"===r.options.shape?(E=Math.min(J,K),l=r.position,t=E,b={x:0,y:0},Q=B(Q=N),b.x=l.x-t*Math.cos(Q),b.y=l.y-t*Math.sin(Q),M=b):(M=function(mm,o,u){return{x:Math.min(Math.max(mm.x,o.x-u),o.x+u),y:Math.min(Math.max(mm.y,o.y-u),o.y+u)}}(z,r.position,K),E=f(M,r.position)),u.follow){if(J>K){var g=z.x-M.x,W=z.y-M.y;r.position.x+=g,r.position.y+=W,r.el.style.top=r.position.y-(o.box.top+w.y)+"px",r.el.style.left=r.position.x-(o.box.left+w.x)+"px",J=f(z,r.position)}}else z=M,J=E;var F=z.x-r.position.x,c=z.y-r.position.y;r.frontPosition={x:F,y:c},u.dataOnly||(r.ui.front.style.transform="translate("+F+"px,"+c+"px)");var A={identifier:r.identifier,position:z,force:P,pressure:mm.force||mm.pressure||mm.webkitForce||0,distance:J,angle:{radian:S,degree:N},vector:{x:F/K,y:-c/K},raw:R,instance:r,lockX:u.lockX,lockY:u.lockY};(A=r.computeDirection(A)).angle={radian:B(180-N),degree:180-N},r.trigger("move",A),o.trigger("move "+r.id+":move",A)}else this.processOnEnd(mm)},F.prototype.processOnEnd=function(mm){var o=this,u=o.options,f=o.manager.getIdentifier(mm),B=o.nipples.get(f),O=o.manager.removeIdentifier(B.identifier);B&&(u.dataOnly||B.hide((function(){"dynamic"===u.mode&&(B.trigger("removed",B),o.trigger("removed "+B.id+":removed",B),o.manager.trigger("removed "+B.id+":removed",B),B.destroy())})),clearInterval(o.pressureIntervals[B.identifier]),B.resetDirection(),B.trigger("end",B),o.trigger("end "+B.id+":end",B),o.ids.indexOf(B.identifier)>=0&&o.ids.splice(o.ids.indexOf(B.identifier),1),o.actives.indexOf(B)>=0&&o.actives.splice(o.actives.indexOf(B),1),/(semi|static)/.test(u.mode)?o.idles.push(B):o.nipples.indexOf(B)>=0&&o.nipples.splice(o.nipples.indexOf(B),1),o.manager.unbindDocument(),/(semi|static)/.test(u.mode)&&(o.manager.ids[O.id]=O.identifier))},F.prototype.onDestroyed=function(mm,o){var u=this;u.nipples.indexOf(o)>=0&&u.nipples.splice(u.nipples.indexOf(o),1),u.actives.indexOf(o)>=0&&u.actives.splice(u.actives.indexOf(o),1),u.idles.indexOf(o)>=0&&u.idles.splice(u.idles.indexOf(o),1),u.ids.indexOf(o.identifier)>=0&&u.ids.splice(u.ids.indexOf(o.identifier),1),u.manager.removeIdentifier(o.identifier),u.manager.unbindDocument()},F.prototype.destroy=function(){var mm=this;for(var o in mm.unbindEvt(mm.options.zone,"start"),mm.nipples.forEach((function(mm){mm.destroy()})),mm.pressureIntervals)mm.pressureIntervals.hasOwnProperty(o)&&clearInterval(mm.pressureIntervals[o]);mm.trigger("destroyed",mm.nipples),mm.manager.unbindDocument(),mm.off()};const c=F;function A(mm){var o=this;o.ids={},o.index=0,o.collections=[],o.scroll=z(),o.config(mm),o.prepareCollections();var u=function(){var mm;o.collections.forEach((function(u){u.forEach((function(u){mm=u.el.getBoundingClientRect(),u.position={x:o.scroll.x+mm.left,y:o.scroll.y+mm.top}}))}))};w(window,"resize",(function(){r(u)}));var f=function(){o.scroll=z()};return w(window,"scroll",(function(){r(f)})),o.collections}A.prototype=new R,A.constructor=A,A.prototype.prepareCollections=function(){var mm=this;mm.collections.create=mm.create.bind(mm),mm.collections.on=mm.on.bind(mm),mm.collections.off=mm.off.bind(mm),mm.collections.destroy=mm.destroy.bind(mm),mm.collections.get=function(o){var u;return mm.collections.every((function(mm){return!(u=mm.get(o))})),u}},A.prototype.create=function(mm){return this.createCollection(mm)},A.prototype.createCollection=function(mm){var o=this,u=new c(o,mm);return o.bindCollection(u),o.collections.push(u),u},A.prototype.bindCollection=function(mm){var o,u=this,f=function(mm,f){o=mm.type+" "+f.id+":"+mm.type,u.trigger(o,f)};mm.on("destroyed",u.onDestroyed.bind(u)),mm.on("shown hidden rested dir plain",f),mm.on("dir:up dir:right dir:down dir:left",f),mm.on("plain:up plain:right plain:down plain:left",f)},A.prototype.bindDocument=function(){var mm=this;mm.binded||(mm.bindEvt(document,"move").bindEvt(document,"end"),mm.binded=!0)},A.prototype.unbindDocument=function(mm){var o=this;Object.keys(o.ids).length&&!0!==mm||(o.unbindEvt(document,"move").unbindEvt(document,"end"),o.binded=!1)},A.prototype.getIdentifier=function(mm){var o;return mm?void 0===(o=void 0===mm.identifier?mm.pointerId:mm.identifier)&&(o=this.latest||0):o=this.index,void 0===this.ids[o]&&(this.ids[o]=this.index,this.index+=1),this.latest=o,this.ids[o]},A.prototype.removeIdentifier=function(mm){var o={};for(var u in this.ids)if(this.ids[u]===mm){o.id=u,o.identifier=this.ids[u],delete this.ids[u];break}return o},A.prototype.onmove=function(mm){return this.onAny("move",mm),!1},A.prototype.onend=function(mm){return this.onAny("end",mm),!1},A.prototype.oncancel=function(mm){return this.onAny("end",mm),!1},A.prototype.onAny=function(mm,o){var u,f=this,B="processOn"+mm.charAt(0).toUpperCase()+mm.slice(1);o=K(o);var O=function(mm,o,u){u.ids.indexOf(o)>=0&&(u[B](mm),mm._found_=!0)};return E(o,(function(mm){u=f.getIdentifier(mm),E(f.collections,O.bind(null,mm,u)),mm._found_||f.removeIdentifier(u)})),!1},A.prototype.destroy=function(){var mm=this;mm.unbindDocument(!0),mm.ids={},mm.index=0,mm.collections.forEach((function(mm){mm.destroy()})),mm.off()},A.prototype.onDestroyed=function(mm,o){var u=this;if(u.collections.indexOf(o)<0)return!1;u.collections.splice(u.collections.indexOf(o),1)};var y=new A;const I={create:function(mm){return y.create(mm)},factory:y};return o.default})(),mm.exports=o()},14625:(mm,o,u)=>{"use strict";const{Deflate:f,deflate:B,deflateRaw:O,gzip:r}=u(14628),{Inflate:w,inflate:p,inflateRaw:K,ungzip:z}=u(14688),Y=u(14665);mm.exports.Deflate=f,mm.exports.deflate=B,mm.exports.deflateRaw=O,mm.exports.gzip=r,mm.exports.Inflate=w,mm.exports.inflate=p,mm.exports.inflateRaw=K,mm.exports.ungzip=z,mm.exports.constants=Y},14628:(mm,o,u)=>{"use strict";const f=u(14637),B=u(14674),O=u(14682),r=u(14660),w=u(14684),p=Object.prototype.toString,{Z_NO_FLUSH:K,Z_SYNC_FLUSH:z,Z_FULL_FLUSH:Y,Z_FINISH:q,Z_OK:x,Z_STREAM_END:H,Z_DEFAULT_COMPRESSION:E,Z_DEFAULT_STRATEGY:M,Z_DEFLATED:l}=u(14665);function t(mm){this.options=B.assign({level:E,method:l,dm:16384,windowBits:15,memLevel:8,strategy:M},mm||{});let o=this.options;o.raw&&o.windowBits>0?o.windowBits=-o.windowBits:o.gzip&&o.windowBits>0&&o.windowBits<16&&(o.windowBits+=16),this.err=0,this.qo="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;let u=f.deflateInit2(this.strm,o.level,o.method,o.windowBits,o.memLevel,o.strategy);if(u!==x)throw new Error(r[u]);if(o.header&&f.deflateSetHeader(this.strm,o.header),o.dictionary){let mm;if(mm="string"===typeof o.dictionary?O.string2buf(o.dictionary):"[object ArrayBuffer]"===p.call(o.dictionary)?new Uint8Array(o.dictionary):o.dictionary,u=f.deflateSetDictionary(this.strm,mm),u!==x)throw new Error(r[u]);this._dict_set=!0}}function Q(mm,o){const u=new t(o);if(u.push(mm,!0),u.err)throw u.qo||r[u.err];return u.result}t.prototype.push=function(mm,o){const u=this.strm,B=this.options.dm;let r,w;if(this.ended)return!1;for(w=o===~~o?o:!0===o?q:K,"string"===typeof mm?u.input=O.string2buf(mm):"[object ArrayBuffer]"===p.call(mm)?u.input=new Uint8Array(mm):u.input=mm,u.next_in=0,u.avail_in=u.input.length;;)if(0===u.avail_out&&(u.output=new Uint8Array(B),u.next_out=0,u.avail_out=B),(w===z||w===Y)&&u.avail_out<=6)this.onData(u.output.subarray(0,u.next_out)),u.avail_out=0;else{if(r=f.deflate(u,w),r===H)return u.next_out>0&&this.onData(u.output.subarray(0,u.next_out)),r=f.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===x;if(0!==u.avail_out){if(w>0&&u.next_out>0)this.onData(u.output.subarray(0,u.next_out)),u.avail_out=0;else if(0===u.avail_in)break}else this.onData(u.output)}return!0},t.prototype.onData=function(mm){this.chunks.push(mm)},t.prototype.onEnd=function(mm){mm===x&&(this.result=B.flattenChunks(this.chunks)),this.chunks=[],this.err=mm,this.qo=this.strm.qo},mm.exports.Deflate=t,mm.exports.deflate=Q,mm.exports.deflateRaw=function(mm,o){return(o=o||{}).raw=!0,Q(mm,o)},mm.exports.gzip=function(mm,o){return(o=o||{}).gzip=!0,Q(mm,o)},mm.exports.constants=u(14665)},14688:(mm,o,u)=>{"use strict";const f=u(14694),B=u(14674),O=u(14682),r=u(14660),w=u(14684),p=u(14709),K=Object.prototype.toString,{Z_NO_FLUSH:z,Z_FINISH:Y,Z_OK:q,Z_STREAM_END:x,Z_NEED_DICT:H,Z_STREAM_ERROR:E,Z_DATA_ERROR:M,Z_MEM_ERROR:l}=u(14665);function t(mm){this.options=B.assign({dm:65536,windowBits:15,to:""},mm||{});const o=this.options;o.raw&&o.windowBits>=0&&o.windowBits<16&&(o.windowBits=-o.windowBits,0===o.windowBits&&(o.windowBits=-15)),!(o.windowBits>=0&&o.windowBits<16)||mm&&mm.windowBits||(o.windowBits+=32),o.windowBits>15&&o.windowBits<48&&0===(15&o.windowBits)&&(o.windowBits|=15),this.err=0,this.qo="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;let u=f.inflateInit2(this.strm,o.windowBits);if(u!==q)throw new Error(r[u]);if(this.header=new p,f.inflateGetHeader(this.strm,this.header),o.dictionary&&("string"===typeof o.dictionary?o.dictionary=O.string2buf(o.dictionary):"[object ArrayBuffer]"===K.call(o.dictionary)&&(o.dictionary=new Uint8Array(o.dictionary)),o.raw&&(u=f.inflateSetDictionary(this.strm,o.dictionary),u!==q)))throw new Error(r[u])}function Q(mm,o){const u=new t(o);if(u.push(mm),u.err)throw u.qo||r[u.err];return u.result}t.prototype.push=function(mm,o){const u=this.strm,B=this.options.dm,r=this.options.dictionary;let w,p,t;if(this.ended)return!1;for(p=o===~~o?o:!0===o?Y:z,"[object ArrayBuffer]"===K.call(mm)?u.input=new Uint8Array(mm):u.input=mm,u.next_in=0,u.avail_in=u.input.length;;){for(0===u.avail_out&&(u.output=new Uint8Array(B),u.next_out=0,u.avail_out=B),w=f.inflate(u,p),w===H&&r&&(w=f.inflateSetDictionary(u,r),w===q?w=f.inflate(u,p):w===M&&(w=H));u.avail_in>0&&w===x&&u.state.wrap>0&&0!==mm[u.next_in];)f.inflateReset(u),w=f.inflate(u,p);switch(w){case E:case M:case H:case l:return this.onEnd(w),this.ended=!0,!1}if(t=u.avail_out,u.next_out&&(0===u.avail_out||w===x))if("string"===this.options.to){let mm=O.utf8border(u.output,u.next_out),o=u.next_out-mm,f=O.buf2string(u.output,mm);u.next_out=o,u.avail_out=B-o,o&&u.output.set(u.output.subarray(mm,mm+o),0),this.onData(f)}else this.onData(u.output.length===u.next_out?u.output:u.output.subarray(0,u.next_out));if(w!==q||0!==t){if(w===x)return w=f.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,!0;if(0===u.avail_in)break}}return!0},t.prototype.onData=function(mm){this.chunks.push(mm)},t.prototype.onEnd=function(mm){mm===q&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=B.flattenChunks(this.chunks)),this.chunks=[],this.err=mm,this.qo=this.strm.qo},mm.exports.Inflate=t,mm.exports.inflate=Q,mm.exports.inflateRaw=function(mm,o){return(o=o||{}).raw=!0,Q(mm,o)},mm.exports.ungzip=Q,mm.exports.constants=u(14665)},14674:mm=>{"use strict";const o=(mm,o)=>Object.prototype.hasOwnProperty.call(mm,o);mm.exports.assign=function(mm){const u=Array.prototype.slice.call(arguments,1);for(;u.length;){const f=u.shift();if(f){if("object"!==typeof f)throw new TypeError(f+"must be non-object");for(const u in f)o(f,u)&&(mm[u]=f[u])}}return mm},mm.exports.flattenChunks=mm=>{let o=0;for(let f=0,B=mm.length;f<B;f++)o+=mm[f].length;const u=new Uint8Array(o);for(let f=0,B=0,O=mm.length;f<O;f++){let o=mm[f];u.set(o,B),B+=o.length}return u}},14682:mm=>{"use strict";let o=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(f){o=!1}const u=new Uint8Array(256);for(let B=0;B<256;B++)u[B]=B>=252?6:B>=248?5:B>=240?4:B>=224?3:B>=192?2:1;u[254]=u[254]=1,mm.exports.string2buf=mm=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(mm);let o,u,f,B,O,r=mm.length,w=0;for(B=0;B<r;B++)u=mm.charCodeAt(B),55296===(64512&u)&&B+1<r&&(f=mm.charCodeAt(B+1),56320===(64512&f)&&(u=65536+(u-55296<<10)+(f-56320),B++)),w+=u<128?1:u<2048?2:u<65536?3:4;for(o=new Uint8Array(w),O=0,B=0;O<w;B++)u=mm.charCodeAt(B),55296===(64512&u)&&B+1<r&&(f=mm.charCodeAt(B+1),56320===(64512&f)&&(u=65536+(u-55296<<10)+(f-56320),B++)),u<128?o[O++]=u:u<2048?(o[O++]=192|u>>>6,o[O++]=128|63&u):u<65536?(o[O++]=224|u>>>12,o[O++]=128|u>>>6&63,o[O++]=128|63&u):(o[O++]=240|u>>>18,o[O++]=128|u>>>12&63,o[O++]=128|u>>>6&63,o[O++]=128|63&u);return o};mm.exports.buf2string=(mm,f)=>{const B=f||mm.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(mm.subarray(0,f));let O,r;const w=new Array(2*B);for(r=0,O=0;O<B;){let o=mm[O++];if(o<128){w[r++]=o;continue}let f=u[o];if(f>4)w[r++]=65533,O+=f-1;else{for(o&=2===f?31:3===f?15:7;f>1&&O<B;)o=o<<6|63&mm[O++],f--;f>1?w[r++]=65533:o<65536?w[r++]=o:(o-=65536,w[r++]=55296|o>>10&1023,w[r++]=56320|1023&o)}}return((mm,u)=>{if(u<65534&&mm.subarray&&o)return String.fromCharCode.apply(null,mm.length===u?mm:mm.subarray(0,u));let f="";for(let o=0;o<u;o++)f+=String.fromCharCode(mm[o]);return f})(w,r)},mm.exports.utf8border=(mm,o)=>{(o=o||mm.length)>mm.length&&(o=mm.length);let f=o-1;for(;f>=0&&128===(192&mm[f]);)f--;return f<0||0===f?o:f+u[mm[f]]>o?f:o}},14647:mm=>{"use strict";mm.exports=(mm,o,u,f)=>{let B=65535&mm,O=mm>>>16&65535,r=0;for(;0!==u;){r=u>2e3?2e3:u,u-=r;do{B=B+o[f++]|0,O=O+B|0}while(--r);B%=65521,O%=65521}return B|O<<16}},14665:mm=>{"use strict";mm.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},14652:mm=>{"use strict";const o=new Uint32Array((()=>{let mm,o=[];for(var u=0;u<256;u++){mm=u;for(var f=0;f<8;f++)mm=1&mm?3988292384^mm>>>1:mm>>>1;o[u]=mm}return o})());mm.exports=(mm,u,f,B)=>{const O=o,r=B+f;mm^=-1;for(let o=B;o<r;o++)mm=mm>>>8^O[255&(mm^u[o])];return~mm}},14637:(mm,o,u)=>{"use strict";const{_tr_init:f,_tr_stored_block:B,_tr_flush_block:O,_tr_tally:r,_tr_align:w}=u(14644),p=u(14647),K=u(14652),z=u(14660),{Z_NO_FLUSH:Y,Z_PARTIAL_FLUSH:q,Z_FULL_FLUSH:x,Z_FINISH:H,Z_BLOCK:E,Z_OK:M,Z_STREAM_END:l,Z_STREAM_ERROR:t,Z_DATA_ERROR:Q,Z_BUF_ERROR:b,Z_DEFAULT_COMPRESSION:J,Z_FILTERED:N,Z_HUFFMAN_ONLY:S,Z_RLE:P,Z_FIXED:R,Z_DEFAULT_STRATEGY:g,Z_UNKNOWN:W,Z_DEFLATED:F}=u(14665),c=258,A=262,y=103,I=113,s=666,j=(mm,o)=>(mm.qo=z[o],o),a=mm=>(mm<<1)-(mm>4?9:0),X=mm=>{let o=mm.length;for(;--o>=0;)mm[o]=0};let G=(mm,o,u)=>(o<<mm.hash_shift^u)&mm.hash_mask;const k=mm=>{const o=mm.state;let u=o.pending;u>mm.avail_out&&(u=mm.avail_out),0!==u&&(mm.output.set(o.pending_buf.subarray(o.pending_out,o.pending_out+u),mm.next_out),mm.next_out+=u,o.pending_out+=u,mm.total_out+=u,mm.avail_out-=u,o.pending-=u,0===o.pending&&(o.pending_out=0))},d=(mm,o)=>{O(mm,mm.block_start>=0?mm.block_start:-1,mm.strstart-mm.block_start,o),mm.block_start=mm.strstart,k(mm.strm)},e=(mm,o)=>{mm.pending_buf[mm.pending++]=o},L=(mm,o)=>{mm.pending_buf[mm.pending++]=o>>>8&255,mm.pending_buf[mm.pending++]=255&o},C=(mm,o,u,f)=>{let B=mm.avail_in;return B>f&&(B=f),0===B?0:(mm.avail_in-=B,o.set(mm.input.subarray(mm.next_in,mm.next_in+B),u),1===mm.state.wrap?mm.adler=p(mm.adler,o,B,u):2===mm.state.wrap&&(mm.adler=K(mm.adler,o,B,u)),mm.next_in+=B,mm.total_in+=B,B)},v=(mm,o)=>{let u,f,B=mm.max_chain_length,O=mm.strstart,r=mm.prev_length,w=mm.nice_match;const p=mm.strstart>mm.w_size-A?mm.strstart-(mm.w_size-A):0,K=mm.window,z=mm.w_mask,Y=mm.prev,q=mm.strstart+c;let x=K[O+r-1],H=K[O+r];mm.prev_length>=mm.good_match&&(B>>=2),w>mm.lookahead&&(w=mm.lookahead);do{if(u=o,K[u+r]===H&&K[u+r-1]===x&&K[u]===K[O]&&K[++u]===K[O+1]){O+=2,u++;do{}while(K[++O]===K[++u]&&K[++O]===K[++u]&&K[++O]===K[++u]&&K[++O]===K[++u]&&K[++O]===K[++u]&&K[++O]===K[++u]&&K[++O]===K[++u]&&K[++O]===K[++u]&&O<q);if(f=c-(q-O),O=q-c,f>r){if(mm.match_start=o,r=f,f>=w)break;x=K[O+r-1],H=K[O+r]}}}while((o=Y[o&z])>p&&0!==--B);return r<=mm.lookahead?r:mm.lookahead},V=mm=>{const o=mm.w_size;let u,f,B,O,r;do{if(O=mm.window_size-mm.lookahead-mm.strstart,mm.strstart>=o+(o-A)){mm.window.set(mm.window.subarray(o,o+o),0),mm.match_start-=o,mm.strstart-=o,mm.block_start-=o,f=mm.hash_size,u=f;do{B=mm.head[--u],mm.head[u]=B>=o?B-o:0}while(--f);f=o,u=f;do{B=mm.prev[--u],mm.prev[u]=B>=o?B-o:0}while(--f);O+=o}if(0===mm.strm.avail_in)break;if(f=C(mm.strm,mm.window,mm.strstart+mm.lookahead,O),mm.lookahead+=f,mm.lookahead+mm.insert>=3)for(r=mm.strstart-mm.insert,mm.ins_h=mm.window[r],mm.ins_h=G(mm,mm.ins_h,mm.window[r+1]);mm.insert&&(mm.ins_h=G(mm,mm.ins_h,mm.window[r+3-1]),mm.prev[r&mm.w_mask]=mm.head[mm.ins_h],mm.head[mm.ins_h]=r,r++,mm.insert--,!(mm.lookahead+mm.insert<3)););}while(mm.lookahead<A&&0!==mm.strm.avail_in)},n=(mm,o)=>{let u,f;for(;;){if(mm.lookahead<A){if(V(mm),mm.lookahead<A&&o===Y)return 1;if(0===mm.lookahead)break}if(u=0,mm.lookahead>=3&&(mm.ins_h=G(mm,mm.ins_h,mm.window[mm.strstart+3-1]),u=mm.prev[mm.strstart&mm.w_mask]=mm.head[mm.ins_h],mm.head[mm.ins_h]=mm.strstart),0!==u&&mm.strstart-u<=mm.w_size-A&&(mm.match_length=v(mm,u)),mm.match_length>=3)if(f=r(mm,mm.strstart-mm.match_start,mm.match_length-3),mm.lookahead-=mm.match_length,mm.match_length<=mm.max_lazy_match&&mm.lookahead>=3){mm.match_length--;do{mm.strstart++,mm.ins_h=G(mm,mm.ins_h,mm.window[mm.strstart+3-1]),u=mm.prev[mm.strstart&mm.w_mask]=mm.head[mm.ins_h],mm.head[mm.ins_h]=mm.strstart}while(0!==--mm.match_length);mm.strstart++}else mm.strstart+=mm.match_length,mm.match_length=0,mm.ins_h=mm.window[mm.strstart],mm.ins_h=G(mm,mm.ins_h,mm.window[mm.strstart+1]);else f=r(mm,0,mm.window[mm.strstart]),mm.lookahead--,mm.strstart++;if(f&&(d(mm,!1),0===mm.strm.avail_out))return 1}return mm.insert=mm.strstart<2?mm.strstart:2,o===H?(d(mm,!0),0===mm.strm.avail_out?3:4):mm.last_lit&&(d(mm,!1),0===mm.strm.avail_out)?1:2},U=(mm,o)=>{let u,f,B;for(;;){if(mm.lookahead<A){if(V(mm),mm.lookahead<A&&o===Y)return 1;if(0===mm.lookahead)break}if(u=0,mm.lookahead>=3&&(mm.ins_h=G(mm,mm.ins_h,mm.window[mm.strstart+3-1]),u=mm.prev[mm.strstart&mm.w_mask]=mm.head[mm.ins_h],mm.head[mm.ins_h]=mm.strstart),mm.prev_length=mm.match_length,mm.prev_match=mm.match_start,mm.match_length=2,0!==u&&mm.prev_length<mm.max_lazy_match&&mm.strstart-u<=mm.w_size-A&&(mm.match_length=v(mm,u),mm.match_length<=5&&(mm.strategy===N||3===mm.match_length&&mm.strstart-mm.match_start>4096)&&(mm.match_length=2)),mm.prev_length>=3&&mm.match_length<=mm.prev_length){B=mm.strstart+mm.lookahead-3,f=r(mm,mm.strstart-1-mm.prev_match,mm.prev_length-3),mm.lookahead-=mm.prev_length-1,mm.prev_length-=2;do{++mm.strstart<=B&&(mm.ins_h=G(mm,mm.ins_h,mm.window[mm.strstart+3-1]),u=mm.prev[mm.strstart&mm.w_mask]=mm.head[mm.ins_h],mm.head[mm.ins_h]=mm.strstart)}while(0!==--mm.prev_length);if(mm.match_available=0,mm.match_length=2,mm.strstart++,f&&(d(mm,!1),0===mm.strm.avail_out))return 1}else if(mm.match_available){if(f=r(mm,0,mm.window[mm.strstart-1]),f&&d(mm,!1),mm.strstart++,mm.lookahead--,0===mm.strm.avail_out)return 1}else mm.match_available=1,mm.strstart++,mm.lookahead--}return mm.match_available&&(f=r(mm,0,mm.window[mm.strstart-1]),mm.match_available=0),mm.insert=mm.strstart<2?mm.strstart:2,o===H?(d(mm,!0),0===mm.strm.avail_out?3:4):mm.last_lit&&(d(mm,!1),0===mm.strm.avail_out)?1:2};function h(mm,o,u,f,B){this.good_length=mm,this.max_lazy=o,this.nice_length=u,this.max_chain=f,this.func=B}const Z=[new h(0,0,0,0,((mm,o)=>{let u=65535;for(u>mm.pending_buf_size-5&&(u=mm.pending_buf_size-5);;){if(mm.lookahead<=1){if(V(mm),0===mm.lookahead&&o===Y)return 1;if(0===mm.lookahead)break}mm.strstart+=mm.lookahead,mm.lookahead=0;const f=mm.block_start+u;if((0===mm.strstart||mm.strstart>=f)&&(mm.lookahead=mm.strstart-f,mm.strstart=f,d(mm,!1),0===mm.strm.avail_out))return 1;if(mm.strstart-mm.block_start>=mm.w_size-A&&(d(mm,!1),0===mm.strm.avail_out))return 1}return mm.insert=0,o===H?(d(mm,!0),0===mm.strm.avail_out?3:4):(mm.strstart>mm.block_start&&(d(mm,!1),mm.strm.avail_out),1)})),new h(4,4,8,4,n),new h(4,5,16,8,n),new h(4,6,32,32,n),new h(4,4,16,16,U),new h(8,16,32,32,U),new h(8,16,128,128,U),new h(8,32,128,256,U),new h(32,128,258,1024,U),new h(32,258,258,4096,U)];function T(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=F,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),X(this.dyn_ltree),X(this.dyn_dtree),X(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),X(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),X(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const D=mm=>{if(!mm||!mm.state)return j(mm,t);mm.total_in=mm.total_out=0,mm.data_type=W;const o=mm.state;return o.pending=0,o.pending_out=0,o.wrap<0&&(o.wrap=-o.wrap),o.status=o.wrap?42:I,mm.adler=2===o.wrap?0:1,o.last_flush=Y,f(o),M},i=mm=>{const o=D(mm);var u;return o===M&&((u=mm.state).window_size=2*u.w_size,X(u.head),u.max_lazy_match=Z[u.level].max_lazy,u.good_match=Z[u.level].good_length,u.nice_match=Z[u.level].nice_length,u.max_chain_length=Z[u.level].max_chain,u.strstart=0,u.block_start=0,u.lookahead=0,u.insert=0,u.match_length=u.prev_length=2,u.match_available=0,u.ins_h=0),o},mo=(mm,o,u,f,B,O)=>{if(!mm)return t;let r=1;if(o===J&&(o=6),f<0?(r=0,f=-f):f>15&&(r=2,f-=16),B<1||B>9||u!==F||f<8||f>15||o<0||o>9||O<0||O>R)return j(mm,t);8===f&&(f=9);const w=new T;return mm.state=w,w.strm=mm,w.wrap=r,w.gzhead=null,w.w_bits=f,w.w_size=1<<w.w_bits,w.w_mask=w.w_size-1,w.hash_bits=B+7,w.hash_size=1<<w.hash_bits,w.hash_mask=w.hash_size-1,w.hash_shift=~~((w.hash_bits+3-1)/3),w.window=new Uint8Array(2*w.w_size),w.head=new Uint16Array(w.hash_size),w.prev=new Uint16Array(w.w_size),w.lit_bufsize=1<<B+6,w.pending_buf_size=4*w.lit_bufsize,w.pending_buf=new Uint8Array(w.pending_buf_size),w.d_buf=1*w.lit_bufsize,w.l_buf=3*w.lit_bufsize,w.level=o,w.strategy=O,w.method=u,i(mm)};mm.exports.deflateInit=(mm,o)=>mo(mm,o,F,15,8,g),mm.exports.deflateInit2=mo,mm.exports.deflateReset=i,mm.exports.deflateResetKeep=D,mm.exports.deflateSetHeader=(mm,o)=>mm&&mm.state?2!==mm.state.wrap?t:(mm.state.gzhead=o,M):t,mm.exports.deflate=(mm,o)=>{let u,f;if(!mm||!mm.state||o>E||o<0)return mm?j(mm,t):t;const O=mm.state;if(!mm.output||!mm.input&&0!==mm.avail_in||O.status===s&&o!==H)return j(mm,0===mm.avail_out?b:t);O.strm=mm;const p=O.last_flush;if(O.last_flush=o,42===O.status)if(2===O.wrap)mm.adler=0,e(O,31),e(O,139),e(O,8),O.gzhead?(e(O,(O.gzhead.text?1:0)+(O.gzhead.hcrc?2:0)+(O.gzhead.extra?4:0)+(O.gzhead.name?8:0)+(O.gzhead.comment?16:0)),e(O,255&O.gzhead.time),e(O,O.gzhead.time>>8&255),e(O,O.gzhead.time>>16&255),e(O,O.gzhead.time>>24&255),e(O,9===O.level?2:O.strategy>=S||O.level<2?4:0),e(O,255&O.gzhead.os),O.gzhead.extra&&O.gzhead.extra.length&&(e(O,255&O.gzhead.extra.length),e(O,O.gzhead.extra.length>>8&255)),O.gzhead.hcrc&&(mm.adler=K(mm.adler,O.pending_buf,O.pending,0)),O.gzindex=0,O.status=69):(e(O,0),e(O,0),e(O,0),e(O,0),e(O,0),e(O,9===O.level?2:O.strategy>=S||O.level<2?4:0),e(O,3),O.status=I);else{let o=F+(O.w_bits-8<<4)<<8,u=-1;u=O.strategy>=S||O.level<2?0:O.level<6?1:6===O.level?2:3,o|=u<<6,0!==O.strstart&&(o|=32),o+=31-o%31,O.status=I,L(O,o),0!==O.strstart&&(L(O,mm.adler>>>16),L(O,65535&mm.adler)),mm.adler=1}if(69===O.status)if(O.gzhead.extra){for(u=O.pending;O.gzindex<(65535&O.gzhead.extra.length)&&(O.pending!==O.pending_buf_size||(O.gzhead.hcrc&&O.pending>u&&(mm.adler=K(mm.adler,O.pending_buf,O.pending-u,u)),k(mm),u=O.pending,O.pending!==O.pending_buf_size));)e(O,255&O.gzhead.extra[O.gzindex]),O.gzindex++;O.gzhead.hcrc&&O.pending>u&&(mm.adler=K(mm.adler,O.pending_buf,O.pending-u,u)),O.gzindex===O.gzhead.extra.length&&(O.gzindex=0,O.status=73)}else O.status=73;if(73===O.status)if(O.gzhead.name){u=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>u&&(mm.adler=K(mm.adler,O.pending_buf,O.pending-u,u)),k(mm),u=O.pending,O.pending===O.pending_buf_size)){f=1;break}f=O.gzindex<O.gzhead.name.length?255&O.gzhead.name.charCodeAt(O.gzindex++):0,e(O,f)}while(0!==f);O.gzhead.hcrc&&O.pending>u&&(mm.adler=K(mm.adler,O.pending_buf,O.pending-u,u)),0===f&&(O.gzindex=0,O.status=91)}else O.status=91;if(91===O.status)if(O.gzhead.comment){u=O.pending;do{if(O.pending===O.pending_buf_size&&(O.gzhead.hcrc&&O.pending>u&&(mm.adler=K(mm.adler,O.pending_buf,O.pending-u,u)),k(mm),u=O.pending,O.pending===O.pending_buf_size)){f=1;break}f=O.gzindex<O.gzhead.comment.length?255&O.gzhead.comment.charCodeAt(O.gzindex++):0,e(O,f)}while(0!==f);O.gzhead.hcrc&&O.pending>u&&(mm.adler=K(mm.adler,O.pending_buf,O.pending-u,u)),0===f&&(O.status=y)}else O.status=y;if(O.status===y&&(O.gzhead.hcrc?(O.pending+2>O.pending_buf_size&&k(mm),O.pending+2<=O.pending_buf_size&&(e(O,255&mm.adler),e(O,mm.adler>>8&255),mm.adler=0,O.status=I)):O.status=I),0!==O.pending){if(k(mm),0===mm.avail_out)return O.last_flush=-1,M}else if(0===mm.avail_in&&a(o)<=a(p)&&o!==H)return j(mm,b);if(O.status===s&&0!==mm.avail_in)return j(mm,b);if(0!==mm.avail_in||0!==O.lookahead||o!==Y&&O.status!==s){let u=O.strategy===S?((mm,o)=>{let u;for(;;){if(0===mm.lookahead&&(V(mm),0===mm.lookahead)){if(o===Y)return 1;break}if(mm.match_length=0,u=r(mm,0,mm.window[mm.strstart]),mm.lookahead--,mm.strstart++,u&&(d(mm,!1),0===mm.strm.avail_out))return 1}return mm.insert=0,o===H?(d(mm,!0),0===mm.strm.avail_out?3:4):mm.last_lit&&(d(mm,!1),0===mm.strm.avail_out)?1:2})(O,o):O.strategy===P?((mm,o)=>{let u,f,B,O;const w=mm.window;for(;;){if(mm.lookahead<=c){if(V(mm),mm.lookahead<=c&&o===Y)return 1;if(0===mm.lookahead)break}if(mm.match_length=0,mm.lookahead>=3&&mm.strstart>0&&(B=mm.strstart-1,f=w[B],f===w[++B]&&f===w[++B]&&f===w[++B])){O=mm.strstart+c;do{}while(f===w[++B]&&f===w[++B]&&f===w[++B]&&f===w[++B]&&f===w[++B]&&f===w[++B]&&f===w[++B]&&f===w[++B]&&B<O);mm.match_length=c-(O-B),mm.match_length>mm.lookahead&&(mm.match_length=mm.lookahead)}if(mm.match_length>=3?(u=r(mm,1,mm.match_length-3),mm.lookahead-=mm.match_length,mm.strstart+=mm.match_length,mm.match_length=0):(u=r(mm,0,mm.window[mm.strstart]),mm.lookahead--,mm.strstart++),u&&(d(mm,!1),0===mm.strm.avail_out))return 1}return mm.insert=0,o===H?(d(mm,!0),0===mm.strm.avail_out?3:4):mm.last_lit&&(d(mm,!1),0===mm.strm.avail_out)?1:2})(O,o):Z[O.level].func(O,o);if(3!==u&&4!==u||(O.status=s),1===u||3===u)return 0===mm.avail_out&&(O.last_flush=-1),M;if(2===u&&(o===q?w(O):o!==E&&(B(O,0,0,!1),o===x&&(X(O.head),0===O.lookahead&&(O.strstart=0,O.block_start=0,O.insert=0))),k(mm),0===mm.avail_out))return O.last_flush=-1,M}return o!==H?M:O.wrap<=0?l:(2===O.wrap?(e(O,255&mm.adler),e(O,mm.adler>>8&255),e(O,mm.adler>>16&255),e(O,mm.adler>>24&255),e(O,255&mm.total_in),e(O,mm.total_in>>8&255),e(O,mm.total_in>>16&255),e(O,mm.total_in>>24&255)):(L(O,mm.adler>>>16),L(O,65535&mm.adler)),k(mm),O.wrap>0&&(O.wrap=-O.wrap),0!==O.pending?M:l)},mm.exports.deflateEnd=mm=>{if(!mm||!mm.state)return t;const o=mm.state.status;return 42!==o&&69!==o&&73!==o&&91!==o&&o!==y&&o!==I&&o!==s?j(mm,t):(mm.state=null,o===I?j(mm,Q):M)},mm.exports.deflateSetDictionary=(mm,o)=>{let u=o.length;if(!mm||!mm.state)return t;const f=mm.state,B=f.wrap;if(2===B||1===B&&42!==f.status||f.lookahead)return t;if(1===B&&(mm.adler=p(mm.adler,o,u,0)),f.wrap=0,u>=f.w_size){0===B&&(X(f.head),f.strstart=0,f.block_start=0,f.insert=0);let mm=new Uint8Array(f.w_size);mm.set(o.subarray(u-f.w_size,u),0),o=mm,u=f.w_size}const O=mm.avail_in,r=mm.next_in,w=mm.input;for(mm.avail_in=u,mm.next_in=0,mm.input=o,V(f);f.lookahead>=3;){let mm=f.strstart,o=f.lookahead-2;do{f.ins_h=G(f,f.ins_h,f.window[mm+3-1]),f.prev[mm&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=mm,mm++}while(--o);f.strstart=mm,f.lookahead=2,V(f)}return f.strstart+=f.lookahead,f.block_start=f.strstart,f.insert=f.lookahead,f.lookahead=0,f.match_length=f.prev_length=2,f.match_available=0,mm.next_in=r,mm.input=w,mm.avail_in=O,f.wrap=B,M},mm.exports.deflateInfo="pako deflate (from Nodeca project)"},14709:mm=>{"use strict";mm.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},14698:mm=>{"use strict";mm.exports=function(mm,o){let u,f,B,O,r,w,p,K,z,Y,q,x,H,E,M,l,t,Q,b,J,N,S,P,R;const g=mm.state;u=mm.next_in,P=mm.input,f=u+(mm.avail_in-5),B=mm.next_out,R=mm.output,O=B-(o-mm.avail_out),r=B+(mm.avail_out-257),w=g.dmax,p=g.wsize,K=g.whave,z=g.wnext,Y=g.window,q=g.hold,x=g.bits,H=g.lencode,E=g.distcode,M=(1<<g.lenbits)-1,l=(1<<g.distbits)-1;mm:do{x<15&&(q+=P[u++]<<x,x+=8,q+=P[u++]<<x,x+=8),t=H[q&M];o:for(;;){if(Q=t>>>24,q>>>=Q,x-=Q,Q=t>>>16&255,0===Q)R[B++]=65535&t;else{if(!(16&Q)){if(0===(64&Q)){t=H[(65535&t)+(q&(1<<Q)-1)];continue o}if(32&Q){g.mode=12;break mm}mm.qo="invalid literal/length code",g.mode=30;break mm}b=65535&t,Q&=15,Q&&(x<Q&&(q+=P[u++]<<x,x+=8),b+=q&(1<<Q)-1,q>>>=Q,x-=Q),x<15&&(q+=P[u++]<<x,x+=8,q+=P[u++]<<x,x+=8),t=E[q&l];u:for(;;){if(Q=t>>>24,q>>>=Q,x-=Q,Q=t>>>16&255,!(16&Q)){if(0===(64&Q)){t=E[(65535&t)+(q&(1<<Q)-1)];continue u}mm.qo="invalid distance code",g.mode=30;break mm}if(J=65535&t,Q&=15,x<Q&&(q+=P[u++]<<x,x+=8,x<Q&&(q+=P[u++]<<x,x+=8)),J+=q&(1<<Q)-1,J>w){mm.qo="invalid distance too far back",g.mode=30;break mm}if(q>>>=Q,x-=Q,Q=B-O,J>Q){if(Q=J-Q,Q>K&&g.sane){mm.qo="invalid distance too far back",g.mode=30;break mm}if(N=0,S=Y,0===z){if(N+=p-Q,Q<b){b-=Q;do{R[B++]=Y[N++]}while(--Q);N=B-J,S=R}}else if(z<Q){if(N+=p+z-Q,Q-=z,Q<b){b-=Q;do{R[B++]=Y[N++]}while(--Q);if(N=0,z<b){Q=z,b-=Q;do{R[B++]=Y[N++]}while(--Q);N=B-J,S=R}}}else if(N+=z-Q,Q<b){b-=Q;do{R[B++]=Y[N++]}while(--Q);N=B-J,S=R}for(;b>2;)R[B++]=S[N++],R[B++]=S[N++],R[B++]=S[N++],b-=3;b&&(R[B++]=S[N++],b>1&&(R[B++]=S[N++]))}else{N=B-J;do{R[B++]=R[N++],R[B++]=R[N++],R[B++]=R[N++],b-=3}while(b>2);b&&(R[B++]=R[N++],b>1&&(R[B++]=R[N++]))}break}}break}}while(u<f&&B<r);b=x>>3,u-=b,x-=b<<3,q&=(1<<x)-1,mm.next_in=u,mm.next_out=B,mm.avail_in=u<f?f-u+5:5-(u-f),mm.avail_out=B<r?r-B+257:257-(B-r),g.hold=q,g.bits=x}},14694:(mm,o,u)=>{"use strict";const f=u(14647),B=u(14652),O=u(14698),r=u(14704),{Z_FINISH:w,Z_BLOCK:p,Z_TREES:K,Z_OK:z,Z_STREAM_END:Y,Z_NEED_DICT:q,Z_STREAM_ERROR:x,Z_DATA_ERROR:H,Z_MEM_ERROR:E,Z_BUF_ERROR:M,Z_DEFLATED:l}=u(14665),t=12,Q=30,b=mm=>(mm>>>24&255)+(mm>>>8&65280)+((65280&mm)<<8)+((255&mm)<<24);function J(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const N=mm=>{if(!mm||!mm.state)return x;const o=mm.state;return mm.total_in=mm.total_out=o.total=0,mm.qo="",o.wrap&&(mm.adler=1&o.wrap),o.mode=1,o.last=0,o.havedict=0,o.dmax=32768,o.head=null,o.hold=0,o.bits=0,o.lencode=o.lendyn=new Int32Array(852),o.distcode=o.distdyn=new Int32Array(592),o.sane=1,o.back=-1,z},S=mm=>{if(!mm||!mm.state)return x;const o=mm.state;return o.wsize=0,o.whave=0,o.wnext=0,N(mm)},P=(mm,o)=>{let u;if(!mm||!mm.state)return x;const f=mm.state;return o<0?(u=0,o=-o):(u=1+(o>>4),o<48&&(o&=15)),o&&(o<8||o>15)?x:(null!==f.window&&f.wbits!==o&&(f.window=null),f.wrap=u,f.wbits=o,S(mm))},R=(mm,o)=>{if(!mm)return x;const u=new J;mm.state=u,u.window=null;const f=P(mm,o);return f!==z&&(mm.state=null),f};let g,W,F=!0;const c=mm=>{if(F){g=new Int32Array(512),W=new Int32Array(32);let o=0;for(;o<144;)mm.lens[o++]=8;for(;o<256;)mm.lens[o++]=9;for(;o<280;)mm.lens[o++]=7;for(;o<288;)mm.lens[o++]=8;for(r(1,mm.lens,0,288,g,0,mm.work,{bits:9}),o=0;o<32;)mm.lens[o++]=5;r(2,mm.lens,0,32,W,0,mm.work,{bits:5}),F=!1}mm.lencode=g,mm.lenbits=9,mm.distcode=W,mm.distbits=5},A=(mm,o,u,f)=>{let B;const O=mm.state;return null===O.window&&(O.wsize=1<<O.wbits,O.wnext=0,O.whave=0,O.window=new Uint8Array(O.wsize)),f>=O.wsize?(O.window.set(o.subarray(u-O.wsize,u),0),O.wnext=0,O.whave=O.wsize):(B=O.wsize-O.wnext,B>f&&(B=f),O.window.set(o.subarray(u-f,u-f+B),O.wnext),(f-=B)?(O.window.set(o.subarray(u-f,u),0),O.wnext=f,O.whave=O.wsize):(O.wnext+=B,O.wnext===O.wsize&&(O.wnext=0),O.whave<O.wsize&&(O.whave+=B))),0};mm.exports.inflateReset=S,mm.exports.inflateReset2=P,mm.exports.inflateResetKeep=N,mm.exports.inflateInit=mm=>R(mm,15),mm.exports.inflateInit2=R,mm.exports.inflate=(mm,o)=>{let u,J,N,S,P,R,g,W,F,y,I,s,j,a,X,G,k,d,e,L,C,v,V=0;const n=new Uint8Array(4);let U,h;const Z=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!mm||!mm.state||!mm.output||!mm.input&&0!==mm.avail_in)return x;u=mm.state,u.mode===t&&(u.mode=13),P=mm.next_out,N=mm.output,g=mm.avail_out,S=mm.next_in,J=mm.input,R=mm.avail_in,W=u.hold,F=u.bits,y=R,I=g,v=z;mm:for(;;)switch(u.mode){case 1:if(0===u.wrap){u.mode=13;break}for(;F<16;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}if(2&u.wrap&&35615===W){u.check=0,n[0]=255&W,n[1]=W>>>8&255,u.check=B(u.check,n,2,0),W=0,F=0,u.mode=2;break}if(u.flags=0,u.head&&(u.head.done=!1),!(1&u.wrap)||(((255&W)<<8)+(W>>8))%31){mm.qo="incorrect header check",u.mode=Q;break}if((15&W)!==l){mm.qo="unknown compression method",u.mode=Q;break}if(W>>>=4,F-=4,C=8+(15&W),0===u.wbits)u.wbits=C;else if(C>u.wbits){mm.qo="invalid window size",u.mode=Q;break}u.dmax=1<<u.wbits,mm.adler=u.check=1,u.mode=512&W?10:t,W=0,F=0;break;case 2:for(;F<16;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}if(u.flags=W,(255&u.flags)!==l){mm.qo="unknown compression method",u.mode=Q;break}if(57344&u.flags){mm.qo="unknown header flags set",u.mode=Q;break}u.head&&(u.head.text=W>>8&1),512&u.flags&&(n[0]=255&W,n[1]=W>>>8&255,u.check=B(u.check,n,2,0)),W=0,F=0,u.mode=3;case 3:for(;F<32;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}u.head&&(u.head.time=W),512&u.flags&&(n[0]=255&W,n[1]=W>>>8&255,n[2]=W>>>16&255,n[3]=W>>>24&255,u.check=B(u.check,n,4,0)),W=0,F=0,u.mode=4;case 4:for(;F<16;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}u.head&&(u.head.xflags=255&W,u.head.os=W>>8),512&u.flags&&(n[0]=255&W,n[1]=W>>>8&255,u.check=B(u.check,n,2,0)),W=0,F=0,u.mode=5;case 5:if(1024&u.flags){for(;F<16;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}u.length=W,u.head&&(u.head.extra_len=W),512&u.flags&&(n[0]=255&W,n[1]=W>>>8&255,u.check=B(u.check,n,2,0)),W=0,F=0}else u.head&&(u.head.extra=null);u.mode=6;case 6:if(1024&u.flags&&(s=u.length,s>R&&(s=R),s&&(u.head&&(C=u.head.extra_len-u.length,u.head.extra||(u.head.extra=new Uint8Array(u.head.extra_len)),u.head.extra.set(J.subarray(S,S+s),C)),512&u.flags&&(u.check=B(u.check,J,s,S)),R-=s,S+=s,u.length-=s),u.length))break mm;u.length=0,u.mode=7;case 7:if(2048&u.flags){if(0===R)break mm;s=0;do{C=J[S+s++],u.head&&C&&u.length<65536&&(u.head.name+=String.fromCharCode(C))}while(C&&s<R);if(512&u.flags&&(u.check=B(u.check,J,s,S)),R-=s,S+=s,C)break mm}else u.head&&(u.head.name=null);u.length=0,u.mode=8;case 8:if(4096&u.flags){if(0===R)break mm;s=0;do{C=J[S+s++],u.head&&C&&u.length<65536&&(u.head.comment+=String.fromCharCode(C))}while(C&&s<R);if(512&u.flags&&(u.check=B(u.check,J,s,S)),R-=s,S+=s,C)break mm}else u.head&&(u.head.comment=null);u.mode=9;case 9:if(512&u.flags){for(;F<16;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}if(W!==(65535&u.check)){mm.qo="header crc mismatch",u.mode=Q;break}W=0,F=0}u.head&&(u.head.hcrc=u.flags>>9&1,u.head.done=!0),mm.adler=u.check=0,u.mode=t;break;case 10:for(;F<32;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}mm.adler=u.check=b(W),W=0,F=0,u.mode=11;case 11:if(0===u.havedict)return mm.next_out=P,mm.avail_out=g,mm.next_in=S,mm.avail_in=R,u.hold=W,u.bits=F,q;mm.adler=u.check=1,u.mode=t;case t:if(o===p||o===K)break mm;case 13:if(u.last){W>>>=7&F,F-=7&F,u.mode=27;break}for(;F<3;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}switch(u.last=1&W,W>>>=1,F-=1,3&W){case 0:u.mode=14;break;case 1:if(c(u),u.mode=20,o===K){W>>>=2,F-=2;break mm}break;case 2:u.mode=17;break;case 3:mm.qo="invalid block type",u.mode=Q}W>>>=2,F-=2;break;case 14:for(W>>>=7&F,F-=7&F;F<32;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}if((65535&W)!==(W>>>16^65535)){mm.qo="invalid stored block lengths",u.mode=Q;break}if(u.length=65535&W,W=0,F=0,u.mode=15,o===K)break mm;case 15:u.mode=16;case 16:if(s=u.length,s){if(s>R&&(s=R),s>g&&(s=g),0===s)break mm;N.set(J.subarray(S,S+s),P),R-=s,S+=s,g-=s,P+=s,u.length-=s;break}u.mode=t;break;case 17:for(;F<14;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}if(u.nlen=257+(31&W),W>>>=5,F-=5,u.ndist=1+(31&W),W>>>=5,F-=5,u.ncode=4+(15&W),W>>>=4,F-=4,u.nlen>286||u.ndist>30){mm.qo="too many length or distance symbols",u.mode=Q;break}u.have=0,u.mode=18;case 18:for(;u.have<u.ncode;){for(;F<3;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}u.lens[Z[u.have++]]=7&W,W>>>=3,F-=3}for(;u.have<19;)u.lens[Z[u.have++]]=0;if(u.lencode=u.lendyn,u.lenbits=7,U={bits:u.lenbits},v=r(0,u.lens,0,19,u.lencode,0,u.work,U),u.lenbits=U.bits,v){mm.qo="invalid code lengths set",u.mode=Q;break}u.have=0,u.mode=19;case 19:for(;u.have<u.nlen+u.ndist;){for(;V=u.lencode[W&(1<<u.lenbits)-1],X=V>>>24,G=V>>>16&255,k=65535&V,!(X<=F);){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}if(k<16)W>>>=X,F-=X,u.lens[u.have++]=k;else{if(16===k){for(h=X+2;F<h;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}if(W>>>=X,F-=X,0===u.have){mm.qo="invalid bit length repeat",u.mode=Q;break}C=u.lens[u.have-1],s=3+(3&W),W>>>=2,F-=2}else if(17===k){for(h=X+3;F<h;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}W>>>=X,F-=X,C=0,s=3+(7&W),W>>>=3,F-=3}else{for(h=X+7;F<h;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}W>>>=X,F-=X,C=0,s=11+(127&W),W>>>=7,F-=7}if(u.have+s>u.nlen+u.ndist){mm.qo="invalid bit length repeat",u.mode=Q;break}for(;s--;)u.lens[u.have++]=C}}if(u.mode===Q)break;if(0===u.lens[256]){mm.qo="invalid code -- missing end-of-block",u.mode=Q;break}if(u.lenbits=9,U={bits:u.lenbits},v=r(1,u.lens,0,u.nlen,u.lencode,0,u.work,U),u.lenbits=U.bits,v){mm.qo="invalid literal/lengths set",u.mode=Q;break}if(u.distbits=6,u.distcode=u.distdyn,U={bits:u.distbits},v=r(2,u.lens,u.nlen,u.ndist,u.distcode,0,u.work,U),u.distbits=U.bits,v){mm.qo="invalid distances set",u.mode=Q;break}if(u.mode=20,o===K)break mm;case 20:u.mode=21;case 21:if(R>=6&&g>=258){mm.next_out=P,mm.avail_out=g,mm.next_in=S,mm.avail_in=R,u.hold=W,u.bits=F,O(mm,I),P=mm.next_out,N=mm.output,g=mm.avail_out,S=mm.next_in,J=mm.input,R=mm.avail_in,W=u.hold,F=u.bits,u.mode===t&&(u.back=-1);break}for(u.back=0;V=u.lencode[W&(1<<u.lenbits)-1],X=V>>>24,G=V>>>16&255,k=65535&V,!(X<=F);){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}if(G&&0===(240&G)){for(d=X,e=G,L=k;V=u.lencode[L+((W&(1<<d+e)-1)>>d)],X=V>>>24,G=V>>>16&255,k=65535&V,!(d+X<=F);){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}W>>>=d,F-=d,u.back+=d}if(W>>>=X,F-=X,u.back+=X,u.length=k,0===G){u.mode=26;break}if(32&G){u.back=-1,u.mode=t;break}if(64&G){mm.qo="invalid literal/length code",u.mode=Q;break}u.extra=15&G,u.mode=22;case 22:if(u.extra){for(h=u.extra;F<h;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}u.length+=W&(1<<u.extra)-1,W>>>=u.extra,F-=u.extra,u.back+=u.extra}u.was=u.length,u.mode=23;case 23:for(;V=u.distcode[W&(1<<u.distbits)-1],X=V>>>24,G=V>>>16&255,k=65535&V,!(X<=F);){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}if(0===(240&G)){for(d=X,e=G,L=k;V=u.distcode[L+((W&(1<<d+e)-1)>>d)],X=V>>>24,G=V>>>16&255,k=65535&V,!(d+X<=F);){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}W>>>=d,F-=d,u.back+=d}if(W>>>=X,F-=X,u.back+=X,64&G){mm.qo="invalid distance code",u.mode=Q;break}u.offset=k,u.extra=15&G,u.mode=24;case 24:if(u.extra){for(h=u.extra;F<h;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}u.offset+=W&(1<<u.extra)-1,W>>>=u.extra,F-=u.extra,u.back+=u.extra}if(u.offset>u.dmax){mm.qo="invalid distance too far back",u.mode=Q;break}u.mode=25;case 25:if(0===g)break mm;if(s=I-g,u.offset>s){if(s=u.offset-s,s>u.whave&&u.sane){mm.qo="invalid distance too far back",u.mode=Q;break}s>u.wnext?(s-=u.wnext,j=u.wsize-s):j=u.wnext-s,s>u.length&&(s=u.length),a=u.window}else a=N,j=P-u.offset,s=u.length;s>g&&(s=g),g-=s,u.length-=s;do{N[P++]=a[j++]}while(--s);0===u.length&&(u.mode=21);break;case 26:if(0===g)break mm;N[P++]=u.length,g--,u.mode=21;break;case 27:if(u.wrap){for(;F<32;){if(0===R)break mm;R--,W|=J[S++]<<F,F+=8}if(I-=g,mm.total_out+=I,u.total+=I,I&&(mm.adler=u.check=u.flags?B(u.check,N,I,P-I):f(u.check,N,I,P-I)),I=g,(u.flags?W:b(W))!==u.check){mm.qo="incorrect data check",u.mode=Q;break}W=0,F=0}u.mode=28;case 28:if(u.wrap&&u.flags){for(;F<32;){if(0===R)break mm;R--,W+=J[S++]<<F,F+=8}if(W!==(4294967295&u.total)){mm.qo="incorrect length check",u.mode=Q;break}W=0,F=0}u.mode=29;case 29:v=Y;break mm;case Q:v=H;break mm;case 31:return E;default:return x}return mm.next_out=P,mm.avail_out=g,mm.next_in=S,mm.avail_in=R,u.hold=W,u.bits=F,(u.wsize||I!==mm.avail_out&&u.mode<Q&&(u.mode<27||o!==w))&&A(mm,mm.output,mm.next_out,I-mm.avail_out)?(u.mode=31,E):(y-=mm.avail_in,I-=mm.avail_out,mm.total_in+=y,mm.total_out+=I,u.total+=I,u.wrap&&I&&(mm.adler=u.check=u.flags?B(u.check,N,I,mm.next_out-I):f(u.check,N,I,mm.next_out-I)),mm.data_type=u.bits+(u.last?64:0)+(u.mode===t?128:0)+(20===u.mode||15===u.mode?256:0),(0===y&&0===I||o===w)&&v===z&&(v=M),v)},mm.exports.inflateEnd=mm=>{if(!mm||!mm.state)return x;let o=mm.state;return o.window&&(o.window=null),mm.state=null,z},mm.exports.inflateGetHeader=(mm,o)=>{if(!mm||!mm.state)return x;const u=mm.state;return 0===(2&u.wrap)?x:(u.head=o,o.done=!1,z)},mm.exports.inflateSetDictionary=(mm,o)=>{const u=o.length;let B,O,r;return mm&&mm.state?(B=mm.state,0!==B.wrap&&11!==B.mode?x:11===B.mode&&(O=1,O=f(O,o,u,0),O!==B.check)?H:(r=A(mm,o,u,u),r?(B.mode=31,E):(B.havedict=1,z))):x},mm.exports.inflateInfo="pako inflate (from Nodeca project)"},14704:mm=>{"use strict";const o=15,u=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),f=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),B=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),O=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);mm.exports=(mm,r,w,p,K,z,Y,q)=>{const x=q.bits;let H,E,M,l,t,Q,b=0,J=0,N=0,S=0,P=0,R=0,g=0,W=0,F=0,c=0,A=null,y=0;const I=new Uint16Array(16),s=new Uint16Array(16);let j,a,X,G=null,k=0;for(b=0;b<=o;b++)I[b]=0;for(J=0;J<p;J++)I[r[w+J]]++;for(P=x,S=o;S>=1&&0===I[S];S--);if(P>S&&(P=S),0===S)return K[z++]=20971520,K[z++]=20971520,q.bits=1,0;for(N=1;N<S&&0===I[N];N++);for(P<N&&(P=N),W=1,b=1;b<=o;b++)if(W<<=1,W-=I[b],W<0)return-1;if(W>0&&(0===mm||1!==S))return-1;for(s[1]=0,b=1;b<o;b++)s[b+1]=s[b]+I[b];for(J=0;J<p;J++)0!==r[w+J]&&(Y[s[r[w+J]]++]=J);if(0===mm?(A=G=Y,Q=19):1===mm?(A=u,y-=257,G=f,k-=257,Q=256):(A=B,G=O,Q=-1),c=0,J=0,b=N,t=z,R=P,g=0,M=-1,F=1<<P,l=F-1,1===mm&&F>852||2===mm&&F>592)return 1;for(;;){j=b-g,Y[J]<Q?(a=0,X=Y[J]):Y[J]>Q?(a=G[k+Y[J]],X=A[y+Y[J]]):(a=96,X=0),H=1<<b-g,E=1<<R,N=E;do{E-=H,K[t+(c>>g)+E]=j<<24|a<<16|X}while(0!==E);for(H=1<<b-1;c&H;)H>>=1;if(0!==H?(c&=H-1,c+=H):c=0,J++,0===--I[b]){if(b===S)break;b=r[w+Y[J]]}if(b>P&&(c&l)!==M){for(0===g&&(g=P),t+=N,R=b-g,W=1<<R;R+g<S&&(W-=I[R+g],!(W<=0));)R++,W<<=1;if(F+=1<<R,1===mm&&F>852||2===mm&&F>592)return 1;M=c&l,K[M]=P<<24|R<<16|t-z}}return 0!==c&&(K[t+c]=b-g<<24|64<<16),q.bits=P,0}},14660:mm=>{"use strict";mm.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},14644:mm=>{"use strict";function o(mm){let o=mm.length;for(;--o>=0;)mm[o]=0}const u=256,f=286,B=30,O=15,r=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),w=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),p=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),K=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),z=new Array(576);o(z);const Y=new Array(60);o(Y);const q=new Array(512);o(q);const x=new Array(256);o(x);const H=new Array(29);o(H);const E=new Array(B);function M(mm,o,u,f,B){this.static_tree=mm,this.extra_bits=o,this.extra_base=u,this.elems=f,this.max_length=B,this.has_stree=mm&&mm.length}let l,t,Q;function b(mm,o){this.dyn_tree=mm,this.max_code=0,this.stat_desc=o}o(E);const J=mm=>mm<256?q[mm]:q[256+(mm>>>7)],N=(mm,o)=>{mm.pending_buf[mm.pending++]=255&o,mm.pending_buf[mm.pending++]=o>>>8&255},S=(mm,o,u)=>{mm.bi_valid>16-u?(mm.bi_buf|=o<<mm.bi_valid&65535,N(mm,mm.bi_buf),mm.bi_buf=o>>16-mm.bi_valid,mm.bi_valid+=u-16):(mm.bi_buf|=o<<mm.bi_valid&65535,mm.bi_valid+=u)},P=(mm,o,u)=>{S(mm,u[2*o],u[2*o+1])},R=(mm,o)=>{let u=0;do{u|=1&mm,mm>>>=1,u<<=1}while(--o>0);return u>>>1},g=(mm,o,u)=>{const f=new Array(16);let B,r,w=0;for(B=1;B<=O;B++)f[B]=w=w+u[B-1]<<1;for(r=0;r<=o;r++){let o=mm[2*r+1];0!==o&&(mm[2*r]=R(f[o]++,o))}},W=mm=>{let o;for(o=0;o<f;o++)mm.dyn_ltree[2*o]=0;for(o=0;o<B;o++)mm.dyn_dtree[2*o]=0;for(o=0;o<19;o++)mm.bl_tree[2*o]=0;mm.dyn_ltree[512]=1,mm.opt_len=mm.static_len=0,mm.last_lit=mm.matches=0},F=mm=>{mm.bi_valid>8?N(mm,mm.bi_buf):mm.bi_valid>0&&(mm.pending_buf[mm.pending++]=mm.bi_buf),mm.bi_buf=0,mm.bi_valid=0},c=(mm,o,u,f)=>{const B=2*o,O=2*u;return mm[B]<mm[O]||mm[B]===mm[O]&&f[o]<=f[u]},A=(mm,o,u)=>{const f=mm.heap[u];let B=u<<1;for(;B<=mm.heap_len&&(B<mm.heap_len&&c(o,mm.heap[B+1],mm.heap[B],mm.depth)&&B++,!c(o,f,mm.heap[B],mm.depth));)mm.heap[u]=mm.heap[B],u=B,B<<=1;mm.heap[u]=f},y=(mm,o,f)=>{let B,O,p,K,z=0;if(0!==mm.last_lit)do{B=mm.pending_buf[mm.d_buf+2*z]<<8|mm.pending_buf[mm.d_buf+2*z+1],O=mm.pending_buf[mm.l_buf+z],z++,0===B?P(mm,O,o):(p=x[O],P(mm,p+u+1,o),K=r[p],0!==K&&(O-=H[p],S(mm,O,K)),B--,p=J(B),P(mm,p,f),K=w[p],0!==K&&(B-=E[p],S(mm,B,K)))}while(z<mm.last_lit);P(mm,256,o)},I=(mm,o)=>{const u=o.dyn_tree,f=o.stat_desc.static_tree,B=o.stat_desc.has_stree,r=o.stat_desc.elems;let w,p,K,z=-1;for(mm.heap_len=0,mm.heap_max=573,w=0;w<r;w++)0!==u[2*w]?(mm.heap[++mm.heap_len]=z=w,mm.depth[w]=0):u[2*w+1]=0;for(;mm.heap_len<2;)K=mm.heap[++mm.heap_len]=z<2?++z:0,u[2*K]=1,mm.depth[K]=0,mm.opt_len--,B&&(mm.static_len-=f[2*K+1]);for(o.max_code=z,w=mm.heap_len>>1;w>=1;w--)A(mm,u,w);K=r;do{w=mm.heap[1],mm.heap[1]=mm.heap[mm.heap_len--],A(mm,u,1),p=mm.heap[1],mm.heap[--mm.heap_max]=w,mm.heap[--mm.heap_max]=p,u[2*K]=u[2*w]+u[2*p],mm.depth[K]=(mm.depth[w]>=mm.depth[p]?mm.depth[w]:mm.depth[p])+1,u[2*w+1]=u[2*p+1]=K,mm.heap[1]=K++,A(mm,u,1)}while(mm.heap_len>=2);mm.heap[--mm.heap_max]=mm.heap[1],((mm,o)=>{const u=o.dyn_tree,f=o.max_code,B=o.stat_desc.static_tree,r=o.stat_desc.has_stree,w=o.stat_desc.extra_bits,p=o.stat_desc.extra_base,K=o.stat_desc.max_length;let z,Y,q,x,H,E,M=0;for(x=0;x<=O;x++)mm.bl_count[x]=0;for(u[2*mm.heap[mm.heap_max]+1]=0,z=mm.heap_max+1;z<573;z++)Y=mm.heap[z],x=u[2*u[2*Y+1]+1]+1,x>K&&(x=K,M++),u[2*Y+1]=x,Y>f||(mm.bl_count[x]++,H=0,Y>=p&&(H=w[Y-p]),E=u[2*Y],mm.opt_len+=E*(x+H),r&&(mm.static_len+=E*(B[2*Y+1]+H)));if(0!==M){do{for(x=K-1;0===mm.bl_count[x];)x--;mm.bl_count[x]--,mm.bl_count[x+1]+=2,mm.bl_count[K]--,M-=2}while(M>0);for(x=K;0!==x;x--)for(Y=mm.bl_count[x];0!==Y;)q=mm.heap[--z],q>f||(u[2*q+1]!==x&&(mm.opt_len+=(x-u[2*q+1])*u[2*q],u[2*q+1]=x),Y--)}})(mm,o),g(u,z,mm.bl_count)},s=(mm,o,u)=>{let f,B,O=-1,r=o[1],w=0,p=7,K=4;for(0===r&&(p=138,K=3),o[2*(u+1)+1]=65535,f=0;f<=u;f++)B=r,r=o[2*(f+1)+1],++w<p&&B===r||(w<K?mm.bl_tree[2*B]+=w:0!==B?(B!==O&&mm.bl_tree[2*B]++,mm.bl_tree[32]++):w<=10?mm.bl_tree[34]++:mm.bl_tree[36]++,w=0,O=B,0===r?(p=138,K=3):B===r?(p=6,K=3):(p=7,K=4))},j=(mm,o,u)=>{let f,B,O=-1,r=o[1],w=0,p=7,K=4;for(0===r&&(p=138,K=3),f=0;f<=u;f++)if(B=r,r=o[2*(f+1)+1],!(++w<p&&B===r)){if(w<K)do{P(mm,B,mm.bl_tree)}while(0!==--w);else 0!==B?(B!==O&&(P(mm,B,mm.bl_tree),w--),P(mm,16,mm.bl_tree),S(mm,w-3,2)):w<=10?(P(mm,17,mm.bl_tree),S(mm,w-3,3)):(P(mm,18,mm.bl_tree),S(mm,w-11,7));w=0,O=B,0===r?(p=138,K=3):B===r?(p=6,K=3):(p=7,K=4)}};let a=!1;const X=(mm,o,u,f)=>{S(mm,0+(f?1:0),3),((mm,o,u,f)=>{F(mm),f&&(N(mm,u),N(mm,~u)),mm.pending_buf.set(mm.window.subarray(o,o+u),mm.pending),mm.pending+=u})(mm,o,u,!0)};mm.exports._tr_init=mm=>{a||((()=>{let mm,o,u,K,b;const J=new Array(16);for(u=0,K=0;K<28;K++)for(H[K]=u,mm=0;mm<1<<r[K];mm++)x[u++]=K;for(x[u-1]=K,b=0,K=0;K<16;K++)for(E[K]=b,mm=0;mm<1<<w[K];mm++)q[b++]=K;for(b>>=7;K<B;K++)for(E[K]=b<<7,mm=0;mm<1<<w[K]-7;mm++)q[256+b++]=K;for(o=0;o<=O;o++)J[o]=0;for(mm=0;mm<=143;)z[2*mm+1]=8,mm++,J[8]++;for(;mm<=255;)z[2*mm+1]=9,mm++,J[9]++;for(;mm<=279;)z[2*mm+1]=7,mm++,J[7]++;for(;mm<=287;)z[2*mm+1]=8,mm++,J[8]++;for(g(z,287,J),mm=0;mm<B;mm++)Y[2*mm+1]=5,Y[2*mm]=R(mm,5);l=new M(z,r,257,f,O),t=new M(Y,w,0,B,O),Q=new M(new Array(0),p,0,19,7)})(),a=!0),mm.l_desc=new b(mm.dyn_ltree,l),mm.d_desc=new b(mm.dyn_dtree,t),mm.bl_desc=new b(mm.bl_tree,Q),mm.bi_buf=0,mm.bi_valid=0,W(mm)},mm.exports._tr_stored_block=X,mm.exports._tr_flush_block=(mm,o,f,B)=>{let O,r,w=0;mm.level>0?(2===mm.strm.data_type&&(mm.strm.data_type=(mm=>{let o,f=4093624447;for(o=0;o<=31;o++,f>>>=1)if(1&f&&0!==mm.dyn_ltree[2*o])return 0;if(0!==mm.dyn_ltree[18]||0!==mm.dyn_ltree[20]||0!==mm.dyn_ltree[26])return 1;for(o=32;o<u;o++)if(0!==mm.dyn_ltree[2*o])return 1;return 0})(mm)),I(mm,mm.l_desc),I(mm,mm.d_desc),w=(mm=>{let o;for(s(mm,mm.dyn_ltree,mm.l_desc.max_code),s(mm,mm.dyn_dtree,mm.d_desc.max_code),I(mm,mm.bl_desc),o=18;o>=3&&0===mm.bl_tree[2*K[o]+1];o--);return mm.opt_len+=3*(o+1)+5+5+4,o})(mm),O=mm.opt_len+3+7>>>3,r=mm.static_len+3+7>>>3,r<=O&&(O=r)):O=r=f+5,f+4<=O&&-1!==o?X(mm,o,f,B):4===mm.strategy||r===O?(S(mm,2+(B?1:0),3),y(mm,z,Y)):(S(mm,4+(B?1:0),3),((mm,o,u,f)=>{let B;for(S(mm,o-257,5),S(mm,u-1,5),S(mm,f-4,4),B=0;B<f;B++)S(mm,mm.bl_tree[2*K[B]+1],3);j(mm,mm.dyn_ltree,o-1),j(mm,mm.dyn_dtree,u-1)})(mm,mm.l_desc.max_code+1,mm.d_desc.max_code+1,w+1),y(mm,mm.dyn_ltree,mm.dyn_dtree)),W(mm),B&&F(mm)},mm.exports._tr_tally=(mm,o,f)=>(mm.pending_buf[mm.d_buf+2*mm.last_lit]=o>>>8&255,mm.pending_buf[mm.d_buf+2*mm.last_lit+1]=255&o,mm.pending_buf[mm.l_buf+mm.last_lit]=255&f,mm.last_lit++,0===o?mm.dyn_ltree[2*f]++:(mm.matches++,o--,mm.dyn_ltree[2*(x[f]+u+1)]++,mm.dyn_dtree[2*J(o)]++),mm.last_lit===mm.lit_bufsize-1),mm.exports._tr_align=mm=>{S(mm,2,3),P(mm,256,z),(mm=>{16===mm.bi_valid?(N(mm,mm.bi_buf),mm.bi_buf=0,mm.bi_valid=0):mm.bi_valid>=8&&(mm.pending_buf[mm.pending++]=255&mm.bi_buf,mm.bi_buf>>=8,mm.bi_valid-=8)})(mm)}},14684:mm=>{"use strict";mm.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.qo="",this.state=null,this.data_type=2,this.adler=0}},13495:mm=>{function o(mm,o,u){for(var f=mm.length,B=-1/0,O=1/0,r=0;r<f;r++){var w=(u[0][r]-mm[r])/o[r],p=(u[1][r]-mm[r])/o[r];if(w>p){var K=w;w=p,p=K}if(p<B||w>O)return 1/0;w>B&&(B=w),p<O&&(O=p)}return B>O?1/0:B}mm.exports=function(mm,u,f,B){var O=o(u,f,B);if(O===1/0)mm=null;else{mm=mm||[];for(var r=0;r<u.length;r++)mm[r]=u[r]+f[r]*O}return mm},mm.exports.distance=o},14776:(mm,o,u)=>{"use strict";u.d(o,{e:()=>r});var f=u(43);const B=f.useLayoutEffect;const O=function(mm){var o=(0,f.useRef)(mm);return B((function(){o.current=mm})),o};var r=function(mm){var o=O(mm);(0,f.Ko)((function(){var mm=function(mm){var u;if(null!=o.current&&(u=o.current(mm)),mm.defaultPrevented&&(mm.returnValue=""),"string"===typeof u)return mm.returnValue=u,u};return window.addEventListener("beforeunload",mm),function(){window.removeEventListener("beforeunload",mm)}}),[])}},14741:(mm,o,u)=>{"use strict";var f=u(14744),B=Array.prototype.concat,O=Array.prototype.slice,r=mm.exports=function(mm){for(var o=[],u=0,r=mm.length;u<r;u++){var w=mm[u];f(w)?o=B.call(o,O.call(w)):o.push(w)}return o};r.wrap=function(mm){return function(){return mm(r(arguments))}}},14744:mm=>{mm.exports=function(mm){return!(!mm||"string"===typeof mm)&&(mm instanceof Array||Array.isArray(mm)||mm.length>=0&&(mm.splice instanceof Function||Object.getOwnPropertyDescriptor(mm,mm.length-1)&&"String"!==mm.constructor.name))}},14579:(mm,o,u)=>{var f=u(14588);function B(mm){for(var o,u,B=0,O=mm.length,r=0;r<mm.length;){for(o=mm[r],u=0;r<O&&mm[r]===o;)++r,++u;B+=f.log2(u)/7|0,B+=f.log2(o>>>0)/7|0,B+=2}return B}o.size=B,o.encode=function(mm,o){o||(o=new Uint8Array(B(mm)));for(var u,f,O=0,r=o.length,w=0;w<mm.length;){for(u=mm[w],f=0;w<mm.length&&mm[w]===u;)++w,++f;for(;O<r&&f>=128;)o[O++]=128+(127&f),f>>>=7;if(O>=r)throw new Error("RLE buffer overflow");for(o[O++]=f,u>>>=0;O<r&&u>=128;)o[O++]=128+(127&u),u>>>=7;if(O>=r)throw new Error("RLE buffer overflow");o[O++]=u}return o},o.decode=function(mm,o){for(var u,f,B,O,r=o.length,w=mm.length,p=0,K=0;K<w;){for(u=0,f=0;K<w&&mm[K]>=128;)u+=(127&mm[K++])<<f,f+=7;if(u+=mm[K++]<<f,K>=w)throw new Error("RLE buffer underrun");if(p+u>r)throw new Error("Chunk buffer overflow");for(B=0,f=0;K<w&&mm[K]>=128;)B+=(127&mm[K++])<<f,f+=7;if(K>=w)throw new Error("RLE buffer underrun");for(B+=mm[K++]<<f,O=0;O<u;++O)o[p++]=B}return o}},14588:(mm,o)=>{"use strict";function u(mm){var o=32;return(mm&=-mm)&&o--,65535&mm&&(o-=16),16711935&mm&&(o-=8),252645135&mm&&(o-=4),858993459&mm&&(o-=2),1431655765&mm&&(o-=1),o}o.INT_BITS=32,o.INT_MAX=2147483647,o.INT_MIN=-1<<31,o.sign=function(mm){return(mm>0)-(mm<0)},o.abs=function(mm){var o=mm>>31;return(mm^o)-o},o.min=function(mm,o){return o^(mm^o)&-(mm<o)},o.max=function(mm,o){return mm^(mm^o)&-(mm<o)},o.isPow2=function(mm){return!(mm&mm-1)&&!!mm},o.log2=function(mm){var o,u;return o=(mm>65535)<<4,o|=u=((mm>>>=o)>255)<<3,o|=u=((mm>>>=u)>15)<<2,(o|=u=((mm>>>=u)>3)<<1)|(mm>>>=u)>>1},o.log10=function(mm){return mm>=1e9?9:mm>=1e8?8:mm>=1e7?7:mm>=1e6?6:mm>=1e5?5:mm>=1e4?4:mm>=1e3?3:mm>=100?2:mm>=10?1:0},o.popCount=function(mm){return 16843009*((mm=(858993459&(mm-=mm>>>1&1431655765))+(mm>>>2&858993459))+(mm>>>4)&252645135)>>>24},o.countTrailingZeros=u,o.nextPow2=function(mm){return mm+=0===mm,--mm,mm|=mm>>>1,mm|=mm>>>2,mm|=mm>>>4,mm|=mm>>>8,(mm|=mm>>>16)+1},o.prevPow2=function(mm){return mm|=mm>>>1,mm|=mm>>>2,mm|=mm>>>4,mm|=mm>>>8,(mm|=mm>>>16)-(mm>>>1)},o.parity=function(mm){return mm^=mm>>>16,mm^=mm>>>8,mm^=mm>>>4,27030>>>(mm&=15)&1};var f=new Array(256);!function(mm){for(var o=0;o<256;++o){var u=o,f=o,B=7;for(u>>>=1;u;u>>>=1)f<<=1,f|=1&u,--B;mm[o]=f<<B&255}}(f),o.reverse=function(mm){return f[255&mm]<<24|f[mm>>>8&255]<<16|f[mm>>>16&255]<<8|f[mm>>>24&255]},o.interleave2=function(mm,o){return(mm=1431655765&((mm=858993459&((mm=252645135&((mm=16711935&((mm&=65535)|mm<<8))|mm<<4))|mm<<2))|mm<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o&=65535)|o<<8))|o<<4))|o<<2))|o<<1))<<1},o.deinterleave2=function(mm,o){return(mm=65535&((mm=16711935&((mm=252645135&((mm=858993459&((mm=mm>>>o&1431655765)|mm>>>1))|mm>>>2))|mm>>>4))|mm>>>16))<<16>>16},o.interleave3=function(mm,o,u){return mm=1227133513&((mm=3272356035&((mm=251719695&((mm=4278190335&((mm&=1023)|mm<<16))|mm<<8))|mm<<4))|mm<<2),(mm|=(o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2))<<1)|(u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2))<<2},o.deinterleave3=function(mm,o){return(mm=1023&((mm=4278190335&((mm=251719695&((mm=3272356035&((mm=mm>>>o&1227133513)|mm>>>2))|mm>>>4))|mm>>>8))|mm>>>16))<<22>>22},o.nextCombination=function(mm){var o=mm|mm-1;return o+1|(~o&-~o)-1>>>u(mm)+1}},14616:mm=>{"use strict";mm.exports=function(mm,o,u,f){var B=self||window;try{try{var O;try{O=new B.Blob([mm])}catch(K){(O=new(B.BlobBuilder||B.WebKitBlobBuilder||B.MozBlobBuilder||B.MSBlobBuilder)).append(mm),O=O.getBlob()}var r=B.URL||B.webkitURL,w=r.createObjectURL(O),p=new B[o](w,u);return r.revokeObjectURL(w),p}catch(K){return new B[o]("data:application/javascript,".concat(encodeURIComponent(mm)),u)}}catch(K){if(!f)throw Error("Inline worker is not supported");return new B[o](f,u)}}},13484:(mm,o,u)=>{"use strict";function f(mm,o,u,f,B){var O={};return Object.keys(f).forEach((function(mm){O[mm]=f[mm]})),O.enumerable=!!O.enumerable,O.configurable=!!O.configurable,("value"in O||O.initializer)&&(O.writable=!0),O=u.slice().reverse().reduce((function(u,f){return f(mm,o,u)||u}),O),B&&void 0!==O.initializer&&(O.value=O.initializer?O.initializer.call(B):void 0,O.initializer=void 0),void 0===O.initializer&&(Object.defineProperty(mm,o,O),O=null),O}u.d(o,{b:()=>f})},13475:(mm,o,u)=>{"use strict";function f(mm,o,u,f){u&&Object.defineProperty(mm,o,{enumerable:u.enumerable,configurable:u.configurable,writable:u.writable,value:u.initializer?u.initializer.call(f):void 0})}u.d(o,{c:()=>f})},14785:(mm,o,u)=>{"use strict";u.d(o,{d:()=>r,g:()=>Y,k:()=>w,m:()=>O,p:()=>p,r:()=>B,t:()=>K,w:()=>z});var f=u(12934);class B{constructor(){this._easingMode=B.EASINGMODE_EASEIN}setEasingMode(mm){const o=Math.min(Math.max(mm,0),2);this._easingMode=o}getEasingMode(){return this._easingMode}easeInCore(mm){throw new Error("You must implement this method")}ease(mm){switch(this._easingMode){case B.EASINGMODE_EASEIN:return this.easeInCore(mm);case B.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-mm)}return mm>=.5?.5*(1-this.easeInCore(2*(1-mm)))+.5:.5*this.easeInCore(2*mm)}}B.EASINGMODE_EASEIN=0,B.EASINGMODE_EASEOUT=1,B.EASINGMODE_EASEINOUT=2;class O extends B{easeInCore(mm){return mm=Math.max(0,Math.min(1,mm)),1-Math.sqrt(1-mm*mm)}}class r extends B{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=mm}easeInCore(mm){const o=Math.max(0,this.amplitude);return Math.pow(mm,3)-mm*o*Math.sin(3.141592653589793*mm)}}class w extends B{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=mm,this.bounciness=o}easeInCore(mm){const o=Math.max(0,this.bounces);let u=this.bounciness;u<=1&&(u=1.001);const f=Math.pow(u,o),B=1-u,O=(1-f)/B+.5*f,r=mm*O,w=Math.log(-r*(1-u)+1)/Math.log(u),p=Math.floor(w),K=p+1,z=(1-Math.pow(u,p))/(B*O),Y=.5*(z+(1-Math.pow(u,K))/(B*O)),q=mm-Y,x=Y-z;return-Math.pow(1/u,o-p)/(x*x)*(q-x)*(q+x)}}class p extends B{easeInCore(mm){return mm*mm*mm}}class K extends B{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=mm,this.springiness=o}easeInCore(mm){let o;const u=Math.max(0,this.oscillations),f=Math.max(0,this.springiness);return o=0==f?mm:(Math.exp(f*mm)-1)/(Math.exp(f)-1),o*Math.sin((6.283185307179586*u+1.5707963267948966)*mm)}}class z extends B{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=mm}easeInCore(mm){return this.exponent<=0?mm:(Math.exp(this.exponent*mm)-1)/(Math.exp(this.exponent)-1)}}class Y extends B{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=mm,this.y1=o,this.x2=u,this.y2=f}easeInCore(mm){return f.e.Interpolate(mm,this.x1,this.y1,this.x2,this.y2)}}},14187:(mm,o,u)=>{"use strict";u.d(o,{e:()=>r});var f=u(12740),B=u(12748),O=u(13145);class r extends O.c{get _matrix(){return this._compose(),this.Yx}set _matrix(mm){(mm.updateFlag!==this.Yx.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Yx.p(mm),this._markAsDirtyAndDecompose())}constructor(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(mm,o.Pm(),!1),this.name=mm,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=o,this.Yx=(null===B||void 0===B?void 0:B.clone())??f.Matrix.Identity(),this._restMatrix=O??this.Yx.clone(),this._bindMatrix=r??this.Yx.clone(),this._index=w,this._absoluteMatrix=new f.Matrix,this._absoluteBindMatrix=new f.Matrix,this._absoluteInverseBindMatrix=new f.Matrix,this._finalMatrix=new f.Matrix,o.bones.push(this),this.setParent(u,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(mm){this.setParent(mm)}setParent(mm){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==mm){if(this.parent){const mm=this.parent.children.indexOf(this);-1!==mm&&this.parent.children.splice(mm,1)}this._parentNode=mm,this.parent&&this.parent.children.push(this),o&&this._updateAbsoluteBindMatrices(),this.cz()}}getLocalMatrix(){return this._compose(),this.Yx}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(mm){this._restMatrix.p(mm)}setRestPose(mm){this.setRestMatrix(mm)}getBindPose(){return this.getBindMatrix()}setBindMatrix(mm){this.Tf(mm)}setBindPose(mm){this.setBindMatrix(mm)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const mm=f.TmpVectors.lo[0],o=f.TmpVectors.Quaternion[0],u=f.TmpVectors.lo[1];this.getRestMatrix().decompose(mm,o,u),this._linkedTransformNode.position.p(u),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??f.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.p(o),this._linkedTransformNode.rp.p(mm)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(mm){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=mm,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.yp}set position(mm){this._decompose(),this.yp.p(mm),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(mm){this.setRotation(mm)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(mm){this.setRotationQuaternion(mm)}get rp(){return this.getScale()}set rp(mm){this.setScale(mm)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=f.lo.Zero(),this._localRotation=f.Quaternion.Zero(),this.yp=f.lo.Zero()),this.Yx.decompose(this._localScaling,this._localRotation,this.yp))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,f.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.yp,this.Yx)):this._needToCompose=!1)}Tf(mm){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],u=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(mm),o&&this._updateAbsoluteBindMatrices(),u?this._matrix=mm:this.cz()}_updateAbsoluteBindMatrices(mm){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(mm||(mm=this._bindMatrix),this.parent?mm.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(mm),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),o)for(let u=0;u<this.children.length;u++)this.children[u]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}cz(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.cz(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.cz(),this._needToDecompose=!0}_updatePosition(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2?arguments[2]:void 0,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const O=this.getLocalMatrix();if(0==o)B?(O.addAtIndex(12,mm.x),O.addAtIndex(13,mm.y),O.addAtIndex(14,mm.z)):O.setTranslationFromFloats(mm.x,mm.y,mm.z);else{let o=null;u&&(o=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const w=r._TmpMats[0],p=r._TmpVecs[0];this.parent?u&&o?(w.p(this.parent.getAbsoluteMatrix()),w.multiplyToRef(o,w)):w.p(this.parent.getAbsoluteMatrix()):f.Matrix.IdentityToRef(w),B&&w.setTranslationFromFloats(0,0,0),w.invert(),f.lo.TransformCoordinatesToRef(mm,w,p),B?(O.addAtIndex(12,p.x),O.addAtIndex(13,p.y),O.addAtIndex(14,p.z)):O.setTranslationFromFloats(p.x,p.y,p.z)}this._markAsDirtyAndDecompose()}translate(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2?arguments[2]:void 0;this._updatePosition(mm,o,u,!0)}setPosition(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2?arguments[2]:void 0;this._updatePosition(mm,o,u,!1)}setAbsolutePosition(mm,o){this.setPosition(mm,1,o)}scale(mm,o,u){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const O=this.getLocalMatrix(),w=r._TmpMats[0];f.Matrix.ScalingToRef(mm,o,u,w),w.multiplyToRef(O,O),w.invert();for(const f of this.children){const B=f.getLocalMatrix();B.multiplyToRef(w,B),B.multiplyAtIndex(12,mm),B.multiplyAtIndex(13,o),B.multiplyAtIndex(14,u),f._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),B)for(const f of this.children)f.scale(mm,o,u,B)}setScale(mm){this._decompose(),this._localScaling.p(mm),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(mm){this._decompose(),mm.p(this._localScaling)}setYawPitchRoll(mm,o,u){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4?arguments[4]:void 0;if(0===B){const w=r._TmpQuat;return f.Quaternion.RotationYawPitchRollToRef(mm,o,u,w),void this.setRotationQuaternion(w,B,O)}const w=r._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(w,O))return;const p=r._TmpMats[1];f.Matrix.RotationYawPitchRollToRef(mm,o,u,p),w.multiplyToRef(p,p),this._rotateWithMatrix(p,B,O)}rotate(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3?arguments[3]:void 0;const O=r._TmpMats[0];O.setTranslationFromFloats(0,0,0),f.Matrix.RotationAxisToRef(mm,o,O),this._rotateWithMatrix(O,u,B)}setAxisAngle(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3?arguments[3]:void 0;if(0===u){const O=r._TmpQuat;return f.Quaternion.RotationAxisToRef(mm,o,O),void this.setRotationQuaternion(O,u,B)}const O=r._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(O,B))return;const w=r._TmpMats[1];f.Matrix.RotationAxisToRef(mm,o,w),O.multiplyToRef(w,w),this._rotateWithMatrix(w,u,B)}setRotation(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(mm.y,mm.x,mm.z,o,u)}setRotationQuaternion(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2?arguments[2]:void 0;if(0===o)return this._decompose(),this._localRotation.p(mm),void this._markAsDirtyAndCompose();const B=r._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,u))return;const O=r._TmpMats[1];f.Matrix.FromQuaternionToRef(mm,O),B.multiplyToRef(O,O),this._rotateWithMatrix(O,o,u)}setRotationMatrix(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2?arguments[2]:void 0;if(0===o){const B=r._TmpQuat;return f.Quaternion.FromRotationMatrixToRef(mm,B),void this.setRotationQuaternion(B,o,u)}const B=r._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,u))return;const O=r._TmpMats[1];O.p(mm),B.multiplyToRef(mm,O),this._rotateWithMatrix(O,o,u)}_rotateWithMatrix(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2?arguments[2]:void 0;const f=this.getLocalMatrix(),B=f.m[12],O=f.m[13],w=f.m[14],p=this.getParent(),K=r._TmpMats[3],z=r._TmpMats[4];p&&1==o?(u?(K.p(u.getWorldMatrix()),p.getAbsoluteMatrix().multiplyToRef(K,K)):K.p(p.getAbsoluteMatrix()),z.p(K),z.invert(),f.multiplyToRef(K,f),f.multiplyToRef(mm,f),f.multiplyToRef(z,f)):1==o&&u?(K.p(u.getWorldMatrix()),z.p(K),z.invert(),f.multiplyToRef(K,f),f.multiplyToRef(mm,f),f.multiplyToRef(z,f)):f.multiplyToRef(mm,f),f.setTranslationFromFloats(B,O,w),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(mm,o){const u=r._TmpMats[2];return mm.p(this.getAbsoluteMatrix()),o?(mm.multiplyToRef(o.getWorldMatrix(),mm),f.Matrix.ScalingToRef(o.rp.x,o.rp.y,o.rp.z,u)):f.Matrix.IdentityToRef(u),mm.invert(),!isNaN(mm.m[0])&&(u.multiplyAtIndex(0,this._scalingDeterminant),mm.multiplyToRef(u,mm),!0)}wf(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const u=f.lo.Zero();return this.getPositionToRef(mm,o,u),u}getPositionToRef(){let mm=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const mm=this.getLocalMatrix();o.x=mm.m[12],o.y=mm.m[13],o.z=mm.m[14]}else{let u=null;mm&&(u=mm.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let f=r._TmpMats[0];mm&&u?(f.p(this.getAbsoluteMatrix()),f.multiplyToRef(u,f)):f=this.getAbsoluteMatrix(),o.x=f.m[12],o.y=f.m[13],o.z=f.m[14]}}getAbsolutePosition(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const o=f.lo.Zero();return this.getPositionToRef(1,mm,o),o}getAbsolutePositionToRef(mm,o){this.getPositionToRef(1,mm,o)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Yx.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Yx);const mm=this._skeleton.getPoseMatrix();mm&&this._absoluteMatrix.multiplyToRef(mm,this._absoluteMatrix)}const mm=this.children,o=mm.length;for(let u=0;u<o;u++)mm[u].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}wK(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const u=f.lo.Zero();return this.getDirectionToRef(mm,o,u),u}getDirectionToRef(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2?arguments[2]:void 0,B=null;o&&(B=o.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=r._TmpMats[0];O.p(this.getAbsoluteMatrix()),o&&B&&O.multiplyToRef(B,O),f.lo.TransformNormalToRef(mm,O,u),u.normalize()}getRotation(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const u=f.lo.Zero();return this.getRotationToRef(mm,o,u),u}getRotationToRef(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2?arguments[2]:void 0;const f=r._TmpQuat;this.getRotationQuaternionToRef(mm,o,f),f.toEulerAnglesToRef(u)}getRotationQuaternion(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const u=f.Quaternion.Identity();return this.getRotationQuaternionToRef(mm,o,u),u}getRotationQuaternionToRef(){let mm=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),o.p(this._localRotation);else{const u=r._TmpMats[0],f=this.getAbsoluteMatrix();mm?f.multiplyToRef(mm.getWorldMatrix(),u):u.p(f),u.multiplyAtIndex(0,this._scalingDeterminant),u.multiplyAtIndex(1,this._scalingDeterminant),u.multiplyAtIndex(2,this._scalingDeterminant),u.decompose(void 0,o,void 0)}}getRotationMatrix(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1?arguments[1]:void 0;const u=f.Matrix.Identity();return this.getRotationMatrixToRef(mm,o,u),u}getRotationMatrixToRef(){let mm=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(o);else{const u=r._TmpMats[0],f=this.getAbsoluteMatrix();mm?f.multiplyToRef(mm.getWorldMatrix(),u):u.p(f),u.multiplyAtIndex(0,this._scalingDeterminant),u.multiplyAtIndex(1,this._scalingDeterminant),u.multiplyAtIndex(2,this._scalingDeterminant),u.getRotationMatrixToRef(o)}}getAbsolutePositionFromLocal(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const u=f.lo.Zero();return this.getAbsolutePositionFromLocalToRef(mm,o,u),u}getAbsolutePositionFromLocalToRef(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2?arguments[2]:void 0,B=null;o&&(B=o.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=r._TmpMats[0];O.p(this.getAbsoluteMatrix()),o&&B&&O.multiplyToRef(B,O),f.lo.TransformCoordinatesToRef(mm,O,u)}getLocalPositionFromAbsolute(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const u=f.lo.Zero();return this.getLocalPositionFromAbsoluteToRef(mm,o,u),u}getLocalPositionFromAbsoluteToRef(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2?arguments[2]:void 0,B=null;o&&(B=o.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const O=r._TmpMats[0];O.p(this.getAbsoluteMatrix()),o&&B&&O.multiplyToRef(B,O),O.invert(),f.lo.TransformCoordinatesToRef(mm,O,u)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const mm=this._skeleton.bones.indexOf(this);if(-1!==mm&&this._skeleton.bones.splice(mm,1),this._parentNode&&this._parentNode.children){const mm=this._parentNode.children,o=mm.indexOf(this);-1!==o&&mm.splice(o,1)}super.dispose()}}r._TmpVecs=(0,B.b)(2,f.lo.Zero),r._TmpQuat=f.Quaternion.Identity(),r._TmpMats=(0,B.b)(5,f.Matrix.Identity)},14780:(mm,o,u)=>{"use strict";u.d(o,{b:()=>I});var f=u(12729),B=u(12732),O=u(12556),r=u(12740),w=u(12752),p=u(13145),K=u(13166),z=u(13010),Y=u(12581),q=u(12746);class x{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(mm){this._zoomStopsAnimation=mm}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(mm){this._idleRotationSpeed=mm}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(mm){this._idleRotationWaitTime=mm}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(mm){this._idleRotationSpinupTime=mm}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(mm){this._attachedCamera=mm;const o=this._attachedCamera.Pm();this._onPrePointerObservableObserver=o.onPrePointerObservable.add((mm=>{mm.type!==z.c.POINTERDOWN?mm.type===z.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=mm.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const mm=Y.b.Now;let o=0;null!=this._lastFrameTime&&(o=mm-this._lastFrameTime),this._lastFrameTime=mm,this._applyUserInteraction();const u=mm-this._lastInteractionTime-this._idleRotationWaitTime,f=Math.max(Math.min(u/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*f,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(o/1e3))}))}detach(){if(!this._attachedCamera)return;const mm=this._attachedCamera.Pm();this._onPrePointerObservableObserver&&mm.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(mm){this._lastInteractionTime=mm??Y.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<q.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let mm=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(mm=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?mm:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Y.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var H=u(14785),E=u(13233);class M{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(mm){if(this._autoTransitionRange===mm)return;this._autoTransitionRange=mm;const o=this._attachedCamera;o&&(mm?this._onMeshTargetChangedObserver=o.onMeshTargetChangedObservable.add((mm=>{if(mm&&(mm.Df(!0),mm.getBoundingInfo)){const o=mm.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*o,this.upperRadiusTransitionRange=.05*o}})):this._onMeshTargetChangedObserver&&o.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(mm){this._attachedCamera=mm,this._onAfterCheckInputsObserver=mm.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(mm){return!!this._attachedCamera&&(this._attachedCamera.radius===mm&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(mm){if(!this._attachedCamera)return;this._radiusBounceTransition||(M.EasingFunction.setEasingMode(M.EasingMode),this._radiusBounceTransition=E.d.CreateAnimation("radius",E.d.ANIMATIONTYPE_FLOAT,60,M.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const o=E.d.TransitionTo("radius",this._attachedCamera.radius+mm,this._attachedCamera,this._attachedCamera.Pm(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));o&&this._animatables.push(o)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}M.EasingFunction=new H.d(.3),M.EasingMode=H.r.EASINGMODE_EASEOUT;class l{constructor(){this.onTargetFramingAnimationEndObservable=new O.d,this._mode=l.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(mm){this._mode=mm}get mode(){return this._mode}set radiusScale(mm){this._radiusScale=mm}get radiusScale(){return this._radiusScale}set positionScale(mm){this._positionScale=mm}get positionScale(){return this._positionScale}set defaultElevation(mm){this._defaultElevation=mm}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(mm){this._elevationReturnTime=mm}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(mm){this._elevationReturnWaitTime=mm}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(mm){this._zoomStopsAnimation=mm}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(mm){this._framingTime=mm}get framingTime(){return this._framingTime}init(){}attach(mm){this._attachedCamera=mm;const o=this._attachedCamera.Pm();l.EasingFunction.setEasingMode(l.EasingMode),this._onPrePointerObservableObserver=o.onPrePointerObservable.add((mm=>{mm.type!==z.c.POINTERDOWN?mm.type===z.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=mm.onMeshTargetChangedObservable.add((mm=>{mm&&mm.getBoundingInfo&&this.zoomOnMesh(mm,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=mm.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const mm=this._attachedCamera.Pm();this._onPrePointerObservableObserver&&mm.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;mm.Df(!0);const f=mm.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(f.minimumWorld,f.maximumWorld,o,u)}zoomOnMeshHierarchy(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;mm.Df(!0);const f=mm.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(f.min,f.max,o,u)}zoomOnMeshesHierarchy(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new r.lo(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),B=new r.lo(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let O=0;O<mm.length;O++){const o=mm[O].getHierarchyBoundingVectors(!0);r.lo.CheckExtends(o.min,f,B),r.lo.CheckExtends(o.max,f,B)}this.zoomOnBoundingInfo(f,B,o,u)}zoomOnBoundingInfo(mm,o){let u,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const O=mm.y,w=O+(o.y-O)*this._positionScale,p=o.Qo(mm).scale(.5);if(!isFinite(w))return!1;if(f)u=new r.lo(0,w,0);else{const o=mm.add(p);u=new r.lo(o.x,w,o.z)}this._vectorTransition||(this._vectorTransition=E.d.CreateAnimation("target",E.d.ANIMATIONTYPE_VECTOR3,60,l.EasingFunction)),this._betaIsAnimating=!0;let K=E.d.TransitionTo("target",u,this._attachedCamera,this._attachedCamera.Pm(),60,this._vectorTransition,this._framingTime);K&&this._animatables.push(K);let z=0;if(this._mode===l.FitFrustumSidesMode){const u=this._calculateLowerRadiusFromModelBoundingSphere(mm,o);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=p.length()+this._attachedCamera.hf),z=u}else this._mode===l.IgnoreBoundsSizeMode&&(z=this._calculateLowerRadiusFromModelBoundingSphere(mm,o),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.hf));if(this.autoCorrectCameraLimitsAndSensibility){const u=o.Qo(mm).length();this._attachedCamera.panningSensibility=5e3/u,this._attachedCamera.wheelPrecision=100/z}return this._radiusTransition||(this._radiusTransition=E.d.CreateAnimation("radius",E.d.ANIMATIONTYPE_FLOAT,60,l.EasingFunction)),K=E.d.TransitionTo("radius",z,this._attachedCamera,this._attachedCamera.Pm(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),B&&B(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),K&&this._animatables.push(K),!0}_calculateLowerRadiusFromModelBoundingSphere(mm,o){const u=this._attachedCamera;if(!u)return 0;let f=u._calculateLowerRadiusFromModelBoundingSphere(mm,o,this._radiusScale);return u.lowerRadiusLimit&&this._mode===l.IgnoreBoundsSizeMode&&(f=f<u.lowerRadiusLimit?u.lowerRadiusLimit:f),u.upperRadiusLimit&&(f=f>u.upperRadiusLimit?u.upperRadiusLimit:f),f}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const mm=Y.b.Now-this._lastInteractionTime,o=.5*Math.PI-this._defaultElevation,u=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>u&&mm>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=E.d.CreateAnimation("beta",E.d.ANIMATIONTYPE_FLOAT,60,l.EasingFunction));const mm=E.d.TransitionTo("beta",o,this._attachedCamera,this._attachedCamera.Pm(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));mm&&this._animatables.push(mm)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=Y.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}l.EasingFunction=new H.w,l.EasingMode=H.r.EASINGMODE_EASEINOUT,l.IgnoreBoundsSizeMode=0,l.FitFrustumSidesMode=1;var t=u(13170),Q=u(13193),b=u(14180),J=u(12549);class N{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(mm){mm=J.Tools.BackCompatCameraNoPreventDefault(arguments);const o=this.camera.getEngine(),u=o.getInputElement();let f=0,B=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=O=>{var r,w;const p=O.event,K="touch"===p.pointerType;if(O.type!==z.c.POINTERMOVE&&-1===this.buttons.indexOf(p.button))return;const Y=p.target;if(this._altKey=p.altKey,this._ctrlKey=p.ctrlKey,this._metaKey=p.metaKey,this._shiftKey=p.shiftKey,this._buttonsPressed=p.buttons,o.isPointerLock){const mm=p.movementX,o=p.movementY;this.onTouch(null,mm,o),this._pointA=null,this._pointB=null}else{if(O.type!==z.c.POINTERDOWN&&O.type!==z.c.POINTERDOUBLETAP&&K&&(null===(r=this._pointA)||void 0===r?void 0:r.pointerId)!==p.pointerId&&(null===(w=this._pointB)||void 0===w?void 0:w.pointerId)!==p.pointerId)return;if(O.type!==z.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!K)if(O.type===z.c.POINTERDOUBLETAP)this.onDoubleTap(p.pointerType);else if(O.type!==z.c.POINTERUP||this._currentMousePointerIdDown!==p.pointerId&&!K){if(O.type===z.c.POINTERMOVE)if(mm||p.preventDefault(),this._pointA&&null===this._pointB){const mm=p.clientX-this._pointA.x,o=p.clientY-this._pointA.y;this._pointA.x=p.clientX,this._pointA.y=p.clientY,this.onTouch(this._pointA,mm,o)}else if(this._pointA&&this._pointB){const mm=this._pointA.pointerId===p.pointerId?this._pointA:this._pointB;mm.x=p.clientX,mm.y=p.clientY;const o=this._pointA.x-this._pointB.x,u=this._pointA.y-this._pointB.y,r=o*o+u*u,w={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:p.pointerId,type:O.type};this.onMultiTouch(this._pointA,this._pointB,f,r,B,w),B=w,f=r}}else{try{null===Y||void 0===Y||Y.releasePointerCapture(p.pointerId)}catch(q){}K||(this._pointB=null),o._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==p.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==p.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==f||B)&&(this.onMultiTouch(this._pointA,this._pointB,f,0,B,null),f=0,B=null),this._currentMousePointerIdDown=-1,this.onButtonUp(p),mm||p.preventDefault()}else{try{null===Y||void 0===Y||Y.setPointerCapture(p.pointerId)}catch(q){}if(null===this._pointA)this._pointA={x:p.clientX,y:p.clientY,pointerId:p.pointerId,type:p.pointerType};else{if(null!==this._pointB)return;this._pointB={x:p.clientX,y:p.clientY,pointerId:p.pointerId,type:p.pointerType}}-1!==this._currentMousePointerIdDown||K||(this._currentMousePointerIdDown=p.pointerId),this.onButtonDown(p),mm||(p.preventDefault(),u&&u.focus())}}},this._observer=this.camera.Pm()._inputManager._addCameraPointerObserver(this._pointerInput,z.c.POINTERDOWN|z.c.POINTERUP|z.c.POINTERMOVE|z.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,f=0,B=null,this.onLostFocus()},this._contextMenuBind=mm=>this.onContextMenu(mm),u&&u.addEventListener("contextmenu",this._contextMenuBind,!1);const O=this.camera.Pm().getEngine().getHostWindow();O&&J.Tools.RegisterTopRootEvents(O,[{name:"blur",handler:this._onLostFocus}])}tq(){if(this._onLostFocus){const mm=this.camera.Pm().getEngine().getHostWindow();mm&&J.Tools.UnregisterTopRootEvents(mm,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Pm()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const mm=this.camera.Pm().getEngine().getInputElement();mm&&mm.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(mm){}onTouch(mm,o,u){}onMultiTouch(mm,o,u,f,B,O){}onContextMenu(mm){mm.preventDefault()}onButtonDown(mm){}onButtonUp(mm){}onLostFocus(){}}(0,f.d)([(0,B.J)()],N.prototype,"buttons",void 0);class S extends N{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(mm,o){if(0!==this.panningSensibility&&mm&&o){const u=o.x-mm.x,f=o.y-mm.y;this.camera.inertialPanningX+=-u/this.panningSensibility,this.camera.inertialPanningY+=f/this.panningSensibility}}_computePinchZoom(mm,o){const u=this.camera.radius||S.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=u*Math.sqrt(mm)/Math.sqrt(o):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(o-mm)*u*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(o-mm)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(mm,o,u){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-o/this.panningSensibility,this.camera.inertialPanningY+=u/this.panningSensibility):(this.camera.inertialAlphaOffset-=o/this.angularSensibilityX,this.camera.inertialBetaOffset-=u/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(mm,o,u,f,B,O){0===u&&null===B||0===f&&null===O||(this.multiTouchPanAndZoom?(this._computePinchZoom(u,f),this._computeMultiTouchPanning(B,O)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(f)-Math.sqrt(u))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(u,f),this._isPinching=!0):this._computeMultiTouchPanning(B,O)):this.multiTouchPanning?this._computeMultiTouchPanning(B,O):this.pinchZoom&&this._computePinchZoom(u,f))}onButtonDown(mm){this._isPanClick=mm.button===this.camera._panningMouseButton}onButtonUp(mm){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}S.MinimumRadiusForPinch=.001,(0,f.d)([(0,B.J)()],S.prototype,"buttons",void 0),(0,f.d)([(0,B.J)()],S.prototype,"angularSensibilityX",void 0),(0,f.d)([(0,B.J)()],S.prototype,"angularSensibilityY",void 0),(0,f.d)([(0,B.J)()],S.prototype,"pinchPrecision",void 0),(0,f.d)([(0,B.J)()],S.prototype,"pinchDeltaPercentage",void 0),(0,f.d)([(0,B.J)()],S.prototype,"useNaturalPinchZoom",void 0),(0,f.d)([(0,B.J)()],S.prototype,"pinchZoom",void 0),(0,f.d)([(0,B.J)()],S.prototype,"panningSensibility",void 0),(0,f.d)([(0,B.J)()],S.prototype,"multiTouchPanning",void 0),(0,f.d)([(0,B.J)()],S.prototype,"multiTouchPanAndZoom",void 0),b.c.ArcRotateCameraPointersInput=S;var P=u(13014);class R{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(mm){mm=J.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Pm(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((o=>{const u=o.event;if(!u.metaKey)if(o.type===P.d.KEYDOWN){if(this._ctrlPressed=u.ctrlKey,this._altPressed=u.altKey,-1!==this.keysUp.indexOf(u.keyCode)||-1!==this.keysDown.indexOf(u.keyCode)||-1!==this.keysLeft.indexOf(u.keyCode)||-1!==this.keysRight.indexOf(u.keyCode)||-1!==this.keysReset.indexOf(u.keyCode)){-1===this._keys.indexOf(u.keyCode)&&this._keys.push(u.keyCode),u.preventDefault&&(mm||u.preventDefault())}}else if(-1!==this.keysUp.indexOf(u.keyCode)||-1!==this.keysDown.indexOf(u.keyCode)||-1!==this.keysLeft.indexOf(u.keyCode)||-1!==this.keysRight.indexOf(u.keyCode)||-1!==this.keysReset.indexOf(u.keyCode)){const o=this._keys.indexOf(u.keyCode);o>=0&&this._keys.splice(o,1),u.preventDefault&&(mm||u.preventDefault())}})))}tq(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const mm=this.camera;for(let o=0;o<this._keys.length;o++){const u=this._keys[o];-1!==this.keysLeft.indexOf(u)?this._ctrlPressed&&this.camera._useCtrlForPanning?mm.inertialPanningX-=1/this.panningSensibility:mm.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(u)?this._ctrlPressed&&this.camera._useCtrlForPanning?mm.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?mm.inertialRadiusOffset+=1/this.zoomingSensibility:mm.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(u)?this._ctrlPressed&&this.camera._useCtrlForPanning?mm.inertialPanningX+=1/this.panningSensibility:mm.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(u)?this._ctrlPressed&&this.camera._useCtrlForPanning?mm.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?mm.inertialRadiusOffset-=1/this.zoomingSensibility:mm.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(u)&&mm.useInputToRestoreState&&mm.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,f.d)([(0,B.J)()],R.prototype,"keysUp",void 0),(0,f.d)([(0,B.J)()],R.prototype,"keysDown",void 0),(0,f.d)([(0,B.J)()],R.prototype,"keysLeft",void 0),(0,f.d)([(0,B.J)()],R.prototype,"keysRight",void 0),(0,f.d)([(0,B.J)()],R.prototype,"keysReset",void 0),(0,f.d)([(0,B.J)()],R.prototype,"panningSensibility",void 0),(0,f.d)([(0,B.J)()],R.prototype,"zoomingSensibility",void 0),(0,f.d)([(0,B.J)()],R.prototype,"useAltToZoom",void 0),(0,f.d)([(0,B.J)()],R.prototype,"angularSpeed",void 0),b.c.ArcRotateCameraKeyboardMoveInput=R;var g=u(12783),W=u(13016);class F{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new r.lo(0,0,0),this._globalOffset=new r.lo(0,0,0),this._inertialPanning=r.lo.Zero()}_computeDeltaFromMouseWheelLegacyEvent(mm,o){let u=0;const f=.01*mm*this.wheelDeltaPercentage*o;return u=mm>0?f/(1+this.wheelDeltaPercentage):f*(1+this.wheelDeltaPercentage),u}attachControl(mm){mm=J.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=o=>{if(o.type!==z.c.POINTERWHEEL)return;const u=o.event;let f=0;const B=u.deltaMode===W.c.DOM_DELTA_LINE?40:1,O=-u.deltaY*B;if(this.customComputeDeltaFromMouseWheel)f=this.customComputeDeltaFromMouseWheel(O,this,u);else if(this.wheelDeltaPercentage){if(f=this._computeDeltaFromMouseWheelLegacyEvent(O,this.camera.radius),f>0){let mm=this.camera.radius,o=this.camera.inertialRadiusOffset+f;for(let u=0;u<20&&!(mm<=o)&&!(Math.abs(o*this.camera.inertia)<.001);u++)mm-=o,o*=this.camera.inertia;mm=(0,w.Clamp)(mm,0,Number.MAX_VALUE),f=this._computeDeltaFromMouseWheelLegacyEvent(O,mm)}}else f=O/(40*this.wheelPrecision);f&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(f)):this.camera.inertialRadiusOffset+=f),u.preventDefault&&(mm||u.preventDefault())},this._observer=this.camera.Pm()._inputManager._addCameraPointerObserver(this._wheel,z.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.wp(0)}tq(){this._observer&&(this.camera.Pm()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const mm=this.camera;0+mm.inertialAlphaOffset+mm.inertialBetaOffset+mm.inertialRadiusOffset&&(this._updateHitPlane(),mm.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(mm.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const mm=this.camera,o=mm.target.Qo(mm.position);this._hitPlane=g.c.FromPositionAndNormal(mm.target,o)}_getPosition(){const mm=this.camera,o=mm.Pm(),u=o.createPickingRay(o.pointerX,o.pointerY,r.Matrix.Identity(),mm,!1);0===mm.targetScreenOffset.x&&0===mm.targetScreenOffset.y||(this._viewOffset.set(mm.targetScreenOffset.x,mm.targetScreenOffset.y,0),mm.getViewMatrix().invertToRef(mm._cameraTransformMatrix),this._globalOffset=r.lo.TransformNormal(this._viewOffset,mm._cameraTransformMatrix),u.origin.addInPlace(this._globalOffset));let f=0;return this._hitPlane&&(f=u.intersectsPlane(this._hitPlane)??0),u.origin.addInPlace(u.direction.scaleInPlace(f))}_zoomToMouse(mm){const o=this.camera,u=1-o.inertia;if(o.lowerRadiusLimit){const f=o.lowerRadiusLimit??0;o.radius-(o.inertialRadiusOffset+mm)/u<f&&(mm=(o.radius-f)*u-o.inertialRadiusOffset)}if(o.upperRadiusLimit){const f=o.upperRadiusLimit??0;o.radius-(o.inertialRadiusOffset+mm)/u>f&&(mm=(o.radius-f)*u-o.inertialRadiusOffset)}const f=mm/u/o.radius,B=this._getPosition(),O=r.TmpVectors.lo[6];B.subtractToRef(o.target,O),O.scaleInPlace(f),O.scaleInPlace(u),this._inertialPanning.addInPlace(O),o.inertialRadiusOffset+=mm}_zeroIfClose(mm){Math.abs(mm.x)<q.e&&(mm.x=0),Math.abs(mm.y)<q.e&&(mm.y=0),Math.abs(mm.z)<q.e&&(mm.z=0)}}(0,f.d)([(0,B.J)()],F.prototype,"wheelPrecision",void 0),(0,f.d)([(0,B.J)()],F.prototype,"zoomToMouseLocation",void 0),(0,f.d)([(0,B.J)()],F.prototype,"wheelDeltaPercentage",void 0),b.c.ArcRotateCameraMouseWheelInput=F;class c extends b.f{constructor(mm){super(mm)}addMouseWheel(){return this.add(new F),this}addPointers(){return this.add(new S),this}addKeyboard(){return this.add(new R),this}}var A=u(12702);function y(mm,o){return isNaN(mm)?o:mm}p.c.AddNodeConstructor("ArcRotateCamera",((mm,o)=>()=>new I(mm,0,0,1,r.lo.Zero(),o)));class I extends Q.b{get target(){return this._target}set target(mm){this.setTarget(mm)}get targetHost(){return this._targetHost}set targetHost(mm){mm&&this.setTarget(mm)}getTarget(){return this.target}get position(){return this._position}set position(mm){this.setPosition(mm)}set upVector(mm){this._upToYMatrix||(this._yToUpMatrix=new r.Matrix,this._upToYMatrix=new r.Matrix,this._upVector=r.lo.Zero()),mm.normalize(),this._upVector.p(mm),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){r.Matrix.RotationAlignToRef(r.lo.UpReadOnly,this._upVector,this._yToUpMatrix),r.Matrix.RotationAlignToRef(this._upVector,r.lo.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const mm=this.inputs.attached.pointers;return mm?mm.angularSensibilityX:0}set angularSensibilityX(mm){const o=this.inputs.attached.pointers;o&&(o.angularSensibilityX=mm)}get angularSensibilityY(){const mm=this.inputs.attached.pointers;return mm?mm.angularSensibilityY:0}set angularSensibilityY(mm){const o=this.inputs.attached.pointers;o&&(o.angularSensibilityY=mm)}get pinchPrecision(){const mm=this.inputs.attached.pointers;return mm?mm.pinchPrecision:0}set pinchPrecision(mm){const o=this.inputs.attached.pointers;o&&(o.pinchPrecision=mm)}get pinchDeltaPercentage(){const mm=this.inputs.attached.pointers;return mm?mm.pinchDeltaPercentage:0}set pinchDeltaPercentage(mm){const o=this.inputs.attached.pointers;o&&(o.pinchDeltaPercentage=mm)}get useNaturalPinchZoom(){const mm=this.inputs.attached.pointers;return!!mm&&mm.useNaturalPinchZoom}set useNaturalPinchZoom(mm){const o=this.inputs.attached.pointers;o&&(o.useNaturalPinchZoom=mm)}get panningSensibility(){const mm=this.inputs.attached.pointers;return mm?mm.panningSensibility:0}set panningSensibility(mm){const o=this.inputs.attached.pointers;o&&(o.panningSensibility=mm)}get keysUp(){const mm=this.inputs.attached.keyboard;return mm?mm.keysUp:[]}set keysUp(mm){const o=this.inputs.attached.keyboard;o&&(o.keysUp=mm)}get keysDown(){const mm=this.inputs.attached.keyboard;return mm?mm.keysDown:[]}set keysDown(mm){const o=this.inputs.attached.keyboard;o&&(o.keysDown=mm)}get keysLeft(){const mm=this.inputs.attached.keyboard;return mm?mm.keysLeft:[]}set keysLeft(mm){const o=this.inputs.attached.keyboard;o&&(o.keysLeft=mm)}get keysRight(){const mm=this.inputs.attached.keyboard;return mm?mm.keysRight:[]}set keysRight(mm){const o=this.inputs.attached.keyboard;o&&(o.keysRight=mm)}get wheelPrecision(){const mm=this.inputs.attached.mousewheel;return mm?mm.wheelPrecision:0}set wheelPrecision(mm){const o=this.inputs.attached.mousewheel;o&&(o.wheelPrecision=mm)}get zoomToMouseLocation(){const mm=this.inputs.attached.mousewheel;return!!mm&&mm.zoomToMouseLocation}set zoomToMouseLocation(mm){const o=this.inputs.attached.mousewheel;o&&(o.zoomToMouseLocation=mm)}get wheelDeltaPercentage(){const mm=this.inputs.attached.mousewheel;return mm?mm.wheelDeltaPercentage:0}set wheelDeltaPercentage(mm){const o=this.inputs.attached.mousewheel;o&&(o.wheelDeltaPercentage=mm)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(mm){mm!==this.useBouncingBehavior&&(mm?(this._bouncingBehavior=new M,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(mm){mm!==this.useFramingBehavior&&(mm?(this._framingBehavior=new l,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(mm){mm!==this.useAutoRotationBehavior&&(mm?(this._autoRotationBehavior=new x,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(mm,o,u,f,B,w){var p;let K=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(mm,r.lo.Zero(),w,K),p=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=r.lo.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=r.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new r.Matrix,this.panningAxis=new r.lo(1,1,0),this._transformedDirection=new r.lo,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new O.d,this.checkCollisions=!1,this.collisionRadius=new r.lo(.5,.5,.5),this._previousPosition=r.lo.Zero(),this._collisionVelocity=r.lo.Zero(),this._newPosition=r.lo.Zero(),this._computationVector=r.lo.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new r.lo(NaN,NaN,NaN),this._goalTargetScreenOffset=new r.Vector2(NaN,NaN),this._onCollisionPositionChange=function(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;u?(p.setPosition(o),p.pH&&p.pH(u)):p._previousPosition.p(p._position);const f=Math.cos(p.alpha),B=Math.sin(p.alpha),O=Math.cos(p.beta);let r=Math.sin(p.beta);0===r&&(r=1e-4);const w=p._getTargetPosition();p._computationVector.Op(p.radius*f*r,p.radius*O,p.radius*B*r),w.addToRef(p._computationVector,p._newPosition),p._position.p(p._newPosition);let K=p.upVector;p.allowUpsideDown&&p.beta<0&&(K=K.clone(),K=K.negate()),p._computeViewMatrix(p._position,w,K),p._viewMatrix.addAtIndex(12,p.targetScreenOffset.x),p._viewMatrix.addAtIndex(13,p.targetScreenOffset.y),p._collisionTriggered=!1},this._target=r.lo.Zero(),B&&this.setTarget(B),this.alpha=o,this.beta=u,this.radius=f,this.getViewMatrix(),this.inputs=new c(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new r.lo(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=r.Vector2.Zero()}_updateCache(mm){mm||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const mm=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?mm.addToRef(this._targetBoundingCenter,this._target):this._target.p(mm)}const mm=this._getLockedTargetPosition();return mm||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>q.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,O=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=O?this._currentInterpolationFactor=O:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=y(mm,this._goalAlpha),this._goalBeta=y(o,this._goalBeta),this._goalRadius=y(u,this._goalRadius),this._goalTarget.set(y(f.x,this._goalTarget.x),y(f.y,this._goalTarget.y),y(f.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(y(B.x,this._goalTargetScreenOffset.x),y(B.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,w.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,w.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,w.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,w.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(mm,o){let u=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const B=arguments;o=J.Tools.BackCompatCameraNoPreventDefault(B),this._useCtrlForPanning=u,this._panningMouseButton=f,"boolean"===typeof B[0]&&(B.length>1&&(this._useCtrlForPanning=B[1]),B.length>2&&(this._panningMouseButton=B[2])),this.inputs.attachElement(o),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}tq(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let mm=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){mm=!0;const o=this.invertRotation?-1:1,u=this._calculateHandednessMultiplier();let f=this.inertialAlphaOffset*u;this.beta<0&&(f*=-1),this.alpha+=f*o,this.beta+=this.inertialBetaOffset*o,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<q.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<q.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*q.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){mm=!0;const o=new r.lo(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),o.multiplyInPlace(this.panningAxis),r.lo.TransformNormalToRef(o,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const mm=this.upVector,o=r.lo.CrossToRef(this._transformedDirection,mm,this._transformedDirection);r.lo.CrossToRef(mm,o,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);r.lo.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const mm=r.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(mm),mm.transposeToRef(mm),r.lo.TransformCoordinatesToRef(this._transformedDirection,mm,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*q.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*q.e&&(this.inertialPanningY=0)}if(mm)this.stopInterpolation();else if(this._isInterpolating){let mm=!1;const o=this._scene.getEngine().getDeltaTime()/1e3,u=1-Math.pow(2,-o/this._currentInterpolationFactor),f=y(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const o=r.TmpVectors.lo[0].set(y(this._goalTarget.x,this._target.x),y(this._goalTarget.y,this._target.y),y(this._goalTarget.z,this._target.z));r.lo.LerpToRef(this.target,o,u,this._target),10*r.lo.Distance(this.target,o)/f<q.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.p(o),this.setTarget(this.target,!1,!0,!0)):mm=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const o=r.Quaternion.RotationAlphaBetaGammaToRef(y(this._goalAlpha,this.alpha),y(this._goalBeta,this.beta),0,r.TmpVectors.Quaternion[0]),f=r.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,r.TmpVectors.Quaternion[1]),B=r.Quaternion.SlerpToRef(f,o,u,r.TmpVectors.Quaternion[2]);B.normalize();const O=B.toAlphaBetaGammaToRef(r.TmpVectors.lo[0]);if(this.alpha=O.x,this.beta=O.y,B.isApprox(o,q.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const mm=o.toAlphaBetaGammaToRef(r.TmpVectors.lo[0]);this.alpha=mm.x,this.beta=mm.y}else mm=!0}if(isNaN(this._goalRadius)||(this.radius+=(f-this.radius)*u,Math.abs(f/this.radius-1)<q.e?(this._goalRadius=NaN,this.radius=f):mm=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const o=r.TmpVectors.Vector2[0].set(y(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),y(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));r.Vector2.LerpToRef(this.targetScreenOffset,o,u,this.targetScreenOffset),r.Vector2.Distance(this.targetScreenOffset,o)<q.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.p(o)):mm=!0}this._isInterpolating=mm}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||r.lo.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const mm=this.alpha;var o,u;this.alpha=function(mm){let o=Math.PI/2;return 0===mm.x&&0===mm.z||(o=Math.acos(mm.x/Math.sqrt(Math.pow(mm.x,2)+Math.pow(mm.z,2)))),mm.z<0&&(o=2*Math.PI-o),o}(this._computationVector),this.beta=(o=this._computationVector.y,u=this.radius,Math.acos(o/u));const f=Math.round((mm-this.alpha)/(2*Math.PI));this.alpha+=2*f*Math.PI,this._checkLimits()}setPosition(mm){this._position.equals(mm)||(this._position.p(mm),this.rebuildAnglesAndRadius())}setTarget(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(f=this.overrideCloneAlphaBetaRadius??f,mm.Df)o&&mm.getBoundingInfo?this._targetBoundingCenter=mm.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,mm.Df(),this._targetHost=mm,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const o=mm,f=this._getTargetPosition();if(f&&!u&&f.equals(o))return;this._targetHost=null,this._target=o,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}f||this.rebuildAnglesAndRadius()}_getViewMatrix(){const mm=Math.cos(this.alpha),o=Math.sin(this.alpha),u=Math.cos(this.beta);let f=Math.sin(this.beta);0===f&&(f=1e-4),0===this.radius&&(this.radius=1e-4);const B=this._getTargetPosition();if(this._computationVector.Op(this.radius*mm*f,this.radius*u,this.radius*o*f),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||r.lo.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),B.addToRef(this._computationVector,this._newPosition),this.Pm().collisionsEnabled&&this.checkCollisions){const mm=this.Pm().collisionCoordinator;this._collider||(this._collider=mm.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,mm.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let mm=this.upVector;this.allowUpsideDown&&f<0&&(mm=mm.negate()),this._computeViewMatrix(this._position,B,mm),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.p(B),this._viewMatrix}zoomOn(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];mm=mm||this.Pm().meshes;const u=K.d.MinMax(mm);let f=this._calculateLowerRadiusFromModelBoundingSphere(u.min,u.max);if(f=Math.max(Math.min(f,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=f*this.zoomOnFactor,this.mode===t.b.ORTHOGRAPHIC_CAMERA){const mm=this.Pm().getEngine().getAspectRatio(this),o=f*this.zoomOnFactor/2;this.orthoLeft=-o*mm,this.orthoRight=o*mm,this.orthoBottom=-o,this.orthoTop=o}this.focusOn({min:u.min,max:u.max,distance:f},o)}focusOn(mm){let o,u,f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===mm.min){const f=mm||this.Pm().meshes;o=K.d.MinMax(f),u=r.lo.Distance(o.min,o.max)}else{o=mm,u=mm.distance}this._target=K.d.Center(o),f||(this.maxZ=2*u)}createRigCamera(mm,o){let u=0;switch(this.cameraRigMode){case t.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case t.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case t.b.RIG_MODE_VR:u=this._cameraRigParams.stereoHalfAngle*(0===o?1:-1);break;case t.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:u=this._cameraRigParams.stereoHalfAngle*(0===o?-1:1)}const f=new I(mm,this.alpha+u,this.beta,this.radius,this._target,this.Pm());return f._cameraRigParams={},f.isRigCamera=!0,f.rigParent=this,f.upVector=this.upVector,f.mode=this.mode,f.orthoLeft=this.orthoLeft,f.orthoRight=this.orthoRight,f.orthoBottom=this.orthoBottom,f.orthoTop=this.orthoTop,f}_updateRigCameras(){const mm=this._rigCameras[0],o=this._rigCameras[1];switch(mm.beta=o.beta=this.beta,this.cameraRigMode){case t.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case t.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case t.b.RIG_MODE_VR:mm.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,o.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case t.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:mm.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,o.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const f=r.lo.Distance(mm,o),B=this.Pm().getEngine().getAspectRatio(this),O=Math.tan(this.fov/2),w=O*B,p=.5*f*u,K=p*Math.sqrt(1+1/(w*w)),z=p*Math.sqrt(1+1/(O*O));return Math.max(K,z)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,f.d)([(0,B.J)()],I.prototype,"alpha",void 0),(0,f.d)([(0,B.J)()],I.prototype,"beta",void 0),(0,f.d)([(0,B.J)()],I.prototype,"radius",void 0),(0,f.d)([(0,B.J)()],I.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,f.d)([(0,B.F)("target")],I.prototype,"_target",void 0),(0,f.d)([(0,B.u)("targetHost")],I.prototype,"_targetHost",void 0),(0,f.d)([(0,B.J)()],I.prototype,"inertialAlphaOffset",void 0),(0,f.d)([(0,B.J)()],I.prototype,"inertialBetaOffset",void 0),(0,f.d)([(0,B.J)()],I.prototype,"inertialRadiusOffset",void 0),(0,f.d)([(0,B.J)()],I.prototype,"lowerAlphaLimit",void 0),(0,f.d)([(0,B.J)()],I.prototype,"upperAlphaLimit",void 0),(0,f.d)([(0,B.J)()],I.prototype,"lowerBetaLimit",void 0),(0,f.d)([(0,B.J)()],I.prototype,"upperBetaLimit",void 0),(0,f.d)([(0,B.J)()],I.prototype,"lowerRadiusLimit",void 0),(0,f.d)([(0,B.J)()],I.prototype,"upperRadiusLimit",void 0),(0,f.d)([(0,B.J)()],I.prototype,"lowerTargetYLimit",void 0),(0,f.d)([(0,B.J)()],I.prototype,"inertialPanningX",void 0),(0,f.d)([(0,B.J)()],I.prototype,"inertialPanningY",void 0),(0,f.d)([(0,B.J)()],I.prototype,"pinchToPanMaxDistance",void 0),(0,f.d)([(0,B.J)()],I.prototype,"panningDistanceLimit",void 0),(0,f.d)([(0,B.F)()],I.prototype,"panningOriginTarget",void 0),(0,f.d)([(0,B.J)()],I.prototype,"panningInertia",void 0),(0,f.d)([(0,B.J)()],I.prototype,"zoomToMouseLocation",null),(0,f.d)([(0,B.J)()],I.prototype,"zoomOnFactor",void 0),(0,f.d)([(0,B.E)()],I.prototype,"targetScreenOffset",void 0),(0,f.d)([(0,B.J)()],I.prototype,"allowUpsideDown",void 0),(0,f.d)([(0,B.J)()],I.prototype,"useInputToRestoreState",void 0),(0,f.d)([(0,B.J)()],I.prototype,"restoreStateInterpolationFactor",void 0),(0,A.c)("BABYLON.ArcRotateCamera",I)},14180:(mm,o,u)=>{"use strict";u.d(o,{c:()=>r,f:()=>w});var f=u(12565),B=u(12766),O=u(13170),r={};class w{constructor(mm){this.attachedToElement=!1,this.attached={},this.camera=mm,this.checkInputs=()=>{}}add(mm){const o=mm.getSimpleName();this.attached[o]?f.e.Warn("camera input of type "+o+" already exists on camera"):(this.attached[o]=mm,mm.camera=this.camera,mm.checkInputs&&(this.checkInputs=this._addCheckInputs(mm.checkInputs.bind(mm))),this.attachedToElement&&mm.attachControl(this.noPreventDefault))}remove(mm){for(const o in this.attached){const u=this.attached[o];if(u===mm)return u.tq(),u.camera=null,delete this.attached[o],void this.rebuildInputCheck()}}removeByType(mm){for(const o in this.attached){const u=this.attached[o];u.getClassName()===mm&&(u.tq(),u.camera=null,delete this.attached[o],this.rebuildInputCheck())}}_addCheckInputs(mm){const o=this.checkInputs;return()=>{o(),mm()}}attachInput(mm){this.attachedToElement&&mm.attachControl(this.noPreventDefault)}attachElement(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){mm=!O.b.ForceAttachControlToAlwaysPreventDefault&&mm,this.attachedToElement=!0,this.noPreventDefault=mm;for(const o in this.attached)this.attached[o].attachControl(mm)}}detachElement(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const o in this.attached)this.attached[o].tq(),mm&&(this.attached[o].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const mm in this.attached){const o=this.attached[mm];o.checkInputs&&(this.checkInputs=this._addCheckInputs(o.checkInputs.bind(o)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(mm){const o={};for(const u in this.attached){const mm=this.attached[u],f=B.c.Serialize(mm);o[mm.getClassName()]=f}mm.inputsmgr=o}parse(mm){const o=mm.inputsmgr;if(o){this.clear();for(const mm in o){const u=r[mm];if(u){const f=o[mm],O=B.c.Parse((()=>new u),f,null);this.add(O)}}}else for(const u in this.attached){const o=r[this.attached[u].getClassName()];if(o){const f=B.c.Parse((()=>new o),mm,null);this.remove(this.attached[u]),this.add(f)}}}}},14174:(mm,o,u)=>{"use strict";u.d(o,{c:()=>N});var f=u(12729),B=u(12732),O=u(12740),r=u(13193),w=u(14180),p=u(13014),K=u(12549);class z{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(mm){mm=K.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Pm(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((o=>{const u=o.event;if(!u.metaKey)if(o.type===p.d.KEYDOWN){if(-1!==this.keysUp.indexOf(u.keyCode)||-1!==this.keysDown.indexOf(u.keyCode)||-1!==this.keysLeft.indexOf(u.keyCode)||-1!==this.keysRight.indexOf(u.keyCode)||-1!==this.keysUpward.indexOf(u.keyCode)||-1!==this.keysDownward.indexOf(u.keyCode)||-1!==this.keysRotateLeft.indexOf(u.keyCode)||-1!==this.keysRotateRight.indexOf(u.keyCode)||-1!==this.keysRotateUp.indexOf(u.keyCode)||-1!==this.keysRotateDown.indexOf(u.keyCode)){-1===this._keys.indexOf(u.keyCode)&&this._keys.push(u.keyCode),mm||u.preventDefault()}}else if(-1!==this.keysUp.indexOf(u.keyCode)||-1!==this.keysDown.indexOf(u.keyCode)||-1!==this.keysLeft.indexOf(u.keyCode)||-1!==this.keysRight.indexOf(u.keyCode)||-1!==this.keysUpward.indexOf(u.keyCode)||-1!==this.keysDownward.indexOf(u.keyCode)||-1!==this.keysRotateLeft.indexOf(u.keyCode)||-1!==this.keysRotateRight.indexOf(u.keyCode)||-1!==this.keysRotateUp.indexOf(u.keyCode)||-1!==this.keysRotateDown.indexOf(u.keyCode)){const o=this._keys.indexOf(u.keyCode);o>=0&&this._keys.splice(o,1),mm||u.preventDefault()}})))}tq(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const mm=this.camera;for(let o=0;o<this._keys.length;o++){const u=this._keys[o],f=mm._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(u)?mm._localDirection.Op(-f,0,0):-1!==this.keysUp.indexOf(u)?mm._localDirection.Op(0,0,f):-1!==this.keysRight.indexOf(u)?mm._localDirection.Op(f,0,0):-1!==this.keysDown.indexOf(u)?mm._localDirection.Op(0,0,-f):-1!==this.keysUpward.indexOf(u)?mm._localDirection.Op(0,f,0):-1!==this.keysDownward.indexOf(u)?mm._localDirection.Op(0,-f,0):-1!==this.keysRotateLeft.indexOf(u)?(mm._localDirection.Op(0,0,0),mm.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(u)?(mm._localDirection.Op(0,0,0),mm.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(u)?(mm._localDirection.Op(0,0,0),mm.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(u)&&(mm._localDirection.Op(0,0,0),mm.cameraRotation.x+=this._getLocalRotation()),mm.Pm().useRightHandedSystem&&(mm._localDirection.z*=-1),mm.getViewMatrix().invertToRef(mm._cameraTransformMatrix),O.lo.TransformNormalToRef(mm._localDirection,mm._cameraTransformMatrix,mm._transformedDirection),mm.cameraDirection.addInPlace(mm._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const mm=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*mm}}(0,f.d)([(0,B.J)()],z.prototype,"keysUp",void 0),(0,f.d)([(0,B.J)()],z.prototype,"keysUpward",void 0),(0,f.d)([(0,B.J)()],z.prototype,"keysDown",void 0),(0,f.d)([(0,B.J)()],z.prototype,"keysDownward",void 0),(0,f.d)([(0,B.J)()],z.prototype,"keysLeft",void 0),(0,f.d)([(0,B.J)()],z.prototype,"keysRight",void 0),(0,f.d)([(0,B.J)()],z.prototype,"rotationSpeed",void 0),(0,f.d)([(0,B.J)()],z.prototype,"keysRotateLeft",void 0),(0,f.d)([(0,B.J)()],z.prototype,"keysRotateRight",void 0),(0,f.d)([(0,B.J)()],z.prototype,"keysRotateUp",void 0),(0,f.d)([(0,B.J)()],z.prototype,"keysRotateDown",void 0),w.c.FreeCameraKeyboardMoveInput=z;var Y=u(12556),q=u(13010);class x{constructor(){let mm=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=mm,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new Y.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(mm){mm=K.Tools.BackCompatCameraNoPreventDefault(arguments);const o=this.camera.getEngine(),u=o.getInputElement();this._pointerInput||(this._pointerInput=f=>{const B=f.event,O="touch"===B.pointerType;if(!this.touchEnabled&&O)return;if(f.type!==q.c.POINTERMOVE&&-1===this.buttons.indexOf(B.button))return;const r=B.target;if(f.type===q.c.POINTERDOWN){if(O&&-1!==this._activePointerId||!O&&-1!==this._currentActiveButton)return;this._activePointerId=B.pointerId;try{null===r||void 0===r||r.setPointerCapture(B.pointerId)}catch(w){}-1===this._currentActiveButton&&(this._currentActiveButton=B.button),this._previousPosition={x:B.clientX,y:B.clientY},mm||(B.preventDefault(),u&&u.focus()),o.isPointerLock&&this._onMouseMove&&this._onMouseMove(f.event)}else if(f.type===q.c.POINTERUP){if(O&&this._activePointerId!==B.pointerId||!O&&this._currentActiveButton!==B.button)return;try{null===r||void 0===r||r.releasePointerCapture(B.pointerId)}catch(w){}this._currentActiveButton=-1,this._previousPosition=null,mm||B.preventDefault(),this._activePointerId=-1}else if(f.type===q.c.POINTERMOVE&&(this._activePointerId===B.pointerId||!O))if(o.isPointerLock&&this._onMouseMove)this._onMouseMove(f.event);else if(this._previousPosition){const o=this.camera._calculateHandednessMultiplier(),u=(B.clientX-this._previousPosition.x)*o,f=B.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=u/this.angularSensibility,this.camera.cameraRotation.x+=f/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:u,offsetY:f}),this._previousPosition={x:B.clientX,y:B.clientY},mm||B.preventDefault()}}),this._onMouseMove=u=>{if(!o.isPointerLock)return;const f=this.camera._calculateHandednessMultiplier(),B=u.movementX*f;this.camera.cameraRotation.y+=B/this.angularSensibility;const O=u.movementY;this.camera.cameraRotation.x+=O/this.angularSensibility,this._previousPosition=null,mm||u.preventDefault()},this._observer=this.camera.Pm()._inputManager._addCameraPointerObserver(this._pointerInput,q.c.POINTERDOWN|q.c.POINTERUP|q.c.POINTERMOVE),u&&(this._contextMenuBind=mm=>this.onContextMenu(mm),u.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(mm){mm.preventDefault()}tq(){if(this._observer){if(this.camera.Pm()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const mm=this.camera.getEngine().getInputElement();mm&&mm.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,f.d)([(0,B.J)()],x.prototype,"buttons",void 0),(0,f.d)([(0,B.J)()],x.prototype,"angularSensibility",void 0),w.c.FreeCameraMouseInput=x;var H,E=u(13016);class M{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new Y.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(mm){mm=K.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=o=>{if(o.type!==q.c.POINTERWHEEL)return;const u=o.event,f=u.deltaMode===E.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*f*u.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*f*u.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*f*u.deltaZ/this._normalize,u.preventDefault&&(mm||u.preventDefault())},this._observer=this.camera.Pm()._inputManager._addCameraPointerObserver(this._wheel,q.c.POINTERWHEEL)}tq(){this._observer&&(this.camera.Pm()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,f.d)([(0,B.J)()],M.prototype,"wheelPrecisionX",void 0),(0,f.d)([(0,B.J)()],M.prototype,"wheelPrecisionY",void 0),(0,f.d)([(0,B.J)()],M.prototype,"wheelPrecisionZ",void 0),function(mm){mm[mm.MoveRelative=0]="MoveRelative",mm[mm.RotateRelative=1]="RotateRelative",mm[mm.MoveScene=2]="MoveScene"}(H||(H={}));class l extends M{constructor(){super(...arguments),this._moveRelative=O.lo.Zero(),this._rotateRelative=O.lo.Zero(),this._moveScene=O.lo.Zero(),this._wheelXAction=H.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=H.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(mm){null===mm&&this._wheelXAction!==H.MoveRelative||(this._wheelXAction=H.MoveRelative,this._wheelXActionCoordinate=mm)}get wheelXMoveRelative(){return this._wheelXAction!==H.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(mm){null===mm&&this._wheelYAction!==H.MoveRelative||(this._wheelYAction=H.MoveRelative,this._wheelYActionCoordinate=mm)}get wheelYMoveRelative(){return this._wheelYAction!==H.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(mm){null===mm&&this._wheelZAction!==H.MoveRelative||(this._wheelZAction=H.MoveRelative,this._wheelZActionCoordinate=mm)}get wheelZMoveRelative(){return this._wheelZAction!==H.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(mm){null===mm&&this._wheelXAction!==H.RotateRelative||(this._wheelXAction=H.RotateRelative,this._wheelXActionCoordinate=mm)}get wheelXRotateRelative(){return this._wheelXAction!==H.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(mm){null===mm&&this._wheelYAction!==H.RotateRelative||(this._wheelYAction=H.RotateRelative,this._wheelYActionCoordinate=mm)}get wheelYRotateRelative(){return this._wheelYAction!==H.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(mm){null===mm&&this._wheelZAction!==H.RotateRelative||(this._wheelZAction=H.RotateRelative,this._wheelZActionCoordinate=mm)}get wheelZRotateRelative(){return this._wheelZAction!==H.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(mm){null===mm&&this._wheelXAction!==H.MoveScene||(this._wheelXAction=H.MoveScene,this._wheelXActionCoordinate=mm)}get wheelXMoveScene(){return this._wheelXAction!==H.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(mm){null===mm&&this._wheelYAction!==H.MoveScene||(this._wheelYAction=H.MoveScene,this._wheelYActionCoordinate=mm)}get wheelYMoveScene(){return this._wheelYAction!==H.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(mm){null===mm&&this._wheelZAction!==H.MoveScene||(this._wheelZAction=H.MoveScene,this._wheelZActionCoordinate=mm)}get wheelZMoveScene(){return this._wheelZAction!==H.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.wp(0),this._rotateRelative.wp(0),this._moveScene.wp(0),this._updateCamera(),this.camera.Pm().useRightHandedSystem&&(this._moveRelative.z*=-1);const mm=O.Matrix.Zero();this.camera.getViewMatrix().invertToRef(mm);const o=O.lo.Zero();O.lo.TransformNormalToRef(this._moveRelative,mm,o),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(o),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(mm,o,u){if(0===mm)return;if(null===o||null===u)return;let f=null;switch(o){case H.MoveRelative:f=this._moveRelative;break;case H.RotateRelative:f=this._rotateRelative;break;case H.MoveScene:f=this._moveScene}switch(u){case 0:f.set(mm,0,0);break;case 1:f.set(0,mm,0);break;case 2:f.set(0,0,mm)}}}(0,f.d)([(0,B.J)()],l.prototype,"wheelXMoveRelative",null),(0,f.d)([(0,B.J)()],l.prototype,"wheelYMoveRelative",null),(0,f.d)([(0,B.J)()],l.prototype,"wheelZMoveRelative",null),(0,f.d)([(0,B.J)()],l.prototype,"wheelXRotateRelative",null),(0,f.d)([(0,B.J)()],l.prototype,"wheelYRotateRelative",null),(0,f.d)([(0,B.J)()],l.prototype,"wheelZRotateRelative",null),(0,f.d)([(0,B.J)()],l.prototype,"wheelXMoveScene",null),(0,f.d)([(0,B.J)()],l.prototype,"wheelYMoveScene",null),(0,f.d)([(0,B.J)()],l.prototype,"wheelZMoveScene",null),w.c.FreeCameraMouseWheelInput=l;class t{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=mm,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=K.Tools.IsSafari()}attachControl(mm){mm=K.Tools.BackCompatCameraNoPreventDefault(arguments);let o=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=u=>{const f=u.event,B="mouse"===f.pointerType||this._isSafari&&"undefined"===typeof f.pointerType;if(this.allowMouse||!B)if(u.type===q.c.POINTERDOWN){if(mm||f.preventDefault(),this._pointerPressed.push(f.pointerId),1!==this._pointerPressed.length)return;o={x:f.clientX,y:f.clientY}}else if(u.type===q.c.POINTERUP){mm||f.preventDefault();const u=this._pointerPressed.indexOf(f.pointerId);if(-1===u)return;if(this._pointerPressed.splice(u,1),0!=u)return;o=null,this._offsetX=null,this._offsetY=null}else if(u.type===q.c.POINTERMOVE){if(mm||f.preventDefault(),!o)return;if(0!=this._pointerPressed.indexOf(f.pointerId))return;this._offsetX=f.clientX-o.x,this._offsetY=-(f.clientY-o.y)}}),this._observer=this.camera.Pm()._inputManager._addCameraPointerObserver(this._pointerInput,q.c.POINTERDOWN|q.c.POINTERUP|q.c.POINTERMOVE),this._onLostFocus){const mm=this.camera.getEngine().getInputElement();mm&&mm.addEventListener("blur",this._onLostFocus)}}tq(){if(this._pointerInput){if(this._observer&&(this.camera.Pm()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const mm=this.camera.getEngine().getInputElement();mm&&mm.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const mm=this.camera,o=mm._calculateHandednessMultiplier();mm.cameraRotation.y=o*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)mm.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const o=mm._computeLocalCameraSpeed(),u=new O.lo(0,0,0!==this.touchMoveSensibility?o*this._offsetY/this.touchMoveSensibility:0);O.Matrix.RotationYawPitchRollToRef(mm.rotation.y,mm.rotation.x,0,mm._cameraRotationMatrix),mm.cameraDirection.addInPlace(O.lo.TransformCoordinates(u,mm._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,f.d)([(0,B.J)()],t.prototype,"touchAngularSensibility",void 0),(0,f.d)([(0,B.J)()],t.prototype,"touchMoveSensibility",void 0),w.c.FreeCameraTouchInput=t;class Q extends w.f{constructor(mm){super(mm),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new z),this}addMouse(){let mm=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new x(mm),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new l,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new t),this}clear(){super.clear(),this._mouseInput=null}}var b=u(12702),J=u(12638);class N extends r.b{get angularSensibility(){const mm=this.inputs.attached.mouse;return mm?mm.angularSensibility:0}set angularSensibility(mm){const o=this.inputs.attached.mouse;o&&(o.angularSensibility=mm)}get keysUp(){const mm=this.inputs.attached.keyboard;return mm?mm.keysUp:[]}set keysUp(mm){const o=this.inputs.attached.keyboard;o&&(o.keysUp=mm)}get keysUpward(){const mm=this.inputs.attached.keyboard;return mm?mm.keysUpward:[]}set keysUpward(mm){const o=this.inputs.attached.keyboard;o&&(o.keysUpward=mm)}get keysDown(){const mm=this.inputs.attached.keyboard;return mm?mm.keysDown:[]}set keysDown(mm){const o=this.inputs.attached.keyboard;o&&(o.keysDown=mm)}get keysDownward(){const mm=this.inputs.attached.keyboard;return mm?mm.keysDownward:[]}set keysDownward(mm){const o=this.inputs.attached.keyboard;o&&(o.keysDownward=mm)}get keysLeft(){const mm=this.inputs.attached.keyboard;return mm?mm.keysLeft:[]}set keysLeft(mm){const o=this.inputs.attached.keyboard;o&&(o.keysLeft=mm)}get keysRight(){const mm=this.inputs.attached.keyboard;return mm?mm.keysRight:[]}set keysRight(mm){const o=this.inputs.attached.keyboard;o&&(o.keysRight=mm)}get keysRotateLeft(){const mm=this.inputs.attached.keyboard;return mm?mm.keysRotateLeft:[]}set keysRotateLeft(mm){const o=this.inputs.attached.keyboard;o&&(o.keysRotateLeft=mm)}get keysRotateRight(){const mm=this.inputs.attached.keyboard;return mm?mm.keysRotateRight:[]}set keysRotateRight(mm){const o=this.inputs.attached.keyboard;o&&(o.keysRotateRight=mm)}get keysRotateUp(){const mm=this.inputs.attached.keyboard;return mm?mm.keysRotateUp:[]}set keysRotateUp(mm){const o=this.inputs.attached.keyboard;o&&(o.keysRotateUp=mm)}get keysRotateDown(){const mm=this.inputs.attached.keyboard;return mm?mm.keysRotateDown:[]}set keysRotateDown(mm){const o=this.inputs.attached.keyboard;o&&(o.keysRotateDown=mm)}constructor(mm,o,u){var f;super(mm,o,u,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),f=this,this.ellipsoid=new O.lo(.5,1,.5),this.ellipsoidOffset=new O.lo(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=O.lo.Zero(),this._diffPosition=O.lo.Zero(),this._newPosition=O.lo.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;f._newPosition.p(o),f._newPosition.subtractToRef(f._oldPosition,f._diffPosition),f._diffPosition.length()>J.c.CollisionsEpsilon&&(f.position.addToRef(f._diffPosition,f._deferredPositionUpdate),f._deferOnly?f._deferredUpdated=!0:f.position.p(f._deferredPositionUpdate),f.pH&&u&&f.pH(u))},this.inputs=new Q(this),this.inputs.addKeyboard().addMouse()}attachControl(mm,o){o=K.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(o)}tq(){this.inputs.detachElement(),this.cameraDirection=new O.lo(0,0,0),this.cameraRotation=new O.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(mm){this._collisionMask=isNaN(mm)?-1:mm}_collideWithWorld(mm){let o;o=this.parent?O.lo.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,o.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const u=this.Pm().collisionCoordinator;this._collider||(this._collider=u.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let f=mm;this.applyGravity&&(f=mm.add(this.Pm().gravity)),u.getNewPosition(this._oldPosition,f,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=O.lo.Zero(),this._transformedDirection=O.lo.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(mm){this._needMoveForGravity=mm}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Pm().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"dY"}}(0,f.d)([(0,B.F)()],N.prototype,"ellipsoid",void 0),(0,f.d)([(0,B.F)()],N.prototype,"ellipsoidOffset",void 0),(0,f.d)([(0,B.J)()],N.prototype,"checkCollisions",void 0),(0,f.d)([(0,B.J)()],N.prototype,"applyGravity",void 0),(0,b.c)("BABYLON.FreeCamera",N)},14849:(mm,o,u)=>{"use strict";u.d(o,{e:()=>O});var f=u(12832),B=u(14852);class O{constructor(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=u,this.XY=[],this._maxBlockCapacity=o||64,this._selectionContent=new f.d(1024),this._creationFunc=mm}update(mm,o,u){B.c._CreateBlocks(mm,o,u,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}vz(mm){for(let o=0;o<this.mq.length;o++){this.mq[o].addEntry(mm)}}Cz(mm){for(let o=0;o<this.mq.length;o++){this.mq[o].removeEntry(mm)}}select(mm,o){this._selectionContent.reset();for(let u=0;u<this.mq.length;u++){this.mq[u].select(mm,this._selectionContent,o)}return o?this._selectionContent.concat(this.XY):this._selectionContent.concatWithNoDuplicate(this.XY),this._selectionContent}intersects(mm,o,u){this._selectionContent.reset();for(let f=0;f<this.mq.length;f++){this.mq[f].intersects(mm,o,this._selectionContent,u)}return u?this._selectionContent.concat(this.XY):this._selectionContent.concatWithNoDuplicate(this.XY),this._selectionContent}intersectsRay(mm){this._selectionContent.reset();for(let o=0;o<this.mq.length;o++){this.mq[o].intersectsRay(mm,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.XY),this._selectionContent}}O.CreationFuncForMeshes=(mm,o)=>{const u=mm.getBoundingInfo();!mm.isBlocked&&u.boundingBox.intersectsMinMax(o.CY,o.vY)&&o.entries.push(mm)},O.CreationFuncForSubMeshes=(mm,o)=>{mm.getBoundingInfo().boundingBox.intersectsMinMax(o.CY,o.vY)&&o.entries.push(mm)}},14852:(mm,o,u)=>{"use strict";u.d(o,{c:()=>O});var f=u(12740),B=u(13072);class O{constructor(mm,o,u,f,B,O){this.entries=[],this.VY=new Array,this._capacity=u,this._depth=f,this._maxDepth=B,this._creationFunc=O,this._minPoint=mm,this._maxPoint=o,this.VY.push(mm.clone()),this.VY.push(o.clone()),this.VY.push(mm.clone()),this.VY[2].x=o.x,this.VY.push(mm.clone()),this.VY[3].y=o.y,this.VY.push(mm.clone()),this.VY[4].z=o.z,this.VY.push(o.clone()),this.VY[5].z=mm.z,this.VY.push(o.clone()),this.VY[6].x=mm.x,this.VY.push(o.clone()),this.VY[7].y=mm.y}get Mp(){return this._capacity}get CY(){return this._minPoint}get vY(){return this._maxPoint}addEntry(mm){if(this.mq)for(let o=0;o<this.mq.length;o++){this.mq[o].addEntry(mm)}else this._creationFunc(mm,this),this.entries.length>this.Mp&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(mm){if(this.mq){for(let o=0;o<this.mq.length;o++){this.mq[o].removeEntry(mm)}return}const o=this.entries.indexOf(mm);o>-1&&this.entries.splice(o,1)}addEntries(mm){for(let o=0;o<mm.length;o++){const u=mm[o];this.addEntry(u)}}select(mm,o,u){if(B.b.IsInFrustum(this.VY,mm)){if(this.mq){for(let f=0;f<this.mq.length;f++){this.mq[f].select(mm,o,u)}return}u?o.concat(this.entries):o.concatWithNoDuplicate(this.entries)}}intersects(mm,o,u,f){if(B.b.IntersectsSphere(this._minPoint,this._maxPoint,mm,o)){if(this.mq){for(let B=0;B<this.mq.length;B++){this.mq[B].intersects(mm,o,u,f)}return}f?u.concat(this.entries):u.concatWithNoDuplicate(this.entries)}}intersectsRay(mm,o){if(mm.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.mq){for(let u=0;u<this.mq.length;u++){this.mq[u].intersectsRay(mm,o)}return}o.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){O._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(mm,o,u,B,r,w,p,K){p.mq=new Array;const z=new f.lo((o.x-mm.x)/2,(o.y-mm.y)/2,(o.z-mm.z)/2);for(let f=0;f<2;f++)for(let o=0;o<2;o++)for(let Y=0;Y<2;Y++){const q=mm.add(z.multiplyByFloats(f,o,Y)),x=mm.add(z.multiplyByFloats(f+1,o+1,Y+1)),H=new O(q,x,B,r+1,w,K);H.addEntries(u),p.mq.push(H)}}}},14858:(mm,o,u)=>{"use strict";u.d(o,{b:()=>z});var f=u(12965),B=u(12740),O=u(13147),r=u(13944),w=u(13002),p=u(14849),K=u(12596);f.d.prototype.createOrUpdateSelectionOctree=function(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,u=this._getComponent(w.e.NAME_OCTREE);u||(u=new z(this),this.o(u)),this.jY||(this.jY=new p.e(p.e.CreationFuncForMeshes,mm,o));const f=this.getWorldExtends();return this.jY.update(f.min,f.max,this.meshes),this.jY},Object.defineProperty(f.d.prototype,"selectionOctree",{get:function(){return this.jY},enumerable:!0,configurable:!0}),O.b.prototype.createOrUpdateSubmeshesOctree=function(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const u=this.Pm();let f=u._getComponent(w.e.NAME_OCTREE);f||(f=new z(u),u.o(f)),this._submeshesOctree||(this._submeshesOctree=new p.e(p.e.CreationFuncForSubMeshes,mm,o)),this.Df(!0);const B=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(B.minimumWorld,B.maximumWorld,this.kf),this._submeshesOctree};class z{constructor(mm){this.name=w.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new r.b(B.lo.Zero(),new B.lo(1,1,1)),(mm=mm||K.d.LastCreatedScene)&&(this.bo=mm,this.bo.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.bo.getActiveSubMeshCandidates=mm=>this.getActiveSubMeshCandidates(mm),this.bo.getCollidingSubMeshCandidates=(mm,o)=>this.getCollidingSubMeshCandidates(mm,o),this.bo.getIntersectingSubMeshCandidates=(mm,o)=>this.getIntersectingSubMeshCandidates(mm,o))}register(){this.bo.onMeshRemovedObservable.add((mm=>{const o=this.bo.selectionOctree;if(void 0!==o&&null!==o){const u=o.XY.indexOf(mm);-1!==u&&o.XY.splice(u,1)}})),this.bo.onMeshImportedObservable.add((mm=>{const o=this.bo.selectionOctree;void 0!==o&&null!==o&&o.vz(mm)}))}getActiveMeshCandidates(){var mm;return(null===(mm=this.bo.jY)||void 0===mm?void 0:mm.select(this.bo.frustumPlanes))||this.bo._getDefaultMeshCandidates()}getActiveSubMeshCandidates(mm){if(mm._submeshesOctree&&mm.useOctreeForRenderingSelection){return mm._submeshesOctree.select(this.bo.frustumPlanes)}return this.bo._getDefaultSubMeshCandidates(mm)}getIntersectingSubMeshCandidates(mm,o){if(mm._submeshesOctree&&mm.useOctreeForPicking){r.b.TransformToRef(o,mm.getWorldMatrix(),this._tempRay);return mm._submeshesOctree.intersectsRay(this._tempRay)}return this.bo._getDefaultSubMeshCandidates(mm)}getCollidingSubMeshCandidates(mm,o){if(mm._submeshesOctree&&mm.useOctreeForCollisions){const u=o._velocityWorldLength+Math.max(o._radius.x,o._radius.y,o._radius.z);return mm._submeshesOctree.intersects(o._basePointWorld,u)}return this.bo._getDefaultSubMeshCandidates(mm)}rebuild(){}dispose(){}}},13944:(mm,o,u)=>{"use strict";u.d(o,{b:()=>x});var f=u(12965),B=u(13170),O=u(12746),r=u(12740),w=u(12748),p=u(13062),K=u(12993),z=u(12596),Y=u(13021);const q={internalPickerForMesh:void 0};class x{constructor(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O.e;this.origin=mm,this.direction=o,this.length=u,this.epsilon=f}clone(){return new x(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const f=x._TmpVector3[0].Op(mm.x-u,mm.y-u,mm.z-u),B=x._TmpVector3[1].Op(o.x+u,o.y+u,o.z+u);let O,r,w,p,K=0,z=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<f.x||this.origin.x>B.x)return!1}else if(O=1/this.direction.x,r=(f.x-this.origin.x)*O,w=(B.x-this.origin.x)*O,w===-1/0&&(w=1/0),r>w&&(p=r,r=w,w=p),K=Math.max(r,K),z=Math.min(w,z),K>z)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<f.y||this.origin.y>B.y)return!1}else if(O=1/this.direction.y,r=(f.y-this.origin.y)*O,w=(B.y-this.origin.y)*O,w===-1/0&&(w=1/0),r>w&&(p=r,r=w,w=p),K=Math.max(r,K),z=Math.min(w,z),K>z)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<f.z||this.origin.z>B.z)return!1}else if(O=1/this.direction.z,r=(f.z-this.origin.z)*O,w=(B.z-this.origin.z)*O,w===-1/0&&(w=1/0),r>w&&(p=r,r=w,w=p),K=Math.max(r,K),z=Math.min(w,z),K>z)return!1;return!0}intersectsBox(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(mm.minimum,mm.maximum,o)}intersectsSphere(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const u=mm.center.x-this.origin.x,f=mm.center.y-this.origin.y,B=mm.center.z-this.origin.z,O=u*u+f*f+B*B,r=mm.radius+o,w=r*r;if(O<=w)return!0;const p=u*this.direction.x+f*this.direction.y+B*this.direction.z;if(p<0)return!1;return O-p*p<=w}intersectsTriangle(mm,o,u){const f=x._TmpVector3[0],B=x._TmpVector3[1],O=x._TmpVector3[2],w=x._TmpVector3[3],K=x._TmpVector3[4];o.subtractToRef(mm,f),u.subtractToRef(mm,B),r.lo.CrossToRef(this.direction,B,O);const z=r.lo.Dot(f,O);if(0===z)return null;const Y=1/z;this.origin.subtractToRef(mm,w);const q=r.lo.Dot(w,O)*Y;if(q<-this.epsilon||q>1+this.epsilon)return null;r.lo.CrossToRef(w,f,K);const H=r.lo.Dot(this.direction,K)*Y;if(H<-this.epsilon||q+H>1+this.epsilon)return null;const E=r.lo.Dot(B,K)*Y;return E>this.length?null:new p.c(1-q-H,q,E)}intersectsPlane(mm){let o;const u=r.lo.Dot(mm.normal,this.direction);if(Math.abs(u)<9.99999997475243e-7)return null;{const f=r.lo.Dot(mm.normal,this.origin);return o=(-mm.d-f)/u,o<0?o<-9.99999997475243e-7?null:0:o}}intersectsAxis(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(mm){case"y":{const mm=(this.origin.y-o)/this.direction.y;return mm>0?null:new r.lo(this.origin.x+this.direction.x*-mm,o,this.origin.z+this.direction.z*-mm)}case"x":{const mm=(this.origin.x-o)/this.direction.x;return mm>0?null:new r.lo(o,this.origin.y+this.direction.y*-mm,this.origin.z+this.direction.z*-mm)}case"z":{const mm=(this.origin.z-o)/this.direction.z;return mm>0?null:new r.lo(this.origin.x+this.direction.x*-mm,this.origin.y+this.direction.y*-mm,o)}default:return null}}intersectsMesh(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const w=r.TmpVectors.Matrix[0];return mm.getWorldMatrix().invertToRef(w),this._tmpRay?x.TransformToRef(this,w,this._tmpRay):this._tmpRay=x.Transform(this,w),mm.intersects(this._tmpRay,o,u,f,B,O)}intersectsMeshes(mm,o,u){u?u.length=0:u=[];for(let f=0;f<mm.length;f++){const B=this.intersectsMesh(mm[f],o);B.hit&&u.push(B)}return u.sort(this._comparePickingInfo),u}_comparePickingInfo(mm,o){return mm.distance<o.distance?-1:mm.distance>o.distance?1:0}intersectionSegment(mm,o,u){const f=this.origin,B=r.TmpVectors.lo[0],O=r.TmpVectors.lo[1],w=r.TmpVectors.lo[2],p=r.TmpVectors.lo[3];o.subtractToRef(mm,B),this.direction.scaleToRef(x._Rayl,w),f.addToRef(w,O),mm.subtractToRef(f,p);const K=r.lo.Dot(B,B),z=r.lo.Dot(B,w),Y=r.lo.Dot(w,w),q=r.lo.Dot(B,p),H=r.lo.Dot(w,p),E=K*Y-z*z;let M,l,t=E,Q=E;E<x._Smallnum?(M=0,t=1,l=H,Q=Y):(M=z*H-Y*q,l=K*H-z*q,M<0?(M=0,l=H,Q=Y):M>t&&(M=t,l=H+z,Q=Y)),l<0?(l=0,-q<0?M=0:-q>K?M=t:(M=-q,t=K)):l>Q&&(l=Q,-q+z<0?M=0:-q+z>K?M=t:(M=-q+z,t=K));const b=Math.abs(M)<x._Smallnum?0:M/t,J=Math.abs(l)<x._Smallnum?0:l/Q,N=r.TmpVectors.lo[4];w.scaleToRef(J,N);const S=r.TmpVectors.lo[5];B.scaleToRef(b,S),S.addInPlace(p);const P=r.TmpVectors.lo[6];S.subtractToRef(N,P);return J>0&&J<=this.length&&P.lengthSquared()<u*u?S.length():-1}update(mm,o,u,f,B,O,w){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){x._RayDistant||(x._RayDistant=x.Zero()),x._RayDistant.unprojectRayToRef(mm,o,u,f,r.Matrix.IdentityReadOnly,O,w);const p=r.TmpVectors.Matrix[0];B.invertToRef(p),x.TransformToRef(x._RayDistant,p,this)}else this.unprojectRayToRef(mm,o,u,f,B,O,w);return this}static Zero(){return new x(r.lo.Zero(),r.lo.Zero())}static CreateNew(mm,o,u,f,B,O,r){return x.Zero().update(mm,o,u,f,B,O,r)}static CreateNewFromTo(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.Matrix.IdentityReadOnly;const f=new x(new r.lo(0,0,0),new r.lo(0,0,0));return x.CreateFromToToRef(mm,o,f,u)}static CreateFromToToRef(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.Matrix.IdentityReadOnly;u.origin.p(mm);const B=o.subtractToRef(mm,u.direction),O=Math.sqrt(B.x*B.x+B.y*B.y+B.z*B.z);return u.length=O,u.direction.normalize(),x.TransformToRef(u,f,u)}static Transform(mm,o){const u=new x(new r.lo(0,0,0),new r.lo(0,0,0));return x.TransformToRef(mm,o,u),u}static TransformToRef(mm,o,u){r.lo.TransformCoordinatesToRef(mm.origin,o,u.origin),r.lo.TransformNormalToRef(mm.direction,o,u.direction),u.length=mm.length,u.epsilon=mm.epsilon;const f=u.direction,B=f.length();if(0!==B&&1!==B){const mm=1/B;f.x*=mm,f.y*=mm,f.z*=mm,u.length*=B}return u}unprojectRayToRef(mm,o,u,f,B,O,w){const p=r.TmpVectors.Matrix[0];B.multiplyToRef(O,p),p.multiplyToRef(w,p),p.invert();const K=z.d.LastCreatedEngine,Y=r.TmpVectors.lo[0];Y.x=mm/u*2-1,Y.y=-(o/f*2-1),Y.z=null!==K&&void 0!==K&&K.tf?1:null!==K&&void 0!==K&&K.isNDCHalfZRange?0:-1;const q=r.TmpVectors.lo[1].Op(Y.x,Y.y,1-1e-8),x=r.TmpVectors.lo[2],H=r.TmpVectors.lo[3];r.lo._UnprojectFromInvertedMatrixToRef(Y,p,x),r.lo._UnprojectFromInvertedMatrixToRef(q,p,H),this.origin.p(x),H.subtractToRef(x,this.direction),this.direction.normalize()}}function H(mm,o,u,f,B){let O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const r=x.Zero();return E(mm,o,u,f,r,B,O),r}function E(mm,o,u,f,B,O){let w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const K=mm.getEngine();if(!O&&!(O=mm.activeCamera))return mm;const z=O.viewport,Y=K.getRenderHeight(),{x:q,y:x,width:H,height:E}=z.toGlobal(K.getRenderWidth(),Y),M=1/K.getHardwareScalingLevel();return o=o*M-q,u=u*M-(Y-x-E),B.update(o,u,H,E,f||r.Matrix.IdentityReadOnly,w?r.Matrix.IdentityReadOnly:O.getViewMatrix(),O.getProjectionMatrix(),p),mm}function M(mm,o,u,f,B){if(!K.d)return mm;const O=mm.getEngine();if(!B&&!(B=mm.activeCamera))throw new Error("Active camera not set");const w=B.viewport,p=O.getRenderHeight(),{x:z,y:Y,width:q,height:x}=w.toGlobal(O.getRenderWidth(),p),H=r.Matrix.Identity(),E=1/O.getHardwareScalingLevel();return o=o*E-z,u=u*E-(p-Y-x),f.update(o,u,q,x,H,H,B.getProjectionMatrix()),mm}function l(mm,o,u,f,B,O,r,w){const p=o(f,u.enableDistantPicking),K=u.intersects(p,B,r,O,f,w);return K&&K.hit?!B&&null!=mm&&K.distance>=mm.distance?null:K:null}function t(mm,o,u,f,B,O){let w=null;const p=!!(mm.activeCameras&&mm.activeCameras.length>1&&mm.cameraToUseForPointers!==mm.activeCamera),z=mm.cameraToUseForPointers||mm.activeCamera,Y=q.internalPickerForMesh||l;for(let K=0;K<mm.meshes.length;K++){const q=mm.meshes[K];if(u){if(!u(q,-1))continue}else if(!q.isEnabled()||!q.isVisible||!q.PK)continue;const x=p&&q.isWorldMatrixCameraDependent(),H=q.Df(x,z);if(q.hasThinInstances&&q.Oz){const mm=Y(w,o,q,H,!0,!0,O);if(mm){if(B)return mm;const p=r.TmpVectors.Matrix[1],K=q.thinInstanceGetWorldMatrices();for(let mm=0;mm<K.length;mm++){if(u&&!u(q,mm))continue;K[mm].multiplyToRef(H,p);const r=Y(w,o,q,p,f,B,O,!0);if(r&&(w=r,w.thinInstanceIndex=mm,f))return w}}}else{const mm=Y(w,o,q,H,f,B,O);if(mm&&(w=mm,f))return w}}return w||new K.d}function Q(mm,o,u,f){if(!K.d)return null;const B=[],O=!!(mm.activeCameras&&mm.activeCameras.length>1&&mm.cameraToUseForPointers!==mm.activeCamera),w=mm.cameraToUseForPointers||mm.activeCamera,p=q.internalPickerForMesh||l;for(let K=0;K<mm.meshes.length;K++){const z=mm.meshes[K];if(u){if(!u(z,-1))continue}else if(!z.isEnabled()||!z.isVisible||!z.PK)continue;const Y=O&&z.isWorldMatrixCameraDependent(),q=z.Df(Y,w);if(z.hasThinInstances&&z.Oz){if(p(null,o,z,q,!0,!0,f)){const mm=r.TmpVectors.Matrix[1],O=z.thinInstanceGetWorldMatrices();for(let r=0;r<O.length;r++){if(u&&!u(z,r))continue;O[r].multiplyToRef(q,mm);const w=p(null,o,z,mm,!1,!1,f,!0);w&&(w.thinInstanceIndex=r,B.push(w))}}}else{const mm=p(null,o,z,q,!1,!1,f);mm&&B.push(mm)}}return B}function b(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,f=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0;f||(f=mm.getWorldMatrix()),o.length=u,B?o.origin.p(B):o.origin.p(mm.position);const O=r.TmpVectors.lo[2];O.set(0,0,mm._scene.useRightHandedSystem?-1:1);const w=r.TmpVectors.lo[3];return r.lo.TransformNormalToRef(O,f,w),r.lo.NormalizeToRef(w,o.direction),o}var J,N;x._TmpVector3=(0,w.b)(6,r.lo.Zero),x._RayDistant=x.Zero(),x._Smallnum=1e-8,x._Rayl=1e9,J=f.d,(N=B.b)&&(N.prototype.getForwardRay=function(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,o=arguments.length>1?arguments[1]:void 0,u=arguments.length>2?arguments[2]:void 0;return b(this,new x(r.lo.Zero(),r.lo.Zero(),mm),mm,o,u)},N.prototype.getForwardRayToRef=function(mm){return b(this,mm,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),J&&(Y.e._IsPickingAvailable=!0,J.prototype.createPickingRay=function(mm,o,u,f){return H(this,mm,o,u,f,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),f.d.prototype.createPickingRayToRef=function(mm,o,u,f,B){return E(this,mm,o,u,f,B,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},f.d.prototype.createPickingRayInCameraSpace=function(mm,o,u){return function(mm,o,u,f){const B=x.Zero();return M(mm,o,u,B,f),B}(this,mm,o,u)},f.d.prototype.createPickingRayInCameraSpaceToRef=function(mm,o,u,f){return M(this,mm,o,u,f)},f.d.prototype.pickWithBoundingInfo=function(mm,o,u,f,B){return function(mm,o,u,f,B,O){if(!K.d)return null;const w=t(mm,(f=>(mm._tempPickingRay||(mm._tempPickingRay=x.Zero()),E(mm,o,u,f,mm._tempPickingRay,O||null),mm._tempPickingRay)),f,B,!0);return w&&(w.ray=H(mm,o,u,r.Matrix.Identity(),O||null)),w}(this,mm,o,u,f,B)},f.d.prototype.Qu=function(mm,o,u,f,B,O){return function(mm,o,u,f,B,O,w){const p=t(mm,((f,B)=>(mm._tempPickingRay||(mm._tempPickingRay=x.Zero()),E(mm,o,u,f,mm._tempPickingRay,O||null,!1,B),mm._tempPickingRay)),f,B,!1,w);return p&&(p.ray=H(mm,o,u,r.Matrix.Identity(),O||null)),p}(this,mm,o,u,f,B,O)},f.d.prototype.pickWithRay=function(mm,o,u,f){return function(mm,o,u,f,B){const O=t(mm,(u=>(mm._pickWithRayInverseMatrix||(mm._pickWithRayInverseMatrix=r.Matrix.Identity()),u.invertToRef(mm._pickWithRayInverseMatrix),mm._cachedRayForTransform||(mm._cachedRayForTransform=x.Zero()),x.TransformToRef(o,mm._pickWithRayInverseMatrix,mm._cachedRayForTransform),mm._cachedRayForTransform)),u,f,!1,B);return O&&(O.ray=o),O}(this,mm,o,u,f)},f.d.prototype.multiPick=function(mm,o,u,f,B){return function(mm,o,u,f,B,O){return Q(mm,(f=>H(mm,o,u,f,B||null)),f,O)}(this,mm,o,u,f,B)},f.d.prototype.multiPickWithRay=function(mm,o,u){return function(mm,o,u,f){return Q(mm,(u=>(mm._pickWithRayInverseMatrix||(mm._pickWithRayInverseMatrix=r.Matrix.Identity()),u.invertToRef(mm._pickWithRayInverseMatrix),mm._cachedRayForTransform||(mm._cachedRayForTransform=x.Zero()),x.TransformToRef(o,mm._pickWithRayInverseMatrix,mm._cachedRayForTransform),mm._cachedRayForTransform)),u,f)}(this,mm,o,u)}},14234:(mm,o,u)=>{"use strict";var f=u(12675),B=u(12565),O=u(12605),r=u(12711),w=u(12638),p=u(12687);w.c.prototype._partialLoadFile=function(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(mm,(mm=>{u[o]=mm,u._internalCount++,6===u._internalCount&&f(u)}),void 0,void 0,!0,((mm,o)=>{B&&mm&&B(mm.status+" "+mm.statusText,o)}))},w.c.prototype._cascadeLoadFiles=function(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const B=[];B._internalCount=0;for(let O=0;O<6;O++)this._partialLoadFile(u[O],O,B,o,f)},w.c.prototype._cascadeLoadImgs=function(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5?arguments[5]:void 0;const r=[];r._internalCount=0;for(let w=0;w<6;w++)this._partialLoadImg(f[w],w,r,mm,o,u,B,O)},w.c.prototype._partialLoadImg=function(mm,o,u,f,B,w){let p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7?arguments[7]:void 0;const z=(0,r.d)();(0,O.q)(mm,(mm=>{u[o]=mm,u._internalCount++,f&&f.removePendingData(z),6===u._internalCount&&w&&w(B,u)}),((mm,o)=>{f&&f.removePendingData(z),p&&p(mm,o)}),f?f.offlineProvider:null,K),f&&f.addPendingData(z)},w.c.prototype.createCubeTextureBase=function(mm,o,u,O){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6?arguments[6]:void 0,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,H=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,M=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,l=arguments.length>14&&void 0!==arguments[14]&&arguments[14],t=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const Q=H||new f.e(this,7);Q.isCube=!0,Q.url=mm,Q.generateMipMaps=!O,Q._lodGenerationScale=q,Q._lodGenerationOffset=x,Q._useSRGBBuffer=!!l&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!O),Q!==H&&(Q.label=mm.substring(0,60)),this._doNotHandleContextLost||(Q._extension=z,Q._files=u,Q._buffer=t);const b=mm;this._transformTextureUrl&&!H&&(mm=this._transformTextureUrl(mm));const J=z??function(mm){const o=mm.split("?")[0],u=o.lastIndexOf(".");return u>-1?o.substring(u).toLowerCase():""}(mm),N=(0,p.e)(J),S=(mm,o)=>{Q.dispose(),w?w(mm,o):mm&&B.e.Warn(mm)},P=(f,w)=>{mm===b?f&&S(f.status+" "+f.statusText,w):(B.e.Warn(`Failed to load ${mm}, falling back to the ${b}`),this.createCubeTextureBase(b,o,u,!!O,r,S,K,z,Y,q,x,Q,E,M,l,t))};if(N)N.then((f=>{const B=mm=>{E&&E(Q,mm),f.loadCubeData(mm,Q,Y,r,((mm,o)=>{S(mm,o)}))};t?B(t):u&&6===u.length?f.supportCascades?this._cascadeLoadFiles(o,(mm=>B(mm.map((mm=>new Uint8Array(mm))))),u,S):S("Textures type does not support cascades."):this._loadFile(mm,(mm=>B(new Uint8Array(mm))),void 0,void 0,!0,P)}));else{if(!u||0===u.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(o,Q,((mm,o)=>{M&&M(mm,o)}),u,S)}return this._internalTexturesCache.push(Q),Q}},14862:(mm,o,u)=>{"use strict";u(12565);var f=u(12863);u(12675),u(12818),u(12668),u(12901),u(12868);f.b},14255:(mm,o,u)=>{"use strict";u.d(o,{d:()=>B});var f=u(12702);class B{constructor(mm){this.value=this._toInt(mm)}_toInt(mm){return 0|mm}add(mm){return new B(this.value+mm.value)}Qo(mm){return new B(this.value-mm.value)}multiply(mm){return new B(Math.imul(this.value,mm.value))}divide(mm){return new B(this.value/mm.value)}getClassName(){return B.ClassName}equals(mm){return this.value===mm.value}static FromValue(mm){return new B(mm)}toString(){return this.value.toString()}}B.ClassName="FlowGraphInteger",(0,f.c)("FlowGraphInteger",B)},14266:(mm,o,u)=>{"use strict";u.d(o,{d:()=>B,g:()=>O});var f=u(12740);class B{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.gf=mm}get m(){return this.gf}transformVector(mm){return this.transformVectorToRef(mm,new f.Vector2)}transformVectorToRef(mm,o){return o.x=mm.x*this.gf[0]+mm.y*this.gf[1],o.y=mm.x*this.gf[2]+mm.y*this.gf[3],o}df(){return this.toArray()}toArray(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let o=0;o<4;o++)mm[o]=this.gf[o];return mm}bu(mm){for(let o=0;o<4;o++)this.gf[o]=mm[o];return this}multiplyToRef(mm,o){const u=mm.gf,f=this.gf,B=o.gf;return B[0]=u[0]*f[0]+u[1]*f[2],B[1]=u[0]*f[1]+u[1]*f[3],B[2]=u[2]*f[0]+u[3]*f[2],B[3]=u[2]*f[1]+u[3]*f[3],o}multiply(mm){return this.multiplyToRef(mm,new B)}divideToRef(mm,o){const u=this.gf,f=mm.gf,B=o.gf;return B[0]=u[0]/f[0],B[1]=u[1]/f[1],B[2]=u[2]/f[2],B[3]=u[3]/f[3],o}divide(mm){return this.divideToRef(mm,new B)}addToRef(mm,o){const u=this.gf,f=mm.m,B=o.m;return B[0]=u[0]+f[0],B[1]=u[1]+f[1],B[2]=u[2]+f[2],B[3]=u[3]+f[3],o}add(mm){return this.addToRef(mm,new B)}subtractToRef(mm,o){const u=this.gf,f=mm.m,B=o.m;return B[0]=u[0]-f[0],B[1]=u[1]-f[1],B[2]=u[2]-f[2],B[3]=u[3]-f[3],o}Qo(mm){return this.subtractToRef(mm,new B)}transpose(){const mm=this.gf;return new B([mm[0],mm[2],mm[1],mm[3]])}determinant(){const mm=this.gf;return mm[0]*mm[3]-mm[1]*mm[2]}inverse(){const mm=this.determinant();if(0===mm)throw new Error("Matrix is not invertible");const o=this.gf,u=1/mm;return new B([o[3]*u,-o[1]*u,-o[2]*u,o[0]*u])}equals(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const u=this.gf,f=mm.m;return 0===o?u[0]===f[0]&&u[1]===f[1]&&u[2]===f[2]&&u[3]===f[3]:Math.abs(u[0]-f[0])<o&&Math.abs(u[1]-f[1])<o&&Math.abs(u[2]-f[2])<o&&Math.abs(u[3]-f[3])<o}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.gf.join(", ")})`}}class O{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.gf=mm}get m(){return this.gf}transformVector(mm){return this.transformVectorToRef(mm,new f.lo)}transformVectorToRef(mm,o){const u=this.gf;return o.x=mm.x*u[0]+mm.y*u[1]+mm.z*u[2],o.y=mm.x*u[3]+mm.y*u[4]+mm.z*u[5],o.z=mm.x*u[6]+mm.y*u[7]+mm.z*u[8],o}multiplyToRef(mm,o){const u=mm.gf,f=this.gf,B=o.m;return B[0]=u[0]*f[0]+u[1]*f[3]+u[2]*f[6],B[1]=u[0]*f[1]+u[1]*f[4]+u[2]*f[7],B[2]=u[0]*f[2]+u[1]*f[5]+u[2]*f[8],B[3]=u[3]*f[0]+u[4]*f[3]+u[5]*f[6],B[4]=u[3]*f[1]+u[4]*f[4]+u[5]*f[7],B[5]=u[3]*f[2]+u[4]*f[5]+u[5]*f[8],B[6]=u[6]*f[0]+u[7]*f[3]+u[8]*f[6],B[7]=u[6]*f[1]+u[7]*f[4]+u[8]*f[7],B[8]=u[6]*f[2]+u[7]*f[5]+u[8]*f[8],o}multiply(mm){return this.multiplyToRef(mm,new O)}divideToRef(mm,o){const u=this.gf,f=mm.m,B=o.m;return B[0]=u[0]/f[0],B[1]=u[1]/f[1],B[2]=u[2]/f[2],B[3]=u[3]/f[3],B[4]=u[4]/f[4],B[5]=u[5]/f[5],B[6]=u[6]/f[6],B[7]=u[7]/f[7],B[8]=u[8]/f[8],o}divide(mm){return this.divideToRef(mm,new O)}addToRef(mm,o){const u=this.gf,f=mm.m,B=o.m;return B[0]=u[0]+f[0],B[1]=u[1]+f[1],B[2]=u[2]+f[2],B[3]=u[3]+f[3],B[4]=u[4]+f[4],B[5]=u[5]+f[5],B[6]=u[6]+f[6],B[7]=u[7]+f[7],B[8]=u[8]+f[8],o}add(mm){return this.addToRef(mm,new O)}subtractToRef(mm,o){const u=this.gf,f=mm.m,B=o.m;return B[0]=u[0]-f[0],B[1]=u[1]-f[1],B[2]=u[2]-f[2],B[3]=u[3]-f[3],B[4]=u[4]-f[4],B[5]=u[5]-f[5],B[6]=u[6]-f[6],B[7]=u[7]-f[7],B[8]=u[8]-f[8],o}Qo(mm){return this.subtractToRef(mm,new O)}toArray(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let o=0;o<9;o++)mm[o]=this.gf[o];return mm}df(){return this.toArray()}bu(mm){for(let o=0;o<9;o++)this.gf[o]=mm[o];return this}transpose(){const mm=this.gf;return new O([mm[0],mm[3],mm[6],mm[1],mm[4],mm[7],mm[2],mm[5],mm[8]])}determinant(){const mm=this.gf;return mm[0]*(mm[4]*mm[8]-mm[5]*mm[7])-mm[1]*(mm[3]*mm[8]-mm[5]*mm[6])+mm[2]*(mm[3]*mm[7]-mm[4]*mm[6])}inverse(){const mm=this.determinant();if(0===mm)throw new Error("Matrix is not invertible");const o=this.gf,u=1/mm;return new O([(o[4]*o[8]-o[5]*o[7])*u,(o[2]*o[7]-o[1]*o[8])*u,(o[1]*o[5]-o[2]*o[4])*u,(o[5]*o[6]-o[3]*o[8])*u,(o[0]*o[8]-o[2]*o[6])*u,(o[2]*o[3]-o[0]*o[5])*u,(o[3]*o[7]-o[4]*o[6])*u,(o[1]*o[6]-o[0]*o[7])*u,(o[0]*o[4]-o[1]*o[3])*u])}equals(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const u=this.gf,f=mm.m;return 0===o?u[0]===f[0]&&u[1]===f[1]&&u[2]===f[2]&&u[3]===f[3]&&u[4]===f[4]&&u[5]===f[5]&&u[6]===f[6]&&u[7]===f[7]&&u[8]===f[8]:Math.abs(u[0]-f[0])<o&&Math.abs(u[1]-f[1])<o&&Math.abs(u[2]-f[2])<o&&Math.abs(u[3]-f[3])<o&&Math.abs(u[4]-f[4])<o&&Math.abs(u[5]-f[5])<o&&Math.abs(u[6]-f[6])<o&&Math.abs(u[7]-f[7])<o&&Math.abs(u[8]-f[8])<o}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.gf.join(", ")})`}}},14271:(mm,o,u)=>{"use strict";var f;function B(mm,o,u,f){switch(o){case"Animation":return f?mm.animations.find((mm=>mm.uniqueId===u))??null:mm.animations[u]??null;case"AnimationGroup":return f?mm.animationGroups.find((mm=>mm.uniqueId===u))??null:mm.animationGroups[u]??null;case"Mesh":return f?mm.meshes.find((mm=>mm.uniqueId===u))??null:mm.meshes[u]??null;case"Material":return f?mm.materials.find((mm=>mm.uniqueId===u))??null:mm.materials[u]??null;case"uY":return f?mm.cameras.find((mm=>mm.uniqueId===u))??null:mm.cameras[u]??null;case"Light":return f?mm.lights.find((mm=>mm.uniqueId===u))??null:mm.lights[u]??null;default:return null}}u.d(o,{c:()=>B}),function(mm){mm.Animation="Animation",mm.AnimationGroup="AnimationGroup",mm.Mesh="Mesh",mm.Material="Material",mm.uY="uY",mm.Light="Light"}(f||(f={}))},14299:(mm,o,u)=>{"use strict";u.d(o,{c:()=>B});var f=u(14308);class B extends f.d{constructor(mm,o){if(super(mm),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),o)for(const u of o)this._eventsSignalOutputs[u]=this._registerSignalOutput(u+"Event")}_executeOnTick(mm){}_startPendingTasks(mm){mm._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(mm),this._resetAfterCanceled(mm)),this._preparePendingTasks(mm),mm._addPendingBlock(this),this.out._activateSignal(mm),mm._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(mm){mm._deleteExecutionVariable(this,"_initialized"),mm._removePendingBlock(this)}}},14280:(mm,o,u)=>{"use strict";u.d(o,{e:()=>K});var f=u(12711),B=u(12702),O=u(14289),r=u(12556),w=u(14251);class p extends O.e{constructor(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:f.defaultValue,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(mm,o,u),this.richType=f,this._defaultValue=B,this._optional=O,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new r.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(mm){this._isDisabled!==mm&&(this._isDisabled=mm,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(mm,o){o._getConnectionValue(this)!==mm&&(o._setConnectionValue(this,mm),this.onValueChangedObservable.notifyObservers(mm))}resetToDefaultValue(mm){mm._setConnectionValue(this,this._defaultValue)}connectTo(mm){this._isDisabled||super.connectTo(mm)}_getValueOrDefault(mm){const o=mm._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(o):o}getValue(mm){if(1===this.connectionType){mm._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(mm);const o=this._getValueOrDefault(mm);return this._lastValue=o,this.richType.typeTransformer?this.richType.typeTransformer(o):o}const o=this.isConnected()?this._connectedPoint[0].getValue(mm):this._getValueOrDefault(mm);return this._lastValue=o,this.richType.typeTransformer?this.richType.typeTransformer(o):o}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(mm),mm.richType={},this.richType.serialize(mm.richType),mm.optional=this._optional,(0,w.g)("defaultValue",this._defaultValue,mm)}}(0,B.c)("FlowGraphDataConnection",p);class K{constructor(mm){var o;this.config=mm,this.uniqueId=(0,f.d)(),this.name=(null===(o=this.config)||void 0===o?void 0:o.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(mm){}registerDataInput(mm,o,u){const f=new p(mm,0,this,o,u);return this.dataInputs.push(f),f}registerDataOutput(mm,o,u){const f=new p(mm,1,this,o,u);return this.dataOutputs.push(f),f}getDataInput(mm){return this.dataInputs.find((o=>o.name===mm))}getDataOutput(mm){return this.dataOutputs.find((o=>o.name===mm))}serialize(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.g;if(mm.uniqueId=this.uniqueId,mm.config={},this.config){const u=this.config,f=Object.keys(u);for(const B of f)o(B,u[B],mm.config)}mm.dataInputs=[],mm.dataOutputs=[],mm.className=this.getClassName();for(const u of this.dataInputs){const o={};u.serialize(o),mm.dataInputs.push(o)}for(const u of this.dataOutputs){const o={};u.serialize(o),mm.dataOutputs.push(o)}}deserialize(mm){}_log(mm,o,u){var f;null===(f=mm.logger)||void 0===f||f.addLogItem({action:o,Ju:u,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14289:(mm,o,u)=>{"use strict";u.d(o,{e:()=>O});var f,B=u(12711);!function(mm){mm[mm.Input=0]="Input",mm[mm.Output=1]="Output"}(f||(f={}));class O{constructor(mm,o,u){this._ownerBlock=u,this._connectedPoint=[],this.uniqueId=(0,B.d)(),this.connectedPointIds=[],this.name=mm,this._connectionType=o}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(mm){if(this._connectionType===mm._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||mm._isSingularConnection()&&mm._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(mm),mm._connectedPoint.push(this)}disconnectFrom(mm){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const u=this._connectedPoint.indexOf(mm),f=mm._connectedPoint.indexOf(this);-1!==u&&-1!==f&&(o&&this._connectedPoint.splice(u,1),mm._connectedPoint.splice(f,1))}disconnectFromAll(){for(const mm of this._connectedPoint)this.disconnectFrom(mm,!1);this._connectedPoint.length=0}dispose(){for(const mm of this._connectedPoint)this.disconnectFrom(mm)}serialize(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};mm.uniqueId=this.uniqueId,mm.name=this.name,mm._connectionType=this._connectionType,mm.connectedPointIds=[],mm.className=this.getClassName();for(const o of this._connectedPoint)mm.connectedPointIds.push(o.uniqueId)}getClassName(){return"FGConnection"}deserialize(mm){this.uniqueId=mm.uniqueId,this.name=mm.name,this._connectionType=mm._connectionType,this.connectedPointIds=mm.connectedPointIds}}},14248:(mm,o,u)=>{"use strict";u.d(o,{b:()=>Q});var f,B=u(12556),O=u(12729),r=u(12732),w=u(12711),p=u(14251),K=u(14271),z=u(12565);!function(mm){mm.ExecuteBlock="ExecuteBlock",mm.ExecuteEvent="ExecuteEvent",mm.TriggerConnection="TriggerConnection",mm.ContextVariableSet="ContextVariableSet",mm.GlobalVariableSet="GlobalVariableSet",mm.GlobalVariableDelete="GlobalVariableDelete",mm.GlobalVariableGet="GlobalVariableGet",mm.AddConnection="AddConnection",mm.GetConnectionValue="GetConnectionValue",mm.SetConnectionValue="SetConnectionValue",mm.ActivateSignal="ActivateSignal",mm.ContextVariableGet="ContextVariableGet"}(f||(f={}));class Y{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(mm){if(mm.time||(mm.time=Date.now()),this.log.push(mm),this.logToConsole){var o;const u=null===(o=mm.Ju)||void 0===o?void 0:o.value;"object"===typeof u&&u.getClassName?z.e.Log(`[FGLog] ${mm.className}:${mm.uniqueId.split("-")[0]} ${mm.action} - ${JSON.stringify(u.getClassName())}: ${u.toString()}`):z.e.Log(`[FGLog] ${mm.className}:${mm.uniqueId.split("-")[0]} ${mm.action} - ${JSON.stringify(mm.Ju)}`)}}getItemsOfType(mm){return this.log.filter((o=>o.action===mm))}}class q{get enableLogging(){return this._enableLogging}set enableLogging(mm){this._enableLogging!==mm&&(this._enableLogging=mm,this._enableLogging?(this.logger=new Y,this.logger.logToConsole=!0):this.logger=null)}constructor(mm){this.uniqueId=(0,w.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new B.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=mm,this.assetsContext=mm.assetsContext??mm.bo}hasVariable(mm){return mm in this._userVariables}setVariable(mm,o){var u;this._userVariables[mm]=o,null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Ju:{name:mm,value:o}})}getAsset(mm,o){return(0,K.c)(this.assetsContext,mm,o)}getVariable(mm){var o;return null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Ju:{name:mm,value:this._userVariables[mm]}}),this._userVariables[mm]}get userVariables(){return this._userVariables}Pm(){return this._configuration.bo}_getUniqueIdPrefixedName(mm,o){return`${mm.uniqueId}_${o}`}_getGlobalContextVariable(mm,o){var u;return null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Ju:{name:mm,defaultValue:o,possibleValue:this._globalContextVariables[mm]}}),this._hasGlobalContextVariable(mm)?this._globalContextVariables[mm]:o}_setGlobalContextVariable(mm,o){var u;null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Ju:{name:mm,value:o}}),this._globalContextVariables[mm]=o}_deleteGlobalContextVariable(mm){var o;null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Ju:{name:mm}}),delete this._globalContextVariables[mm]}_hasGlobalContextVariable(mm){return mm in this._globalContextVariables}_setExecutionVariable(mm,o,u){this._executionVariables[this._getUniqueIdPrefixedName(mm,o)]=u}_getExecutionVariable(mm,o,u){return this._hasExecutionVariable(mm,o)?this._executionVariables[this._getUniqueIdPrefixedName(mm,o)]:u}_deleteExecutionVariable(mm,o){delete this._executionVariables[this._getUniqueIdPrefixedName(mm,o)]}_hasExecutionVariable(mm,o){return this._getUniqueIdPrefixedName(mm,o)in this._executionVariables}_hasConnectionValue(mm){return mm.uniqueId in this._connectionValues}_setConnectionValue(mm,o){var u;this._connectionValues[mm.uniqueId]=o,null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Ju:{connectionPointId:mm.uniqueId,value:o}})}_setConnectionValueByKey(mm,o){this._connectionValues[mm]=o}_getConnectionValue(mm){var o;return null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Ju:{connectionPointId:mm.uniqueId,value:this._connectionValues[mm.uniqueId]}}),this._connectionValues[mm.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(mm){this._pendingBlocks.includes(mm)||(this._pendingBlocks.push(mm),this._pendingBlocks.sort(((mm,o)=>mm.priority-o.priority)))}_removePendingBlock(mm){const o=this._pendingBlocks.indexOf(mm);-1!==o&&this._pendingBlocks.splice(o,1)}_clearPendingBlocks(){for(const mm of this._pendingBlocks)mm._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(mm){var o;this.onNodeExecutedObservable.notifyObservers(mm),null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:mm.getClassName(),uniqueId:mm.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(mm){this._setGlobalContextVariable("timeSinceStart",mm.timeSinceStart),this._setGlobalContextVariable("deltaTime",mm.deltaTime);for(const u of this._pendingBlocks){var o;null===(o=u._executeOnTick)||void 0===o||o.call(u,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.g;mm.uniqueId=this.uniqueId,mm._userVariables={};for(const f in this._userVariables)o(f,this._userVariables[f],mm._userVariables);mm._connectionValues={};for(const f in this._connectionValues)o(f,this._connectionValues[f],mm._connectionValues);var u;this.assetsContext!==this.Pm()&&(mm._assetsContext={meshes:this.assetsContext.meshes.map((mm=>mm.id)),materials:this.assetsContext.materials.map((mm=>mm.id)),textures:this.assetsContext.textures.map((mm=>mm.name)),animations:this.assetsContext.animations.map((mm=>mm.name)),lights:this.assetsContext.lights.map((mm=>mm.id)),cameras:this.assetsContext.cameras.map((mm=>mm.id)),Nx:null===(u=this.assetsContext.Nx)||void 0===u?void 0:u.map((mm=>mm.name)),skeletons:this.assetsContext.skeletons.map((mm=>mm.id)),kq:this.assetsContext.kq.map((mm=>mm.name)),geometries:this.assetsContext.geometries.map((mm=>mm.id)),multiMaterials:this.assetsContext.multiMaterials.map((mm=>mm.id)),transformNodes:this.assetsContext.transformNodes.map((mm=>mm.id))})}getClassName(){return"FlowGraphContext"}}(0,O.d)([(0,r.J)()],q.prototype,"uniqueId",void 0);var x=u(14274),H=u(13010);class E{constructor(mm){this.onEventTriggeredObservable=new B.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=mm,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Jf.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const mm=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Ju:{timeSinceStart:this._startingTime,deltaTime:mm}}),this._startingTime+=mm})),this._meshPickedObserver=this._scene.onPointerObservable.add((mm=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Ju:mm})}),H.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((mm=>{const o=mm.pointerId,u=mm.mesh,f=this._pointerUnderMeshState[o];!f&&u?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Ju:{pointerId:o,mesh:u}}):f&&!u?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Ju:{pointerId:o,mesh:f}}):f&&u&&f!==u&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Ju:{pointerId:o,mesh:f,over:u}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Ju:{pointerId:o,mesh:u,out:f}})),this._pointerUnderMeshState[o]=u}),H.c.POINTERMOVE)}dispose(){var mm,o,u,f,B;null===(mm=this._sceneDisposeObserver)||void 0===mm||mm.remove(),null===(o=this._sceneReadyObserver)||void 0===o||o.remove(),null===(u=this._sceneOnBeforeRenderObserver)||void 0===u||u.remove(),null===(f=this._meshPickedObserver)||void 0===f||f.remove(),null===(B=this._meshUnderPointerObserver)||void 0===B||B.remove(),this.onEventTriggeredObservable.clear()}}var M,l=u(14291);!function(mm){mm[mm.Stopped=0]="Stopped",mm[mm.Started=1]="Started"}(M||(M={}));class t{get state(){return this._state}set state(mm){this._state=mm,this.onStateChangedObservable.notifyObservers(mm)}constructor(mm){this.onStateChangedObservable=new B.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=mm.bo,this._sceneEventCoordinator=new E(this._scene),this._coordinator=mm.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((mm=>{for(const o of this._executionContexts){const u=this._getContextualOrder(mm.type,o);for(const f of u)if(!f._executeEvent(o,mm.Ju))break}switch(mm.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const o of this._executionContexts)o._notifyOnTick(mm.Ju);break;case"SceneDispose":this.dispose()}}))}createContext(){const mm=new q({bo:this._scene,coordinator:this._coordinator});return this._executionContexts.push(mm),mm}getContext(mm){return this._executionContexts[mm]}addEventBlock(mm){if("PointerOver"!==mm.type&&"PointerOut"!==mm.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==mm.type&&this._eventBlocks[mm.type].push(mm),1===this.state)for(const o of this._executionContexts)mm._startPendingTasks(o);else this.onStateChangedObservable.addOnce((o=>{if(1===o)for(const u of this._executionContexts)mm._startPendingTasks(u)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((mm=>{1===mm&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const mm of this._executionContexts)for(const o in this._eventBlocks){const u=this._getContextualOrder(o,mm);for(const o of u)o._startPendingTasks(mm)}}_getContextualOrder(mm,o){const u=this._eventBlocks[mm].sort(((mm,o)=>o.initPriority-mm.initPriority));if("MeshPick"===mm){const mm=[];for(const f of u){const B=f.asset.getValue(o);let O=0;for(;O<u.length;O++){const mm=u[O].asset.getValue(o);if(B&&mm&&(0,l.k)(B,mm))break}mm.splice(O,0,f)}return mm}return u}dispose(){var mm;if(0!==this.state){this.state=0;for(const mm of this._executionContexts)mm._clearPendingBlocks();this._executionContexts.length=0;for(const mm in this._eventBlocks)this._eventBlocks[mm].length=0;null===(mm=this._eventObserver)||void 0===mm||mm.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(mm){const o=[],u=new Set;for(const f in this._eventBlocks)for(const mm of this._eventBlocks[f])o.push(mm),u.add(mm.uniqueId);for(;o.length>0;){const f=o.pop();mm(f);for(const mm of f.dataInputs)for(const f of mm._connectedPoint)u.has(f._ownerBlock.uniqueId)||(o.push(f._ownerBlock),u.add(f._ownerBlock.uniqueId));if(f instanceof x.d)for(const mm of f.signalOutputs)for(const f of mm._connectedPoint)u.has(f._ownerBlock.uniqueId)||(o.push(f._ownerBlock),u.add(f._ownerBlock.uniqueId))}}serialize(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;mm.allBlocks=[],this.visitAllBlocks((o=>{const u={};o.serialize(u),mm.allBlocks.push(u)})),mm.executionContexts=[];for(const u of this._executionContexts){const f={};u.serialize(f,o),mm.executionContexts.push(f)}}}class Q{constructor(mm){this.config=mm,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.bo.Jf.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.bo.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const mm=this._executeOnNextFrame.slice(0);if(mm.length)for(const o of mm){this.notifyCustomEvent(o.id,o.data,!1);const mm=this._executeOnNextFrame.findIndex((mm=>mm.uniqueId===o.uniqueId));-1!==mm&&this._executeOnNextFrame.splice(mm,1)}}));(Q.SceneCoordinators.get(this.config.bo)??[]).push(this)}createGraph(){const mm=new t({bo:this.config.bo,coordinator:this});return this._flowGraphs.push(mm),mm}removeGraph(mm){const o=this._flowGraphs.indexOf(mm);-1!==o&&(mm.dispose(),this._flowGraphs.splice(o,1))}start(){for(const mm of this._flowGraphs)mm.start()}dispose(){var mm,o;for(const B of this._flowGraphs)B.dispose();this._flowGraphs.length=0,null===(mm=this._disposeObserver)||void 0===mm||mm.remove(),null===(o=this._onBeforeRenderObserver)||void 0===o||o.remove();const u=Q.SceneCoordinators.get(this.config.bo)??[],f=u.indexOf(this);-1!==f&&u.splice(f,1)}serialize(mm,o){mm._flowGraphs=[];for(const u of this._flowGraphs){const f={};u.serialize(f,o),mm._flowGraphs.push(f)}mm.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(mm){let o=this._customEventsMap.get(mm);return o||(o=new B.d,this._customEventsMap.set(mm,o)),o}notifyCustomEvent(mm,o){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:mm,data:o,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(mm)){const o=this._eventExecutionCounter.get(mm);if(this._eventExecutionCounter.set(mm,o+1),o>=Q.MaxEventTypeExecutionPerFrame)return void(o===Q.MaxEventTypeExecutionPerFrame&&z.e.Warn(`FlowGraphCoordinator: Too many executions of event "${mm}".`))}else this._eventExecutionCounter.set(mm,1);const u=this._customEventsMap.get(mm);u&&u.notifyObservers(o)}}Q.MaxEventsPerType=30,Q.MaxEventTypeExecutionPerFrame=30,Q.SceneCoordinators=new Map},14296:(mm,o,u)=>{"use strict";u.d(o,{e:()=>B});var f=u(14299);class B extends f.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(mm){mm._notifyExecuteNode(this),this.done._activateSignal(mm)}}},14274:(mm,o,u)=>{"use strict";u.d(o,{d:()=>w});var f=u(14280),B=u(14289),O=u(12702);class r extends B.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(mm){super.connectTo(mm),this._connectedPoint.sort(((mm,o)=>o.priority-mm.priority))}_activateSignal(mm){var o;if(null===(o=mm.logger)||void 0===o||o.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Ju:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)mm._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(mm,this),mm._increaseExecutionId();else for(const u of this._connectedPoint)u._activateSignal(mm)}}(0,O.c)("FlowGraphSignalConnection",r);class w extends f.e{constructor(mm){super(mm),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(mm){const o=new r(mm,0,this);return this.signalInputs.push(o),o}_registerSignalOutput(mm){const o=new r(mm,1,this);return this.signalOutputs.push(o),o}_unregisterSignalInput(mm){const o=this.signalInputs.findIndex((o=>o.name===mm));-1!==o&&(this.signalInputs[o].dispose(),this.signalInputs.splice(o,1))}_unregisterSignalOutput(mm){const o=this.signalOutputs.findIndex((o=>o.name===mm));-1!==o&&(this.signalOutputs[o].dispose(),this.signalOutputs.splice(o,1))}_reportError(mm,o){this.error.Ju="string"===typeof o?new Error(o):o,this.error._activateSignal(mm)}getSignalInput(mm){return this.signalInputs.find((o=>o.name===mm))}getSignalOutput(mm){return this.signalOutputs.find((o=>o.name===mm))}serialize(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(mm),mm.signalInputs=[],mm.signalOutputs=[];for(const o of this.signalInputs){const u={};o.serialize(u),mm.signalInputs.push(u)}for(const o of this.signalOutputs){const u={};o.serialize(u),mm.signalOutputs.push(u)}}deserialize(mm){for(let o=0;o<mm.signalInputs.length;o++){const u=this.getSignalInput(mm.signalInputs[o].name);if(!u)throw new Error("Could not find signal input with name "+mm.signalInputs[o].name+" in block "+mm.className);u.deserialize(mm.signalInputs[o])}for(let o=0;o<mm.signalOutputs.length;o++){const u=this.getSignalOutput(mm.signalOutputs[o].name);if(!u)throw new Error("Could not find signal output with name "+mm.signalOutputs[o].name+" in block "+mm.className);u.deserialize(mm.signalOutputs[o])}}getClassName(){return"FlowGraphExecutionBlock"}}},14308:(mm,o,u)=>{"use strict";u.d(o,{d:()=>B});var f=u(14274);class B extends f.d{constructor(mm){super(mm),this.out=this._registerSignalOutput("out")}}},14257:(mm,o,u)=>{"use strict";u.d(o,{B:()=>x,D:()=>H,E:()=>E,G:()=>R,K:()=>g,O:()=>P,P:()=>S,b:()=>K,f:()=>q,j:()=>N,l:()=>M,m:()=>l,q:()=>t,r:()=>Y,t:()=>J,x:()=>z});var f,B=u(12740),O=u(12780),r=u(14255),w=u(14266);!function(mm){mm.Any="any",mm.String="string",mm.Number="number",mm.Boolean="boolean",mm.Object="object",mm.Integer="FlowGraphInteger",mm.Vector2="Vector2",mm.lo="lo",mm.Vector4="Vector4",mm.Quaternion="Quaternion",mm.Matrix="Matrix",mm.Matrix2D="Matrix2D",mm.Matrix3D="Matrix3D",mm.No="No",mm.pp="pp"}(f||(f={}));class p{constructor(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=mm,this.defaultValue=o,this.animationType=u}serialize(mm){mm.typeName=this.typeName,mm.defaultValue=this.defaultValue}}const K=new p("any",void 0),z=new p("string",""),Y=new p("number",0,0),q=new p("boolean",!1),x=new p("Vector2",B.Vector2.Zero(),5),H=new p("lo",B.lo.Zero(),1),E=new p("Vector4",B.Vector4.Zero()),M=new p("Matrix",B.Matrix.Identity(),3),l=new p("Matrix2D",new w.d),t=new p("Matrix3D",new w.g),Q=new p("No",O.No.Black(),4),b=new p("pp",new O.pp(0,0,0,0),7),J=new p("Quaternion",B.Quaternion.Identity(),2);J.typeTransformer=mm=>{if(mm.getClassName){if("Vector4"===mm.getClassName())return B.Quaternion.So(mm.df());if("lo"===mm.getClassName())return B.Quaternion.FromEulerVector(mm);if("Matrix"===mm.getClassName())return B.Quaternion.FromRotationMatrix(mm)}return mm};const N=new p("FlowGraphInteger",new r.d(0),0);function S(mm){const o=mm;switch(typeof mm){case"string":return z;case"number":return Y;case"boolean":return q;case"object":if(o.getClassName)switch(o.getClassName()){case"Vector2":return x;case"lo":return H;case"Vector4":return E;case"Matrix":return M;case"No":return Q;case"pp":return b;case"Quaternion":return J;case"FlowGraphInteger":return N;case"Matrix2D":return l;case"Matrix3D":return t}return K;default:return K}}function P(mm){switch(mm){case"string":return z;case"number":return Y;case"boolean":return q;case"Vector2":return x;case"lo":return H;case"Vector4":return E;case"Matrix":return M;case"No":return Q;case"pp":return b;case"Quaternion":return J;case"FlowGraphInteger":return N;case"Matrix2D":return l;case"Matrix3D":return t;default:return K}}function R(mm){switch(mm){case"number":default:return 0;case"Vector2":return 5;case"lo":return 1;case"Matrix":return 3;case"No":return 4;case"pp":return 7;case"Quaternion":return 2}}function g(mm){switch(mm){case 0:return Y;case 5:return x;case 1:return H;case 3:return M;case 4:return Q;case 7:return b;case 2:return J;default:return K}}},14251:(mm,o,u)=>{"use strict";u.d(o,{d:()=>z,g:()=>K,k:()=>Y});var f=u(12780),B=u(12740),O=u(14255),r=u(14257),w=u(14266);function p(mm){return"Vector2"===mm||"lo"===mm||"Vector4"===mm||"Quaternion"===mm||"No"===mm||"pp"===mm}function K(mm,o,u){var f;const B=(null===o||void 0===o||null===(f=o.getClassName)||void 0===f?void 0:f.call(o))??"";if(p(B)||function(mm){return"Matrix"===mm||"Matrix2D"===mm||"Matrix3D"===mm}(B))u[mm]={value:o.df(),className:B};else if("FlowGraphInteger"===B)u[mm]={value:o.value,className:B};else if(B&&(o.id||o.name))u[mm]={id:o.id,name:o.name,className:B};else{if("object"===typeof o)throw new Error(`Could not serialize value ${o}`);u[mm]=o}}function z(mm,o,u,K){const Y=o[mm];let q;const x=(null===Y||void 0===Y?void 0:Y.type)??(null===Y||void 0===Y?void 0:Y.className);if(function(mm){return"Mesh"===mm||"AbstractMesh"===mm||"GroundMesh"===mm||"InstanceMesh"===mm||"LinesMesh"===mm||"GoldbergMesh"===mm||"GreasedLineMesh"===mm||"TrailMesh"===mm}(x)){let mm=K.meshes.filter((mm=>Y.id?mm.id===Y.id:mm.name===Y.name));0===mm.length&&(mm=K.transformNodes.filter((mm=>Y.id?mm.id===Y.id:mm.name===Y.name))),q=Y.uniqueId?mm.find((mm=>mm.uniqueId===Y.uniqueId)):mm[0]}else if(p(x))q=function(mm,o){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===mm)return B.Vector2.So(o);if("lo"===mm)return u&&(o[2]*=-1),B.lo.So(o);if("Vector4"===mm)return B.Vector4.So(o);if("Quaternion"===mm)return u&&(o[2]*=-1,o[3]*=-1),B.Quaternion.So(o);if("No"===mm)return new f.No(o[0],o[1],o[2]);if("pp"===mm)return new f.pp(o[0],o[1],o[2],o[3]);throw new Error(`Unknown vector class name ${mm}`)}(x,Y.value);else if(function(mm){return"AnimationGroup"===mm}(x)){const mm=K.animationGroups.filter((mm=>mm.name===Y.name));q=1===mm.length?mm[0]:mm.find((mm=>mm.uniqueId===Y.uniqueId))}else q="Matrix"===x?B.Matrix.So(Y.value):"Matrix2D"===x?new w.d(Y.value):"Matrix3D"===x?new w.g(Y.value):"FlowGraphInteger"===x?O.d.FromValue(Y.value):"number"===x||"string"===x||"boolean"===x?Y.value[0]:Y&&void 0!==Y.value?Y.value:Array.isArray(Y)?Y.reduce(((mm,o)=>o.eventData?(mm[o.id]={type:(0,r.O)(o.type)},"undefined"!==typeof o.value&&(mm[o.id].value=z("value",o,u,K)),mm):mm),{}):Y;return q}function Y(mm){return"FlowGraphJsonPointerParserBlock"===mm}},14291:(mm,o,u)=>{"use strict";function f(mm,o){return!(!mm.parent||mm.parent!==o&&!f(mm.parent,o))}function B(mm){if(mm.getClassName)return mm.getClassName()}function O(mm,o){return mm===o&&("Vector2"===mm||"lo"===mm||"Vector4"===mm||"Quaternion"===mm)}function r(mm,o){return mm===o&&("Matrix"===mm||"Matrix2D"===mm||"Matrix3D"===mm)}function w(mm,o){return"FlowGraphInteger"===mm&&"FlowGraphInteger"===o}function p(mm,o){const u="number"===typeof mm||"number"===typeof(null===mm||void 0===mm?void 0:mm.value);return u&&!o?!isNaN(K(mm)):u}function K(mm){return"number"===typeof mm?mm:mm.value}u.d(o,{c:()=>w,d:()=>r,f:()=>O,j:()=>B,k:()=>f,n:()=>K,r:()=>p})},14612:(mm,o,u)=>{"use strict";u.r(o),u.d(o,{SceneInstrumentation:()=>O});var f=u(12549),B=u(12940);class O{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(mm){mm!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=mm,mm?(this._onBeforeActiveMeshesEvaluationObserver=this.bo.onBeforeActiveMeshesEvaluationObservable.add((()=>{f.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.bo.onAfterActiveMeshesEvaluationObservable.add((()=>{f.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.bo.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.bo.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(mm){mm!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=mm,mm?(this._onBeforeRenderTargetsRenderObserver=this.bo.onBeforeRenderTargetsRenderObservable.add((()=>{f.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.bo.onAfterRenderTargetsRenderObservable.add((()=>{f.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.bo.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.bo.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(mm){mm!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=mm,mm?(this._onBeforeParticlesRenderingObserver=this.bo.onBeforeParticlesRenderingObservable.add((()=>{f.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.bo.onAfterParticlesRenderingObservable.add((()=>{f.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.bo.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.bo.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(mm){mm!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=mm,this.bo.spriteManagers&&(mm?(this._onBeforeSpritesRenderingObserver=this.bo.onBeforeSpritesRenderingObservable.add((()=>{f.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.bo.onAfterSpritesRenderingObservable.add((()=>{f.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.bo.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.bo.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(mm){mm!==this._capturePhysicsTime&&this.bo.onBeforePhysicsObservable&&(this._capturePhysicsTime=mm,mm?(this._onBeforePhysicsObserver=this.bo.onBeforePhysicsObservable.add((()=>{f.Tools.StartPerformanceCounter("nx"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.bo.onAfterPhysicsObservable.add((()=>{f.Tools.EndPerformanceCounter("nx"),this._physicsTime.endMonitoring()}))):(this.bo.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.bo.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(mm){mm!==this._captureAnimationsTime&&(this._captureAnimationsTime=mm,mm?this._onAfterAnimationsObserver=this.bo.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.bo.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(mm){this._captureFrameTime=mm}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(mm){this._captureInterFrameTime=mm}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(mm){mm!==this._captureRenderTime&&(this._captureRenderTime=mm,mm?(this._onBeforeDrawPhaseObserver=this.bo.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),f.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.bo.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),f.Tools.EndPerformanceCounter("Main render")}))):(this.bo.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.bo.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(mm){mm!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=mm,mm?(this._onBeforeCameraRenderObserver=this.bo.onBeforeCameraRenderObservable.add((mm=>{this._cameraRenderTime.beginMonitoring(),f.Tools.StartPerformanceCounter(`Rendering camera ${mm.name}`)})),this._onAfterCameraRenderObserver=this.bo.onAfterCameraRenderObservable.add((mm=>{this._cameraRenderTime.endMonitoring(!1),f.Tools.EndPerformanceCounter(`Rendering camera ${mm.name}`)}))):(this.bo.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.bo.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.bo.getEngine()._drawCalls}constructor(mm){this.bo=mm,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new B.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new B.e,this._captureFrameTime=!1,this._frameTime=new B.e,this._captureRenderTime=!1,this._renderTime=new B.e,this._captureInterFrameTime=!1,this._interFrameTime=new B.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new B.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new B.e,this._capturePhysicsTime=!1,this._physicsTime=new B.e,this._captureAnimationsTime=!1,this._animationsTime=new B.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new B.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=mm.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(f.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.bo.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=mm.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(f.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.bf(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.bf(),this._captureParticlesRenderTime&&this._particlesRenderTime.bf(),this._captureSpritesRenderTime&&this._spritesRenderTime.bf(),this._captureRenderTime&&this._renderTime.bf(),this._captureCameraRenderTime&&this._cameraRenderTime.bf()}))}dispose(){this._disposed||(this.bo.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.bo.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.bo.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.bo.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.bo.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.bo.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.bo.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.bo.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.bo.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.bo.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.bo.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.bo.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.bo.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.bo.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.bo.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.bo.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.bo.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.bo=null,this._disposed=!0)}}},14243:(mm,o,u)=>{"use strict";u.d(o,{d:()=>z});var f=u(12729),B=u(12732),O=u(12740),r=u(13145),w=u(13258),p=u(13310),K=u(12702);r.c.AddNodeConstructor("Light_Type_1",((mm,o)=>()=>new z(mm,O.lo.Zero(),o)));class z extends p.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(mm){this._shadowFrustumSize=mm,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(mm){this._shadowOrthoScale=mm,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(mm){this._orthoLeft=mm}get orthoRight(){return this._orthoRight}set orthoRight(mm){this._orthoRight=mm}get orthoTop(){return this._orthoTop}set orthoTop(mm){this._orthoTop=mm}get orthoBottom(){return this._orthoBottom}set orthoBottom(mm){this._orthoBottom=mm}constructor(mm,o,u){super(mm,u),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=o.scale(-1),this.direction=o}getClassName(){return"aE"}getTypeID(){return w.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(mm,o,u){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(mm):this._setDefaultAutoExtendShadowProjectionMatrix(mm,o,u)}_setDefaultFixedFrustumShadowProjectionMatrix(mm){const o=this.Pm().activeCamera;o&&O.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:o.hf,void 0!==this.shadowMaxZ?this.shadowMaxZ:o.maxZ,mm,this.Pm().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(mm,o,u){const f=this.Pm().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const mm=O.lo.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let f=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(let r=0;r<u.length;r++){const w=u[r];if(!w)continue;const p=w.getBoundingInfo().boundingBox;for(let u=0;u<p.vectorsWorld.length;u++)O.lo.TransformCoordinatesToRef(p.vectorsWorld[u],o,mm),mm.x<this._orthoLeft&&(this._orthoLeft=mm.x),mm.y<this._orthoBottom&&(this._orthoBottom=mm.y),mm.x>this._orthoRight&&(this._orthoRight=mm.x),mm.y>this._orthoTop&&(this._orthoTop=mm.y),this.autoCalcShadowZBounds&&(mm.z<f&&(f=mm.z),mm.z>B&&(B=mm.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=f,this._shadowMaxZ=B)}const B=this._orthoRight-this._orthoLeft,r=this._orthoTop-this._orthoBottom,w=void 0!==this.shadowMinZ?this.shadowMinZ:(null===f||void 0===f?void 0:f.hf)||0,p=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===f||void 0===f?void 0:f.maxZ)||1e4,K=this.Pm().getEngine().tf;O.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-B*this.shadowOrthoScale,this._orthoRight+B*this.shadowOrthoScale,this._orthoBottom-r*this.shadowOrthoScale,this._orthoTop+r*this.shadowOrthoScale,K?p:w,K?w:p,mm,this.Pm().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(mm,o){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,o),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,o),this)}transferToNodeMaterialEffect(mm,o){return this.computeTransformedInformation()?(mm.setFloat3(o,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(mm.setFloat3(o,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(mm){const o=this._scene.getEngine();return!o.tf&&o.isNDCHalfZRange?0:1}getDepthMaxZ(mm){const o=this._scene.getEngine();return o.tf&&o.isNDCHalfZRange?0:1}prepareLightSpecificDefines(mm,o){mm["DIRLIGHT"+o]=!0}}(0,f.d)([(0,B.J)()],z.prototype,"shadowFrustumSize",null),(0,f.d)([(0,B.J)()],z.prototype,"shadowOrthoScale",null),(0,f.d)([(0,B.J)()],z.prototype,"autoUpdateExtends",void 0),(0,f.d)([(0,B.J)()],z.prototype,"autoCalcShadowZBounds",void 0),(0,f.d)([(0,B.J)("orthoLeft")],z.prototype,"_orthoLeft",void 0),(0,f.d)([(0,B.J)("orthoRight")],z.prototype,"_orthoRight",void 0),(0,f.d)([(0,B.J)("orthoTop")],z.prototype,"_orthoTop",void 0),(0,f.d)([(0,B.J)("orthoBottom")],z.prototype,"_orthoBottom",void 0),(0,K.c)("BABYLON.DirectionalLight",z)},14793:(mm,o,u)=>{"use strict";u.d(o,{b:()=>z});var f=u(12729),B=u(12732),O=u(12740),r=u(12780),w=u(13145),p=u(13258),K=u(12702);w.c.AddNodeConstructor("Light_Type_3",((mm,o)=>()=>new z(mm,O.lo.Zero(),o)));class z extends p.c{constructor(mm,o,u){super(mm,u),this.groundColor=new r.No(0,0,0),this.direction=o||O.lo.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"XE"}setDirectionToTarget(mm){return this.direction=O.lo.Normalize(mm.Qo(O.lo.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(mm,o){const u=O.lo.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",u.x,u.y,u.z,0,o),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Yp),o),this}transferToNodeMaterialEffect(mm,o){const u=O.lo.Normalize(this.direction);return mm.setFloat3(o,u.x,u.y,u.z),this}Df(){return this._worldMatrix||(this._worldMatrix=O.Matrix.Identity()),this._worldMatrix}getTypeID(){return p.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(mm,o){mm["HEMILIGHT"+o]=!0}}(0,f.d)([(0,B.l)()],z.prototype,"groundColor",void 0),(0,f.d)([(0,B.F)()],z.prototype,"direction",void 0),(0,K.c)("BABYLON.HemisphericLight",z)},14213:(mm,o,u)=>{"use strict";u.d(o,{b:()=>Y});var f=u(12729),B=u(12732),O=u(12740),r=u(13145),w=u(13258),p=u(13310),K=u(12727),z=u(12702);r.c.AddNodeConstructor("Light_Type_2",((mm,o)=>()=>new Y(mm,O.lo.Zero(),O.lo.Zero(),0,0,o)));class Y extends p.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(mm){this._iesProfileTexture!==mm&&(this._iesProfileTexture=mm,this._iesProfileTexture&&Y._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(mm){this._angle=mm,this._cosHalfAngle=Math.cos(.5*mm),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(mm){this._innerAngle=mm,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(mm){this._shadowAngleScale=mm,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(mm){this._projectionTextureLightNear=mm,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(mm){this._projectionTextureLightFar=mm,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(mm){this._projectionTextureUpDirection=mm,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(mm){this._projectionTexture!==mm&&(this._projectionTexture=mm,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Y._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Y._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(mm){return void 0!==mm.onGeneratedObservable}static _IsTexture(mm){return void 0!==mm.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(mm){this._projectionTextureProjectionLightMatrix=mm,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(mm,o,u,f,B,r){super(mm,r),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=O.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=O.lo.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=O.lo.Zero(),this._projectionTextureViewLightMatrix=O.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=O.Matrix.Zero(),this._projectionTextureScalingMatrix=O.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=o,this.direction=u,this.angle=f,this.exponent=B}getClassName(){return"SpotLight"}getTypeID(){return w.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(mm){super._setDirection(mm),this._projectionTextureViewLightDirty=!0}_setPosition(mm){super._setPosition(mm),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(mm,o,u){const f=this.Pm().activeCamera;if(!f)return;this._shadowAngleScale=this._shadowAngleScale||1;const B=this._shadowAngleScale*this._angle,r=void 0!==this.shadowMinZ?this.shadowMinZ:f.hf,w=void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ,p=this.Pm().getEngine().tf;O.Matrix.PerspectiveFovLHToRef(B,1,p?w:r,p?r:w,mm,!0,this._scene.getEngine().isNDCHalfZRange,void 0,p)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),O.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const mm=this.projectionTextureLightFar,o=this.projectionTextureLightNear,u=mm/(mm-o),f=-u*o,B=1/Math.tan(this._angle/2);O.Matrix.FromValuesToRef(B/1,0,0,0,0,B,0,0,0,0,u,1,0,0,f,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof K.b){const mm=this._projectionTexture.uScale/2,o=this._projectionTexture.vScale/2;O.Matrix.FromValuesToRef(mm,0,0,0,0,o,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(mm,o){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),mm.setMatrix("textureProjectionMatrix"+o,this._projectionTextureMatrix),mm.setTexture("projectionLightTexture"+o,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&mm.setTexture("iesLightTexture"+o,this._iesProfileTexture),this}transferToEffect(mm,o){let u;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,o),u=O.lo.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,o),u=O.lo.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",u.x,u.y,u.z,this._cosHalfAngle,o),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,o),this}transferToNodeMaterialEffect(mm,o){let u;return u=this.computeTransformedInformation()?O.lo.Normalize(this.transformedDirection):O.lo.Normalize(this.direction),this.Pm().useRightHandedSystem?mm.setFloat3(o,-u.x,-u.y,-u.z):mm.setFloat3(o,u.x,u.y,u.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(mm){const o=this._scene.getEngine(),u=void 0!==this.shadowMinZ?this.shadowMinZ:(null===mm||void 0===mm?void 0:mm.hf)??0;return o.tf&&o.isNDCHalfZRange?u:this._scene.getEngine().isNDCHalfZRange?0:u}getDepthMaxZ(mm){const o=this._scene.getEngine(),u=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===mm||void 0===mm?void 0:mm.maxZ)??1e4;return o.tf&&o.isNDCHalfZRange?0:u}prepareLightSpecificDefines(mm,o){mm["SPOTLIGHT"+o]=!0,mm["PROJECTEDLIGHTTEXTURE"+o]=!(!this.projectionTexture||!this.projectionTexture.isReady()),mm["IESLIGHTTEXTURE"+o]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,f.d)([(0,B.J)()],Y.prototype,"angle",null),(0,f.d)([(0,B.J)()],Y.prototype,"innerAngle",null),(0,f.d)([(0,B.J)()],Y.prototype,"shadowAngleScale",null),(0,f.d)([(0,B.J)()],Y.prototype,"exponent",void 0),(0,f.d)([(0,B.J)()],Y.prototype,"projectionTextureLightNear",null),(0,f.d)([(0,B.J)()],Y.prototype,"projectionTextureLightFar",null),(0,f.d)([(0,B.J)()],Y.prototype,"projectionTextureUpDirection",null),(0,f.d)([(0,B.B)("projectedLightTexture")],Y.prototype,"_projectionTexture",void 0),(0,z.c)("BABYLON.SpotLight",Y)},13933:(mm,o,u)=>{"use strict";u.d(o,{b:()=>r,f:()=>O,i:()=>w});const f={},B={};function O(mm,o){f[mm]=o}function r(mm,o){B[mm]=o}function w(mm){return B[mm]?B[mm]:null}},13830:(mm,o,u)=>{"use strict";u.d(o,{d:()=>S,e:()=>j});var f,B=u(12549),O=u(12556),r=u(12965),w=u(12596),p=u(12565),K=u(13181),z=u(12605),Y=u(12610),q=u(12711),x=u(12638),H=u(12594);!function(mm){mm[mm.Clean=0]="Clean",mm[mm.Stop=1]="Stop",mm[mm.Sync=2]="Sync",mm[mm.NoSync=3]="NoSync"}(f||(f={}));const E=new O.d,M={};let l=!1;function t(){return M[".babylon"]}function Q(mm,o){const u=M[mm];return u||(p.e.Warn("Unable to find a plugin to load "+mm+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),o?t():void 0)}function b(mm,o,u){let f="Unable to load from "+(mm.rawData?"binary data":mm.url);return o?f+=`: ${o}`:u&&(f+=`: ${u}`),f}async function J(mm,o,u,f,B,O,r,w,p){var K;const Y="data:"===(q=mm.url).substring(0,5)?q.substring(5):null;var q;if(mm.rawData&&!r)throw"When using ArrayBufferView to load data the file extension must be provided.";const l=Y||r?"":function(mm){const o=mm.indexOf("?");-1!==o&&(mm=mm.substring(0,o));const u=mm.lastIndexOf(".");return mm.substring(u,mm.length).toLowerCase()}(mm.url);let b=r?Q(r,!0):Y?function(mm){for(const o in M){const u=M[o].plugin;if(u.canDirectLoad&&u.canDirectLoad(mm))return M[o]}return t()}(mm.url):Q(l,!1);if(!b&&l){if(mm.url&&!mm.url.startsWith("blob:")){const o=await async function(mm,o){const u=o.method||"GET";return await new Promise(((f,B)=>{const O=new H.e;O.addEventListener("readystatechange",(()=>{if(4==O.readyState)if(200==O.status){const mm={};if(o.responseHeaders)for(const u of o.responseHeaders)mm[u]=O.getResponseHeader(u)||"";f({response:O.response,headerValues:mm})}else B(`Unable to fetch data from ${mm}. Error code: ${O.status}`)})),O.open(u,mm),O.send()}))}(mm.url,{method:"HEAD",responseHeaders:["Content-Type"]}),u=o.headerValues?o.headerValues["Content-Type"]:"";u&&(b=function(mm){for(const o in M){const u=M[o];if(u.mimeType===mm)return u}}(u))}b||(b=t())}if(!b)throw new Error(`No plugin or fallback for ${r??mm.url}`);if(!1===(null===p||void 0===p||null===(K=p[b.plugin.name])||void 0===K?void 0:K.enabled))throw new Error(`The '${b.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(mm.rawData&&!b.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(mm=>{if(b.plugin.createPlugin){const o=b.plugin.createPlugin(p??{});return o instanceof Promise?(o.then(mm).catch((mm=>{B("Error instantiating plugin.",mm)})),null):(mm(o),o)}return mm(b.plugin),b.plugin})((p=>{var K;if(!p)throw`The loader plugin corresponding to the '${r}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(E.notifyObservers(p),Y&&(p.canDirectLoad&&p.canDirectLoad(mm.url)||!(0,z.k)(mm.url))){if(p.directLoad){const mm=p.directLoad(o,Y);mm instanceof Promise?mm.then((mm=>{u(p,mm)})).catch((mm=>{B("Error in directLoad of _loadData: "+mm,mm)})):u(p,mm)}else u(p,Y);return}const q=b.isBinary,H=(mm,f)=>{o.q?B("Scene has been disposed"):u(p,mm,f)};let M=null,l=!1;null===(K=p.Jf)||void 0===K||K.add((()=>{l=!0,M&&(M.abort(),M=null),O()}));const t=()=>{if(l)return;const u=(mm,o)=>{B(null===mm||void 0===mm?void 0:mm.statusText,o)};if(!p.loadFile&&mm.rawData)throw"Plugin does not support loading ArrayBufferView.";M=p.loadFile?p.loadFile(o,mm.rawData||mm.file||mm.url,mm.rootUrl,H,f,q,u,w):o._loadFile(mm.file||mm.url,H,f,!0,q,u)},Q=o.getEngine();let J=Q.enableOfflineSupport;if(J){let u=!1;for(const f of o.disableOfflineSupportExceptionRules)if(f.test(mm.url)){u=!0;break}J=!u}J&&x.c.OfflineProviderFactory?o.offlineProvider=x.c.OfflineProviderFactory(mm.url,t,Q.disableManifestCheck):t()}))}function N(mm,o){let u,f,O=null,r=null;if(o)if(o.name)u=`file:${o.name}`,f=o.name,O=o;else if(ArrayBuffer.isView(o))u="",f=(0,q.d)(),r=o;else if(o.startsWith("data:"))u=o,f="";else if(mm){const O=o;if("/"===O.substring(0,1))return B.Tools.Error("Wrong sceneFilename parameter"),null;u=mm+O,f=O}else u=o,f=B.Tools.GetFilename(o),mm=B.Tools.GetFolderPath(o);else u=mm,f=B.Tools.GetFilename(mm),mm=B.Tools.GetFolderPath(mm);return{url:u,rootUrl:mm,name:f,file:O,rawData:r}}function S(mm){if("string"===typeof mm.extensions){const o=mm.extensions;M[o.toLowerCase()]={plugin:mm,isBinary:!1}}else{const o=mm.extensions,u=Object.keys(o);for(const f of u)M[f.toLowerCase()]={plugin:mm,isBinary:o[f].isBinary,mimeType:o[f].mimeType}}}async function P(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.d.LastCreatedScene,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!f)return p.e.Error("No scene available to import mesh to"),null;const x=N(o,u);if(!x)return null;const H={};f.addPendingData(H);const E=()=>{f.removePendingData(H)},M=(mm,o)=>{const u=b(x,mm,o);r?r(f,u,new Y.j(u,Y.h.SceneLoaderError,o)):p.e.Error(u),E()},l=O?mm=>{try{O(mm)}catch(o){M("Error in onProgress callback: "+o,o)}}:void 0,t=(mm,o,u,O,r,w,p,K)=>{if(f.importedMeshesFiles.push(x.url),B)try{B(mm,o,u,O,r,w,p,K)}catch(z){M("Error in onSuccess callback: "+z,z)}f.removePendingData(H)};return await J(x,f,((o,u,B)=>{if(o.rewriteRootURL&&(x.rootUrl=o.rewriteRootURL(x.rootUrl,B)),o.importMesh){const B=[],O=[],r=[];if(!o.importMesh(mm,f,u,x.rootUrl,B,O,r,M))return;f.loadingPluginName=o.name,t(B,O,r,[],[],[],[],[])}else{o.importMeshAsync(mm,f,u,x.rootUrl,l,x.name).then((mm=>{f.loadingPluginName=o.name,t(mm.meshes,mm.kq,mm.skeletons,mm.animationGroups,mm.transformNodes,mm.geometries,mm.lights,mm.spriteManagers)})).catch((mm=>{M(mm.message,mm)}))}}),l,M,E,K,z,q)}async function R(mm,o,u,f,B,O,r,w){return await new Promise(((p,K)=>{try{P(mm,o,u,f,((mm,o,u,f,B,O,r,w)=>{p({meshes:mm,kq:o,skeletons:u,animationGroups:f,transformNodes:B,geometries:O,lights:r,spriteManagers:w})}),B,((mm,o,u)=>{K(u||new Error(o))}),O,r,w).catch(K)}catch(Y){K(Y)}}))}async function g(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.d.LastCreatedEngine,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};u?await F(mm,o,new r.d(u),f,O,p,K,z,Y):B.Tools.Error("No engine available")}async function W(mm,o,u,f,B,O,r){return await new Promise(((w,p)=>{g(mm,o,u,(mm=>{w(mm)}),f,((mm,o,u)=>{p(u||new Error(o))}),B,O,r)}))}async function F(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.d.LastCreatedScene,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!u)return p.e.Error("No scene available to append to"),null;const x=N(mm,o);if(!x)return null;const H={};u.addPendingData(H);const E=()=>{u.removePendingData(H)};K.d.ShowLoadingScreen&&!l&&(l=!0,u.getEngine().displayLoadingUI(),u.executeWhenReady((()=>{u.getEngine().hideLoadingUI(),l=!1})));const M=(mm,o)=>{const f=b(x,mm,o);O?O(u,f,new Y.j(f,Y.h.SceneLoaderError,o)):p.e.Error(f),E()},t=B?mm=>{try{B(mm)}catch(o){M("Error in onProgress callback",o)}}:void 0,Q=()=>{if(f)try{f(u)}catch(mm){M("Error in onSuccess callback",mm)}u.removePendingData(H)};return await J(x,u,((mm,o)=>{if(mm.load){if(!mm.load(u,o,x.rootUrl,M))return;u.loadingPluginName=mm.name,Q()}else{mm.loadAsync(u,o,x.rootUrl,t,x.name).then((()=>{u.loadingPluginName=mm.name,Q()})).catch((mm=>{M(mm.message,mm)}))}}),t,M,E,r,z,q)}async function c(mm,o,u,f,B,O,r){return await new Promise(((w,p)=>{try{F(mm,o,u,(mm=>{w(mm)}),f,((mm,o,u)=>{p(u||new Error(o))}),B,O,r).catch(p)}catch(Y){p(Y)}}))}async function A(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.d.LastCreatedScene,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!u)return p.e.Error("No scene available to load asset container to"),null;const q=N(mm,o);if(!q)return null;const x={};u.addPendingData(x);const H=()=>{u.removePendingData(x)},E=(mm,o)=>{const f=b(q,mm,o);O?O(u,f,new Y.j(f,Y.h.SceneLoaderError,o)):p.e.Error(f),H()},M=B?mm=>{try{B(mm)}catch(o){E("Error in onProgress callback",o)}}:void 0,l=mm=>{if(f)try{f(mm)}catch(o){E("Error in onSuccess callback",o)}u.removePendingData(x)};return await J(q,u,((mm,o)=>{if(mm.loadAssetContainer){const f=mm.loadAssetContainer(u,o,q.rootUrl,E);if(!f)return;f.populateRootNodes(),u.loadingPluginName=mm.name,l(f)}else if(mm.loadAssetContainerAsync){mm.loadAssetContainerAsync(u,o,q.rootUrl,M,q.name).then((o=>{o.populateRootNodes(),u.loadingPluginName=mm.name,l(o)})).catch((mm=>{E(mm.message,mm)}))}else E("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),M,E,H,r,K,z)}async function y(mm,o,u,f,B,O,r){return await new Promise(((w,p)=>{try{A(mm,o,u,(mm=>{w(mm)}),f,((mm,o,u)=>{p(u||new Error(o))}),B,O,r).catch(p)}catch(Y){p(Y)}}))}async function I(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.d.LastCreatedScene,f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",x=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!u)return void p.e.Error("No scene available to load animations to");if(f){for(const f of u.animatables)f.reset();u.stopAllAnimations();const mm=u.animationGroups.slice();for(const u of mm)u.dispose();const o=u.getNodes();for(const u of o)u.animations&&(u.animations=[])}else switch(B){case 0:const mm=u.animationGroups.slice();for(const o of mm)o.dispose();break;case 1:for(const o of u.animationGroups)o.stop();break;case 2:for(const o of u.animationGroups)o.reset(),o.restart();break;case 3:break;default:return void p.e.Error("Unknown animation group loading mode value '"+B+"'")}const H=u.animatables.length;await A(mm,o,u,(mm=>{mm.mergeAnimationsTo(u,u.animatables.slice(H),O),mm.dispose(),u.onAnimationFileImportedObservable.notifyObservers(u),r&&r(u)}),K,z,Y,q,x)}async function s(mm,o,u,f,B,O,r,w,p,K){return await new Promise(((z,q)=>{try{I(mm,o,u,f,B,O,(mm=>{z(mm)}),r,((mm,o,u)=>{q(u||new Error(o))}),w,p,K).catch(q)}catch(Y){q(Y)}}))}class j{static get ForceFullSceneLoadingForIncremental(){return K.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(mm){K.d.ForceFullSceneLoadingForIncremental=mm}static get ShowLoadingScreen(){return K.d.ShowLoadingScreen}static set ShowLoadingScreen(mm){K.d.ShowLoadingScreen=mm}static get loggingLevel(){return K.d.loggingLevel}static set loggingLevel(mm){K.d.loggingLevel=mm}static get CleanBoneMatrixWeights(){return K.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(mm){K.d.CleanBoneMatrixWeights=mm}static GetDefaultPlugin(){return t()}static GetPluginForExtension(mm){var o;return null===(o=Q(mm,!0))||void 0===o?void 0:o.plugin}static IsPluginForExtensionAvailable(mm){return function(mm){return!!M[mm]}(mm)}static RegisterPlugin(mm){S(mm)}static ImportMesh(mm,o,u,f,B,O,r,p,K){P(mm,o,u,f,B,O,r,p,K).catch((mm=>null===r||void 0===r?void 0:r(w.d.LastCreatedScene,null===mm||void 0===mm?void 0:mm.message,mm)))}static async ImportMeshAsync(mm,o,u,f,B,O,r){return await R(mm,o,u,f,B,O,r)}static Load(mm,o,u,f,B,O,r,p){g(mm,o,u,f,B,O,r,p).catch((mm=>null===O||void 0===O?void 0:O(w.d.LastCreatedScene,null===mm||void 0===mm?void 0:mm.message,mm)))}static async LoadAsync(mm,o,u,f,B,O){return await W(mm,o,u,f,B,O)}static Append(mm,o,u,f,B,O,r,p){F(mm,o,u,f,B,O,r,p).catch((mm=>null===O||void 0===O?void 0:O(u??w.d.LastCreatedScene,null===mm||void 0===mm?void 0:mm.message,mm)))}static async AppendAsync(mm,o,u,f,B,O){return await c(mm,o,u,f,B,O)}static LoadAssetContainer(mm,o,u,f,B,O,r,p){A(mm,o,u,f,B,O,r,p).catch((mm=>null===O||void 0===O?void 0:O(u??w.d.LastCreatedScene,null===mm||void 0===mm?void 0:mm.message,mm)))}static async LoadAssetContainerAsync(mm,o,u,f,B,O){return await y(mm,o,u,f,B,O)}static ImportAnimations(mm,o,u,f,B,O,r,p,K,z,Y){I(mm,o,u,f,B,O,r,p,K,z,Y).catch((mm=>null===K||void 0===K?void 0:K(u??w.d.LastCreatedScene,null===mm||void 0===mm?void 0:mm.message,mm)))}static async ImportAnimationsAsync(mm,o,u,f,B,O,r,w,p,K,z){return await s(mm,o,u,f,B,O,w,K,z)}}j.NO_LOGGING=0,j.MINIMAL_LOGGING=1,j.SUMMARY_LOGGING=2,j.DETAILED_LOGGING=3,j.OnPluginActivatedObservable=E},14232:(mm,o,u)=>{"use strict";u.d(o,{e:()=>q});var f=u(12729),B=u(12732),O=u(12549),r=u(12740),w=u(12760),p=u(12727),K=u(12702),z=u(12556),Y=u(12766);u(14234);class q extends w.c{set boundingBoxSize(mm){if(this._boundingBoxSize&&this._boundingBoxSize.equals(mm))return;this._boundingBoxSize=mm;const o=this.Pm();o&&o.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(mm){this._rotationY=mm,this.setReflectionTextureMatrix(r.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(mm,o,u){let f="";for(const B of mm)f+=B;return new q(f,o,null,u,mm)}static CreateFromPrefilteredData(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const B=o.useDelayedTextureLoading;o.useDelayedTextureLoading=!1;const O=new q(mm,o,null,!1,null,null,null,void 0,!0,u,f);return o.useDelayedTextureLoading=B,O}constructor(mm,o){var u;let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,H=arguments.length>10&&void 0!==arguments[10]&&arguments[10],E=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,M=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,l=arguments.length>13?arguments[13]:void 0,t=arguments.length>14?arguments[14]:void 0;super(o),this.onLoadObservable=new z.d,this.boundingBoxPosition=r.lo.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new r.Matrix,this._buffer=null,this.name=mm,this.url=mm,this._noMipmap=B,this.Uf=!1,this.isCube=!0,this._textureMatrix=r.Matrix.Identity(),this.coordinatesMode=p.b.CUBIC_MODE;let Q=null,b=null;null===f||Array.isArray(f)?(this._noMipmap=B,this._format=Y,this._createPolynomials=H,Q=f,this._loaderOptions=l,this._useSRGBBuffer=t,this._lodScale=E,this._lodOffset=M):(Q=f.extensions??null,this._noMipmap=f.noMipmap??!1,O=f.files??null,b=f.buffer??null,this._format=f.format??5,q=f.prefiltered??!1,x=f.forcedExtension??null,this._createPolynomials=f.createPolynomials??!1,this._lodScale=f.lodScale??.8,this._lodOffset=f.lodOffset??0,this._loaderOptions=f.loaderOptions,this._useSRGBBuffer=f.useSRGBBuffer,w=f.T??null,K=f.onError??null),(mm||O)&&this.updateURL(mm,x,w,q,K,Q,null===(u=this.Pm())||void 0===u?void 0:u.useDelayedTextureLoading,O,b)}getClassName(){return"CubeTexture"}updateURL(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=mm),this.url=mm,o&&(this._forcedExtension=o);const K=mm.lastIndexOf("."),z=o||(K>-1?mm.substring(K).toLowerCase():""),Y=0===z.indexOf(".dds"),q=0===z.indexOf(".env"),x=0===z.indexOf(".basis");if(q?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=f,f&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),w)this._files=w;else if(x||q||Y||O||(O=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,O){for(let o=0;o<O.length;o++)this._files.push(mm+O[o]);this._extensions=O}this._buffer=p,r?(this.delayLoadState=4,this._delayedOnLoad=u,this._delayedOnError=B):this._loadTexture(u,B)}delayLoad(mm){4===this.delayLoadState&&(mm&&(this._forcedExtension=mm),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(mm){var o,u;if(mm.updateFlag===this._textureMatrix.updateFlag)return;mm.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(u=this.Pm())||void 0===u||u.markAllMaterialsAsDirty(1,(mm=>-1!==mm.getActiveTextures().indexOf(this))));if(this._textureMatrix=mm,null===(o=this.Pm())||void 0===o||!o.useRightHandedSystem)return;const f=r.TmpVectors.lo[0],B=r.TmpVectors.Quaternion[0],O=r.TmpVectors.lo[1];this._textureMatrix.decompose(f,B,O),B.z*=-1,B.w*=-1,r.Matrix.ComposeToRef(f,B,O,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var mm;return null!==(mm=this.Pm())&&void 0!==mm&&mm.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const u=this.Pm(),f=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const B=()=>{var o;(this.onLoadObservable.notifyObservers(this),f)&&(f.dispose(),null===(o=this.Pm())||void 0===o||o.markAllMaterialsAsDirty(1));mm&&mm()},r=(mm,u)=>{this._loadingError=!0,this._errorObject={message:mm,exception:u},o&&o(mm,u),p.b.OnTextureLoadErrorObservable.notifyObservers(this)};var w;this._texture?this._texture.isReady?O.Tools.SetImmediate((()=>B())):this._texture.onLoadedObservable.add((()=>B())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,u,this._lodScale,this._lodOffset,mm,r,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,u,this._files,this._noMipmap,mm,r,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(w=this._texture)||void 0===w||w.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(mm,o,u){const f=Y.c.Parse((()=>{let f=!1;return mm.prefiltered&&(f=mm.prefiltered),new q(u+(mm.url??mm.name),o,mm.extensions,!1,mm.files||null,null,null,void 0,f,mm.forcedExtension)}),mm,o);if(mm.boundingBoxPosition&&(f.boundingBoxPosition=r.lo.So(mm.boundingBoxPosition)),mm.boundingBoxSize&&(f.boundingBoxSize=r.lo.So(mm.boundingBoxSize)),mm.animations)for(let B=0;B<mm.animations.length;B++){const o=mm.animations[B],u=(0,K.b)("BABYLON.Animation");u&&f.animations.push(u.Parse(o))}return f}clone(){let mm=0;const o=Y.c.Clone((()=>{const o=new q(this.url,this.Pm()||this._getEngine(),this._extensions,this._noMipmap,this._files);return mm=o.uniqueId,o}),this);return o.uniqueId=mm,o}}(0,f.d)([(0,B.J)()],q.prototype,"url",void 0),(0,f.d)([(0,B.F)()],q.prototype,"boundingBoxPosition",void 0),(0,f.d)([(0,B.F)()],q.prototype,"boundingBoxSize",null),(0,f.d)([(0,B.J)("rotationY")],q.prototype,"rotationY",null),(0,f.d)([(0,B.J)("files")],q.prototype,"_files",void 0),(0,f.d)([(0,B.J)("forcedExtension")],q.prototype,"_forcedExtension",void 0),(0,f.d)([(0,B.J)("extensions")],q.prototype,"_extensions",void 0),(0,f.d)([(0,B.t)("textureMatrix")],q.prototype,"_textureMatrix",void 0),(0,f.d)([(0,B.t)("textureMatrixRefraction")],q.prototype,"_textureMatrixRefraction",void 0),p.b._CubeTextureParser=q.Parse,(0,K.c)("BABYLON.CubeTexture",q)},14801:(mm,o,u)=>{"use strict";u.d(o,{c:()=>p});var f=u(12565),B=u(12727),O=u(12718),r=u(12865),w=u(12675);r.ThinEngine.prototype.createDynamicTexture=function(mm,o,u,f){const B=new w.e(this,4);return B.baseWidth=mm,B.baseHeight=o,u&&(mm=this.needPOTTextures?(0,O.e)(mm,this._caps.maxTextureSize):mm,o=this.needPOTTextures?(0,O.e)(o,this._caps.maxTextureSize):o),B.width=mm,B.height=o,B.isReady=!1,B.generateMipMaps=u,B.samplingMode=f,this.updateTextureSamplingMode(f,B),this._internalTexturesCache.push(B),B},r.ThinEngine.prototype.updateDynamicTexture=function(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!mm)return;const r=this._gl,w=r.TEXTURE_2D,p=this._bindTextureDirectly(w,mm,!0,O);this._unpackFlipY(void 0===u?mm.invertY:u),f&&r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const K=this._getWebGLTextureType(mm.type),z=this._getInternalFormat(B||mm.format),Y=this._getRGBABufferInternalSizedFormat(mm.type,z);r.texImage2D(w,0,Y,z,K,o),mm.generateMipMaps&&r.generateMipmap(w),p||this._bindTextureDirectly(w,null),f&&r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),B&&(mm.format=B),mm._dynamicTextureSource=o,mm._premulAlpha=f,mm.invertY=u||!1,mm.isReady=!0};class p extends B.b{constructor(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,w=arguments.length>6?arguments[6]:void 0;const p=!u||u._isScene;super(null,p?u:null===u||void 0===u?void 0:u.bo,p?!f:u,w,O,void 0,void 0,void 0,void 0,r),this.name=mm,this.wrapU=B.b.CLAMP_ADDRESSMODE,this.wrapV=B.b.CLAMP_ADDRESSMODE,this._generateMipMaps=f;const K=this._getEngine();if(!K)return;if(o.getContext)this._canvas=o,this._ownCanvas=!1,this._texture=K.createDynamicTexture(this._canvas.width,this._canvas.height,f,O);else{this._canvas=K.createCanvas(1,1),this._ownCanvas=!0;const mm=o;mm.width||0===mm.width?this._texture=K.createDynamicTexture(mm.width,mm.height,f,O):this._texture=K.createDynamicTexture(o,o,f,O)}const z=this.getSize();this._canvas.width!==z.width&&(this._canvas.width=z.width),this._canvas.height!==z.height&&(this._canvas.height=z.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(mm){this._canvas.width=mm.width,this._canvas.height=mm.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(mm.width,mm.height,this._generateMipMaps,this.samplingMode)}scale(mm){const o=this.getSize();o.width*=mm,o.height*=mm,this._recreate(o)}scaleTo(mm,o){const u=this.getSize();u.width=mm,u.height=o,this._recreate(u)}getContext(){return this._context}clear(mm){const o=this.getSize();mm&&(this._context.fillStyle=mm),this._context.clearRect(0,0,o.width,o.height)}update(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===mm||mm,o,this._format||void 0,void 0,u)}drawText(mm,o,u,f,B,O,r){let w=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const p=this.getSize();if(O&&(this._context.fillStyle=O,this._context.fillRect(0,0,p.width,p.height)),this._context.font=f,null===o||void 0===o){const u=this._context.measureText(mm);o=(p.width-u.width)/2}if(null===u||void 0===u){const mm=parseInt(f.replace(/\D/g,""));u=p.height/2+mm/3.65}this._context.fillStyle=B||"",this._context.fillText(mm,o,u),w&&this.update(r)}dispose(){var mm,o;(super.dispose(),this._ownCanvas)&&(null===(mm=this._canvas)||void 0===mm||null===(o=mm.remove)||void 0===o||o.call(mm));this._canvas=null,this._context=null}clone(){const mm=this.Pm();if(!mm)return this;const o=this.getSize(),u=new p(this.name,o,mm,this._generateMipMaps);return u.Uf=this.Uf,u.level=this.level,u.wrapU=this.wrapU,u.wrapV=this.wrapV,u}serialize(){const mm=this.Pm();mm&&!mm.isReady()&&f.e.Warn("The scene must be ready before serializing the dynamic texture");const o=super.serialize();return p._IsCanvasElement(this._canvas)&&(o.base64String=this._canvas.toDataURL()),o.invertY=this._invertY,o.samplingMode=this.samplingMode,o}static _IsCanvasElement(mm){return void 0!==mm.toDataURL}_rebuild(){this.update()}}},14138:(mm,o,u)=>{"use strict";u.d(o,{e:()=>B});var f=u(12727);class B extends f.b{get depth(){return this._depth}constructor(mm,o,u,B,O,r){let w=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],p=arguments.length>7&&void 0!==arguments[7]&&arguments[7],K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:f.b.TRILINEAR_SAMPLINGMODE,z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Y=arguments.length>10?arguments[10]:void 0;super(null,r,!w,p),this.format=O,this._texture=r.getEngine().createRawTexture2DArray(mm,o,u,B,O,w,p,K,null,z,Y),this._depth=B,this.is2DArray=!0}update(mm){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,mm,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(mm,o,u,f,O){return new B(mm,o,u,f,5,O,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13948:(mm,o,u)=>{"use strict";u.d(o,{d:()=>w,e:()=>p,i:()=>O,k:()=>r});var f=u(12752),B=u(12740);function O(mm,o){return`{X: ${mm.x.toFixed(o)} Y: ${mm.y.toFixed(o)}}`}function r(mm,o){return`{X: ${mm._x.toFixed(o)} Y: ${mm._y.toFixed(o)} Z: ${mm._z.toFixed(o)}}`}function w(mm,o){return 2*Math.acos((0,f.Clamp)(B.Quaternion.Dot(mm,o)))}function p(mm,o){const u=new B.Quaternion;return function(mm,o,u){const O=B.lo.Cross(mm,o),r=Math.acos((0,f.Clamp)(B.lo.Dot(mm,o),-1,1));B.Quaternion.RotationAxisToRef(O,r,u)}(mm,o,u),u}},13786:(mm,o,u)=>{"use strict";u.d(o,{d:()=>K});var f=u(12740),B=u(12780),O=u(13166),r=u(13151),w=u(12791);u(13788);function p(mm){let o=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const u=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],O=[];let p=[];const K=mm.width||mm.size||1,z=mm.height||mm.size||1,Y=mm.depth||mm.size||1,q=mm.wrap||!1;let x=void 0===mm.topBaseAt?1:mm.topBaseAt,H=void 0===mm.bottomBaseAt?0:mm.bottomBaseAt;x=(x+4)%4,H=(H+4)%4;let E=[2,0,3,1][x],M=[2,0,1,3][H],l=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(q){o=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],l=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let mm=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],u=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const f=[17,18,19,16],B=[22,23,20,21];for(;E>0;)mm.unshift(mm.pop()),f.unshift(f.pop()),E--;for(;M>0;)u.unshift(u.pop()),B.unshift(B.pop()),M--;mm=mm.flat(),u=u.flat(),l=l.concat(mm).concat(u),o.push(f[0],f[2],f[3],f[0],f[1],f[2]),o.push(B[0],B[2],B[3],B[0],B[1],B[2])}const t=[K/2,z/2,Y/2];p=l.reduce(((mm,o,u)=>mm.concat(o*t[u%3])),[]);const Q=0===mm.sideOrientation?0:mm.sideOrientation||r.b.DEFAULTSIDE,b=mm.faceUV||new Array(6),J=mm.faceColors,N=[];for(let r=0;r<6;r++)void 0===b[r]&&(b[r]=new f.Vector4(0,0,1,1)),J&&void 0===J[r]&&(J[r]=new B.pp(1,1,1,1));for(let f=0;f<6;f++)if(O.push(b[f].z,w.d?1-b[f].w:b[f].w),O.push(b[f].x,w.d?1-b[f].w:b[f].w),O.push(b[f].x,w.d?1-b[f].y:b[f].y),O.push(b[f].z,w.d?1-b[f].y:b[f].y),J)for(let mm=0;mm<4;mm++)N.push(J[f].r,J[f].g,J[f].b,J[f].a);r.b._ComputeSides(Q,p,o,u,O,mm.frontUVs,mm.backUVs);const S=new r.b;if(S.indices=o,S.gm=p,S.Wm=u,S.Am=O,J){const mm=Q===r.b.DOUBLESIDE?N.concat(N):N;S.Fm=mm}return S}function K(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new O.d(mm,u);o.sideOrientation=O.d._GetDefaultSideOrientation(o.sideOrientation),f._originalBuilderSideOrientation=o.sideOrientation;return p(o).Im(f,o.updatable),f}r.b.CreateBox=p,O.d.CreateBox=function(mm,o){return K(mm,{size:o,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13939:(mm,o,u)=>{"use strict";u.d(o,{e:()=>w});var f=u(13166),B=u(13151),O=u(12791);function r(mm){const o=[],u=[],f=[],r=[],w=mm.radius||.5,p=mm.tessellation||64,K=mm.arc&&(mm.arc<=0||mm.arc>1)?1:mm.arc||1,z=0===mm.sideOrientation?0:mm.sideOrientation||B.b.DEFAULTSIDE;o.push(0,0,0),r.push(.5,.5);const Y=2*Math.PI*K,q=1===K?Y/p:Y/(p-1);let x=0;for(let B=0;B<p;B++){const mm=Math.cos(x),u=Math.sin(x),f=(mm+1)/2,B=(1-u)/2;o.push(w*mm,w*u,0),r.push(f,O.d?1-B:B),x+=q}1===K&&(o.push(o[3],o[4],o[5]),r.push(r[2],O.d?1-r[3]:r[3]));const H=o.length/3;for(let B=1;B<H-1;B++)u.push(B+1,0,B);B.b.ComputeNormals(o,u,f),B.b._ComputeSides(z,o,u,f,r,mm.frontUVs,mm.backUVs);const E=new B.b;return E.indices=u,E.gm=o,E.Wm=f,E.Am=r,E}function w(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new f.d(mm,u);o.sideOrientation=f.d._GetDefaultSideOrientation(o.sideOrientation),B._originalBuilderSideOrientation=o.sideOrientation;return r(o).Im(B,o.updatable),B}B.b.CreateDisc=r,f.d.CreateDisc=function(mm,o,u){return w(mm,{radius:o,tessellation:u,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13788:(mm,o,u)=>{"use strict";u.d(o,{f:()=>M,c:()=>t,g:()=>l});var f=u(12740),B=u(12780),O=u(13166),r=u(13151),w=u(12809);O.d._GroundMeshParser=(mm,o)=>p.Parse(mm,o);class p extends O.d{constructor(mm,o){super(mm,o),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=mm,this._subdivisionsY=mm,this.subdivide(mm);const u=this;u.createOrUpdateSubmeshesOctree&&u.createOrUpdateSubmeshesOctree(o)}getHeightAtCoordinates(mm,o){const u=this.getWorldMatrix(),B=f.TmpVectors.Matrix[5];u.invertToRef(B);const O=f.TmpVectors.lo[8];if(f.lo.TransformCoordinatesFromFloatsToRef(mm,0,o,B,O),mm=O.x,o=O.z,mm<this._minX||mm>=this._maxX||o<=this._minZ||o>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const r=this._getFacetAt(mm,o),w=-(r.x*mm+r.z*o+r.w)/r.y;return f.lo.TransformCoordinatesFromFloatsToRef(0,w,0,u,O),O.y}getNormalAtCoordinates(mm,o){const u=new f.lo(0,1,0);return this.getNormalAtCoordinatesToRef(mm,o,u),u}getNormalAtCoordinatesToRef(mm,o,u){const B=this.getWorldMatrix(),O=f.TmpVectors.Matrix[5];B.invertToRef(O);const r=f.TmpVectors.lo[8];if(f.lo.TransformCoordinatesFromFloatsToRef(mm,0,o,O,r),mm=r.x,o=r.z,mm<this._minX||mm>this._maxX||o<this._minZ||o>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const w=this._getFacetAt(mm,o);return f.lo.TransformNormalFromFloatsToRef(w.x,w.y,w.z,B,u),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(mm,o){const u=Math.floor((mm+this._maxX)*this._subdivisionsX/this._width),f=Math.floor(-(o+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),B=this._heightQuads[f*this._subdivisionsX+u];let O;return O=o<B.slope.x*mm+B.slope.y?B.facet1:B.facet2,O}_initHeightQuads(){const mm=this._subdivisionsX,o=this._subdivisionsY;this._heightQuads=[];for(let u=0;u<o;u++)for(let o=0;o<mm;o++){const B={slope:f.Vector2.Zero(),facet1:new f.Vector4(0,0,0,0),facet2:new f.Vector4(0,0,0,0)};this._heightQuads[u*mm+o]=B}return this}_computeHeightQuads(){const mm=this.getVerticesData(w.f.PositionKind);if(!mm)return this;const o=f.TmpVectors.lo[3],u=f.TmpVectors.lo[2],B=f.TmpVectors.lo[1],O=f.TmpVectors.lo[0],r=f.TmpVectors.lo[4],p=f.TmpVectors.lo[5],K=f.TmpVectors.lo[6],z=f.TmpVectors.lo[7],Y=f.TmpVectors.lo[8];let q=0,x=0,H=0,E=0,M=0,l=0,t=0;const Q=this._subdivisionsX,b=this._subdivisionsY;for(let w=0;w<b;w++)for(let b=0;b<Q;b++){q=3*b,x=w*(Q+1)*3,H=(w+1)*(Q+1)*3,o.x=mm[x+q],o.y=mm[x+q+1],o.z=mm[x+q+2],u.x=mm[x+q+3],u.y=mm[x+q+4],u.z=mm[x+q+5],B.x=mm[H+q],B.y=mm[H+q+1],B.z=mm[H+q+2],O.x=mm[H+q+3],O.y=mm[H+q+4],O.z=mm[H+q+5],E=(O.z-o.z)/(O.x-o.x),M=o.z-E*o.x,u.subtractToRef(o,r),B.subtractToRef(o,p),O.subtractToRef(o,K),f.lo.CrossToRef(K,p,z),f.lo.CrossToRef(r,K,Y),z.normalize(),Y.normalize(),l=-(z.x*o.x+z.y*o.y+z.z*o.z),t=-(Y.x*u.x+Y.y*u.y+Y.z*u.z);const J=this._heightQuads[w*Q+b];J.slope.Op(E,M),J.facet1.Op(z.x,z.y,z.z,l),J.facet2.Op(Y.x,Y.y,Y.z,t)}return this}serialize(mm){super.serialize(mm),mm.subdivisionsX=this._subdivisionsX,mm.subdivisionsY=this._subdivisionsY,mm.minX=this._minX,mm.maxX=this._maxX,mm.hf=this._minZ,mm.maxZ=this._maxZ,mm.width=this._width,mm.height=this._height}static Parse(mm,o){const u=new p(mm.name,o);return u._subdivisionsX=mm.subdivisionsX||1,u._subdivisionsY=mm.subdivisionsY||1,u._minX=mm.minX,u._maxX=mm.maxX,u._minZ=mm.hf,u._maxZ=mm.maxZ,u._width=mm.width,u._height=mm.height,u}}var K=u(12549),z=u(12596),Y=u(12746),q=u(12791);function x(mm){const o=[],u=[],B=[],O=[];let w,p;const K=mm.width||mm.size||1,z=mm.height||mm.size||1,Y=0|(mm.subdivisionsX||mm.subdivisions||1),x=0|(mm.subdivisionsY||mm.subdivisions||1);for(w=0;w<=x;w++)for(p=0;p<=Y;p++){const mm=new f.lo(p*K/Y-K/2,0,(x-w)*z/x-z/2),o=new f.lo(0,1,0);u.push(mm.x,mm.y,mm.z),B.push(o.x,o.y,o.z),O.push(p/Y,q.d?w/x:1-w/x)}for(w=0;w<x;w++)for(p=0;p<Y;p++)o.push(p+1+(w+1)*(Y+1)),o.push(p+1+w*(Y+1)),o.push(p+w*(Y+1)),o.push(p+(w+1)*(Y+1)),o.push(p+1+(w+1)*(Y+1)),o.push(p+w*(Y+1));const H=new r.b;return H.indices=o,H.gm=u,H.Wm=B,H.Am=O,H}function H(mm){const o=void 0!==mm.xmin&&null!==mm.xmin?mm.xmin:-1,u=void 0!==mm.zmin&&null!==mm.zmin?mm.zmin:-1,B=void 0!==mm.xmax&&null!==mm.xmax?mm.xmax:1,O=void 0!==mm.zmax&&null!==mm.zmax?mm.zmax:1,w=mm.subdivisions||{w:1,h:1},p=mm.precision||{w:1,h:1},K=[],z=[],Y=[],q=[];let x,H,E,M;w.h=w.h<1?1:w.h,w.w=w.w<1?1:w.w,p.w=p.w<1?1:p.w,p.h=p.h<1?1:p.h;const l=(B-o)/w.w,t=(O-u)/w.h;function Q(mm,o,u,B){const O=z.length/3,r=p.w+1;for(x=0;x<p.h;x++)for(H=0;H<p.w;H++){const mm=[O+H+x*r,O+(H+1)+x*r,O+(H+1)+(x+1)*r,O+H+(x+1)*r];K.push(mm[1]),K.push(mm[2]),K.push(mm[3]),K.push(mm[0]),K.push(mm[1]),K.push(mm[3])}const w=f.lo.Zero(),E=new f.lo(0,1,0);for(x=0;x<=p.h;x++)for(w.z=x*(B-o)/p.h+o,H=0;H<=p.w;H++)w.x=H*(u-mm)/p.w+mm,w.y=0,z.push(w.x,w.y,w.z),Y.push(E.x,E.y,E.z),q.push(H/p.w,x/p.h)}for(E=0;E<w.h;E++)for(M=0;M<w.w;M++)Q(o+M*l,u+E*t,o+(M+1)*l,u+(E+1)*t);const b=new r.b;return b.indices=K,b.gm=z,b.Wm=Y,b.Am=q,b}function E(mm){const o=[],u=[],O=[],w=[];let p,K;const z=mm.colorFilter||new B.No(.3,.59,.11),q=mm.alphaFilter||0;let x=!1;if(mm.minHeight>mm.maxHeight){x=!0;const o=mm.maxHeight;mm.maxHeight=mm.minHeight,mm.minHeight=o}for(p=0;p<=mm.subdivisions;p++)for(K=0;K<=mm.subdivisions;K++){const o=new f.lo(K*mm.width/mm.subdivisions-mm.width/2,0,(mm.subdivisions-p)*mm.height/mm.subdivisions-mm.height/2),B=4*(((o.x+mm.width/2)/mm.width*(mm.bufferWidth-1)|0)+((1-(o.z+mm.height/2)/mm.height)*(mm.bufferHeight-1)|0)*mm.bufferWidth);let r=mm.buffer[B]/255,H=mm.buffer[B+1]/255,E=mm.buffer[B+2]/255;const M=mm.buffer[B+3]/255;x&&(r=1-r,H=1-H,E=1-E);const l=r*z.r+H*z.g+E*z.b;o.y=M>=q?mm.minHeight+(mm.maxHeight-mm.minHeight)*l:mm.minHeight-Y.e,mm.heightBuffer&&(mm.heightBuffer[p*(mm.subdivisions+1)+K]=o.y),u.push(o.x,o.y,o.z),O.push(0,0,0),w.push(K/mm.subdivisions,1-p/mm.subdivisions)}for(p=0;p<mm.subdivisions;p++)for(K=0;K<mm.subdivisions;K++){const f=K+1+(p+1)*(mm.subdivisions+1),B=K+1+p*(mm.subdivisions+1),O=K+p*(mm.subdivisions+1),r=K+(p+1)*(mm.subdivisions+1),w=u[3*f+1]>=mm.minHeight,z=u[3*B+1]>=mm.minHeight,Y=u[3*O+1]>=mm.minHeight;w&&z&&Y&&(o.push(f),o.push(B),o.push(O));u[3*r+1]>=mm.minHeight&&w&&Y&&(o.push(r),o.push(f),o.push(O))}r.b.ComputeNormals(u,o,O);const H=new r.b;return H.indices=o,H.gm=u,H.Wm=O,H.Am=w,H}function M(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const u=new p(mm,arguments.length>2?arguments[2]:void 0);u._setReady(!1),u._subdivisionsX=o.subdivisionsX||o.subdivisions||1,u._subdivisionsY=o.subdivisionsY||o.subdivisions||1,u._width=o.width||1,u._height=o.height||1,u._maxX=u._width/2,u._maxZ=u._height/2,u._minX=-u._maxX,u._minZ=-u._maxZ;return x(o).Im(u,o.updatable),u._setReady(!0),u}function l(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new O.d(mm,u);return H(o).Im(f,o.updatable),f}function t(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const O=u.width||10,r=u.height||10,w=u.subdivisions||1,Y=u.minHeight||0,q=u.maxHeight||1,x=u.colorFilter||new B.No(.3,.59,.11),H=u.alphaFilter||0,M=u.updatable,l=u.onReady;f=f||z.d.LastCreatedScene;const t=new p(mm,f);let Q;t._subdivisionsX=w,t._subdivisionsY=w,t._width=O,t._height=r,t._maxX=t._width/2,t._maxZ=t._height/2,t._minX=-t._maxX,t._minZ=-t._maxZ,t._setReady(!1),u.passHeightBufferInCallback&&(Q=new Float32Array((w+1)*(w+1)));const b=(mm,o,u)=>{E({width:O,height:r,subdivisions:w,minHeight:Y,maxHeight:q,colorFilter:x,buffer:mm,bufferWidth:o,bufferHeight:u,alphaFilter:H,heightBuffer:Q}).Im(t,M),l&&l(t,Q),t._setReady(!0)};if("string"===typeof o){const mm=mm=>{var o;const u=mm.width,B=mm.height;if(f.q)return;const O=null===(o=f)||void 0===o?void 0:o.getEngine().resizeImageBitmap(mm,u,B);b(O,u,B)};K.Tools.LoadImage(o,mm,u.onError?u.onError:()=>{},f.offlineProvider)}else b(o.data,o.width,o.height);return t}r.b.CreateGround=x,r.b.CreateTiledGround=H,r.b.CreateGroundFromHeightMap=E,O.d.CreateGround=(mm,o,u,f,B,O)=>M(mm,{width:o,height:u,subdivisions:f,updatable:O},B),O.d.CreateTiledGround=(mm,o,u,f,B,O,r,w,p)=>l(mm,{xmin:o,zmin:u,xmax:f,zmax:B,subdivisions:O,precision:r,updatable:p},w),O.d.CreateGroundFromHeightMap=(mm,o,u,f,B,O,r,w,p,K,z)=>t(mm,o,{width:u,height:f,subdivisions:B,minHeight:O,maxHeight:r,updatable:p,onReady:K,alphaFilter:z},w)},14360:(mm,o,u)=>{"use strict";u.d(o,{e:()=>x,i:()=>Y,l:()=>q});var f=u(12740),B=u(13166),O=u(13151),r=u(13260),w=u(12809),p=u(12565);function K(mm){const o=[],u=[],f=mm.lines,B=mm.Fm,r=[];let w=0;for(let O=0;O<f.length;O++){const mm=f[O];for(let f=0;f<mm.length;f++){const{x:p,y:K,z:z}=mm[f];if(u.push(p,K,z),B){const mm=B[O],{r:o,g:u,b:w,a:p}=mm[f];r.push(o,u,w,p)}f>0&&(o.push(w-1),o.push(w)),w++}}const p=new O.b;return p.indices=o,p.gm=u,B&&(p.Fm=r),p}function z(mm){const o=mm.dashSize||3,u=mm.gapSize||1,B=mm.dashNb||200,r=mm.points,w=[],p=[],K=f.lo.Zero();let z=0,Y=0,q=0,x=0,H=0,E=0,M=0;for(M=0;M<r.length-1;M++)r[M+1].subtractToRef(r[M],K),z+=K.length();for(q=z/B,x=o*q/(o+u),M=0;M<r.length-1;M++){r[M+1].subtractToRef(r[M],K),Y=Math.floor(K.length()/q),K.normalize();for(let mm=0;mm<Y;mm++)H=q*mm,w.push(r[M].x+H*K.x,r[M].y+H*K.y,r[M].z+H*K.z),w.push(r[M].x+(H+x)*K.x,r[M].y+(H+x)*K.y,r[M].z+(H+x)*K.z),p.push(E,E+1),E+=2}const l=new O.b;return l.gm=w,l.indices=p,l}function Y(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=o.instance,B=o.lines,O=o.Fm;if(f){const mm=f.getVerticesData(w.f.PositionKind);let o,u;O&&(o=f.getVerticesData(w.f.ColorKind));let r=0,p=0;for(let f=0;f<B.length;f++){const w=B[f];for(let B=0;B<w.length;B++)mm[r]=w[B].x,mm[r+1]=w[B].y,mm[r+2]=w[B].z,O&&o&&(u=O[f],o[p]=u[B].r,o[p+1]=u[B].g,o[p+2]=u[B].b,o[p+3]=u[B].a,p+=4),r+=3}return f.updateVerticesData(w.f.PositionKind,mm,!1,!1),O&&o&&f.updateVerticesData(w.f.ColorKind,o,!1,!1),f.refreshBoundingInfo(),f}const p=!!O,z=new r.b(mm,u,null,void 0,void 0,p,o.useVertexAlpha,o.material);return K(o).Im(z,o.updatable),z}function q(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=o.Fm?[o.Fm]:null;return Y(mm,{lines:[o.points],updatable:o.updatable,instance:o.instance,Fm:f,useVertexAlpha:o.useVertexAlpha,material:o.material},u)}function x(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=o.points,w=o.instance,K=o.gapSize||1,Y=o.dashSize||3;if(w){const mm=mm=>{const o=f.lo.Zero(),u=mm.length/6;let B=0,r=0,p=0,K=0,z=0,Y=0,q=0,x=0;for(q=0;q<O.length-1;q++)O[q+1].subtractToRef(O[q],o),B+=o.length();p=B/u;const H=w._creationDataStorage.dashSize;for(K=H*p/(H+w._creationDataStorage.gapSize),q=0;q<O.length-1;q++)for(O[q+1].subtractToRef(O[q],o),r=Math.floor(o.length()/p),o.normalize(),x=0;x<r&&Y<mm.length;)z=p*x,mm[Y]=O[q].x+z*o.x,mm[Y+1]=O[q].y+z*o.y,mm[Y+2]=O[q].z+z*o.z,mm[Y+3]=O[q].x+(z+K)*o.x,mm[Y+4]=O[q].y+(z+K)*o.y,mm[Y+5]=O[q].z+(z+K)*o.z,Y+=6,x++;for(;Y<mm.length;)mm[Y]=O[q].x,mm[Y+1]=O[q].y,mm[Y+2]=O[q].z,Y+=3};return(o.dashNb||o.dashSize||o.gapSize||o.useVertexAlpha||o.material)&&p.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),w.updateMeshPositions(mm,!1),w}const q=new r.b(mm,u,null,void 0,void 0,void 0,o.useVertexAlpha,o.material);return z(o).Im(q,o.updatable),q._creationDataStorage=new B.g,q._creationDataStorage.dashSize=Y,q._creationDataStorage.gapSize=K,q}O.b.CreateLineSystem=K,O.b.CreateDashedLines=z,B.d.Bz=function(mm,o){return q(mm,{points:o,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},B.d.CreateDashedLines=function(mm,o,u,f,B){return x(mm,{points:o,dashSize:u,gapSize:f,dashNb:B,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13837:(mm,o,u)=>{"use strict";u.d(o,{b:()=>w,e:()=>p});var f=u(13166),B=u(13151),O=u(12791);function r(mm){const o=[],u=[],f=[],r=[],w=void 0!==mm.width?mm.width:void 0!==mm.size?mm.size:1,p=void 0!==mm.height?mm.height:void 0!==mm.size?mm.size:1,K=0===mm.sideOrientation?0:mm.sideOrientation||B.b.DEFAULTSIDE,z=w/2,Y=p/2;u.push(-z,-Y,0),f.push(0,0,-1),r.push(0,O.d?1:0),u.push(z,-Y,0),f.push(0,0,-1),r.push(1,O.d?1:0),u.push(z,Y,0),f.push(0,0,-1),r.push(1,O.d?0:1),u.push(-z,Y,0),f.push(0,0,-1),r.push(0,O.d?0:1),o.push(0),o.push(1),o.push(2),o.push(0),o.push(2),o.push(3),B.b._ComputeSides(K,u,o,f,r,mm.frontUVs,mm.backUVs);const q=new B.b;return q.indices=o,q.gm=u,q.Wm=f,q.Am=r,q}function w(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new f.d(mm,u);o.sideOrientation=f.d._GetDefaultSideOrientation(o.sideOrientation),B._originalBuilderSideOrientation=o.sideOrientation;return r(o).Im(B,o.updatable),o.sourcePlane&&(B.translate(o.sourcePlane.normal,-o.sourcePlane.d),B.setDirection(o.sourcePlane.normal.scale(-1))),B}const p={wz:w};B.b.wz=r,f.d.wz=(mm,o,u,f,B)=>w(mm,{size:o,width:o,height:o,sideOrientation:B,updatable:f},u)},13927:(mm,o,u)=>{"use strict";u.d(o,{b:()=>p});var f=u(12740),B=u(13166),O=u(13151),r=u(12791);function w(mm){const o=0|(mm.segments||32),u=mm.diameterX||mm.diameter||1,B=mm.diameterY||mm.diameter||1,w=mm.diameterZ||mm.diameter||1,p=mm.arc&&(mm.arc<=0||mm.arc>1)?1:mm.arc||1,K=mm.slice&&mm.slice<=0?1:mm.slice||1,z=0===mm.sideOrientation?0:mm.sideOrientation||O.b.DEFAULTSIDE,Y=!!mm.dedupTopBottomIndices,q=new f.lo(u/2,B/2,w/2),x=2+o,H=2*x,E=[],M=[],l=[],t=[];for(let O=0;O<=x;O++){const mm=O/x,o=mm*Math.PI*K;for(let u=0;u<=H;u++){const B=u/H,O=B*Math.PI*2*p,w=f.Matrix.RotationZ(-o),K=f.Matrix.RotationY(O),z=f.lo.TransformCoordinates(f.lo.Up(),w),Y=f.lo.TransformCoordinates(z,K),x=Y.multiply(q),E=Y.divide(q).normalize();M.push(x.x,x.y,x.z),l.push(E.x,E.y,E.z),t.push(B,r.d?1-mm:mm)}if(O>0){const mm=M.length/3;for(let o=mm-2*(H+1);o+H+2<mm;o++)Y?(O>1&&(E.push(o),E.push(o+1),E.push(o+H+1)),(O<x||K<1)&&(E.push(o+H+1),E.push(o+1),E.push(o+H+2))):(E.push(o),E.push(o+1),E.push(o+H+1),E.push(o+H+1),E.push(o+1),E.push(o+H+2))}}O.b._ComputeSides(z,M,E,l,t,mm.frontUVs,mm.backUVs);const Q=new O.b;return Q.indices=E,Q.gm=M,Q.Wm=l,Q.Am=t,Q}function p(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new B.d(mm,u);o.sideOrientation=B.d._GetDefaultSideOrientation(o.sideOrientation),f._originalBuilderSideOrientation=o.sideOrientation;return w(o).Im(f,o.updatable),f}O.b.CreateSphere=w,B.d.CreateSphere=(mm,o,u,f,B,O)=>p(mm,{segments:o,diameterX:u,diameterY:u,diameterZ:u,sideOrientation:O,updatable:B},f)},14813:(mm,o,u)=>{"use strict";u.d(o,{b:()=>w});var f=u(13284),B=u(14237),O=u(13303),r=u(13151);class w{static get Configuration(){return{get decoder(){return B.b.DefaultConfiguration},set decoder(mm){B.b.DefaultConfiguration=mm}}}static set Configuration(mm){B.b.DefaultConfiguration=mm.decoder}static get DecoderAvailable(){return(0,f.k)(B.b.DefaultConfiguration)}static get Default(){return w._Default??(w._Default=new w),w._Default}static ResetDefault(mm){w._Default&&(mm||w._Default.dispose(),w._Default=null)}constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.DefaultNumWorkers;const o="number"===typeof mm?{...B.b.DefaultConfiguration,numWorkers:mm}:{...B.b.DefaultConfiguration,...mm};this._decoder=new B.b(o)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(mm,o,u){return this._decoder.decodeMeshToMeshDataAsync(mm,o,u)}async decodeMeshToGeometryAsync(mm,o,u,f){return await this._decoder.decodeMeshToGeometryAsync(mm,o,u,f)}async _decodeMeshToGeometryForGltfAsync(mm,o,u,f,B,O){return await this._decoder._decodeMeshToGeometryForGltfAsync(mm,o,u,f,B,O)}async decodeMeshAsync(mm,o){const u=await this._decoder.decodeMeshToMeshDataAsync(mm,o),f=new r.b;u.indices&&(f.indices=u.indices);for(const B of u.attributes){const mm=O.c.GetFloatData(B.data,B.size,O.c.GetDataType(B.data),B.byteOffset,B.byteStride,B.normalized,u.totalVertices);f.set(mm,B.kind)}return f}}w.DefaultNumWorkers=(0,f.g)(),w._Default=null},14237:(mm,o,u)=>{"use strict";u.d(o,{b:()=>K});var f=u(13284),B=u(12549),O=u(13178),r=u(13303),w=u(12565),p=u(13295);class K extends f.e{static get DefaultAvailable(){return(0,f.k)(K.DefaultConfiguration)}static get Default(){return K._Default??(K._Default=new K),K._Default}static ResetDefault(mm){K._Default&&(mm||K._Default.dispose(),K._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(mm,o){return{module:await(o||DracoDecoderModule)({wasmBinary:mm})}}_getWorkerContent(){return`${p.c}(${p.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:K.DefaultConfiguration)}decodeMeshToMeshDataAsync(mm,o,u){const f=mm instanceof ArrayBuffer?new Int8Array(mm):new Int8Array(mm.buffer,mm.byteOffset,mm.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async mm=>await new Promise(((B,O)=>{mm.push(((mm,r)=>{let p=null;const K=[],z=o=>{mm.removeEventListener("error",z),mm.removeEventListener("message",Y),O(o),r()},Y=o=>{const f=o.data;switch(f.id){case"indices":p=f.data;break;case"attribute":K.push({kind:f.kind,data:f.data,size:f.size,byteOffset:f.byteOffset,byteStride:f.byteStride,normalized:(O=f.kind,q=f.normalized,u&&void 0!==u[O]?(q!==u[O]&&w.e.Warn(`Normalized flag from Draco data (${q}) does not match normalized flag from glTF accessor (${u[O]}). Using flag from glTF accessor.`),u[O]):q)});break;case"decodeMeshDone":mm.removeEventListener("error",z),mm.removeEventListener("message",Y),B({indices:p,attributes:K,totalVertices:f.totalVertices}),r()}var O,q};mm.addEventListener("error",z),mm.addEventListener("message",Y);const q=f.slice();mm.postMessage({id:"decodeMesh",dataView:q,attributes:o},[q.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((mm=>{let u=null;const B=[],O=(0,p.c)(mm.module,f,o,(mm=>{u=mm}),((mm,o,u,f,O,r)=>{B.push({kind:mm,data:o,size:u,byteOffset:f,byteStride:O,normalized:r})}));return{indices:u,attributes:B,totalVertices:O}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(mm,o,u,f){const B=await this.decodeMeshToMeshDataAsync(u,f),w=new O.d(mm,o);B.indices&&w.setIndices(B.indices);for(const O of B.attributes)w.setVerticesBuffer(new r.c(o.getEngine(),O.data,O.kind,!1,void 0,O.byteStride,void 0,O.byteOffset,O.size,void 0,O.normalized,!0),B.totalVertices);return w}async _decodeMeshToGeometryForGltfAsync(mm,o,u,f,B,w){const p=await this.decodeMeshToMeshDataAsync(u,f,B),K=new O.d(mm,o);w&&(K._boundingInfo=w,K.useBoundingInfoFromGeometry=!0),p.indices&&K.setIndices(p.indices);for(const O of p.attributes)K.setVerticesBuffer(new r.c(o.getEngine(),O.data,O.kind,!1,void 0,O.byteStride,void 0,O.byteOffset,O.size,void 0,O.normalized,!0),p.totalVertices);return K}}K.DefaultConfiguration={wasmUrl:`${B.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${B.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${B.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},K._Default=null},14355:(mm,o,u)=>{"use strict";u.d(o,{c:()=>wm});var f=u(12740),B=u(13166),O=u(12809),r=u(13151),w=u(12791);function p(mm){let o=mm.pathArray;const u=mm.closeArray||!1,f=mm.closePath||!1,B=mm.invertUV||!1,p=Math.floor(o[0].length/2);let K=mm.offset||p;K=K>p?p:Math.floor(K);const z=0===mm.sideOrientation?0:mm.sideOrientation||r.b.DEFAULTSIDE,Y=mm.Am,q=mm.Fm,x=[],H=[],E=[],M=[],l=[],t=[],Q=[],b=[];let J;const N=[],S=[];let P,R,g;if(o.length<2){const mm=[],u=[];for(R=0;R<o[0].length-K;R++)mm.push(o[0][R]),u.push(o[0][R+K]);o=[mm,u]}let W=0;const F=f?1:0,c=u?1:0;let A,y,I,s,j,a;for(J=o[0].length,P=0;P<o.length+c;P++){for(Q[P]=0,l[P]=[0],A=P===o.length?o[0]:o[P],y=A.length,J=J<y?J:y,g=0;g<y;)x.push(A[g].x,A[g].y,A[g].z),g>0&&(I=A[g].Qo(A[g-1]).length(),s=I+Q[P],l[P].push(s),Q[P]=s),g++;f&&(g--,x.push(A[0].x,A[0].y,A[0].z),I=A[g].Qo(A[0]).length(),s=I+Q[P],l[P].push(s),Q[P]=s),N[P]=y+F,S[P]=W,W+=y+F}let X,G,k=null,d=null;for(R=0;R<J+F;R++)for(b[R]=0,t[R]=[0],P=0;P<o.length-1+c;P++)j=o[P],a=P===o.length-1?o[0]:o[P+1],R===J?(k=j[0],d=a[0]):(k=j[R],d=a[R]),I=d.Qo(k).length(),s=I+b[R],t[R].push(s),b[R]=s;if(Y)for(P=0;P<Y.length;P++)M.push(Y[P].x,w.d?1-Y[P].y:Y[P].y);else for(P=0;P<o.length+c;P++)for(R=0;R<J+F;R++)X=0!=Q[P]?l[P][R]/Q[P]:0,G=0!=b[R]?t[R][P]/b[R]:0,B?M.push(G,X):M.push(X,w.d?1-G:G);P=0;let e=0,L=N[P]-1,C=N[P+1]-1,v=L<C?L:C,V=S[1]-S[0];const n=N.length-1;for(;e<=v&&P<n;)H.push(e,e+V,e+1),H.push(e+V+1,e+1,e+V),e+=1,e===v&&(P++,V=S[P+1]-S[P],L=N[P]-1,C=N[P+1]-1,e=S[P],v=L<C?L+e:C+e);if(r.b.ComputeNormals(x,H,E),f){let mm=0,u=0;for(P=0;P<o.length;P++){mm=3*S[P],u=P+1<o.length?3*(S[P+1]-1):E.length-3,E[mm]=.5*(E[mm]+E[u]),E[mm+1]=.5*(E[mm+1]+E[u+1]),E[mm+2]=.5*(E[mm+2]+E[u+2]);const f=Math.sqrt(E[mm]*E[mm]+E[mm+1]*E[mm+1]+E[mm+2]*E[mm+2]);E[mm]/=f,E[mm+1]/=f,E[mm+2]/=f,E[u]=E[mm],E[u+1]=E[mm+1],E[u+2]=E[mm+2]}}if(u){let mm=3*S[0],u=3*S[o.length];for(R=0;R<J+F;R++){E[mm]=.5*(E[mm]+E[u]),E[mm+1]=.5*(E[mm+1]+E[u+1]),E[mm+2]=.5*(E[mm+2]+E[u+2]);const o=Math.sqrt(E[mm]*E[mm]+E[mm+1]*E[mm+1]+E[mm+2]*E[mm+2]);E[mm]/=o,E[mm+1]/=o,E[mm+2]/=o,E[u]=E[mm],E[u+1]=E[mm+1],E[u+2]=E[mm+2],mm+=3,u+=3}}r.b._ComputeSides(z,x,H,E,M,mm.frontUVs,mm.backUVs);let U=null;if(q){U=new Float32Array(4*q.length);for(let mm=0;mm<q.length;mm++)U[4*mm]=q[mm].r,U[4*mm+1]=q[mm].g,U[4*mm+2]=q[mm].b,U[4*mm+3]=q[mm].a}const h=new r.b,Z=new Float32Array(x),T=new Float32Array(E),D=new Float32Array(M);return h.indices=H,h.gm=Z,h.Wm=T,h.Am=D,U&&h.set(U,O.f.ColorKind),f&&(h._idx=S),h}function K(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=o.pathArray,z=o.closeArray,Y=o.closePath,q=B.d._GetDefaultSideOrientation(o.sideOrientation),x=o.instance,H=o.updatable;if(x){const mm=f.TmpVectors.lo[0].wp(Number.MAX_VALUE),u=f.TmpVectors.lo[1].wp(-Number.MAX_VALUE),p=o=>{let f=K[0].length;const O=x;let r=0;const w=O._originalBuilderSideOrientation===B.d.DOUBLESIDE?2:1;for(let B=1;B<=w;++B)for(let w=0;w<K.length;++w){const B=K[w],p=B.length;f=f<p?f:p;for(let O=0;O<f;++O){const f=B[O];o[r]=f.x,o[r+1]=f.y,o[r+2]=f.z,mm.minimizeInPlaceFromFloats(f.x,f.y,f.z),u.maximizeInPlaceFromFloats(f.x,f.y,f.z),r+=3}if(O._creationDataStorage&&O._creationDataStorage.closePath){const mm=B[0];o[r]=mm.x,o[r+1]=mm.y,o[r+2]=mm.z,r+=3}}},z=x.getVerticesData(O.f.PositionKind);if(p(z),x.hasBoundingInfo?x.getBoundingInfo().reConstruct(mm,u,x._worldMatrix):x.buildBoundingInfo(mm,u,x._worldMatrix),x.updateVerticesData(O.f.PositionKind,z,!1,!1),o.Fm){const mm=x.getVerticesData(O.f.ColorKind);for(let u=0,f=0;u<o.Fm.length;u++,f+=4){const B=o.Fm[u];mm[f]=B.r,mm[f+1]=B.g,mm[f+2]=B.b,mm[f+3]=B.a}x.updateVerticesData(O.f.ColorKind,mm,!1,!1)}if(o.Am){const mm=x.getVerticesData(O.f.UVKind);for(let u=0;u<o.Am.length;u++)mm[2*u]=o.Am[u].x,mm[2*u+1]=w.d?1-o.Am[u].y:o.Am[u].y;x.updateVerticesData(O.f.UVKind,mm,!1,!1)}if(!x.areNormalsFrozen||x.isFacetDataEnabled){const mm=x.hr(),o=x.getVerticesData(O.f.NormalKind),u=x.isFacetDataEnabled?x.getFacetDataParameters():null;if(r.b.ComputeNormals(z,mm,o,u),x._creationDataStorage&&x._creationDataStorage.closePath){let mm=0,u=0;for(let f=0;f<K.length;f++)mm=3*x._creationDataStorage.idx[f],u=f+1<K.length?3*(x._creationDataStorage.idx[f+1]-1):o.length-3,o[mm]=.5*(o[mm]+o[u]),o[mm+1]=.5*(o[mm+1]+o[u+1]),o[mm+2]=.5*(o[mm+2]+o[u+2]),o[u]=o[mm],o[u+1]=o[mm+1],o[u+2]=o[mm+2]}x.areNormalsFrozen||x.updateVerticesData(O.f.NormalKind,o,!1,!1)}return x}{const f=new B.d(mm,u);f._originalBuilderSideOrientation=q,f._creationDataStorage=new B.g;const O=p(o);return Y&&(f._creationDataStorage.idx=O._idx),f._creationDataStorage.closePath=Y,f._creationDataStorage.closeArray=z,O.Im(f,H),f}}r.b.CreateRibbon=p,B.d.CreateRibbon=function(mm,o){return K(mm,{pathArray:o,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var z=u(13939),Y=u(13786),q=u(12780);function x(mm){const o=mm.pattern||B.d.NO_FLIP,u=mm.tileWidth||mm.tileSize||1,f=mm.tileHeight||mm.tileSize||1,O=mm.alignHorizontal||0,w=mm.alignVertical||0,p=mm.width||mm.size||1,K=Math.floor(p/u);let z=p-K*u;const Y=mm.height||mm.size||1,q=Math.floor(Y/f);let x=Y-q*f;const H=u*K/2,E=f*q/2;let M=0,l=0,t=0,Q=0,b=0,J=0;if(z>0||x>0){switch(t=-H,Q=-E,b=H,J=E,O){case B.d.CENTER:z/=2,t-=z,b+=z;break;case B.d.LEFT:b+=z,M=-z/2;break;case B.d.RIGHT:t-=z,M=z/2}switch(w){case B.d.CENTER:x/=2,Q-=x,J+=x;break;case B.d.BOTTOM:J+=x,l=-x/2;break;case B.d.TOP:Q-=x,l=x/2}}const N=[],S=[],P=[];P[0]=[0,0,1,0,1,1,0,1],P[1]=[0,0,1,0,1,1,0,1],o!==B.d.ROTATE_TILE&&o!==B.d.ROTATE_ROW||(P[1]=[1,1,0,1,0,0,1,0]),o!==B.d.FLIP_TILE&&o!==B.d.FLIP_ROW||(P[1]=[1,0,0,0,0,1,1,1]),o!==B.d.FLIP_N_ROTATE_TILE&&o!==B.d.FLIP_N_ROTATE_ROW||(P[1]=[0,1,1,1,1,0,0,0]);let R=[];const g=[],W=[];let F=0;for(let r=0;r<q;r++)for(let mm=0;mm<K;mm++)N.push(mm*u-H+M,r*f-E+l,0),N.push((mm+1)*u-H+M,r*f-E+l,0),N.push((mm+1)*u-H+M,(r+1)*f-E+l,0),N.push(mm*u-H+M,(r+1)*f-E+l,0),W.push(F,F+1,F+3,F+1,F+2,F+3),R=o===B.d.FLIP_TILE||o===B.d.ROTATE_TILE||o===B.d.FLIP_N_ROTATE_TILE?R.concat(P[(mm%2+r%2)%2]):o===B.d.FLIP_ROW||o===B.d.ROTATE_ROW||o===B.d.FLIP_N_ROTATE_ROW?R.concat(P[r%2]):R.concat(P[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),F+=4;if(z>0||x>0){const mm=x>0&&(w===B.d.CENTER||w===B.d.TOP),r=x>0&&(w===B.d.CENTER||w===B.d.BOTTOM),p=z>0&&(O===B.d.CENTER||O===B.d.RIGHT),Y=z>0&&(O===B.d.CENTER||O===B.d.LEFT);let P,c,A,y,I=[];if(mm&&p&&(N.push(t+M,Q+l,0),N.push(-H+M,Q+l,0),N.push(-H+M,Q+x+l,0),N.push(t+M,Q+x+l,0),W.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,P=1-z/u,c=1-x/f,A=1,y=1,I=[P,c,A,c,A,y,P,y],o===B.d.ROTATE_ROW&&(I=[1-P,1-c,1-A,1-c,1-A,1-y,1-P,1-y]),o===B.d.FLIP_ROW&&(I=[1-P,c,1-A,c,1-A,y,1-P,y]),o===B.d.FLIP_N_ROTATE_ROW&&(I=[P,1-c,A,1-c,A,1-y,P,1-y]),R=R.concat(I),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),mm&&Y&&(N.push(H+M,Q+l,0),N.push(b+M,Q+l,0),N.push(b+M,Q+x+l,0),N.push(H+M,Q+x+l,0),W.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,P=0,c=1-x/f,A=z/u,y=1,I=[P,c,A,c,A,y,P,y],(o===B.d.ROTATE_ROW||o===B.d.ROTATE_TILE&&K%2===0)&&(I=[1-P,1-c,1-A,1-c,1-A,1-y,1-P,1-y]),(o===B.d.FLIP_ROW||o===B.d.FLIP_TILE&&K%2===0)&&(I=[1-P,c,1-A,c,1-A,y,1-P,y]),(o===B.d.FLIP_N_ROTATE_ROW||o===B.d.FLIP_N_ROTATE_TILE&&K%2===0)&&(I=[P,1-c,A,1-c,A,1-y,P,1-y]),R=R.concat(I),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),r&&p&&(N.push(t+M,E+l,0),N.push(-H+M,E+l,0),N.push(-H+M,J+l,0),N.push(t+M,J+l,0),W.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,P=1-z/u,c=0,A=1,y=x/f,I=[P,c,A,c,A,y,P,y],(o===B.d.ROTATE_ROW&&q%2===1||o===B.d.ROTATE_TILE&&q%1===0)&&(I=[1-P,1-c,1-A,1-c,1-A,1-y,1-P,1-y]),(o===B.d.FLIP_ROW&&q%2===1||o===B.d.FLIP_TILE&&q%2===0)&&(I=[1-P,c,1-A,c,1-A,y,1-P,y]),(o===B.d.FLIP_N_ROTATE_ROW&&q%2===1||o===B.d.FLIP_N_ROTATE_TILE&&q%2===0)&&(I=[P,1-c,A,1-c,A,1-y,P,1-y]),R=R.concat(I),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),r&&Y&&(N.push(H+M,E+l,0),N.push(b+M,E+l,0),N.push(b+M,J+l,0),N.push(H+M,J+l,0),W.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,P=0,c=0,A=z/u,y=x/f,I=[P,c,A,c,A,y,P,y],(o===B.d.ROTATE_ROW&&q%2===1||o===B.d.ROTATE_TILE&&(q+K)%2===1)&&(I=[1-P,1-c,1-A,1-c,1-A,1-y,1-P,1-y]),(o===B.d.FLIP_ROW&&q%2===1||o===B.d.FLIP_TILE&&(q+K)%2===1)&&(I=[1-P,c,1-A,c,1-A,y,1-P,y]),(o===B.d.FLIP_N_ROTATE_ROW&&q%2===1||o===B.d.FLIP_N_ROTATE_TILE&&(q+K)%2===1)&&(I=[P,1-c,A,1-c,A,1-y,P,1-y]),R=R.concat(I),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),mm){const mm=[];P=0,c=1-x/f,A=1,y=1,mm[0]=[P,c,A,c,A,y,P,y],mm[1]=[P,c,A,c,A,y,P,y],o!==B.d.ROTATE_TILE&&o!==B.d.ROTATE_ROW||(mm[1]=[1-P,1-c,1-A,1-c,1-A,1-y,1-P,1-y]),o!==B.d.FLIP_TILE&&o!==B.d.FLIP_ROW||(mm[1]=[1-P,c,1-A,c,1-A,y,1-P,y]),o!==B.d.FLIP_N_ROTATE_TILE&&o!==B.d.FLIP_N_ROTATE_ROW||(mm[1]=[P,1-c,A,1-c,A,1-y,P,1-y]);for(let f=0;f<K;f++)N.push(f*u-H+M,Q+l,0),N.push((f+1)*u-H+M,Q+l,0),N.push((f+1)*u-H+M,Q+x+l,0),N.push(f*u-H+M,Q+x+l,0),W.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,R=o===B.d.FLIP_TILE||o===B.d.ROTATE_TILE||o===B.d.FLIP_N_ROTATE_TILE?R.concat(mm[(f+1)%2]):o===B.d.FLIP_ROW||o===B.d.ROTATE_ROW||o===B.d.FLIP_N_ROTATE_ROW?R.concat(mm[1]):R.concat(mm[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(r){const mm=[];P=0,c=0,A=1,y=x/f,mm[0]=[P,c,A,c,A,y,P,y],mm[1]=[P,c,A,c,A,y,P,y],o!==B.d.ROTATE_TILE&&o!==B.d.ROTATE_ROW||(mm[1]=[1-P,1-c,1-A,1-c,1-A,1-y,1-P,1-y]),o!==B.d.FLIP_TILE&&o!==B.d.FLIP_ROW||(mm[1]=[1-P,c,1-A,c,1-A,y,1-P,y]),o!==B.d.FLIP_N_ROTATE_TILE&&o!==B.d.FLIP_N_ROTATE_ROW||(mm[1]=[P,1-c,A,1-c,A,1-y,P,1-y]);for(let f=0;f<K;f++)N.push(f*u-H+M,J-x+l,0),N.push((f+1)*u-H+M,J-x+l,0),N.push((f+1)*u-H+M,J+l,0),N.push(f*u-H+M,J+l,0),W.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,R=o===B.d.FLIP_TILE||o===B.d.ROTATE_TILE||o===B.d.FLIP_N_ROTATE_TILE?R.concat(mm[(f+q)%2]):o===B.d.FLIP_ROW||o===B.d.ROTATE_ROW||o===B.d.FLIP_N_ROTATE_ROW?R.concat(mm[q%2]):R.concat(mm[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(p){const mm=[];P=1-z/u,c=0,A=1,y=1,mm[0]=[P,c,A,c,A,y,P,y],mm[1]=[P,c,A,c,A,y,P,y],o!==B.d.ROTATE_TILE&&o!==B.d.ROTATE_ROW||(mm[1]=[1-P,1-c,1-A,1-c,1-A,1-y,1-P,1-y]),o!==B.d.FLIP_TILE&&o!==B.d.FLIP_ROW||(mm[1]=[1-P,c,1-A,c,1-A,y,1-P,y]),o!==B.d.FLIP_N_ROTATE_TILE&&o!==B.d.FLIP_N_ROTATE_ROW||(mm[1]=[P,1-c,A,1-c,A,1-y,P,1-y]);for(let u=0;u<q;u++)N.push(t+M,u*f-E+l,0),N.push(t+z+M,u*f-E+l,0),N.push(t+z+M,(u+1)*f-E+l,0),N.push(t+M,(u+1)*f-E+l,0),W.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,R=o===B.d.FLIP_TILE||o===B.d.ROTATE_TILE||o===B.d.FLIP_N_ROTATE_TILE?R.concat(mm[(u+1)%2]):o===B.d.FLIP_ROW||o===B.d.ROTATE_ROW||o===B.d.FLIP_N_ROTATE_ROW?R.concat(mm[u%2]):R.concat(mm[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Y){const mm=[];P=0,c=0,A=z/f,y=1,mm[0]=[P,c,A,c,A,y,P,y],mm[1]=[P,c,A,c,A,y,P,y],o!==B.d.ROTATE_TILE&&o!==B.d.ROTATE_ROW||(mm[1]=[1-P,1-c,1-A,1-c,1-A,1-y,1-P,1-y]),o!==B.d.FLIP_TILE&&o!==B.d.FLIP_ROW||(mm[1]=[1-P,c,1-A,c,1-A,y,1-P,y]),o!==B.d.FLIP_N_ROTATE_TILE&&o!==B.d.FLIP_N_ROTATE_ROW||(mm[1]=[P,1-c,A,1-c,A,1-y,P,1-y]);for(let u=0;u<q;u++)N.push(b-z+M,u*f-E+l,0),N.push(b+M,u*f-E+l,0),N.push(b+M,(u+1)*f-E+l,0),N.push(b-z+M,(u+1)*f-E+l,0),W.push(F,F+1,F+3,F+1,F+2,F+3),F+=4,R=o===B.d.FLIP_TILE||o===B.d.ROTATE_TILE||o===B.d.FLIP_N_ROTATE_TILE?R.concat(mm[(u+K)%2]):o===B.d.FLIP_ROW||o===B.d.ROTATE_ROW||o===B.d.FLIP_N_ROTATE_ROW?R.concat(mm[u%2]):R.concat(mm[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const c=0===mm.sideOrientation?0:mm.sideOrientation||r.b.DEFAULTSIDE;r.b._ComputeSides(c,N,W,S,R,mm.frontUVs,mm.backUVs);const A=new r.b;A.indices=W,A.gm=N,A.Wm=S,A.Am=R;const y=c===r.b.DOUBLESIDE?g.concat(g):g;return A.Fm=y,A}function H(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new B.d(mm,u);o.sideOrientation=B.d._GetDefaultSideOrientation(o.sideOrientation),f._originalBuilderSideOrientation=o.sideOrientation;return x(o).Im(f,o.updatable),f}function E(mm){const o=mm.faceUV||new Array(6),u=mm.faceColors,O=mm.pattern||B.d.NO_FLIP,p=mm.width||mm.size||1,K=mm.height||mm.size||1,z=mm.depth||mm.size||1,Y=mm.tileWidth||mm.tileSize||1,H=mm.tileHeight||mm.tileSize||1,E=mm.alignHorizontal||0,M=mm.alignVertical||0,l=0===mm.sideOrientation?0:mm.sideOrientation||r.b.DEFAULTSIDE;for(let B=0;B<6;B++)void 0===o[B]&&(o[B]=new f.Vector4(0,0,1,1)),u&&void 0===u[B]&&(u[B]=new q.pp(1,1,1,1));const t=p/2,Q=K/2,b=z/2,J=[];for(let f=0;f<2;f++)J[f]=x({pattern:O,tileWidth:Y,tileHeight:H,width:p,height:K,alignVertical:M,alignHorizontal:E,sideOrientation:l});for(let f=2;f<4;f++)J[f]=x({pattern:O,tileWidth:Y,tileHeight:H,width:z,height:K,alignVertical:M,alignHorizontal:E,sideOrientation:l});let N=M;M===B.d.BOTTOM?N=B.d.TOP:M===B.d.TOP&&(N=B.d.BOTTOM);for(let f=4;f<6;f++)J[f]=x({pattern:O,tileWidth:Y,tileHeight:H,width:p,height:z,alignVertical:N,alignHorizontal:E,sideOrientation:l});let S=[],P=[],R=[],g=[];const W=[],F=[],c=[],A=[];let y=0,I=0;for(let B=0;B<6;B++){const mm=J[B].gm.length;F[B]=[],c[B]=[];for(let o=0;o<mm/3;o++)F[B].push(new f.lo(J[B].gm[3*o],J[B].gm[3*o+1],J[B].gm[3*o+2])),c[B].push(new f.lo(J[B].Wm[3*o],J[B].Wm[3*o+1],J[B].Wm[3*o+2]));y=J[B].Am.length,A[B]=[];for(let u=0;u<y;u+=2)A[B][u]=o[B].x+(o[B].z-o[B].x)*J[B].Am[u],A[B][u+1]=o[B].y+(o[B].w-o[B].y)*J[B].Am[u+1],w.d&&(A[B][u+1]=1-A[B][u+1]);if(R=R.concat(A[B]),g=g.concat(J[B].indices.map((mm=>mm+I))),I+=F[B].length,u)for(let o=0;o<4;o++)W.push(u[B].r,u[B].g,u[B].b,u[B].a)}const s=new f.lo(0,0,b),j=f.Matrix.RotationY(Math.PI);S=F[0].map((mm=>f.lo.TransformNormal(mm,j).add(s))).map((mm=>[mm.x,mm.y,mm.z])).reduce(((mm,o)=>mm.concat(o)),[]),P=c[0].map((mm=>f.lo.TransformNormal(mm,j))).map((mm=>[mm.x,mm.y,mm.z])).reduce(((mm,o)=>mm.concat(o)),[]),S=S.concat(F[1].map((mm=>mm.Qo(s))).map((mm=>[mm.x,mm.y,mm.z])).reduce(((mm,o)=>mm.concat(o)),[])),P=P.concat(c[1].map((mm=>[mm.x,mm.y,mm.z])).reduce(((mm,o)=>mm.concat(o)),[]));const a=new f.lo(t,0,0),X=f.Matrix.RotationY(-Math.PI/2);S=S.concat(F[2].map((mm=>f.lo.TransformNormal(mm,X).add(a))).map((mm=>[mm.x,mm.y,mm.z])).reduce(((mm,o)=>mm.concat(o)),[])),P=P.concat(c[2].map((mm=>f.lo.TransformNormal(mm,X))).map((mm=>[mm.x,mm.y,mm.z])).reduce(((mm,o)=>mm.concat(o)),[]));const G=f.Matrix.RotationY(Math.PI/2);S=S.concat(F[3].map((mm=>f.lo.TransformNormal(mm,G).Qo(a))).map((mm=>[mm.x,mm.y,mm.z])).reduce(((mm,o)=>mm.concat(o)),[])),P=P.concat(c[3].map((mm=>f.lo.TransformNormal(mm,G))).map((mm=>[mm.x,mm.y,mm.z])).reduce(((mm,o)=>mm.concat(o)),[]));const k=new f.lo(0,Q,0),d=f.Matrix.RotationX(Math.PI/2);S=S.concat(F[4].map((mm=>f.lo.TransformNormal(mm,d).add(k))).map((mm=>[mm.x,mm.y,mm.z])).reduce(((mm,o)=>mm.concat(o)),[])),P=P.concat(c[4].map((mm=>f.lo.TransformNormal(mm,d))).map((mm=>[mm.x,mm.y,mm.z])).reduce(((mm,o)=>mm.concat(o)),[]));const e=f.Matrix.RotationX(-Math.PI/2);S=S.concat(F[5].map((mm=>f.lo.TransformNormal(mm,e).Qo(k))).map((mm=>[mm.x,mm.y,mm.z])).reduce(((mm,o)=>mm.concat(o)),[])),P=P.concat(c[5].map((mm=>f.lo.TransformNormal(mm,e))).map((mm=>[mm.x,mm.y,mm.z])).reduce(((mm,o)=>mm.concat(o)),[])),r.b._ComputeSides(l,S,g,P,R);const L=new r.b;if(L.indices=g,L.gm=S,L.Wm=P,L.Am=R,u){const mm=l===r.b.DOUBLESIDE?W.concat(W):W;L.Fm=mm}return L}function M(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new B.d(mm,u);o.sideOrientation=B.d._GetDefaultSideOrientation(o.sideOrientation),f._originalBuilderSideOrientation=o.sideOrientation;return E(o).Im(f,o.updatable),f}r.b.CreateTiledPlane=x;r.b.CreateTiledBox=E;var l=u(13927),t=u(12965),Q=u(12924);function b(mm){const o=mm.height||2;let u=0===mm.diameterTop?0:mm.diameterTop||mm.diameter||1,O=0===mm.diameterBottom?0:mm.diameterBottom||mm.diameter||1;u=u||1e-5,O=O||1e-5;const p=0|(mm.tessellation||24),K=0|(mm.subdivisions||1),z=!!mm.hasRings,Y=!!mm.enclose,x=0===mm.cap?0:mm.cap||B.d.CAP_ALL,H=mm.arc&&(mm.arc<=0||mm.arc>1)?1:mm.arc||1,E=0===mm.sideOrientation?0:mm.sideOrientation||r.b.DEFAULTSIDE,M=mm.faceUV||new Array(3),l=mm.faceColors,t=2+(1+(1!==H&&Y?2:0))*(z?K:1);let b;for(b=0;b<t;b++)l&&void 0===l[b]&&(l[b]=new q.pp(1,1,1,1));for(b=0;b<t;b++)M&&void 0===M[b]&&(M[b]=new f.Vector4(0,0,1,1));const J=[],N=[],S=[],P=[],R=[],g=2*Math.PI*H/p;let W,F,c;const A=(O-u)/2/o,y=f.lo.Zero(),I=f.lo.Zero(),s=f.lo.Zero(),j=f.lo.Zero(),a=f.lo.Zero(),X=Q.b.Y;let G,k,d,e=1,L=1,C=0,v=0;for(G=0;G<=K;G++)for(F=G/K,c=(F*(u-O)+O)/2,e=z&&0!==G&&G!==K?2:1,d=0;d<e;d++){for(z&&(L+=d),Y&&(L+=2*d),k=0;k<=p;k++)W=k*g,y.x=Math.cos(-W)*c,y.y=-o/2+F*o,y.z=Math.sin(-W)*c,0===u&&G===K?(I.x=S[S.length-3*(p+1)],I.y=S[S.length-3*(p+1)+1],I.z=S[S.length-3*(p+1)+2]):(I.x=y.x,I.z=y.z,I.y=Math.sqrt(I.x*I.x+I.z*I.z)*A,I.normalize()),0===k&&(s.p(y),j.p(I)),N.push(y.x,y.y,y.z),S.push(I.x,I.y,I.z),v=z?C!==L?M[L].y:M[L].w:M[L].y+(M[L].w-M[L].y)*F,P.push(M[L].x+(M[L].z-M[L].x)*k/p,w.d?1-v:v),l&&R.push(l[L].r,l[L].g,l[L].b,l[L].a);1!==H&&Y&&(N.push(y.x,y.y,y.z),N.push(0,y.y,0),N.push(0,y.y,0),N.push(s.x,s.y,s.z),f.lo.CrossToRef(X,I,a),a.normalize(),S.push(a.x,a.y,a.z,a.x,a.y,a.z),f.lo.CrossToRef(j,X,a),a.normalize(),S.push(a.x,a.y,a.z,a.x,a.y,a.z),v=z?C!==L?M[L+1].y:M[L+1].w:M[L+1].y+(M[L+1].w-M[L+1].y)*F,P.push(M[L+1].x,w.d?1-v:v),P.push(M[L+1].z,w.d?1-v:v),v=z?C!==L?M[L+2].y:M[L+2].w:M[L+2].y+(M[L+2].w-M[L+2].y)*F,P.push(M[L+2].x,w.d?1-v:v),P.push(M[L+2].z,w.d?1-v:v),l&&(R.push(l[L+1].r,l[L+1].g,l[L+1].b,l[L+1].a),R.push(l[L+1].r,l[L+1].g,l[L+1].b,l[L+1].a),R.push(l[L+2].r,l[L+2].g,l[L+2].b,l[L+2].a),R.push(l[L+2].r,l[L+2].g,l[L+2].b,l[L+2].a))),C!==L&&(C=L)}const V=1!==H&&Y?p+4:p;for(G=0,L=0;L<K;L++){let mm=0,o=0,u=0,f=0;for(k=0;k<p;k++)mm=G*(V+1)+k,o=(G+1)*(V+1)+k,u=G*(V+1)+(k+1),f=(G+1)*(V+1)+(k+1),J.push(mm,o,u),J.push(f,u,o);1!==H&&Y&&(J.push(mm+2,o+2,u+2),J.push(f+2,u+2,o+2),J.push(mm+4,o+4,u+4),J.push(f+4,u+4,o+4)),G=z?G+2:G+1}const n=mm=>{const B=mm?u/2:O/2;if(0===B)return;let r,K,z;const Y=mm?M[t-1]:M[0];let q=null;l&&(q=mm?l[t-1]:l[0]);const x=N.length/3,E=mm?o/2:-o/2,Q=new f.lo(0,E,0);N.push(Q.x,Q.y,Q.z),S.push(0,mm?1:-1,0);const b=Y.y+.5*(Y.w-Y.y);P.push(Y.x+.5*(Y.z-Y.x),w.d?1-b:b),q&&R.push(q.r,q.g,q.b,q.a);const g=new f.Vector2(.5,.5);for(z=0;z<=p;z++){r=2*Math.PI*z*H/p;const o=Math.cos(-r),u=Math.sin(-r);K=new f.lo(o*B,E,u*B);const O=new f.Vector2(o*g.x+.5,u*g.y+.5);N.push(K.x,K.y,K.z),S.push(0,mm?1:-1,0);const x=Y.y+(Y.w-Y.y)*O.y;P.push(Y.x+(Y.z-Y.x)*O.x,w.d?1-x:x),q&&R.push(q.r,q.g,q.b,q.a)}for(z=0;z<p;z++)mm?(J.push(x),J.push(x+(z+2)),J.push(x+(z+1))):(J.push(x),J.push(x+(z+1)),J.push(x+(z+2)))};x!==B.d.CAP_START&&x!==B.d.CAP_ALL||n(!1),x!==B.d.CAP_END&&x!==B.d.CAP_ALL||n(!0),r.b._ComputeSides(E,N,J,S,P,mm.frontUVs,mm.backUVs);const U=new r.b;return U.indices=J,U.gm=N,U.Wm=S,U.Am=P,l&&(U.Fm=R),U}function J(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0;const f=new B.d(mm,u);o.sideOrientation=B.d._GetDefaultSideOrientation(o.sideOrientation),f._originalBuilderSideOrientation=o.sideOrientation;return b(o).Im(f,o.updatable),f}function N(mm){const o=[],u=[],B=[],O=[],p=mm.diameter||1,K=mm.thickness||.5,z=0|(mm.tessellation||16),Y=0===mm.sideOrientation?0:mm.sideOrientation||r.b.DEFAULTSIDE,q=z+1;for(let r=0;r<=z;r++){const mm=r/z,Y=r*Math.PI*2/z-Math.PI/2,x=f.Matrix.Translation(p/2,0,0).multiply(f.Matrix.RotationY(Y));for(let p=0;p<=z;p++){const Y=1-p/z,H=p*Math.PI*2/z+Math.PI,E=Math.cos(H),M=Math.sin(H);let l=new f.lo(E,M,0),t=l.scale(K/2);const Q=new f.Vector2(mm,Y);t=f.lo.TransformCoordinates(t,x),l=f.lo.TransformNormal(l,x),u.push(t.x,t.y,t.z),B.push(l.x,l.y,l.z),O.push(Q.x,w.d?1-Q.y:Q.y);const b=(r+1)%q,J=(p+1)%q;o.push(r*q+p),o.push(r*q+J),o.push(b*q+p),o.push(r*q+J),o.push(b*q+J),o.push(b*q+p)}}r.b._ComputeSides(Y,u,o,B,O,mm.frontUVs,mm.backUVs);const x=new r.b;return x.indices=o,x.gm=u,x.Wm=B,x.Am=O,x}function S(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0;const f=new B.d(mm,u);o.sideOrientation=B.d._GetDefaultSideOrientation(o.sideOrientation),f._originalBuilderSideOrientation=o.sideOrientation;return N(o).Im(f,o.updatable),f}r.b.CreateCylinder=b,B.d.CreateCylinder=(mm,o,u,f,O,r,w,p,K)=>{void 0!==w&&w instanceof t.d||(void 0!==w&&(K=p||B.d.DEFAULTSIDE,p=w),w=r,r=1);return J(mm,{height:o,diameterTop:u,diameterBottom:f,tessellation:O,subdivisions:r,sideOrientation:K,updatable:p},w)};function P(mm){const o=[],u=[],B=[],O=[],p=mm.radius||2,K=mm.tube||.5,z=mm.radialSegments||32,Y=mm.tubularSegments||32,q=mm.p||2,x=mm.q||3,H=0===mm.sideOrientation?0:mm.sideOrientation||r.b.DEFAULTSIDE,E=mm=>{const o=Math.cos(mm),u=Math.sin(mm),B=x/q*mm,O=Math.cos(B),r=p*(2+O)*.5*o,w=p*(2+O)*u*.5,K=p*Math.sin(B)*.5;return new f.lo(r,w,K)};let M,l;for(M=0;M<=z;M++){const mm=M%z/z*2*q*Math.PI,o=E(mm),B=E(mm+.01),r=B.Qo(o);let p=B.add(o);const x=f.lo.Cross(r,p);for(p=f.lo.Cross(x,r),x.normalize(),p.normalize(),l=0;l<Y;l++){const mm=l%Y/Y*2*Math.PI,f=-K*Math.cos(mm),B=K*Math.sin(mm);u.push(o.x+f*p.x+B*x.x),u.push(o.y+f*p.y+B*x.y),u.push(o.z+f*p.z+B*x.z),O.push(M/z),O.push(w.d?1-l/Y:l/Y)}}for(M=0;M<z;M++)for(l=0;l<Y;l++){const mm=(l+1)%Y,u=M*Y+l,f=(M+1)*Y+l,B=(M+1)*Y+mm,O=M*Y+mm;o.push(O),o.push(f),o.push(u),o.push(O),o.push(B),o.push(f)}r.b.ComputeNormals(u,o,B),r.b._ComputeSides(H,u,o,B,O,mm.frontUVs,mm.backUVs);const t=new r.b;return t.indices=o,t.gm=u,t.Wm=B,t.Am=O,t}function R(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0;const f=new B.d(mm,u);o.sideOrientation=B.d._GetDefaultSideOrientation(o.sideOrientation),f._originalBuilderSideOrientation=o.sideOrientation;return P(o).Im(f,o.updatable),f}r.b.CreateTorus=N,B.d.CreateTorus=(mm,o,u,f,B,O,r)=>S(mm,{diameter:o,thickness:u,tessellation:f,sideOrientation:r,updatable:O},B);r.b.CreateTorusKnot=P,B.d.CreateTorusKnot=(mm,o,u,f,B,O,r,w,p,K)=>R(mm,{radius:o,tube:u,radialSegments:f,tubularSegments:B,p:O,q:r,sideOrientation:K,updatable:p},w);var g=u(14360),W=u(13271),F=u(12934);function c(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=o.path,O=o.shape,r=o.scale||1,w=o.rotation||0,p=0===o.cap?0:o.cap||B.d.NO_CAP,K=o.updatable,z=B.d._GetDefaultSideOrientation(o.sideOrientation),Y=o.instance||null,q=o.invertUV||!1,x=o.closeShape||!1,H=o.closePath||!1,E=o.capFunction||null;return y(mm,O,f,r,w,null,null,H,x,p,!1,u,!!K,z,Y,q,o.frontUVs||null,o.backUVs||null,o.firstNormal||null,!!o.adjustFrame,E)}function A(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=o.path,O=o.shape,r=o.scaleFunction||(()=>1),w=o.rotationFunction||(()=>0),p=o.closePath||o.ribbonCloseArray||!1,K=o.closeShape||o.ribbonClosePath||!1,z=0===o.cap?0:o.cap||B.d.NO_CAP,Y=o.updatable,q=o.firstNormal||null,x=o.adjustFrame||!1,H=B.d._GetDefaultSideOrientation(o.sideOrientation),E=o.instance,M=o.invertUV||!1,l=o.capFunction||null;return y(mm,O,f,null,null,r,w,p,K,z,!0,u,!!Y,H,E||null,M,o.frontUVs||null,o.backUVs||null,q,x,l||null)}function y(mm,o,u,O,r,w,p,z,Y,q,x,H,E,M,l,t,Q,b,J,N,S){const P=(mm,o,u,O,r,w,p,K,z,Y,q)=>{const x=u.getTangents(),H=u.getNormals(),E=u.getBinormals(),M=u.getDistances();if(q)for(let B=0;B<x.length;B++)if(0==x[B].x&&0==x[B].y&&0==x[B].z&&x[B].p(x[B-1]),0==H[B].x&&0==H[B].y&&0==H[B].z&&H[B].p(H[B-1]),0==E[B].x&&0==E[B].y&&0==E[B].z&&E[B].p(E[B-1]),B>0){let mm=x[B-1];f.lo.Dot(mm,x[B])<0&&x[B].scaleInPlace(-1),mm=H[B-1],f.lo.Dot(mm,H[B])<0&&H[B].scaleInPlace(-1),mm=E[B-1],f.lo.Dot(mm,E[B])<0&&E[B].scaleInPlace(-1)}let l=0;const t=Y&&K?K:()=>null!==w?w:0,Q=Y&&p?p:()=>null!==r?r:1;let b=z===B.d.NO_CAP||z===B.d.CAP_END?0:2;const J=f.TmpVectors.Matrix[0];for(let B=0;B<o.length;B++){const u=[],r=t(B,M[B]),w=Q(B,M[B]);f.Matrix.RotationAxisToRef(x[B],l,J);for(let O=0;O<mm.length;O++){const r=x[B].scale(mm[O].z).add(H[B].scale(mm[O].x)).add(E[B].scale(mm[O].y)),p=f.lo.Zero();f.lo.TransformCoordinatesToRef(r,J,p),p.scaleInPlace(w).addInPlace(o[B]),u[O]=p}O[b]=u,l+=r,b++}const N=S||(mm=>{const o=Array(),u=f.lo.Zero();let B;for(B=0;B<mm.length;B++)u.addInPlace(mm[B]);for(u.scaleInPlace(1/mm.length),B=0;B<mm.length;B++)o.push(u);return o});switch(z){case B.d.NO_CAP:break;case B.d.CAP_START:O[0]=N(O[2]),O[1]=O[2];break;case B.d.CAP_END:O[b]=O[b-1],O[b+1]=N(O[b-1]);break;case B.d.CAP_ALL:O[0]=N(O[2]),O[1]=O[2],O[b]=O[b-1],O[b+1]=N(O[b-1])}return O};let R,g;if(l){const mm=l._creationDataStorage;return R=J?mm.path3D.update(u,J):mm.path3D.update(u),g=P(o,u,mm.path3D,mm.pathArray,O,r,w,p,mm.cap,x,N),l=K("",{pathArray:g,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:l},H||void 0)}R=J?new F.j(u,J):new F.j(u);g=P(o,u,R,new Array,O,r,w,p,q=q<0||q>3?0:q,x,N);const W=K(mm,{pathArray:g,closeArray:z,closePath:Y,updatable:E,sideOrientation:M,invertUV:t,frontUVs:Q||void 0,backUVs:b||void 0},H);return W._creationDataStorage.pathArray=g,W._creationDataStorage.path3D=R,W._creationDataStorage.cap=q,W}function I(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=o.arc?o.arc<=0||o.arc>1?1:o.arc:1,r=void 0===o.closed||o.closed,w=o.shape,p=o.radius||1,z=o.tessellation||64,Y=o.clip||0,q=o.updatable,x=B.d._GetDefaultSideOrientation(o.sideOrientation),H=o.cap||B.d.NO_CAP,E=2*Math.PI,M=[],l=o.invertUV||!1;let t=0,Q=0;const b=E/z*O;let J,N;for(t=0;t<=z-Y;t++){for(N=[],H!=B.d.CAP_START&&H!=B.d.CAP_ALL||(N.push(new f.lo(0,w[0].y,0)),N.push(new f.lo(Math.cos(t*b)*w[0].x*p,w[0].y,Math.sin(t*b)*w[0].x*p))),Q=0;Q<w.length;Q++)J=new f.lo(Math.cos(t*b)*w[Q].x*p,w[Q].y,Math.sin(t*b)*w[Q].x*p),N.push(J);H!=B.d.CAP_END&&H!=B.d.CAP_ALL||(N.push(new f.lo(Math.cos(t*b)*w[w.length-1].x*p,w[w.length-1].y,Math.sin(t*b)*w[w.length-1].x*p)),N.push(new f.lo(0,w[w.length-1].y,0))),M.push(N)}return K(mm,{pathArray:M,closeArray:r,sideOrientation:x,updatable:q,invertUV:l,frontUVs:o.frontUVs,backUVs:o.backUVs},u)}B.d.ExtrudeShape=function(mm,o,u,f,O,r){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7?arguments[7]:void 0,K=arguments.length>8?arguments[8]:void 0,z=arguments.length>9?arguments[9]:void 0;return c(mm,{shape:o,path:u,scale:f,rotation:O,cap:0===r?0:r||B.d.NO_CAP,sideOrientation:K,instance:z,updatable:p},w)},B.d.ExtrudeShapeCustom=(mm,o,u,f,O,r,w,p,K,z,Y,q)=>A(mm,{shape:o,path:u,scaleFunction:f,rotationFunction:O,ribbonCloseArray:r,ribbonClosePath:w,cap:0===p?0:p||B.d.NO_CAP,sideOrientation:Y,instance:q,updatable:z},K);B.d.CreateLathe=(mm,o,u,f,B,O,r)=>I(mm,{shape:o,radius:u,tessellation:f,sideOrientation:r,updatable:O},B);var s=u(13837),j=u(13788);function a(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=o.path;let r=o.instance,w=1;void 0!==o.radius?w=o.radius:r&&(w=r._creationDataStorage.radius);const p=o.tessellation||64,z=o.radiusFunction||null;let Y=o.cap||B.d.NO_CAP;const q=o.invertUV||!1,x=o.updatable,H=B.d._GetDefaultSideOrientation(o.sideOrientation);o.arc=o.arc&&(o.arc<=0||o.arc>1)?1:o.arc||1;const E=(mm,o,u,O,r,w,p,K)=>{const z=o.getTangents(),Y=o.getNormals(),q=o.getDistances(),x=2*Math.PI/r*K,H=w||(()=>O);let E,M,l,t;const Q=f.TmpVectors.Matrix[0];let b=p===B.d.NO_CAP||p===B.d.CAP_END?0:2;for(let B=0;B<mm.length;B++){M=H(B,q[B]),E=Array(),l=Y[B];for(let o=0;o<r;o++)f.Matrix.RotationAxisToRef(z[B],x*o,Q),t=E[o]?E[o]:f.lo.Zero(),f.lo.TransformCoordinatesToRef(l,Q,t),t.scaleInPlace(M).addInPlace(mm[B]),E[o]=t;u[b]=E,b++}const J=(o,u)=>{const f=Array();for(let B=0;B<o;B++)f.push(mm[u]);return f};switch(p){case B.d.NO_CAP:break;case B.d.CAP_START:u[0]=J(r,0),u[1]=u[2].slice(0);break;case B.d.CAP_END:u[b]=u[b-1].slice(0),u[b+1]=J(r,mm.length-1);break;case B.d.CAP_ALL:u[0]=J(r,0),u[1]=u[2].slice(0),u[b]=u[b-1].slice(0),u[b+1]=J(r,mm.length-1)}return u};let M,l;if(r){const mm=r._creationDataStorage,u=o.arc||mm.arc;return M=mm.path3D.update(O),l=E(O,M,mm.pathArray,w,mm.tessellation,z,mm.cap,u),r=K("",{pathArray:l,instance:r}),mm.path3D=M,mm.pathArray=l,mm.arc=u,mm.radius=w,r}M=new F.j(O);Y=Y<0||Y>3?0:Y,l=E(O,M,new Array,w,p,z,Y,o.arc);const t=K(mm,{pathArray:l,closePath:!0,closeArray:!1,updatable:x,sideOrientation:H,invertUV:q,frontUVs:o.frontUVs,backUVs:o.backUVs},u);return t._creationDataStorage.pathArray=l,t._creationDataStorage.path3D=M,t._creationDataStorage.tessellation=p,t._creationDataStorage.cap=Y,t._creationDataStorage.arc=o.arc,t._creationDataStorage.radius=w,t}function X(mm){const o=[];o[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},o[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},o[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},o[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},o[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},o[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},o[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},o[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},o[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},o[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},o[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},o[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},o[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},o[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},o[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const u=mm.type&&(mm.type<0||mm.type>=o.length)?0:mm.type||0,B=mm.size,O=mm.sizeX||B||1,p=mm.sizeY||B||1,K=mm.sizeZ||B||1,z=mm.custom||o[u],Y=z.face.length,x=mm.faceUV||new Array(Y),H=mm.faceColors,E=void 0===mm.flat||mm.flat,M=0===mm.sideOrientation?0:mm.sideOrientation||r.b.DEFAULTSIDE,l=[],t=[],Q=[],b=[],J=[];let N=0,S=0;const P=[];let R,g,W,F,c,A,y=0,I=0;if(E)for(I=0;I<Y;I++)H&&void 0===H[I]&&(H[I]=new q.pp(1,1,1,1)),x&&void 0===x[I]&&(x[I]=new f.Vector4(0,0,1,1));if(E)for(I=0;I<Y;I++){const mm=z.face[I].length;for(W=2*Math.PI/mm,F=.5*Math.tan(W/2),c=.5,y=0;y<mm;y++)l.push(z.vertex[z.face[I][y]][0]*O,z.vertex[z.face[I][y]][1]*p,z.vertex[z.face[I][y]][2]*K),P.push(N),N++,R=x[I].x+(x[I].z-x[I].x)*(.5+F),g=x[I].y+(x[I].w-x[I].y)*(c-.5),b.push(R,w.d?1-g:g),A=F*Math.cos(W)-c*Math.sin(W),c=F*Math.sin(W)+c*Math.cos(W),F=A,H&&J.push(H[I].r,H[I].g,H[I].b,H[I].a);for(y=0;y<mm-2;y++)t.push(P[0+S],P[y+2+S],P[y+1+S]);S+=mm}else{for(y=0;y<z.vertex.length;y++)l.push(z.vertex[y][0]*O,z.vertex[y][1]*p,z.vertex[y][2]*K),b.push(0,w.d?1:0);for(I=0;I<Y;I++)for(y=0;y<z.face[I].length-2;y++)t.push(z.face[I][0],z.face[I][y+2],z.face[I][y+1])}r.b.ComputeNormals(l,t,Q),r.b._ComputeSides(M,l,t,Q,b,mm.frontUVs,mm.backUVs);const s=new r.b;return s.gm=l,s.indices=t,s.Wm=Q,s.Am=b,H&&E&&(s.Fm=J),s}function G(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new B.d(mm,u);o.sideOrientation=B.d._GetDefaultSideOrientation(o.sideOrientation),f._originalBuilderSideOrientation=o.sideOrientation;return X(o).Im(f,o.updatable),f}B.d.CreateTube=(mm,o,u,f,B,O,r,w,p,K)=>a(mm,{path:o,radius:u,tessellation:f,radiusFunction:B,arc:1,cap:O,updatable:w,sideOrientation:p,instance:K},r);function k(mm){const o=mm.sideOrientation||r.b.DEFAULTSIDE,u=mm.radius||1,B=void 0===mm.flat||mm.flat,O=0|(mm.subdivisions||4),p=mm.radiusX||u,K=mm.radiusY||u,z=mm.radiusZ||u,Y=(1+Math.sqrt(5))/2,q=[-1,Y,-0,1,Y,0,-1,-Y,0,1,-Y,0,0,-1,-Y,0,1,-Y,0,-1,Y,0,1,Y,Y,0,1,Y,0,-1,-Y,0,1,-Y,0,-1],x=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],H=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],E=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],M=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],l=[],t=[],Q=[],b=[];let J=0;const N=new Array(3),S=new Array(3);let P;for(P=0;P<3;P++)N[P]=f.lo.Zero(),S[P]=f.Vector2.Zero();for(let r=0;r<20;r++){for(P=0;P<3;P++){const mm=x[3*r+P];N[P].Op(q[3*H[mm]],q[3*H[mm]+1],q[3*H[mm]+2]),N[P].normalize(),S[P].Op(.134765625*E[2*mm]+.05859375+-.0390625*M[r],.2333984375*E[2*mm+1]+.025390625+.01953125*M[r])}const mm=(mm,o,u,r)=>{const Y=f.lo.Lerp(N[0],N[2],o/O),q=f.lo.Lerp(N[1],N[2],o/O),x=O===o?N[2]:f.lo.Lerp(Y,q,mm/(O-o));let H;if(x.normalize(),B){const mm=f.lo.Lerp(N[0],N[2],r/O),o=f.lo.Lerp(N[1],N[2],r/O);H=f.lo.Lerp(mm,o,u/(O-r))}else H=new f.lo(x.x,x.y,x.z);H.x/=p,H.y/=K,H.z/=z,H.normalize();const E=f.Vector2.Lerp(S[0],S[2],o/O),M=f.Vector2.Lerp(S[1],S[2],o/O),P=O===o?S[2]:f.Vector2.Lerp(E,M,mm/(O-o));t.push(x.x*p,x.y*K,x.z*z),Q.push(H.x,H.y,H.z),b.push(P.x,w.d?1-P.y:P.y),l.push(J),J++};for(let o=0;o<O;o++)for(let u=0;u+o<O;u++)mm(u,o,u+1/3,o+1/3),mm(u+1,o,u+1/3,o+1/3),mm(u,o+1,u+1/3,o+1/3),u+o+1<O&&(mm(u+1,o,u+2/3,o+2/3),mm(u+1,o+1,u+2/3,o+2/3),mm(u,o+1,u+2/3,o+2/3))}r.b._ComputeSides(o,t,l,Q,b,mm.frontUVs,mm.backUVs);const R=new r.b;return R.indices=l,R.gm=t,R.Wm=Q,R.Am=b,R}function d(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new B.d(mm,u);o.sideOrientation=B.d._GetDefaultSideOrientation(o.sideOrientation),f._originalBuilderSideOrientation=o.sideOrientation;return k(o).Im(f,o.updatable),f}r.b.CreatePolyhedron=X,B.d.CreatePolyhedron=(mm,o,u)=>G(mm,o,u);r.b.CreateIcoSphere=k,B.d.CreateIcoSphere=(mm,o,u)=>d(mm,o,u);var e=u(12752);const L=new f.lo(1,0,0),C=new f.lo(-1,0,0),v=new f.lo(0,1,0),V=new f.lo(0,-1,0),n=new f.lo(0,0,1),U=new f.lo(0,0,-1);class h{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.lo.Zero(),o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.lo.Up(),u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.Vector2.Zero(),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=mm,this.normal=o,this.uv=u,this.vertexIdx=B,this.vertexIdxForBones=O,this.localPositionOverride=r,this.localNormalOverride=w,this.matrixIndicesOverride=p,this.matrixWeightsOverride=K}clone(){var mm,o,u,f;return new h(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(mm=this.localPositionOverride)||void 0===mm?void 0:mm.slice(),null===(o=this.localNormalOverride)||void 0===o?void 0:o.slice(),null===(u=this.matrixIndicesOverride)||void 0===u?void 0:u.slice(),null===(f=this.matrixWeightsOverride)||void 0===f?void 0:f.slice())}}function Z(mm,o,u){var p,K,z,Y,q;const x=!!o.skeleton,H=!(null===(p=o.morphTargetManager)||void 0===p||!p.numTargets),E=u.localMode||x,M=o.hr(),l=x||H?o.Jp(!0,!0):o.getVerticesData(O.f.PositionKind),t=x||H?o.getNormalsData(!0,!0):o.getVerticesData(O.f.NormalKind),Q=E?x?o.getVerticesData(O.f.PositionKind):l:null,b=E?x?o.getVerticesData(O.f.NormalKind):t:null,J=o.getVerticesData(O.f.UVKind),N=x?o.getVerticesData(O.f.MatricesIndicesKind):null,S=x?o.getVerticesData(O.f.MatricesWeightsKind):null,P=x?o.getVerticesData(O.f.MatricesIndicesExtraKind):null,R=x?o.getVerticesData(O.f.MatricesWeightsExtraKind):null,g=u.position||f.lo.Zero();let W=u.normal||f.lo.Up();const F=u.size||f.lo.One(),c=u.angle||0;if(!W){const mm=new f.lo(0,0,1),u=o.Pm().activeCamera,B=f.lo.TransformCoordinates(mm,u.getWorldMatrix());W=u.globalPosition.Qo(B)}const A=-Math.atan2(W.z,W.x)-Math.PI/2,y=Math.sqrt(W.x*W.x+W.z*W.z),I=Math.atan2(W.y,y),s=new r.b;s.indices=[],s.gm=[],s.Wm=[],s.Am=[],s.matricesIndices=x?[]:null,s.matricesWeights=x?[]:null,s.matricesIndicesExtra=P?[]:null,s.matricesWeightsExtra=R?[]:null;let j=0;const a=(mm,o)=>{const B=new h;if(!M||!l||!t)return B;const O=M[mm];if(B.vertexIdx=3*O,B.vertexIdxForBones=4*O,B.position=new f.lo(l[3*O],l[3*O+1],l[3*O+2]),f.lo.TransformCoordinatesToRef(B.position,o,B.position),B.normal=new f.lo(t[3*O],t[3*O+1],t[3*O+2]),f.lo.TransformNormalToRef(B.normal,o,B.normal),u.captureUVS&&J){const mm=J[2*O+1];B.uv=new f.Vector2(J[2*O],w.d?1-mm:mm)}return B},X=[0,0,0,0],G=(mm,o)=>{if(0===mm.length)return mm;const u=.5*Math.abs(f.lo.Dot(F,o)),B=(mm,o,u,f)=>{for(let B=0;B<f;++B)if(mm[u+B]===o)return u+B;return-1},O=(mm,O)=>{const r=f.lo.GetClipFactor(mm.position,O.position,o,u);let w=X,p=X;if(N&&S){const o=mm.matrixIndicesOverride?0:mm.vertexIdxForBones,u=mm.matrixIndicesOverride??N,f=mm.matrixWeightsOverride??S,K=O.matrixIndicesOverride?0:O.vertexIdxForBones,z=O.matrixIndicesOverride??N,Y=O.matrixWeightsOverride??S;w=[0,0,0,0],p=[0,0,0,0];let q=0;for(let mm=0;mm<4;++mm)if(f[o+mm]>0){const O=B(z,u[o+mm],K,4);w[q]=u[o+mm],p[q]=(0,e.Lerp)(f[o+mm],O>=0?Y[O]:0,r),q++}for(let mm=0;mm<4&&q<4;++mm){const f=z[K+mm];-1===B(u,f,o,4)&&(w[q]=f,p[q]=(0,e.Lerp)(0,Y[K+mm],r),q++)}const x=p[0]+p[1]+p[2]+p[3];p[0]/=x,p[1]/=x,p[2]/=x,p[3]/=x}const K=mm.localPositionOverride?mm.localPositionOverride[0]:(null===Q||void 0===Q?void 0:Q[mm.vertexIdx])??0,z=mm.localPositionOverride?mm.localPositionOverride[1]:(null===Q||void 0===Q?void 0:Q[mm.vertexIdx+1])??0,Y=mm.localPositionOverride?mm.localPositionOverride[2]:(null===Q||void 0===Q?void 0:Q[mm.vertexIdx+2])??0,q=O.localPositionOverride?O.localPositionOverride[0]:(null===Q||void 0===Q?void 0:Q[O.vertexIdx])??0,x=O.localPositionOverride?O.localPositionOverride[1]:(null===Q||void 0===Q?void 0:Q[O.vertexIdx+1])??0,H=O.localPositionOverride?O.localPositionOverride[2]:(null===Q||void 0===Q?void 0:Q[O.vertexIdx+2])??0,E=mm.localNormalOverride?mm.localNormalOverride[0]:(null===b||void 0===b?void 0:b[mm.vertexIdx])??0,M=mm.localNormalOverride?mm.localNormalOverride[1]:(null===b||void 0===b?void 0:b[mm.vertexIdx+1])??0,l=mm.localNormalOverride?mm.localNormalOverride[2]:(null===b||void 0===b?void 0:b[mm.vertexIdx+2])??0,t=E+((O.localNormalOverride?O.localNormalOverride[0]:(null===b||void 0===b?void 0:b[O.vertexIdx])??0)-E)*r,J=M+((O.localNormalOverride?O.localNormalOverride[1]:(null===b||void 0===b?void 0:b[O.vertexIdx+1])??0)-M)*r,P=l+((O.localNormalOverride?O.localNormalOverride[2]:(null===b||void 0===b?void 0:b[O.vertexIdx+2])??0)-l)*r,R=Math.sqrt(t*t+J*J+P*P);return new h(f.lo.Lerp(mm.position,O.position,r),f.lo.Lerp(mm.normal,O.normal,r).normalize(),f.Vector2.Lerp(mm.uv,O.uv,r),-1,-1,Q?[K+(q-K)*r,z+(x-z)*r,Y+(H-Y)*r]:null,b?[t/R,J/R,P/R]:null,w,p)};let r=null;mm.length>3&&(r=[]);for(let w=0;w<mm.length;w+=3){let B=0,p=null,K=null,z=null,Y=null;const q=f.lo.Dot(mm[w].position,o)-u>0,x=f.lo.Dot(mm[w+1].position,o)-u>0,H=f.lo.Dot(mm[w+2].position,o)-u>0;switch(B=(q?1:0)+(x?1:0)+(H?1:0),B){case 0:mm.length>3?(r.push(mm[w]),r.push(mm[w+1]),r.push(mm[w+2])):r=mm;break;case 1:if(r=r??new Array,q&&(p=mm[w+1],K=mm[w+2],z=O(mm[w],p),Y=O(mm[w],K)),x){p=mm[w],K=mm[w+2],z=O(mm[w+1],p),Y=O(mm[w+1],K),r.push(z),r.push(K.clone()),r.push(p.clone()),r.push(K.clone()),r.push(z.clone()),r.push(Y);break}H&&(p=mm[w],K=mm[w+1],z=O(mm[w+2],p),Y=O(mm[w+2],K)),p&&K&&z&&Y&&(r.push(p.clone()),r.push(K.clone()),r.push(z),r.push(Y),r.push(z.clone()),r.push(K.clone()));break;case 2:r=r??new Array,q||(p=mm[w].clone(),K=O(p,mm[w+1]),z=O(p,mm[w+2]),r.push(p),r.push(K),r.push(z)),x||(p=mm[w+1].clone(),K=O(p,mm[w+2]),z=O(p,mm[w]),r.push(p),r.push(K),r.push(z)),H||(p=mm[w+2].clone(),K=O(p,mm[w]),z=O(p,mm[w+1]),r.push(p),r.push(K),r.push(z))}}return r},k=o instanceof B.d?o:null,d=null===k||void 0===k?void 0:k._thinInstanceDataStorage.matrixData,Z=(null===k||void 0===k?void 0:k.zp)||1,T=f.TmpVectors.Matrix[0];T.p(f.Matrix.IdentityReadOnly);for(let B=0;B<Z;++B){if(null!==k&&void 0!==k&&k.hasThinInstances&&d){const mm=16*B;T.setRowFromFloats(0,d[mm+0],d[mm+1],d[mm+2],d[mm+3]),T.setRowFromFloats(1,d[mm+4],d[mm+5],d[mm+6],d[mm+7]),T.setRowFromFloats(2,d[mm+8],d[mm+9],d[mm+10],d[mm+11]),T.setRowFromFloats(3,d[mm+12],d[mm+13],d[mm+14],d[mm+15])}const mm=f.Matrix.RotationYawPitchRoll(A,I,c).multiply(f.Matrix.Translation(g.x,g.y,g.z)),O=f.Matrix.Invert(mm),r=o.getWorldMatrix(),p=T.multiply(r).multiply(O),K=new Array(3);for(let o=0;o<M.length;o+=3){let mm=K;if(mm[0]=a(o,p),mm[1]=a(o+1,p),mm[2]=a(o+2,p),!(u.cullBackFaces&&-mm[0].normal.z<=0&&-mm[1].normal.z<=0&&-mm[2].normal.z<=0)&&(mm=G(mm,L),mm&&(mm=G(mm,C),mm&&(mm=G(mm,v),mm&&(mm=G(mm,V),mm&&(mm=G(mm,n),mm&&(mm=G(mm,U),mm)))))))for(let o=0;o<mm.length;o++){const f=mm[o];if(s.indices.push(j),E?(f.localPositionOverride?(s.gm[3*j]=f.localPositionOverride[0],s.gm[3*j+1]=f.localPositionOverride[1],s.gm[3*j+2]=f.localPositionOverride[2]):Q&&(s.gm[3*j]=Q[f.vertexIdx],s.gm[3*j+1]=Q[f.vertexIdx+1],s.gm[3*j+2]=Q[f.vertexIdx+2]),f.localNormalOverride?(s.Wm[3*j]=f.localNormalOverride[0],s.Wm[3*j+1]=f.localNormalOverride[1],s.Wm[3*j+2]=f.localNormalOverride[2]):b&&(s.Wm[3*j]=b[f.vertexIdx],s.Wm[3*j+1]=b[f.vertexIdx+1],s.Wm[3*j+2]=b[f.vertexIdx+2])):(f.position.toArray(s.gm,3*j),f.normal.toArray(s.Wm,3*j)),s.matricesIndices&&s.matricesWeights&&(f.matrixIndicesOverride?(s.matricesIndices[4*j]=f.matrixIndicesOverride[0],s.matricesIndices[4*j+1]=f.matrixIndicesOverride[1],s.matricesIndices[4*j+2]=f.matrixIndicesOverride[2],s.matricesIndices[4*j+3]=f.matrixIndicesOverride[3]):(N&&(s.matricesIndices[4*j]=N[f.vertexIdxForBones],s.matricesIndices[4*j+1]=N[f.vertexIdxForBones+1],s.matricesIndices[4*j+2]=N[f.vertexIdxForBones+2],s.matricesIndices[4*j+3]=N[f.vertexIdxForBones+3]),P&&s.matricesIndicesExtra&&(s.matricesIndicesExtra[4*j]=P[f.vertexIdxForBones],s.matricesIndicesExtra[4*j+1]=P[f.vertexIdxForBones+1],s.matricesIndicesExtra[4*j+2]=P[f.vertexIdxForBones+2],s.matricesIndicesExtra[4*j+3]=P[f.vertexIdxForBones+3])),f.matrixWeightsOverride?(s.matricesWeights[4*j]=f.matrixWeightsOverride[0],s.matricesWeights[4*j+1]=f.matrixWeightsOverride[1],s.matricesWeights[4*j+2]=f.matrixWeightsOverride[2],s.matricesWeights[4*j+3]=f.matrixWeightsOverride[3]):(S&&(s.matricesWeights[4*j]=S[f.vertexIdxForBones],s.matricesWeights[4*j+1]=S[f.vertexIdxForBones+1],s.matricesWeights[4*j+2]=S[f.vertexIdxForBones+2],s.matricesWeights[4*j+3]=S[f.vertexIdxForBones+3]),R&&s.matricesWeightsExtra&&(s.matricesWeightsExtra[4*j]=R[f.vertexIdxForBones],s.matricesWeightsExtra[4*j+1]=R[f.vertexIdxForBones+1],s.matricesWeightsExtra[4*j+2]=R[f.vertexIdxForBones+2],s.matricesWeightsExtra[4*j+3]=R[f.vertexIdxForBones+3]))),u.captureUVS)f.uv.toArray(s.Am,2*j);else{s.Am.push(.5+f.position.x/F.x);const mm=.5+f.position.y/F.y;s.Am.push(w.d?1-mm:mm)}j++}}}0===s.indices.length&&(s.indices=null),0===s.gm.length&&(s.gm=null),0===s.Wm.length&&(s.Wm=null),0===s.Am.length&&(s.Am=null),0===(null===(K=s.matricesIndices)||void 0===K?void 0:K.length)&&(s.matricesIndices=null),0===(null===(z=s.matricesWeights)||void 0===z?void 0:z.length)&&(s.matricesWeights=null),0===(null===(Y=s.matricesIndicesExtra)||void 0===Y?void 0:Y.length)&&(s.matricesIndicesExtra=null),0===(null===(q=s.matricesWeightsExtra)||void 0===q?void 0:q.length)&&(s.matricesWeightsExtra=null);const D=new B.d(mm,o.Pm());return s.Im(D),E?(D.skeleton=o.skeleton,D.parent=o):(D.position=g.clone(),D.rotation=new f.lo(I,A,c)),D.Df(!0),D.refreshBoundingInfo(!0,!0),D}function T(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const o=0|Math.max(mm.subdivisions?mm.subdivisions:2,1),u=0|Math.max(mm.tessellation?mm.tessellation:16,3),B=Math.max(mm.height?mm.height:1,0),O=Math.max(mm.radius?mm.radius:.25,0),p=0|Math.max(mm.capSubdivisions?mm.capSubdivisions:6,1),K=u,z=o,Y=Math.max(mm.radiusTop?mm.radiusTop:O,0),q=Math.max(mm.radiusBottom?mm.radiusBottom:O,0),x=B-(Y+q),H=2*Math.PI,E=Math.max(mm.topCapSubdivisions?mm.topCapSubdivisions:p,1),M=Math.max(mm.bottomCapSubdivisions?mm.bottomCapSubdivisions:p,1),l=Math.acos((q-Y)/B);let t=[];const Q=[],b=[],J=[];let N=0;const S=[],P=.5*x,R=.5*Math.PI;let g,W;const F=f.lo.Zero(),c=f.lo.Zero(),A=Math.cos(l),y=Math.sin(l),I=new f.Vector2(Y*y,P+Y*A).Qo(new f.Vector2(q*y,q*A-P)).length(),s=Y*l+I+q*(R-l);let j=0;for(W=0;W<=E;W++){const mm=[],o=R-l*(W/E);j+=Y*l/E;const u=Math.cos(o),f=Math.sin(o),B=u*Y;for(g=0;g<=K;g++){const o=g/K,O=o*H+0,r=Math.sin(O),p=Math.cos(O);c.x=B*r,c.y=P+f*Y,c.z=B*p,Q.push(c.x,c.y,c.z),F.set(u*r,f,u*p),b.push(F.x,F.y,F.z),J.push(o,w.d?j/s:1-j/s),mm.push(N),N++}S.push(mm)}const a=B-Y-q+A*Y-A*q,X=y*(q-Y)/a;for(W=1;W<=z;W++){const mm=[];j+=I/z;const o=y*(W*(q-Y)/z+Y);for(g=0;g<=K;g++){const u=g/K,f=u*H+0,B=Math.sin(f),O=Math.cos(f);c.x=o*B,c.y=P+A*Y-W*a/z,c.z=o*O,Q.push(c.x,c.y,c.z),F.set(B,X,O).normalize(),b.push(F.x,F.y,F.z),J.push(u,w.d?j/s:1-j/s),mm.push(N),N++}S.push(mm)}for(W=1;W<=M;W++){const mm=[],o=R-l-(Math.PI-l)*(W/M);j+=q*l/M;const u=Math.cos(o),f=Math.sin(o),B=u*q;for(g=0;g<=K;g++){const o=g/K,O=o*H+0,r=Math.sin(O),p=Math.cos(O);c.x=B*r,c.y=f*q-P,c.z=B*p,Q.push(c.x,c.y,c.z),F.set(u*r,f,u*p),b.push(F.x,F.y,F.z),J.push(o,w.d?j/s:1-j/s),mm.push(N),N++}S.push(mm)}for(g=0;g<K;g++)for(W=0;W<E+z+M;W++){const mm=S[W][g],o=S[W+1][g],u=S[W+1][g+1],f=S[W][g+1];t.push(mm),t.push(o),t.push(f),t.push(o),t.push(u),t.push(f)}if(t=t.reverse(),mm.orientation&&!mm.orientation.equals(f.lo.Up())){const o=new f.Matrix;mm.orientation.clone().scale(.5*Math.PI).cross(f.lo.Up()).toQuaternion().toRotationMatrix(o);const u=f.lo.Zero();for(let mm=0;mm<Q.length;mm+=3)u.set(Q[mm],Q[mm+1],Q[mm+2]),f.lo.TransformCoordinatesToRef(u.clone(),o,u),Q[mm]=u.x,Q[mm+1]=u.y,Q[mm+2]=u.z}const G=new r.b;return G.gm=Q,G.Wm=b,G.Am=J,G.indices=t,G}function D(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:f.lo.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new B.d(mm,u);return T(o).Im(O,o.updatable),O}B.d.CreateDecal=(mm,o,u,f,B,O)=>Z(mm,o,{position:u,normal:f,size:B,angle:O});B.d.CreateCapsule=(mm,o,u)=>D(mm,o,u),r.b.CreateCapsule=T;var i=u(12565),mo=u(12746);class om{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=mm,this.y=o,mm!==Math.floor(mm)&&(mm=Math.floor(mm),i.e.Warn("x is not an integer, floor(x) used")),o!==Math.floor(o)&&(o=Math.floor(o),i.e.Warn("y is not an integer, floor(y) used"))}clone(){return new om(this.x,this.y)}rotate60About(mm){const o=this.x;return this.x=mm.x+mm.y-this.y,this.y=o+this.y-mm.x,this}rotateNeg60About(mm){const o=this.x;return this.x=o+this.y-mm.y,this.y=mm.x+mm.y-o,this}rotate120(mm,o){mm!==Math.floor(mm)&&(mm=Math.floor(mm),i.e.Warn("m not an integer only floor(m) used")),o!==Math.floor(o)&&(o=Math.floor(o),i.e.Warn("n not an integer only floor(n) used"));const u=this.x;return this.x=mm-u-this.y,this.y=o+u,this}rotateNeg120(mm,o){mm!==Math.floor(mm)&&(mm=Math.floor(mm),i.e.Warn("m is not an integer, floor(m) used")),o!==Math.floor(o)&&(o=Math.floor(o),i.e.Warn("n is not an integer,   floor(n) used"));const u=this.x;return this.x=this.y-o,this.y=mm+o-u-this.y,this}toCartesianOrigin(mm,o){const u=f.lo.Zero();return u.x=mm.x+2*this.x*o+this.y*o,u.y=mm.y+Math.sqrt(3)*this.y*o,u}static Zero(){return new om(0,0)}}class um{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new fm("icosahedron","Regular",[[0,mo.f,-1],[-mo.f,1,0],[-1,0,-mo.f],[1,0,-mo.f],[mo.f,1,0],[0,mo.f,1],[-1,0,mo.f],[-mo.f,-1,0],[0,-mo.f,-1],[mo.f,-1,0],[1,0,mo.f],[0,-mo.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let mm=12;const o={},u=this.m,f=this.n;let B,O,r,w,p,K=u,z=1,Y=0;0!==f&&(K=(0,e.HighestCommonFactor)(u,f)),z=u/K,Y=f/K;const q=om.Zero(),x=new om(u,f),H=new om(-f,u+f),E=om.Zero(),M=om.Zero(),l=om.Zero();let t,Q,b,J,N=[];const S=[],P=this.vertByDist,R=(u,f,B,O)=>{t=u+"|"+B,Q=f+"|"+O,t in o||Q in o?t in o&&!(Q in o)?o[Q]=o[t]:Q in o&&!(t in o)&&(o[t]=o[Q]):(o[t]=mm,o[Q]=mm,mm++),P[B][0]>2?S[o[t]]=[-P[B][0],P[B][1],o[t]]:S[o[t]]=[N[P[B][0]],P[B][1],o[t]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let g=0;g<20;g++){if(N=this.IDATA.face[g],r=N[2],w=N[1],p=N[0],b=q.x+"|"+q.y,t=g+"|"+b,t in o||(o[t]=r,S[r]=[N[P[b][0]],P[b][1]]),b=x.x+"|"+x.y,t=g+"|"+b,t in o||(o[t]=w,S[w]=[N[P[b][0]],P[b][1]]),b=H.x+"|"+H.y,t=g+"|"+b,t in o||(o[t]=p,S[p]=[N[P[b][0]],P[b][1]]),B=this.IDATA.edgematch[g][0],O=this.IDATA.edgematch[g][1],"B"===O)for(let mm=1;mm<K;mm++)M.x=u-mm*(z+Y),M.y=f+mm*z,l.x=-mm*Y,l.y=mm*(z+Y),b=M.x+"|"+M.y,J=l.x+"|"+l.y,R(g,B,b,J);if("O"===O)for(let mm=1;mm<K;mm++)l.x=-mm*Y,l.y=mm*(z+Y),E.x=mm*z,E.y=mm*Y,b=l.x+"|"+l.y,J=E.x+"|"+E.y,R(g,B,b,J);if(B=this.IDATA.edgematch[g][2],O=this.IDATA.edgematch[g][3],O&&"A"===O)for(let mm=1;mm<K;mm++)E.x=mm*z,E.y=mm*Y,M.x=u-(K-mm)*(z+Y),M.y=f+(K-mm)*z,b=E.x+"|"+E.y,J=M.x+"|"+M.y,R(g,B,b,J);for(let u=0;u<this.vertices.length;u++)b=this.vertices[u].x+"|"+this.vertices[u].y,t=g+"|"+b,t in o||(o[t]=mm++,P[b][0]>2?S[o[t]]=[-P[b][0],P[b][1],o[t]]:S[o[t]]=[N[P[b][0]],P[b][1],o[t]])}this.closestTo=S,this.vecToidx=o}calcCoeffs(){const mm=this.m,o=this.n,u=Math.sqrt(3)/3,f=mm*mm+o*o+mm*o;this.coau=(mm+o)/f,this.cobu=-o/f,this.coav=-u*(mm-o)/f,this.cobv=u*(2*mm+o)/f}createInnerFacets(){const mm=this.m,o=this.n;for(let u=0;u<o+mm+1;u++)for(let mm=this.min[u];mm<this.max[u]+1;mm++)mm<this.max[u]&&mm<this.max[u+1]+1&&this.innerFacets.push(["|"+mm+"|"+u,"|"+mm+"|"+(u+1),"|"+(mm+1)+"|"+u]),u>0&&mm<this.max[u-1]&&mm+1<this.max[u]+1&&this.innerFacets.push(["|"+mm+"|"+u,"|"+(mm+1)+"|"+u,"|"+(mm+1)+"|"+(u-1)])}edgeVecsABOB(){const mm=this.m,o=this.n,u=new om(-o,mm+o);for(let f=1;f<mm+o;f++){const mm=new om(this.min[f],f),o=new om(this.min[f-1],f-1),B=new om(this.min[f+1],f+1),O=mm.clone(),r=o.clone(),w=B.clone();O.rotate60About(u),r.rotate60About(u),w.rotate60About(u);const p=new om(this.max[O.y],O.y),K=new om(this.max[O.y-1],O.y-1),z=new om(this.max[O.y-1]-1,O.y-1);O.x===p.x&&O.y===p.y||(O.x!==K.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([mm,K,z]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([mm,z,p])):O.y===w.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([mm,o,K]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([mm,K,B])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([mm,o,K]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([mm,K,p])))}}mapABOBtoOBOA(){const mm=new om(0,0);for(let o=0;o<this.isoVecsABOB.length;o++){const u=[];for(let f=0;f<3;f++)mm.x=this.isoVecsABOB[o][f].x,mm.y=this.isoVecsABOB[o][f].y,0===this.vertexTypes[o][f]&&mm.rotateNeg120(this.m,this.n),u.push(mm.clone());this.isoVecsOBOA.push(u)}}mapABOBtoBAOA(){const mm=new om(0,0);for(let o=0;o<this.isoVecsABOB.length;o++){const u=[];for(let f=0;f<3;f++)mm.x=this.isoVecsABOB[o][f].x,mm.y=this.isoVecsABOB[o][f].y,1===this.vertexTypes[o][f]&&mm.rotate120(this.m,this.n),u.push(mm.clone());this.isoVecsBAOA.push(u)}}MapToFace(mm,o){const u=this.IDATA.face[mm],B=u[2],O=u[1],r=u[0],w=f.lo.So(this.IDATA.vertex[B]),p=f.lo.So(this.IDATA.vertex[O]),K=f.lo.So(this.IDATA.vertex[r]),z=p.Qo(w),Y=K.Qo(w),q=z.scale(this.coau).add(Y.scale(this.cobu)),x=z.scale(this.coav).add(Y.scale(this.cobv)),H=[];let E,M=f.TmpVectors.lo[0];for(let f=0;f<this.cartesian.length;f++)M=q.scale(this.cartesian[f].x).add(x.scale(this.cartesian[f].y)).add(w),H[f]=[M.x,M.y,M.z],E=mm+"|"+this.vertices[f].x+"|"+this.vertices[f].y,o.vertex[this.vecToidx[E]]=[M.x,M.y,M.z]}build(mm,o){const u=[],f=om.Zero(),B=new om(mm,o),O=new om(-o,mm+o);u.push(f,B,O);for(let b=o;b<mm+1;b++)for(let o=0;o<mm+1-b;o++)u.push(new om(o,b));if(o>0){const f=(0,e.HighestCommonFactor)(mm,o),B=mm/f,O=o/f;for(let w=1;w<f;w++)u.push(new om(w*B,w*O)),u.push(new om(-w*O,w*(B+O))),u.push(new om(mm-w*(B+O),o+w*B));const r=mm/o;for(let w=1;w<o;w++)for(let f=0;f<w*r;f++)u.push(new om(f,w)),u.push(new om(f,w).rotate120(mm,o)),u.push(new om(f,w).rotateNeg120(mm,o))}u.sort(((mm,o)=>mm.x-o.x)),u.sort(((mm,o)=>mm.y-o.y));const r=new Array(mm+o+1),w=new Array(mm+o+1);for(let b=0;b<r.length;b++)r[b]=1/0,w[b]=-1/0;let p=0,K=0;const z=u.length;for(let b=0;b<z;b++)K=u[b].x,p=u[b].y,r[p]=Math.min(K,r[p]),w[p]=Math.max(K,w[p]);const Y=(u,f)=>{const B=u.clone();return"A"===f&&B.rotateNeg120(mm,o),"B"===f&&B.rotate120(mm,o),B.x<0?B.y:B.x+B.y},q=[],x=[],H=[],E=[],M={},l=[];let t=-1,Q=-1;for(let b=0;b<z;b++)q[b]=u[b].toCartesianOrigin(new om(0,0),.5),x[b]=Y(u[b],"O"),H[b]=Y(u[b],"A"),E[b]=Y(u[b],"B"),x[b]===H[b]&&H[b]===E[b]?(t=3,Q=x[b]):x[b]===H[b]?(t=4,Q=x[b]):H[b]===E[b]?(t=5,Q=H[b]):E[b]===x[b]&&(t=6,Q=x[b]),x[b]<H[b]&&x[b]<E[b]&&(t=2,Q=x[b]),H[b]<x[b]&&H[b]<E[b]&&(t=1,Q=H[b]),E[b]<H[b]&&E[b]<x[b]&&(t=0,Q=E[b]),l.push([t,Q,u[b].x,u[b].y]);l.sort(((mm,o)=>mm[2]-o[2])),l.sort(((mm,o)=>mm[3]-o[3])),l.sort(((mm,o)=>mm[1]-o[1])),l.sort(((mm,o)=>mm[0]-o[0]));for(let b=0;b<l.length;b++)M[l[b][2]+"|"+l[b][3]]=[l[b][0],l[b][1],b];return this.m=mm,this.n=o,this.vertices=u,this.vertByDist=M,this.cartesian=q,this.min=r,this.max=w,this}}class fm{constructor(mm,o,u,f){this.name=mm,this.category=o,this.vertex=u,this.face=f}}class Bm extends fm{innerToData(mm,o){for(let u=0;u<o.innerFacets.length;u++)this.face.push(o.innerFacets[u].map((u=>o.vecToidx[mm+u])))}mapABOBtoDATA(mm,o){const u=o.IDATA.edgematch[mm][0];for(let f=0;f<o.isoVecsABOB.length;f++){const B=[];for(let O=0;O<3;O++)0===o.vertexTypes[f][O]?B.push(mm+"|"+o.isoVecsABOB[f][O].x+"|"+o.isoVecsABOB[f][O].y):B.push(u+"|"+o.isoVecsABOB[f][O].x+"|"+o.isoVecsABOB[f][O].y);this.face.push([o.vecToidx[B[0]],o.vecToidx[B[1]],o.vecToidx[B[2]]])}}mapOBOAtoDATA(mm,o){const u=o.IDATA.edgematch[mm][0];for(let f=0;f<o.isoVecsOBOA.length;f++){const B=[];for(let O=0;O<3;O++)1===o.vertexTypes[f][O]?B.push(mm+"|"+o.isoVecsOBOA[f][O].x+"|"+o.isoVecsOBOA[f][O].y):B.push(u+"|"+o.isoVecsOBOA[f][O].x+"|"+o.isoVecsOBOA[f][O].y);this.face.push([o.vecToidx[B[0]],o.vecToidx[B[1]],o.vecToidx[B[2]]])}}mapBAOAtoDATA(mm,o){const u=o.IDATA.edgematch[mm][2];for(let f=0;f<o.isoVecsBAOA.length;f++){const B=[];for(let O=0;O<3;O++)1===o.vertexTypes[f][O]?B.push(mm+"|"+o.isoVecsBAOA[f][O].x+"|"+o.isoVecsBAOA[f][O].y):B.push(u+"|"+o.isoVecsBAOA[f][O].x+"|"+o.isoVecsBAOA[f][O].y);this.face.push([o.vecToidx[B[0]],o.vecToidx[B[1]],o.vecToidx[B[2]]])}}orderData(mm){const o=[];for(let O=0;O<13;O++)o[O]=[];const u=mm.closestTo;for(let O=0;O<u.length;O++)u[O][0]>-1?u[O][1]>0&&o[u[O][0]].push([O,u[O][1]]):o[12].push([O,u[O][0]]);const f=[];for(let O=0;O<12;O++)f[O]=O;let B=12;for(let O=0;O<12;O++){o[O].sort(((mm,o)=>mm[1]-o[1]));for(let mm=0;mm<o[O].length;mm++)f[o[O][mm][0]]=B++}for(let O=0;O<o[12].length;O++)f[o[12][O][0]]=B++;for(let O=0;O<this.vertex.length;O++)this.vertex[O].push(f[O]);this.vertex.sort(((mm,o)=>mm[3]-o[3]));for(let O=0;O<this.vertex.length;O++)this.vertex[O].pop();for(let O=0;O<this.face.length;O++)for(let mm=0;mm<this.face[O].length;mm++)this.face[O][mm]=f[this.face[O][mm]];this.sharedNodes=o[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(mm,o){const u=[],f=[];let B=o.pop();f.push(B);let O=this.face[B].indexOf(mm);O=(O+2)%3;let r=this.face[B][O];u.push(r);let w=0;for(;o.length>0;)B=o[w],this.face[B].indexOf(r)>-1?(O=(this.face[B].indexOf(r)+1)%3,r=this.face[B][O],u.push(r),f.push(B),o.splice(w,1),w=0):w++;return this.adjacentFaces.push(u),f}toGoldbergPolyhedronData(){const mm=new fm("GeoDual","Goldberg",[],[]);mm.name="GD dual";const o=this.vertex.length,u=new Array(o);for(let p=0;p<o;p++)u[p]=[];for(let p=0;p<this.face.length;p++)for(let mm=0;mm<3;mm++)u[this.face[p][mm]].push(p);let f=0,B=0,O=0,r=[],w=[];this.adjacentFaces=[];for(let p=0;p<u.length;p++){mm.face[p]=this.setOrder(p,u[p].concat([]));for(const o of u[p]){f=0,B=0,O=0,r=this.face[o];for(let mm=0;mm<3;mm++)w=this.vertex[r[mm]],f+=w[0],B+=w[1],O+=w[2];mm.vertex[o]=[f/3,B/3,O/3]}}return mm}static BuildGeodesicData(mm){const o=new Bm("Geodesic-m-n","Geodesic",[[0,mo.f,-1],[-mo.f,1,0],[-1,0,-mo.f],[1,0,-mo.f],[mo.f,1,0],[0,mo.f,1],[-1,0,mo.f],[-mo.f,-1,0],[0,-mo.f,-1],[mo.f,-1,0],[1,0,mo.f],[0,-mo.f,1]],[]);mm.setIndices(),mm.calcCoeffs(),mm.createInnerFacets(),mm.edgeVecsABOB(),mm.mapABOBtoOBOA(),mm.mapABOBtoBAOA();for(let u=0;u<mm.IDATA.face.length;u++)mm.MapToFace(u,o),o.innerToData(u,mm),"B"===mm.IDATA.edgematch[u][1]&&o.mapABOBtoDATA(u,mm),"O"===mm.IDATA.edgematch[u][1]&&o.mapOBOAtoDATA(u,mm),"A"===mm.IDATA.edgematch[u][3]&&o.mapBAOAtoDATA(u,mm);o.orderData(mm);return o.vertex=o.vertex.map((function(mm){const o=mm[0],u=mm[1],f=mm[2],B=Math.sqrt(o*o+u*u+f*f);return mm[0]*=1/B,mm[1]*=1/B,mm[2]*=1/B,mm})),o}}B.d._GoldbergMeshParser=(mm,o)=>Om.Parse(mm,o);class Om extends B.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(mm,o){return void 0===o?(mm>this.goldbergData.nbUnsharedFaces-1&&(i.e.Warn("Maximum number of unshared faces used"),mm=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+mm):(mm>11&&(i.e.Warn("Last pole used"),mm=11),o>this.goldbergData.nbFacesAtPole-1&&(i.e.Warn("Maximum number of faces at a pole used"),o=this.goldbergData.nbFacesAtPole-1),12+mm*this.goldbergData.nbFacesAtPole+o)}_changeGoldbergFaceColors(mm){for(let u=0;u<mm.length;u++){const o=mm[u][0],f=mm[u][1],B=mm[u][2];for(let mm=o;mm<f+1;mm++)this.goldbergData.faceColors[mm]=B}const o=[];for(let u=0;u<12;u++)for(let mm=0;mm<5;mm++)o.push(this.goldbergData.faceColors[u].r,this.goldbergData.faceColors[u].g,this.goldbergData.faceColors[u].b,this.goldbergData.faceColors[u].a);for(let u=12;u<this.goldbergData.faceColors.length;u++)for(let mm=0;mm<6;mm++)o.push(this.goldbergData.faceColors[u].r,this.goldbergData.faceColors[u].g,this.goldbergData.faceColors[u].b,this.goldbergData.faceColors[u].a);return o}setGoldbergFaceColors(mm){const o=this._changeGoldbergFaceColors(mm);this.Xm(O.f.ColorKind,o)}updateGoldbergFaceColors(mm){const o=this._changeGoldbergFaceColors(mm);this.updateVerticesData(O.f.ColorKind,o)}_changeGoldbergFaceUVs(mm){const o=this.getVerticesData(O.f.UVKind);for(let u=0;u<mm.length;u++){const f=mm[u][0],B=mm[u][1],O=mm[u][2],r=mm[u][3],w=mm[u][4],p=[],K=[];let z,Y;for(let mm=0;mm<5;mm++)z=O.x+r*Math.cos(w+mm*Math.PI/2.5),Y=O.y+r*Math.sin(w+mm*Math.PI/2.5),z<0&&(z=0),z>1&&(z=1),p.push(z,Y);for(let mm=0;mm<6;mm++)z=O.x+r*Math.cos(w+mm*Math.PI/3),Y=O.y+r*Math.sin(w+mm*Math.PI/3),z<0&&(z=0),z>1&&(z=1),K.push(z,Y);for(let mm=f;mm<Math.min(12,B+1);mm++)for(let u=0;u<5;u++)o[10*mm+2*u]=p[2*u],o[10*mm+2*u+1]=p[2*u+1];for(let mm=Math.max(12,f);mm<B+1;mm++)for(let u=0;u<6;u++)o[12*mm-24+2*u]=K[2*u],o[12*mm-23+2*u]=K[2*u+1]}return o}setGoldbergFaceUVs(mm){const o=this._changeGoldbergFaceUVs(mm);this.Xm(O.f.UVKind,o)}updateGoldbergFaceUVs(mm){const o=this._changeGoldbergFaceUVs(mm);this.updateVerticesData(O.f.UVKind,o)}placeOnGoldbergFaceAt(mm,o,u){const B=f.lo.RotationFromAxis(this.goldbergData.faceXaxis[o],this.goldbergData.faceYaxis[o],this.goldbergData.faceZaxis[o]);mm.rotation=B,mm.position=this.goldbergData.faceCenters[o].add(this.goldbergData.faceXaxis[o].scale(u.x)).add(this.goldbergData.faceYaxis[o].scale(u.y)).add(this.goldbergData.faceZaxis[o].scale(u.z))}serialize(mm){super.serialize(mm),mm.type="GoldbergMesh";const o={};if(o.adjacentFaces=this.goldbergData.adjacentFaces,o.nbSharedFaces=this.goldbergData.nbSharedFaces,o.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,o.nbFaces=this.goldbergData.nbFaces,o.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){o.faceColors=[];for(const mm of this.goldbergData.faceColors)o.faceColors.push(mm.df())}if(this.goldbergData.faceCenters){o.faceCenters=[];for(const mm of this.goldbergData.faceCenters)o.faceCenters.push(mm.df())}if(this.goldbergData.faceZaxis){o.faceZaxis=[];for(const mm of this.goldbergData.faceZaxis)o.faceZaxis.push(mm.df())}if(this.goldbergData.faceYaxis){o.faceYaxis=[];for(const mm of this.goldbergData.faceYaxis)o.faceYaxis.push(mm.df())}if(this.goldbergData.faceXaxis){o.faceXaxis=[];for(const mm of this.goldbergData.faceXaxis)o.faceXaxis.push(mm.df())}mm.goldbergData=o}static Parse(mm,o){const u=mm.goldbergData;u.faceColors=u.faceColors.map((mm=>q.pp.So(mm))),u.faceCenters=u.faceCenters.map((mm=>f.lo.So(mm))),u.faceZaxis=u.faceZaxis.map((mm=>f.lo.So(mm))),u.faceXaxis=u.faceXaxis.map((mm=>f.lo.So(mm))),u.faceYaxis=u.faceYaxis.map((mm=>f.lo.So(mm)));const B=new Om(mm.name,o);return B.goldbergData=u,B}}var rm=u(13264);const wm={CreateBox:Y.d,CreateTiledBox:M,CreateSphere:l.b,CreateDisc:z.e,CreateIcoSphere:d,CreateRibbon:K,CreateCylinder:J,CreateTorus:S,CreateTorusKnot:R,CreateLineSystem:g.i,Bz:g.l,CreateDashedLines:g.e,ExtrudeShape:c,ExtrudeShapeCustom:A,CreateLathe:I,CreateTiledPlane:H,wz:s.b,CreateGround:j.f,CreateTiledGround:j.g,CreateGroundFromHeightMap:j.c,CreatePolygon:W.e,ExtrudePolygon:W.g,CreateTube:a,CreatePolyhedron:G,CreateGeodesic:function(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=o.m||1;f!==Math.floor(f)&&(f=Math.floor(f),i.e.Warn("m not an integer only floor(m) used"));let B=o.n||0;if(B!==Math.floor(B)&&(B=Math.floor(B),i.e.Warn("n not an integer only floor(n) used")),B>f){const mm=B;B=f,f=mm,i.e.Warn("n > m therefore m and n swapped")}const O=new um;return O.build(f,B),G(mm,{custom:Bm.BuildGeodesicData(O),size:o.size,sizeX:o.sizeX,sizeY:o.sizeY,sizeZ:o.sizeZ,faceUV:o.faceUV,faceColors:o.faceColors,flat:o.flat,updatable:o.updatable,sideOrientation:o.sideOrientation,frontUVs:o.frontUVs,backUVs:o.backUVs},u)},CreateGoldberg:function(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=o.size,p=o.sizeX||O||1,K=o.sizeY||O||1,z=o.sizeZ||O||1;let Y=o.m||1;Y!==Math.floor(Y)&&(Y=Math.floor(Y),i.e.Warn("m not an integer only floor(m) used"));let x=o.n||0;if(x!==Math.floor(x)&&(x=Math.floor(x),i.e.Warn("n not an integer only floor(n) used")),x>Y){const mm=x;x=Y,Y=mm,i.e.Warn("n > m therefore m and n swapped")}const H=new um;H.build(Y,x);const E=Bm.BuildGeodesicData(H),M=E.toGoldbergPolyhedronData(),l=new Om(mm,u);o.sideOrientation=B.d._GetDefaultSideOrientation(o.sideOrientation),l._originalBuilderSideOrientation=o.sideOrientation;(function(mm,o){const u=mm.size,B=mm.sizeX||u||1,O=mm.sizeY||u||1,p=mm.sizeZ||u||1,K=0===mm.sideOrientation?0:mm.sideOrientation||r.b.DEFAULTSIDE,z=[],Y=[],q=[],x=[];let H=1/0,E=-1/0,M=1/0,l=-1/0;for(let f=0;f<o.vertex.length;f++)H=Math.min(H,o.vertex[f][0]*B),E=Math.max(E,o.vertex[f][0]*B),M=Math.min(M,o.vertex[f][1]*O),l=Math.max(l,o.vertex[f][1]*O);let t=0;for(let r=0;r<o.face.length;r++){const mm=o.face[r],u=f.lo.So(o.vertex[mm[0]]),K=f.lo.So(o.vertex[mm[2]]),Q=f.lo.So(o.vertex[mm[1]]),b=K.Qo(u),J=Q.Qo(u),N=f.lo.Cross(J,b).normalize();for(let f=0;f<mm.length;f++){q.push(N.x,N.y,N.z);const u=o.vertex[mm[f]];z.push(u[0]*B,u[1]*O,u[2]*p);const r=(u[1]*O-M)/(l-M);x.push((u[0]*B-H)/(E-H),w.d?1-r:r)}for(let o=0;o<mm.length-2;o++)Y.push(t,t+o+2,t+o+1);t+=mm.length}r.b._ComputeSides(K,z,Y,q,x);const Q=new r.b;return Q.gm=z,Q.indices=Y,Q.Wm=q,Q.Am=x,Q})(o,M).Im(l,o.updatable),l.goldbergData.nbSharedFaces=E.sharedNodes,l.goldbergData.nbUnsharedFaces=E.poleNodes,l.goldbergData.adjacentFaces=E.adjacentFaces,l.goldbergData.nbFaces=l.goldbergData.nbSharedFaces+l.goldbergData.nbUnsharedFaces,l.goldbergData.nbFacesAtPole=(l.goldbergData.nbUnsharedFaces-12)/12;for(let B=0;B<E.vertex.length;B++)l.goldbergData.faceCenters.push(f.lo.So(E.vertex[B])),l.goldbergData.faceCenters[B].x*=p,l.goldbergData.faceCenters[B].y*=K,l.goldbergData.faceCenters[B].z*=z,l.goldbergData.faceColors.push(new q.pp(1,1,1,1));for(let B=0;B<M.face.length;B++){const mm=M.face[B],o=f.lo.So(M.vertex[mm[0]]),u=f.lo.So(M.vertex[mm[2]]),O=f.lo.So(M.vertex[mm[1]]),r=u.Qo(o),w=O.Qo(o),p=f.lo.Cross(w,r).normalize(),K=f.lo.Cross(w,p).normalize();l.goldbergData.faceXaxis.push(w.normalize()),l.goldbergData.faceYaxis.push(p),l.goldbergData.faceZaxis.push(K)}return l},CreateDecal:Z,CreateCapsule:D,CreateText:rm.d}},13857:(mm,o,u)=>{"use strict";u.d(o,{e:()=>wo});var f=u(12740),B=u(13109);class O extends B.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var r=u(12780),w=(u(12896),u(12702));class p{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(mm){this._targetStopDuration!==mm&&(this._targetStopDuration=mm)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(mm){this._noiseTexture!==mm&&(this._noiseTexture=mm,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(mm){this._animationSheetEnabled!==mm&&(this._animationSheetEnabled=mm)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(mm){this._isAnimationSheetEnabled!=mm&&(this._isAnimationSheetEnabled=mm,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(mm){this._useLogarithmicDepth=mm&&this.Pm().getEngine().getCaps().fragmentDepthSupported}Pm(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(mm){switch(mm){case p.BLENDMODE_MULTIPLYADD:return;case p.BLENDMODE_ADD:mm=1;break;case p.BLENDMODE_ONEONE:mm=6;break;case p.BLENDMODE_STANDARD:mm=2;break;case p.BLENDMODE_MULTIPLY:mm=4;break;case p.BLENDMODE_SUBTRACT:mm=3}this._engine.setAlphaMode(mm)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:f.lo.Zero()}set direction1(mm){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=mm)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:f.lo.Zero()}set direction2(mm){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=mm)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:f.lo.Zero()}set minEmitBox(mm){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=mm)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:f.lo.Zero()}set maxEmitBox(mm){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=mm)}get billboardMode(){return this._billboardMode}set billboardMode(mm){this._billboardMode!==mm&&(this._billboardMode=mm,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(mm){this._isBillboardBased!==mm&&(this._isBillboardBased=mm,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(mm){this._attachImageProcessingConfiguration(mm)}_attachImageProcessingConfiguration(mm){mm!==this._imageProcessingConfiguration&&(!mm&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=mm)}_reset(){}_removeGradientAndTexture(mm,o,u){if(!o)return this;let f=0;for(const B of o){if(B.gradient===mm){o.splice(f,1);break}f++}return u&&u.dispose(),this}constructor(mm){this.animations=[],this.renderingGroupId=0,this.ro=f.lo.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new f.lo(10,10,10),this.onAnimationEnd=null,this.blendMode=p.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new f.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.oz=new f.lo(0,0,0),this._useLogarithmicDepth=!1,this.gravity=f.lo.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new r.pp(1,1,1,1),this.color2=new r.pp(1,1,1,1),this.colorDead=new r.pp(0,0,0,1),this.textureMask=new r.pp(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new O,this.id=mm,this.name=mm}createPointEmitter(mm,o){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new f.lo(0,1,0),arguments.length>2&&void 0!==arguments[2]||new f.lo(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new f.lo(0,1,0),arguments.length>4&&void 0!==arguments[4]||new f.lo(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new f.lo(0,1,0),arguments.length>3&&void 0!==arguments[3]||new f.lo(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(mm,o,u,f){throw new Error("Method not implemented.")}}p.BLENDMODE_ONEONE=0,p.BLENDMODE_STANDARD=1,p.BLENDMODE_ADD=2,p.BLENDMODE_MULTIPLY=3,p.BLENDMODE_MULTIPLYADD=4,p.BLENDMODE_SUBTRACT=-1,(0,w.c)("BABYLON.BaseParticleSystem",p);var K=u(12752),z=u(12574);class Y{constructor(){this.direction1=new f.lo(0,1,0),this.direction2=new f.lo(0,1,0),this.minEmitBox=new f.lo(-.5,-.5,-.5),this.maxEmitBox=new f.lo(.5,.5,.5)}startDirectionFunction(mm,o,u,B){const O=(0,K.RandomRange)(this.direction1.x,this.direction2.x),r=(0,K.RandomRange)(this.direction1.y,this.direction2.y),w=(0,K.RandomRange)(this.direction1.z,this.direction2.z);if(B)return o.x=O,o.y=r,void(o.z=w);f.lo.TransformNormalFromFloatsToRef(O,r,w,mm,o)}startPositionFunction(mm,o,u,B){const O=(0,K.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),r=(0,K.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),w=(0,K.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(B)return o.x=O,o.y=r,void(o.z=w);f.lo.TransformCoordinatesFromFloatsToRef(O,r,w,mm,o)}clone(){const mm=new Y;return z.b.DeepCopy(this,mm),mm}applyToShader(mm){mm.setVector3("direction1",this.direction1),mm.setVector3("direction2",this.direction2),mm.setVector3("minEmitBox",this.minEmitBox),mm.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(mm){mm.addUniform("direction1",3),mm.addUniform("direction2",3),mm.addUniform("minEmitBox",3),mm.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const mm={};return mm.type=this.getClassName(),mm.direction1=this.direction1.df(),mm.direction2=this.direction2.df(),mm.minEmitBox=this.minEmitBox.df(),mm.maxEmitBox=this.maxEmitBox.df(),mm}parse(mm){f.lo.FromArrayToRef(mm.direction1,0,this.direction1),f.lo.FromArrayToRef(mm.direction2,0,this.direction2),f.lo.FromArrayToRef(mm.minEmitBox,0,this.minEmitBox),f.lo.FromArrayToRef(mm.maxEmitBox,0,this.maxEmitBox)}}class q{get radius(){return this._radius}set radius(mm){this._radius=mm,this._buildHeight()}get angle(){return this._angle}set angle(mm){this._angle=mm,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=u,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=o,this.radius=mm}startDirectionFunction(mm,o,u,B){B?f.TmpVectors.lo[0].p(u.yp).normalize():u.position.subtractToRef(mm.getTranslation(),f.TmpVectors.lo[0]).normalize();const O=(0,K.RandomRange)(0,this.directionRandomizer),r=(0,K.RandomRange)(0,this.directionRandomizer),w=(0,K.RandomRange)(0,this.directionRandomizer);o.x=f.TmpVectors.lo[0].x+O,o.y=f.TmpVectors.lo[0].y+r,o.z=f.TmpVectors.lo[0].z+w,o.normalize()}startPositionFunction(mm,o,u,B){const O=(0,K.RandomRange)(0,2*Math.PI);let r;this.emitFromSpawnPointOnly?r=1e-4:(r=(0,K.RandomRange)(0,this.heightRange),r=1-r*r);let w=this._radius-(0,K.RandomRange)(0,this._radius*this.radiusRange);w*=r;const p=w*Math.sin(O),z=w*Math.cos(O),Y=r*this._height;if(B)return o.x=p,o.y=Y,void(o.z=z);f.lo.TransformCoordinatesFromFloatsToRef(p,Y,z,mm,o)}clone(){const mm=new q(this._radius,this._angle,this.directionRandomizer);return z.b.DeepCopy(this,mm),mm}applyToShader(mm){mm.setFloat2("radius",this._radius,this.radiusRange),mm.setFloat("coneAngle",this._angle),mm.setFloat2("height",this._height,this.heightRange),mm.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(mm){mm.addUniform("radius",2),mm.addUniform("coneAngle",1),mm.addUniform("height",2),mm.addUniform("directionRandomizer",1)}getEffectDefines(){let mm="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(mm+="\n#define CONEEMITTERSPAWNPOINT"),mm}getClassName(){return"ConeParticleEmitter"}serialize(){const mm={};return mm.type=this.getClassName(),mm.radius=this._radius,mm.angle=this._angle,mm.directionRandomizer=this.directionRandomizer,mm.radiusRange=this.radiusRange,mm.heightRange=this.heightRange,mm.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,mm}parse(mm){this.radius=mm.radius,this.angle=mm.angle,this.directionRandomizer=mm.directionRandomizer,this.radiusRange=void 0!==mm.radiusRange?mm.radiusRange:1,this.heightRange=void 0!==mm.radiusRange?mm.heightRange:1,this.emitFromSpawnPointOnly=void 0!==mm.emitFromSpawnPointOnly&&mm.emitFromSpawnPointOnly}}class x extends q{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.lo(0,1,0),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.lo(0,1,0);super(mm,o),this.direction1=u,this.direction2=B}startDirectionFunction(mm,o){const u=(0,K.RandomRange)(this.direction1.x,this.direction2.x),B=(0,K.RandomRange)(this.direction1.y,this.direction2.y),O=(0,K.RandomRange)(this.direction1.z,this.direction2.z);f.lo.TransformNormalFromFloatsToRef(u,B,O,mm,o)}clone(){const mm=new x(this.radius,this.angle,this.direction1,this.direction2);return z.b.DeepCopy(this,mm),mm}applyToShader(mm){mm.setFloat("radius",this.radius),mm.setFloat("radiusRange",this.radiusRange),mm.setVector3("direction1",this.direction1),mm.setVector3("direction2",this.direction2)}buildUniformLayout(mm){mm.addUniform("radius",1),mm.addUniform("radiusRange",1),mm.addUniform("direction1",3),mm.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const mm=super.serialize();return mm.direction1=this.direction1.df(),mm.direction2=this.direction2.df(),mm}parse(mm){super.parse(mm),this.direction1.p(mm.direction1),this.direction2.p(mm.direction2)}}class H{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=mm,this.height=o,this.radiusRange=u,this.directionRandomizer=B,this._tempVector=f.lo.Zero()}startDirectionFunction(mm,o,u,B,O){u.position.subtractToRef(mm.getTranslation(),this._tempVector),this._tempVector.normalize(),f.lo.TransformNormalToRef(this._tempVector,O,this._tempVector);const r=(0,K.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let w=Math.atan2(this._tempVector.x,this._tempVector.z);w+=(0,K.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=r,this._tempVector.x=Math.sin(w),this._tempVector.z=Math.cos(w),this._tempVector.normalize(),B?o.p(this._tempVector):f.lo.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,mm,o)}startPositionFunction(mm,o,u,B){const O=(0,K.RandomRange)(-this.height/2,this.height/2),r=(0,K.RandomRange)(0,2*Math.PI),w=(0,K.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),p=Math.sqrt(w)*this.radius,z=p*Math.cos(r),Y=p*Math.sin(r);B?o.Op(z,O,Y):f.lo.TransformCoordinatesFromFloatsToRef(z,O,Y,mm,o)}clone(){const mm=new H(this.radius,this.directionRandomizer);return z.b.DeepCopy(this,mm),mm}applyToShader(mm){mm.setFloat("radius",this.radius),mm.setFloat("height",this.height),mm.setFloat("radiusRange",this.radiusRange),mm.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(mm){mm.addUniform("radius",1),mm.addUniform("height",1),mm.addUniform("radiusRange",1),mm.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const mm={};return mm.type=this.getClassName(),mm.radius=this.radius,mm.height=this.height,mm.radiusRange=this.radiusRange,mm.directionRandomizer=this.directionRandomizer,mm}parse(mm){this.radius=mm.radius,this.height=mm.height,this.radiusRange=mm.radiusRange,this.directionRandomizer=mm.directionRandomizer}}class E extends H{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.lo(0,1,0),O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new f.lo(0,1,0);super(mm,o,u),this.direction1=B,this.direction2=O}startDirectionFunction(mm,o,u,B){const O=(0,K.RandomRange)(this.direction1.x,this.direction2.x),r=(0,K.RandomRange)(this.direction1.y,this.direction2.y),w=(0,K.RandomRange)(this.direction1.z,this.direction2.z);B?o.Op(O,r,w):f.lo.TransformNormalFromFloatsToRef(O,r,w,mm,o)}clone(){const mm=new E(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return z.b.DeepCopy(this,mm),mm}applyToShader(mm){mm.setFloat("radius",this.radius),mm.setFloat("height",this.height),mm.setFloat("radiusRange",this.radiusRange),mm.setVector3("direction1",this.direction1),mm.setVector3("direction2",this.direction2)}buildUniformLayout(mm){mm.addUniform("radius",1),mm.addUniform("height",1),mm.addUniform("radiusRange",1),mm.addUniform("direction1",3),mm.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const mm=super.serialize();return mm.direction1=this.direction1.df(),mm.direction2=this.direction2.df(),mm}parse(mm){super.parse(mm),f.lo.FromArrayToRef(mm.direction1,0,this.direction1),f.lo.FromArrayToRef(mm.direction2,0,this.direction2)}}class M{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=mm,this.radiusRange=o,this.directionRandomizer=u}startDirectionFunction(mm,o,u,B){const O=u.position.Qo(mm.getTranslation()).normalize(),r=(0,K.RandomRange)(0,this.directionRandomizer),w=(0,K.RandomRange)(0,this.directionRandomizer),p=(0,K.RandomRange)(0,this.directionRandomizer);O.x+=r,O.y+=w,O.z+=p,O.normalize(),B?o.p(O):f.lo.TransformNormalFromFloatsToRef(O.x,O.y,O.z,mm,o)}startPositionFunction(mm,o,u,B){const O=this.radius-(0,K.RandomRange)(0,this.radius*this.radiusRange),r=(0,K.RandomRange)(0,1),w=(0,K.RandomRange)(0,2*Math.PI),p=Math.acos(2*r-1),z=O*Math.cos(w)*Math.sin(p),Y=O*Math.cos(p),q=O*Math.sin(w)*Math.sin(p);B?o.Op(z,Math.abs(Y),q):f.lo.TransformCoordinatesFromFloatsToRef(z,Math.abs(Y),q,mm,o)}clone(){const mm=new M(this.radius,this.directionRandomizer);return z.b.DeepCopy(this,mm),mm}applyToShader(mm){mm.setFloat("radius",this.radius),mm.setFloat("radiusRange",this.radiusRange),mm.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(mm){mm.addUniform("radius",1),mm.addUniform("radiusRange",1),mm.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const mm={};return mm.type=this.getClassName(),mm.radius=this.radius,mm.radiusRange=this.radiusRange,mm.directionRandomizer=this.directionRandomizer,mm}parse(mm){this.radius=mm.radius,this.radiusRange=mm.radiusRange,this.directionRandomizer=mm.directionRandomizer}}class l{constructor(){this.direction1=new f.lo(0,1,0),this.direction2=new f.lo(0,1,0)}startDirectionFunction(mm,o,u,B){const O=(0,K.RandomRange)(this.direction1.x,this.direction2.x),r=(0,K.RandomRange)(this.direction1.y,this.direction2.y),w=(0,K.RandomRange)(this.direction1.z,this.direction2.z);B?o.Op(O,r,w):f.lo.TransformNormalFromFloatsToRef(O,r,w,mm,o)}startPositionFunction(mm,o,u,B){B?o.Op(0,0,0):f.lo.TransformCoordinatesFromFloatsToRef(0,0,0,mm,o)}clone(){const mm=new l;return z.b.DeepCopy(this,mm),mm}applyToShader(mm){mm.setVector3("direction1",this.direction1),mm.setVector3("direction2",this.direction2)}buildUniformLayout(mm){mm.addUniform("direction1",3),mm.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const mm={};return mm.type=this.getClassName(),mm.direction1=this.direction1.df(),mm.direction2=this.direction2.df(),mm}parse(mm){f.lo.FromArrayToRef(mm.direction1,0,this.direction1),f.lo.FromArrayToRef(mm.direction2,0,this.direction2)}}class t{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=mm,this.radiusRange=o,this.directionRandomizer=u}startDirectionFunction(mm,o,u,B){const O=u.position.Qo(mm.getTranslation()).normalize(),r=(0,K.RandomRange)(0,this.directionRandomizer),w=(0,K.RandomRange)(0,this.directionRandomizer),p=(0,K.RandomRange)(0,this.directionRandomizer);O.x+=r,O.y+=w,O.z+=p,O.normalize(),B?o.p(O):f.lo.TransformNormalFromFloatsToRef(O.x,O.y,O.z,mm,o)}startPositionFunction(mm,o,u,B){const O=this.radius-(0,K.RandomRange)(0,this.radius*this.radiusRange),r=(0,K.RandomRange)(0,1),w=(0,K.RandomRange)(0,2*Math.PI),p=Math.acos(2*r-1),z=O*Math.cos(w)*Math.sin(p),Y=O*Math.cos(p),q=O*Math.sin(w)*Math.sin(p);B?o.Op(z,Y,q):f.lo.TransformCoordinatesFromFloatsToRef(z,Y,q,mm,o)}clone(){const mm=new t(this.radius,this.directionRandomizer);return z.b.DeepCopy(this,mm),mm}applyToShader(mm){mm.setFloat("radius",this.radius),mm.setFloat("radiusRange",this.radiusRange),mm.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(mm){mm.addUniform("radius",1),mm.addUniform("radiusRange",1),mm.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const mm={};return mm.type=this.getClassName(),mm.radius=this.radius,mm.radiusRange=this.radiusRange,mm.directionRandomizer=this.directionRandomizer,mm}parse(mm){this.radius=mm.radius,this.radiusRange=mm.radiusRange,this.directionRandomizer=mm.directionRandomizer}}class Q extends t{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.lo(0,1,0),u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.lo(0,1,0);super(mm),this.direction1=o,this.direction2=u}startDirectionFunction(mm,o){const u=(0,K.RandomRange)(this.direction1.x,this.direction2.x),B=(0,K.RandomRange)(this.direction1.y,this.direction2.y),O=(0,K.RandomRange)(this.direction1.z,this.direction2.z);f.lo.TransformNormalFromFloatsToRef(u,B,O,mm,o)}clone(){const mm=new Q(this.radius,this.direction1,this.direction2);return z.b.DeepCopy(this,mm),mm}applyToShader(mm){mm.setFloat("radius",this.radius),mm.setFloat("radiusRange",this.radiusRange),mm.setVector3("direction1",this.direction1),mm.setVector3("direction2",this.direction2)}buildUniformLayout(mm){mm.addUniform("radius",1),mm.addUniform("radiusRange",1),mm.addUniform("direction1",3),mm.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const mm=super.serialize();return mm.direction1=this.direction1.df(),mm.direction2=this.direction2.df(),mm}parse(mm){super.parse(mm),this.direction1.p(mm.direction1),this.direction2.p(mm.direction2)}}class b{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(mm,o,u,B){const O=f.TmpVectors.lo[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,u,O);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,u,O);const mm=f.TmpVectors.lo[1];O.subtractToRef(u.position,mm),mm.scaleToRef(1/u.lifeTime,O)}else O.set(0,0,0);B?o.p(O):f.lo.TransformNormalToRef(O,mm,o)}startPositionFunction(mm,o,u,B){const O=f.TmpVectors.lo[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,u,O):O.set(0,0,0),B?o.p(O):f.lo.TransformCoordinatesToRef(O,mm,o)}clone(){const mm=new b;return z.b.DeepCopy(this,mm),mm}applyToShader(mm){}buildUniformLayout(mm){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const mm={};return mm.type=this.getClassName(),mm.particlePositionGenerator=this.particlePositionGenerator,mm.particleDestinationGenerator=this.particleDestinationGenerator,mm}parse(mm){mm.particlePositionGenerator&&(this.particlePositionGenerator=mm.particlePositionGenerator),mm.particleDestinationGenerator&&(this.particleDestinationGenerator=mm.particleDestinationGenerator)}}var J=u(12809);class N{get mesh(){return this._mesh}set mesh(mm){this._mesh!==mm&&(this._mesh=mm,mm?(this._indices=mm.hr(),this._positions=mm.getVerticesData(J.f.PositionKind),this._normals=mm.getVerticesData(J.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=f.lo.Zero(),this._mesh=null,this.direction1=new f.lo(0,1,0),this.direction2=new f.lo(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=mm}startDirectionFunction(mm,o,u,B){if(this.useMeshNormalsForDirection&&this._normals)return void f.lo.TransformNormalToRef(this._storedNormal,mm,o);const O=(0,K.RandomRange)(this.direction1.x,this.direction2.x),r=(0,K.RandomRange)(this.direction1.y,this.direction2.y),w=(0,K.RandomRange)(this.direction1.z,this.direction2.z);B?o.Op(O,r,w):f.lo.TransformNormalFromFloatsToRef(O,r,w,mm,o)}startPositionFunction(mm,o,u,B){if(!this._indices||!this._positions)return;const O=3*(Math.random()*(this._indices.length/3)|0),r=Math.random(),w=Math.random()*(1-r),p=1-r-w,K=this._indices[O],z=this._indices[O+1],Y=this._indices[O+2],q=f.TmpVectors.lo[0],x=f.TmpVectors.lo[1],H=f.TmpVectors.lo[2],E=f.TmpVectors.lo[3];f.lo.FromArrayToRef(this._positions,3*K,q),f.lo.FromArrayToRef(this._positions,3*z,x),f.lo.FromArrayToRef(this._positions,3*Y,H),E.x=r*q.x+w*x.x+p*H.x,E.y=r*q.y+w*x.y+p*H.y,E.z=r*q.z+w*x.z+p*H.z,B?o.Op(E.x,E.y,E.z):f.lo.TransformCoordinatesFromFloatsToRef(E.x,E.y,E.z,mm,o),this.useMeshNormalsForDirection&&this._normals&&(f.lo.FromArrayToRef(this._normals,3*K,q),f.lo.FromArrayToRef(this._normals,3*z,x),f.lo.FromArrayToRef(this._normals,3*Y,H),this._storedNormal.x=r*q.x+w*x.x+p*H.x,this._storedNormal.y=r*q.y+w*x.y+p*H.y,this._storedNormal.z=r*q.z+w*x.z+p*H.z)}clone(){const mm=new N(this.mesh);return z.b.DeepCopy(this,mm),mm}applyToShader(mm){mm.setVector3("direction1",this.direction1),mm.setVector3("direction2",this.direction2)}buildUniformLayout(mm){mm.addUniform("direction1",3),mm.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var mm;const o={};return o.type=this.getClassName(),o.direction1=this.direction1.df(),o.direction2=this.direction2.df(),o.meshId=null===(mm=this.mesh)||void 0===mm?void 0:mm.id,o.useMeshNormalsForDirection=this.useMeshNormalsForDirection,o}parse(mm,o){f.lo.FromArrayToRef(mm.direction1,0,this.direction1),f.lo.FromArrayToRef(mm.direction2,0,this.direction2),mm.meshId&&o&&(this.mesh=o.getLastMeshById(mm.meshId)),this.useMeshNormalsForDirection=mm.useMeshNormalsForDirection}}class S{_isUbo(mm){return void 0!==mm.addUniform}constructor(mm){this._isUbo(mm)?(this.setMatrix3x3=mm.updateMatrix3x3.bind(mm),this.setMatrix2x2=mm.updateMatrix2x2.bind(mm),this.setFloat=mm.updateFloat.bind(mm),this.setFloat2=mm.updateFloat2.bind(mm),this.setFloat3=mm.updateFloat3.bind(mm),this.setFloat4=mm.updateFloat4.bind(mm),this.setFloatArray=mm.updateFloatArray.bind(mm),this.setArray=mm.updateArray.bind(mm),this.setIntArray=mm.updateIntArray.bind(mm),this.setMatrix=mm.Tf.bind(mm),this.setMatrices=mm.updateMatrices.bind(mm),this.setVector3=mm.updateVector3.bind(mm),this.setVector4=mm.updateVector4.bind(mm),this.setColor3=mm.updateColor3.bind(mm),this.setColor4=mm.updateColor4.bind(mm),this.setDirectColor4=mm.updateDirectColor4.bind(mm),this.setInt=mm.updateInt.bind(mm),this.setInt2=mm.updateInt2.bind(mm),this.setInt3=mm.updateInt3.bind(mm),this.setInt4=mm.updateInt4.bind(mm)):(this.setMatrix3x3=mm.setMatrix3x3.bind(mm),this.setMatrix2x2=mm.setMatrix2x2.bind(mm),this.setFloat=mm.setFloat.bind(mm),this.setFloat2=mm.setFloat2.bind(mm),this.setFloat3=mm.setFloat3.bind(mm),this.setFloat4=mm.setFloat4.bind(mm),this.setFloatArray=mm.setFloatArray.bind(mm),this.setArray=mm.setArray.bind(mm),this.setIntArray=mm.setIntArray.bind(mm),this.setMatrix=mm.setMatrix.bind(mm),this.setMatrices=mm.setMatrices.bind(mm),this.setVector3=mm.setVector3.bind(mm),this.setVector4=mm.setVector4.bind(mm),this.setColor3=mm.setColor3.bind(mm),this.setColor4=mm.setColor4.bind(mm),this.setDirectColor4=mm.setDirectColor4.bind(mm),this.setInt=mm.setInt.bind(mm),this.setInt2=mm.setInt2.bind(mm),this.setInt3=mm.setInt3.bind(mm),this.setInt4=mm.setInt4.bind(mm))}}var P=u(12652);const R="gpuUpdateParticlesPixelShader",g="#version 300 es\nvoid main() {discard;}\n";P.e.ShadersStore[R]||(P.e.ShadersStore[R]=g);const W="gpuUpdateParticlesVertexShader",F="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";P.e.ShadersStore[W]||(P.e.ShadersStore[W]=F);(0,w.c)("BABYLON.WebGL2ParticleSystem",class{constructor(mm,o){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=mm,this._engine=o,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var mm;return(null===(mm=this._updateEffect)||void 0===mm?void 0:mm.isReady())??!1}createUpdateBuffer(mm){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof b&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=mm,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new S(this._updateEffect)}createVertexBuffers(mm,o){this._updateVAO.push(this._createUpdateVAO(mm)),this._renderVAO.push(this._engine.recordVertexArrayObject(o,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=o}createParticleBuffer(mm){return mm}bindDrawBuffers(mm,o,u){u?this._engine.bindBuffers(this._renderVertexBuffers,u,o):this._engine.bindVertexArrayObject(this._renderVAO[mm],null)}preUpdateParticleBuffer(){const mm=this._engine;if(this._engine.enableEffect(this._updateEffect),!mm.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(mm,o,u){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[mm],null);const f=this._engine;f.bindTransformFeedbackBuffer(o.getBuffer()),f.setRasterizerState(!1),f.beginTransformFeedback(!0),f.drawArraysType(3,0,u),f.endTransformFeedback(),f.setRasterizerState(!0),f.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let mm=0;mm<this._updateVAO.length;mm++)this._engine.releaseVertexArrayObject(this._updateVAO[mm]);this._updateVAO.length=0;for(let mm=0;mm<this._renderVAO.length;mm++)this._engine.releaseVertexArrayObject(this._renderVAO[mm]);this._renderVAO.length=0}_createUpdateVAO(mm){const o={};o.position=mm.createVertexBuffer("position",0,3);let u=3;o.age=mm.createVertexBuffer("age",u,1),u+=1,o.size=mm.createVertexBuffer("size",u,3),u+=3,o.life=mm.createVertexBuffer("life",u,1),u+=1,o.seed=mm.createVertexBuffer("seed",u,4),u+=4,o.direction=mm.createVertexBuffer("direction",u,3),u+=3,this._parent.particleEmitterType instanceof b&&(o.initialPosition=mm.createVertexBuffer("initialPosition",u,3),u+=3),this._parent._colorGradientsTexture||(o.color=mm.createVertexBuffer("color",u,4),u+=4),this._parent._isBillboardBased||(o.initialDirection=mm.createVertexBuffer("initialDirection",u,3),u+=3),this._parent.noiseTexture&&(o.noiseCoordinates1=mm.createVertexBuffer("noiseCoordinates1",u,3),u+=3,o.noiseCoordinates2=mm.createVertexBuffer("noiseCoordinates2",u,3),u+=3),this._parent._angularSpeedGradientsTexture?(o.angle=mm.createVertexBuffer("angle",u,1),u+=1):(o.angle=mm.createVertexBuffer("angle",u,2),u+=2),this._parent._isAnimationSheetEnabled&&(o.cellIndex=mm.createVertexBuffer("cellIndex",u,1),u+=1,this._parent.spriteRandomStartCell&&(o.cellStartOffset=mm.createVertexBuffer("cellStartOffset",u,1),u+=1));const f=this._engine.recordVertexArrayObject(o,null,this._updateEffect);return this._engine.bindArrayBuffer(null),f}});class c{constructor(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,f=arguments.length>3?arguments[3]:void 0;this._engine=mm,this._label=f,this._engine._storageBuffers.push(this),this._create(o,u)}_create(mm,o){this._bufferSize=mm,this._creationFlags=o,this._buffer=this._engine.createStorageBuffer(mm,o,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(mm,o,u){this._buffer&&this._engine.updateStorageBuffer(this._buffer,mm,o,u)}async read(mm,o,u,f){return await this._engine.readFromStorageBuffer(this._buffer,mm,o,u,f)}dispose(){const mm=this._engine._storageBuffers,o=mm.indexOf(this);-1!==o&&(mm[o]=mm[mm.length-1],mm.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var A=u(12729),y=u(12732),I=u(12766),s=u(12727),j=u(13030),a=u(12565),X=u(12680),G=u(12940);class k{constructor(){this._gpuTimeInFrameId=-1,this.counter=new G.e}_addDuration(mm,o){mm<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==mm?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(o,!1),this._gpuTimeInFrameId=mm):this.counter.addCount(o,!1))}}var d=u(12634);class e{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=mm,this._engine=o,this.uniqueId=j.b.UniqueId,o.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new k),this._engine.getCaps().supportComputeShaders?f.bindingsMapping?(this._context=o.createComputeContext(),this._shaderPath=u,this._options={bindingsMapping:{},defines:[],...f}):a.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):a.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(mm,o){let u=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const f=this._bindings[mm];this._bindings[mm]={type:u?0:4,object:o,indexInGroupEntries:null===f||void 0===f?void 0:f.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!f||f.object!==o||f.type!==this._bindings[mm].type)}setStorageTexture(mm,o){const u=this._bindings[mm];this._contextIsDirty||(this._contextIsDirty=!u||u.object!==o),this._bindings[mm]={type:1,object:o,indexInGroupEntries:null===u||void 0===u?void 0:u.indexInGroupEntries}}setExternalTexture(mm,o){const u=this._bindings[mm];this._contextIsDirty||(this._contextIsDirty=!u||u.object!==o),this._bindings[mm]={type:6,object:o,indexInGroupEntries:null===u||void 0===u?void 0:u.indexInGroupEntries}}setVideoTexture(mm,o){return!!o.externalTexture&&(this.setExternalTexture(mm,o.externalTexture),!0)}setUniformBuffer(mm,o){const u=this._bindings[mm];this._contextIsDirty||(this._contextIsDirty=!u||u.object!==o),this._bindings[mm]={type:e._BufferIsDataBuffer(o)?7:2,object:o,indexInGroupEntries:null===u||void 0===u?void 0:u.indexInGroupEntries}}setStorageBuffer(mm,o){const u=this._bindings[mm];this._contextIsDirty||(this._contextIsDirty=!u||u.object!==o),this._bindings[mm]={type:e._BufferIsDataBuffer(o)?7:3,object:o,indexInGroupEntries:null===u||void 0===u?void 0:u.indexInGroupEntries}}setTextureSampler(mm,o){const u=this._bindings[mm];this._contextIsDirty||(this._contextIsDirty=!u||!o.compareSampler(u.object)),this._bindings[mm]={type:5,object:o,indexInGroupEntries:null===u||void 0===u?void 0:u.indexInGroupEntries}}isReady(){let mm=this._effect;for(const B in this._bindings){const mm=this._bindings[B],o=mm.type,u=mm.object;switch(o){case 0:case 4:case 1:if(!u.isReady())return!1;break;case 6:if(!u.isReady())return!1;break}}const o=[],u=this._shaderPath;if(this._options.defines)for(let B=0;B<this._options.defines.length;B++)o.push(this._options.defines[B]);const f=o.join("\n");return this._cachedDefines!==f&&(this._cachedDefines=f,mm=this._engine.createComputeEffect(u,{defines:f,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=mm),!!mm.isReady()}dispatch(mm,o,u){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,mm,o,u,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const u=e._BufferIsDataBuffer(mm)?mm:mm.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,u,o,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const o in this._bindings){const u=this._bindings[o];if(!this._options.bindingsMapping[o])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+o+"'");switch(u.type){case 0:{const f=this._samplers[o],B=u.object;var mm;if(!f||!B._texture||!f.compareSampler(B._texture))this._samplers[o]=(new X.e).setParameters(B.wrapU,B.wrapV,B.wrapR,B.anisotropicFilteringLevel,B._texture.samplingMode,null===(mm=B._texture)||void 0===mm?void 0:mm._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const mm=u.object;mm.getBuffer()!==u.buffer&&(u.buffer=mm.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((B=>{(0,d.g)((()=>this.dispatch(mm,o,u)),B,void 0,f)}))}serialize(){const mm=I.c.Serialize(this);mm.options=this._options,mm.shaderPath=this._shaderPath,mm.nq={},mm.textures={};for(const o in this._bindings){const u=this._bindings[o],f=u.object;switch(u.type){case 0:case 4:case 1:{const B=f.serialize();B&&(mm.textures[o]=B,mm.nq[o]={type:u.type});break}}}return mm}static Parse(mm,o,u){const f=I.c.Parse((()=>new e(mm.name,o.getEngine(),mm.shaderPath,mm.options)),mm,o,u);for(const B in mm.textures){const O=mm.nq[B],r=s.b.Parse(mm.textures[B],o,u);0===O.type?f.setTexture(B,r):4===O.type?f.setTexture(B,r,!1):f.setStorageTexture(B,r)}return f}static _BufferIsDataBuffer(mm){return void 0!==mm.underlyingResource}}(0,A.d)([(0,y.J)()],e.prototype,"name",void 0),(0,A.d)([(0,y.J)()],e.prototype,"fastMode",void 0),(0,w.c)("BABYLON.ComputeShader",e);var L=u(12989);const C="gpuUpdateParticlesComputeShader",v="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";P.e.ShadersStoreWGSL[C]||(P.e.ShadersStoreWGSL[C]=v);(0,w.c)("BABYLON.ComputeShaderParticleSystem",class{constructor(mm,o){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=mm,this._engine=o}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var mm;return(null===(mm=this._updateComputeShader)||void 0===mm?void 0:mm.isReady())??!1}createUpdateBuffer(mm){var o;const u={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(u.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(u.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(u.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(u.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(u.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(u.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(u.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new e("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:u,defines:mm.split("\n")}),null===(o=this._simParamsComputeShader)||void 0===o||o.dispose(),this._simParamsComputeShader=new L.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new S(this._simParamsComputeShader)}createVertexBuffers(mm,o){this._renderVertexBuffers.push(o)}createParticleBuffer(mm){const o=new c(this._engine,4*mm.length,11,"ComputeShaderParticleSystemBuffer");return o.update(mm),this._bufferComputeShader.push(o),o.getBuffer()}bindDrawBuffers(mm,o,u){this._engine.bindBuffers(this._renderVertexBuffers[mm],u,o)}preUpdateParticleBuffer(){}updateParticleBuffer(mm,o,u){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[mm]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^mm]),this._updateComputeShader.dispatch(Math.ceil(u/64))}releaseBuffers(){var mm;for(let o=0;o<this._bufferComputeShader.length;++o)this._bufferComputeShader[o].dispose();this._bufferComputeShader.length=0,null===(mm=this._simParamsComputeShader)||void 0===mm||mm.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class V{constructor(mm,o,u){this.gradient=mm,this.color1=o,this.color2=u}getColorToRef(mm){this.color2?r.pp.LerpToRef(this.color1,this.color2,Math.random(),mm):mm.p(this.color1)}}class n{constructor(mm,o){this.gradient=mm,this.color=o}}class U{constructor(mm,o,u){this.gradient=mm,this.factor1=o,this.factor2=u}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class h{static GetCurrentGradient(mm,o,u){if(o[0].gradient>mm)return void u(o[0],o[0],1);for(let B=0;B<o.length-1;B++){const f=o[B],O=o[B+1];if(mm>=f.gradient&&mm<=O.gradient){return void u(f,O,(mm-f.gradient)/(O.gradient-f.gradient))}}const f=o.length-1;u(o[f],o[f],1)}}var Z=u(12556),T=u(13188),D=u(12596);class i{constructor(mm){this.particleSystem=mm,this.position=f.lo.Zero(),this.direction=f.lo.Zero(),this.color=new r.pp(0,0,0,0),this.colorStep=new r.pp(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new f.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new r.pp(0,0,0,0),this._currentColor2=new r.pp(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=i._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let mm=this.age,o=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===o?(o=1,mm=this._randomCellOffset):mm+=this._randomCellOffset);const u=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let f;f=this._initialSpriteCellLoop?(0,K.Clamp)(mm*o%this.lifeTime/this.lifeTime):(0,K.Clamp)(mm*o/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+f*u|0}_inheritParticleInfoToSubEmitter(mm){if(mm.particleSystem.ro.position){const o=mm.particleSystem.ro;if(o.position.p(this.position),mm.inheritDirection){const mm=f.TmpVectors.lo[0];this.direction.normalizeToRef(mm),o.setDirection(mm,0,Math.PI/2)}}else{mm.particleSystem.ro.p(this.position)}this.direction.scaleToRef(mm.inheritedVelocityAmount/2,f.TmpVectors.lo[0]),mm.particleSystem._inheritedVelocityOffset.p(f.TmpVectors.lo[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const mm of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(mm)}_reset(){this.age=0,this.id=i._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(mm){mm.position.p(this.position),this._initialDirection?mm._initialDirection?mm._initialDirection.p(this._initialDirection):mm._initialDirection=this._initialDirection.clone():mm._initialDirection=null,mm.direction.p(this.direction),this.yp&&(mm.yp?mm.yp.p(this.yp):mm.yp=this.yp.clone()),mm.color.p(this.color),mm.colorStep.p(this.colorStep),mm.lifeTime=this.lifeTime,mm.age=this.age,mm._randomCellOffset=this._randomCellOffset,mm.size=this.size,mm.scale.p(this.scale),mm.angle=this.angle,mm.angularSpeed=this.angularSpeed,mm.particleSystem=this.particleSystem,mm.cellIndex=this.cellIndex,mm.id=this.id,mm._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(mm._currentColorGradient=this._currentColorGradient,mm._currentColor1.p(this._currentColor1),mm._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(mm._currentSizeGradient=this._currentSizeGradient,mm._currentSize1=this._currentSize1,mm._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(mm._currentAngularSpeedGradient=this._currentAngularSpeedGradient,mm._currentAngularSpeed1=this._currentAngularSpeed1,mm._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(mm._currentVelocityGradient=this._currentVelocityGradient,mm._currentVelocity1=this._currentVelocity1,mm._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(mm._currentLimitVelocityGradient=this._currentLimitVelocityGradient,mm._currentLimitVelocity1=this._currentLimitVelocity1,mm._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(mm._currentDragGradient=this._currentDragGradient,mm._currentDrag1=this._currentDrag1,mm._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(mm._initialStartSpriteCellId=this._initialStartSpriteCellId,mm._initialEndSpriteCellId=this._initialEndSpriteCellId,mm._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(mm.remapData&&this.remapData?mm.remapData.p(this.remapData):mm.remapData=new f.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(mm._randomNoiseCoordinates1?(mm._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),mm._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(mm._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),mm._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}i._Count=0;var mo=u(12855),om=(u(12890),u(13093)),um=u(13088),fm=u(12986);function Bm(mm,o){const u=(0,K.RandomRange)(0,1);r.pp.LerpToRef(o.color1,o.color2,u,mm.color),o.colorDead.subtractToRef(mm.color,o._colorDiff),o._colorDiff.scaleToRef(1/mm.lifeTime,mm.colorStep)}function Om(mm,o){mm._currentColorGradient=o._colorGradients[0],mm._currentColorGradient.getColorToRef(mm.color),mm._currentColor1.p(mm.color),o._colorGradients.length>1?o._colorGradients[1].getColorToRef(mm._currentColor2):mm._currentColor2.p(mm.color)}function rm(mm,o){const u=o._colorGradients;h.GetCurrentGradient(o._ratio,u,((o,u,f)=>{o!==mm._currentColorGradient&&(mm._currentColor1.p(mm._currentColor2),u.getColorToRef(mm._currentColor2),mm._currentColorGradient=o),r.pp.LerpToRef(mm._currentColor1,mm._currentColor2,f,mm.color)}))}function wm(mm,o){mm.colorStep.scaleToRef(o._scaledUpdateSpeed,o._scaledColorStep),mm.color.addInPlace(o._scaledColorStep),mm.color.a<0&&(mm.color.a=0)}function pm(mm,o){h.GetCurrentGradient(o._ratio,o._angularSpeedGradients,((o,u,f)=>{o!==mm._currentAngularSpeedGradient&&(mm._currentAngularSpeed1=mm._currentAngularSpeed2,mm._currentAngularSpeed2=u.getFactor(),mm._currentAngularSpeedGradient=o),mm.angularSpeed=(0,K.Lerp)(mm._currentAngularSpeed1,mm._currentAngularSpeed2,f)}))}function Km(mm,o){mm.angle+=mm.angularSpeed*o._scaledUpdateSpeed}function zm(mm,o){o.particleEmitterType.startDirectionFunction(o._emitterWorldMatrix,mm.direction,mm,o.isLocal,o._emitterInverseWorldMatrix)}function Ym(mm,o){o.startDirectionFunction(o._emitterWorldMatrix,mm.direction,mm,o.isLocal)}function qm(mm,o){mm._currentVelocityGradient=o._velocityGradients[0],mm._currentVelocity1=mm._currentVelocityGradient.getFactor(),o._velocityGradients.length>1?mm._currentVelocity2=o._velocityGradients[1].getFactor():mm._currentVelocity2=mm._currentVelocity1}function xm(mm,o){mm._currentLimitVelocityGradient=o._limitVelocityGradients[0],mm._currentLimitVelocity1=mm._currentLimitVelocityGradient.getFactor(),o._limitVelocityGradients.length>1?mm._currentLimitVelocity2=o._limitVelocityGradients[1].getFactor():mm._currentLimitVelocity2=mm._currentLimitVelocity1}function Hm(mm,o){h.GetCurrentGradient(o._ratio,o._velocityGradients,((u,f,B)=>{u!==mm._currentVelocityGradient&&(mm._currentVelocity1=mm._currentVelocity2,mm._currentVelocity2=f.getFactor(),mm._currentVelocityGradient=u),o._directionScale*=(0,K.Lerp)(mm._currentVelocity1,mm._currentVelocity2,B)}))}function Em(mm,o){h.GetCurrentGradient(o._ratio,o._limitVelocityGradients,((u,f,B)=>{u!==mm._currentLimitVelocityGradient&&(mm._currentLimitVelocity1=mm._currentLimitVelocity2,mm._currentLimitVelocity2=f.getFactor(),mm._currentLimitVelocityGradient=u);const O=(0,K.Lerp)(mm._currentLimitVelocity1,mm._currentLimitVelocity2,B);mm.direction.length()>O&&mm.direction.scaleInPlace(o.limitVelocityDamping)}))}function Mm(mm,o){mm.direction.scaleToRef(o._directionScale,o._scaledDirection)}function lm(mm,o){o.particleEmitterType.startPositionFunction(o._emitterWorldMatrix,mm.position,mm,o.isLocal)}function tm(mm,o){o.startPositionFunction(o._emitterWorldMatrix,mm.position,mm,o.isLocal)}function Qm(mm,o){mm.yp?mm.yp.p(mm.position):mm.yp=mm.position.clone(),f.lo.TransformCoordinatesToRef(mm.yp,o._emitterWorldMatrix,mm.position)}function bm(mm,o){o.isLocal&&mm.yp?(mm.yp.addInPlace(o._scaledDirection),f.lo.TransformCoordinatesToRef(mm.yp,o._emitterWorldMatrix,mm.position)):mm.position.addInPlace(o._scaledDirection)}function Jm(mm,o){mm._currentDragGradient=o._dragGradients[0],mm._currentDrag1=mm._currentDragGradient.getFactor(),o._dragGradients.length>1?mm._currentDrag2=o._dragGradients[1].getFactor():mm._currentDrag2=mm._currentDrag1}function Nm(mm,o){h.GetCurrentGradient(o._ratio,o._dragGradients,((u,f,B)=>{u!==mm._currentDragGradient&&(mm._currentDrag1=mm._currentDrag2,mm._currentDrag2=f.getFactor(),mm._currentDragGradient=u);const O=(0,K.Lerp)(mm._currentDrag1,mm._currentDrag2,B);o._scaledDirection.scaleInPlace(1-O)}))}function Sm(mm,o){mm._randomNoiseCoordinates1?(mm._randomNoiseCoordinates1.Op(Math.random(),Math.random(),Math.random()),mm._randomNoiseCoordinates2.Op(Math.random(),Math.random(),Math.random())):(mm._randomNoiseCoordinates1=new f.lo(Math.random(),Math.random(),Math.random()),mm._randomNoiseCoordinates2=new f.lo(Math.random(),Math.random(),Math.random()))}function Pm(mm,o){const u=o._noiseTextureData,B=o._noiseTextureSize;if(u&&B&&mm._randomNoiseCoordinates1){const O=o._fetchR(mm._randomNoiseCoordinates1.x,mm._randomNoiseCoordinates1.y,B.width,B.height,u),r=o._fetchR(mm._randomNoiseCoordinates1.z,mm._randomNoiseCoordinates2.x,B.width,B.height,u),w=o._fetchR(mm._randomNoiseCoordinates2.y,mm._randomNoiseCoordinates2.z,B.width,B.height,u),p=f.TmpVectors.lo[0],K=f.TmpVectors.lo[1];p.Op((2*O-1)*o.noiseStrength.x,(2*r-1)*o.noiseStrength.y,(2*w-1)*o.noiseStrength.z),p.scaleToRef(o._tempScaledUpdateSpeed,K),mm.direction.addInPlace(K)}}function Rm(mm,o){o.gravity.scaleToRef(o._tempScaledUpdateSpeed,o._scaledGravity),mm.direction.addInPlace(o._scaledGravity)}function gm(mm,o){mm.size=(0,K.RandomRange)(o.minSize,o.maxSize),mm.scale.Op((0,K.RandomRange)(o.minScaleX,o.maxScaleX),(0,K.RandomRange)(o.minScaleY,o.maxScaleY))}function Wm(mm,o){mm._currentSizeGradient=o._sizeGradients[0],mm._currentSize1=mm._currentSizeGradient.getFactor(),mm.size=mm._currentSize1,o._sizeGradients.length>1?mm._currentSize2=o._sizeGradients[1].getFactor():mm._currentSize2=mm._currentSize1,mm.scale.Op((0,K.RandomRange)(o.minScaleX,o.maxScaleX),(0,K.RandomRange)(o.minScaleY,o.maxScaleY))}function Fm(mm,o){const u=o._actualFrame/o.targetStopDuration;h.GetCurrentGradient(u,o._startSizeGradients,((u,f,B)=>{u!==o._currentStartSizeGradient&&(o._currentStartSize1=o._currentStartSize2,o._currentStartSize2=f.getFactor(),o._currentStartSizeGradient=u);const O=(0,K.Lerp)(o._currentStartSize1,o._currentStartSize2,B);mm.scale.scaleInPlace(O)}))}function cm(mm,o){h.GetCurrentGradient(o._ratio,o._sizeGradients,((o,u,f)=>{o!==mm._currentSizeGradient&&(mm._currentSize1=mm._currentSize2,mm._currentSize2=u.getFactor(),mm._currentSizeGradient=o),mm.size=(0,K.Lerp)(mm._currentSize1,mm._currentSize2,f)}))}function Am(mm,o){mm.remapData=new f.Vector4(0,1,0,1)}function ym(mm,o){o._colorRemapGradients&&o._colorRemapGradients.length>0&&h.GetCurrentGradient(o._ratio,o._colorRemapGradients,((o,u,f)=>{const B=(0,K.Lerp)(o.factor1,u.factor1,f),O=(0,K.Lerp)(o.factor2,u.factor2,f);mm.remapData.x=B,mm.remapData.y=O-B})),o._alphaRemapGradients&&o._alphaRemapGradients.length>0&&h.GetCurrentGradient(o._ratio,o._alphaRemapGradients,((o,u,f)=>{const B=(0,K.Lerp)(o.factor1,u.factor1,f),O=(0,K.Lerp)(o.factor2,u.factor2,f);mm.remapData.z=B,mm.remapData.w=O-B}))}function Im(mm,o){const u=(0,K.Clamp)(o._actualFrame/o.targetStopDuration);h.GetCurrentGradient(u,o._lifeTimeGradients,((o,f)=>{const B=o,O=f,r=B.getFactor(),w=O.getFactor(),p=(u-B.gradient)/(O.gradient-B.gradient);mm.lifeTime=(0,K.Lerp)(r,w,p)})),o._emitPower=(0,K.RandomRange)(o.minEmitPower,o.maxEmitPower)}function sm(mm,o){mm.lifeTime=(0,K.RandomRange)(o.minLifeTime,o.maxLifeTime),o._emitPower=(0,K.RandomRange)(o.minEmitPower,o.maxEmitPower)}function jm(mm,o){0===o._emitPower?(mm._initialDirection?mm._initialDirection.p(mm.direction):mm._initialDirection=mm.direction.clone(),mm.direction.set(0,0,0)):(mm._initialDirection=null,mm.direction.scaleInPlace(o._emitPower)),mm.direction.addInPlace(o._inheritedVelocityOffset)}function am(mm,o){mm.angularSpeed=(0,K.RandomRange)(o.minAngularSpeed,o.maxAngularSpeed),mm.angle=(0,K.RandomRange)(o.minInitialRotation,o.maxInitialRotation)}function Xm(mm,o){mm._currentAngularSpeedGradient=o._angularSpeedGradients[0],mm.angularSpeed=mm._currentAngularSpeedGradient.getFactor(),mm._currentAngularSpeed1=mm.angularSpeed,o._angularSpeedGradients.length>1?mm._currentAngularSpeed2=o._angularSpeedGradients[1].getFactor():mm._currentAngularSpeed2=mm._currentAngularSpeed1,mm.angle=(0,K.RandomRange)(o.minInitialRotation,o.maxInitialRotation)}function Gm(mm,o){mm._initialStartSpriteCellId=o.startSpriteCellID,mm._initialEndSpriteCellId=o.endSpriteCellID,mm._initialSpriteCellLoop=o.spriteCellLoop}function km(mm,o){mm.previousItem=o.previousItem,mm.nextItem=o,o.previousItem&&(o.previousItem.nextItem=mm),o.previousItem=mm}function dm(mm,o){mm.previousItem=o,mm.nextItem=o.nextItem,o.nextItem&&(o.nextItem.previousItem=mm),o.nextItem=mm}function em(mm,o){let u=o;for(;u.nextItem;)u=u.nextItem;mm.previousItem=u,mm.nextItem=u.nextItem,u.nextItem=mm}function Lm(mm){mm.previousItem&&(mm.previousItem.nextItem=mm.nextItem),mm.nextItem&&(mm.nextItem.previousItem=mm.previousItem)}class Cm extends p{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(mm){this._startDirectionFunction!==mm&&(this._startDirectionFunction=mm,this._directionProcessing.process=mm?Ym:zm)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(mm){this._startPositionFunction!==mm&&(this._startPositionFunction=mm,this._positionCreation.process=mm?tm:lm)}set onDispose(mm){this._onDisposeObserver&&this.Jf.remove(this._onDisposeObserver),this._onDisposeObserver=this.Jf.add(mm)}get q(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(mm){this._useRampGradients!==mm&&(this._useRampGradients=mm,this._resetEffect(),mm?(this._rampCreation={process:Am,previousItem:null,nextItem:null},dm(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:ym,previousItem:null,nextItem:null},dm(this._remapGradientProcessing,this._gravityProcessing)):(Lm(this._rampCreation),Lm(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(mm){this._isLocal!==mm&&(this._isLocal=mm,mm?(this._isLocalCreation={process:Qm,previousItem:null,nextItem:null},dm(this._isLocalCreation,this._positionCreation)):Lm(this._isLocalCreation))}get particles(){return this.eq}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(mm){this._animationSheetEnabled!==mm&&(this._animationSheetEnabled=mm,mm?(this._sheetCreation={process:Gm,previousItem:null,nextItem:null},dm(this._sheetCreation,this._colorCreation)):Lm(this._sheetCreation),this._reset())}getActiveCount(){return this.eq.length}getClassName(){return"ip"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var mm;let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(mm=this._customWrappers[o])||void 0===mm?void 0:mm.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[mm]??this._customWrappers[0]}setCustomEffect(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[o]=new mo.c(this._engine),this._customWrappers[o].effect=mm,this._customWrappers[o].drawContext&&(this._customWrappers[o].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Z.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(mm){if(this.noiseTexture!==mm){if(this._noiseTexture=mm,!mm)return Lm(this._noiseCreation),void Lm(this._noiseProcessing);this._noiseCreation={process:Sm,previousItem:null,nextItem:null},dm(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Pm,previousItem:null,nextItem:null},dm(this._noiseProcessing,this._positionProcessing)}}constructor(mm,o,u){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]&&arguments[4],w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(mm),this._emitterInverseWorldMatrix=f.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new f.lo,this.Jf=new Z.d,this.onStoppedObservable=new Z.d,this.onStartedObservable=new Z.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.eq=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new r.pp(0,0,0,0),this._colorDiff=new r.pp(0,0,0,0),this._scaledDirection=f.lo.Zero(),this._scaledGravity=f.lo.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=mm=>{},this.recycleParticle=mm=>{const o=this.eq.pop();o!==mm&&o.copyTo(mm),this._stockParticles.push(o)},this._createParticle=()=>{let mm;return 0!==this._stockParticles.length?(mm=this._stockParticles.pop(),mm._reset()):mm=new i(this),this._prepareParticle(mm),mm},this.paused=!1,this._shadersLoaded=!1,this._capacity=o,this._epsilon=w,u&&"Scene"!==u.getClassName()?(this._engine=u,this.defaultProjectionMatrix=f.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=u||D.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.kq.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:sm,previousItem:null,nextItem:null},this._positionCreation={process:lm,previousItem:null,nextItem:null},dm(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:zm,previousItem:null,nextItem:null},dm(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:jm,previousItem:null,nextItem:null},dm(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:gm,previousItem:null,nextItem:null},dm(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:am,previousItem:null,nextItem:null},dm(this._angleCreation,this._sizeCreation),this._colorCreation={process:Bm,previousItem:null,nextItem:null},dm(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,p||(this._colorProcessing={process:wm,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Km,previousItem:null,nextItem:null},dm(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Mm,previousItem:null,nextItem:null},dm(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:bm,previousItem:null,nextItem:null},dm(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Rm,previousItem:null,nextItem:null},dm(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=O,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new mo.c(this._engine)},this._customWrappers[0].effect=B,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new Y,this.updateFunction=mm=>{var o;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(o=this.noiseTexture.getContent())||void 0===o||o.then((mm=>{this._noiseTextureData=mm})));const u=mm===this.eq;for(let f=0;f<mm.length;f++){const o=mm[f];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const B=o.age;if(o.age+=this._tempScaledUpdateSpeed,o.age>o.lifeTime){const mm=o.age-B,u=o.lifeTime-B;this._tempScaledUpdateSpeed=u*this._tempScaledUpdateSpeed/mm,o.age=o.lifeTime}this._ratio=o.age/o.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let O=this._updateQueueStart;for(;O;)O.process(o,this),O=O.nextItem;if(this._isAnimationSheetEnabled&&!p&&o.updateCellIndex(),o._inheritParticleInfoToSubEmitters(),o.age>=o.lifeTime){if(this._emitFromParticle(o),o._attachedSubEmitters){for(const mm of o._attachedSubEmitters)mm.particleSystem.disposeOnStop=!0,mm.particleSystem.stop();o._attachedSubEmitters=null}this.recycleParticle(o),u&&f--}else;}}}serialize(mm){throw new Error("Method not implemented.")}clone(mm,o){throw new Error("Method not implemented.")}_addFactorGradient(mm,o,u,f){const B=new U(o,u,f);mm.push(B),mm.sort(((mm,o)=>mm.gradient<o.gradient?-1:mm.gradient>o.gradient?1:0))}_removeFactorGradient(mm,o){if(!mm)return;let u=0;for(const f of mm){if(f.gradient===o){mm.splice(u,1);break}u++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Im:this._lifeTimeCreation.process=sm}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Fm,previousItem:null,nextItem:null},dm(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Lm(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(mm){this.targetStopDuration!==mm&&(this._targetStopDuration=mm,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(mm,o,u){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,mm,o,u),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(mm){return this._removeFactorGradient(this._lifeTimeGradients,mm),this._syncLifeTimeCreation(),this}addSizeGradient(mm,o,u){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Wm,this._sizeGradientProcessing={process:cm,previousItem:null,nextItem:null},km(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,mm,o,u),this}removeSizeGradient(mm){var o;return this._removeFactorGradient(this._sizeGradients,mm),0===(null===(o=this._sizeGradients)||void 0===o?void 0:o.length)&&(Lm(this._sizeGradientProcessing),this._sizeCreation.process=gm),this}addColorRemapGradient(mm,o,u){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,mm,o,u),this}removeColorRemapGradient(mm){return this._removeFactorGradient(this._colorRemapGradients,mm),this}addAlphaRemapGradient(mm,o,u){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,mm,o,u),this}removeAlphaRemapGradient(mm){return this._removeFactorGradient(this._alphaRemapGradients,mm),this}addAngularSpeedGradient(mm,o,u){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Xm,this._angularSpeedGradientProcessing={process:pm,previousItem:null,nextItem:null},km(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,mm,o,u),this}removeAngularSpeedGradient(mm){var o;return this._removeFactorGradient(this._angularSpeedGradients,mm),0===(null===(o=this._angularSpeedGradients)||void 0===o?void 0:o.length)&&(this._angleCreation.process=am,Lm(this._angularSpeedGradientProcessing)),this}addVelocityGradient(mm,o,u){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:qm,previousItem:null,nextItem:null},dm(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Hm,previousItem:null,nextItem:null},km(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,mm,o,u),this}removeVelocityGradient(mm){var o;return this._removeFactorGradient(this._velocityGradients,mm),0===(null===(o=this._velocityGradients)||void 0===o?void 0:o.length)&&(Lm(this._velocityCreation),Lm(this._velocityGradientProcessing)),this}addLimitVelocityGradient(mm,o,u){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:xm,previousItem:null,nextItem:null},dm(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Em,previousItem:null,nextItem:null},dm(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,mm,o,u),this}removeLimitVelocityGradient(mm){var o;return this._removeFactorGradient(this._limitVelocityGradients,mm),0===(null===(o=this._limitVelocityGradients)||void 0===o?void 0:o.length)&&(Lm(this._limitVelocityCreation),Lm(this._limitVelocityGradientProcessing)),this}addDragGradient(mm,o,u){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Jm,previousItem:null,nextItem:null},km(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Nm,previousItem:null,nextItem:null},km(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,mm,o,u),this}removeDragGradient(mm){var o;return this._removeFactorGradient(this._dragGradients,mm),0===(null===(o=this._dragGradients)||void 0===o?void 0:o.length)&&(Lm(this._dragCreation),Lm(this._dragGradientProcessing)),this}addEmitRateGradient(mm,o,u){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,mm,o,u),this}removeEmitRateGradient(mm){return this._removeFactorGradient(this._emitRateGradients,mm),this}addStartSizeGradient(mm,o,u){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,mm,o,u),this._syncStartSizeCreation(),this}removeStartSizeGradient(mm){return this._removeFactorGradient(this._startSizeGradients,mm),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const mm=new Uint8Array(4*this._rawTextureWidth),o=r.TmpColors.No[0];for(let u=0;u<this._rawTextureWidth;u++){const f=u/this._rawTextureWidth;h.GetCurrentGradient(f,this._rampGradients,((f,B,O)=>{r.No.LerpToRef(f.color,B.color,O,o),mm[4*u]=255*o.r,mm[4*u+1]=255*o.g,mm[4*u+2]=255*o.b,mm[4*u+3]=255}))}this._rampGradientsTexture=T.d.CreateRGBATexture(mm,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((mm,o)=>mm.gradient<o.gradient?-1:mm.gradient>o.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(mm,o){this._rampGradients||(this._rampGradients=[]);const u=new n(mm,o);return this._rampGradients.push(u),this._syncRampGradientTexture(),this}removeRampGradient(mm){return this._removeGradientAndTexture(mm,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(mm,o,u){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Om,this._colorProcessing.process=rm);const f=new V(mm,o,u);return this._colorGradients.push(f),this._colorGradients.sort(((mm,o)=>mm.gradient<o.gradient?-1:mm.gradient>o.gradient?1:0)),this}removeColorGradient(mm){if(!this._colorGradients)return this;let o=0;for(const u of this._colorGradients){if(u.gradient===mm){this._colorGradients.splice(o,1);break}o++}return 0===this._colorGradients.length&&(this._colorCreation.process=Bm,this._colorProcessing.process=wm),this}resetDrawCache(){if(this._drawWrappers){for(const mm of this._drawWrappers)if(mm)for(const o of mm)null===o||void 0===o||o.dispose();this._drawWrappers=[]}}_fetchR(mm,o,u,f,B){return B[4*(((mm=.5*Math.abs(mm)+.5)*u%u|0)+((o=.5*Math.abs(o)+.5)*f%f|0)*u)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const mm=this._engine,o=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*o),this._vertexBuffer=new J.c(mm,this._vertexData,!0,o);let u=0;const f=this._vertexBuffer.createVertexBuffer(J.f.PositionKind,u,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[J.f.PositionKind]=f,u+=3;const B=this._vertexBuffer.createVertexBuffer(J.f.ColorKind,u,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[J.f.ColorKind]=B,u+=4;const O=this._vertexBuffer.createVertexBuffer("angle",u,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=O,u+=1;const r=this._vertexBuffer.createVertexBuffer("size",u,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=r,u+=2,this._isAnimationSheetEnabled){const mm=this._vertexBuffer.createVertexBuffer("cellIndex",u,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=mm,u+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const mm=this._vertexBuffer.createVertexBuffer("direction",u,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=mm,u+=3}if(this._useRampGradients){const mm=this._vertexBuffer.createVertexBuffer("remapData",u,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=mm,u+=4}let w;if(this._useInstancing){const o=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new J.c(mm,o,!1,2),w=this._spriteBuffer.createVertexBuffer("offset",0,2)}else w=this._vertexBuffer.createVertexBuffer("offset",u,2,this._vertexBufferSize,this._useInstancing),u+=2;this._vertexBuffers.offset=w,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const mm=[],o=[];let u=0;for(let f=0;f<this._capacity;f++)mm.push(u),mm.push(u+1),mm.push(u+2),mm.push(u),mm.push(u+2),mm.push(u+3),o.push(u,u+1,u+1,u+2,u+2,u+3,u+3,u,u,u+3),u+=4;this._indexBuffer=this._engine.createIndexBuffer(mm),this._linesIndexBuffer=this._engine.createIndexBuffer(o)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(mm)setTimeout((()=>{this.start(0)}),mm);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var o;-1!==(null===(o=this.ro)||void 0===o?void 0:o.getClassName().indexOf("Mesh"))&&this.ro.Df(!0);const mm=this.noiseTexture;if(mm&&mm.onGeneratedObservable)mm.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let o=0;o<this.preWarmCycles;o++)this.animate(!0),mm.render()}))}));else for(let o=0;o<this.preWarmCycles;o++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let mm=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(mm))}_postStop(mm){}reset(){this._stockParticles.length=0,this.eq.length=0}_appendParticleVertex(mm,o,u,B){let O=mm*this._vertexBufferSize;if(this._vertexData[O++]=o.position.x+this.oz.x,this._vertexData[O++]=o.position.y+this.oz.y,this._vertexData[O++]=o.position.z+this.oz.z,this._vertexData[O++]=o.color.r,this._vertexData[O++]=o.color.g,this._vertexData[O++]=o.color.b,this._vertexData[O++]=o.color.a,this._vertexData[O++]=o.angle,this._vertexData[O++]=o.scale.x*o.size,this._vertexData[O++]=o.scale.y*o.size,this._isAnimationSheetEnabled&&(this._vertexData[O++]=o.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[O++]=o.direction.x,this._vertexData[O++]=o.direction.y,this._vertexData[O++]=o.direction.z);else if(o._initialDirection){let mm=o._initialDirection;this.isLocal&&(f.lo.TransformNormalToRef(mm,this._emitterWorldMatrix,f.TmpVectors.lo[0]),mm=f.TmpVectors.lo[0]),0===mm.x&&0===mm.z&&(mm.x=.001),this._vertexData[O++]=mm.x,this._vertexData[O++]=mm.y,this._vertexData[O++]=mm.z}else{let mm=o.direction;this.isLocal&&(f.lo.TransformNormalToRef(mm,this._emitterWorldMatrix,f.TmpVectors.lo[0]),mm=f.TmpVectors.lo[0]),0===mm.x&&0===mm.z&&(mm.x=.001),this._vertexData[O++]=mm.x,this._vertexData[O++]=mm.y,this._vertexData[O++]=mm.z}this._useRampGradients&&o.remapData&&(this._vertexData[O++]=o.remapData.x,this._vertexData[O++]=o.remapData.y,this._vertexData[O++]=o.remapData.z,this._vertexData[O++]=o.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===u?u=this._epsilon:1===u&&(u=1-this._epsilon),0===B?B=this._epsilon:1===B&&(B=1-this._epsilon)),this._vertexData[O++]=u,this._vertexData[O++]=B)}_prepareParticle(mm){}_createNewOnes(mm){let o;for(let u=0;u<mm&&this.eq.length!==this._capacity;u++){o=this._createParticle(),this.eq.push(o);let mm=this._createQueueStart;for(;mm;)mm.process(o,this),mm=mm.nextItem;o._inheritParticleInfoToSubEmitters()}}_update(mm){if(this._alive=this.eq.length>0,this.ro.position){const mm=this.ro;this._emitterWorldMatrix=mm.getWorldMatrix()}else{const mm=this.ro;this._emitterWorldMatrix=f.Matrix.Translation(mm.x,mm.y,mm.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.eq),this._createNewOnes(mm)}static _GetAttributeNamesOrOptions(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f=[J.f.PositionKind,J.f.ColorKind,"angle","offset","size"];return mm&&f.push("cellIndex"),o||f.push("direction"),u&&f.push("remapData"),f}static _GetEffectCreationOptions(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,om.e)(f),mm&&f.push("particlesInfos"),o&&f.push("logarithmicDepthConstant"),u&&(f.push("vFogInfos"),f.push("vFogColor")),f}fillDefines(mm,o){let u=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,om.l)(this,this._scene,mm),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&mm.push("#define FOG")),this._isAnimationSheetEnabled&&mm.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&mm.push("#define LOGARITHMICDEPTH"),o===p.BLENDMODE_MULTIPLY&&mm.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&mm.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(mm.push("#define BILLBOARD"),this.billboardMode){case 2:mm.push("#define BILLBOARDY");break;case 8:case 9:mm.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&mm.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:mm.push("#define BILLBOARDMODE_ALL")}u&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),mm.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(mm,o,u){o.push(...Cm._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),mm.push(...Cm._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),u.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,fm.e)(mm,this._imageProcessingConfigurationDefines),(0,fm.d)(u,this._imageProcessingConfigurationDefines))}_getWrapper(mm){const o=this._getCustomDrawWrapper(mm);if(null!==o&&void 0!==o&&o.effect)return o;const u=[];this.fillDefines(u,mm);const f=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let B=this._drawWrappers[f];B||(B=this._drawWrappers[f]=[]);let O=B[mm];O||(O=new mo.c(this._engine),O.drawContext&&(O.drawContext.useInstancing=this._useInstancing),B[mm]=O);const r=u.join("\n");if(O.defines!==r){const mm=[],o=[],u=[];this.fillUniformsAttributesAndSamplerNames(o,mm,u),O.setEffect(this._engine.createEffect("particles",mm,o,u,r,void 0,void 0,void 0,void 0,this._shaderLanguage),r)}return O}animate(){var mm;let o,u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!u&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(u?this.preWarmStepOffset:(null===(mm=this._scene)||void 0===mm?void 0:mm.getAnimationRatio())||1),this.manualEmitCount>-1)o=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let mm=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const o=this._actualFrame/this.targetStopDuration;h.GetCurrentGradient(o,this._emitRateGradients,((o,u,f)=>{o!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=u.getFactor(),this._currentEmitRateGradient=o),mm=(0,K.Lerp)(this._currentEmitRate1,this._currentEmitRate2,f)}))}o=mm*this._scaledUpdateSpeed|0,this._newPartsExcess+=mm*this._scaledUpdateSpeed-o}if(this._newPartsExcess>1&&(o+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?o=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(o),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!u){let mm=0;for(let o=0;o<this.eq.length;o++){const u=this.eq[o];this._appendParticleVertices(mm,u),mm+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.eq.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(mm,o){this._appendParticleVertex(mm++,o,0,0),this._useInstancing||(this._appendParticleVertex(mm++,o,1,0),this._appendParticleVertex(mm++,o,1,1),this._appendParticleVertex(mm++,o,0,1))}rebuild(){var mm;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(mm=this._spriteBuffer)||void 0===mm||mm._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Cm.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(u.bind(u,14030)),Promise.resolve().then(u.bind(u,13978))])):await Promise.all([Promise.resolve().then(u.bind(u,13968)),Promise.resolve().then(u.bind(u,13957))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.ro||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==p.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(p.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(p.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(mm){const o=this._getWrapper(mm),u=o.effect,B=this._engine;B.enableEffect(o);const O=this.defaultViewMatrix??this._scene.getViewMatrix();if(u.setTexture("diffuseSampler",this.particleTexture),u.setMatrix("view",O),u.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const mm=this.particleTexture.getBaseSize();u.setFloat3("particlesInfos",this.spriteCellWidth/mm.width,this.spriteCellHeight/mm.height,this.spriteCellWidth/mm.width)}if(u.setVector2("translationPivot",this.translationPivot),u.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const mm=this._scene.activeCamera;u.setVector3("eyePosition",mm.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),u.setTexture("rampSampler",this._rampGradientsTexture));const r=u.defines;var w,p,K,z,Y,q;(this._scene&&((0,om.h)(u,this,this._scene),this.applyFog&&(0,um.f)(this._scene,void 0,u)),r.indexOf("#define BILLBOARDMODE_ALL")>=0&&(O.invertToRef(f.TmpVectors.Matrix[0]),u.setMatrix("invView",f.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?B.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,u):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,u)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?B.bindBuffers(this._vertexBuffers,null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?this._linesIndexBuffer:this._indexBuffer,u):B.bindBuffers(this._vertexBuffers,null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._linesIndexBufferUseInstancing:null,u);(this.useLogarithmicDepth&&this._scene&&(0,um.k)(r,u,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(u),this._setEngineBasedOnBlendMode(mm),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(u),this._useInstancing)?null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?B.drawElementsType(6,0,10,this.eq.length):B.drawArraysType(7,0,4,this.eq.length):null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?B.drawElementsType(1,0,10*this.eq.length):B.drawElementsType(0,0,6*this.eq.length);return this.eq.length}render(){if(!this.isReady()||!this.eq.length)return 0;const mm=this._engine;mm.setState&&(mm.setState(!1),this.forceDepthWrite&&mm.setDepthWrite(!0));let o=0;return o=this.blendMode===p.BLENDMODE_MULTIPLYADD?this._render(p.BLENDMODE_MULTIPLY)+this._render(p.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),o}_onDispose(){}dispose(){let mm=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),mm&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),mm&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(o,u),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const mm=this._scene.kq.indexOf(this);mm>-1&&this._scene.kq.splice(mm,1),this._scene._activeParticleSystems.dispose()}this.Jf.notifyObservers(this),this.Jf.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Cm.ForceGLSL=!1;var vm,Vm=u(12589);!function(mm){mm[mm.ATTACHED=0]="ATTACHED",mm[mm.END=1]="END"}(vm||(vm={}));class nm{constructor(mm){if(this.particleSystem=mm,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!mm.ro||!mm.ro.dispose){const o=(0,w.b)("BABYLON.AbstractMesh");mm.ro=new o("SubemitterSystemEmitter",mm.Pm()),mm._disposeEmitterOnDispose=!0}}clone(){let mm=this.particleSystem.ro;if(mm){if(mm instanceof f.lo)mm=mm.clone();else if(-1!==mm.getClassName().indexOf("Mesh")){mm=new((0,w.b)("BABYLON.Mesh"))("",mm.Pm()),mm.isVisible=!1}}else mm=new f.lo;const o=new nm(this.particleSystem.clone(this.particleSystem.name,mm));return o.particleSystem.name+="Clone",o.type=this.type,o.inheritDirection=this.inheritDirection,o.inheritedVelocityAmount=this.inheritedVelocityAmount,o.particleSystem._disposeEmitterOnDispose=!0,o.particleSystem.disposeOnStop=!0,o}serialize(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const o={};return o.type=this.type,o.inheritDirection=this.inheritDirection,o.inheritedVelocityAmount=this.inheritedVelocityAmount,o.particleSystem=this.particleSystem.serialize(mm),o}static _ParseParticleSystem(mm,o,u){throw(0,Vm.d)("ParseParticle")}static Parse(mm,o,u){const f=mm.particleSystem,B=new nm(nm._ParseParticleSystem(f,o,u,!0));return B.type=mm.type,B.inheritDirection=mm.inheritDirection,B.inheritedVelocityAmount=mm.inheritedVelocityAmount,B.particleSystem._isSubEmitter=!0,B}dispose(){this.particleSystem.dispose()}}var Um=u(12638);function hm(mm,o){const u=new l;return u.direction1=mm,u.direction2=o,u}function Zm(){return new M(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Tm(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Dm(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.lo(0,1,0),u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.lo(0,1,0);return new Q(mm,o,u)}function im(){return new H(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function mu(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.lo(0,1,0),O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new f.lo(0,1,0);return new E(mm,o,u,B,O)}function oo(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new q(mm,o)}function uo(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.lo(0,1,0),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.lo(0,1,0);return new x(mm,o,u,B)}const fo=f.lo.Zero(),Bo=f.lo.Zero(),Oo=f.lo.Zero();class ro{constructor(){this.strength=0,this.position=f.lo.Zero()}_processParticle(mm,o){this.position.subtractToRef(mm.position,fo);const u=fo.lengthSquared()+1;fo.normalize().scaleToRef(this.strength/u,Bo),Bo.scaleToRef(o._tempScaledUpdateSpeed,Oo),mm.direction.addInPlace(Oo)}serialize(){return{position:this.position.df(),strength:this.strength}}}class wo extends Cm{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=mm=>{if(!this._subEmitters||0===this._subEmitters.length)return;const o=Math.floor(Math.random()*this._subEmitters.length);for(const u of this._subEmitters[o])if(1===u.type){const o=u.clone();mm._inheritParticleInfoToSubEmitter(o),o.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(o.particleSystem),o.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(mm,o){const u=hm(mm,o);return this.particleEmitterType=u,u}get flowMap(){return this._flowMap}set flowMap(mm){this._flowMap!==mm&&(this._flowMap=mm,this._flowMapUpdate&&(Lm(this._flowMapUpdate),this._flowMapUpdate=null),mm&&(this._flowMapUpdate={process:mm=>{var o;const u=null===(o=this.Pm())||void 0===o?void 0:o.getTransformMatrix();this._flowMap._processParticle(mm,this.flowMapStrength*this._tempScaledUpdateSpeed,u)},previousItem:null,nextItem:null},dm(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(mm){this._attractors.push(mm),1===this._attractors.length&&(this._attractorUpdate={process:mm=>{for(const o of this._attractors)o._processParticle(mm,this)},previousItem:null,nextItem:null},dm(this._attractorUpdate,this._directionProcessing))}removeAttractor(mm){const o=this._attractors.indexOf(mm);-1!==o&&this._attractors.splice(o,1),0===this._attractors.length&&Lm(this._attractorUpdate)}start(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(mm)}createHemisphericEmitter(){const mm=Zm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=mm,mm}createSphereEmitter(){const mm=Tm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=mm,mm}createDirectedSphereEmitter(){const mm=Dm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.lo(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.lo(0,1,0));return this.particleEmitterType=mm,mm}createCylinderEmitter(){const mm=im(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=mm,mm}createDirectedCylinderEmitter(){const mm=mu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.lo(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new f.lo(0,1,0));return this.particleEmitterType=mm,mm}createConeEmitter(){const mm=oo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=mm,mm}createDirectedConeEmitter(){const mm=uo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.lo(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.lo(0,1,0));return this.particleEmitterType=mm,mm}createBoxEmitter(mm,o,u,f){const B=new Y;return this.particleEmitterType=B,this.direction1=mm,this.direction2=o,this.minEmitBox=u,this.maxEmitBox=f,B}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const mm of this.subEmitters)mm instanceof wo?this._subEmitters.push([new nm(mm)]):mm instanceof nm?this._subEmitters.push([mm]):mm instanceof Array&&this._subEmitters.push(mm)}_stopSubEmitters(){if(this.activeSubSystems){for(const mm of this.activeSubSystems)mm.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const mm=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==mm&&this._rootParticleSystem.activeSubSystems.splice(mm,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(mm){mm&&this._stopSubEmitters()}_prepareParticle(mm){if(this._subEmitters&&this._subEmitters.length>0){const o=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];mm._attachedSubEmitters=[];for(const u of o)if(0===u.type){const o=u.clone();mm._attachedSubEmitters.push(o),o.particleSystem.start()}}}_onDispose(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),mm&&this.particles)for(const u of this.particles)if(u._attachedSubEmitters)for(let mm=u._attachedSubEmitters.length-1;mm>=0;mm-=1)u._attachedSubEmitters[mm].dispose();if(o&&this.activeSubSystems)for(let u=this.activeSubSystems.length-1;u>=0;u-=1)this.activeSubSystems[u].dispose();if(this._subEmitters&&this._subEmitters.length){for(let mm=0;mm<this._subEmitters.length;mm++)for(const o of this._subEmitters[mm])o.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.ro&&this.ro.dispose&&this.ro.dispose(!0)}static _Parse(mm,o,u,B){let O;O=u instanceof Um.c?null:u;const p=(0,w.b)("BABYLON.Texture");if(p&&O&&(mm.texture?o.particleTexture=p.Parse(mm.texture,O,B):mm.textureName&&(o.particleTexture=new p(B+mm.textureName,O,!1,void 0===mm.invertY||mm.invertY),o.particleTexture.name=mm.textureName)),mm.emitterId||0===mm.emitterId||void 0!==mm.ro?mm.emitterId&&O?o.ro=O.getLastMeshById(mm.emitterId):o.ro=f.lo.So(mm.ro):o.ro=f.lo.Zero(),o.isLocal=!!mm.isLocal,void 0!==mm.renderingGroupId&&(o.renderingGroupId=mm.renderingGroupId),void 0!==mm.isBillboardBased&&(o.isBillboardBased=mm.isBillboardBased),void 0!==mm.billboardMode&&(o.billboardMode=mm.billboardMode),void 0!==mm.useLogarithmicDepth&&(o.useLogarithmicDepth=mm.useLogarithmicDepth),mm.animations){for(let u=0;u<mm.animations.length;u++){const f=mm.animations[u],B=(0,w.b)("BABYLON.Animation");B&&o.animations.push(B.Parse(f))}o.beginAnimationOnStart=mm.beginAnimationOnStart,o.beginAnimationFrom=mm.beginAnimationFrom,o.beginAnimationTo=mm.beginAnimationTo,o.beginAnimationLoop=mm.beginAnimationLoop}if(mm.autoAnimate&&O&&O.beginAnimation(o,mm.autoAnimateFrom,mm.autoAnimateTo,mm.autoAnimateLoop,mm.autoAnimateSpeed||1),o.startDelay=0|mm.startDelay,o.minAngularSpeed=mm.minAngularSpeed,o.maxAngularSpeed=mm.maxAngularSpeed,o.minSize=mm.minSize,o.maxSize=mm.maxSize,mm.minScaleX&&(o.minScaleX=mm.minScaleX,o.maxScaleX=mm.maxScaleX,o.minScaleY=mm.minScaleY,o.maxScaleY=mm.maxScaleY),void 0!==mm.preWarmCycles&&(o.preWarmCycles=mm.preWarmCycles,o.preWarmStepOffset=mm.preWarmStepOffset),void 0!==mm.minInitialRotation&&(o.minInitialRotation=mm.minInitialRotation,o.maxInitialRotation=mm.maxInitialRotation),o.minLifeTime=mm.minLifeTime,o.maxLifeTime=mm.maxLifeTime,o.minEmitPower=mm.minEmitPower,o.maxEmitPower=mm.maxEmitPower,o.emitRate=mm.emitRate,o.gravity=f.lo.So(mm.gravity),mm.noiseStrength&&(o.noiseStrength=f.lo.So(mm.noiseStrength)),o.color1=r.pp.So(mm.color1),o.color2=r.pp.So(mm.color2),o.colorDead=r.pp.So(mm.colorDead),o.updateSpeed=mm.updateSpeed,o.targetStopDuration=mm.targetStopDuration,o.blendMode=mm.blendMode,mm.colorGradients)for(const f of mm.colorGradients)o.addColorGradient(f.gradient,r.pp.So(f.color1),f.color2?r.pp.So(f.color2):void 0);if(mm.rampGradients){for(const u of mm.rampGradients)o.addRampGradient(u.gradient,r.No.So(u.color));o.useRampGradients=mm.useRampGradients}if(mm.colorRemapGradients)for(const f of mm.colorRemapGradients)o.addColorRemapGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(mm.alphaRemapGradients)for(const f of mm.alphaRemapGradients)o.addAlphaRemapGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(mm.sizeGradients)for(const f of mm.sizeGradients)o.addSizeGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(mm.angularSpeedGradients)for(const f of mm.angularSpeedGradients)o.addAngularSpeedGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(mm.velocityGradients)for(const f of mm.velocityGradients)o.addVelocityGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(mm.dragGradients)for(const f of mm.dragGradients)o.addDragGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(mm.emitRateGradients)for(const f of mm.emitRateGradients)o.addEmitRateGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(mm.startSizeGradients)for(const f of mm.startSizeGradients)o.addStartSizeGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(mm.lifeTimeGradients)for(const f of mm.lifeTimeGradients)o.addLifeTimeGradient(f.gradient,void 0!==f.factor1?f.factor1:f.factor,f.factor2);if(mm.limitVelocityGradients){for(const u of mm.limitVelocityGradients)o.addLimitVelocityGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);o.limitVelocityDamping=mm.limitVelocityDamping}if(mm.noiseTexture&&O){const u=(0,w.b)("BABYLON.ProceduralTexture");o.noiseTexture=u.Parse(mm.noiseTexture,O,B)}let K;if(mm.particleEmitterType){switch(mm.particleEmitterType.type){case"SphereParticleEmitter":K=new t;break;case"SphereDirectedParticleEmitter":K=new Q;break;case"ConeEmitter":case"ConeParticleEmitter":K=new q;break;case"ConeDirectedParticleEmitter":K=new x;break;case"CylinderParticleEmitter":K=new H;break;case"CylinderDirectedParticleEmitter":K=new E;break;case"HemisphericParticleEmitter":K=new M;break;case"PointParticleEmitter":K=new l;break;case"MeshParticleEmitter":K=new N;break;case"CustomParticleEmitter":K=new b;break;default:K=new Y}K.parse(mm.particleEmitterType,O)}else K=new Y,K.parse(mm,O);o.particleEmitterType=K,o.startSpriteCellID=mm.startSpriteCellID,o.endSpriteCellID=mm.endSpriteCellID,o.spriteCellLoop=mm.spriteCellLoop??!0,o.spriteCellWidth=mm.spriteCellWidth,o.spriteCellHeight=mm.spriteCellHeight,o.spriteCellChangeSpeed=mm.spriteCellChangeSpeed,o.spriteRandomStartCell=mm.spriteRandomStartCell,o.disposeOnStop=mm.disposeOnStop??!1,o.manualEmitCount=mm.manualEmitCount??-1}static Parse(mm,o,u){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4?arguments[4]:void 0;const w=mm.name;let p,K,z=null,Y=null;if(o instanceof Um.c?p=o:(K=o,p=K.getEngine()),mm.customShader&&p.createEffectForParticles){Y=mm.customShader;const o=Y.shaderOptions.defines.length>0?Y.shaderOptions.defines.join("\n"):"";z=p.createEffectForParticles(Y.shaderPath.fragmentElement,Y.shaderOptions.uniforms,Y.shaderOptions.samplers,o)}const q=new wo(w,O||mm.Mp,o,z,mm.isAnimationSheetEnabled);if(q.customShader=Y,q._rootUrl=u,mm.id&&(q.id=mm.id),mm.subEmitters){q.subEmitters=[];for(const f of mm.subEmitters){const mm=[];for(const B of f)mm.push(nm.Parse(B,o,u));q.subEmitters.push(mm)}}if(mm.attractors)for(const r of mm.attractors){const mm=new ro;mm.position=f.lo.So(r.position),mm.strength=r.strength,q.addAttractor(mm)}return wo._Parse(mm,q,o,u),mm.textureMask&&(q.textureMask=r.pp.So(mm.textureMask)),mm.oz&&(q.oz=f.lo.So(mm.oz)),mm.preventAutoStart&&(q.preventAutoStart=mm.preventAutoStart),B||q.preventAutoStart||q.start(),q}serialize(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const o={};if(wo._Serialize(o,this,mm),o.textureMask=this.textureMask.df(),o.customShader=this.customShader,o.preventAutoStart=this.preventAutoStart,o.oz=this.oz.df(),this.subEmitters){o.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const u of this._subEmitters){const f=[];for(const o of u)f.push(o.serialize(mm));o.subEmitters.push(f)}}if(this._attractors&&this._attractors.length){o.attractors=[];for(const mm of this._attractors)o.attractors.push(mm.serialize())}return o}static _Serialize(mm,o,u){if(mm.name=o.name,mm.id=o.id,mm.Mp=o.getCapacity(),mm.disposeOnStop=o.disposeOnStop,mm.manualEmitCount=o.manualEmitCount,o.ro.position){const u=o.ro;mm.emitterId=u.id}else{const u=o.ro;mm.ro=u.df()}o.particleEmitterType&&(mm.particleEmitterType=o.particleEmitterType.serialize()),o.particleTexture&&(u?mm.texture=o.particleTexture.serialize():(mm.textureName=o.particleTexture.name,mm.invertY=!!o.particleTexture._invertY)),mm.isLocal=o.isLocal,I.c.AppendSerializedAnimations(o,mm),mm.beginAnimationOnStart=o.beginAnimationOnStart,mm.beginAnimationFrom=o.beginAnimationFrom,mm.beginAnimationTo=o.beginAnimationTo,mm.beginAnimationLoop=o.beginAnimationLoop,mm.startDelay=o.startDelay,mm.renderingGroupId=o.renderingGroupId,mm.isBillboardBased=o.isBillboardBased,mm.billboardMode=o.billboardMode,mm.minAngularSpeed=o.minAngularSpeed,mm.maxAngularSpeed=o.maxAngularSpeed,mm.minSize=o.minSize,mm.maxSize=o.maxSize,mm.minScaleX=o.minScaleX,mm.maxScaleX=o.maxScaleX,mm.minScaleY=o.minScaleY,mm.maxScaleY=o.maxScaleY,mm.minEmitPower=o.minEmitPower,mm.maxEmitPower=o.maxEmitPower,mm.minLifeTime=o.minLifeTime,mm.maxLifeTime=o.maxLifeTime,mm.emitRate=o.emitRate,mm.gravity=o.gravity.df(),mm.noiseStrength=o.noiseStrength.df(),mm.color1=o.color1.df(),mm.color2=o.color2.df(),mm.colorDead=o.colorDead.df(),mm.updateSpeed=o.updateSpeed,mm.targetStopDuration=o.targetStopDuration,mm.blendMode=o.blendMode,mm.preWarmCycles=o.preWarmCycles,mm.preWarmStepOffset=o.preWarmStepOffset,mm.minInitialRotation=o.minInitialRotation,mm.maxInitialRotation=o.maxInitialRotation,mm.startSpriteCellID=o.startSpriteCellID,mm.spriteCellLoop=o.spriteCellLoop,mm.endSpriteCellID=o.endSpriteCellID,mm.spriteCellChangeSpeed=o.spriteCellChangeSpeed,mm.spriteCellWidth=o.spriteCellWidth,mm.spriteCellHeight=o.spriteCellHeight,mm.spriteRandomStartCell=o.spriteRandomStartCell,mm.isAnimationSheetEnabled=o.isAnimationSheetEnabled,mm.useLogarithmicDepth=o.useLogarithmicDepth;const f=o.getColorGradients();if(f){mm.colorGradients=[];for(const o of f){const u={gradient:o.gradient,color1:o.color1.df()};o.color2?u.color2=o.color2.df():u.color2=o.color1.df(),mm.colorGradients.push(u)}}const B=o.getRampGradients();if(B){mm.rampGradients=[];for(const o of B){const u={gradient:o.gradient,color:o.color.df()};mm.rampGradients.push(u)}mm.useRampGradients=o.useRampGradients}const O=o.getColorRemapGradients();if(O){mm.colorRemapGradients=[];for(const o of O){const u={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?u.factor2=o.factor2:u.factor2=o.factor1,mm.colorRemapGradients.push(u)}}const r=o.getAlphaRemapGradients();if(r){mm.alphaRemapGradients=[];for(const o of r){const u={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?u.factor2=o.factor2:u.factor2=o.factor1,mm.alphaRemapGradients.push(u)}}const w=o.getSizeGradients();if(w){mm.sizeGradients=[];for(const o of w){const u={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?u.factor2=o.factor2:u.factor2=o.factor1,mm.sizeGradients.push(u)}}const p=o.getAngularSpeedGradients();if(p){mm.angularSpeedGradients=[];for(const o of p){const u={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?u.factor2=o.factor2:u.factor2=o.factor1,mm.angularSpeedGradients.push(u)}}const K=o.getVelocityGradients();if(K){mm.velocityGradients=[];for(const o of K){const u={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?u.factor2=o.factor2:u.factor2=o.factor1,mm.velocityGradients.push(u)}}const z=o.getDragGradients();if(z){mm.dragGradients=[];for(const o of z){const u={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?u.factor2=o.factor2:u.factor2=o.factor1,mm.dragGradients.push(u)}}const Y=o.getEmitRateGradients();if(Y){mm.emitRateGradients=[];for(const o of Y){const u={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?u.factor2=o.factor2:u.factor2=o.factor1,mm.emitRateGradients.push(u)}}const q=o.getStartSizeGradients();if(q){mm.startSizeGradients=[];for(const o of q){const u={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?u.factor2=o.factor2:u.factor2=o.factor1,mm.startSizeGradients.push(u)}}const x=o.getLifeTimeGradients();if(x){mm.lifeTimeGradients=[];for(const o of x){const u={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?u.factor2=o.factor2:u.factor2=o.factor1,mm.lifeTimeGradients.push(u)}}const H=o.getLimitVelocityGradients();if(H){mm.limitVelocityGradients=[];for(const o of H){const u={gradient:o.gradient,factor1:o.factor1};void 0!==o.factor2?u.factor2=o.factor2:u.factor2=o.factor1,mm.limitVelocityGradients.push(u)}mm.limitVelocityDamping=o.limitVelocityDamping}o.noiseTexture&&(mm.noiseTexture=o.noiseTexture.serialize())}clone(mm,o){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f={...this._customWrappers};let B=null;const O=this._engine;if(O.createEffectForParticles&&null!=this.customShader){B=this.customShader;const mm=B.shaderOptions.defines.length>0?B.shaderOptions.defines.join("\n"):"",o=O.createEffectForParticles(B.shaderPath.fragmentElement,B.shaderOptions.uniforms,B.shaderOptions.samplers,mm);f[0]?f[0].effect=o:this.setCustomEffect(o,0)}const r=this.serialize(u),w=wo.Parse(r,this._scene||this._engine,this._rootUrl);return w.name=mm,w.customShader=B,w._customWrappers=f,void 0===o&&(o=this.ro),this.noiseTexture&&(w.noiseTexture=this.noiseTexture.clone()),w.ro=o,this.preventAutoStart||w.start(),w}}wo.BILLBOARDMODE_Y=2,wo.BILLBOARDMODE_ALL=7,wo.BILLBOARDMODE_STRETCHED=8,wo.BILLBOARDMODE_STRETCHED_LOCAL=9,nm._ParseParticleSystem=wo.Parse;var po=u(12971),Ko=u(12965),zo=u(12863);zo.b.prototype.createTransformFeedback=function(){const mm=this._gl.createTransformFeedback();if(!mm)throw new Error("Unable to create Transform Feedback");return mm},zo.b.prototype.deleteTransformFeedback=function(mm){this._gl.deleteTransformFeedback(mm)},zo.b.prototype.bindTransformFeedback=function(mm){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,mm)},zo.b.prototype.beginTransformFeedback=function(){let mm=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(mm?this._gl.POINTS:this._gl.TRIANGLES)},zo.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},zo.b.prototype.setTranformFeedbackVaryings=function(mm,o){this._gl.transformFeedbackVaryings(mm,o,this._gl.INTERLEAVED_ATTRIBS)},zo.b.prototype.bindTransformFeedbackBuffer=function(mm){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,mm?mm.underlyingResource:null)},zo.b.prototype.readTransformFeedbackBuffer=function(mm){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,mm)};const Yo="clipPlaneFragmentDeclaration2",qo="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";P.e.IncludesShadersStore[Yo]||(P.e.IncludesShadersStore[Yo]=qo);u(13861),u(13865),u(13871),u(13879),u(13883),u(13889),u(13891),u(13899);const xo="gpuRenderParticlesPixelShader",Ho="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";P.e.ShadersStore[xo]||(P.e.ShadersStore[xo]=Ho);const Eo="clipPlaneVertexDeclaration2",Mo="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";P.e.IncludesShadersStore[Eo]||(P.e.IncludesShadersStore[Eo]=Mo);u(13904),u(13911),u(13915),u(13921);const lo="gpuRenderParticlesVertexShader",to="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";P.e.ShadersStore[lo]||(P.e.ShadersStore[lo]=to);class Qo extends p{static get IsSupported(){if(!D.d.LastCreatedEngine)return!1;const mm=D.d.LastCreatedEngine.getCaps();return mm.supportTransformFeedbacks||mm.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(mm){this._maxActiveParticleCount=Math.min(mm,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(mm){this.maxActiveParticleCount=mm}createPointEmitter(mm,o){const u=hm(mm,o);return this.particleEmitterType=u,u}createHemisphericEmitter(){const mm=Zm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=mm,mm}createSphereEmitter(){const mm=Tm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=mm,mm}createDirectedSphereEmitter(){const mm=Dm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f.lo(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.lo(0,1,0));return this.particleEmitterType=mm,mm}createCylinderEmitter(){const mm=im(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=mm,mm}createDirectedCylinderEmitter(){const mm=mu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.lo(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new f.lo(0,1,0));return this.particleEmitterType=mm,mm}createConeEmitter(){const mm=oo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=mm,mm}createDirectedConeEmitter(){const mm=uo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new f.lo(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f.lo(0,1,0));return this.particleEmitterType=mm,mm}createBoxEmitter(mm,o,u,f){const B=new Y;return this.particleEmitterType=B,this.direction1=mm,this.direction2=o,this.minEmitBox=u,this.maxEmitBox=f,B}get flowMap(){return this._flowMap}set flowMap(mm){this._flowMap!==mm&&(this._flowMap=mm)}isReady(){if(!this.ro||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==wo.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(wo.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(wo.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";mm?setTimeout((()=>{this.start(0)}),mm):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var mm;let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(mm=this._customWrappers[o])||void 0===mm?void 0:mm.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[mm]??this._customWrappers[0]}setCustomEffect(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[o]=new mo.c(this._engine),this._customWrappers[o].effect=mm}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Z.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(mm,o,u){return super._removeGradientAndTexture(mm,o,u),this._releaseBuffers(),this}addColorGradient(mm,o){this._colorGradients||(this._colorGradients=[]);const u=new V(mm,o);return this._colorGradients.push(u),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(mm&&this._colorGradients.sort(((mm,o)=>mm.gradient<o.gradient?-1:mm.gradient>o.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(mm){return this._removeGradientAndTexture(mm,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const o in this._drawWrappers){var mm;null===(mm=this._drawWrappers[o].drawContext)||void 0===mm||mm.reset()}}_addFactorGradient(mm,o,u){const f=new U(o,u);mm.push(f),this._releaseBuffers()}addSizeGradient(mm,o){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,mm,o),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(mm){return this._removeGradientAndTexture(mm,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(mm,o){if(!mm)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&mm.sort(((mm,o)=>mm.gradient<o.gradient?-1:mm.gradient>o.gradient?1:0));const u=this;u[o]&&(u[o].dispose(),u[o]=null)}addAngularSpeedGradient(mm,o){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,mm,o),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(mm){return this._removeGradientAndTexture(mm,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(mm,o){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,mm,o),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(mm){return this._removeGradientAndTexture(mm,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(mm,o){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,mm,o),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(mm){return this._removeGradientAndTexture(mm,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(mm,o){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,mm,o),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(mm){return this._removeGradientAndTexture(mm,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(mm){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(mm,o,u){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(mm),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Jf=new Z.d,this.onStoppedObservable=new Z.d,this.onStartedObservable=new Z.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,u&&"Scene"!==u.getClassName()?(this._engine=u,this.defaultProjectionMatrix=f.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=u||D.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.kq.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,w.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,w.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,w.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,w.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new mo.c(this._engine)},this._customWrappers[0].effect=B,this._drawWrappers={0:new mo.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(o=o??{}).randomTextureSize||delete o.randomTextureSize;const r={Mp:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...o},p=o;isFinite(p)&&(r.Mp=p),this._capacity=r.Mp,this._maxActiveParticleCount=r.Mp,this._currentActiveCount=0,this._isAnimationSheetEnabled=O,this.particleEmitterType=new Y;const K=Math.min(this._engine.getCaps().maxTextureSize,r.randomTextureSize);let z=[];for(let f=0;f<K;++f)z.push(Math.random()),z.push(Math.random()),z.push(Math.random()),z.push(Math.random());this._randomTexture=new T.d(new Float32Array(z),K,1,5,u,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,z=[];for(let f=0;f<K;++f)z.push(Math.random()),z.push(Math.random()),z.push(Math.random()),z.push(Math.random());this._randomTexture2=new T.d(new Float32Array(z),K,1,5,u,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=K}_reset(){this._releaseBuffers()}_createVertexBuffers(mm,o,u){const f={};f.position=o.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let B=3;f.age=o.createVertexBuffer("age",B,1,this._attributesStrideSize,!0),B+=1,f.size=o.createVertexBuffer("size",B,3,this._attributesStrideSize,!0),B+=3,f.life=o.createVertexBuffer("life",B,1,this._attributesStrideSize,!0),B+=1,B+=4,this.billboardMode===wo.BILLBOARDMODE_STRETCHED&&(f.direction=o.createVertexBuffer("direction",B,3,this._attributesStrideSize,!0)),B+=3,this._platform.alignDataInBuffer&&(B+=1),this.particleEmitterType instanceof b&&(B+=3,this._platform.alignDataInBuffer&&(B+=1)),this._colorGradientsTexture||(f.color=o.createVertexBuffer("color",B,4,this._attributesStrideSize,!0),B+=4),this._isBillboardBased||(f.initialDirection=o.createVertexBuffer("initialDirection",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1)),this.noiseTexture&&(f.noiseCoordinates1=o.createVertexBuffer("noiseCoordinates1",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1),f.noiseCoordinates2=o.createVertexBuffer("noiseCoordinates2",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1)),f.angle=o.createVertexBuffer("angle",B,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?B++:B+=2,this._isAnimationSheetEnabled&&(f.cellIndex=o.createVertexBuffer("cellIndex",B,1,this._attributesStrideSize,!0),B+=1,this.spriteRandomStartCell&&(f.cellStartOffset=o.createVertexBuffer("cellStartOffset",B,1,this._attributesStrideSize,!0),B+=1)),f.offset=u.createVertexBuffer("offset",0,2),f.uv=u.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(f),this._platform.createVertexBuffers(mm,f),this.resetDrawCache()}_initialize(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!mm)return;const o=this._engine,u=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof b&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const B=this.particleEmitterType instanceof b,O=f.TmpVectors.lo[0];let r=0;for(let f=0;f<this._capacity;f++)if(u.push(0),u.push(0),u.push(0),u.push(0),u.push(0),u.push(0),u.push(0),u.push(0),u.push(Math.random()),u.push(Math.random()),u.push(Math.random()),u.push(Math.random()),B?(this.particleEmitterType.particleDestinationGenerator(f,null,O),u.push(O.x),u.push(O.y),u.push(O.z)):(u.push(0),u.push(0),u.push(0)),this._platform.alignDataInBuffer&&u.push(0),r+=16,B&&(this.particleEmitterType.particlePositionGenerator(f,null,O),u.push(O.x),u.push(O.y),u.push(O.z),this._platform.alignDataInBuffer&&u.push(0),r+=4),this._colorGradientsTexture||(u.push(0),u.push(0),u.push(0),u.push(0),r+=4),this.isBillboardBased||(u.push(0),u.push(0),u.push(0),this._platform.alignDataInBuffer&&u.push(0),r+=4),this.noiseTexture&&(u.push(Math.random()),u.push(Math.random()),u.push(Math.random()),this._platform.alignDataInBuffer&&u.push(0),u.push(Math.random()),u.push(Math.random()),u.push(Math.random()),this._platform.alignDataInBuffer&&u.push(0),r+=8),u.push(0),r+=1,this._angularSpeedGradientsTexture||(u.push(0),r+=1),this._isAnimationSheetEnabled&&(u.push(0),r+=1,this.spriteRandomStartCell&&(u.push(0),r+=1)),this._platform.alignDataInBuffer){let mm=3-(r+3&3);for(r+=mm;mm-- >0;)u.push(0)}const w=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),p=this._platform.createParticleBuffer(u),K=this._platform.createParticleBuffer(u);this._buffer0=new J.c(o,p,!1,this._attributesStrideSize),this._buffer1=new J.c(o,K,!1,this._attributesStrideSize),this._spriteBuffer=new J.c(o,w,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let mm=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(mm+="\n#define BILLBOARD"),this._colorGradientsTexture&&(mm+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(mm+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(mm+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(mm+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(mm+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(mm+="\n#define DRAGGRADIENTS"),this._flowMap&&(mm+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(mm+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(mm+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(mm+="\n#define NOISE"),this.isLocal&&(mm+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===mm||(this._cachedUpdateDefines=mm,this._updateBuffer=this._platform.createUpdateBuffer(mm)),this._platform.isUpdateBufferReady()}_getWrapper(mm){const o=this._getCustomDrawWrapper(mm);if(null!==o&&void 0!==o&&o.effect)return o;const u=[];this.fillDefines(u,mm);let f=this._drawWrappers[mm];f||(f=new mo.c(this._engine),f.drawContext&&(f.drawContext.useInstancing=!0),this._drawWrappers[mm]=f);const B=u.join("\n");if(f.defines!==B){const mm=[],o=[],u=[];this.fillUniformsAttributesAndSamplerNames(o,mm,u),f.setEffect(this._engine.createEffect("gpuRenderParticles",mm,o,u,B),B)}return f}static _GetAttributeNamesOrOptions(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const B=[J.f.PositionKind,"age","life","size","angle"];return mm||B.push(J.f.ColorKind),o&&B.push("cellIndex"),u||B.push("initialDirection"),f&&B.push("direction"),B.push("offset",J.f.UVKind),B}static _GetEffectCreationOptions(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f=["emitterWM","oz","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,om.e)(f),mm&&f.push("sheetInfos"),o&&f.push("logarithmicDepthConstant"),u&&(f.push("vFogInfos"),f.push("vFogColor")),f}fillDefines(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,om.l)(this,this._scene,mm),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Ko.d.FOGMODE_NONE&&mm.push("#define FOG")),o===wo.BLENDMODE_MULTIPLY&&mm.push("#define BLENDMULTIPLYMODE"),this.isLocal&&mm.push("#define LOCAL"),this.useLogarithmicDepth&&mm.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(mm.push("#define BILLBOARD"),this.billboardMode){case wo.BILLBOARDMODE_Y:mm.push("#define BILLBOARDY");break;case wo.BILLBOARDMODE_STRETCHED:mm.push("#define BILLBOARDSTRETCHED");break;case wo.BILLBOARDMODE_ALL:mm.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&mm.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&mm.push("#define ANIMATESHEET"),u&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),mm.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(mm,o,u){o.push(...Qo._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===wo.BILLBOARDMODE_STRETCHED)),mm.push(...Qo._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),u.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(po.d.PrepareUniforms(mm,this._imageProcessingConfigurationDefines),po.d.PrepareSamplers(u,this._imageProcessingConfigurationDefines))}animate(){var mm;let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(o?this.preWarmStepOffset:(null===(mm=this._scene)||void 0===mm?void 0:mm.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(mm,o){const u=this[o];if(!mm||!mm.length||u)return;const f=new Float32Array(this._rawTextureWidth);for(let B=0;B<this._rawTextureWidth;B++){const o=B/this._rawTextureWidth;h.GetCurrentGradient(o,mm,((mm,o,u)=>{f[B]=(0,K.Lerp)(mm.factor1,o.factor1,u)}))}this[o]=T.d.CreateRTexture(f,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[o].name=o.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const mm=new Uint8Array(4*this._rawTextureWidth),o=r.TmpColors.pp[0];for(let u=0;u<this._rawTextureWidth;u++){const f=u/this._rawTextureWidth;h.GetCurrentGradient(f,this._colorGradients,((f,B,O)=>{r.pp.LerpToRef(f.color1,B.color1,O,o),mm[4*u]=255*o.r,mm[4*u+1]=255*o.g,mm[4*u+2]=255*o.b,mm[4*u+3]=255*o.a}))}this._colorGradientsTexture=T.d.CreateRGBATexture(mm,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(mm,o){var u,B,O,r;const w=this._getWrapper(mm),p=w.effect;this._engine.enableEffect(w);const K=(null===(u=this._scene)||void 0===u?void 0:u.getViewMatrix())||f.Matrix.IdentityReadOnly;if(p.setMatrix("view",K),p.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),p.setTexture("diffuseSampler",this.particleTexture),p.setVector2("translationPivot",this.translationPivot),p.setVector3("oz",this.oz),this.isLocal&&p.setMatrix("emitterWM",o),this._colorGradientsTexture?p.setTexture("colorGradientSampler",this._colorGradientsTexture):p.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const mm=this.particleTexture.getBaseSize();p.setFloat3("sheetInfos",this.spriteCellWidth/mm.width,this.spriteCellHeight/mm.height,mm.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const mm=this._scene.activeCamera;p.setVector3("eyePosition",mm.globalPosition)}const z=p.defines;if(this._scene&&((0,om.h)(p,this,this._scene),this.applyFog&&(0,um.f)(this._scene,void 0,p)),z.indexOf("#define BILLBOARDMODE_ALL")>=0){const mm=K.clone();mm.invert(),p.setMatrix("invView",mm)}return this.useLogarithmicDepth&&this._scene&&(0,um.k)(z,p,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(p),this._setEngineBasedOnBlendMode(mm),this._platform.bindDrawBuffers(this._targetIndex,p,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(p),null!==(O=this._scene)&&void 0!==O&&O.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(r=this._scene)&&void 0!==r&&r.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(mm){if(!this.ro||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!mm)if(this.ro.position){mm=this.ro.getWorldMatrix()}else{const o=this.ro;mm=f.TmpVectors.Matrix[0],f.Matrix.TranslationToRef(o.x,o.y,o.z,mm)}const o=this._engine,u=o.getDepthWrite();if(o.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const mm=this.Pm();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",mm.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",mm),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const B=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=B,o.setDepthWrite(u)}render(){let mm,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!o&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let mm=0;mm<this.preWarmCycles;mm++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const mm=0|this._accumulatedCount;this._accumulatedCount-=mm,this._currentActiveCount+=mm}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.ro.position){mm=this.ro.getWorldMatrix()}else{const o=this.ro;mm=f.TmpVectors.Matrix[0],f.Matrix.TranslationToRef(o.x,o.y,o.z,mm)}const B=this._engine;this.updateInAnimate||this._update(mm);let O=0;return o||u||(B.setState(!1),this.forceDepthWrite&&B.setDepthWrite(!0),O=this.blendMode===wo.BLENDMODE_MULTIPLYADD?this._render(wo.BLENDMODE_MULTIPLY,mm)+this._render(wo.BLENDMODE_ADD,mm):this._render(this.blendMode,mm),this._engine.setAlphaMode(0)),O}rebuild(){const mm=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(mm,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,mm()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let mm=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const o in this._drawWrappers){this._drawWrappers[o].dispose()}if(this._drawWrappers={},this._scene){const mm=this._scene.kq.indexOf(this);mm>-1&&this._scene.kq.splice(mm,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let o=0;o<this._renderVertexBuffers.length;++o){const mm=this._renderVertexBuffers[o];for(const o in mm)mm[o].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),mm&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),mm&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Jf.notifyObservers(this),this.Jf.clear()}clone(mm,o){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f={...this._customWrappers};let B=null;const O=this._engine;if(O.createEffectForParticles&&null!=this.customShader){B=this.customShader;const mm=B.shaderOptions.defines.length>0?B.shaderOptions.defines.join("\n"):"";f[0]=O.createEffectForParticles(B.shaderPath.fragmentElement,B.shaderOptions.uniforms,B.shaderOptions.samplers,mm,void 0,void 0,void 0,this)}const r=this.serialize(u),w=Qo.Parse(r,this._scene||this._engine,this._rootUrl);return w.name=mm,w.customShader=B,w._customWrappers=f,void 0===o&&(o=this.ro),this.noiseTexture&&(w.noiseTexture=this.noiseTexture.clone()),w.ro=o,w}serialize(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const o={};return wo._Serialize(o,this,mm),o.activeParticleCount=this.activeParticleCount,o.randomTextureSize=this._randomTextureSize,o.customShader=this.customShader,o}static Parse(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0;const O=mm.name;let r,w;o instanceof Um.c?r=o:(w=o,r=w.getEngine());const p=new Qo(O,{Mp:B||mm.Mp,randomTextureSize:mm.randomTextureSize},o,null,mm.isAnimationSheetEnabled);if(p._rootUrl=u,mm.customShader&&r.createEffectForParticles){const o=mm.customShader,u=o.shaderOptions.defines.length>0?o.shaderOptions.defines.join("\n"):"",f=r.createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,u,void 0,void 0,void 0,p);p.setCustomEffect(f,0),p.customShader=o}return mm.id&&(p.id=mm.id),mm.activeParticleCount&&(p.activeParticleCount=mm.activeParticleCount),wo._Parse(mm,p,o,u),mm.preventAutoStart&&(p.preventAutoStart=mm.preventAutoStart),f||p.preventAutoStart||p.start(),p}}var bo=u(12549),Jo=u(13927),No=u(13101);class So{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(mm){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const o of this.systems)o.ro=mm;this._emitterNode=mm}setEmitterAsSphere(mm,o,u){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:mm,renderingGroupId:o};const f=(0,Jo.b)("emitterSphere",{diameter:mm.diameter,segments:mm.segments},u);f.renderingGroupId=o;const B=new No.Jo("emitterSphereMaterial",u);B.emissiveColor=mm.color,f.material=B;for(const O of this.systems)O.ro=f;this._emitterNode=f}start(mm){for(const o of this.systems)mm&&(o.ro=mm),o.start()}dispose(){for(const mm of this.systems)mm.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const o={systems:[]};for(const u of this.systems)o.systems.push(u.serialize(mm));return this._emitterNode&&(o.ro=this._emitterCreationOptions),o}static Parse(mm,o){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3?arguments[3]:void 0;const B=new So,O=this.BaseAssetsUrl+"/textures/";o=o||D.d.LastCreatedScene;for(const r of mm.systems)B.systems.push(u?Qo.Parse(r,o,O,!0,f):wo.Parse(r,o,O,!0,f));if(mm.ro){const u=mm.ro.options;if("Sphere"===mm.ro.kind)B.setEmitterAsSphere({diameter:u.diameter,segments:u.segments,color:r.No.So(u.color)},mm.ro.renderingGroupId,o)}return B}}So.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Po=u(12594);class Ro{static CreateDefault(mm){let o,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,f=arguments.length>2?arguments[2]:void 0;o=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Qo("default system",{Mp:u},f):new wo("default system",u,f),o.ro=mm;const B=bo.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return o.particleTexture=new s.b(B,o.Pm()),o.createConeEmitter(.1,Math.PI/4),o.color1=new r.pp(1,1,1,1),o.color2=new r.pp(1,1,1,1),o.colorDead=new r.pp(1,1,1,0),o.minSize=.1,o.maxSize=.1,o.minEmitPower=2,o.maxEmitPower=2,o.updateSpeed=1/60,o.emitRate=30,o}static CreateAsync(mm,o){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3?arguments[3]:void 0;o||(o=D.d.LastCreatedScene);const B={};return o.addPendingData(B),new Promise(((O,r)=>{if(u&&!Qo.IsSupported)return o.removePendingData(B),r("Particle system with GPU is not supported.");bo.Tools.LoadFile(`${Ro.BaseAssetsUrl}/systems/${mm}.json`,(mm=>{o.removePendingData(B);const r=JSON.parse(mm.toString());return O(So.Parse(r,o,u,f))}),void 0,void 0,void 0,(()=>(o.removePendingData(B),r(`An error occurred with the creation of your particle system. Check if your type '${mm}' exists.`))))}))}static ExportSet(mm){const o=new So;for(const u of mm)o.systems.push(u);return o}static ParseFromFileAsync(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",O=arguments.length>5?arguments[5]:void 0;return new Promise(((r,w)=>{const p=new Po.e;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const o=JSON.parse(p.responseText);let w;w=f?Qo.Parse(o,u,B,!1,O):wo.Parse(o,u,B,!1,O),mm&&(w.name=mm),r(w)}else w("Unable to load the particle system")})),p.open("GET",o),p.send()}))}static ParseFromSnippetAsync(mm,o){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",B=arguments.length>4?arguments[4]:void 0;if("_BLANK"===mm){const mm=this.CreateDefault(null);return mm.start(),Promise.resolve(mm)}return new Promise(((O,r)=>{const w=new Po.e;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const r=JSON.parse(JSON.parse(w.responseText).jsonPayload),p=JSON.parse(r.particleSystem);let K;K=u?Qo.Parse(p,o,f,!1,B):wo.Parse(p,o,f,!1,B),K.snippetId=mm,O(K)}else r("Unable to load the snippet "+mm)})),w.open("GET",this.SnippetUrl+"/"+mm.replace(/#/g,"/")),w.send()}))}}Ro.BaseAssetsUrl=So.BaseAssetsUrl,Ro.SnippetUrl="https://snippet.babylonjs.com",Ro.CreateFromSnippetAsync=Ro.ParseFromSnippetAsync;var go=u(13166),Wo=u(13002),Fo=u(13933);(0,Fo.f)(Wo.e.NAME_PARTICLESYSTEM,((mm,o,u,f)=>{const B=(0,Fo.i)(Wo.e.NAME_PARTICLESYSTEM);if(B&&void 0!==mm.kq&&null!==mm.kq)for(let O=0,r=mm.kq.length;O<r;O++){const r=mm.kq[O];u.kq.push(B(r,o,f))}})),(0,Fo.b)(Wo.e.NAME_PARTICLESYSTEM,((mm,o,u)=>{if(mm.activeParticleCount){return Qo.Parse(mm,o,u)}return wo.Parse(mm,o,u)})),Um.c.prototype.createEffectForParticles=function(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",O=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,w=arguments.length>6?arguments[6]:void 0,p=arguments.length>7?arguments[7]:void 0,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,z=arguments.length>9?arguments[9]:void 0,Y=[],q=[];const x=[];return p?p.fillUniformsAttributesAndSamplerNames(q,Y,x):(Y=wo._GetAttributeNamesOrOptions(),q=wo._GetEffectCreationOptions()),-1===B.indexOf(" BILLBOARD")&&(B+="\n#define BILLBOARD\n"),null!==p&&void 0!==p&&p.isAnimationSheetEnabled&&-1===B.indexOf(" ANIMATESHEET")&&(B+="\n#define ANIMATESHEET\n"),-1===f.indexOf("diffuseSampler")&&f.push("diffuseSampler"),this.createEffect({vertex:z??(null===p||void 0===p?void 0:p.vertexShaderName)??"particles",fragmentElement:mm},Y,q.concat(o),x.concat(f),B,O,r,w,void 0,K,(async()=>{0===K?await Promise.resolve().then(u.bind(u,13968)):await Promise.resolve().then(u.bind(u,14030))}))},go.d.prototype.getEmittedParticleSystems=function(){const mm=[];for(let o=0;o<this.Pm().kq.length;o++){const u=this.Pm().kq[o];u.ro===this&&mm.push(u)}return mm},go.d.prototype.getHierarchyEmittedParticleSystems=function(){const mm=[],o=this.getDescendants();o.push(this);for(let u=0;u<this.Pm().kq.length;u++){const f=this.Pm().kq[u],B=f.ro;B.position&&-1!==o.indexOf(B)&&mm.push(f)}return mm};u(13065),u(13076),u(13147);u(13151),u(13939),u(12924),u(13057),u(13184);u(12918);var co;u(13944),u(12760);!function(mm){mm[mm.Color=2]="Color",mm[mm.UV=1]="UV",mm[mm.Random=0]="Random",mm[mm.Stated=3]="Stated"}(co||(co={}));var Ao=u(12952);const yo=new f.lo(0,0,0),Io=new f.lo(0,0,0),so=new f.lo(0,0,0);class jo{constructor(mm,o,u){this.width=mm,this.height=o,this.data=u}processFlowable(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,u=arguments.length>2?arguments[2]:void 0;if(!u)return;u instanceof f.Matrix?f.lo.TransformCoordinatesToRef(mm.position,u,so):(so.x=u.x,so.y=u.y,so.z=u.z);const B=.5*so.x+.5,O=1-(.5*so.y+.5),r=Math.floor(B*this.width),w=Math.floor(O*this.height);if(r<0||r>=this.width||w<0||w>=this.height)return;const p=4*(w*this.width+r),K=this.data[p]/255*2-1,z=this.data[p+1]/255*2-1,Y=this.data[p+2]/255*2-1,q=this.data[p+3]/255;yo.set(K,z,Y),yo.scaleToRef(o*q,Io),mm.direction.addInPlace(Io)}_processParticle(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,u=arguments.length>2?arguments[2]:void 0;this.processFlowable(mm,o,u)}static async FromUrlAsync(mm){return await new Promise(((o,u)=>{const f=document.createElement("canvas"),B=f.getContext("2d");let O=null;const r=new Image;r.crossOrigin="anonymous",r.src=mm,r.onerror=o=>{u(new Error(`Failed to load image: ${mm} : ${o}`))},r.onload=()=>{f.width=r.width,f.height=r.height,B.drawImage(r,0,0),O=B.getImageData(0,0,f.width,f.height),o(new jo(f.width,f.height,O.data))}}))}static async ExtractFromTextureAsync(mm){return await new Promise(((o,u)=>{if(!mm.isReady())return void mm.onLoadObservable.addOnce((async()=>{try{const u=await this.ExtractFromTextureAsync(mm);o(u)}catch(f){u(f)}}));const f=mm.getSize();Ao.j.GetTextureDataAsync(mm,f.width,f.height).then((mm=>{o(new jo(f.width,f.height,new Uint8ClampedArray(mm)))})).catch(u)}))}}var ao,Xo,Go,ko,eo,Lo,Co,vo,Vo;!function(mm){mm[mm.Int=1]="Int",mm[mm.Float=2]="Float",mm[mm.Vector2=4]="Vector2",mm[mm.lo=8]="lo",mm[mm.Matrix=16]="Matrix",mm[mm.Particle=32]="Particle",mm[mm.Texture=64]="Texture",mm[mm.pp=128]="pp",mm[mm.FloatGradient=256]="FloatGradient",mm[mm.Vector2Gradient=512]="Vector2Gradient",mm[mm.Vector3Gradient=1024]="Vector3Gradient",mm[mm.Color4Gradient=2048]="Color4Gradient",mm[mm.System=4096]="System",mm[mm.AutoDetect=8192]="AutoDetect",mm[mm.BasedOnInput=16384]="BasedOnInput",mm[mm.Undefined=32768]="Undefined",mm[mm.All=65535]="All"}(ao||(ao={})),function(mm){mm[mm.Compatible=0]="Compatible",mm[mm.TypeIncompatible=1]="TypeIncompatible",mm[mm.HierarchyIssue=2]="HierarchyIssue"}(Xo||(Xo={})),function(mm){mm[mm.Input=0]="Input",mm[mm.Output=1]="Output"}(Go||(Go={}));class no{get direction(){return this._direction}get type(){if(this._type===ao.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===ao.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(mm){this._type=mm}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((mm=>mm.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(mm,o,u){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=ao.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new Z.d,this.onDisconnectionObservable=new Z.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=o,this.name=mm,this._direction=u}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(mm){var o;return this.isConnected?null!==(o=this._connectedPoint)&&void 0!==o&&o._storedFunction?this._connectedPoint._storedFunction(mm):this._connectedPoint._storedValue:this.value}canConnectTo(mm){return 0===this.checkCompatibilityState(mm)}checkCompatibilityState(mm){const o=this._ownerBlock,u=mm.ownerBlock;if(this.type!==mm.type&&mm.innerType!==ao.AutoDetect)return mm.acceptedConnectionPointTypes&&-1!==mm.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(mm.excludedConnectionPointTypes&&-1!==mm.excludedConnectionPointTypes.indexOf(this.type))return 1;let f=u,B=o;return 0===this.direction&&(f=o,B=u),f.isAnAncestorOf(B)?2:0}connectTo(mm){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(mm))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${mm.ownerBlock.name}".${mm.name}`;return this._endpoints.push(mm),mm._connectedPoint=this,this.onConnectionObservable.notifyObservers(mm),mm.onConnectionObservable.notifyObservers(this),this}disconnectFrom(mm){const o=this._endpoints.indexOf(mm);return-1===o||(this._endpoints.splice(o,1),mm._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(mm),mm.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(mm){let o=1;for(;o<ao.All;)mm&o||this.excludedConnectionPointTypes.push(o),o<<=1}serialize(){let mm=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const o={};return o.name=this.name,o.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.df?(o.valueType="BABYLON."+this.value.getClassName(),o.value=this.value.df()):(o.valueType="number",o.value=this.value)),mm&&this.connectedPoint&&(o.inputName=this.name,o.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,o.targetConnectionName=this.connectedPoint.name,o.isExposedOnFrame=!0,o.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(o.isExposedOnFrame=!0,o.exposedPortPosition=this.exposedPortPosition),o}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Uo{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(mm){this._name=mm}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(mm){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new Z.d,this.Jf=new Z.d,this.onInputChangedObservable=new Z.d,this.visibleOnFrame=!1,this._name=mm,this.uniqueId=j.b.UniqueId}_inputRename(mm){return mm}_outputRename(mm){return mm}isAnAncestorOf(mm){for(const o of this._outputs)if(o.hasEndpoints)for(const u of o.endpoints){if(u.ownerBlock===mm)return!0;if(u.ownerBlock.isAnAncestorOf(mm))return!0}return!1}isAnAncestorOfType(mm){if(this.getClassName()===mm)return!0;for(const o of this._outputs)if(o.hasEndpoints)for(const u of o.endpoints)if(u.ownerBlock.isAnAncestorOfType(mm))return!0;return!1}getInputByName(mm){const o=this._inputs.filter((o=>o.name===mm));return o.length?o[0]:null}_linkConnectionTypes(mm,o){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[o]._acceptedConnectionPointType=this._inputs[mm]:(this._inputs[mm]._linkedConnectionSource=this._inputs[o],this._inputs[mm]._isMainLinkSource=!0),this._inputs[o]._linkedConnectionSource=this._inputs[mm]}registerInput(mm,o){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0,O=arguments.length>5?arguments[5]:void 0;const r=new no(mm,this,0);return r.type=o,r.isOptional=u,r.defaultValue=f,r.value=f,r.valueMin=B,r.valueMax=O,this._inputs.push(r),this.onInputChangedObservable.notifyObservers(r),this}registerOutput(mm,o,u){return(u=u??new no(mm,this,1)).type=o,this._outputs.push(u),this}_build(mm){}_customBuildStep(mm){}build(mm){if(this._buildId===mm.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((mm=>mm.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=mm.buildId;for(const o of this._inputs){if(!o.connectedPoint){o.isOptional||mm.notConnectedNonOptionalInputs.push(o);continue}const u=o.connectedPoint.ownerBlock;u&&u!==this&&!u.isSystem&&u.build(mm)}return this._customBuildStep(mm),mm.verbose&&a.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(mm),this.onBuildObservable.notifyObservers(this),!1}serialize(){const mm={};mm.customType="BABYLON."+this.getClassName(),mm.id=this.uniqueId,mm.name=this.name,mm.visibleOnFrame=this.visibleOnFrame,mm.inputs=[],mm.outputs=[];for(const o of this.inputs)mm.inputs.push(o.serialize());for(const o of this.outputs)mm.outputs.push(o.serialize(!1));return mm}_deserialize(mm){this._name=mm.name,this.comments=mm.comments,this.visibleOnFrame=!!mm.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(mm)}_deserializePortDisplayNamesAndExposedOnFrame(mm){const o=mm.inputs,u=mm.outputs;if(o)for(const f of o){const mm=this.inputs.find((mm=>mm.name===f.name));if(!mm)return;if(f.displayName&&(mm.displayName=f.displayName),f.isExposedOnFrame&&(mm.isExposedOnFrame=f.isExposedOnFrame,mm.exposedPortPosition=f.exposedPortPosition),void 0!==f.value&&null!==f.value)if("number"===f.valueType)mm.value=f.value;else{const o=(0,w.b)(f.valueType);o&&(mm.value=o.So(f.value))}}if(u)for(let f=0;f<u.length;f++){const mm=u[f];mm.displayName&&(this.outputs[f].displayName=mm.displayName),mm.isExposedOnFrame&&(this.outputs[f].isExposedOnFrame=mm.isExposedOnFrame,this.outputs[f].exposedPortPosition=mm.exposedPortPosition)}}clone(){const mm=this.serialize(),o=(0,w.b)(mm.customType);if(o){const u=new o;return u._deserialize(mm),u}return null}dispose(){this.Jf.notifyObservers(this),this.Jf.clear();for(const mm of this.inputs)mm.dispose();for(const mm of this.outputs)mm.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function ho(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",f=arguments.length>3?arguments[3]:void 0;return(B,O)=>{let r=B._propStore;r||(r=[],B._propStore=r),r.push({propertyName:O,displayName:mm,type:o,groupName:u,options:f??{},className:B.getClassName()})}}(0,A.d)([(0,y.J)("comment")],Uo.prototype,"comments",void 0),function(mm){mm[mm.Boolean=0]="Boolean",mm[mm.Float=1]="Float",mm[mm.Int=2]="Int",mm[mm.Vector2=3]="Vector2",mm[mm.List=4]="List",mm[mm.pp=5]="pp",mm[mm.SamplingMode=6]="SamplingMode",mm[mm.TextureFormat=7]="TextureFormat",mm[mm.TextureType=8]="TextureType"}(ko||(ko={})),function(mm){mm[mm.None=0]="None",mm[mm.Position=1]="Position",mm[mm.Direction=2]="Direction",mm[mm.Age=3]="Age",mm[mm.Lifetime=4]="Lifetime",mm[mm.Color=5]="Color",mm[mm.ScaledDirection=6]="ScaledDirection",mm[mm.Scale=7]="Scale",mm[mm.AgeGradient=8]="AgeGradient",mm[mm.Angle=9]="Angle",mm[mm.SpriteCellIndex=16]="SpriteCellIndex",mm[mm.SpriteCellStart=17]="SpriteCellStart",mm[mm.SpriteCellEnd=18]="SpriteCellEnd"}(eo||(eo={})),function(mm){mm[mm.None=0]="None",mm[mm.Time=1]="Time",mm[mm.Delta=2]="Delta",mm[mm.Emitter=3]="Emitter"}(Lo||(Lo={}));class Zo{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let mm="";for(const o of this.notConnectedNonOptionalInputs)mm+=`input ${o.name} from block ${o.ownerBlock.name}[${o.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(mm)throw"Build of Node Particle System Set failed:\n"+mm}adapt(mm,o){const u=mm.getConnectedValue(this)||0;if(mm.type===o)return u;switch(o){case ao.Vector2:return new f.Vector2(u,u);case ao.lo:return new f.lo(u,u,u);case ao.pp:return new r.pp(u,u,u,u)}return null}getContextualValue(mm){if(!this.particleContext||!this.systemContext)return null;switch(mm){case eo.Position:return this.particleContext.position;case eo.Direction:return this.particleContext.direction;case eo.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case eo.Color:return this.particleContext.color;case eo.Age:return this.particleContext.age;case eo.Lifetime:return this.particleContext.lifeTime;case eo.Angle:return this.particleContext.angle;case eo.Scale:return this.particleContext.scale;case eo.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case eo.SpriteCellEnd:return this.systemContext.endSpriteCellID;case eo.SpriteCellIndex:return this.particleContext.cellIndex;case eo.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.ro.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.ro.absolutePosition:this.systemContext.ro:null}getSystemValue(mm){if(!this.particleContext||!this.systemContext)return null;switch(mm){case Lo.Time:return this.systemContext._actualFrame;case Lo.Delta:return this.systemContext._scaledUpdateSpeed;case Lo.Emitter:if(this.isEmitterTransformNode){return this.systemContext.ro.absolutePosition}return this.systemContext.ro}return null}}function To(mm,o,u){const f=new Zo;f.bo=o;const B=mm.createSystem(f);return B.canStart=()=>!0,B.ro=u.clone(),B.disposeOnStop=!0,B.start(),B}class Do extends Uo{constructor(mm){super(mm),this.blendMode=p.BLENDMODE_ONEONE,this.Mp=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",ao.Particle),this.registerInput("texture",ao.Texture),this.registerInput("onStart",ao.System,!0),this.registerInput("onEnd",ao.System,!0),this.registerOutput("system",ao.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(mm){mm.Mp=this.Mp,mm.buildId=this._buildId++,this.build(mm);const o=this.particle.getConnectedValue(mm);return o.particleTexture=this.texture.getConnectedValue(mm),o.emitRate=this.emitRate,o.blendMode=this.blendMode,o.name=this.name,o._nodeGenerated=!0,o._targetStopDuration=this.targetStopDuration,o.startDelay=this.startDelay,this.system._storedValue=this,o.canStart=()=>!this.doNoStart,o.onStartedObservable.add((u=>{const f=this.onStart.getConnectedValue(mm);f&&u.onStartedObservable.addOnce((()=>{mm.systemContext=o;const u=To(f,mm.bo,mm.emitterPosition);this.Jf.addOnce((()=>{u.dispose()}))}));const B=this.onEnd.getConnectedValue(mm);B&&u.onStoppedObservable.addOnce((()=>{mm.systemContext=o;const u=To(B,mm.bo,mm.emitterPosition);this.Jf.addOnce((()=>{u.dispose()}))}))})),this.Jf.addOnce((()=>{o.dispose()})),o}serialize(){const mm=super.serialize();return mm.Mp=this.Mp,mm.emitRate=this.emitRate,mm.blendMode=this.blendMode,mm.doNoStart=this.doNoStart,mm.targetStopDuration=this.targetStopDuration,mm.startDelay=this.startDelay,mm}_deserialize(mm){super._deserialize(mm),this.Mp=mm.Mp,this.emitRate=mm.emitRate,this.doNoStart=!!mm.doNoStart,void 0!==mm.blendMode&&(this.blendMode=mm.blendMode),void 0!==mm.targetStopDuration&&(this.targetStopDuration=mm.targetStopDuration),void 0!==mm.startDelay&&(this.startDelay=mm.startDelay)}}(0,A.d)([ho("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:p.BLENDMODE_ONEONE},{label:"Standard",value:p.BLENDMODE_STANDARD},{label:"Add",value:p.BLENDMODE_ADD},{label:"Multiply",value:p.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:p.BLENDMODE_MULTIPLYADD}]})],Do.prototype,"blendMode",void 0),(0,A.d)([ho("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Do.prototype,"Mp",void 0),(0,A.d)([ho("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Do.prototype,"emitRate",void 0),(0,A.d)([ho("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Do.prototype,"targetStopDuration",void 0),(0,A.d)([ho("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Do.prototype,"startDelay",void 0),(0,A.d)([ho("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Do.prototype,"doNoStart",void 0),(0,w.c)("BABYLON.SystemBlock",Do);class io extends Uo{get type(){if(this._type===ao.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=ao.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=ao.Vector2,this._type;case"lo":return this._type=ao.lo,this._type;case"pp":return this._type=ao.pp,this._type;case"Matrix":return this._type=ao.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===eo.None&&this._systemSource!==Lo.None}get systemSource(){return this._systemSource}set systemSource(mm){if(this._systemSource=mm,mm!==Lo.None){switch(this._contextualSource=eo.None,this._type=ao.Float,mm){case Lo.Time:case Lo.Delta:this._type=ao.Float;break;case Lo.Emitter:this._type=ao.lo}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==eo.None}get contextualValue(){return this._contextualSource}set contextualValue(mm){if(this._contextualSource=mm,mm!==eo.None){switch(this._systemSource=Lo.None,mm){case eo.Scale:this._type=ao.Vector2;break;case eo.Position:case eo.Direction:case eo.ScaledDirection:this._type=ao.lo;break;case eo.Color:this._type=ao.pp;break;case eo.Age:case eo.Lifetime:case eo.Angle:case eo.AgeGradient:this._type=ao.Float;break;case eo.SpriteCellEnd:case eo.SpriteCellStart:case eo.SpriteCellIndex:this._type=ao.Int}this.output&&(this.output.type=this._type)}}constructor(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ao.AutoDetect;super(mm),this._type=ao.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new Z.d,this._systemSource=Lo.None,this._contextualSource=eo.None,this._type=o,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",o)}get value(){return this._storedValue}set value(mm){this.type===ao.Float&&this.min!==this.max&&(mm=Math.max(this.min,mm),mm=Math.min(this.max,mm)),this._storedValue=mm,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(mm){this._valueCallback=mm}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case ao.Int:case ao.Float:this.value=0;break;case ao.Vector2:this.value=f.Vector2.Zero();break;case ao.lo:this.value=f.lo.Zero();break;case ao.pp:this.value=new r.pp(1,1,1,1);break;case ao.Matrix:this.value=f.Matrix.Identity()}}_build(mm){super._build(mm),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=mm=>mm.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=mm=>mm.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const mm=super.serialize();return mm.type=this.type,mm.contextualValue=this.contextualValue,mm.systemSource=this.systemSource,mm.min=this.min,mm.max=this.max,mm.groupInInspector=this.groupInInspector,mm.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.df?(mm.valueType="BABYLON."+this._storedValue.getClassName(),mm.value=this._storedValue.df()):(mm.valueType="number",mm.value=this._storedValue)),mm}_deserialize(mm){if(super._deserialize(mm),this._type=mm.type,this.contextualValue=mm.contextualValue,this.systemSource=mm.systemSource||Lo.None,this.min=mm.min||0,this.max=mm.max||0,this.groupInInspector=mm.groupInInspector||"",void 0!==mm.displayInInspector&&(this.displayInInspector=mm.displayInInspector),mm.valueType)if("number"===mm.valueType)this._storedValue=mm.value;else{const o=(0,w.b)(mm.valueType);o&&(this._storedValue=o.So(mm.value))}}}(0,w.c)("BABYLON.ParticleInputBlock",io);class mf extends Uo{get url(){return this._url}set url(mm){this._url!==mm&&(this._cachedData=null,this._url=mm,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(mm){this._textureDataUrl!==mm&&(this._cachedData=null,this._textureDataUrl=mm,this._url="",this._sourceTexture=null)}set sourceTexture(mm){this._sourceTexture!==mm&&(this._cachedData=null,this._sourceTexture=mm,this._url="",this._textureDataUrl="")}constructor(mm){super(mm),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",ao.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const mm=this.texture._storedValue;return await new Promise(((o,u)=>{if(!mm.isReady())return void mm.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),o(this._cachedData)}catch(mm){u(mm)}}));const f=mm.getSize();Ao.j.GetTextureDataAsync(mm,f.width,f.height).then((u=>{this._cachedData={width:f.width,height:f.height,data:new Uint8ClampedArray(u)},mm.dispose(),o(this._cachedData)})).catch(u)}))}_build(mm){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new s.b(this._textureDataUrl,mm.bo):this.texture._storedValue=new s.b(this._url,mm.bo):this.texture._storedValue=null}serialize(){const mm=super.serialize();return mm.url=this.url,mm.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(mm.textureDataUrl=this.textureDataUrl),mm}_deserialize(mm){super._deserialize(mm),this.url=mm.url,this.serializedCachedData=!!mm.serializedCachedData,mm.textureDataUrl&&(this.textureDataUrl=mm.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,w.c)("BABYLON.ParticleTextureSourceBlock",mf);class ou extends Uo{constructor(mm){super(mm),this.registerInput("particle",ao.Particle),this.registerInput("position",ao.lo),this.registerOutput("output",ao.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(mm){const o=this.particle.getConnectedValue(mm);if(this.output._storedValue=o,!this.position.isConnected)return;const u={process:u=>{mm.particleContext=u,mm.systemContext=o,u.position.p(this.position.getConnectedValue(mm))},previousItem:null,nextItem:null};o._updateQueueStart?em(u,o._updateQueueStart):o._updateQueueStart=u}}(0,w.c)("BABYLON.UpdatePositionBlock",ou),function(mm){mm[mm.Add=0]="Add",mm[mm.Subtract=1]="Subtract",mm[mm.Multiply=2]="Multiply",mm[mm.Divide=3]="Divide",mm[mm.Max=4]="Max",mm[mm.Min=5]="Min"}(Co||(Co={}));class uu extends Uo{constructor(mm){super(mm),this.operation=Co.Add,this.registerInput("left",ao.AutoDetect),this.registerInput("right",ao.AutoDetect),this.registerOutput("output",ao.BasedOnInput),this.output._typeConnectionSource=this.left;const o=[ao.Matrix,ao.Particle,ao.Texture,ao.System,ao.FloatGradient,ao.Color4Gradient,ao.Vector2Gradient,ao.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...o),this.right.excludedConnectionPointTypes.push(...o),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(mm){let o;const u=this.left,B=this.right;if(!u.isConnected||!B.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const O=u.type===ao.Float||u.type===ao.Int,w=B.type===ao.Float||B.type===ao.Int,p=O&&w;switch(this.operation){case Co.Add:o=p?mm=>u.getConnectedValue(mm)+B.getConnectedValue(mm):O?mm=>mm.adapt(u,B.type).add(B.getConnectedValue(mm)):mm=>u.getConnectedValue(mm).add(mm.adapt(B,u.type));break;case Co.Subtract:o=p?mm=>u.getConnectedValue(mm)-B.getConnectedValue(mm):O?mm=>mm.adapt(u,B.type).Qo(B.getConnectedValue(mm)):mm=>u.getConnectedValue(mm).Qo(mm.adapt(B,u.type));break;case Co.Multiply:o=p?mm=>u.getConnectedValue(mm)*B.getConnectedValue(mm):O?mm=>mm.adapt(u,B.type).multiply(B.getConnectedValue(mm)):mm=>u.getConnectedValue(mm).multiply(mm.adapt(B,u.type));break;case Co.Divide:o=p?mm=>u.getConnectedValue(mm)/B.getConnectedValue(mm):O?mm=>mm.adapt(u,B.type).divide(B.getConnectedValue(mm)):mm=>u.getConnectedValue(mm).divide(mm.adapt(B,u.type));break;case Co.Min:if(p)o=mm=>Math.min(u.getConnectedValue(mm),B.getConnectedValue(mm));else{const[mm,w]=O?[B,u]:[u,B];switch(mm.type){case ao.Vector2:o=o=>f.Vector2.Minimize(mm.getConnectedValue(o),o.adapt(w,mm.type));break;case ao.lo:o=o=>f.lo.Minimize(mm.getConnectedValue(o),o.adapt(w,mm.type));break;case ao.pp:o=o=>{const u=mm.getConnectedValue(o),{r:f,g:B,b:O,a:p}=o.adapt(w,mm.type);return new r.pp(Math.min(u.r,f),Math.min(u.g,B),Math.min(u.b,O),Math.min(u.a,p))}}}break;case Co.Max:if(!p){const[mm,w]=O?[B,u]:[u,B];switch(mm.type){case ao.Vector2:o=o=>f.Vector2.Maximize(mm.getConnectedValue(o),o.adapt(w,mm.type));break;case ao.lo:o=o=>f.lo.Maximize(mm.getConnectedValue(o),o.adapt(w,mm.type));break;case ao.pp:o=o=>{const u=mm.getConnectedValue(o),{r:f,g:B,b:O,a:p}=o.adapt(w,mm.type);return new r.pp(Math.max(u.r,f),Math.min(u.g,B),Math.min(u.b,O),Math.min(u.a,p))}}break}o=mm=>Math.max(u.getConnectedValue(mm),B.getConnectedValue(mm))}this.output._storedFunction=mm=>u.type===ao.Int?0|o(mm):o(mm)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===ao.Int||this.left.type===ao.Float&&this.right.type!==ao.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[mm,o]of[[this.left,this.right],[this.right,this.left]])mm.acceptedConnectionPointTypes=[ao.Int,ao.Float],o.isConnected&&(mm.acceptedConnectionPointTypes.push(o.type),o.type!==ao.Int&&o.type!==ao.Float||mm.acceptedConnectionPointTypes.push(ao.Vector2,ao.lo,ao.pp))}dispose(){super.dispose();for(const mm of this._connectionObservers)mm.remove();this._connectionObservers.length=0}serialize(){const mm=super.serialize();return mm.operation=this.operation,mm}_deserialize(mm){super._deserialize(mm),this.operation=mm.operation}}(0,A.d)([ho("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Co.Add},{label:"Subtract",value:Co.Subtract},{label:"Multiply",value:Co.Multiply},{label:"Divide",value:Co.Divide},{label:"Max",value:Co.Max},{label:"Min",value:Co.Min}]})],uu.prototype,"operation",void 0),(0,w.c)("BABYLON.ParticleMathBlock",uu);class fu extends Uo{constructor(mm){super(mm),this.registerInput("particle",ao.Particle),this.registerInput("direction1",ao.lo,!0,new f.lo(0,1,0)),this.registerInput("direction2",ao.lo,!0,new f.lo(0,1,0)),this.registerInput("minEmitBox",ao.lo,!0,new f.lo(-.5,-.5,-.5)),this.registerInput("maxEmitBox",ao.lo,!0,new f.lo(.5,.5,.5)),this.registerOutput("output",ao.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(mm){const o=this.particle.getConnectedValue(mm);o._directionCreation.process=u=>{mm.particleContext=u,mm.systemContext=o;const B=this.direction1.getConnectedValue(mm),O=this.direction2.getConnectedValue(mm),r=(0,K.RandomRange)(B.x,O.x),w=(0,K.RandomRange)(B.y,O.y),p=(0,K.RandomRange)(B.z,O.z);mm.isEmitterTransformNode?f.lo.TransformNormalFromFloatsToRef(r,w,p,mm.emitterWorldMatrix,u.direction):u.direction.Op(r,w,p)},o._positionCreation.process=u=>{mm.particleContext=u,mm.systemContext=o;const B=this.minEmitBox.getConnectedValue(mm),O=this.maxEmitBox.getConnectedValue(mm),r=(0,K.RandomRange)(B.x,O.x),w=(0,K.RandomRange)(B.y,O.y),p=(0,K.RandomRange)(B.z,O.z);mm.isEmitterTransformNode?f.lo.TransformCoordinatesFromFloatsToRef(r,w,p,mm.emitterWorldMatrix,u.position):(u.position.Op(r,w,p),u.position.addInPlace(mm.emitterPosition))},this.output._storedValue=o}}(0,w.c)("BABYLON.BoxShapeBlock",fu);class Bu extends Uo{constructor(mm){super(mm),this.registerInput("emitPower",ao.Float,!0,1),this.registerInput("lifeTime",ao.Float,!0,1),this.registerInput("color",ao.pp,!0,new r.pp(1,1,1,1)),this.registerInput("scale",ao.Vector2,!0,new f.Vector2(1,1)),this.registerInput("angle",ao.Float,!0,0),this.registerOutput("particle",ao.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(mm){const o=new wo(this.name,mm.Mp,mm.bo,null,!1,void 0,!0);o.particleEmitterType=new l,o._lifeTimeCreation.process=(o,u)=>{mm.particleContext=o,o.lifeTime=this.lifeTime.getConnectedValue(mm),u._emitPower=this.emitPower.getConnectedValue(mm)},o._colorCreation.process=o=>{mm.particleContext=o,o.color.p(this.color.getConnectedValue(mm))},o._sizeCreation.process=o=>{mm.particleContext=o,o.size=1,o.scale.p(this.scale.getConnectedValue(mm))},o._angleCreation.process=o=>{mm.particleContext=o,o.angle=this.angle.getConnectedValue(mm)},this.particle._storedValue=o}}(0,w.c)("BABYLON.CreateParticleBlock",Bu);class Ou{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const mm=[];for(const o of this.attachedBlocks)o.isInput&&mm.push(o);return mm}constructor(mm){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new Z.d,this.name=mm}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(mm){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(mm)&&this.attachedBlocks.push(mm);for(const u of mm.inputs){const f=u.connectedPoint;if(f){const u=f.ownerBlock;u!==mm&&this._initializeBlock(u,o)}}}async buildAsync(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((u=>{const f=new So;for(const mm of this._systemBlocks)this._initializeBlock(mm);for(const B of this.systemBlocks){const u=new Zo;u.buildId=this._buildId++,u.bo=mm,u.verbose=o;const O=B.createSystem(u);u.emitErrors(),f.systems.push(O)}this.onBuildObservable.notifyObservers(this),u(f)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const mm=new Do("Particle system"),o=new ou("Update position");o.output.connectTo(mm.particle);const u=new io("Position");u.contextualValue=eo.Position;const f=new io("Scaled direction");f.contextualValue=eo.ScaledDirection;const B=new uu("Add");B.operation=Co.Add,u.output.connectTo(B.left),f.output.connectTo(B.right),B.output.connectTo(o.position);const O=new Bu("Create particle"),r=new fu("Box shape");O.particle.connectTo(r.particle),r.output.connectTo(o.particle);const w=new mf("Texture");w.texture.connectTo(mm.texture),w.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(mm)}removeBlock(mm){const o=this.attachedBlocks.indexOf(mm);if(o>-1&&this.attachedBlocks.splice(o,1),mm.isSystem){const o=this._systemBlocks.indexOf(mm);o>-1&&this._systemBlocks.splice(o,1)}}parseSerializedObject(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o||this.clear();const u={};for(const f of mm.mq){const mm=(0,w.b)(f.customType);if(mm){const o=new mm;o._deserialize(f),u[f.id]=o,this.attachedBlocks.push(o),o.isSystem&&this._systemBlocks.push(o)}}for(const f of this.attachedBlocks)if(f.isTeleportOut){const mm=f,o=mm._tempEntryPointUniqueId;if(o){const f=u[o];f&&f.attachToEndpoint(mm)}}for(let f=0;f<mm.mq.length;f++){const B=mm.mq[f],O=u[B.id];O&&(O.inputs.length&&B.inputs.some((mm=>mm.targetConnectionName))&&!o||this._restoreConnections(O,mm,u))}if(mm.locations||mm.editorData&&mm.editorData.locations){const f=mm.locations||mm.editorData.locations;for(const mm of f)u[mm.XB]&&(mm.XB=u[mm.XB].uniqueId);o&&this.editorData&&this.editorData.locations&&f.concat(this.editorData.locations),mm.locations?this.editorData={locations:f}:(this.editorData=mm.editorData,this.editorData.locations=f);const B=[];for(const mm in u)B[mm]=u[mm].uniqueId;this.editorData.map=B}this.comment=mm.comment}_restoreConnections(mm,o,u){for(const f of mm.outputs)for(const B of o.mq){const O=u[B.id];if(O)for(const r of B.inputs)if(u[r.targetBlockId]!==mm||r.targetConnectionName!==f.name);else{const mm=O.getInputByName(r.inputName);if(!mm||mm.isConnected)continue;f.connectTo(mm,!0),this._restoreConnections(O,o,u)}}}serialize(mm){const o=mm?{}:I.c.Serialize(this);o.editorData=JSON.parse(JSON.stringify(this.editorData));let u=[];mm?u=mm:o.customType="BABYLON.NodeParticleSystemSet",o.mq=[];for(const f of u)o.mq.push(f.serialize());if(!mm)for(const f of this.attachedBlocks)-1===u.indexOf(f)&&o.mq.push(f.serialize());return o}dispose(){for(const mm of this.attachedBlocks)mm.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(mm){const o=new Ou(mm);return o.setToDefault(),o}static Parse(mm){const o=I.c.Parse((()=>new Ou(mm.name)),mm,null);return o.parseSerializedObject(mm),o}static ParseFromSnippetAsync(mm,o){return"_BLANK"===mm?Promise.resolve(Ou.CreateDefault("blank")):new Promise(((u,f)=>{const B=new Po.e;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const r=JSON.parse(JSON.parse(B.responseText).jsonPayload),w=JSON.parse(r.nodeParticle);o||(o=I.c.Parse((()=>new Ou(mm)),w,null)),o.parseSerializedObject(w),o.snippetId=mm;try{u(o)}catch(O){f(O)}}else f("Unable to load the snippet "+mm)})),B.open("GET",this.SnippetUrl+"/"+mm.replace(/#/g,"/")),B.send()}))}}Ou.EditorURL=`${bo.Tools._DefaultCdnUrl}/v${Um.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Ou.SnippetUrl="https://snippet.babylonjs.com",(0,A.d)([(0,y.J)()],Ou.prototype,"name",void 0),(0,A.d)([(0,y.J)("comment")],Ou.prototype,"comment",void 0),function(mm){mm[mm.None=0]="None",mm[mm.PerParticle=1]="PerParticle",mm[mm.PerSystem=2]="PerSystem"}(vo||(vo={}));class ru extends Uo{constructor(mm){super(mm),this._currentLockId=-2,this.lockMode=vo.PerParticle,this.registerInput("min",ao.AutoDetect,!0,0),this.registerInput("max",ao.AutoDetect,!0,1),this.registerOutput("output",ao.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(ao.Float|ao.Int|ao.Vector2|ao.lo|ao.pp),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(ao.Float|ao.Int|ao.Vector2|ao.lo|ao.pp),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=ao.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let mm=null;switch(this._currentLockId=-2,this.min.type){case ao.AutoDetect:case ao.Int:case ao.Float:mm=mm=>{const o=this.min.getConnectedValue(mm)||0,u=this.max.getConnectedValue(mm)||1;return o+Math.random()*(u-o)};break;case ao.Vector2:mm=mm=>{const o=this.min.getConnectedValue(mm)||f.Vector2.Zero(),u=this.max.getConnectedValue(mm)||f.Vector2.One();return new f.Vector2(o.x+Math.random()*(u.x-o.x),o.y+Math.random()*(u.y-o.y))};break;case ao.lo:mm=mm=>{const o=this.min.getConnectedValue(mm)||f.lo.Zero(),u=this.max.getConnectedValue(mm)||f.lo.One();return new f.lo(o.x+Math.random()*(u.x-o.x),o.y+Math.random()*(u.y-o.y),o.z+Math.random()*(u.z-o.z))};break;case ao.pp:mm=mm=>{const o=this.min.getConnectedValue(mm)||new r.pp(0,0,0,0),u=this.max.getConnectedValue(mm)||new r.pp(1,1,1,1);return new r.pp(o.x+Math.random()*(u.x-o.x),o.y+Math.random()*(u.y-o.y),o.z+Math.random()*(u.z-o.z),o.w+Math.random()*(u.w-o.w))}}this.output._storedFunction=o=>{var u;let f=0;switch(this.lockMode){case vo.PerParticle:f=(null===(u=o.particleContext)||void 0===u?void 0:u.id)||-1;break;case vo.PerSystem:f=o.buildId||0}return this._currentLockId!==f&&(this.lockMode!==vo.None&&(this._currentLockId=f),this.output._storedValue=mm(o)),this.output._storedValue}}serialize(){const mm=super.serialize();return mm.lockMode=this.lockMode,mm}_deserialize(mm){super._deserialize(mm),this.lockMode=mm.lockMode}}(0,A.d)([ho("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:vo.None},{label:"Per particle",value:vo.PerParticle},{label:"Per system",value:vo.PerSystem}]})],ru.prototype,"lockMode",void 0),(0,w.c)("BABYLON.ParticleRandomBlock",ru);class wu extends Uo{constructor(mm){super(mm),this._currentLockId=-2,this.lockMode=vo.PerParticle,this.registerInput("min",ao.AutoDetect),this.registerInput("max",ao.AutoDetect),this.registerOutput("output",ao.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const o=[ao.Matrix,ao.Particle,ao.Texture,ao.System,ao.FloatGradient,ao.Color4Gradient,ao.Vector2Gradient,ao.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...o),this.max.excludedConnectionPointTypes.push(...o)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let mm=null;switch(this._currentLockId=-2,this.min.type){case ao.Float:case ao.Int:mm=mm=>{const o=this.min.getConnectedValue(mm),u=this.max.getConnectedValue(mm);return Math.random()*(u-o)+o};break;case ao.Vector2:mm=mm=>{const o=this.min.getConnectedValue(mm),u=this.max.getConnectedValue(mm);return new f.Vector2(Math.random()*(u.x-o.x)+o.x,Math.random()*(u.y-o.y)+o.y)};break;case ao.lo:mm=mm=>{const o=this.min.getConnectedValue(mm),u=this.max.getConnectedValue(mm);return new f.lo(Math.random()*(u.x-o.x)+o.x,Math.random()*(u.y-o.y)+o.y,Math.random()*(u.z-o.z)+o.z)};break;case ao.pp:mm=mm=>{const o=this.min.getConnectedValue(mm),u=this.max.getConnectedValue(mm);return new r.pp(Math.random()*(u.r-o.r)+o.r,Math.random()*(u.g-o.g)+o.g,Math.random()*(u.b-o.b)+o.b,Math.random()*(u.a-o.a)+o.a)}}this.output._storedFunction=o=>{var u;let f=0;switch(this.lockMode){case vo.PerParticle:f=(null===(u=o.particleContext)||void 0===u?void 0:u.id)||-1;break;case vo.PerSystem:f=o.buildId||0}return this._currentLockId!==f&&(this.lockMode!==vo.None&&(this._currentLockId=f),this.output._storedValue=mm(o)),this.output._storedValue}}serialize(){const mm=super.serialize();return mm.lockMode=this.lockMode,mm}_deserialize(mm){super._deserialize(mm),void 0!==mm.lockMode&&(this.lockMode=mm.lockMode)}}(0,A.d)([ho("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:vo.None},{label:"Per particle",value:vo.PerParticle},{label:"Per system",value:vo.PerSystem}]})],wu.prototype,"lockMode",void 0),(0,w.c)("BABYLON.RandomRangeBlock",wu);(0,w.c)("BABYLON.ParticleLerpBlock",class extends Uo{constructor(mm){super(mm),this.registerInput("left",ao.AutoDetect),this.registerInput("right",ao.AutoDetect),this.registerInput("gradient",ao.Float,!0,0,0,1),this.registerOutput("output",ao.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(ao.Float|ao.Int|ao.Vector2|ao.lo|ao.pp)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const mm=(mm,o,u)=>(1-mm)*o+mm*u;this.output._storedFunction=o=>{const u=this.left.getConnectedValue(o),B=this.right.getConnectedValue(o),O=this.gradient.getConnectedValue(o);switch(this.left.type){case ao.Int:case ao.Float:return mm(O,u,B);case ao.Vector2:return new f.Vector2(mm(O,u.x,B.x),mm(O,u.y,B.y));case ao.lo:return new f.lo(mm(O,u.x,B.x),mm(O,u.y,B.y),mm(O,u.z,B.z));case ao.pp:return new r.pp(mm(O,u.r,B.r),mm(O,u.g,B.g),mm(O,u.b,B.b),mm(O,u.a,B.a))}return 0}}});(0,w.c)("BABYLON.UpdateDirectionBlock",class extends Uo{constructor(mm){super(mm),this.registerInput("particle",ao.Particle),this.registerInput("direction",ao.lo),this.registerOutput("output",ao.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(mm){const o=this.particle.getConnectedValue(mm);if(this.output._storedValue=o,!this.direction.isConnected)return;const u={process:u=>{mm.particleContext=u,mm.systemContext=o,u.direction.p(this.direction.getConnectedValue(mm))},previousItem:null,nextItem:null};o._updateQueueStart?em(u,o._updateQueueStart):o._updateQueueStart=u}});(0,w.c)("BABYLON.UpdateColorBlock",class extends Uo{constructor(mm){super(mm),this.registerInput("particle",ao.Particle),this.registerInput("color",ao.pp),this.registerOutput("output",ao.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(mm){const o=this.particle.getConnectedValue(mm);if(this.output._storedValue=o,!this.color.isConnected)return;const u={process:u=>{mm.particleContext=u,mm.systemContext=o,u.color.p(this.color.getConnectedValue(mm))},previousItem:null,nextItem:null};o._updateQueueStart?em(u,o._updateQueueStart):o._updateQueueStart=u}});(0,w.c)("BABYLON.UpdateScaleBlock",class extends Uo{constructor(mm){super(mm),this.registerInput("particle",ao.Particle),this.registerInput("scale",ao.Vector2),this.registerOutput("output",ao.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(mm){const o=this.particle.getConnectedValue(mm);if(this.output._storedValue=o,!this.scale.isConnected)return;const u={process:u=>{mm.particleContext=u,mm.systemContext=o,u.scale.p(this.scale.getConnectedValue(mm))},previousItem:null,nextItem:null};o._updateQueueStart?em(u,o._updateQueueStart):o._updateQueueStart=u}});(0,w.c)("BABYLON.UpdateAngleBlock",class extends Uo{constructor(mm){super(mm),this.registerInput("particle",ao.Particle),this.registerInput("angle",ao.Float),this.registerOutput("output",ao.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(mm){const o=this.particle.getConnectedValue(mm);if(this.output._storedValue=o,!this.angle.isConnected)return;const u={process:u=>{mm.particleContext=u,mm.systemContext=o,u.angle=this.angle.getConnectedValue(mm)},previousItem:null,nextItem:null};o._updateQueueStart?em(u,o._updateQueueStart):o._updateQueueStart=u}});(0,w.c)("BABYLON.BasicPositionUpdateBlock",class extends Uo{constructor(mm){super(mm),this.registerInput("particle",ao.Particle),this.registerOutput("output",ao.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(mm){const o=this.particle.getConnectedValue(mm),u={process:u=>{mm.particleContext=u,mm.systemContext=o,u.direction.scaleToRef(o._directionScale,o._scaledDirection),u.position.addInPlace(o._scaledDirection)},previousItem:null,nextItem:null};o._updateQueueStart?em(u,o._updateQueueStart):o._updateQueueStart=u,this.output._storedValue=o}});(0,w.c)("BABYLON.BasicSpriteUpdateBlock",class extends Uo{constructor(mm){super(mm),this.registerInput("particle",ao.Particle),this.registerOutput("output",ao.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(mm){const o=this.particle.getConnectedValue(mm),u={process:u=>{mm.particleContext=u,mm.systemContext=o,u.updateCellIndex()},previousItem:null,nextItem:null};o._updateQueueStart?em(u,o._updateQueueStart):o._updateQueueStart=u,this.output._storedValue=o}});(0,w.c)("BABYLON.UpdateSpriteCellIndexBlock",class extends Uo{constructor(mm){super(mm),this.registerInput("particle",ao.Particle),this.registerInput("cellIndex",ao.Int),this.registerOutput("output",ao.Particle),this.cellIndex.acceptedConnectionPointTypes=[ao.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(mm){const o=this.particle.getConnectedValue(mm);if(this.output._storedValue=o,!this.cellIndex.isConnected)return;const u={process:u=>{mm.particleContext=u,mm.systemContext=o,u.cellIndex=Math.floor(this.cellIndex.getConnectedValue(mm))},previousItem:null,nextItem:null};o._updateQueueStart?em(u,o._updateQueueStart):o._updateQueueStart=u}});class pu extends Uo{constructor(mm){super(mm),this.strength=1,this.registerInput("particle",ao.Particle),this.registerInput("flowMap",ao.Texture),this.registerOutput("output",ao.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(mm){var o;const u=this.particle.getConnectedValue(mm),f=mm.bo;let B;(null===(o=this.flowMap.connectedPoint)||void 0===o?void 0:o.ownerBlock).extractTextureContentAsync().then((mm=>{mm&&(B=new jo(mm.width,mm.height,mm.data))}));const O={process:mm=>{const o=f.getTransformMatrix();B&&B._processParticle(mm,this.strength*u._tempScaledUpdateSpeed,o)},previousItem:null,nextItem:null};u._updateQueueStart?em(O,u._updateQueueStart):u._updateQueueStart=O,this.output._storedValue=u}serialize(){const mm=super.serialize();return mm.strength=this.strength,mm}_deserialize(mm){super._deserialize(mm),this.strength=mm.strength}}(0,A.d)([ho("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pu.prototype,"strength",void 0),(0,w.c)("BABYLON.UpdateFlowMapBlock",pu);(0,w.c)("BABYLON.SphereShapeBlock",class extends Uo{constructor(mm){super(mm),this.registerInput("input",ao.Particle),this.registerInput("radius",ao.Float,!0,1),this.registerInput("radiusRange",ao.Float,!0,1,0,1),this.registerInput("directionRandomizer",ao.Float,!0,0,0,1),this.registerOutput("output",ao.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(mm){const o=this.input.getConnectedValue(mm);o._directionCreation.process=u=>{mm.particleContext=u,mm.systemContext=o;const B=this.directionRandomizer.getConnectedValue(mm),O=u.position.Qo(mm.emitterPosition).normalize(),r=(0,K.RandomRange)(0,B),w=(0,K.RandomRange)(0,B),p=(0,K.RandomRange)(0,B);O.x+=r,O.y+=w,O.z+=p,O.normalize(),mm.isEmitterTransformNode?f.lo.TransformNormalFromFloatsToRef(r,w,p,mm.emitterWorldMatrix,u.direction):u.direction.Op(r,w,p)},o._positionCreation.process=u=>{mm.particleContext=u,mm.systemContext=o;const B=this.radius.getConnectedValue(mm),O=this.radiusRange.getConnectedValue(mm),r=B-(0,K.RandomRange)(0,B*O),w=(0,K.RandomRange)(0,1),p=(0,K.RandomRange)(0,2*Math.PI),z=Math.acos(2*w-1),Y=r*Math.cos(p)*Math.sin(z),q=r*Math.cos(z),x=r*Math.sin(p)*Math.sin(z);mm.isEmitterTransformNode?f.lo.TransformCoordinatesFromFloatsToRef(Y,q,x,mm.emitterWorldMatrix,u.position):(u.position.Op(Y,q,x),u.position.addInPlace(mm.emitterPosition))},this.output._storedValue=o}});(0,w.c)("BABYLON.PointShapeBlock",class extends Uo{constructor(mm){super(mm),this.registerInput("particle",ao.Particle),this.registerInput("direction1",ao.lo,!0,new f.lo(0,1,0)),this.registerInput("direction2",ao.lo,!0,new f.lo(0,1,0)),this.registerOutput("output",ao.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(mm){const o=this.particle.getConnectedValue(mm);o._directionCreation.process=u=>{mm.particleContext=u,mm.systemContext=o;const B=this.direction1.getConnectedValue(mm),O=this.direction2.getConnectedValue(mm),r=(0,K.RandomRange)(B.x,O.x),w=(0,K.RandomRange)(B.y,O.y),p=(0,K.RandomRange)(B.z,O.z);mm.isEmitterTransformNode?f.lo.TransformNormalFromFloatsToRef(r,w,p,mm.emitterWorldMatrix,u.direction):u.direction.Op(r,w,p)},o._positionCreation.process=u=>{mm.systemContext=o,mm.isEmitterTransformNode?f.lo.TransformCoordinatesFromFloatsToRef(0,0,0,mm.emitterWorldMatrix,u.position):u.position.p(mm.emitterPosition)},this.output._storedValue=o}});(0,w.c)("BABYLON.CustomShapeBlock",class extends Uo{constructor(mm){super(mm),this.registerInput("particle",ao.Particle),this.registerInput("position",ao.lo,!0,new f.lo(0,0,0)),this.registerInput("direction",ao.lo,!0,new f.lo(0,1,0)),this.registerOutput("output",ao.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(mm){const o=this.particle.getConnectedValue(mm);o._directionCreation.process=u=>{mm.particleContext=u,mm.systemContext=o;const B=this.direction.getConnectedValue(mm);mm.isEmitterTransformNode?f.lo.TransformNormalToRef(B,mm.emitterWorldMatrix,u.direction):u.direction.p(B)},o._positionCreation.process=u=>{mm.particleContext=u,mm.systemContext=o;const B=this.position.getConnectedValue(mm);mm.isEmitterTransformNode?f.lo.TransformCoordinatesToRef(B,mm.emitterWorldMatrix,u.position):(u.position.p(B),u.position.addInPlace(mm.emitterPosition))},this.output._storedValue=o}});(0,w.c)("BABYLON.CylinderShapeBlock",class extends Uo{constructor(mm){super(mm),this._tempVector=f.lo.Zero(),this.registerInput("particle",ao.Particle),this.registerInput("radius",ao.Float,!0,1),this.registerInput("height",ao.Float,!0,1,0),this.registerInput("radiusRange",ao.Float,!0,1,0,1),this.registerInput("directionRandomizer",ao.Float,!0,0,0,1),this.registerOutput("output",ao.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(mm){const o=this.particle.getConnectedValue(mm);o._directionCreation.process=u=>{mm.particleContext=u,mm.systemContext=o;const B=this.directionRandomizer.getConnectedValue(mm);u.position.subtractToRef(mm.emitterPosition,this._tempVector),this._tempVector.normalize(),mm.isEmitterTransformNode&&f.lo.TransformNormalToRef(this._tempVector,mm.emitterInverseWorldMatrix,this._tempVector);const O=(0,K.RandomRange)(-B/2,B/2);let r=Math.atan2(this._tempVector.x,this._tempVector.z);r+=(0,K.RandomRange)(-Math.PI/2,Math.PI/2)*B,this._tempVector.y=O,this._tempVector.x=Math.sin(r),this._tempVector.z=Math.cos(r),this._tempVector.normalize(),mm.isEmitterTransformNode?f.lo.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,mm.emitterWorldMatrix,u.direction):u.direction.p(this._tempVector)},o._positionCreation.process=u=>{mm.particleContext=u,mm.systemContext=o;const B=this.height.getConnectedValue(mm),O=this.radiusRange.getConnectedValue(mm),r=this.radius.getConnectedValue(mm),w=(0,K.RandomRange)(-B/2,B/2),p=(0,K.RandomRange)(0,2*Math.PI),z=(0,K.RandomRange)((1-O)*(1-O),1),Y=Math.sqrt(z)*r,q=Y*Math.cos(p),x=Y*Math.sin(p);mm.isEmitterTransformNode?f.lo.TransformCoordinatesFromFloatsToRef(q,w,x,mm.emitterWorldMatrix,u.position):(u.position.Op(q,w,x),u.position.addInPlace(mm.emitterPosition))},this.output._storedValue=o}});class Ku extends Uo{constructor(mm){super(mm),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",ao.Particle),this.registerOutput("output",ao.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(mm){super._build(mm);const o=this.particle.getConnectedValue(mm);o._isAnimationSheetEnabled=!0,o.spriteCellWidth=this.width,o.spriteCellHeight=this.height,o.startSpriteCellID=this.start,o.endSpriteCellID=this.end,o.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=o}serialize(){const mm=super.serialize();return mm.width=this.width,mm.height=this.height,mm.start=this.start,mm.end=this.end,mm.randomStartCell=this.randomStartCell,mm}_deserialize(mm){super._deserialize(mm),this.width=mm.width,this.height=mm.height,this.start=mm.start,this.end=mm.end,this.randomStartCell=mm.randomStartCell}}(0,A.d)([ho("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ku.prototype,"start",void 0),(0,A.d)([ho("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ku.prototype,"end",void 0),(0,A.d)([ho("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ku.prototype,"width",void 0),(0,A.d)([ho("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ku.prototype,"height",void 0),(0,A.d)([ho("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ku.prototype,"loop",void 0),(0,A.d)([ho("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ku.prototype,"randomStartCell",void 0),(0,w.c)("BABYLON.SetupSpriteSheetBlock",Ku);class zu extends Uo{constructor(mm){super(mm),this.reference=0,this.registerInput("value",ao.AutoDetect),this.registerOutput("output",ao.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=mm=>{switch(mm){case ao.Float:return ao.FloatGradient;case ao.Vector2:return ao.Vector2Gradient;case ao.lo:return ao.Vector3Gradient;case ao.pp:return ao.Color4Gradient}return mm},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(ao.Float|ao.Vector2|ao.lo|ao.pp)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=mm=>null}serialize(){const mm=super.serialize();return mm.reference=this.reference,mm}_deserialize(mm){super._deserialize(mm),this.reference=mm.reference}}(0,A.d)([ho("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],zu.prototype,"reference",void 0),(0,w.c)("BABYLON.ParticleGradientValueBlock",zu);(0,w.c)("BABYLON.ParticleGradientBlock",class extends Uo{constructor(mm){super(mm),this._entryCount=1,this.registerInput("gradient",ao.Float,!0,1,0,1),this.registerInput("value0",ao.AutoDetect),this.registerOutput("output",ao.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=mm=>{switch(mm){case ao.FloatGradient:return ao.Float;case ao.Vector2Gradient:return ao.Vector2;case ao.Vector3Gradient:return ao.lo;case ao.Color4Gradient:return ao.pp}return mm},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(ao.FloatGradient|ao.Vector2Gradient|ao.Vector3Gradient|ao.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(mm){this._inputs[mm].onConnectionObservable.add((()=>{this._entryCount>mm||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),ao.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const mm=[];for(let u=1;u<this._inputs.length;u++){var o;if(this._inputs[u].isConnected)mm.push(null===(o=this._inputs[u].connectedPoint)||void 0===o?void 0:o.ownerBlock)}mm.sort(((mm,o)=>mm.reference-o.reference)),this.output._storedFunction=o=>{const u=this.gradient.getConnectedValue(o);if(1===mm.length)return mm[0].value.getConnectedValue(o);let B=null;for(let O=mm.length-1;O>=0;O--){const w=mm[O];if(w.reference<=u){const mm=w.value.getConnectedValue(o);if(B){const O=B.value.getConnectedValue(o),p=B.reference,z=w.reference,Y=Math.max(0,Math.min(1,(u-z)/(p-z)));switch(this.output.type){case ao.Float:return(0,K.Lerp)(mm,O,Y);case ao.Vector2:return f.Vector2.Lerp(mm,O,Y);case ao.lo:return f.lo.Lerp(mm,O,Y);case ao.pp:return r.pp.Lerp(mm,O,Y)}}return mm}B=w}return 0}}});(0,w.c)("BABYLON.ParticleConverterBlock",class extends Uo{constructor(mm){super(mm),this.registerInput("color ",ao.pp,!0),this.registerInput("xyz ",ao.lo,!0),this.registerInput("xy ",ao.Vector2,!0),this.registerInput("zw ",ao.Vector2,!0),this.registerInput("x ",ao.Float,!0),this.registerInput("y ",ao.Float,!0),this.registerInput("z ",ao.Float,!0),this.registerInput("w ",ao.Float,!0),this.registerOutput("color",ao.pp),this.registerOutput("xyz",ao.lo),this.registerOutput("xy",ao.Vector2),this.registerOutput("zw",ao.Vector2),this.registerOutput("x",ao.Float),this.registerOutput("y",ao.Float),this.registerOutput("z",ao.Float),this.registerOutput("w",ao.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(mm){return"color "===mm?"colorIn":"xyz "===mm?"xyzIn":"xy "===mm?"xyIn":"zw "===mm?"zwIn":"x "===mm?"xIn":"y "===mm?"yIn":"z "===mm?"zIn":"w "===mm?"wIn":mm}_outputRename(mm){switch(mm){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return mm}}_build(mm){super._build(mm);const o=this.xIn,u=this.yIn,B=this.zIn,O=this.wIn,w=this.xyIn,p=this.zwIn,K=this.xyzIn,z=this.colorIn,Y=this.colorOut,q=this.xyzOut,x=this.xyOut,H=this.zwOut,E=this.xOut,M=this.yOut,l=this.zOut,t=this.wOut,Q=mm=>{if(z.isConnected)return z.getConnectedValue(mm);let f=0,Y=0,q=0,x=0;if(o.isConnected&&(f=o.getConnectedValue(mm)),u.isConnected&&(Y=u.getConnectedValue(mm)),B.isConnected&&(q=B.getConnectedValue(mm)),O.isConnected&&(x=O.getConnectedValue(mm)),w.isConnected){const o=w.getConnectedValue(mm);o&&(f=o.x,Y=o.y)}if(p.isConnected){const o=p.getConnectedValue(mm);o&&(q=o.x,x=o.y)}if(K.isConnected){const o=K.getConnectedValue(mm);o&&(f=o.x,Y=o.y,q=o.z)}return new r.pp(f,Y,q,x)};Y._storedFunction=mm=>Q(mm),q._storedFunction=mm=>{const o=Q(mm);return new f.lo(o.r,o.g,o.b)},x._storedFunction=mm=>{const o=Q(mm);return new f.Vector2(o.r,o.g)},H._storedFunction=mm=>{const o=Q(mm);return new f.Vector2(o.b,o.a)},E._storedFunction=mm=>Q(mm).r,M._storedFunction=mm=>Q(mm).g,l._storedFunction=mm=>Q(mm).b,t._storedFunction=mm=>Q(mm).a}}),function(mm){mm[mm.Cos=0]="Cos",mm[mm.Sin=1]="Sin",mm[mm.Abs=2]="Abs",mm[mm.Exp=3]="Exp",mm[mm.Exp2=4]="Exp2",mm[mm.Round=5]="Round",mm[mm.Floor=6]="Floor",mm[mm.Ceiling=7]="Ceiling",mm[mm.Sqrt=8]="Sqrt",mm[mm.Log=9]="Log",mm[mm.Tan=10]="Tan",mm[mm.ArcTan=11]="ArcTan",mm[mm.ArcCos=12]="ArcCos",mm[mm.ArcSin=13]="ArcSin",mm[mm.Sign=14]="Sign",mm[mm.Negate=15]="Negate",mm[mm.OneMinus=16]="OneMinus",mm[mm.Reciprocal=17]="Reciprocal",mm[mm.ToDegrees=18]="ToDegrees",mm[mm.ToRadians=19]="ToRadians",mm[mm.Fract=20]="Fract"}(Vo||(Vo={}));class Yu extends Uo{constructor(mm){super(mm),this.operation=Vo.Cos,this.registerInput("input",ao.AutoDetect),this.registerOutput("output",ao.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(ao.Float|ao.Int|ao.Vector2|ao.lo|ao.pp)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(mm){super._build(mm);let o=null;switch(this.operation){case Vo.Cos:o=mm=>Math.cos(mm);break;case Vo.Sin:o=mm=>Math.sin(mm);break;case Vo.Abs:o=mm=>Math.abs(mm);break;case Vo.Exp:o=mm=>Math.exp(mm);break;case Vo.Exp2:o=mm=>Math.pow(2,mm);break;case Vo.Round:o=mm=>Math.round(mm);break;case Vo.Floor:o=mm=>Math.floor(mm);break;case Vo.Ceiling:o=mm=>Math.ceil(mm);break;case Vo.Sqrt:o=mm=>Math.sqrt(mm);break;case Vo.Log:o=mm=>Math.log(mm);break;case Vo.Tan:o=mm=>Math.tan(mm);break;case Vo.ArcTan:o=mm=>Math.atan(mm);break;case Vo.ArcCos:o=mm=>Math.acos(mm);break;case Vo.ArcSin:o=mm=>Math.asin(mm);break;case Vo.Sign:o=mm=>Math.sign(mm);break;case Vo.Negate:o=mm=>-mm;break;case Vo.OneMinus:o=mm=>1-mm;break;case Vo.Reciprocal:o=mm=>1/mm;break;case Vo.ToRadians:o=mm=>mm*Math.PI/180;break;case Vo.ToDegrees:o=mm=>180*mm/Math.PI;break;case Vo.Fract:o=mm=>mm>=0?mm-Math.floor(mm):mm-Math.ceil(mm)}if(!o)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case ao.Int:case ao.Float:this.output._storedFunction=mm=>{const u=this.input.getConnectedValue(mm);return o(u)};break;case ao.Vector2:this.output._storedFunction=mm=>{const u=this.input.getConnectedValue(mm);return new f.Vector2(o(u.x),o(u.y))};break;case ao.lo:this.output._storedFunction=mm=>{const u=this.input.getConnectedValue(mm);return new f.lo(o(u.x),o(u.y),o(u.z))};break;case ao.pp:this.output._storedFunction=mm=>{const u=this.input.getConnectedValue(mm);return new r.pp(o(u.r),o(u.g),o(u.b),o(u.a))}}return this}serialize(){const mm=super.serialize();return mm.operation=this.operation,mm}_deserialize(mm){super._deserialize(mm),this.operation=mm.operation}}(0,A.d)([ho("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Vo.Cos},{label:"Sin",value:Vo.Sin},{label:"Abs",value:Vo.Abs},{label:"Exp",value:Vo.Exp},{label:"Exp2",value:Vo.Exp2},{label:"Round",value:Vo.Round},{label:"Floor",value:Vo.Floor},{label:"Ceiling",value:Vo.Ceiling},{label:"Sqrt",value:Vo.Sqrt},{label:"Log",value:Vo.Log},{label:"Tan",value:Vo.Tan},{label:"ArcTan",value:Vo.ArcTan},{label:"ArcCos",value:Vo.ArcCos},{label:"ArcSin",value:Vo.ArcSin},{label:"Sign",value:Vo.Sign},{label:"Negate",value:Vo.Negate},{label:"OneMinus",value:Vo.OneMinus},{label:"Reciprocal",value:Vo.Reciprocal},{label:"ToDegrees",value:Vo.ToDegrees},{label:"ToRadians",value:Vo.ToRadians},{label:"Fract",value:Vo.Fract}]})],Yu.prototype,"operation",void 0),(0,w.c)("BABYLON.ParticleTrigonometryBlock",Yu);var qu,xu=u(13948);class Hu extends Uo{constructor(mm){super(mm),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",ao.AutoDetect),this.registerOutput("output",ao.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(ao.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(ao.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(ao.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(ao.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(ao.System),this._inputs[0].excludedConnectionPointTypes.push(ao.Particle),this._inputs[0].excludedConnectionPointTypes.push(ao.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(mm){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const o=mm=>{const o=this.input.getConnectedValue(mm);if(this.log.length>=this.stackSize)return o;if(null===o||void 0===o)return this.log.push(["null",""]),o;switch(this.input.type){case ao.Vector2:this.log.push([(0,xu.i)(o,4),o.toString()]);break;case ao.lo:this.log.push([(0,xu.k)(o,4),o.toString()]);break;case ao.pp:this.log.push([`{R: ${o.r.toFixed(4)} G: ${o.g.toFixed(4)} B: ${o.b.toFixed(4)} A: ${o.a.toFixed(4)}}`,o.toString()]);break;default:this.log.push([o.toString(),o.toString()])}return o};this.output.isConnected?this.output._storedFunction=o:this.output._storedValue=o(mm)}serialize(){const mm=super.serialize();return mm.stackSize=this.stackSize,mm}_deserialize(mm){super._deserialize(mm),this.stackSize=mm.stackSize}}(0,A.d)([ho("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Hu.prototype,"stackSize",void 0),(0,w.c)("BABYLON.ParticleDebugBlock",Hu);(0,w.c)("BABYLON.ParticleElbowBlock",class extends Uo{constructor(mm){super(mm),this.registerInput("input",ao.AutoDetect),this.registerOutput("output",ao.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(mm){super._build(mm);const o=this._outputs[0],u=this._inputs[0];o._storedFunction=mm=>u.getConnectedValue(mm)}});(0,w.c)("BABYLON.ParticleTeleportInBlock",class extends Uo{get endpoints(){return this._endpoints}constructor(mm){super(mm),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",ao.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(mm){if(this.getClassName()===mm)return!0;for(const o of this.endpoints)if(o.isAnAncestorOfType(mm))return!0;return!1}isAnAncestorOf(mm){for(const o of this.endpoints){if(o===mm)return!0;if(o.isAnAncestorOf(mm))return!0}return!1}attachToEndpoint(mm){mm.detach(),this._endpoints.push(mm),mm._entryPoint=this,mm._outputs[0]._typeConnectionSource=this._inputs[0],mm._tempEntryPointUniqueId=null,mm.name="> "+this.name}detachFromEndpoint(mm){const o=this._endpoints.indexOf(mm);-1!==o&&(this._endpoints.splice(o,1),mm._outputs[0]._typeConnectionSource=null,mm._entryPoint=null)}_build(){for(const mm of this._endpoints)mm.output._storedFunction=mm=>this.input.getConnectedValue(mm)}});(0,w.c)("BABYLON.ParticleTeleportOutBlock",class extends Uo{constructor(mm){super(mm),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",ao.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(mm){this.entryPoint&&this.entryPoint.build(mm)}clone(){const mm=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(mm),mm}serialize(){var mm;const o=super.serialize();return o.entryPoint=(null===(mm=this.entryPoint)||void 0===mm?void 0:mm.uniqueId)??"",o}_deserialize(mm){super._deserialize(mm),this._tempEntryPointUniqueId=mm.entryPoint}}),function(mm){mm[mm.Equal=0]="Equal",mm[mm.NotEqual=1]="NotEqual",mm[mm.LessThan=2]="LessThan",mm[mm.GreaterThan=3]="GreaterThan",mm[mm.LessOrEqual=4]="LessOrEqual",mm[mm.GreaterOrEqual=5]="GreaterOrEqual",mm[mm.Xor=6]="Xor",mm[mm.Or=7]="Or",mm[mm.And=8]="And"}(qu||(qu={}));class Eu extends Uo{constructor(mm){super(mm),this.test=qu.Equal,this.epsilon=0,this.registerInput("left",ao.Float),this.registerInput("right",ao.Float,!0,0),this.registerInput("ifTrue",ao.AutoDetect,!0,1),this.registerInput("ifFalse",ao.AutoDetect,!0,0),this.registerOutput("output",ao.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=ao.Float,this._inputs[0].acceptedConnectionPointTypes.push(ao.Int),this._inputs[1].acceptedConnectionPointTypes.push(ao.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const mm=mm=>{const o=this.left.getConnectedValue(mm),u=this.right.getConnectedValue(mm);let f=!1;switch(this.test){case qu.Equal:f=(0,K.WithinEpsilon)(o,u,this.epsilon);break;case qu.NotEqual:f=!(0,K.WithinEpsilon)(o,u,this.epsilon);break;case qu.LessThan:f=o<u+this.epsilon;break;case qu.GreaterThan:f=o>u-this.epsilon;break;case qu.LessOrEqual:f=o<=u+this.epsilon;break;case qu.GreaterOrEqual:f=o>=u-this.epsilon;break;case qu.Xor:f=!!o&&!u||!o&&!!u;break;case qu.Or:f=!!o||!!u;break;case qu.And:f=!!o&&!!u}return f};this.output._storedFunction=o=>mm(o)?this.ifTrue.getConnectedValue(o):this.ifFalse.getConnectedValue(o)}serialize(){const mm=super.serialize();return mm.test=this.test,mm.epsilon=this.epsilon,mm}_deserialize(mm){super._deserialize(mm),this.test=mm.test,void 0!==mm.epsilon&&(this.epsilon=mm.epsilon)}}(0,A.d)([ho("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:qu.Equal},{label:"NotEqual",value:qu.NotEqual},{label:"LessThan",value:qu.LessThan},{label:"GreaterThan",value:qu.GreaterThan},{label:"LessOrEqual",value:qu.LessOrEqual},{label:"GreaterOrEqual",value:qu.GreaterOrEqual},{label:"Xor",value:qu.Xor},{label:"Or",value:qu.Or},{label:"And",value:qu.And}]})],Eu.prototype,"test",void 0),(0,A.d)([ho("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Eu.prototype,"epsilon",void 0),(0,w.c)("BABYLON.ParticleConditionBlock",Eu);class Mu extends Uo{constructor(mm){super(mm),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",ao.Particle),this.registerInput("condition",ao.Float,!0,0),this.registerInput("system",ao.System),this.registerOutput("output",ao.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(mm){this._triggerCount=0;const o=this.input.getConnectedValue(mm),u={process:u=>{if(mm.particleContext=u,mm.systemContext=o,0!==this.condition.getConnectedValue(mm)&&(0===this.limit||this._triggerCount<this.limit)){const f=(new Date).getTime();if(this._previousOne&&f-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=f;const B=this.system.getConnectedValue(mm);if(B){const f=To(B,mm.bo,u.position);f.Jf.addOnce((()=>{this._triggerCount--})),o.Jf.addOnce((()=>{f.dispose()}))}}},previousItem:null,nextItem:null};o._updateQueueStart?em(u,o._updateQueueStart):o._updateQueueStart=u,this.output._storedValue=o}serialize(){const mm=super.serialize();return mm.limit=this.limit,mm.delay=this.delay,mm}_deserialize(mm){super._deserialize(mm),void 0!==mm.limit&&(this.limit=mm.limit),void 0!==mm.delay&&(this.delay=mm.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,A.d)([ho("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Mu.prototype,"limit",void 0),(0,A.d)([ho("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Mu.prototype,"delay",void 0),(0,w.c)("BABYLON.ParticleTriggerBlock",Mu);u(13957),u(13968),u(13978),u(14030)},14015:(mm,o,u)=>{"use strict";var f=u(12652);const B="clipPlaneFragment",O="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},13982:(mm,o,u)=>{"use strict";var f=u(12652);const B="clipPlaneFragmentDeclaration",O="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},14044:(mm,o,u)=>{"use strict";var f=u(12652);const B="clipPlaneVertex",O="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},14034:(mm,o,u)=>{"use strict";var f=u(12652);const B="clipPlaneVertexDeclaration",O="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},14026:(mm,o,u)=>{"use strict";var f=u(12652);const B="fogFragment",O="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},14010:(mm,o,u)=>{"use strict";var f=u(12652);const B="fogFragmentDeclaration",O="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},14052:(mm,o,u)=>{"use strict";var f=u(12652);const B="fogVertex",O="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},14036:(mm,o,u)=>{"use strict";var f=u(12652);const B="fogVertexDeclaration",O="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},13998:(mm,o,u)=>{"use strict";var f=u(12652);const B="helperFunctions",O="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},13990:(mm,o,u)=>{"use strict";var f=u(12652);const B="imageProcessingDeclaration",O="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},14004:(mm,o,u)=>{"use strict";var f=u(12652);const B="imageProcessingFunctions",O="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},13995:(mm,o,u)=>{"use strict";var f=u(12652);const B="logDepthDeclaration",O="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},14019:(mm,o,u)=>{"use strict";var f=u(12652);const B="logDepthFragment",O="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},14056:(mm,o,u)=>{"use strict";var f=u(12652);const B="logDepthVertex",O="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";f.e.IncludesShadersStoreWGSL[B]||(f.e.IncludesShadersStoreWGSL[B]=O)},13978:(mm,o,u)=>{"use strict";u.r(o),u.d(o,{particlesPixelShaderWGSL:()=>r});var f=u(12652);u(13982),u(13990),u(13995),u(13998),u(14004),u(14010),u(14015),u(14019),u(14026);const B="particlesPixelShader",O="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";f.e.ShadersStoreWGSL[B]||(f.e.ShadersStoreWGSL[B]=O);const r={name:B,shader:O}},14030:(mm,o,u)=>{"use strict";u.r(o),u.d(o,{particlesVertexShaderWGSL:()=>r});var f=u(12652);u(14034),u(14036),u(13995),u(14044),u(14052),u(14056);const B="particlesVertexShader",O="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";f.e.ShadersStoreWGSL[B]||(f.e.ShadersStoreWGSL[B]=O);const r={name:B,shader:O}},13889:(mm,o,u)=>{"use strict";var f=u(12652);const B="clipPlaneFragment",O="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13965:(mm,o,u)=>{"use strict";var f=u(12652);const B="clipPlaneFragmentDeclaration",O="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13911:(mm,o,u)=>{"use strict";var f=u(12652);const B="clipPlaneVertex",O="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13975:(mm,o,u)=>{"use strict";var f=u(12652);const B="clipPlaneVertexDeclaration",O="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13899:(mm,o,u)=>{"use strict";var f=u(12652);const B="fogFragment",O="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13883:(mm,o,u)=>{"use strict";var f=u(12652);const B="fogFragmentDeclaration",O="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13915:(mm,o,u)=>{"use strict";var f=u(12652);const B="fogVertex",O="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13904:(mm,o,u)=>{"use strict";var f=u(12652);const B="fogVertexDeclaration",O="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13871:(mm,o,u)=>{"use strict";var f=u(12652);const B="helperFunctions",O="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13861:(mm,o,u)=>{"use strict";var f=u(12652);const B="imageProcessingDeclaration",O="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13879:(mm,o,u)=>{"use strict";var f=u(12652);const B="imageProcessingFunctions",O="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13865:(mm,o,u)=>{"use strict";var f=u(12652);const B="logDepthDeclaration",O="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13891:(mm,o,u)=>{"use strict";var f=u(12652);const B="logDepthFragment",O="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13921:(mm,o,u)=>{"use strict";var f=u(12652);const B="logDepthVertex",O="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";f.e.IncludesShadersStore[B]||(f.e.IncludesShadersStore[B]=O)},13957:(mm,o,u)=>{"use strict";u.r(o),u.d(o,{particlesPixelShader:()=>r});var f=u(12652);u(13965),u(13861),u(13865),u(13871),u(13879),u(13883),u(13889),u(13891),u(13899);const B="particlesPixelShader",O="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";f.e.ShadersStore[B]||(f.e.ShadersStore[B]=O);const r={name:B,shader:O}},13968:(mm,o,u)=>{"use strict";u.r(o),u.d(o,{particlesVertexShader:()=>r});var f=u(12652);u(13975),u(13904),u(13865),u(13911),u(13915),u(13921);const B="particlesVertexShader",O="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";f.e.ShadersStore[B]||(f.e.ShadersStore[B]=O);const r={name:B,shader:O}},14315:(mm,o,u)=>{"use strict";u.r(o),u.d(o,{FlowGraphGLTFDataProvider:()=>O});var f=u(14280),B=u(14257);class O extends f.e{constructor(mm){var o,u;super();const f=mm.glTF,O=(null===(o=f.animations)||void 0===o?void 0:o.map((mm=>mm._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",B.b,O);const r=(null===(u=f.nodes)||void 0===u?void 0:u.map((mm=>mm._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",B.b,r)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14206:(mm,o,u)=>{"use strict";u.d(o,{c:()=>M,g:()=>H,h:()=>x,k:()=>E});var f=u(12740),B=u(13190),O=u(12780),r=u(14213);const w=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class p{constructor(mm,o){this._gltf=mm,this._infoTree=o}convert(mm){let o,u=this._gltf,f=this._infoTree;if(!mm.startsWith("/"))throw new Error("Path must start with a /");const B=mm.split("/");if(B.shift(),B[B.length-1].includes(".length")){const mm=B[B.length-1].split(".");B.pop(),B.push(...mm)}let O=!1;for(const p of B){const B="length"===p;if(B&&!f.__array__)throw new Error(`Path ${mm} is invalid`);if(f.__ignoreObjectTree__&&(O=!0),f.__array__&&!B)f=f.__array__;else if(f=f[p],!f)throw new Error(`Path ${mm} is invalid`);if(!O)if(void 0===u){if(!w.find((o=>o.regex.test(mm))))throw new Error(`Path ${mm} is invalid`)}else if(!B){var r;u=null===(r=u)||void 0===r?void 0:r[p]}(f.__target__||B)&&(o=u)}return{object:o,info:f}}}function K(mm,o,u,f){const B=z(mm,o);return f?B[u][f]:B[u]}function z(mm,o,u){var f,O;return null===(f=mm._data)||void 0===f||null===(O=f[(null===u||void 0===u?void 0:u.fillMode)??B.d.MATERIAL_TriangleFillMode])||void 0===O?void 0:O.babylonMaterial}function Y(mm,o){return{offset:{componentsCount:2,type:"Vector2",get:(u,B,O)=>{const r=K(u,O,mm,o);return new f.Vector2(null===r||void 0===r?void 0:r.uOffset,null===r||void 0===r?void 0:r.vOffset)},getTarget:z,set:(u,f,B,O)=>{const r=K(f,O,mm,o);r.uOffset=u.x,r.vOffset=u.y},getPropertyName:[()=>`${mm}${o?"."+o:""}.uOffset`,()=>`${mm}${o?"."+o:""}.vOffset`]},rotation:{type:"number",get:(u,f,B)=>{var O;return null===(O=K(u,B,mm,o))||void 0===O?void 0:O.wAng},getTarget:z,set:(u,f,B,O)=>K(f,O,mm,o).wAng=u,getPropertyName:[()=>`${mm}${o?"."+o:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(u,B,O)=>{const r=K(u,O,mm,o);return new f.Vector2(null===r||void 0===r?void 0:r.uScale,null===r||void 0===r?void 0:r.vScale)},getTarget:z,set:(u,f,B,O)=>{const r=K(f,O,mm,o);r.uScale=u.x,r.vScale=u.y},getPropertyName:[()=>`${mm}${o?"."+o:""}.uScale`,()=>`${mm}${o?"."+o:""}.vScale`]}}}const q={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:mm=>{var o,u;return new f.Vector2((null===(o=mm._babylonCamera)||void 0===o?void 0:o.orthoLeft)??0,(null===(u=mm._babylonCamera)||void 0===u?void 0:u.orthoRight)??0)},set:(mm,o)=>{o._babylonCamera&&(o._babylonCamera.orthoLeft=mm.x,o._babylonCamera.orthoRight=mm.y)},getTarget:mm=>mm,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:mm=>{var o,u;return new f.Vector2((null===(o=mm._babylonCamera)||void 0===o?void 0:o.orthoBottom)??0,(null===(u=mm._babylonCamera)||void 0===u?void 0:u.orthoTop)??0)},set:(mm,o)=>{o._babylonCamera&&(o._babylonCamera.orthoBottom=mm.x,o._babylonCamera.orthoTop=mm.y)},getTarget:mm=>mm,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:mm=>{var o;return null===(o=mm._babylonCamera)||void 0===o?void 0:o.maxZ},set:(mm,o)=>{o._babylonCamera&&(o._babylonCamera.maxZ=mm)},getTarget:mm=>mm,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:mm=>{var o;return null===(o=mm._babylonCamera)||void 0===o?void 0:o.hf},set:(mm,o)=>{o._babylonCamera&&(o._babylonCamera.hf=mm)},getTarget:mm=>mm,getPropertyName:[()=>"hf"]}},perspective:{aspectRatio:{type:"number",get:mm=>{var o;return null===(o=mm._babylonCamera)||void 0===o?void 0:o.getEngine().getAspectRatio(mm._babylonCamera)},getTarget:mm=>mm,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:mm=>{var o;return null===(o=mm._babylonCamera)||void 0===o?void 0:o.fov},set:(mm,o)=>{o._babylonCamera&&(o._babylonCamera.fov=mm)},getTarget:mm=>mm,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:mm=>{var o;return null===(o=mm._babylonCamera)||void 0===o?void 0:o.maxZ},set:(mm,o)=>{o._babylonCamera&&(o._babylonCamera.maxZ=mm)},getTarget:mm=>mm,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:mm=>{var o;return null===(o=mm._babylonCamera)||void 0===o?void 0:o.hf},set:(mm,o)=>{o._babylonCamera&&(o._babylonCamera.hf=mm)},getTarget:mm=>mm,getPropertyName:[()=>"hf"]}}}},nodes:{length:{type:"number",get:mm=>mm.length,getTarget:mm=>mm.map((mm=>mm._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"lo",get:mm=>{var o;return null===(o=mm._babylonTransformNode)||void 0===o?void 0:o.position},set:(mm,o)=>{var u;return null===(u=o._babylonTransformNode)||void 0===u?void 0:u.position.p(mm)},getTarget:mm=>mm._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:mm=>{var o;return null===(o=mm._babylonTransformNode)||void 0===o?void 0:o.rotationQuaternion},set:(mm,o)=>{var u,f;return null===(u=o._babylonTransformNode)||void 0===u||null===(f=u.rotationQuaternion)||void 0===f?void 0:f.p(mm)},getTarget:mm=>mm._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"lo",get:mm=>{var o;return null===(o=mm._babylonTransformNode)||void 0===o?void 0:o.rp},set:(mm,o)=>{var u;return null===(u=o._babylonTransformNode)||void 0===u?void 0:u.rp.p(mm)},getTarget:mm=>mm._babylonTransformNode,getPropertyName:[()=>"rp"]},weights:{length:{type:"number",get:mm=>mm._numMorphTargets,getTarget:mm=>mm._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(mm,o)=>{var u,f;return void 0!==o?null===(u=mm._primitiveBabylonMeshes)||void 0===u||null===(f=u[0].morphTargetManager)||void 0===f?void 0:f.getTarget(o).influence:void 0},getTarget:mm=>mm._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(mm,o)=>[0],getTarget:mm=>mm._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:mm=>{var o,u,B;return f.Matrix.Compose(null===(o=mm._babylonTransformNode)||void 0===o?void 0:o.rp,null===(u=mm._babylonTransformNode)||void 0===u?void 0:u.rotationQuaternion,null===(B=mm._babylonTransformNode)||void 0===B?void 0:B.position)},getTarget:mm=>mm._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:mm=>{var o,u,B,O;const r=f.Matrix.Identity();let w=mm.parent;for(;w&&w.parent;)w=w.parent;const p=(null===(o=mm._babylonTransformNode)||void 0===o?void 0:o.position._isDirty)||(null===(u=mm._babylonTransformNode)||void 0===u||null===(B=u.rotationQuaternion)||void 0===B?void 0:B._isDirty)||(null===(O=mm._babylonTransformNode)||void 0===O?void 0:O.rp._isDirty);if(w){var K;const o=null===(K=w._babylonTransformNode)||void 0===K?void 0:K.Df(!0).invert();var z,Y;if(o)null===(z=mm._babylonTransformNode)||void 0===z||null===(Y=z.Df(p))||void 0===Y||Y.multiplyToRef(o,r)}else mm._babylonTransformNode&&r.p(mm._babylonTransformNode.Df(p));return r},getTarget:mm=>mm._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:mm=>{var o,u;return null===(o=mm._babylonTransformNode)||void 0===o||null===(u=o.getChildren((mm=>mm instanceof r.b),!0)[0])||void 0===u?void 0:u.Yp},getTarget:mm=>{var o;return null===(o=mm._babylonTransformNode)||void 0===o?void 0:o.getChildren((mm=>mm instanceof r.b),!0)[0]},set:(mm,o)=>{if(o._babylonTransformNode){const u=o._babylonTransformNode.getChildren((mm=>mm instanceof r.b),!0)[0];u&&(u.Yp=mm)}}},color:{type:"No",get:mm=>{var o,u;return null===(o=mm._babylonTransformNode)||void 0===o||null===(u=o.getChildren((mm=>mm instanceof r.b),!0)[0])||void 0===u?void 0:u.qp},getTarget:mm=>{var o;return null===(o=mm._babylonTransformNode)||void 0===o?void 0:o.getChildren((mm=>mm instanceof r.b),!0)[0]},set:(mm,o)=>{if(o._babylonTransformNode){const u=o._babylonTransformNode.getChildren((mm=>mm instanceof r.b),!0)[0];u&&(u.qp=mm)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"No",get:(mm,o,u)=>z(mm,o,u).emissiveColor,set:(mm,o,u,f)=>z(o,u,f).emissiveColor.p(mm),getTarget:(mm,o,u)=>z(mm,o,u),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:Y("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(mm,o,u)=>{var f;return null===(f=K(mm,u,"bumpTexture"))||void 0===f?void 0:f.level},set:(mm,o,u,f)=>{const B=K(o,f,"bumpTexture");B&&(B.level=mm)},getTarget:(mm,o,u)=>z(mm,o,u),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:Y("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(mm,o,u)=>z(mm,o,u).ambientTextureStrength,set:(mm,o,u,f)=>{const B=z(o,u,f);B&&(B.ambientTextureStrength=mm)},getTarget:(mm,o,u)=>z(mm,o,u),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:Y("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"pp",get:(mm,o,u)=>{const f=z(mm,o,u);return O.pp.FromColor3(f.albedoColor,f.alpha)},set:(mm,o,u,f)=>{const B=z(o,u,f);B.albedoColor.set(mm.r,mm.g,mm.b),B.alpha=mm.a},getTarget:(mm,o,u)=>z(mm,o,u),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:Y("albedoTexture")}},metallicFactor:{type:"number",get:(mm,o,u)=>z(mm,o,u).metallic,set:(mm,o,u,f)=>{const B=z(o,u,f);B&&(B.metallic=mm)},getTarget:(mm,o,u)=>z(mm,o,u),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(mm,o,u)=>z(mm,o,u).roughness,set:(mm,o,u,f)=>{const B=z(o,u,f);B&&(B.roughness=mm)},getTarget:(mm,o,u)=>z(mm,o,u),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Y("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(mm,o,u)=>z(mm,o,u).anisotropy.Yp,set:(mm,o,u,f)=>{z(o,u,f).anisotropy.Yp=mm},getTarget:(mm,o,u)=>z(mm,o,u),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(mm,o,u)=>z(mm,o,u).anisotropy.angle,set:(mm,o,u,f)=>{z(o,u,f).anisotropy.angle=mm},getTarget:(mm,o,u)=>z(mm,o,u),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:Y("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(mm,o,u)=>z(mm,o,u).clearCoat.Yp,set:(mm,o,u,f)=>{z(o,u,f).clearCoat.Yp=mm},getTarget:(mm,o,u)=>z(mm,o,u),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(mm,o,u)=>z(mm,o,u).clearCoat.roughness,set:(mm,o,u,f)=>{z(o,u,f).clearCoat.roughness=mm},getTarget:(mm,o,u)=>z(mm,o,u),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:Y("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(mm,o,u)=>{var f;return null===(f=z(mm,o,u).clearCoat.bumpTexture)||void 0===f?void 0:f.level},getTarget:z,set:(mm,o,u,f)=>z(o,u,f).clearCoat.bumpTexture.level=mm},extensions:{KHR_texture_transform:Y("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Y("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(mm,o,u)=>z(mm,o,u).subSurface.dispersion,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).subSurface.dispersion=mm}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(mm,o,u)=>z(mm,o,u).emissiveIntensity,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).emissiveIntensity=mm}},KHR_materials_ior:{ior:{type:"number",get:(mm,o,u)=>z(mm,o,u).indexOfRefraction,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).indexOfRefraction=mm}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(mm,o,u)=>z(mm,o,u).iridescence.Yp,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).iridescence.Yp=mm},iridescenceIor:{type:"number",get:(mm,o,u)=>z(mm,o,u).iridescence.indexOfRefraction,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).iridescence.indexOfRefraction=mm},iridescenceTexture:{extensions:{KHR_texture_transform:Y("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(mm,o,u)=>z(mm,o,u).iridescence.maximumThickness,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).iridescence.maximumThickness=mm},iridescenceThicknessMinimum:{type:"number",get:(mm,o,u)=>z(mm,o,u).iridescence.minimumThickness,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).iridescence.minimumThickness=mm},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Y("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"No",get:(mm,o,u)=>z(mm,o,u).sheen.color,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).sheen.color.p(mm)},sheenColorTexture:{extensions:{KHR_texture_transform:Y("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(mm,o,u)=>z(mm,o,u).sheen.Yp,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).sheen.Yp=mm},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Y("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(mm,o,u)=>z(mm,o,u).metallicF0Factor,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).metallicF0Factor=mm,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"No",get:(mm,o,u)=>z(mm,o,u).metallicReflectanceColor,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).metallicReflectanceColor.p(mm),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:Y("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Y("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(mm,o,u)=>z(mm,o,u).subSurface.refractionIntensity,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).subSurface.refractionIntensity=mm,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:Y("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(mm,o,u)=>z(mm,o,u).subSurface.translucencyIntensity,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).subSurface.translucencyIntensity=mm},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Y("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"No",get:(mm,o,u)=>z(mm,o,u).subSurface.translucencyColor,getTarget:z,set:(mm,o,u,f)=>{var B;return mm&&(null===(B=z(o,u,f).subSurface.translucencyColor)||void 0===B?void 0:B.p(mm))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Y("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"No",get:(mm,o,u)=>z(mm,o,u).subSurface.tintColor,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).subSurface.tintColor.p(mm)},attenuationDistance:{type:"number",get:(mm,o,u)=>z(mm,o,u).subSurface.tintColorAtDistance,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).subSurface.tintColorAtDistance=mm},thicknessFactor:{type:"number",get:(mm,o,u)=>z(mm,o,u).subSurface.maximumThickness,getTarget:z,set:(mm,o,u,f)=>z(o,u,f).subSurface.maximumThickness=mm},thicknessTexture:{extensions:{KHR_texture_transform:Y("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:mm=>mm.length,getTarget:mm=>mm.map((mm=>mm._babylonLight)),getPropertyName:[mm=>"length"]},__array__:{__target__:!0,color:{type:"No",get:mm=>{var o;return null===(o=mm._babylonLight)||void 0===o?void 0:o.qp},set:(mm,o)=>{var u;return null===(u=o._babylonLight)||void 0===u?void 0:u.qp.p(mm)},getTarget:mm=>mm._babylonLight,getPropertyName:[mm=>"diffuse"]},Yp:{type:"number",get:mm=>{var o;return null===(o=mm._babylonLight)||void 0===o?void 0:o.Yp},set:(mm,o)=>o._babylonLight?o._babylonLight.Yp=mm:void 0,getTarget:mm=>mm._babylonLight,getPropertyName:[mm=>"intensity"]},range:{type:"number",get:mm=>{var o;return null===(o=mm._babylonLight)||void 0===o?void 0:o.range},set:(mm,o)=>o._babylonLight?o._babylonLight.range=mm:void 0,getTarget:mm=>mm._babylonLight,getPropertyName:[mm=>"range"]},spot:{innerConeAngle:{type:"number",get:mm=>{var o;return null===(o=mm._babylonLight)||void 0===o?void 0:o.innerAngle},set:(mm,o)=>o._babylonLight?o._babylonLight.innerAngle=mm:void 0,getTarget:mm=>mm._babylonLight,getPropertyName:[mm=>"innerConeAngle"]},outerConeAngle:{type:"number",get:mm=>{var o;return null===(o=mm._babylonLight)||void 0===o?void 0:o.angle},set:(mm,o)=>o._babylonLight?o._babylonLight.angle=mm:void 0,getTarget:mm=>mm._babylonLight,getPropertyName:[mm=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:mm=>mm.length,getTarget:mm=>mm.map((mm=>mm._babylonLight)),getPropertyName:[mm=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:mm=>mm.length,getTarget:mm=>mm.map((mm=>mm._babylonTexture)),getPropertyName:[mm=>"length"]},__array__:{__target__:!0,Yp:{type:"number",get:mm=>{var o;return null===(o=mm._babylonTexture)||void 0===o?void 0:o.level},set:(mm,o)=>{o._babylonTexture&&(o._babylonTexture.level=mm)},getTarget:mm=>mm._babylonTexture},rotation:{type:"Quaternion",get:mm=>{var o;return mm._babylonTexture&&f.Quaternion.FromRotationMatrix(null===(o=mm._babylonTexture)||void 0===o?void 0:o.getReflectionTextureMatrix())},set:(mm,o)=>{var u;o._babylonTexture&&(null!==(u=o._babylonTexture.Pm())&&void 0!==u&&u.useRightHandedSystem||(mm=f.Quaternion.Inverse(mm)),f.Matrix.FromQuaternionToRef(mm,o._babylonTexture.getReflectionTextureMatrix()))},getTarget:mm=>mm._babylonTexture}}}}},animations:{length:{type:"number",get:mm=>mm.length,getTarget:mm=>mm.map((mm=>mm._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:mm=>mm.length,getTarget:mm=>mm.map((mm=>{var o;return null===(o=mm.primitives[0]._instanceData)||void 0===o?void 0:o.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function x(mm){return new p(mm,q)}function H(mm){const o=mm.split("/").map((mm=>mm.replace(/{}/g,"__array__")));let u=q;for(const f of o)f&&(u=u[f]);if(u&&u.type&&u.get)return u}function E(mm,o){const u=mm.split("/").map((mm=>mm.replace(/{}/g,"__array__")));let f=q;for(const B of u)B&&(f=f[B]);f&&f.type&&f.get&&(f.interpolation=o)}function M(mm,o){const u=mm.split("/").map((mm=>mm.replace(/{}/g,"__array__")));let f=q;for(const B of u)if(B){if(!f[B]){if("?"===B){f.__ignoreObjectTree__=!0;continue}f[B]={},"__array__"===B&&(f[B].__target__=!0)}f=f[B]}Object.assign(f,o)}},14219:(mm,o,u)=>{"use strict";u.r(o),u.d(o,{AnimationPropertyInfo:()=>K,TransformNodeAnimationPropertyInfo:()=>z,WeightAnimationPropertyInfo:()=>Y,getQuaternion:()=>w,getVector3:()=>r,getWeights:()=>p});var f=u(13233),B=u(12740),O=u(14206);function r(mm,o,u,f){return B.lo.So(o,u).scaleInPlace(f)}function w(mm,o,u,f){return B.Quaternion.So(o,u).scaleInPlace(f)}function p(mm,o,u,f){const B=new Array(mm._numMorphTargets);for(let O=0;O<B.length;O++)B[O]=o[u++]*f;return B}class K{constructor(mm,o,u,f){this.type=mm,this.name=o,this.getValue=u,this.getStride=f}_buildAnimation(mm,o,u){const B=new f.d(mm,this.name,o,this.type);return B.setKeys(u),B}}class z extends K{buildAnimations(mm,o,u,f){const B=[];return B.push({babylonAnimatable:mm._babylonTransformNode,babylonAnimation:this._buildAnimation(o,u,f)}),B}}class Y extends K{buildAnimations(mm,o,u,B){const O=[];if(mm._numMorphTargets)for(let r=0;r<mm._numMorphTargets;r++){const w=new f.d(`${o}_${r}`,this.name,u,this.type);if(w.setKeys(B.map((mm=>({frame:mm.frame,inTangent:mm.inTangent?mm.inTangent[r]:void 0,value:mm.value[r],outTangent:mm.outTangent?mm.outTangent[r]:void 0,interpolation:mm.interpolation})))),mm._primitiveBabylonMeshes)for(const o of mm._primitiveBabylonMeshes)if(o.morphTargetManager){const mm=o.morphTargetManager.getTarget(r),u=w.clone();mm.animations.push(u),O.push({babylonAnimatable:mm,babylonAnimation:u})}}return O}}(0,O.k)("/nodes/{}/translation",[new z(f.d.ANIMATIONTYPE_VECTOR3,"position",r,(()=>3))]),(0,O.k)("/nodes/{}/rotation",[new z(f.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",w,(()=>4))]),(0,O.k)("/nodes/{}/scale",[new z(f.d.ANIMATIONTYPE_VECTOR3,"rp",r,(()=>3))]),(0,O.k)("/nodes/{}/weights",[new Y(f.d.ANIMATIONTYPE_FLOAT,"influence",p,(mm=>mm._numMorphTargets))])},14166:(mm,o,u)=>{"use strict";class f{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((mm,o)=>{this._resolve=mm,this._reject=o}))}}var B=u(12740),O=u(12780),r=u(12549),w=u(13170),p=u(14174),K=u(14187),z=u(12556),Y=u(13188),q=u(13233),x=u(13242),H=u(12596),E=u(12565),M=u(12574);class l{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(mm){this._useTextureToStoreBoneMatrices=mm,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(mm){this._animationPropertiesOverride=mm}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(mm,o,u){this.name=mm,this.id=o,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=B.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new z.d,this.bones=[],this._scene=u||H.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const f=this._scene.getEngine().getCaps();this._canUseTextureForBones=f.textureFloat&&f.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((mm=>!mm.getParent()))}getTransformMatrices(mm){if(this.needInitialSkinMatrix){if(!mm)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return mm._bonesTransformMatrices||this.prepare(!0),mm._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(mm){return this.needInitialSkinMatrix&&mm._transformMatrixTexture?mm._transformMatrixTexture:this._transformMatrixTexture}Pm(){return this._scene}toString(mm){let o=`Name: ${this.name}, nBones: ${this.bones.length}`;if(o+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,mm){o+=", Ranges: {";let mm=!0;for(const u in this._ranges)mm&&(o+=", ",mm=!1),o+=u;o+="}"}return o}getBoneIndexByName(mm){for(let o=0,u=this.bones.length;o<u;o++)if(this.bones[o].name===mm)return o;return-1}createAnimationRange(mm,o,u){if(!this._ranges[mm]){this._ranges[mm]=new x.e(mm,o,u);for(let f=0,B=this.bones.length;f<B;f++)this.bones[f].animations[0]&&this.bones[f].animations[0].createRange(mm,o,u)}}deleteAnimationRange(mm){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let u=0,f=this.bones.length;u<f;u++)this.bones[u].animations[0]&&this.bones[u].animations[0].deleteRange(mm,o);this._ranges[mm]=null}getAnimationRange(mm){return this._ranges[mm]||null}getAnimationRanges(){const mm=[];let o;for(o in this._ranges)mm.push(this._ranges[o]);return mm}copyAnimationRange(mm,o){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[o]||!mm.getAnimationRange(o))return!1;let f=!0;const B=this._getHighestAnimationFrame()+1,O={},r=mm.bones;let w,p;for(p=0,w=r.length;p<w;p++)O[r[p].name]=r[p];this.bones.length!==r.length&&(E.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${r.length}`),f=!1);const K=u&&this.dimensionsAtRest&&mm.dimensionsAtRest?this.dimensionsAtRest.divide(mm.dimensionsAtRest):null;for(p=0,w=this.bones.length;p<w;p++){const mm=this.bones[p].name,r=O[mm];r?f=f&&this.bones[p].copyAnimationRange(r,o,B,u,K):(E.e.Warn("copyAnimationRange: not same rig, missing source bone "+mm),f=!1)}const z=mm.getAnimationRange(o);return z&&(this._ranges[o]=new x.e(o,z.from+B,z.to+B)),f}returnToRest(){for(const mm of this.bones)-1!==mm._index&&mm.returnToRest()}_getHighestAnimationFrame(){let mm=0;for(let o=0,u=this.bones.length;o<u;o++)if(this.bones[o].animations[0]){const u=this.bones[o].animations[0].getHighestFrame();mm<u&&(mm=u)}return mm}beginAnimation(mm,o,u,f){const B=this.getAnimationRange(mm);return B?this._scene.beginAnimation(this,B.from,B.to,o,u,f):null}static MakeAnimationAdditive(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2?arguments[2]:void 0;const f=mm.getAnimationRange(u);if(!f)return null;const B=mm._scene.getAllAnimatablesByTarget(mm);let O=null;for(let w=0;w<B.length;w++){const mm=B[w];if(mm.fromFrame===(null===f||void 0===f?void 0:f.from)&&mm.toFrame===(null===f||void 0===f?void 0:f.to)){O=mm;break}}const r=mm.getAnimatables();for(let w=0;w<r.length;w++){const mm=r[w].animations;if(mm)for(let f=0;f<mm.length;f++)q.d.MakeAnimationAdditive(mm[f],o,u)}return O&&(O.isAdditive=!0),mm}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(mm){this._meshesWithPoseMatrix.push(mm)}_unregisterMeshWithPoseMatrix(mm){const o=this._meshesWithPoseMatrix.indexOf(mm);o>-1&&this._meshesWithPoseMatrix.splice(o,1)}_computeTransformMatrices(mm,o){this.onBeforeComputeObservable.notifyObservers(this);for(let u=0;u<this.bones.length;u++){const f=this.bones[u];f._childUpdateId++;const B=f.getParent();if(B?f.getLocalMatrix().multiplyToRef(B.getFinalMatrix(),f.getFinalMatrix()):o?f.getLocalMatrix().multiplyToRef(o,f.getFinalMatrix()):f.getFinalMatrix().p(f.getLocalMatrix()),-1!==f._index){const o=null===f._index?u:f._index;f.getAbsoluteInverseBindMatrix().multiplyToArray(f.getFinalMatrix(),mm,16*o)}}this._identity.copyToArray(mm,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const mm=this.Pm().getRenderId();if(this._currentRenderId===mm)return;this._currentRenderId=mm}if(this._numBonesWithLinkedTransformNode>0)for(const mm of this.bones)if(mm._linkedTransformNode){const o=mm._linkedTransformNode;mm.position=o.position,o.rotationQuaternion?mm.rotationQuaternion=o.rotationQuaternion:mm.rotation=o.rotation,mm.rp=o.rp}if(this.needInitialSkinMatrix)for(const mm of this._meshesWithPoseMatrix){const o=mm.getPoseMatrix();let u=this._isDirty;if(mm._bonesTransformMatrices&&mm._bonesTransformMatrices.length===16*(this.bones.length+1)||(mm._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),u=!0),u){if(this._synchronizedWithMesh!==mm){this._synchronizedWithMesh=mm;for(const mm of this.bones)if(!mm.getParent()){mm.getBindMatrix().multiplyToRef(o,B.TmpVectors.Matrix[1]),mm._updateAbsoluteBindMatrices(B.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const o=4*(this.bones.length+1);mm._transformMatrixTexture&&mm._transformMatrixTexture.getSize().width===o||(mm._transformMatrixTexture&&mm._transformMatrixTexture.dispose(),mm._transformMatrixTexture=Y.d.CreateRGBATexture(mm._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(mm._bonesTransformMatrices,o),this.isUsingTextureForMatrices&&mm._transformMatrixTexture&&mm._transformMatrixTexture.update(mm._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=Y.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let mm=0;mm<this.bones.length;mm++)this._animatables.push(this.bones[mm])}return this._animatables}clone(mm,o){const u=new l(mm,o||mm,this._scene);u.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let f=0;f<this.bones.length;f++){const mm=this.bones[f];let o=null;const B=mm.getParent();if(B){const mm=this.bones.indexOf(B);o=u.bones[mm]}const O=new K.e(mm.name,u,o,mm.getBindMatrix().clone(),mm.getRestMatrix().clone());O._index=mm._index,mm._linkedTransformNode&&O.linkTransformNode(mm._linkedTransformNode),M.b.DeepCopy(mm.animations,O.animations)}if(this._ranges){u._ranges={};for(const mm in this._ranges){const o=this._ranges[mm];o&&(u._ranges[mm]=o.clone())}}return this._isDirty=!0,u.prepare(!0),u}enableBlending(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const o of this.bones)for(const u of o.animations)u.enableBlending=!0,u.blendingSpeed=mm}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Pm().stopAnimation(this),this.Pm().removeSkeleton(this),this._parentContainer){const mm=this._parentContainer.skeletons.indexOf(this);mm>-1&&this._parentContainer.skeletons.splice(mm,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const mm={};mm.name=this.name,mm.id=this.id,this.dimensionsAtRest&&(mm.dimensionsAtRest=this.dimensionsAtRest.df()),mm.bones=[],mm.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let u=0;u<this.bones.length;u++){var o;const f=this.bones[u],B=f.getParent(),O={parentBoneIndex:B?this.bones.indexOf(B):-1,index:f.getIndex(),name:f.name,id:f.id,matrix:f.getBindMatrix().df(),rest:f.getRestMatrix().df(),linkedTransformNodeId:null===(o=f.getTransformNode())||void 0===o?void 0:o.id};mm.bones.push(O),f.length&&(O.length=f.length),f.metadata&&(O.metadata=f.metadata),f.animations&&f.animations.length>0&&(O.animation=f.animations[0].serialize()),mm.ranges=[];for(const o in this._ranges){const u=this._ranges[o];if(!u)continue;const f={};f.name=o,f.from=u.from,f.to=u.to,mm.ranges.push(f)}}return mm}static Parse(mm,o){const u=new l(mm.name,mm.id,o);let f;for(mm.dimensionsAtRest&&(u.dimensionsAtRest=B.lo.So(mm.dimensionsAtRest)),u.needInitialSkinMatrix=mm.needInitialSkinMatrix,f=0;f<mm.bones.length;f++){const o=mm.bones[f],O=mm.bones[f].index;let r=null;o.parentBoneIndex>-1&&(r=u.bones[o.parentBoneIndex]);const w=o.rest?B.Matrix.So(o.rest):null,p=new K.e(o.name,u,r,B.Matrix.So(o.matrix),w,null,O);void 0!==o.id&&null!==o.id&&(p.id=o.id),o.length&&(p.length=o.length),o.metadata&&(p.metadata=o.metadata),o.animation&&p.animations.push(q.d.Parse(o.animation)),void 0!==o.linkedTransformNodeId&&null!==o.linkedTransformNodeId&&(u._hasWaitingData=!0,p._waitingTransformNodeId=o.linkedTransformNodeId)}if(mm.ranges)for(f=0;f<mm.ranges.length;f++){const o=mm.ranges[f];u.createAnimationRange(o.name,o.from,o.to)}return u}computeAbsoluteMatrices(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||mm)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(mm)}getPoseMatrix(){let mm=null;return this._meshesWithPoseMatrix.length>0&&(mm=this._meshesWithPoseMatrix[0].getPoseMatrix()),mm}sortBones(){const mm=[],o=new Array(this.bones.length);for(let u=0;u<this.bones.length;u++)this._sortBones(u,mm,o);this.bones=mm}_sortBones(mm,o,u){if(u[mm])return;u[mm]=!0;const f=this.bones[mm];if(!f)return;void 0===f._index&&(f._index=mm);const B=f.getParent();B&&this._sortBones(this.bones.indexOf(B),o,u),o.push(f)}setCurrentPoseAsRest(){for(const mm of this.bones)mm.setCurrentPoseAsRest()}}var t=u(13050),Q=u(13199),b=u(12727),J=u(13139),N=u(12809),S=u(13178),P=u(13147),R=u(13166),g=u(13249),W=u(12832),F=u(14138);class c{set areUpdatesFrozen(mm){mm?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new W.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,mm||(mm=H.d.LastCreatedScene),this._scene=mm,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const mm=this._scene.getEngine().getCaps();this._canUseTextureForTargets=mm.canUseGLVertexID&&mm.textureFloat&&mm.maxVertexTextureImageUnits>0&&mm.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return c.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?c.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(mm){this._numMaxInfluencers!==mm&&(this._numMaxInfluencers=mm,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(mm){this._useTextureToStoreTargets!==mm&&(this._useTextureToStoreTargets=mm,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var mm;return c.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(mm=this._scene)&&void 0!==mm&&mm.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(mm){return this._activeTargets.data[mm]}getTarget(mm){return this._targets[mm]}getTargetByName(mm){for(const o of this._targets)if(o.name===mm)return o;return null}addTarget(mm){this._targets.push(mm),this._targetInfluenceChangedObservers.push(mm.onInfluenceChanged.add((mm=>{this.areUpdatesFrozen&&mm&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(mm)}))),this._targetDataLayoutChangedObservers.push(mm._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(mm){const o=this._targets.indexOf(mm);o>=0&&(this._targets.splice(o,1),mm.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(o,1)[0]),mm._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(o,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(mm)}_bind(mm){mm.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),mm.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),mm.setTexture("morphTargets",this._targetStoreTexture),mm.setInt("morphTargetCount",this.numInfluencers)}clone(){const mm=new c(this._scene);for(const o of this._targets)mm.addTarget(o.clone());return mm.enablePositionMorphing=this.enablePositionMorphing,mm.enableNormalMorphing=this.enableNormalMorphing,mm.enableTangentMorphing=this.enableTangentMorphing,mm.enableUVMorphing=this.enableUVMorphing,mm.enableUV2Morphing=this.enableUV2Morphing,mm.enableColorMorphing=this.enableColorMorphing,mm}serialize(){const mm={};mm.id=this.uniqueId,mm.targets=[];for(const o of this._targets)mm.targets.push(o.serialize());return mm}_syncActiveTargets(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const o=!!this._targetStoreTexture,u=this.isUsingTextureForTargets;(this._mustSynchronize||o!==u)&&(this._mustSynchronize=!1,this.synchronize());let f=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let B=-1;for(const O of this._targets)if(B++,0!==O.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=c.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(O),this._morphTargetTextureIndices[f]=B,this._tempInfluences[f++]=O.influence}this._morphTargetTextureIndices.length!==f&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,f)),this._influences&&this._influences.length===f||(this._influences=new Float32Array(f));for(let O=0;O<f;O++)this._influences[O]=this._tempInfluences[O];if(mm&&this._scene)for(const O of this._scene.meshes)O.morphTargetManager===this&&(u?O._markSubMeshesAsAttributesDirty():O._syncGeometryWithMorphTargetManager())}synchronize(){var mm;if(!this._scene||this.areUpdatesFrozen)return;const o=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(mm=this._targetStoreTexture)||void 0===mm||mm.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>o.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const u of this._targets){this._supportsPositions=this._supportsPositions&&u.hasPositions,this._supportsNormals=this._supportsNormals&&u.hasNormals,this._supportsTangents=this._supportsTangents&&u.hasTangents,this._supportsUVs=this._supportsUVs&&u.hasUVs,this._supportsUV2s=this._supportsUV2s&&u.hasUV2s,this._supportsColors=this._supportsColors&&u.hasColors;const mm=u.vertexCount;if(0===this._vertexCount)this._vertexCount=mm;else if(this._vertexCount!==mm)return void E.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${u.name}": ${mm}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const mm=o.getCaps().maxTextureSize;this._textureWidth>mm&&(this._textureHeight=Math.ceil(this._textureWidth/mm),this._textureWidth=mm);const u=this._targets.length,f=new Float32Array(u*this._textureWidth*this._textureHeight*4);let B=0;for(let o=0;o<u;o++){const mm=this._targets[o],u=mm.getPositions(),O=mm.getNormals(),r=mm.getUVs(),w=mm.getTangents(),p=mm.getUV2s(),K=mm.getColors();B=o*this._textureWidth*this._textureHeight*4;for(let o=0;o<this._vertexCount;o++)this._supportsPositions&&u&&(f[B]=u[3*o],f[B+1]=u[3*o+1],f[B+2]=u[3*o+2],B+=4),this._supportsNormals&&O&&(f[B]=O[3*o],f[B+1]=O[3*o+1],f[B+2]=O[3*o+2],B+=4),this._supportsUVs&&r&&(f[B]=r[2*o],f[B+1]=r[2*o+1],B+=4),this._supportsTangents&&w&&(f[B]=w[3*o],f[B+1]=w[3*o+1],f[B+2]=w[3*o+2],B+=4),this._supportsUV2s&&p&&(f[B]=p[2*o],f[B+1]=p[2*o+1],B+=4),this._supportsColors&&K&&(f[B]=K[4*o],f[B+1]=K[4*o+1],f[B+2]=K[4*o+2],f[B+3]=K[4*o+3],B+=4)}this._targetStoreTexture=F.e.CreateRGBATexture(f,this._textureWidth,this._textureHeight,u,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const u of this._scene.meshes)u.morphTargetManager===this&&u._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const mm=this._parentContainer.morphTargetManagers.indexOf(this);mm>-1&&this._parentContainer.morphTargetManagers.splice(mm,1),this._parentContainer=null}for(const mm of this._targets)this._scene.stopAnimation(mm)}}static Parse(mm,o){const u=new c(o);for(const f of mm.targets)u.addTarget(g.c.Parse(f,o));return u}}c.EnableTextureStorage=!0,c.MaxActiveMorphTargetsInVertexAttributeMode=8,c.ConstantTargetCountForTextureMode=0;var A=u(14189),y=u(12605),I=u(13065);const s=new Map,j=s;function a(mm,o,u){X(mm)&&E.e.Warn(`Extension with the name '${mm}' already exists`),s.set(mm,{isGLTFExtension:o,factory:u})}function X(mm){return s.delete(mm)}var G=u(14206),k=u(13307),d=u(12824);class e{static Get(mm,o,u){if(!o||void 0==u||!o[u])throw new Error(`${mm}: Failed to find index (${u})`);return o[u]}static TryGet(mm,o){return mm&&void 0!=o&&mm[o]?mm[o]:null}static Assign(mm){if(mm)for(let o=0;o<mm.length;o++)mm[o].index=o}}function L(mm){if(mm.min&&mm.max){const o=mm.min,u=mm.max,f=B.TmpVectors.lo[0].Op(o[0],o[1],o[2]),O=B.TmpVectors.lo[1].Op(u[0],u[1],u[2]);if(mm.normalized&&5126!==mm.componentType){let o=1;switch(mm.componentType){case 5120:o=127;break;case 5121:o=255;break;case 5122:o=32767;break;case 5123:o=65535}const u=1/o;f.scaleInPlace(u),O.scaleInPlace(u)}return new I.e(f,O)}return null}class C{static RegisterExtension(mm,o){a(mm,!1,o)}static UnregisterExtension(mm){return X(mm)}get Af(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(mm){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=mm}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((mm=>mm.dispose&&mm.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(mm,o,u,f,B,O){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=o,this._assetContainer=u,this._loadData(f);let O=null;if(mm){const o={};if(this._gltf.nodes)for(const mm of this._gltf.nodes)mm.name&&(o[mm.name]=mm.index);O=(mm instanceof Array?mm:[mm]).map((mm=>{const u=o[mm];if(void 0===u)throw new Error(`Failed to find node '${mm}'`);return u}))}return await this._loadAsync(B,r,O,(()=>({meshes:this._getMeshes(),kq:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=mm,this._loadData(o),await this._loadAsync(u,B,null,(()=>{}))}async _loadAsync(mm,o,u,f){return await Promise.resolve().then((async()=>{this._rootUrl=mm,this._uniqueRootUrl=!mm.startsWith("file:")&&o?mm:`${mm}${Date.now()}/`,this._fileName=o,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const B=`${A.i[A.i.LOADING]} => ${A.i[A.i.READY]}`,O=`${A.i[A.i.LOADING]} => ${A.i[A.i.COMPLETE]}`;this._parent._startPerformanceCounter(B),this._parent._startPerformanceCounter(O),this._parent._setState(A.i.LOADING),this._extensionsOnLoading();const w=new Array;if(!this.parent.loadOnlyMaterials)if(u)w.push(this.loadSceneAsync("/nodes",{nodes:u,index:-1}));else if(void 0!=this._gltf.bo||this._gltf.scenes&&this._gltf.scenes[0]){const mm=e.Get("/scene",this._gltf.scenes,this._gltf.bo||0);w.push(this.loadSceneAsync(`/scenes/${mm.index}`,mm))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let mm=0;mm<this._gltf.materials.length;++mm){const o=this._gltf.materials[mm],u="/materials/"+mm,f=t.c.TriangleFillMode;w.push(this._loadMaterialAsync(u,o,null,f,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&w.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&w.push(this._compileShadowGeneratorsAsync());const p=Promise.all(w).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.cp(!0);for(const mm of this._babylonScene.materials){const o=mm;void 0!==o.maxSimultaneousLights&&(o.maxSimultaneousLights=Math.max(o.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(A.i.READY),this._skipStartAnimationStep||this._startAnimations(),f()}));return await p.then((mm=>(this._parent._endPerformanceCounter(B),r.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(O),this._parent._setState(A.i.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(mm=>{this._parent.onErrorObservable.notifyObservers(mm),this._parent.onErrorObservable.clear(),this.dispose()}))})),mm)))})).catch((mm=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(mm),this._parent.onErrorObservable.clear(),this.dispose()),mm}))}_loadData(mm){if(this._gltf=mm.json,this._setupData(),mm.bin){const o=this._gltf.buffers;if(o&&o[0]&&!o[0].uri){const u=o[0];(u.byteLength<mm.bin.byteLength-3||u.byteLength>mm.bin.byteLength)&&E.e.Warn(`Binary buffer length (${u.byteLength}) from JSON does not match chunk length (${mm.bin.byteLength})`),this._bin=mm.bin}else E.e.Warn("Unexpected BIN chunk")}}_setupData(){if(e.Assign(this._gltf.accessors),e.Assign(this._gltf.animations),e.Assign(this._gltf.buffers),e.Assign(this._gltf.bufferViews),e.Assign(this._gltf.cameras),e.Assign(this._gltf.images),e.Assign(this._gltf.materials),e.Assign(this._gltf.meshes),e.Assign(this._gltf.nodes),e.Assign(this._gltf.samplers),e.Assign(this._gltf.scenes),e.Assign(this._gltf.skins),e.Assign(this._gltf.textures),this._gltf.nodes){const mm={};for(const u of this._gltf.nodes)if(u.children)for(const o of u.children)mm[o]=u.index;const o=this._createRootNode();for(const u of this._gltf.nodes){const f=mm[u.index];u.parent=void 0===f?o:this._gltf.nodes[f]}}}async _loadExtensionsAsync(){const mm=[];if(j.forEach(((o,u)=>{var f;!1===(null===(f=this.parent.extensionOptions[u])||void 0===f?void 0:f.enabled)?o.isGLTFExtension&&this.isExtensionUsed(u)&&E.e.Warn(`Extension ${u} is used but has been explicitly disabled.`):o.isGLTFExtension&&!this.isExtensionUsed(u)||mm.push((async()=>{const mm=await o.factory(this);return mm.name!==u&&E.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${mm.name} !== ${u}`),this._parent.onExtensionLoadedObservable.notifyObservers(mm),mm})())})),this._extensions.push(...await Promise.all(mm)),this._extensions.sort(((mm,o)=>(mm.order||Number.MAX_VALUE)-(o.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const u of this._gltf.extensionsRequired){if(!this._extensions.some((mm=>mm.name===u&&mm.enabled))){var o;if(!1===(null===(o=this.parent.extensionOptions[u])||void 0===o?void 0:o.enabled))throw new Error(`Required extension ${u} is disabled`);throw new Error(`Required extension ${u} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const mm=new R.d("__root__",this._babylonScene);this._rootBabylonMesh=mm,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.cp(!1);const o={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case A.h.AUTO:this._babylonScene.useRightHandedSystem||(o.rotation=[0,1,0,0],o.scale=[1,1,-1],C._LoadTransform(o,this._rootBabylonMesh));break;case A.h.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(mm),o}loadSceneAsync(mm,o){const u=this._extensionsLoadSceneAsync(mm,o);if(u)return u;const f=new Array;if(this.logOpen(`${mm} ${o.name||""}`),o.nodes)for(const B of o.nodes){const o=e.Get(`${mm}/nodes/${B}`,this._gltf.nodes,B);f.push(this.loadNodeAsync(`/nodes/${o.index}`,o,(mm=>{mm.parent=this._rootBabylonMesh})))}for(const B of this._postSceneLoadActions)B();return f.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(f).then((()=>{}))}_forEachPrimitive(mm,o){if(mm._primitiveBabylonMeshes)for(const u of mm._primitiveBabylonMeshes)o(u)}_getGeometries(){const mm=[],o=this._gltf.nodes;if(o)for(const u of o)this._forEachPrimitive(u,(o=>{const u=o.br;u&&-1===mm.indexOf(u)&&mm.push(u)}));return mm}_getMeshes(){const mm=[];this._rootBabylonMesh instanceof P.b&&mm.push(this._rootBabylonMesh);const o=this._gltf.nodes;if(o)for(const u of o)this._forEachPrimitive(u,(o=>{mm.push(o)}));return mm}_getTransformNodes(){const mm=[],o=this._gltf.nodes;if(o)for(const u of o)u._babylonTransformNode&&"nz"===u._babylonTransformNode.getClassName()&&mm.push(u._babylonTransformNode),u._babylonTransformNodeForSkin&&mm.push(u._babylonTransformNodeForSkin);return mm}_getSkeletons(){const mm=[],o=this._gltf.skins;if(o)for(const u of o)u._data&&mm.push(u._data.babylonSkeleton);return mm}_getAnimationGroups(){const mm=[],o=this._gltf.animations;if(o)for(const u of o)u._babylonAnimationGroup&&mm.push(u._babylonAnimationGroup);return mm}_startAnimations(){switch(this._parent.animationStartMode){case A.f.NONE:break;case A.f.FIRST:{const mm=this._getAnimationGroups();0!==mm.length&&mm[0].start(!0);break}case A.f.ALL:{const mm=this._getAnimationGroups();for(const o of mm)o.start(!0);break}default:return void E.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const f=this._extensionsLoadNodeAsync(mm,o,u);if(f)return f;if(o._babylonTransformNode)throw new Error(`${mm}: Invalid recursive node hierarchy`);const B=new Array;this.logOpen(`${mm} ${o.name||""}`);const O=f=>{if(C.AddPointerMetadata(f,mm),C._LoadTransform(o,f),void 0!=o.camera){const u=e.Get(`${mm}/camera`,this._gltf.cameras,o.camera);B.push(this.loadCameraAsync(`/cameras/${u.index}`,u,(mm=>{mm.parent=f,this._babylonScene.useRightHandedSystem||(f.rp.x=-1)})))}if(o.children)for(const u of o.children){const o=e.Get(`${mm}/children/${u}`,this._gltf.nodes,u);B.push(this.loadNodeAsync(`/nodes/${o.index}`,o,(mm=>{mm.parent=f})))}u(f)},r=void 0!=o.mesh,w=this._parent.loadSkins&&void 0!=o.skin;if(!r||w){const mm=o.name||`node${o.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new J.c(mm,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==o.mesh?o._babylonTransformNode=u:o._babylonTransformNodeForSkin=u,O(u)}if(r)if(w){const u=e.Get(`${mm}/mesh`,this._gltf.meshes,o.mesh);B.push(this._loadMeshAsync(`/meshes/${u.index}`,o,u,(u=>{const f=o._babylonTransformNodeForSkin;u.metadata=(0,k.d)(f.metadata,u.metadata||{});const O=e.Get(`${mm}/skin`,this._gltf.skins,o.skin);B.push(this._loadSkinAsync(`/skins/${O.index}`,o,O,(mm=>{this._forEachPrimitive(o,(o=>{o.skeleton=mm})),this._postSceneLoadActions.push((()=>{if(void 0!=O.skeleton){const mm=e.Get(`/skins/${O.index}/skeleton`,this._gltf.nodes,O.skeleton).parent;o.index===mm.index?u.parent=f.parent:u.parent=mm._babylonTransformNode}else u.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:f,skinnedNode:u})}))})))})))}else{const u=e.Get(`${mm}/mesh`,this._gltf.meshes,o.mesh);B.push(this._loadMeshAsync(`/meshes/${u.index}`,o,u,O))}return this.logClose(),Promise.all(B).then((()=>(this._forEachPrimitive(o,(mm=>{const o=mm;!o.isAnInstance&&o.br&&o.br.useBoundingInfoFromGeometry?mm.jm():mm.refreshBoundingInfo(!0,!0)})),o._babylonTransformNode)))}_loadMeshAsync(mm,o,u,f){const B=u.primitives;if(!B||!B.length)throw new Error(`${mm}: Primitives are missing`);void 0==B[0].index&&e.Assign(B);const O=new Array;this.logOpen(`${mm} ${u.name||""}`);const r=o.name||`node${o.index}`;if(1===B.length){const f=u.primitives[0];O.push(this._loadMeshPrimitiveAsync(`${mm}/primitives/${f.index}`,r,o,u,f,(mm=>{o._babylonTransformNode=mm,o._primitiveBabylonMeshes=[mm]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,o._babylonTransformNode=new J.c(r,this._babylonScene),o._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o._primitiveBabylonMeshes=[];for(const f of B)O.push(this._loadMeshPrimitiveAsync(`${mm}/primitives/${f.index}`,`${r}_primitive${f.index}`,o,u,f,(mm=>{mm.parent=o._babylonTransformNode,o._primitiveBabylonMeshes.push(mm)})))}return f(o._babylonTransformNode),this.logClose(),Promise.all(O).then((()=>o._babylonTransformNode))}_loadMeshPrimitiveAsync(mm,o,u,f,B,O){const r=this._extensionsLoadMeshPrimitiveAsync(mm,o,u,f,B,O);if(r)return r;this.logOpen(`${mm}`);const w=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==u.skin&&!f.primitives[0].targets;let p,K;if(w&&B._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,p=B._instanceData.babylonSourceMesh.createInstance(o),p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,K=B._instanceData.promise;else{const O=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new R.d(o,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.sideOrientation=this._babylonScene.useRightHandedSystem?t.c.CounterClockWiseSideOrientation:t.c.ClockWiseSideOrientation,this._createMorphTargets(mm,u,f,B,r),O.push(this._loadVertexDataAsync(mm,B,r).then((async o=>await this._loadMorphTargetsAsync(mm,B,r,o).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,o.Im(r),o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const z=C._GetDrawMode(mm,B.mode);if(void 0==B.material){let mm=this._defaultBabylonMaterialData[z];mm||(mm=this._createDefaultMaterial("__GLTFLoader._default",z),this._parent.onMaterialLoadedObservable.notifyObservers(mm),this._defaultBabylonMaterialData[z]=mm),r.material=mm}else if(!this.parent.skipMaterials){const o=e.Get(`${mm}/material`,this._gltf.materials,B.material);O.push(this._loadMaterialAsync(`/materials/${o.index}`,o,r,z,(mm=>{r.material=mm})))}K=Promise.all(O),w&&(B._instanceData={babylonSourceMesh:r,promise:K}),p=r}return C.AddPointerMetadata(p,mm),this._parent.onMeshLoadedObservable.notifyObservers(p),O(p),this.logClose(),K.then((()=>p))}_loadVertexDataAsync(mm,o,u){const f=this._extensionsLoadVertexDataAsync(mm,o,u);if(f)return f;const B=o.attributes;if(!B)throw new Error(`${mm}: Attributes are missing`);const O=new Array,r=new S.d(u.name,this._babylonScene);if(void 0==o.indices)u.isUnIndexed=!0;else{const u=e.Get(`${mm}/indices`,this._gltf.accessors,o.indices);O.push(this._loadIndicesAccessorAsync(`/accessors/${u.index}`,u).then((mm=>{r.setIndices(mm)})))}const w=(o,f,w)=>{if(void 0==B[o])return;u._delayInfo=u._delayInfo||[],-1===u._delayInfo.indexOf(f)&&u._delayInfo.push(f);const p=e.Get(`${mm}/attributes/${o}`,this._gltf.accessors,B[o]);O.push(this._loadVertexAccessorAsync(`/accessors/${p.index}`,p,f).then((mm=>{if(mm.getKind()===N.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!u.skeleton){const mm=L(p);mm&&(r._boundingInfo=mm,r.useBoundingInfoFromGeometry=!0)}r.setVerticesBuffer(mm,p.count)}))),f==N.f.MatricesIndicesExtraKind&&(u.numBoneInfluencers=8),w&&w(p)};return w("POSITION",N.f.PositionKind),w("NORMAL",N.f.NormalKind),w("TANGENT",N.f.TangentKind),w("TEXCOORD_0",N.f.UVKind),w("TEXCOORD_1",N.f.UV2Kind),w("TEXCOORD_2",N.f.UV3Kind),w("TEXCOORD_3",N.f.UV4Kind),w("TEXCOORD_4",N.f.UV5Kind),w("TEXCOORD_5",N.f.UV6Kind),w("JOINTS_0",N.f.MatricesIndicesKind),w("WEIGHTS_0",N.f.MatricesWeightsKind),w("JOINTS_1",N.f.MatricesIndicesExtraKind),w("WEIGHTS_1",N.f.MatricesWeightsExtraKind),w("COLOR_0",N.f.ColorKind,(mm=>{"VEC4"===mm.type&&(u.hasVertexAlpha=!0)})),Promise.all(O).then((()=>r))}_createMorphTargets(mm,o,u,f,B){if(!f.targets||!this._parent.loadMorphTargets)return;if(void 0==o._numMorphTargets)o._numMorphTargets=f.targets.length;else if(f.targets.length!==o._numMorphTargets)throw new Error(`${mm}: Primitives do not have the same number of targets`);const O=u.extras?u.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,B.morphTargetManager=new c(this._babylonScene),B.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.morphTargetManager.areUpdatesFrozen=!0;for(let r=0;r<f.targets.length;r++){const mm=o.weights?o.weights[r]:u.weights?u.weights[r]:0,f=O?O[r]:`morphTarget${r}`;B.morphTargetManager.addTarget(new g.c(f,mm,B.Pm()))}}_loadMorphTargetsAsync(mm,o,u,f){if(!o.targets||!this._parent.loadMorphTargets)return Promise.resolve();const B=new Array,O=u.morphTargetManager;for(let r=0;r<O.numTargets;r++){const u=O.getTarget(r);B.push(this._loadMorphTargetVertexDataAsync(`${mm}/targets/${r}`,f,o.targets[r],u))}return Promise.all(B).then((()=>{O.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(mm,o,u,f){const B=new Array,O=(f,O,r)=>{if(void 0==u[f])return;const w=o.getVertexBuffer(O);if(!w)return;const p=e.Get(`${mm}/${f}`,this._gltf.accessors,u[f]);B.push(this._loadFloatAccessorAsync(`/accessors/${p.index}`,p).then((mm=>{r(w,mm)})))};return O("POSITION",N.f.PositionKind,((mm,o)=>{const u=new Float32Array(o.length);mm.forEach(o.length,((mm,f)=>{u[f]=o[f]+mm})),f.setPositions(u)})),O("NORMAL",N.f.NormalKind,((mm,o)=>{const u=new Float32Array(o.length);mm.forEach(u.length,((mm,f)=>{u[f]=o[f]+mm})),f.setNormals(u)})),O("TANGENT",N.f.TangentKind,((mm,o)=>{const u=new Float32Array(o.length/3*4);let B=0;mm.forEach(o.length/3*4,((mm,f)=>{(f+1)%4!==0&&(u[B]=o[B]+mm,B++)})),f.setTangents(u)})),O("TEXCOORD_0",N.f.UVKind,((mm,o)=>{const u=new Float32Array(o.length);mm.forEach(o.length,((mm,f)=>{u[f]=o[f]+mm})),f.setUVs(u)})),O("TEXCOORD_1",N.f.UV2Kind,((mm,o)=>{const u=new Float32Array(o.length);mm.forEach(o.length,((mm,f)=>{u[f]=o[f]+mm})),f.setUV2s(u)})),O("COLOR_0",N.f.ColorKind,((o,u)=>{let B=null;const O=o.getSize();if(3===O){B=new Float32Array(u.length/3*4),o.forEach(u.length,((mm,o)=>{const f=Math.floor(o/3),O=o%3;B[4*f+O]=u[3*f+O]+mm}));for(let mm=0;mm<u.length/3;++mm)B[4*mm+3]=1}else{if(4!==O)throw new Error(`${mm}: Invalid number of components (${O}) for COLOR_0 attribute`);B=new Float32Array(u.length),o.forEach(u.length,((mm,o)=>{B[o]=u[o]+mm}))}f.setColors(B)})),await Promise.all(B).then((()=>{}))}static _LoadTransform(mm,o){if(void 0!=mm.skin)return;let u=B.lo.Zero(),f=B.Quaternion.Identity(),O=B.lo.One();if(mm.matrix){B.Matrix.So(mm.matrix).decompose(O,f,u)}else mm.translation&&(u=B.lo.So(mm.translation)),mm.rotation&&(f=B.Quaternion.So(mm.rotation)),mm.scale&&(O=B.lo.So(mm.scale));o.position=u,o.rotationQuaternion=f,o.rp=O}_loadSkinAsync(mm,o,u,f){if(!this._parent.loadSkins)return Promise.resolve();const B=this._extensionsLoadSkinAsync(mm,o,u);if(B)return B;if(u._data)return f(u._data.babylonSkeleton),u._data.promise;const O=`skeleton${u.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new l(u.name||O,O,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(mm,u,r);const w=this._loadSkinInverseBindMatricesDataAsync(mm,u).then((mm=>{this._updateBoneMatrices(r,mm)}));return u._data={babylonSkeleton:r,promise:w},f(r),w}_loadBones(mm,o,u){if(void 0==o.skeleton||this._parent.alwaysComputeSkeletonRootNode){const u=this._findSkeletonRootNode(`${mm}/joints`,o.joints);if(u)if(void 0===o.skeleton)o.skeleton=u.index;else{const f=(mm,o)=>{for(;o.parent;o=o.parent)if(o.parent===mm)return!0;return!1},B=e.Get(`${mm}/skeleton`,this._gltf.nodes,o.skeleton);B===u||f(B,u)||(E.e.Warn(`${mm}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),o.skeleton=u.index)}else E.e.Warn(`${mm}: Failed to find common root`)}const f={};for(const B of o.joints){const O=e.Get(`${mm}/joints/${B}`,this._gltf.nodes,B);this._loadBone(O,o,u,f)}}_findSkeletonRootNode(mm,o){if(0===o.length)return null;const u={};for(const B of o){const o=[];let f=e.Get(`${mm}/${B}`,this._gltf.nodes,B);for(;-1!==f.index;)o.unshift(f),f=f.parent;u[B]=o}let f=null;for(let B=0;;++B){let mm=u[o[0]];if(B>=mm.length)return f;const O=mm[B];for(let r=1;r<o.length;++r)if(mm=u[o[r]],B>=mm.length||O!==mm[B])return f;f=O}}_loadBone(mm,o,u,f){mm._isJoint=!0;let B=f[mm.index];if(B)return B;let O=null;mm.index!==o.skeleton&&(mm.parent&&-1!==mm.parent.index?O=this._loadBone(mm.parent,o,u,f):void 0!==o.skeleton&&E.e.Warn(`/skins/${o.index}/skeleton: Skeleton node is not a common root`));const r=o.joints.indexOf(mm.index);return B=new K.e(mm.name||`joint${mm.index}`,u,O,this._getNodeMatrix(mm),null,null,r),f[mm.index]=B,this._postSceneLoadActions.push((()=>{B.linkTransformNode(mm._babylonTransformNode)})),B}_loadSkinInverseBindMatricesDataAsync(mm,o){if(void 0==o.inverseBindMatrices)return Promise.resolve(null);const u=e.Get(`${mm}/inverseBindMatrices`,this._gltf.accessors,o.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${u.index}`,u)}_updateBoneMatrices(mm,o){for(const u of mm.bones){const mm=B.Matrix.Identity(),f=u._index;o&&-1!==f&&(B.Matrix.FromArrayToRef(o,16*f,mm),mm.invertToRef(mm));const O=u.getParent();O&&mm.multiplyToRef(O.getAbsoluteInverseBindMatrix(),mm),u.Tf(mm,!1,!1),u._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(mm){return mm.matrix?B.Matrix.So(mm.matrix):B.Matrix.Compose(mm.scale?B.lo.So(mm.scale):B.lo.One(),mm.rotation?B.Quaternion.So(mm.rotation):B.Quaternion.Identity(),mm.translation?B.lo.So(mm.translation):B.lo.Zero())}loadCameraAsync(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const f=this._extensionsLoadCameraAsync(mm,o,u);if(f)return f;const O=new Array;this.logOpen(`${mm} ${o.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new p.c(o.name||`camera${o.index}`,B.lo.Zero(),this._babylonScene,!1);switch(r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o._babylonCamera=r,r.setTarget(new B.lo(0,0,-1)),o.type){case"perspective":{const u=o.perspective;if(!u)throw new Error(`${mm}: Camera perspective properties are missing`);r.fov=u.yfov,r.hf=u.znear,r.maxZ=u.zfar||0;break}case"orthographic":if(!o.orthographic)throw new Error(`${mm}: Camera orthographic properties are missing`);r.mode=w.b.ORTHOGRAPHIC_CAMERA,r.orthoLeft=-o.orthographic.xmag,r.orthoRight=o.orthographic.xmag,r.orthoBottom=-o.orthographic.ymag,r.orthoTop=o.orthographic.ymag,r.hf=o.orthographic.znear,r.maxZ=o.orthographic.zfar;break;default:throw new Error(`${mm}: Invalid camera type (${o.type})`)}return C.AddPointerMetadata(r,mm),this._parent.onCameraLoadedObservable.notifyObservers(r),u(r),this.logClose(),Promise.all(O).then((()=>r))}_loadAnimationsAsync(){const mm=this._gltf.animations;if(!mm)return Promise.resolve();const o=new Array;for(let u=0;u<mm.length;u++){const f=mm[u];o.push(this.loadAnimationAsync(`/animations/${f.index}`,f).then((mm=>{0===mm.targetedAnimations.length&&mm.dispose()})))}return Promise.all(o).then((()=>{}))}loadAnimationAsync(mm,o){const f=this._extensionsLoadAnimationAsync(mm,o);return f||u.e(78).then(u.bind(u,15753)).then((u=>{let{AnimationGroup:f}=u;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new f(o.name||`animation${o.index}`,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o._babylonAnimationGroup=B;const O=new Array;e.Assign(o.channels),e.Assign(o.samplers);for(const r of o.channels)O.push(this._loadAnimationChannelAsync(`${mm}/channels/${r.index}`,mm,o,r,((mm,o)=>{mm.animations=mm.animations||[],mm.animations.push(o),B.addTargetedAnimation(o,mm)})));return Promise.all(O).then((()=>(B.normalize(0),B)))}))}async _loadAnimationChannelAsync(mm,o,f,B,O){const r=this._extensionsLoadAnimationChannelAsync(mm,o,f,B,O);if(r)return await r;if(void 0==B.target.node)return await Promise.resolve();const w=e.Get(`${mm}/target/node`,this._gltf.nodes,B.target.node),p=B.target.path,K="weights"===p;if(K&&!w._numMorphTargets||!K&&!w._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!K&&!w._isJoint)return await Promise.resolve();let z;switch(await Promise.resolve().then(u.bind(u,14219)),p){case"translation":var Y;z=null===(Y=(0,G.g)("/nodes/{}/translation"))||void 0===Y?void 0:Y.interpolation;break;case"rotation":var q;z=null===(q=(0,G.g)("/nodes/{}/rotation"))||void 0===q?void 0:q.interpolation;break;case"scale":var x;z=null===(x=(0,G.g)("/nodes/{}/scale"))||void 0===x?void 0:x.interpolation;break;case"weights":var H;z=null===(H=(0,G.g)("/nodes/{}/weights"))||void 0===H?void 0:H.interpolation;break;default:throw new Error(`${mm}/target/path: Invalid value (${B.target.path})`)}if(!z)throw new Error(`${mm}/target/path: Could not find interpolation properties for target path (${B.target.path})`);const E={object:w,info:z};return await this._loadAnimationChannelFromTargetInfoAsync(mm,o,f,B,E,O)}_loadAnimationChannelFromTargetInfoAsync(mm,o,u,f,B,O){const r=this.parent.targetFps,w=1/r,p=e.Get(`${mm}/sampler`,u.samplers,f.sampler);return this._loadAnimationSamplerAsync(`${o}/samplers/${f.sampler}`,p).then((mm=>{let o=0;const p=B.object,K=B.info;for(const B of K){const K=B.getStride(p),z=mm.input,Y=mm.output,q=new Array(z.length);let x=0;switch(mm.interpolation){case"STEP":for(let mm=0;mm<z.length;mm++){const o=B.getValue(p,Y,x,1);x+=K,q[mm]={frame:z[mm]*r,value:o,interpolation:1}}break;case"CUBICSPLINE":for(let mm=0;mm<z.length;mm++){const o=B.getValue(p,Y,x,w);x+=K;const u=B.getValue(p,Y,x,1);x+=K;const f=B.getValue(p,Y,x,w);x+=K,q[mm]={frame:z[mm]*r,inTangent:o,value:u,outTangent:f}}break;case"LINEAR":for(let mm=0;mm<z.length;mm++){const o=B.getValue(p,Y,x,1);x+=K,q[mm]={frame:z[mm]*r,value:o}}}if(x>0){const mm=`${u.name||`animation${u.index}`}_channel${f.index}_${o}`,w=B.buildAnimations(p,mm,r,q);for(const u of w)o++,O(u.babylonAnimatable,u.babylonAnimation)}}}))}_loadAnimationSamplerAsync(mm,o){if(o._data)return o._data;const u=o.interpolation||"LINEAR";switch(u){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${mm}/interpolation: Invalid value (${o.interpolation})`)}const f=e.Get(`${mm}/input`,this._gltf.accessors,o.input),B=e.Get(`${mm}/output`,this._gltf.accessors,o.output);return o._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${f.index}`,f),this._loadFloatAccessorAsync(`/accessors/${B.index}`,B)]).then((mm=>{let[o,f]=mm;return{input:o,interpolation:u,output:f}})),o._data}loadBufferAsync(mm,o,u,f){const B=this._extensionsLoadBufferAsync(mm,o,u,f);if(B)return B;if(!o._data)if(o.uri)o._data=this.loadUriAsync(`${mm}/uri`,o,o.uri);else{if(!this._bin)throw new Error(`${mm}: Uri is missing or the binary glTF is missing its binary chunk`);o._data=this._bin.readAsync(0,o.byteLength)}return o._data.then((o=>{try{return new Uint8Array(o.buffer,o.byteOffset+u,f)}catch(B){throw new Error(`${mm}: ${B.message}`)}}))}loadBufferViewAsync(mm,o){const u=this._extensionsLoadBufferViewAsync(mm,o);if(u)return u;if(o._data)return o._data;const f=e.Get(`${mm}/buffer`,this._gltf.buffers,o.buffer);return o._data=this.loadBufferAsync(`/buffers/${f.index}`,f,o.byteOffset||0,o.byteLength),o._data}_loadAccessorAsync(mm,o,u){if(o._data)return o._data;const f=C._GetNumComponents(mm,o.type),B=f*N.f.GetTypeByteLength(o.componentType),O=f*o.count;if(void 0==o.bufferView)o._data=Promise.resolve(new u(O));else{const r=e.Get(`${mm}/bufferView`,this._gltf.bufferViews,o.bufferView);o._data=this.loadBufferViewAsync(`/bufferViews/${r.index}`,r).then((w=>{if(5126!==o.componentType||o.normalized||r.byteStride&&r.byteStride!==B){const mm=new u(O);return N.f.ForEach(w,o.byteOffset||0,r.byteStride||B,f,o.componentType,mm.length,o.normalized||!1,((o,u)=>{mm[u]=o})),mm}return C._GetTypedArray(mm,o.componentType,w,o.byteOffset,O)}))}if(o.sparse){const O=o.sparse;o._data=o._data.then((r=>{const w=r,p=e.Get(`${mm}/sparse/indices/bufferView`,this._gltf.bufferViews,O.indices.bufferView),K=e.Get(`${mm}/sparse/values/bufferView`,this._gltf.bufferViews,O.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${p.index}`,p),this.loadBufferViewAsync(`/bufferViews/${K.index}`,K)]).then((r=>{let[p,K]=r;const z=C._GetTypedArray(`${mm}/sparse/indices`,O.indices.componentType,p,O.indices.byteOffset,O.count),Y=f*O.count;let q;if(5126!==o.componentType||o.normalized){const r=C._GetTypedArray(`${mm}/sparse/values`,o.componentType,K,O.values.byteOffset,Y);q=new u(Y),N.f.ForEach(r,0,B,f,o.componentType,q.length,o.normalized||!1,((mm,o)=>{q[o]=mm}))}else q=C._GetTypedArray(`${mm}/sparse/values`,o.componentType,K,O.values.byteOffset,Y);let x=0;for(let mm=0;mm<z.length;mm++){let o=z[mm]*f;for(let mm=0;mm<f;mm++)w[o++]=q[x++]}return w}))}))}return o._data}_loadFloatAccessorAsync(mm,o){return this._loadAccessorAsync(mm,o,Float32Array)}_loadIndicesAccessorAsync(mm,o){if("SCALAR"!==o.type)throw new Error(`${mm}/type: Invalid value ${o.type}`);if(5121!==o.componentType&&5123!==o.componentType&&5125!==o.componentType)throw new Error(`${mm}/componentType: Invalid value ${o.componentType}`);if(o._data)return o._data;if(o.sparse){const u=C._GetTypedArrayConstructor(`${mm}/componentType`,o.componentType);o._data=this._loadAccessorAsync(mm,o,u)}else{const u=e.Get(`${mm}/bufferView`,this._gltf.bufferViews,o.bufferView);o._data=this.loadBufferViewAsync(`/bufferViews/${u.index}`,u).then((u=>C._GetTypedArray(mm,o.componentType,u,o.byteOffset,o.count)))}return o._data}_loadVertexBufferViewAsync(mm){if(mm._babylonBuffer)return mm._babylonBuffer;const o=this._babylonScene.getEngine();return mm._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${mm.index}`,mm).then((mm=>new N.c(o,mm,!1))),mm._babylonBuffer}_loadVertexAccessorAsync(mm,o,u){var f;if(null!==(f=o._babylonVertexBuffer)&&void 0!==f&&f[u])return o._babylonVertexBuffer[u];o._babylonVertexBuffer||(o._babylonVertexBuffer={});const B=this._babylonScene.getEngine();if(o.sparse||void 0==o.bufferView)o._babylonVertexBuffer[u]=this._loadFloatAccessorAsync(mm,o).then((mm=>new N.f(B,mm,u,!1)));else{const f=e.Get(`${mm}/bufferView`,this._gltf.bufferViews,o.bufferView);o._babylonVertexBuffer[u]=this._loadVertexBufferViewAsync(f).then((O=>{const r=C._GetNumComponents(mm,o.type);return new N.f(B,O,u,!1,void 0,f.byteStride,void 0,o.byteOffset,r,o.componentType,o.normalized,!0,void 0,!0)}))}return o._babylonVertexBuffer[u]}_loadMaterialMetallicRoughnessPropertiesAsync(mm,o,u){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);const f=new Array;return o&&(o.baseColorFactor?(u.albedoColor=O.No.So(o.baseColorFactor),u.alpha=o.baseColorFactor[3]):u.albedoColor=O.No.White(),u.metallic=void 0==o.metallicFactor?1:o.metallicFactor,u.roughness=void 0==o.roughnessFactor?1:o.roughnessFactor,o.baseColorTexture&&f.push(this.loadTextureInfoAsync(`${mm}/baseColorTexture`,o.baseColorTexture,(mm=>{mm.name=`${u.name} (Base Color)`,u.albedoTexture=mm}))),o.metallicRoughnessTexture&&(o.metallicRoughnessTexture.nonColorData=!0,f.push(this.loadTextureInfoAsync(`${mm}/metallicRoughnessTexture`,o.metallicRoughnessTexture,(mm=>{mm.name=`${u.name} (Metallic Roughness)`,u.metallicTexture=mm}))),u.useMetallnessFromMetallicTextureBlue=!0,u.useRoughnessFromMetallicTextureGreen=!0,u.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(f).then((()=>{}))}_loadMaterialAsync(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const O=this._extensionsLoadMaterialAsync(mm,o,u,f,B);if(O)return O;o._data=o._data||{};let r=o._data[f];if(!r){this.logOpen(`${mm} ${o.name||""}`);const u=this.createMaterial(mm,o,f);r={babylonMaterial:u,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(mm,o,u)},o._data[f]=r,C.AddPointerMetadata(u,mm),this._parent.onMaterialLoadedObservable.notifyObservers(u),this.logClose()}return u&&(r.babylonMeshes.push(u),u.Jf.addOnce((()=>{const mm=r.babylonMeshes.indexOf(u);-1!==mm&&r.babylonMeshes.splice(mm,1)}))),B(r.babylonMaterial),r.promise.then((()=>r.babylonMaterial))}_createDefaultMaterial(mm,o){this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new Q.d(mm,this._babylonScene);return u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.fillMode=o,u.enableSpecularAntiAliasing=!0,u.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,u.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,u.transparencyMode=Q.d.PBRMATERIAL_OPAQUE,u.metallic=1,u.roughness=1,u}createMaterial(mm,o,u){const f=this._extensionsCreateMaterial(mm,o,u);if(f)return f;const B=o.name||`material${o.index}`;return this._createDefaultMaterial(B,u)}loadMaterialPropertiesAsync(mm,o,u){const f=this._extensionsLoadMaterialPropertiesAsync(mm,o,u);if(f)return f;const B=new Array;return B.push(this.loadMaterialBasePropertiesAsync(mm,o,u)),o.pbrMetallicRoughness&&B.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${mm}/pbrMetallicRoughness`,o.pbrMetallicRoughness,u)),this.loadMaterialAlphaProperties(mm,o,u),Promise.all(B).then((()=>{}))}loadMaterialBasePropertiesAsync(mm,o,u){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);const f=new Array;return u.emissiveColor=o.emissiveFactor?O.No.So(o.emissiveFactor):new O.No(0,0,0),o.doubleSided&&(u.Bp=!1,u.twoSidedLighting=!0),o.normalTexture&&(o.normalTexture.nonColorData=!0,f.push(this.loadTextureInfoAsync(`${mm}/normalTexture`,o.normalTexture,(mm=>{mm.name=`${u.name} (Normal)`,u.bumpTexture=mm}))),u.invertNormalMapX=!this._babylonScene.useRightHandedSystem,u.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=o.normalTexture.scale&&u.bumpTexture&&(u.bumpTexture.level=o.normalTexture.scale),u.forceIrradianceInFragment=!0),o.occlusionTexture&&(o.occlusionTexture.nonColorData=!0,f.push(this.loadTextureInfoAsync(`${mm}/occlusionTexture`,o.occlusionTexture,(mm=>{mm.name=`${u.name} (Occlusion)`,u.ambientTexture=mm}))),u.useAmbientInGrayScale=!0,void 0!=o.occlusionTexture.strength&&(u.ambientTextureStrength=o.occlusionTexture.strength)),o.emissiveTexture&&f.push(this.loadTextureInfoAsync(`${mm}/emissiveTexture`,o.emissiveTexture,(mm=>{mm.name=`${u.name} (Emissive)`,u.emissiveTexture=mm}))),Promise.all(f).then((()=>{}))}loadMaterialAlphaProperties(mm,o,u){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);switch(o.alphaMode||"OPAQUE"){case"OPAQUE":u.transparencyMode=Q.d.PBRMATERIAL_OPAQUE,u.alpha=1;break;case"MASK":u.transparencyMode=Q.d.PBRMATERIAL_ALPHATEST,u.alphaCutOff=void 0==o.alphaCutoff?.5:o.alphaCutoff,u.albedoTexture&&(u.albedoTexture.Uf=!0);break;case"BLEND":u.transparencyMode=Q.d.PBRMATERIAL_ALPHABLEND,u.albedoTexture&&(u.albedoTexture.Uf=!0,u.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${mm}/alphaMode: Invalid value (${o.alphaMode})`)}}loadTextureInfoAsync(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const f=this._extensionsLoadTextureInfoAsync(mm,o,u);if(f)return f;if(this.logOpen(`${mm}`),o.texCoord>=6)throw new Error(`${mm}/texCoord: Invalid value (${o.texCoord})`);const B=e.Get(`${mm}/index`,this._gltf.textures,o.index);B._textureInfo=o;const O=this._loadTextureAsync(`/textures/${o.index}`,B,(f=>{f.coordinatesIndex=o.texCoord||0,C.AddPointerMetadata(f,mm),this._parent.onTextureLoadedObservable.notifyObservers(f),u(f)}));return this.logClose(),O}_loadTextureAsync(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const f=this._extensionsLoadTextureAsync(mm,o,u);if(f)return f;this.logOpen(`${mm} ${o.name||""}`);const B=void 0==o.sampler?C.DefaultSampler:e.Get(`${mm}/sampler`,this._gltf.samplers,o.sampler),O=e.Get(`${mm}/source`,this._gltf.images,o.source),r=this._createTextureAsync(mm,B,O,u,void 0,!o._textureInfo.nonColorData);return this.logClose(),r}_createTextureAsync(mm,o,u){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},O=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;const w=this._loadSampler(`/samplers/${o.index}`,o),p=new Array,K=new f;this._babylonScene._blockEntityCollection=!!this._assetContainer;const z={noMipmap:w.noMipMaps,invertY:!1,samplingMode:w.samplingMode,T:()=>{this._disposed||K.resolve()},onError:(o,u)=>{this._disposed||K.reject(new Error(`${mm}: ${u&&u.message?u.message:o||"Failed to load texture"}`))},mimeType:u.mimeType??(0,y.i)(u.uri??""),loaderOptions:O,useSRGBBuffer:!!r&&this._parent.useSRGBBuffers},Y=new b.b(null,this._babylonScene,z);return Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p.push(K.promise),p.push(this.loadImageAsync(`/images/${u.index}`,u).then((mm=>{const o=u.uri||`${this._fileName}#image${u.index}`,f=`data:${this._uniqueRootUrl}${o}`;Y.updateURL(f,mm);const B=Y.getInternalTexture();B&&(B.label=u.name)}))),Y.wrapU=w.wrapU,Y.wrapV=w.wrapV,B(Y),this._parent.useGltfTextureNames&&(Y.name=u.name||u.uri||`image${u.index}`),Promise.all(p).then((()=>Y))}_loadSampler(mm,o){return o._data||(o._data={noMipMaps:9728===o.minFilter||9729===o.minFilter,samplingMode:C._GetTextureSamplingMode(mm,o),wrapU:C._GetTextureWrapMode(`${mm}/wrapS`,o.wrapS),wrapV:C._GetTextureWrapMode(`${mm}/wrapT`,o.wrapT)}),o._data}loadImageAsync(mm,o){if(!o._data){if(this.logOpen(`${mm} ${o.name||""}`),o.uri)o._data=this.loadUriAsync(`${mm}/uri`,o,o.uri);else{const u=e.Get(`${mm}/bufferView`,this._gltf.bufferViews,o.bufferView);o._data=this.loadBufferViewAsync(`/bufferViews/${u.index}`,u)}this.logClose()}return o._data}loadUriAsync(mm,o,u){const f=this._extensionsLoadUriAsync(mm,o,u);if(f)return f;if(!C._ValidateUri(u))throw new Error(`${mm}: '${u}' is invalid`);if((0,y.k)(u)){const o=new Uint8Array((0,y.e)(u));return this.log(`${mm}: Decoded ${u.substring(0,64)}... (${o.length} bytes)`),Promise.resolve(o)}return this.log(`${mm}: Loading ${u}`),this._parent.preprocessUrlAsync(this._rootUrl+u).then((o=>new Promise(((f,B)=>{this._parent._loadFile(this._babylonScene,o,(o=>{this._disposed||(this.log(`${mm}: Loaded ${u} (${o.byteLength} bytes)`),f(new Uint8Array(o)))}),!0,(o=>{B(new y.l(`${mm}: Failed to load '${u}'${o?": "+o.status+" "+o.statusText:""}`,o))}))}))))}static AddPointerMetadata(mm,o){mm.metadata=mm.metadata||{};const u=mm._internalMetadata=mm._internalMetadata||{},f=u.Af=u.Af||{};(f.pointers=f.pointers||[]).push(o)}static _GetTextureWrapMode(mm,o){switch(o=void 0==o?10497:o){case 33071:return b.b.CLAMP_ADDRESSMODE;case 33648:return b.b.MIRROR_ADDRESSMODE;case 10497:return b.b.WRAP_ADDRESSMODE;default:return E.e.Warn(`${mm}: Invalid value (${o})`),b.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(mm,o){const u=void 0==o.magFilter?9729:o.magFilter,f=void 0==o.minFilter?9987:o.minFilter;if(9729===u)switch(f){case 9728:return b.b.LINEAR_NEAREST;case 9729:return b.b.LINEAR_LINEAR;case 9984:return b.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return b.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return b.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return b.b.LINEAR_LINEAR_MIPLINEAR;default:return E.e.Warn(`${mm}/minFilter: Invalid value (${f})`),b.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==u&&E.e.Warn(`${mm}/magFilter: Invalid value (${u})`),f){case 9728:return b.b.NEAREST_NEAREST;case 9729:return b.b.NEAREST_LINEAR;case 9984:return b.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return b.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return b.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return b.b.NEAREST_LINEAR_MIPLINEAR;default:return E.e.Warn(`${mm}/minFilter: Invalid value (${f})`),b.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(mm,o){try{return(0,d.l)(o)}catch(u){throw new Error(`${mm}: ${u.message}`)}}static _GetTypedArray(mm,o,u,f,B){const O=u.buffer;f=u.byteOffset+(f||0);const r=C._GetTypedArrayConstructor(`${mm}/componentType`,o),w=N.f.GetTypeByteLength(o);return f%w!==0?(E.e.Warn(`${mm}: Copying buffer as byte offset (${f}) is not a multiple of component type byte length (${w})`),new r(O.slice(f,f+B*w),0)):new r(O,f,B)}static _GetNumComponents(mm,o){switch(o){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${mm}: Invalid type (${o})`)}static _ValidateUri(mm){return r.Tools.IsBase64(mm)||-1===mm.indexOf("..")}static _GetDrawMode(mm,o){switch(void 0==o&&(o=4),o){case 0:return t.c.PointListDrawMode;case 1:return t.c.LineListDrawMode;case 2:return t.c.LineLoopDrawMode;case 3:return t.c.LineStripDrawMode;case 4:return t.c.TriangleFillMode;case 5:return t.c.TriangleStripDrawMode;case 6:return t.c.TriangleFanDrawMode}throw new Error(`${mm}: Invalid mesh primitive mode (${o})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const mm=new Array;if(this._gltf.materials)for(const o of this._gltf.materials)if(o._data)for(const u in o._data){const f=o._data[u];for(const o of f.babylonMeshes){o.Df(!0);const u=f.babylonMaterial;mm.push(u.forceCompilationAsync(o)),mm.push(u.forceCompilationAsync(o,{useInstances:!0})),this._parent.useClipPlane&&(mm.push(u.forceCompilationAsync(o,{clipPlane:!0})),mm.push(u.forceCompilationAsync(o,{clipPlane:!0,useInstances:!0})))}}return Promise.all(mm).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const mm=new Array,o=this._babylonScene.lights;for(const u of o){const o=u.getShadowGenerator();o&&mm.push(o.forceCompilationAsync())}return Promise.all(mm).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(mm){for(const o of this._extensions)o.enabled&&mm(o)}_applyExtensions(mm,o,u){for(const f of this._extensions)if(f.enabled){const B=`${f.name}.${o}`,O=mm;O._activeLoaderExtensionFunctions=O._activeLoaderExtensionFunctions||{};const r=O._activeLoaderExtensionFunctions;if(!r[B]){r[B]=!0;try{const mm=u(f);if(mm)return mm}finally{delete r[B]}}}return null}_extensionsOnLoading(){this._forEachExtensions((mm=>mm.onLoading&&mm.onLoading()))}_extensionsOnReady(){this._forEachExtensions((mm=>mm.onReady&&mm.onReady()))}_extensionsLoadSceneAsync(mm,o){return this._applyExtensions(o,"loadScene",(u=>u.loadSceneAsync&&u.loadSceneAsync(mm,o)))}_extensionsLoadNodeAsync(mm,o,u){return this._applyExtensions(o,"loadNode",(f=>f.loadNodeAsync&&f.loadNodeAsync(mm,o,u)))}_extensionsLoadCameraAsync(mm,o,u){return this._applyExtensions(o,"loadCamera",(f=>f.loadCameraAsync&&f.loadCameraAsync(mm,o,u)))}_extensionsLoadVertexDataAsync(mm,o,u){return this._applyExtensions(o,"loadVertexData",(f=>f._loadVertexDataAsync&&f._loadVertexDataAsync(mm,o,u)))}_extensionsLoadMeshPrimitiveAsync(mm,o,u,f,B,O){return this._applyExtensions(B,"loadMeshPrimitive",(r=>r._loadMeshPrimitiveAsync&&r._loadMeshPrimitiveAsync(mm,o,u,f,B,O)))}_extensionsLoadMaterialAsync(mm,o,u,f,B){return this._applyExtensions(o,"loadMaterial",(O=>O._loadMaterialAsync&&O._loadMaterialAsync(mm,o,u,f,B)))}_extensionsCreateMaterial(mm,o,u){return this._applyExtensions(o,"createMaterial",(f=>f.createMaterial&&f.createMaterial(mm,o,u)))}_extensionsLoadMaterialPropertiesAsync(mm,o,u){return this._applyExtensions(o,"loadMaterialProperties",(f=>f.loadMaterialPropertiesAsync&&f.loadMaterialPropertiesAsync(mm,o,u)))}_extensionsLoadTextureInfoAsync(mm,o,u){return this._applyExtensions(o,"loadTextureInfo",(f=>f.loadTextureInfoAsync&&f.loadTextureInfoAsync(mm,o,u)))}_extensionsLoadTextureAsync(mm,o,u){return this._applyExtensions(o,"loadTexture",(f=>f._loadTextureAsync&&f._loadTextureAsync(mm,o,u)))}_extensionsLoadAnimationAsync(mm,o){return this._applyExtensions(o,"loadAnimation",(u=>u.loadAnimationAsync&&u.loadAnimationAsync(mm,o)))}_extensionsLoadAnimationChannelAsync(mm,o,u,f,B){return this._applyExtensions(u,"loadAnimationChannel",(O=>O._loadAnimationChannelAsync&&O._loadAnimationChannelAsync(mm,o,u,f,B)))}_extensionsLoadSkinAsync(mm,o,u){return this._applyExtensions(u,"loadSkin",(f=>f._loadSkinAsync&&f._loadSkinAsync(mm,o,u)))}_extensionsLoadUriAsync(mm,o,u){return this._applyExtensions(o,"loadUri",(f=>f._loadUriAsync&&f._loadUriAsync(mm,o,u)))}_extensionsLoadBufferViewAsync(mm,o){return this._applyExtensions(o,"loadBufferView",(u=>u.loadBufferViewAsync&&u.loadBufferViewAsync(mm,o)))}_extensionsLoadBufferAsync(mm,o,u,f){return this._applyExtensions(o,"loadBuffer",(B=>B.loadBufferAsync&&B.loadBufferAsync(mm,o,u,f)))}static LoadExtensionAsync(mm,o,u,f){if(!o.extensions)return null;const B=o.extensions[u];return B?f(`${mm}/extensions/${u}`,B):null}static LoadExtraAsync(mm,o,u,f){if(!o.extras)return null;const B=o.extras[u];return B?f(`${mm}/extras/${u}`,B):null}isExtensionUsed(mm){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(mm)}logOpen(mm){this._parent._logOpen(mm)}logClose(){this._parent._logClose()}log(mm){this._parent._log(mm)}startPerformanceCounter(mm){this._parent._startPerformanceCounter(mm)}endPerformanceCounter(mm){this._parent._endPerformanceCounter(mm)}}C.DefaultSampler={index:-1},A.d._CreateGLTF2Loader=mm=>new C(mm);var v=u(14219),V=u(12912),n=u(12766),U=u(14226),h=u(14232);class Z extends h.e{constructor(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",mm),this._texture=mm.getEngine().createRawCubeTexture(o,u,f,B,O,r,w,p)}update(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,mm,o,u,f,B)}updateRGBDAsync(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,U.h)(this._texture,mm,o,u,f).then((()=>{}))}clone(){return n.c.Clone((()=>{const mm=this.Pm(),o=this._texture,u=new Z(mm,o._bufferViewArray,o.width,o.format,o.type,o.generateMipMaps,o.invertY,o.samplingMode,o._compression);return 13===o.source&&u.updateRGBDAsync(o._bufferViewArrayArray,o._sphericalPolynomial,o._lodGenerationScale,o._lodGenerationOffset),u}),this)}}const T="EXT_lights_image_based";class D{constructor(mm){this.name=T,this._loader=mm,this.enabled=this._loader.isExtensionUsed(T)}dispose(){this._loader=null,delete this._lights}onLoading(){const mm=this._loader.Af.extensions;if(mm&&mm[this.name]){const o=mm[this.name];this._lights=o.lights}}loadSceneAsync(mm,o){return C.LoadExtensionAsync(mm,o,this.name,(async(u,f)=>{this._loader._allMaterialsDirtyRequired=!0;const B=new Array;B.push(this._loader.loadSceneAsync(mm,o)),this._loader.logOpen(`${u}`);const O=e.Get(`${u}/light`,this._lights,f.Ef);return B.push(this._loadLightAsync(`/extensions/${this.name}/lights/${f.Ef}`,O).then((mm=>{this._loader.babylonScene.environmentTexture=mm}))),this._loader.logClose(),await Promise.all(B).then((()=>{}))}))}_loadLightAsync(mm,o){if(!o._loaded){const u=new Array;this._loader.logOpen(`${mm}`);const f=new Array(o.specularImages.length);for(let B=0;B<o.specularImages.length;B++){const O=o.specularImages[B];f[B]=new Array(O.length);for(let o=0;o<O.length;o++){const r=`${mm}/specularImages/${B}/${o}`;this._loader.logOpen(`${r}`);const w=O[o],p=e.Get(r,this._loader.Af.images,w);u.push(this._loader.loadImageAsync(`/images/${w}`,p).then((mm=>{f[B][o]=mm}))),this._loader.logClose()}}this._loader.logClose(),o._loaded=Promise.all(u).then((async()=>{const u=new Z(this._loader.babylonScene,null,o.specularImageSize);if(u.name=o.name||"environment",o._babylonTexture=u,void 0!=o.Yp&&(u.level=o.Yp),o.rotation){let mm=B.Quaternion.So(o.rotation);this._loader.babylonScene.useRightHandedSystem||(mm=B.Quaternion.Inverse(mm)),B.Matrix.FromQuaternionToRef(mm,u.getReflectionTextureMatrix())}if(!o.irradianceCoefficients)throw new Error(`${mm}: Irradiance coefficients are missing`);const O=V.b.So(o.irradianceCoefficients);O.scaleInPlace(o.Yp),O.convertIrradianceToLambertianRadiance();const r=V.c.FromHarmonics(O),w=(f.length-1)/Math.log2(o.specularImageSize);return await u.updateRGBDAsync(f,r,w)}))}return o._loaded.then((()=>o._babylonTexture))}}X(T),a(T,!0,(mm=>new D(mm)));u(13280);const i="EXT_mesh_gpu_instancing";class mo{constructor(mm){this.name=i,this._loader=mm,this.enabled=this._loader.isExtensionUsed(i)}dispose(){this._loader=null}loadNodeAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(mm,f)=>{this._loader._disableInstancedMesh++;const O=this._loader.loadNodeAsync(`/nodes/${o.index}`,o,u);if(this._loader._disableInstancedMesh--,!o._primitiveBabylonMeshes)return await O;const r=new Array;let w=0;const p=o=>{if(void 0==f.attributes[o])return void r.push(Promise.resolve(null));const u=e.Get(`${mm}/attributes/${o}`,this._loader.Af.accessors,f.attributes[o]);if(r.push(this._loader._loadFloatAccessorAsync(`/accessors/${u.bufferView}`,u)),0===w)w=u.count;else if(w!==u.count)throw new Error(`${mm}/attributes: Instance buffer accessors do not have the same count.`)};return p("TRANSLATION"),p("ROTATION"),p("SCALE"),await O.then((async mm=>{const[u,f,O]=await Promise.all(r),p=new Float32Array(16*w);B.TmpVectors.lo[0].Op(0,0,0),B.TmpVectors.Quaternion[0].Op(0,0,0,1),B.TmpVectors.lo[1].Op(1,1,1);for(let o=0;o<w;++o)u&&B.lo.FromArrayToRef(u,3*o,B.TmpVectors.lo[0]),f&&B.Quaternion.FromArrayToRef(f,4*o,B.TmpVectors.Quaternion[0]),O&&B.lo.FromArrayToRef(O,3*o,B.TmpVectors.lo[1]),B.Matrix.ComposeToRef(B.TmpVectors.lo[1],B.TmpVectors.Quaternion[0],B.TmpVectors.lo[0],B.TmpVectors.Matrix[0]),B.TmpVectors.Matrix[0].copyToArray(p,16*o);for(const B of o._primitiveBabylonMeshes)B.Oq("matrix",p,16,!0);return mm}))}))}}X(i),a(i,!0,(mm=>new mo(mm)));let om=0,um=null;class fm{static get Default(){return fm._Default||(fm._Default=new fm),fm._Default}constructor(){const mm=fm.Configuration.decoder;this._decoderModulePromise=r.Tools.LoadBabylonScriptAsync(mm.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(mm,o,u,f,B){await this._decoderModulePromise,0===om&&(MeshoptDecoder.useWorkers(1),om=1);const O=await MeshoptDecoder.decodeGltfBufferAsync(o,u,mm,f,B);return null!==um&&clearTimeout(um),um=setTimeout((()=>{MeshoptDecoder.useWorkers(0),om=0,um=null}),1e3),O}}fm.Configuration={decoder:{url:`${r.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},fm._Default=null;const Bm="EXT_meshopt_compression";class Om{constructor(mm){this.name=Bm,this.enabled=mm.isExtensionUsed(Bm),this._loader=mm}dispose(){this._loader=null}loadBufferViewAsync(mm,o){return C.LoadExtensionAsync(mm,o,this.name,(async(u,f)=>{const B=o;if(B._meshOptData)return await B._meshOptData;const O=e.Get(`${mm}/buffer`,this._loader.Af.buffers,f.buffer);return B._meshOptData=this._loader.loadBufferAsync(`/buffers/${O.index}`,O,f.byteOffset||0,f.byteLength).then((async mm=>await fm.Default.decodeGltfBufferAsync(mm,f.count,f.byteStride,f.mode,f.filter))),await B._meshOptData}))}}X(Bm),a(Bm,!0,(mm=>new Om(mm)));const rm="EXT_texture_webp";class wm{constructor(mm){this.name=rm,this._loader=mm,this.enabled=mm.isExtensionUsed(rm)}dispose(){this._loader=null}_loadTextureAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=void 0==o.sampler?C.DefaultSampler:e.Get(`${mm}/sampler`,this._loader.Af.samplers,o.sampler),r=e.Get(`${f}/source`,this._loader.Af.images,B.source);return await this._loader._createTextureAsync(mm,O,r,(mm=>{u(mm)}),void 0,!o._textureInfo.nonColorData)}))}}X(rm),a(rm,!0,(mm=>new wm(mm)));const pm="EXT_texture_avif";class Km{constructor(mm){this.name=pm,this._loader=mm,this.enabled=mm.isExtensionUsed(pm)}dispose(){this._loader=null}_loadTextureAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=void 0==o.sampler?C.DefaultSampler:e.Get(`${mm}/sampler`,this._loader.Af.samplers,o.sampler),r=e.Get(`${f}/source`,this._loader.Af.images,B.source);return await this._loader._createTextureAsync(mm,O,r,(mm=>{u(mm)}),void 0,!o._textureInfo.nonColorData)}))}}X(pm),a(pm,!0,(mm=>new Km(mm)));var zm=u(14213),Ym=u(13258);const qm="EXT_lights_ies";class xm{constructor(mm){this.name=qm,this._loader=mm,this.enabled=this._loader.isExtensionUsed(qm)}dispose(){this._loader=null,delete this._lights}onLoading(){const mm=this._loader.Af.extensions;if(mm&&mm[this.name]){const o=mm[this.name];this._lights=o.lights,e.Assign(this._lights)}}loadNodeAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,r)=>{let w,p;this._loader._allMaterialsDirtyRequired=!0;const K=await this._loader.loadNodeAsync(mm,o,(mm=>{p=e.Get(f,this._lights,r.Ef);const o=p.name||mm.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,w=new zm.b(o,B.lo.Zero(),B.lo.Backward(),0,1,this._loader.babylonScene),w.angle=Math.PI/2,w.innerAngle=0,w._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,p._babylonLight=w,w.falloffType=Ym.c.FALLOFF_GLTF,w.qp=r.color?O.No.So(r.color):O.No.White(),w.Yp=r.multiplier||1,w.range=Number.MAX_VALUE,w.parent=mm,this._loader._babylonLights.push(w),C.AddPointerMetadata(w,f),u(mm)}));let z;if(p.uri)z=await this._loader.loadUriAsync(mm,p,p.uri);else{const o=e.Get(`${mm}/bufferView`,this._loader.Af.bufferViews,p.bufferView);z=await this._loader.loadBufferViewAsync(`/bufferViews/${o.index}`,o)}return w.iesProfileTexture=new b.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,z,!0,void 0,void 0,void 0,void 0,".ies"),K}))}}X(qm),a(qm,!0,(mm=>new xm(mm)));var Hm=u(14237);const Em="KHR_draco_mesh_compression";class Mm{constructor(mm){this.name=Em,this.useNormalizedFlagFromAccessor=!0,this._loader=mm,this.enabled=Hm.b.DefaultAvailable&&this._loader.isExtensionUsed(Em)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{if(void 0!=o.mode&&4!==o.mode&&5!==o.mode)throw new Error(`${mm}: Unsupported mode ${o.mode}`);const O={},r={},w=(mm,f)=>{const w=B.attributes[mm];if(void 0!=w&&(u._delayInfo=u._delayInfo||[],-1===u._delayInfo.indexOf(f)&&u._delayInfo.push(f),O[f]=w,this.useNormalizedFlagFromAccessor)){const u=e.TryGet(this._loader.Af.accessors,o.attributes[mm]);u&&(r[f]=u.normalized||!1)}};w("POSITION",N.f.PositionKind),w("NORMAL",N.f.NormalKind),w("TANGENT",N.f.TangentKind),w("TEXCOORD_0",N.f.UVKind),w("TEXCOORD_1",N.f.UV2Kind),w("TEXCOORD_2",N.f.UV3Kind),w("TEXCOORD_3",N.f.UV4Kind),w("TEXCOORD_4",N.f.UV5Kind),w("TEXCOORD_5",N.f.UV6Kind),w("JOINTS_0",N.f.MatricesIndicesKind),w("WEIGHTS_0",N.f.MatricesWeightsKind),w("COLOR_0",N.f.ColorKind);const p=e.Get(f,this._loader.Af.bufferViews,B.bufferView);return p._dracoBabylonGeometry||(p._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${p.index}`,p).then((async f=>{const B=this.dracoDecoder||Hm.b.Default,w=e.TryGet(this._loader.Af.accessors,o.attributes.POSITION),p=this._loader.parent.alwaysComputeBoundingBox||u.skeleton||!w?null:L(w);return await B._decodeMeshToGeometryForGltfAsync(u.name,this._loader.babylonScene,f,O,r,p).catch((o=>{throw new Error(`${mm}: ${o.message}`)}))}))),await p._dracoBabylonGeometry}))}}X(Em),a(Em,!0,(mm=>new Mm(mm)));var lm=u(14243),tm=u(12729),Qm=u(12732),bm=u(13145),Jm=u(13310),Nm=u(12702);bm.c.AddNodeConstructor("Light_Type_0",((mm,o)=>()=>new Sm(mm,B.lo.Zero(),o)));class Sm extends Jm.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(mm){this._shadowAngle=mm,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(mm){const o=this.needCube();if(this._direction=mm,this.needCube()!==o&&this._shadowGenerators){const mm=this._shadowGenerators.values();for(let o=mm.next();!0!==o.done;o=mm.next()){o.value.recreateShadowMap()}}}constructor(mm,o,u){super(mm,u),this._shadowAngle=Math.PI/2,this.position=o}getClassName(){return"PointLight"}getTypeID(){return Ym.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(mm){if(this.direction)return super.getShadowDirection(mm);switch(mm){case 0:return new B.lo(1,0,0);case 1:return new B.lo(-1,0,0);case 2:return new B.lo(0,-1,0);case 3:return new B.lo(0,1,0);case 4:return new B.lo(0,0,1);case 5:return new B.lo(0,0,-1)}return B.lo.Zero()}_setDefaultShadowProjectionMatrix(mm,o,u){const f=this.Pm().activeCamera;if(!f)return;const O=void 0!==this.shadowMinZ?this.shadowMinZ:f.hf,r=void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ,w=this.Pm().getEngine().tf;B.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,w?r:O,w?O:r,mm,!0,this._scene.getEngine().isNDCHalfZRange,void 0,w)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(mm,o){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,o):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,o),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,o),this}transferToNodeMaterialEffect(mm,o){return this.computeTransformedInformation()?mm.setFloat3(o,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):mm.setFloat3(o,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(mm,o){mm["POINTLIGHT"+o]=!0}}(0,tm.d)([(0,Qm.J)()],Sm.prototype,"shadowAngle",null),(0,Nm.c)("BABYLON.PointLight",Sm);const Pm="KHR_lights_punctual";class Rm{constructor(mm){this.name=Pm,this._loader=mm,this.enabled=this._loader.isExtensionUsed(Pm)}dispose(){this._loader=null,delete this._lights}onLoading(){const mm=this._loader.Af.extensions;if(mm&&mm[this.name]){const o=mm[this.name];this._lights=o.lights,e.Assign(this._lights)}}loadNodeAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,r)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(mm,o,(mm=>{let o;const w=e.Get(f,this._lights,r.Ef),p=w.name||mm.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,w.type){case"directional":{const mm=new lm.d(p,B.lo.Backward(),this._loader.babylonScene);mm.position.wp(0),o=mm;break}case"point":o=new Sm(p,B.lo.Zero(),this._loader.babylonScene);break;case"spot":{const mm=new zm.b(p,B.lo.Zero(),B.lo.Backward(),0,1,this._loader.babylonScene);mm.angle=2*(w.spot&&w.spot.outerConeAngle||Math.PI/4),mm.innerAngle=2*(w.spot&&w.spot.innerConeAngle||0),o=mm;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${f}: Invalid light type (${w.type})`)}o._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,w._babylonLight=o,o.falloffType=Ym.c.FALLOFF_GLTF,o.qp=w.color?O.No.So(w.color):O.No.White(),o.Yp=void 0==w.Yp?1:w.Yp,o.range=void 0==w.range?Number.MAX_VALUE:w.range,o.parent=mm,this._loader._babylonLights.push(o),C.AddPointerMetadata(o,f),u(mm)})))))}}X(Pm),a(Pm,!0,(mm=>new Rm(mm)));const gm="KHR_materials_pbrSpecularGlossiness";class Wm{constructor(mm){this.name=gm,this.order=200,this._loader=mm,this.enabled=this._loader.isExtensionUsed(gm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=new Array;return O.push(this._loader.loadMaterialBasePropertiesAsync(mm,o,u)),O.push(this._loadSpecularGlossinessPropertiesAsync(f,B,u)),this._loader.loadMaterialAlphaProperties(mm,o,u),await Promise.all(O).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(mm,o,u){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);const f=new Array;return u.metallic=null,u.roughness=null,o.diffuseFactor?(u.albedoColor=O.No.So(o.diffuseFactor),u.alpha=o.diffuseFactor[3]):u.albedoColor=O.No.White(),u.reflectivityColor=o.specularFactor?O.No.So(o.specularFactor):O.No.White(),u.microSurface=void 0==o.glossinessFactor?1:o.glossinessFactor,o.diffuseTexture&&f.push(this._loader.loadTextureInfoAsync(`${mm}/diffuseTexture`,o.diffuseTexture,(mm=>{mm.name=`${u.name} (Diffuse)`,u.albedoTexture=mm}))),o.specularGlossinessTexture&&(f.push(this._loader.loadTextureInfoAsync(`${mm}/specularGlossinessTexture`,o.specularGlossinessTexture,(mm=>{mm.name=`${u.name} (Specular Glossiness)`,u.reflectivityTexture=mm,u.reflectivityTexture.Uf=!0}))),u.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(f).then((()=>{}))}}X(gm),a(gm,!0,(mm=>new Wm(mm)));const Fm="KHR_materials_unlit";class cm{constructor(mm){this.name=Fm,this.order=210,this._loader=mm,this.enabled=this._loader.isExtensionUsed(Fm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async()=>await this._loadUnlitPropertiesAsync(mm,o,u)))}_loadUnlitPropertiesAsync(mm,o,u){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);const f=new Array;u.unlit=!0;const B=o.pbrMetallicRoughness;return B&&(B.baseColorFactor?(u.albedoColor=O.No.So(B.baseColorFactor),u.alpha=B.baseColorFactor[3]):u.albedoColor=O.No.White(),B.baseColorTexture&&f.push(this._loader.loadTextureInfoAsync(`${mm}/baseColorTexture`,B.baseColorTexture,(mm=>{mm.name=`${u.name} (Base Color)`,u.albedoTexture=mm})))),o.doubleSided&&(u.Bp=!1,u.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(mm,o,u),Promise.all(f).then((()=>{}))}}X(Fm),a(Fm,!0,(mm=>new cm(mm)));const Am="KHR_materials_clearcoat";class ym{constructor(mm){this.name=Am,this.order=190,this._loader=mm,this.enabled=this._loader.isExtensionUsed(Am)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=new Array;O.push(this._loader.loadMaterialPropertiesAsync(mm,o,u)),O.push(this._loadClearCoatPropertiesAsync(f,B,u)),await Promise.all(O)}))}_loadClearCoatPropertiesAsync(mm,o,u){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);const f=new Array;return u.clearCoat.isEnabled=!0,u.clearCoat.useRoughnessFromMainTexture=!1,u.clearCoat.remapF0OnInterfaceChange=!1,void 0!=o.clearcoatFactor?u.clearCoat.Yp=o.clearcoatFactor:u.clearCoat.Yp=0,o.clearcoatTexture&&f.push(this._loader.loadTextureInfoAsync(`${mm}/clearcoatTexture`,o.clearcoatTexture,(mm=>{mm.name=`${u.name} (ClearCoat)`,u.clearCoat.texture=mm}))),void 0!=o.clearcoatRoughnessFactor?u.clearCoat.roughness=o.clearcoatRoughnessFactor:u.clearCoat.roughness=0,o.clearcoatRoughnessTexture&&(o.clearcoatRoughnessTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${mm}/clearcoatRoughnessTexture`,o.clearcoatRoughnessTexture,(mm=>{mm.name=`${u.name} (ClearCoat Roughness)`,u.clearCoat.textureRoughness=mm})))),o.clearcoatNormalTexture&&(o.clearcoatNormalTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${mm}/clearcoatNormalTexture`,o.clearcoatNormalTexture,(mm=>{mm.name=`${u.name} (ClearCoat Normal)`,u.clearCoat.bumpTexture=mm}))),u.invertNormalMapX=!u.Pm().useRightHandedSystem,u.invertNormalMapY=u.Pm().useRightHandedSystem,void 0!=o.clearcoatNormalTexture.scale&&(u.clearCoat.bumpTexture.level=o.clearcoatNormalTexture.scale)),Promise.all(f).then((()=>{}))}}X(Am),a(Am,!0,(mm=>new ym(mm)));const Im="KHR_materials_iridescence";class sm{constructor(mm){this.name=Im,this.order=195,this._loader=mm,this.enabled=this._loader.isExtensionUsed(Im)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(mm,o,u)),O.push(this._loadIridescencePropertiesAsync(f,B,u)),await Promise.all(O).then((()=>{}))}))}_loadIridescencePropertiesAsync(mm,o,u){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);const f=new Array;return u.iridescence.isEnabled=!0,u.iridescence.Yp=o.iridescenceFactor??0,u.iridescence.indexOfRefraction=o.iridescenceIor??o.iridescenceIOR??1.3,u.iridescence.minimumThickness=o.iridescenceThicknessMinimum??100,u.iridescence.maximumThickness=o.iridescenceThicknessMaximum??400,o.iridescenceTexture&&f.push(this._loader.loadTextureInfoAsync(`${mm}/iridescenceTexture`,o.iridescenceTexture,(mm=>{mm.name=`${u.name} (Iridescence)`,u.iridescence.texture=mm}))),o.iridescenceThicknessTexture&&f.push(this._loader.loadTextureInfoAsync(`${mm}/iridescenceThicknessTexture`,o.iridescenceThicknessTexture,(mm=>{mm.name=`${u.name} (Iridescence Thickness)`,u.iridescence.thicknessTexture=mm}))),Promise.all(f).then((()=>{}))}}X(Im),a(Im,!0,(mm=>new sm(mm)));const jm="KHR_materials_anisotropy";class am{constructor(mm){this.name=jm,this.order=195,this._loader=mm,this.enabled=this._loader.isExtensionUsed(jm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=new Array;O.push(this._loader.loadMaterialPropertiesAsync(mm,o,u)),O.push(this._loadIridescencePropertiesAsync(f,B,u)),await Promise.all(O)}))}async _loadIridescencePropertiesAsync(mm,o,u){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);const f=new Array;u.anisotropy.isEnabled=!0,u.anisotropy.Yp=o.anisotropyStrength??0,u.anisotropy.angle=o.anisotropyRotation??0,o.anisotropyTexture&&(o.anisotropyTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${mm}/anisotropyTexture`,o.anisotropyTexture,(mm=>{mm.name=`${u.name} (Anisotropy Intensity)`,u.anisotropy.texture=mm})))),await Promise.all(f)}}X(jm),a(jm,!0,(mm=>new am(mm)));const Xm="KHR_materials_emissive_strength";class Gm{constructor(mm){this.name=Xm,this.order=170,this._loader=mm,this.enabled=this._loader.isExtensionUsed(Xm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>await this._loader.loadMaterialPropertiesAsync(mm,o,u).then((()=>{this._loadEmissiveProperties(f,B,u)}))))}_loadEmissiveProperties(mm,o,u){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);void 0!==o.emissiveStrength&&(u.emissiveIntensity=o.emissiveStrength)}}X(Xm),a(Xm,!0,(mm=>new Gm(mm)));const km="KHR_materials_sheen";class dm{constructor(mm){this.name=km,this.order=190,this._loader=mm,this.enabled=this._loader.isExtensionUsed(km)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(mm,o,u)),O.push(this._loadSheenPropertiesAsync(f,B,u)),await Promise.all(O).then((()=>{}))}))}_loadSheenPropertiesAsync(mm,o,u){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);const f=new Array;return u.sheen.isEnabled=!0,u.sheen.Yp=1,void 0!=o.sheenColorFactor?u.sheen.color=O.No.So(o.sheenColorFactor):u.sheen.color=O.No.Black(),o.sheenColorTexture&&f.push(this._loader.loadTextureInfoAsync(`${mm}/sheenColorTexture`,o.sheenColorTexture,(mm=>{mm.name=`${u.name} (Sheen Color)`,u.sheen.texture=mm}))),void 0!==o.sheenRoughnessFactor?u.sheen.roughness=o.sheenRoughnessFactor:u.sheen.roughness=0,o.sheenRoughnessTexture&&(o.sheenRoughnessTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${mm}/sheenRoughnessTexture`,o.sheenRoughnessTexture,(mm=>{mm.name=`${u.name} (Sheen Roughness)`,u.sheen.textureRoughness=mm})))),u.sheen.albedoScaling=!0,u.sheen.useRoughnessFromMainTexture=!1,Promise.all(f).then((()=>{}))}}X(km),a(km,!0,(mm=>new dm(mm)));var em=u(13190);const Lm="KHR_materials_specular";class Cm{constructor(mm){this.name=Lm,this.order=190,this._loader=mm,this.enabled=this._loader.isExtensionUsed(Lm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=new Array;if(O.push(this._loader.loadMaterialPropertiesAsync(mm,o,u)),O.push(this._loadSpecularPropertiesAsync(f,B,u)),B.extensions&&B.extensions.EXT_materials_specular_edge_color&&u instanceof Q.d){B.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(u.brdf.dielectricSpecularModel=em.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,u.brdf.conductorSpecularModel=em.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(O).then((()=>{}))}))}_loadSpecularPropertiesAsync(mm,o,u){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);const f=new Array;return void 0!==o.specularFactor&&(u.metallicF0Factor=o.specularFactor),void 0!==o.specularColorFactor&&(u.metallicReflectanceColor=O.No.So(o.specularColorFactor)),o.specularTexture&&(o.specularTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${mm}/specularTexture`,o.specularTexture,(mm=>{mm.name=`${u.name} (Specular)`,u.metallicReflectanceTexture=mm,u.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),o.specularColorTexture&&f.push(this._loader.loadTextureInfoAsync(`${mm}/specularColorTexture`,o.specularColorTexture,(mm=>{mm.name=`${u.name} (Specular Color)`,u.reflectanceTexture=mm}))),Promise.all(f).then((()=>{}))}}X(Lm),a(Lm,!0,(mm=>new Cm(mm)));const vm="KHR_materials_ior";class Vm{constructor(mm){this.name=vm,this.order=180,this._loader=mm,this.enabled=this._loader.isExtensionUsed(vm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(mm,o,u)),O.push(this._loadIorPropertiesAsync(f,B,u)),await Promise.all(O).then((()=>{}))}))}_loadIorPropertiesAsync(mm,o,u){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);return void 0!==o.ior?u.indexOfRefraction=o.ior:u.indexOfRefraction=Vm._DEFAULT_IOR,Promise.resolve()}}Vm._DEFAULT_IOR=1.5,X(vm),a(vm,!0,(mm=>new Vm(mm)));const nm="KHR_materials_variants";class Um{constructor(mm){this.name=nm,this._loader=mm,this.enabled=this._loader.isExtensionUsed(nm)}dispose(){this._loader=null}static GetAvailableVariants(mm){const o=this._GetExtensionMetadata(mm);return o?Object.keys(o.variants):[]}getAvailableVariants(mm){return Um.GetAvailableVariants(mm)}static SelectVariant(mm,o){const u=this._GetExtensionMetadata(mm);if(!u)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${nm} extension`);const f=mm=>{const o=u.variants[mm];if(o)for(const u of o)u.mesh.material=u.material};if(o instanceof Array)for(const B of o)f(B);else f(o);u.lastSelected=o}selectVariant(mm,o){Um.SelectVariant(mm,o)}static Reset(mm){const o=this._GetExtensionMetadata(mm);if(!o)throw new Error(`Cannot reset on a glTF mesh that does not have the ${nm} extension`);for(const u of o.original)u.mesh.material=u.material;o.lastSelected=null}reset(mm){Um.Reset(mm)}static GetLastSelectedVariant(mm){const o=this._GetExtensionMetadata(mm);if(!o)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${nm} extension`);return o.lastSelected}getLastSelectedVariant(mm){return Um.GetLastSelectedVariant(mm)}static _GetExtensionMetadata(mm){var o,u;return(null===mm||void 0===mm||null===(o=mm._internalMetadata)||void 0===o||null===(u=o.Af)||void 0===u?void 0:u[nm])||null}onLoading(){const mm=this._loader.Af.extensions;if(mm&&mm[this.name]){const o=mm[this.name];this._variants=o.variants}}onReady(){const mm=this._loader.rootBabylonMesh;if(mm){var o;const u=this._loader.parent.extensionOptions[nm];null!==u&&void 0!==u&&u.defaultVariant&&Um.SelectVariant(mm,u.defaultVariant),null===u||void 0===u||null===(o=u.onLoaded)||void 0===o||o.call(u,{get variants(){return Um.GetAvailableVariants(mm)},get selectedVariant(){const o=Um.GetLastSelectedVariant(mm);return o?Array.isArray(o)?o[0]:o:Um.GetAvailableVariants(mm)[0]},set selectedVariant(o){Um.SelectVariant(mm,o)}})}}_loadMeshPrimitiveAsync(mm,o,u,f,B,O){return C.LoadExtensionAsync(mm,B,this.name,(async(r,w)=>{const p=new Array;return p.push(this._loader._loadMeshPrimitiveAsync(mm,o,u,f,B,(o=>{if(O(o),o instanceof R.d){const u=C._GetDrawMode(mm,B.mode),f=this._loader.rootBabylonMesh,O=f?f._internalMetadata=f._internalMetadata||{}:{},K=O.Af=O.Af||{},z=K[nm]=K[nm]||{lastSelected:null,original:[],variants:{}};z.original.push({mesh:o,material:o.material});for(let mm=0;mm<w.mappings.length;++mm){const B=w.mappings[mm],O=e.Get(`${r}/mappings/${mm}/material`,this._loader.Af.materials,B.material);p.push(this._loader._loadMaterialAsync(`#/materials/${B.material}`,O,o,u,(mm=>{for(let u=0;u<B.variants.length;++u){const O=B.variants[u],r=e.Get(`/extensions/${nm}/variants/${O}`,this._variants,O);z.variants[r.name]=z.variants[r.name]||[],z.variants[r.name].push({mesh:o,material:mm}),o.onClonedObservable.add((mm=>{const u=mm;let B=null,O=u;do{if(O=O.parent,!O)return;B=Um._GetExtensionMetadata(O)}while(null===B);if(f&&B===Um._GetExtensionMetadata(f)){O._internalMetadata={};for(const mm in f._internalMetadata)O._internalMetadata[mm]=f._internalMetadata[mm];O._internalMetadata.Af=[];for(const mm in f._internalMetadata.Af)O._internalMetadata.Af[mm]=f._internalMetadata.Af[mm];O._internalMetadata.Af[nm]={lastSelected:null,original:[],variants:{}};for(const mm of B.original)O._internalMetadata.Af[nm].original.push({mesh:mm.mesh,material:mm.material});for(const mm in B.variants)if(Object.prototype.hasOwnProperty.call(B.variants,mm)){O._internalMetadata.Af[nm].variants[mm]=[];for(const o of B.variants[mm])O._internalMetadata.Af[nm].variants[mm].push({mesh:o.mesh,material:o.material})}B=O._internalMetadata.Af[nm]}for(const f of B.original)f.mesh===o&&(f.mesh=u);for(const f of B.variants[r.name])f.mesh===o&&(f.mesh=u)}))}})))}}}))),await Promise.all(p).then((mm=>{let[o]=mm;return o}))}))}}X(nm),a(nm,!0,(mm=>new Um(mm)));var hm=u(12796);class Zm{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:em.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(mm,o){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Zm._GetDefaultOptions(),...mm},this._scene=o,this._scene._transmissionHelper=this,this.onErrorObservable=new z.d,this._scene.Jf.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(mm){if(!Object.keys(mm).filter((o=>this._options[o]!==mm[o])).length)return;const o={...this._options,...mm},u=this._options;this._options=o,o.renderSize===u.renderSize&&o.renderTargetTextureType===u.renderTargetTextureType&&o.generateMipmaps===u.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=o.samples,this._opaqueRenderTarget.lodGenerationScale=o.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=o.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(mm){return!!mm&&!!(mm instanceof Q.d&&mm.subSurface.isRefractionEnabled)}_addMesh(mm){this._materialObservers[mm.uniqueId]=mm.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),r.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(mm.material)?(mm.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(mm)&&this._transparentMeshesCache.push(mm)):-1===this._opaqueMeshesCache.indexOf(mm)&&this._opaqueMeshesCache.push(mm)}))}_removeMesh(mm){mm.onMaterialChangedObservable.remove(this._materialObservers[mm.uniqueId]),delete this._materialObservers[mm.uniqueId];let o=this._transparentMeshesCache.indexOf(mm);-1!==o&&this._transparentMeshesCache.splice(o,1),o=this._opaqueMeshesCache.indexOf(mm),-1!==o&&this._opaqueMeshesCache.splice(o,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(mm){const o=this._transparentMeshesCache.indexOf(mm),u=this._opaqueMeshesCache.indexOf(mm);this._shouldRenderAsTransmission(mm.material)?(mm.material instanceof Q.d&&(mm.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==u?(this._opaqueMeshesCache.splice(u,1),this._transparentMeshesCache.push(mm)):-1===o&&this._transparentMeshesCache.push(mm)):-1!==o?(this._transparentMeshesCache.splice(o,1),this._opaqueMeshesCache.push(mm)):-1===u&&this._opaqueMeshesCache.push(mm)}_isRenderTargetValid(){var mm;return null!==(null===(mm=this._opaqueRenderTarget)||void 0===mm?void 0:mm.getInternalTexture())}_setupRenderTargets(){var mm;let o;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new hm.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(mm=this._options.clearColor)||void 0===mm?void 0:mm.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((mm=>{o=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?mm.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(mm.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=o}));for(const u of this._transparentMeshesCache)this._shouldRenderAsTransmission(u.material)&&(u.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Tm="KHR_materials_transmission";class Dm{constructor(mm){this.name=Tm,this.order=175,this._loader=mm,this.enabled=this._loader.isExtensionUsed(Tm),this.enabled&&(mm.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(mm,o,u)),O.push(this._loadTransparentPropertiesAsync(f,o,u,B)),await Promise.all(O).then((()=>{}))}))}_loadTransparentPropertiesAsync(mm,o,u,f){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);const B=u;if(B.subSurface.isRefractionEnabled=!0,B.subSurface.volumeIndexOfRefraction=1,B.subSurface.useAlbedoToTintRefraction=!0,void 0===f.transmissionFactor)return B.subSurface.refractionIntensity=0,B.subSurface.isRefractionEnabled=!1,Promise.resolve();{var O;B.subSurface.refractionIntensity=f.transmissionFactor;const mm=B.Pm();if(B.subSurface.refractionIntensity&&!mm._transmissionHelper)new Zm({},B.Pm());else if(B.subSurface.refractionIntensity&&(null===(O=mm._transmissionHelper)||void 0===O||!O._isRenderTargetValid())){var r;null===(r=mm._transmissionHelper)||void 0===r||r._setupRenderTargets()}}return B.subSurface.minimumThickness=0,B.subSurface.maximumThickness=0,f.transmissionTexture?(f.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${mm}/transmissionTexture`,f.transmissionTexture,void 0).then((mm=>{mm.name=`${u.name} (Transmission)`,B.subSurface.refractionIntensityTexture=mm,B.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}X(Tm),a(Tm,!0,(mm=>new Dm(mm)));const im="KHR_materials_diffuse_transmission";class mu{constructor(mm){this.name=im,this.order=174,this._loader=mm,this.enabled=this._loader.isExtensionUsed(im),this.enabled&&(mm.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(mm,o,u)),O.push(this._loadTranslucentPropertiesAsync(f,o,u,B)),await Promise.all(O).then((()=>{}))}))}_loadTranslucentPropertiesAsync(mm,o,u,f){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);const B=u;if(B.subSurface.isTranslucencyEnabled=!0,B.subSurface.volumeIndexOfRefraction=1,B.subSurface.minimumThickness=0,B.subSurface.maximumThickness=0,B.subSurface.useAlbedoToTintTranslucency=!1,void 0===f.diffuseTransmissionFactor)return B.subSurface.translucencyIntensity=0,B.subSurface.isTranslucencyEnabled=!1,Promise.resolve();B.subSurface.translucencyIntensity=f.diffuseTransmissionFactor;const r=new Array;return B.subSurface.useGltfStyleTextures=!0,f.diffuseTransmissionTexture&&(f.diffuseTransmissionTexture.nonColorData=!0,r.push(this._loader.loadTextureInfoAsync(`${mm}/diffuseTransmissionTexture`,f.diffuseTransmissionTexture).then((mm=>{mm.name=`${u.name} (Diffuse Transmission)`,B.subSurface.translucencyIntensityTexture=mm})))),void 0!==f.diffuseTransmissionColorFactor?B.subSurface.translucencyColor=O.No.So(f.diffuseTransmissionColorFactor):B.subSurface.translucencyColor=O.No.White(),f.diffuseTransmissionColorTexture&&r.push(this._loader.loadTextureInfoAsync(`${mm}/diffuseTransmissionColorTexture`,f.diffuseTransmissionColorTexture).then((mm=>{mm.name=`${u.name} (Diffuse Transmission Color)`,B.subSurface.translucencyColorTexture=mm}))),Promise.all(r).then((()=>{}))}}X(im),a(im,!0,(mm=>new mu(mm)));const oo="KHR_materials_volume";class uo{constructor(mm){this.name=oo,this.order=173,this._loader=mm,this.enabled=this._loader.isExtensionUsed(oo),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(mm,o,u)),O.push(this._loadVolumePropertiesAsync(f,o,u,B)),await Promise.all(O).then((()=>{}))}))}_loadVolumePropertiesAsync(mm,o,u,f){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);if(!u.subSurface.isRefractionEnabled&&!u.subSurface.isTranslucencyEnabled||!f.thicknessFactor)return Promise.resolve();u.subSurface.volumeIndexOfRefraction=u.indexOfRefraction;const B=void 0!==f.attenuationDistance?f.attenuationDistance:Number.MAX_VALUE;return u.subSurface.tintColorAtDistance=B,void 0!==f.attenuationColor&&3==f.attenuationColor.length&&u.subSurface.tintColor.Op(f.attenuationColor[0],f.attenuationColor[1],f.attenuationColor[2]),u.subSurface.minimumThickness=0,u.subSurface.maximumThickness=f.thicknessFactor,u.subSurface.useThicknessAsDepth=!0,f.thicknessTexture?(f.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${mm}/thicknessTexture`,f.thicknessTexture).then((mm=>{mm.name=`${u.name} (Thickness)`,u.subSurface.thicknessTexture=mm,u.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}X(oo),a(oo,!0,(mm=>new uo(mm)));const fo="KHR_materials_dispersion";class Bo{constructor(mm){this.name=fo,this.order=174,this._loader=mm,this.enabled=this._loader.isExtensionUsed(fo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(mm,o,u)),O.push(this._loadDispersionPropertiesAsync(f,o,u,B)),await Promise.all(O).then((()=>{}))}))}_loadDispersionPropertiesAsync(mm,o,u,f){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);return u.subSurface.isRefractionEnabled&&f.dispersion?(u.subSurface.isDispersionEnabled=!0,u.subSurface.dispersion=f.dispersion,Promise.resolve()):Promise.resolve()}}X(fo),a(fo,!0,(mm=>new Bo(mm)));const Oo="EXT_materials_diffuse_roughness";class ro{constructor(mm){this.name=Oo,this.order=190,this._loader=mm,this.enabled=this._loader.isExtensionUsed(Oo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=new Array;return O.push(this._loader.loadMaterialPropertiesAsync(mm,o,u)),O.push(this._loadDiffuseRoughnessPropertiesAsync(f,B,u)),await Promise.all(O).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(mm,o,u){if(!(u instanceof Q.d))throw new Error(`${mm}: Material type not supported`);const f=new Array;return u.brdf.baseDiffuseModel=em.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=o.diffuseRoughnessFactor?u.baseDiffuseRoughness=o.diffuseRoughnessFactor:u.baseDiffuseRoughness=0,o.diffuseRoughnessTexture&&f.push(this._loader.loadTextureInfoAsync(`${mm}/diffuseRoughnessTexture`,o.diffuseRoughnessTexture,(mm=>{mm.name=`${u.name} (Diffuse Roughness)`,u.baseDiffuseRoughnessTexture=mm}))),Promise.all(f).then((()=>{}))}}X(Oo),a(Oo,!0,(mm=>new ro(mm)));const wo="KHR_mesh_quantization";class po{constructor(mm){this.name=wo,this.enabled=mm.isExtensionUsed(wo)}dispose(){}}X(wo),a(wo,!0,(mm=>new po(mm)));const Ko="KHR_texture_basisu";class zo{constructor(mm){this.name=Ko,this._loader=mm,this.enabled=mm.isExtensionUsed(Ko)}dispose(){this._loader=null}_loadTextureAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>{const O=void 0==o.sampler?C.DefaultSampler:e.Get(`${mm}/sampler`,this._loader.Af.samplers,o.sampler),r=e.Get(`${f}/source`,this._loader.Af.images,B.source);return await this._loader._createTextureAsync(mm,O,r,(mm=>{u(mm)}),o._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!o._textureInfo.nonColorData)}))}}X(Ko),a(Ko,!0,(mm=>new zo(mm)));const Yo="KHR_texture_transform";class qo{constructor(mm){this.name=Yo,this._loader=mm,this.enabled=this._loader.isExtensionUsed(Yo)}dispose(){this._loader=null}loadTextureInfoAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(f,B)=>await this._loader.loadTextureInfoAsync(mm,o,(mm=>{if(!(mm instanceof b.b))throw new Error(`${f}: Texture type not supported`);B.offset&&(mm.uOffset=B.offset[0],mm.vOffset=B.offset[1]),mm.uRotationCenter=0,mm.vRotationCenter=0,B.rotation&&(mm.wAng=-B.rotation),B.scale&&(mm.uScale=B.scale[0],mm.vScale=B.scale[1]),void 0!=B.texCoord&&(mm.coordinatesIndex=B.texCoord),u(mm)}))))}}X(Yo),a(Yo,!0,(mm=>new qo(mm)));const xo="KHR_xmp_json_ld";class Ho{constructor(mm){this.name=xo,this.order=100,this._loader=mm,this.enabled=this._loader.isExtensionUsed(xo)}dispose(){this._loader=null}onLoading(){var mm,o,u;if(null===this._loader.rootBabylonMesh)return;const f=null===(mm=this._loader.Af.extensions)||void 0===mm?void 0:mm.KHR_xmp_json_ld,B=null===(o=this._loader.Af.asset)||void 0===o||null===(u=o.extensions)||void 0===u?void 0:u.KHR_xmp_json_ld;if(f&&B){const mm=+B.packet;f.packets&&mm<f.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=f.packets[mm])}}}function Eo(mm,o,u,f){return O.No.So(o,u).scale(f)}function Mo(mm,o,u,f){return o[u]*f}function lo(mm,o,u,f){return-o[u]*f}function to(mm,o,u,f){return o[u+1]*f}function Qo(mm,o,u,f){return o[u]*f*2}function bo(mm){return{scale:[new No(q.d.ANIMATIONTYPE_FLOAT,`${mm}.uScale`,Mo,(()=>2)),new No(q.d.ANIMATIONTYPE_FLOAT,`${mm}.vScale`,to,(()=>2))],offset:[new No(q.d.ANIMATIONTYPE_FLOAT,`${mm}.uOffset`,Mo,(()=>2)),new No(q.d.ANIMATIONTYPE_FLOAT,`${mm}.vOffset`,to,(()=>2))],rotation:[new No(q.d.ANIMATIONTYPE_FLOAT,`${mm}.wAng`,lo,(()=>1))]}}X(xo),a(xo,!0,(mm=>new Ho(mm)));class Jo extends v.AnimationPropertyInfo{buildAnimations(mm,o,u,f){return[{babylonAnimatable:mm._babylonCamera,babylonAnimation:this._buildAnimation(o,u,f)}]}}class No extends v.AnimationPropertyInfo{buildAnimations(mm,o,u,f){const B=[];for(const O in mm._data)B.push({babylonAnimatable:mm._data[O].babylonMaterial,babylonAnimation:this._buildAnimation(o,u,f)});return B}}class So extends v.AnimationPropertyInfo{buildAnimations(mm,o,u,f){return[{babylonAnimatable:mm._babylonLight,babylonAnimation:this._buildAnimation(o,u,f)}]}}(0,G.k)("/cameras/{}/orthographic/xmag",[new Jo(q.d.ANIMATIONTYPE_FLOAT,"orthoLeft",lo,(()=>1)),new Jo(q.d.ANIMATIONTYPE_FLOAT,"orthoRight",to,(()=>1))]),(0,G.k)("/cameras/{}/orthographic/ymag",[new Jo(q.d.ANIMATIONTYPE_FLOAT,"orthoBottom",lo,(()=>1)),new Jo(q.d.ANIMATIONTYPE_FLOAT,"orthoTop",to,(()=>1))]),(0,G.k)("/cameras/{}/orthographic/zfar",[new Jo(q.d.ANIMATIONTYPE_FLOAT,"maxZ",Mo,(()=>1))]),(0,G.k)("/cameras/{}/orthographic/znear",[new Jo(q.d.ANIMATIONTYPE_FLOAT,"hf",Mo,(()=>1))]),(0,G.k)("/cameras/{}/perspective/yfov",[new Jo(q.d.ANIMATIONTYPE_FLOAT,"fov",Mo,(()=>1))]),(0,G.k)("/cameras/{}/perspective/zfar",[new Jo(q.d.ANIMATIONTYPE_FLOAT,"maxZ",Mo,(()=>1))]),(0,G.k)("/cameras/{}/perspective/znear",[new Jo(q.d.ANIMATIONTYPE_FLOAT,"hf",Mo,(()=>1))]),(0,G.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new No(q.d.ANIMATIONTYPE_COLOR3,"albedoColor",Eo,(()=>4)),new No(q.d.ANIMATIONTYPE_FLOAT,"alpha",(function(mm,o,u,f){return o[u+3]*f}),(()=>4))]),(0,G.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new No(q.d.ANIMATIONTYPE_FLOAT,"metallic",Mo,(()=>1))]),(0,G.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new No(q.d.ANIMATIONTYPE_FLOAT,"roughness",Mo,(()=>1))]);const Po=bo("albedoTexture");(0,G.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Po.scale),(0,G.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Po.offset),(0,G.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Po.rotation);const Ro=bo("metallicTexture");(0,G.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Ro.scale),(0,G.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Ro.offset),(0,G.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Ro.rotation),(0,G.k)("/materials/{}/emissiveFactor",[new No(q.d.ANIMATIONTYPE_COLOR3,"emissiveColor",Eo,(()=>3))]);const go=bo("bumpTexture");(0,G.k)("/materials/{}/normalTexture/scale",[new No(q.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Mo,(()=>1))]),(0,G.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",go.scale),(0,G.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",go.offset),(0,G.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",go.rotation),(0,G.k)("/materials/{}/occlusionTexture/strength",[new No(q.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Mo,(()=>1))]);const Wo=bo("ambientTexture");(0,G.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Wo.scale),(0,G.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Wo.offset),(0,G.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Wo.rotation);const Fo=bo("emissiveTexture");(0,G.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Fo.scale),(0,G.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Fo.offset),(0,G.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Fo.rotation),(0,G.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new No(q.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Mo,(()=>1))]),(0,G.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new No(q.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Mo,(()=>1))]);const co=bo("anisotropy.texture");(0,G.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",co.scale),(0,G.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",co.offset),(0,G.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",co.rotation),(0,G.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new No(q.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Mo,(()=>1))]),(0,G.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new No(q.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Mo,(()=>1))]);const Ao=bo("clearCoat.texture");(0,G.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Ao.scale),(0,G.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Ao.offset),(0,G.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Ao.rotation);const yo=bo("clearCoat.bumpTexture");(0,G.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new No(q.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Mo,(()=>1))]),(0,G.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",yo.scale),(0,G.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",yo.offset),(0,G.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",yo.rotation);const Io=bo("clearCoat.textureRoughness");(0,G.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Io.scale),(0,G.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Io.offset),(0,G.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Io.rotation),(0,G.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new No(q.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Mo,(()=>1))]),(0,G.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new No(q.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Mo,(()=>1))]),(0,G.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new No(q.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Mo,(()=>1))]),(0,G.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new No(q.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Mo,(()=>1))]),(0,G.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new No(q.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Mo,(()=>1))]),(0,G.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new No(q.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Mo,(()=>1))]),(0,G.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new No(q.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Mo,(()=>1))]);const so=bo("iridescence.texture");(0,G.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",so.scale),(0,G.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",so.offset),(0,G.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",so.rotation);const jo=bo("iridescence.thicknessTexture");(0,G.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",jo.scale),(0,G.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",jo.offset),(0,G.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",jo.rotation),(0,G.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new No(q.d.ANIMATIONTYPE_COLOR3,"sheen.color",Eo,(()=>3))]),(0,G.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new No(q.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",Mo,(()=>1))]);const ao=bo("sheen.texture");(0,G.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",ao.scale),(0,G.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",ao.offset),(0,G.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",ao.rotation);const Xo=bo("sheen.textureRoughness");(0,G.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Xo.scale),(0,G.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Xo.offset),(0,G.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Xo.rotation),(0,G.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new No(q.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Mo,(()=>1))]),(0,G.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new No(q.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Eo,(()=>3))]);const Go=bo("metallicReflectanceTexture");(0,G.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Go.scale),(0,G.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Go.offset),(0,G.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Go.rotation);const ko=bo("reflectanceTexture");(0,G.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",ko.scale),(0,G.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",ko.offset),(0,G.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",ko.rotation),(0,G.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new No(q.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Mo,(()=>1))]);const eo=bo("subSurface.refractionIntensityTexture");(0,G.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",eo.scale),(0,G.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",eo.offset),(0,G.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",eo.rotation),(0,G.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new No(q.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Eo,(()=>3))]),(0,G.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new No(q.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Mo,(()=>1))]),(0,G.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new No(q.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Mo,(()=>1))]);const Lo=bo("subSurface.thicknessTexture");(0,G.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Lo.scale),(0,G.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Lo.offset),(0,G.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Lo.rotation),(0,G.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new No(q.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Mo,(()=>1))]);const Co=bo("subSurface.translucencyIntensityTexture");(0,G.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Co.scale),(0,G.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Co.offset),(0,G.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Co.rotation),(0,G.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new No(q.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Eo,(()=>3))]);const vo=bo("subSurface.translucencyColorTexture");(0,G.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",vo.scale),(0,G.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",vo.offset),(0,G.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",vo.rotation),(0,G.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new So(q.d.ANIMATIONTYPE_COLOR3,"diffuse",Eo,(()=>3))]),(0,G.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new So(q.d.ANIMATIONTYPE_FLOAT,"intensity",Mo,(()=>1))]),(0,G.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new So(q.d.ANIMATIONTYPE_FLOAT,"range",Mo,(()=>1))]),(0,G.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new So(q.d.ANIMATIONTYPE_FLOAT,"innerAngle",Qo,(()=>1))]),(0,G.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new So(q.d.ANIMATIONTYPE_FLOAT,"angle",Qo,(()=>1))]),(0,G.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new So(q.d.ANIMATIONTYPE_COLOR3,"diffuse",Eo,(()=>3))]),(0,G.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new So(q.d.ANIMATIONTYPE_FLOAT,"intensity",Mo,(()=>1))]);const Vo="KHR_animation_pointer";class no{constructor(mm){this.name=Vo,this._loader=mm,this._pathToObjectConverter=(0,G.h)(this._loader.Af)}get enabled(){return this._loader.isExtensionUsed(Vo)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(mm,o,u,f,B){var O;const r=null===(O=f.target.extensions)||void 0===O?void 0:O.KHR_animation_pointer;if(!r||!this._pathToObjectConverter)return null;"pointer"!==f.target.path&&E.e.Warn(`${mm}/target/path: Value (${f.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=f.target.node&&E.e.Warn(`${mm}/target/node: Value (${f.target.node}) must not be present when using the ${this.name} extension`);const w=`${mm}/extensions/${this.name}`,p=r.pointer;if(!p)throw new Error(`${w}: Pointer is missing`);try{const O=this._pathToObjectConverter.convert(p);if(!O.info.interpolation)throw new Error(`${w}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(mm,o,u,f,{object:O.object,info:O.info.interpolation},B)}catch(K){return E.e.Warn(`${w}/pointer: Invalid pointer (${p}) skipped`),null}}}X(Vo),a(Vo,!0,(mm=>new no(mm)));class Uo{constructor(mm,o,u){this.frame=mm,this.action=o,this.onlyOnce=u,this.isDone=!1}_clone(){return new Uo(this.frame,this.action,this.onlyOnce)}}var ho=u(12589),Zo=u(12638),To=u(12634);class Do{get loop(){return this._loop}set loop(mm){mm!==this._loop&&(this._loop=mm,this.updateOptions({loop:mm}))}get currentTime(){var mm;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(mm=Zo.c.audioEngine)&&void 0!==mm&&mm.audioContext&&(this.isPlaying||this.isPaused)){const mm=this.isPaused?0:Zo.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+mm}return 0}get spatialSound(){return this._spatialSound}set spatialSound(mm){if(mm==this._spatialSound)return;const o=this.isPlaying;this.pause(),mm?(this._spatialSound=mm,this._updateSpatialParameters()):this._disableSpatialSound(),o&&this.play()}constructor(mm,o,u){var f;let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new z.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=B.lo.Zero(),this._localDirection=new B.lo(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=mm,u=u||H.d.LastCreatedScene)if(this._scene=u,Do._SceneComponentInitialization(u),this._readyToPlayCallback=O,this._customAttenuationFunction=(mm,o,u,f,B)=>o<u?mm*(1-o/u):0,w&&(this.autoplay=w.autoplay||!1,this._loop=w.loop||!1,void 0!==w.volume&&(this._volume=w.volume),this._spatialSound=w.spatialSound??!1,this.maxDistance=w.maxDistance??100,this.useCustomAttenuation=w.useCustomAttenuation??!1,this.rolloffFactor=w.rolloffFactor||1,this.refDistance=w.refDistance||1,this.distanceModel=w.distanceModel||"linear",this._playbackRate=w.playbackRate||1,this._streaming=w.streaming??!1,this._length=w.length,this._offset=w.offset),null!==(f=Zo.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&Zo.c.audioEngine.audioContext){this._soundGain=Zo.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let mm=!0;if(o)try{"string"===typeof o?(this._urlType="String",this._url=o):o instanceof ArrayBuffer?this._urlType="ArrayBuffer":o instanceof HTMLMediaElement?this._urlType="MediaElement":o instanceof MediaStream?this._urlType="MediaStream":o instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(o)&&(this._urlType="Array");let u=[],f=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Zo.c.audioEngine.audioContext.createMediaElementSource(o),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Zo.c.audioEngine.audioContext.createMediaStreamSource(o),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":o.byteLength>0&&(f=!0,this._soundLoaded(o));break;case"AudioBuffer":this._audioBufferLoaded(o);break;case"String":u.push(o);case"Array":0===u.length&&(u=o);for(let mm=0;mm<u.length;mm++){const o=u[mm];if(f=w&&w.skipCodecCheck||-1!==o.indexOf(".mp3",o.length-4)&&Zo.c.audioEngine.isMP3supported||-1!==o.indexOf(".ogg",o.length-4)&&Zo.c.audioEngine.isOGGsupported||-1!==o.indexOf(".wav",o.length-4)||-1!==o.indexOf(".m4a",o.length-4)||-1!==o.indexOf(".mp4",o.length-4)||-1!==o.indexOf("blob:"),f){this._streaming?(this._htmlAudioElement=new Audio(o),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,r.Tools.SetCorsBehavior(o,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(o,(mm=>{this._soundLoaded(mm)}),void 0,!0,!0,(mm=>{mm&&E.e.Error("XHR "+mm.status+" error on: "+o+"."),E.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:mm=!1}mm?f||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):E.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(p){E.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Zo.c.audioEngine&&!Zo.c.audioEngine.WarnedWebAudioUnsupported&&(E.e.Error("Web Audio is not supported by your browser."),Zo.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var mm;null!==(mm=Zo.c.audioEngine)&&void 0!==mm&&mm.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(mm){var o;null!==(o=Zo.c.audioEngine)&&void 0!==o&&o.audioContext&&(this._audioBuffer=mm,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(mm){var o;null!==(o=Zo.c.audioEngine)&&void 0!==o&&o.audioContext&&Zo.c.audioEngine.audioContext.decodeAudioData(mm,(mm=>{this._audioBufferLoaded(mm)}),(mm=>{E.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+mm)}))}setAudioBuffer(mm){var o;null!==(o=Zo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&(this._audioBuffer=mm,this._isReadyToPlay=!0)}updateOptions(mm){mm&&(this.loop=mm.loop??this.loop,this.maxDistance=mm.maxDistance??this.maxDistance,this.useCustomAttenuation=mm.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=mm.rolloffFactor??this.rolloffFactor,this.refDistance=mm.refDistance??this.refDistance,this.distanceModel=mm.distanceModel??this.distanceModel,this._playbackRate=mm.playbackRate??this._playbackRate,this._length=mm.length??void 0,this.spatialSound=mm.spatialSound??this._spatialSound,this._setOffset(mm.offset??void 0),this.setVolume(mm.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var mm;null!==(mm=Zo.c.audioEngine)&&void 0!==mm&&mm.canUseWebAudio&&Zo.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Zo.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var mm;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(mm=this._soundPanner)||void 0===mm||mm.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var mm;null!==(mm=Zo.c.audioEngine)&&void 0!==mm&&mm.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(mm){var o;null!==(o=Zo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(mm),this._isOutputConnected=!0)}setDirectionalCone(mm,o,u){o<mm?E.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=mm,this._coneOuterAngle=o,this._coneOuterGain=u,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(mm){if(mm!=this._coneInnerAngle){var o;if(this._coneOuterAngle<mm)return void E.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=mm,null!==(o=Zo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(mm){if(mm!=this._coneOuterAngle){var o;if(mm<this._coneInnerAngle)return void E.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=mm,null!==(o=Zo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(mm){var o;mm.equals(this._position)||(this._position.p(mm),null!==(o=Zo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(mm){var o;this._localDirection=mm,null!==(o=Zo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const mm=this._connectedTransformNode.getWorldMatrix(),o=B.lo.TransformNormal(this._localDirection,mm);o.normalize(),this._soundPanner.orientationX.value=o.x,this._soundPanner.orientationY.value=o.y,this._soundPanner.orientationZ.value=o.z}updateDistanceFromListener(){var mm;if(null!==(mm=Zo.c.audioEngine)&&void 0!==mm&&mm.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const mm=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Qo(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,mm,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(mm){this._customAttenuationFunction=mm}play(mm,o,u){var f;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(f=Zo.c.audioEngine)&&void 0!==f&&f.audioContext)try{var B,O;this._clearTimeoutsAndObservers();let f=mm?(null===(B=Zo.c.audioEngine)||void 0===B?void 0:B.audioContext.currentTime)+mm:null===(O=Zo.c.audioEngine)||void 0===O?void 0:O.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Zo.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const mm=()=>{var u;if(null!==(u=Zo.c.audioEngine)&&void 0!==u&&u.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=o??0;const u=this._htmlAudioElement.play();void 0!==u&&u.catch((()=>{var o,u;(null===(o=Zo.c.audioEngine)||void 0===o||o.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(u=Zo.c.audioEngine)||void 0===u?void 0:u.onAudioUnlockedObservable.addOnce((()=>{mm()})))}))}else{var f;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(f=Zo.c.audioEngine)||void 0===f?void 0:f.onAudioUnlockedObservable.addOnce((()=>{mm()}))}};mm()}}else{var r;const B=()=>{var B;if(null!==(B=Zo.c.audioEngine)&&void 0!==B&&B.audioContext){var O;if(u=u||this._length,void 0!==o&&this._setOffset(o),this._soundSource){const mm=this._soundSource;mm.onended=()=>{mm.disconnect()}}if(this._soundSource=null===(O=Zo.c.audioEngine)||void 0===O?void 0:O.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var r;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==o&&(this._soundSource.loopStart=o),void 0!==u&&(this._soundSource.loopEnd=(0|o)+u),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},f=mm?(null===(r=Zo.c.audioEngine)||void 0===r?void 0:r.audioContext.currentTime)+mm:Zo.c.audioEngine.audioContext.currentTime;const B=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(f,B,this.loop?void 0:u)}}};"suspended"===(null===(r=Zo.c.audioEngine)||void 0===r?void 0:r.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var mm;"suspended"===(null===(mm=Zo.c.audioEngine)||void 0===mm?void 0:mm.audioContext.state)?(Zo.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Zo.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{B()})))):B()}),500):B()}this._startTime=f,this.isPlaying=!0,this.isPaused=!1}catch(w){E.e.Error("Error while trying to play audio: "+this.name+", "+w.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(mm){var o;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var u;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(u=this._streamingSource)||void 0===u||u.disconnect();this.isPlaying=!1}else if(null!==(o=Zo.c.audioEngine)&&void 0!==o&&o.audioContext&&this._soundSource){const o=mm?Zo.c.audioEngine.audioContext.currentTime+mm:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(o)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var mm;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var o;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(o=this._streamingSource)||void 0===o||o.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(mm=Zo.c.audioEngine)&&void 0!==mm&&mm.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Zo.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(mm,o){var u;null!==(u=Zo.c.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._soundGain&&(o&&Zo.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Zo.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Zo.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(mm,Zo.c.audioEngine.audioContext.currentTime+o)):this._soundGain.gain.value=mm),this._volume=mm}setPlaybackRate(mm){this._playbackRate=mm,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(mm){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=mm,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=mm=>this._onRegisterAfterWorldMatrixUpdate(mm),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(mm){var o;if(mm.getBoundingInfo){const o=mm.getBoundingInfo();this.setPosition(o.boundingSphere.centerWorld)}else this.setPosition(mm.absolutePosition);null!==(o=Zo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const mm=()=>{(0,To.g)((()=>this._isReadyToPlay),(()=>{u._audioBuffer=this.getAudioBuffer(),u._isReadyToPlay=!0,u.autoplay&&u.play(0,this._offset,this._length)}),void 0,300)},o={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},u=new Do(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,o);return this.useCustomAttenuation&&u.setAttenuationFunction(this._customAttenuationFunction),u.setPosition(this._position),u.setPlaybackRate(this._playbackRate),mm(),u}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const mm={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(mm.connectedMeshId=this._connectedTransformNode.id),mm.position=this._position.df(),mm.refDistance=this.refDistance,mm.distanceModel=this.distanceModel,mm.isDirectional=this._isDirectional,mm.localDirectionToMesh=this._localDirection.df(),mm.coneInnerAngle=this._coneInnerAngle,mm.coneOuterAngle=this._coneOuterAngle,mm.coneOuterGain=this._coneOuterGain),mm}static Parse(mm,o,u,f){const O=mm.name;let r;r=mm.url?u+mm.url:u+O;const w={autoplay:mm.autoplay,loop:mm.loop,volume:mm.volume,spatialSound:mm.spatialSound,maxDistance:mm.maxDistance,rolloffFactor:mm.rolloffFactor,refDistance:mm.refDistance,distanceModel:mm.distanceModel,playbackRate:mm.playbackRate};let p;if(f){const mm=()=>{(0,To.g)((()=>f._isReadyToPlay),(()=>{p._audioBuffer=f.getAudioBuffer(),p._isReadyToPlay=!0,p.autoplay&&p.play(0,p._offset,p._length)}),void 0,300)};p=new Do(O,new ArrayBuffer(0),o,null,w),mm()}else p=new Do(O,r,o,(()=>{o.removePendingData(p)}),w),o.addPendingData(p);if(mm.position){const o=B.lo.So(mm.position);p.setPosition(o)}if(mm.isDirectional&&(p.setDirectionalCone(mm.coneInnerAngle||360,mm.coneOuterAngle||360,mm.coneOuterGain||0),mm.localDirectionToMesh)){const o=B.lo.So(mm.localDirectionToMesh);p.setLocalDirectionToMesh(o)}if(mm.connectedMeshId){const u=o.getMeshById(mm.connectedMeshId);u&&p.attachToMesh(u)}return mm.metadata&&(p.metadata=mm.metadata),p}_setOffset(mm){this._offset!==mm&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=mm)}_clearTimeoutsAndObservers(){var mm;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(mm=Zo.c.audioEngine)||void 0===mm||mm.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Do._SceneComponentInitialization=mm=>{throw(0,ho.d)("AudioSceneComponent")},(0,Nm.c)("BABYLON.Sound",Do);class io{constructor(mm,o,u){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],o.length!==u.length)throw new Error("Sounds length does not equal weights length");this.loop=mm,this._weights=u;let f=0;for(const O of u)f+=O;const B=f>0?1/f:0;for(let O=0;O<this._weights.length;O++)this._weights[O]*=B;this._sounds=o;for(const O of this._sounds)O.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(mm){if(mm!==this._coneInnerAngle){if(this._coneOuterAngle<mm)return void E.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=mm;for(const o of this._sounds)o.directionalConeInnerAngle=mm}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(mm){if(mm!==this._coneOuterAngle){if(mm<this._coneInnerAngle)return void E.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=mm;for(const o of this._sounds)o.directionalConeOuterAngle=mm}}get volume(){return this._volume}set volume(mm){if(mm!==this._volume)for(const o of this._sounds)o.setVolume(mm)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(mm){if(!this.isPaused){this.stop();const mm=Math.random();let o=0;for(let u=0;u<this._weights.length;u++)if(o+=this._weights[u],mm<=o){this._currentIndex=u;break}}const o=this._sounds[this._currentIndex??0];o.isReady()?o.play(0,this.isPaused?void 0:mm):o.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class mf{constructor(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(mm=mm||H.d.LastCreatedScene)&&(this._scene=mm,this.soundCollection=[],this._options=o,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var mm;null!==(mm=Zo.c.audioEngine)&&void 0!==mm&&mm.canUseWebAudio&&Zo.c.audioEngine.audioContext&&(this._outputAudioNode=Zo.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Zo.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Zo.c.audioEngine&&Zo.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(mm){var o;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(o=Zo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._outputAudioNode&&mm.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==mm.soundTrackId&&(-1===mm.soundTrackId?this._scene.mainSoundTrack.removeSound(mm):this._scene.soundTracks&&this._scene.soundTracks[mm.soundTrackId].removeSound(mm)),this.soundCollection.push(mm),mm.soundTrackId=this.id}removeSound(mm){const o=this.soundCollection.indexOf(mm);-1!==o&&this.soundCollection.splice(o,1)}setVolume(mm){var o;null!==(o=Zo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=mm)}switchPanningModelToHRTF(){var mm;if(null!==(mm=Zo.c.audioEngine)&&void 0!==mm&&mm.canUseWebAudio)for(let o=0;o<this.soundCollection.length;o++)this.soundCollection[o].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var mm;if(null!==(mm=Zo.c.audioEngine)&&void 0!==mm&&mm.canUseWebAudio)for(let o=0;o<this.soundCollection.length;o++)this.soundCollection[o].switchPanningModelToEqualPower()}connectToAnalyser(mm){var o;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=mm,null!==(o=Zo.c.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Zo.c.audioEngine.masterGain))}}var ou=u(13002),uu=u(12965),fu=u(12562);Zo.c.AudioEngineFactory=(mm,o,u)=>new Bu(mm,o,u);class Bu{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new z.d,this.onAudioLockedObservable=new z.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,fu.j)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const f=document.createElement("audio");this._hostElement=mm,this._audioContext=o,this._audioDestination=u;try{f&&f.canPlayType&&(f.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||f.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(B){}try{f&&f.canPlayType&&f.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(B){}}lock(){this._triggerSuspendedState()}unlock(){var mm,o;if("running"===(null===(mm=this._audioContext)||void 0===mm?void 0:mm.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(o=this._audioContext)||void 0===o||o.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{E.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var mm;null===(mm=this._audioContext)||void 0===mm||mm.addEventListener("statechange",(()=>{var mm;this.unlocked&&"running"!==(null===(mm=this._audioContext)||void 0===mm?void 0:mm.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var mm;return null!==(mm=this._audioContext)&&void 0!==mm&&mm.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(mm){this.canUseWebAudio=!1,E.e.Error("Web Audio: "+mm.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(mm){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const mm=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",o=document.createElement("style");o.appendChild(document.createTextNode(mm)),document.getElementsByTagName("head")[0].appendChild(o),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var mm;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(mm=this._audioContext)||void 0===mm||mm.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(mm){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=mm)}connectToAnalyser(mm){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=mm,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Ou=u(12581);(0,u(13933).f)(ou.e.NAME_AUDIO,((mm,o,u,f)=>{let B,O=[];if(u.Nx=u.Nx||[],void 0!==mm.Nx&&null!==mm.Nx)for(let w=0,p=mm.Nx.length;w<p;w++){var r;const p=mm.Nx[w];null!==(r=Zo.c.audioEngine)&&void 0!==r&&r.canUseWebAudio?(p.url||(p.url=p.name),O[p.url]?u.Nx.push(Do.Parse(p,o,f,O[p.url])):(B=Do.Parse(p,o,f),O[p.url]=B,u.Nx.push(B))):u.Nx.push(new Do(p.name,null,o))}O=[]})),Object.defineProperty(uu.d.prototype,"mainSoundTrack",{get:function(){let mm=this._getComponent(ou.e.NAME_AUDIO);return mm||(mm=new ru(this),this.o(mm)),this._mainSoundTrack||(this._mainSoundTrack=new mf(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),uu.d.prototype.getSoundByName=function(mm){let o;for(o=0;o<this.mainSoundTrack.soundCollection.length;o++)if(this.mainSoundTrack.soundCollection[o].name===mm)return this.mainSoundTrack.soundCollection[o];if(this.soundTracks)for(let u=0;u<this.soundTracks.length;u++)for(o=0;o<this.soundTracks[u].soundCollection.length;o++)if(this.soundTracks[u].soundCollection[o].name===mm)return this.soundTracks[u].soundCollection[o];return null},Object.defineProperty(uu.d.prototype,"audioEnabled",{get:function(){let mm=this._getComponent(ou.e.NAME_AUDIO);return mm||(mm=new ru(this),this.o(mm)),mm.audioEnabled},set:function(mm){let o=this._getComponent(ou.e.NAME_AUDIO);o||(o=new ru(this),this.o(o)),mm?o.enableAudio():o.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(uu.d.prototype,"headphone",{get:function(){let mm=this._getComponent(ou.e.NAME_AUDIO);return mm||(mm=new ru(this),this.o(mm)),mm.headphone},set:function(mm){let o=this._getComponent(ou.e.NAME_AUDIO);o||(o=new ru(this),this.o(o)),mm?o.switchAudioModeForHeadphones():o.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(uu.d.prototype,"audioListenerPositionProvider",{get:function(){let mm=this._getComponent(ou.e.NAME_AUDIO);return mm||(mm=new ru(this),this.o(mm)),mm.audioListenerPositionProvider},set:function(mm){let o=this._getComponent(ou.e.NAME_AUDIO);if(o||(o=new ru(this),this.o(o)),mm&&"function"!==typeof mm)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");o.audioListenerPositionProvider=mm},enumerable:!0,configurable:!0}),Object.defineProperty(uu.d.prototype,"audioListenerRotationProvider",{get:function(){let mm=this._getComponent(ou.e.NAME_AUDIO);return mm||(mm=new ru(this),this.o(mm)),mm.audioListenerRotationProvider},set:function(mm){let o=this._getComponent(ou.e.NAME_AUDIO);if(o||(o=new ru(this),this.o(o)),mm&&"function"!==typeof mm)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");o.audioListenerRotationProvider=mm},enumerable:!0,configurable:!0}),Object.defineProperty(uu.d.prototype,"audioPositioningRefreshRate",{get:function(){let mm=this._getComponent(ou.e.NAME_AUDIO);return mm||(mm=new ru(this),this.o(mm)),mm.audioPositioningRefreshRate},set:function(mm){let o=this._getComponent(ou.e.NAME_AUDIO);o||(o=new ru(this),this.o(o)),o.audioPositioningRefreshRate=mm},enumerable:!0,configurable:!0});class ru{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(mm){this.name=ou.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new B.lo,this._cachedCameraPosition=new B.lo,this._lastCheck=0,this._invertMatrixTemp=new B.Matrix,this._cameraDirectionTemp=new B.lo,(mm=mm||H.d.LastCreatedScene)&&(this.bo=mm,mm.soundTracks=[],mm.Nx=[])}register(){this.bo._afterRenderStage.registerStep(ou.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(mm){if(mm.Nx=[],this.bo.soundTracks)for(let o=0;o<this.bo.soundTracks.length;o++){const u=this.bo.soundTracks[o];for(let o=0;o<u.soundCollection.length;o++)mm.Nx.push(u.soundCollection[o].serialize())}}addFromContainer(mm){if(mm.Nx)for(const o of mm.Nx)o.play(),o.autoplay=!0,this.bo.mainSoundTrack.addSound(o)}removeFromContainer(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(mm.Nx)for(const u of mm.Nx)u.stop(),u.autoplay=!1,this.bo.mainSoundTrack.removeSound(u),o&&u.dispose()}dispose(){const mm=this.bo;if(mm._mainSoundTrack&&mm.mainSoundTrack.dispose(),mm.soundTracks)for(let o=0;o<mm.soundTracks.length;o++)mm.soundTracks[o].dispose()}disableAudio(){const mm=this.bo;let o;for(this._audioEnabled=!1,Zo.c.audioEngine&&Zo.c.audioEngine.audioContext&&Zo.c.audioEngine.audioContext.suspend(),o=0;o<mm.mainSoundTrack.soundCollection.length;o++)mm.mainSoundTrack.soundCollection[o].pause();if(mm.soundTracks)for(o=0;o<mm.soundTracks.length;o++)for(let u=0;u<mm.soundTracks[o].soundCollection.length;u++)mm.soundTracks[o].soundCollection[u].pause()}enableAudio(){const mm=this.bo;let o;for(this._audioEnabled=!0,Zo.c.audioEngine&&Zo.c.audioEngine.audioContext&&Zo.c.audioEngine.audioContext.resume(),o=0;o<mm.mainSoundTrack.soundCollection.length;o++)mm.mainSoundTrack.soundCollection[o].isPaused&&mm.mainSoundTrack.soundCollection[o].play();if(mm.soundTracks)for(o=0;o<mm.soundTracks.length;o++)for(let u=0;u<mm.soundTracks[o].soundCollection.length;u++)mm.soundTracks[o].soundCollection[u].isPaused&&mm.soundTracks[o].soundCollection[u].play()}switchAudioModeForHeadphones(){const mm=this.bo;if(this._headphone=!0,mm.mainSoundTrack.switchPanningModelToHRTF(),mm.soundTracks)for(let o=0;o<mm.soundTracks.length;o++)mm.soundTracks[o].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const mm=this.bo;if(this._headphone=!1,mm.mainSoundTrack.switchPanningModelToEqualPower(),mm.soundTracks)for(let o=0;o<mm.soundTracks.length;o++)mm.soundTracks[o].switchPanningModelToEqualPower()}_afterRender(){const mm=Ou.b.Now;if(this._lastCheck&&mm-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=mm;const o=this.bo;if(!this._audioEnabled||!o._mainSoundTrack||!o.soundTracks||0===o._mainSoundTrack.soundCollection.length&&1===o.soundTracks.length)return;const u=Zo.c.audioEngine;if(u&&u.audioContext){let mm,f=o.activeCamera;if(o.activeCameras&&o.activeCameras.length>0&&(f=o.activeCameras[0]),this.audioListenerPositionProvider){const mm=this.audioListenerPositionProvider();u.audioContext.listener.setPosition(mm.x||0,mm.y||0,mm.z||0)}else f?this._cachedCameraPosition.equals(f.globalPosition)||(this._cachedCameraPosition.p(f.globalPosition),u.audioContext.listener.setPosition(f.globalPosition.x,f.globalPosition.y,f.globalPosition.z)):u.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const mm=this.audioListenerRotationProvider();u.audioContext.listener.setOrientation(mm.x||0,mm.y||0,mm.z||0,0,1,0)}else f?(f.rigCameras&&f.rigCameras.length>0&&(f=f.rigCameras[0]),f.getViewMatrix().invertToRef(this._invertMatrixTemp),B.lo.TransformNormalToRef(ru._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),u.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):u.audioContext.listener.setOrientation(0,0,0,0,1,0);for(mm=0;mm<o.mainSoundTrack.soundCollection.length;mm++){const u=o.mainSoundTrack.soundCollection[mm];u.useCustomAttenuation&&u.updateDistanceFromListener()}if(o.soundTracks)for(mm=0;mm<o.soundTracks.length;mm++)for(let u=0;u<o.soundTracks[mm].soundCollection.length;u++){const f=o.soundTracks[mm].soundCollection[u];f.useCustomAttenuation&&f.updateDistanceFromListener()}}}}ru._CameraDirection=new B.lo(0,0,-1),Do._SceneComponentInitialization=mm=>{let o=mm._getComponent(ou.e.NAME_AUDIO);o||(o=new ru(mm),mm.o(o))};const wu="MSFT_audio_emitter";class pu{constructor(mm){this.name=wu,this._loader=mm,this.enabled=this._loader.isExtensionUsed(wu)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const mm=this._loader.Af.extensions;if(mm&&mm[this.name]){const o=mm[this.name];this._clips=o.clips,this._emitters=o.emitters,e.Assign(this._clips),e.Assign(this._emitters)}}loadSceneAsync(mm,o){return C.LoadExtensionAsync(mm,o,this.name,(async(u,f)=>{const B=new Array;B.push(this._loader.loadSceneAsync(mm,o));for(const mm of f.emitters){const o=e.Get(`${u}/emitters`,this._emitters,mm);if(void 0!=o.refDistance||void 0!=o.maxDistance||void 0!=o.rolloffFactor||void 0!=o.distanceModel||void 0!=o.innerAngle||void 0!=o.outerAngle)throw new Error(`${u}: Direction or Distance properties are not allowed on emitters attached to a scene`);B.push(this._loadEmitterAsync(`${u}/emitters/${o.index}`,o))}await Promise.all(B)}))}loadNodeAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(mm,f)=>{const O=new Array,w=await this._loader.loadNodeAsync(mm,o,(o=>{for(const u of f.emitters){const f=e.Get(`${mm}/emitters`,this._emitters,u);O.push(this._loadEmitterAsync(`${mm}/emitters/${f.index}`,f).then((()=>{for(const mm of f._babylonSounds)mm.attachToMesh(o),void 0==f.innerAngle&&void 0==f.outerAngle||(mm.setLocalDirectionToMesh(B.lo.Forward()),mm.setDirectionalCone(2*r.Tools.ToDegrees(void 0==f.innerAngle?Math.PI:f.innerAngle),2*r.Tools.ToDegrees(void 0==f.outerAngle?Math.PI:f.outerAngle),0))})))}u(o)}));return await Promise.all(O),w}))}loadAnimationAsync(mm,o){return C.LoadExtensionAsync(mm,o,this.name,(async(u,f)=>{const B=await this._loader.loadAnimationAsync(mm,o),O=new Array;e.Assign(f.events);for(const r of f.events)O.push(this._loadAnimationEventAsync(`${u}/events/${r.index}`,mm,o,r,B));return await Promise.all(O),B}))}_loadClipAsync(mm,o){if(o._objectURL)return o._objectURL;let u;if(o.uri)u=this._loader.loadUriAsync(mm,o,o.uri);else{const f=e.Get(`${mm}/bufferView`,this._loader.Af.bufferViews,o.bufferView);u=this._loader.loadBufferViewAsync(`/bufferViews/${f.index}`,f)}return o._objectURL=u.then((mm=>URL.createObjectURL(new Blob([mm],{type:o.mimeType})))),o._objectURL}_loadEmitterAsync(mm,o){if(o._babylonSounds=o._babylonSounds||[],!o._babylonData){const mm=new Array,u=o.name||`emitter${o.index}`,f={loop:!1,autoplay:!1,volume:void 0==o.volume?1:o.volume};for(let O=0;O<o.clips.length;O++){const B=`/extensions/${this.name}/clips`,r=e.Get(B,this._clips,o.clips[O].clip);mm.push(this._loadClipAsync(`${B}/${o.clips[O].clip}`,r).then((mm=>{const B=o._babylonSounds[O]=new Do(u,mm,this._loader.babylonScene,null,f);B.refDistance=o.refDistance||1,B.maxDistance=o.maxDistance||256,B.rolloffFactor=o.rolloffFactor||1,B.distanceModel=o.distanceModel||"exponential"})))}const B=Promise.all(mm).then((()=>{const mm=o.clips.map((mm=>mm.weight||1)),u=new io(o.loop||!1,o._babylonSounds,mm);o.innerAngle&&(u.directionalConeInnerAngle=2*r.Tools.ToDegrees(o.innerAngle)),o.outerAngle&&(u.directionalConeOuterAngle=2*r.Tools.ToDegrees(o.outerAngle)),o.volume&&(u.volume=o.volume),o._babylonData.sound=u}));o._babylonData={loaded:B}}return o._babylonData.loaded}_getEventAction(mm,o,u,f,B){switch(u){case"play":return mm=>{const u=(B||0)+(mm-f);o.play(u)};case"stop":return()=>{o.stop()};case"pause":return()=>{o.pause()};default:throw new Error(`${mm}: Unsupported action ${u}`)}}_loadAnimationEventAsync(mm,o,u,f,B){if(0==B.targetedAnimations.length)return Promise.resolve();const O=B.targetedAnimations[0],r=f.ro,w=e.Get(`/extensions/${this.name}/emitters`,this._emitters,r);return this._loadEmitterAsync(mm,w).then((()=>{const o=w._babylonData.sound;if(o){const u=new Uo(f.time,this._getEventAction(mm,o,f.action,f.time,f.startOffset));O.animation.addEvent(u),B.onAnimationGroupEndObservable.add((()=>{o.stop()})),B.onAnimationGroupPauseObservable.add((()=>{o.pause()}))}}))}}X(wu),a(wu,!0,(mm=>new pu(mm)));const Ku="MSFT_lod";class zu{constructor(mm){var o;this.name=Ku,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new z.d,this.onMaterialLODsLoadedObservable=new z.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=mm,this.maxLODsToLoad=(null===(o=this._loader.parent.extensionOptions[Ku])||void 0===o?void 0:o.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Ku)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let mm=0;mm<this._nodePromiseLODs.length;mm++){const o=Promise.all(this._nodePromiseLODs[mm]).then((()=>{0!==mm&&(this._loader.endPerformanceCounter(`Node LOD ${mm}`),this._loader.log(`Loaded node LOD ${mm}`)),this.onNodeLODsLoadedObservable.notifyObservers(mm),mm!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${mm+1}`),this._loadBufferLOD(this._nodeBufferLODs,mm+1),this._nodeSignalLODs[mm]&&this._nodeSignalLODs[mm].resolve())}));this._loader._completePromises.push(o)}for(let mm=0;mm<this._materialPromiseLODs.length;mm++){const o=Promise.all(this._materialPromiseLODs[mm]).then((()=>{0!==mm&&(this._loader.endPerformanceCounter(`Material LOD ${mm}`),this._loader.log(`Loaded material LOD ${mm}`)),this.onMaterialLODsLoadedObservable.notifyObservers(mm),mm!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${mm+1}`),this._loadBufferLOD(this._materialBufferLODs,mm+1),this._materialSignalLODs[mm]&&this._materialSignalLODs[mm].resolve())}));this._loader._completePromises.push(o)}}loadSceneAsync(mm,o){const u=this._loader.loadSceneAsync(mm,o);return this._loadBufferLOD(this._bufferLODs,0),u}loadNodeAsync(mm,o,u){return C.LoadExtensionAsync(mm,o,this.name,(async(mm,B)=>{let O;const r=this._getLODs(mm,o,this._loader.Af.nodes,B.ids);this._loader.logOpen(`${mm}`);for(let o=0;o<r.length;o++){const mm=r[o];0!==o&&(this._nodeIndexLOD=o,this._nodeSignalLODs[o]=this._nodeSignalLODs[o]||new f);const B=mm=>{u(mm),mm.cp(!1)},w=this._loader.loadNodeAsync(`/nodes/${mm.index}`,mm,B).then((mm=>{if(0!==o){const mm=r[o-1];mm._babylonTransformNode&&(this._disposeTransformNode(mm._babylonTransformNode),delete mm._babylonTransformNode)}return mm.cp(!0),mm}));this._nodePromiseLODs[o]=this._nodePromiseLODs[o]||[],0===o?O=w:(this._nodeIndexLOD=null,this._nodePromiseLODs[o].push(w))}return this._loader.logClose(),await O}))}_loadMaterialAsync(mm,o,u,f,B){return this._nodeIndexLOD?null:C.LoadExtensionAsync(mm,o,this.name,(async(mm,O)=>{let r;const w=this._getLODs(mm,o,this._loader.Af.materials,O.ids);this._loader.logOpen(`${mm}`);for(let o=0;o<w.length;o++){const mm=w[o];0!==o&&(this._materialIndexLOD=o);const O=this._loader._loadMaterialAsync(`/materials/${mm.index}`,mm,u,f,(mm=>{0===o&&B(mm)})).then((mm=>{if(0!==o){B(mm);const u=w[o-1]._data;u[f]&&(this._disposeMaterials([u[f].babylonMaterial]),delete u[f])}return mm}));this._materialPromiseLODs[o]=this._materialPromiseLODs[o]||[],0===o?r=O:(this._materialIndexLOD=null,this._materialPromiseLODs[o].push(O))}return this._loader.logClose(),await r}))}_loadUriAsync(mm,o,u){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const B=this._nodeIndexLOD-1;return this._nodeSignalLODs[B]=this._nodeSignalLODs[B]||new f,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(mm,o,u)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const B=this._materialIndexLOD-1;return this._materialSignalLODs[B]=this._materialSignalLODs[B]||new f,this._materialSignalLODs[B].promise.then((async()=>await this._loader.loadUriAsync(mm,o,u)))}return null}loadBufferAsync(mm,o,u,B){if(this._loader.parent.useRangeRequests&&!o.uri){if(!this._loader.bin)throw new Error(`${mm}: Uri is missing or the binary glTF is missing its binary chunk`);const o=async(mm,o)=>{const O=u,r=O+B-1;let w=mm[o];return w?(w.start=Math.min(w.start,O),w.end=Math.max(w.end,r)):(w={start:O,end:r,loaded:new f},mm[o]=w),await w.loaded.promise.then((mm=>new Uint8Array(mm.buffer,mm.byteOffset+u-w.start,B)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?o(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?o(this._materialBufferLODs,this._materialIndexLOD):o(this._bufferLODs,0)}return null}_loadBufferLOD(mm,o){const u=mm[o];u&&(this._loader.log(`Loading buffer range [${u.start}-${u.end}]`),this._loader.bin.readAsync(u.start,u.end-u.start+1).then((mm=>{u.loaded.resolve(mm)}),(mm=>{u.loaded.reject(mm)})))}_getLODs(mm,o,u,f){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const B=[];for(let O=f.length-1;O>=0;O--)if(B.push(e.Get(`${mm}/ids/${f[O]}`,u,f[O])),B.length===this.maxLODsToLoad)return B;return B.push(o),B}_disposeTransformNode(mm){const o=[],u=mm.material;u&&o.push(u);for(const B of mm.getChildMeshes())B.material&&o.push(B.material);mm.dispose();const f=o.filter((mm=>this._loader.babylonScene.meshes.every((o=>o.material!=mm))));this._disposeMaterials(f)}_disposeMaterials(mm){const o={};for(const u of mm){for(const mm of u.getActiveTextures())o[mm.uniqueId]=mm;u.dispose()}for(const u in o)for(const mm of this._loader.babylonScene.materials)mm.hasTexture(o[u])&&delete o[u];for(const u in o)o[u].dispose()}}X(Ku),a(Ku,!0,(mm=>new zu(mm)));const Yu="MSFT_minecraftMesh";class qu{constructor(mm){this.name=Yu,this._loader=mm,this.enabled=this._loader.isExtensionUsed(Yu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtraAsync(mm,o,this.name,(async(f,B)=>{if(B){if(!(u instanceof Q.d))throw new Error(`${f}: Material type not supported`);const B=this._loader.loadMaterialPropertiesAsync(mm,o,u);return u.needAlphaBlending()&&(u.forceDepthWrite=!0,u.separateCullingPass=!0),u.Bp=u.forceDepthWrite,u.twoSidedLighting=!0,await B}}))}}X(Yu),a(Yu,!0,(mm=>new qu(mm)));const xu="MSFT_sRGBFactors";class Hu{constructor(mm){this.name=xu,this._loader=mm,this.enabled=this._loader.isExtensionUsed(xu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(mm,o,u){return C.LoadExtraAsync(mm,o,this.name,(async(f,B)=>{if(B){if(!(u instanceof Q.d))throw new Error(`${f}: Material type not supported`);const B=this._loader.loadMaterialPropertiesAsync(mm,o,u),O=u.Pm().getEngine().useExactSrgbConversions;return u.albedoTexture||u.albedoColor.toLinearSpaceToRef(u.albedoColor,O),u.reflectivityTexture||u.reflectivityColor.toLinearSpaceToRef(u.reflectivityColor,O),await B}}))}}X(xu),a(xu,!0,(mm=>new Hu(mm)));var Eu=u(14248);const Mu={};var lu=u(14296),tu=u(14274),Qu=u(14251),bu=u(14257);function Ju(mm,o){for(const u of mm)for(const mm of u.dataOutputs)if(mm.uniqueId===o)return mm;throw new Error("Could not find data out connection with unique id "+o)}function Nu(mm,o){for(const u of mm)if(u instanceof tu.d)for(const mm of u.signalInputs)if(mm.uniqueId===o)return mm;throw new Error("Could not find signal in connection with unique id "+o)}async function Su(mm,o){const f=await Promise.all(mm.allBlocks.map((async mm=>{const o=function(mm){switch(mm){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([u.e(78),u.e(79)]).then(u.bind(u,15755))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await u.e(80).then(u.bind(u,15757))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await u.e(81).then(u.bind(u,15761))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await u.e(82).then(u.bind(u,15767))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await u.e(83).then(u.bind(u,15774))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await u.e(84).then(u.bind(u,15776))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await u.e(85).then(u.bind(u,15785))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await u.e(86).then(u.bind(u,15792))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await u.e(87).then(u.bind(u,15799))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await u.e(89).then(u.bind(u,15830))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await u.e(89).then(u.bind(u,15830))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await u.e(89).then(u.bind(u,15830))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await u.e(89).then(u.bind(u,15830))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await u.e(89).then(u.bind(u,15830))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await u.e(89).then(u.bind(u,15830))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await u.e(90).then(u.bind(u,15838))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await u.e(90).then(u.bind(u,15838))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await u.e(90).then(u.bind(u,15838))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await u.e(90).then(u.bind(u,15838))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await u.e(95).then(u.bind(u,15840))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await u.e(96).then(u.bind(u,15848))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await u.e(97).then(u.bind(u,15853))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await u.e(98).then(u.bind(u,15857))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await u.e(99).then(u.bind(u,15860))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await u.e(100).then(u.bind(u,15863))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await u.e(101).then(u.bind(u,15867))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await u.e(102).then(u.bind(u,15873))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await u.e(103).then(u.bind(u,15878))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await u.e(104).then(u.bind(u,15885))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await u.e(105).then(u.bind(u,15890))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await u.e(106).then(u.bind(u,15897))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await u.e(107).then(u.bind(u,15904))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await u.e(108).then(u.bind(u,15908))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await u.e(109).then(u.bind(u,15914))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await u.e(110).then(u.bind(u,15917))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await u.e(111).then(u.bind(u,15923))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await u.e(112).then(u.bind(u,15925))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await u.e(113).then(u.bind(u,15928))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await u.e(92).then(u.bind(u,15933))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await u.e(114).then(u.bind(u,15938))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await u.e(115).then(u.bind(u,15940))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await u.e(116).then(u.bind(u,15942))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await u.e(93).then(u.bind(u,15951))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await u.e(88).then(u.bind(u,15807))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await u.e(94).then(u.bind(u,15956))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await u.e(94).then(u.bind(u,15956))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await u.e(94).then(u.bind(u,15956))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await u.e(94).then(u.bind(u,15956))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await u.e(94).then(u.bind(u,15956))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await u.e(94).then(u.bind(u,15956))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await u.e(94).then(u.bind(u,15956))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await u.e(94).then(u.bind(u,15956))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await u.e(89).then(u.bind(u,15830))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await u.e(89).then(u.bind(u,15830))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await u.e(89).then(u.bind(u,15830))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await u.e(89).then(u.bind(u,15830))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await u.e(89).then(u.bind(u,15830))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await u.e(89).then(u.bind(u,15830))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await u.e(89).then(u.bind(u,15830))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await u.e(90).then(u.bind(u,15838))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await u.e(90).then(u.bind(u,15838))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await u.e(91).then(u.bind(u,15960))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await u.e(91).then(u.bind(u,15960))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await u.e(91).then(u.bind(u,15960))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await u.e(91).then(u.bind(u,15960))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await u.e(91).then(u.bind(u,15960))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await u.e(91).then(u.bind(u,15960))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await u.e(117).then(u.bind(u,15969))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await u.e(118).then(u.bind(u,15975))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await u.e(119).then(u.bind(u,15977))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await u.e(120).then(u.bind(u,15980))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await u.e(121).then(u.bind(u,15989))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await u.e(122).then(u.bind(u,15991))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await u.e(123).then(u.bind(u,15996))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await u.e(124).then(u.bind(u,16003))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await u.e(125).then(u.bind(u,16005))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await u.e(126).then(u.bind(u,16007))).FlowGraphDataSwitchBlock;default:if(Mu[mm])return Mu[mm];throw new Error(`Unknown block name ${mm}`)}}(mm.className);return await o()})));return function(mm,o,u){const f=o.coordinator.createGraph(),B=[],O=o.valueParseFunction??Qu.d;for(let r=0;r<mm.allBlocks.length;r++){const w=Ru(mm.allBlocks[r],{bo:o.coordinator.config.bo,pathConverter:o.pathConverter,assetsContainer:o.coordinator.config.bo,valueParseFunction:O},u[r]);B.push(w),w instanceof lu.e&&f.addEventBlock(w)}for(const r of B){for(const mm of r.dataInputs)for(const o of mm.connectedPointIds){const u=Ju(B,o);mm.connectTo(u)}if(r instanceof tu.d)for(const mm of r.signalOutputs)for(const o of mm.connectedPointIds){const u=Nu(B,o);mm.connectTo(u)}}for(const r of mm.executionContexts)Pu(r,{graph:f,valueParseFunction:O},mm.rightHanded);return f}(mm,o,f)}function Pu(mm,o,u){const f=o.graph.createContext();mm.enableLogging&&(f.enableLogging=!0),f.treatDataAsRightHanded=u||!1;const B=o.valueParseFunction??Qu.d;f.uniqueId=mm.uniqueId;const O=f.Pm();if(mm._assetsContext){var r,w,p,K,z,Y,q,x,H,E;const o=mm._assetsContext,u={meshes:null===(r=o.meshes)||void 0===r?void 0:r.map((mm=>O.getMeshById(mm))),lights:null===(w=o.lights)||void 0===w?void 0:w.map((mm=>O.getLightByName(mm))),cameras:null===(p=o.cameras)||void 0===p?void 0:p.map((mm=>O.getCameraByName(mm))),materials:null===(K=o.materials)||void 0===K?void 0:K.map((mm=>O.getMaterialById(mm))),textures:null===(z=o.textures)||void 0===z?void 0:z.map((mm=>O.getTextureByName(mm))),animations:null===(Y=o.animations)||void 0===Y?void 0:Y.map((mm=>O.animations.find((o=>o.name===mm)))),skeletons:null===(q=o.skeletons)||void 0===q?void 0:q.map((mm=>O.getSkeletonByName(mm))),kq:null===(x=o.kq)||void 0===x?void 0:x.map((mm=>O.getParticleSystemById(mm))),animationGroups:null===(H=o.animationGroups)||void 0===H?void 0:H.map((mm=>O.getAnimationGroupByName(mm))),transformNodes:null===(E=o.transformNodes)||void 0===E?void 0:E.map((mm=>O.getTransformNodeById(mm))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Nx:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};f.assetsContext=u}for(const M in mm._userVariables){const o=B(M,mm._userVariables,f.assetsContext,O);f.userVariables[M]=o}for(const M in mm._connectionValues){const o=B(M,mm._connectionValues,f.assetsContext,O);f._setConnectionValueByKey(M,o)}return f}function Ru(mm,o,u){const f={},B=o.valueParseFunction??Qu.d;if(mm.config)for(const r in mm.config)f[r]=B(r,mm.config,o.assetsContainer||o.bo,o.bo);if((0,Qu.k)(mm.className)){if(!o.pathConverter)throw new Error("Path converter is required for this block");f.pathConverter=o.pathConverter}const O=new u(f);O.uniqueId=mm.uniqueId;for(let r=0;r<mm.dataInputs.length;r++){const o=O.getDataInput(mm.dataInputs[r].name);if(!o)throw new Error("Could not find data input with name "+mm.dataInputs[r].name+" in block "+mm.className);o.deserialize(mm.dataInputs[r])}for(let r=0;r<mm.dataOutputs.length;r++){const o=O.getDataOutput(mm.dataOutputs[r].name);if(!o)throw new Error("Could not find data output with name "+mm.dataOutputs[r].name+" in block "+mm.className);o.deserialize(mm.dataOutputs[r])}return O.metadata=mm.metadata,O.deserialize&&O.deserialize(mm),O}function gu(mm){const[o,u]=mm.split(":");return Wu({op:o,extension:u})}function Wu(mm){var o;let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const f=mm.extension?null===(o=cu[mm.extension])||void 0===o?void 0:o[mm.op]:Au[mm.op];if(!f&&(E.e.Warn(`No mapping found for operation ${mm.op} and extension ${mm.extension||"KHR_interactivity"}`),u)){const o={},u={flows:{}};if(mm.inputValueSockets){o.values={};for(const u in mm.inputValueSockets)o.values[u]={name:u}}return mm.outputValueSockets&&(u.values={},Object.keys(mm.outputValueSockets).forEach((mm=>{u.values[mm]={name:mm}}))),{mq:[],inputs:o,outputs:u}}return f}function Fu(mm,o,u){cu[o]||(cu[o]={}),cu[o][mm]=u}const cu={BABYLON:{"flow/log":{mq:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Au={"event/onStart":{mq:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{mq:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{mq:["FlowGraphSendCustomEventBlock"],extraProcessor(mm,o,u,f,B){if("event/send"!==o.op||!mm.configuration||1!==Object.keys(mm.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const O=mm.configuration.event.value[0];if("number"!==typeof O)throw new Error("Event id should be a number");const r=f.arrays.events[O],w=B[0];return w.config||(w.config={}),w.config.eventId=r.eventId,w.config.eventData=r.eventData,B}},"event/receive":{mq:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(mm,o){var u;if(!mm.configuration)return E.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const f=mm.configuration.event;if(!f)return E.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const B=f.value[0];if("number"!==typeof B)return E.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(u=o.events)||void 0===u?void 0:u[B])?{valid:!0}:(E.e.Error(`Event with id ${B} not found`),{valid:!1,error:`Event with id ${B} not found`})},extraProcessor(mm,o,u,f,B){if("event/receive"!==o.op||!mm.configuration||1!==Object.keys(mm.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const O=mm.configuration.event.value[0];if("number"!==typeof O)throw new Error("Event id should be a number");const r=f.arrays.events[O],w=B[0];return w.config||(w.config={}),w.config.eventId=r.eventId,w.config.eventData=r.eventData,B}},"math/e":yu("FlowGraphEBlock"),"math/pi":yu("FlowGraphPIBlock"),"math/inf":yu("FlowGraphInfBlock"),"math/nan":yu("FlowGraphNaNBlock"),"math/abs":yu("FlowGraphAbsBlock"),"math/sign":yu("FlowGraphSignBlock"),"math/trunc":yu("FlowGraphTruncBlock"),"math/floor":yu("FlowGraphFloorBlock"),"math/ceil":yu("FlowGraphCeilBlock"),"math/round":{mq:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(mm,o,u,f,B){var O;return(O=B[0]).config||(O.config={}),B[0].config.roundHalfAwayFromZero=!0,B}},"math/fract":yu("FlowGraphFractBlock"),"math/neg":yu("FlowGraphNegationBlock"),"math/add":yu("FlowGraphAddBlock",["a","b"],!0),"math/sub":yu("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{mq:["FlowGraphMultiplyBlock"],extraProcessor(mm,o,u,f,B){var O;(O=B[0]).config||(O.config={}),B[0].config.useMatrixPerComponent=!0,B[0].config.preventIntegerFloatArithmetic=!0;let r=-1;return Object.keys(mm.values||{}).find((o=>{var u;return void 0!==(null===(u=mm.values)||void 0===u?void 0:u[o].type)&&(r=mm.values[o].type,!0)})),-1!==r&&(B[0].config.type=f.arrays.types[r].flowGraphType),B},validation:mm=>mm.values?Iu(mm):{valid:!0}},"math/div":yu("FlowGraphDivideBlock",["a","b"],!0),"math/rem":yu("FlowGraphModuloBlock",["a","b"]),"math/min":yu("FlowGraphMinBlock",["a","b"]),"math/max":yu("FlowGraphMaxBlock",["a","b"]),"math/clamp":yu("FlowGraphClampBlock",["a","b","c"]),"math/saturate":yu("FlowGraphSaturateBlock"),"math/mix":yu("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":yu("FlowGraphEqualityBlock",["a","b"]),"math/lt":yu("FlowGraphLessThanBlock",["a","b"]),"math/le":yu("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":yu("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":yu("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":yu("FlowGraphIsNaNBlock"),"math/isinf":yu("FlowGraphIsInfBlock"),"math/select":{mq:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{mq:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":yu("FlowGraphSinBlock"),"math/cos":yu("FlowGraphCosBlock"),"math/tan":yu("FlowGraphTanBlock"),"math/asin":yu("FlowGraphASinBlock"),"math/acos":yu("FlowGraphACosBlock"),"math/atan":yu("FlowGraphATanBlock"),"math/atan2":yu("FlowGraphATan2Block",["a","b"]),"math/sinh":yu("FlowGraphSinhBlock"),"math/cosh":yu("FlowGraphCoshBlock"),"math/tanh":yu("FlowGraphTanhBlock"),"math/asinh":yu("FlowGraphASinhBlock"),"math/acosh":yu("FlowGraphACoshBlock"),"math/atanh":yu("FlowGraphATanhBlock"),"math/exp":yu("FlowGraphExponentialBlock"),"math/log":yu("FlowGraphLogBlock"),"math/log2":yu("FlowGraphLog2Block"),"math/log10":yu("FlowGraphLog10Block"),"math/sqrt":yu("FlowGraphSquareRootBlock"),"math/cbrt":yu("FlowGraphCubeRootBlock"),"math/pow":yu("FlowGraphPowerBlock",["a","b"]),"math/length":yu("FlowGraphLengthBlock"),"math/normalize":yu("FlowGraphNormalizeBlock"),"math/dot":yu("FlowGraphDotBlock",["a","b"]),"math/cross":yu("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":yu("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":yu("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{mq:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{mq:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{mq:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{mq:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{mq:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{mq:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{mq:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":yu("FlowGraphTransposeBlock"),"math/determinant":yu("FlowGraphDeterminantBlock"),"math/inverse":yu("FlowGraphInvertMatrixBlock"),"math/matmul":yu("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{mq:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"rp",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(mm,o,u,f,B,O){const r=B[0].dataInputs.find((mm=>"rotationQuaternion"===mm.name));if(!r)throw new Error("Rotation quaternion input not found");return O._connectionValues[r.uniqueId]&&(O._connectionValues[r.uniqueId].type="Quaternion"),B}},"math/matDecompose":{mq:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"rp"}}}},"math/quatConjugate":yu("FlowGraphConjugateBlock",["a"]),"math/quatMul":{mq:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(mm,o,u,f,B){var O;return(O=B[0]).config||(O.config={}),B[0].config.type="Quaternion",B}},"math/quatAngleBetween":yu("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{mq:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":yu("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":yu("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{mq:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(mm,o,u,f,B){var O;return(O=B[0]).config||(O.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract2x2":{mq:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{mq:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(mm,o,u,f,B){var O;return(O=B[0]).config||(O.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract3x3":{mq:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{mq:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(mm,o,u,f,B){var O;return(O=B[0]).config||(O.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract4x4":{mq:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{mq:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(mm,o,u,f,B,O){var r,w;(w=B[0]).config||(w.config={});const p=B[0].dataInputs[0];return B[0].config.valueType=(null===(r=O._connectionValues[p.uniqueId])||void 0===r?void 0:r.type)??"FlowGraphInteger",B}},"math/and":{mq:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(mm,o,u,f,B,O){var r,w,p;(p=B[0]).config||(p.config={});const K=B[0].dataInputs[0],z=B[0].dataInputs[1];return B[0].config.valueType=(null===(r=O._connectionValues[K.uniqueId])||void 0===r?void 0:r.type)??(null===(w=O._connectionValues[z.uniqueId])||void 0===w?void 0:w.type)??"FlowGraphInteger",B}},"math/or":{mq:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(mm,o,u,f,B,O){var r,w,p;(p=B[0]).config||(p.config={});const K=B[0].dataInputs[0],z=B[0].dataInputs[1];return B[0].config.valueType=(null===(r=O._connectionValues[K.uniqueId])||void 0===r?void 0:r.type)??(null===(w=O._connectionValues[z.uniqueId])||void 0===w?void 0:w.type)??"FlowGraphInteger",B}},"math/xor":{mq:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(mm,o,u,f,B,O){var r,w,p;(p=B[0]).config||(p.config={});const K=B[0].dataInputs[0],z=B[0].dataInputs[1];return B[0].config.valueType=(null===(r=O._connectionValues[K.uniqueId])||void 0===r?void 0:r.type)??(null===(w=O._connectionValues[z.uniqueId])||void 0===w?void 0:w.type)??"FlowGraphInteger",B}},"math/asr":yu("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":yu("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":yu("FlowGraphLeadingZerosBlock"),"math/ctz":yu("FlowGraphTrailingZerosBlock"),"math/popcnt":yu("FlowGraphOneBitsCounterBlock"),"math/rad":yu("FlowGraphDegToRadBlock"),"math/deg":yu("FlowGraphRadToDegBlock"),"type/boolToInt":yu("FlowGraphBooleanToInt"),"type/boolToFloat":yu("FlowGraphBooleanToFloat"),"type/intToBool":yu("FlowGraphIntToBoolean"),"type/intToFloat":yu("FlowGraphIntToFloat"),"type/floatToInt":yu("FlowGraphFloatToInt"),"type/floatToBool":yu("FlowGraphFloatToBoolean"),"flow/sequence":{mq:["FlowGraphSequenceBlock"],extraProcessor(mm,o,u,f,B){const O=B[0];return O.config||(O.config={}),O.config.outputSignalCount=Object.keys(mm.flows||[]).length,O.signalOutputs.forEach(((mm,o)=>{mm.name="out_"+o})),B}},"flow/branch":{mq:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{mq:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(mm){if(mm.configuration&&mm.configuration.cases){const o=mm.configuration.cases.value;if(!o.every((mm=>"number"===typeof mm&&/^-?\d+$/.test(mm.toString()))))return E.e.Warn("Switch cases should be integers. Using empty array instead."),mm.configuration.cases.value=[],{valid:!0};const u=new Set(o);mm.configuration.cases.value=Array.from(u)}return{valid:!0}},extraProcessor(mm,o,u,f,B){if("flow/switch"!==o.op||!mm.flows||0===Object.keys(mm.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return B[0].signalOutputs.forEach((mm=>{"default"!==mm.name&&(mm.name="out_"+mm.name)})),B}},"flow/while":{mq:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{mq:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(mm,o,u,f,B){const O=B[0];return O.config||(O.config={}),O.config.incrementIndexWhenLoopDone=!0,B}},"flow/doN":{mq:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{mq:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(mm,o,u,f,B){if("flow/multiGate"!==o.op||!mm.flows||0===Object.keys(mm.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const O=B[0];return O.config||(O.config={}),O.config.outputSignalCount=Object.keys(mm.flows).length,O.signalOutputs.forEach(((mm,o)=>{mm.name="out_"+o})),B}},"flow/waitAll":{mq:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(mm){var o,u;return"number"!==typeof(null===(o=mm.configuration)||void 0===o||null===(u=o.inputFlows)||void 0===u?void 0:u.value[0])&&(mm.configuration=mm.configuration||{inputFlows:{value:[0]}},mm.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{mq:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{mq:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{mq:["FlowGraphCancelDelayBlock"]},"variable/get":{mq:["FlowGraphGetVariableBlock"],validation(mm){var o,u;return null!==(o=mm.configuration)&&void 0!==o&&null!==(u=o.variable)&&void 0!==u&&u.value?{valid:!0}:(E.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(mm,o)=>[o.getVariableName(mm[0])]}}},"variable/set":{mq:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(mm,o)=>[o.getVariableName(mm[0])]}}},"variable/setMultiple":{mq:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(mm,o)=>[mm[0].map((mm=>o.getVariableName(mm)))]}},extraProcessor:(mm,o,u,f,B)=>(B[0].dataInputs.forEach((mm=>{mm.name=f.getVariableName(+mm.name)})),B)},"variable/interpolate":{mq:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(mm,o)=>[o.getVariableName(mm[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:mm=>!0===mm[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Pu:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Pu:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Pu:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Pu:"FlowGraphPlayAnimationBlock"},out:{name:"out",Pu:"FlowGraphPlayAnimationBlock"},done:{name:"done",Pu:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(mm,o,u,f,B){var O,r,w;const p=B[0],K=null===(O=mm.configuration)||void 0===O?void 0:O.variable.value[0];if("number"!==typeof K)throw E.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const z=f.arrays.staticVariables[K];"undefined"===typeof p.config.animationType.value&&(f.arrays.staticVariables,p.config.animationType.value=(0,bu.G)(z.type));const Y=B[4];return Y.config||(Y.config={}),(r=Y.config).variable||(r.variable={}),Y.config.variable.value=f.getVariableName(K),(w=B[3]).config||(w.config={}),B}},"pointer/get":{mq:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Pu:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Pu:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(mm,o,u,f,B)=>(B.forEach((mm=>{"FlowGraphJsonPointerParserBlock"===mm.className&&(mm.config||(mm.config={}),mm.config.outputValue=!0)})),B)},"pointer/set":{mq:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Pu:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Pu:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(mm,o,u,f,B)=>(B.forEach((mm=>{"FlowGraphJsonPointerParserBlock"===mm.className&&(mm.config||(mm.config={}),mm.config.outputValue=!0)})),B)},"pointer/interpolate":{mq:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Pu:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Pu:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Pu:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Pu:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Pu:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Pu:"FlowGraphPlayAnimationBlock"},out:{name:"out",Pu:"FlowGraphPlayAnimationBlock"},done:{name:"done",Pu:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(mm,o,u,f,B)=>(B.forEach((o=>{"FlowGraphJsonPointerParserBlock"===o.className?(o.config||(o.config={}),o.config.outputValue=!0):"FlowGraphInterpolationBlock"===o.className&&(o.config||(o.config={}),Object.keys(mm.values||[]).forEach((u=>{var B;const O=null===(B=mm.values)||void 0===B?void 0:B[u];if("value"===u&&O){const mm=O.type;void 0!==mm&&(o.config.animationType=f.arrays.types[mm].flowGraphType)}})))})),B)},"animation/start":{mq:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Pu:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(mm,o)=>[mm[0]*o._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(mm,o)=>[mm[0]*o._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(mm,o,u,f,B,O,r){const w=B[B.length-1];return w.config||(w.config={}),w.config.glTF=r,B}},"animation/stop":{mq:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Pu:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(mm,o,u,f,B,O,r){const w=B[B.length-1];return w.config||(w.config={}),w.config.glTF=r,B}},"animation/stopAt":{mq:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Pu:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(mm,o)=>[mm[0]*o._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(mm,o,u,f,B,O,r){const w=B[B.length-1];return w.config||(w.config={}),w.config.glTF=r,B}},"math/switch":{mq:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(mm){if(mm.configuration&&mm.configuration.cases){const o=mm.configuration.cases.value;if(!o.every((mm=>"number"===typeof mm&&/^-?\d+$/.test(mm.toString()))))return E.e.Warn("Switch cases should be integers. Using empty array instead."),mm.configuration.cases.value=[],{valid:!0};const u=new Set(o);mm.configuration.cases.value=Array.from(u)}return{valid:!0}},extraProcessor(mm,o,u,f,B){const O=B[0];return O.dataInputs.forEach((mm=>{"default"!==mm.name&&"case"!==mm.name&&(mm.name="in_"+mm.name)})),O.config||(O.config={}),O.config.treatCasesAsIntegers=!0,B}},"debug/log":{mq:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function yu(mm){let o=arguments.length>2?arguments[2]:void 0;return{mq:[mm],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((mm,o)=>(mm[o]={name:o},mm)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(mm,u,f,B,O){var r;if(o){(r=O[0]).config||(r.config={}),O[0].config.preventIntegerFloatArithmetic=!0;let o=-1;Object.keys(mm.values||{}).find((u=>{var f;return void 0!==(null===(f=mm.values)||void 0===f?void 0:f[u].type)&&(o=mm.values[u].type,!0)})),-1!==o&&(O[0].config.type=B.arrays.types[o].flowGraphType)}return O},validation:mm=>o?Iu(mm):{valid:!0}}}function Iu(mm){if(mm.values){const o=Object.keys(mm.values).map((o=>mm.values[o].type)).filter((mm=>void 0!==mm));if(!o.every((mm=>mm===o[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Au["math/compose"]=Au["math/matCompose"],Au["math/decompose"]=Au["math/matDecompose"];var su=u(12711);const ju={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"lo",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class au{constructor(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=mm,this._gltf=o,this._animationTargetFps=u,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const mm of this._interactivityGraph.types)this._types.push(ju[mm.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const mm of this._interactivityGraph.declarations){const o=Wu(mm);if(!o)throw E.e.Error(["No mapping found for declaration",mm]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:o,fullOperationName:mm.extension?mm.op+":"+mm.extension:mm.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const mm of this._interactivityGraph.variables){const o=this._parseVariable(mm);this._staticVariables.push(o)}}_parseVariable(mm,o){const u=this._types[mm.type];if(!u)throw E.e.Error(["No type found for variable",mm]),new Error("Error parsing variables");if(mm.value&&mm.value.length!==u.length)throw E.e.Error(["Invalid value length for variable",mm,u]),new Error("Error parsing variables");const f=mm.value||[];if(!f.length)switch(u.flowGraphType){case"boolean":f.push(!1);break;case"FlowGraphInteger":f.push(0);break;case"number":f.push(NaN);break;case"Vector2":f.push(NaN,NaN);break;case"lo":f.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":f.fill(NaN,0,4);break;case"Matrix":f.fill(NaN,0,16);break;case"Matrix3D":f.fill(NaN,0,9)}return"number"===u.elementType&&"string"===typeof f[0]&&(f[0]=parseFloat(f[0])),{type:u.flowGraphType,value:o?o(f,this):f}}_parseEvents(){if(this._interactivityGraph.events)for(const mm of this._interactivityGraph.events){const o={eventId:mm.id||"internalEvent_"+this._internalEventsCounter++};mm.values&&(o.eventData=Object.keys(mm.values).map((o=>{var u;const f=null===(u=mm.values)||void 0===u?void 0:u[o];if(!f)throw E.e.Error(["No value found for event key",o]),new Error("Error parsing events");const B=this._types[f.type];if(!B)throw E.e.Error(["No type found for event value",f]),new Error("Error parsing events");const O="undefined"!==typeof f.value?this._parseVariable(f):void 0;return{id:o,type:B.flowGraphType,eventData:!0,value:O}}))),this._events.push(o)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const o of this._interactivityGraph.nodes){if("number"!==typeof o.declaration)throw E.e.Error(["No declaration found for node",o]),new Error("Error parsing nodes");const u=this._mappings[o.declaration];if(!u)throw E.e.Error(["No mapping found for node",o]),new Error("Error parsing nodes");if(u.flowGraphMapping.validation){const f=u.flowGraphMapping.validation(o,this._interactivityGraph,this._gltf);var mm;if(!f.valid)throw new Error(`Error validating interactivity node ${null===(mm=this._interactivityGraph.declarations)||void 0===mm?void 0:mm[o.declaration].op} - ${f.error}`)}const f=[];for(const mm of u.flowGraphMapping.mq){const B=this._getEmptyBlock(mm,u.fullOperationName);this._parseNodeConfiguration(o,B,u.flowGraphMapping,mm),f.push(B)}this._nodes.push({mq:f,fullOperationName:u.fullOperationName})}}_getEmptyBlock(mm,o){return{uniqueId:(0,su.d)(),className:mm,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:o,metadata:{}}}_parseNodeConfiguration(mm,o,u,f){const B=o.config;if(mm.configuration){const o=Object.keys(mm.configuration);for(const w of o){var O,r;const o=null===(O=mm.configuration)||void 0===O?void 0:O[w];if(!o)throw E.e.Error(["No value found for node configuration",w]),new Error("Error parsing node configuration");const p=null===(r=u.configuration)||void 0===r?void 0:r[w];if(p&&p.Pu?p.Pu===f:0===u.mq.indexOf(f)){const mm=(null===p||void 0===p?void 0:p.name)||w;o&&"undefined"!==typeof o.value||"undefined"===typeof(null===p||void 0===p?void 0:p.defaultValue)?o.value.length>=0?B[mm]={value:1===o.value.length?o.value[0]:o.value}:E.e.Warn(["Invalid value for node configuration",o]):B[mm]={value:p.defaultValue},p&&p.dataTransformer&&(B[mm].value=p.dataTransformer([B[mm].value],this)[0])}}}}_parseNodeConnections(mm){for(let N=0;N<this._nodes.length;N++){var o;const S=null===(o=this._interactivityGraph.nodes)||void 0===o?void 0:o[N];if(!S)throw E.e.Error(["No node found for interactivity node",this._nodes[N]]),new Error("Error parsing node connections");const P=this._nodes[N],R=this._mappings[S.declaration];if(!R)throw E.e.Error(["No mapping found for node",S]),new Error("Error parsing node connections");const g=S.flows||{},W=Object.keys(g).sort();for(const mm of W){var u,f,B,O;const o=g[mm],K=null===(u=R.flowGraphMapping.outputs)||void 0===u||null===(f=u.flows)||void 0===f?void 0:f[mm],z=(null===K||void 0===K?void 0:K.name)||mm,Y=this._createNewSocketConnection(z,!0);(K&&K.Pu&&P.mq.find((mm=>mm.className===K.Pu))||P.mq[0]).signalOutputs.push(Y);const q=o.node,x=this._nodes[q];if(!x)throw E.e.Error(["No node found for input node id",q]),new Error("Error parsing node connections");const H=gu(x.fullOperationName);if(!H)throw E.e.Error(["No mapping found for input node",x]),new Error("Error parsing node connections");let M=null===(B=H.inputs)||void 0===B||null===(O=B.flows)||void 0===O?void 0:O[o.socket||"in"],l=!1;if(!M)for(const mm in null===(r=H.inputs)||void 0===r?void 0:r.flows){var r,w,p;if(mm.startsWith("[")&&mm.endsWith("]"))l=!0,M=null===(w=H.inputs)||void 0===w||null===(p=w.flows)||void 0===p?void 0:p[mm]}const t=M?l?M.name.replace("$1",o.socket||""):M.name:o.socket||"in",Q=M&&M.Pu&&x.mq.find((mm=>mm.className===M.Pu))||x.mq[0];let b=Q.signalInputs.find((mm=>mm.name===t));b||(b=this._createNewSocketConnection(t),Q.signalInputs.push(b)),b.connectedPointIds.push(Y.uniqueId),Y.connectedPointIds.push(b.uniqueId)}const F=S.values||{},c=Object.keys(F);for(const o of c){var K,z;const u=F[o];let f=null===(K=R.flowGraphMapping.inputs)||void 0===K||null===(z=K.values)||void 0===z?void 0:z[o],B=!1;if(!f)for(const mm in null===(Y=R.flowGraphMapping.inputs)||void 0===Y?void 0:Y.values){var Y,q,x;if(mm.startsWith("[")&&mm.endsWith("]"))B=!0,f=null===(q=R.flowGraphMapping.inputs)||void 0===q||null===(x=q.values)||void 0===x?void 0:x[mm]}const O=f?B?f.name.replace("$1",o):f.name:o,r=this._createNewSocketConnection(O);if((f&&f.Pu&&P.mq.find((mm=>mm.className===f.Pu))||P.mq[0]).dataInputs.push(r),void 0!==u.value){const o=this._parseVariable(u,f&&f.dataTransformer);mm._connectionValues[r.uniqueId]=o}else{if("undefined"===typeof u.node)throw E.e.Error(["Invalid value for value connection",u]),new Error("Error parsing node connections");{var H,M,l;const mm=u.node,o=u.socket||"value",f=this._nodes[mm];if(!f)throw E.e.Error(["No node found for output socket reference",u]),new Error("Error parsing node connections");const B=gu(f.fullOperationName);if(!B)throw E.e.Error(["No mapping found for output socket reference",u]),new Error("Error parsing node connections");let O=null===(H=B.outputs)||void 0===H||null===(M=H.values)||void 0===M?void 0:M[o],w=!1;if(!O)for(const u in null===(t=B.outputs)||void 0===t?void 0:t.values){var t,Q,b;if(u.startsWith("[")&&u.endsWith("]"))w=!0,O=null===(Q=B.outputs)||void 0===Q||null===(b=Q.values)||void 0===b?void 0:b[u]}const p=O?w?O.name.replace("$1",o):null===(l=O)||void 0===l?void 0:l.name:o,K=O&&O.Pu&&f.mq.find((mm=>mm.className===O.Pu))||f.mq[0];let z=K.dataOutputs.find((mm=>mm.name===p));z||(z=this._createNewSocketConnection(p,!0),K.dataOutputs.push(z)),r.connectedPointIds.push(z.uniqueId),z.connectedPointIds.push(r.uniqueId)}}}if(R.flowGraphMapping.interBlockConnectors)for(const mm of R.flowGraphMapping.interBlockConnectors){const o=mm.input,u=mm.output,f=mm.isVariable;this._connectFlowGraphNodes(o,u,P.mq[mm.inputBlockIndex],P.mq[mm.outputBlockIndex],f)}if(R.flowGraphMapping.extraProcessor){var J;const o=null===(J=this._interactivityGraph.declarations)||void 0===J?void 0:J[S.declaration];if(!o)throw E.e.Error(["No declaration found for extra processor",S]),new Error("Error parsing node connections");P.mq=R.flowGraphMapping.extraProcessor(S,o,R.flowGraphMapping,this,P.mq,mm,this._gltf)}}}_createNewSocketConnection(mm,o){return{uniqueId:(0,su.d)(),name:mm,_connectionType:o?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(mm,o,u,f,B){const O=B?u.dataInputs:u.signalInputs,r=B?f.dataOutputs:f.signalOutputs,w=O.find((o=>o.name===mm))||this._createNewSocketConnection(mm),p=r.find((mm=>mm.name===o))||this._createNewSocketConnection(o,!0);O.find((o=>o.name===mm))||O.push(w),r.find((mm=>mm.name===o))||r.push(p),w.connectedPointIds.push(p.uniqueId),p.connectedPointIds.push(w.uniqueId)}getVariableName(mm){return"staticVariable_"+mm}serializeToFlowGraph(){const mm={uniqueId:(0,su.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(mm);for(let o=0;o<this._staticVariables.length;o++){const u=this._staticVariables[o];mm._userVariables[this.getVariableName(o)]=u}return{rightHanded:!0,allBlocks:this._nodes.reduce(((mm,o)=>mm.concat(o.mq)),[]),executionContexts:[mm]}}}const Xu="KHR_interactivity";class Gu{constructor(mm){this._loader=mm,this.name=Xu,this.enabled=this._loader.isExtensionUsed(Xu),this._pathConverter=(0,G.h)(this._loader.Af),mm._skipStartAnimationStep=!0;const o=mm.babylonScene;o&&function(mm){(0,G.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!mm.activeCamera)return new B.Quaternion(NaN,NaN,NaN,NaN);const o=B.Quaternion.FromRotationMatrix(mm.activeCamera.getWorldMatrix()).normalize();return mm.useRightHandedSystem||(o.w*=-1,o.x*=-1),o},type:"Quaternion",getTarget:()=>mm.activeCamera}),(0,G.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!mm.activeCamera)return new B.lo(NaN,NaN,NaN);const o=mm.activeCamera.getWorldMatrix().getTranslation();return mm.useRightHandedSystem||(o.x*=-1),o},type:"lo",getTarget:()=>mm.activeCamera}),(0,G.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:mm=>{var o;return(null===(o=mm._babylonAnimationGroup)||void 0===o?void 0:o.isPlaying)??!1},type:"boolean",getTarget:mm=>mm._babylonAnimationGroup}),(0,G.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:mm=>{var o;return((null===(o=mm._babylonAnimationGroup)||void 0===o?void 0:o.from)??0)/60},type:"number",getTarget:mm=>mm._babylonAnimationGroup}),(0,G.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:mm=>{var o;return((null===(o=mm._babylonAnimationGroup)||void 0===o?void 0:o.to)??0)/60},type:"number",getTarget:mm=>mm._babylonAnimationGroup}),(0,G.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:mm=>{var o;return((null===(o=mm._babylonAnimationGroup)||void 0===o?void 0:o.getCurrentFrame())??0)/60},type:"number",getTarget:mm=>mm._babylonAnimationGroup}),(0,G.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:mm=>{var o;return((null===(o=mm._babylonAnimationGroup)||void 0===o?void 0:o.getCurrentFrame())??0)/60},type:"number",getTarget:mm=>mm._babylonAnimationGroup})}(o)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var mm;if(!this._loader.babylonScene||!this._pathConverter)return;const o=this._loader.babylonScene,u=null===(mm=this._loader.Af.extensions)||void 0===mm?void 0:mm.KHR_interactivity;if(!u)return;const f=new Eu.b({bo:o});f.dispatchEventsSynchronously=!1;const B=u.graphs.map((mm=>new au(mm,this._loader.Af,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(B.map((async mm=>await Su(mm,{coordinator:f,pathConverter:this._pathConverter})))),f.start()}}var ku;ku=async()=>(await Promise.resolve().then(u.bind(u,14315))).FlowGraphGLTFDataProvider,Mu[`${Xu}/${"FlowGraphGLTFDataProvider"}`]=ku,X(Xu),a(Xu,!0,(mm=>new Gu(mm)));const du="KHR_node_visibility";(0,G.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:mm=>{const o=mm._babylonTransformNode;return!o||void 0===o.isVisible||o.isVisible},set:(mm,o)=>{var u,f;null===(u=o._primitiveBabylonMeshes)||void 0===u||u.forEach((mm=>{mm.inheritVisibility=!0})),o._babylonTransformNode&&(o._babylonTransformNode.isVisible=mm),null===(f=o._primitiveBabylonMeshes)||void 0===f||f.forEach((o=>{o.isVisible=mm}))},getTarget:mm=>mm._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class eu{constructor(mm){this.name=du,this._loader=mm,this.enabled=mm.isExtensionUsed(du)}async onReady(){var mm;null===(mm=this._loader.Af.nodes)||void 0===mm||mm.forEach((mm=>{var o,u,f,B;(null===(o=mm._primitiveBabylonMeshes)||void 0===o||o.forEach((mm=>{mm.inheritVisibility=!0})),null!==(u=mm.extensions)&&void 0!==u&&u.KHR_node_visibility)&&(!1===(null===(f=mm.extensions)||void 0===f?void 0:f.KHR_node_visibility.visible)&&(mm._babylonTransformNode&&(mm._babylonTransformNode.isVisible=!1),null===(B=mm._primitiveBabylonMeshes)||void 0===B||B.forEach((mm=>{mm.isVisible=!1}))))}))}dispose(){this._loader=null}}X(du),a(du,!0,(mm=>new eu(mm)));const Lu="KHR_node_selectability";Fu("event/onSelect",Lu,{mq:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Pu:"FlowGraphGetVariableBlock",dataTransformer:mm=>["pickedMesh_"+mm[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Pu:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(mm,o,u,f,B,O,r){var w,p,K,z,Y,q;const x=B[B.length-1];x.config=x.config||{},x.config.glTF=r;const H=null===(w=mm.configuration)||void 0===w||null===(p=w.nodeIndex)||void 0===p?void 0:p.value[0];if(void 0===H||"number"!==typeof H)throw new Error("nodeIndex not found in configuration");const E="pickedMesh_"+H;return B[1].config.variable=E,O._userVariables[E]={className:"Mesh",id:null===r||void 0===r||null===(K=r.nodes)||void 0===K||null===(z=K[H]._babylonTransformNode)||void 0===z?void 0:z.id,uniqueId:null===r||void 0===r||null===(Y=r.nodes)||void 0===Y||null===(q=Y[H]._babylonTransformNode)||void 0===q?void 0:q.uniqueId},B}}),(0,G.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:mm=>{const o=mm._babylonTransformNode;return!o||void 0===o.PK||o.PK},set:(mm,o)=>{var u;null===(u=o._primitiveBabylonMeshes)||void 0===u||u.forEach((o=>{o.PK=mm}))},getTarget:mm=>mm._babylonTransformNode,getPropertyName:[()=>"PK"],type:"boolean"});class Cu{constructor(mm){this.name=Lu,this._loader=mm,this.enabled=mm.isExtensionUsed(Lu)}async onReady(){var mm;null===(mm=this._loader.Af.nodes)||void 0===mm||mm.forEach((mm=>{var o,u,f;null!==(o=mm.extensions)&&void 0!==o&&o.KHR_node_selectability&&!1===(null===(u=mm.extensions)||void 0===u?void 0:u.KHR_node_selectability.selectable)&&(null===(f=mm._babylonTransformNode)||void 0===f||f.getChildMeshes().forEach((mm=>{mm.PK=!1})))}))}dispose(){this._loader=null}}X(Lu),a(Lu,!0,(mm=>new Cu(mm)));const vu="KHR_node_hoverability",Vu="targetMeshPointerOver_";Fu("event/onHoverIn",vu,{mq:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Pu:"FlowGraphGetVariableBlock",dataTransformer:mm=>[Vu+mm[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Pu:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(mm,o,u,f,B,O,r){var w,p,K,z,Y,q;const x=B[B.length-1];x.config=x.config||{},x.config.glTF=r;const H=null===(w=mm.configuration)||void 0===w||null===(p=w.nodeIndex)||void 0===p?void 0:p.value[0];if(void 0===H||"number"!==typeof H)throw new Error("nodeIndex not found in configuration");const E=Vu+H;return B[1].config.variable=E,O._userVariables[E]={className:"Mesh",id:null===r||void 0===r||null===(K=r.nodes)||void 0===K||null===(z=K[H]._babylonTransformNode)||void 0===z?void 0:z.id,uniqueId:null===r||void 0===r||null===(Y=r.nodes)||void 0===Y||null===(q=Y[H]._babylonTransformNode)||void 0===q?void 0:q.uniqueId},B}});const nu="targetMeshPointerOut_";Fu("event/onHoverOut",vu,{mq:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Pu:"FlowGraphGetVariableBlock",dataTransformer:mm=>[nu+mm[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Pu:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(mm,o,u,f,B,O,r){var w,p,K,z,Y,q;const x=B[B.length-1];x.config=x.config||{},x.config.glTF=r;const H=null===(w=mm.configuration)||void 0===w||null===(p=w.nodeIndex)||void 0===p?void 0:p.value[0];if(void 0===H||"number"!==typeof H)throw new Error("nodeIndex not found in configuration");const E=nu+H;return B[1].config.variable=E,O._userVariables[E]={className:"Mesh",id:null===r||void 0===r||null===(K=r.nodes)||void 0===K||null===(z=K[H]._babylonTransformNode)||void 0===z?void 0:z.id,uniqueId:null===r||void 0===r||null===(Y=r.nodes)||void 0===Y||null===(q=Y[H]._babylonTransformNode)||void 0===q?void 0:q.uniqueId},B}}),(0,G.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:mm=>{const o=mm._babylonTransformNode;return!o||void 0===o.pointerOverDisableMeshTesting||o.pointerOverDisableMeshTesting},set:(mm,o)=>{var u;null===(u=o._primitiveBabylonMeshes)||void 0===u||u.forEach((o=>{o.pointerOverDisableMeshTesting=!mm}))},getTarget:mm=>mm._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Uu{constructor(mm){this.name=vu,this._loader=mm,this.enabled=mm.isExtensionUsed(vu)}async onReady(){var mm;null===(mm=this._loader.Af.nodes)||void 0===mm||mm.forEach((mm=>{var o,u,f;null!==(o=mm.extensions)&&void 0!==o&&o.KHR_node_hoverability&&!1===(null===(u=mm.extensions)||void 0===u?void 0:u.KHR_node_hoverability.hoverable)&&(null===(f=mm._babylonTransformNode)||void 0===f||f.getChildMeshes().forEach((mm=>{mm.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}X(vu),a(vu,!0,(mm=>new Uu(mm)));const hu="ExtrasAsMetadata";class Zu{_assignExtras(mm,o){if(o.extras&&Object.keys(o.extras).length>0){const u=mm.metadata=mm.metadata||{};(u.Af=u.Af||{}).extras=o.extras}}constructor(mm){this.name=hu,this.enabled=!0,this._loader=mm}dispose(){this._loader=null}loadNodeAsync(mm,o,u){return this._loader.loadNodeAsync(mm,o,(mm=>{this._assignExtras(mm,o),u(mm)}))}loadCameraAsync(mm,o,u){return this._loader.loadCameraAsync(mm,o,(mm=>{this._assignExtras(mm,o),u(mm)}))}createMaterial(mm,o,u){const f=this._loader.createMaterial(mm,o,u);return this._assignExtras(f,o),f}}X(hu),a(hu,!1,(mm=>new Zu(mm)));u(14315)},14189:(mm,o,u)=>{"use strict";u.d(o,{d:()=>y,f:()=>R,h:()=>P,i:()=>g});var f=u(12556),B=u(12549),O=u(13830),r=u(13166),w=u(13139),p=u(13147),K=u(12565),z=u(12596),Y=u(13160),q=u(13258),x=u(13170),H=u(12771);class E{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.kq=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Nx=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(mm){this._environmentTexture=mm}getNodes(){let mm=[];mm=mm.concat(this.meshes),mm=mm.concat(this.lights),mm=mm.concat(this.cameras),mm=mm.concat(this.transformNodes);for(const o of this.skeletons)mm=mm.concat(o.bones);return mm}}class M extends E{}class l{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const mm=this.rootNodes;for(const f of mm)f.dispose();mm.length=0;const o=this.skeletons;for(const f of o)f.dispose();o.length=0;const u=this.animationGroups;for(const f of u)f.dispose();u.length=0}}class t extends E{constructor(mm){super(),this._wasAddedToScene=!1,(mm=mm||z.d.LastCreatedScene)&&(this.bo=mm,this.proceduralTextures=[],mm.Jf.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=mm.getEngine().onContextRestoredObservable.add((()=>{for(const mm of this.geometries)mm._rebuild();for(const mm of this.meshes)mm._rebuild();for(const mm of this.kq)mm.rebuild();for(const mm of this.textures)mm._rebuild()})))}_topologicalSort(mm){const o=new Map;for(const r of mm)o.set(r.uniqueId,r);const u={dependsOn:new Map,dependedBy:new Map};for(const r of mm){const mm=r.uniqueId;u.dependsOn.set(mm,new Set),u.dependedBy.set(mm,new Set)}for(const r of mm){const mm=r.uniqueId,f=u.dependsOn.get(mm);if(r instanceof Y.b){const B=r.sourceMesh;o.has(B.uniqueId)&&(f.add(B.uniqueId),u.dependedBy.get(B.uniqueId).add(mm))}const B=u.dependedBy.get(mm);for(const O of r.getDescendants()){const f=O.uniqueId;if(o.has(f)){B.add(f);u.dependsOn.get(f).add(mm)}}}const f=[],B=[];for(const r of mm){const mm=r.uniqueId;0===u.dependsOn.get(mm).size&&(B.push(r),o.delete(mm))}const O=B;for(;O.length>0;){const mm=O.shift();f.push(mm);const B=u.dependedBy.get(mm.uniqueId);for(const f of Array.from(B.values())){const B=u.dependsOn.get(f);B.delete(mm.uniqueId),0===B.size&&o.get(f)&&(O.push(o.get(f)),o.delete(f))}}return o.size>0&&(K.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),o.forEach((mm=>{K.e.Error(mm.name)}))),f}_addNodeAndDescendantsToList(mm,o,u,f){if(u&&(!f||f(u))&&!o.has(u.uniqueId)){mm.push(u),o.add(u.uniqueId);for(const B of u.getDescendants(!0))this._addNodeAndDescendantsToList(mm,o,B,f)}}_isNodeInContainer(mm){return mm instanceof p.b&&-1!==this.meshes.indexOf(mm)||(mm instanceof w.c&&-1!==this.transformNodes.indexOf(mm)||(mm instanceof q.c&&-1!==this.lights.indexOf(mm)||mm instanceof x.b&&-1!==this.cameras.indexOf(mm)))}_isValidHierarchy(){for(const mm of this.meshes)if(mm.parent&&!this._isNodeInContainer(mm.parent))return K.e.Warn(`Node ${mm.name} has a parent that is not in the container.`),!1;for(const mm of this.transformNodes)if(mm.parent&&!this._isNodeInContainer(mm.parent))return K.e.Warn(`Node ${mm.name} has a parent that is not in the container.`),!1;for(const mm of this.lights)if(mm.parent&&!this._isNodeInContainer(mm.parent))return K.e.Warn(`Node ${mm.name} has a parent that is not in the container.`),!1;for(const mm of this.cameras)if(mm.parent&&!this._isNodeInContainer(mm.parent))return K.e.Warn(`Node ${mm.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||B.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const f={},O={},w=new l,p=[],K=[],z={doNotInstantiate:!0,...u},Y=[],q=new Set;for(const B of this.transformNodes)null===B.parent&&this._addNodeAndDescendantsToList(Y,q,B,z.predicate);for(const B of this.meshes)null===B.parent&&this._addNodeAndDescendantsToList(Y,q,B,z.predicate);const x=this._topologicalSort(Y),H=(u,B)=>{if(((o,u)=>{if(f[o.uniqueId]=u.uniqueId,O[u.uniqueId]=u,mm&&(u.name=mm(o.name)),u instanceof r.d){const mm=u;if(mm.morphTargetManager){const u=o.morphTargetManager;mm.morphTargetManager=u.clone();for(let o=0;o<u.numTargets;o++){const B=u.getTarget(o),r=mm.morphTargetManager.getTarget(o);f[B.uniqueId]=r.uniqueId,O[r.uniqueId]=r}}}})(u,B),u.parent){const mm=f[u.parent.uniqueId],o=O[mm];B.parent=o||u.parent}if(B.position&&u.position&&B.position.p(u.position),B.rotationQuaternion&&u.rotationQuaternion&&B.rotationQuaternion.p(u.rotationQuaternion),B.rotation&&u.rotation&&B.rotation.p(u.rotation),B.rp&&u.rp&&B.rp.p(u.rp),B.material){const r=B;if(r.material)if(o){const o=u.material;if(-1===K.indexOf(o)){let u=o.clone(mm?mm(o.name):"Clone of "+o.name);if(K.push(o),f[o.uniqueId]=u.uniqueId,O[u.uniqueId]=u,"MultiMaterial"===o.getClassName()){const B=o;for(const o of B.Kp)o&&(u=o.clone(mm?mm(o.name):"Clone of "+o.name),K.push(o),f[o.uniqueId]=u.uniqueId,O[u.uniqueId]=u);B.Kp=B.Kp.map((mm=>mm&&O[f[mm.uniqueId]]))}}"InstancedMesh"!==r.getClassName()&&(r.material=O[f[o.uniqueId]])}else"MultiMaterial"===r.material.getClassName()?-1===this.bo.multiMaterials.indexOf(r.material)&&this.bo.addMultiMaterial(r.material):-1===this.bo.materials.indexOf(r.material)&&this.bo.addMaterial(r.material)}null===B.parent&&w.rootNodes.push(B)};for(const B of x)if("InstancedMesh"===B.getClassName()){const mm=B,o=mm.sourceMesh,u=f[o.uniqueId];H(mm,("number"===typeof u?O[u]:o).createInstance(mm.name))}else{let mm=!0;"nz"===B.getClassName()||"Node"===B.getClassName()||B.skeleton||!B.getTotalVertices||0===B.getTotalVertices()?mm=!1:z.doNotInstantiate&&(mm="function"===typeof z.doNotInstantiate?!z.doNotInstantiate(B):!z.doNotInstantiate);const o=mm?B.createInstance(`instance of ${B.name}`):B.clone(`Clone of ${B.name}`,null,!0);if(!o)throw new Error(`Could not clone or instantiate node on Asset Container ${B.name}`);H(B,o)}for(const B of this.skeletons){if(z.predicate&&!z.predicate(B))continue;const o=B.clone(mm?mm(B.name):"Clone of "+B.name);for(const mm of this.meshes)if(mm.skeleton===B&&!mm.isAnInstance){const u=O[f[mm.uniqueId]];if(!u||u.isAnInstance)continue;if(u.skeleton=o,-1!==p.indexOf(o))continue;p.push(o);for(const mm of o.bones)mm._linkedTransformNode&&(mm._linkedTransformNode=O[f[mm._linkedTransformNode.uniqueId]])}w.skeletons.push(o)}for(const B of this.animationGroups){if(z.predicate&&!z.predicate(B))continue;const o=B.clone(mm?mm(B.name):"Clone of "+B.name,(mm=>O[f[mm.uniqueId]]||mm));w.animationGroups.push(o)}return w}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||B.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.bo.environmentTexture=this.environmentTexture);for(const mm of this.bo._serializableComponents)mm.addFromContainer(this);this.bo.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const o=[];for(const u of this.cameras)mm&&!mm(u)||(this.bo.addCamera(u),o.push(u));for(const u of this.lights)mm&&!mm(u)||(this.bo.addLight(u),o.push(u));for(const u of this.meshes)mm&&!mm(u)||(this.bo.vz(u),o.push(u));for(const u of this.skeletons)mm&&!mm(u)||this.bo.addSkeleton(u);for(const u of this.animations)mm&&!mm(u)||this.bo.addAnimation(u);for(const u of this.animationGroups)mm&&!mm(u)||this.bo.addAnimationGroup(u);for(const u of this.multiMaterials)mm&&!mm(u)||this.bo.addMultiMaterial(u);for(const u of this.materials)mm&&!mm(u)||this.bo.addMaterial(u);for(const u of this.morphTargetManagers)mm&&!mm(u)||this.bo.addMorphTargetManager(u);for(const u of this.geometries)mm&&!mm(u)||this.bo.addGeometry(u);for(const u of this.transformNodes)mm&&!mm(u)||(this.bo.addTransformNode(u),o.push(u));for(const u of this.actionManagers)mm&&!mm(u)||this.bo.addActionManager(u);for(const u of this.textures)mm&&!mm(u)||this.bo.addTexture(u);for(const u of this.reflectionProbes)mm&&!mm(u)||this.bo.addReflectionProbe(u);for(const u of o)u.parent&&-1===this.bo.getNodes().indexOf(u.parent)&&(u.setParent?u.setParent(null):u.parent=null)}removeAllFromScene(){this._isValidHierarchy()||B.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.bo.environmentTexture&&(this.bo.environmentTexture=null);for(const mm of this.bo._serializableComponents)mm.removeFromContainer(this)}removeFromScene(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const o of this.cameras)mm&&!mm(o)||this.bo.removeCamera(o);for(const o of this.lights)mm&&!mm(o)||this.bo.removeLight(o);for(const o of this.meshes)mm&&!mm(o)||this.bo.Cz(o,!0);for(const o of this.skeletons)mm&&!mm(o)||this.bo.removeSkeleton(o);for(const o of this.animations)mm&&!mm(o)||this.bo.removeAnimation(o);for(const o of this.animationGroups)mm&&!mm(o)||this.bo.removeAnimationGroup(o);for(const o of this.multiMaterials)mm&&!mm(o)||this.bo.removeMultiMaterial(o);for(const o of this.materials)mm&&!mm(o)||this.bo.removeMaterial(o);for(const o of this.morphTargetManagers)mm&&!mm(o)||this.bo.removeMorphTargetManager(o);for(const o of this.geometries)mm&&!mm(o)||this.bo.removeGeometry(o);for(const o of this.transformNodes)mm&&!mm(o)||this.bo.removeTransformNode(o);for(const o of this.actionManagers)mm&&!mm(o)||this.bo.removeActionManager(o);for(const o of this.textures)mm&&!mm(o)||this.bo.removeTexture(o);for(const o of this.reflectionProbes)mm&&!mm(o)||this.bo.removeReflectionProbe(o)}dispose(){const mm=this.cameras.slice(0);for(const x of mm)x.dispose();this.cameras.length=0;const o=this.lights.slice(0);for(const x of o)x.dispose();this.lights.length=0;const u=this.meshes.slice(0);for(const x of u)x.dispose();this.meshes.length=0;const f=this.skeletons.slice(0);for(const x of f)x.dispose();this.skeletons.length=0;const B=this.animationGroups.slice(0);for(const x of B)x.dispose();this.animationGroups.length=0;const O=this.multiMaterials.slice(0);for(const x of O)x.dispose();this.multiMaterials.length=0;const r=this.materials.slice(0);for(const x of r)x.dispose();this.materials.length=0;const w=this.geometries.slice(0);for(const x of w)x.dispose();this.geometries.length=0;const p=this.transformNodes.slice(0);for(const x of p)x.dispose();this.transformNodes.length=0;const K=this.actionManagers.slice(0);for(const x of K)x.dispose();this.actionManagers.length=0;const z=this.textures.slice(0);for(const x of z)x.dispose();this.textures.length=0;const Y=this.reflectionProbes.slice(0);for(const x of Y)x.dispose();this.reflectionProbes.length=0;const q=this.morphTargetManagers.slice(0);for(const x of q)x.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const x of this.bo._serializableComponents)x.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.bo.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(mm,o,u){if(mm&&o)for(const f of mm){let mm=!0;if(u)for(const o of u)if(f===o){mm=!1;break}mm&&(o.push(f),f._parentContainer=this)}}moveAllFromScene(mm){this._wasAddedToScene=!1,void 0===mm&&(mm=new M);for(const o in this)Object.prototype.hasOwnProperty.call(this,o)&&(this[o]=this[o]||("_environmentTexture"===o?null:[]),this._moveAssets(this.bo[o],this[o],mm[o]));this.environmentTexture=this.bo.environmentTexture,this.removeAllFromScene()}createRootMesh(){const mm=new r.d("assetContainerRootMesh",this.bo);for(const o of this.meshes)o.parent||mm.addChild(o);return this.meshes.unshift(mm),mm}mergeAnimationsTo(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.d.LastCreatedScene,o=arguments.length>1?arguments[1]:void 0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!mm)return K.e.Error("No scene available to merge animations to"),[];const f=u||(o=>{let u=null;const f=o.animations.length?o.animations[0].targetProperty:"",B=o.name.split(".").join("").split("_primitive")[0];switch(f){case"position":case"rotationQuaternion":u=mm.getTransformNodeByName(o.name)||mm.getTransformNodeByName(B);break;case"influence":u=mm.getMorphTargetByName(o.name)||mm.getMorphTargetByName(B);break;default:u=mm.getNodeByName(o.name)||mm.getNodeByName(B)}return u}),B=this.getNodes();for(const w of B){const mm=f(w);if(null!==mm){for(const o of w.animations){const u=mm.animations.filter((mm=>mm.targetProperty===o.targetProperty));for(const o of u){const u=mm.animations.indexOf(o,0);u>-1&&mm.animations.splice(u,1)}}mm.animations=mm.animations.concat(w.animations)}}const O=[],r=this.animationGroups.slice();for(const w of r){O.push(w.clone(w.name,f));for(const mm of w.animatables)mm.stop()}for(const w of o){const o=f(w.target);o&&(mm.beginAnimation(o,w.fromFrame,w.toFrame,w.loopAnimation,w.speedRatio,w.onAnimationEnd?w.onAnimationEnd:void 0,void 0,!0,void 0,w.onAnimationLoop?w.onAnimationLoop:void 0),mm.stopAnimation(w.target))}return O}populateRootNodes(){this.rootNodes.length=0;for(const mm of this.meshes)mm.parent||-1!==this.rootNodes.indexOf(mm)||this.rootNodes.push(mm);for(const mm of this.transformNodes)mm.parent||-1!==this.rootNodes.indexOf(mm)||this.rootNodes.push(mm);for(const mm of this.lights)mm.parent||-1!==this.rootNodes.indexOf(mm)||this.rootNodes.push(mm);for(const mm of this.cameras)mm.parent||-1!==this.rootNodes.indexOf(mm)||this.rootNodes.push(mm)}addAllAssetsToContainer(mm){if(!mm)return;const o=[],u=new Set;for(o.push(mm);o.length>0;){const mm=o.pop();if(mm instanceof r.d?(mm.br&&-1===this.geometries.indexOf(mm.br)&&this.geometries.push(mm.br),this.meshes.push(mm)):mm instanceof Y.b?this.meshes.push(mm):mm instanceof w.c?this.transformNodes.push(mm):mm instanceof q.c?this.lights.push(mm):mm instanceof x.b&&this.cameras.push(mm),mm instanceof p.b){if(mm.material&&-1===this.materials.indexOf(mm.material)){this.materials.push(mm.material);for(const o of mm.material.getActiveTextures())-1===this.textures.indexOf(o)&&this.textures.push(o)}mm.skeleton&&-1===this.skeletons.indexOf(mm.skeleton)&&this.skeletons.push(mm.skeleton),mm.morphTargetManager&&-1===this.morphTargetManagers.indexOf(mm.morphTargetManager)&&this.morphTargetManagers.push(mm.morphTargetManager)}for(const f of mm.getChildren())u.has(f)||o.push(f);u.add(mm)}this.populateRootNodes()}_getByTags(mm,o,u){if(void 0===o)return mm;const f=[];for(const B in mm){const O=mm[B];H.e&&H.e.MatchesQuery(O,o)&&(!u||u(O))&&f.push(O)}return f}getMeshesByTags(mm,o){return this._getByTags(this.meshes,mm,o)}getCamerasByTags(mm,o){return this._getByTags(this.cameras,mm,o)}getLightsByTags(mm,o){return this._getByTags(this.lights,mm,o)}getMaterialsByTags(mm,o){return this._getByTags(this.materials,mm,o).concat(this._getByTags(this.multiMaterials,mm,o))}getTransformNodesByTags(mm,o){return this._getByTags(this.transformNodes,mm,o)}}var Q=u(12617);class b{constructor(mm){this.byteOffset=0,this.buffer=mm}async loadAsync(mm){const o=await this.buffer.readAsync(this.byteOffset,mm);this._dataView=new DataView(o.buffer,o.byteOffset,o.byteLength),this._dataByteOffset=0}readUint32(){const mm=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,mm}readUint8Array(mm){const o=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,mm);return this._dataByteOffset+=mm,this.byteOffset+=mm,o}readString(mm){return(0,Q.h)(this.readUint8Array(mm))}skipBytes(mm){this._dataByteOffset+=mm,this.byteOffset+=mm}}var J=u(14197);const N="Z2xURg",S={name:"Af",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:mm=>-1!==mm.indexOf("asset")&&-1!==mm.indexOf("version")||mm.startsWith("data:base64,"+N)||mm.startsWith("data:;base64,"+N)||mm.startsWith("data:application/octet-stream;base64,"+N)||mm.startsWith("data:model/gltf-binary;base64,"+N)};var P,R,g,W=u(12605),F=u(12610);function c(mm,o,u){try{return Promise.resolve(new Uint8Array(mm,o,u))}catch(f){return Promise.reject(f)}}!function(mm){mm[mm.AUTO=0]="AUTO",mm[mm.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(P||(P={})),function(mm){mm[mm.NONE=0]="NONE",mm[mm.FIRST=1]="FIRST",mm[mm.ALL=2]="ALL"}(R||(R={})),function(mm){mm[mm.LOADING=0]="LOADING",mm[mm.READY=1]="READY",mm[mm.COMPLETE=2]="COMPLETE"}(g||(g={}));class A{constructor(){this.coordinateSystemMode=P.AUTO,this.animationStartMode=R.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=mm=>Promise.resolve(mm),this.extensionOptions={}}p(mm){mm&&(this.onParsed=mm.onParsed,this.coordinateSystemMode=mm.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=mm.animationStartMode??this.animationStartMode,this.loadNodeAnimations=mm.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=mm.loadSkins??this.loadSkins,this.loadMorphTargets=mm.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=mm.compileMaterials??this.compileMaterials,this.useClipPlane=mm.useClipPlane??this.useClipPlane,this.compileShadowGenerators=mm.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=mm.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=mm.useRangeRequests??this.useRangeRequests,this.createInstances=mm.createInstances??this.createInstances,this.alwaysComputeBoundingBox=mm.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=mm.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=mm.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=mm.skipMaterials??this.skipMaterials,this.useSRGBBuffers=mm.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=mm.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=mm.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=mm.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=mm.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=mm.customRootNode,this.onMeshLoaded=mm.onMeshLoaded,this.onSkinLoaded=mm.onSkinLoaded,this.onTextureLoaded=mm.onTextureLoaded,this.onMaterialLoaded=mm.onMaterialLoaded,this.onCameraLoaded=mm.onCameraLoaded,this.extensionOptions=mm.extensionOptions??this.extensionOptions)}}class y extends A{constructor(mm){super(),this.onParsedObservable=new f.d,this.onMeshLoadedObservable=new f.d,this.onSkinLoadedObservable=new f.d,this.onTextureLoadedObservable=new f.d,this.onMaterialLoadedObservable=new f.d,this.onCameraLoadedObservable=new f.d,this.onCompleteObservable=new f.d,this.onErrorObservable=new f.d,this.Jf=new f.d,this.onExtensionLoadedObservable=new f.d,this.validate=!1,this.onValidatedObservable=new f.d,this._loader=null,this._state=null,this._requests=new Array,this.name=S.name,this.extensions=S.extensions,this.onLoaderStateChangedObservable=new f.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(mm)}set onParsed(mm){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),mm&&(this._onParsedObserver=this.onParsedObservable.add(mm))}set onMeshLoaded(mm){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),mm&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(mm))}set onSkinLoaded(mm){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),mm&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((o=>mm(o.node,o.skinnedNode))))}set onTextureLoaded(mm){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),mm&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(mm))}set onMaterialLoaded(mm){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),mm&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(mm))}set onCameraLoaded(mm){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),mm&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(mm))}set onComplete(mm){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(mm)}set onError(mm){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(mm)}set onDispose(mm){this._onDisposeObserver&&this.Jf.remove(this._onDisposeObserver),this._onDisposeObserver=this.Jf.add(mm)}set onExtensionLoaded(mm){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(mm)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(mm){this._loggingEnabled!==mm&&(this._loggingEnabled=mm,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(mm){this._capturePerformanceCounters!==mm&&(this._capturePerformanceCounters=mm,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(mm){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(mm)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const mm of this._requests)mm.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=mm=>Promise.resolve(mm),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Jf.notifyObservers(void 0),this.Jf.clear()}loadFile(mm,o,u,O,r,w,p,z){if(ArrayBuffer.isView(o))return this._loadBinary(mm,o,u,O,p,z),null;this._progressCallback=r;const Y=o.name||B.Tools.GetFilename(o);if(w){if(this.useRangeRequests){this.validate&&K.e.Warn("glTF validation is not supported when range requests are enabled");const u={abort:()=>{},onCompleteObservable:new f.d},B={readAsync:(u,f)=>new Promise(((B,O)=>{this._loadFile(mm,o,(mm=>{B(new Uint8Array(mm))}),!0,(mm=>{O(mm)}),(mm=>{mm.setRequestHeader("Range",`bytes=${u}-${u+f-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new b(B)).then((mm=>{u.onCompleteObservable.notifyObservers(u),O(mm)}),p?mm=>p(void 0,mm):void 0),u}return this._loadFile(mm,o,(o=>{this._validate(mm,new Uint8Array(o,0,o.byteLength),u,Y),this._unpackBinaryAsync(new b({readAsync:(mm,u)=>c(o,mm,u),byteLength:o.byteLength})).then((mm=>{O(mm)}),p?mm=>p(void 0,mm):void 0)}),!0,p)}return this._loadFile(mm,o,(o=>{try{this._validate(mm,o,u,Y),O({json:this._parseJson(o)})}catch{p&&p()}}),!1,p)}_loadBinary(mm,o,u,f,B,O){this._validate(mm,new Uint8Array(o.buffer,o.byteOffset,o.byteLength),u,O),this._unpackBinaryAsync(new b({readAsync:(mm,u)=>function(mm,o,u){try{if(o<0||o>=mm.byteLength)throw new RangeError("Offset is out of range.");if(o+u>mm.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(mm.buffer,mm.byteOffset+o,u))}catch(f){return Promise.reject(f)}}(o,mm,u),byteLength:o.byteLength})).then((mm=>{f(mm)}),B?mm=>B(void 0,mm):void 0)}importMeshAsync(mm,o,u,f,B,O){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(u),this.onParsedObservable.clear(),this._log(`Loading ${O||""}`),this._loader=this._getLoader(u),this._loader.importMeshAsync(mm,o,null,u,f,B,O))))}loadAsync(mm,o,u,f,B){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(o),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(o),this._loader.loadAsync(mm,o,u,f,B))))}loadAssetContainerAsync(mm,o,u,f,B){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(o),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(o);const O=new t(mm),r=[];this.onMaterialLoadedObservable.add((mm=>{r.push(mm)}));const w=[];this.onTextureLoadedObservable.add((mm=>{w.push(mm)}));const p=[];this.onCameraLoadedObservable.add((mm=>{p.push(mm)}));const K=[];return this.onMeshLoadedObservable.add((mm=>{mm.morphTargetManager&&K.push(mm.morphTargetManager)})),this._loader.importMeshAsync(null,mm,O,o,u,f,B).then((mm=>(Array.prototype.push.apply(O.geometries,mm.geometries),Array.prototype.push.apply(O.meshes,mm.meshes),Array.prototype.push.apply(O.kq,mm.kq),Array.prototype.push.apply(O.skeletons,mm.skeletons),Array.prototype.push.apply(O.animationGroups,mm.animationGroups),Array.prototype.push.apply(O.materials,r),Array.prototype.push.apply(O.textures,w),Array.prototype.push.apply(O.lights,mm.lights),Array.prototype.push.apply(O.transformNodes,mm.transformNodes),Array.prototype.push.apply(O.cameras,p),Array.prototype.push.apply(O.morphTargetManagers,K),O)))}))}canDirectLoad(mm){return S.canDirectLoad(mm)}directLoad(mm,o){if(o.startsWith("base64,"+N)||o.startsWith(";base64,"+N)||o.startsWith("application/octet-stream;base64,"+N)||o.startsWith("model/gltf-binary;base64,"+N)){const u=(0,W.e)(o);return this._validate(mm,new Uint8Array(u,0,u.byteLength)),this._unpackBinaryAsync(new b({readAsync:(mm,o)=>c(u,mm,o),byteLength:u.byteLength}))}return this._validate(mm,o),Promise.resolve({json:this._parseJson(o)})}createPlugin(mm){return new y(mm[S.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((mm,o)=>{this.onCompleteObservable.addOnce((()=>{mm()})),this.onErrorObservable.addOnce((mm=>{o(mm)}))}))}_setState(mm){this._state!==mm&&(this._state=mm,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(g[this._state]))}_loadFile(mm,o,u,f,B,O){const r=mm._loadFile(o,u,(mm=>{this._onProgress(mm,r)}),!0,f,B,O);return r.onCompleteObservable.add((()=>{r._lengthComputable=!0,r._total=r._loaded})),this._requests.push(r),r}_onProgress(mm,o){if(!this._progressCallback)return;o._lengthComputable=mm.lengthComputable,o._loaded=mm.loaded,o._total=mm.total;let u=!0,f=0,B=0;for(const O of this._requests){if(void 0===O._lengthComputable||void 0===O._loaded||void 0===O._total)return;u=u&&O._lengthComputable,f+=O._loaded,B+=O._total}this._progressCallback({lengthComputable:u,loaded:f,total:u?B:0})}_validate(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),J.d.ValidateAsync(o,u,f,(o=>this.preprocessUrlAsync(u+o).then((o=>mm._loadFileAsync(o,void 0,!0,!0).then((mm=>new Uint8Array(mm,0,mm.byteLength))))))).then((mm=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(mm),this.onValidatedObservable.clear()}),(mm=>{this._endPerformanceCounter("Validate JSON"),B.Tools.Warn(`Failed to validate: ${mm.message}`),this.onValidatedObservable.clear()})))}_getLoader(mm){const o=mm.json.asset||{};this._log(`Asset version: ${o.version}`),o.minVersion&&this._log(`Asset minimum version: ${o.minVersion}`),o.generator&&this._log(`Asset generator: ${o.generator}`);const u=y._parseVersion(o.version);if(!u)throw new Error("Invalid version: "+o.version);if(void 0!==o.minVersion){const mm=y._parseVersion(o.minVersion);if(!mm)throw new Error("Invalid minimum version: "+o.minVersion);if(y._compareVersion(mm,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+o.minVersion)}const f={1:y._CreateGLTF1Loader,2:y._CreateGLTF2Loader}[u.major];if(!f)throw new Error("Unsupported version: "+o.version);return f(this)}_parseJson(mm){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${mm.length}`);const o=JSON.parse(mm);return this._endPerformanceCounter("Parse JSON"),o}_unpackBinaryAsync(mm){return this._startPerformanceCounter("Unpack Binary"),mm.loadAsync(20).then((()=>{const o=mm.readUint32();if(1179937895!==o)throw new F.j("Unexpected magic: "+o,F.h.GLTFLoaderUnexpectedMagicError);const u=mm.readUint32();this.loggingEnabled&&this._log(`Binary version: ${u}`);const f=mm.readUint32();let B;switch(this.useRangeRequests||f===mm.buffer.byteLength||K.e.Warn(`Length in header does not match actual data length: ${f} != ${mm.buffer.byteLength}`),u){case 1:B=this._unpackBinaryV1Async(mm,f);break;case 2:B=this._unpackBinaryV2Async(mm,f);break;default:throw new Error("Unsupported version: "+u)}return this._endPerformanceCounter("Unpack Binary"),B}))}_unpackBinaryV1Async(mm,o){const u=mm.readUint32(),f=mm.readUint32();if(0!==f)throw new Error(`Unexpected content format: ${f}`);const B=o-mm.byteOffset,O={json:this._parseJson(mm.readString(u)),bin:null};if(0!==B){const o=mm.byteOffset;O.bin={readAsync:(u,f)=>mm.buffer.readAsync(o+u,f),byteLength:B}}return Promise.resolve(O)}_unpackBinaryV2Async(mm,o){const u=1313821514,f=5130562,B=mm.readUint32();if(mm.readUint32()!==u)throw new Error("First chunk format is not JSON");return mm.byteOffset+B===o?mm.loadAsync(B).then((()=>({json:this._parseJson(mm.readString(B)),bin:null}))):mm.loadAsync(B+8).then((()=>{const O={json:this._parseJson(mm.readString(B)),bin:null},r=()=>{const B=mm.readUint32();switch(mm.readUint32()){case u:throw new Error("Unexpected JSON chunk");case f:{const o=mm.byteOffset;O.bin={readAsync:(u,f)=>mm.buffer.readAsync(o+u,f),byteLength:B},mm.skipBytes(B);break}default:mm.skipBytes(B)}return mm.byteOffset!==o?mm.loadAsync(8).then(r):Promise.resolve(O)};return r()}))}static _parseVersion(mm){if("1.0"===mm||"1.0.1"===mm)return{major:1,minor:0};const o=(mm+"").match(/^(\d+)\.(\d+)/);return o?{major:parseInt(o[1]),minor:parseInt(o[2])}:null}static _compareVersion(mm,o){return mm.major>o.major?1:mm.major<o.major?-1:mm.minor>o.minor?1:mm.minor<o.minor?-1:0}_logOpen(mm){this._log(mm),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(mm){const o=y._logSpaces.substring(0,2*this._logIndentLevel);K.e.Log(`${o}${mm}`)}_logDisabled(mm){}_startPerformanceCounterEnabled(mm){B.Tools.StartPerformanceCounter(mm)}_startPerformanceCounterDisabled(mm){}_endPerformanceCounterEnabled(mm){B.Tools.EndPerformanceCounter(mm)}_endPerformanceCounterDisabled(mm){}}y.IncrementalLoading=!0,y.HomogeneousCoordinates=!1,y._logSpaces="                                ",(0,O.d)(new y)},14197:(mm,o,u)=>{"use strict";u.d(o,{d:()=>r});var f=u(12549);function B(mm,o,u,f){const B={externalResourceFunction:f};return u&&(B.uri="file:"===o?u:o+u),ArrayBuffer.isView(mm)?GLTFValidator.validateBytes(mm,B):GLTFValidator.validateString(mm,B)}function O(){const mm=[];onmessage=o=>{const u=o.data;switch(u.id){case"init":importScripts(u.url);break;case"validate":B(u.data,u.rootUrl,u.fileName,(o=>new Promise(((u,f)=>{const B=mm.length;mm.push({resolve:u,reject:f}),postMessage({id:"getExternalResource",index:B,uri:o})})))).then((mm=>{postMessage({id:"validate.resolve",value:mm})}),(mm=>{postMessage({id:"validate.reject",reason:mm})}));break;case"getExternalResource.resolve":mm[u.index].resolve(u.value);break;case"getExternalResource.reject":mm[u.index].reject(u.reason)}}}class r{static ValidateAsync(mm,o,u,r){return"function"===typeof Worker?new Promise(((w,p)=>{const K=`${B}(${O})()`,z=URL.createObjectURL(new Blob([K],{type:"application/javascript"})),Y=new Worker(z),q=mm=>{Y.removeEventListener("error",q),Y.removeEventListener("message",x),p(mm)},x=mm=>{const o=mm.data;switch(o.id){case"getExternalResource":r(o.uri).then((mm=>{Y.postMessage({id:"getExternalResource.resolve",index:o.index,value:mm},[mm.buffer])}),(mm=>{Y.postMessage({id:"getExternalResource.reject",index:o.index,reason:mm})}));break;case"validate.resolve":Y.removeEventListener("error",q),Y.removeEventListener("message",x),w(o.value),Y.terminate();break;case"validate.reject":Y.removeEventListener("error",q),Y.removeEventListener("message",x),p(o.reason),Y.terminate()}};if(Y.addEventListener("error",q),Y.addEventListener("message",x),Y.postMessage({id:"init",url:f.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(mm)){const f=mm.slice();Y.postMessage({id:"validate",data:f,rootUrl:o,fileName:u},[f.buffer])}else Y.postMessage({id:"validate",data:mm,rootUrl:o,fileName:u})})):(this._LoadScriptPromise||(this._LoadScriptPromise=f.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>B(mm,o,u,r))))}}r.Configuration={url:`${f.Tools._DefaultCdnUrl}/gltf_validator.js`}},14808:(mm,o,u)=>{"use strict";u.d(o,{e:()=>S});var f=u(12729),B=u(12732),O=u(12766),r=u(12740),w=u(13109),p=u(13041),K=u(12809),z=u(12965),Y=u(12702),q=u(12652);u(13965),u(13865),u(13883),u(13871),u(13889),u(13891),u(13899);const x="imageProcessingCompatibility",H="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";q.e.IncludesShadersStore[x]||(q.e.IncludesShadersStore[x]=H);const E="skyPixelShader",M="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";q.e.ShadersStore[E]||(q.e.ShadersStore[E]=M);u(13975),u(13904),u(13911),u(13921),u(13915);const l="skyVertexShader",t="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";q.e.ShadersStore[l]||(q.e.ShadersStore[l]=t);var Q=u(13037),b=u(13093),J=u(13088);class N extends w.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class S extends p.d{constructor(mm,o){super(mm,o),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new r.lo(0,100,0),this.useSunPosition=!1,this.cameraOffset=r.lo.Zero(),this.up=r.lo.Up(),this.dithering=!1,this._cameraPosition=r.lo.Zero(),this._skyOrientation=new r.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(mm,o){const u=o._drawWrapper;if(this.isFrozen&&u.effect&&u._wasPreviouslyReady)return!0;o.materialDefines||(o.materialDefines=new N);const f=o.materialDefines,B=this.Pm();if(this._isReadyForSubMesh(o))return!0;if((0,J.U)(mm,B,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,f),(0,J.I)(mm,f,!0,!1),f.IMAGEPROCESSINGPOSTPROCESS!==B.imageProcessingConfiguration.applyByPostProcess&&f.markAsMiscDirty(),f.DITHER!==this.dithering&&f.markAsMiscDirty(),f.isDirty){f.markAsProcessed(),B.resetCachedMaterial();const mm=new Q.e;f.FOG&&mm.addFallback(1,"FOG"),f.IMAGEPROCESSINGPOSTPROCESS=B.imageProcessingConfiguration.applyByPostProcess,f.DITHER=this.dithering;const u=[K.f.PositionKind];f.VERTEXCOLOR&&u.push(K.f.ColorKind);const O="sky",r=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,b.e)(r);const w=f.toString();o.setEffect(B.getEngine().createEffect(O,u,r,[],w,mm,this.onCompiled,this.onError),f,this._materialContext)}return!(!o.effect||!o.effect.isReady())&&(f._renderId=B.getRenderId(),u._wasPreviouslyReady=!0,!0)}bindForSubMesh(mm,o,u){const f=this.Pm(),B=u.materialDefines;if(!B)return;const O=u.effect;if(!O)return;this._activeEffect=O,this.bindOnlyWorldMatrix(mm),this._activeEffect.setMatrix("viewProjection",f.getTransformMatrix()),this._mustRebind(f,O,u)&&((0,b.h)(O,this,f),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,J.k)(B,O,f)),f.fogEnabled&&o.applyFog&&f.fogMode!==z.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",f.getViewMatrix()),(0,J.f)(f,o,this._activeEffect);const w=f.activeCamera;if(w){const mm=w.getWorldMatrix();this._cameraPosition.x=mm.m[12],this._cameraPosition.y=mm.m[13],this._cameraPosition.z=mm.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const mm=Math.PI*(this.inclination-.5),o=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(o)*Math.cos(mm),this.sunPosition.y=this.distance*Math.sin(-mm),this.sunPosition.z=this.distance*Math.sin(o)*Math.cos(mm),r.Quaternion.FromUnitVectorsToRef(r.lo.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(o,this._activeEffect,u)}getAnimatables(){return[]}dispose(mm){super.dispose(mm)}clone(mm){return O.c.Clone((()=>new S(mm,this.Pm())),this)}serialize(){const mm=super.serialize();return mm.customType="BABYLON.SkyMaterial",mm}getClassName(){return"SkyMaterial"}static Parse(mm,o,u){return O.c.Parse((()=>new S(mm.name,o)),mm,o,u)}}(0,f.d)([(0,B.J)()],S.prototype,"luminance",void 0),(0,f.d)([(0,B.J)()],S.prototype,"turbidity",void 0),(0,f.d)([(0,B.J)()],S.prototype,"rayleigh",void 0),(0,f.d)([(0,B.J)()],S.prototype,"mieCoefficient",void 0),(0,f.d)([(0,B.J)()],S.prototype,"mieDirectionalG",void 0),(0,f.d)([(0,B.J)()],S.prototype,"distance",void 0),(0,f.d)([(0,B.J)()],S.prototype,"inclination",void 0),(0,f.d)([(0,B.J)()],S.prototype,"azimuth",void 0),(0,f.d)([(0,B.F)()],S.prototype,"sunPosition",void 0),(0,f.d)([(0,B.J)()],S.prototype,"useSunPosition",void 0),(0,f.d)([(0,B.F)()],S.prototype,"cameraOffset",void 0),(0,f.d)([(0,B.F)()],S.prototype,"up",void 0),(0,f.d)([(0,B.J)()],S.prototype,"dithering",void 0),(0,Y.c)("BABYLON.SkyMaterial",S)},13403:(mm,o,u)=>{"use strict";function f(mm,o){o.headers=mm.headers||{},o.statusMessage=mm.statusText,o.statusCode=mm.status,o.data=mm.response}function B(mm,o,u){return new Promise((function(B,O){u=u||{};var r,w,p,K=new XMLHttpRequest,z=u.body,Y=u.headers||{};for(r in u.timeout&&(K.timeout=u.timeout),K.ontimeout=K.onerror=function(mm){mm.timeout="timeout"==mm.type,O(mm)},K.open(mm,o.href||o),K.onload=function(){for(p=K.getAllResponseHeaders().trim().split(/[\r\n]+/),f(K,K);w=p.shift();)w=w.split(": "),K.headers[w.shift().toLowerCase()]=w.join(": ");if((w=K.headers["content-type"])&&~w.indexOf("application/json"))try{K.data=JSON.parse(K.data,u.reviver)}catch(mm){return f(K,mm),O(mm)}(K.status>=400?O:B)(K)},typeof FormData<"u"&&z instanceof FormData||z&&"object"==typeof z&&(Y["content-type"]="application/json",z=JSON.stringify(z)),K.withCredentials=!!u.withCredentials,Y)K.setRequestHeader(r,Y[r]);K.send(z)}))}u.r(o),u.d(o,{del:()=>p,get:()=>O,patch:()=>w,post:()=>r,put:()=>K,send:()=>B});var O=B.bind(B,"GET"),r=B.bind(B,"POST"),w=B.bind(B,"PATCH"),p=B.bind(B,"DELETE"),K=B.bind(B,"PUT")},14913:(mm,o,u)=>{"use strict";u.d(o,{b:()=>Y});const f=.5*(Math.sqrt(3)-1),B=(3-Math.sqrt(3))/6,O=1/3,r=1/6,w=(Math.sqrt(5)-1)/4,p=(5-Math.sqrt(5))/20,K=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),z=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const Y=class{constructor(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const o="function"==typeof mm?mm:function(mm){let o=0,u=0,f=0,B=1;const O=function(){let mm=4022871197;return function(o){o=o.toString();for(let u=0;u<o.length;u++){mm+=o.charCodeAt(u);let f=.02519603282416938*mm;mm=f>>>0,f-=mm,f*=mm,mm=f>>>0,f-=mm,mm+=4294967296*f}return 2.3283064365386963e-10*(mm>>>0)}}();o=O(" "),u=O(" "),f=O(" "),o-=O(mm),o<0&&(o+=1);u-=O(mm),u<0&&(u+=1);f-=O(mm),f<0&&(f+=1);return function(){const mm=2091639*o+2.3283064365386963e-10*B;return o=u,u=f,f=mm-(B=0|mm)}}(mm);this.p=function(mm){const o=new Uint8Array(256);for(let u=0;u<256;u++)o[u]=u;for(let u=0;u<255;u++){const f=u+~~(mm()*(256-u)),B=o[u];o[u]=o[f],o[f]=B}return o}(o),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let u=0;u<512;u++)this.perm[u]=this.p[255&u],this.permMod12[u]=this.perm[u]%12}noise2D(mm,o){const u=this.permMod12,O=this.perm;let r=0,w=0,p=0;const z=(mm+o)*f,Y=Math.floor(mm+z),q=Math.floor(o+z),x=(Y+q)*B,H=mm-(Y-x),E=o-(q-x);let M,l;H>E?(M=1,l=0):(M=0,l=1);const t=H-M+B,Q=E-l+B,b=H-1+2*B,J=E-1+2*B,N=255&Y,S=255&q;let P=.5-H*H-E*E;if(P>=0){const mm=3*u[N+O[S]];P*=P,r=P*P*(K[mm]*H+K[mm+1]*E)}let R=.5-t*t-Q*Q;if(R>=0){const mm=3*u[N+M+O[S+l]];R*=R,w=R*R*(K[mm]*t+K[mm+1]*Q)}let g=.5-b*b-J*J;if(g>=0){const mm=3*u[N+1+O[S+1]];g*=g,p=g*g*(K[mm]*b+K[mm+1]*J)}return 70*(r+w+p)}noise3D(mm,o,u){const f=this.permMod12,B=this.perm;let w,p,z,Y;const q=(mm+o+u)*O,x=Math.floor(mm+q),H=Math.floor(o+q),E=Math.floor(u+q),M=(x+H+E)*r,l=mm-(x-M),t=o-(H-M),Q=u-(E-M);let b,J,N,S,P,R;l>=t?t>=Q?(b=1,J=0,N=0,S=1,P=1,R=0):l>=Q?(b=1,J=0,N=0,S=1,P=0,R=1):(b=0,J=0,N=1,S=1,P=0,R=1):t<Q?(b=0,J=0,N=1,S=0,P=1,R=1):l<Q?(b=0,J=1,N=0,S=0,P=1,R=1):(b=0,J=1,N=0,S=1,P=1,R=0);const g=l-b+r,W=t-J+r,F=Q-N+r,c=l-S+2*r,A=t-P+2*r,y=Q-R+2*r,I=l-1+.5,s=t-1+.5,j=Q-1+.5,a=255&x,X=255&H,G=255&E;let k=.6-l*l-t*t-Q*Q;if(k<0)w=0;else{const mm=3*f[a+B[X+B[G]]];k*=k,w=k*k*(K[mm]*l+K[mm+1]*t+K[mm+2]*Q)}let d=.6-g*g-W*W-F*F;if(d<0)p=0;else{const mm=3*f[a+b+B[X+J+B[G+N]]];d*=d,p=d*d*(K[mm]*g+K[mm+1]*W+K[mm+2]*F)}let e=.6-c*c-A*A-y*y;if(e<0)z=0;else{const mm=3*f[a+S+B[X+P+B[G+R]]];e*=e,z=e*e*(K[mm]*c+K[mm+1]*A+K[mm+2]*y)}let L=.6-I*I-s*s-j*j;if(L<0)Y=0;else{const mm=3*f[a+1+B[X+1+B[G+1]]];L*=L,Y=L*L*(K[mm]*I+K[mm+1]*s+K[mm+2]*j)}return 32*(w+p+z+Y)}noise4D(mm,o,u,f){const B=this.perm;let O,r,K,Y,q;const x=(mm+o+u+f)*w,H=Math.floor(mm+x),E=Math.floor(o+x),M=Math.floor(u+x),l=Math.floor(f+x),t=(H+E+M+l)*p,Q=mm-(H-t),b=o-(E-t),J=u-(M-t),N=f-(l-t);let S=0,P=0,R=0,g=0;Q>b?S++:P++,Q>J?S++:R++,Q>N?S++:g++,b>J?P++:R++,b>N?P++:g++,J>N?R++:g++;const W=S>=3?1:0,F=P>=3?1:0,c=R>=3?1:0,A=g>=3?1:0,y=S>=2?1:0,I=P>=2?1:0,s=R>=2?1:0,j=g>=2?1:0,a=S>=1?1:0,X=P>=1?1:0,G=R>=1?1:0,k=g>=1?1:0,d=Q-W+p,e=b-F+p,L=J-c+p,C=N-A+p,v=Q-y+2*p,V=b-I+2*p,n=J-s+2*p,U=N-j+2*p,h=Q-a+3*p,Z=b-X+3*p,T=J-G+3*p,D=N-k+3*p,i=Q-1+4*p,mo=b-1+4*p,om=J-1+4*p,um=N-1+4*p,fm=255&H,Bm=255&E,Om=255&M,rm=255&l;let wm=.6-Q*Q-b*b-J*J-N*N;if(wm<0)O=0;else{const mm=B[fm+B[Bm+B[Om+B[rm]]]]%32*4;wm*=wm,O=wm*wm*(z[mm]*Q+z[mm+1]*b+z[mm+2]*J+z[mm+3]*N)}let pm=.6-d*d-e*e-L*L-C*C;if(pm<0)r=0;else{const mm=B[fm+W+B[Bm+F+B[Om+c+B[rm+A]]]]%32*4;pm*=pm,r=pm*pm*(z[mm]*d+z[mm+1]*e+z[mm+2]*L+z[mm+3]*C)}let Km=.6-v*v-V*V-n*n-U*U;if(Km<0)K=0;else{const mm=B[fm+y+B[Bm+I+B[Om+s+B[rm+j]]]]%32*4;Km*=Km,K=Km*Km*(z[mm]*v+z[mm+1]*V+z[mm+2]*n+z[mm+3]*U)}let zm=.6-h*h-Z*Z-T*T-D*D;if(zm<0)Y=0;else{const mm=B[fm+a+B[Bm+X+B[Om+G+B[rm+k]]]]%32*4;zm*=zm,Y=zm*zm*(z[mm]*h+z[mm+1]*Z+z[mm+2]*T+z[mm+3]*D)}let Ym=.6-i*i-mo*mo-om*om-um*um;if(Ym<0)q=0;else{const mm=B[fm+1+B[Bm+1+B[Om+1+B[rm+1]]]]%32*4;Ym*=Ym,q=Ym*Ym*(z[mm]*i+z[mm+1]*mo+z[mm+2]*om+z[mm+3]*um)}return 27*(O+r+K+Y+q)}}}}]);