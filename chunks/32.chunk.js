/*! For license information please see yit8yc.32.dc9b7b69.chunk.js.LICENSE.txt */
(self.gpkvekif0vo=self.gpkvekif0vo||[]).push([[32],{14388:(a,O,i)=>{"use strict";var H=i(14395),b=i(14402),G=i(14405);i.g.__TYPEDARRAY_POOL||(i.g.__TYPEDARRAY_POOL={UINT8:b([32,0]),UINT16:b([32,0]),UINT32:b([32,0]),INT8:b([32,0]),INT16:b([32,0]),INT32:b([32,0]),FLOAT:b([32,0]),DOUBLE:b([32,0]),DATA:b([32,0]),UINT8C:b([32,0]),BUFFER:b([32,0])});var q="undefined"!==typeof Uint8ClampedArray,Q=i.g.__TYPEDARRAY_POOL;Q.UINT8C||(Q.UINT8C=b([32,0])),Q.BUFFER||(Q.BUFFER=b([32,0]));var k=Q.DATA,I=Q.BUFFER;function P(a){if(a){var O=a.length||a.byteLength,i=H.log2(O);k[i].push(a)}}function e(a){a=H.nextPow2(a);var O=H.log2(a),i=k[O];return i.length>0?i.pop():new ArrayBuffer(a)}function h(a){return new Uint8Array(e(a),0,a)}function j(a){return new Uint16Array(e(2*a),0,a)}function Z(a){return new Uint32Array(e(4*a),0,a)}function F(a){return new Int8Array(e(a),0,a)}function r(a){return new Int16Array(e(2*a),0,a)}function J(a){return new Int32Array(e(4*a),0,a)}function ma(a){return new Float32Array(e(4*a),0,a)}function M(a){return new Float64Array(e(8*a),0,a)}function C(a){return q?new Uint8ClampedArray(e(a),0,a):h(a)}function n(a){return new DataView(e(a),0,a)}O.free=function(a){if(G(a))I[H.log2(a.length)].push(a);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(a)&&(a=a.buffer),!a)return;var O=a.length||a.byteLength,i=0|H.log2(O);k[i].push(a)}},O.freeUint8=O.freeUint16=O.freeUint32=O.freeInt8=O.freeInt16=O.freeInt32=O.freeFloat32=O.freeFloat=O.freeFloat64=O.freeDouble=O.freeUint8Clamped=O.freeDataView=function(a){P(a.buffer)},O.freeArrayBuffer=P,O.freeBuffer=function(a){I[H.log2(a.length)].push(a)},O.malloc=function(a,O){if(void 0===O||"arraybuffer"===O)return e(a);switch(O){case"uint8":return h(a);case"uint16":return j(a);case"uint32":return Z(a);case"int8":return F(a);case"int16":return r(a);case"int32":return J(a);case"float":case"float32":return ma(a);case"double":case"float64":return M(a);case"uint8_clamped":return C(a);case"buffer":throw"Buffer not supported";case"data":case"dataview":return n(a);default:return null}return null},O.mallocArrayBuffer=e,O.mallocUint8=h,O.mallocUint16=j,O.mallocUint32=Z,O.mallocInt8=F,O.mallocInt16=r,O.mallocInt32=J,O.mallocFloat32=O.mallocFloat=ma,O.mallocFloat64=O.mallocDouble=M,O.mallocUint8Clamped=C,O.mallocDataView=n,O.clearCache=function(){for(var a=0;a<32;++a)Q.UINT8[a].length=0,Q.UINT16[a].length=0,Q.UINT32[a].length=0,Q.INT8[a].length=0,Q.INT16[a].length=0,Q.INT32[a].length=0,Q.FLOAT[a].length=0,Q.DOUBLE[a].length=0,Q.UINT8C[a].length=0,k[a].length=0,I[a].length=0}},14492:(a,O,i)=>{a.exports=b;var H=i(13221);function b(a,O){if(!(this instanceof b))return new b(a,O);var i=H.create();H.add(i,a,O),this.base=H.min(H.create(),a,i),this.kP=H.clone(O),this.max=H.max(H.create(),a,i),this.mag=H.length(this.kP)}var G=b.prototype;G.width=function(){return this.kP[0]},G.height=function(){return this.kP[1]},G.depth=function(){return this.kP[2]},G.x0=function(){return this.base[0]},G.y0=function(){return this.base[1]},G.z0=function(){return this.base[2]},G.x1=function(){return this.max[0]},G.y1=function(){return this.max[1]},G.z1=function(){return this.max[2]},G.translate=function(a){return H.add(this.max,this.max,a),H.add(this.base,this.base,a),this},G.setPosition=function(a){return H.add(this.max,a,this.kP),H.j(this.base,a),this},G.expand=function(a){var O=H.create(),i=H.create();return H.max(O,a.max,this.max),H.min(i,a.base,this.base),H.FO(O,O,i),new b(i,O)},G.intersects=function(a){return!(a.base[0]>this.max[0])&&(!(a.base[1]>this.max[1])&&(!(a.base[2]>this.max[2])&&(!(a.max[0]<this.base[0])&&(!(a.max[1]<this.base[1])&&!(a.max[2]<this.base[2])))))},G.touches=function(a){var O=this.union(a);return null!==O&&(0==O.width()||0==O.height()||0==O.depth())},G.union=function(a){if(!this.intersects(a))return null;var O=Math.max(a.base[0],this.base[0]),i=Math.max(a.base[1],this.base[1]),H=Math.max(a.base[2],this.base[2]);return new b([O,i,H],[Math.min(a.max[0],this.max[0])-O,Math.min(a.max[1],this.max[1])-i,Math.min(a.max[2],this.max[2])-H])}},14395:(a,O)=>{"use strict";function i(a){var O=32;return(a&=-a)&&O--,65535&a&&(O-=16),16711935&a&&(O-=8),252645135&a&&(O-=4),858993459&a&&(O-=2),1431655765&a&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(a){return(a>0)-(a<0)},O.abs=function(a){var O=a>>31;return(a^O)-O},O.min=function(a,O){return O^(a^O)&-(a<O)},O.max=function(a,O){return a^(a^O)&-(a<O)},O.isPow2=function(a){return!(a&a-1)&&!!a},O.log2=function(a){var O,i;return O=(a>65535)<<4,O|=i=((a>>>=O)>255)<<3,O|=i=((a>>>=i)>15)<<2,(O|=i=((a>>>=i)>3)<<1)|(a>>>=i)>>1},O.log10=function(a){return a>=1e9?9:a>=1e8?8:a>=1e7?7:a>=1e6?6:a>=1e5?5:a>=1e4?4:a>=1e3?3:a>=100?2:a>=10?1:0},O.popCount=function(a){return 16843009*((a=(858993459&(a-=a>>>1&1431655765))+(a>>>2&858993459))+(a>>>4)&252645135)>>>24},O.countTrailingZeros=i,O.nextPow2=function(a){return a+=0===a,--a,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,(a|=a>>>16)+1},O.prevPow2=function(a){return a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,(a|=a>>>16)-(a>>>1)},O.parity=function(a){return a^=a>>>16,a^=a>>>8,a^=a>>>4,27030>>>(a&=15)&1};var H=new Array(256);!function(a){for(var O=0;O<256;++O){var i=O,H=O,b=7;for(i>>>=1;i;i>>>=1)H<<=1,H|=1&i,--b;a[O]=H<<b&255}}(H),O.reverse=function(a){return H[255&a]<<24|H[a>>>8&255]<<16|H[a>>>16&255]<<8|H[a>>>24&255]},O.interleave2=function(a,O){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a&=65535)|a<<8))|a<<4))|a<<2))|a<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(a,O){return(a=65535&((a=16711935&((a=252645135&((a=858993459&((a=a>>>O&1431655765)|a>>>1))|a>>>2))|a>>>4))|a>>>16))<<16>>16},O.interleave3=function(a,O,i){return a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2),(a|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},O.deinterleave3=function(a,O){return(a=1023&((a=4278190335&((a=251719695&((a=3272356035&((a=a>>>O&1227133513)|a>>>2))|a>>>4))|a>>>8))|a>>>16))<<22>>22},O.nextCombination=function(a){var O=a|a-1;return O+1|(~O&-~O)-1>>>i(a)+1}},14380:(a,O,i)=>{"use strict";a.exports=function(a,O,i){switch(arguments.length){case 1:return H=[],I(b=a,b,P,!0),H;case 2:return"function"===typeof O?I(a,a,O,!0):function(a,O){return H=[],I(a,O,P,!1),H}(a,O);case 3:return I(a,O,i,!1);default:throw new Error("box-intersect: Invalid arguments")}var b};var H,b=i(14388),G=i(14413),q=i(14422);function Q(a,O){for(var i=0;i<a;++i)if(!(O[i]<=O[i+a]))return!0;return!1}function k(a,O,i,H){for(var b=0,G=0,q=0,k=a.length;q<k;++q){var I=a[q];if(!Q(O,I)){for(var P=0;P<2*O;++P)i[b++]=I[P];H[G++]=q}}return G}function I(a,O,i,H){var Q=a.length,I=O.length;if(!(Q<=0||I<=0)){var P=a[0].length>>>1;if(!(P<=0)){var e,h=b.mallocDouble(2*P*Q),j=b.mallocInt32(Q);if((Q=k(a,P,h,j))>0){if(1===P&&H)G.init(Q),e=G.sweepComplete(P,i,0,Q,h,j,0,Q,h,j);else{var Z=b.mallocDouble(2*P*I),F=b.mallocInt32(I);(I=k(O,P,Z,F))>0&&(G.init(Q+I),e=1===P?G.sweepBipartite(P,i,0,Q,h,j,0,I,Z,F):q(P,i,H,Q,h,j,I,Z,F),b.free(Z),b.free(F))}b.free(h),b.free(j)}return e}}}function P(a,O){H.push([a,O])}},14429:(a,O)=>{"use strict";var i="d",H="ax",b="fp",G="es",q="rs",Q="re",k="rb",I="bs",P="be",e="bb",h=[i,H,"vv",q,Q,k,"ri",I,P,e,"bi"];function j(a){var O="bruteForce"+(a?"Full":"Partial"),H=[],q=h.slice();a||q.splice(3,0,b);var Q=["function "+O+"("+q.join()+"){"];function k(O,b){var q=function(a,O,H){var b="bruteForce"+(a?"Red":"Blue")+(O?"Flip":"")+(H?"Full":""),q=["function ",b,"(",h.join(),"){","var ",G,"=2*",i,";"],Q="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",k="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(H?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return a?q.push(Q,"Q",":",k):q.push(k,"Q",":",Q),H?q.push("if(y1<x0||x1<y0)continue;"):O?q.push("if(y0<=x0||x1<y0)continue;"):q.push("if(y0<x0||x1<y0)continue;"),q.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),O?q.push("yi,xi"):q.push("xi,yi"),q.push(");if(rv!==void 0)return rv;}}}"),{name:b,code:q.join("")}}(O,b,a);H.push(q.code),Q.push("return "+q.name+"("+h.join()+");")}Q.push("if(re-rs>be-bs){"),a?(k(!0,!1),Q.push("}else{"),k(!1,!1)):(Q.push("if(fp){"),k(!0,!0),Q.push("}else{"),k(!0,!1),Q.push("}}else{if(fp){"),k(!1,!0),Q.push("}else{"),k(!1,!1),Q.push("}")),Q.push("}}return "+O);var I=H.join("")+Q.join("");return new Function(I)()}O.partial=j(!1),O.full=j(!0)},14422:(a,O,i)=>{"use strict";a.exports=function(a,O,i,G,P,S,f,B,T){!function(a,O){var i=8*b.log2(O+1)*(a+1)|0,G=b.nextPow2(C*i);D.length<G&&(H.free(D),D=H.mallocInt32(G));var q=b.nextPow2(n*i);U.length<q&&(H.free(U),U=H.mallocDouble(q))}(a,G+f);var A,E=0,l=2*a;y(E++,0,0,G,0,f,i?16:0,-1/0,1/0),i||y(E++,0,0,f,0,G,1,-1/0,1/0);for(;E>0;){var W=(E-=1)*C,u=D[W],c=D[W+1],R=D[W+2],z=D[W+3],x=D[W+4],g=D[W+5],N=E*n,v=U[N],X=U[N+1],p=1&g,o=!!(16&g),d=P,Y=S,L=B,s=T;if(p&&(d=B,Y=T,L=P,s=S),!(2&g&&c>=(R=r(a,u,c,R,d,Y,X)))&&!(4&g&&(c=J(a,u,c,R,d,Y,v))>=R)){var t=R-c,V=x-z;if(o){if(a*t*(t+V)<j){if(void 0!==(A=k.scanComplete(a,u,O,c,R,d,Y,z,x,L,s)))return A;continue}}else{if(a*Math.min(t,V)<e){if(void 0!==(A=q(a,u,O,p,c,R,d,Y,z,x,L,s)))return A;continue}if(a*t*V<h){if(void 0!==(A=k.scanBipartite(a,u,O,p,c,R,d,Y,z,x,L,s)))return A;continue}}var aa=Z(a,u,c,R,d,Y,v,X);if(c<aa)if(a*(aa-c)<e){if(void 0!==(A=Q(a,u+1,O,c,aa,d,Y,z,x,L,s)))return A}else if(u===a-2){if(void 0!==(A=p?k.sweepBipartite(a,O,z,x,L,s,c,aa,d,Y):k.sweepBipartite(a,O,c,aa,d,Y,z,x,L,s)))return A}else y(E++,u+1,c,aa,z,x,p,-1/0,1/0),y(E++,u+1,z,x,c,aa,1^p,-1/0,1/0);if(aa<R){var Oa=I(a,u,z,x,L,s),ia=L[l*Oa+u],Ha=F(a,u,Oa,x,L,s,ia);if(Ha<x&&y(E++,u,aa,R,Ha,x,(4|p)+(o?16:0),ia,X),z<Oa&&y(E++,u,aa,R,z,Oa,(2|p)+(o?16:0),v,ia),Oa+1===Ha){if(void 0!==(A=o?K(a,u,O,aa,R,d,Y,Oa,L,s[Oa]):w(a,u,O,p,aa,R,d,Y,Oa,L,s[Oa])))return A}else if(Oa<Ha){var ba;if(o){if(aa<(ba=ma(a,u,aa,R,d,Y,ia))){var Ga=F(a,u,aa,ba,d,Y,ia);if(u===a-2){if(aa<Ga&&void 0!==(A=k.sweepComplete(a,O,aa,Ga,d,Y,Oa,Ha,L,s)))return A;if(Ga<ba&&void 0!==(A=k.sweepBipartite(a,O,Ga,ba,d,Y,Oa,Ha,L,s)))return A}else aa<Ga&&y(E++,u+1,aa,Ga,Oa,Ha,16,-1/0,1/0),Ga<ba&&(y(E++,u+1,Ga,ba,Oa,Ha,0,-1/0,1/0),y(E++,u+1,Oa,Ha,Ga,ba,1,-1/0,1/0))}}else aa<(ba=p?M(a,u,aa,R,d,Y,ia):ma(a,u,aa,R,d,Y,ia))&&(u===a-2?A=p?k.sweepBipartite(a,O,Oa,Ha,L,s,aa,ba,d,Y):k.sweepBipartite(a,O,aa,ba,d,Y,Oa,Ha,L,s):(y(E++,u+1,aa,ba,Oa,Ha,p,-1/0,1/0),y(E++,u+1,Oa,Ha,aa,ba,1^p,-1/0,1/0)))}}}}};var H=i(14388),b=i(14395),G=i(14429),q=G.partial,Q=G.full,k=i(14413),I=i(14436),P=i(14442),e=128,h=1<<22,j=1<<22,Z=P("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),F=P("lo===p0",["p0"]),r=P("lo<p0",["p0"]),J=P("hi<=p0",["p0"]),ma=P("lo<=p0&&p0<=hi",["p0"]),M=P("lo<p0&&p0<=hi",["p0"]),C=6,n=2,D=H.mallocInt32(1024),U=H.mallocDouble(1024);function y(a,O,i,H,b,G,q,Q,k){var I=C*a;D[I]=O,D[I+1]=i,D[I+2]=H,D[I+3]=b,D[I+4]=G,D[I+5]=q;var P=n*a;U[P]=Q,U[P+1]=k}function w(a,O,i,H,b,G,q,Q,k,I,P){var e=2*a,h=k*e,j=I[h+O];a:for(var Z=b,F=b*e;Z<G;++Z,F+=e){var r=q[F+O],J=q[F+O+a];if(!(j<r||J<j)&&(!H||j!==r)){for(var ma,M=Q[Z],C=O+1;C<a;++C){r=q[F+C],J=q[F+C+a];var n=I[h+C],D=I[h+C+a];if(J<n||D<r)continue a}if(void 0!==(ma=H?i(P,M):i(M,P)))return ma}}}function K(a,O,i,H,b,G,q,Q,k,I){var P=2*a,e=Q*P,h=k[e+O];a:for(var j=H,Z=H*P;j<b;++j,Z+=P){var F=q[j];if(F!==I){var r=G[Z+O],J=G[Z+O+a];if(!(h<r||J<h)){for(var ma=O+1;ma<a;++ma){r=G[Z+ma],J=G[Z+ma+a];var M=k[e+ma],C=k[e+ma+a];if(J<M||C<r)continue a}var n=i(F,I);if(void 0!==n)return n}}}}},14436:(a,O,i)=>{"use strict";a.exports=function(a,O,i,q,Q,k){if(q<=i+1)return i;var I=i,P=q,e=q+i>>>1,h=2*a,j=e,Z=Q[h*e+O];for(;I<P;){if(P-I<b){G(a,O,I,P,Q,k),Z=Q[h*e+O];break}var F=P-I,r=Math.random()*F+I|0,J=Q[h*r+O],ma=Math.random()*F+I|0,M=Q[h*ma+O],C=Math.random()*F+I|0,n=Q[h*C+O];J<=M?n>=M?(j=ma,Z=M):J>=n?(j=r,Z=J):(j=C,Z=n):M>=n?(j=ma,Z=M):n>=J?(j=r,Z=J):(j=C,Z=n);for(var D=h*(P-1),U=h*j,y=0;y<h;++y,++D,++U){var w=Q[D];Q[D]=Q[U],Q[U]=w}var K=k[P-1];k[P-1]=k[j],k[j]=K;for(D=h*(P-1),U=h*(j=H(a,O,I,P-1,Q,k,Z)),y=0;y<h;++y,++D,++U){w=Q[D];Q[D]=Q[U],Q[U]=w}K=k[P-1];if(k[P-1]=k[j],k[j]=K,e<j){for(P=j-1;I<P&&Q[h*(P-1)+O]===Z;)P-=1;P+=1}else{if(!(j<e))break;for(I=j+1;I<P&&Q[h*I+O]===Z;)I+=1}}return H(a,O,i,e,Q,k,Q[h*e+O])};var H=i(14442)("lo<p0",["p0"]),b=8;function G(a,O,i,H,b,G){for(var q=2*a,Q=q*(i+1)+O,k=i+1;k<H;++k,Q+=q)for(var I=b[Q],P=k,e=q*(k-1);P>i&&b[e+O]>I;--P,e-=q){for(var h=e,j=e+q,Z=0;Z<q;++Z,++h,++j){var F=b[h];b[h]=b[j],b[j]=F}var r=G[P];G[P]=G[P-1],G[P-1]=r}}},14442:a=>{"use strict";a.exports=function(a,i){var H="abcdef".split("").concat(i),b=[];a.indexOf("lo")>=0&&b.push("lo=e[k+n]");a.indexOf("hi")>=0&&b.push("hi=e[k+o]");return H.push(O.replace("_",b.join()).replace("$",a)),Function.apply(void 0,H)};var O="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14417:a=>{"use strict";a.exports=function(a,H){H<=4*O?i(0,H-1,a):I(0,H-1,a)};var O=32;function i(a,O,i){for(var H=2*(a+1),b=a+1;b<=O;++b){for(var G=i[H++],q=i[H++],Q=b,k=H-2;Q-- >a;){var I=i[k-2],P=i[k-1];if(I<G)break;if(I===G&&P<q)break;i[k]=I,i[k+1]=P,k-=2}i[k]=G,i[k+1]=q}}function H(a,O,i){O*=2;var H=i[a*=2],b=i[a+1];i[a]=i[O],i[a+1]=i[O+1],i[O]=H,i[O+1]=b}function b(a,O,i){O*=2,i[a*=2]=i[O],i[a+1]=i[O+1]}function G(a,O,i,H){O*=2,i*=2;var b=H[a*=2],G=H[a+1];H[a]=H[O],H[a+1]=H[O+1],H[O]=H[i],H[O+1]=H[i+1],H[i]=b,H[i+1]=G}function q(a,O,i,H,b){O*=2,b[a*=2]=b[O],b[O]=i,b[a+1]=b[O+1],b[O+1]=H}function Q(a,O,i){O*=2;var H=i[a*=2],b=i[O];return!(H<b)&&(H!==b||i[a+1]>i[O+1])}function k(a,O,i,H){var b=H[a*=2];return b<O||b===O&&H[a+1]<i}function I(a,P,e){var h=(P-a+1)/6|0,j=a+h,Z=P-h,F=a+P>>1,r=F-h,J=F+h,ma=j,M=r,C=F,n=J,D=Z,U=a+1,y=P-1,w=0;Q(ma,M,e)&&(w=ma,ma=M,M=w),Q(n,D,e)&&(w=n,n=D,D=w),Q(ma,C,e)&&(w=ma,ma=C,C=w),Q(M,C,e)&&(w=M,M=C,C=w),Q(ma,n,e)&&(w=ma,ma=n,n=w),Q(C,n,e)&&(w=C,C=n,n=w),Q(M,D,e)&&(w=M,M=D,D=w),Q(M,C,e)&&(w=M,M=C,C=w),Q(n,D,e)&&(w=n,n=D,D=w);for(var K=e[2*M],S=e[2*M+1],f=e[2*n],B=e[2*n+1],T=2*ma,A=2*C,E=2*D,l=2*j,W=2*F,u=2*Z,c=0;c<2;++c){var R=e[T+c],z=e[A+c],x=e[E+c];e[l+c]=R,e[W+c]=z,e[u+c]=x}b(r,a,e),b(J,P,e);for(var g=U;g<=y;++g)if(k(g,K,S,e))g!==U&&H(g,U,e),++U;else if(!k(g,f,B,e))for(;;){if(k(y,f,B,e)){k(y,K,S,e)?(G(g,U,y,e),++U,--y):(H(g,y,e),--y);break}if(--y<g)break}q(a,U-1,K,S,e),q(P,y+1,f,B,e),U-2-a<=O?i(a,U-2,e):I(a,U-2,e),P-(y+2)<=O?i(y+2,P,e):I(y+2,P,e),y-U<=O?i(U,y,e):I(U,y,e)}},14413:(a,O,i)=>{"use strict";a.exports={init:function(a){var O=b.nextPow2(a);k.length<O&&(H.free(k),k=H.mallocInt32(O));I.length<O&&(H.free(I),I=H.mallocInt32(O));P.length<O&&(H.free(P),P=H.mallocInt32(O));e.length<O&&(H.free(e),e=H.mallocInt32(O));h.length<O&&(H.free(h),h=H.mallocInt32(O));j.length<O&&(H.free(j),j=H.mallocInt32(O));var i=8*O;Z.length<i&&(H.free(Z),Z=H.mallocDouble(i))},sweepBipartite:function(a,O,i,H,b,Q,h,j,J,ma){for(var M=0,C=2*a,n=a-1,D=C-1,U=i;U<H;++U){var y=Q[U],w=C*U;Z[M++]=b[w+n],Z[M++]=-(y+1),Z[M++]=b[w+D],Z[M++]=y}for(U=h;U<j;++U){y=ma[U]+q;var K=C*U;Z[M++]=J[K+n],Z[M++]=-y,Z[M++]=J[K+D],Z[M++]=y}var S=M>>>1;G(Z,S);var f=0,B=0;for(U=0;U<S;++U){var T=0|Z[2*U+1];if(T>=q)F(P,e,B--,T=T-q|0);else if(T>=0)F(k,I,f--,T);else if(T<=-q){T=-T-q|0;for(var A=0;A<f;++A){if(void 0!==(E=O(k[A],T)))return E}r(P,e,B++,T)}else{T=-T-1|0;for(A=0;A<B;++A){var E;if(void 0!==(E=O(T,P[A])))return E}r(k,I,f++,T)}}},sweepComplete:function(a,O,i,H,b,q,Q,J,ma,M){for(var C=0,n=2*a,D=a-1,U=n-1,y=i;y<H;++y){var w=q[y]+1<<1,K=n*y;Z[C++]=b[K+D],Z[C++]=-w,Z[C++]=b[K+U],Z[C++]=w}for(y=Q;y<J;++y){w=M[y]+1<<1;var S=n*y;Z[C++]=ma[S+D],Z[C++]=1|-w,Z[C++]=ma[S+U],Z[C++]=1|w}var f=C>>>1;G(Z,f);var B=0,T=0,A=0;for(y=0;y<f;++y){var E=0|Z[2*y+1],l=1&E;if(y<f-1&&E>>1===Z[2*y+3]>>1&&(l=2,y+=1),E<0){for(var W=-(E>>1)-1,u=0;u<A;++u){if(void 0!==(c=O(h[u],W)))return c}if(0!==l)for(u=0;u<B;++u){if(void 0!==(c=O(k[u],W)))return c}if(1!==l)for(u=0;u<T;++u){var c;if(void 0!==(c=O(P[u],W)))return c}0===l?r(k,I,B++,W):1===l?r(P,e,T++,W):2===l&&r(h,j,A++,W)}else{W=(E>>1)-1;0===l?F(k,I,B--,W):1===l?F(P,e,T--,W):2===l&&F(h,j,A--,W)}}},scanBipartite:function(a,O,i,H,b,Q,P,e,h,j,J,ma){var M=0,C=2*a,n=O,D=O+a,U=1,y=1;H?y=q:U=q;for(var w=b;w<Q;++w){var K=w+U,S=C*w;Z[M++]=P[S+n],Z[M++]=-K,Z[M++]=P[S+D],Z[M++]=K}for(w=h;w<j;++w){K=w+y;var f=C*w;Z[M++]=J[f+n],Z[M++]=-K}var B=M>>>1;G(Z,B);var T=0;for(w=0;w<B;++w){var A=0|Z[2*w+1];if(A<0){var E=!1;if((K=-A)>=q?(E=!H,K-=q):(E=!!H,K-=1),E)r(k,I,T++,K);else{var l=ma[K],W=C*K,u=J[W+O+1],c=J[W+O+1+a];a:for(var R=0;R<T;++R){var z=k[R],x=C*z;if(!(c<P[x+O+1]||P[x+O+1+a]<u)){for(var g=O+2;g<a;++g)if(J[W+g+a]<P[x+g]||P[x+g+a]<J[W+g])continue a;var N,v=e[z];if(void 0!==(N=H?i(l,v):i(v,l)))return N}}}}else F(k,I,T--,A-U)}},scanComplete:function(a,O,i,H,b,Q,I,P,e,h,j){for(var F=0,r=2*a,J=O,ma=O+a,M=H;M<b;++M){var C=M+q,n=r*M;Z[F++]=Q[n+J],Z[F++]=-C,Z[F++]=Q[n+ma],Z[F++]=C}for(M=P;M<e;++M){C=M+1;var D=r*M;Z[F++]=h[D+J],Z[F++]=-C}var U=F>>>1;G(Z,U);var y=0;for(M=0;M<U;++M){var w=0|Z[2*M+1];if(w<0){if((C=-w)>=q)k[y++]=C-q;else{var K=j[C-=1],S=r*C,f=h[S+O+1],B=h[S+O+1+a];a:for(var T=0;T<y;++T){var A=k[T],E=I[A];if(E===K)break;var l=r*A;if(!(B<Q[l+O+1]||Q[l+O+1+a]<f)){for(var W=O+2;W<a;++W)if(h[S+W+a]<Q[l+W]||Q[l+W+a]<h[S+W])continue a;var u=i(E,K);if(void 0!==u)return u}}}}else{for(C=w-q,T=y-1;T>=0;--T)if(k[T]===C){for(W=T+1;W<y;++W)k[W-1]=k[W];break}--y}}}};var H=i(14388),b=i(14395),G=i(14417),q=1<<28,Q=1024,k=H.mallocInt32(Q),I=H.mallocInt32(Q),P=H.mallocInt32(Q),e=H.mallocInt32(Q),h=H.mallocInt32(Q),j=H.mallocInt32(Q),Z=H.mallocDouble(8192);function F(a,O,i,H){var b=O[H],G=a[i-1];a[b]=G,O[G]=b}function r(a,O,i,H){a[i]=H,O[H]=i}},14402:a=>{"use strict";function O(a,i,H){var b=0|a[H];if(b<=0)return[];var G,q=new Array(b);if(H===a.length-1)for(G=0;G<b;++G)q[G]=i;else for(G=0;G<b;++G)q[G]=O(a,i,H+1);return q}a.exports=function(a,i){switch("undefined"===typeof i&&(i=0),typeof a){case"number":if(a>0)return function(a,O){var i,H;for(i=new Array(a),H=0;H<a;++H)i[H]=O;return i}(0|a,i);break;case"object":if("number"===typeof a.length)return O(a,i,0)}return[]}},14358:(a,O,i)=>{a.exports=function(){var a=this;this.components={},this.comps=this.components;var O=this.components,i=1,b={},G=[],q=[],Q={timeout:!1,removals:[],multiComps:[]};function k(a,i){var H=O[i],G=b[i],q=G.hash[a];q&&(G.remove(a),H.mb&&(H.multi?(q.forEach((O=>{O&&H.mb(a,O)})),q.length=0):H.mb(a,q)),Q.removals.push(G),I())}function I(){Q.timeout||(Q.timeout=!0,setTimeout(P,1))}function P(){Q.timeout=!1,e()}function e(){Q.multiComps.length&&function(a){for(var O=0;O<a.length;O++){var{entID:i,data:H}=a[O],b=H.hash[i];if(b){for(var G=0;G<b.length;G++)b[G]||(b.splice(G,1),G--);0===b.length&&(H.remove(i),Q.removals.push(H))}}a.length=0}(Q.multiComps),Q.removals.length&&function(a){for(var O=0;O<a.length;O++){a[O].flush()}a.length=0}(Q.removals)}this.xe=b,this._systems=G,this._renderSystems=q,this.eP=function(O){var H=i++;return Array.isArray(O)&&O.forEach((O=>a.dk(H,O))),H},this.deleteEntity=function(O){return Object.keys(b).forEach((a=>{b[a].hash[O]&&k(O,a)})),a},this.KP=function(a){if(!a)throw new Error("Missing component definition");var i=a.name;if(!i)throw new Error("Component definition must have a name property.");if("string"!==typeof i)throw new Error("Component name must be a string.");if(""===i)throw new Error("Component name must be a non-empty string.");if(b[i])throw new Error(`Component ${i} already exists.`);var Q={};return Q.name=i,Q.multi=!!a.multi,Q.order=isNaN(a.order)?99:a.order,Q.stateConstructor=a.stateConstructor||null,Q.state=a.state||{},Q.XQ=a.XQ||null,Q.mb=a.mb||null,Q.system=a.system||null,Q.sQ=a.sQ||null,O[i]=Q,b[i]=new H,b[i]._pendingMultiCleanup=!1,b[i]._multiCleanupIDs=Q.multi?[]:null,Q.system&&(G.push(i),G.sort(((a,i)=>O[a].order-O[i].order))),Q.sQ&&(q.push(i),q.sort(((a,i)=>O[a].order-O[i].order))),i},this.overwriteComponent=function(a,i){var H=O[a];if(!H)throw new Error(`Unknown component: ${a}`);if(!i)throw new Error("Missing component definition");if(H.name!==i.name)throw new Error("Overwriting component must use the same name property.");var Q={};Q.name=a,Q.multi=!!i.multi,Q.order=isNaN(i.order)?99:i.order,Q.state=i.state||{},Q.XQ=i.XQ||null,Q.mb=i.mb||null,Q.system=i.system||null,Q.sQ=i.sQ||null,O[a]=Q,b[a]._pendingMultiCleanup=!1,b[a]._multiCleanupIDs=Q.multi?[]:null;var k=G.indexOf(a);Q.system&&k<0&&G.push(a),!Q.system&&k>=0&&G.splice(k,1),G.sort(((a,i)=>O[a].order-O[i].order));var I=q.indexOf(a);Q.sQ&&I<0&&q.push(a),!Q.sQ&&I>=0&&q.splice(I,1),q.sort(((a,i)=>O[a].order-O[i].order));var P=Q.state;return this.oI(a).forEach((a=>{for(var O in P)O in a||(a[O]=P[O]);Q.XQ&&Q.XQ(a.YQ,a)})),a},this.deleteComponent=function(i){var H=b[i];if(!H)throw new Error(`Unknown component: ${i}`);H.flush(),H.list.forEach((a=>{a&&k(a.YQ||a[0].YQ,i)}));var Q=G.indexOf(i),I=q.indexOf(i);return Q>-1&&G.splice(Q,1),I>-1&&q.splice(I,1),b[i].dispose(),delete b[i],delete O[i],a},this.dk=function(a,i,H){var G,q=O[i],Q=b[i];if(!Q)throw new Error(`Unknown component: ${i}.`);if(Q.hash[a]&&!q.multi)throw new Error(`Entity ${a} already has component: ${i}.`);if(q.stateConstructor){if(!(G=new q.stateConstructor).hasOwnProperty("YQ"))throw new Error(`Component ${q.name} stateConstructor type does not have property __id`)}else G=Object.assign({},{YQ:a},q.state,H);if(G.YQ=a,q.multi){var k=Q.hash[a];k||(k=[],Q.add(a,k)),k.push(G)}else Q.add(a,G);return q.XQ&&q.XQ(a,G),this},this.bI=function(a,O){var i=b[O];if(!i)throw new Error(`Unknown component: ${O}.`);return!!i.hash[a]},this.tk=function(O,i){if(!b[i])throw new Error(`Unknown component: ${i}.`);return k(O,i),a},this.getState=function(a,O){var i=b[O];if(!i)throw new Error(`Unknown component: ${O}.`);return i.hash[a]},this.oI=function(a){var O=b[a];if(!O)throw new Error(`Unknown component: ${a}.`);return e(),O.list},this.vj=function(a){if(!b[a])throw new Error(`Unknown component: ${a}.`);var O=b[a].hash;return a=>O[a]},this.oj=function(a){if(!b[a])throw new Error(`Unknown component: ${a}.`);var O=b[a].hash;return a=>!!O[a]},this.NQ=function(i){e();for(var H=0;H<G.length;H++){var q=G[H],Q=O[q],k=b[q];Q.system(i,k.list),e()}return a},this.render=function(i){e();for(var H=0;H<q.length;H++){var G=q[H],Q=O[G],k=b[G];Q.sQ(i,k.list),e()}return a},this.removeMultiComponent=function(i,H,G){var q=O[H],k=b[H];if(!k)throw new Error(`Unknown component: ${H}.`);if(!q.multi)throw new Error("removeMultiComponent called on non-multi component");return function(a,O,i,H){var b=i.hash[a];if(b){var G=b[H];G&&(b[H]=null,O.mb&&O.mb(a,G),Q.multiComps.push({entID:a,data:i}),I())}}(i,q,k,G),a}};var H=i(14360)},14360:a=>{function O(a,O){var i=a._map[O];if(delete a.hash[O],delete a._map[O],i===a.list.length-1)a.list.pop();else{var H=a.list.pop();if(a.list[i]=H,null===H||null===H[0]){var b=a.list.length;for(var G in a._map)if(a._map[G]===b)return void(a._map[G]=i)}else{var q=H.YQ||H[0].YQ;a._map[q]=i}}}a.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(a,O){if("number"===typeof this._map[a]){var i=this._map[a];this.hash[a]=O,this.list[i]=O}else this._map[a]=this.list.length,this.hash[a]=O,this.list.push(O)}remove(a){var O=this._map[a];this.hash[a]=null,this.list[O]=null,this._pendingRemovals.push(a)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var a=0;a<this._pendingRemovals.length;a++){var i=this._pendingRemovals[a];null===this.hash[i]&&O(this,i)}this._pendingRemovals.length=0}}},14325:a=>{"use strict";var O,i="object"===typeof Reflect?Reflect:null,H=function(a,O,i){return Function.prototype.apply.call(a,O,i)};O=i&&"function"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))}:function(a){return Object.getOwnPropertyNames(a)};var b=Number.isNaN||function(a){return a!==a};function G(){G.init.call(this)}a.exports=G,a.exports.once=function(a,O){return new Promise((function(i,H){function b(i){a.removeListener(O,G),H(i)}function G(){"function"===typeof a.removeListener&&a.removeListener("error",b),i([].slice.call(arguments))}F(a,O,G,{once:!0}),"error"!==O&&function(a,O,i){"function"===typeof a.on&&F(a,"error",O,i)}(a,b,{once:!0})}))},G.EventEmitter=G,G.prototype._events=void 0,G.prototype._eventsCount=0,G.prototype._maxListeners=void 0;var q=10;function Q(a){if("function"!==typeof a)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}function k(a){return void 0===a._maxListeners?G.defaultMaxListeners:a._maxListeners}function I(a,O,i,H){var b,G,q,I;if(Q(i),void 0===(G=a._events)?(G=a._events=Object.create(null),a._eventsCount=0):(void 0!==G.newListener&&(a.emit("newListener",O,i.listener?i.listener:i),G=a._events),q=G[O]),void 0===q)q=G[O]=i,++a._eventsCount;else if("function"===typeof q?q=G[O]=H?[i,q]:[q,i]:H?q.unshift(i):q.push(i),(b=k(a))>0&&q.length>b&&!q.warned){q.warned=!0;var P=new Error("Possible EventEmitter memory leak detected. "+q.length+" "+String(O)+" listeners added. Use emitter.setMaxListeners() to increase limit");P.name="MaxListenersExceededWarning",P.HO=a,P.type=O,P.count=q.length,I=P,console&&console.warn&&console.warn(I)}return a}function P(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function e(a,O,i){var H={fired:!1,wrapFn:void 0,target:a,type:O,listener:i},b=P.bind(H);return b.listener=i,H.wrapFn=b,b}function h(a,O,i){var H=a._events;if(void 0===H)return[];var b=H[O];return void 0===b?[]:"function"===typeof b?i?[b.listener||b]:[b]:i?function(a){for(var O=new Array(a.length),i=0;i<O.length;++i)O[i]=a[i].listener||a[i];return O}(b):Z(b,b.length)}function j(a){var O=this._events;if(void 0!==O){var i=O[a];if("function"===typeof i)return 1;if(void 0!==i)return i.length}return 0}function Z(a,O){for(var i=new Array(O),H=0;H<O;++H)i[H]=a[H];return i}function F(a,O,i,H){if("function"===typeof a.on)H.once?a.once(O,i):a.on(O,i);else{if("function"!==typeof a.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a);a.addEventListener(O,(function b(G){H.once&&a.removeEventListener(O,b),i(G)}))}}Object.defineProperty(G,"defaultMaxListeners",{enumerable:!0,get:function(){return q},set:function(a){if("number"!==typeof a||a<0||b(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");q=a}}),G.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},G.prototype.setMaxListeners=function(a){if("number"!==typeof a||a<0||b(a))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+a+".");return this._maxListeners=a,this},G.prototype.getMaxListeners=function(){return k(this)},G.prototype.emit=function(a){for(var O=[],i=1;i<arguments.length;i++)O.push(arguments[i]);var b="error"===a,G=this._events;if(void 0!==G)b=b&&void 0===G.error;else if(!b)return!1;if(b){var q;if(O.length>0&&(q=O[0]),q instanceof Error)throw q;var Q=new Error("Unhandled error."+(q?" ("+q.message+")":""));throw Q.context=q,Q}var k=G[a];if(void 0===k)return!1;if("function"===typeof k)H(k,this,O);else{var I=k.length,P=Z(k,I);for(i=0;i<I;++i)H(P[i],this,O)}return!0},G.prototype.addListener=function(a,O){return I(this,a,O,!1)},G.prototype.on=G.prototype.addListener,G.prototype.prependListener=function(a,O){return I(this,a,O,!0)},G.prototype.once=function(a,O){return Q(O),this.on(a,e(this,a,O)),this},G.prototype.prependOnceListener=function(a,O){return Q(O),this.prependListener(a,e(this,a,O)),this},G.prototype.removeListener=function(a,O){var i,H,b,G,q;if(Q(O),void 0===(H=this._events))return this;if(void 0===(i=H[a]))return this;if(i===O||i.listener===O)0===--this._eventsCount?this._events=Object.create(null):(delete H[a],H.removeListener&&this.emit("removeListener",a,i.listener||O));else if("function"!==typeof i){for(b=-1,G=i.length-1;G>=0;G--)if(i[G]===O||i[G].listener===O){q=i[G].listener,b=G;break}if(b<0)return this;0===b?i.shift():function(a,O){for(;O+1<a.length;O++)a[O]=a[O+1];a.pop()}(i,b),1===i.length&&(H[a]=i[0]),void 0!==H.removeListener&&this.emit("removeListener",a,q||O)}return this},G.prototype.off=G.prototype.removeListener,G.prototype.bO=function(a){var O,i,H;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[a]&&(0===--this._eventsCount?this._events=Object.create(null):delete i[a]),this;if(0===arguments.length){var b,G=Object.keys(i);for(H=0;H<G.length;++H)"removeListener"!==(b=G[H])&&this.bO(b);return this.bO("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(O=i[a]))this.removeListener(a,O);else if(void 0!==O)for(H=O.length-1;H>=0;H--)this.removeListener(a,O[H]);return this},G.prototype.listeners=function(a){return h(this,a,!0)},G.prototype.rawListeners=function(a){return h(this,a,!1)},G.listenerCount=function(a,O){return"function"===typeof a.listenerCount?a.listenerCount(O):j.call(a,O)},G.prototype.listenerCount=j,G.prototype.eventNames=function(){return this._eventsCount>0?O(this._events):[]}},14619:a=>{"use strict";a.exports=function(a,O,i,H,b,G){var q=+O[0],Q=+O[1],k=+O[2],I=+i[0],P=+i[1],e=+i[2],h=Math.sqrt(I*I+P*P+e*e);if(0===h)throw new Error("Can't raycast along a zero vector");return function(a,O,i,H,b,G,q,Q,k,I){for(var P=0,e=Math.floor,h=0|e(O),j=0|e(i),Z=0|e(H),F=b>0?1:-1,r=G>0?1:-1,J=q>0?1:-1,ma=Math.abs(1/b),M=Math.abs(1/G),C=Math.abs(1/q),n=ma<1/0?ma*(F>0?h+1-O:O-h):1/0,D=M<1/0?M*(r>0?j+1-i:i-j):1/0,U=C<1/0?C*(J>0?Z+1-H:H-Z):1/0,y=-1;P<=Q;){var w=a(h,j,Z);if(w)return k&&(k[0]=O+P*b,k[1]=i+P*G,k[2]=H+P*q),I&&(I[0]=I[1]=I[2]=0,0===y&&(I[0]=-F),1===y&&(I[1]=-r),2===y&&(I[2]=-J)),w;n<D?n<U?(h+=F,P=n,n+=ma,y=0):(Z+=J,P=U,U+=C,y=2):D<U?(j+=r,P=D,D+=M,y=1):(Z+=J,P=U,U+=C,y=2)}return k&&(k[0]=O+P*b,k[1]=i+P*G,k[2]=H+P*q),I&&(I[0]=I[1]=I[2]=0),0}(a,q,Q,k,I/=h,P/=h,e/=h,H="undefined"===typeof H?64:+H,b,G)}},14652:(a,O,i)=>{"use strict";i.d(O,{b:()=>G});var H=i(14325);function b(){this.Nh=!1,this.stopPropagation=!1,this.Xh=!1,this.disabled=!1,this.maxPointerMovement=100}class G{constructor(a,O){this.version="0.7.0";var i=Object.assign({},new b,O||{});this.element=a||document,this.Nh=!!i.Nh,this.stopPropagation=!!i.stopPropagation,this.Xh=!!i.Xh,this.disabled=!!i.disabled,this.filterEvents=(a,O)=>!0,this.down=new H.EventEmitter,this.up=new H.EventEmitter,this.state={},this.xI={dx:0,dy:0,lj:0,zI:0,Wj:0},this.maxPointerMovement=i.maxPointerMovement||0,this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?Q(this):document.addEventListener("DOMContentLoaded",(a=>{Q(this)}),{once:!0})}bind(a){for(var O=arguments.length,i=new Array(O>1?O-1:0),H=1;H<O;H++)i[H-1]=arguments[H];i.forEach((O=>{var i=this._keyBindmap[O]||[];i.includes(a)||(i.push(a),this._keyBindmap[O]=i)})),this.state[a]=!!this.state[a],this.pressCount[a]=this.pressCount[a]||0,this.releaseCount[a]=this.releaseCount[a]||0}unbind(a){for(var O in this._keyBindmap){var i=this._keyBindmap[O],H=i.indexOf(a);H>-1&&i.splice(H,1)}}getBindings(){var a={};for(var O in this._keyBindmap){this._keyBindmap[O].forEach((i=>{a[i]=a[i]||[],a[i].push(O)}))}return a}NQ(){q(this.xI),q(this.pressCount),q(this.releaseCount)}}function q(a){for(var O in a)a[O]=0}function Q(a){window.addEventListener("keydown",Z.bind(null,a,!0),!1),window.addEventListener("keyup",Z.bind(null,a,!1),!1);var O={passive:!0};a.element.addEventListener("touchstart",e.bind(void 0,a),{passive:!1}),a.element.addEventListener("touchend",j.bind(void 0,a),O),a.element.addEventListener("mousedown",F.bind(null,a,!0),O),window.document.addEventListener("mouseup",F.bind(null,a,!1),O),a.element.addEventListener("touchmove",r.bind(null,a),O),a.element.addEventListener("mousemove",r.bind(null,a),O),window.PointerEvent,a.element.addEventListener("wheel",M.bind(null,a),O),a.element.addEventListener("contextmenu",C.bind(null,a),!1),window.addEventListener("blur",n.bind(null,a),!1)}var k=0,I=0,P=null;function e(a,O){O.preventDefault(),h(O)}function h(a){let O=!1;for(let i=0;i<a.touches.length;++i)if(a.touches[i].identifier===P){O=!0;break}if(!O){const O=a.changedTouches[0];k=O.clientX,I=O.clientY,P=O.identifier}}function j(a,O){for(var i=O.changedTouches,H=0;H<i.length;++H)i[H].identifier===P&&(P=null)}function Z(a,O,i){D(i.code,O,a,i)}function F(a,O,i){if("pointerId"in i)if(O){if(null!==a._touches.currID)return;a._touches.currID=i.pointerId}else{if(a._touches.currID!==i.pointerId)return;a._touches.currID=null}return D("Mouse"+("button"in i?i.button+1:1),O,a,i),!1}function r(a,O){var i=O.movementX||O.mozMovementX||0,H=O.movementY||O.mozMovementY||0;if(O.touches&&0===(i|H)){var b=function(a){h(a);for(let O=0;O<a.changedTouches.length;++O)if(a.changedTouches[O].identifier==P){const i=a.changedTouches[O],H=[i.clientX-k,i.clientY-I];return k=i.clientX,I=i.clientY,H}return console.error(`Did not find touch id ${P}`),[0,0]}(O);i=b[0],H=b[1]}if(a.maxPointerMovement>0){var G=Math.abs(i)>a.maxPointerMovement&&Math.abs(i/J)>4,q=Math.abs(H)>a.maxPointerMovement&&Math.abs(H/ma)>4;G||q?(J=(J+(i=0))/2,ma=(ma+(H=0))/2):(a.xI.dx+=i,a.xI.dy+=H,J=i||1,ma=H||1)}}var J=0,ma=0;function M(a,O){var i=1;switch(O.deltaMode){case 0:i=1;break;case 1:i=12;break;case 2:i=a.element.clientHeight||window.innerHeight}a.xI.lj+=(O.deltaX||0)*i,a.xI.zI+=(O.deltaY||0)*i,a.xI.Wj+=(O.deltaZ||0)*i}function C(a,O){if(!a.Xh)return O.preventDefault(),!1}function n(a){for(var O in a._keyStates)a._keyStates[O]&&(/^Mouse\d/.test(O)||D(O,!1,a,{code:O,note:"fkrj2xw7y3m",preventDefault:()=>{},stopPropagation:()=>{}}))}function D(a,O,i,H){var b=i._keyBindmap[a];b&&(U(i._keyStates[a],O)&&(i._keyStates[a]=O,b.forEach((a=>{(!i.filterEvents||i.filterEvents(H,a))&&function(a,O,i,H){var b=O?i.pressCount:i.releaseCount;b[a]=(b[a]||0)+1;var G=i._bindPressCount[a]||0;(G+=O?1:-1)<0&&(G=0);i._bindPressCount[a]=G;var q=i.state[a];if(U(q,G)){i.state[a]=G>0;var Q=O?i.down:i.up;i.disabled||Q.emit(a,H)}}(a,O,i,H)}))),"button"in H||(i.Nh&&!H.defaultPrevented&&H.preventDefault(),i.stopPropagation&&H.stopPropagation()))}function U(a,O){return a?!O:O}},13293:a=>{a.exports=function(a,O,i){return a[0]=O[0]+i[0],a[1]=O[1]+i[1],a[2]=O[2]+i[2],a}},13240:(a,O,i)=>{a.exports=function(a,O){var i=H(a[0],a[1],a[2]),q=H(O[0],O[1],O[2]);b(i,i),b(q,q);var Q=G(i,q);return Q>1?0:Math.acos(Q)};var H=i(13247),b=i(13252),G=i(13260)},13338:a=>{a.exports=function(a,O){return a[0]=Math.ceil(O[0]),a[1]=Math.ceil(O[1]),a[2]=Math.ceil(O[2]),a}},13234:a=>{a.exports=function(a){var O=new Float32Array(3);return O[0]=a[0],O[1]=a[1],O[2]=a[2],O}},13267:a=>{a.exports=function(a,O){return a[0]=O[0],a[1]=O[1],a[2]=O[2],a}},13228:a=>{a.exports=function(){var a=new Float32Array(3);return a[0]=0,a[1]=0,a[2]=0,a}},13425:a=>{a.exports=function(a,O,i){var H=O[0],b=O[1],G=O[2],q=i[0],Q=i[1],k=i[2];return a[0]=b*k-G*Q,a[1]=G*q-H*k,a[2]=H*Q-b*q,a}},13360:(a,O,i)=>{a.exports=i(13357)},13357:a=>{a.exports=function(a,O){var i=O[0]-a[0],H=O[1]-a[1],b=O[2]-a[2];return Math.sqrt(i*i+H*H+b*b)}},13320:(a,O,i)=>{a.exports=i(13312)},13312:a=>{a.exports=function(a,O,i){return a[0]=O[0]/i[0],a[1]=O[1]/i[1],a[2]=O[2]/i[2],a}},13260:a=>{a.exports=function(a,O){return a[0]*O[0]+a[1]*O[1]+a[2]*O[2]}},13226:a=>{a.exports=1e-6},13282:(a,O,i)=>{a.exports=function(a,O){var i=a[0],b=a[1],G=a[2],q=O[0],Q=O[1],k=O[2];return Math.abs(i-q)<=H*Math.max(1,Math.abs(i),Math.abs(q))&&Math.abs(b-Q)<=H*Math.max(1,Math.abs(b),Math.abs(Q))&&Math.abs(G-k)<=H*Math.max(1,Math.abs(G),Math.abs(k))};var H=i(13226)},13288:a=>{a.exports=function(a,O){return a[0]===O[0]&&a[1]===O[1]&&a[2]===O[2]}},13332:a=>{a.exports=function(a,O){return a[0]=Math.floor(O[0]),a[1]=Math.floor(O[1]),a[2]=Math.floor(O[2]),a}},13472:(a,O,i)=>{a.exports=function(a,O,i,b,G,q){var Q,k;O||(O=3);i||(i=0);k=b?Math.min(b*O+i,a.length):a.length;for(Q=i;Q<k;Q+=O)H[0]=a[Q],H[1]=a[Q+1],H[2]=a[Q+2],G(H,H,q),a[Q]=H[0],a[Q+1]=H[1],a[Q+2]=H[2];return a};var H=i(13228)()},13247:a=>{a.exports=function(a,O,i){var H=new Float32Array(3);return H[0]=a,H[1]=O,H[2]=i,H}},13221:(a,O,i)=>{a.exports={EPSILON:i(13226),create:i(13228),clone:i(13234),angle:i(13240),EQ:i(13247),j:i(13267),set:i(13275),equals:i(13282),exactEquals:i(13288),add:i(13293),FO:i(13296),sub:i(13300),multiply:i(13303),mul:i(13307),divide:i(13312),div:i(13320),min:i(13324),max:i(13330),floor:i(13332),ceil:i(13338),round:i(13345),scale:i(13353),lQ:i(13355),distance:i(13357),i:i(13360),squaredDistance:i(13368),sqrDist:i(13375),length:i(13383),len:i(13392),squaredLength:i(13401),WQ:i(13410),negate:i(13419),inverse:i(13423),normalize:i(13252),dot:i(13260),cross:i(13425),BQ:i(13433),random:i(13435),transformMat4:i(13442),transformMat3:i(13451),transformQuat:i(13458),uQ:i(13461),cQ:i(13463),RQ:i(13467),forEach:i(13472)}},13423:a=>{a.exports=function(a,O){return a[0]=1/O[0],a[1]=1/O[1],a[2]=1/O[2],a}},13392:(a,O,i)=>{a.exports=i(13383)},13383:a=>{a.exports=function(a){var O=a[0],i=a[1],H=a[2];return Math.sqrt(O*O+i*i+H*H)}},13433:a=>{a.exports=function(a,O,i,H){var b=O[0],G=O[1],q=O[2];return a[0]=b+H*(i[0]-b),a[1]=G+H*(i[1]-G),a[2]=q+H*(i[2]-q),a}},13330:a=>{a.exports=function(a,O,i){return a[0]=Math.max(O[0],i[0]),a[1]=Math.max(O[1],i[1]),a[2]=Math.max(O[2],i[2]),a}},13324:a=>{a.exports=function(a,O,i){return a[0]=Math.min(O[0],i[0]),a[1]=Math.min(O[1],i[1]),a[2]=Math.min(O[2],i[2]),a}},13307:(a,O,i)=>{a.exports=i(13303)},13303:a=>{a.exports=function(a,O,i){return a[0]=O[0]*i[0],a[1]=O[1]*i[1],a[2]=O[2]*i[2],a}},13419:a=>{a.exports=function(a,O){return a[0]=-O[0],a[1]=-O[1],a[2]=-O[2],a}},13252:a=>{a.exports=function(a,O){var i=O[0],H=O[1],b=O[2],G=i*i+H*H+b*b;G>0&&(G=1/Math.sqrt(G),a[0]=O[0]*G,a[1]=O[1]*G,a[2]=O[2]*G);return a}},13435:a=>{a.exports=function(a,O){O=O||1;var i=2*Math.random()*Math.PI,H=2*Math.random()-1,b=Math.sqrt(1-H*H)*O;return a[0]=Math.cos(i)*b,a[1]=Math.sin(i)*b,a[2]=H*O,a}},13461:a=>{a.exports=function(a,O,i,H){var b=i[1],G=i[2],q=O[1]-b,Q=O[2]-G,k=Math.sin(H),I=Math.cos(H);return a[0]=O[0],a[1]=b+q*I-Q*k,a[2]=G+q*k+Q*I,a}},13463:a=>{a.exports=function(a,O,i,H){var b=i[0],G=i[2],q=O[0]-b,Q=O[2]-G,k=Math.sin(H),I=Math.cos(H);return a[0]=b+Q*k+q*I,a[1]=O[1],a[2]=G+Q*I-q*k,a}},13467:a=>{a.exports=function(a,O,i,H){var b=i[0],G=i[1],q=O[0]-b,Q=O[1]-G,k=Math.sin(H),I=Math.cos(H);return a[0]=b+q*I-Q*k,a[1]=G+q*k+Q*I,a[2]=O[2],a}},13345:a=>{a.exports=function(a,O){return a[0]=Math.round(O[0]),a[1]=Math.round(O[1]),a[2]=Math.round(O[2]),a}},13353:a=>{a.exports=function(a,O,i){return a[0]=O[0]*i,a[1]=O[1]*i,a[2]=O[2]*i,a}},13355:a=>{a.exports=function(a,O,i,H){return a[0]=O[0]+i[0]*H,a[1]=O[1]+i[1]*H,a[2]=O[2]+i[2]*H,a}},13275:a=>{a.exports=function(a,O,i,H){return a[0]=O,a[1]=i,a[2]=H,a}},13375:(a,O,i)=>{a.exports=i(13368)},13410:(a,O,i)=>{a.exports=i(13401)},13368:a=>{a.exports=function(a,O){var i=O[0]-a[0],H=O[1]-a[1],b=O[2]-a[2];return i*i+H*H+b*b}},13401:a=>{a.exports=function(a){var O=a[0],i=a[1],H=a[2];return O*O+i*i+H*H}},13300:(a,O,i)=>{a.exports=i(13296)},13296:a=>{a.exports=function(a,O,i){return a[0]=O[0]-i[0],a[1]=O[1]-i[1],a[2]=O[2]-i[2],a}},13451:a=>{a.exports=function(a,O,i){var H=O[0],b=O[1],G=O[2];return a[0]=H*i[0]+b*i[3]+G*i[6],a[1]=H*i[1]+b*i[4]+G*i[7],a[2]=H*i[2]+b*i[5]+G*i[8],a}},13442:a=>{a.exports=function(a,O,i){var H=O[0],b=O[1],G=O[2],q=i[3]*H+i[7]*b+i[11]*G+i[15];return q=q||1,a[0]=(i[0]*H+i[4]*b+i[8]*G+i[12])/q,a[1]=(i[1]*H+i[5]*b+i[9]*G+i[13])/q,a[2]=(i[2]*H+i[6]*b+i[10]*G+i[14])/q,a}},13458:a=>{a.exports=function(a,O,i){var H=O[0],b=O[1],G=O[2],q=i[0],Q=i[1],k=i[2],I=i[3],P=I*H+Q*G-k*b,e=I*b+k*H-q*G,h=I*G+q*b-Q*H,j=-q*H-Q*b-k*G;return a[0]=P*I+j*-q+e*-k-h*-Q,a[1]=e*I+j*-Q+h*-q-P*-k,a[2]=h*I+j*-k+P*-Q-e*-q,a}},14348:a=>{"use strict";a.exports=function(a){for(var O=new Array(a),i=0;i<a;++i)O[i]=i;return O}},14405:a=>{a.exports=function(a){return null!=a&&null!=a.constructor&&"function"===typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}},14621:(a,O,i)=>{"use strict";i.d(O,{d:()=>H});class H{constructor(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.dP=!1,this.YP=!1,this.pP=30,this.oP=0,this.Qe=!1,this.fullscreen=!1,this.sP=function(a){},this.tP=function(){},this.He=function(){},this.ib=function(){},this.VP=function(a){},this.onFullscreenChanged=function(a){},I((()=>{!function(a,O){a._nowObject=performance||Date,a._lastTick=0,a._renderAccum=0,a._rt=0,a._frameCB=Q.bind(null,a),requestAnimationFrame(a._frameCB),O>0&&(a._intervalCB=q.bind(null,a),a._interval=setInterval(a._intervalCB,Math.max(O,1e3/a.pP/2)))}(this,O),function(a,O){if(!O)return;var i=!1,H=!1;document.addEventListener("pointerlockchange",(H=>{i=document.pointerLockElement===O,a.VP(i)})),document.addEventListener("fullscreenchange",(i=>{H=document.fullscreenElement===O,a.onFullscreenChanged(H)})),Object.defineProperty(a,"Qe",{get:()=>i,set:a=>{a&&!i?k(O):i&&!a&&function(a){a.exitPointerLock&&a.exitPointerLock()}(document)}}),Object.defineProperty(a,"fullscreen",{get:()=>H,set:a=>{a&&!H?O.requestFullscreen():H&&!a&&document.exitFullscreen()}}),O.addEventListener("click",(b=>{a.dP&&!i&&k(O),a.YP&&!H&&O.requestFullscreen()}));var b=()=>a.ib();if(window.ResizeObserver){new ResizeObserver(b).observe(O)}else window.addEventListener("resize",b)}(this,a),this.He()}))}}var b=3,G=20;function q(a){for(var O=1e3/a.pP,i=a._nowObject.now()+G,H=0;a._nowObject.now()>=a._lastTick+O&&a._nowObject.now()<i&&++H<=b;)a.sP(O),a._lastTick+=O;var q=5*(O+5),Q=a._nowObject.now();if(Q-a._lastTick>q)for(;Q>=a._lastTick+O;)a._lastTick+=O}function Q(a){requestAnimationFrame(a._frameCB),q(a);var O=a._nowObject.now(),i=O-a._rt;if(a._rt=O,a.oP>0){a._renderAccum+=i;var H=1e3/a.oP;if(a._renderAccum<H)return;a._renderAccum=Math.min(a._renderAccum-H,H)}var b=1e3/a.pP,G=(O-a._lastTick)/b;a.tP(i,G,b)}function k(a){a.requestPointerLock&&a.requestPointerLock()}var I=a=>{if("loading"===document.readyState){var O=()=>{document.removeEventListener("readystatechange",O),a()};document.addEventListener("readystatechange",O)}else setTimeout(a,1)}},14344:(a,O,i)=>{var H=i(14348),b=i(14353),G="undefined"!==typeof Float64Array;function q(a,O){return a[0]-O[0]}function Q(){var a,O=this.stride,i=new Array(O.length);for(a=0;a<i.length;++a)i[a]=[Math.abs(O[a]),a];i.sort(q);var H=new Array(i.length);for(a=0;a<H.length;++a)H[a]=i[a][1];return H}function k(a,O){var i=["View",O,"d",a].join("");O<0&&(i="View_Nil"+a);var b="generic"===a;if(-1===O){var G="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+a+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(G)()}if(0===O){G="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+a+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(b?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(b?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}";return new Function("TrivialArray",G)(I[a][0])}G=["'use strict'"];var q=H(O),k=q.map((function(a){return"i"+a})),P="this.offset+"+q.map((function(a){return"this.stride["+a+"]*i"+a})).join("+"),e=q.map((function(a){return"b"+a})).join(","),h=q.map((function(a){return"c"+a})).join(",");G.push("function "+i+"(a,"+e+","+h+",d){this.data=a","this.shape=["+e+"]","this.stride=["+h+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+a+"'","proto.dimension="+O),G.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+q.map((function(a){return"this.shape["+a+"]"})).join("*"),"}})"),1===O?G.push("proto.order=[0]"):(G.push("Object.defineProperty(proto,'order',{get:"),O<4?(G.push("function "+i+"_order(){"),2===O?G.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===O&&G.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):G.push("ORDER})")),G.push("proto.set=function "+i+"_set("+k.join(",")+",v){"),b?G.push("return this.data.set("+P+",v)}"):G.push("return this.data["+P+"]=v}"),G.push("proto.get=function "+i+"_get("+k.join(",")+"){"),b?G.push("return this.data.get("+P+")}"):G.push("return this.data["+P+"]}"),G.push("proto.index=function "+i+"_index(",k.join(),"){return "+P+"}"),G.push("proto.hi=function "+i+"_hi("+k.join(",")+"){return new "+i+"(this.data,"+q.map((function(a){return["(typeof i",a,"!=='number'||i",a,"<0)?this.shape[",a,"]:i",a,"|0"].join("")})).join(",")+","+q.map((function(a){return"this.stride["+a+"]"})).join(",")+",this.offset)}");var j=q.map((function(a){return"a"+a+"=this.shape["+a+"]"})),Z=q.map((function(a){return"c"+a+"=this.stride["+a+"]"}));G.push("proto.lo=function "+i+"_lo("+k.join(",")+"){var b=this.offset,d=0,"+j.join(",")+","+Z.join(","));for(var F=0;F<O;++F)G.push("if(typeof i"+F+"==='number'&&i"+F+">=0){d=i"+F+"|0;b+=c"+F+"*d;a"+F+"-=d}");G.push("return new "+i+"(this.data,"+q.map((function(a){return"a"+a})).join(",")+","+q.map((function(a){return"c"+a})).join(",")+",b)}"),G.push("proto.step=function "+i+"_step("+k.join(",")+"){var "+q.map((function(a){return"a"+a+"=this.shape["+a+"]"})).join(",")+","+q.map((function(a){return"b"+a+"=this.stride["+a+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(F=0;F<O;++F)G.push("if(typeof i"+F+"==='number'){d=i"+F+"|0;if(d<0){c+=b"+F+"*(a"+F+"-1);a"+F+"=ceil(-a"+F+"/d)}else{a"+F+"=ceil(a"+F+"/d)}b"+F+"*=d}");G.push("return new "+i+"(this.data,"+q.map((function(a){return"a"+a})).join(",")+","+q.map((function(a){return"b"+a})).join(",")+",c)}");var r=new Array(O),J=new Array(O);for(F=0;F<O;++F)r[F]="a[i"+F+"]",J[F]="b[i"+F+"]";G.push("proto.transpose=function "+i+"_transpose("+k+"){"+k.map((function(a,O){return a+"=("+a+"===undefined?"+O+":"+a+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+r.join(",")+","+J.join(",")+",this.offset)}"),G.push("proto.pick=function "+i+"_pick("+k+"){var a=[],b=[],c=this.offset");for(F=0;F<O;++F)G.push("if(typeof i"+F+"==='number'&&i"+F+">=0){c=(c+this.stride["+F+"]*i"+F+")|0}else{a.push(this.shape["+F+"]);b.push(this.stride["+F+"])}");return G.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),G.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+q.map((function(a){return"shape["+a+"]"})).join(",")+","+q.map((function(a){return"stride["+a+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",G.join("\n"))(I[a],Q)}var I={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};a.exports=function(a,O,i,H){if(void 0===a)return(0,I.array[0])([]);"number"===typeof a&&(a=[a]),void 0===O&&(O=[a.length]);var q=O.length;if(void 0===i){i=new Array(q);for(var Q=q-1,P=1;Q>=0;--Q)i[Q]=P,P*=O[Q]}if(void 0===H){H=0;for(Q=0;Q<q;++Q)i[Q]<0&&(H-=(O[Q]-1)*i[Q])}for(var e=function(a){if(b(a))return"buffer";if(G)switch(Object.prototype.toString.call(a)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(a)?"array":"generic"}(a),h=I[e];h.length<=q+1;)h.push(k(e,h.length-1));return(0,h[q+1])(a,O,i,H)}},14353:a=>{function O(a){return!!a.constructor&&"function"===typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}a.exports=function(a){return null!=a&&(O(a)||function(a){return"function"===typeof a.readFloatLE&&"function"===typeof a.slice&&O(a.slice(0,0))}(a)||!!a._isBuffer)}},14496:a=>{"use strict";var O=[],i=[],H=[],b=[],G=[],q=[],Q=[],k=[],I=[],P=[],e=[],h=[];a.exports=function(a,j,Z,F,r,J){for(var ma=Q,M=I,C=P,n=h,D=0;D<3;D++)ma[D]=+Z[D],C[D]=+j.max[D],M[D]=+j.base[D];J||(J=1e-10);var U=function(a,Q,I,P,h,j){var Z=O,F=i,r=H,J=b,ma=G,M=q,C=k,n=Math.floor,D=0,U=0,y=0,w=0,K=0;if(S(),0===y)return 0;for(w=T();U<=y;){if(f(w)&&B())return D;w=T()}for(D+=y,K=0;K<3;K++)P[K]+=I[K],h[K]+=I[K];return D;function S(){if(U=0,0!==(y=Math.sqrt(I[0]*I[0]+I[1]*I[1]+I[2]*I[2])))for(var a=0;a<3;a++){var O=I[a]>=0;J[a]=O?1:-1;var i=O?h[a]:P[a];Z[a]=O?P[a]:h[a],F[a]=A(i,J[a]),r[a]=E(Z[a],J[a]),C[a]=I[a]/y,ma[a]=Math.abs(1/C[a]);var H=O?F[a]+1-i:i-F[a];M[a]=ma[a]<1/0?ma[a]*H:1/0}}function f(O){for(var i=J[0],H=0===O?F[0]:r[0],b=F[0]+i,G=J[1],q=1===O?F[1]:r[1],Q=F[1]+G,k=J[2],I=2===O?F[2]:r[2],P=F[2]+k,e=H;e!=b;e+=i)for(var h=q;h!=Q;h+=G)for(var j=I;j!=P;j+=k)if(a(e,h,j))return!0;return!1}function B(){D+=U;var a=J[w],O=U/y,i=e;for(K=0;K<3;K++){var H=I[K]*O;P[K]+=H,h[K]+=H,i[K]=I[K]-H}if(a>0?h[w]=Math.round(h[w]):P[w]=Math.round(P[w]),Q(D,w,a,i))return!0;for(K=0;K<3;K++)I[K]=i[K];return S(),0===y}function T(){var a=M[0]<M[1]?M[0]<M[2]?0:2:M[1]<M[2]?1:2,O=M[a]-U;for(U=M[a],F[a]+=J[a],M[a]+=ma[a],K=0;K<3;K++)Z[K]+=O*C[K],r[K]=E(Z[K],J[K]);return a}function A(a,O){return n(a-O*j)}function E(a,O){return n(a+O*j)}}(a,F,ma,M,C,J);if(!r){for(D=0;D<3;D++)n[D]=Z[D]>0?C[D]-j.max[D]:M[D]-j.base[D];j.translate(n)}return U}},14659:(a,O,i)=>{"use strict";i.d(O,{d:()=>e});var H=i(14492),b=i(13221);class G{constructor(a,O,i,G,q,Q,k){this.pI=new H(a.base,a.kP),this.jG=O,this.friction=i,this.restitution=G,this.DQ=q,this.OZ=Q,this.UQ=!!k,this.QP=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.gZ=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.CI=b.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=b.create(),this._impulses=b.create(),this._sleepFrameCount=10}loadFromCopy(a){b.j(this.pI.base,a.pI.base),b.j(this.pI.kP,a.pI.kP),b.j(this.pI.max,a.pI.max),this.pI.mag=a.pI.mag,this.jG=a.jG,this.friction=a.friction,this.restitution=a.restitution,this.DQ=a.DQ,this.OZ=a.OZ,this.UQ=a.UQ,this.QP=a.QP,this.fluidDrag=a.fluidDrag,this.gZ=a.gZ,this.preventFallOffEdge=a.preventFallOffEdge,this.rolledBackLastTick=a.rolledBackLastTick,b.j(this.CI,a.CI),b.j(this.resting,a.resting),this.inFluid=a.inFluid,this._ratioInFluid=a._ratioInFluid,b.j(this._forces,a._forces),b.j(this._impulses,a._impulses),this._sleepFrameCount=a._sleepFrameCount}setPosition(a){q(a),b.FO(a,a,this.pI.base),this.pI.translate(a),this.UI()}Hb(){return b.clone(this.pI.base)}applyForce(a){q(a),b.add(this._forces,this._forces,a),this.UI()}applyImpulse(a){q(a),b.add(this._impulses,this._impulses,a),this.UI()}UI(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var q=a=>{};var Q=i(14492),k=i(13221),I=i(14496);function P(){this.QP=.1,this.fluidDrag=.4,this.fQ=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function e(a,O,i){a=Object.assign(new P,a),this.gravity=a.gravity||[0,-10,0],this.QP=a.QP||.1,this.fQ=a.fQ||2,this.fluidDrag=a.fluidDrag||.4,this.minBounceImpulse=a.minBounceImpulse,this.bodies=[],this.Uj=a.Uj,this.testSolid=O,this.testFluid=i}e.prototype.kZ=function(a,O,i,H,b,q){a=a||new Q([0,0,0],[1,1,1]),"undefined"==typeof O&&(O=1),"undefined"==typeof i&&(i=1),"undefined"==typeof H&&(H=0),"undefined"==typeof b&&(b=1);var k=new G(a,O,i,H,b,q);return this.bodies.push(k),k},e.prototype.IZ=function(a){var O=this.bodies.indexOf(a);O<0||(this.bodies.splice(O,1),a.pI=a.OZ=null)};var h=k.create(),j=k.create(),Z=k.create(),F=k.create(),r=k.create(),J=k.create(),ma=k.create(),M=new Q([0,0,0],[1,1,1]),C=new G(M,1,1,0,1,(()=>{}),!1);function n(a,O,i){return O=i,O*=1-(1-a.ratioInFluid)**2}e.prototype.NQ=function(a){a/=1e3;var O=R(0,k.squaredLength(this.gravity));this.bodies.forEach((i=>function(a,O,i,H){k.j(r,O.resting),a.Uj&&C.loadFromCopy(O);if(O.jG<=0)return k.set(O.CI,0,0,0),k.set(O._forces,0,0,0),void k.set(O._impulses,0,0,0);var b=H||0===O.DQ;if(function(a,O,i,H){if(O._sleepFrameCount>0)return!1;if(H)return!0;var b=!1,G=.5*i*i*O.DQ;return k.scale(c,a.gravity,G),I(a.testSolid,O.pI,c,(function(){return b=!0,!0}),!0),b}(a,O,i,b))return;O._sleepFrameCount--,function(a,O){var i=O.pI,H=Math.floor(i.base[0]),b=Math.floor(i.base[2]),G=Math.floor(i.base[1]),q=Math.floor(i.max[1]);if(!a.testFluid(H,G,b))return O.inFluid=!1,void(O.ratioInFluid=0);var Q=1,I=G+1;for(;I<=q&&a.testFluid(H,I,b);)Q++,I++;var P=(G+Q-i.base[1])/i.kP[1];P>1&&(P=1);var e=i.kP[0]*i.kP[1]*i.kP[2]*P,h=U;k.scale(h,a.gravity,-a.fQ*e*O.DQ),O.applyForce(h),O.inFluid=!0,O.ratioInFluid=P}(a,O),x(O._forces),x(O._impulses),x(O.CI),x(O.resting),k.scale(h,O._forces,1/O.jG),k.lQ(h,h,a.gravity,O.DQ),k.scale(j,O._impulses,1/O.jG),k.lQ(j,j,h,i),k.add(O.CI,O.CI,j),O.friction&&(y(a,0,O,j,i),y(a,1,O,j,i),y(a,2,O,j,i));var G=O.fluidDrag>=0?O.fluidDrag:a.fluidDrag,q=O.QP>=0?O.QP:a.QP,Q=q,P=q;O.inFluid&&(Q=n(O,Q,O.fluidDragHoriz>=0?O.fluidDragHoriz:G),P=n(O,P,O.fluidDragVert>=0?O.fluidDragVert:G));Q=Math.max(1-Q*i/O.jG,0),P=Math.max(1-P*i/O.jG,0),k.set(D,Q,P,Q),k.multiply(O.CI,O.CI,D),k.scale(Z,O.CI,i),k.set(O._forces,0,0,0),k.set(O._impulses,0,0,0),O.UQ&&z(S,O.pI);k.j(J,Z),k.set(ma,0,0,0),O.preventFallOffEdge&&function(a,O,i,H){if(!O.resting[1]||i[1]>0)return;var b=l;z(b,O.pI);for(var G=0;G<3;G+=2){k.set(E,0,0,0),E[G]=i[G];var q=!0;(q=(q=(q=(q=q&&!u(a,b.base[0]+E[0]+1e-5,b.base[1],b.base[2]+E[2]+1e-5))&&!u(a,b.max[0]+E[0]-1e-5,b.base[1],b.base[2]+E[2]+1e-5))&&!u(a,b.base[0]+E[0]+1e-5,b.base[1],b.max[2]+E[2]-1e-5))&&!u(a,b.max[0]+E[0]-1e-5,b.base[1],b.max[2]+E[2]-1e-5))?(H[G]=i[G]>0?1:-1,i[G]=0):0===G&&(k.set(W,i[0],0,0),K(a,b,W,H,O.slideOnCollision))}}(a,O,Z,ma);K(a,O.pI,Z,O.resting,O.slideOnCollision),O.UQ&&function(a,O,i,H){if(O.resting[1]>=0&&!O.inFluid)return;var b=0!==O.resting[0],G=0!==O.resting[2];if(!b&&!G)return;var q=Math.abs(H[0]/H[2]),Q=4;if(!b&&q>Q)return;if(!G&&q<1/Q)return;k.add(B,i.base,H);var P=a.testSolid;I(P,i,H,(function(a,O,i,H){if(1!==O)return!0;H[O]=0}));var e=i.base[1],h=O.inFluid?1.951:1.001,j=Math.floor(e+h)-e;k.set(T,0,j,0);var Z=!1;if(I(P,i,T,(function(a,O,i,H){return Z=!0,!0})),Z)return;k.FO(A,B,i.base),A[1]=0,K(a,i,A,f,!0);var F=R(i.base[0],B[0]),r=R(i.base[2],B[2]);if(b&&!F&&(!r||!G))return;if(G&&(!F||!b)&&!r)return;var J=!0;if(J=J&&!u(a,i.base[0]+1e-5,i.base[1],i.base[2]+1e-5),J=J&&!u(a,i.max[0]-1e-5,i.base[1],i.base[2]+1e-5),J=J&&!u(a,i.base[0]+1e-5,i.base[1],i.max[2]-1e-5),J=J&&!u(a,i.max[0]-1e-5,i.base[1],i.max[2]-1e-5),J)return;z(O.pI,i),O.resting[0]=f[0],O.resting[2]=f[2],O.gZ&&O.gZ()}(a,O,S,J);for(var e=0;e<3;++e)O.resting[e]=O.resting[e]||ma[e],F[e]=0,O.resting[e]&&(r[e]||(F[e]=-O.CI[e]),O.CI[e]=0);var M=k.length(F);M>.001&&(k.scale(F,F,O.jG),O.OZ&&O.OZ(F),O.restitution>0&&M>a.minBounceImpulse&&(k.scale(F,F,O.restitution),O.applyImpulse(F)));var w=k.squaredLength(O.CI);w>1e-5&&O.UI();a.Uj&&a.Uj(O)?(O.loadFromCopy(C),O.rolledBackLastTick=!0):O.rolledBackLastTick=!1}(this,i,a,O)))};var D=k.create([0,0,0]);var U=k.create();function y(a,O,i,H,b){var G=i.resting[O],q=H[O];if(!i.alwaysApplyHorizFriction||1!==O){if(0===G)return;if(G*q<=0)return}k.j(w,i.CI),w[O]=0;var Q=k.length(w);if(!R(Q,0)){var I=Math.abs(i.friction*a.gravity[O]*b),P=Q>I?(Q-I)/Q:0;i.CI[(O+1)%3]*=P,i.CI[(O+2)%3]*=P}}var w=k.create();function K(a,O,i,H,b){return k.set(H,0,0,0),I(a.testSolid,O,i,(function(a,O,i,G){H[O]=i,G[O]=0,b||(G[0]=0,G[1]=0,G[2]=0)}))}var S=new Q([],[]),f=k.create(),B=k.create(),T=k.create(),A=k.create();var E=k.create(),l=new Q([],[]),W=k.create();function u(a,O,i,H){return a.testSolid(Math.floor(O),Math.floor(i-1),Math.floor(H))}var c=k.create();function R(a,O){return Math.abs(a-O)<1e-5}function z(a,O){for(var i=0;i<3;i++)a.base[i]=O.base[i],a.max[i]=O.max[i],a.kP[i]=O.kP[i]}var x=function(a){}},13084:function(a,O){!function(a){"use strict";var O=function(a,i){return O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,O){a.__proto__=O}||function(a,O){for(var i in O)Object.prototype.hasOwnProperty.call(O,i)&&(a[i]=O[i])},O(a,i)};function i(a,i){if("function"!==typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function H(){this.constructor=a}O(a,i),a.prototype=null===i?Object.create(i):(H.prototype=i.prototype,new H)}function H(a,O,i,H){var b,G=arguments.length,q=G<3?O:null===H?H=Object.getOwnPropertyDescriptor(O,i):H;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)q=Reflect.decorate(a,O,i,H);else for(var Q=a.length-1;Q>=0;Q--)(b=a[Q])&&(q=(G<3?b(q):G>3?b(O,i,q):b(O,i))||q);return G>3&&q&&Object.defineProperty(O,i,q),q}function b(a,O,i){if(i||2===arguments.length)for(var H,b=0,G=O.length;b<G;b++)!H&&b in O||(H||(H=Array.prototype.slice.call(O,0,b)),H[b]=O[b]);return a.concat(H||Array.prototype.slice.call(O))}var G,q=255,Q=213;a.OPERATION=void 0,(G=a.OPERATION||(a.OPERATION={}))[G.ADD=128]="ADD",G[G.REPLACE=0]="REPLACE",G[G.DELETE=64]="DELETE",G[G.DELETE_AND_ADD=192]="DELETE_AND_ADD",G[G.TOUCH=1]="TOUCH",G[G.CLEAR=10]="CLEAR";var k=function(){function O(a,O,i){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=a,this.setParent(O,i)}return O.prototype.setParent=function(a,O,i){var H=this;if(this.indexes||(this.indexes=this.ref instanceof Aa?this.ref._definition.indexes:{}),this.parent=a,this.parentIndex=i,O)if(this.root=O,this.ref instanceof Aa){var b=this.ref._definition;for(var G in b.schema){var q=this.ref[G];if(q&&q.$changes){var Q=b.indexes[G];q.$changes.setParent(this.ref,O,Q)}}}else"object"===typeof this.ref&&this.ref.forEach((function(a,O){if(a instanceof Aa){var i=a.$changes,b=H.ref.$changes.indexes[O];i.setParent(H.ref,H.root,b)}}))},O.prototype.operation=function(a){this.changes.set(--this.currentCustomOperation,a)},O.prototype.change=function(O,i){void 0===i&&(i=a.OPERATION.ADD);var H="number"===typeof O?O:this.indexes[O];this.assertValidIndex(H,O);var b=this.changes.get(H);b&&b.op!==a.OPERATION.DELETE&&b.op!==a.OPERATION.TOUCH||this.changes.set(H,{op:b&&b.op===a.OPERATION.DELETE?a.OPERATION.DELETE_AND_ADD:i,index:H}),this.allChanges.add(H),this.changed=!0,this.touchParents()},O.prototype.touch=function(O){var i="number"===typeof O?O:this.indexes[O];this.assertValidIndex(i,O),this.changes.has(i)||this.changes.set(i,{op:a.OPERATION.TOUCH,index:i}),this.allChanges.add(i),this.touchParents()},O.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},O.prototype.getType=function(a){if(this.ref._definition)return(O=this.ref._definition).schema[O.fieldsByIndex[a]];var O,i=(O=this.parent._definition).schema[O.fieldsByIndex[this.parentIndex]];return Object.values(i)[0]},O.prototype.getChildrenFilter=function(){var a=this.parent._definition.childFilters;return a&&a[this.parentIndex]},O.prototype.getValue=function(a){return this.ref.getByIndex(a)},O.prototype.delete=function(O){var i="number"===typeof O?O:this.indexes[O];if(void 0!==i){var H=this.getValue(i);this.changes.set(i,{op:a.OPERATION.DELETE,index:i}),this.allChanges.delete(i),delete this.caches[i],H&&H.$changes&&(H.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(O," (").concat(i,")"))},O.prototype.discard=function(O,i){var H=this;void 0===O&&(O=!1),void 0===i&&(i=!1),this.ref instanceof Aa||this.changes.forEach((function(O){if(O.op===a.OPERATION.DELETE){var i=H.ref.getIndex(O.index);delete H.indexes[i]}})),this.changes.clear(),this.changed=O,i&&this.allChanges.clear(),this.currentCustomOperation=0},O.prototype.discardAll=function(){var a=this;this.changes.forEach((function(O){var i=a.getValue(O.index);i&&i.$changes&&i.$changes.discardAll()})),this.discard()},O.prototype.cache=function(a,O){this.caches[a]=O},O.prototype.clone=function(){return new O(this.ref,this.parent,this.root)},O.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},O.prototype.assertValidIndex=function(a,O){if(void 0===a)throw new Error('ChangeTree: missing index for field "'.concat(O,'"'))},O}();function I(a,O,i,H){return a[O]||(a[O]=[]),a[O].push(i),null===H||void 0===H||H.forEach((function(a,O){return i(a,O)})),function(){return e(a[O],a[O].indexOf(i))}}function P(O){var i=this,H="string"!==typeof this.$changes.getType();this.$items.forEach((function(b,G){O.push({refId:i.$changes.refId,op:a.OPERATION.DELETE,field:G,value:void 0,previousValue:b}),H&&i.$changes.root.removeRef(b.$changes.refId)}))}function e(a,O){if(-1===O||O>=a.length)return!1;for(var i=a.length-1,H=O;H<i;H++)a[H]=a[H+1];return a.length=i,!0}var h=function(a,O){var i=a.toString(),H=O.toString();return i<H?-1:i>H?1:0};function j(a){return a.$proxy=!0,a=new Proxy(a,{get:function(a,O){return"symbol"===typeof O||isNaN(O)?a[O]:a.at(O)},set:function(a,O,i){if("symbol"===typeof O||isNaN(O))a[O]=i;else{var H=Array.from(a.$items.keys()),b=parseInt(H[O]||O);void 0===i||null===i?a.deleteAt(b):a.setAt(b,i)}return!0},deleteProperty:function(a,O){return"number"===typeof O?a.deleteAt(O):delete a[O],!0}})}var Z=function(){function O(){for(var a=[],O=0;O<arguments.length;O++)a[O]=arguments[O];this.$changes=new k(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,a)}return O.prototype.XQ=function(O,i){return void 0===i&&(i=!0),I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.ADD,O,i?this.$items:void 0)},O.prototype.mb=function(O){return I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,O)},O.is=function(a){return Array.isArray(a)||void 0!==a.array},Object.defineProperty(O.prototype,"length",{get:function(){return this.$items.size},set:function(a){0===a?this.clear():this.splice(a,this.length-a)},enumerable:!1,configurable:!0}),O.prototype.push=function(){for(var a,O=this,i=[],H=0;H<arguments.length;H++)i[H]=arguments[H];return i.forEach((function(i){a=O.$refId++,O.setAt(a,i)})),a},O.prototype.pop=function(){var a=Array.from(this.$indexes.values()).pop();if(void 0!==a){this.$changes.delete(a),this.$indexes.delete(a);var O=this.$items.get(a);return this.$items.delete(a),O}},O.prototype.at=function(a){var O=Array.from(this.$items.keys())[a];return this.$items.get(O)},O.prototype.setAt=function(O,i){var H,b;if(void 0!==i&&null!==i){if(this.$items.get(O)!==i){void 0!==i.$changes&&i.$changes.setParent(this,this.$changes.root,O);var G=null!==(b=null===(H=this.$changes.indexes[O])||void 0===H?void 0:H.op)&&void 0!==b?b:a.OPERATION.ADD;this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,i),this.$changes.change(O,G)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},O.prototype.deleteAt=function(a){var O=Array.from(this.$items.keys())[a];return void 0!==O&&this.$deleteAt(O)},O.prototype.$deleteAt=function(a){return this.$changes.delete(a),this.$indexes.delete(a),this.$items.delete(a)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&P.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:a.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.concat=function(){for(var a,i=[],H=0;H<arguments.length;H++)i[H]=arguments[H];return new(O.bind.apply(O,b([void 0],(a=Array.from(this.$items.values())).concat.apply(a,i),!1)))},O.prototype.join=function(a){return Array.from(this.$items.values()).join(a)},O.prototype.reverse=function(){var a=this,O=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(i,H){a.setAt(O[H],i)})),this},O.prototype.shift=function(){var a=Array.from(this.$items.keys()).shift();if(void 0!==a){var O=this.$items.get(a);return this.$deleteAt(a),O}},O.prototype.slice=function(a,i){var H=new O;return H.push.apply(H,Array.from(this.$items.values()).slice(a,i)),H},O.prototype.sort=function(a){var O=this;void 0===a&&(a=h);var i=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(a).forEach((function(a,H){O.setAt(i[H],a)})),this},O.prototype.splice=function(a,O){void 0===O&&(O=this.length-a);for(var i=Array.from(this.$items.keys()),H=[],b=a;b<a+O;b++)H.push(this.$items.get(i[b])),this.$deleteAt(i[b]);return H},O.prototype.unshift=function(){for(var a=this,O=[],i=0;i<arguments.length;i++)O[i]=arguments[i];var H=this.length,b=O.length,G=Array.from(this.$items.values());return O.forEach((function(O,i){a.setAt(i,O)})),G.forEach((function(O,i){a.setAt(b+i,O)})),H+b},O.prototype.indexOf=function(a,O){return Array.from(this.$items.values()).indexOf(a,O)},O.prototype.lastIndexOf=function(a,O){return void 0===O&&(O=this.length-1),Array.from(this.$items.values()).lastIndexOf(a,O)},O.prototype.every=function(a,O){return Array.from(this.$items.values()).every(a,O)},O.prototype.some=function(a,O){return Array.from(this.$items.values()).some(a,O)},O.prototype.forEach=function(a,O){Array.from(this.$items.values()).forEach(a,O)},O.prototype.map=function(a,O){return Array.from(this.$items.values()).map(a,O)},O.prototype.filter=function(a,O){return Array.from(this.$items.values()).filter(a,O)},O.prototype.reduce=function(a,O){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},O.prototype.reduceRight=function(a,O){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},O.prototype.find=function(a,O){return Array.from(this.$items.values()).find(a,O)},O.prototype.findIndex=function(a,O){return Array.from(this.$items.values()).findIndex(a,O)},O.prototype.fill=function(a,O,i){throw new Error("ArraySchema#fill() not implemented")},O.prototype.copyWithin=function(a,O,i){throw new Error("ArraySchema#copyWithin() not implemented")},O.prototype.toString=function(){return this.$items.toString()},O.prototype.toLocaleString=function(){return this.$items.toLocaleString()},O.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},O.prototype.includes=function(a,O){return Array.from(this.$items.values()).includes(a,O)},O.prototype.flatMap=function(a,O){throw new Error("ArraySchema#flatMap() is not supported.")},O.prototype.flat=function(a){throw new Error("ArraySchema#flat() is not supported.")},O.prototype.findLast=function(){var a=Array.from(this.$items.values());return a.findLast.apply(a,arguments)},O.prototype.findLastIndex=function(){var a=Array.from(this.$items.values());return a.findLastIndex.apply(a,arguments)},O.prototype.setIndex=function(a,O){this.$indexes.set(a,O)},O.prototype.getIndex=function(a){return this.$indexes.get(a)},O.prototype.getByIndex=function(a){return this.$items.get(this.$indexes.get(a))},O.prototype.deleteByIndex=function(a){var O=this.$indexes.get(a);this.$items.delete(O),this.$indexes.delete(a)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){return this.toArray().map((function(a){return"function"===typeof a.toJSON?a.toJSON():a}))},O.prototype.clone=function(a){return a?new(O.bind.apply(O,b([void 0],Array.from(this.$items.values()),!1))):new(O.bind.apply(O,b([void 0],this.map((function(a){return a.$changes?a.clone():a})),!1)))},O}();function F(a){return a.$proxy=!0,a=new Proxy(a,{get:function(a,O){return"symbol"!==typeof O&&"undefined"===typeof a[O]?a.get(O):a[O]},set:function(a,O,i){return"symbol"!==typeof O&&-1===O.indexOf("$")&&"XQ"!==O&&"mb"!==O&&"onChange"!==O?a.set(O,i):a[O]=i,!0},deleteProperty:function(a,O){return a.delete(O),!0}})}var r=function(){function O(a){var i=this;if(this.$changes=new k(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,a)if(a instanceof Map||a instanceof O)a.forEach((function(a,O){return i.set(O,a)}));else for(var H in a)this.set(H,a[H])}return O.prototype.XQ=function(O,i){return void 0===i&&(i=!0),I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.ADD,O,i?this.$items:void 0)},O.prototype.mb=function(O){return I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,O)},O.is=function(a){return void 0!==a.map},O.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(O.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.set=function(O,i){if(void 0===i||null===i)throw new Error("MapSchema#set('".concat(O,"', ").concat(i,"): trying to set ").concat(i," value on '").concat(O,"'."));O=O.toString();var H="undefined"!==typeof this.$changes.indexes[O],b=H?this.$changes.indexes[O]:this.$refId++,G=H?a.OPERATION.REPLACE:a.OPERATION.ADD,q=void 0!==i.$changes;if(q&&i.$changes.setParent(this,this.$changes.root,b),H){if(!q&&this.$items.get(O)===i)return;q&&this.$items.get(O)!==i&&(G=a.OPERATION.ADD)}else this.$changes.indexes[O]=b,this.$indexes.set(b,O);return this.$items.set(O,i),this.$changes.change(O,G),this},O.prototype.get=function(a){return this.$items.get(a)},O.prototype.delete=function(a){return this.$changes.delete(a),this.$items.delete(a)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&P.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:a.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(a){return this.$items.has(a)},O.prototype.forEach=function(a){this.$items.forEach(a)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(a,O){this.$indexes.set(a,O)},O.prototype.getIndex=function(a){return this.$indexes.get(a)},O.prototype.getByIndex=function(a){return this.$items.get(this.$indexes.get(a))},O.prototype.deleteByIndex=function(a){var O=this.$indexes.get(a);this.$items.delete(O),this.$indexes.delete(a)},O.prototype.toJSON=function(){var a={};return this.forEach((function(O,i){a[i]="function"===typeof O.toJSON?O.toJSON():O})),a},O.prototype.clone=function(a){var i;return a?i=Object.assign(new O,this):(i=new O,this.forEach((function(a,O){a.$changes?i.set(O,a.clone()):i.set(O,a)}))),i},O}(),J={};function ma(a,O){J[a]=O}function M(a){return J[a]}var C=function(){function a(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return a.create=function(O){var i=new a;return i.schema=Object.assign({},O&&O.schema||{}),i.indexes=Object.assign({},O&&O.indexes||{}),i.fieldsByIndex=Object.assign({},O&&O.fieldsByIndex||{}),i.descriptors=Object.assign({},O&&O.descriptors||{}),i.deprecated=Object.assign({},O&&O.deprecated||{}),i},a.prototype.addField=function(a,O){var i=this.getNextFieldIndex();this.fieldsByIndex[i]=a,this.indexes[a]=i,this.schema[a]=Array.isArray(O)?{array:O[0]}:O},a.prototype.hasField=function(a){return void 0!==this.indexes[a]},a.prototype.addFilter=function(a,O){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[a]]=O,this.indexesWithFilters.push(this.indexes[a]),!0},a.prototype.addChildrenFilter=function(a,O){var i=this.indexes[a],H=this.schema[a];if(M(Object.keys(H)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[i]=O,!0;console.warn("@filterChildren: field '".concat(a,"' can't have children. Ignoring filter."))},a.prototype.getChildrenFilter=function(a){return this.childFilters&&this.childFilters[this.indexes[a]]},a.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},a}();function n(a){return a._context&&a._context.useFilters}var D=function(){function a(){this.types={},this.schemas=new Map,this.useFilters=!1}return a.prototype.has=function(a){return this.schemas.has(a)},a.prototype.get=function(a){return this.types[a]},a.prototype.add=function(a,O){void 0===O&&(O=this.schemas.size),a._definition=C.create(a._definition),a._typeid=O,this.types[O]=a,this.schemas.set(a,O)},a.create=function(O){return void 0===O&&(O={}),function(i){return O.context||(O.context=new a),y(i,O)}},a}(),U=new D;function y(a,O){return void 0===O&&(O={}),function(i,H){var G=O.context||U,q=i.constructor;if(q._context=G,!a)throw new Error("".concat(q.name,': @type() reference provided for "').concat(H,"\" is undefined. Make sure you don't have any circular dependencies."));G.has(q)||G.add(q);var Q=q._definition;if(Q.addField(H,a),Q.descriptors[H]){if(Q.deprecated[H])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(H,"' definition on '").concat(q.name,"'.\nCheck @type() annotation"))}catch(J){var k=J.stack.split("\n")[4].trim();throw new Error("".concat(J.message," ").concat(k))}}var I=Z.is(a),P=!I&&r.is(a);if("string"!==typeof a&&!Aa.is(a)){var e=Object.values(a)[0];"string"===typeof e||G.has(e)||G.add(e)}if(O.manual)Q.descriptors[H]={enumerable:!0,configurable:!0,writable:!0};else{var h="_".concat(H);Q.descriptors[h]={enumerable:!1,configurable:!1,writable:!0},Q.descriptors[H]={get:function(){return this[h]},set:function(a){a!==this[h]&&(void 0!==a&&null!==a?(!I||a instanceof Z||(a=new(Z.bind.apply(Z,b([void 0],a,!1)))),!P||a instanceof r||(a=new r(a)),void 0===a.$proxy&&(P?a=F(a):I&&(a=j(a))),this.$changes.change(H),a.$changes&&a.$changes.setParent(this,this.$changes.root,this._definition.indexes[H])):this[h]&&this.$changes.delete(H),this[h]=a)},enumerable:!0,configurable:!0}}}}function w(a){return function(O,i){var H=O.constructor;H._definition.addFilter(i,a)&&(H._context.useFilters=!0)}}function K(a){return function(O,i){var H=O.constructor;H._definition.addChildrenFilter(i,a)&&(H._context.useFilters=!0)}}function S(a){return void 0===a&&(a=!0),function(O,i){var H=O.constructor._definition;H.deprecated[i]=!0,a&&(H.descriptors[i]={get:function(){throw new Error("".concat(i," is deprecated."))},set:function(a){},enumerable:!1,configurable:!0})}}function f(a,O,i){for(var H in void 0===i&&(i={}),i.context||(i.context=a._context||i.context||U),O)y(O[H],i)(a.prototype,H);return a}function B(a){for(var O=0,i=0,H=0,b=a.length;H<b;H++)(O=a.charCodeAt(H))<128?i+=1:O<2048?i+=2:O<55296||O>=57344?i+=3:(H++,i+=4);return i}function T(a,O,i){for(var H=0,b=0,G=i.length;b<G;b++)(H=i.charCodeAt(b))<128?a[O++]=H:H<2048?(a[O++]=192|H>>6,a[O++]=128|63&H):H<55296||H>=57344?(a[O++]=224|H>>12,a[O++]=128|H>>6&63,a[O++]=128|63&H):(b++,H=65536+((1023&H)<<10|1023&i.charCodeAt(b)),a[O++]=240|H>>18,a[O++]=128|H>>12&63,a[O++]=128|H>>6&63,a[O++]=128|63&H)}function A(a,O){a.push(255&O)}function E(a,O){a.push(255&O)}function l(a,O){a.push(255&O),a.push(O>>8&255)}function W(a,O){a.push(255&O),a.push(O>>8&255)}function u(a,O){a.push(255&O),a.push(O>>8&255),a.push(O>>16&255),a.push(O>>24&255)}function c(a,O){var i=O>>24,H=O>>16,b=O>>8,G=O;a.push(255&G),a.push(255&b),a.push(255&H),a.push(255&i)}function R(a,O){var i=Math.floor(O/Math.pow(2,32));c(a,O>>>0),c(a,i)}function z(a,O){var i=O/Math.pow(2,32)|0;c(a,O>>>0),c(a,i)}function x(a,O){p(a,O)}function g(a,O){o(a,O)}var N=new Int32Array(2),v=new Float32Array(N.buffer),X=new Float64Array(N.buffer);function p(a,O){v[0]=O,u(a,N[0])}function o(a,O){X[0]=O,u(a,N[0]),u(a,N[1])}function d(a,O){return E(a,O?1:0)}function Y(a,O){O||(O="");var i=B(O),H=0;if(i<32)a.push(160|i),H=1;else if(i<256)a.push(217),E(a,i),H=2;else if(i<65536)a.push(218),W(a,i),H=3;else{if(!(i<4294967296))throw new Error("String too long");a.push(219),c(a,i),H=5}return T(a,a.length,O),H+i}function L(a,O){return isNaN(O)?L(a,0):isFinite(O)?O!==(0|O)?(a.push(203),o(a,O),9):O>=0?O<128?(E(a,O),1):O<256?(a.push(204),E(a,O),2):O<65536?(a.push(205),W(a,O),3):O<4294967296?(a.push(206),c(a,O),5):(a.push(207),z(a,O),9):O>=-32?(a.push(224|O+32),1):O>=-128?(a.push(208),A(a,O),2):O>=-32768?(a.push(209),l(a,O),3):O>=-2147483648?(a.push(210),u(a,O),5):(a.push(211),R(a,O),9):L(a,O>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var s=Object.freeze({__proto__:null,utf8Write:T,int8:A,uint8:E,int16:l,uint16:W,int32:u,uint32:c,int64:R,uint64:z,float32:x,float64:g,writeFloat32:p,writeFloat64:o,boolean:d,string:Y,number:L});function t(a,O,i){for(var H="",b=0,G=O,q=O+i;G<q;G++){var Q=a[G];0!==(128&Q)?192!==(224&Q)?224!==(240&Q)?240!==(248&Q)?console.error("Invalid byte "+Q.toString(16)):(b=(7&Q)<<18|(63&a[++G])<<12|(63&a[++G])<<6|63&a[++G])>=65536?(b-=65536,H+=String.fromCharCode(55296+(b>>>10),56320+(1023&b))):H+=String.fromCharCode(b):H+=String.fromCharCode((15&Q)<<12|(63&a[++G])<<6|63&a[++G]):H+=String.fromCharCode((31&Q)<<6|63&a[++G]):H+=String.fromCharCode(Q)}return H}function V(a,O){return aa(a,O)<<24>>24}function aa(a,O){return a[O.offset++]}function Oa(a,O){return ia(a,O)<<16>>16}function ia(a,O){return a[O.offset++]|a[O.offset++]<<8}function Ha(a,O){return a[O.offset++]|a[O.offset++]<<8|a[O.offset++]<<16|a[O.offset++]<<24}function ba(a,O){return Ha(a,O)>>>0}function Ga(a,O){return ha(a,O)}function qa(a,O){return ja(a,O)}function Qa(a,O){var i=ba(a,O);return Ha(a,O)*Math.pow(2,32)+i}function ka(a,O){var i=ba(a,O);return ba(a,O)*Math.pow(2,32)+i}var Ia=new Int32Array(2),Pa=new Float32Array(Ia.buffer),ea=new Float64Array(Ia.buffer);function ha(a,O){return Ia[0]=Ha(a,O),Pa[0]}function ja(a,O){return Ia[0]=Ha(a,O),Ia[1]=Ha(a,O),ea[0]}function Za(a,O){return aa(a,O)>0}function Fa(a,O){var i,H=a[O.offset++];H<192?i=31&H:217===H?i=aa(a,O):218===H?i=ia(a,O):219===H&&(i=ba(a,O));var b=t(a,O.offset,i);return O.offset+=i,b}function ra(a,O){var i=a[O.offset];return i<192&&i>160||217===i||218===i||219===i}function Ja(a,O){var i=a[O.offset++];return i<128?i:202===i?ha(a,O):203===i?ja(a,O):204===i?aa(a,O):205===i?ia(a,O):206===i?ba(a,O):207===i?ka(a,O):208===i?V(a,O):209===i?Oa(a,O):210===i?Ha(a,O):211===i?Qa(a,O):i>223?-1*(255-i+1):void 0}function mO(a,O){var i=a[O.offset];return i<128||i>=202&&i<=211}function Ma(a,O){return a[O.offset]<160}function Ca(a,O){return a[O.offset-1]===q&&(a[O.offset]<128||a[O.offset]>=202&&a[O.offset]<=211)}var na=Object.freeze({__proto__:null,int8:V,uint8:aa,int16:Oa,uint16:ia,int32:Ha,uint32:ba,float32:Ga,float64:qa,int64:Qa,uint64:ka,readFloat32:ha,readFloat64:ja,boolean:Za,string:Fa,stringCheck:ra,number:Ja,numberCheck:mO,arrayCheck:Ma,switchStructureCheck:Ca}),Da=function(){function O(a){var O=this;this.$changes=new k(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,a&&a.forEach((function(a){return O.add(a)}))}return O.prototype.XQ=function(O,i){return void 0===i&&(i=!0),I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.ADD,O,i?this.$items:void 0)},O.prototype.mb=function(O){return I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,O)},O.is=function(a){return void 0!==a.collection},O.prototype.add=function(a){var O=this.$refId++;return void 0!==a.$changes&&a.$changes.setParent(this,this.$changes.root,O),this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,a),this.$changes.change(O),O},O.prototype.at=function(a){var O=Array.from(this.$items.keys())[a];return this.$items.get(O)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(a){for(var O,i,H=this.$items.entries();(i=H.next())&&!i.done;)if(a===i.value[1]){O=i.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&P.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:a.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(a){return Array.from(this.$items.values()).some((function(O){return O===a}))},O.prototype.forEach=function(a){var O=this;this.$items.forEach((function(i,H,b){return a(i,H,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(a,O){this.$indexes.set(a,O)},O.prototype.getIndex=function(a){return this.$indexes.get(a)},O.prototype.getByIndex=function(a){return this.$items.get(this.$indexes.get(a))},O.prototype.deleteByIndex=function(a){var O=this.$indexes.get(a);this.$items.delete(O),this.$indexes.delete(a)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var a=[];return this.forEach((function(O,i){a.push("function"===typeof O.toJSON?O.toJSON():O)})),a},O.prototype.clone=function(a){var i;return a?i=Object.assign(new O,this):(i=new O,this.forEach((function(a){a.$changes?i.add(a.clone()):i.add(a)}))),i},O}(),Ua=function(){function O(a){var O=this;this.$changes=new k(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,a&&a.forEach((function(a){return O.add(a)}))}return O.prototype.XQ=function(O,i){return void 0===i&&(i=!0),I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.ADD,O,i?this.$items:void 0)},O.prototype.mb=function(O){return I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,O)},O.is=function(a){return void 0!==a.set},O.prototype.add=function(O){var i,H;if(this.has(O))return!1;var b=this.$refId++;void 0!==O.$changes&&O.$changes.setParent(this,this.$changes.root,b);var G=null!==(H=null===(i=this.$changes.indexes[b])||void 0===i?void 0:i.op)&&void 0!==H?H:a.OPERATION.ADD;return this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,O),this.$changes.change(b,G),b},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(a){for(var O,i,H=this.$items.entries();(i=H.next())&&!i.done;)if(a===i.value[1]){O=i.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&P.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:a.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(a){for(var O,i=this.$items.values(),H=!1;(O=i.next())&&!O.done;)if(a===O.value){H=!0;break}return H},O.prototype.forEach=function(a){var O=this;this.$items.forEach((function(i,H,b){return a(i,H,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(a,O){this.$indexes.set(a,O)},O.prototype.getIndex=function(a){return this.$indexes.get(a)},O.prototype.getByIndex=function(a){return this.$items.get(this.$indexes.get(a))},O.prototype.deleteByIndex=function(a){var O=this.$indexes.get(a);this.$items.delete(O),this.$indexes.delete(a)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var a=[];return this.forEach((function(O,i){a.push("function"===typeof O.toJSON?O.toJSON():O)})),a},O.prototype.clone=function(a){var i;return a?i=Object.assign(new O,this):(i=new O,this.forEach((function(a){a.$changes?i.add(a.clone()):i.add(a)}))),i},O}(),ya=function(){function a(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return a.prototype.addRefId=function(a){this.refIds.has(a)||(this.refIds.add(a),this.containerIndexes.set(a,new Set))},a.get=function(O){return void 0===O.$filterState&&(O.$filterState=new a),O.$filterState},a}(),wa=function(){function a(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return a.prototype.getNextUniqueId=function(){return this.nextUniqueId++},a.prototype.addRef=function(a,O,i){void 0===i&&(i=!0),this.refs.set(a,O),i&&(this.refCounts[a]=(this.refCounts[a]||0)+1)},a.prototype.removeRef=function(a){this.refCounts[a]=this.refCounts[a]-1,this.deletedRefs.add(a)},a.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},a.prototype.garbageCollectDeletedRefs=function(){var a=this;this.deletedRefs.forEach((function(O){if(!(a.refCounts[O]>0)){var i=a.refs.get(O);if(i instanceof Aa)for(var H in i._definition.schema)"string"!==typeof i._definition.schema[H]&&i[H]&&i[H].$changes&&a.removeRef(i[H].$changes.refId);else{var b=i.$changes.parent._definition,G=b.schema[b.fieldsByIndex[i.$changes.parentIndex]];"function"===typeof Object.values(G)[0]&&Array.from(i.values()).forEach((function(O){return a.removeRef(O.$changes.refId)}))}a.refs.delete(O),delete a.refCounts[O]}})),this.deletedRefs.clear()},a}(),Ka=function(a){function O(){return null!==a&&a.apply(this,arguments)||this}return i(O,a),O}(Error);function Sa(a,O,i,H){var b,G=!1;switch(O){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":b="number",isNaN(a)&&console.log('trying to encode "NaN" in '.concat(i.constructor.name,"#").concat(H));break;case"string":b="string",G=!0;break;case"boolean":return}if(typeof a!==b&&(!G||G&&null!==a)){var q="'".concat(JSON.stringify(a),"'").concat(a&&a.constructor&&" (".concat(a.constructor.name,")")||"");throw new Ka("a '".concat(b,"' was expected, but ").concat(q," was provided in ").concat(i.constructor.name,"#").concat(H))}}function fa(a,O,i,H){if(!(a instanceof O))throw new Ka("a '".concat(O.name,"' was expected, but '").concat(a.constructor.name,"' was provided in ").concat(i.constructor.name,"#").concat(H))}function Ba(a,O,i,H,b){Sa(i,a,H,b);var G=s[a];if(!G)throw new Ka("a '".concat(a,"' was expected, but ").concat(i," was provided in ").concat(H.constructor.name,"#").concat(b));G(O,i)}function Ta(a,O,i){return na[a](O,i)}var Aa=function(){function O(){for(var a=[],O=0;O<arguments.length;O++)a[O]=arguments[O];Object.defineProperties(this,{$changes:{value:new k(this,void 0,new wa),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var i=this._definition.descriptors;i&&Object.defineProperties(this,i),a[0]&&this.assign(a[0])}return O.onError=function(a){console.error(a)},O.is=function(a){return a._definition&&void 0!==a._definition.schema},O.prototype.onChange=function(O){return I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.REPLACE,O)},O.prototype.mb=function(O){return I(this.$callbacks||(this.$callbacks=[]),a.OPERATION.DELETE,O)},O.prototype.assign=function(a){return Object.assign(this,a),this},Object.defineProperty(O.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),O.prototype.setDirty=function(a,O){this.$changes.change(a,O)},O.prototype.listen=function(a,O,i){var H=this;return void 0===i&&(i=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[a]||(this.$callbacks[a]=[]),this.$callbacks[a].push(O),i&&void 0!==this[a]&&O(this[a],void 0),function(){return e(H.$callbacks[a],H.$callbacks[a].indexOf(O))}},O.prototype.decode=function(i,H,b){var G;void 0===H&&(H={offset:0}),void 0===b&&(b=this);var Q=[],k=this.$changes.root,I=i.length,P=0;for(k.refs.set(P,this);H.offset<I;){var e=i[H.offset++];if(e!=q){var h=b.$changes,j=void 0!==b._definition,F=j?e>>6<<6:e;if(F!==a.OPERATION.CLEAR){var J=j?e%(F||255):Ja(i,H),ma=j?b._definition.fieldsByIndex[J]:"",C=h.getType(J),n=void 0,D=void 0,U=void 0;if(j?D=b["_".concat(ma)]:(D=b.getByIndex(J),(F&a.OPERATION.ADD)===a.OPERATION.ADD?(U=b instanceof r?Fa(i,H):J,b.setIndex(J,U)):U=b.getIndex(J)),(F&a.OPERATION.DELETE)===a.OPERATION.DELETE&&(F!==a.OPERATION.DELETE_AND_ADD&&b.deleteByIndex(J),D&&D.$changes&&k.removeRef(D.$changes.refId),n=null),void 0!==ma){if(F===a.OPERATION.DELETE);else if(O.is(C)){var y=Ja(i,H);if(n=k.refs.get(y),F!==a.OPERATION.REPLACE){var w=this.getSchemaType(i,H,C);n||((n=this.createTypeInstance(w)).$changes.refId=y,D&&(n.$callbacks=D.$callbacks,D.$changes.refId&&y!==D.$changes.refId&&k.removeRef(D.$changes.refId))),k.addRef(y,n,n!==D)}}else if("string"===typeof C)n=Ta(C,i,H);else{var K=M(Object.keys(C)[0]),S=Ja(i,H),f=k.refs.has(S)?D||k.refs.get(S):new K.constructor;if((n=f.clone(!0)).$changes.refId=S,D&&(n.$callbacks=D.$callbacks,D.$changes.refId&&S!==D.$changes.refId)){k.removeRef(D.$changes.refId);for(var B=D.entries(),T=void 0;(T=B.next())&&!T.done;){var A=(G=T.value)[0],E=G[1];Q.push({refId:S,op:a.OPERATION.DELETE,field:A,value:void 0,previousValue:E})}}k.addRef(S,n,f!==D)}if(null!==n&&void 0!==n)if(n.$changes&&n.$changes.setParent(h.ref,h.root,J),b instanceof O)b[ma]=n;else if(b instanceof r)A=U,b.$items.set(A,n),b.$changes.allChanges.add(J);else if(b instanceof Z)b.setAt(J,n);else if(b instanceof Da){var l=b.add(n);b.setIndex(J,l)}else b instanceof Ua&&!1!==(l=b.add(n))&&b.setIndex(J,l);D!==n&&Q.push({refId:P,op:F,field:ma,dynamicIndex:U,value:n,previousValue:D})}else{console.warn("@colyseus/schema: definition mismatch");for(var W={offset:H.offset};H.offset<I&&(!Ca(i,H)||(W.offset=H.offset+1,!k.refs.has(Ja(i,W))));)H.offset++}}else b.clear(Q)}else{P=Ja(i,H);var u=k.refs.get(P);if(!u)throw new Error('"refId" not found: '.concat(P));b=u}}return this._triggerChanges(Q),k.garbageCollectDeletedRefs(),Q},O.prototype.encode=function(i,H,b){void 0===i&&(i=!1),void 0===H&&(H=[]),void 0===b&&(b=!1);for(var G=this.$changes,Q=new WeakSet,k=[G],I=1,P=0;P<I;P++){var e=k[P],h=e.ref,j=h instanceof O;e.ensureRefId(),Q.add(e),e!==G&&(e.changed||i)&&(E(H,q),L(H,e.refId));for(var Z=i?Array.from(e.allChanges):Array.from(e.changes.values()),F=0,J=Z.length;F<J;F++){var ma=i?{op:a.OPERATION.ADD,index:Z[F]}:Z[F],C=ma.index,n=j?h._definition.fieldsByIndex&&h._definition.fieldsByIndex[C]:C,D=H.length;if(ma.op!==a.OPERATION.TOUCH)if(j)E(H,C|ma.op);else{if(E(H,ma.op),ma.op===a.OPERATION.CLEAR)continue;L(H,C)}if(j||(ma.op&a.OPERATION.ADD)!=a.OPERATION.ADD||h instanceof r&&Y(H,e.ref.$indexes.get(C)),ma.op!==a.OPERATION.DELETE){var U=e.getType(C),y=e.getValue(C);if(y&&y.$changes&&!Q.has(y.$changes)&&(k.push(y.$changes),y.$changes.ensureRefId(),I++),ma.op!==a.OPERATION.TOUCH){if(O.is(U))fa(y,U,h,n),L(H,y.$changes.refId),(ma.op&a.OPERATION.ADD)===a.OPERATION.ADD&&this.tryEncodeTypeId(H,U,y.constructor);else if("string"===typeof U)Ba(U,H,y,h,n);else{var w=M(Object.keys(U)[0]);fa(h["_".concat(n)],w.constructor,h,n),L(H,y.$changes.refId)}b&&e.cache(C,H.slice(D))}}}i||b||e.discard()}return H},O.prototype.encodeAll=function(a){return this.encode(!0,[],a)},O.prototype.applyFilters=function(i,H){var b,G;void 0===H&&(H=!1);for(var Q=this,k=new Set,I=ya.get(i),P=[this.$changes],e=1,h=[],j=function(j){var Z=P[j];if(k.has(Z.refId))return"continue";var F=Z.ref,J=F instanceof O;E(h,q),L(h,Z.refId);var ma=I.refIds.has(Z),M=H||!ma;I.addRefId(Z);var C=I.containerIndexes.get(Z),n=M?Array.from(Z.allChanges):Array.from(Z.changes.values());!H&&J&&F._definition.indexesWithFilters&&F._definition.indexesWithFilters.forEach((function(O){!C.has(O)&&Z.allChanges.has(O)&&(M?n.push(O):n.push({op:a.OPERATION.ADD,index:O}))}));for(var D=0,U=n.length;D<U;D++){var y=M?{op:a.OPERATION.ADD,index:n[D]}:n[D];if(y.op!==a.OPERATION.CLEAR){var w=y.index;if(y.op!==a.OPERATION.DELETE){var K=Z.getValue(w),S=Z.getType(w);if(J){if((f=F._definition.filters&&F._definition.filters[w])&&!f.call(F,i,K,Q)){K&&K.$changes&&k.add(K.$changes.refId);continue}}else{var f,B=Z.parent;if((f=Z.getChildrenFilter())&&!f.call(B,i,F.$indexes.get(w),K,Q)){K&&K.$changes&&k.add(K.$changes.refId);continue}}if(K.$changes&&(P.push(K.$changes),e++),y.op!==a.OPERATION.TOUCH)if(y.op===a.OPERATION.ADD||J)h.push.apply(h,null!==(b=Z.caches[w])&&void 0!==b?b:[]),C.add(w);else if(C.has(w))h.push.apply(h,null!==(G=Z.caches[w])&&void 0!==G?G:[]);else{if(C.add(w),E(h,a.OPERATION.ADD),L(h,w),F instanceof r){var T=Z.ref.$indexes.get(w);Y(h,T)}K.$changes?L(h,K.$changes.refId):s[S](h,K)}else K.$changes&&!J&&(E(h,a.OPERATION.ADD),L(h,w),F instanceof r&&(T=Z.ref.$indexes.get(w),Y(h,T)),L(h,K.$changes.refId))}else J?E(h,y.op|w):(E(h,y.op),L(h,w))}else E(h,y.op)}},Z=0;Z<e;Z++)j(Z);return h},O.prototype.clone=function(){var a,O=new this.constructor,i=this._definition.schema;for(var H in i)"object"===typeof this[H]&&"function"===typeof(null===(a=this[H])||void 0===a?void 0:a.clone)?O[H]=this[H].clone():O[H]=this[H];return O},O.prototype.toJSON=function(){var a=this._definition.schema,O=this._definition.deprecated,i={};for(var H in a)O[H]||null===this[H]||"undefined"===typeof this[H]||(i[H]="function"===typeof this[H].toJSON?this[H].toJSON():this["_".concat(H)]);return i},O.prototype.discardAllChanges=function(){this.$changes.discardAll()},O.prototype.getByIndex=function(a){return this[this._definition.fieldsByIndex[a]]},O.prototype.deleteByIndex=function(a){this[this._definition.fieldsByIndex[a]]=void 0},O.prototype.tryEncodeTypeId=function(a,O,i){O._typeid!==i._typeid&&(E(a,Q),L(a,i._typeid))},O.prototype.getSchemaType=function(a,O,i){var H;return a[O.offset]===Q&&(O.offset++,H=this.constructor._context.get(Ja(a,O))),H||i},O.prototype.createTypeInstance=function(a){var O=new a;return O.$changes.root=this.$changes.root,O},O.prototype._triggerChanges=function(i){for(var H,b,G,q,Q,k,I,P,e,h=new Set,j=this.$changes.root.refs,Z=function(Z){var F=i[Z],r=F.refId,J=j.get(r),ma=J.$callbacks;if((F.op&a.OPERATION.DELETE)===a.OPERATION.DELETE&&F.previousValue instanceof O&&(null===(b=null===(H=F.previousValue.$callbacks)||void 0===H?void 0:H[a.OPERATION.DELETE])||void 0===b||b.forEach((function(a){return a()}))),!ma)return"continue";if(J instanceof O){if(!h.has(r))try{null===(G=null===ma||void 0===ma?void 0:ma[a.OPERATION.REPLACE])||void 0===G||G.forEach((function(a){return a()}))}catch(M){O.onError(M)}try{ma.hasOwnProperty(F.field)&&(null===(q=ma[F.field])||void 0===q||q.forEach((function(a){return a(F.value,F.previousValue)})))}catch(M){O.onError(M)}}else F.op===a.OPERATION.ADD&&void 0===F.previousValue?null===(Q=ma[a.OPERATION.ADD])||void 0===Q||Q.forEach((function(a){var O;return a(F.value,null!==(O=F.dynamicIndex)&&void 0!==O?O:F.field)})):F.op===a.OPERATION.DELETE?void 0!==F.previousValue&&(null===(k=ma[a.OPERATION.DELETE])||void 0===k||k.forEach((function(a){var O;return a(F.previousValue,null!==(O=F.dynamicIndex)&&void 0!==O?O:F.field)}))):F.op===a.OPERATION.DELETE_AND_ADD&&(void 0!==F.previousValue&&(null===(I=ma[a.OPERATION.DELETE])||void 0===I||I.forEach((function(a){var O;return a(F.previousValue,null!==(O=F.dynamicIndex)&&void 0!==O?O:F.field)}))),null===(P=ma[a.OPERATION.ADD])||void 0===P||P.forEach((function(a){var O;return a(F.value,null!==(O=F.dynamicIndex)&&void 0!==O?O:F.field)}))),F.value!==F.previousValue&&(null===(e=ma[a.OPERATION.REPLACE])||void 0===e||e.forEach((function(a){var O;return a(F.value,null!==(O=F.dynamicIndex)&&void 0!==O?O:F.field)})));h.add(r)},F=0;F<i.length;F++)Z(F)},O._definition=C.create(),O}();function Ea(a){for(var O=[a.$changes],i=1,H={},b=H,G=function(a){var i=O[a];i.changes.forEach((function(a){var O=i.ref,H=a.index,G=O._definition?O._definition.fieldsByIndex[H]:O.$indexes.get(H);b[G]=i.getValue(H)}))},q=0;q<i;q++)G(q);return H}var la={context:new D},Wa=function(a){function O(){return null!==a&&a.apply(this,arguments)||this}return i(O,a),H([y("string",la)],O.prototype,"name",void 0),H([y("string",la)],O.prototype,"type",void 0),H([y("number",la)],O.prototype,"referencedType",void 0),O}(Aa),ua=function(a){function O(){var O=null!==a&&a.apply(this,arguments)||this;return O.fields=new Z,O}return i(O,a),H([y("number",la)],O.prototype,"id",void 0),H([y([Wa],la)],O.prototype,"fields",void 0),O}(Aa),ca=function(a){function O(){var O=null!==a&&a.apply(this,arguments)||this;return O.types=new Z,O}return i(O,a),O.encode=function(a){var i=a.constructor,H=new O;H.rootType=i._typeid;var b=function(a,O){for(var i in O){var b=new Wa;b.name=i;var G=void 0;if("string"===typeof O[i])G=O[i];else{var q=O[i],Q=void 0;Aa.is(q)?(G="ref",Q=O[i]):"string"===typeof q[G=Object.keys(q)[0]]?G+=":"+q[G]:Q=q[G],b.referencedType=Q?Q._typeid:-1}b.type=G,a.fields.push(b)}H.types.push(a)},G=i._context.types;for(var q in G){var Q=new ua;Q.id=Number(q),b(Q,G[q]._definition.schema)}return H.encodeAll()},O.decode=function(a,H){var b=new D,G=new O;G.decode(a,H);var q=G.types.reduce((function(a,O){var H=function(a){function O(){return null!==a&&a.apply(this,arguments)||this}return i(O,a),O}(Aa),G=O.id;return a[G]=H,b.add(H,G),a}),{});G.types.forEach((function(a){var O=q[a.id];a.fields.forEach((function(a){var i;if(void 0!==a.referencedType){var H=a.type,G=q[a.referencedType];if(!G){var Q=a.type.split(":");H=Q[0],G=Q[1]}"ref"===H?y(G,{context:b})(O.prototype,a.name):y(((i={})[H]=G,i),{context:b})(O.prototype,a.name)}else y(a.type,{context:b})(O.prototype,a.name)}))}));var Q=q[G.rootType],k=new Q;for(var I in Q._definition.schema){var P=Q._definition.schema[I];"string"!==typeof P&&(k[I]="function"===typeof P?new P:new(M(Object.keys(P)[0]).constructor))}return k},H([y([ua],la)],O.prototype,"types",void 0),H([y("number",la)],O.prototype,"rootType",void 0),O}(Aa);ma("map",{constructor:r}),ma("array",{constructor:Z}),ma("set",{constructor:Ua}),ma("collection",{constructor:Da}),a.ArraySchema=Z,a.CollectionSchema=Da,a.Context=D,a.MapSchema=r,a.Reflection=ca,a.ReflectionField=Wa,a.ReflectionType=ua,a.Schema=Aa,a.SchemaDefinition=C,a.SetSchema=Ua,a.decode=na,a.defineTypes=f,a.deprecated=S,a.dumpChanges=Ea,a.encode=s,a.filter=w,a.filterChildren=K,a.hasFilter=n,a.registerType=ma,a.type=y,Object.defineProperty(a,"__esModule",{value:!0})}(O)},14532:a=>{"use strict";a.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14526:(a,O,i)=>{var H=i(14532),b=i(14540),G=Object.hasOwnProperty,q=Object.create(null);for(var Q in H)G.call(H,Q)&&(q[H[Q]]=Q);var k=a.exports={to:{},get:{}};function I(a,O,i){return Math.min(Math.max(O,a),i)}function P(a){var O=Math.round(a).toString(16).toUpperCase();return O.length<2?"0"+O:O}k.get=function(a){var O,i;switch(a.substring(0,3).toLowerCase()){case"hsl":O=k.get.hsl(a),i="hsl";break;case"hwb":O=k.get.hwb(a),i="hwb";break;default:O=k.get.rgb(a),i="rgb"}return O?{model:i,value:O}:null},k.get.rgb=function(a){if(!a)return null;var O,i,b,q=[0,0,0,1];if(O=a.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(b=O[2],O=O[1],i=0;i<3;i++){var Q=2*i;q[i]=parseInt(O.slice(Q,Q+2),16)}b&&(q[3]=parseInt(b,16)/255)}else if(O=a.match(/^#([a-f0-9]{3,4})$/i)){for(b=(O=O[1])[3],i=0;i<3;i++)q[i]=parseInt(O[i]+O[i],16);b&&(q[3]=parseInt(b+b,16)/255)}else if(O=a.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(i=0;i<3;i++)q[i]=parseInt(O[i+1],0);O[4]&&(O[5]?q[3]=.01*parseFloat(O[4]):q[3]=parseFloat(O[4]))}else{if(!(O=a.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(O=a.match(/^(\w+)$/))?"transparent"===O[1]?[0,0,0,0]:G.call(H,O[1])?((q=H[O[1]])[3]=1,q):null:null;for(i=0;i<3;i++)q[i]=Math.round(2.55*parseFloat(O[i+1]));O[4]&&(O[5]?q[3]=.01*parseFloat(O[4]):q[3]=parseFloat(O[4]))}for(i=0;i<3;i++)q[i]=I(q[i],0,255);return q[3]=I(q[3],0,1),q},k.get.hsl=function(a){if(!a)return null;var O=a.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var i=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,I(parseFloat(O[2]),0,100),I(parseFloat(O[3]),0,100),I(isNaN(i)?1:i,0,1)]}return null},k.get.hwb=function(a){if(!a)return null;var O=a.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var i=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,I(parseFloat(O[2]),0,100),I(parseFloat(O[3]),0,100),I(isNaN(i)?1:i,0,1)]}return null},k.to.hex=function(){var a=b(arguments);return"#"+P(a[0])+P(a[1])+P(a[2])+(a[3]<1?P(Math.round(255*a[3])):"")},k.to.rgb=function(){var a=b(arguments);return a.length<4||1===a[3]?"rgb("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+")":"rgba("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+", "+a[3]+")"},k.to.rgb.percent=function(){var a=b(arguments),O=Math.round(a[0]/255*100),i=Math.round(a[1]/255*100),H=Math.round(a[2]/255*100);return a.length<4||1===a[3]?"rgb("+O+"%, "+i+"%, "+H+"%)":"rgba("+O+"%, "+i+"%, "+H+"%, "+a[3]+")"},k.to.hsl=function(){var a=b(arguments);return a.length<4||1===a[3]?"hsl("+a[0]+", "+a[1]+"%, "+a[2]+"%)":"hsla("+a[0]+", "+a[1]+"%, "+a[2]+"%, "+a[3]+")"},k.to.hwb=function(){var a=b(arguments),O="";return a.length>=4&&1!==a[3]&&(O=", "+a[3]),"hwb("+a[0]+", "+a[1]+"%, "+a[2]+"%"+O+")"},k.to.keyword=function(a){return q[a.slice(0,3)]}},14518:(a,O,i)=>{const H=i(14526),b=i(14549),G=["keyword","gray","hex"],q={};for(const j of Object.keys(b))q[[...b[j].labels].sort().join("")]=j;const Q={};function k(a,O){if(!(this instanceof k))return new k(a,O);if(O&&O in G&&(O=null),O&&!(O in b))throw new Error("Unknown model: "+O);let i,I;if(null==a)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(a instanceof k)this.model=a.model,this.color=[...a.color],this.valpha=a.valpha;else if("string"===typeof a){const O=H.get(a);if(null===O)throw new Error("Unable to parse color from string: "+a);this.model=O.model,I=b[this.model].channels,this.color=O.value.slice(0,I),this.valpha="number"===typeof O.value[I]?O.value[I]:1}else if(a.length>0){this.model=O||"rgb",I=b[this.model].channels;const i=Array.prototype.slice.call(a,0,I);this.color=h(i,I),this.valpha="number"===typeof a[I]?a[I]:1}else if("number"===typeof a)this.model="rgb",this.color=[a>>16&255,a>>8&255,255&a],this.valpha=1;else{this.valpha=1;const O=Object.keys(a);"alpha"in a&&(O.splice(O.indexOf("alpha"),1),this.valpha="number"===typeof a.alpha?a.alpha:0);const H=O.sort().join("");if(!(H in q))throw new Error("Unable to parse color from object: "+JSON.stringify(a));this.model=q[H];const{labels:G}=b[this.model],Q=[];for(i=0;i<G.length;i++)Q.push(a[G[i]]);this.color=h(Q)}if(Q[this.model])for(I=b[this.model].channels,i=0;i<I;i++){const a=Q[this.model][i];a&&(this.color[i]=a(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}k.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(a){let O=this.model in H.to?this:this.rgb();O=O.round("number"===typeof a?a:1);const i=1===O.valpha?O.color:[...O.color,this.valpha];return H.to[O.model](i)},percentString(a){const O=this.rgb().round("number"===typeof a?a:1),i=1===O.valpha?O.color:[...O.color,this.valpha];return H.to.rgb.percent(i)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const a={},{channels:O}=b[this.model],{labels:i}=b[this.model];for(let H=0;H<O;H++)a[i[H]]=this.color[H];return 1!==this.valpha&&(a.alpha=this.valpha),a},unitArray(){const a=this.rgb().color;return a[0]/=255,a[1]/=255,a[2]/=255,1!==this.valpha&&a.push(this.valpha),a},unitObject(){const a=this.rgb().object();return a.r/=255,a.g/=255,a.b/=255,1!==this.valpha&&(a.alpha=this.valpha),a},round(a){return a=Math.max(a||0,0),new k([...this.color.map(I(a)),this.valpha],this.model)},alpha(a){return void 0!==a?new k([...this.color,Math.max(0,Math.min(1,a))],this.model):this.valpha},red:P("rgb",0,e(255)),green:P("rgb",1,e(255)),blue:P("rgb",2,e(255)),hue:P(["hsl","hsv","hsl","hwb","hcg"],0,(a=>(a%360+360)%360)),saturationl:P("hsl",1,e(100)),lightness:P("hsl",2,e(100)),saturationv:P("hsv",1,e(100)),value:P("hsv",2,e(100)),chroma:P("hcg",1,e(100)),gray:P("hcg",2,e(100)),white:P("hwb",1,e(100)),wblack:P("hwb",2,e(100)),cyan:P("cmyk",0,e(100)),magenta:P("cmyk",1,e(100)),yellow:P("cmyk",2,e(100)),black:P("cmyk",3,e(100)),x:P("xyz",0,e(95.047)),y:P("xyz",1,e(100)),z:P("xyz",2,e(108.833)),l:P("lab",0,e(100)),a:P("lab",1),b:P("lab",2),keyword(a){return void 0!==a?new k(a):b[this.model].keyword(this.color)},hex(a){return void 0!==a?new k(a):H.to.hex(this.rgb().round().color)},hexa(a){if(void 0!==a)return new k(a);const O=this.rgb().round().color;let i=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===i.length&&(i="0"+i),H.to.hex(O)+i},rgbNumber(){const a=this.rgb().color;return(255&a[0])<<16|(255&a[1])<<8|255&a[2]},luminosity(){const a=this.rgb().color,O=[];for(const[i,H]of a.entries()){const a=H/255;O[i]=a<=.04045?a/12.92:((a+.055)/1.055)**2.4}return.2126*O[0]+.7152*O[1]+.0722*O[2]},contrast(a){const O=this.luminosity(),i=a.luminosity();return O>i?(O+.05)/(i+.05):(i+.05)/(O+.05)},level(a){const O=this.contrast(a);return O>=7?"AAA":O>=4.5?"AA":""},isDark(){const a=this.rgb().color;return(2126*a[0]+7152*a[1]+722*a[2])/1e4<128},isLight(){return!this.isDark()},negate(){const a=this.rgb();for(let O=0;O<3;O++)a.color[O]=255-a.color[O];return a},lighten(a){const O=this.hsl();return O.color[2]+=O.color[2]*a,O},darken(a){const O=this.hsl();return O.color[2]-=O.color[2]*a,O},saturate(a){const O=this.hsl();return O.color[1]+=O.color[1]*a,O},desaturate(a){const O=this.hsl();return O.color[1]-=O.color[1]*a,O},whiten(a){const O=this.hwb();return O.color[1]+=O.color[1]*a,O},blacken(a){const O=this.hwb();return O.color[2]+=O.color[2]*a,O},grayscale(){const a=this.rgb().color,O=.3*a[0]+.59*a[1]+.11*a[2];return k.rgb(O,O,O)},fade(a){return this.alpha(this.valpha-this.valpha*a)},opaquer(a){return this.alpha(this.valpha+this.valpha*a)},rotate(a){const O=this.hsl();let i=O.color[0];return i=(i+a)%360,i=i<0?360+i:i,O.color[0]=i,O},mix(a,O){if(!a||!a.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof a);const i=a.rgb(),H=this.rgb(),b=void 0===O?.5:O,G=2*b-1,q=i.alpha()-H.alpha(),Q=((G*q===-1?G:(G+q)/(1+G*q))+1)/2,I=1-Q;return k.rgb(Q*i.red()+I*H.red(),Q*i.green()+I*H.green(),Q*i.blue()+I*H.blue(),i.alpha()*b+H.alpha()*(1-b))}};for(const j of Object.keys(b)){if(G.includes(j))continue;const{channels:a}=b[j];k.prototype[j]=function(){if(this.model===j)return new k(this);for(var a=arguments.length,O=new Array(a),i=0;i<a;i++)O[i]=arguments[i];return O.length>0?new k(O,j):new k([...(H=b[this.model][j].raw(this.color),Array.isArray(H)?H:[H]),this.valpha],j);var H},k[j]=function(){for(var O=arguments.length,i=new Array(O),H=0;H<O;H++)i[H]=arguments[H];let b=i[0];return"number"===typeof b&&(b=h(i,a)),new k(b,j)}}function I(a){return function(O){return function(a,O){return Number(a.toFixed(O))}(O,a)}}function P(a,O,i){a=Array.isArray(a)?a:[a];for(const H of a)(Q[H]||(Q[H]=[]))[O]=i;return a=a[0],function(H){let b;return void 0!==H?(i&&(H=i(H)),b=this[a](),b.color[O]=H,b):(b=this[a]().color[O],i&&(b=i(b)),b)}}function e(a){return function(O){return Math.max(0,Math.min(a,O))}}function h(a,O){for(let i=0;i<O;i++)"number"!==typeof a[i]&&(a[i]=0);return a}a.exports=k},14554:(a,O,i)=>{const H=i(14556),b={};for(const q of Object.keys(H))b[H[q]]=q;const G={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};a.exports=G;for(const q of Object.keys(G)){if(!("channels"in G[q]))throw new Error("missing channels property: "+q);if(!("labels"in G[q]))throw new Error("missing channel labels property: "+q);if(G[q].labels.length!==G[q].channels)throw new Error("channel and label counts mismatch: "+q);const{channels:a,labels:O}=G[q];delete G[q].channels,delete G[q].labels,Object.defineProperty(G[q],"channels",{value:a}),Object.defineProperty(G[q],"labels",{value:O})}G.rgb.hsl=function(a){const O=a[0]/255,i=a[1]/255,H=a[2]/255,b=Math.min(O,i,H),G=Math.max(O,i,H),q=G-b;let Q,k;G===b?Q=0:O===G?Q=(i-H)/q:i===G?Q=2+(H-O)/q:H===G&&(Q=4+(O-i)/q),Q=Math.min(60*Q,360),Q<0&&(Q+=360);const I=(b+G)/2;return k=G===b?0:I<=.5?q/(G+b):q/(2-G-b),[Q,100*k,100*I]},G.rgb.hsv=function(a){let O,i,H,b,G;const q=a[0]/255,Q=a[1]/255,k=a[2]/255,I=Math.max(q,Q,k),P=I-Math.min(q,Q,k),e=function(a){return(I-a)/6/P+.5};return 0===P?(b=0,G=0):(G=P/I,O=e(q),i=e(Q),H=e(k),q===I?b=H-i:Q===I?b=1/3+O-H:k===I&&(b=2/3+i-O),b<0?b+=1:b>1&&(b-=1)),[360*b,100*G,100*I]},G.rgb.hwb=function(a){const O=a[0],i=a[1];let H=a[2];const b=G.rgb.hsl(a)[0],q=1/255*Math.min(O,Math.min(i,H));return H=1-1/255*Math.max(O,Math.max(i,H)),[b,100*q,100*H]},G.rgb.cmyk=function(a){const O=a[0]/255,i=a[1]/255,H=a[2]/255,b=Math.min(1-O,1-i,1-H);return[100*((1-O-b)/(1-b)||0),100*((1-i-b)/(1-b)||0),100*((1-H-b)/(1-b)||0),100*b]},G.rgb.keyword=function(a){const O=b[a];if(O)return O;let i,G=1/0;for(const b of Object.keys(H)){const O=H[b],k=(Q=O,((q=a)[0]-Q[0])**2+(q[1]-Q[1])**2+(q[2]-Q[2])**2);k<G&&(G=k,i=b)}var q,Q;return i},G.keyword.rgb=function(a){return H[a]},G.rgb.xyz=function(a){let O=a[0]/255,i=a[1]/255,H=a[2]/255;O=O>.04045?((O+.055)/1.055)**2.4:O/12.92,i=i>.04045?((i+.055)/1.055)**2.4:i/12.92,H=H>.04045?((H+.055)/1.055)**2.4:H/12.92;return[100*(.4124*O+.3576*i+.1805*H),100*(.2126*O+.7152*i+.0722*H),100*(.0193*O+.1192*i+.9505*H)]},G.rgb.lab=function(a){const O=G.rgb.xyz(a);let i=O[0],H=O[1],b=O[2];i/=95.047,H/=100,b/=108.883,i=i>.008856?i**(1/3):7.787*i+16/116,H=H>.008856?H**(1/3):7.787*H+16/116,b=b>.008856?b**(1/3):7.787*b+16/116;return[116*H-16,500*(i-H),200*(H-b)]},G.hsl.rgb=function(a){const O=a[0]/360,i=a[1]/100,H=a[2]/100;let b,G,q;if(0===i)return q=255*H,[q,q,q];b=H<.5?H*(1+i):H+i-H*i;const Q=2*H-b,k=[0,0,0];for(let I=0;I<3;I++)G=O+1/3*-(I-1),G<0&&G++,G>1&&G--,q=6*G<1?Q+6*(b-Q)*G:2*G<1?b:3*G<2?Q+(b-Q)*(2/3-G)*6:Q,k[I]=255*q;return k},G.hsl.hsv=function(a){const O=a[0];let i=a[1]/100,H=a[2]/100,b=i;const G=Math.max(H,.01);H*=2,i*=H<=1?H:2-H,b*=G<=1?G:2-G;return[O,100*(0===H?2*b/(G+b):2*i/(H+i)),100*((H+i)/2)]},G.hsv.rgb=function(a){const O=a[0]/60,i=a[1]/100;let H=a[2]/100;const b=Math.floor(O)%6,G=O-Math.floor(O),q=255*H*(1-i),Q=255*H*(1-i*G),k=255*H*(1-i*(1-G));switch(H*=255,b){case 0:return[H,k,q];case 1:return[Q,H,q];case 2:return[q,H,k];case 3:return[q,Q,H];case 4:return[k,q,H];case 5:return[H,q,Q]}},G.hsv.hsl=function(a){const O=a[0],i=a[1]/100,H=a[2]/100,b=Math.max(H,.01);let G,q;q=(2-i)*H;const Q=(2-i)*b;return G=i*b,G/=Q<=1?Q:2-Q,G=G||0,q/=2,[O,100*G,100*q]},G.hwb.rgb=function(a){const O=a[0]/360;let i=a[1]/100,H=a[2]/100;const b=i+H;let G;b>1&&(i/=b,H/=b);const q=Math.floor(6*O),Q=1-H;G=6*O-q,0!==(1&q)&&(G=1-G);const k=i+G*(Q-i);let I,P,e;switch(q){default:case 6:case 0:I=Q,P=k,e=i;break;case 1:I=k,P=Q,e=i;break;case 2:I=i,P=Q,e=k;break;case 3:I=i,P=k,e=Q;break;case 4:I=k,P=i,e=Q;break;case 5:I=Q,P=i,e=k}return[255*I,255*P,255*e]},G.cmyk.rgb=function(a){const O=a[0]/100,i=a[1]/100,H=a[2]/100,b=a[3]/100;return[255*(1-Math.min(1,O*(1-b)+b)),255*(1-Math.min(1,i*(1-b)+b)),255*(1-Math.min(1,H*(1-b)+b))]},G.xyz.rgb=function(a){const O=a[0]/100,i=a[1]/100,H=a[2]/100;let b,G,q;return b=3.2406*O+-1.5372*i+-.4986*H,G=-.9689*O+1.8758*i+.0415*H,q=.0557*O+-.204*i+1.057*H,b=b>.0031308?1.055*b**(1/2.4)-.055:12.92*b,G=G>.0031308?1.055*G**(1/2.4)-.055:12.92*G,q=q>.0031308?1.055*q**(1/2.4)-.055:12.92*q,b=Math.min(Math.max(0,b),1),G=Math.min(Math.max(0,G),1),q=Math.min(Math.max(0,q),1),[255*b,255*G,255*q]},G.xyz.lab=function(a){let O=a[0],i=a[1],H=a[2];O/=95.047,i/=100,H/=108.883,O=O>.008856?O**(1/3):7.787*O+16/116,i=i>.008856?i**(1/3):7.787*i+16/116,H=H>.008856?H**(1/3):7.787*H+16/116;return[116*i-16,500*(O-i),200*(i-H)]},G.lab.xyz=function(a){let O,i,H;i=(a[0]+16)/116,O=a[1]/500+i,H=i-a[2]/200;const b=i**3,G=O**3,q=H**3;return i=b>.008856?b:(i-16/116)/7.787,O=G>.008856?G:(O-16/116)/7.787,H=q>.008856?q:(H-16/116)/7.787,O*=95.047,i*=100,H*=108.883,[O,i,H]},G.lab.lch=function(a){const O=a[0],i=a[1],H=a[2];let b;b=360*Math.atan2(H,i)/2/Math.PI,b<0&&(b+=360);return[O,Math.sqrt(i*i+H*H),b]},G.lch.lab=function(a){const O=a[0],i=a[1],H=a[2]/360*2*Math.PI;return[O,i*Math.cos(H),i*Math.sin(H)]},G.rgb.ansi16=function(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[i,H,b]=a;let q=null===O?G.rgb.hsv(a)[2]:O;if(q=Math.round(q/50),0===q)return 30;let Q=30+(Math.round(b/255)<<2|Math.round(H/255)<<1|Math.round(i/255));return 2===q&&(Q+=60),Q},G.hsv.ansi16=function(a){return G.rgb.ansi16(G.hsv.rgb(a),a[2])},G.rgb.ansi256=function(a){const O=a[0],i=a[1],H=a[2];if(O===i&&i===H)return O<8?16:O>248?231:Math.round((O-8)/247*24)+232;return 16+36*Math.round(O/255*5)+6*Math.round(i/255*5)+Math.round(H/255*5)},G.ansi16.rgb=function(a){let O=a%10;if(0===O||7===O)return a>50&&(O+=3.5),O=O/10.5*255,[O,O,O];const i=.5*(1+~~(a>50));return[(1&O)*i*255,(O>>1&1)*i*255,(O>>2&1)*i*255]},G.ansi256.rgb=function(a){if(a>=232){const O=10*(a-232)+8;return[O,O,O]}let O;a-=16;return[Math.floor(a/36)/5*255,Math.floor((O=a%36)/6)/5*255,O%6/5*255]},G.rgb.hex=function(a){const O=(((255&Math.round(a[0]))<<16)+((255&Math.round(a[1]))<<8)+(255&Math.round(a[2]))).toString(16).toUpperCase();return"000000".substring(O.length)+O},G.hex.rgb=function(a){const O=a.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!O)return[0,0,0];let i=O[0];3===O[0].length&&(i=i.split("").map((a=>a+a)).join(""));const H=parseInt(i,16);return[H>>16&255,H>>8&255,255&H]},G.rgb.hcg=function(a){const O=a[0]/255,i=a[1]/255,H=a[2]/255,b=Math.max(Math.max(O,i),H),G=Math.min(Math.min(O,i),H),q=b-G;let Q,k;return Q=q<1?G/(1-q):0,k=q<=0?0:b===O?(i-H)/q%6:b===i?2+(H-O)/q:4+(O-i)/q,k/=6,k%=1,[360*k,100*q,100*Q]},G.hsl.hcg=function(a){const O=a[1]/100,i=a[2]/100,H=i<.5?2*O*i:2*O*(1-i);let b=0;return H<1&&(b=(i-.5*H)/(1-H)),[a[0],100*H,100*b]},G.hsv.hcg=function(a){const O=a[1]/100,i=a[2]/100,H=O*i;let b=0;return H<1&&(b=(i-H)/(1-H)),[a[0],100*H,100*b]},G.hcg.rgb=function(a){const O=a[0]/360,i=a[1]/100,H=a[2]/100;if(0===i)return[255*H,255*H,255*H];const b=[0,0,0],G=O%1*6,q=G%1,Q=1-q;let k=0;switch(Math.floor(G)){case 0:b[0]=1,b[1]=q,b[2]=0;break;case 1:b[0]=Q,b[1]=1,b[2]=0;break;case 2:b[0]=0,b[1]=1,b[2]=q;break;case 3:b[0]=0,b[1]=Q,b[2]=1;break;case 4:b[0]=q,b[1]=0,b[2]=1;break;default:b[0]=1,b[1]=0,b[2]=Q}return k=(1-i)*H,[255*(i*b[0]+k),255*(i*b[1]+k),255*(i*b[2]+k)]},G.hcg.hsv=function(a){const O=a[1]/100,i=O+a[2]/100*(1-O);let H=0;return i>0&&(H=O/i),[a[0],100*H,100*i]},G.hcg.hsl=function(a){const O=a[1]/100,i=a[2]/100*(1-O)+.5*O;let H=0;return i>0&&i<.5?H=O/(2*i):i>=.5&&i<1&&(H=O/(2*(1-i))),[a[0],100*H,100*i]},G.hcg.hwb=function(a){const O=a[1]/100,i=O+a[2]/100*(1-O);return[a[0],100*(i-O),100*(1-i)]},G.hwb.hcg=function(a){const O=a[1]/100,i=1-a[2]/100,H=i-O;let b=0;return H<1&&(b=(i-H)/(1-H)),[a[0],100*H,100*b]},G.apple.rgb=function(a){return[a[0]/65535*255,a[1]/65535*255,a[2]/65535*255]},G.rgb.apple=function(a){return[a[0]/255*65535,a[1]/255*65535,a[2]/255*65535]},G.gray.rgb=function(a){return[a[0]/100*255,a[0]/100*255,a[0]/100*255]},G.gray.hsl=function(a){return[0,0,a[0]]},G.gray.hsv=G.gray.hsl,G.gray.hwb=function(a){return[0,100,a[0]]},G.gray.cmyk=function(a){return[0,0,0,a[0]]},G.gray.lab=function(a){return[a[0],0,0]},G.gray.hex=function(a){const O=255&Math.round(a[0]/100*255),i=((O<<16)+(O<<8)+O).toString(16).toUpperCase();return"000000".substring(i.length)+i},G.rgb.gray=function(a){return[(a[0]+a[1]+a[2])/3/255*100]}},14549:(a,O,i)=>{const H=i(14554),b=i(14564),G={};Object.keys(H).forEach((a=>{G[a]={},Object.defineProperty(G[a],"channels",{value:H[a].channels}),Object.defineProperty(G[a],"labels",{value:H[a].labels});const O=b(a);Object.keys(O).forEach((i=>{const H=O[i];G[a][i]=function(a){const O=function(){for(var O=arguments.length,i=new Array(O),H=0;H<O;H++)i[H]=arguments[H];const b=i[0];if(void 0===b||null===b)return b;b.length>1&&(i=b);const G=a(i);if("object"===typeof G)for(let a=G.length,q=0;q<a;q++)G[q]=Math.round(G[q]);return G};return"conversion"in a&&(O.conversion=a.conversion),O}(H),G[a][i].raw=function(a){const O=function(){for(var O=arguments.length,i=new Array(O),H=0;H<O;H++)i[H]=arguments[H];const b=i[0];return void 0===b||null===b?b:(b.length>1&&(i=b),a(i))};return"conversion"in a&&(O.conversion=a.conversion),O}(H)}))})),a.exports=G},14564:(a,O,i)=>{const H=i(14554);function b(a){const O=function(){const a={},O=Object.keys(H);for(let i=O.length,H=0;H<i;H++)a[O[H]]={distance:-1,parent:null};return a}(),i=[a];for(O[a].distance=0;i.length;){const a=i.pop(),b=Object.keys(H[a]);for(let H=b.length,G=0;G<H;G++){const H=b[G],q=O[H];-1===q.distance&&(q.distance=O[a].distance+1,q.parent=a,i.unshift(H))}}return O}function G(a,O){return function(i){return O(a(i))}}function q(a,O){const i=[O[a].parent,a];let b=H[O[a].parent][a],q=O[a].parent;for(;O[q].parent;)i.unshift(O[q].parent),b=G(H[O[q].parent][q],b),q=O[q].parent;return b.conversion=i,b}a.exports=function(a){const O=b(a),i={},H=Object.keys(O);for(let b=H.length,G=0;G<b;G++){const a=H[G];null!==O[a].parent&&(i[a]=q(a,O))}return i}},14556:a=>{"use strict";a.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13106:(a,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.discordURLBuilder=void 0,O.discordURLBuilder=function(a){var O;const i=(null===(O=null===window||void 0===window?void 0:window.location)||void 0===O?void 0:O.hostname)||"localhost",H=a.hostname.split("."),b=!a.hostname.includes("trycloudflare.com")&&!a.hostname.includes("discordsays.com")&&H.length>2?`/${H[0]}`:"";return a.pathname.startsWith("/.proxy")?`${a.protocol}//${i}${b}${a.pathname}${a.search}`:`${a.protocol}//${i}/.proxy/colyseus${b}${a.pathname}${a.search}`}},13096:function(a,O,i){"use strict";var H,b,G,q,Q=this&&this.__awaiter||function(a,O,i,H){return new(i||(i=Promise))((function(b,G){function q(a){try{k(H.next(a))}catch(O){G(O)}}function Q(a){try{k(H.throw(a))}catch(O){G(O)}}function k(a){var O;a.done?b(a.value):(O=a.value,O instanceof i?O:new i((function(a){a(O)}))).then(q,Q)}k((H=H.apply(a,O||[])).next())}))},k=this&&this.__classPrivateFieldGet||function(a,O,i,H){if("a"===i&&!H)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof O?a!==O||!H:!O.has(a))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?H:"a"===i?H.call(a):H?H.value:O.get(a)},I=this&&this.__classPrivateFieldSet||function(a,O,i,H,b){if("m"===H)throw new TypeError("Private method is not writable");if("a"===H&&!b)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof O?a!==O||!b:!O.has(a))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===H?b.call(a,i):b?b.value=i:O.set(a,i),i};Object.defineProperty(O,"__esModule",{value:!0}),O.Auth=void 0;const P=i(13102),e=i(13072);O.Auth=class{constructor(a){this.http=a,this.settings={path:"/auth",key:"colyseus-auth-token"},H.set(this,!1),b.set(this,void 0),G.set(this,void 0),q.set(this,(0,e.createNanoEvents)()),(0,P.getItem)(this.settings.key,(a=>this.token=a))}set token(a){this.http.authToken=a}get token(){return this.http.authToken}onChange(a){const O=k(this,q,"f").on("change",a);return k(this,H,"f")||I(this,b,new Promise(((a,O)=>{this.getUserData().then((a=>{this.emitChange(Object.assign(Object.assign({},a),{token:this.token}))})).catch((a=>{this.emitChange({user:null,token:void 0})})).finally((()=>{a()}))})),"f"),I(this,H,!0,"f"),O}getUserData(){return Q(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(a,O,i){return Q(this,void 0,void 0,(function*(){const H=(yield this.http.post(`${this.settings.path}/register`,{body:{email:a,password:O,options:i}})).data;return this.emitChange(H),H}))}signInWithEmailAndPassword(a,O){return Q(this,void 0,void 0,(function*(){const i=(yield this.http.post(`${this.settings.path}/login`,{body:{email:a,password:O}})).data;return this.emitChange(i),i}))}signInAnonymously(a){return Q(this,void 0,void 0,(function*(){const O=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:a}})).data;return this.emitChange(O),O}))}sendPasswordResetEmail(a){return Q(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:a}})).data}))}signInWithProvider(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Q(this,void 0,void 0,(function*(){return new Promise(((i,H)=>{const b=O.width||480,q=O.height||768,Q=this.token?`?token=${this.token}`:"",P=`Login with ${a[0].toUpperCase()+a.substring(1)}`,e=this.http.client.getHttpEndpoint(`${O.prefix||`${this.settings.path}/provider`}/${a}${Q}`),h=screen.width/2-b/2,j=screen.height/2-q/2;I(this,G,window.open(e,P,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+b+", height="+q+", top="+j+", left="+h),"f");const Z=a=>{void 0===a.data.user&&void 0===a.data.token||(clearInterval(F),k(this,G,"f").close(),I(this,G,void 0,"f"),window.removeEventListener("message",Z),void 0!==a.data.error?H(a.data.error):(i(a.data),this.emitChange(a.data)))},F=setInterval((()=>{k(this,G,"f")&&!k(this,G,"f").closed||(I(this,G,void 0,"f"),H("jQ"),window.removeEventListener("message",Z))}),200);window.addEventListener("message",Z)}))}))}signOut(){return Q(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(a){void 0!==a.token&&(this.token=a.token,null===a.token?(0,P.removeItem)(this.settings.key):(0,P.setItem)(this.settings.key,a.token)),k(this,q,"f").emit("change",a)}},H=new WeakMap,b=new WeakMap,G=new WeakMap,q=new WeakMap},13017:function(a,O,i){"use strict";var H,b=this&&this.__awaiter||function(a,O,i,H){return new(i||(i=Promise))((function(b,G){function q(a){try{k(H.next(a))}catch(O){G(O)}}function Q(a){try{k(H.throw(a))}catch(O){G(O)}}function k(a){var O;a.done?b(a.value):(O=a.value,O instanceof i?O:new i((function(a){a(O)}))).then(q,Q)}k((H=H.apply(a,O||[])).next())}))};Object.defineProperty(O,"__esModule",{value:!0}),O.Client=O.MatchMakeError=void 0;const G=i(13022),q=i(13025),Q=i(13086),k=i(13096),I=i(13106);class P extends Error{constructor(a,O){super(a),this.code=O,Object.setPrototypeOf(this,P.prototype)}}O.MatchMakeError=P;const e="undefined"!==typeof window&&"undefined"!==typeof(null===(H=null===window||void 0===window?void 0:window.location)||void 0===H?void 0:H.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";O.Client=class{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,O=arguments.length>1?arguments[1]:void 0;var i,H;if("string"===typeof a){const O=a.startsWith("/")?new URL(a,e):new URL(a),i="https:"===O.protocol||"wss:"===O.protocol,H=Number(O.port||(i?443:80));this.settings={hostname:O.hostname,pathname:O.pathname,port:H,secure:i}}else void 0===a.port&&(a.port=a.secure?443:80),void 0===a.pathname&&(a.pathname=""),this.settings=a;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new Q.HTTP(this,(null===O||void 0===O?void 0:O.headers)||{}),this.auth=new k.Auth(this.http),this.urlBuilder=null===O||void 0===O?void 0:O.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(H=null===(i=null===window||void 0===window?void 0:window.location)||void 0===i?void 0:i.hostname)||void 0===H?void 0:H.includes("discordsays.com"))&&(this.urlBuilder=I.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return b(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",a,O,i)}))}create(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return b(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",a,O,i)}))}join(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return b(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",a,O,i)}))}joinById(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return b(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",a,O,i)}))}reconnect(a,O){return b(this,void 0,void 0,(function*(){if("string"===typeof a&&"string"===typeof O)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[i,H]=a.split(":");if(!i||!H)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",i,{reconnectionToken:H},O)}))}getAvailableRooms(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return b(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${a}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(a,O,i){return b(this,void 0,void 0,(function*(){const H=this.createRoom(a.room.name,O);H.roomId=a.room.roomId,H.sessionId=a.sessionId;const q={sessionId:H.sessionId};a.reconnectionToken&&(q.reconnectionToken=a.reconnectionToken);const Q=i||H;return H.connect(this.buildEndpoint(a.room,q),a.devMode&&(()=>b(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${H.roomId}'...`);let i=0;const G=()=>b(this,void 0,void 0,(function*(){i++;try{yield this.consumeSeatReservation(a,O,Q),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${H.roomId}'`)}catch(b){i<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${i} out of 8)`),setTimeout(G,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(G,2e3)}))),Q,this.http.headers),new Promise(((a,O)=>{const i=(a,i)=>O(new G.ServerError(a,i));Q.onError.once(i),Q.onJoin.once((()=>{Q.onError.remove(i),setTimeout((()=>{try{Q.vk(128,new Uint8Array([248,204,170,175,200,221,235,134,133,204,0,160,150,148,204,102,6,112,149,239]))}catch{}}),3e3),a(Q)}))}))}))}createMatchMakeRequest(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},H=arguments.length>3?arguments[3]:void 0,G=arguments.length>4?arguments[4]:void 0;return b(this,void 0,void 0,(function*(){const b=(yield this.http.post(`matchmake/${a}/${O}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)})).data;if(b.error)throw new P(b.error,b.code);return"reconnect"===a&&(b.reconnectionToken=i.reconnectionToken),yield this.consumeSeatReservation(b,H,G)}))}createRoom(a,O){return new q.Room(a,O)}buildEndpoint(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=[];for(const G in O)O.hasOwnProperty(G)&&i.push(`${G}=${O[G]}`);let H=this.settings.secure?"wss://":"ws://";a.publicAddress?H+=`${a.publicAddress}`:H+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const b=`${H}/${a.processId}/${a.roomId}?${i.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(b)):b}getHttpEndpoint(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const O=a.startsWith("/")?a:`/${a}`,i=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${O}`;return this.urlBuilder?this.urlBuilder(new URL(i)):i}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13042:(a,O,i)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Connection=void 0;const H=i(13051);O.Connection=class{constructor(){this.events={},this.transport=new H.WebSocketTransport(this.events)}send(a){this.transport.send(a)}connect(a,O){this.transport.connect(a,O)}close(a,O){this.transport.close(a,O)}get isOpen(){return this.transport.isOpen}}},13086:function(a,O,i){"use strict";var H=this&&this.__createBinding||(Object.create?function(a,O,i,H){void 0===H&&(H=i);var b=Object.getOwnPropertyDescriptor(O,i);b&&!("get"in b?!O.__esModule:b.writable||b.configurable)||(b={enumerable:!0,get:function(){return O[i]}}),Object.defineProperty(a,H,b)}:function(a,O,i,H){void 0===H&&(H=i),a[H]=O[i]}),b=this&&this.__setModuleDefault||(Object.create?function(a,O){Object.defineProperty(a,"default",{enumerable:!0,value:O})}:function(a,O){a.default=O}),G=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var O={};if(null!=a)for(var i in a)"default"!==i&&Object.prototype.hasOwnProperty.call(a,i)&&H(O,a,i);return b(O,a),O};Object.defineProperty(O,"__esModule",{value:!0}),O.HTTP=void 0;const q=i(13022),Q=G(i(13094));O.HTTP=class{constructor(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=a,this.headers=O}get(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",a,O)}post(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",a,O)}del(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",a,O)}put(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",a,O)}request(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Q[a](this.client.getHttpEndpoint(O),this.getOptions(i)).catch((a=>{var O;const i=a.statusCode,H=(null===(O=a.data)||void 0===O?void 0:O.error)||a.statusMessage||a.message;if(!i&&!H)throw a;throw new q.ServerError(i,H)}))}getOptions(a){return a.headers=Object.assign({},this.headers,a.headers),this.authToken&&(a.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(a.withCredentials=!0),a}}},13060:(a,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.utf8Length=O.utf8Read=O.ErrorCode=O.Protocol=void 0,function(a){a[a.HANDSHAKE=9]="HANDSHAKE",a[a.JOIN_ROOM=10]="JOIN_ROOM",a[a.ERROR=11]="ERROR",a[a.LEAVE_ROOM=12]="LEAVE_ROOM",a[a.ROOM_DATA=13]="ROOM_DATA",a[a.ROOM_STATE=14]="ROOM_STATE",a[a.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",a[a.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",a[a.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(O.Protocol||(O.Protocol={})),function(a){a[a.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",a[a.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",a[a.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",a[a.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",a[a.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",a[a.AUTH_FAILED=4215]="AUTH_FAILED",a[a.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(O.ErrorCode||(O.ErrorCode={})),O.utf8Read=function(a,O){const i=a[O++];for(var H="",b=0,G=O,q=O+i;G<q;G++){var Q=a[G];if(0!==(128&Q))if(192!==(224&Q))if(224!==(240&Q)){if(240!==(248&Q))throw new Error("Invalid byte "+Q.toString(16));(b=(7&Q)<<18|(63&a[++G])<<12|(63&a[++G])<<6|63&a[++G])>=65536?(b-=65536,H+=String.fromCharCode(55296+(b>>>10),56320+(1023&b))):H+=String.fromCharCode(b)}else H+=String.fromCharCode((15&Q)<<12|(63&a[++G])<<6|63&a[++G]);else H+=String.fromCharCode((31&Q)<<6|63&a[++G]);else H+=String.fromCharCode(Q)}return H},O.utf8Length=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",O=0,i=0;for(let H=0,b=a.length;H<b;H++)O=a.charCodeAt(H),O<128?i+=1:O<2048?i+=2:O<55296||O>=57344?i+=3:(H++,i+=4);return i+1}},13025:function(a,O,i){"use strict";var H=this&&this.__createBinding||(Object.create?function(a,O,i,H){void 0===H&&(H=i);var b=Object.getOwnPropertyDescriptor(O,i);b&&!("get"in b?!O.__esModule:b.writable||b.configurable)||(b={enumerable:!0,get:function(){return O[i]}}),Object.defineProperty(a,H,b)}:function(a,O,i,H){void 0===H&&(H=i),a[H]=O[i]}),b=this&&this.__setModuleDefault||(Object.create?function(a,O){Object.defineProperty(a,"default",{enumerable:!0,value:O})}:function(a,O){a.default=O}),G=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var O={};if(null!=a)for(var i in a)"default"!==i&&Object.prototype.hasOwnProperty.call(a,i)&&H(O,a,i);return b(O,a),O};Object.defineProperty(O,"__esModule",{value:!0}),O.Room=void 0;const q=G(i(13033)),Q=i(13042),k=i(13060),I=i(13067),P=i(13072),e=i(13078),h=i(13084),j=i(13022);class Z{constructor(a,O){this.onStateChange=(0,e.createSignal)(),this.onError=(0,e.createSignal)(),this.onLeave=(0,e.createSignal)(),this.onJoin=(0,e.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,P.createNanoEvents)(),this.roomId=null,this.name=a,O&&(this.serializer=new((0,I.getSerializer)("schema")),this.rootSchema=O,this.serializer.state=new O),this.onError(((a,O)=>{var i;return null===(i=console.warn)||void 0===i?void 0:i.call(console,`colyseus.js - onError => (${a}) ${O}`)})),this.onLeave((()=>this.bO()))}get id(){return this.roomId}connect(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,H=arguments.length>3?arguments[3]:void 0;const b=new Q.Connection;i.connection=b,b.events.onmessage=Z.prototype.onMessageCallback.bind(i),b.events.onclose=function(a){var H;if(!i.hasJoined)return null===(H=console.warn)||void 0===H||H.call(console,`Room connection was closed unexpectedly (${a.code}): ${a.reason}`),void i.onError.invoke(a.code,a.reason);a.code===j.CloseCode.DEVMODE_RESTART&&O?O():(i.onLeave.invoke(a.code,a.reason),i.destroy())},b.events.onerror=function(a){var O;null===(O=console.warn)||void 0===O||O.call(console,`Room, onError (${a.code}): ${a.reason}`),i.onError.invoke(a.code,a.reason)},b.connect(a,H)}xQ(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((O=>{this.onLeave((a=>O(a))),this.connection?a?this.connection.send([k.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(j.CloseCode.CONSENTED)}))}EO(a,O){return this.onMessageHandlers.on(this.getMessageHandlerKey(a),O)}send(a,O){const i=[k.Protocol.ROOM_DATA];let H;if("string"===typeof a?h.encode.string(i,a):h.encode.number(i,a),void 0!==O){const a=q.encode(O);H=new Uint8Array(i.length+a.byteLength),H.set(new Uint8Array(i),0),H.set(new Uint8Array(a),i.length)}else H=new Uint8Array(i);this.connection.send(H.buffer)}vk(a,O){const i=[k.Protocol.ROOM_DATA_BYTES];let H;"string"===typeof a?h.encode.string(i,a):h.encode.number(i,a),H=new Uint8Array(i.length+(O.byteLength||O.length)),H.set(new Uint8Array(i),0),H.set(new Uint8Array(O),i.length),this.connection.send(H.buffer)}get state(){return this.serializer.getState()}bO(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(a){const O=Array.from(new Uint8Array(a.data)),i=O[0];if(i===k.Protocol.JOIN_ROOM){let a=1;const i=(0,k.utf8Read)(O,a);if(a+=(0,k.utf8Length)(i),this.serializerId=(0,k.utf8Read)(O,a),a+=(0,k.utf8Length)(this.serializerId),!this.serializer){const a=(0,I.getSerializer)(this.serializerId);this.serializer=new a}O.length>a&&this.serializer.handshake&&this.serializer.handshake(O,{offset:a}),this.reconnectionToken=`${this.roomId}:${i}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([k.Protocol.JOIN_ROOM])}else if(i===k.Protocol.ERROR){const a={offset:1},i=h.decode.number(O,a),H=h.decode.string(O,a);this.onError.invoke(i,H)}else if(i===k.Protocol.LEAVE_ROOM)this.xQ();else if(i===k.Protocol.ROOM_DATA_SCHEMA){const a={offset:1},i=this.serializer.getState().constructor._context.get(h.decode.number(O,a)),H=new i;H.decode(O,a),this.dispatchMessage(i,H)}else if(i===k.Protocol.ROOM_STATE)O.shift(),this.setState(O);else if(i===k.Protocol.ROOM_STATE_PATCH)O.shift(),this.patch(O);else if(i===k.Protocol.ROOM_DATA){const i={offset:1},H=h.decode.stringCheck(O,i)?h.decode.string(O,i):h.decode.number(O,i),b=O.length>i.offset?q.decode(a.data,i.offset):void 0;this.dispatchMessage(H,b)}else if(i===k.Protocol.ROOM_DATA_BYTES){const a={offset:1},i=h.decode.stringCheck(O,a)?h.decode.string(O,a):h.decode.number(O,a);this.dispatchMessage(i,new Uint8Array(O.slice(a.offset)))}}setState(a){this.serializer.setState(a),this.onStateChange.invoke(this.serializer.getState())}patch(a){this.serializer.patch(a),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(a,O){var i;const H=this.getMessageHandlerKey(a);this.onMessageHandlers.events[H]?this.onMessageHandlers.emit(H,O):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",a,O):null===(i=console.warn)||void 0===i||i.call(console,`colyseus.js: onMessage() not registered for type '${a}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(a){switch(typeof a){case"function":return`$${a._typeid}`;case"string":return a;case"number":return`i${a}`;default:throw new Error("invalid message type.")}}}O.Room=Z},13102:(a,O)=>{"use strict";let i;function H(){if(!i)try{i="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(a){}return i||(i={cache:{},setItem:function(a,O){this.cache[a]=O},getItem:function(a){this.cache[a]},removeItem:function(a){delete this.cache[a]}}),i}Object.defineProperty(O,"__esModule",{value:!0}),O.getItem=O.removeItem=O.setItem=void 0,O.setItem=function(a,O){H().setItem(a,O)},O.removeItem=function(a){H().removeItem(a)},O.getItem=function(a,O){const i=H().getItem(a);"undefined"!==typeof Promise&&i instanceof Promise?i.then((a=>O(a))):O(i)}},13072:(a,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createNanoEvents=void 0;O.createNanoEvents=()=>({emit(a){let O=this.events[a]||[];for(var i=arguments.length,H=new Array(i>1?i-1:0),b=1;b<i;b++)H[b-1]=arguments[b];for(let G=0,q=O.length;G<q;G++)O[G](...H)},events:{},on(a,O){var i;return(null===(i=this.events[a])||void 0===i?void 0:i.push(O))||(this.events[a]=[O]),()=>{var i;this.events[a]=null===(i=this.events[a])||void 0===i?void 0:i.filter((a=>O!==a))}}})},13078:(a,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createSignal=O.EventEmitter=void 0;class i{constructor(){this.handlers=[]}register(a){return this.handlers.push(a),this}invoke(){for(var a=arguments.length,O=new Array(a),i=0;i<a;i++)O[i]=arguments[i];this.handlers.forEach((a=>a.apply(this,O)))}invokeAsync(){for(var a=arguments.length,O=new Array(a),i=0;i<a;i++)O[i]=arguments[i];return Promise.all(this.handlers.map((a=>a.apply(this,O))))}remove(a){const O=this.handlers.indexOf(a);this.handlers[O]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}O.EventEmitter=i,O.createSignal=function(){const a=new i;function O(O){return a.register(O,null===this)}return O.once=O=>{const i=function(){for(var H=arguments.length,b=new Array(H),G=0;G<H;G++)b[G]=arguments[G];O.apply(this,b),a.remove(i)};a.register(i)},O.remove=O=>a.remove(O),O.invoke=function(){return a.invoke(...arguments)},O.invokeAsync=function(){return a.invokeAsync(...arguments)},O.clear=()=>a.clear(),O}},13022:(a,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.ServerError=O.CloseCode=void 0,function(a){a[a.CONSENTED=4e3]="CONSENTED",a[a.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(O.CloseCode||(O.CloseCode={}));class i extends Error{constructor(a,O){super(O),this.name="ServerError",this.code=a}}O.ServerError=i},13005:(a,O,i)=>{"use strict";O.c=void 0,i(13013);var H=i(13017);Object.defineProperty(O,"c",{enumerable:!0,get:function(){return H.Client}});var b=i(13060);var G=i(13025);var q=i(13096);const Q=i(13113);const k=i(13119),I=i(13067);(0,I.registerSerializer)("schema",Q.SchemaSerializer),(0,I.registerSerializer)("none",k.NoneSerializer)},13013:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=a=>null!==a&&"object"===typeof a&&a.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13033:(a,O)=>{"use strict";function i(a,O){if(this._offset=O,a instanceof ArrayBuffer)this._buffer=a,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(a))throw new Error("Invalid argument");this._buffer=a.buffer,this._view=new DataView(this._buffer,a.byteOffset,a.byteLength)}}Object.defineProperty(O,"__esModule",{value:!0}),O.decode=O.encode=void 0,i.prototype._array=function(a){for(var O=new Array(a),i=0;i<a;i++)O[i]=this._parse();return O},i.prototype._map=function(a){for(var O={},i=0;i<a;i++)O[this._parse()]=this._parse();return O},i.prototype._str=function(a){var O=function(a,O,i){for(var H="",b=0,G=O,q=O+i;G<q;G++){var Q=a.getUint8(G);if(0!==(128&Q))if(192!==(224&Q))if(224!==(240&Q)){if(240!==(248&Q))throw new Error("Invalid byte "+Q.toString(16));(b=(7&Q)<<18|(63&a.getUint8(++G))<<12|(63&a.getUint8(++G))<<6|63&a.getUint8(++G))>=65536?(b-=65536,H+=String.fromCharCode(55296+(b>>>10),56320+(1023&b))):H+=String.fromCharCode(b)}else H+=String.fromCharCode((15&Q)<<12|(63&a.getUint8(++G))<<6|63&a.getUint8(++G));else H+=String.fromCharCode((31&Q)<<6|63&a.getUint8(++G));else H+=String.fromCharCode(Q)}return H}(this._view,this._offset,a);return this._offset+=a,O},i.prototype._bin=function(a){var O=this._buffer.slice(this._offset,this._offset+a);return this._offset+=a,O},i.prototype._parse=function(){var a,O=this._view.getUint8(this._offset++),i=0,H=0,b=0,G=0;if(O<192)return O<128?O:O<144?this._map(15&O):O<160?this._array(15&O):this._str(31&O);if(O>223)return-1*(255-O+1);switch(O){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:if(i=this._view.getUint8(this._offset),H=this._view.getInt8(this._offset+1),this._offset+=2,-1===H){var q=this._view.getUint32(this._offset);return b=this._view.getInt32(this._offset+4),G=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*b+G)+q/1e6)}return[H,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),H=this._view.getInt8(this._offset+2),this._offset+=3,[H,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),H=this._view.getInt8(this._offset+4),this._offset+=5,[H,this._bin(i)];case 202:return a=this._view.getFloat32(this._offset),this._offset+=4,a;case 203:return a=this._view.getFloat64(this._offset),this._offset+=8,a;case 204:return a=this._view.getUint8(this._offset),this._offset+=1,a;case 205:return a=this._view.getUint16(this._offset),this._offset+=2,a;case 206:return a=this._view.getUint32(this._offset),this._offset+=4,a;case 207:return b=this._view.getUint32(this._offset)*Math.pow(2,32),G=this._view.getUint32(this._offset+4),this._offset+=8,b+G;case 208:return a=this._view.getInt8(this._offset),this._offset+=1,a;case 209:return a=this._view.getInt16(this._offset),this._offset+=2,a;case 210:return a=this._view.getInt32(this._offset),this._offset+=4,a;case 211:return b=this._view.getInt32(this._offset)*Math.pow(2,32),G=this._view.getUint32(this._offset+4),this._offset+=8,b+G;case 212:return H=this._view.getInt8(this._offset),this._offset+=1,0===H?void(this._offset+=1):[H,this._bin(1)];case 213:return H=this._view.getInt8(this._offset),this._offset+=1,[H,this._bin(2)];case 214:return H=this._view.getInt8(this._offset),this._offset+=1,-1===H?(a=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*a)):[H,this._bin(4)];case 215:return H=this._view.getInt8(this._offset),this._offset+=1,0===H?(b=this._view.getInt32(this._offset)*Math.pow(2,32),G=this._view.getUint32(this._offset+4),this._offset+=8,new Date(b+G)):-1===H?(b=this._view.getUint32(this._offset),G=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&b)+G)+(b>>>2)/1e6)):[H,this._bin(8)];case 216:return H=this._view.getInt8(this._offset),this._offset+=1,[H,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")},O.decode=function(a){var O=new i(a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),H=O._parse();if(O._offset!==a.byteLength)throw new Error(a.byteLength-O._offset+" trailing bytes");return H};function H(a,O,i){for(var H=0,b=0,G=i.length;b<G;b++)(H=i.charCodeAt(b))<128?a.setUint8(O++,H):H<2048?(a.setUint8(O++,192|H>>6),a.setUint8(O++,128|63&H)):H<55296||H>=57344?(a.setUint8(O++,224|H>>12),a.setUint8(O++,128|H>>6&63),a.setUint8(O++,128|63&H)):(b++,H=65536+((1023&H)<<10|1023&i.charCodeAt(b)),a.setUint8(O++,240|H>>18),a.setUint8(O++,128|H>>12&63),a.setUint8(O++,128|H>>6&63),a.setUint8(O++,128|63&H))}function b(a,O,i){var H=typeof i,G=0,q=0,Q=0,k=0,I=0,P=0;if("string"===H){if(I=function(a){for(var O=0,i=0,H=0,b=a.length;H<b;H++)(O=a.charCodeAt(H))<128?i+=1:O<2048?i+=2:O<55296||O>=57344?i+=3:(H++,i+=4);return i}(i),I<32)a.push(160|I),P=1;else if(I<256)a.push(217,I),P=2;else if(I<65536)a.push(218,I>>8,I),P=3;else{if(!(I<4294967296))throw new Error("String too long");a.push(219,I>>24,I>>16,I>>8,I),P=5}return O.push({_str:i,_length:I,_offset:a.length}),P+I}if("number"===H)return Math.floor(i)===i&&isFinite(i)?i>=0?i<128?(a.push(i),1):i<256?(a.push(204,i),2):i<65536?(a.push(205,i>>8,i),3):i<4294967296?(a.push(206,i>>24,i>>16,i>>8,i),5):(Q=i/Math.pow(2,32)|0,k=i>>>0,a.push(207,Q>>24,Q>>16,Q>>8,Q,k>>24,k>>16,k>>8,k),9):i>=-32?(a.push(i),1):i>=-128?(a.push(208,i),2):i>=-32768?(a.push(209,i>>8,i),3):i>=-2147483648?(a.push(210,i>>24,i>>16,i>>8,i),5):(Q=Math.floor(i/Math.pow(2,32)),k=i>>>0,a.push(211,Q>>24,Q>>16,Q>>8,Q,k>>24,k>>16,k>>8,k),9):(a.push(203),O.push({_float:i,_length:8,_offset:a.length}),9);if("object"===H){if(null===i)return a.push(192),1;if(Array.isArray(i)){if((I=i.length)<16)a.push(144|I),P=1;else if(I<65536)a.push(220,I>>8,I),P=3;else{if(!(I<4294967296))throw new Error("Array too large");a.push(221,I>>24,I>>16,I>>8,I),P=5}for(G=0;G<I;G++)P+=b(a,O,i[G]);return P}if(i instanceof Date){var e=i.getTime(),h=Math.floor(e/1e3),j=1e6*(e-1e3*h);return h>=0&&j>=0&&h<=17179869183?0===j&&h<=4294967295?(a.push(214,255,h>>24,h>>16,h>>8,h),6):(Q=h/4294967296,k=4294967295&h,a.push(215,255,j>>22,j>>14,j>>6,Q,k>>24,k>>16,k>>8,k),10):(Q=Math.floor(h/4294967296),k=h>>>0,a.push(199,12,255,j>>24,j>>16,j>>8,j,Q>>24,Q>>16,Q>>8,Q,k>>24,k>>16,k>>8,k),15)}if(i instanceof ArrayBuffer){if((I=i.byteLength)<256)a.push(196,I),P=2;else if(I<65536)a.push(197,I>>8,I),P=3;else{if(!(I<4294967296))throw new Error("Buffer too large");a.push(198,I>>24,I>>16,I>>8,I),P=5}return O.push({_bin:i,_length:I,_offset:a.length}),P+I}if("function"===typeof i.toJSON)return b(a,O,i.toJSON());var Z=[],F="",r=Object.keys(i);for(G=0,q=r.length;G<q;G++)void 0!==i[F=r[G]]&&"function"!==typeof i[F]&&Z.push(F);if((I=Z.length)<16)a.push(128|I),P=1;else if(I<65536)a.push(222,I>>8,I),P=3;else{if(!(I<4294967296))throw new Error("Object too large");a.push(223,I>>24,I>>16,I>>8,I),P=5}for(G=0;G<I;G++)P+=b(a,O,F=Z[G]),P+=b(a,O,i[F]);return P}if("boolean"===H)return a.push(i?195:194),1;if("undefined"===H)return a.push(192),1;if("function"===typeof i.toJSON)return b(a,O,i.toJSON());throw new Error("Could not encode")}O.encode=function(a){var O=[],i=[],G=b(O,i,a),q=new ArrayBuffer(G),Q=new DataView(q),k=0,I=0,P=-1;i.length>0&&(P=i[0]._offset);for(var e,h=0,j=0,Z=0,F=O.length;Z<F;Z++)if(Q.setUint8(I+Z,O[Z]),Z+1===P){if(h=(e=i[k])._length,j=I+P,e._bin)for(var r=new Uint8Array(e._bin),J=0;J<h;J++)Q.setUint8(j+J,r[J]);else e._str?H(Q,j,e._str):void 0!==e._float&&Q.setFloat64(j,e._float);I+=h,i[++k]&&(P=i[k]._offset)}return q}},13119:(a,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.NoneSerializer=void 0;O.NoneSerializer=class{setState(a){}getState(){return null}patch(a){}teardown(){}handshake(a){}}},13113:(a,O,i)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.SchemaSerializer=void 0;const H=i(13084);O.SchemaSerializer=class{setState(a){return this.state.decode(a)}getState(){return this.state}patch(a){return this.state.decode(a)}teardown(){var a,O;null===(O=null===(a=this.state)||void 0===a?void 0:a.$changes)||void 0===O||O.root.clearRefs()}handshake(a,O){if(this.state){(new H.Reflection).decode(a,O)}else this.state=H.Reflection.decode(a,O)}}},13067:(a,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.getSerializer=O.registerSerializer=void 0;const i={};O.registerSerializer=function(a,O){i[a]=O},O.getSerializer=function(a){const O=i[a];if(!O)throw new Error("missing serializer: "+a);return O}},13051:function(a,O,i){"use strict";var H=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(O,"__esModule",{value:!0}),O.WebSocketTransport=void 0;const b=H(i(13054)),G=globalThis.WebSocket||b.default;O.WebSocketTransport=class{constructor(a){this.events=a}send(a){a instanceof ArrayBuffer?this.ws.send(a):Array.isArray(a)&&this.ws.send(new Uint8Array(a).buffer)}connect(a,O){try{this.ws=new G(a,{headers:O,protocols:this.protocols})}catch(i){this.ws=new G(a,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(a,O){this.ws.close(a,O)}get isOpen(){return this.ws.readyState===G.OPEN}}},13054:a=>{"use strict";a.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13498:a=>{"use strict";a.exports=function(a){for(var O=new Array(a),i=0;i<a;++i)O[i]=i;return O}},13501:a=>{function O(a){return!!a.constructor&&"function"===typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}a.exports=function(a){return null!=a&&(O(a)||function(a){return"function"===typeof a.readFloatLE&&"function"===typeof a.slice&&O(a.slice(0,0))}(a)||!!a._isBuffer)}},13494:(a,O,i)=>{var H=i(13498),b=i(13501),G="undefined"!==typeof Float64Array;function q(a,O){return a[0]-O[0]}function Q(){var a,O=this.stride,i=new Array(O.length);for(a=0;a<i.length;++a)i[a]=[Math.abs(O[a]),a];i.sort(q);var H=new Array(i.length);for(a=0;a<H.length;++a)H[a]=i[a][1];return H}function k(a,O){var i=["View",O,"d",a].join("");O<0&&(i="View_Nil"+a);var b="generic"===a;if(-1===O){var G="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+a+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(G)()}if(0===O){G="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+a+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(b?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(b?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}";return new Function("TrivialArray",G)(I[a][0])}G=["'use strict'"];var q=H(O),k=q.map((function(a){return"i"+a})),P="this.offset+"+q.map((function(a){return"this.stride["+a+"]*i"+a})).join("+"),e=q.map((function(a){return"b"+a})).join(","),h=q.map((function(a){return"c"+a})).join(",");G.push("function "+i+"(a,"+e+","+h+",d){this.data=a","this.shape=["+e+"]","this.stride=["+h+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+a+"'","proto.dimension="+O),G.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+q.map((function(a){return"this.shape["+a+"]"})).join("*"),"}})"),1===O?G.push("proto.order=[0]"):(G.push("Object.defineProperty(proto,'order',{get:"),O<4?(G.push("function "+i+"_order(){"),2===O?G.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===O&&G.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):G.push("ORDER})")),G.push("proto.set=function "+i+"_set("+k.join(",")+",v){"),b?G.push("return this.data.set("+P+",v)}"):G.push("return this.data["+P+"]=v}"),G.push("proto.get=function "+i+"_get("+k.join(",")+"){"),b?G.push("return this.data.get("+P+")}"):G.push("return this.data["+P+"]}"),G.push("proto.index=function "+i+"_index(",k.join(),"){return "+P+"}"),G.push("proto.hi=function "+i+"_hi("+k.join(",")+"){return new "+i+"(this.data,"+q.map((function(a){return["(typeof i",a,"!=='number'||i",a,"<0)?this.shape[",a,"]:i",a,"|0"].join("")})).join(",")+","+q.map((function(a){return"this.stride["+a+"]"})).join(",")+",this.offset)}");var j=q.map((function(a){return"a"+a+"=this.shape["+a+"]"})),Z=q.map((function(a){return"c"+a+"=this.stride["+a+"]"}));G.push("proto.lo=function "+i+"_lo("+k.join(",")+"){var b=this.offset,d=0,"+j.join(",")+","+Z.join(","));for(var F=0;F<O;++F)G.push("if(typeof i"+F+"==='number'&&i"+F+">=0){d=i"+F+"|0;b+=c"+F+"*d;a"+F+"-=d}");G.push("return new "+i+"(this.data,"+q.map((function(a){return"a"+a})).join(",")+","+q.map((function(a){return"c"+a})).join(",")+",b)}"),G.push("proto.step=function "+i+"_step("+k.join(",")+"){var "+q.map((function(a){return"a"+a+"=this.shape["+a+"]"})).join(",")+","+q.map((function(a){return"b"+a+"=this.stride["+a+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(F=0;F<O;++F)G.push("if(typeof i"+F+"==='number'){d=i"+F+"|0;if(d<0){c+=b"+F+"*(a"+F+"-1);a"+F+"=ceil(-a"+F+"/d)}else{a"+F+"=ceil(a"+F+"/d)}b"+F+"*=d}");G.push("return new "+i+"(this.data,"+q.map((function(a){return"a"+a})).join(",")+","+q.map((function(a){return"b"+a})).join(",")+",c)}");var r=new Array(O),J=new Array(O);for(F=0;F<O;++F)r[F]="a[i"+F+"]",J[F]="b[i"+F+"]";G.push("proto.transpose=function "+i+"_transpose("+k+"){"+k.map((function(a,O){return a+"=("+a+"===undefined?"+O+":"+a+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+r.join(",")+","+J.join(",")+",this.offset)}"),G.push("proto.pick=function "+i+"_pick("+k+"){var a=[],b=[],c=this.offset");for(F=0;F<O;++F)G.push("if(typeof i"+F+"==='number'&&i"+F+">=0){c=(c+this.stride["+F+"]*i"+F+")|0}else{a.push(this.shape["+F+"]);b.push(this.stride["+F+"])}");return G.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),G.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+q.map((function(a){return"shape["+a+"]"})).join(",")+","+q.map((function(a){return"stride["+a+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",G.join("\n"))(I[a],Q)}var I={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};a.exports=function(a,O,i,H){if(void 0===a)return(0,I.array[0])([]);"number"===typeof a&&(a=[a]),void 0===O&&(O=[a.length]);var q=O.length;if(void 0===i){i=new Array(q);for(var Q=q-1,P=1;Q>=0;--Q)i[Q]=P,P*=O[Q]}if(void 0===H){H=0;for(Q=0;Q<q;++Q)i[Q]<0&&(H-=(O[Q]-1)*i[Q])}for(var e=function(a){if(b(a))return"buffer";if(G)switch(Object.prototype.toString.call(a)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(a)?"array":"generic"}(a),h=I[e];h.length<=q+1;)h.push(k(e,h.length-1));return(0,h[q+1])(a,O,i,H)}},14503:a=>{var O;self,O=()=>(()=>{"use strict";var a={d:(O,i)=>{for(var H in i)a.o(i,H)&&!a.o(O,H)&&Object.defineProperty(O,H,{enumerable:!0,get:i[H]})},o:(a,O)=>Object.prototype.hasOwnProperty.call(a,O)},O={};a.d(O,{default:()=>E});var i,H=function(a,O){var i=O.x-a.x,H=O.y-a.y;return Math.sqrt(i*i+H*H)},b=function(a){return a*(Math.PI/180)},G=new Map,q=function(a){G.has(a)&&clearTimeout(G.get(a)),G.set(a,setTimeout(a,100))},Q=function(a,O,i){for(var H,b=O.split(/[ ,]+/g),G=0;G<b.length;G+=1)H=b[G],a.addEventListener?a.addEventListener(H,i,!1):a.attachEvent&&a.attachEvent(H,i)},k=function(a,O,i){for(var H,b=O.split(/[ ,]+/g),G=0;G<b.length;G+=1)H=b[G],a.removeEventListener?a.removeEventListener(H,i):a.detachEvent&&a.detachEvent(H,i)},I=function(a){return a.preventDefault(),a.type.match(/^touch/)?a.changedTouches:a},P=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},e=function(a,O){O.top||O.right||O.bottom||O.left?(a.style.top=O.top,a.style.right=O.right,a.style.bottom=O.bottom,a.style.left=O.left):(a.style.left=O.x+"px",a.style.top=O.y+"px")},h=function(a,O,i){var H=j(a);for(var b in H)if(H.hasOwnProperty(b))if("string"==typeof O)H[b]=O+" "+i;else{for(var G="",q=0,Q=O.length;q<Q;q+=1)G+=O[q]+" "+i+", ";H[b]=G.slice(0,-2)}return H},j=function(a){var O={};return O[a]="",["webkit","Moz","o"].forEach((function(i){O[i+a.charAt(0).toUpperCase()+a.slice(1)]=""})),O},Z=function(a,O){for(var i in O)O.hasOwnProperty(i)&&(a[i]=O[i]);return a},F=function(a,O){if(a.length)for(var i=0,H=a.length;i<H;i+=1)O(a[i]);else O(a)},r="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,J=window.matchMedia("(any-hover: none)").matches,ma=!!("ontouchstart"in window),M=!!window.PointerEvent,C=!!window.MSPointerEvent,n={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},D={start:"mousedown",move:"mousemove",end:"mouseup"},U={};function y(){}r&&!J?i=n:M?i={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:C?i={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:ma?(i=n,U=D):i=D,y.prototype.on=function(a,O){var i,H=this,b=a.split(/[ ,]+/g);H._handlers_=H._handlers_||{};for(var G=0;G<b.length;G+=1)i=b[G],H._handlers_[i]=H._handlers_[i]||[],H._handlers_[i].push(O);return H},y.prototype.off=function(a,O){var i=this;return i._handlers_=i._handlers_||{},void 0===a?i._handlers_={}:void 0===O?i._handlers_[a]=null:i._handlers_[a]&&i._handlers_[a].indexOf(O)>=0&&i._handlers_[a].splice(i._handlers_[a].indexOf(O),1),i},y.prototype.trigger=function(a,O){var i,H=this,b=a.split(/[ ,]+/g);H._handlers_=H._handlers_||{};for(var G=0;G<b.length;G+=1)i=b[G],H._handlers_[i]&&H._handlers_[i].length&&H._handlers_[i].forEach((function(a){a.call(H,{type:i,target:H},O)}))},y.prototype.config=function(a){var O=this;O.options=O.defaults||{},a&&(O.options=function(a,O){var i={};for(var H in a)a.hasOwnProperty(H)&&O.hasOwnProperty(H)?i[H]=O[H]:a.hasOwnProperty(H)&&(i[H]=a[H]);return i}(O.options,a))},y.prototype.bindEvt=function(a,O){var H=this;return H._domHandlers_=H._domHandlers_||{},H._domHandlers_[O]=function(){"function"==typeof H["on"+O]?H["on"+O].apply(H,arguments):console.warn('[WARNING] : Missing "on'+O+'" handler.')},Q(a,i[O],H._domHandlers_[O]),U[O]&&Q(a,U[O],H._domHandlers_[O]),H},y.prototype.unbindEvt=function(a,O){var H=this;return H._domHandlers_=H._domHandlers_||{},k(a,i[O],H._domHandlers_[O]),U[O]&&k(a,U[O],H._domHandlers_[O]),delete H._domHandlers_[O],this};const w=y;function K(a,O){return this.identifier=O.identifier,this.position=O.position,this.frontPosition=O.frontPosition,this.collection=a,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(O),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=K.id,K.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}K.prototype=new w,K.constructor=K,K.id=0,K.prototype.buildEl=function(a){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},K.prototype.stylize=function(){if(this.options.dataOnly)return this;var a=this.options.fadeTime+"ms",O=function(){var a=j("borderRadius");for(var O in a)a.hasOwnProperty(O)&&(a[O]="50%");return a}(),i=h("transition","opacity",a),H={};return H.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},H.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},H.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},Z(H.el,i),"circle"===this.options.shape&&Z(H.back,O),Z(H.front,O),this.applyStyles(H),this},K.prototype.applyStyles=function(a){for(var O in this.ui)if(this.ui.hasOwnProperty(O))for(var i in a[O])this.ui[O].style[i]=a[O][i];return this},K.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},K.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},K.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},K.prototype.show=function(a){var O=this;return O.options.dataOnly||(clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.addToDom(),O.restCallback(),setTimeout((function(){O.ui.el.style.opacity=1}),0),O.showTimeout=setTimeout((function(){O.trigger("shown",O.instance),"function"==typeof a&&a.call(this)}),O.options.fadeTime)),O},K.prototype.hide=function(a){var O=this;if(O.options.dataOnly)return O;if(O.ui.el.style.opacity=O.options.restOpacity,clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.removeTimeout=setTimeout((function(){var i="dynamic"===O.options.mode?"none":"block";O.ui.el.style.display=i,"function"==typeof a&&a.call(O),O.trigger("hidden",O.instance)}),O.options.fadeTime),O.options.restJoystick){var i=O.options.restJoystick,H={};H.x=!0===i||!1!==i.x?0:O.instance.frontPosition.x,H.y=!0===i||!1!==i.y?0:O.instance.frontPosition.y,O.setPosition(a,H)}return O},K.prototype.setPosition=function(a,O){var i=this;i.frontPosition={x:O.x,y:O.y};var H=i.options.fadeTime+"ms",b={};b.front=h("transition",["transform"],H);var G={front:{}};G.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(b),i.applyStyles(G),i.restTimeout=setTimeout((function(){"function"==typeof a&&a.call(i),i.restCallback()}),i.options.fadeTime)},K.prototype.restCallback=function(){var a=this,O={};O.front=h("transition","none",""),a.applyStyles(O),a.trigger("rested",a.instance)},K.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},K.prototype.computeDirection=function(a){var O,i,H,b=a.angle.radian,G=Math.PI/4,q=Math.PI/2;if(b>G&&b<3*G&&!a.lockX?O="up":b>-G&&b<=G&&!a.lockY?O="left":b>3*-G&&b<=-G&&!a.lockX?O="down":a.lockY||(O="right"),a.lockY||(i=b>-q&&b<q?"left":"right"),a.lockX||(H=b>0?"up":"down"),a.force>this.options.threshold){var Q,k={};for(Q in this.direction)this.direction.hasOwnProperty(Q)&&(k[Q]=this.direction[Q]);var I={};for(Q in this.direction={x:i,y:H,angle:O},a.direction=this.direction,k)k[Q]===this.direction[Q]&&(I[Q]=!0);if(I.x&&I.y&&I.angle)return a;I.x&&I.y||this.trigger("plain",a),I.x||this.trigger("plain:"+i,a),I.y||this.trigger("plain:"+H,a),I.angle||this.trigger("dir dir:"+O,a)}else this.resetDirection();return a};const S=K;function f(a,O){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=a,i.id=f.id,f.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(O),"static"!==i.options.mode&&"semi"!==i.options.mode||(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);var H=getComputedStyle(i.options.zone.parentElement);return H&&"flex"===H.display&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.oh(),i.begin(),i.nipples}f.prototype=new w,f.constructor=f,f.id=0,f.prototype.prepareNipples=function(){var a=this,O=a.nipples;O.on=a.on.bind(a),O.off=a.off.bind(a),O.options=a.options,O.destroy=a.destroy.bind(a),O.ids=a.ids,O.id=a.id,O.processOnMove=a.processOnMove.bind(a),O.processOnEnd=a.processOnEnd.bind(a),O.get=function(a){if(void 0===a)return O[0];for(var i=0,H=O.length;i<H;i+=1)if(O[i].identifier===a)return O[i];return!1}},f.prototype.oh=function(){var a=this;a.bindEvt(a.options.zone,"start"),a.options.zone.style.touchAction="none",a.options.zone.style.msTouchAction="none"},f.prototype.begin=function(){var a=this,O=a.options;if("static"===O.mode){var i=a.createNipple(O.position,a.manager.getIdentifier());i.add(),a.idles.push(i)}},f.prototype.createNipple=function(a,O){var i=this,H=i.manager.scroll,b={},G=i.options,q=i.parentIsFlex?H.x:H.x+i.box.left,Q=i.parentIsFlex?H.y:H.y+i.box.top;if(a.x&&a.y)b={x:a.x-q,y:a.y-Q};else if(a.top||a.right||a.bottom||a.left){var k=document.createElement("DIV");k.style.display="hidden",k.style.top=a.top,k.style.right=a.right,k.style.bottom=a.bottom,k.style.left=a.left,k.style.position="absolute",G.zone.appendChild(k);var I=k.getBoundingClientRect();G.zone.removeChild(k),b=a,a={x:I.left+H.x,y:I.top+H.y}}var P=new S(i,{color:G.color,size:G.size,threshold:G.threshold,fadeTime:G.fadeTime,dataOnly:G.dataOnly,restJoystick:G.restJoystick,restOpacity:G.restOpacity,mode:G.mode,identifier:O,position:a,zone:G.zone,frontPosition:{x:0,y:0},shape:G.shape});return G.dataOnly||(e(P.ui.el,b),e(P.ui.front,P.frontPosition)),i.nipples.push(P),i.trigger("added "+P.identifier+":added",P),i.manager.trigger("added "+P.identifier+":added",P),i.bindNipple(P),P},f.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},f.prototype.bindNipple=function(a){var O,i=this,H=function(a,H){O=a.type+" "+H.id+":"+a.type,i.trigger(O,H)};a.on("destroyed",i.onDestroyed.bind(i)),a.on("shown hidden rested dir plain",H),a.on("dir:up dir:right dir:down dir:left",H),a.on("plain:up plain:right plain:down plain:left",H)},f.prototype.pressureFn=function(a,O,i){var H=this,b=0;clearInterval(H.pressureIntervals[i]),H.pressureIntervals[i]=setInterval(function(){var i=a.force||a.pressure||a.webkitForce||0;i!==b&&(O.trigger("pressure",i),H.trigger("pressure "+O.identifier+":pressure",i),b=i)}.bind(H),100)},f.prototype.onstart=function(a){var O=this,i=O.options,H=a;return a=I(a),O.updateBox(),F(a,(function(b){O.actives.length<i.maxNumberOfNipples?O.processOnStart(b):H.type.match(/^touch/)&&(Object.keys(O.manager.ids).forEach((function(i){if(Object.values(H.touches).findIndex((function(a){return a.identifier===i}))<0){var b=[a[0]];b.identifier=i,O.processOnEnd(b)}})),O.actives.length<i.maxNumberOfNipples&&O.processOnStart(b))})),O.manager.bindDocument(),!1},f.prototype.processOnStart=function(a){var O,i=this,b=i.options,G=i.manager.getIdentifier(a),q=a.force||a.pressure||a.webkitForce||0,Q={x:a.pageX,y:a.pageY},k=i.getOrCreate(G,Q);k.identifier!==G&&i.manager.removeIdentifier(k.identifier),k.identifier=G;var I=function(O){O.trigger("start",O),i.trigger("start "+O.id+":start",O),O.show(),q>0&&i.pressureFn(a,O,O.identifier),i.processOnMove(a)};if((O=i.idles.indexOf(k))>=0&&i.idles.splice(O,1),i.actives.push(k),i.ids.push(k.identifier),"semi"!==b.mode)I(k);else{if(!(H(Q,k.position)<=b.catchDistance))return k.destroy(),void i.processOnStart(a);I(k)}return k},f.prototype.getOrCreate=function(a,O){var i,H=this,b=H.options;return/(semi|static)/.test(b.mode)?(i=H.idles[0])?(H.idles.splice(0,1),i):"semi"===b.mode?H.createNipple(O,a):(console.warn("Coudln't find the needed nipple."),!1):i=H.createNipple(O,a)},f.prototype.processOnMove=function(a){var O=this,i=O.options,G=O.manager.getIdentifier(a),q=O.nipples.get(G),Q=O.manager.scroll;if(function(a){return isNaN(a.buttons)?0!==a.pressure:0!==a.buttons}(a)){if(!q)return console.error("Found zombie joystick with ID "+G),void O.manager.removeIdentifier(G);if(i.dynamicPage){var k=q.el.getBoundingClientRect();q.position={x:Q.x+k.left,y:Q.y+k.top}}q.identifier=G;var I=q.options.size/2,P={x:a.pageX,y:a.pageY};i.lockX&&(P.y=q.position.y),i.lockY&&(P.x=q.position.x);var e,h,j,Z,F,r,J,ma,M,C,n=H(P,q.position),D=(e=P,j=(h=q.position).x-e.x,Z=h.y-e.y,function(a){return a*(180/Math.PI)}(Math.atan2(Z,j))),U=b(D),y=n/I,w={distance:n,position:P};if("circle"===q.options.shape?(F=Math.min(n,I),J=q.position,ma=F,C={x:0,y:0},M=b(M=D),C.x=J.x-ma*Math.cos(M),C.y=J.y-ma*Math.sin(M),r=C):(r=function(a,O,i){return{x:Math.min(Math.max(a.x,O.x-i),O.x+i),y:Math.min(Math.max(a.y,O.y-i),O.y+i)}}(P,q.position,I),F=H(r,q.position)),i.follow){if(n>I){var K=P.x-r.x,S=P.y-r.y;q.position.x+=K,q.position.y+=S,q.el.style.top=q.position.y-(O.box.top+Q.y)+"px",q.el.style.left=q.position.x-(O.box.left+Q.x)+"px",n=H(P,q.position)}}else P=r,n=F;var f=P.x-q.position.x,B=P.y-q.position.y;q.frontPosition={x:f,y:B},i.dataOnly||(q.ui.front.style.transform="translate("+f+"px,"+B+"px)");var T={identifier:q.identifier,position:P,force:y,pressure:a.force||a.pressure||a.webkitForce||0,distance:n,angle:{radian:U,degree:D},vector:{x:f/I,y:-B/I},raw:w,instance:q,lockX:i.lockX,lockY:i.lockY};(T=q.computeDirection(T)).angle={radian:b(180-D),degree:180-D},q.trigger("move",T),O.trigger("move "+q.id+":move",T)}else this.processOnEnd(a)},f.prototype.processOnEnd=function(a){var O=this,i=O.options,H=O.manager.getIdentifier(a),b=O.nipples.get(H),G=O.manager.removeIdentifier(b.identifier);b&&(i.dataOnly||b.hide((function(){"dynamic"===i.mode&&(b.trigger("removed",b),O.trigger("removed "+b.id+":removed",b),O.manager.trigger("removed "+b.id+":removed",b),b.destroy())})),clearInterval(O.pressureIntervals[b.identifier]),b.resetDirection(),b.trigger("end",b),O.trigger("end "+b.id+":end",b),O.ids.indexOf(b.identifier)>=0&&O.ids.splice(O.ids.indexOf(b.identifier),1),O.actives.indexOf(b)>=0&&O.actives.splice(O.actives.indexOf(b),1),/(semi|static)/.test(i.mode)?O.idles.push(b):O.nipples.indexOf(b)>=0&&O.nipples.splice(O.nipples.indexOf(b),1),O.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(O.manager.ids[G.id]=G.identifier))},f.prototype.onDestroyed=function(a,O){var i=this;i.nipples.indexOf(O)>=0&&i.nipples.splice(i.nipples.indexOf(O),1),i.actives.indexOf(O)>=0&&i.actives.splice(i.actives.indexOf(O),1),i.idles.indexOf(O)>=0&&i.idles.splice(i.idles.indexOf(O),1),i.ids.indexOf(O.identifier)>=0&&i.ids.splice(i.ids.indexOf(O.identifier),1),i.manager.removeIdentifier(O.identifier),i.manager.unbindDocument()},f.prototype.destroy=function(){var a=this;for(var O in a.unbindEvt(a.options.zone,"start"),a.nipples.forEach((function(a){a.destroy()})),a.pressureIntervals)a.pressureIntervals.hasOwnProperty(O)&&clearInterval(a.pressureIntervals[O]);a.trigger("destroyed",a.nipples),a.manager.unbindDocument(),a.off()};const B=f;function T(a){var O=this;O.ids={},O.index=0,O.collections=[],O.scroll=P(),O.config(a),O.prepareCollections();var i=function(){var a;O.collections.forEach((function(i){i.forEach((function(i){a=i.el.getBoundingClientRect(),i.position={x:O.scroll.x+a.left,y:O.scroll.y+a.top}}))}))};Q(window,"resize",(function(){q(i)}));var H=function(){O.scroll=P()};return Q(window,"scroll",(function(){q(H)})),O.collections}T.prototype=new w,T.constructor=T,T.prototype.prepareCollections=function(){var a=this;a.collections.create=a.create.bind(a),a.collections.on=a.on.bind(a),a.collections.off=a.off.bind(a),a.collections.destroy=a.destroy.bind(a),a.collections.get=function(O){var i;return a.collections.every((function(a){return!(i=a.get(O))})),i}},T.prototype.create=function(a){return this.createCollection(a)},T.prototype.createCollection=function(a){var O=this,i=new B(O,a);return O.bindCollection(i),O.collections.push(i),i},T.prototype.bindCollection=function(a){var O,i=this,H=function(a,H){O=a.type+" "+H.id+":"+a.type,i.trigger(O,H)};a.on("destroyed",i.onDestroyed.bind(i)),a.on("shown hidden rested dir plain",H),a.on("dir:up dir:right dir:down dir:left",H),a.on("plain:up plain:right plain:down plain:left",H)},T.prototype.bindDocument=function(){var a=this;a.binded||(a.bindEvt(document,"move").bindEvt(document,"end"),a.binded=!0)},T.prototype.unbindDocument=function(a){var O=this;Object.keys(O.ids).length&&!0!==a||(O.unbindEvt(document,"move").unbindEvt(document,"end"),O.binded=!1)},T.prototype.getIdentifier=function(a){var O;return a?void 0===(O=void 0===a.identifier?a.pointerId:a.identifier)&&(O=this.latest||0):O=this.index,void 0===this.ids[O]&&(this.ids[O]=this.index,this.index+=1),this.latest=O,this.ids[O]},T.prototype.removeIdentifier=function(a){var O={};for(var i in this.ids)if(this.ids[i]===a){O.id=i,O.identifier=this.ids[i],delete this.ids[i];break}return O},T.prototype.onmove=function(a){return this.onAny("move",a),!1},T.prototype.onend=function(a){return this.onAny("end",a),!1},T.prototype.oncancel=function(a){return this.onAny("end",a),!1},T.prototype.onAny=function(a,O){var i,H=this,b="processOn"+a.charAt(0).toUpperCase()+a.slice(1);O=I(O);var G=function(a,O,i){i.ids.indexOf(O)>=0&&(i[b](a),a._found_=!0)};return F(O,(function(a){i=H.getIdentifier(a),F(H.collections,G.bind(null,a,i)),a._found_||H.removeIdentifier(i)})),!1},T.prototype.destroy=function(){var a=this;a.unbindDocument(!0),a.ids={},a.index=0,a.collections.forEach((function(a){a.destroy()})),a.off()},T.prototype.onDestroyed=function(a,O){var i=this;if(i.collections.indexOf(O)<0)return!1;i.collections.splice(i.collections.indexOf(O),1)};var A=new T;const E={create:function(a){return A.create(a)},factory:A};return O.default})(),a.exports=O()},13522:(a,O,i)=>{"use strict";const{Deflate:H,deflate:b,deflateRaw:G,gzip:q}=i(13524),{Inflate:Q,inflate:k,inflateRaw:I,ungzip:P}=i(13581),e=i(13553);a.exports.Deflate=H,a.exports.deflate=b,a.exports.deflateRaw=G,a.exports.gzip=q,a.exports.Inflate=Q,a.exports.inflate=k,a.exports.inflateRaw=I,a.exports.ungzip=P,a.exports.constants=e},13524:(a,O,i)=>{"use strict";const H=i(13529),b=i(13558),G=i(13567),q=i(13546),Q=i(13576),k=Object.prototype.toString,{Z_NO_FLUSH:I,Z_SYNC_FLUSH:P,Z_FULL_FLUSH:e,Z_FINISH:h,Z_OK:j,Z_STREAM_END:Z,Z_DEFAULT_COMPRESSION:F,Z_DEFAULT_STRATEGY:r,Z_DEFLATED:J}=i(13553);function ma(a){this.options=b.assign({level:F,method:J,Ra:16384,windowBits:15,memLevel:8,strategy:r},a||{});let O=this.options;O.raw&&O.windowBits>0?O.windowBits=-O.windowBits:O.gzip&&O.windowBits>0&&O.windowBits<16&&(O.windowBits+=16),this.err=0,this.IO="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;let i=H.deflateInit2(this.strm,O.level,O.method,O.windowBits,O.memLevel,O.strategy);if(i!==j)throw new Error(q[i]);if(O.header&&H.deflateSetHeader(this.strm,O.header),O.dictionary){let a;if(a="string"===typeof O.dictionary?G.string2buf(O.dictionary):"[object ArrayBuffer]"===k.call(O.dictionary)?new Uint8Array(O.dictionary):O.dictionary,i=H.deflateSetDictionary(this.strm,a),i!==j)throw new Error(q[i]);this._dict_set=!0}}function M(a,O){const i=new ma(O);if(i.push(a,!0),i.err)throw i.IO||q[i.err];return i.result}ma.prototype.push=function(a,O){const i=this.strm,b=this.options.Ra;let q,Q;if(this.ended)return!1;for(Q=O===~~O?O:!0===O?h:I,"string"===typeof a?i.input=G.string2buf(a):"[object ArrayBuffer]"===k.call(a)?i.input=new Uint8Array(a):i.input=a,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(b),i.next_out=0,i.avail_out=b),(Q===P||Q===e)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(q=H.deflate(i,Q),q===Z)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),q=H.deflateEnd(this.strm),this.onEnd(q),this.ended=!0,q===j;if(0!==i.avail_out){if(Q>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},ma.prototype.onData=function(a){this.chunks.push(a)},ma.prototype.onEnd=function(a){a===j&&(this.result=b.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.IO=this.strm.IO},a.exports.Deflate=ma,a.exports.deflate=M,a.exports.deflateRaw=function(a,O){return(O=O||{}).raw=!0,M(a,O)},a.exports.gzip=function(a,O){return(O=O||{}).gzip=!0,M(a,O)},a.exports.constants=i(13553)},13581:(a,O,i)=>{"use strict";const H=i(13589),b=i(13558),G=i(13567),q=i(13546),Q=i(13576),k=i(13611),I=Object.prototype.toString,{Z_NO_FLUSH:P,Z_FINISH:e,Z_OK:h,Z_STREAM_END:j,Z_NEED_DICT:Z,Z_STREAM_ERROR:F,Z_DATA_ERROR:r,Z_MEM_ERROR:J}=i(13553);function ma(a){this.options=b.assign({Ra:65536,windowBits:15,to:""},a||{});const O=this.options;O.raw&&O.windowBits>=0&&O.windowBits<16&&(O.windowBits=-O.windowBits,0===O.windowBits&&(O.windowBits=-15)),!(O.windowBits>=0&&O.windowBits<16)||a&&a.windowBits||(O.windowBits+=32),O.windowBits>15&&O.windowBits<48&&0===(15&O.windowBits)&&(O.windowBits|=15),this.err=0,this.IO="",this.ended=!1,this.chunks=[],this.strm=new Q,this.strm.avail_out=0;let i=H.inflateInit2(this.strm,O.windowBits);if(i!==h)throw new Error(q[i]);if(this.header=new k,H.inflateGetHeader(this.strm,this.header),O.dictionary&&("string"===typeof O.dictionary?O.dictionary=G.string2buf(O.dictionary):"[object ArrayBuffer]"===I.call(O.dictionary)&&(O.dictionary=new Uint8Array(O.dictionary)),O.raw&&(i=H.inflateSetDictionary(this.strm,O.dictionary),i!==h)))throw new Error(q[i])}function M(a,O){const i=new ma(O);if(i.push(a),i.err)throw i.IO||q[i.err];return i.result}ma.prototype.push=function(a,O){const i=this.strm,b=this.options.Ra,q=this.options.dictionary;let Q,k,ma;if(this.ended)return!1;for(k=O===~~O?O:!0===O?e:P,"[object ArrayBuffer]"===I.call(a)?i.input=new Uint8Array(a):i.input=a,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(b),i.next_out=0,i.avail_out=b),Q=H.inflate(i,k),Q===Z&&q&&(Q=H.inflateSetDictionary(i,q),Q===h?Q=H.inflate(i,k):Q===r&&(Q=Z));i.avail_in>0&&Q===j&&i.state.wrap>0&&0!==a[i.next_in];)H.inflateReset(i),Q=H.inflate(i,k);switch(Q){case F:case r:case Z:case J:return this.onEnd(Q),this.ended=!0,!1}if(ma=i.avail_out,i.next_out&&(0===i.avail_out||Q===j))if("string"===this.options.to){let a=G.utf8border(i.output,i.next_out),O=i.next_out-a,H=G.buf2string(i.output,a);i.next_out=O,i.avail_out=b-O,O&&i.output.set(i.output.subarray(a,a+O),0),this.onData(H)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(Q!==h||0!==ma){if(Q===j)return Q=H.inflateEnd(this.strm),this.onEnd(Q),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},ma.prototype.onData=function(a){this.chunks.push(a)},ma.prototype.onEnd=function(a){a===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=b.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.IO=this.strm.IO},a.exports.Inflate=ma,a.exports.inflate=M,a.exports.inflateRaw=function(a,O){return(O=O||{}).raw=!0,M(a,O)},a.exports.ungzip=M,a.exports.constants=i(13553)},13558:a=>{"use strict";const O=(a,O)=>Object.prototype.hasOwnProperty.call(a,O);a.exports.assign=function(a){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const H=i.shift();if(H){if("object"!==typeof H)throw new TypeError(H+"must be non-object");for(const i in H)O(H,i)&&(a[i]=H[i])}}return a},a.exports.flattenChunks=a=>{let O=0;for(let H=0,b=a.length;H<b;H++)O+=a[H].length;const i=new Uint8Array(O);for(let H=0,b=0,G=a.length;H<G;H++){let O=a[H];i.set(O,b),b+=O.length}return i}},13567:a=>{"use strict";let O=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(H){O=!1}const i=new Uint8Array(256);for(let b=0;b<256;b++)i[b]=b>=252?6:b>=248?5:b>=240?4:b>=224?3:b>=192?2:1;i[254]=i[254]=1,a.exports.string2buf=a=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(a);let O,i,H,b,G,q=a.length,Q=0;for(b=0;b<q;b++)i=a.charCodeAt(b),55296===(64512&i)&&b+1<q&&(H=a.charCodeAt(b+1),56320===(64512&H)&&(i=65536+(i-55296<<10)+(H-56320),b++)),Q+=i<128?1:i<2048?2:i<65536?3:4;for(O=new Uint8Array(Q),G=0,b=0;G<Q;b++)i=a.charCodeAt(b),55296===(64512&i)&&b+1<q&&(H=a.charCodeAt(b+1),56320===(64512&H)&&(i=65536+(i-55296<<10)+(H-56320),b++)),i<128?O[G++]=i:i<2048?(O[G++]=192|i>>>6,O[G++]=128|63&i):i<65536?(O[G++]=224|i>>>12,O[G++]=128|i>>>6&63,O[G++]=128|63&i):(O[G++]=240|i>>>18,O[G++]=128|i>>>12&63,O[G++]=128|i>>>6&63,O[G++]=128|63&i);return O};a.exports.buf2string=(a,H)=>{const b=H||a.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(a.subarray(0,H));let G,q;const Q=new Array(2*b);for(q=0,G=0;G<b;){let O=a[G++];if(O<128){Q[q++]=O;continue}let H=i[O];if(H>4)Q[q++]=65533,G+=H-1;else{for(O&=2===H?31:3===H?15:7;H>1&&G<b;)O=O<<6|63&a[G++],H--;H>1?Q[q++]=65533:O<65536?Q[q++]=O:(O-=65536,Q[q++]=55296|O>>10&1023,Q[q++]=56320|1023&O)}}return((a,i)=>{if(i<65534&&a.subarray&&O)return String.fromCharCode.apply(null,a.length===i?a:a.subarray(0,i));let H="";for(let O=0;O<i;O++)H+=String.fromCharCode(a[O]);return H})(Q,q)},a.exports.utf8border=(a,O)=>{(O=O||a.length)>a.length&&(O=a.length);let H=O-1;for(;H>=0&&128===(192&a[H]);)H--;return H<0||0===H?O:H+i[a[H]]>O?H:O}},13537:a=>{"use strict";a.exports=(a,O,i,H)=>{let b=65535&a,G=a>>>16&65535,q=0;for(;0!==i;){q=i>2e3?2e3:i,i-=q;do{b=b+O[H++]|0,G=G+b|0}while(--q);b%=65521,G%=65521}return b|G<<16}},13553:a=>{"use strict";a.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13543:a=>{"use strict";const O=new Uint32Array((()=>{let a,O=[];for(var i=0;i<256;i++){a=i;for(var H=0;H<8;H++)a=1&a?3988292384^a>>>1:a>>>1;O[i]=a}return O})());a.exports=(a,i,H,b)=>{const G=O,q=b+H;a^=-1;for(let O=b;O<q;O++)a=a>>>8^G[255&(a^i[O])];return~a}},13529:(a,O,i)=>{"use strict";const{_tr_init:H,_tr_stored_block:b,_tr_flush_block:G,_tr_tally:q,_tr_align:Q}=i(13535),k=i(13537),I=i(13543),P=i(13546),{Z_NO_FLUSH:e,Z_PARTIAL_FLUSH:h,Z_FULL_FLUSH:j,Z_FINISH:Z,Z_BLOCK:F,Z_OK:r,Z_STREAM_END:J,Z_STREAM_ERROR:ma,Z_DATA_ERROR:M,Z_BUF_ERROR:C,Z_DEFAULT_COMPRESSION:n,Z_FILTERED:D,Z_HUFFMAN_ONLY:U,Z_RLE:y,Z_FIXED:w,Z_DEFAULT_STRATEGY:K,Z_UNKNOWN:S,Z_DEFLATED:f}=i(13553),B=258,T=262,A=103,E=113,l=666,W=(a,O)=>(a.IO=P[O],O),u=a=>(a<<1)-(a>4?9:0),c=a=>{let O=a.length;for(;--O>=0;)a[O]=0};let R=(a,O,i)=>(O<<a.hash_shift^i)&a.hash_mask;const z=a=>{const O=a.state;let i=O.pending;i>a.avail_out&&(i=a.avail_out),0!==i&&(a.output.set(O.pending_buf.subarray(O.pending_out,O.pending_out+i),a.next_out),a.next_out+=i,O.pending_out+=i,a.total_out+=i,a.avail_out-=i,O.pending-=i,0===O.pending&&(O.pending_out=0))},x=(a,O)=>{G(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,O),a.block_start=a.strstart,z(a.strm)},g=(a,O)=>{a.pending_buf[a.pending++]=O},N=(a,O)=>{a.pending_buf[a.pending++]=O>>>8&255,a.pending_buf[a.pending++]=255&O},v=(a,O,i,H)=>{let b=a.avail_in;return b>H&&(b=H),0===b?0:(a.avail_in-=b,O.set(a.input.subarray(a.next_in,a.next_in+b),i),1===a.state.wrap?a.adler=k(a.adler,O,b,i):2===a.state.wrap&&(a.adler=I(a.adler,O,b,i)),a.next_in+=b,a.total_in+=b,b)},X=(a,O)=>{let i,H,b=a.max_chain_length,G=a.strstart,q=a.prev_length,Q=a.nice_match;const k=a.strstart>a.w_size-T?a.strstart-(a.w_size-T):0,I=a.window,P=a.w_mask,e=a.prev,h=a.strstart+B;let j=I[G+q-1],Z=I[G+q];a.prev_length>=a.good_match&&(b>>=2),Q>a.lookahead&&(Q=a.lookahead);do{if(i=O,I[i+q]===Z&&I[i+q-1]===j&&I[i]===I[G]&&I[++i]===I[G+1]){G+=2,i++;do{}while(I[++G]===I[++i]&&I[++G]===I[++i]&&I[++G]===I[++i]&&I[++G]===I[++i]&&I[++G]===I[++i]&&I[++G]===I[++i]&&I[++G]===I[++i]&&I[++G]===I[++i]&&G<h);if(H=B-(h-G),G=h-B,H>q){if(a.match_start=O,q=H,H>=Q)break;j=I[G+q-1],Z=I[G+q]}}}while((O=e[O&P])>k&&0!==--b);return q<=a.lookahead?q:a.lookahead},p=a=>{const O=a.w_size;let i,H,b,G,q;do{if(G=a.window_size-a.lookahead-a.strstart,a.strstart>=O+(O-T)){a.window.set(a.window.subarray(O,O+O),0),a.match_start-=O,a.strstart-=O,a.block_start-=O,H=a.hash_size,i=H;do{b=a.head[--i],a.head[i]=b>=O?b-O:0}while(--H);H=O,i=H;do{b=a.prev[--i],a.prev[i]=b>=O?b-O:0}while(--H);G+=O}if(0===a.strm.avail_in)break;if(H=v(a.strm,a.window,a.strstart+a.lookahead,G),a.lookahead+=H,a.lookahead+a.insert>=3)for(q=a.strstart-a.insert,a.ins_h=a.window[q],a.ins_h=R(a,a.ins_h,a.window[q+1]);a.insert&&(a.ins_h=R(a,a.ins_h,a.window[q+3-1]),a.prev[q&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=q,q++,a.insert--,!(a.lookahead+a.insert<3)););}while(a.lookahead<T&&0!==a.strm.avail_in)},o=(a,O)=>{let i,H;for(;;){if(a.lookahead<T){if(p(a),a.lookahead<T&&O===e)return 1;if(0===a.lookahead)break}if(i=0,a.lookahead>=3&&(a.ins_h=R(a,a.ins_h,a.window[a.strstart+3-1]),i=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==i&&a.strstart-i<=a.w_size-T&&(a.match_length=X(a,i)),a.match_length>=3)if(H=q(a,a.strstart-a.match_start,a.match_length-3),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=3){a.match_length--;do{a.strstart++,a.ins_h=R(a,a.ins_h,a.window[a.strstart+3-1]),i=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart}while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=R(a,a.ins_h,a.window[a.strstart+1]);else H=q(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(H&&(x(a,!1),0===a.strm.avail_out))return 1}return a.insert=a.strstart<2?a.strstart:2,O===Z?(x(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(x(a,!1),0===a.strm.avail_out)?1:2},d=(a,O)=>{let i,H,b;for(;;){if(a.lookahead<T){if(p(a),a.lookahead<T&&O===e)return 1;if(0===a.lookahead)break}if(i=0,a.lookahead>=3&&(a.ins_h=R(a,a.ins_h,a.window[a.strstart+3-1]),i=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=2,0!==i&&a.prev_length<a.max_lazy_match&&a.strstart-i<=a.w_size-T&&(a.match_length=X(a,i),a.match_length<=5&&(a.strategy===D||3===a.match_length&&a.strstart-a.match_start>4096)&&(a.match_length=2)),a.prev_length>=3&&a.match_length<=a.prev_length){b=a.strstart+a.lookahead-3,H=q(a,a.strstart-1-a.prev_match,a.prev_length-3),a.lookahead-=a.prev_length-1,a.prev_length-=2;do{++a.strstart<=b&&(a.ins_h=R(a,a.ins_h,a.window[a.strstart+3-1]),i=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart)}while(0!==--a.prev_length);if(a.match_available=0,a.match_length=2,a.strstart++,H&&(x(a,!1),0===a.strm.avail_out))return 1}else if(a.match_available){if(H=q(a,0,a.window[a.strstart-1]),H&&x(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return 1}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(H=q(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<2?a.strstart:2,O===Z?(x(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(x(a,!1),0===a.strm.avail_out)?1:2};function Y(a,O,i,H,b){this.good_length=a,this.max_lazy=O,this.nice_length=i,this.max_chain=H,this.func=b}const L=[new Y(0,0,0,0,((a,O)=>{let i=65535;for(i>a.pending_buf_size-5&&(i=a.pending_buf_size-5);;){if(a.lookahead<=1){if(p(a),0===a.lookahead&&O===e)return 1;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;const H=a.block_start+i;if((0===a.strstart||a.strstart>=H)&&(a.lookahead=a.strstart-H,a.strstart=H,x(a,!1),0===a.strm.avail_out))return 1;if(a.strstart-a.block_start>=a.w_size-T&&(x(a,!1),0===a.strm.avail_out))return 1}return a.insert=0,O===Z?(x(a,!0),0===a.strm.avail_out?3:4):(a.strstart>a.block_start&&(x(a,!1),a.strm.avail_out),1)})),new Y(4,4,8,4,o),new Y(4,5,16,8,o),new Y(4,6,32,32,o),new Y(4,4,16,16,d),new Y(8,16,32,32,d),new Y(8,16,128,128,d),new Y(8,32,128,256,d),new Y(32,128,258,1024,d),new Y(32,258,258,4096,d)];function s(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=f,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),c(this.dyn_ltree),c(this.dyn_dtree),c(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),c(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),c(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const t=a=>{if(!a||!a.state)return W(a,ma);a.total_in=a.total_out=0,a.data_type=S;const O=a.state;return O.pending=0,O.pending_out=0,O.wrap<0&&(O.wrap=-O.wrap),O.status=O.wrap?42:E,a.adler=2===O.wrap?0:1,O.last_flush=e,H(O),r},V=a=>{const O=t(a);var i;return O===r&&((i=a.state).window_size=2*i.w_size,c(i.head),i.max_lazy_match=L[i.level].max_lazy,i.good_match=L[i.level].good_length,i.nice_match=L[i.level].nice_length,i.max_chain_length=L[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),O},aa=(a,O,i,H,b,G)=>{if(!a)return ma;let q=1;if(O===n&&(O=6),H<0?(q=0,H=-H):H>15&&(q=2,H-=16),b<1||b>9||i!==f||H<8||H>15||O<0||O>9||G<0||G>w)return W(a,ma);8===H&&(H=9);const Q=new s;return a.state=Q,Q.strm=a,Q.wrap=q,Q.gzhead=null,Q.w_bits=H,Q.w_size=1<<Q.w_bits,Q.w_mask=Q.w_size-1,Q.hash_bits=b+7,Q.hash_size=1<<Q.hash_bits,Q.hash_mask=Q.hash_size-1,Q.hash_shift=~~((Q.hash_bits+3-1)/3),Q.window=new Uint8Array(2*Q.w_size),Q.head=new Uint16Array(Q.hash_size),Q.prev=new Uint16Array(Q.w_size),Q.lit_bufsize=1<<b+6,Q.pending_buf_size=4*Q.lit_bufsize,Q.pending_buf=new Uint8Array(Q.pending_buf_size),Q.d_buf=1*Q.lit_bufsize,Q.l_buf=3*Q.lit_bufsize,Q.level=O,Q.strategy=G,Q.method=i,V(a)};a.exports.deflateInit=(a,O)=>aa(a,O,f,15,8,K),a.exports.deflateInit2=aa,a.exports.deflateReset=V,a.exports.deflateResetKeep=t,a.exports.deflateSetHeader=(a,O)=>a&&a.state?2!==a.state.wrap?ma:(a.state.gzhead=O,r):ma,a.exports.deflate=(a,O)=>{let i,H;if(!a||!a.state||O>F||O<0)return a?W(a,ma):ma;const G=a.state;if(!a.output||!a.input&&0!==a.avail_in||G.status===l&&O!==Z)return W(a,0===a.avail_out?C:ma);G.strm=a;const k=G.last_flush;if(G.last_flush=O,42===G.status)if(2===G.wrap)a.adler=0,g(G,31),g(G,139),g(G,8),G.gzhead?(g(G,(G.gzhead.text?1:0)+(G.gzhead.hcrc?2:0)+(G.gzhead.extra?4:0)+(G.gzhead.name?8:0)+(G.gzhead.comment?16:0)),g(G,255&G.gzhead.time),g(G,G.gzhead.time>>8&255),g(G,G.gzhead.time>>16&255),g(G,G.gzhead.time>>24&255),g(G,9===G.level?2:G.strategy>=U||G.level<2?4:0),g(G,255&G.gzhead.os),G.gzhead.extra&&G.gzhead.extra.length&&(g(G,255&G.gzhead.extra.length),g(G,G.gzhead.extra.length>>8&255)),G.gzhead.hcrc&&(a.adler=I(a.adler,G.pending_buf,G.pending,0)),G.gzindex=0,G.status=69):(g(G,0),g(G,0),g(G,0),g(G,0),g(G,0),g(G,9===G.level?2:G.strategy>=U||G.level<2?4:0),g(G,3),G.status=E);else{let O=f+(G.w_bits-8<<4)<<8,i=-1;i=G.strategy>=U||G.level<2?0:G.level<6?1:6===G.level?2:3,O|=i<<6,0!==G.strstart&&(O|=32),O+=31-O%31,G.status=E,N(G,O),0!==G.strstart&&(N(G,a.adler>>>16),N(G,65535&a.adler)),a.adler=1}if(69===G.status)if(G.gzhead.extra){for(i=G.pending;G.gzindex<(65535&G.gzhead.extra.length)&&(G.pending!==G.pending_buf_size||(G.gzhead.hcrc&&G.pending>i&&(a.adler=I(a.adler,G.pending_buf,G.pending-i,i)),z(a),i=G.pending,G.pending!==G.pending_buf_size));)g(G,255&G.gzhead.extra[G.gzindex]),G.gzindex++;G.gzhead.hcrc&&G.pending>i&&(a.adler=I(a.adler,G.pending_buf,G.pending-i,i)),G.gzindex===G.gzhead.extra.length&&(G.gzindex=0,G.status=73)}else G.status=73;if(73===G.status)if(G.gzhead.name){i=G.pending;do{if(G.pending===G.pending_buf_size&&(G.gzhead.hcrc&&G.pending>i&&(a.adler=I(a.adler,G.pending_buf,G.pending-i,i)),z(a),i=G.pending,G.pending===G.pending_buf_size)){H=1;break}H=G.gzindex<G.gzhead.name.length?255&G.gzhead.name.charCodeAt(G.gzindex++):0,g(G,H)}while(0!==H);G.gzhead.hcrc&&G.pending>i&&(a.adler=I(a.adler,G.pending_buf,G.pending-i,i)),0===H&&(G.gzindex=0,G.status=91)}else G.status=91;if(91===G.status)if(G.gzhead.comment){i=G.pending;do{if(G.pending===G.pending_buf_size&&(G.gzhead.hcrc&&G.pending>i&&(a.adler=I(a.adler,G.pending_buf,G.pending-i,i)),z(a),i=G.pending,G.pending===G.pending_buf_size)){H=1;break}H=G.gzindex<G.gzhead.comment.length?255&G.gzhead.comment.charCodeAt(G.gzindex++):0,g(G,H)}while(0!==H);G.gzhead.hcrc&&G.pending>i&&(a.adler=I(a.adler,G.pending_buf,G.pending-i,i)),0===H&&(G.status=A)}else G.status=A;if(G.status===A&&(G.gzhead.hcrc?(G.pending+2>G.pending_buf_size&&z(a),G.pending+2<=G.pending_buf_size&&(g(G,255&a.adler),g(G,a.adler>>8&255),a.adler=0,G.status=E)):G.status=E),0!==G.pending){if(z(a),0===a.avail_out)return G.last_flush=-1,r}else if(0===a.avail_in&&u(O)<=u(k)&&O!==Z)return W(a,C);if(G.status===l&&0!==a.avail_in)return W(a,C);if(0!==a.avail_in||0!==G.lookahead||O!==e&&G.status!==l){let i=G.strategy===U?((a,O)=>{let i;for(;;){if(0===a.lookahead&&(p(a),0===a.lookahead)){if(O===e)return 1;break}if(a.match_length=0,i=q(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,i&&(x(a,!1),0===a.strm.avail_out))return 1}return a.insert=0,O===Z?(x(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(x(a,!1),0===a.strm.avail_out)?1:2})(G,O):G.strategy===y?((a,O)=>{let i,H,b,G;const Q=a.window;for(;;){if(a.lookahead<=B){if(p(a),a.lookahead<=B&&O===e)return 1;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=3&&a.strstart>0&&(b=a.strstart-1,H=Q[b],H===Q[++b]&&H===Q[++b]&&H===Q[++b])){G=a.strstart+B;do{}while(H===Q[++b]&&H===Q[++b]&&H===Q[++b]&&H===Q[++b]&&H===Q[++b]&&H===Q[++b]&&H===Q[++b]&&H===Q[++b]&&b<G);a.match_length=B-(G-b),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=3?(i=q(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(i=q(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),i&&(x(a,!1),0===a.strm.avail_out))return 1}return a.insert=0,O===Z?(x(a,!0),0===a.strm.avail_out?3:4):a.last_lit&&(x(a,!1),0===a.strm.avail_out)?1:2})(G,O):L[G.level].func(G,O);if(3!==i&&4!==i||(G.status=l),1===i||3===i)return 0===a.avail_out&&(G.last_flush=-1),r;if(2===i&&(O===h?Q(G):O!==F&&(b(G,0,0,!1),O===j&&(c(G.head),0===G.lookahead&&(G.strstart=0,G.block_start=0,G.insert=0))),z(a),0===a.avail_out))return G.last_flush=-1,r}return O!==Z?r:G.wrap<=0?J:(2===G.wrap?(g(G,255&a.adler),g(G,a.adler>>8&255),g(G,a.adler>>16&255),g(G,a.adler>>24&255),g(G,255&a.total_in),g(G,a.total_in>>8&255),g(G,a.total_in>>16&255),g(G,a.total_in>>24&255)):(N(G,a.adler>>>16),N(G,65535&a.adler)),z(a),G.wrap>0&&(G.wrap=-G.wrap),0!==G.pending?r:J)},a.exports.deflateEnd=a=>{if(!a||!a.state)return ma;const O=a.state.status;return 42!==O&&69!==O&&73!==O&&91!==O&&O!==A&&O!==E&&O!==l?W(a,ma):(a.state=null,O===E?W(a,M):r)},a.exports.deflateSetDictionary=(a,O)=>{let i=O.length;if(!a||!a.state)return ma;const H=a.state,b=H.wrap;if(2===b||1===b&&42!==H.status||H.lookahead)return ma;if(1===b&&(a.adler=k(a.adler,O,i,0)),H.wrap=0,i>=H.w_size){0===b&&(c(H.head),H.strstart=0,H.block_start=0,H.insert=0);let a=new Uint8Array(H.w_size);a.set(O.subarray(i-H.w_size,i),0),O=a,i=H.w_size}const G=a.avail_in,q=a.next_in,Q=a.input;for(a.avail_in=i,a.next_in=0,a.input=O,p(H);H.lookahead>=3;){let a=H.strstart,O=H.lookahead-2;do{H.ins_h=R(H,H.ins_h,H.window[a+3-1]),H.prev[a&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=a,a++}while(--O);H.strstart=a,H.lookahead=2,p(H)}return H.strstart+=H.lookahead,H.block_start=H.strstart,H.insert=H.lookahead,H.lookahead=0,H.match_length=H.prev_length=2,H.match_available=0,a.next_in=q,a.input=Q,a.avail_in=G,H.wrap=b,r},a.exports.deflateInfo="pako deflate (from Nodeca project)"},13611:a=>{"use strict";a.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13593:a=>{"use strict";a.exports=function(a,O){let i,H,b,G,q,Q,k,I,P,e,h,j,Z,F,r,J,ma,M,C,n,D,U,y,w;const K=a.state;i=a.next_in,y=a.input,H=i+(a.avail_in-5),b=a.next_out,w=a.output,G=b-(O-a.avail_out),q=b+(a.avail_out-257),Q=K.dmax,k=K.wsize,I=K.whave,P=K.wnext,e=K.window,h=K.hold,j=K.bits,Z=K.lencode,F=K.distcode,r=(1<<K.lenbits)-1,J=(1<<K.distbits)-1;a:do{j<15&&(h+=y[i++]<<j,j+=8,h+=y[i++]<<j,j+=8),ma=Z[h&r];O:for(;;){if(M=ma>>>24,h>>>=M,j-=M,M=ma>>>16&255,0===M)w[b++]=65535&ma;else{if(!(16&M)){if(0===(64&M)){ma=Z[(65535&ma)+(h&(1<<M)-1)];continue O}if(32&M){K.mode=12;break a}a.IO="invalid literal/length code",K.mode=30;break a}C=65535&ma,M&=15,M&&(j<M&&(h+=y[i++]<<j,j+=8),C+=h&(1<<M)-1,h>>>=M,j-=M),j<15&&(h+=y[i++]<<j,j+=8,h+=y[i++]<<j,j+=8),ma=F[h&J];i:for(;;){if(M=ma>>>24,h>>>=M,j-=M,M=ma>>>16&255,!(16&M)){if(0===(64&M)){ma=F[(65535&ma)+(h&(1<<M)-1)];continue i}a.IO="invalid distance code",K.mode=30;break a}if(n=65535&ma,M&=15,j<M&&(h+=y[i++]<<j,j+=8,j<M&&(h+=y[i++]<<j,j+=8)),n+=h&(1<<M)-1,n>Q){a.IO="invalid distance too far back",K.mode=30;break a}if(h>>>=M,j-=M,M=b-G,n>M){if(M=n-M,M>I&&K.sane){a.IO="invalid distance too far back",K.mode=30;break a}if(D=0,U=e,0===P){if(D+=k-M,M<C){C-=M;do{w[b++]=e[D++]}while(--M);D=b-n,U=w}}else if(P<M){if(D+=k+P-M,M-=P,M<C){C-=M;do{w[b++]=e[D++]}while(--M);if(D=0,P<C){M=P,C-=M;do{w[b++]=e[D++]}while(--M);D=b-n,U=w}}}else if(D+=P-M,M<C){C-=M;do{w[b++]=e[D++]}while(--M);D=b-n,U=w}for(;C>2;)w[b++]=U[D++],w[b++]=U[D++],w[b++]=U[D++],C-=3;C&&(w[b++]=U[D++],C>1&&(w[b++]=U[D++]))}else{D=b-n;do{w[b++]=w[D++],w[b++]=w[D++],w[b++]=w[D++],C-=3}while(C>2);C&&(w[b++]=w[D++],C>1&&(w[b++]=w[D++]))}break}}break}}while(i<H&&b<q);C=j>>3,i-=C,j-=C<<3,h&=(1<<j)-1,a.next_in=i,a.next_out=b,a.avail_in=i<H?H-i+5:5-(i-H),a.avail_out=b<q?q-b+257:257-(b-q),K.hold=h,K.bits=j}},13589:(a,O,i)=>{"use strict";const H=i(13537),b=i(13543),G=i(13593),q=i(13602),{Z_FINISH:Q,Z_BLOCK:k,Z_TREES:I,Z_OK:P,Z_STREAM_END:e,Z_NEED_DICT:h,Z_STREAM_ERROR:j,Z_DATA_ERROR:Z,Z_MEM_ERROR:F,Z_BUF_ERROR:r,Z_DEFLATED:J}=i(13553),ma=12,M=30,C=a=>(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24);function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const D=a=>{if(!a||!a.state)return j;const O=a.state;return a.total_in=a.total_out=O.total=0,a.IO="",O.wrap&&(a.adler=1&O.wrap),O.mode=1,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new Int32Array(852),O.distcode=O.distdyn=new Int32Array(592),O.sane=1,O.back=-1,P},U=a=>{if(!a||!a.state)return j;const O=a.state;return O.wsize=0,O.whave=0,O.wnext=0,D(a)},y=(a,O)=>{let i;if(!a||!a.state)return j;const H=a.state;return O<0?(i=0,O=-O):(i=1+(O>>4),O<48&&(O&=15)),O&&(O<8||O>15)?j:(null!==H.window&&H.wbits!==O&&(H.window=null),H.wrap=i,H.wbits=O,U(a))},w=(a,O)=>{if(!a)return j;const i=new n;a.state=i,i.window=null;const H=y(a,O);return H!==P&&(a.state=null),H};let K,S,f=!0;const B=a=>{if(f){K=new Int32Array(512),S=new Int32Array(32);let O=0;for(;O<144;)a.lens[O++]=8;for(;O<256;)a.lens[O++]=9;for(;O<280;)a.lens[O++]=7;for(;O<288;)a.lens[O++]=8;for(q(1,a.lens,0,288,K,0,a.work,{bits:9}),O=0;O<32;)a.lens[O++]=5;q(2,a.lens,0,32,S,0,a.work,{bits:5}),f=!1}a.lencode=K,a.lenbits=9,a.distcode=S,a.distbits=5},T=(a,O,i,H)=>{let b;const G=a.state;return null===G.window&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new Uint8Array(G.wsize)),H>=G.wsize?(G.window.set(O.subarray(i-G.wsize,i),0),G.wnext=0,G.whave=G.wsize):(b=G.wsize-G.wnext,b>H&&(b=H),G.window.set(O.subarray(i-H,i-H+b),G.wnext),(H-=b)?(G.window.set(O.subarray(i-H,i),0),G.wnext=H,G.whave=G.wsize):(G.wnext+=b,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=b))),0};a.exports.inflateReset=U,a.exports.inflateReset2=y,a.exports.inflateResetKeep=D,a.exports.inflateInit=a=>w(a,15),a.exports.inflateInit2=w,a.exports.inflate=(a,O)=>{let i,n,D,U,y,w,K,S,f,A,E,l,W,u,c,R,z,x,g,N,v,X,p=0;const o=new Uint8Array(4);let d,Y;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return j;i=a.state,i.mode===ma&&(i.mode=13),y=a.next_out,D=a.output,K=a.avail_out,U=a.next_in,n=a.input,w=a.avail_in,S=i.hold,f=i.bits,A=w,E=K,X=P;a:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;f<16;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}if(2&i.wrap&&35615===S){i.check=0,o[0]=255&S,o[1]=S>>>8&255,i.check=b(i.check,o,2,0),S=0,f=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&S)<<8)+(S>>8))%31){a.IO="incorrect header check",i.mode=M;break}if((15&S)!==J){a.IO="unknown compression method",i.mode=M;break}if(S>>>=4,f-=4,v=8+(15&S),0===i.wbits)i.wbits=v;else if(v>i.wbits){a.IO="invalid window size",i.mode=M;break}i.dmax=1<<i.wbits,a.adler=i.check=1,i.mode=512&S?10:ma,S=0,f=0;break;case 2:for(;f<16;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}if(i.flags=S,(255&i.flags)!==J){a.IO="unknown compression method",i.mode=M;break}if(57344&i.flags){a.IO="unknown header flags set",i.mode=M;break}i.head&&(i.head.text=S>>8&1),512&i.flags&&(o[0]=255&S,o[1]=S>>>8&255,i.check=b(i.check,o,2,0)),S=0,f=0,i.mode=3;case 3:for(;f<32;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}i.head&&(i.head.time=S),512&i.flags&&(o[0]=255&S,o[1]=S>>>8&255,o[2]=S>>>16&255,o[3]=S>>>24&255,i.check=b(i.check,o,4,0)),S=0,f=0,i.mode=4;case 4:for(;f<16;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}i.head&&(i.head.xflags=255&S,i.head.os=S>>8),512&i.flags&&(o[0]=255&S,o[1]=S>>>8&255,i.check=b(i.check,o,2,0)),S=0,f=0,i.mode=5;case 5:if(1024&i.flags){for(;f<16;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}i.length=S,i.head&&(i.head.extra_len=S),512&i.flags&&(o[0]=255&S,o[1]=S>>>8&255,i.check=b(i.check,o,2,0)),S=0,f=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(l=i.length,l>w&&(l=w),l&&(i.head&&(v=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(n.subarray(U,U+l),v)),512&i.flags&&(i.check=b(i.check,n,l,U)),w-=l,U+=l,i.length-=l),i.length))break a;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===w)break a;l=0;do{v=n[U+l++],i.head&&v&&i.length<65536&&(i.head.name+=String.fromCharCode(v))}while(v&&l<w);if(512&i.flags&&(i.check=b(i.check,n,l,U)),w-=l,U+=l,v)break a}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===w)break a;l=0;do{v=n[U+l++],i.head&&v&&i.length<65536&&(i.head.comment+=String.fromCharCode(v))}while(v&&l<w);if(512&i.flags&&(i.check=b(i.check,n,l,U)),w-=l,U+=l,v)break a}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;f<16;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}if(S!==(65535&i.check)){a.IO="header crc mismatch",i.mode=M;break}S=0,f=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),a.adler=i.check=0,i.mode=ma;break;case 10:for(;f<32;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}a.adler=i.check=C(S),S=0,f=0,i.mode=11;case 11:if(0===i.havedict)return a.next_out=y,a.avail_out=K,a.next_in=U,a.avail_in=w,i.hold=S,i.bits=f,h;a.adler=i.check=1,i.mode=ma;case ma:if(O===k||O===I)break a;case 13:if(i.last){S>>>=7&f,f-=7&f,i.mode=27;break}for(;f<3;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}switch(i.last=1&S,S>>>=1,f-=1,3&S){case 0:i.mode=14;break;case 1:if(B(i),i.mode=20,O===I){S>>>=2,f-=2;break a}break;case 2:i.mode=17;break;case 3:a.IO="invalid block type",i.mode=M}S>>>=2,f-=2;break;case 14:for(S>>>=7&f,f-=7&f;f<32;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}if((65535&S)!==(S>>>16^65535)){a.IO="invalid stored block lengths",i.mode=M;break}if(i.length=65535&S,S=0,f=0,i.mode=15,O===I)break a;case 15:i.mode=16;case 16:if(l=i.length,l){if(l>w&&(l=w),l>K&&(l=K),0===l)break a;D.set(n.subarray(U,U+l),y),w-=l,U+=l,K-=l,y+=l,i.length-=l;break}i.mode=ma;break;case 17:for(;f<14;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}if(i.nlen=257+(31&S),S>>>=5,f-=5,i.ndist=1+(31&S),S>>>=5,f-=5,i.ncode=4+(15&S),S>>>=4,f-=4,i.nlen>286||i.ndist>30){a.IO="too many length or distance symbols",i.mode=M;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;f<3;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}i.lens[L[i.have++]]=7&S,S>>>=3,f-=3}for(;i.have<19;)i.lens[L[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,d={bits:i.lenbits},X=q(0,i.lens,0,19,i.lencode,0,i.work,d),i.lenbits=d.bits,X){a.IO="invalid code lengths set",i.mode=M;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;p=i.lencode[S&(1<<i.lenbits)-1],c=p>>>24,R=p>>>16&255,z=65535&p,!(c<=f);){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}if(z<16)S>>>=c,f-=c,i.lens[i.have++]=z;else{if(16===z){for(Y=c+2;f<Y;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}if(S>>>=c,f-=c,0===i.have){a.IO="invalid bit length repeat",i.mode=M;break}v=i.lens[i.have-1],l=3+(3&S),S>>>=2,f-=2}else if(17===z){for(Y=c+3;f<Y;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}S>>>=c,f-=c,v=0,l=3+(7&S),S>>>=3,f-=3}else{for(Y=c+7;f<Y;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}S>>>=c,f-=c,v=0,l=11+(127&S),S>>>=7,f-=7}if(i.have+l>i.nlen+i.ndist){a.IO="invalid bit length repeat",i.mode=M;break}for(;l--;)i.lens[i.have++]=v}}if(i.mode===M)break;if(0===i.lens[256]){a.IO="invalid code -- missing end-of-block",i.mode=M;break}if(i.lenbits=9,d={bits:i.lenbits},X=q(1,i.lens,0,i.nlen,i.lencode,0,i.work,d),i.lenbits=d.bits,X){a.IO="invalid literal/lengths set",i.mode=M;break}if(i.distbits=6,i.distcode=i.distdyn,d={bits:i.distbits},X=q(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,d),i.distbits=d.bits,X){a.IO="invalid distances set",i.mode=M;break}if(i.mode=20,O===I)break a;case 20:i.mode=21;case 21:if(w>=6&&K>=258){a.next_out=y,a.avail_out=K,a.next_in=U,a.avail_in=w,i.hold=S,i.bits=f,G(a,E),y=a.next_out,D=a.output,K=a.avail_out,U=a.next_in,n=a.input,w=a.avail_in,S=i.hold,f=i.bits,i.mode===ma&&(i.back=-1);break}for(i.back=0;p=i.lencode[S&(1<<i.lenbits)-1],c=p>>>24,R=p>>>16&255,z=65535&p,!(c<=f);){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}if(R&&0===(240&R)){for(x=c,g=R,N=z;p=i.lencode[N+((S&(1<<x+g)-1)>>x)],c=p>>>24,R=p>>>16&255,z=65535&p,!(x+c<=f);){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}S>>>=x,f-=x,i.back+=x}if(S>>>=c,f-=c,i.back+=c,i.length=z,0===R){i.mode=26;break}if(32&R){i.back=-1,i.mode=ma;break}if(64&R){a.IO="invalid literal/length code",i.mode=M;break}i.extra=15&R,i.mode=22;case 22:if(i.extra){for(Y=i.extra;f<Y;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}i.length+=S&(1<<i.extra)-1,S>>>=i.extra,f-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;p=i.distcode[S&(1<<i.distbits)-1],c=p>>>24,R=p>>>16&255,z=65535&p,!(c<=f);){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}if(0===(240&R)){for(x=c,g=R,N=z;p=i.distcode[N+((S&(1<<x+g)-1)>>x)],c=p>>>24,R=p>>>16&255,z=65535&p,!(x+c<=f);){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}S>>>=x,f-=x,i.back+=x}if(S>>>=c,f-=c,i.back+=c,64&R){a.IO="invalid distance code",i.mode=M;break}i.offset=z,i.extra=15&R,i.mode=24;case 24:if(i.extra){for(Y=i.extra;f<Y;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}i.offset+=S&(1<<i.extra)-1,S>>>=i.extra,f-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){a.IO="invalid distance too far back",i.mode=M;break}i.mode=25;case 25:if(0===K)break a;if(l=E-K,i.offset>l){if(l=i.offset-l,l>i.whave&&i.sane){a.IO="invalid distance too far back",i.mode=M;break}l>i.wnext?(l-=i.wnext,W=i.wsize-l):W=i.wnext-l,l>i.length&&(l=i.length),u=i.window}else u=D,W=y-i.offset,l=i.length;l>K&&(l=K),K-=l,i.length-=l;do{D[y++]=u[W++]}while(--l);0===i.length&&(i.mode=21);break;case 26:if(0===K)break a;D[y++]=i.length,K--,i.mode=21;break;case 27:if(i.wrap){for(;f<32;){if(0===w)break a;w--,S|=n[U++]<<f,f+=8}if(E-=K,a.total_out+=E,i.total+=E,E&&(a.adler=i.check=i.flags?b(i.check,D,E,y-E):H(i.check,D,E,y-E)),E=K,(i.flags?S:C(S))!==i.check){a.IO="incorrect data check",i.mode=M;break}S=0,f=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;f<32;){if(0===w)break a;w--,S+=n[U++]<<f,f+=8}if(S!==(4294967295&i.total)){a.IO="incorrect length check",i.mode=M;break}S=0,f=0}i.mode=29;case 29:X=e;break a;case M:X=Z;break a;case 31:return F;default:return j}return a.next_out=y,a.avail_out=K,a.next_in=U,a.avail_in=w,i.hold=S,i.bits=f,(i.wsize||E!==a.avail_out&&i.mode<M&&(i.mode<27||O!==Q))&&T(a,a.output,a.next_out,E-a.avail_out)?(i.mode=31,F):(A-=a.avail_in,E-=a.avail_out,a.total_in+=A,a.total_out+=E,i.total+=E,i.wrap&&E&&(a.adler=i.check=i.flags?b(i.check,D,E,a.next_out-E):H(i.check,D,E,a.next_out-E)),a.data_type=i.bits+(i.last?64:0)+(i.mode===ma?128:0)+(20===i.mode||15===i.mode?256:0),(0===A&&0===E||O===Q)&&X===P&&(X=r),X)},a.exports.inflateEnd=a=>{if(!a||!a.state)return j;let O=a.state;return O.window&&(O.window=null),a.state=null,P},a.exports.inflateGetHeader=(a,O)=>{if(!a||!a.state)return j;const i=a.state;return 0===(2&i.wrap)?j:(i.head=O,O.done=!1,P)},a.exports.inflateSetDictionary=(a,O)=>{const i=O.length;let b,G,q;return a&&a.state?(b=a.state,0!==b.wrap&&11!==b.mode?j:11===b.mode&&(G=1,G=H(G,O,i,0),G!==b.check)?Z:(q=T(a,O,i,i),q?(b.mode=31,F):(b.havedict=1,P))):j},a.exports.inflateInfo="pako inflate (from Nodeca project)"},13602:a=>{"use strict";const O=15,i=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),H=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),b=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),G=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);a.exports=(a,q,Q,k,I,P,e,h)=>{const j=h.bits;let Z,F,r,J,ma,M,C=0,n=0,D=0,U=0,y=0,w=0,K=0,S=0,f=0,B=0,T=null,A=0;const E=new Uint16Array(16),l=new Uint16Array(16);let W,u,c,R=null,z=0;for(C=0;C<=O;C++)E[C]=0;for(n=0;n<k;n++)E[q[Q+n]]++;for(y=j,U=O;U>=1&&0===E[U];U--);if(y>U&&(y=U),0===U)return I[P++]=20971520,I[P++]=20971520,h.bits=1,0;for(D=1;D<U&&0===E[D];D++);for(y<D&&(y=D),S=1,C=1;C<=O;C++)if(S<<=1,S-=E[C],S<0)return-1;if(S>0&&(0===a||1!==U))return-1;for(l[1]=0,C=1;C<O;C++)l[C+1]=l[C]+E[C];for(n=0;n<k;n++)0!==q[Q+n]&&(e[l[q[Q+n]]++]=n);if(0===a?(T=R=e,M=19):1===a?(T=i,A-=257,R=H,z-=257,M=256):(T=b,R=G,M=-1),B=0,n=0,C=D,ma=P,w=y,K=0,r=-1,f=1<<y,J=f-1,1===a&&f>852||2===a&&f>592)return 1;for(;;){W=C-K,e[n]<M?(u=0,c=e[n]):e[n]>M?(u=R[z+e[n]],c=T[A+e[n]]):(u=96,c=0),Z=1<<C-K,F=1<<w,D=F;do{F-=Z,I[ma+(B>>K)+F]=W<<24|u<<16|c}while(0!==F);for(Z=1<<C-1;B&Z;)Z>>=1;if(0!==Z?(B&=Z-1,B+=Z):B=0,n++,0===--E[C]){if(C===U)break;C=q[Q+e[n]]}if(C>y&&(B&J)!==r){for(0===K&&(K=y),ma+=D,w=C-K,S=1<<w;w+K<U&&(S-=E[w+K],!(S<=0));)w++,S<<=1;if(f+=1<<w,1===a&&f>852||2===a&&f>592)return 1;r=B&J,I[r]=y<<24|w<<16|ma-P}}return 0!==B&&(I[ma+B]=C-K<<24|64<<16),h.bits=y,0}},13546:a=>{"use strict";a.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13535:a=>{"use strict";function O(a){let O=a.length;for(;--O>=0;)a[O]=0}const i=256,H=286,b=30,G=15,q=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Q=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),k=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),P=new Array(576);O(P);const e=new Array(60);O(e);const h=new Array(512);O(h);const j=new Array(256);O(j);const Z=new Array(29);O(Z);const F=new Array(b);function r(a,O,i,H,b){this.static_tree=a,this.extra_bits=O,this.extra_base=i,this.elems=H,this.max_length=b,this.has_stree=a&&a.length}let J,ma,M;function C(a,O){this.dyn_tree=a,this.max_code=0,this.stat_desc=O}O(F);const n=a=>a<256?h[a]:h[256+(a>>>7)],D=(a,O)=>{a.pending_buf[a.pending++]=255&O,a.pending_buf[a.pending++]=O>>>8&255},U=(a,O,i)=>{a.bi_valid>16-i?(a.bi_buf|=O<<a.bi_valid&65535,D(a,a.bi_buf),a.bi_buf=O>>16-a.bi_valid,a.bi_valid+=i-16):(a.bi_buf|=O<<a.bi_valid&65535,a.bi_valid+=i)},y=(a,O,i)=>{U(a,i[2*O],i[2*O+1])},w=(a,O)=>{let i=0;do{i|=1&a,a>>>=1,i<<=1}while(--O>0);return i>>>1},K=(a,O,i)=>{const H=new Array(16);let b,q,Q=0;for(b=1;b<=G;b++)H[b]=Q=Q+i[b-1]<<1;for(q=0;q<=O;q++){let O=a[2*q+1];0!==O&&(a[2*q]=w(H[O]++,O))}},S=a=>{let O;for(O=0;O<H;O++)a.dyn_ltree[2*O]=0;for(O=0;O<b;O++)a.dyn_dtree[2*O]=0;for(O=0;O<19;O++)a.bl_tree[2*O]=0;a.dyn_ltree[512]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0},f=a=>{a.bi_valid>8?D(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0},B=(a,O,i,H)=>{const b=2*O,G=2*i;return a[b]<a[G]||a[b]===a[G]&&H[O]<=H[i]},T=(a,O,i)=>{const H=a.heap[i];let b=i<<1;for(;b<=a.heap_len&&(b<a.heap_len&&B(O,a.heap[b+1],a.heap[b],a.depth)&&b++,!B(O,H,a.heap[b],a.depth));)a.heap[i]=a.heap[b],i=b,b<<=1;a.heap[i]=H},A=(a,O,H)=>{let b,G,k,I,P=0;if(0!==a.last_lit)do{b=a.pending_buf[a.d_buf+2*P]<<8|a.pending_buf[a.d_buf+2*P+1],G=a.pending_buf[a.l_buf+P],P++,0===b?y(a,G,O):(k=j[G],y(a,k+i+1,O),I=q[k],0!==I&&(G-=Z[k],U(a,G,I)),b--,k=n(b),y(a,k,H),I=Q[k],0!==I&&(b-=F[k],U(a,b,I)))}while(P<a.last_lit);y(a,256,O)},E=(a,O)=>{const i=O.dyn_tree,H=O.stat_desc.static_tree,b=O.stat_desc.has_stree,q=O.stat_desc.elems;let Q,k,I,P=-1;for(a.heap_len=0,a.heap_max=573,Q=0;Q<q;Q++)0!==i[2*Q]?(a.heap[++a.heap_len]=P=Q,a.depth[Q]=0):i[2*Q+1]=0;for(;a.heap_len<2;)I=a.heap[++a.heap_len]=P<2?++P:0,i[2*I]=1,a.depth[I]=0,a.opt_len--,b&&(a.static_len-=H[2*I+1]);for(O.max_code=P,Q=a.heap_len>>1;Q>=1;Q--)T(a,i,Q);I=q;do{Q=a.heap[1],a.heap[1]=a.heap[a.heap_len--],T(a,i,1),k=a.heap[1],a.heap[--a.heap_max]=Q,a.heap[--a.heap_max]=k,i[2*I]=i[2*Q]+i[2*k],a.depth[I]=(a.depth[Q]>=a.depth[k]?a.depth[Q]:a.depth[k])+1,i[2*Q+1]=i[2*k+1]=I,a.heap[1]=I++,T(a,i,1)}while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],((a,O)=>{const i=O.dyn_tree,H=O.max_code,b=O.stat_desc.static_tree,q=O.stat_desc.has_stree,Q=O.stat_desc.extra_bits,k=O.stat_desc.extra_base,I=O.stat_desc.max_length;let P,e,h,j,Z,F,r=0;for(j=0;j<=G;j++)a.bl_count[j]=0;for(i[2*a.heap[a.heap_max]+1]=0,P=a.heap_max+1;P<573;P++)e=a.heap[P],j=i[2*i[2*e+1]+1]+1,j>I&&(j=I,r++),i[2*e+1]=j,e>H||(a.bl_count[j]++,Z=0,e>=k&&(Z=Q[e-k]),F=i[2*e],a.opt_len+=F*(j+Z),q&&(a.static_len+=F*(b[2*e+1]+Z)));if(0!==r){do{for(j=I-1;0===a.bl_count[j];)j--;a.bl_count[j]--,a.bl_count[j+1]+=2,a.bl_count[I]--,r-=2}while(r>0);for(j=I;0!==j;j--)for(e=a.bl_count[j];0!==e;)h=a.heap[--P],h>H||(i[2*h+1]!==j&&(a.opt_len+=(j-i[2*h+1])*i[2*h],i[2*h+1]=j),e--)}})(a,O),K(i,P,a.bl_count)},l=(a,O,i)=>{let H,b,G=-1,q=O[1],Q=0,k=7,I=4;for(0===q&&(k=138,I=3),O[2*(i+1)+1]=65535,H=0;H<=i;H++)b=q,q=O[2*(H+1)+1],++Q<k&&b===q||(Q<I?a.bl_tree[2*b]+=Q:0!==b?(b!==G&&a.bl_tree[2*b]++,a.bl_tree[32]++):Q<=10?a.bl_tree[34]++:a.bl_tree[36]++,Q=0,G=b,0===q?(k=138,I=3):b===q?(k=6,I=3):(k=7,I=4))},W=(a,O,i)=>{let H,b,G=-1,q=O[1],Q=0,k=7,I=4;for(0===q&&(k=138,I=3),H=0;H<=i;H++)if(b=q,q=O[2*(H+1)+1],!(++Q<k&&b===q)){if(Q<I)do{y(a,b,a.bl_tree)}while(0!==--Q);else 0!==b?(b!==G&&(y(a,b,a.bl_tree),Q--),y(a,16,a.bl_tree),U(a,Q-3,2)):Q<=10?(y(a,17,a.bl_tree),U(a,Q-3,3)):(y(a,18,a.bl_tree),U(a,Q-11,7));Q=0,G=b,0===q?(k=138,I=3):b===q?(k=6,I=3):(k=7,I=4)}};let u=!1;const c=(a,O,i,H)=>{U(a,0+(H?1:0),3),((a,O,i,H)=>{f(a),H&&(D(a,i),D(a,~i)),a.pending_buf.set(a.window.subarray(O,O+i),a.pending),a.pending+=i})(a,O,i,!0)};a.exports._tr_init=a=>{u||((()=>{let a,O,i,I,C;const n=new Array(16);for(i=0,I=0;I<28;I++)for(Z[I]=i,a=0;a<1<<q[I];a++)j[i++]=I;for(j[i-1]=I,C=0,I=0;I<16;I++)for(F[I]=C,a=0;a<1<<Q[I];a++)h[C++]=I;for(C>>=7;I<b;I++)for(F[I]=C<<7,a=0;a<1<<Q[I]-7;a++)h[256+C++]=I;for(O=0;O<=G;O++)n[O]=0;for(a=0;a<=143;)P[2*a+1]=8,a++,n[8]++;for(;a<=255;)P[2*a+1]=9,a++,n[9]++;for(;a<=279;)P[2*a+1]=7,a++,n[7]++;for(;a<=287;)P[2*a+1]=8,a++,n[8]++;for(K(P,287,n),a=0;a<b;a++)e[2*a+1]=5,e[2*a]=w(a,5);J=new r(P,q,257,H,G),ma=new r(e,Q,0,b,G),M=new r(new Array(0),k,0,19,7)})(),u=!0),a.l_desc=new C(a.dyn_ltree,J),a.d_desc=new C(a.dyn_dtree,ma),a.bl_desc=new C(a.bl_tree,M),a.bi_buf=0,a.bi_valid=0,S(a)},a.exports._tr_stored_block=c,a.exports._tr_flush_block=(a,O,H,b)=>{let G,q,Q=0;a.level>0?(2===a.strm.data_type&&(a.strm.data_type=(a=>{let O,H=4093624447;for(O=0;O<=31;O++,H>>>=1)if(1&H&&0!==a.dyn_ltree[2*O])return 0;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return 1;for(O=32;O<i;O++)if(0!==a.dyn_ltree[2*O])return 1;return 0})(a)),E(a,a.l_desc),E(a,a.d_desc),Q=(a=>{let O;for(l(a,a.dyn_ltree,a.l_desc.max_code),l(a,a.dyn_dtree,a.d_desc.max_code),E(a,a.bl_desc),O=18;O>=3&&0===a.bl_tree[2*I[O]+1];O--);return a.opt_len+=3*(O+1)+5+5+4,O})(a),G=a.opt_len+3+7>>>3,q=a.static_len+3+7>>>3,q<=G&&(G=q)):G=q=H+5,H+4<=G&&-1!==O?c(a,O,H,b):4===a.strategy||q===G?(U(a,2+(b?1:0),3),A(a,P,e)):(U(a,4+(b?1:0),3),((a,O,i,H)=>{let b;for(U(a,O-257,5),U(a,i-1,5),U(a,H-4,4),b=0;b<H;b++)U(a,a.bl_tree[2*I[b]+1],3);W(a,a.dyn_ltree,O-1),W(a,a.dyn_dtree,i-1)})(a,a.l_desc.max_code+1,a.d_desc.max_code+1,Q+1),A(a,a.dyn_ltree,a.dyn_dtree)),S(a),b&&f(a)},a.exports._tr_tally=(a,O,H)=>(a.pending_buf[a.d_buf+2*a.last_lit]=O>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&O,a.pending_buf[a.l_buf+a.last_lit]=255&H,a.last_lit++,0===O?a.dyn_ltree[2*H]++:(a.matches++,O--,a.dyn_ltree[2*(j[H]+i+1)]++,a.dyn_dtree[2*n(O)]++),a.last_lit===a.lit_bufsize-1),a.exports._tr_align=a=>{U(a,2,3),y(a,256,P),(a=>{16===a.bi_valid?(D(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)})(a)}},13576:a=>{"use strict";a.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.IO="",this.state=null,this.data_type=2,this.adler=0}},13205:a=>{function O(a,O,i){for(var H=a.length,b=-1/0,G=1/0,q=0;q<H;q++){var Q=(i[0][q]-a[q])/O[q],k=(i[1][q]-a[q])/O[q];if(Q>k){var I=Q;Q=k,k=I}if(k<b||Q>G)return 1/0;Q>b&&(b=Q),k<G&&(G=k)}return b>G?1/0:b}a.exports=function(a,i,H,b){var G=O(i,H,b);if(G===1/0)a=null;else{a=a||[];for(var q=0;q<i.length;q++)a[q]=i[q]+H[q]*G}return a},a.exports.distance=O},14582:(a,O,i)=>{"use strict";i.d(O,{b:()=>q});var H=i(27);const b=H.useLayoutEffect;const G=function(a){var O=(0,H.useRef)(a);return b((function(){O.current=a})),O};var q=function(a){var O=G(a);(0,H.qO)((function(){var a=function(a){var i;if(null!=O.current&&(i=O.current(a)),a.defaultPrevented&&(a.returnValue=""),"string"===typeof i)return a.returnValue=i,i};return window.addEventListener("beforeunload",a),function(){window.removeEventListener("beforeunload",a)}}),[])}},14540:(a,O,i)=>{"use strict";var H=i(14544),b=Array.prototype.concat,G=Array.prototype.slice,q=a.exports=function(a){for(var O=[],i=0,q=a.length;i<q;i++){var Q=a[i];H(Q)?O=b.call(O,G.call(Q)):O.push(Q)}return O};q.wrap=function(a){return function(){return a(q(arguments))}}},14544:a=>{a.exports=function(a){return!(!a||"string"===typeof a)&&(a instanceof Array||Array.isArray(a)||a.length>=0&&(a.splice instanceof Function||Object.getOwnPropertyDescriptor(a,a.length-1)&&"String"!==a.constructor.name))}},13486:(a,O,i)=>{var H=i(13489);function b(a){for(var O,i,b=0,G=a.length,q=0;q<a.length;){for(O=a[q],i=0;q<G&&a[q]===O;)++q,++i;b+=H.log2(i)/7|0,b+=H.log2(O>>>0)/7|0,b+=2}return b}O.size=b,O.encode=function(a,O){O||(O=new Uint8Array(b(a)));for(var i,H,G=0,q=O.length,Q=0;Q<a.length;){for(i=a[Q],H=0;Q<a.length&&a[Q]===i;)++Q,++H;for(;G<q&&H>=128;)O[G++]=128+(127&H),H>>>=7;if(G>=q)throw new Error("RLE buffer overflow");for(O[G++]=H,i>>>=0;G<q&&i>=128;)O[G++]=128+(127&i),i>>>=7;if(G>=q)throw new Error("RLE buffer overflow");O[G++]=i}return O},O.decode=function(a,O){for(var i,H,b,G,q=O.length,Q=a.length,k=0,I=0;I<Q;){for(i=0,H=0;I<Q&&a[I]>=128;)i+=(127&a[I++])<<H,H+=7;if(i+=a[I++]<<H,I>=Q)throw new Error("RLE buffer underrun");if(k+i>q)throw new Error("Chunk buffer overflow");for(b=0,H=0;I<Q&&a[I]>=128;)b+=(127&a[I++])<<H,H+=7;if(I>=Q)throw new Error("RLE buffer underrun");for(b+=a[I++]<<H,G=0;G<i;++G)O[k++]=b}return O}},13489:(a,O)=>{"use strict";function i(a){var O=32;return(a&=-a)&&O--,65535&a&&(O-=16),16711935&a&&(O-=8),252645135&a&&(O-=4),858993459&a&&(O-=2),1431655765&a&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(a){return(a>0)-(a<0)},O.abs=function(a){var O=a>>31;return(a^O)-O},O.min=function(a,O){return O^(a^O)&-(a<O)},O.max=function(a,O){return a^(a^O)&-(a<O)},O.isPow2=function(a){return!(a&a-1)&&!!a},O.log2=function(a){var O,i;return O=(a>65535)<<4,O|=i=((a>>>=O)>255)<<3,O|=i=((a>>>=i)>15)<<2,(O|=i=((a>>>=i)>3)<<1)|(a>>>=i)>>1},O.log10=function(a){return a>=1e9?9:a>=1e8?8:a>=1e7?7:a>=1e6?6:a>=1e5?5:a>=1e4?4:a>=1e3?3:a>=100?2:a>=10?1:0},O.popCount=function(a){return 16843009*((a=(858993459&(a-=a>>>1&1431655765))+(a>>>2&858993459))+(a>>>4)&252645135)>>>24},O.countTrailingZeros=i,O.nextPow2=function(a){return a+=0===a,--a,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,(a|=a>>>16)+1},O.prevPow2=function(a){return a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,(a|=a>>>16)-(a>>>1)},O.parity=function(a){return a^=a>>>16,a^=a>>>8,a^=a>>>4,27030>>>(a&=15)&1};var H=new Array(256);!function(a){for(var O=0;O<256;++O){var i=O,H=O,b=7;for(i>>>=1;i;i>>>=1)H<<=1,H|=1&i,--b;a[O]=H<<b&255}}(H),O.reverse=function(a){return H[255&a]<<24|H[a>>>8&255]<<16|H[a>>>16&255]<<8|H[a>>>24&255]},O.interleave2=function(a,O){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a&=65535)|a<<8))|a<<4))|a<<2))|a<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(a,O){return(a=65535&((a=16711935&((a=252645135&((a=858993459&((a=a>>>O&1431655765)|a>>>1))|a>>>2))|a>>>4))|a>>>16))<<16>>16},O.interleave3=function(a,O,i){return a=1227133513&((a=3272356035&((a=251719695&((a=4278190335&((a&=1023)|a<<16))|a<<8))|a<<4))|a<<2),(a|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},O.deinterleave3=function(a,O){return(a=1023&((a=4278190335&((a=251719695&((a=3272356035&((a=a>>>O&1227133513)|a>>>2))|a>>>4))|a>>>8))|a>>>16))<<22>>22},O.nextCombination=function(a){var O=a|a-1;return O+1|(~O&-~O)-1>>>i(a)+1}},13515:a=>{"use strict";a.exports=function(a,O,i,H){var b=self||window;try{try{var G;try{G=new b.Blob([a])}catch(I){(G=new(b.BlobBuilder||b.WebKitBlobBuilder||b.MozBlobBuilder||b.MSBlobBuilder)).append(a),G=G.getBlob()}var q=b.URL||b.webkitURL,Q=q.createObjectURL(G),k=new b[O](Q,i);return q.revokeObjectURL(Q),k}catch(I){return new b[O]("data:application/javascript,".concat(encodeURIComponent(a)),i)}}catch(I){if(!H)throw Error("Inline worker is not supported");return new b[O](H,i)}}},13194:(a,O,i)=>{"use strict";function H(a,O,i,H,b){var G={};return Object.keys(H).forEach((function(a){G[a]=H[a]})),G.enumerable=!!G.enumerable,G.configurable=!!G.configurable,("value"in G||G.initializer)&&(G.writable=!0),G=i.slice().reverse().reduce((function(i,H){return H(a,O,i)||i}),G),b&&void 0!==G.initializer&&(G.value=G.initializer?G.initializer.call(b):void 0,G.initializer=void 0),void 0===G.initializer&&(Object.defineProperty(a,O,G),G=null),G}i.d(O,{b:()=>H})},13188:(a,O,i)=>{"use strict";function H(a,O,i,H){i&&Object.defineProperty(a,O,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(H):void 0})}i.d(O,{e:()=>H})},14576:(a,O,i)=>{"use strict";i.d(O,{b:()=>q,e:()=>e,g:()=>Q,k:()=>G,m:()=>k,q:()=>b,t:()=>I,v:()=>P});var H=i(12613);class b{constructor(){this._easingMode=b.EASINGMODE_EASEIN}setEasingMode(a){const O=Math.min(Math.max(a,0),2);this._easingMode=O}getEasingMode(){return this._easingMode}easeInCore(a){throw new Error("You must implement this method")}ease(a){switch(this._easingMode){case b.EASINGMODE_EASEIN:return this.easeInCore(a);case b.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-a)}return a>=.5?.5*(1-this.easeInCore(2*(1-a)))+.5:.5*this.easeInCore(2*a)}}b.EASINGMODE_EASEIN=0,b.EASINGMODE_EASEOUT=1,b.EASINGMODE_EASEINOUT=2;class G extends b{easeInCore(a){return a=Math.max(0,Math.min(1,a)),1-Math.sqrt(1-a*a)}}class q extends b{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=a}easeInCore(a){const O=Math.max(0,this.amplitude);return Math.pow(a,3)-a*O*Math.sin(3.141592653589793*a)}}class Q extends b{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=a,this.bounciness=O}easeInCore(a){const O=Math.max(0,this.bounces);let i=this.bounciness;i<=1&&(i=1.001);const H=Math.pow(i,O),b=1-i,G=(1-H)/b+.5*H,q=a*G,Q=Math.log(-q*(1-i)+1)/Math.log(i),k=Math.floor(Q),I=k+1,P=(1-Math.pow(i,k))/(b*G),e=.5*(P+(1-Math.pow(i,I))/(b*G)),h=a-e,j=e-P;return-Math.pow(1/i,O-k)/(j*j)*(h-j)*(h+j)}}class k extends b{easeInCore(a){return a*a*a}}class I extends b{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=a,this.springiness=O}easeInCore(a){let O;const i=Math.max(0,this.oscillations),H=Math.max(0,this.springiness);return O=0==H?a:(Math.exp(H*a)-1)/(Math.exp(H)-1),O*Math.sin((6.283185307179586*i+1.5707963267948966)*a)}}class P extends b{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=a}easeInCore(a){return this.exponent<=0?a:(Math.exp(this.exponent*a)-1)/(Math.exp(this.exponent)-1)}}class e extends b{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=a,this.y1=O,this.x2=i,this.y2=H}easeInCore(a){return H.c.Interpolate(a,this.x1,this.y1,this.x2,this.y2)}}},14057:(a,O,i)=>{"use strict";i.d(O,{d:()=>q});var H=i(12395),b=i(12403),G=i(12820);class q extends G.c{get _matrix(){return this._compose(),this.kj}set _matrix(a){(a.updateFlag!==this.kj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.kj.q(a),this._markAsDirtyAndDecompose())}constructor(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(a,O.Ua(),!1),this.name=a,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=O,this.kj=(null===b||void 0===b?void 0:b.clone())??H.Matrix.Identity(),this._restMatrix=G??this.kj.clone(),this._bindMatrix=q??this.kj.clone(),this._index=Q,this._absoluteMatrix=new H.Matrix,this._absoluteBindMatrix=new H.Matrix,this._absoluteInverseBindMatrix=new H.Matrix,this._finalMatrix=new H.Matrix,O.bones.push(this),this.setParent(i,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(a){this.setParent(a)}setParent(a){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==a){if(this.parent){const a=this.parent.children.indexOf(this);-1!==a&&this.parent.children.splice(a,1)}this._parentNode=a,this.parent&&this.parent.children.push(this),O&&this._updateAbsoluteBindMatrices(),this.aP()}}getLocalMatrix(){return this._compose(),this.kj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(a){this._restMatrix.q(a)}setRestPose(a){this.setRestMatrix(a)}getBindPose(){return this.getBindMatrix()}setBindMatrix(a){this.Ub(a)}setBindPose(a){this.setBindMatrix(a)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const a=H.TmpVectors.ZO[0],O=H.TmpVectors.Quaternion[0],i=H.TmpVectors.ZO[1];this.getRestMatrix().decompose(a,O,i),this._linkedTransformNode.position.q(i),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??H.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.q(O),this._linkedTransformNode.Bb.q(a)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(a){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=a,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Hk}set position(a){this._decompose(),this.Hk.q(a),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(a){this.setRotation(a)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(a){this.setRotationQuaternion(a)}get Bb(){return this.getScale()}set Bb(a){this.setScale(a)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=H.ZO.Zero(),this._localRotation=H.Quaternion.Zero(),this.Hk=H.ZO.Zero()),this.kj.decompose(this._localScaling,this._localRotation,this.Hk))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,H.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Hk,this.kj)):this._needToCompose=!1)}Ub(a){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.q(a),O&&this._updateAbsoluteBindMatrices(),i?this._matrix=a:this.aP()}_updateAbsoluteBindMatrices(a){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(a||(a=this._bindMatrix),this.parent?a.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.q(a),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),O)for(let i=0;i<this.children.length;i++)this.children[i]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}aP(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.aP(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.aP(),this._needToDecompose=!0}_updatePosition(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const G=this.getLocalMatrix();if(0==O)b?(G.addAtIndex(12,a.x),G.addAtIndex(13,a.y),G.addAtIndex(14,a.z)):G.setTranslationFromFloats(a.x,a.y,a.z);else{let O=null;i&&(O=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Q=q._TmpMats[0],k=q._TmpVecs[0];this.parent?i&&O?(Q.q(this.parent.getAbsoluteMatrix()),Q.multiplyToRef(O,Q)):Q.q(this.parent.getAbsoluteMatrix()):H.Matrix.IdentityToRef(Q),b&&Q.setTranslationFromFloats(0,0,0),Q.invert(),H.ZO.TransformCoordinatesToRef(a,Q,k),b?(G.addAtIndex(12,k.x),G.addAtIndex(13,k.y),G.addAtIndex(14,k.z)):G.setTranslationFromFloats(k.x,k.y,k.z)}this._markAsDirtyAndDecompose()}translate(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this._updatePosition(a,O,i,!0)}setPosition(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this._updatePosition(a,O,i,!1)}setAbsolutePosition(a,O){this.setPosition(a,1,O)}scale(a,O,i){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const G=this.getLocalMatrix(),Q=q._TmpMats[0];H.Matrix.ScalingToRef(a,O,i,Q),Q.multiplyToRef(G,G),Q.invert();for(const H of this.children){const b=H.getLocalMatrix();b.multiplyToRef(Q,b),b.multiplyAtIndex(12,a),b.multiplyAtIndex(13,O),b.multiplyAtIndex(14,i),H._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),b)for(const H of this.children)H.scale(a,O,i,b)}setScale(a){this._decompose(),this._localScaling.q(a),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(a){this._decompose(),a.q(this._localScaling)}setYawPitchRoll(a,O,i){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4?arguments[4]:void 0;if(0===b){const Q=q._TmpQuat;return H.Quaternion.RotationYawPitchRollToRef(a,O,i,Q),void this.setRotationQuaternion(Q,b,G)}const Q=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Q,G))return;const k=q._TmpMats[1];H.Matrix.RotationYawPitchRollToRef(a,O,i,k),Q.multiplyToRef(k,k),this._rotateWithMatrix(k,b,G)}rotate(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,b=arguments.length>3?arguments[3]:void 0;const G=q._TmpMats[0];G.setTranslationFromFloats(0,0,0),H.Matrix.RotationAxisToRef(a,O,G),this._rotateWithMatrix(G,i,b)}setAxisAngle(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,b=arguments.length>3?arguments[3]:void 0;if(0===i){const G=q._TmpQuat;return H.Quaternion.RotationAxisToRef(a,O,G),void this.setRotationQuaternion(G,i,b)}const G=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(G,b))return;const Q=q._TmpMats[1];H.Matrix.RotationAxisToRef(a,O,Q),G.multiplyToRef(Q,Q),this._rotateWithMatrix(Q,i,b)}setRotation(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(a.y,a.x,a.z,O,i)}setRotationQuaternion(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(0===O)return this._decompose(),this._localRotation.q(a),void this._markAsDirtyAndCompose();const b=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(b,i))return;const G=q._TmpMats[1];H.Matrix.FromQuaternionToRef(a,G),b.multiplyToRef(G,G),this._rotateWithMatrix(G,O,i)}setRotationMatrix(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(0===O){const b=q._TmpQuat;return H.Quaternion.FromRotationMatrixToRef(a,b),void this.setRotationQuaternion(b,O,i)}const b=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(b,i))return;const G=q._TmpMats[1];G.q(a),b.multiplyToRef(a,G),this._rotateWithMatrix(G,O,i)}_rotateWithMatrix(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;const H=this.getLocalMatrix(),b=H.m[12],G=H.m[13],Q=H.m[14],k=this.getParent(),I=q._TmpMats[3],P=q._TmpMats[4];k&&1==O?(i?(I.q(i.getWorldMatrix()),k.getAbsoluteMatrix().multiplyToRef(I,I)):I.q(k.getAbsoluteMatrix()),P.q(I),P.invert(),H.multiplyToRef(I,H),H.multiplyToRef(a,H),H.multiplyToRef(P,H)):1==O&&i?(I.q(i.getWorldMatrix()),P.q(I),P.invert(),H.multiplyToRef(I,H),H.multiplyToRef(a,H),H.multiplyToRef(P,H)):H.multiplyToRef(a,H),H.setTranslationFromFloats(b,G,Q),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(a,O){const i=q._TmpMats[2];return a.q(this.getAbsoluteMatrix()),O?(a.multiplyToRef(O.getWorldMatrix(),a),H.Matrix.ScalingToRef(O.Bb.x,O.Bb.y,O.Bb.z,i)):H.Matrix.IdentityToRef(i),a.invert(),!isNaN(a.m[0])&&(i.multiplyAtIndex(0,this._scalingDeterminant),a.multiplyToRef(i,a),!0)}Hb(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=H.ZO.Zero();return this.getPositionToRef(a,O,i),i}getPositionToRef(){let a=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const a=this.getLocalMatrix();O.x=a.m[12],O.y=a.m[13],O.z=a.m[14]}else{let i=null;a&&(i=a.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let H=q._TmpMats[0];a&&i?(H.q(this.getAbsoluteMatrix()),H.multiplyToRef(i,H)):H=this.getAbsoluteMatrix(),O.x=H.m[12],O.y=H.m[13],O.z=H.m[14]}}getAbsolutePosition(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=H.ZO.Zero();return this.getPositionToRef(1,a,O),O}getAbsolutePositionToRef(a,O){this.getPositionToRef(1,a,O)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.kj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.q(this.kj);const a=this._skeleton.getPoseMatrix();a&&this._absoluteMatrix.multiplyToRef(a,this._absoluteMatrix)}const a=this.children,O=a.length;for(let i=0;i<O;i++)a[i].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Tk(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=H.ZO.Zero();return this.getDirectionToRef(a,O,i),i}getDirectionToRef(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,b=null;O&&(b=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=q._TmpMats[0];G.q(this.getAbsoluteMatrix()),O&&b&&G.multiplyToRef(b,G),H.ZO.TransformNormalToRef(a,G,i),i.normalize()}getRotation(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=H.ZO.Zero();return this.getRotationToRef(a,O,i),i}getRotationToRef(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;const H=q._TmpQuat;this.getRotationQuaternionToRef(a,O,H),H.toEulerAnglesToRef(i)}getRotationQuaternion(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=H.Quaternion.Identity();return this.getRotationQuaternionToRef(a,O,i),i}getRotationQuaternionToRef(){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),O.q(this._localRotation);else{const i=q._TmpMats[0],H=this.getAbsoluteMatrix();a?H.multiplyToRef(a.getWorldMatrix(),i):i.q(H),i.multiplyAtIndex(0,this._scalingDeterminant),i.multiplyAtIndex(1,this._scalingDeterminant),i.multiplyAtIndex(2,this._scalingDeterminant),i.decompose(void 0,O,void 0)}}getRotationMatrix(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1?arguments[1]:void 0;const i=H.Matrix.Identity();return this.getRotationMatrixToRef(a,O,i),i}getRotationMatrixToRef(){let a=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(O);else{const i=q._TmpMats[0],H=this.getAbsoluteMatrix();a?H.multiplyToRef(a.getWorldMatrix(),i):i.q(H),i.multiplyAtIndex(0,this._scalingDeterminant),i.multiplyAtIndex(1,this._scalingDeterminant),i.multiplyAtIndex(2,this._scalingDeterminant),i.getRotationMatrixToRef(O)}}getAbsolutePositionFromLocal(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=H.ZO.Zero();return this.getAbsolutePositionFromLocalToRef(a,O,i),i}getAbsolutePositionFromLocalToRef(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,b=null;O&&(b=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=q._TmpMats[0];G.q(this.getAbsoluteMatrix()),O&&b&&G.multiplyToRef(b,G),H.ZO.TransformCoordinatesToRef(a,G,i)}getLocalPositionFromAbsolute(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=H.ZO.Zero();return this.getLocalPositionFromAbsoluteToRef(a,O,i),i}getLocalPositionFromAbsoluteToRef(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,b=null;O&&(b=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=q._TmpMats[0];G.q(this.getAbsoluteMatrix()),O&&b&&G.multiplyToRef(b,G),G.invert(),H.ZO.TransformCoordinatesToRef(a,G,i)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const a=this._skeleton.bones.indexOf(this);if(-1!==a&&this._skeleton.bones.splice(a,1),this._parentNode&&this._parentNode.children){const a=this._parentNode.children,O=a.indexOf(this);-1!==O&&a.splice(O,1)}super.dispose()}}q._TmpVecs=(0,b.e)(2,H.ZO.Zero),q._TmpQuat=H.Quaternion.Identity(),q._TmpMats=(0,b.e)(5,H.Matrix.Identity)},14572:(a,O,i)=>{"use strict";i.d(O,{d:()=>E});var H=i(12375),b=i(12384),G=i(12193),q=i(12395),Q=i(12412),k=i(12820),I=i(12841),P=i(12689),e=i(12218),h=i(12397);class j{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(a){this._zoomStopsAnimation=a}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(a){this._idleRotationSpeed=a}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(a){this._idleRotationWaitTime=a}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(a){this._idleRotationSpinupTime=a}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(a){this._attachedCamera=a;const O=this._attachedCamera.Ua();this._onPrePointerObservableObserver=O.onPrePointerObservable.add((a=>{a.type!==P.c.POINTERDOWN?a.type===P.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const a=e.c.Now;let O=0;null!=this._lastFrameTime&&(O=a-this._lastFrameTime),this._lastFrameTime=a,this._applyUserInteraction();const i=a-this._lastInteractionTime-this._idleRotationWaitTime,H=Math.max(Math.min(i/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*H,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(O/1e3))}))}detach(){if(!this._attachedCamera)return;const a=this._attachedCamera.Ua();this._onPrePointerObservableObserver&&a.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(a){this._lastInteractionTime=a??e.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<h.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let a=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(a=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?a:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=e.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var Z=i(14576),F=i(12916);class r{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(a){if(this._autoTransitionRange===a)return;this._autoTransitionRange=a;const O=this._attachedCamera;O&&(a?this._onMeshTargetChangedObserver=O.onMeshTargetChangedObservable.add((a=>{if(a&&(a.yb(!0),a.getBoundingInfo)){const O=a.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*O,this.upperRadiusTransitionRange=.05*O}})):this._onMeshTargetChangedObserver&&O.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(a){this._attachedCamera=a,this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(a){return!!this._attachedCamera&&(this._attachedCamera.radius===a&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(a){if(!this._attachedCamera)return;this._radiusBounceTransition||(r.EasingFunction.setEasingMode(r.EasingMode),this._radiusBounceTransition=F.b.CreateAnimation("radius",F.b.ANIMATIONTYPE_FLOAT,60,r.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const O=F.b.TransitionTo("radius",this._attachedCamera.radius+a,this._attachedCamera,this._attachedCamera.Ua(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));O&&this._animatables.push(O)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}r.EasingFunction=new Z.b(.3),r.EasingMode=Z.q.EASINGMODE_EASEOUT;class J{constructor(){this.onTargetFramingAnimationEndObservable=new G.e,this._mode=J.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(a){this._mode=a}get mode(){return this._mode}set radiusScale(a){this._radiusScale=a}get radiusScale(){return this._radiusScale}set positionScale(a){this._positionScale=a}get positionScale(){return this._positionScale}set defaultElevation(a){this._defaultElevation=a}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(a){this._elevationReturnTime=a}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(a){this._elevationReturnWaitTime=a}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(a){this._zoomStopsAnimation=a}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(a){this._framingTime=a}get framingTime(){return this._framingTime}init(){}attach(a){this._attachedCamera=a;const O=this._attachedCamera.Ua();J.EasingFunction.setEasingMode(J.EasingMode),this._onPrePointerObservableObserver=O.onPrePointerObservable.add((a=>{a.type!==P.c.POINTERDOWN?a.type===P.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=a.onMeshTargetChangedObservable.add((a=>{a&&a.getBoundingInfo&&this.zoomOnMesh(a,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=a.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const a=this._attachedCamera.Ua();this._onPrePointerObservableObserver&&a.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(a){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a.yb(!0);const H=a.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(H.minimumWorld,H.maximumWorld,O,i)}zoomOnMeshHierarchy(a){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;a.yb(!0);const H=a.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(H.min,H.max,O,i)}zoomOnMeshesHierarchy(a){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new q.ZO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b=new q.ZO(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let G=0;G<a.length;G++){const O=a[G].getHierarchyBoundingVectors(!0);q.ZO.CheckExtends(O.min,H,b),q.ZO.CheckExtends(O.max,H,b)}this.zoomOnBoundingInfo(H,b,O,i)}zoomOnBoundingInfo(a,O){let i,H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const G=a.y,Q=G+(O.y-G)*this._positionScale,k=O.FO(a).scale(.5);if(!isFinite(Q))return!1;if(H)i=new q.ZO(0,Q,0);else{const O=a.add(k);i=new q.ZO(O.x,Q,O.z)}this._vectorTransition||(this._vectorTransition=F.b.CreateAnimation("target",F.b.ANIMATIONTYPE_VECTOR3,60,J.EasingFunction)),this._betaIsAnimating=!0;let I=F.b.TransitionTo("target",i,this._attachedCamera,this._attachedCamera.Ua(),60,this._vectorTransition,this._framingTime);I&&this._animatables.push(I);let P=0;if(this._mode===J.FitFrustumSidesMode){const i=this._calculateLowerRadiusFromModelBoundingSphere(a,O);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=k.length()+this._attachedCamera.Db),P=i}else this._mode===J.IgnoreBoundsSizeMode&&(P=this._calculateLowerRadiusFromModelBoundingSphere(a,O),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Db));if(this.autoCorrectCameraLimitsAndSensibility){const i=O.FO(a).length();this._attachedCamera.panningSensibility=5e3/i,this._attachedCamera.wheelPrecision=100/P}return this._radiusTransition||(this._radiusTransition=F.b.CreateAnimation("radius",F.b.ANIMATIONTYPE_FLOAT,60,J.EasingFunction)),I=F.b.TransitionTo("radius",P,this._attachedCamera,this._attachedCamera.Ua(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),b&&b(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),I&&this._animatables.push(I),!0}_calculateLowerRadiusFromModelBoundingSphere(a,O){const i=this._attachedCamera;if(!i)return 0;let H=i._calculateLowerRadiusFromModelBoundingSphere(a,O,this._radiusScale);return i.lowerRadiusLimit&&this._mode===J.IgnoreBoundsSizeMode&&(H=H<i.lowerRadiusLimit?i.lowerRadiusLimit:H),i.upperRadiusLimit&&(H=H>i.upperRadiusLimit?i.upperRadiusLimit:H),H}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const a=e.c.Now-this._lastInteractionTime,O=.5*Math.PI-this._defaultElevation,i=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>i&&a>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=F.b.CreateAnimation("beta",F.b.ANIMATIONTYPE_FLOAT,60,J.EasingFunction));const a=F.b.TransitionTo("beta",O,this._attachedCamera,this._attachedCamera.Ua(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));a&&this._animatables.push(a)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=e.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}J.EasingFunction=new Z.v,J.EasingMode=Z.q.EASINGMODE_EASEINOUT,J.IgnoreBoundsSizeMode=0,J.FitFrustumSidesMode=1;var ma=i(12846),M=i(12880),C=i(14053),n=i(12184);class D{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(a){a=n.Tools.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),i=O.getInputElement();let H=0,b=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=G=>{var q,Q;const k=G.event,I="touch"===k.pointerType;if(G.type!==P.c.POINTERMOVE&&-1===this.buttons.indexOf(k.button))return;const e=k.target;if(this._altKey=k.altKey,this._ctrlKey=k.ctrlKey,this._metaKey=k.metaKey,this._shiftKey=k.shiftKey,this._buttonsPressed=k.buttons,O.isPointerLock){const a=k.movementX,O=k.movementY;this.onTouch(null,a,O),this._pointA=null,this._pointB=null}else{if(G.type!==P.c.POINTERDOWN&&G.type!==P.c.POINTERDOUBLETAP&&I&&(null===(q=this._pointA)||void 0===q?void 0:q.pointerId)!==k.pointerId&&(null===(Q=this._pointB)||void 0===Q?void 0:Q.pointerId)!==k.pointerId)return;if(G.type!==P.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!I)if(G.type===P.c.POINTERDOUBLETAP)this.onDoubleTap(k.pointerType);else if(G.type!==P.c.POINTERUP||this._currentMousePointerIdDown!==k.pointerId&&!I){if(G.type===P.c.POINTERMOVE)if(a||k.preventDefault(),this._pointA&&null===this._pointB){const a=k.clientX-this._pointA.x,O=k.clientY-this._pointA.y;this._pointA.x=k.clientX,this._pointA.y=k.clientY,this.onTouch(this._pointA,a,O)}else if(this._pointA&&this._pointB){const a=this._pointA.pointerId===k.pointerId?this._pointA:this._pointB;a.x=k.clientX,a.y=k.clientY;const O=this._pointA.x-this._pointB.x,i=this._pointA.y-this._pointB.y,q=O*O+i*i,Q={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:k.pointerId,type:G.type};this.onMultiTouch(this._pointA,this._pointB,H,q,b,Q),b=Q,H=q}}else{try{null===e||void 0===e||e.releasePointerCapture(k.pointerId)}catch(h){}I||(this._pointB=null),O._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==k.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==k.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==H||b)&&(this.onMultiTouch(this._pointA,this._pointB,H,0,b,null),H=0,b=null),this._currentMousePointerIdDown=-1,this.onButtonUp(k),a||k.preventDefault()}else{try{null===e||void 0===e||e.setPointerCapture(k.pointerId)}catch(h){}if(null===this._pointA)this._pointA={x:k.clientX,y:k.clientY,pointerId:k.pointerId,type:k.pointerType};else{if(null!==this._pointB)return;this._pointB={x:k.clientX,y:k.clientY,pointerId:k.pointerId,type:k.pointerType}}-1!==this._currentMousePointerIdDown||I||(this._currentMousePointerIdDown=k.pointerId),this.onButtonDown(k),a||(k.preventDefault(),i&&i.focus())}}},this._observer=this.camera.Ua()._inputManager._addCameraPointerObserver(this._pointerInput,P.c.POINTERDOWN|P.c.POINTERUP|P.c.POINTERMOVE|P.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,H=0,b=null,this.onLostFocus()},this._contextMenuBind=a=>this.onContextMenu(a),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);const G=this.camera.Ua().getEngine().getHostWindow();G&&n.Tools.RegisterTopRootEvents(G,[{name:"blur",handler:this._onLostFocus}])}kh(){if(this._onLostFocus){const a=this.camera.Ua().getEngine().getHostWindow();a&&n.Tools.UnregisterTopRootEvents(a,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Ua()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const a=this.camera.Ua().getEngine().getInputElement();a&&a.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(a){}onTouch(a,O,i){}onMultiTouch(a,O,i,H,b,G){}onContextMenu(a){a.preventDefault()}onButtonDown(a){}onButtonUp(a){}onLostFocus(){}}(0,H.c)([(0,b.G)()],D.prototype,"buttons",void 0);class U extends D{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(a,O){if(0!==this.panningSensibility&&a&&O){const i=O.x-a.x,H=O.y-a.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=H/this.panningSensibility}}_computePinchZoom(a,O){const i=this.camera.radius||U.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(a)/Math.sqrt(O):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(O-a)*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(O-a)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(a,O,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-O/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=O/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(a,O,i,H,b,G){0===i&&null===b||0===H&&null===G||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,H),this._computeMultiTouchPanning(b,G)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(H)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,H),this._isPinching=!0):this._computeMultiTouchPanning(b,G)):this.multiTouchPanning?this._computeMultiTouchPanning(b,G):this.pinchZoom&&this._computePinchZoom(i,H))}onButtonDown(a){this._isPanClick=a.button===this.camera._panningMouseButton}onButtonUp(a){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}U.MinimumRadiusForPinch=.001,(0,H.c)([(0,b.G)()],U.prototype,"buttons",void 0),(0,H.c)([(0,b.G)()],U.prototype,"angularSensibilityX",void 0),(0,H.c)([(0,b.G)()],U.prototype,"angularSensibilityY",void 0),(0,H.c)([(0,b.G)()],U.prototype,"pinchPrecision",void 0),(0,H.c)([(0,b.G)()],U.prototype,"pinchDeltaPercentage",void 0),(0,H.c)([(0,b.G)()],U.prototype,"useNaturalPinchZoom",void 0),(0,H.c)([(0,b.G)()],U.prototype,"pinchZoom",void 0),(0,H.c)([(0,b.G)()],U.prototype,"panningSensibility",void 0),(0,H.c)([(0,b.G)()],U.prototype,"multiTouchPanning",void 0),(0,H.c)([(0,b.G)()],U.prototype,"multiTouchPanAndZoom",void 0),C.b.ArcRotateCameraPointersInput=U;var y=i(12693);class w{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(a){a=n.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ua(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const i=O.event;if(!i.metaKey)if(O.type===y.c.KEYDOWN){if(this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&(a||i.preventDefault())}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){const O=this._keys.indexOf(i.keyCode);O>=0&&this._keys.splice(O,1),i.preventDefault&&(a||i.preventDefault())}})))}kh(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const a=this.camera;for(let O=0;O<this._keys.length;O++){const i=this._keys[O];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningX-=1/this.panningSensibility:a.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?a.inertialRadiusOffset+=1/this.zoomingSensibility:a.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningX+=1/this.panningSensibility:a.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?a.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?a.inertialRadiusOffset-=1/this.zoomingSensibility:a.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&a.useInputToRestoreState&&a.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,H.c)([(0,b.G)()],w.prototype,"keysUp",void 0),(0,H.c)([(0,b.G)()],w.prototype,"keysDown",void 0),(0,H.c)([(0,b.G)()],w.prototype,"keysLeft",void 0),(0,H.c)([(0,b.G)()],w.prototype,"keysRight",void 0),(0,H.c)([(0,b.G)()],w.prototype,"keysReset",void 0),(0,H.c)([(0,b.G)()],w.prototype,"panningSensibility",void 0),(0,H.c)([(0,b.G)()],w.prototype,"zoomingSensibility",void 0),(0,H.c)([(0,b.G)()],w.prototype,"useAltToZoom",void 0),(0,H.c)([(0,b.G)()],w.prototype,"angularSpeed",void 0),C.b.ArcRotateCameraKeyboardMoveInput=w;var K=i(12441),S=i(12702);class f{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new q.ZO(0,0,0),this._globalOffset=new q.ZO(0,0,0),this._inertialPanning=q.ZO.Zero()}_computeDeltaFromMouseWheelLegacyEvent(a,O){let i=0;const H=.01*a*this.wheelDeltaPercentage*O;return i=a>0?H/(1+this.wheelDeltaPercentage):H*(1+this.wheelDeltaPercentage),i}attachControl(a){a=n.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==P.c.POINTERWHEEL)return;const i=O.event;let H=0;const b=i.deltaMode===S.e.DOM_DELTA_LINE?40:1,G=-i.deltaY*b;if(this.customComputeDeltaFromMouseWheel)H=this.customComputeDeltaFromMouseWheel(G,this,i);else if(this.wheelDeltaPercentage){if(H=this._computeDeltaFromMouseWheelLegacyEvent(G,this.camera.radius),H>0){let a=this.camera.radius,O=this.camera.inertialRadiusOffset+H;for(let i=0;i<20&&!(a<=O)&&!(Math.abs(O*this.camera.inertia)<.001);i++)a-=O,O*=this.camera.inertia;a=(0,Q.Clamp)(a,0,Number.MAX_VALUE),H=this._computeDeltaFromMouseWheelLegacyEvent(G,a)}}else H=G/(40*this.wheelPrecision);H&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(H)):this.camera.inertialRadiusOffset+=H),i.preventDefault&&(a||i.preventDefault())},this._observer=this.camera.Ua()._inputManager._addCameraPointerObserver(this._wheel,P.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Tb(0)}kh(){this._observer&&(this.camera.Ua()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const a=this.camera;0+a.inertialAlphaOffset+a.inertialBetaOffset+a.inertialRadiusOffset&&(this._updateHitPlane(),a.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(a.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const a=this.camera,O=a.target.FO(a.position);this._hitPlane=K.c.FromPositionAndNormal(a.target,O)}_getPosition(){const a=this.camera,O=a.Ua(),i=O.createPickingRay(O.pointerX,O.pointerY,q.Matrix.Identity(),a,!1);0===a.targetScreenOffset.x&&0===a.targetScreenOffset.y||(this._viewOffset.set(a.targetScreenOffset.x,a.targetScreenOffset.y,0),a.getViewMatrix().invertToRef(a._cameraTransformMatrix),this._globalOffset=q.ZO.TransformNormal(this._viewOffset,a._cameraTransformMatrix),i.origin.addInPlace(this._globalOffset));let H=0;return this._hitPlane&&(H=i.intersectsPlane(this._hitPlane)??0),i.origin.addInPlace(i.direction.scaleInPlace(H))}_zoomToMouse(a){const O=this.camera,i=1-O.inertia;if(O.lowerRadiusLimit){const H=O.lowerRadiusLimit??0;O.radius-(O.inertialRadiusOffset+a)/i<H&&(a=(O.radius-H)*i-O.inertialRadiusOffset)}if(O.upperRadiusLimit){const H=O.upperRadiusLimit??0;O.radius-(O.inertialRadiusOffset+a)/i>H&&(a=(O.radius-H)*i-O.inertialRadiusOffset)}const H=a/i/O.radius,b=this._getPosition(),G=q.TmpVectors.ZO[6];b.subtractToRef(O.target,G),G.scaleInPlace(H),G.scaleInPlace(i),this._inertialPanning.addInPlace(G),O.inertialRadiusOffset+=a}_zeroIfClose(a){Math.abs(a.x)<h.e&&(a.x=0),Math.abs(a.y)<h.e&&(a.y=0),Math.abs(a.z)<h.e&&(a.z=0)}}(0,H.c)([(0,b.G)()],f.prototype,"wheelPrecision",void 0),(0,H.c)([(0,b.G)()],f.prototype,"zoomToMouseLocation",void 0),(0,H.c)([(0,b.G)()],f.prototype,"wheelDeltaPercentage",void 0),C.b.ArcRotateCameraMouseWheelInput=f;class B extends C.d{constructor(a){super(a)}addMouseWheel(){return this.add(new f),this}addPointers(){return this.add(new U),this}addKeyboard(){return this.add(new w),this}}var T=i(12346);function A(a,O){return isNaN(a)?O:a}k.c.AddNodeConstructor("ArcRotateCamera",((a,O)=>()=>new E(a,0,0,1,q.ZO.Zero(),O)));class E extends M.c{get target(){return this._target}set target(a){this.setTarget(a)}get targetHost(){return this._targetHost}set targetHost(a){a&&this.setTarget(a)}getTarget(){return this.target}get position(){return this._position}set position(a){this.setPosition(a)}set upVector(a){this._upToYMatrix||(this._yToUpMatrix=new q.Matrix,this._upToYMatrix=new q.Matrix,this._upVector=q.ZO.Zero()),a.normalize(),this._upVector.q(a),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){q.Matrix.RotationAlignToRef(q.ZO.UpReadOnly,this._upVector,this._yToUpMatrix),q.Matrix.RotationAlignToRef(this._upVector,q.ZO.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const a=this.inputs.attached.pointers;return a?a.angularSensibilityX:0}set angularSensibilityX(a){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityX=a)}get angularSensibilityY(){const a=this.inputs.attached.pointers;return a?a.angularSensibilityY:0}set angularSensibilityY(a){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityY=a)}get pinchPrecision(){const a=this.inputs.attached.pointers;return a?a.pinchPrecision:0}set pinchPrecision(a){const O=this.inputs.attached.pointers;O&&(O.pinchPrecision=a)}get pinchDeltaPercentage(){const a=this.inputs.attached.pointers;return a?a.pinchDeltaPercentage:0}set pinchDeltaPercentage(a){const O=this.inputs.attached.pointers;O&&(O.pinchDeltaPercentage=a)}get useNaturalPinchZoom(){const a=this.inputs.attached.pointers;return!!a&&a.useNaturalPinchZoom}set useNaturalPinchZoom(a){const O=this.inputs.attached.pointers;O&&(O.useNaturalPinchZoom=a)}get panningSensibility(){const a=this.inputs.attached.pointers;return a?a.panningSensibility:0}set panningSensibility(a){const O=this.inputs.attached.pointers;O&&(O.panningSensibility=a)}get keysUp(){const a=this.inputs.attached.keyboard;return a?a.keysUp:[]}set keysUp(a){const O=this.inputs.attached.keyboard;O&&(O.keysUp=a)}get keysDown(){const a=this.inputs.attached.keyboard;return a?a.keysDown:[]}set keysDown(a){const O=this.inputs.attached.keyboard;O&&(O.keysDown=a)}get keysLeft(){const a=this.inputs.attached.keyboard;return a?a.keysLeft:[]}set keysLeft(a){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=a)}get keysRight(){const a=this.inputs.attached.keyboard;return a?a.keysRight:[]}set keysRight(a){const O=this.inputs.attached.keyboard;O&&(O.keysRight=a)}get wheelPrecision(){const a=this.inputs.attached.mousewheel;return a?a.wheelPrecision:0}set wheelPrecision(a){const O=this.inputs.attached.mousewheel;O&&(O.wheelPrecision=a)}get zoomToMouseLocation(){const a=this.inputs.attached.mousewheel;return!!a&&a.zoomToMouseLocation}set zoomToMouseLocation(a){const O=this.inputs.attached.mousewheel;O&&(O.zoomToMouseLocation=a)}get wheelDeltaPercentage(){const a=this.inputs.attached.mousewheel;return a?a.wheelDeltaPercentage:0}set wheelDeltaPercentage(a){const O=this.inputs.attached.mousewheel;O&&(O.wheelDeltaPercentage=a)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(a){a!==this.useBouncingBehavior&&(a?(this._bouncingBehavior=new r,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(a){a!==this.useFramingBehavior&&(a?(this._framingBehavior=new J,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(a){a!==this.useAutoRotationBehavior&&(a?(this._autoRotationBehavior=new j,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(a,O,i,H,b,Q){var k;let I=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(a,q.ZO.Zero(),Q,I),k=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=q.ZO.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=q.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new q.Matrix,this.panningAxis=new q.ZO(1,1,0),this._transformedDirection=new q.ZO,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new G.e,this.checkCollisions=!1,this.collisionRadius=new q.ZO(.5,.5,.5),this._previousPosition=q.ZO.Zero(),this._collisionVelocity=q.ZO.Zero(),this._newPosition=q.ZO.Zero(),this._computationVector=q.ZO.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new q.ZO(NaN,NaN,NaN),this._goalTargetScreenOffset=new q.Vector2(NaN,NaN),this._onCollisionPositionChange=function(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i?(k.setPosition(O),k.OZ&&k.OZ(i)):k._previousPosition.q(k._position);const H=Math.cos(k.alpha),b=Math.sin(k.alpha),G=Math.cos(k.beta);let q=Math.sin(k.beta);0===q&&(q=1e-4);const Q=k._getTargetPosition();k._computationVector.fb(k.radius*H*q,k.radius*G,k.radius*b*q),Q.addToRef(k._computationVector,k._newPosition),k._position.q(k._newPosition);let I=k.upVector;k.allowUpsideDown&&k.beta<0&&(I=I.clone(),I=I.negate()),k._computeViewMatrix(k._position,Q,I),k._viewMatrix.addAtIndex(12,k.targetScreenOffset.x),k._viewMatrix.addAtIndex(13,k.targetScreenOffset.y),k._collisionTriggered=!1},this._target=q.ZO.Zero(),b&&this.setTarget(b),this.alpha=O,this.beta=i,this.radius=H,this.getViewMatrix(),this.inputs=new B(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new q.ZO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=q.Vector2.Zero()}_updateCache(a){a||super._updateCache(),this._cache._target.q(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.q(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const a=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?a.addToRef(this._targetBoundingCenter,this._target):this._target.q(a)}const a=this._getLockedTargetPosition();return a||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>h.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,G=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=G?this._currentInterpolationFactor=G:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=A(a,this._goalAlpha),this._goalBeta=A(O,this._goalBeta),this._goalRadius=A(i,this._goalRadius),this._goalTarget.set(A(H.x,this._goalTarget.x),A(H.y,this._goalTarget.y),A(H.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(A(b.x,this._goalTargetScreenOffset.x),A(b.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,Q.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,Q.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,Q.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,Q.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(a,O){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const b=arguments;O=n.Tools.BackCompatCameraNoPreventDefault(b),this._useCtrlForPanning=i,this._panningMouseButton=H,"boolean"===typeof b[0]&&(b.length>1&&(this._useCtrlForPanning=b[1]),b.length>2&&(this._panningMouseButton=b[2])),this.inputs.attachElement(O),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}kh(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let a=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){a=!0;const O=this.invertRotation?-1:1,i=this._calculateHandednessMultiplier();let H=this.inertialAlphaOffset*i;this.beta<0&&(H*=-1),this.alpha+=H*O,this.beta+=this.inertialBetaOffset*O,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<h.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<h.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*h.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){a=!0;const O=new q.ZO(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),O.multiplyInPlace(this.panningAxis),q.ZO.TransformNormalToRef(O,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const a=this.upVector,O=q.ZO.CrossToRef(this._transformedDirection,a,this._transformedDirection);q.ZO.CrossToRef(a,O,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);q.ZO.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.q(this._transformedDirection)}else{if(this.parent){const a=q.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(a),a.transposeToRef(a),q.ZO.TransformCoordinatesToRef(this._transformedDirection,a,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*h.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*h.e&&(this.inertialPanningY=0)}if(a)this.stopInterpolation();else if(this._isInterpolating){let a=!1;const O=this._scene.getEngine().getDeltaTime()/1e3,i=1-Math.pow(2,-O/this._currentInterpolationFactor),H=A(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const O=q.TmpVectors.ZO[0].set(A(this._goalTarget.x,this._target.x),A(this._goalTarget.y,this._target.y),A(this._goalTarget.z,this._target.z));q.ZO.LerpToRef(this.target,O,i,this._target),10*q.ZO.Distance(this.target,O)/H<h.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.q(O),this.setTarget(this.target,!1,!0,!0)):a=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const O=q.Quaternion.RotationAlphaBetaGammaToRef(A(this._goalAlpha,this.alpha),A(this._goalBeta,this.beta),0,q.TmpVectors.Quaternion[0]),H=q.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,q.TmpVectors.Quaternion[1]),b=q.Quaternion.SlerpToRef(H,O,i,q.TmpVectors.Quaternion[2]);b.normalize();const G=b.toAlphaBetaGammaToRef(q.TmpVectors.ZO[0]);if(this.alpha=G.x,this.beta=G.y,b.isApprox(O,h.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const a=O.toAlphaBetaGammaToRef(q.TmpVectors.ZO[0]);this.alpha=a.x,this.beta=a.y}else a=!0}if(isNaN(this._goalRadius)||(this.radius+=(H-this.radius)*i,Math.abs(H/this.radius-1)<h.e?(this._goalRadius=NaN,this.radius=H):a=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const O=q.TmpVectors.Vector2[0].set(A(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),A(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));q.Vector2.LerpToRef(this.targetScreenOffset,O,i,this.targetScreenOffset),q.Vector2.Distance(this.targetScreenOffset,O)<h.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.q(O)):a=!0}this._isInterpolating=a}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||q.ZO.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const a=this.alpha;var O,i;this.alpha=function(a){let O=Math.PI/2;return 0===a.x&&0===a.z||(O=Math.acos(a.x/Math.sqrt(Math.pow(a.x,2)+Math.pow(a.z,2)))),a.z<0&&(O=2*Math.PI-O),O}(this._computationVector),this.beta=(O=this._computationVector.y,i=this.radius,Math.acos(O/i));const H=Math.round((a-this.alpha)/(2*Math.PI));this.alpha+=2*H*Math.PI,this._checkLimits()}setPosition(a){this._position.equals(a)||(this._position.q(a),this.rebuildAnglesAndRadius())}setTarget(a){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(H=this.overrideCloneAlphaBetaRadius??H,a.yb)O&&a.getBoundingInfo?this._targetBoundingCenter=a.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,a.yb(),this._targetHost=a,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const O=a,H=this._getTargetPosition();if(H&&!i&&H.equals(O))return;this._targetHost=null,this._target=O,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}H||this.rebuildAnglesAndRadius()}_getViewMatrix(){const a=Math.cos(this.alpha),O=Math.sin(this.alpha),i=Math.cos(this.beta);let H=Math.sin(this.beta);0===H&&(H=1e-4),0===this.radius&&(this.radius=1e-4);const b=this._getTargetPosition();if(this._computationVector.fb(this.radius*a*H,this.radius*i,this.radius*O*H),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||q.ZO.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),b.addToRef(this._computationVector,this._newPosition),this.Ua().collisionsEnabled&&this.checkCollisions){const a=this.Ua().collisionCoordinator;this._collider||(this._collider=a.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,a.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.q(this._newPosition);let a=this.upVector;this.allowUpsideDown&&H<0&&(a=a.negate()),this._computeViewMatrix(this._position,b,a),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.q(b),this._viewMatrix}zoomOn(a){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a=a||this.Ua().meshes;const i=I.d.MinMax(a);let H=this._calculateLowerRadiusFromModelBoundingSphere(i.min,i.max);if(H=Math.max(Math.min(H,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=H*this.zoomOnFactor,this.mode===ma.e.ORTHOGRAPHIC_CAMERA){const a=this.Ua().getEngine().getAspectRatio(this),O=H*this.zoomOnFactor/2;this.orthoLeft=-O*a,this.orthoRight=O*a,this.orthoBottom=-O,this.orthoTop=O}this.focusOn({min:i.min,max:i.max,distance:H},O)}focusOn(a){let O,i,H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===a.min){const H=a||this.Ua().meshes;O=I.d.MinMax(H),i=q.ZO.Distance(O.min,O.max)}else{O=a,i=a.distance}this._target=I.d.Center(O),H||(this.maxZ=2*i)}createRigCamera(a,O){let i=0;switch(this.cameraRigMode){case ma.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case ma.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case ma.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case ma.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case ma.e.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===O?1:-1);break;case ma.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===O?-1:1)}const H=new E(a,this.alpha+i,this.beta,this.radius,this._target,this.Ua());return H._cameraRigParams={},H.isRigCamera=!0,H.rigParent=this,H.upVector=this.upVector,H.mode=this.mode,H.orthoLeft=this.orthoLeft,H.orthoRight=this.orthoRight,H.orthoBottom=this.orthoBottom,H.orthoTop=this.orthoTop,H}_updateRigCameras(){const a=this._rigCameras[0],O=this._rigCameras[1];switch(a.beta=O.beta=this.beta,this.cameraRigMode){case ma.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case ma.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case ma.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case ma.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case ma.e.RIG_MODE_VR:a.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case ma.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:a.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const H=q.ZO.Distance(a,O),b=this.Ua().getEngine().getAspectRatio(this),G=Math.tan(this.fov/2),Q=G*b,k=.5*H*i,I=k*Math.sqrt(1+1/(Q*Q)),P=k*Math.sqrt(1+1/(G*G));return Math.max(I,P)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,H.c)([(0,b.G)()],E.prototype,"alpha",void 0),(0,H.c)([(0,b.G)()],E.prototype,"beta",void 0),(0,H.c)([(0,b.G)()],E.prototype,"radius",void 0),(0,H.c)([(0,b.G)()],E.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,H.c)([(0,b.D)("target")],E.prototype,"_target",void 0),(0,H.c)([(0,b.u)("targetHost")],E.prototype,"_targetHost",void 0),(0,H.c)([(0,b.G)()],E.prototype,"inertialAlphaOffset",void 0),(0,H.c)([(0,b.G)()],E.prototype,"inertialBetaOffset",void 0),(0,H.c)([(0,b.G)()],E.prototype,"inertialRadiusOffset",void 0),(0,H.c)([(0,b.G)()],E.prototype,"lowerAlphaLimit",void 0),(0,H.c)([(0,b.G)()],E.prototype,"upperAlphaLimit",void 0),(0,H.c)([(0,b.G)()],E.prototype,"lowerBetaLimit",void 0),(0,H.c)([(0,b.G)()],E.prototype,"upperBetaLimit",void 0),(0,H.c)([(0,b.G)()],E.prototype,"lowerRadiusLimit",void 0),(0,H.c)([(0,b.G)()],E.prototype,"upperRadiusLimit",void 0),(0,H.c)([(0,b.G)()],E.prototype,"lowerTargetYLimit",void 0),(0,H.c)([(0,b.G)()],E.prototype,"inertialPanningX",void 0),(0,H.c)([(0,b.G)()],E.prototype,"inertialPanningY",void 0),(0,H.c)([(0,b.G)()],E.prototype,"pinchToPanMaxDistance",void 0),(0,H.c)([(0,b.G)()],E.prototype,"panningDistanceLimit",void 0),(0,H.c)([(0,b.D)()],E.prototype,"panningOriginTarget",void 0),(0,H.c)([(0,b.G)()],E.prototype,"panningInertia",void 0),(0,H.c)([(0,b.G)()],E.prototype,"zoomToMouseLocation",null),(0,H.c)([(0,b.G)()],E.prototype,"zoomOnFactor",void 0),(0,H.c)([(0,b.B)()],E.prototype,"targetScreenOffset",void 0),(0,H.c)([(0,b.G)()],E.prototype,"allowUpsideDown",void 0),(0,H.c)([(0,b.G)()],E.prototype,"useInputToRestoreState",void 0),(0,H.c)([(0,b.G)()],E.prototype,"restoreStateInterpolationFactor",void 0),(0,T.h)("BABYLON.ArcRotateCamera",E)},14053:(a,O,i)=>{"use strict";i.d(O,{b:()=>q,d:()=>Q});var H=i(12209),b=i(12427),G=i(12846),q={};class Q{constructor(a){this.attachedToElement=!1,this.attached={},this.camera=a,this.checkInputs=()=>{}}add(a){const O=a.getSimpleName();this.attached[O]?H.c.Warn("camera input of type "+O+" already exists on camera"):(this.attached[O]=a,a.camera=this.camera,a.checkInputs&&(this.checkInputs=this._addCheckInputs(a.checkInputs.bind(a))),this.attachedToElement&&a.attachControl(this.noPreventDefault))}remove(a){for(const O in this.attached){const i=this.attached[O];if(i===a)return i.kh(),i.camera=null,delete this.attached[O],void this.rebuildInputCheck()}}removeByType(a){for(const O in this.attached){const i=this.attached[O];i.getClassName()===a&&(i.kh(),i.camera=null,delete this.attached[O],this.rebuildInputCheck())}}_addCheckInputs(a){const O=this.checkInputs;return()=>{O(),a()}}attachInput(a){this.attachedToElement&&a.attachControl(this.noPreventDefault)}attachElement(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){a=!G.e.ForceAttachControlToAlwaysPreventDefault&&a,this.attachedToElement=!0,this.noPreventDefault=a;for(const O in this.attached)this.attached[O].attachControl(a)}}detachElement(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const O in this.attached)this.attached[O].kh(),a&&(this.attached[O].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const a in this.attached){const O=this.attached[a];O.checkInputs&&(this.checkInputs=this._addCheckInputs(O.checkInputs.bind(O)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(a){const O={};for(const i in this.attached){const a=this.attached[i],H=b.d.Serialize(a);O[a.getClassName()]=H}a.inputsmgr=O}parse(a){const O=a.inputsmgr;if(O){this.clear();for(const a in O){const i=q[a];if(i){const H=O[a],G=b.d.Parse((()=>new i),H,null);this.add(G)}}}else for(const i in this.attached){const O=q[this.attached[i].getClassName()];if(O){const H=b.d.Parse((()=>new O),a,null);this.remove(this.attached[i]),this.add(H)}}}}},14049:(a,O,i)=>{"use strict";i.d(O,{c:()=>D});var H=i(12375),b=i(12384),G=i(12395),q=i(12880),Q=i(14053),k=i(12693),I=i(12184);class P{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(a){a=I.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Ua(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const i=O.event;if(!i.metaKey)if(O.type===k.c.KEYDOWN){if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),a||i.preventDefault()}}else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysUpward.indexOf(i.keyCode)||-1!==this.keysDownward.indexOf(i.keyCode)||-1!==this.keysRotateLeft.indexOf(i.keyCode)||-1!==this.keysRotateRight.indexOf(i.keyCode)||-1!==this.keysRotateUp.indexOf(i.keyCode)||-1!==this.keysRotateDown.indexOf(i.keyCode)){const O=this._keys.indexOf(i.keyCode);O>=0&&this._keys.splice(O,1),a||i.preventDefault()}})))}kh(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const a=this.camera;for(let O=0;O<this._keys.length;O++){const i=this._keys[O],H=a._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(i)?a._localDirection.fb(-H,0,0):-1!==this.keysUp.indexOf(i)?a._localDirection.fb(0,0,H):-1!==this.keysRight.indexOf(i)?a._localDirection.fb(H,0,0):-1!==this.keysDown.indexOf(i)?a._localDirection.fb(0,0,-H):-1!==this.keysUpward.indexOf(i)?a._localDirection.fb(0,H,0):-1!==this.keysDownward.indexOf(i)?a._localDirection.fb(0,-H,0):-1!==this.keysRotateLeft.indexOf(i)?(a._localDirection.fb(0,0,0),a.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(i)?(a._localDirection.fb(0,0,0),a.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(i)?(a._localDirection.fb(0,0,0),a.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(i)&&(a._localDirection.fb(0,0,0),a.cameraRotation.x+=this._getLocalRotation()),a.Ua().useRightHandedSystem&&(a._localDirection.z*=-1),a.getViewMatrix().invertToRef(a._cameraTransformMatrix),G.ZO.TransformNormalToRef(a._localDirection,a._cameraTransformMatrix,a._transformedDirection),a.cameraDirection.addInPlace(a._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const a=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*a}}(0,H.c)([(0,b.G)()],P.prototype,"keysUp",void 0),(0,H.c)([(0,b.G)()],P.prototype,"keysUpward",void 0),(0,H.c)([(0,b.G)()],P.prototype,"keysDown",void 0),(0,H.c)([(0,b.G)()],P.prototype,"keysDownward",void 0),(0,H.c)([(0,b.G)()],P.prototype,"keysLeft",void 0),(0,H.c)([(0,b.G)()],P.prototype,"keysRight",void 0),(0,H.c)([(0,b.G)()],P.prototype,"rotationSpeed",void 0),(0,H.c)([(0,b.G)()],P.prototype,"keysRotateLeft",void 0),(0,H.c)([(0,b.G)()],P.prototype,"keysRotateRight",void 0),(0,H.c)([(0,b.G)()],P.prototype,"keysRotateUp",void 0),(0,H.c)([(0,b.G)()],P.prototype,"keysRotateDown",void 0),Q.b.FreeCameraKeyboardMoveInput=P;var e=i(12193),h=i(12689);class j{constructor(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=a,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new e.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(a){a=I.Tools.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),i=O.getInputElement();this._pointerInput||(this._pointerInput=H=>{const b=H.event,G="touch"===b.pointerType;if(!this.touchEnabled&&G)return;if(H.type!==h.c.POINTERMOVE&&-1===this.buttons.indexOf(b.button))return;const q=b.target;if(H.type===h.c.POINTERDOWN){if(G&&-1!==this._activePointerId||!G&&-1!==this._currentActiveButton)return;this._activePointerId=b.pointerId;try{null===q||void 0===q||q.setPointerCapture(b.pointerId)}catch(Q){}-1===this._currentActiveButton&&(this._currentActiveButton=b.button),this._previousPosition={x:b.clientX,y:b.clientY},a||(b.preventDefault(),i&&i.focus()),O.isPointerLock&&this._onMouseMove&&this._onMouseMove(H.event)}else if(H.type===h.c.POINTERUP){if(G&&this._activePointerId!==b.pointerId||!G&&this._currentActiveButton!==b.button)return;try{null===q||void 0===q||q.releasePointerCapture(b.pointerId)}catch(Q){}this._currentActiveButton=-1,this._previousPosition=null,a||b.preventDefault(),this._activePointerId=-1}else if(H.type===h.c.POINTERMOVE&&(this._activePointerId===b.pointerId||!G))if(O.isPointerLock&&this._onMouseMove)this._onMouseMove(H.event);else if(this._previousPosition){const O=this.camera._calculateHandednessMultiplier(),i=(b.clientX-this._previousPosition.x)*O,H=b.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=i/this.angularSensibility,this.camera.cameraRotation.x+=H/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:i,offsetY:H}),this._previousPosition={x:b.clientX,y:b.clientY},a||b.preventDefault()}}),this._onMouseMove=i=>{if(!O.isPointerLock)return;const H=this.camera._calculateHandednessMultiplier(),b=i.movementX*H;this.camera.cameraRotation.y+=b/this.angularSensibility;const G=i.movementY;this.camera.cameraRotation.x+=G/this.angularSensibility,this._previousPosition=null,a||i.preventDefault()},this._observer=this.camera.Ua()._inputManager._addCameraPointerObserver(this._pointerInput,h.c.POINTERDOWN|h.c.POINTERUP|h.c.POINTERMOVE),i&&(this._contextMenuBind=a=>this.onContextMenu(a),i.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(a){a.preventDefault()}kh(){if(this._observer){if(this.camera.Ua()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const a=this.camera.getEngine().getInputElement();a&&a.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,H.c)([(0,b.G)()],j.prototype,"buttons",void 0),(0,H.c)([(0,b.G)()],j.prototype,"angularSensibility",void 0),Q.b.FreeCameraMouseInput=j;var Z,F=i(12702);class r{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new e.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(a){a=I.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==h.c.POINTERWHEEL)return;const i=O.event,H=i.deltaMode===F.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*H*i.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*H*i.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*H*i.deltaZ/this._normalize,i.preventDefault&&(a||i.preventDefault())},this._observer=this.camera.Ua()._inputManager._addCameraPointerObserver(this._wheel,h.c.POINTERWHEEL)}kh(){this._observer&&(this.camera.Ua()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,H.c)([(0,b.G)()],r.prototype,"wheelPrecisionX",void 0),(0,H.c)([(0,b.G)()],r.prototype,"wheelPrecisionY",void 0),(0,H.c)([(0,b.G)()],r.prototype,"wheelPrecisionZ",void 0),function(a){a[a.MoveRelative=0]="MoveRelative",a[a.RotateRelative=1]="RotateRelative",a[a.MoveScene=2]="MoveScene"}(Z||(Z={}));class J extends r{constructor(){super(...arguments),this._moveRelative=G.ZO.Zero(),this._rotateRelative=G.ZO.Zero(),this._moveScene=G.ZO.Zero(),this._wheelXAction=Z.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=Z.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(a){null===a&&this._wheelXAction!==Z.MoveRelative||(this._wheelXAction=Z.MoveRelative,this._wheelXActionCoordinate=a)}get wheelXMoveRelative(){return this._wheelXAction!==Z.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(a){null===a&&this._wheelYAction!==Z.MoveRelative||(this._wheelYAction=Z.MoveRelative,this._wheelYActionCoordinate=a)}get wheelYMoveRelative(){return this._wheelYAction!==Z.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(a){null===a&&this._wheelZAction!==Z.MoveRelative||(this._wheelZAction=Z.MoveRelative,this._wheelZActionCoordinate=a)}get wheelZMoveRelative(){return this._wheelZAction!==Z.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(a){null===a&&this._wheelXAction!==Z.RotateRelative||(this._wheelXAction=Z.RotateRelative,this._wheelXActionCoordinate=a)}get wheelXRotateRelative(){return this._wheelXAction!==Z.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(a){null===a&&this._wheelYAction!==Z.RotateRelative||(this._wheelYAction=Z.RotateRelative,this._wheelYActionCoordinate=a)}get wheelYRotateRelative(){return this._wheelYAction!==Z.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(a){null===a&&this._wheelZAction!==Z.RotateRelative||(this._wheelZAction=Z.RotateRelative,this._wheelZActionCoordinate=a)}get wheelZRotateRelative(){return this._wheelZAction!==Z.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(a){null===a&&this._wheelXAction!==Z.MoveScene||(this._wheelXAction=Z.MoveScene,this._wheelXActionCoordinate=a)}get wheelXMoveScene(){return this._wheelXAction!==Z.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(a){null===a&&this._wheelYAction!==Z.MoveScene||(this._wheelYAction=Z.MoveScene,this._wheelYActionCoordinate=a)}get wheelYMoveScene(){return this._wheelYAction!==Z.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(a){null===a&&this._wheelZAction!==Z.MoveScene||(this._wheelZAction=Z.MoveScene,this._wheelZActionCoordinate=a)}get wheelZMoveScene(){return this._wheelZAction!==Z.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Tb(0),this._rotateRelative.Tb(0),this._moveScene.Tb(0),this._updateCamera(),this.camera.Ua().useRightHandedSystem&&(this._moveRelative.z*=-1);const a=G.Matrix.Zero();this.camera.getViewMatrix().invertToRef(a);const O=G.ZO.Zero();G.ZO.TransformNormalToRef(this._moveRelative,a,O),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(O),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(a,O,i){if(0===a)return;if(null===O||null===i)return;let H=null;switch(O){case Z.MoveRelative:H=this._moveRelative;break;case Z.RotateRelative:H=this._rotateRelative;break;case Z.MoveScene:H=this._moveScene}switch(i){case 0:H.set(a,0,0);break;case 1:H.set(0,a,0);break;case 2:H.set(0,0,a)}}}(0,H.c)([(0,b.G)()],J.prototype,"wheelXMoveRelative",null),(0,H.c)([(0,b.G)()],J.prototype,"wheelYMoveRelative",null),(0,H.c)([(0,b.G)()],J.prototype,"wheelZMoveRelative",null),(0,H.c)([(0,b.G)()],J.prototype,"wheelXRotateRelative",null),(0,H.c)([(0,b.G)()],J.prototype,"wheelYRotateRelative",null),(0,H.c)([(0,b.G)()],J.prototype,"wheelZRotateRelative",null),(0,H.c)([(0,b.G)()],J.prototype,"wheelXMoveScene",null),(0,H.c)([(0,b.G)()],J.prototype,"wheelYMoveScene",null),(0,H.c)([(0,b.G)()],J.prototype,"wheelZMoveScene",null),Q.b.FreeCameraMouseWheelInput=J;class ma{constructor(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=a,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=I.Tools.IsSafari()}attachControl(a){a=I.Tools.BackCompatCameraNoPreventDefault(arguments);let O=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=i=>{const H=i.event,b="mouse"===H.pointerType||this._isSafari&&"undefined"===typeof H.pointerType;if(this.allowMouse||!b)if(i.type===h.c.POINTERDOWN){if(a||H.preventDefault(),this._pointerPressed.push(H.pointerId),1!==this._pointerPressed.length)return;O={x:H.clientX,y:H.clientY}}else if(i.type===h.c.POINTERUP){a||H.preventDefault();const i=this._pointerPressed.indexOf(H.pointerId);if(-1===i)return;if(this._pointerPressed.splice(i,1),0!=i)return;O=null,this._offsetX=null,this._offsetY=null}else if(i.type===h.c.POINTERMOVE){if(a||H.preventDefault(),!O)return;if(0!=this._pointerPressed.indexOf(H.pointerId))return;this._offsetX=H.clientX-O.x,this._offsetY=-(H.clientY-O.y)}}),this._observer=this.camera.Ua()._inputManager._addCameraPointerObserver(this._pointerInput,h.c.POINTERDOWN|h.c.POINTERUP|h.c.POINTERMOVE),this._onLostFocus){const a=this.camera.getEngine().getInputElement();a&&a.addEventListener("blur",this._onLostFocus)}}kh(){if(this._pointerInput){if(this._observer&&(this.camera.Ua()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const a=this.camera.getEngine().getInputElement();a&&a.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const a=this.camera,O=a._calculateHandednessMultiplier();a.cameraRotation.y=O*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)a.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const O=a._computeLocalCameraSpeed(),i=new G.ZO(0,0,0!==this.touchMoveSensibility?O*this._offsetY/this.touchMoveSensibility:0);G.Matrix.RotationYawPitchRollToRef(a.rotation.y,a.rotation.x,0,a._cameraRotationMatrix),a.cameraDirection.addInPlace(G.ZO.TransformCoordinates(i,a._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,H.c)([(0,b.G)()],ma.prototype,"touchAngularSensibility",void 0),(0,H.c)([(0,b.G)()],ma.prototype,"touchMoveSensibility",void 0),Q.b.FreeCameraTouchInput=ma;class M extends Q.d{constructor(a){super(a),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new P),this}addMouse(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new j(a),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new J,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new ma),this}clear(){super.clear(),this._mouseInput=null}}var C=i(12346),n=i(12273);class D extends q.c{get angularSensibility(){const a=this.inputs.attached.mouse;return a?a.angularSensibility:0}set angularSensibility(a){const O=this.inputs.attached.mouse;O&&(O.angularSensibility=a)}get keysUp(){const a=this.inputs.attached.keyboard;return a?a.keysUp:[]}set keysUp(a){const O=this.inputs.attached.keyboard;O&&(O.keysUp=a)}get keysUpward(){const a=this.inputs.attached.keyboard;return a?a.keysUpward:[]}set keysUpward(a){const O=this.inputs.attached.keyboard;O&&(O.keysUpward=a)}get keysDown(){const a=this.inputs.attached.keyboard;return a?a.keysDown:[]}set keysDown(a){const O=this.inputs.attached.keyboard;O&&(O.keysDown=a)}get keysDownward(){const a=this.inputs.attached.keyboard;return a?a.keysDownward:[]}set keysDownward(a){const O=this.inputs.attached.keyboard;O&&(O.keysDownward=a)}get keysLeft(){const a=this.inputs.attached.keyboard;return a?a.keysLeft:[]}set keysLeft(a){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=a)}get keysRight(){const a=this.inputs.attached.keyboard;return a?a.keysRight:[]}set keysRight(a){const O=this.inputs.attached.keyboard;O&&(O.keysRight=a)}get keysRotateLeft(){const a=this.inputs.attached.keyboard;return a?a.keysRotateLeft:[]}set keysRotateLeft(a){const O=this.inputs.attached.keyboard;O&&(O.keysRotateLeft=a)}get keysRotateRight(){const a=this.inputs.attached.keyboard;return a?a.keysRotateRight:[]}set keysRotateRight(a){const O=this.inputs.attached.keyboard;O&&(O.keysRotateRight=a)}get keysRotateUp(){const a=this.inputs.attached.keyboard;return a?a.keysRotateUp:[]}set keysRotateUp(a){const O=this.inputs.attached.keyboard;O&&(O.keysRotateUp=a)}get keysRotateDown(){const a=this.inputs.attached.keyboard;return a?a.keysRotateDown:[]}set keysRotateDown(a){const O=this.inputs.attached.keyboard;O&&(O.keysRotateDown=a)}constructor(a,O,i){var H;super(a,O,i,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),H=this,this.ellipsoid=new G.ZO(.5,1,.5),this.ellipsoidOffset=new G.ZO(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=G.ZO.Zero(),this._diffPosition=G.ZO.Zero(),this._newPosition=G.ZO.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H._newPosition.q(O),H._newPosition.subtractToRef(H._oldPosition,H._diffPosition),H._diffPosition.length()>n.c.CollisionsEpsilon&&(H.position.addToRef(H._diffPosition,H._deferredPositionUpdate),H._deferOnly?H._deferredUpdated=!0:H.position.q(H._deferredPositionUpdate),H.OZ&&i&&H.OZ(i))},this.inputs=new M(this),this.inputs.addKeyboard().addMouse()}attachControl(a,O){O=I.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(O)}kh(){this.inputs.detachElement(),this.cameraDirection=new G.ZO(0,0,0),this.cameraRotation=new G.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(a){this._collisionMask=isNaN(a)?-1:a}_collideWithWorld(a){let O;O=this.parent?G.ZO.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,O.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const i=this.Ua().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let H=a;this.applyGravity&&(H=a.add(this.Ua().gravity)),i.getNewPosition(this._oldPosition,H,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=G.ZO.Zero(),this._transformedDirection=G.ZO.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(a){this._needMoveForGravity=a}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Ua().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"xb"}}(0,H.c)([(0,b.D)()],D.prototype,"ellipsoid",void 0),(0,H.c)([(0,b.D)()],D.prototype,"ellipsoidOffset",void 0),(0,H.c)([(0,b.G)()],D.prototype,"checkCollisions",void 0),(0,H.c)([(0,b.G)()],D.prototype,"applyGravity",void 0),(0,C.h)("BABYLON.FreeCamera",D)},14628:(a,O,i)=>{"use strict";i.d(O,{c:()=>G});var H=i(12492),b=i(14633);class G{constructor(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=i,this.Ze=[],this._maxBlockCapacity=O||64,this._selectionContent=new H.e(1024),this._creationFunc=a}update(a,O,i){b.d._CreateBlocks(a,O,i,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}jP(a){for(let O=0;O<this.wP.length;O++){this.wP[O].addEntry(a)}}hP(a){for(let O=0;O<this.wP.length;O++){this.wP[O].removeEntry(a)}}select(a,O){this._selectionContent.reset();for(let i=0;i<this.wP.length;i++){this.wP[i].select(a,this._selectionContent,O)}return O?this._selectionContent.concat(this.Ze):this._selectionContent.concatWithNoDuplicate(this.Ze),this._selectionContent}intersects(a,O,i){this._selectionContent.reset();for(let H=0;H<this.wP.length;H++){this.wP[H].intersects(a,O,this._selectionContent,i)}return i?this._selectionContent.concat(this.Ze):this._selectionContent.concatWithNoDuplicate(this.Ze),this._selectionContent}intersectsRay(a){this._selectionContent.reset();for(let O=0;O<this.wP.length;O++){this.wP[O].intersectsRay(a,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Ze),this._selectionContent}}G.CreationFuncForMeshes=(a,O)=>{const i=a.getBoundingInfo();!a.isBlocked&&i.boundingBox.intersectsMinMax(O.De,O.Ue)&&O.entries.push(a)},G.CreationFuncForSubMeshes=(a,O)=>{a.getBoundingInfo().boundingBox.intersectsMinMax(O.De,O.Ue)&&O.entries.push(a)}},14633:(a,O,i)=>{"use strict";i.d(O,{d:()=>G});var H=i(12395),b=i(12753);class G{constructor(a,O,i,H,b,G){this.entries=[],this.we=new Array,this._capacity=i,this._depth=H,this._maxDepth=b,this._creationFunc=G,this._minPoint=a,this._maxPoint=O,this.we.push(a.clone()),this.we.push(O.clone()),this.we.push(a.clone()),this.we[2].x=O.x,this.we.push(a.clone()),this.we[3].y=O.y,this.we.push(a.clone()),this.we[4].z=O.z,this.we.push(O.clone()),this.we[5].z=a.z,this.we.push(O.clone()),this.we[6].x=a.x,this.we.push(O.clone()),this.we[7].y=a.y}get Zi(){return this._capacity}get De(){return this._minPoint}get Ue(){return this._maxPoint}addEntry(a){if(this.wP)for(let O=0;O<this.wP.length;O++){this.wP[O].addEntry(a)}else this._creationFunc(a,this),this.entries.length>this.Zi&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(a){if(this.wP){for(let O=0;O<this.wP.length;O++){this.wP[O].removeEntry(a)}return}const O=this.entries.indexOf(a);O>-1&&this.entries.splice(O,1)}addEntries(a){for(let O=0;O<a.length;O++){const i=a[O];this.addEntry(i)}}select(a,O,i){if(b.b.IsInFrustum(this.we,a)){if(this.wP){for(let H=0;H<this.wP.length;H++){this.wP[H].select(a,O,i)}return}i?O.concat(this.entries):O.concatWithNoDuplicate(this.entries)}}intersects(a,O,i,H){if(b.b.IntersectsSphere(this._minPoint,this._maxPoint,a,O)){if(this.wP){for(let b=0;b<this.wP.length;b++){this.wP[b].intersects(a,O,i,H)}return}H?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}}intersectsRay(a,O){if(a.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.wP){for(let i=0;i<this.wP.length;i++){this.wP[i].intersectsRay(a,O)}return}O.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){G._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(a,O,i,b,q,Q,k,I){k.wP=new Array;const P=new H.ZO((O.x-a.x)/2,(O.y-a.y)/2,(O.z-a.z)/2);for(let H=0;H<2;H++)for(let O=0;O<2;O++)for(let e=0;e<2;e++){const h=a.add(P.multiplyByFloats(H,O,e)),j=a.add(P.multiplyByFloats(H+1,O+1,e+1)),Z=new G(h,j,b,q+1,Q,I);Z.addEntries(i),k.wP.push(Z)}}}},14638:(a,O,i)=>{"use strict";i.d(O,{e:()=>P});var H=i(12648),b=i(12395),G=i(12826),q=i(13800),Q=i(12682),k=i(14628),I=i(12236);H.c.prototype.createOrUpdateSelectionOctree=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=this._getComponent(Q.b.NAME_OCTREE);i||(i=new P(this),this.o(i)),this.Ie||(this.Ie=new k.c(k.c.CreationFuncForMeshes,a,O));const H=this.getWorldExtends();return this.Ie.update(H.min,H.max,this.meshes),this.Ie},Object.defineProperty(H.c.prototype,"selectionOctree",{get:function(){return this.Ie},enumerable:!0,configurable:!0}),G.e.prototype.createOrUpdateSubmeshesOctree=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const i=this.Ua();let H=i._getComponent(Q.b.NAME_OCTREE);H||(H=new P(i),i.o(H)),this._submeshesOctree||(this._submeshesOctree=new k.c(k.c.CreationFuncForSubMeshes,a,O)),this.yb(!0);const b=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(b.minimumWorld,b.maximumWorld,this.Mb),this._submeshesOctree};class P{constructor(a){this.name=Q.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new q.c(b.ZO.Zero(),new b.ZO(1,1,1)),(a=a||I.b.LastCreatedScene)&&(this.rO=a,this.rO.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.rO.getActiveSubMeshCandidates=a=>this.getActiveSubMeshCandidates(a),this.rO.getCollidingSubMeshCandidates=(a,O)=>this.getCollidingSubMeshCandidates(a,O),this.rO.getIntersectingSubMeshCandidates=(a,O)=>this.getIntersectingSubMeshCandidates(a,O))}register(){this.rO.onMeshRemovedObservable.add((a=>{const O=this.rO.selectionOctree;if(void 0!==O&&null!==O){const i=O.Ze.indexOf(a);-1!==i&&O.Ze.splice(i,1)}})),this.rO.onMeshImportedObservable.add((a=>{const O=this.rO.selectionOctree;void 0!==O&&null!==O&&O.jP(a)}))}getActiveMeshCandidates(){var a;return(null===(a=this.rO.Ie)||void 0===a?void 0:a.select(this.rO.frustumPlanes))||this.rO._getDefaultMeshCandidates()}getActiveSubMeshCandidates(a){if(a._submeshesOctree&&a.useOctreeForRenderingSelection){return a._submeshesOctree.select(this.rO.frustumPlanes)}return this.rO._getDefaultSubMeshCandidates(a)}getIntersectingSubMeshCandidates(a,O){if(a._submeshesOctree&&a.useOctreeForPicking){q.c.TransformToRef(O,a.getWorldMatrix(),this._tempRay);return a._submeshesOctree.intersectsRay(this._tempRay)}return this.rO._getDefaultSubMeshCandidates(a)}getCollidingSubMeshCandidates(a,O){if(a._submeshesOctree&&a.useOctreeForCollisions){const i=O._velocityWorldLength+Math.max(O._radius.x,O._radius.y,O._radius.z);return a._submeshesOctree.intersects(O._basePointWorld,i)}return this.rO._getDefaultSubMeshCandidates(a)}rebuild(){}dispose(){}}},13800:(a,O,i)=>{"use strict";i.d(O,{c:()=>j});var H=i(12648),b=i(12846),G=i(12397),q=i(12395),Q=i(12403),k=i(12743),I=i(12680),P=i(12236),e=i(12708);const h={internalPickerForMesh:void 0};class j{constructor(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.e;this.origin=a,this.direction=O,this.length=i,this.epsilon=H}clone(){return new j(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const H=j._TmpVector3[0].fb(a.x-i,a.y-i,a.z-i),b=j._TmpVector3[1].fb(O.x+i,O.y+i,O.z+i);let G,q,Q,k,I=0,P=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<H.x||this.origin.x>b.x)return!1}else if(G=1/this.direction.x,q=(H.x-this.origin.x)*G,Q=(b.x-this.origin.x)*G,Q===-1/0&&(Q=1/0),q>Q&&(k=q,q=Q,Q=k),I=Math.max(q,I),P=Math.min(Q,P),I>P)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<H.y||this.origin.y>b.y)return!1}else if(G=1/this.direction.y,q=(H.y-this.origin.y)*G,Q=(b.y-this.origin.y)*G,Q===-1/0&&(Q=1/0),q>Q&&(k=q,q=Q,Q=k),I=Math.max(q,I),P=Math.min(Q,P),I>P)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<H.z||this.origin.z>b.z)return!1}else if(G=1/this.direction.z,q=(H.z-this.origin.z)*G,Q=(b.z-this.origin.z)*G,Q===-1/0&&(Q=1/0),q>Q&&(k=q,q=Q,Q=k),I=Math.max(q,I),P=Math.min(Q,P),I>P)return!1;return!0}intersectsBox(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(a.minimum,a.maximum,O)}intersectsSphere(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=a.center.x-this.origin.x,H=a.center.y-this.origin.y,b=a.center.z-this.origin.z,G=i*i+H*H+b*b,q=a.radius+O,Q=q*q;if(G<=Q)return!0;const k=i*this.direction.x+H*this.direction.y+b*this.direction.z;if(k<0)return!1;return G-k*k<=Q}intersectsTriangle(a,O,i){const H=j._TmpVector3[0],b=j._TmpVector3[1],G=j._TmpVector3[2],Q=j._TmpVector3[3],I=j._TmpVector3[4];O.subtractToRef(a,H),i.subtractToRef(a,b),q.ZO.CrossToRef(this.direction,b,G);const P=q.ZO.Dot(H,G);if(0===P)return null;const e=1/P;this.origin.subtractToRef(a,Q);const h=q.ZO.Dot(Q,G)*e;if(h<-this.epsilon||h>1+this.epsilon)return null;q.ZO.CrossToRef(Q,H,I);const Z=q.ZO.Dot(this.direction,I)*e;if(Z<-this.epsilon||h+Z>1+this.epsilon)return null;const F=q.ZO.Dot(b,I)*e;return F>this.length?null:new k.b(1-h-Z,h,F)}intersectsPlane(a){let O;const i=q.ZO.Dot(a.normal,this.direction);if(Math.abs(i)<9.99999997475243e-7)return null;{const H=q.ZO.Dot(a.normal,this.origin);return O=(-a.d-H)/i,O<0?O<-9.99999997475243e-7?null:0:O}}intersectsAxis(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(a){case"y":{const a=(this.origin.y-O)/this.direction.y;return a>0?null:new q.ZO(this.origin.x+this.direction.x*-a,O,this.origin.z+this.direction.z*-a)}case"x":{const a=(this.origin.x-O)/this.direction.x;return a>0?null:new q.ZO(O,this.origin.y+this.direction.y*-a,this.origin.z+this.direction.z*-a)}case"z":{const a=(this.origin.z-O)/this.direction.z;return a>0?null:new q.ZO(this.origin.x+this.direction.x*-a,this.origin.y+this.direction.y*-a,O)}default:return null}}intersectsMesh(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Q=q.TmpVectors.Matrix[0];return a.getWorldMatrix().invertToRef(Q),this._tmpRay?j.TransformToRef(this,Q,this._tmpRay):this._tmpRay=j.Transform(this,Q),a.intersects(this._tmpRay,O,i,H,b,G)}intersectsMeshes(a,O,i){i?i.length=0:i=[];for(let H=0;H<a.length;H++){const b=this.intersectsMesh(a[H],O);b.hit&&i.push(b)}return i.sort(this._comparePickingInfo),i}_comparePickingInfo(a,O){return a.distance<O.distance?-1:a.distance>O.distance?1:0}intersectionSegment(a,O,i){const H=this.origin,b=q.TmpVectors.ZO[0],G=q.TmpVectors.ZO[1],Q=q.TmpVectors.ZO[2],k=q.TmpVectors.ZO[3];O.subtractToRef(a,b),this.direction.scaleToRef(j._Rayl,Q),H.addToRef(Q,G),a.subtractToRef(H,k);const I=q.ZO.Dot(b,b),P=q.ZO.Dot(b,Q),e=q.ZO.Dot(Q,Q),h=q.ZO.Dot(b,k),Z=q.ZO.Dot(Q,k),F=I*e-P*P;let r,J,ma=F,M=F;F<j._Smallnum?(r=0,ma=1,J=Z,M=e):(r=P*Z-e*h,J=I*Z-P*h,r<0?(r=0,J=Z,M=e):r>ma&&(r=ma,J=Z+P,M=e)),J<0?(J=0,-h<0?r=0:-h>I?r=ma:(r=-h,ma=I)):J>M&&(J=M,-h+P<0?r=0:-h+P>I?r=ma:(r=-h+P,ma=I));const C=Math.abs(r)<j._Smallnum?0:r/ma,n=Math.abs(J)<j._Smallnum?0:J/M,D=q.TmpVectors.ZO[4];Q.scaleToRef(n,D);const U=q.TmpVectors.ZO[5];b.scaleToRef(C,U),U.addInPlace(k);const y=q.TmpVectors.ZO[6];U.subtractToRef(D,y);return n>0&&n<=this.length&&y.lengthSquared()<i*i?U.length():-1}update(a,O,i,H,b,G,Q){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){j._RayDistant||(j._RayDistant=j.Zero()),j._RayDistant.unprojectRayToRef(a,O,i,H,q.Matrix.IdentityReadOnly,G,Q);const k=q.TmpVectors.Matrix[0];b.invertToRef(k),j.TransformToRef(j._RayDistant,k,this)}else this.unprojectRayToRef(a,O,i,H,b,G,Q);return this}static Zero(){return new j(q.ZO.Zero(),q.ZO.Zero())}static CreateNew(a,O,i,H,b,G,q){return j.Zero().update(a,O,i,H,b,G,q)}static CreateNewFromTo(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.Matrix.IdentityReadOnly;const H=new j(new q.ZO(0,0,0),new q.ZO(0,0,0));return j.CreateFromToToRef(a,O,H,i)}static CreateFromToToRef(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.Matrix.IdentityReadOnly;i.origin.q(a);const b=O.subtractToRef(a,i.direction),G=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z);return i.length=G,i.direction.normalize(),j.TransformToRef(i,H,i)}static Transform(a,O){const i=new j(new q.ZO(0,0,0),new q.ZO(0,0,0));return j.TransformToRef(a,O,i),i}static TransformToRef(a,O,i){q.ZO.TransformCoordinatesToRef(a.origin,O,i.origin),q.ZO.TransformNormalToRef(a.direction,O,i.direction),i.length=a.length,i.epsilon=a.epsilon;const H=i.direction,b=H.length();if(0!==b&&1!==b){const a=1/b;H.x*=a,H.y*=a,H.z*=a,i.length*=b}return i}unprojectRayToRef(a,O,i,H,b,G,Q){const k=q.TmpVectors.Matrix[0];b.multiplyToRef(G,k),k.multiplyToRef(Q,k),k.invert();const I=P.b.LastCreatedEngine,e=q.TmpVectors.ZO[0];e.x=a/i*2-1,e.y=-(O/H*2-1),e.z=null!==I&&void 0!==I&&I.qb?1:null!==I&&void 0!==I&&I.isNDCHalfZRange?0:-1;const h=q.TmpVectors.ZO[1].fb(e.x,e.y,1-1e-8),j=q.TmpVectors.ZO[2],Z=q.TmpVectors.ZO[3];q.ZO._UnprojectFromInvertedMatrixToRef(e,k,j),q.ZO._UnprojectFromInvertedMatrixToRef(h,k,Z),this.origin.q(j),Z.subtractToRef(j,this.direction),this.direction.normalize()}}function Z(a,O,i,H,b){let G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const q=j.Zero();return F(a,O,i,H,q,b,G),q}function F(a,O,i,H,b,G){let Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const I=a.getEngine();if(!G&&!(G=a.activeCamera))return a;const P=G.viewport,e=I.getRenderHeight(),{x:h,y:j,width:Z,height:F}=P.toGlobal(I.getRenderWidth(),e),r=1/I.getHardwareScalingLevel();return O=O*r-h,i=i*r-(e-j-F),b.update(O,i,Z,F,H||q.Matrix.IdentityReadOnly,Q?q.Matrix.IdentityReadOnly:G.getViewMatrix(),G.getProjectionMatrix(),k),a}function r(a,O,i,H,b){if(!I.e)return a;const G=a.getEngine();if(!b&&!(b=a.activeCamera))throw new Error("Active camera not set");const Q=b.viewport,k=G.getRenderHeight(),{x:P,y:e,width:h,height:j}=Q.toGlobal(G.getRenderWidth(),k),Z=q.Matrix.Identity(),F=1/G.getHardwareScalingLevel();return O=O*F-P,i=i*F-(k-e-j),H.update(O,i,h,j,Z,Z,b.getProjectionMatrix()),a}function J(a,O,i,H,b,G,q,Q){const k=O(H,i.enableDistantPicking),I=i.intersects(k,b,q,G,H,Q);return I&&I.hit?!b&&null!=a&&I.distance>=a.distance?null:I:null}function ma(a,O,i,H,b,G){let Q=null;const k=!!(a.activeCameras&&a.activeCameras.length>1&&a.cameraToUseForPointers!==a.activeCamera),P=a.cameraToUseForPointers||a.activeCamera,e=h.internalPickerForMesh||J;for(let I=0;I<a.meshes.length;I++){const h=a.meshes[I];if(i){if(!i(h,-1))continue}else if(!h.isEnabled()||!h.isVisible||!h.Lk)continue;const j=k&&h.isWorldMatrixCameraDependent(),Z=h.yb(j,P);if(h.hasThinInstances&&h.BI){const a=e(Q,O,h,Z,!0,!0,G);if(a){if(b)return a;const k=q.TmpVectors.Matrix[1],I=h.thinInstanceGetWorldMatrices();for(let a=0;a<I.length;a++){if(i&&!i(h,a))continue;I[a].multiplyToRef(Z,k);const q=e(Q,O,h,k,H,b,G,!0);if(q&&(Q=q,Q.thinInstanceIndex=a,H))return Q}}}else{const a=e(Q,O,h,Z,H,b,G);if(a&&(Q=a,H))return Q}}return Q||new I.e}function M(a,O,i,H){if(!I.e)return null;const b=[],G=!!(a.activeCameras&&a.activeCameras.length>1&&a.cameraToUseForPointers!==a.activeCamera),Q=a.cameraToUseForPointers||a.activeCamera,k=h.internalPickerForMesh||J;for(let I=0;I<a.meshes.length;I++){const P=a.meshes[I];if(i){if(!i(P,-1))continue}else if(!P.isEnabled()||!P.isVisible||!P.Lk)continue;const e=G&&P.isWorldMatrixCameraDependent(),h=P.yb(e,Q);if(P.hasThinInstances&&P.BI){if(k(null,O,P,h,!0,!0,H)){const a=q.TmpVectors.Matrix[1],G=P.thinInstanceGetWorldMatrices();for(let q=0;q<G.length;q++){if(i&&!i(P,q))continue;G[q].multiplyToRef(h,a);const Q=k(null,O,P,a,!1,!1,H,!0);Q&&(Q.thinInstanceIndex=q,b.push(Q))}}}else{const a=k(null,O,P,h,!1,!1,H);a&&b.push(a)}}return b}function C(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,H=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0;H||(H=a.getWorldMatrix()),O.length=i,b?O.origin.q(b):O.origin.q(a.position);const G=q.TmpVectors.ZO[2];G.set(0,0,a._scene.useRightHandedSystem?-1:1);const Q=q.TmpVectors.ZO[3];return q.ZO.TransformNormalToRef(G,H,Q),q.ZO.NormalizeToRef(Q,O.direction),O}var n,D;j._TmpVector3=(0,Q.e)(6,q.ZO.Zero),j._RayDistant=j.Zero(),j._Smallnum=1e-8,j._Rayl=1e9,n=H.c,(D=b.e)&&(D.prototype.getForwardRay=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,O=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return C(this,new j(q.ZO.Zero(),q.ZO.Zero(),a),a,O,i)},D.prototype.getForwardRayToRef=function(a){return C(this,a,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),n&&(e.d._IsPickingAvailable=!0,n.prototype.createPickingRay=function(a,O,i,H){return Z(this,a,O,i,H,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),H.c.prototype.createPickingRayToRef=function(a,O,i,H,b){return F(this,a,O,i,H,b,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},H.c.prototype.createPickingRayInCameraSpace=function(a,O,i){return function(a,O,i,H){const b=j.Zero();return r(a,O,i,b,H),b}(this,a,O,i)},H.c.prototype.createPickingRayInCameraSpaceToRef=function(a,O,i,H){return r(this,a,O,i,H)},H.c.prototype.pickWithBoundingInfo=function(a,O,i,H,b){return function(a,O,i,H,b,G){if(!I.e)return null;const Q=ma(a,(H=>(a._tempPickingRay||(a._tempPickingRay=j.Zero()),F(a,O,i,H,a._tempPickingRay,G||null),a._tempPickingRay)),H,b,!0);return Q&&(Q.ray=Z(a,O,i,q.Matrix.Identity(),G||null)),Q}(this,a,O,i,H,b)},H.c.prototype.ei=function(a,O,i,H,b,G){return function(a,O,i,H,b,G,Q){const k=ma(a,((H,b)=>(a._tempPickingRay||(a._tempPickingRay=j.Zero()),F(a,O,i,H,a._tempPickingRay,G||null,!1,b),a._tempPickingRay)),H,b,!1,Q);return k&&(k.ray=Z(a,O,i,q.Matrix.Identity(),G||null)),k}(this,a,O,i,H,b,G)},H.c.prototype.pickWithRay=function(a,O,i,H){return function(a,O,i,H,b){const G=ma(a,(i=>(a._pickWithRayInverseMatrix||(a._pickWithRayInverseMatrix=q.Matrix.Identity()),i.invertToRef(a._pickWithRayInverseMatrix),a._cachedRayForTransform||(a._cachedRayForTransform=j.Zero()),j.TransformToRef(O,a._pickWithRayInverseMatrix,a._cachedRayForTransform),a._cachedRayForTransform)),i,H,!1,b);return G&&(G.ray=O),G}(this,a,O,i,H)},H.c.prototype.multiPick=function(a,O,i,H,b){return function(a,O,i,H,b,G){return M(a,(H=>Z(a,O,i,H,b||null)),H,G)}(this,a,O,i,H,b)},H.c.prototype.multiPickWithRay=function(a,O,i){return function(a,O,i,H){return M(a,(i=>(a._pickWithRayInverseMatrix||(a._pickWithRayInverseMatrix=q.Matrix.Identity()),i.invertToRef(a._pickWithRayInverseMatrix),a._cachedRayForTransform||(a._cachedRayForTransform=j.Zero()),j.TransformToRef(O,a._pickWithRayInverseMatrix,a._cachedRayForTransform),a._cachedRayForTransform)),i,H)}(this,a,O,i)}},14088:(a,O,i)=>{"use strict";var H=i(12317),b=i(12209),G=i(12243),q=i(12350),Q=i(12273),k=i(12334);Q.c.prototype._partialLoadFile=function(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(a,(a=>{i[O]=a,i._internalCount++,6===i._internalCount&&H(i)}),void 0,void 0,!0,((a,O)=>{b&&a&&b(a.status+" "+a.statusText,O)}))},Q.c.prototype._cascadeLoadFiles=function(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const b=[];b._internalCount=0;for(let G=0;G<6;G++)this._partialLoadFile(i[G],G,b,O,H)},Q.c.prototype._cascadeLoadImgs=function(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5?arguments[5]:void 0;const q=[];q._internalCount=0;for(let Q=0;Q<6;Q++)this._partialLoadImg(H[Q],Q,q,a,O,i,b,G)},Q.c.prototype._partialLoadImg=function(a,O,i,H,b,Q){let k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7?arguments[7]:void 0;const P=(0,q.c)();(0,G.u)(a,(a=>{i[O]=a,i._internalCount++,H&&H.removePendingData(P),6===i._internalCount&&Q&&Q(b,i)}),((a,O)=>{H&&H.removePendingData(P),k&&k(a,O)}),H?H.offlineProvider:null,I),H&&H.addPendingData(P)},Q.c.prototype.createCubeTextureBase=function(a,O,i,G){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6?arguments[6]:void 0,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]&&arguments[8],h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,j=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,Z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,r=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,J=arguments.length>14&&void 0!==arguments[14]&&arguments[14],ma=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const M=Z||new H.c(this,7);M.isCube=!0,M.url=a,M.generateMipMaps=!G,M._lodGenerationScale=h,M._lodGenerationOffset=j,M._useSRGBBuffer=!!J&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!G),M!==Z&&(M.label=a.substring(0,60)),this._doNotHandleContextLost||(M._extension=P,M._files=i,M._buffer=ma);const C=a;this._transformTextureUrl&&!Z&&(a=this._transformTextureUrl(a));const n=P??function(a){const O=a.split("?")[0],i=O.lastIndexOf(".");return i>-1?O.substring(i).toLowerCase():""}(a),D=(0,k.e)(n),U=(a,O)=>{M.dispose(),Q?Q(a,O):a&&b.c.Warn(a)},y=(H,Q)=>{a===C?H&&U(H.status+" "+H.statusText,Q):(b.c.Warn(`Failed to load ${a}, falling back to the ${C}`),this.createCubeTextureBase(C,O,i,!!G,q,U,I,P,e,h,j,M,F,r,J,ma))};if(D)D.then((H=>{const b=a=>{F&&F(M,a),H.loadCubeData(a,M,e,q,((a,O)=>{U(a,O)}))};ma?b(ma):i&&6===i.length?H.supportCascades?this._cascadeLoadFiles(O,(a=>b(a.map((a=>new Uint8Array(a))))),i,U):U("Textures type does not support cascades."):this._loadFile(a,(a=>b(new Uint8Array(a))),void 0,void 0,!0,y)}));else{if(!i||0===i.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(O,M,((a,O)=>{r&&r(a,O)}),i,U)}return this._internalTexturesCache.push(M),M}},14646:(a,O,i)=>{"use strict";i(12209);var H=i(12528);i(12317),i(12477),i(12308),i(12581),i(12539);H.b},14115:(a,O,i)=>{"use strict";i.d(O,{d:()=>b});var H=i(12346);class b{constructor(a){this.value=this._toInt(a)}_toInt(a){return 0|a}add(a){return new b(this.value+a.value)}FO(a){return new b(this.value-a.value)}multiply(a){return new b(Math.imul(this.value,a.value))}divide(a){return new b(this.value/a.value)}getClassName(){return b.ClassName}equals(a){return this.value===a.value}static FromValue(a){return new b(a)}toString(){return this.value.toString()}}b.ClassName="FlowGraphInteger",(0,H.h)("FlowGraphInteger",b)},14126:(a,O,i)=>{"use strict";i.d(O,{c:()=>b,d:()=>G});var H=i(12395);class b{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.jb=a}get m(){return this.jb}transformVector(a){return this.transformVectorToRef(a,new H.Vector2)}transformVectorToRef(a,O){return O.x=a.x*this.jb[0]+a.y*this.jb[1],O.y=a.x*this.jb[2]+a.y*this.jb[3],O}Cb(){return this.toArray()}toArray(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let O=0;O<4;O++)a[O]=this.jb[O];return a}hi(a){for(let O=0;O<4;O++)this.jb[O]=a[O];return this}multiplyToRef(a,O){const i=a.jb,H=this.jb,b=O.jb;return b[0]=i[0]*H[0]+i[1]*H[2],b[1]=i[0]*H[1]+i[1]*H[3],b[2]=i[2]*H[0]+i[3]*H[2],b[3]=i[2]*H[1]+i[3]*H[3],O}multiply(a){return this.multiplyToRef(a,new b)}divideToRef(a,O){const i=this.jb,H=a.jb,b=O.jb;return b[0]=i[0]/H[0],b[1]=i[1]/H[1],b[2]=i[2]/H[2],b[3]=i[3]/H[3],O}divide(a){return this.divideToRef(a,new b)}addToRef(a,O){const i=this.jb,H=a.m,b=O.m;return b[0]=i[0]+H[0],b[1]=i[1]+H[1],b[2]=i[2]+H[2],b[3]=i[3]+H[3],O}add(a){return this.addToRef(a,new b)}subtractToRef(a,O){const i=this.jb,H=a.m,b=O.m;return b[0]=i[0]-H[0],b[1]=i[1]-H[1],b[2]=i[2]-H[2],b[3]=i[3]-H[3],O}FO(a){return this.subtractToRef(a,new b)}transpose(){const a=this.jb;return new b([a[0],a[2],a[1],a[3]])}determinant(){const a=this.jb;return a[0]*a[3]-a[1]*a[2]}inverse(){const a=this.determinant();if(0===a)throw new Error("Matrix is not invertible");const O=this.jb,i=1/a;return new b([O[3]*i,-O[1]*i,-O[2]*i,O[0]*i])}equals(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.jb,H=a.m;return 0===O?i[0]===H[0]&&i[1]===H[1]&&i[2]===H[2]&&i[3]===H[3]:Math.abs(i[0]-H[0])<O&&Math.abs(i[1]-H[1])<O&&Math.abs(i[2]-H[2])<O&&Math.abs(i[3]-H[3])<O}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.jb.join(", ")})`}}class G{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.jb=a}get m(){return this.jb}transformVector(a){return this.transformVectorToRef(a,new H.ZO)}transformVectorToRef(a,O){const i=this.jb;return O.x=a.x*i[0]+a.y*i[1]+a.z*i[2],O.y=a.x*i[3]+a.y*i[4]+a.z*i[5],O.z=a.x*i[6]+a.y*i[7]+a.z*i[8],O}multiplyToRef(a,O){const i=a.jb,H=this.jb,b=O.m;return b[0]=i[0]*H[0]+i[1]*H[3]+i[2]*H[6],b[1]=i[0]*H[1]+i[1]*H[4]+i[2]*H[7],b[2]=i[0]*H[2]+i[1]*H[5]+i[2]*H[8],b[3]=i[3]*H[0]+i[4]*H[3]+i[5]*H[6],b[4]=i[3]*H[1]+i[4]*H[4]+i[5]*H[7],b[5]=i[3]*H[2]+i[4]*H[5]+i[5]*H[8],b[6]=i[6]*H[0]+i[7]*H[3]+i[8]*H[6],b[7]=i[6]*H[1]+i[7]*H[4]+i[8]*H[7],b[8]=i[6]*H[2]+i[7]*H[5]+i[8]*H[8],O}multiply(a){return this.multiplyToRef(a,new G)}divideToRef(a,O){const i=this.jb,H=a.m,b=O.m;return b[0]=i[0]/H[0],b[1]=i[1]/H[1],b[2]=i[2]/H[2],b[3]=i[3]/H[3],b[4]=i[4]/H[4],b[5]=i[5]/H[5],b[6]=i[6]/H[6],b[7]=i[7]/H[7],b[8]=i[8]/H[8],O}divide(a){return this.divideToRef(a,new G)}addToRef(a,O){const i=this.jb,H=a.m,b=O.m;return b[0]=i[0]+H[0],b[1]=i[1]+H[1],b[2]=i[2]+H[2],b[3]=i[3]+H[3],b[4]=i[4]+H[4],b[5]=i[5]+H[5],b[6]=i[6]+H[6],b[7]=i[7]+H[7],b[8]=i[8]+H[8],O}add(a){return this.addToRef(a,new G)}subtractToRef(a,O){const i=this.jb,H=a.m,b=O.m;return b[0]=i[0]-H[0],b[1]=i[1]-H[1],b[2]=i[2]-H[2],b[3]=i[3]-H[3],b[4]=i[4]-H[4],b[5]=i[5]-H[5],b[6]=i[6]-H[6],b[7]=i[7]-H[7],b[8]=i[8]-H[8],O}FO(a){return this.subtractToRef(a,new G)}toArray(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let O=0;O<9;O++)a[O]=this.jb[O];return a}Cb(){return this.toArray()}hi(a){for(let O=0;O<9;O++)this.jb[O]=a[O];return this}transpose(){const a=this.jb;return new G([a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]])}determinant(){const a=this.jb;return a[0]*(a[4]*a[8]-a[5]*a[7])-a[1]*(a[3]*a[8]-a[5]*a[6])+a[2]*(a[3]*a[7]-a[4]*a[6])}inverse(){const a=this.determinant();if(0===a)throw new Error("Matrix is not invertible");const O=this.jb,i=1/a;return new G([(O[4]*O[8]-O[5]*O[7])*i,(O[2]*O[7]-O[1]*O[8])*i,(O[1]*O[5]-O[2]*O[4])*i,(O[5]*O[6]-O[3]*O[8])*i,(O[0]*O[8]-O[2]*O[6])*i,(O[2]*O[3]-O[0]*O[5])*i,(O[3]*O[7]-O[4]*O[6])*i,(O[1]*O[6]-O[0]*O[7])*i,(O[0]*O[4]-O[1]*O[3])*i])}equals(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this.jb,H=a.m;return 0===O?i[0]===H[0]&&i[1]===H[1]&&i[2]===H[2]&&i[3]===H[3]&&i[4]===H[4]&&i[5]===H[5]&&i[6]===H[6]&&i[7]===H[7]&&i[8]===H[8]:Math.abs(i[0]-H[0])<O&&Math.abs(i[1]-H[1])<O&&Math.abs(i[2]-H[2])<O&&Math.abs(i[3]-H[3])<O&&Math.abs(i[4]-H[4])<O&&Math.abs(i[5]-H[5])<O&&Math.abs(i[6]-H[6])<O&&Math.abs(i[7]-H[7])<O&&Math.abs(i[8]-H[8])<O}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.jb.join(", ")})`}}},14130:(a,O,i)=>{"use strict";var H;function b(a,O,i,H){switch(O){case"Animation":return H?a.animations.find((a=>a.uniqueId===i))??null:a.animations[i]??null;case"AnimationGroup":return H?a.animationGroups.find((a=>a.uniqueId===i))??null:a.animationGroups[i]??null;case"Mesh":return H?a.meshes.find((a=>a.uniqueId===i))??null:a.meshes[i]??null;case"Material":return H?a.materials.find((a=>a.uniqueId===i))??null:a.materials[i]??null;case"nP":return H?a.cameras.find((a=>a.uniqueId===i))??null:a.cameras[i]??null;case"Light":return H?a.lights.find((a=>a.uniqueId===i))??null:a.lights[i]??null;default:return null}}i.d(O,{e:()=>b}),function(a){a.Animation="Animation",a.AnimationGroup="AnimationGroup",a.Mesh="Mesh",a.Material="Material",a.nP="nP",a.Light="Light"}(H||(H={}))},14159:(a,O,i)=>{"use strict";i.d(O,{c:()=>b});var H=i(14164);class b extends H.c{constructor(a,O){if(super(a),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),O)for(const i of O)this._eventsSignalOutputs[i]=this._registerSignalOutput(i+"Event")}_executeOnTick(a){}_startPendingTasks(a){a._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(a),this._resetAfterCanceled(a)),this._preparePendingTasks(a),a._addPendingBlock(this),this.out._activateSignal(a),a._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(a){a._deleteExecutionVariable(this,"_initialized"),a._removePendingBlock(this)}}},14139:(a,O,i)=>{"use strict";i.d(O,{c:()=>I});var H=i(12350),b=i(12346),G=i(14147),q=i(12193),Q=i(14113);class k extends G.c{constructor(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:H.defaultValue,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(a,O,i),this.richType=H,this._defaultValue=b,this._optional=G,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new q.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(a){this._isDisabled!==a&&(this._isDisabled=a,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(a,O){O._getConnectionValue(this)!==a&&(O._setConnectionValue(this,a),this.onValueChangedObservable.notifyObservers(a))}resetToDefaultValue(a){a._setConnectionValue(this,this._defaultValue)}connectTo(a){this._isDisabled||super.connectTo(a)}_getValueOrDefault(a){const O=a._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(O):O}getValue(a){if(1===this.connectionType){a._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(a);const O=this._getValueOrDefault(a);return this._lastValue=O,this.richType.typeTransformer?this.richType.typeTransformer(O):O}const O=this.isConnected()?this._connectedPoint[0].getValue(a):this._getValueOrDefault(a);return this._lastValue=O,this.richType.typeTransformer?this.richType.typeTransformer(O):O}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(a),a.richType={},this.richType.serialize(a.richType),a.optional=this._optional,(0,Q.f)("defaultValue",this._defaultValue,a)}}(0,b.h)("FlowGraphDataConnection",k);class I{constructor(a){var O;this.config=a,this.uniqueId=(0,H.c)(),this.name=(null===(O=this.config)||void 0===O?void 0:O.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(a){}registerDataInput(a,O,i){const H=new k(a,0,this,O,i);return this.dataInputs.push(H),H}registerDataOutput(a,O,i){const H=new k(a,1,this,O,i);return this.dataOutputs.push(H),H}getDataInput(a){return this.dataInputs.find((O=>O.name===a))}getDataOutput(a){return this.dataOutputs.find((O=>O.name===a))}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q.f;if(a.uniqueId=this.uniqueId,a.config={},this.config){const i=this.config,H=Object.keys(i);for(const b of H)O(b,i[b],a.config)}a.dataInputs=[],a.dataOutputs=[],a.className=this.getClassName();for(const i of this.dataInputs){const O={};i.serialize(O),a.dataInputs.push(O)}for(const i of this.dataOutputs){const O={};i.serialize(O),a.dataOutputs.push(O)}}deserialize(a){}_log(a,O,i){var H;null===(H=a.logger)||void 0===H||H.addLogItem({action:O,ji:i,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14147:(a,O,i)=>{"use strict";i.d(O,{c:()=>G});var H,b=i(12350);!function(a){a[a.Input=0]="Input",a[a.Output=1]="Output"}(H||(H={}));class G{constructor(a,O,i){this._ownerBlock=i,this._connectedPoint=[],this.uniqueId=(0,b.c)(),this.connectedPointIds=[],this.name=a,this._connectionType=O}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(a){if(this._connectionType===a._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||a._isSingularConnection()&&a._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(a),a._connectedPoint.push(this)}disconnectFrom(a){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this._connectedPoint.indexOf(a),H=a._connectedPoint.indexOf(this);-1!==i&&-1!==H&&(O&&this._connectedPoint.splice(i,1),a._connectedPoint.splice(H,1))}disconnectFromAll(){for(const a of this._connectedPoint)this.disconnectFrom(a,!1);this._connectedPoint.length=0}dispose(){for(const a of this._connectedPoint)this.disconnectFrom(a)}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.uniqueId=this.uniqueId,a.name=this.name,a._connectionType=this._connectionType,a.connectedPointIds=[],a.className=this.getClassName();for(const O of this._connectedPoint)a.connectedPointIds.push(O.uniqueId)}getClassName(){return"FGConnection"}deserialize(a){this.uniqueId=a.uniqueId,this.name=a.name,this._connectionType=a._connectionType,this.connectedPointIds=a.connectedPointIds}}},14107:(a,O,i)=>{"use strict";i.d(O,{b:()=>M});var H,b=i(12193),G=i(12375),q=i(12384),Q=i(12350),k=i(14113),I=i(14130),P=i(12209);!function(a){a.ExecuteBlock="ExecuteBlock",a.ExecuteEvent="ExecuteEvent",a.TriggerConnection="TriggerConnection",a.ContextVariableSet="ContextVariableSet",a.GlobalVariableSet="GlobalVariableSet",a.GlobalVariableDelete="GlobalVariableDelete",a.GlobalVariableGet="GlobalVariableGet",a.AddConnection="AddConnection",a.GetConnectionValue="GetConnectionValue",a.SetConnectionValue="SetConnectionValue",a.ActivateSignal="ActivateSignal",a.ContextVariableGet="ContextVariableGet"}(H||(H={}));class e{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(a){if(a.time||(a.time=Date.now()),this.log.push(a),this.logToConsole){var O;const i=null===(O=a.ji)||void 0===O?void 0:O.value;"object"===typeof i&&i.getClassName?P.c.Log(`[FGLog] ${a.className}:${a.uniqueId.split("-")[0]} ${a.action} - ${JSON.stringify(i.getClassName())}: ${i.toString()}`):P.c.Log(`[FGLog] ${a.className}:${a.uniqueId.split("-")[0]} ${a.action} - ${JSON.stringify(a.ji)}`)}}getItemsOfType(a){return this.log.filter((O=>O.action===a))}}class h{get enableLogging(){return this._enableLogging}set enableLogging(a){this._enableLogging!==a&&(this._enableLogging=a,this._enableLogging?(this.logger=new e,this.logger.logToConsole=!0):this.logger=null)}constructor(a){this.uniqueId=(0,Q.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new b.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=a,this.assetsContext=a.assetsContext??a.rO}hasVariable(a){return a in this._userVariables}setVariable(a,O){var i;this._userVariables[a]=O,null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",ji:{name:a,value:O}})}getAsset(a,O){return(0,I.e)(this.assetsContext,a,O)}getVariable(a){var O;return null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",ji:{name:a,value:this._userVariables[a]}}),this._userVariables[a]}get userVariables(){return this._userVariables}Ua(){return this._configuration.rO}_getUniqueIdPrefixedName(a,O){return`${a.uniqueId}_${O}`}_getGlobalContextVariable(a,O){var i;return null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",ji:{name:a,defaultValue:O,possibleValue:this._globalContextVariables[a]}}),this._hasGlobalContextVariable(a)?this._globalContextVariables[a]:O}_setGlobalContextVariable(a,O){var i;null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",ji:{name:a,value:O}}),this._globalContextVariables[a]=O}_deleteGlobalContextVariable(a){var O;null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",ji:{name:a}}),delete this._globalContextVariables[a]}_hasGlobalContextVariable(a){return a in this._globalContextVariables}_setExecutionVariable(a,O,i){this._executionVariables[this._getUniqueIdPrefixedName(a,O)]=i}_getExecutionVariable(a,O,i){return this._hasExecutionVariable(a,O)?this._executionVariables[this._getUniqueIdPrefixedName(a,O)]:i}_deleteExecutionVariable(a,O){delete this._executionVariables[this._getUniqueIdPrefixedName(a,O)]}_hasExecutionVariable(a,O){return this._getUniqueIdPrefixedName(a,O)in this._executionVariables}_hasConnectionValue(a){return a.uniqueId in this._connectionValues}_setConnectionValue(a,O){var i;this._connectionValues[a.uniqueId]=O,null===(i=this.logger)||void 0===i||i.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",ji:{connectionPointId:a.uniqueId,value:O}})}_setConnectionValueByKey(a,O){this._connectionValues[a]=O}_getConnectionValue(a){var O;return null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",ji:{connectionPointId:a.uniqueId,value:this._connectionValues[a.uniqueId]}}),this._connectionValues[a.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(a){this._pendingBlocks.includes(a)||(this._pendingBlocks.push(a),this._pendingBlocks.sort(((a,O)=>a.priority-O.priority)))}_removePendingBlock(a){const O=this._pendingBlocks.indexOf(a);-1!==O&&this._pendingBlocks.splice(O,1)}_clearPendingBlocks(){for(const a of this._pendingBlocks)a._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(a){var O;this.onNodeExecutedObservable.notifyObservers(a),null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:a.getClassName(),uniqueId:a.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(a){this._setGlobalContextVariable("timeSinceStart",a.timeSinceStart),this._setGlobalContextVariable("deltaTime",a.deltaTime);for(const i of this._pendingBlocks){var O;null===(O=i._executeOnTick)||void 0===O||O.call(i,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.f;a.uniqueId=this.uniqueId,a._userVariables={};for(const H in this._userVariables)O(H,this._userVariables[H],a._userVariables);a._connectionValues={};for(const H in this._connectionValues)O(H,this._connectionValues[H],a._connectionValues);var i;this.assetsContext!==this.Ua()&&(a._assetsContext={meshes:this.assetsContext.meshes.map((a=>a.id)),materials:this.assetsContext.materials.map((a=>a.id)),textures:this.assetsContext.textures.map((a=>a.name)),animations:this.assetsContext.animations.map((a=>a.name)),lights:this.assetsContext.lights.map((a=>a.id)),cameras:this.assetsContext.cameras.map((a=>a.id)),Mj:null===(i=this.assetsContext.Mj)||void 0===i?void 0:i.map((a=>a.name)),skeletons:this.assetsContext.skeletons.map((a=>a.id)),Eh:this.assetsContext.Eh.map((a=>a.name)),geometries:this.assetsContext.geometries.map((a=>a.id)),multiMaterials:this.assetsContext.multiMaterials.map((a=>a.id)),transformNodes:this.assetsContext.transformNodes.map((a=>a.id))})}getClassName(){return"FlowGraphContext"}}(0,G.c)([(0,q.G)()],h.prototype,"uniqueId",void 0);var j=i(14132),Z=i(12689);class F{constructor(a){this.onEventTriggeredObservable=new b.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=a,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Pb.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const a=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",ji:{timeSinceStart:this._startingTime,deltaTime:a}}),this._startingTime+=a})),this._meshPickedObserver=this._scene.onPointerObservable.add((a=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",ji:a})}),Z.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((a=>{const O=a.pointerId,i=a.mesh,H=this._pointerUnderMeshState[O];!H&&i?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",ji:{pointerId:O,mesh:i}}):H&&!i?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",ji:{pointerId:O,mesh:H}}):H&&i&&H!==i&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",ji:{pointerId:O,mesh:H,over:i}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",ji:{pointerId:O,mesh:i,out:H}})),this._pointerUnderMeshState[O]=i}),Z.c.POINTERMOVE)}dispose(){var a,O,i,H,b;null===(a=this._sceneDisposeObserver)||void 0===a||a.remove(),null===(O=this._sceneReadyObserver)||void 0===O||O.remove(),null===(i=this._sceneOnBeforeRenderObserver)||void 0===i||i.remove(),null===(H=this._meshPickedObserver)||void 0===H||H.remove(),null===(b=this._meshUnderPointerObserver)||void 0===b||b.remove(),this.onEventTriggeredObservable.clear()}}var r,J=i(14152);!function(a){a[a.Stopped=0]="Stopped",a[a.Started=1]="Started"}(r||(r={}));class ma{get state(){return this._state}set state(a){this._state=a,this.onStateChangedObservable.notifyObservers(a)}constructor(a){this.onStateChangedObservable=new b.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=a.rO,this._sceneEventCoordinator=new F(this._scene),this._coordinator=a.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((a=>{for(const O of this._executionContexts){const i=this._getContextualOrder(a.type,O);for(const H of i)if(!H._executeEvent(O,a.ji))break}switch(a.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const O of this._executionContexts)O._notifyOnTick(a.ji);break;case"SceneDispose":this.dispose()}}))}createContext(){const a=new h({rO:this._scene,coordinator:this._coordinator});return this._executionContexts.push(a),a}getContext(a){return this._executionContexts[a]}addEventBlock(a){if("PointerOver"!==a.type&&"PointerOut"!==a.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==a.type&&this._eventBlocks[a.type].push(a),1===this.state)for(const O of this._executionContexts)a._startPendingTasks(O);else this.onStateChangedObservable.addOnce((O=>{if(1===O)for(const i of this._executionContexts)a._startPendingTasks(i)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((a=>{1===a&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const a of this._executionContexts)for(const O in this._eventBlocks){const i=this._getContextualOrder(O,a);for(const O of i)O._startPendingTasks(a)}}_getContextualOrder(a,O){const i=this._eventBlocks[a].sort(((a,O)=>O.initPriority-a.initPriority));if("MeshPick"===a){const a=[];for(const H of i){const b=H.asset.getValue(O);let G=0;for(;G<i.length;G++){const a=i[G].asset.getValue(O);if(b&&a&&(0,J.m)(b,a))break}a.splice(G,0,H)}return a}return i}dispose(){var a;if(0!==this.state){this.state=0;for(const a of this._executionContexts)a._clearPendingBlocks();this._executionContexts.length=0;for(const a in this._eventBlocks)this._eventBlocks[a].length=0;null===(a=this._eventObserver)||void 0===a||a.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(a){const O=[],i=new Set;for(const H in this._eventBlocks)for(const a of this._eventBlocks[H])O.push(a),i.add(a.uniqueId);for(;O.length>0;){const H=O.pop();a(H);for(const a of H.dataInputs)for(const H of a._connectedPoint)i.has(H._ownerBlock.uniqueId)||(O.push(H._ownerBlock),i.add(H._ownerBlock.uniqueId));if(H instanceof j.c)for(const a of H.signalOutputs)for(const H of a._connectedPoint)i.has(H._ownerBlock.uniqueId)||(O.push(H._ownerBlock),i.add(H._ownerBlock.uniqueId))}}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1?arguments[1]:void 0;a.allBlocks=[],this.visitAllBlocks((O=>{const i={};O.serialize(i),a.allBlocks.push(i)})),a.executionContexts=[];for(const i of this._executionContexts){const H={};i.serialize(H,O),a.executionContexts.push(H)}}}class M{constructor(a){this.config=a,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.rO.Pb.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.rO.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const a=this._executeOnNextFrame.slice(0);if(a.length)for(const O of a){this.notifyCustomEvent(O.id,O.data,!1);const a=this._executeOnNextFrame.findIndex((a=>a.uniqueId===O.uniqueId));-1!==a&&this._executeOnNextFrame.splice(a,1)}}));(M.SceneCoordinators.get(this.config.rO)??[]).push(this)}createGraph(){const a=new ma({rO:this.config.rO,coordinator:this});return this._flowGraphs.push(a),a}removeGraph(a){const O=this._flowGraphs.indexOf(a);-1!==O&&(a.dispose(),this._flowGraphs.splice(O,1))}start(){for(const a of this._flowGraphs)a.start()}dispose(){var a,O;for(const b of this._flowGraphs)b.dispose();this._flowGraphs.length=0,null===(a=this._disposeObserver)||void 0===a||a.remove(),null===(O=this._onBeforeRenderObserver)||void 0===O||O.remove();const i=M.SceneCoordinators.get(this.config.rO)??[],H=i.indexOf(this);-1!==H&&i.splice(H,1)}serialize(a,O){a._flowGraphs=[];for(const i of this._flowGraphs){const H={};i.serialize(H,O),a._flowGraphs.push(H)}a.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(a){let O=this._customEventsMap.get(a);return O||(O=new b.e,this._customEventsMap.set(a,O)),O}notifyCustomEvent(a,O){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:a,data:O,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(a)){const O=this._eventExecutionCounter.get(a);if(this._eventExecutionCounter.set(a,O+1),O>=M.MaxEventTypeExecutionPerFrame)return void(O===M.MaxEventTypeExecutionPerFrame&&P.c.Warn(`FlowGraphCoordinator: Too many executions of event "${a}".`))}else this._eventExecutionCounter.set(a,1);const i=this._customEventsMap.get(a);i&&i.notifyObservers(O)}}M.MaxEventsPerType=30,M.MaxEventTypeExecutionPerFrame=30,M.SceneCoordinators=new Map},14157:(a,O,i)=>{"use strict";i.d(O,{c:()=>b});var H=i(14159);class b extends H.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(a){a._notifyExecuteNode(this),this.done._activateSignal(a)}}},14132:(a,O,i)=>{"use strict";i.d(O,{c:()=>Q});var H=i(14139),b=i(14147),G=i(12346);class q extends b.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(a){super.connectTo(a),this._connectedPoint.sort(((a,O)=>O.priority-a.priority))}_activateSignal(a){var O;if(null===(O=a.logger)||void 0===O||O.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,ji:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)a._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(a,this),a._increaseExecutionId();else for(const i of this._connectedPoint)i._activateSignal(a)}}(0,G.h)("FlowGraphSignalConnection",q);class Q extends H.c{constructor(a){super(a),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(a){const O=new q(a,0,this);return this.signalInputs.push(O),O}_registerSignalOutput(a){const O=new q(a,1,this);return this.signalOutputs.push(O),O}_unregisterSignalInput(a){const O=this.signalInputs.findIndex((O=>O.name===a));-1!==O&&(this.signalInputs[O].dispose(),this.signalInputs.splice(O,1))}_unregisterSignalOutput(a){const O=this.signalOutputs.findIndex((O=>O.name===a));-1!==O&&(this.signalOutputs[O].dispose(),this.signalOutputs.splice(O,1))}_reportError(a,O){this.error.ji="string"===typeof O?new Error(O):O,this.error._activateSignal(a)}getSignalInput(a){return this.signalInputs.find((O=>O.name===a))}getSignalOutput(a){return this.signalOutputs.find((O=>O.name===a))}serialize(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(a),a.signalInputs=[],a.signalOutputs=[];for(const O of this.signalInputs){const i={};O.serialize(i),a.signalInputs.push(i)}for(const O of this.signalOutputs){const i={};O.serialize(i),a.signalOutputs.push(i)}}deserialize(a){for(let O=0;O<a.signalInputs.length;O++){const i=this.getSignalInput(a.signalInputs[O].name);if(!i)throw new Error("Could not find signal input with name "+a.signalInputs[O].name+" in block "+a.className);i.deserialize(a.signalInputs[O])}for(let O=0;O<a.signalOutputs.length;O++){const i=this.getSignalOutput(a.signalOutputs[O].name);if(!i)throw new Error("Could not find signal output with name "+a.signalOutputs[O].name+" in block "+a.className);i.deserialize(a.signalOutputs[O])}}getClassName(){return"FlowGraphExecutionBlock"}}},14164:(a,O,i)=>{"use strict";i.d(O,{c:()=>b});var H=i(14132);class b extends H.c{constructor(a){super(a),this.out=this._registerSignalOutput("out")}}},14124:(a,O,i)=>{"use strict";i.d(O,{B:()=>j,E:()=>Z,I:()=>F,M:()=>w,Q:()=>K,T:()=>y,U:()=>U,e:()=>I,h:()=>h,l:()=>D,p:()=>r,r:()=>J,s:()=>ma,t:()=>e,v:()=>n,z:()=>P});var H,b=i(12395),G=i(12436),q=i(14115),Q=i(14126);!function(a){a.Any="any",a.String="string",a.Number="number",a.Boolean="boolean",a.Object="object",a.Integer="FlowGraphInteger",a.Vector2="Vector2",a.ZO="ZO",a.Vector4="Vector4",a.Quaternion="Quaternion",a.Matrix="Matrix",a.Matrix2D="Matrix2D",a.Matrix3D="Matrix3D",a.mi="mi",a.Ab="Ab"}(H||(H={}));class k{constructor(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=a,this.defaultValue=O,this.animationType=i}serialize(a){a.typeName=this.typeName,a.defaultValue=this.defaultValue}}const I=new k("any",void 0),P=new k("string",""),e=new k("number",0,0),h=new k("boolean",!1),j=new k("Vector2",b.Vector2.Zero(),5),Z=new k("ZO",b.ZO.Zero(),1),F=new k("Vector4",b.Vector4.Zero()),r=new k("Matrix",b.Matrix.Identity(),3),J=new k("Matrix2D",new Q.c),ma=new k("Matrix3D",new Q.d),M=new k("mi",G.mi.Black(),4),C=new k("Ab",new G.Ab(0,0,0,0),7),n=new k("Quaternion",b.Quaternion.Identity(),2);n.typeTransformer=a=>{if(a.getClassName){if("Vector4"===a.getClassName())return b.Quaternion.MO(a.Cb());if("ZO"===a.getClassName())return b.Quaternion.FromEulerVector(a);if("Matrix"===a.getClassName())return b.Quaternion.FromRotationMatrix(a)}return a};const D=new k("FlowGraphInteger",new q.d(0),0);function U(a){const O=a;switch(typeof a){case"string":return P;case"number":return e;case"boolean":return h;case"object":if(O.getClassName)switch(O.getClassName()){case"Vector2":return j;case"ZO":return Z;case"Vector4":return F;case"Matrix":return r;case"mi":return M;case"Ab":return C;case"Quaternion":return n;case"FlowGraphInteger":return D;case"Matrix2D":return J;case"Matrix3D":return ma}return I;default:return I}}function y(a){switch(a){case"string":return P;case"number":return e;case"boolean":return h;case"Vector2":return j;case"ZO":return Z;case"Vector4":return F;case"Matrix":return r;case"mi":return M;case"Ab":return C;case"Quaternion":return n;case"FlowGraphInteger":return D;case"Matrix2D":return J;case"Matrix3D":return ma;default:return I}}function w(a){switch(a){case"number":default:return 0;case"Vector2":return 5;case"ZO":return 1;case"Matrix":return 3;case"mi":return 4;case"Ab":return 7;case"Quaternion":return 2}}function K(a){switch(a){case 0:return e;case 5:return j;case 1:return Z;case 3:return r;case 4:return M;case 7:return C;case 2:return n;default:return I}}},14113:(a,O,i)=>{"use strict";i.d(O,{c:()=>P,f:()=>I,h:()=>e});var H=i(12436),b=i(12395),G=i(14115),q=i(14124),Q=i(14126);function k(a){return"Vector2"===a||"ZO"===a||"Vector4"===a||"Quaternion"===a||"mi"===a||"Ab"===a}function I(a,O,i){var H;const b=(null===O||void 0===O||null===(H=O.getClassName)||void 0===H?void 0:H.call(O))??"";if(k(b)||function(a){return"Matrix"===a||"Matrix2D"===a||"Matrix3D"===a}(b))i[a]={value:O.Cb(),className:b};else if("FlowGraphInteger"===b)i[a]={value:O.value,className:b};else if(b&&(O.id||O.name))i[a]={id:O.id,name:O.name,className:b};else{if("object"===typeof O)throw new Error(`Could not serialize value ${O}`);i[a]=O}}function P(a,O,i,I){const e=O[a];let h;const j=(null===e||void 0===e?void 0:e.type)??(null===e||void 0===e?void 0:e.className);if(function(a){return"Mesh"===a||"AbstractMesh"===a||"GroundMesh"===a||"InstanceMesh"===a||"LinesMesh"===a||"GoldbergMesh"===a||"GreasedLineMesh"===a||"TrailMesh"===a}(j)){let a=I.meshes.filter((a=>e.id?a.id===e.id:a.name===e.name));0===a.length&&(a=I.transformNodes.filter((a=>e.id?a.id===e.id:a.name===e.name))),h=e.uniqueId?a.find((a=>a.uniqueId===e.uniqueId)):a[0]}else if(k(j))h=function(a,O){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===a)return b.Vector2.MO(O);if("ZO"===a)return i&&(O[2]*=-1),b.ZO.MO(O);if("Vector4"===a)return b.Vector4.MO(O);if("Quaternion"===a)return i&&(O[2]*=-1,O[3]*=-1),b.Quaternion.MO(O);if("mi"===a)return new H.mi(O[0],O[1],O[2]);if("Ab"===a)return new H.Ab(O[0],O[1],O[2],O[3]);throw new Error(`Unknown vector class name ${a}`)}(j,e.value);else if(function(a){return"AnimationGroup"===a}(j)){const a=I.animationGroups.filter((a=>a.name===e.name));h=1===a.length?a[0]:a.find((a=>a.uniqueId===e.uniqueId))}else h="Matrix"===j?b.Matrix.MO(e.value):"Matrix2D"===j?new Q.c(e.value):"Matrix3D"===j?new Q.d(e.value):"FlowGraphInteger"===j?G.d.FromValue(e.value):"number"===j||"string"===j||"boolean"===j?e.value[0]:e&&void 0!==e.value?e.value:Array.isArray(e)?e.reduce(((a,O)=>O.eventData?(a[O.id]={type:(0,q.T)(O.type)},"undefined"!==typeof O.value&&(a[O.id].value=P("value",O,i,I)),a):a),{}):e;return h}function e(a){return"FlowGraphJsonPointerParserBlock"===a}},14152:(a,O,i)=>{"use strict";function H(a,O){return!(!a.parent||a.parent!==O&&!H(a.parent,O))}function b(a){if(a.getClassName)return a.getClassName()}function G(a,O){return a===O&&("Vector2"===a||"ZO"===a||"Vector4"===a||"Quaternion"===a)}function q(a,O){return a===O&&("Matrix"===a||"Matrix2D"===a||"Matrix3D"===a)}function Q(a,O){return"FlowGraphInteger"===a&&"FlowGraphInteger"===O}function k(a,O){const i="number"===typeof a||"number"===typeof(null===a||void 0===a?void 0:a.value);return i&&!O?!isNaN(I(a)):i}function I(a){return"number"===typeof a?a:a.value}i.d(O,{b:()=>Q,c:()=>q,f:()=>G,i:()=>b,m:()=>H,n:()=>I,r:()=>k})},13506:(a,O,i)=>{"use strict";i.r(O),i.d(O,{SceneInstrumentation:()=>G});var H=i(12184),b=i(12622);class G{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(a){a!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=a,a?(this._onBeforeActiveMeshesEvaluationObserver=this.rO.onBeforeActiveMeshesEvaluationObservable.add((()=>{H.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.rO.onAfterActiveMeshesEvaluationObservable.add((()=>{H.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.rO.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.rO.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(a){a!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=a,a?(this._onBeforeRenderTargetsRenderObserver=this.rO.onBeforeRenderTargetsRenderObservable.add((()=>{H.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.rO.onAfterRenderTargetsRenderObservable.add((()=>{H.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.rO.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.rO.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(a){a!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=a,a?(this._onBeforeParticlesRenderingObserver=this.rO.onBeforeParticlesRenderingObservable.add((()=>{H.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.rO.onAfterParticlesRenderingObservable.add((()=>{H.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.rO.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.rO.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(a){a!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=a,this.rO.spriteManagers&&(a?(this._onBeforeSpritesRenderingObserver=this.rO.onBeforeSpritesRenderingObservable.add((()=>{H.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.rO.onAfterSpritesRenderingObservable.add((()=>{H.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.rO.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.rO.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(a){a!==this._capturePhysicsTime&&this.rO.onBeforePhysicsObservable&&(this._capturePhysicsTime=a,a?(this._onBeforePhysicsObserver=this.rO.onBeforePhysicsObservable.add((()=>{H.Tools.StartPerformanceCounter("Xb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.rO.onAfterPhysicsObservable.add((()=>{H.Tools.EndPerformanceCounter("Xb"),this._physicsTime.endMonitoring()}))):(this.rO.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.rO.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(a){a!==this._captureAnimationsTime&&(this._captureAnimationsTime=a,a?this._onAfterAnimationsObserver=this.rO.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.rO.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(a){this._captureFrameTime=a}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(a){this._captureInterFrameTime=a}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(a){a!==this._captureRenderTime&&(this._captureRenderTime=a,a?(this._onBeforeDrawPhaseObserver=this.rO.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),H.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.rO.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),H.Tools.EndPerformanceCounter("Main render")}))):(this.rO.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.rO.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(a){a!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=a,a?(this._onBeforeCameraRenderObserver=this.rO.onBeforeCameraRenderObservable.add((a=>{this._cameraRenderTime.beginMonitoring(),H.Tools.StartPerformanceCounter(`Rendering camera ${a.name}`)})),this._onAfterCameraRenderObserver=this.rO.onAfterCameraRenderObservable.add((a=>{this._cameraRenderTime.endMonitoring(!1),H.Tools.EndPerformanceCounter(`Rendering camera ${a.name}`)}))):(this.rO.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.rO.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.rO.getEngine()._drawCalls}constructor(a){this.rO=a,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new b.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new b.d,this._captureFrameTime=!1,this._frameTime=new b.d,this._captureRenderTime=!1,this._renderTime=new b.d,this._captureInterFrameTime=!1,this._interFrameTime=new b.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new b.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new b.d,this._capturePhysicsTime=!1,this._physicsTime=new b.d,this._captureAnimationsTime=!1,this._animationsTime=new b.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new b.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=a.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(H.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.rO.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=a.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(H.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ib(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ib(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ib(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ib(),this._captureRenderTime&&this._renderTime.Ib(),this._captureCameraRenderTime&&this._cameraRenderTime.Ib()}))}dispose(){this._disposed||(this.rO.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.rO.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.rO.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.rO.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.rO.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.rO.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.rO.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.rO.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.rO.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.rO.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.rO.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.rO.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.rO.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.rO.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.rO.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.rO.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.rO.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.rO=null,this._disposed=!0)}}},14100:(a,O,i)=>{"use strict";i.d(O,{b:()=>P});var H=i(12375),b=i(12384),G=i(12395),q=i(12820),Q=i(12936),k=i(12994),I=i(12346);q.c.AddNodeConstructor("Light_Type_1",((a,O)=>()=>new P(a,G.ZO.Zero(),O)));class P extends k.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(a){this._shadowFrustumSize=a,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(a){this._shadowOrthoScale=a,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(a){this._orthoLeft=a}get orthoRight(){return this._orthoRight}set orthoRight(a){this._orthoRight=a}get orthoTop(){return this._orthoTop}set orthoTop(a){this._orthoTop=a}get orthoBottom(){return this._orthoBottom}set orthoBottom(a){this._orthoBottom=a}constructor(a,O,i){super(a,i),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=O.scale(-1),this.direction=O}getClassName(){return"pb"}getTypeID(){return Q.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(a,O,i){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(a):this._setDefaultAutoExtendShadowProjectionMatrix(a,O,i)}_setDefaultFixedFrustumShadowProjectionMatrix(a){const O=this.Ua().activeCamera;O&&G.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:O.Db,void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ,a,this.Ua().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(a,O,i){const H=this.Ua().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const a=G.ZO.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let H=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let q=0;q<i.length;q++){const Q=i[q];if(!Q)continue;const k=Q.getBoundingInfo().boundingBox;for(let i=0;i<k.vectorsWorld.length;i++)G.ZO.TransformCoordinatesToRef(k.vectorsWorld[i],O,a),a.x<this._orthoLeft&&(this._orthoLeft=a.x),a.y<this._orthoBottom&&(this._orthoBottom=a.y),a.x>this._orthoRight&&(this._orthoRight=a.x),a.y>this._orthoTop&&(this._orthoTop=a.y),this.autoCalcShadowZBounds&&(a.z<H&&(H=a.z),a.z>b&&(b=a.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=H,this._shadowMaxZ=b)}const b=this._orthoRight-this._orthoLeft,q=this._orthoTop-this._orthoBottom,Q=void 0!==this.shadowMinZ?this.shadowMinZ:(null===H||void 0===H?void 0:H.Db)||0,k=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===H||void 0===H?void 0:H.maxZ)||1e4,I=this.Ua().getEngine().qb;G.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-b*this.shadowOrthoScale,this._orthoRight+b*this.shadowOrthoScale,this._orthoBottom-q*this.shadowOrthoScale,this._orthoTop+q*this.shadowOrthoScale,I?k:Q,I?Q:k,a,this.Ua().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(a,O){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,O),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,O),this)}transferToNodeMaterialEffect(a,O){return this.computeTransformedInformation()?(a.setFloat3(O,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(a.setFloat3(O,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(a){const O=this._scene.getEngine();return!O.qb&&O.isNDCHalfZRange?0:1}getDepthMaxZ(a){const O=this._scene.getEngine();return O.qb&&O.isNDCHalfZRange?0:1}prepareLightSpecificDefines(a,O){a["DIRLIGHT"+O]=!0}}(0,H.c)([(0,b.G)()],P.prototype,"shadowFrustumSize",null),(0,H.c)([(0,b.G)()],P.prototype,"shadowOrthoScale",null),(0,H.c)([(0,b.G)()],P.prototype,"autoUpdateExtends",void 0),(0,H.c)([(0,b.G)()],P.prototype,"autoCalcShadowZBounds",void 0),(0,H.c)([(0,b.G)("orthoLeft")],P.prototype,"_orthoLeft",void 0),(0,H.c)([(0,b.G)("orthoRight")],P.prototype,"_orthoRight",void 0),(0,H.c)([(0,b.G)("orthoTop")],P.prototype,"_orthoTop",void 0),(0,H.c)([(0,b.G)("orthoBottom")],P.prototype,"_orthoBottom",void 0),(0,I.h)("BABYLON.DirectionalLight",P)},14578:(a,O,i)=>{"use strict";i.d(O,{b:()=>P});var H=i(12375),b=i(12384),G=i(12395),q=i(12436),Q=i(12820),k=i(12936),I=i(12346);Q.c.AddNodeConstructor("Light_Type_3",((a,O)=>()=>new P(a,G.ZO.Zero(),O)));class P extends k.b{constructor(a,O,i){super(a,i),this.groundColor=new q.mi(0,0,0),this.direction=O||G.ZO.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ob"}setDirectionToTarget(a){return this.direction=G.ZO.Normalize(a.FO(G.ZO.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(a,O){const i=G.ZO.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",i.x,i.y,i.z,0,O),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Wb),O),this}transferToNodeMaterialEffect(a,O){const i=G.ZO.Normalize(this.direction);return a.setFloat3(O,i.x,i.y,i.z),this}yb(){return this._worldMatrix||(this._worldMatrix=G.Matrix.Identity()),this._worldMatrix}getTypeID(){return k.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(a,O){a["HEMILIGHT"+O]=!0}}(0,H.c)([(0,b.k)()],P.prototype,"groundColor",void 0),(0,H.c)([(0,b.D)()],P.prototype,"direction",void 0),(0,I.h)("BABYLON.HemisphericLight",P)},14073:(a,O,i)=>{"use strict";i.d(O,{b:()=>e});var H=i(12375),b=i(12384),G=i(12395),q=i(12820),Q=i(12936),k=i(12994),I=i(12370),P=i(12346);q.c.AddNodeConstructor("Light_Type_2",((a,O)=>()=>new e(a,G.ZO.Zero(),G.ZO.Zero(),0,0,O)));class e extends k.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(a){this._iesProfileTexture!==a&&(this._iesProfileTexture=a,this._iesProfileTexture&&e._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(a){this._angle=a,this._cosHalfAngle=Math.cos(.5*a),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(a){this._innerAngle=a,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(a){this._shadowAngleScale=a,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(a){this._projectionTextureLightNear=a,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(a){this._projectionTextureLightFar=a,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(a){this._projectionTextureUpDirection=a,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(a){this._projectionTexture!==a&&(this._projectionTexture=a,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(e._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):e._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(a){return void 0!==a.onGeneratedObservable}static _IsTexture(a){return void 0!==a.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(a){this._projectionTextureProjectionLightMatrix=a,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(a,O,i,H,b,q){super(a,q),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=G.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=G.ZO.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=G.ZO.Zero(),this._projectionTextureViewLightMatrix=G.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=G.Matrix.Zero(),this._projectionTextureScalingMatrix=G.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=O,this.direction=i,this.angle=H,this.exponent=b}getClassName(){return"SpotLight"}getTypeID(){return Q.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(a){super._setDirection(a),this._projectionTextureViewLightDirty=!0}_setPosition(a){super._setPosition(a),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(a,O,i){const H=this.Ua().activeCamera;if(!H)return;this._shadowAngleScale=this._shadowAngleScale||1;const b=this._shadowAngleScale*this._angle,q=void 0!==this.shadowMinZ?this.shadowMinZ:H.Db,Q=void 0!==this.shadowMaxZ?this.shadowMaxZ:H.maxZ,k=this.Ua().getEngine().qb;G.Matrix.PerspectiveFovLHToRef(b,1,k?Q:q,k?q:Q,a,!0,this._scene.getEngine().isNDCHalfZRange,void 0,k)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),G.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const a=this.projectionTextureLightFar,O=this.projectionTextureLightNear,i=a/(a-O),H=-i*O,b=1/Math.tan(this._angle/2);G.Matrix.FromValuesToRef(b/1,0,0,0,0,b,0,0,0,0,i,1,0,0,H,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof I.e){const a=this._projectionTexture.uScale/2,O=this._projectionTexture.vScale/2;G.Matrix.FromValuesToRef(a,0,0,0,0,O,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(a,O){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),a.setMatrix("textureProjectionMatrix"+O,this._projectionTextureMatrix),a.setTexture("projectionLightTexture"+O,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&a.setTexture("iesLightTexture"+O,this._iesProfileTexture),this}transferToEffect(a,O){let i;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,O),i=G.ZO.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,O),i=G.ZO.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",i.x,i.y,i.z,this._cosHalfAngle,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,O),this}transferToNodeMaterialEffect(a,O){let i;return i=this.computeTransformedInformation()?G.ZO.Normalize(this.transformedDirection):G.ZO.Normalize(this.direction),this.Ua().useRightHandedSystem?a.setFloat3(O,-i.x,-i.y,-i.z):a.setFloat3(O,i.x,i.y,i.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(a){const O=this._scene.getEngine(),i=void 0!==this.shadowMinZ?this.shadowMinZ:(null===a||void 0===a?void 0:a.Db)??0;return O.qb&&O.isNDCHalfZRange?i:this._scene.getEngine().isNDCHalfZRange?0:i}getDepthMaxZ(a){const O=this._scene.getEngine(),i=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===a||void 0===a?void 0:a.maxZ)??1e4;return O.qb&&O.isNDCHalfZRange?0:i}prepareLightSpecificDefines(a,O){a["SPOTLIGHT"+O]=!0,a["PROJECTEDLIGHTTEXTURE"+O]=!(!this.projectionTexture||!this.projectionTexture.isReady()),a["IESLIGHTTEXTURE"+O]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,H.c)([(0,b.G)()],e.prototype,"angle",null),(0,H.c)([(0,b.G)()],e.prototype,"innerAngle",null),(0,H.c)([(0,b.G)()],e.prototype,"shadowAngleScale",null),(0,H.c)([(0,b.G)()],e.prototype,"exponent",void 0),(0,H.c)([(0,b.G)()],e.prototype,"projectionTextureLightNear",null),(0,H.c)([(0,b.G)()],e.prototype,"projectionTextureLightFar",null),(0,H.c)([(0,b.G)()],e.prototype,"projectionTextureUpDirection",null),(0,H.c)([(0,b.z)("projectedLightTexture")],e.prototype,"_projectionTexture",void 0),(0,P.h)("BABYLON.SpotLight",e)},13787:(a,O,i)=>{"use strict";i.d(O,{e:()=>q,f:()=>G,i:()=>Q});const H={},b={};function G(a,O){H[a]=O}function q(a,O){b[a]=O}function Q(a){return b[a]?b[a]:null}},13687:(a,O,i)=>{"use strict";i.d(O,{c:()=>U,d:()=>W});var H,b=i(12184),G=i(12193),q=i(12648),Q=i(12236),k=i(12209),I=i(12858),P=i(12243),e=i(12245),h=i(12350),j=i(12273),Z=i(12227);!function(a){a[a.Clean=0]="Clean",a[a.Stop=1]="Stop",a[a.Sync=2]="Sync",a[a.NoSync=3]="NoSync"}(H||(H={}));const F=new G.e,r={};let J=!1;function ma(){return r[".babylon"]}function M(a,O){const i=r[a];return i||(k.c.Warn("Unable to find a plugin to load "+a+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),O?ma():void 0)}function C(a,O,i){let H="Unable to load from "+(a.rawData?"binary data":a.url);return O?H+=`: ${O}`:i&&(H+=`: ${i}`),H}async function n(a,O,i,H,b,G,q,Q,k){var I;const e="data:"===(h=a.url).substring(0,5)?h.substring(5):null;var h;if(a.rawData&&!q)throw"When using ArrayBufferView to load data the file extension must be provided.";const J=e||q?"":function(a){const O=a.indexOf("?");-1!==O&&(a=a.substring(0,O));const i=a.lastIndexOf(".");return a.substring(i,a.length).toLowerCase()}(a.url);let C=q?M(q,!0):e?function(a){for(const O in r){const i=r[O].plugin;if(i.canDirectLoad&&i.canDirectLoad(a))return r[O]}return ma()}(a.url):M(J,!1);if(!C&&J){if(a.url&&!a.url.startsWith("blob:")){const O=await async function(a,O){const i=O.method||"GET";return await new Promise(((H,b)=>{const G=new Z.e;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const a={};if(O.responseHeaders)for(const i of O.responseHeaders)a[i]=G.getResponseHeader(i)||"";H({response:G.response,headerValues:a})}else b(`Unable to fetch data from ${a}. Error code: ${G.status}`)})),G.open(i,a),G.send()}))}(a.url,{method:"HEAD",responseHeaders:["Content-Type"]}),i=O.headerValues?O.headerValues["Content-Type"]:"";i&&(C=function(a){for(const O in r){const i=r[O];if(i.mimeType===a)return i}}(i))}C||(C=ma())}if(!C)throw new Error(`No plugin or fallback for ${q??a.url}`);if(!1===(null===k||void 0===k||null===(I=k[C.plugin.name])||void 0===I?void 0:I.enabled))throw new Error(`The '${C.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(a.rawData&&!C.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(a=>{if(C.plugin.createPlugin){const O=C.plugin.createPlugin(k??{});return O instanceof Promise?(O.then(a).catch((a=>{b("Error instantiating plugin.",a)})),null):(a(O),O)}return a(C.plugin),C.plugin})((k=>{var I;if(!k)throw`The loader plugin corresponding to the '${q}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(F.notifyObservers(k),e&&(k.canDirectLoad&&k.canDirectLoad(a.url)||!(0,P.n)(a.url))){if(k.directLoad){const a=k.directLoad(O,e);a instanceof Promise?a.then((a=>{i(k,a)})).catch((a=>{b("Error in directLoad of _loadData: "+a,a)})):i(k,a)}else i(k,e);return}const h=C.isBinary,Z=(a,H)=>{O.h?b("Scene has been disposed"):i(k,a,H)};let r=null,J=!1;null===(I=k.Pb)||void 0===I||I.add((()=>{J=!0,r&&(r.abort(),r=null),G()}));const ma=()=>{if(J)return;const i=(a,O)=>{b(null===a||void 0===a?void 0:a.statusText,O)};if(!k.loadFile&&a.rawData)throw"Plugin does not support loading ArrayBufferView.";r=k.loadFile?k.loadFile(O,a.rawData||a.file||a.url,a.rootUrl,Z,H,h,i,Q):O._loadFile(a.file||a.url,Z,H,!0,h,i)},M=O.getEngine();let n=M.enableOfflineSupport;if(n){let i=!1;for(const H of O.disableOfflineSupportExceptionRules)if(H.test(a.url)){i=!0;break}n=!i}n&&j.c.OfflineProviderFactory?O.offlineProvider=j.c.OfflineProviderFactory(a.url,ma,M.disableManifestCheck):ma()}))}function D(a,O){let i,H,G=null,q=null;if(O)if(O.name)i=`file:${O.name}`,H=O.name,G=O;else if(ArrayBuffer.isView(O))i="",H=(0,h.c)(),q=O;else if(O.startsWith("data:"))i=O,H="";else if(a){const G=O;if("/"===G.substring(0,1))return b.Tools.Error("Wrong sceneFilename parameter"),null;i=a+G,H=G}else i=O,H=b.Tools.GetFilename(O),a=b.Tools.GetFolderPath(O);else i=a,H=b.Tools.GetFilename(a),a=b.Tools.GetFolderPath(a);return{url:i,rootUrl:a,name:H,file:G,rawData:q}}function U(a){if("string"===typeof a.extensions){const O=a.extensions;r[O.toLowerCase()]={plugin:a,isBinary:!1}}else{const O=a.extensions,i=Object.keys(O);for(const H of i)r[H.toLowerCase()]={plugin:a,isBinary:O[H].isBinary,mimeType:O[H].mimeType}}}async function y(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Q.b.LastCreatedScene,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!H)return k.c.Error("No scene available to import mesh to"),null;const j=D(O,i);if(!j)return null;const Z={};H.addPendingData(Z);const F=()=>{H.removePendingData(Z)},r=(a,O)=>{const i=C(j,a,O);q?q(H,i,new e.m(i,e.i.SceneLoaderError,O)):k.c.Error(i),F()},J=G?a=>{try{G(a)}catch(O){r("Error in onProgress callback: "+O,O)}}:void 0,ma=(a,O,i,G,q,Q,k,I)=>{if(H.importedMeshesFiles.push(j.url),b)try{b(a,O,i,G,q,Q,k,I)}catch(P){r("Error in onSuccess callback: "+P,P)}H.removePendingData(Z)};return await n(j,H,((O,i,b)=>{if(O.rewriteRootURL&&(j.rootUrl=O.rewriteRootURL(j.rootUrl,b)),O.importMesh){const b=[],G=[],q=[];if(!O.importMesh(a,H,i,j.rootUrl,b,G,q,r))return;H.loadingPluginName=O.name,ma(b,G,q,[],[],[],[],[])}else{O.importMeshAsync(a,H,i,j.rootUrl,J,j.name).then((a=>{H.loadingPluginName=O.name,ma(a.meshes,a.Eh,a.skeletons,a.animationGroups,a.transformNodes,a.geometries,a.lights,a.spriteManagers)})).catch((a=>{r(a.message,a)}))}}),J,r,F,I,P,h)}async function w(a,O,i,H,b,G,q,Q){return await new Promise(((k,I)=>{try{y(a,O,i,H,((a,O,i,H,b,G,q,Q)=>{k({meshes:a,Eh:O,skeletons:i,animationGroups:H,transformNodes:b,geometries:G,lights:q,spriteManagers:Q})}),b,((a,O,i)=>{I(i||new Error(O))}),G,q,Q).catch(I)}catch(e){I(e)}}))}async function K(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.b.LastCreatedEngine,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};i?await f(a,O,new q.c(i),H,G,k,I,P,e):b.Tools.Error("No engine available")}async function S(a,O,i,H,b,G,q){return await new Promise(((Q,k)=>{K(a,O,i,(a=>{Q(a)}),H,((a,O,i)=>{k(i||new Error(O))}),b,G,q)}))}async function f(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.b.LastCreatedScene,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!i)return k.c.Error("No scene available to append to"),null;const j=D(a,O);if(!j)return null;const Z={};i.addPendingData(Z);const F=()=>{i.removePendingData(Z)};I.e.ShowLoadingScreen&&!J&&(J=!0,i.getEngine().displayLoadingUI(),i.executeWhenReady((()=>{i.getEngine().hideLoadingUI(),J=!1})));const r=(a,O)=>{const H=C(j,a,O);G?G(i,H,new e.m(H,e.i.SceneLoaderError,O)):k.c.Error(H),F()},ma=b?a=>{try{b(a)}catch(O){r("Error in onProgress callback",O)}}:void 0,M=()=>{if(H)try{H(i)}catch(a){r("Error in onSuccess callback",a)}i.removePendingData(Z)};return await n(j,i,((a,O)=>{if(a.load){if(!a.load(i,O,j.rootUrl,r))return;i.loadingPluginName=a.name,M()}else{a.loadAsync(i,O,j.rootUrl,ma,j.name).then((()=>{i.loadingPluginName=a.name,M()})).catch((a=>{r(a.message,a)}))}}),ma,r,F,q,P,h)}async function B(a,O,i,H,b,G,q){return await new Promise(((Q,k)=>{try{f(a,O,i,(a=>{Q(a)}),H,((a,O,i)=>{k(i||new Error(O))}),b,G,q).catch(k)}catch(e){k(e)}}))}async function T(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.b.LastCreatedScene,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!i)return k.c.Error("No scene available to load asset container to"),null;const h=D(a,O);if(!h)return null;const j={};i.addPendingData(j);const Z=()=>{i.removePendingData(j)},F=(a,O)=>{const H=C(h,a,O);G?G(i,H,new e.m(H,e.i.SceneLoaderError,O)):k.c.Error(H),Z()},r=b?a=>{try{b(a)}catch(O){F("Error in onProgress callback",O)}}:void 0,J=a=>{if(H)try{H(a)}catch(O){F("Error in onSuccess callback",O)}i.removePendingData(j)};return await n(h,i,((a,O)=>{if(a.loadAssetContainer){const H=a.loadAssetContainer(i,O,h.rootUrl,F);if(!H)return;H.populateRootNodes(),i.loadingPluginName=a.name,J(H)}else if(a.loadAssetContainerAsync){a.loadAssetContainerAsync(i,O,h.rootUrl,r,h.name).then((O=>{O.populateRootNodes(),i.loadingPluginName=a.name,J(O)})).catch((a=>{F(a.message,a)}))}else F("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),r,F,Z,q,I,P)}async function A(a,O,i,H,b,G,q){return await new Promise(((Q,k)=>{try{T(a,O,i,(a=>{Q(a)}),H,((a,O,i)=>{k(i||new Error(O))}),b,G,q).catch(k)}catch(e){k(e)}}))}async function E(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.b.LastCreatedScene,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",j=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!i)return void k.c.Error("No scene available to load animations to");if(H){for(const H of i.animatables)H.reset();i.stopAllAnimations();const a=i.animationGroups.slice();for(const i of a)i.dispose();const O=i.getNodes();for(const i of O)i.animations&&(i.animations=[])}else switch(b){case 0:const a=i.animationGroups.slice();for(const O of a)O.dispose();break;case 1:for(const O of i.animationGroups)O.stop();break;case 2:for(const O of i.animationGroups)O.reset(),O.restart();break;case 3:break;default:return void k.c.Error("Unknown animation group loading mode value '"+b+"'")}const Z=i.animatables.length;await T(a,O,i,(a=>{a.mergeAnimationsTo(i,i.animatables.slice(Z),G),a.dispose(),i.onAnimationFileImportedObservable.notifyObservers(i),q&&q(i)}),I,P,e,h,j)}async function l(a,O,i,H,b,G,q,Q,k,I){return await new Promise(((P,h)=>{try{E(a,O,i,H,b,G,(a=>{P(a)}),q,((a,O,i)=>{h(i||new Error(O))}),Q,k,I).catch(h)}catch(e){h(e)}}))}class W{static get ForceFullSceneLoadingForIncremental(){return I.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(a){I.e.ForceFullSceneLoadingForIncremental=a}static get ShowLoadingScreen(){return I.e.ShowLoadingScreen}static set ShowLoadingScreen(a){I.e.ShowLoadingScreen=a}static get loggingLevel(){return I.e.loggingLevel}static set loggingLevel(a){I.e.loggingLevel=a}static get CleanBoneMatrixWeights(){return I.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(a){I.e.CleanBoneMatrixWeights=a}static GetDefaultPlugin(){return ma()}static GetPluginForExtension(a){var O;return null===(O=M(a,!0))||void 0===O?void 0:O.plugin}static IsPluginForExtensionAvailable(a){return function(a){return!!r[a]}(a)}static RegisterPlugin(a){U(a)}static ImportMesh(a,O,i,H,b,G,q,k,I){y(a,O,i,H,b,G,q,k,I).catch((a=>null===q||void 0===q?void 0:q(Q.b.LastCreatedScene,null===a||void 0===a?void 0:a.message,a)))}static async ImportMeshAsync(a,O,i,H,b,G,q){return await w(a,O,i,H,b,G,q)}static Load(a,O,i,H,b,G,q,k){K(a,O,i,H,b,G,q,k).catch((a=>null===G||void 0===G?void 0:G(Q.b.LastCreatedScene,null===a||void 0===a?void 0:a.message,a)))}static async LoadAsync(a,O,i,H,b,G){return await S(a,O,i,H,b,G)}static Append(a,O,i,H,b,G,q,k){f(a,O,i,H,b,G,q,k).catch((a=>null===G||void 0===G?void 0:G(i??Q.b.LastCreatedScene,null===a||void 0===a?void 0:a.message,a)))}static async AppendAsync(a,O,i,H,b,G){return await B(a,O,i,H,b,G)}static LoadAssetContainer(a,O,i,H,b,G,q,k){T(a,O,i,H,b,G,q,k).catch((a=>null===G||void 0===G?void 0:G(i??Q.b.LastCreatedScene,null===a||void 0===a?void 0:a.message,a)))}static async LoadAssetContainerAsync(a,O,i,H,b,G){return await A(a,O,i,H,b,G)}static ImportAnimations(a,O,i,H,b,G,q,k,I,P,e){E(a,O,i,H,b,G,q,k,I,P,e).catch((a=>null===I||void 0===I?void 0:I(i??Q.b.LastCreatedScene,null===a||void 0===a?void 0:a.message,a)))}static async ImportAnimationsAsync(a,O,i,H,b,G,q,Q,k,I,P){return await l(a,O,i,H,b,G,Q,I,P)}}W.NO_LOGGING=0,W.MINIMAL_LOGGING=1,W.SUMMARY_LOGGING=2,W.DETAILED_LOGGING=3,W.OnPluginActivatedObservable=F},14084:(a,O,i)=>{"use strict";i.d(O,{e:()=>h});var H=i(12375),b=i(12384),G=i(12184),q=i(12395),Q=i(12417),k=i(12370),I=i(12346),P=i(12193),e=i(12427);i(14088);class h extends Q.c{set boundingBoxSize(a){if(this._boundingBoxSize&&this._boundingBoxSize.equals(a))return;this._boundingBoxSize=a;const O=this.Ua();O&&O.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(a){this._rotationY=a,this.setReflectionTextureMatrix(q.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(a,O,i){let H="";for(const b of a)H+=b;return new h(H,O,null,i,a)}static CreateFromPrefilteredData(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const b=O.useDelayedTextureLoading;O.useDelayedTextureLoading=!1;const G=new h(a,O,null,!1,null,null,null,void 0,!0,i,H);return O.useDelayedTextureLoading=b,G}constructor(a,O){var i;let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,h=arguments.length>8&&void 0!==arguments[8]&&arguments[8],j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Z=arguments.length>10&&void 0!==arguments[10]&&arguments[10],F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,r=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,J=arguments.length>13?arguments[13]:void 0,ma=arguments.length>14?arguments[14]:void 0;super(O),this.onLoadObservable=new P.e,this.boundingBoxPosition=q.ZO.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new q.Matrix,this._buffer=null,this.name=a,this.url=a,this._noMipmap=b,this.nb=!1,this.isCube=!0,this._textureMatrix=q.Matrix.Identity(),this.coordinatesMode=k.e.CUBIC_MODE;let M=null,C=null;null===H||Array.isArray(H)?(this._noMipmap=b,this._format=e,this._createPolynomials=Z,M=H,this._loaderOptions=J,this._useSRGBBuffer=ma,this._lodScale=F,this._lodOffset=r):(M=H.extensions??null,this._noMipmap=H.noMipmap??!1,G=H.files??null,C=H.buffer??null,this._format=H.format??5,h=H.prefiltered??!1,j=H.forcedExtension??null,this._createPolynomials=H.createPolynomials??!1,this._lodScale=H.lodScale??.8,this._lodOffset=H.lodOffset??0,this._loaderOptions=H.loaderOptions,this._useSRGBBuffer=H.useSRGBBuffer,Q=H.L??null,I=H.onError??null),(a||G)&&this.updateURL(a,j,Q,h,I,M,null===(i=this.Ua())||void 0===i?void 0:i.useDelayedTextureLoading,G,C)}getClassName(){return"CubeTexture"}updateURL(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=a),this.url=a,O&&(this._forcedExtension=O);const I=a.lastIndexOf("."),P=O||(I>-1?a.substring(I).toLowerCase():""),e=0===P.indexOf(".dds"),h=0===P.indexOf(".env"),j=0===P.indexOf(".basis");if(h?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=H,H&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),Q)this._files=Q;else if(j||h||e||G||(G=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,G){for(let O=0;O<G.length;O++)this._files.push(a+G[O]);this._extensions=G}this._buffer=k,q?(this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=b):this._loadTexture(i,b)}delayLoad(a){4===this.delayLoadState&&(a&&(this._forcedExtension=a),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(a){var O,i;if(a.updateFlag===this._textureMatrix.updateFlag)return;a.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(i=this.Ua())||void 0===i||i.markAllMaterialsAsDirty(1,(a=>-1!==a.getActiveTextures().indexOf(this))));if(this._textureMatrix=a,null===(O=this.Ua())||void 0===O||!O.useRightHandedSystem)return;const H=q.TmpVectors.ZO[0],b=q.TmpVectors.Quaternion[0],G=q.TmpVectors.ZO[1];this._textureMatrix.decompose(H,b,G),b.z*=-1,b.w*=-1,q.Matrix.ComposeToRef(H,b,G,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var a;return null!==(a=this.Ua())&&void 0!==a&&a.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this.Ua(),H=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const b=()=>{var O;(this.onLoadObservable.notifyObservers(this),H)&&(H.dispose(),null===(O=this.Ua())||void 0===O||O.markAllMaterialsAsDirty(1));a&&a()},q=(a,i)=>{this._loadingError=!0,this._errorObject={message:a,exception:i},O&&O(a,i),k.e.OnTextureLoadErrorObservable.notifyObservers(this)};var Q;this._texture?this._texture.isReady?G.Tools.SetImmediate((()=>b())):this._texture.onLoadedObservable.add((()=>b())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,i,this._lodScale,this._lodOffset,a,q,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,i,this._files,this._noMipmap,a,q,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(Q=this._texture)||void 0===Q||Q.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(a,O,i){const H=e.d.Parse((()=>{let H=!1;return a.prefiltered&&(H=a.prefiltered),new h(i+(a.url??a.name),O,a.extensions,!1,a.files||null,null,null,void 0,H,a.forcedExtension)}),a,O);if(a.boundingBoxPosition&&(H.boundingBoxPosition=q.ZO.MO(a.boundingBoxPosition)),a.boundingBoxSize&&(H.boundingBoxSize=q.ZO.MO(a.boundingBoxSize)),a.animations)for(let b=0;b<a.animations.length;b++){const O=a.animations[b],i=(0,I.e)("BABYLON.Animation");i&&H.animations.push(i.Parse(O))}return H}clone(){let a=0;const O=e.d.Clone((()=>{const O=new h(this.url,this.Ua()||this._getEngine(),this._extensions,this._noMipmap,this._files);return a=O.uniqueId,O}),this);return O.uniqueId=a,O}}(0,H.c)([(0,b.G)()],h.prototype,"url",void 0),(0,H.c)([(0,b.D)()],h.prototype,"boundingBoxPosition",void 0),(0,H.c)([(0,b.D)()],h.prototype,"boundingBoxSize",null),(0,H.c)([(0,b.G)("rotationY")],h.prototype,"rotationY",null),(0,H.c)([(0,b.G)("files")],h.prototype,"_files",void 0),(0,H.c)([(0,b.G)("forcedExtension")],h.prototype,"_forcedExtension",void 0),(0,H.c)([(0,b.G)("extensions")],h.prototype,"_extensions",void 0),(0,H.c)([(0,b.r)("textureMatrix")],h.prototype,"_textureMatrix",void 0),(0,H.c)([(0,b.r)("textureMatrixRefraction")],h.prototype,"_textureMatrixRefraction",void 0),k.e._CubeTextureParser=h.Parse,(0,I.h)("BABYLON.CubeTexture",h)},14588:(a,O,i)=>{"use strict";i.d(O,{e:()=>k});var H=i(12209),b=i(12370),G=i(12358),q=i(12537),Q=i(12317);q.ThinEngine.prototype.createDynamicTexture=function(a,O,i,H){const b=new Q.c(this,4);return b.baseWidth=a,b.baseHeight=O,i&&(a=this.needPOTTextures?(0,G.f)(a,this._caps.maxTextureSize):a,O=this.needPOTTextures?(0,G.f)(O,this._caps.maxTextureSize):O),b.width=a,b.height=O,b.isReady=!1,b.generateMipMaps=i,b.samplingMode=H,this.updateTextureSamplingMode(H,b),this._internalTexturesCache.push(b),b},q.ThinEngine.prototype.updateDynamicTexture=function(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!a)return;const q=this._gl,Q=q.TEXTURE_2D,k=this._bindTextureDirectly(Q,a,!0,G);this._unpackFlipY(void 0===i?a.invertY:i),H&&q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const I=this._getWebGLTextureType(a.type),P=this._getInternalFormat(b||a.format),e=this._getRGBABufferInternalSizedFormat(a.type,P);q.texImage2D(Q,0,e,P,I,O),a.generateMipMaps&&q.generateMipmap(Q),k||this._bindTextureDirectly(Q,null),H&&q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),b&&(a.format=b),a._dynamicTextureSource=O,a._premulAlpha=H,a.invertY=i||!1,a.isReady=!0};class k extends b.e{constructor(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,Q=arguments.length>6?arguments[6]:void 0;const k=!i||i._isScene;super(null,k?i:null===i||void 0===i?void 0:i.rO,k?!H:i,Q,G,void 0,void 0,void 0,void 0,q),this.name=a,this.wrapU=b.e.CLAMP_ADDRESSMODE,this.wrapV=b.e.CLAMP_ADDRESSMODE,this._generateMipMaps=H;const I=this._getEngine();if(!I)return;if(O.getContext)this._canvas=O,this._ownCanvas=!1,this._texture=I.createDynamicTexture(this._canvas.width,this._canvas.height,H,G);else{this._canvas=I.createCanvas(1,1),this._ownCanvas=!0;const a=O;a.width||0===a.width?this._texture=I.createDynamicTexture(a.width,a.height,H,G):this._texture=I.createDynamicTexture(O,O,H,G)}const P=this.getSize();this._canvas.width!==P.width&&(this._canvas.width=P.width),this._canvas.height!==P.height&&(this._canvas.height=P.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(a){this._canvas.width=a.width,this._canvas.height=a.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(a.width,a.height,this._generateMipMaps,this.samplingMode)}scale(a){const O=this.getSize();O.width*=a,O.height*=a,this._recreate(O)}scaleTo(a,O){const i=this.getSize();i.width=a,i.height=O,this._recreate(i)}getContext(){return this._context}clear(a){const O=this.getSize();a&&(this._context.fillStyle=a),this._context.clearRect(0,0,O.width,O.height)}update(a){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===a||a,O,this._format||void 0,void 0,i)}drawText(a,O,i,H,b,G,q){let Q=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const k=this.getSize();if(G&&(this._context.fillStyle=G,this._context.fillRect(0,0,k.width,k.height)),this._context.font=H,null===O||void 0===O){const i=this._context.measureText(a);O=(k.width-i.width)/2}if(null===i||void 0===i){const a=parseInt(H.replace(/\D/g,""));i=k.height/2+a/3.65}this._context.fillStyle=b||"",this._context.fillText(a,O,i),Q&&this.update(q)}dispose(){var a,O;(super.dispose(),this._ownCanvas)&&(null===(a=this._canvas)||void 0===a||null===(O=a.remove)||void 0===O||O.call(a));this._canvas=null,this._context=null}clone(){const a=this.Ua();if(!a)return this;const O=this.getSize(),i=new k(this.name,O,a,this._generateMipMaps);return i.nb=this.nb,i.level=this.level,i.wrapU=this.wrapU,i.wrapV=this.wrapV,i}serialize(){const a=this.Ua();a&&!a.isReady()&&H.c.Warn("The scene must be ready before serializing the dynamic texture");const O=super.serialize();return k._IsCanvasElement(this._canvas)&&(O.base64String=this._canvas.toDataURL()),O.invertY=this._invertY,O.samplingMode=this.samplingMode,O}static _IsCanvasElement(a){return void 0!==a.toDataURL}_rebuild(){this.update()}}},14013:(a,O,i)=>{"use strict";i.d(O,{d:()=>b});var H=i(12370);class b extends H.e{get depth(){return this._depth}constructor(a,O,i,b,G,q){let Q=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],k=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:H.e.TRILINEAR_SAMPLINGMODE,P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,e=arguments.length>10?arguments[10]:void 0;super(null,q,!Q,k),this.format=G,this._texture=q.getEngine().createRawTexture2DArray(a,O,i,b,G,Q,k,I,null,P,e),this._depth=b,this.is2DArray=!0}update(a){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,a,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(a,O,i,H,G){return new b(a,O,i,H,5,G,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13807:(a,O,i)=>{"use strict";i.d(O,{c:()=>Q,d:()=>k,h:()=>G,i:()=>q});var H=i(12412),b=i(12395);function G(a,O){return`{X: ${a.x.toFixed(O)} Y: ${a.y.toFixed(O)}}`}function q(a,O){return`{X: ${a._x.toFixed(O)} Y: ${a._y.toFixed(O)} Z: ${a._z.toFixed(O)}}`}function Q(a,O){return 2*Math.acos((0,H.Clamp)(b.Quaternion.Dot(a,O)))}function k(a,O){const i=new b.Quaternion;return function(a,O,i){const G=b.ZO.Cross(a,O),q=Math.acos((0,H.Clamp)(b.ZO.Dot(a,O),-1,1));b.Quaternion.RotationAxisToRef(G,q,i)}(a,O,i),i}},13637:(a,O,i)=>{"use strict";i.d(O,{b:()=>I});var H=i(12395),b=i(12436),G=i(12841),q=i(12829),Q=i(12448);i(13639);function k(a){let O=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],G=[];let k=[];const I=a.width||a.size||1,P=a.height||a.size||1,e=a.depth||a.size||1,h=a.wrap||!1;let j=void 0===a.topBaseAt?1:a.topBaseAt,Z=void 0===a.bottomBaseAt?0:a.bottomBaseAt;j=(j+4)%4,Z=(Z+4)%4;let F=[2,0,3,1][j],r=[2,0,1,3][Z],J=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(h){O=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],J=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let a=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],i=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const H=[17,18,19,16],b=[22,23,20,21];for(;F>0;)a.unshift(a.pop()),H.unshift(H.pop()),F--;for(;r>0;)i.unshift(i.pop()),b.unshift(b.pop()),r--;a=a.flat(),i=i.flat(),J=J.concat(a).concat(i),O.push(H[0],H[2],H[3],H[0],H[1],H[2]),O.push(b[0],b[2],b[3],b[0],b[1],b[2])}const ma=[I/2,P/2,e/2];k=J.reduce(((a,O,i)=>a.concat(O*ma[i%3])),[]);const M=0===a.sideOrientation?0:a.sideOrientation||q.d.DEFAULTSIDE,C=a.faceUV||new Array(6),n=a.faceColors,D=[];for(let q=0;q<6;q++)void 0===C[q]&&(C[q]=new H.Vector4(0,0,1,1)),n&&void 0===n[q]&&(n[q]=new b.Ab(1,1,1,1));for(let H=0;H<6;H++)if(G.push(C[H].z,Q.c?1-C[H].w:C[H].w),G.push(C[H].x,Q.c?1-C[H].w:C[H].w),G.push(C[H].x,Q.c?1-C[H].y:C[H].y),G.push(C[H].z,Q.c?1-C[H].y:C[H].y),n)for(let a=0;a<4;a++)D.push(n[H].r,n[H].g,n[H].b,n[H].a);q.d._ComputeSides(M,k,O,i,G,a.frontUVs,a.backUVs);const U=new q.d;if(U.indices=O,U.wa=k,U.Ka=i,U.fa=G,n){const a=M===q.d.DOUBLESIDE?D.concat(D):D;U.Sa=a}return U}function I(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new G.d(a,i);O.sideOrientation=G.d._GetDefaultSideOrientation(O.sideOrientation),H._originalBuilderSideOrientation=O.sideOrientation;return k(O).Ta(H,O.updatable),H}q.d.CreateBox=k,G.d.CreateBox=function(a,O){return I(a,{size:O,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13796:(a,O,i)=>{"use strict";i.d(O,{c:()=>Q});var H=i(12841),b=i(12829),G=i(12448);function q(a){const O=[],i=[],H=[],q=[],Q=a.radius||.5,k=a.tessellation||64,I=a.arc&&(a.arc<=0||a.arc>1)?1:a.arc||1,P=0===a.sideOrientation?0:a.sideOrientation||b.d.DEFAULTSIDE;O.push(0,0,0),q.push(.5,.5);const e=2*Math.PI*I,h=1===I?e/k:e/(k-1);let j=0;for(let b=0;b<k;b++){const a=Math.cos(j),i=Math.sin(j),H=(a+1)/2,b=(1-i)/2;O.push(Q*a,Q*i,0),q.push(H,G.c?1-b:b),j+=h}1===I&&(O.push(O[3],O[4],O[5]),q.push(q[2],G.c?1-q[3]:q[3]));const Z=O.length/3;for(let b=1;b<Z-1;b++)i.push(b+1,0,b);b.d.ComputeNormals(O,i,H),b.d._ComputeSides(P,O,i,H,q,a.frontUVs,a.backUVs);const F=new b.d;return F.indices=i,F.wa=O,F.Ka=H,F.fa=q,F}function Q(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new H.d(a,i);O.sideOrientation=H.d._GetDefaultSideOrientation(O.sideOrientation),b._originalBuilderSideOrientation=O.sideOrientation;return q(O).Ta(b,O.updatable),b}b.d.CreateDisc=q,H.d.CreateDisc=function(a,O,i){return Q(a,{radius:O,tessellation:i,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13639:(a,O,i)=>{"use strict";i.d(O,{i:()=>r,e:()=>ma,l:()=>J});var H=i(12395),b=i(12436),G=i(12841),q=i(12829),Q=i(12470);G.d._GroundMeshParser=(a,O)=>k.Parse(a,O);class k extends G.d{constructor(a,O){super(a,O),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=a,this._subdivisionsY=a,this.subdivide(a);const i=this;i.createOrUpdateSubmeshesOctree&&i.createOrUpdateSubmeshesOctree(O)}getHeightAtCoordinates(a,O){const i=this.getWorldMatrix(),b=H.TmpVectors.Matrix[5];i.invertToRef(b);const G=H.TmpVectors.ZO[8];if(H.ZO.TransformCoordinatesFromFloatsToRef(a,0,O,b,G),a=G.x,O=G.z,a<this._minX||a>=this._maxX||O<=this._minZ||O>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const q=this._getFacetAt(a,O),Q=-(q.x*a+q.z*O+q.w)/q.y;return H.ZO.TransformCoordinatesFromFloatsToRef(0,Q,0,i,G),G.y}getNormalAtCoordinates(a,O){const i=new H.ZO(0,1,0);return this.getNormalAtCoordinatesToRef(a,O,i),i}getNormalAtCoordinatesToRef(a,O,i){const b=this.getWorldMatrix(),G=H.TmpVectors.Matrix[5];b.invertToRef(G);const q=H.TmpVectors.ZO[8];if(H.ZO.TransformCoordinatesFromFloatsToRef(a,0,O,G,q),a=q.x,O=q.z,a<this._minX||a>this._maxX||O<this._minZ||O>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Q=this._getFacetAt(a,O);return H.ZO.TransformNormalFromFloatsToRef(Q.x,Q.y,Q.z,b,i),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(a,O){const i=Math.floor((a+this._maxX)*this._subdivisionsX/this._width),H=Math.floor(-(O+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),b=this._heightQuads[H*this._subdivisionsX+i];let G;return G=O<b.slope.x*a+b.slope.y?b.facet1:b.facet2,G}_initHeightQuads(){const a=this._subdivisionsX,O=this._subdivisionsY;this._heightQuads=[];for(let i=0;i<O;i++)for(let O=0;O<a;O++){const b={slope:H.Vector2.Zero(),facet1:new H.Vector4(0,0,0,0),facet2:new H.Vector4(0,0,0,0)};this._heightQuads[i*a+O]=b}return this}_computeHeightQuads(){const a=this.getVerticesData(Q.c.PositionKind);if(!a)return this;const O=H.TmpVectors.ZO[3],i=H.TmpVectors.ZO[2],b=H.TmpVectors.ZO[1],G=H.TmpVectors.ZO[0],q=H.TmpVectors.ZO[4],k=H.TmpVectors.ZO[5],I=H.TmpVectors.ZO[6],P=H.TmpVectors.ZO[7],e=H.TmpVectors.ZO[8];let h=0,j=0,Z=0,F=0,r=0,J=0,ma=0;const M=this._subdivisionsX,C=this._subdivisionsY;for(let Q=0;Q<C;Q++)for(let C=0;C<M;C++){h=3*C,j=Q*(M+1)*3,Z=(Q+1)*(M+1)*3,O.x=a[j+h],O.y=a[j+h+1],O.z=a[j+h+2],i.x=a[j+h+3],i.y=a[j+h+4],i.z=a[j+h+5],b.x=a[Z+h],b.y=a[Z+h+1],b.z=a[Z+h+2],G.x=a[Z+h+3],G.y=a[Z+h+4],G.z=a[Z+h+5],F=(G.z-O.z)/(G.x-O.x),r=O.z-F*O.x,i.subtractToRef(O,q),b.subtractToRef(O,k),G.subtractToRef(O,I),H.ZO.CrossToRef(I,k,P),H.ZO.CrossToRef(q,I,e),P.normalize(),e.normalize(),J=-(P.x*O.x+P.y*O.y+P.z*O.z),ma=-(e.x*i.x+e.y*i.y+e.z*i.z);const n=this._heightQuads[Q*M+C];n.slope.fb(F,r),n.facet1.fb(P.x,P.y,P.z,J),n.facet2.fb(e.x,e.y,e.z,ma)}return this}serialize(a){super.serialize(a),a.subdivisionsX=this._subdivisionsX,a.subdivisionsY=this._subdivisionsY,a.minX=this._minX,a.maxX=this._maxX,a.Db=this._minZ,a.maxZ=this._maxZ,a.width=this._width,a.height=this._height}static Parse(a,O){const i=new k(a.name,O);return i._subdivisionsX=a.subdivisionsX||1,i._subdivisionsY=a.subdivisionsY||1,i._minX=a.minX,i._maxX=a.maxX,i._minZ=a.Db,i._maxZ=a.maxZ,i._width=a.width,i._height=a.height,i}}var I=i(12184),P=i(12236),e=i(12397),h=i(12448);function j(a){const O=[],i=[],b=[],G=[];let Q,k;const I=a.width||a.size||1,P=a.height||a.size||1,e=0|(a.subdivisionsX||a.subdivisions||1),j=0|(a.subdivisionsY||a.subdivisions||1);for(Q=0;Q<=j;Q++)for(k=0;k<=e;k++){const a=new H.ZO(k*I/e-I/2,0,(j-Q)*P/j-P/2),O=new H.ZO(0,1,0);i.push(a.x,a.y,a.z),b.push(O.x,O.y,O.z),G.push(k/e,h.c?Q/j:1-Q/j)}for(Q=0;Q<j;Q++)for(k=0;k<e;k++)O.push(k+1+(Q+1)*(e+1)),O.push(k+1+Q*(e+1)),O.push(k+Q*(e+1)),O.push(k+(Q+1)*(e+1)),O.push(k+1+(Q+1)*(e+1)),O.push(k+Q*(e+1));const Z=new q.d;return Z.indices=O,Z.wa=i,Z.Ka=b,Z.fa=G,Z}function Z(a){const O=void 0!==a.xmin&&null!==a.xmin?a.xmin:-1,i=void 0!==a.zmin&&null!==a.zmin?a.zmin:-1,b=void 0!==a.xmax&&null!==a.xmax?a.xmax:1,G=void 0!==a.zmax&&null!==a.zmax?a.zmax:1,Q=a.subdivisions||{w:1,h:1},k=a.precision||{w:1,h:1},I=[],P=[],e=[],h=[];let j,Z,F,r;Q.h=Q.h<1?1:Q.h,Q.w=Q.w<1?1:Q.w,k.w=k.w<1?1:k.w,k.h=k.h<1?1:k.h;const J=(b-O)/Q.w,ma=(G-i)/Q.h;function M(a,O,i,b){const G=P.length/3,q=k.w+1;for(j=0;j<k.h;j++)for(Z=0;Z<k.w;Z++){const a=[G+Z+j*q,G+(Z+1)+j*q,G+(Z+1)+(j+1)*q,G+Z+(j+1)*q];I.push(a[1]),I.push(a[2]),I.push(a[3]),I.push(a[0]),I.push(a[1]),I.push(a[3])}const Q=H.ZO.Zero(),F=new H.ZO(0,1,0);for(j=0;j<=k.h;j++)for(Q.z=j*(b-O)/k.h+O,Z=0;Z<=k.w;Z++)Q.x=Z*(i-a)/k.w+a,Q.y=0,P.push(Q.x,Q.y,Q.z),e.push(F.x,F.y,F.z),h.push(Z/k.w,j/k.h)}for(F=0;F<Q.h;F++)for(r=0;r<Q.w;r++)M(O+r*J,i+F*ma,O+(r+1)*J,i+(F+1)*ma);const C=new q.d;return C.indices=I,C.wa=P,C.Ka=e,C.fa=h,C}function F(a){const O=[],i=[],G=[],Q=[];let k,I;const P=a.colorFilter||new b.mi(.3,.59,.11),h=a.alphaFilter||0;let j=!1;if(a.minHeight>a.maxHeight){j=!0;const O=a.maxHeight;a.maxHeight=a.minHeight,a.minHeight=O}for(k=0;k<=a.subdivisions;k++)for(I=0;I<=a.subdivisions;I++){const O=new H.ZO(I*a.width/a.subdivisions-a.width/2,0,(a.subdivisions-k)*a.height/a.subdivisions-a.height/2),b=4*(((O.x+a.width/2)/a.width*(a.bufferWidth-1)|0)+((1-(O.z+a.height/2)/a.height)*(a.bufferHeight-1)|0)*a.bufferWidth);let q=a.buffer[b]/255,Z=a.buffer[b+1]/255,F=a.buffer[b+2]/255;const r=a.buffer[b+3]/255;j&&(q=1-q,Z=1-Z,F=1-F);const J=q*P.r+Z*P.g+F*P.b;O.y=r>=h?a.minHeight+(a.maxHeight-a.minHeight)*J:a.minHeight-e.e,a.heightBuffer&&(a.heightBuffer[k*(a.subdivisions+1)+I]=O.y),i.push(O.x,O.y,O.z),G.push(0,0,0),Q.push(I/a.subdivisions,1-k/a.subdivisions)}for(k=0;k<a.subdivisions;k++)for(I=0;I<a.subdivisions;I++){const H=I+1+(k+1)*(a.subdivisions+1),b=I+1+k*(a.subdivisions+1),G=I+k*(a.subdivisions+1),q=I+(k+1)*(a.subdivisions+1),Q=i[3*H+1]>=a.minHeight,P=i[3*b+1]>=a.minHeight,e=i[3*G+1]>=a.minHeight;Q&&P&&e&&(O.push(H),O.push(b),O.push(G));i[3*q+1]>=a.minHeight&&Q&&e&&(O.push(q),O.push(H),O.push(G))}q.d.ComputeNormals(i,O,G);const Z=new q.d;return Z.indices=O,Z.wa=i,Z.Ka=G,Z.fa=Q,Z}function r(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new k(a,arguments.length>2?arguments[2]:void 0);i._setReady(!1),i._subdivisionsX=O.subdivisionsX||O.subdivisions||1,i._subdivisionsY=O.subdivisionsY||O.subdivisions||1,i._width=O.width||1,i._height=O.height||1,i._maxX=i._width/2,i._maxZ=i._height/2,i._minX=-i._maxX,i._minZ=-i._maxZ;return j(O).Ta(i,O.updatable),i._setReady(!0),i}function J(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new G.d(a,i);return Z(O).Ta(H,O.updatable),H}function ma(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const G=i.width||10,q=i.height||10,Q=i.subdivisions||1,e=i.minHeight||0,h=i.maxHeight||1,j=i.colorFilter||new b.mi(.3,.59,.11),Z=i.alphaFilter||0,r=i.updatable,J=i.onReady;H=H||P.b.LastCreatedScene;const ma=new k(a,H);let M;ma._subdivisionsX=Q,ma._subdivisionsY=Q,ma._width=G,ma._height=q,ma._maxX=ma._width/2,ma._maxZ=ma._height/2,ma._minX=-ma._maxX,ma._minZ=-ma._maxZ,ma._setReady(!1),i.passHeightBufferInCallback&&(M=new Float32Array((Q+1)*(Q+1)));const C=(a,O,i)=>{F({width:G,height:q,subdivisions:Q,minHeight:e,maxHeight:h,colorFilter:j,buffer:a,bufferWidth:O,bufferHeight:i,alphaFilter:Z,heightBuffer:M}).Ta(ma,r),J&&J(ma,M),ma._setReady(!0)};if("string"===typeof O){const a=a=>{var O;const i=a.width,b=a.height;if(H.h)return;const G=null===(O=H)||void 0===O?void 0:O.getEngine().resizeImageBitmap(a,i,b);C(G,i,b)};I.Tools.LoadImage(O,a,i.onError?i.onError:()=>{},H.offlineProvider)}else C(O.data,O.width,O.height);return ma}q.d.CreateGround=j,q.d.CreateTiledGround=Z,q.d.CreateGroundFromHeightMap=F,G.d.CreateGround=(a,O,i,H,b,G)=>r(a,{width:O,height:i,subdivisions:H,updatable:G},b),G.d.CreateTiledGround=(a,O,i,H,b,G,q,Q,k)=>J(a,{xmin:O,zmin:i,xmax:H,zmax:b,subdivisions:G,precision:q,updatable:k},Q),G.d.CreateGroundFromHeightMap=(a,O,i,H,b,G,q,Q,k,I,P)=>ma(a,O,{width:i,height:H,subdivisions:b,minHeight:G,maxHeight:q,updatable:k,onReady:I,alphaFilter:P},Q)},14292:(a,O,i)=>{"use strict";i.d(O,{d:()=>j,g:()=>e,j:()=>h});var H=i(12395),b=i(12841),G=i(12829),q=i(12942),Q=i(12470),k=i(12209);function I(a){const O=[],i=[],H=a.lines,b=a.Sa,q=[];let Q=0;for(let G=0;G<H.length;G++){const a=H[G];for(let H=0;H<a.length;H++){const{x:k,y:I,z:P}=a[H];if(i.push(k,I,P),b){const a=b[G],{r:O,g:i,b:Q,a:k}=a[H];q.push(O,i,Q,k)}H>0&&(O.push(Q-1),O.push(Q)),Q++}}const k=new G.d;return k.indices=O,k.wa=i,b&&(k.Sa=q),k}function P(a){const O=a.dashSize||3,i=a.gapSize||1,b=a.dashNb||200,q=a.points,Q=[],k=[],I=H.ZO.Zero();let P=0,e=0,h=0,j=0,Z=0,F=0,r=0;for(r=0;r<q.length-1;r++)q[r+1].subtractToRef(q[r],I),P+=I.length();for(h=P/b,j=O*h/(O+i),r=0;r<q.length-1;r++){q[r+1].subtractToRef(q[r],I),e=Math.floor(I.length()/h),I.normalize();for(let a=0;a<e;a++)Z=h*a,Q.push(q[r].x+Z*I.x,q[r].y+Z*I.y,q[r].z+Z*I.z),Q.push(q[r].x+(Z+j)*I.x,q[r].y+(Z+j)*I.y,q[r].z+(Z+j)*I.z),k.push(F,F+1),F+=2}const J=new G.d;return J.wa=Q,J.indices=k,J}function e(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=O.instance,b=O.lines,G=O.Sa;if(H){const a=H.getVerticesData(Q.c.PositionKind);let O,i;G&&(O=H.getVerticesData(Q.c.ColorKind));let q=0,k=0;for(let H=0;H<b.length;H++){const Q=b[H];for(let b=0;b<Q.length;b++)a[q]=Q[b].x,a[q+1]=Q[b].y,a[q+2]=Q[b].z,G&&O&&(i=G[H],O[k]=i[b].r,O[k+1]=i[b].g,O[k+2]=i[b].b,O[k+3]=i[b].a,k+=4),q+=3}return H.updateVerticesData(Q.c.PositionKind,a,!1,!1),G&&O&&H.updateVerticesData(Q.c.ColorKind,O,!1,!1),H.refreshBoundingInfo(),H}const k=!!G,P=new q.e(a,i,null,void 0,void 0,k,O.useVertexAlpha,O.material);return I(O).Ta(P,O.updatable),P}function h(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=O.Sa?[O.Sa]:null;return e(a,{lines:[O.points],updatable:O.updatable,instance:O.instance,Sa:H,useVertexAlpha:O.useVertexAlpha,material:O.material},i)}function j(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=O.points,Q=O.instance,I=O.gapSize||1,e=O.dashSize||3;if(Q){const a=a=>{const O=H.ZO.Zero(),i=a.length/6;let b=0,q=0,k=0,I=0,P=0,e=0,h=0,j=0;for(h=0;h<G.length-1;h++)G[h+1].subtractToRef(G[h],O),b+=O.length();k=b/i;const Z=Q._creationDataStorage.dashSize;for(I=Z*k/(Z+Q._creationDataStorage.gapSize),h=0;h<G.length-1;h++)for(G[h+1].subtractToRef(G[h],O),q=Math.floor(O.length()/k),O.normalize(),j=0;j<q&&e<a.length;)P=k*j,a[e]=G[h].x+P*O.x,a[e+1]=G[h].y+P*O.y,a[e+2]=G[h].z+P*O.z,a[e+3]=G[h].x+(P+I)*O.x,a[e+4]=G[h].y+(P+I)*O.y,a[e+5]=G[h].z+(P+I)*O.z,e+=6,j++;for(;e<a.length;)a[e]=G[h].x,a[e+1]=G[h].y,a[e+2]=G[h].z,e+=3};return(O.dashNb||O.dashSize||O.gapSize||O.useVertexAlpha||O.material)&&k.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),Q.updateMeshPositions(a,!1),Q}const h=new q.e(a,i,null,void 0,void 0,void 0,O.useVertexAlpha,O.material);return P(O).Ta(h,O.updatable),h._creationDataStorage=new b.f,h._creationDataStorage.dashSize=e,h._creationDataStorage.gapSize=I,h}G.d.CreateLineSystem=I,G.d.CreateDashedLines=P,b.d.fI=function(a,O){return h(a,{points:O,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},b.d.CreateDashedLines=function(a,O,i,H,b){return j(a,{points:O,dashSize:i,gapSize:H,dashNb:b,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13696:(a,O,i)=>{"use strict";i.d(O,{d:()=>Q,e:()=>k});var H=i(12841),b=i(12829),G=i(12448);function q(a){const O=[],i=[],H=[],q=[],Q=void 0!==a.width?a.width:void 0!==a.size?a.size:1,k=void 0!==a.height?a.height:void 0!==a.size?a.size:1,I=0===a.sideOrientation?0:a.sideOrientation||b.d.DEFAULTSIDE,P=Q/2,e=k/2;i.push(-P,-e,0),H.push(0,0,-1),q.push(0,G.c?1:0),i.push(P,-e,0),H.push(0,0,-1),q.push(1,G.c?1:0),i.push(P,e,0),H.push(0,0,-1),q.push(1,G.c?0:1),i.push(-P,e,0),H.push(0,0,-1),q.push(0,G.c?0:1),O.push(0),O.push(1),O.push(2),O.push(0),O.push(2),O.push(3),b.d._ComputeSides(I,i,O,H,q,a.frontUVs,a.backUVs);const h=new b.d;return h.indices=O,h.wa=i,h.Ka=H,h.fa=q,h}function Q(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new H.d(a,i);O.sideOrientation=H.d._GetDefaultSideOrientation(O.sideOrientation),b._originalBuilderSideOrientation=O.sideOrientation;return q(O).Ta(b,O.updatable),O.sourcePlane&&(b.translate(O.sourcePlane.normal,-O.sourcePlane.d),b.setDirection(O.sourcePlane.normal.scale(-1))),b}const k={AI:Q};b.d.AI=q,H.d.AI=(a,O,i,H,b)=>Q(a,{size:O,width:O,height:O,sideOrientation:b,updatable:H},i)},13783:(a,O,i)=>{"use strict";i.d(O,{b:()=>k});var H=i(12395),b=i(12841),G=i(12829),q=i(12448);function Q(a){const O=0|(a.segments||32),i=a.diameterX||a.diameter||1,b=a.diameterY||a.diameter||1,Q=a.diameterZ||a.diameter||1,k=a.arc&&(a.arc<=0||a.arc>1)?1:a.arc||1,I=a.slice&&a.slice<=0?1:a.slice||1,P=0===a.sideOrientation?0:a.sideOrientation||G.d.DEFAULTSIDE,e=!!a.dedupTopBottomIndices,h=new H.ZO(i/2,b/2,Q/2),j=2+O,Z=2*j,F=[],r=[],J=[],ma=[];for(let G=0;G<=j;G++){const a=G/j,O=a*Math.PI*I;for(let i=0;i<=Z;i++){const b=i/Z,G=b*Math.PI*2*k,Q=H.Matrix.RotationZ(-O),I=H.Matrix.RotationY(G),P=H.ZO.TransformCoordinates(H.ZO.Up(),Q),e=H.ZO.TransformCoordinates(P,I),j=e.multiply(h),F=e.divide(h).normalize();r.push(j.x,j.y,j.z),J.push(F.x,F.y,F.z),ma.push(b,q.c?1-a:a)}if(G>0){const a=r.length/3;for(let O=a-2*(Z+1);O+Z+2<a;O++)e?(G>1&&(F.push(O),F.push(O+1),F.push(O+Z+1)),(G<j||I<1)&&(F.push(O+Z+1),F.push(O+1),F.push(O+Z+2))):(F.push(O),F.push(O+1),F.push(O+Z+1),F.push(O+Z+1),F.push(O+1),F.push(O+Z+2))}}G.d._ComputeSides(P,r,F,J,ma,a.frontUVs,a.backUVs);const M=new G.d;return M.indices=F,M.wa=r,M.Ka=J,M.fa=ma,M}function k(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new b.d(a,i);O.sideOrientation=b.d._GetDefaultSideOrientation(O.sideOrientation),H._originalBuilderSideOrientation=O.sideOrientation;return Q(O).Ta(H,O.updatable),H}G.d.CreateSphere=Q,b.d.CreateSphere=(a,O,i,H,b,G)=>k(a,{segments:O,diameterX:i,diameterY:i,diameterZ:i,sideOrientation:G,updatable:b},H)},14601:(a,O,i)=>{"use strict";i.d(O,{d:()=>Q});var H=i(12966),b=i(14095),G=i(12985),q=i(12829);class Q{static get Configuration(){return{get decoder(){return b.b.DefaultConfiguration},set decoder(a){b.b.DefaultConfiguration=a}}}static set Configuration(a){b.b.DefaultConfiguration=a.decoder}static get DecoderAvailable(){return(0,H.e)(b.b.DefaultConfiguration)}static get Default(){return Q._Default??(Q._Default=new Q),Q._Default}static ResetDefault(a){Q._Default&&(a||Q._Default.dispose(),Q._Default=null)}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q.DefaultNumWorkers;const O="number"===typeof a?{...b.b.DefaultConfiguration,numWorkers:a}:{...b.b.DefaultConfiguration,...a};this._decoder=new b.b(O)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(a,O,i){return this._decoder.decodeMeshToMeshDataAsync(a,O,i)}async decodeMeshToGeometryAsync(a,O,i,H){return await this._decoder.decodeMeshToGeometryAsync(a,O,i,H)}async _decodeMeshToGeometryForGltfAsync(a,O,i,H,b,G){return await this._decoder._decodeMeshToGeometryForGltfAsync(a,O,i,H,b,G)}async decodeMeshAsync(a,O){const i=await this._decoder.decodeMeshToMeshDataAsync(a,O),H=new q.d;i.indices&&(H.indices=i.indices);for(const b of i.attributes){const a=G.c.GetFloatData(b.data,b.size,G.c.GetDataType(b.data),b.byteOffset,b.byteStride,b.normalized,i.totalVertices);H.set(a,b.kind)}return H}}Q.DefaultNumWorkers=(0,H.d)(),Q._Default=null},14095:(a,O,i)=>{"use strict";i.d(O,{b:()=>I});var H=i(12966),b=i(12184),G=i(12854),q=i(12985),Q=i(12209),k=i(12982);class I extends H.c{static get DefaultAvailable(){return(0,H.e)(I.DefaultConfiguration)}static get Default(){return I._Default??(I._Default=new I),I._Default}static ResetDefault(a){I._Default&&(a||I._Default.dispose(),I._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(a,O){return{module:await(O||DracoDecoderModule)({wasmBinary:a})}}_getWorkerContent(){return`${k.d}(${k.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.DefaultConfiguration)}decodeMeshToMeshDataAsync(a,O,i){const H=a instanceof ArrayBuffer?new Int8Array(a):new Int8Array(a.buffer,a.byteOffset,a.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async a=>await new Promise(((b,G)=>{a.push(((a,q)=>{let k=null;const I=[],P=O=>{a.removeEventListener("error",P),a.removeEventListener("message",e),G(O),q()},e=O=>{const H=O.data;switch(H.id){case"indices":k=H.data;break;case"attribute":I.push({kind:H.kind,data:H.data,size:H.size,byteOffset:H.byteOffset,byteStride:H.byteStride,normalized:(G=H.kind,h=H.normalized,i&&void 0!==i[G]?(h!==i[G]&&Q.c.Warn(`Normalized flag from Draco data (${h}) does not match normalized flag from glTF accessor (${i[G]}). Using flag from glTF accessor.`),i[G]):h)});break;case"decodeMeshDone":a.removeEventListener("error",P),a.removeEventListener("message",e),b({indices:k,attributes:I,totalVertices:H.totalVertices}),q()}var G,h};a.addEventListener("error",P),a.addEventListener("message",e);const h=H.slice();a.postMessage({id:"decodeMesh",dataView:h,attributes:O},[h.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((a=>{let i=null;const b=[],G=(0,k.d)(a.module,H,O,(a=>{i=a}),((a,O,i,H,G,q)=>{b.push({kind:a,data:O,size:i,byteOffset:H,byteStride:G,normalized:q})}));return{indices:i,attributes:b,totalVertices:G}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(a,O,i,H){const b=await this.decodeMeshToMeshDataAsync(i,H),Q=new G.b(a,O);b.indices&&Q.setIndices(b.indices);for(const G of b.attributes)Q.setVerticesBuffer(new q.c(O.getEngine(),G.data,G.kind,!1,void 0,G.byteStride,void 0,G.byteOffset,G.size,void 0,G.normalized,!0),b.totalVertices);return Q}async _decodeMeshToGeometryForGltfAsync(a,O,i,H,b,Q){const k=await this.decodeMeshToMeshDataAsync(i,H,b),I=new G.b(a,O);Q&&(I._boundingInfo=Q,I.useBoundingInfoFromGeometry=!0),k.indices&&I.setIndices(k.indices);for(const G of k.attributes)I.setVerticesBuffer(new q.c(O.getEngine(),G.data,G.kind,!1,void 0,G.byteStride,void 0,G.byteOffset,G.size,void 0,G.normalized,!0),k.totalVertices);return I}}I.DefaultConfiguration={wasmUrl:`${b.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${b.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${b.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},I._Default=null},14284:(a,O,i)=>{"use strict";i.d(O,{b:()=>Qa});var H=i(12395),b=i(12841),G=i(12470),q=i(12829),Q=i(12448);function k(a){let O=a.pathArray;const i=a.closeArray||!1,H=a.closePath||!1,b=a.invertUV||!1,k=Math.floor(O[0].length/2);let I=a.offset||k;I=I>k?k:Math.floor(I);const P=0===a.sideOrientation?0:a.sideOrientation||q.d.DEFAULTSIDE,e=a.fa,h=a.Sa,j=[],Z=[],F=[],r=[],J=[],ma=[],M=[],C=[];let n;const D=[],U=[];let y,w,K;if(O.length<2){const a=[],i=[];for(w=0;w<O[0].length-I;w++)a.push(O[0][w]),i.push(O[0][w+I]);O=[a,i]}let S=0;const f=H?1:0,B=i?1:0;let T,A,E,l,W,u;for(n=O[0].length,y=0;y<O.length+B;y++){for(M[y]=0,J[y]=[0],T=y===O.length?O[0]:O[y],A=T.length,n=n<A?n:A,K=0;K<A;)j.push(T[K].x,T[K].y,T[K].z),K>0&&(E=T[K].FO(T[K-1]).length(),l=E+M[y],J[y].push(l),M[y]=l),K++;H&&(K--,j.push(T[0].x,T[0].y,T[0].z),E=T[K].FO(T[0]).length(),l=E+M[y],J[y].push(l),M[y]=l),D[y]=A+f,U[y]=S,S+=A+f}let c,R,z=null,x=null;for(w=0;w<n+f;w++)for(C[w]=0,ma[w]=[0],y=0;y<O.length-1+B;y++)W=O[y],u=y===O.length-1?O[0]:O[y+1],w===n?(z=W[0],x=u[0]):(z=W[w],x=u[w]),E=x.FO(z).length(),l=E+C[w],ma[w].push(l),C[w]=l;if(e)for(y=0;y<e.length;y++)r.push(e[y].x,Q.c?1-e[y].y:e[y].y);else for(y=0;y<O.length+B;y++)for(w=0;w<n+f;w++)c=0!=M[y]?J[y][w]/M[y]:0,R=0!=C[w]?ma[w][y]/C[w]:0,b?r.push(R,c):r.push(c,Q.c?1-R:R);y=0;let g=0,N=D[y]-1,v=D[y+1]-1,X=N<v?N:v,p=U[1]-U[0];const o=D.length-1;for(;g<=X&&y<o;)Z.push(g,g+p,g+1),Z.push(g+p+1,g+1,g+p),g+=1,g===X&&(y++,p=U[y+1]-U[y],N=D[y]-1,v=D[y+1]-1,g=U[y],X=N<v?N+g:v+g);if(q.d.ComputeNormals(j,Z,F),H){let a=0,i=0;for(y=0;y<O.length;y++){a=3*U[y],i=y+1<O.length?3*(U[y+1]-1):F.length-3,F[a]=.5*(F[a]+F[i]),F[a+1]=.5*(F[a+1]+F[i+1]),F[a+2]=.5*(F[a+2]+F[i+2]);const H=Math.sqrt(F[a]*F[a]+F[a+1]*F[a+1]+F[a+2]*F[a+2]);F[a]/=H,F[a+1]/=H,F[a+2]/=H,F[i]=F[a],F[i+1]=F[a+1],F[i+2]=F[a+2]}}if(i){let a=3*U[0],i=3*U[O.length];for(w=0;w<n+f;w++){F[a]=.5*(F[a]+F[i]),F[a+1]=.5*(F[a+1]+F[i+1]),F[a+2]=.5*(F[a+2]+F[i+2]);const O=Math.sqrt(F[a]*F[a]+F[a+1]*F[a+1]+F[a+2]*F[a+2]);F[a]/=O,F[a+1]/=O,F[a+2]/=O,F[i]=F[a],F[i+1]=F[a+1],F[i+2]=F[a+2],a+=3,i+=3}}q.d._ComputeSides(P,j,Z,F,r,a.frontUVs,a.backUVs);let d=null;if(h){d=new Float32Array(4*h.length);for(let a=0;a<h.length;a++)d[4*a]=h[a].r,d[4*a+1]=h[a].g,d[4*a+2]=h[a].b,d[4*a+3]=h[a].a}const Y=new q.d,L=new Float32Array(j),s=new Float32Array(F),t=new Float32Array(r);return Y.indices=Z,Y.wa=L,Y.Ka=s,Y.fa=t,d&&Y.set(d,G.c.ColorKind),H&&(Y._idx=U),Y}function I(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=O.pathArray,P=O.closeArray,e=O.closePath,h=b.d._GetDefaultSideOrientation(O.sideOrientation),j=O.instance,Z=O.updatable;if(j){const a=H.TmpVectors.ZO[0].Tb(Number.MAX_VALUE),i=H.TmpVectors.ZO[1].Tb(-Number.MAX_VALUE),k=O=>{let H=I[0].length;const G=j;let q=0;const Q=G._originalBuilderSideOrientation===b.d.DOUBLESIDE?2:1;for(let b=1;b<=Q;++b)for(let Q=0;Q<I.length;++Q){const b=I[Q],k=b.length;H=H<k?H:k;for(let G=0;G<H;++G){const H=b[G];O[q]=H.x,O[q+1]=H.y,O[q+2]=H.z,a.minimizeInPlaceFromFloats(H.x,H.y,H.z),i.maximizeInPlaceFromFloats(H.x,H.y,H.z),q+=3}if(G._creationDataStorage&&G._creationDataStorage.closePath){const a=b[0];O[q]=a.x,O[q+1]=a.y,O[q+2]=a.z,q+=3}}},P=j.getVerticesData(G.c.PositionKind);if(k(P),j.hasBoundingInfo?j.getBoundingInfo().reConstruct(a,i,j._worldMatrix):j.buildBoundingInfo(a,i,j._worldMatrix),j.updateVerticesData(G.c.PositionKind,P,!1,!1),O.Sa){const a=j.getVerticesData(G.c.ColorKind);for(let i=0,H=0;i<O.Sa.length;i++,H+=4){const b=O.Sa[i];a[H]=b.r,a[H+1]=b.g,a[H+2]=b.b,a[H+3]=b.a}j.updateVerticesData(G.c.ColorKind,a,!1,!1)}if(O.fa){const a=j.getVerticesData(G.c.UVKind);for(let i=0;i<O.fa.length;i++)a[2*i]=O.fa[i].x,a[2*i+1]=Q.c?1-O.fa[i].y:O.fa[i].y;j.updateVerticesData(G.c.UVKind,a,!1,!1)}if(!j.areNormalsFrozen||j.isFacetDataEnabled){const a=j.Kb(),O=j.getVerticesData(G.c.NormalKind),i=j.isFacetDataEnabled?j.getFacetDataParameters():null;if(q.d.ComputeNormals(P,a,O,i),j._creationDataStorage&&j._creationDataStorage.closePath){let a=0,i=0;for(let H=0;H<I.length;H++)a=3*j._creationDataStorage.idx[H],i=H+1<I.length?3*(j._creationDataStorage.idx[H+1]-1):O.length-3,O[a]=.5*(O[a]+O[i]),O[a+1]=.5*(O[a+1]+O[i+1]),O[a+2]=.5*(O[a+2]+O[i+2]),O[i]=O[a],O[i+1]=O[a+1],O[i+2]=O[a+2]}j.areNormalsFrozen||j.updateVerticesData(G.c.NormalKind,O,!1,!1)}return j}{const H=new b.d(a,i);H._originalBuilderSideOrientation=h,H._creationDataStorage=new b.f;const G=k(O);return e&&(H._creationDataStorage.idx=G._idx),H._creationDataStorage.closePath=e,H._creationDataStorage.closeArray=P,G.Ta(H,Z),H}}q.d.CreateRibbon=k,b.d.CreateRibbon=function(a,O){return I(a,{pathArray:O,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var P=i(13796),e=i(13637),h=i(12436);function j(a){const O=a.pattern||b.d.NO_FLIP,i=a.tileWidth||a.tileSize||1,H=a.tileHeight||a.tileSize||1,G=a.alignHorizontal||0,Q=a.alignVertical||0,k=a.width||a.size||1,I=Math.floor(k/i);let P=k-I*i;const e=a.height||a.size||1,h=Math.floor(e/H);let j=e-h*H;const Z=i*I/2,F=H*h/2;let r=0,J=0,ma=0,M=0,C=0,n=0;if(P>0||j>0){switch(ma=-Z,M=-F,C=Z,n=F,G){case b.d.CENTER:P/=2,ma-=P,C+=P;break;case b.d.LEFT:C+=P,r=-P/2;break;case b.d.RIGHT:ma-=P,r=P/2}switch(Q){case b.d.CENTER:j/=2,M-=j,n+=j;break;case b.d.BOTTOM:n+=j,J=-j/2;break;case b.d.TOP:M-=j,J=j/2}}const D=[],U=[],y=[];y[0]=[0,0,1,0,1,1,0,1],y[1]=[0,0,1,0,1,1,0,1],O!==b.d.ROTATE_TILE&&O!==b.d.ROTATE_ROW||(y[1]=[1,1,0,1,0,0,1,0]),O!==b.d.FLIP_TILE&&O!==b.d.FLIP_ROW||(y[1]=[1,0,0,0,0,1,1,1]),O!==b.d.FLIP_N_ROTATE_TILE&&O!==b.d.FLIP_N_ROTATE_ROW||(y[1]=[0,1,1,1,1,0,0,0]);let w=[];const K=[],S=[];let f=0;for(let q=0;q<h;q++)for(let a=0;a<I;a++)D.push(a*i-Z+r,q*H-F+J,0),D.push((a+1)*i-Z+r,q*H-F+J,0),D.push((a+1)*i-Z+r,(q+1)*H-F+J,0),D.push(a*i-Z+r,(q+1)*H-F+J,0),S.push(f,f+1,f+3,f+1,f+2,f+3),w=O===b.d.FLIP_TILE||O===b.d.ROTATE_TILE||O===b.d.FLIP_N_ROTATE_TILE?w.concat(y[(a%2+q%2)%2]):O===b.d.FLIP_ROW||O===b.d.ROTATE_ROW||O===b.d.FLIP_N_ROTATE_ROW?w.concat(y[q%2]):w.concat(y[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),f+=4;if(P>0||j>0){const a=j>0&&(Q===b.d.CENTER||Q===b.d.TOP),q=j>0&&(Q===b.d.CENTER||Q===b.d.BOTTOM),k=P>0&&(G===b.d.CENTER||G===b.d.RIGHT),e=P>0&&(G===b.d.CENTER||G===b.d.LEFT);let y,B,T,A,E=[];if(a&&k&&(D.push(ma+r,M+J,0),D.push(-Z+r,M+J,0),D.push(-Z+r,M+j+J,0),D.push(ma+r,M+j+J,0),S.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,y=1-P/i,B=1-j/H,T=1,A=1,E=[y,B,T,B,T,A,y,A],O===b.d.ROTATE_ROW&&(E=[1-y,1-B,1-T,1-B,1-T,1-A,1-y,1-A]),O===b.d.FLIP_ROW&&(E=[1-y,B,1-T,B,1-T,A,1-y,A]),O===b.d.FLIP_N_ROTATE_ROW&&(E=[y,1-B,T,1-B,T,1-A,y,1-A]),w=w.concat(E),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a&&e&&(D.push(Z+r,M+J,0),D.push(C+r,M+J,0),D.push(C+r,M+j+J,0),D.push(Z+r,M+j+J,0),S.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,y=0,B=1-j/H,T=P/i,A=1,E=[y,B,T,B,T,A,y,A],(O===b.d.ROTATE_ROW||O===b.d.ROTATE_TILE&&I%2===0)&&(E=[1-y,1-B,1-T,1-B,1-T,1-A,1-y,1-A]),(O===b.d.FLIP_ROW||O===b.d.FLIP_TILE&&I%2===0)&&(E=[1-y,B,1-T,B,1-T,A,1-y,A]),(O===b.d.FLIP_N_ROTATE_ROW||O===b.d.FLIP_N_ROTATE_TILE&&I%2===0)&&(E=[y,1-B,T,1-B,T,1-A,y,1-A]),w=w.concat(E),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&k&&(D.push(ma+r,F+J,0),D.push(-Z+r,F+J,0),D.push(-Z+r,n+J,0),D.push(ma+r,n+J,0),S.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,y=1-P/i,B=0,T=1,A=j/H,E=[y,B,T,B,T,A,y,A],(O===b.d.ROTATE_ROW&&h%2===1||O===b.d.ROTATE_TILE&&h%1===0)&&(E=[1-y,1-B,1-T,1-B,1-T,1-A,1-y,1-A]),(O===b.d.FLIP_ROW&&h%2===1||O===b.d.FLIP_TILE&&h%2===0)&&(E=[1-y,B,1-T,B,1-T,A,1-y,A]),(O===b.d.FLIP_N_ROTATE_ROW&&h%2===1||O===b.d.FLIP_N_ROTATE_TILE&&h%2===0)&&(E=[y,1-B,T,1-B,T,1-A,y,1-A]),w=w.concat(E),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&e&&(D.push(Z+r,F+J,0),D.push(C+r,F+J,0),D.push(C+r,n+J,0),D.push(Z+r,n+J,0),S.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,y=0,B=0,T=P/i,A=j/H,E=[y,B,T,B,T,A,y,A],(O===b.d.ROTATE_ROW&&h%2===1||O===b.d.ROTATE_TILE&&(h+I)%2===1)&&(E=[1-y,1-B,1-T,1-B,1-T,1-A,1-y,1-A]),(O===b.d.FLIP_ROW&&h%2===1||O===b.d.FLIP_TILE&&(h+I)%2===1)&&(E=[1-y,B,1-T,B,1-T,A,1-y,A]),(O===b.d.FLIP_N_ROTATE_ROW&&h%2===1||O===b.d.FLIP_N_ROTATE_TILE&&(h+I)%2===1)&&(E=[y,1-B,T,1-B,T,1-A,y,1-A]),w=w.concat(E),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),a){const a=[];y=0,B=1-j/H,T=1,A=1,a[0]=[y,B,T,B,T,A,y,A],a[1]=[y,B,T,B,T,A,y,A],O!==b.d.ROTATE_TILE&&O!==b.d.ROTATE_ROW||(a[1]=[1-y,1-B,1-T,1-B,1-T,1-A,1-y,1-A]),O!==b.d.FLIP_TILE&&O!==b.d.FLIP_ROW||(a[1]=[1-y,B,1-T,B,1-T,A,1-y,A]),O!==b.d.FLIP_N_ROTATE_TILE&&O!==b.d.FLIP_N_ROTATE_ROW||(a[1]=[y,1-B,T,1-B,T,1-A,y,1-A]);for(let H=0;H<I;H++)D.push(H*i-Z+r,M+J,0),D.push((H+1)*i-Z+r,M+J,0),D.push((H+1)*i-Z+r,M+j+J,0),D.push(H*i-Z+r,M+j+J,0),S.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,w=O===b.d.FLIP_TILE||O===b.d.ROTATE_TILE||O===b.d.FLIP_N_ROTATE_TILE?w.concat(a[(H+1)%2]):O===b.d.FLIP_ROW||O===b.d.ROTATE_ROW||O===b.d.FLIP_N_ROTATE_ROW?w.concat(a[1]):w.concat(a[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(q){const a=[];y=0,B=0,T=1,A=j/H,a[0]=[y,B,T,B,T,A,y,A],a[1]=[y,B,T,B,T,A,y,A],O!==b.d.ROTATE_TILE&&O!==b.d.ROTATE_ROW||(a[1]=[1-y,1-B,1-T,1-B,1-T,1-A,1-y,1-A]),O!==b.d.FLIP_TILE&&O!==b.d.FLIP_ROW||(a[1]=[1-y,B,1-T,B,1-T,A,1-y,A]),O!==b.d.FLIP_N_ROTATE_TILE&&O!==b.d.FLIP_N_ROTATE_ROW||(a[1]=[y,1-B,T,1-B,T,1-A,y,1-A]);for(let H=0;H<I;H++)D.push(H*i-Z+r,n-j+J,0),D.push((H+1)*i-Z+r,n-j+J,0),D.push((H+1)*i-Z+r,n+J,0),D.push(H*i-Z+r,n+J,0),S.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,w=O===b.d.FLIP_TILE||O===b.d.ROTATE_TILE||O===b.d.FLIP_N_ROTATE_TILE?w.concat(a[(H+h)%2]):O===b.d.FLIP_ROW||O===b.d.ROTATE_ROW||O===b.d.FLIP_N_ROTATE_ROW?w.concat(a[h%2]):w.concat(a[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(k){const a=[];y=1-P/i,B=0,T=1,A=1,a[0]=[y,B,T,B,T,A,y,A],a[1]=[y,B,T,B,T,A,y,A],O!==b.d.ROTATE_TILE&&O!==b.d.ROTATE_ROW||(a[1]=[1-y,1-B,1-T,1-B,1-T,1-A,1-y,1-A]),O!==b.d.FLIP_TILE&&O!==b.d.FLIP_ROW||(a[1]=[1-y,B,1-T,B,1-T,A,1-y,A]),O!==b.d.FLIP_N_ROTATE_TILE&&O!==b.d.FLIP_N_ROTATE_ROW||(a[1]=[y,1-B,T,1-B,T,1-A,y,1-A]);for(let i=0;i<h;i++)D.push(ma+r,i*H-F+J,0),D.push(ma+P+r,i*H-F+J,0),D.push(ma+P+r,(i+1)*H-F+J,0),D.push(ma+r,(i+1)*H-F+J,0),S.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,w=O===b.d.FLIP_TILE||O===b.d.ROTATE_TILE||O===b.d.FLIP_N_ROTATE_TILE?w.concat(a[(i+1)%2]):O===b.d.FLIP_ROW||O===b.d.ROTATE_ROW||O===b.d.FLIP_N_ROTATE_ROW?w.concat(a[i%2]):w.concat(a[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(e){const a=[];y=0,B=0,T=P/H,A=1,a[0]=[y,B,T,B,T,A,y,A],a[1]=[y,B,T,B,T,A,y,A],O!==b.d.ROTATE_TILE&&O!==b.d.ROTATE_ROW||(a[1]=[1-y,1-B,1-T,1-B,1-T,1-A,1-y,1-A]),O!==b.d.FLIP_TILE&&O!==b.d.FLIP_ROW||(a[1]=[1-y,B,1-T,B,1-T,A,1-y,A]),O!==b.d.FLIP_N_ROTATE_TILE&&O!==b.d.FLIP_N_ROTATE_ROW||(a[1]=[y,1-B,T,1-B,T,1-A,y,1-A]);for(let i=0;i<h;i++)D.push(C-P+r,i*H-F+J,0),D.push(C+r,i*H-F+J,0),D.push(C+r,(i+1)*H-F+J,0),D.push(C-P+r,(i+1)*H-F+J,0),S.push(f,f+1,f+3,f+1,f+2,f+3),f+=4,w=O===b.d.FLIP_TILE||O===b.d.ROTATE_TILE||O===b.d.FLIP_N_ROTATE_TILE?w.concat(a[(i+I)%2]):O===b.d.FLIP_ROW||O===b.d.ROTATE_ROW||O===b.d.FLIP_N_ROTATE_ROW?w.concat(a[i%2]):w.concat(a[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),U.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const B=0===a.sideOrientation?0:a.sideOrientation||q.d.DEFAULTSIDE;q.d._ComputeSides(B,D,S,U,w,a.frontUVs,a.backUVs);const T=new q.d;T.indices=S,T.wa=D,T.Ka=U,T.fa=w;const A=B===q.d.DOUBLESIDE?K.concat(K):K;return T.Sa=A,T}function Z(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new b.d(a,i);O.sideOrientation=b.d._GetDefaultSideOrientation(O.sideOrientation),H._originalBuilderSideOrientation=O.sideOrientation;return j(O).Ta(H,O.updatable),H}function F(a){const O=a.faceUV||new Array(6),i=a.faceColors,G=a.pattern||b.d.NO_FLIP,k=a.width||a.size||1,I=a.height||a.size||1,P=a.depth||a.size||1,e=a.tileWidth||a.tileSize||1,Z=a.tileHeight||a.tileSize||1,F=a.alignHorizontal||0,r=a.alignVertical||0,J=0===a.sideOrientation?0:a.sideOrientation||q.d.DEFAULTSIDE;for(let b=0;b<6;b++)void 0===O[b]&&(O[b]=new H.Vector4(0,0,1,1)),i&&void 0===i[b]&&(i[b]=new h.Ab(1,1,1,1));const ma=k/2,M=I/2,C=P/2,n=[];for(let H=0;H<2;H++)n[H]=j({pattern:G,tileWidth:e,tileHeight:Z,width:k,height:I,alignVertical:r,alignHorizontal:F,sideOrientation:J});for(let H=2;H<4;H++)n[H]=j({pattern:G,tileWidth:e,tileHeight:Z,width:P,height:I,alignVertical:r,alignHorizontal:F,sideOrientation:J});let D=r;r===b.d.BOTTOM?D=b.d.TOP:r===b.d.TOP&&(D=b.d.BOTTOM);for(let H=4;H<6;H++)n[H]=j({pattern:G,tileWidth:e,tileHeight:Z,width:k,height:P,alignVertical:D,alignHorizontal:F,sideOrientation:J});let U=[],y=[],w=[],K=[];const S=[],f=[],B=[],T=[];let A=0,E=0;for(let b=0;b<6;b++){const a=n[b].wa.length;f[b]=[],B[b]=[];for(let O=0;O<a/3;O++)f[b].push(new H.ZO(n[b].wa[3*O],n[b].wa[3*O+1],n[b].wa[3*O+2])),B[b].push(new H.ZO(n[b].Ka[3*O],n[b].Ka[3*O+1],n[b].Ka[3*O+2]));A=n[b].fa.length,T[b]=[];for(let i=0;i<A;i+=2)T[b][i]=O[b].x+(O[b].z-O[b].x)*n[b].fa[i],T[b][i+1]=O[b].y+(O[b].w-O[b].y)*n[b].fa[i+1],Q.c&&(T[b][i+1]=1-T[b][i+1]);if(w=w.concat(T[b]),K=K.concat(n[b].indices.map((a=>a+E))),E+=f[b].length,i)for(let O=0;O<4;O++)S.push(i[b].r,i[b].g,i[b].b,i[b].a)}const l=new H.ZO(0,0,C),W=H.Matrix.RotationY(Math.PI);U=f[0].map((a=>H.ZO.TransformNormal(a,W).add(l))).map((a=>[a.x,a.y,a.z])).reduce(((a,O)=>a.concat(O)),[]),y=B[0].map((a=>H.ZO.TransformNormal(a,W))).map((a=>[a.x,a.y,a.z])).reduce(((a,O)=>a.concat(O)),[]),U=U.concat(f[1].map((a=>a.FO(l))).map((a=>[a.x,a.y,a.z])).reduce(((a,O)=>a.concat(O)),[])),y=y.concat(B[1].map((a=>[a.x,a.y,a.z])).reduce(((a,O)=>a.concat(O)),[]));const u=new H.ZO(ma,0,0),c=H.Matrix.RotationY(-Math.PI/2);U=U.concat(f[2].map((a=>H.ZO.TransformNormal(a,c).add(u))).map((a=>[a.x,a.y,a.z])).reduce(((a,O)=>a.concat(O)),[])),y=y.concat(B[2].map((a=>H.ZO.TransformNormal(a,c))).map((a=>[a.x,a.y,a.z])).reduce(((a,O)=>a.concat(O)),[]));const R=H.Matrix.RotationY(Math.PI/2);U=U.concat(f[3].map((a=>H.ZO.TransformNormal(a,R).FO(u))).map((a=>[a.x,a.y,a.z])).reduce(((a,O)=>a.concat(O)),[])),y=y.concat(B[3].map((a=>H.ZO.TransformNormal(a,R))).map((a=>[a.x,a.y,a.z])).reduce(((a,O)=>a.concat(O)),[]));const z=new H.ZO(0,M,0),x=H.Matrix.RotationX(Math.PI/2);U=U.concat(f[4].map((a=>H.ZO.TransformNormal(a,x).add(z))).map((a=>[a.x,a.y,a.z])).reduce(((a,O)=>a.concat(O)),[])),y=y.concat(B[4].map((a=>H.ZO.TransformNormal(a,x))).map((a=>[a.x,a.y,a.z])).reduce(((a,O)=>a.concat(O)),[]));const g=H.Matrix.RotationX(-Math.PI/2);U=U.concat(f[5].map((a=>H.ZO.TransformNormal(a,g).FO(z))).map((a=>[a.x,a.y,a.z])).reduce(((a,O)=>a.concat(O)),[])),y=y.concat(B[5].map((a=>H.ZO.TransformNormal(a,g))).map((a=>[a.x,a.y,a.z])).reduce(((a,O)=>a.concat(O)),[])),q.d._ComputeSides(J,U,K,y,w);const N=new q.d;if(N.indices=K,N.wa=U,N.Ka=y,N.fa=w,i){const a=J===q.d.DOUBLESIDE?S.concat(S):S;N.Sa=a}return N}function r(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new b.d(a,i);O.sideOrientation=b.d._GetDefaultSideOrientation(O.sideOrientation),H._originalBuilderSideOrientation=O.sideOrientation;return F(O).Ta(H,O.updatable),H}q.d.CreateTiledPlane=j;q.d.CreateTiledBox=F;var J=i(13783),ma=i(12648),M=i(12602);function C(a){const O=a.height||2;let i=0===a.diameterTop?0:a.diameterTop||a.diameter||1,G=0===a.diameterBottom?0:a.diameterBottom||a.diameter||1;i=i||1e-5,G=G||1e-5;const k=0|(a.tessellation||24),I=0|(a.subdivisions||1),P=!!a.hasRings,e=!!a.enclose,j=0===a.cap?0:a.cap||b.d.CAP_ALL,Z=a.arc&&(a.arc<=0||a.arc>1)?1:a.arc||1,F=0===a.sideOrientation?0:a.sideOrientation||q.d.DEFAULTSIDE,r=a.faceUV||new Array(3),J=a.faceColors,ma=2+(1+(1!==Z&&e?2:0))*(P?I:1);let C;for(C=0;C<ma;C++)J&&void 0===J[C]&&(J[C]=new h.Ab(1,1,1,1));for(C=0;C<ma;C++)r&&void 0===r[C]&&(r[C]=new H.Vector4(0,0,1,1));const n=[],D=[],U=[],y=[],w=[],K=2*Math.PI*Z/k;let S,f,B;const T=(G-i)/2/O,A=H.ZO.Zero(),E=H.ZO.Zero(),l=H.ZO.Zero(),W=H.ZO.Zero(),u=H.ZO.Zero(),c=M.b.Y;let R,z,x,g=1,N=1,v=0,X=0;for(R=0;R<=I;R++)for(f=R/I,B=(f*(i-G)+G)/2,g=P&&0!==R&&R!==I?2:1,x=0;x<g;x++){for(P&&(N+=x),e&&(N+=2*x),z=0;z<=k;z++)S=z*K,A.x=Math.cos(-S)*B,A.y=-O/2+f*O,A.z=Math.sin(-S)*B,0===i&&R===I?(E.x=U[U.length-3*(k+1)],E.y=U[U.length-3*(k+1)+1],E.z=U[U.length-3*(k+1)+2]):(E.x=A.x,E.z=A.z,E.y=Math.sqrt(E.x*E.x+E.z*E.z)*T,E.normalize()),0===z&&(l.q(A),W.q(E)),D.push(A.x,A.y,A.z),U.push(E.x,E.y,E.z),X=P?v!==N?r[N].y:r[N].w:r[N].y+(r[N].w-r[N].y)*f,y.push(r[N].x+(r[N].z-r[N].x)*z/k,Q.c?1-X:X),J&&w.push(J[N].r,J[N].g,J[N].b,J[N].a);1!==Z&&e&&(D.push(A.x,A.y,A.z),D.push(0,A.y,0),D.push(0,A.y,0),D.push(l.x,l.y,l.z),H.ZO.CrossToRef(c,E,u),u.normalize(),U.push(u.x,u.y,u.z,u.x,u.y,u.z),H.ZO.CrossToRef(W,c,u),u.normalize(),U.push(u.x,u.y,u.z,u.x,u.y,u.z),X=P?v!==N?r[N+1].y:r[N+1].w:r[N+1].y+(r[N+1].w-r[N+1].y)*f,y.push(r[N+1].x,Q.c?1-X:X),y.push(r[N+1].z,Q.c?1-X:X),X=P?v!==N?r[N+2].y:r[N+2].w:r[N+2].y+(r[N+2].w-r[N+2].y)*f,y.push(r[N+2].x,Q.c?1-X:X),y.push(r[N+2].z,Q.c?1-X:X),J&&(w.push(J[N+1].r,J[N+1].g,J[N+1].b,J[N+1].a),w.push(J[N+1].r,J[N+1].g,J[N+1].b,J[N+1].a),w.push(J[N+2].r,J[N+2].g,J[N+2].b,J[N+2].a),w.push(J[N+2].r,J[N+2].g,J[N+2].b,J[N+2].a))),v!==N&&(v=N)}const p=1!==Z&&e?k+4:k;for(R=0,N=0;N<I;N++){let a=0,O=0,i=0,H=0;for(z=0;z<k;z++)a=R*(p+1)+z,O=(R+1)*(p+1)+z,i=R*(p+1)+(z+1),H=(R+1)*(p+1)+(z+1),n.push(a,O,i),n.push(H,i,O);1!==Z&&e&&(n.push(a+2,O+2,i+2),n.push(H+2,i+2,O+2),n.push(a+4,O+4,i+4),n.push(H+4,i+4,O+4)),R=P?R+2:R+1}const o=a=>{const b=a?i/2:G/2;if(0===b)return;let q,I,P;const e=a?r[ma-1]:r[0];let h=null;J&&(h=a?J[ma-1]:J[0]);const j=D.length/3,F=a?O/2:-O/2,M=new H.ZO(0,F,0);D.push(M.x,M.y,M.z),U.push(0,a?1:-1,0);const C=e.y+.5*(e.w-e.y);y.push(e.x+.5*(e.z-e.x),Q.c?1-C:C),h&&w.push(h.r,h.g,h.b,h.a);const K=new H.Vector2(.5,.5);for(P=0;P<=k;P++){q=2*Math.PI*P*Z/k;const O=Math.cos(-q),i=Math.sin(-q);I=new H.ZO(O*b,F,i*b);const G=new H.Vector2(O*K.x+.5,i*K.y+.5);D.push(I.x,I.y,I.z),U.push(0,a?1:-1,0);const j=e.y+(e.w-e.y)*G.y;y.push(e.x+(e.z-e.x)*G.x,Q.c?1-j:j),h&&w.push(h.r,h.g,h.b,h.a)}for(P=0;P<k;P++)a?(n.push(j),n.push(j+(P+2)),n.push(j+(P+1))):(n.push(j),n.push(j+(P+1)),n.push(j+(P+2)))};j!==b.d.CAP_START&&j!==b.d.CAP_ALL||o(!1),j!==b.d.CAP_END&&j!==b.d.CAP_ALL||o(!0),q.d._ComputeSides(F,D,n,U,y,a.frontUVs,a.backUVs);const d=new q.d;return d.indices=n,d.wa=D,d.Ka=U,d.fa=y,J&&(d.Sa=w),d}function n(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const H=new b.d(a,i);O.sideOrientation=b.d._GetDefaultSideOrientation(O.sideOrientation),H._originalBuilderSideOrientation=O.sideOrientation;return C(O).Ta(H,O.updatable),H}function D(a){const O=[],i=[],b=[],G=[],k=a.diameter||1,I=a.thickness||.5,P=0|(a.tessellation||16),e=0===a.sideOrientation?0:a.sideOrientation||q.d.DEFAULTSIDE,h=P+1;for(let q=0;q<=P;q++){const a=q/P,e=q*Math.PI*2/P-Math.PI/2,j=H.Matrix.Translation(k/2,0,0).multiply(H.Matrix.RotationY(e));for(let k=0;k<=P;k++){const e=1-k/P,Z=k*Math.PI*2/P+Math.PI,F=Math.cos(Z),r=Math.sin(Z);let J=new H.ZO(F,r,0),ma=J.scale(I/2);const M=new H.Vector2(a,e);ma=H.ZO.TransformCoordinates(ma,j),J=H.ZO.TransformNormal(J,j),i.push(ma.x,ma.y,ma.z),b.push(J.x,J.y,J.z),G.push(M.x,Q.c?1-M.y:M.y);const C=(q+1)%h,n=(k+1)%h;O.push(q*h+k),O.push(q*h+n),O.push(C*h+k),O.push(q*h+n),O.push(C*h+n),O.push(C*h+k)}}q.d._ComputeSides(e,i,O,b,G,a.frontUVs,a.backUVs);const j=new q.d;return j.indices=O,j.wa=i,j.Ka=b,j.fa=G,j}function U(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const H=new b.d(a,i);O.sideOrientation=b.d._GetDefaultSideOrientation(O.sideOrientation),H._originalBuilderSideOrientation=O.sideOrientation;return D(O).Ta(H,O.updatable),H}q.d.CreateCylinder=C,b.d.CreateCylinder=(a,O,i,H,G,q,Q,k,I)=>{void 0!==Q&&Q instanceof ma.c||(void 0!==Q&&(I=k||b.d.DEFAULTSIDE,k=Q),Q=q,q=1);return n(a,{height:O,diameterTop:i,diameterBottom:H,tessellation:G,subdivisions:q,sideOrientation:I,updatable:k},Q)};function y(a){const O=[],i=[],b=[],G=[],k=a.radius||2,I=a.tube||.5,P=a.radialSegments||32,e=a.tubularSegments||32,h=a.p||2,j=a.q||3,Z=0===a.sideOrientation?0:a.sideOrientation||q.d.DEFAULTSIDE,F=a=>{const O=Math.cos(a),i=Math.sin(a),b=j/h*a,G=Math.cos(b),q=k*(2+G)*.5*O,Q=k*(2+G)*i*.5,I=k*Math.sin(b)*.5;return new H.ZO(q,Q,I)};let r,J;for(r=0;r<=P;r++){const a=r%P/P*2*h*Math.PI,O=F(a),b=F(a+.01),q=b.FO(O);let k=b.add(O);const j=H.ZO.Cross(q,k);for(k=H.ZO.Cross(j,q),j.normalize(),k.normalize(),J=0;J<e;J++){const a=J%e/e*2*Math.PI,H=-I*Math.cos(a),b=I*Math.sin(a);i.push(O.x+H*k.x+b*j.x),i.push(O.y+H*k.y+b*j.y),i.push(O.z+H*k.z+b*j.z),G.push(r/P),G.push(Q.c?1-J/e:J/e)}}for(r=0;r<P;r++)for(J=0;J<e;J++){const a=(J+1)%e,i=r*e+J,H=(r+1)*e+J,b=(r+1)*e+a,G=r*e+a;O.push(G),O.push(H),O.push(i),O.push(G),O.push(b),O.push(H)}q.d.ComputeNormals(i,O,b),q.d._ComputeSides(Z,i,O,b,G,a.frontUVs,a.backUVs);const ma=new q.d;return ma.indices=O,ma.wa=i,ma.Ka=b,ma.fa=G,ma}function w(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;const H=new b.d(a,i);O.sideOrientation=b.d._GetDefaultSideOrientation(O.sideOrientation),H._originalBuilderSideOrientation=O.sideOrientation;return y(O).Ta(H,O.updatable),H}q.d.CreateTorus=D,b.d.CreateTorus=(a,O,i,H,b,G,q)=>U(a,{diameter:O,thickness:i,tessellation:H,sideOrientation:q,updatable:G},b);q.d.CreateTorusKnot=y,b.d.CreateTorusKnot=(a,O,i,H,b,G,q,Q,k,I)=>w(a,{radius:O,tube:i,radialSegments:H,tubularSegments:b,p:G,q:q,sideOrientation:I,updatable:k},Q);var K=i(14292),S=i(12952),f=i(12613);function B(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=O.path,G=O.shape,q=O.scale||1,Q=O.rotation||0,k=0===O.cap?0:O.cap||b.d.NO_CAP,I=O.updatable,P=b.d._GetDefaultSideOrientation(O.sideOrientation),e=O.instance||null,h=O.invertUV||!1,j=O.closeShape||!1,Z=O.closePath||!1,F=O.capFunction||null;return A(a,G,H,q,Q,null,null,Z,j,k,!1,i,!!I,P,e,h,O.frontUVs||null,O.backUVs||null,O.firstNormal||null,!!O.adjustFrame,F)}function T(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=O.path,G=O.shape,q=O.scaleFunction||(()=>1),Q=O.rotationFunction||(()=>0),k=O.closePath||O.ribbonCloseArray||!1,I=O.closeShape||O.ribbonClosePath||!1,P=0===O.cap?0:O.cap||b.d.NO_CAP,e=O.updatable,h=O.firstNormal||null,j=O.adjustFrame||!1,Z=b.d._GetDefaultSideOrientation(O.sideOrientation),F=O.instance,r=O.invertUV||!1,J=O.capFunction||null;return A(a,G,H,null,null,q,Q,k,I,P,!0,i,!!e,Z,F||null,r,O.frontUVs||null,O.backUVs||null,h,j,J||null)}function A(a,O,i,G,q,Q,k,P,e,h,j,Z,F,r,J,ma,M,C,n,D,U){const y=(a,O,i,G,q,Q,k,I,P,e,h)=>{const j=i.getTangents(),Z=i.getNormals(),F=i.getBinormals(),r=i.getDistances();if(h)for(let b=0;b<j.length;b++)if(0==j[b].x&&0==j[b].y&&0==j[b].z&&j[b].q(j[b-1]),0==Z[b].x&&0==Z[b].y&&0==Z[b].z&&Z[b].q(Z[b-1]),0==F[b].x&&0==F[b].y&&0==F[b].z&&F[b].q(F[b-1]),b>0){let a=j[b-1];H.ZO.Dot(a,j[b])<0&&j[b].scaleInPlace(-1),a=Z[b-1],H.ZO.Dot(a,Z[b])<0&&Z[b].scaleInPlace(-1),a=F[b-1],H.ZO.Dot(a,F[b])<0&&F[b].scaleInPlace(-1)}let J=0;const ma=e&&I?I:()=>null!==Q?Q:0,M=e&&k?k:()=>null!==q?q:1;let C=P===b.d.NO_CAP||P===b.d.CAP_END?0:2;const n=H.TmpVectors.Matrix[0];for(let b=0;b<O.length;b++){const i=[],q=ma(b,r[b]),Q=M(b,r[b]);H.Matrix.RotationAxisToRef(j[b],J,n);for(let G=0;G<a.length;G++){const q=j[b].scale(a[G].z).add(Z[b].scale(a[G].x)).add(F[b].scale(a[G].y)),k=H.ZO.Zero();H.ZO.TransformCoordinatesToRef(q,n,k),k.scaleInPlace(Q).addInPlace(O[b]),i[G]=k}G[C]=i,J+=q,C++}const D=U||(a=>{const O=Array(),i=H.ZO.Zero();let b;for(b=0;b<a.length;b++)i.addInPlace(a[b]);for(i.scaleInPlace(1/a.length),b=0;b<a.length;b++)O.push(i);return O});switch(P){case b.d.NO_CAP:break;case b.d.CAP_START:G[0]=D(G[2]),G[1]=G[2];break;case b.d.CAP_END:G[C]=G[C-1],G[C+1]=D(G[C-1]);break;case b.d.CAP_ALL:G[0]=D(G[2]),G[1]=G[2],G[C]=G[C-1],G[C+1]=D(G[C-1])}return G};let w,K;if(J){const a=J._creationDataStorage;return w=n?a.path3D.update(i,n):a.path3D.update(i),K=y(O,i,a.path3D,a.pathArray,G,q,Q,k,a.cap,j,D),J=I("",{pathArray:K,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:J},Z||void 0)}w=n?new f.l(i,n):new f.l(i);K=y(O,i,w,new Array,G,q,Q,k,h=h<0||h>3?0:h,j,D);const S=I(a,{pathArray:K,closeArray:P,closePath:e,updatable:F,sideOrientation:r,invertUV:ma,frontUVs:M||void 0,backUVs:C||void 0},Z);return S._creationDataStorage.pathArray=K,S._creationDataStorage.path3D=w,S._creationDataStorage.cap=h,S}function E(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=O.arc?O.arc<=0||O.arc>1?1:O.arc:1,q=void 0===O.closed||O.closed,Q=O.shape,k=O.radius||1,P=O.tessellation||64,e=O.clip||0,h=O.updatable,j=b.d._GetDefaultSideOrientation(O.sideOrientation),Z=O.cap||b.d.NO_CAP,F=2*Math.PI,r=[],J=O.invertUV||!1;let ma=0,M=0;const C=F/P*G;let n,D;for(ma=0;ma<=P-e;ma++){for(D=[],Z!=b.d.CAP_START&&Z!=b.d.CAP_ALL||(D.push(new H.ZO(0,Q[0].y,0)),D.push(new H.ZO(Math.cos(ma*C)*Q[0].x*k,Q[0].y,Math.sin(ma*C)*Q[0].x*k))),M=0;M<Q.length;M++)n=new H.ZO(Math.cos(ma*C)*Q[M].x*k,Q[M].y,Math.sin(ma*C)*Q[M].x*k),D.push(n);Z!=b.d.CAP_END&&Z!=b.d.CAP_ALL||(D.push(new H.ZO(Math.cos(ma*C)*Q[Q.length-1].x*k,Q[Q.length-1].y,Math.sin(ma*C)*Q[Q.length-1].x*k)),D.push(new H.ZO(0,Q[Q.length-1].y,0))),r.push(D)}return I(a,{pathArray:r,closeArray:q,sideOrientation:j,updatable:h,invertUV:J,frontUVs:O.frontUVs,backUVs:O.backUVs},i)}b.d.ExtrudeShape=function(a,O,i,H,G,q){let Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,k=arguments.length>7?arguments[7]:void 0,I=arguments.length>8?arguments[8]:void 0,P=arguments.length>9?arguments[9]:void 0;return B(a,{shape:O,path:i,scale:H,rotation:G,cap:0===q?0:q||b.d.NO_CAP,sideOrientation:I,instance:P,updatable:k},Q)},b.d.ExtrudeShapeCustom=(a,O,i,H,G,q,Q,k,I,P,e,h)=>T(a,{shape:O,path:i,scaleFunction:H,rotationFunction:G,ribbonCloseArray:q,ribbonClosePath:Q,cap:0===k?0:k||b.d.NO_CAP,sideOrientation:e,instance:h,updatable:P},I);b.d.CreateLathe=(a,O,i,H,b,G,q)=>E(a,{shape:O,radius:i,tessellation:H,sideOrientation:q,updatable:G},b);var l=i(13696),W=i(13639);function u(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=O.path;let q=O.instance,Q=1;void 0!==O.radius?Q=O.radius:q&&(Q=q._creationDataStorage.radius);const k=O.tessellation||64,P=O.radiusFunction||null;let e=O.cap||b.d.NO_CAP;const h=O.invertUV||!1,j=O.updatable,Z=b.d._GetDefaultSideOrientation(O.sideOrientation);O.arc=O.arc&&(O.arc<=0||O.arc>1)?1:O.arc||1;const F=(a,O,i,G,q,Q,k,I)=>{const P=O.getTangents(),e=O.getNormals(),h=O.getDistances(),j=2*Math.PI/q*I,Z=Q||(()=>G);let F,r,J,ma;const M=H.TmpVectors.Matrix[0];let C=k===b.d.NO_CAP||k===b.d.CAP_END?0:2;for(let b=0;b<a.length;b++){r=Z(b,h[b]),F=Array(),J=e[b];for(let O=0;O<q;O++)H.Matrix.RotationAxisToRef(P[b],j*O,M),ma=F[O]?F[O]:H.ZO.Zero(),H.ZO.TransformCoordinatesToRef(J,M,ma),ma.scaleInPlace(r).addInPlace(a[b]),F[O]=ma;i[C]=F,C++}const n=(O,i)=>{const H=Array();for(let b=0;b<O;b++)H.push(a[i]);return H};switch(k){case b.d.NO_CAP:break;case b.d.CAP_START:i[0]=n(q,0),i[1]=i[2].slice(0);break;case b.d.CAP_END:i[C]=i[C-1].slice(0),i[C+1]=n(q,a.length-1);break;case b.d.CAP_ALL:i[0]=n(q,0),i[1]=i[2].slice(0),i[C]=i[C-1].slice(0),i[C+1]=n(q,a.length-1)}return i};let r,J;if(q){const a=q._creationDataStorage,i=O.arc||a.arc;return r=a.path3D.update(G),J=F(G,r,a.pathArray,Q,a.tessellation,P,a.cap,i),q=I("",{pathArray:J,instance:q}),a.path3D=r,a.pathArray=J,a.arc=i,a.radius=Q,q}r=new f.l(G);e=e<0||e>3?0:e,J=F(G,r,new Array,Q,k,P,e,O.arc);const ma=I(a,{pathArray:J,closePath:!0,closeArray:!1,updatable:j,sideOrientation:Z,invertUV:h,frontUVs:O.frontUVs,backUVs:O.backUVs},i);return ma._creationDataStorage.pathArray=J,ma._creationDataStorage.path3D=r,ma._creationDataStorage.tessellation=k,ma._creationDataStorage.cap=e,ma._creationDataStorage.arc=O.arc,ma._creationDataStorage.radius=Q,ma}function c(a){const O=[];O[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},O[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},O[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},O[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},O[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},O[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},O[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},O[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},O[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},O[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},O[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},O[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},O[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},O[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},O[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const i=a.type&&(a.type<0||a.type>=O.length)?0:a.type||0,b=a.size,G=a.sizeX||b||1,k=a.sizeY||b||1,I=a.sizeZ||b||1,P=a.custom||O[i],e=P.face.length,j=a.faceUV||new Array(e),Z=a.faceColors,F=void 0===a.flat||a.flat,r=0===a.sideOrientation?0:a.sideOrientation||q.d.DEFAULTSIDE,J=[],ma=[],M=[],C=[],n=[];let D=0,U=0;const y=[];let w,K,S,f,B,T,A=0,E=0;if(F)for(E=0;E<e;E++)Z&&void 0===Z[E]&&(Z[E]=new h.Ab(1,1,1,1)),j&&void 0===j[E]&&(j[E]=new H.Vector4(0,0,1,1));if(F)for(E=0;E<e;E++){const a=P.face[E].length;for(S=2*Math.PI/a,f=.5*Math.tan(S/2),B=.5,A=0;A<a;A++)J.push(P.vertex[P.face[E][A]][0]*G,P.vertex[P.face[E][A]][1]*k,P.vertex[P.face[E][A]][2]*I),y.push(D),D++,w=j[E].x+(j[E].z-j[E].x)*(.5+f),K=j[E].y+(j[E].w-j[E].y)*(B-.5),C.push(w,Q.c?1-K:K),T=f*Math.cos(S)-B*Math.sin(S),B=f*Math.sin(S)+B*Math.cos(S),f=T,Z&&n.push(Z[E].r,Z[E].g,Z[E].b,Z[E].a);for(A=0;A<a-2;A++)ma.push(y[0+U],y[A+2+U],y[A+1+U]);U+=a}else{for(A=0;A<P.vertex.length;A++)J.push(P.vertex[A][0]*G,P.vertex[A][1]*k,P.vertex[A][2]*I),C.push(0,Q.c?1:0);for(E=0;E<e;E++)for(A=0;A<P.face[E].length-2;A++)ma.push(P.face[E][0],P.face[E][A+2],P.face[E][A+1])}q.d.ComputeNormals(J,ma,M),q.d._ComputeSides(r,J,ma,M,C,a.frontUVs,a.backUVs);const l=new q.d;return l.wa=J,l.indices=ma,l.Ka=M,l.fa=C,Z&&F&&(l.Sa=n),l}function R(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new b.d(a,i);O.sideOrientation=b.d._GetDefaultSideOrientation(O.sideOrientation),H._originalBuilderSideOrientation=O.sideOrientation;return c(O).Ta(H,O.updatable),H}b.d.CreateTube=(a,O,i,H,b,G,q,Q,k,I)=>u(a,{path:O,radius:i,tessellation:H,radiusFunction:b,arc:1,cap:G,updatable:Q,sideOrientation:k,instance:I},q);function z(a){const O=a.sideOrientation||q.d.DEFAULTSIDE,i=a.radius||1,b=void 0===a.flat||a.flat,G=0|(a.subdivisions||4),k=a.radiusX||i,I=a.radiusY||i,P=a.radiusZ||i,e=(1+Math.sqrt(5))/2,h=[-1,e,-0,1,e,0,-1,-e,0,1,-e,0,0,-1,-e,0,1,-e,0,-1,e,0,1,e,e,0,1,e,0,-1,-e,0,1,-e,0,-1],j=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],Z=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],F=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],r=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],J=[],ma=[],M=[],C=[];let n=0;const D=new Array(3),U=new Array(3);let y;for(y=0;y<3;y++)D[y]=H.ZO.Zero(),U[y]=H.Vector2.Zero();for(let q=0;q<20;q++){for(y=0;y<3;y++){const a=j[3*q+y];D[y].fb(h[3*Z[a]],h[3*Z[a]+1],h[3*Z[a]+2]),D[y].normalize(),U[y].fb(.134765625*F[2*a]+.05859375+-.0390625*r[q],.2333984375*F[2*a+1]+.025390625+.01953125*r[q])}const a=(a,O,i,q)=>{const e=H.ZO.Lerp(D[0],D[2],O/G),h=H.ZO.Lerp(D[1],D[2],O/G),j=G===O?D[2]:H.ZO.Lerp(e,h,a/(G-O));let Z;if(j.normalize(),b){const a=H.ZO.Lerp(D[0],D[2],q/G),O=H.ZO.Lerp(D[1],D[2],q/G);Z=H.ZO.Lerp(a,O,i/(G-q))}else Z=new H.ZO(j.x,j.y,j.z);Z.x/=k,Z.y/=I,Z.z/=P,Z.normalize();const F=H.Vector2.Lerp(U[0],U[2],O/G),r=H.Vector2.Lerp(U[1],U[2],O/G),y=G===O?U[2]:H.Vector2.Lerp(F,r,a/(G-O));ma.push(j.x*k,j.y*I,j.z*P),M.push(Z.x,Z.y,Z.z),C.push(y.x,Q.c?1-y.y:y.y),J.push(n),n++};for(let O=0;O<G;O++)for(let i=0;i+O<G;i++)a(i,O,i+1/3,O+1/3),a(i+1,O,i+1/3,O+1/3),a(i,O+1,i+1/3,O+1/3),i+O+1<G&&(a(i+1,O,i+2/3,O+2/3),a(i+1,O+1,i+2/3,O+2/3),a(i,O+1,i+2/3,O+2/3))}q.d._ComputeSides(O,ma,J,M,C,a.frontUVs,a.backUVs);const w=new q.d;return w.indices=J,w.wa=ma,w.Ka=M,w.fa=C,w}function x(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new b.d(a,i);O.sideOrientation=b.d._GetDefaultSideOrientation(O.sideOrientation),H._originalBuilderSideOrientation=O.sideOrientation;return z(O).Ta(H,O.updatable),H}q.d.CreatePolyhedron=c,b.d.CreatePolyhedron=(a,O,i)=>R(a,O,i);q.d.CreateIcoSphere=z,b.d.CreateIcoSphere=(a,O,i)=>x(a,O,i);var g=i(12412);const N=new H.ZO(1,0,0),v=new H.ZO(-1,0,0),X=new H.ZO(0,1,0),p=new H.ZO(0,-1,0),o=new H.ZO(0,0,1),d=new H.ZO(0,0,-1);class Y{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H.ZO.Zero(),O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.ZO.Up(),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.Vector2.Zero(),b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=a,this.normal=O,this.uv=i,this.vertexIdx=b,this.vertexIdxForBones=G,this.localPositionOverride=q,this.localNormalOverride=Q,this.matrixIndicesOverride=k,this.matrixWeightsOverride=I}clone(){var a,O,i,H;return new Y(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(a=this.localPositionOverride)||void 0===a?void 0:a.slice(),null===(O=this.localNormalOverride)||void 0===O?void 0:O.slice(),null===(i=this.matrixIndicesOverride)||void 0===i?void 0:i.slice(),null===(H=this.matrixWeightsOverride)||void 0===H?void 0:H.slice())}}function L(a,O,i){var k,I,P,e,h;const j=!!O.skeleton,Z=!(null===(k=O.morphTargetManager)||void 0===k||!k.numTargets),F=i.localMode||j,r=O.Kb(),J=j||Z?O.oQ(!0,!0):O.getVerticesData(G.c.PositionKind),ma=j||Z?O.getNormalsData(!0,!0):O.getVerticesData(G.c.NormalKind),M=F?j?O.getVerticesData(G.c.PositionKind):J:null,C=F?j?O.getVerticesData(G.c.NormalKind):ma:null,n=O.getVerticesData(G.c.UVKind),D=j?O.getVerticesData(G.c.MatricesIndicesKind):null,U=j?O.getVerticesData(G.c.MatricesWeightsKind):null,y=j?O.getVerticesData(G.c.MatricesIndicesExtraKind):null,w=j?O.getVerticesData(G.c.MatricesWeightsExtraKind):null,K=i.position||H.ZO.Zero();let S=i.normal||H.ZO.Up();const f=i.size||H.ZO.One(),B=i.angle||0;if(!S){const a=new H.ZO(0,0,1),i=O.Ua().activeCamera,b=H.ZO.TransformCoordinates(a,i.getWorldMatrix());S=i.globalPosition.FO(b)}const T=-Math.atan2(S.z,S.x)-Math.PI/2,A=Math.sqrt(S.x*S.x+S.z*S.z),E=Math.atan2(S.y,A),l=new q.d;l.indices=[],l.wa=[],l.Ka=[],l.fa=[],l.matricesIndices=j?[]:null,l.matricesWeights=j?[]:null,l.matricesIndicesExtra=y?[]:null,l.matricesWeightsExtra=w?[]:null;let W=0;const u=(a,O)=>{const b=new Y;if(!r||!J||!ma)return b;const G=r[a];if(b.vertexIdx=3*G,b.vertexIdxForBones=4*G,b.position=new H.ZO(J[3*G],J[3*G+1],J[3*G+2]),H.ZO.TransformCoordinatesToRef(b.position,O,b.position),b.normal=new H.ZO(ma[3*G],ma[3*G+1],ma[3*G+2]),H.ZO.TransformNormalToRef(b.normal,O,b.normal),i.captureUVS&&n){const a=n[2*G+1];b.uv=new H.Vector2(n[2*G],Q.c?1-a:a)}return b},c=[0,0,0,0],R=(a,O)=>{if(0===a.length)return a;const i=.5*Math.abs(H.ZO.Dot(f,O)),b=(a,O,i,H)=>{for(let b=0;b<H;++b)if(a[i+b]===O)return i+b;return-1},G=(a,G)=>{const q=H.ZO.GetClipFactor(a.position,G.position,O,i);let Q=c,k=c;if(D&&U){const O=a.matrixIndicesOverride?0:a.vertexIdxForBones,i=a.matrixIndicesOverride??D,H=a.matrixWeightsOverride??U,I=G.matrixIndicesOverride?0:G.vertexIdxForBones,P=G.matrixIndicesOverride??D,e=G.matrixWeightsOverride??U;Q=[0,0,0,0],k=[0,0,0,0];let h=0;for(let a=0;a<4;++a)if(H[O+a]>0){const G=b(P,i[O+a],I,4);Q[h]=i[O+a],k[h]=(0,g.Lerp)(H[O+a],G>=0?e[G]:0,q),h++}for(let a=0;a<4&&h<4;++a){const H=P[I+a];-1===b(i,H,O,4)&&(Q[h]=H,k[h]=(0,g.Lerp)(0,e[I+a],q),h++)}const j=k[0]+k[1]+k[2]+k[3];k[0]/=j,k[1]/=j,k[2]/=j,k[3]/=j}const I=a.localPositionOverride?a.localPositionOverride[0]:(null===M||void 0===M?void 0:M[a.vertexIdx])??0,P=a.localPositionOverride?a.localPositionOverride[1]:(null===M||void 0===M?void 0:M[a.vertexIdx+1])??0,e=a.localPositionOverride?a.localPositionOverride[2]:(null===M||void 0===M?void 0:M[a.vertexIdx+2])??0,h=G.localPositionOverride?G.localPositionOverride[0]:(null===M||void 0===M?void 0:M[G.vertexIdx])??0,j=G.localPositionOverride?G.localPositionOverride[1]:(null===M||void 0===M?void 0:M[G.vertexIdx+1])??0,Z=G.localPositionOverride?G.localPositionOverride[2]:(null===M||void 0===M?void 0:M[G.vertexIdx+2])??0,F=a.localNormalOverride?a.localNormalOverride[0]:(null===C||void 0===C?void 0:C[a.vertexIdx])??0,r=a.localNormalOverride?a.localNormalOverride[1]:(null===C||void 0===C?void 0:C[a.vertexIdx+1])??0,J=a.localNormalOverride?a.localNormalOverride[2]:(null===C||void 0===C?void 0:C[a.vertexIdx+2])??0,ma=F+((G.localNormalOverride?G.localNormalOverride[0]:(null===C||void 0===C?void 0:C[G.vertexIdx])??0)-F)*q,n=r+((G.localNormalOverride?G.localNormalOverride[1]:(null===C||void 0===C?void 0:C[G.vertexIdx+1])??0)-r)*q,y=J+((G.localNormalOverride?G.localNormalOverride[2]:(null===C||void 0===C?void 0:C[G.vertexIdx+2])??0)-J)*q,w=Math.sqrt(ma*ma+n*n+y*y);return new Y(H.ZO.Lerp(a.position,G.position,q),H.ZO.Lerp(a.normal,G.normal,q).normalize(),H.Vector2.Lerp(a.uv,G.uv,q),-1,-1,M?[I+(h-I)*q,P+(j-P)*q,e+(Z-e)*q]:null,C?[ma/w,n/w,y/w]:null,Q,k)};let q=null;a.length>3&&(q=[]);for(let Q=0;Q<a.length;Q+=3){let b=0,k=null,I=null,P=null,e=null;const h=H.ZO.Dot(a[Q].position,O)-i>0,j=H.ZO.Dot(a[Q+1].position,O)-i>0,Z=H.ZO.Dot(a[Q+2].position,O)-i>0;switch(b=(h?1:0)+(j?1:0)+(Z?1:0),b){case 0:a.length>3?(q.push(a[Q]),q.push(a[Q+1]),q.push(a[Q+2])):q=a;break;case 1:if(q=q??new Array,h&&(k=a[Q+1],I=a[Q+2],P=G(a[Q],k),e=G(a[Q],I)),j){k=a[Q],I=a[Q+2],P=G(a[Q+1],k),e=G(a[Q+1],I),q.push(P),q.push(I.clone()),q.push(k.clone()),q.push(I.clone()),q.push(P.clone()),q.push(e);break}Z&&(k=a[Q],I=a[Q+1],P=G(a[Q+2],k),e=G(a[Q+2],I)),k&&I&&P&&e&&(q.push(k.clone()),q.push(I.clone()),q.push(P),q.push(e),q.push(P.clone()),q.push(I.clone()));break;case 2:q=q??new Array,h||(k=a[Q].clone(),I=G(k,a[Q+1]),P=G(k,a[Q+2]),q.push(k),q.push(I),q.push(P)),j||(k=a[Q+1].clone(),I=G(k,a[Q+2]),P=G(k,a[Q]),q.push(k),q.push(I),q.push(P)),Z||(k=a[Q+2].clone(),I=G(k,a[Q]),P=G(k,a[Q+1]),q.push(k),q.push(I),q.push(P))}}return q},z=O instanceof b.d?O:null,x=null===z||void 0===z?void 0:z._thinInstanceDataStorage.matrixData,L=(null===z||void 0===z?void 0:z.lb)||1,s=H.TmpVectors.Matrix[0];s.q(H.Matrix.IdentityReadOnly);for(let b=0;b<L;++b){if(null!==z&&void 0!==z&&z.hasThinInstances&&x){const a=16*b;s.setRowFromFloats(0,x[a+0],x[a+1],x[a+2],x[a+3]),s.setRowFromFloats(1,x[a+4],x[a+5],x[a+6],x[a+7]),s.setRowFromFloats(2,x[a+8],x[a+9],x[a+10],x[a+11]),s.setRowFromFloats(3,x[a+12],x[a+13],x[a+14],x[a+15])}const a=H.Matrix.RotationYawPitchRoll(T,E,B).multiply(H.Matrix.Translation(K.x,K.y,K.z)),G=H.Matrix.Invert(a),q=O.getWorldMatrix(),k=s.multiply(q).multiply(G),I=new Array(3);for(let O=0;O<r.length;O+=3){let a=I;if(a[0]=u(O,k),a[1]=u(O+1,k),a[2]=u(O+2,k),!(i.cullBackFaces&&-a[0].normal.z<=0&&-a[1].normal.z<=0&&-a[2].normal.z<=0)&&(a=R(a,N),a&&(a=R(a,v),a&&(a=R(a,X),a&&(a=R(a,p),a&&(a=R(a,o),a&&(a=R(a,d),a)))))))for(let O=0;O<a.length;O++){const H=a[O];if(l.indices.push(W),F?(H.localPositionOverride?(l.wa[3*W]=H.localPositionOverride[0],l.wa[3*W+1]=H.localPositionOverride[1],l.wa[3*W+2]=H.localPositionOverride[2]):M&&(l.wa[3*W]=M[H.vertexIdx],l.wa[3*W+1]=M[H.vertexIdx+1],l.wa[3*W+2]=M[H.vertexIdx+2]),H.localNormalOverride?(l.Ka[3*W]=H.localNormalOverride[0],l.Ka[3*W+1]=H.localNormalOverride[1],l.Ka[3*W+2]=H.localNormalOverride[2]):C&&(l.Ka[3*W]=C[H.vertexIdx],l.Ka[3*W+1]=C[H.vertexIdx+1],l.Ka[3*W+2]=C[H.vertexIdx+2])):(H.position.toArray(l.wa,3*W),H.normal.toArray(l.Ka,3*W)),l.matricesIndices&&l.matricesWeights&&(H.matrixIndicesOverride?(l.matricesIndices[4*W]=H.matrixIndicesOverride[0],l.matricesIndices[4*W+1]=H.matrixIndicesOverride[1],l.matricesIndices[4*W+2]=H.matrixIndicesOverride[2],l.matricesIndices[4*W+3]=H.matrixIndicesOverride[3]):(D&&(l.matricesIndices[4*W]=D[H.vertexIdxForBones],l.matricesIndices[4*W+1]=D[H.vertexIdxForBones+1],l.matricesIndices[4*W+2]=D[H.vertexIdxForBones+2],l.matricesIndices[4*W+3]=D[H.vertexIdxForBones+3]),y&&l.matricesIndicesExtra&&(l.matricesIndicesExtra[4*W]=y[H.vertexIdxForBones],l.matricesIndicesExtra[4*W+1]=y[H.vertexIdxForBones+1],l.matricesIndicesExtra[4*W+2]=y[H.vertexIdxForBones+2],l.matricesIndicesExtra[4*W+3]=y[H.vertexIdxForBones+3])),H.matrixWeightsOverride?(l.matricesWeights[4*W]=H.matrixWeightsOverride[0],l.matricesWeights[4*W+1]=H.matrixWeightsOverride[1],l.matricesWeights[4*W+2]=H.matrixWeightsOverride[2],l.matricesWeights[4*W+3]=H.matrixWeightsOverride[3]):(U&&(l.matricesWeights[4*W]=U[H.vertexIdxForBones],l.matricesWeights[4*W+1]=U[H.vertexIdxForBones+1],l.matricesWeights[4*W+2]=U[H.vertexIdxForBones+2],l.matricesWeights[4*W+3]=U[H.vertexIdxForBones+3]),w&&l.matricesWeightsExtra&&(l.matricesWeightsExtra[4*W]=w[H.vertexIdxForBones],l.matricesWeightsExtra[4*W+1]=w[H.vertexIdxForBones+1],l.matricesWeightsExtra[4*W+2]=w[H.vertexIdxForBones+2],l.matricesWeightsExtra[4*W+3]=w[H.vertexIdxForBones+3]))),i.captureUVS)H.uv.toArray(l.fa,2*W);else{l.fa.push(.5+H.position.x/f.x);const a=.5+H.position.y/f.y;l.fa.push(Q.c?1-a:a)}W++}}}0===l.indices.length&&(l.indices=null),0===l.wa.length&&(l.wa=null),0===l.Ka.length&&(l.Ka=null),0===l.fa.length&&(l.fa=null),0===(null===(I=l.matricesIndices)||void 0===I?void 0:I.length)&&(l.matricesIndices=null),0===(null===(P=l.matricesWeights)||void 0===P?void 0:P.length)&&(l.matricesWeights=null),0===(null===(e=l.matricesIndicesExtra)||void 0===e?void 0:e.length)&&(l.matricesIndicesExtra=null),0===(null===(h=l.matricesWeightsExtra)||void 0===h?void 0:h.length)&&(l.matricesWeightsExtra=null);const t=new b.d(a,O.Ua());return l.Ta(t),F?(t.skeleton=O.skeleton,t.parent=O):(t.position=K.clone(),t.rotation=new H.ZO(E,T,B)),t.yb(!0),t.refreshBoundingInfo(!0,!0),t}function s(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const O=0|Math.max(a.subdivisions?a.subdivisions:2,1),i=0|Math.max(a.tessellation?a.tessellation:16,3),b=Math.max(a.height?a.height:1,0),G=Math.max(a.radius?a.radius:.25,0),k=0|Math.max(a.capSubdivisions?a.capSubdivisions:6,1),I=i,P=O,e=Math.max(a.radiusTop?a.radiusTop:G,0),h=Math.max(a.radiusBottom?a.radiusBottom:G,0),j=b-(e+h),Z=2*Math.PI,F=Math.max(a.topCapSubdivisions?a.topCapSubdivisions:k,1),r=Math.max(a.bottomCapSubdivisions?a.bottomCapSubdivisions:k,1),J=Math.acos((h-e)/b);let ma=[];const M=[],C=[],n=[];let D=0;const U=[],y=.5*j,w=.5*Math.PI;let K,S;const f=H.ZO.Zero(),B=H.ZO.Zero(),T=Math.cos(J),A=Math.sin(J),E=new H.Vector2(e*A,y+e*T).FO(new H.Vector2(h*A,h*T-y)).length(),l=e*J+E+h*(w-J);let W=0;for(S=0;S<=F;S++){const a=[],O=w-J*(S/F);W+=e*J/F;const i=Math.cos(O),H=Math.sin(O),b=i*e;for(K=0;K<=I;K++){const O=K/I,G=O*Z+0,q=Math.sin(G),k=Math.cos(G);B.x=b*q,B.y=y+H*e,B.z=b*k,M.push(B.x,B.y,B.z),f.set(i*q,H,i*k),C.push(f.x,f.y,f.z),n.push(O,Q.c?W/l:1-W/l),a.push(D),D++}U.push(a)}const u=b-e-h+T*e-T*h,c=A*(h-e)/u;for(S=1;S<=P;S++){const a=[];W+=E/P;const O=A*(S*(h-e)/P+e);for(K=0;K<=I;K++){const i=K/I,H=i*Z+0,b=Math.sin(H),G=Math.cos(H);B.x=O*b,B.y=y+T*e-S*u/P,B.z=O*G,M.push(B.x,B.y,B.z),f.set(b,c,G).normalize(),C.push(f.x,f.y,f.z),n.push(i,Q.c?W/l:1-W/l),a.push(D),D++}U.push(a)}for(S=1;S<=r;S++){const a=[],O=w-J-(Math.PI-J)*(S/r);W+=h*J/r;const i=Math.cos(O),H=Math.sin(O),b=i*h;for(K=0;K<=I;K++){const O=K/I,G=O*Z+0,q=Math.sin(G),k=Math.cos(G);B.x=b*q,B.y=H*h-y,B.z=b*k,M.push(B.x,B.y,B.z),f.set(i*q,H,i*k),C.push(f.x,f.y,f.z),n.push(O,Q.c?W/l:1-W/l),a.push(D),D++}U.push(a)}for(K=0;K<I;K++)for(S=0;S<F+P+r;S++){const a=U[S][K],O=U[S+1][K],i=U[S+1][K+1],H=U[S][K+1];ma.push(a),ma.push(O),ma.push(H),ma.push(O),ma.push(i),ma.push(H)}if(ma=ma.reverse(),a.orientation&&!a.orientation.equals(H.ZO.Up())){const O=new H.Matrix;a.orientation.clone().scale(.5*Math.PI).cross(H.ZO.Up()).toQuaternion().toRotationMatrix(O);const i=H.ZO.Zero();for(let a=0;a<M.length;a+=3)i.set(M[a],M[a+1],M[a+2]),H.ZO.TransformCoordinatesToRef(i.clone(),O,i),M[a]=i.x,M[a+1]=i.y,M[a+2]=i.z}const R=new q.d;return R.wa=M,R.Ka=C,R.fa=n,R.indices=ma,R}function t(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:H.ZO.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new b.d(a,i);return s(O).Ta(G,O.updatable),G}b.d.CreateDecal=(a,O,i,H,b,G)=>L(a,O,{position:i,normal:H,size:b,angle:G});b.d.CreateCapsule=(a,O,i)=>t(a,O,i),q.d.CreateCapsule=s;var V=i(12209),aa=i(12397);class Oa{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=a,this.y=O,a!==Math.floor(a)&&(a=Math.floor(a),V.c.Warn("x is not an integer, floor(x) used")),O!==Math.floor(O)&&(O=Math.floor(O),V.c.Warn("y is not an integer, floor(y) used"))}clone(){return new Oa(this.x,this.y)}rotate60About(a){const O=this.x;return this.x=a.x+a.y-this.y,this.y=O+this.y-a.x,this}rotateNeg60About(a){const O=this.x;return this.x=O+this.y-a.y,this.y=a.x+a.y-O,this}rotate120(a,O){a!==Math.floor(a)&&(a=Math.floor(a),V.c.Warn("m not an integer only floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),V.c.Warn("n not an integer only floor(n) used"));const i=this.x;return this.x=a-i-this.y,this.y=O+i,this}rotateNeg120(a,O){a!==Math.floor(a)&&(a=Math.floor(a),V.c.Warn("m is not an integer, floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),V.c.Warn("n is not an integer,   floor(n) used"));const i=this.x;return this.x=this.y-O,this.y=a+O-i-this.y,this}toCartesianOrigin(a,O){const i=H.ZO.Zero();return i.x=a.x+2*this.x*O+this.y*O,i.y=a.y+Math.sqrt(3)*this.y*O,i}static Zero(){return new Oa(0,0)}}class ia{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Ha("icosahedron","Regular",[[0,aa.f,-1],[-aa.f,1,0],[-1,0,-aa.f],[1,0,-aa.f],[aa.f,1,0],[0,aa.f,1],[-1,0,aa.f],[-aa.f,-1,0],[0,-aa.f,-1],[aa.f,-1,0],[1,0,aa.f],[0,-aa.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let a=12;const O={},i=this.m,H=this.n;let b,G,q,Q,k,I=i,P=1,e=0;0!==H&&(I=(0,g.HighestCommonFactor)(i,H)),P=i/I,e=H/I;const h=Oa.Zero(),j=new Oa(i,H),Z=new Oa(-H,i+H),F=Oa.Zero(),r=Oa.Zero(),J=Oa.Zero();let ma,M,C,n,D=[];const U=[],y=this.vertByDist,w=(i,H,b,G)=>{ma=i+"|"+b,M=H+"|"+G,ma in O||M in O?ma in O&&!(M in O)?O[M]=O[ma]:M in O&&!(ma in O)&&(O[ma]=O[M]):(O[ma]=a,O[M]=a,a++),y[b][0]>2?U[O[ma]]=[-y[b][0],y[b][1],O[ma]]:U[O[ma]]=[D[y[b][0]],y[b][1],O[ma]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let K=0;K<20;K++){if(D=this.IDATA.face[K],q=D[2],Q=D[1],k=D[0],C=h.x+"|"+h.y,ma=K+"|"+C,ma in O||(O[ma]=q,U[q]=[D[y[C][0]],y[C][1]]),C=j.x+"|"+j.y,ma=K+"|"+C,ma in O||(O[ma]=Q,U[Q]=[D[y[C][0]],y[C][1]]),C=Z.x+"|"+Z.y,ma=K+"|"+C,ma in O||(O[ma]=k,U[k]=[D[y[C][0]],y[C][1]]),b=this.IDATA.edgematch[K][0],G=this.IDATA.edgematch[K][1],"B"===G)for(let a=1;a<I;a++)r.x=i-a*(P+e),r.y=H+a*P,J.x=-a*e,J.y=a*(P+e),C=r.x+"|"+r.y,n=J.x+"|"+J.y,w(K,b,C,n);if("O"===G)for(let a=1;a<I;a++)J.x=-a*e,J.y=a*(P+e),F.x=a*P,F.y=a*e,C=J.x+"|"+J.y,n=F.x+"|"+F.y,w(K,b,C,n);if(b=this.IDATA.edgematch[K][2],G=this.IDATA.edgematch[K][3],G&&"A"===G)for(let a=1;a<I;a++)F.x=a*P,F.y=a*e,r.x=i-(I-a)*(P+e),r.y=H+(I-a)*P,C=F.x+"|"+F.y,n=r.x+"|"+r.y,w(K,b,C,n);for(let i=0;i<this.vertices.length;i++)C=this.vertices[i].x+"|"+this.vertices[i].y,ma=K+"|"+C,ma in O||(O[ma]=a++,y[C][0]>2?U[O[ma]]=[-y[C][0],y[C][1],O[ma]]:U[O[ma]]=[D[y[C][0]],y[C][1],O[ma]])}this.closestTo=U,this.vecToidx=O}calcCoeffs(){const a=this.m,O=this.n,i=Math.sqrt(3)/3,H=a*a+O*O+a*O;this.coau=(a+O)/H,this.cobu=-O/H,this.coav=-i*(a-O)/H,this.cobv=i*(2*a+O)/H}createInnerFacets(){const a=this.m,O=this.n;for(let i=0;i<O+a+1;i++)for(let a=this.min[i];a<this.max[i]+1;a++)a<this.max[i]&&a<this.max[i+1]+1&&this.innerFacets.push(["|"+a+"|"+i,"|"+a+"|"+(i+1),"|"+(a+1)+"|"+i]),i>0&&a<this.max[i-1]&&a+1<this.max[i]+1&&this.innerFacets.push(["|"+a+"|"+i,"|"+(a+1)+"|"+i,"|"+(a+1)+"|"+(i-1)])}edgeVecsABOB(){const a=this.m,O=this.n,i=new Oa(-O,a+O);for(let H=1;H<a+O;H++){const a=new Oa(this.min[H],H),O=new Oa(this.min[H-1],H-1),b=new Oa(this.min[H+1],H+1),G=a.clone(),q=O.clone(),Q=b.clone();G.rotate60About(i),q.rotate60About(i),Q.rotate60About(i);const k=new Oa(this.max[G.y],G.y),I=new Oa(this.max[G.y-1],G.y-1),P=new Oa(this.max[G.y-1]-1,G.y-1);G.x===k.x&&G.y===k.y||(G.x!==I.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([a,I,P]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([a,P,k])):G.y===Q.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([a,O,I]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([a,I,b])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([a,O,I]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([a,I,k])))}}mapABOBtoOBOA(){const a=new Oa(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const i=[];for(let H=0;H<3;H++)a.x=this.isoVecsABOB[O][H].x,a.y=this.isoVecsABOB[O][H].y,0===this.vertexTypes[O][H]&&a.rotateNeg120(this.m,this.n),i.push(a.clone());this.isoVecsOBOA.push(i)}}mapABOBtoBAOA(){const a=new Oa(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const i=[];for(let H=0;H<3;H++)a.x=this.isoVecsABOB[O][H].x,a.y=this.isoVecsABOB[O][H].y,1===this.vertexTypes[O][H]&&a.rotate120(this.m,this.n),i.push(a.clone());this.isoVecsBAOA.push(i)}}MapToFace(a,O){const i=this.IDATA.face[a],b=i[2],G=i[1],q=i[0],Q=H.ZO.MO(this.IDATA.vertex[b]),k=H.ZO.MO(this.IDATA.vertex[G]),I=H.ZO.MO(this.IDATA.vertex[q]),P=k.FO(Q),e=I.FO(Q),h=P.scale(this.coau).add(e.scale(this.cobu)),j=P.scale(this.coav).add(e.scale(this.cobv)),Z=[];let F,r=H.TmpVectors.ZO[0];for(let H=0;H<this.cartesian.length;H++)r=h.scale(this.cartesian[H].x).add(j.scale(this.cartesian[H].y)).add(Q),Z[H]=[r.x,r.y,r.z],F=a+"|"+this.vertices[H].x+"|"+this.vertices[H].y,O.vertex[this.vecToidx[F]]=[r.x,r.y,r.z]}build(a,O){const i=[],H=Oa.Zero(),b=new Oa(a,O),G=new Oa(-O,a+O);i.push(H,b,G);for(let C=O;C<a+1;C++)for(let O=0;O<a+1-C;O++)i.push(new Oa(O,C));if(O>0){const H=(0,g.HighestCommonFactor)(a,O),b=a/H,G=O/H;for(let Q=1;Q<H;Q++)i.push(new Oa(Q*b,Q*G)),i.push(new Oa(-Q*G,Q*(b+G))),i.push(new Oa(a-Q*(b+G),O+Q*b));const q=a/O;for(let Q=1;Q<O;Q++)for(let H=0;H<Q*q;H++)i.push(new Oa(H,Q)),i.push(new Oa(H,Q).rotate120(a,O)),i.push(new Oa(H,Q).rotateNeg120(a,O))}i.sort(((a,O)=>a.x-O.x)),i.sort(((a,O)=>a.y-O.y));const q=new Array(a+O+1),Q=new Array(a+O+1);for(let C=0;C<q.length;C++)q[C]=1/0,Q[C]=-1/0;let k=0,I=0;const P=i.length;for(let C=0;C<P;C++)I=i[C].x,k=i[C].y,q[k]=Math.min(I,q[k]),Q[k]=Math.max(I,Q[k]);const e=(i,H)=>{const b=i.clone();return"A"===H&&b.rotateNeg120(a,O),"B"===H&&b.rotate120(a,O),b.x<0?b.y:b.x+b.y},h=[],j=[],Z=[],F=[],r={},J=[];let ma=-1,M=-1;for(let C=0;C<P;C++)h[C]=i[C].toCartesianOrigin(new Oa(0,0),.5),j[C]=e(i[C],"O"),Z[C]=e(i[C],"A"),F[C]=e(i[C],"B"),j[C]===Z[C]&&Z[C]===F[C]?(ma=3,M=j[C]):j[C]===Z[C]?(ma=4,M=j[C]):Z[C]===F[C]?(ma=5,M=Z[C]):F[C]===j[C]&&(ma=6,M=j[C]),j[C]<Z[C]&&j[C]<F[C]&&(ma=2,M=j[C]),Z[C]<j[C]&&Z[C]<F[C]&&(ma=1,M=Z[C]),F[C]<Z[C]&&F[C]<j[C]&&(ma=0,M=F[C]),J.push([ma,M,i[C].x,i[C].y]);J.sort(((a,O)=>a[2]-O[2])),J.sort(((a,O)=>a[3]-O[3])),J.sort(((a,O)=>a[1]-O[1])),J.sort(((a,O)=>a[0]-O[0]));for(let C=0;C<J.length;C++)r[J[C][2]+"|"+J[C][3]]=[J[C][0],J[C][1],C];return this.m=a,this.n=O,this.vertices=i,this.vertByDist=r,this.cartesian=h,this.min=q,this.max=Q,this}}class Ha{constructor(a,O,i,H){this.name=a,this.category=O,this.vertex=i,this.face=H}}class ba extends Ha{innerToData(a,O){for(let i=0;i<O.innerFacets.length;i++)this.face.push(O.innerFacets[i].map((i=>O.vecToidx[a+i])))}mapABOBtoDATA(a,O){const i=O.IDATA.edgematch[a][0];for(let H=0;H<O.isoVecsABOB.length;H++){const b=[];for(let G=0;G<3;G++)0===O.vertexTypes[H][G]?b.push(a+"|"+O.isoVecsABOB[H][G].x+"|"+O.isoVecsABOB[H][G].y):b.push(i+"|"+O.isoVecsABOB[H][G].x+"|"+O.isoVecsABOB[H][G].y);this.face.push([O.vecToidx[b[0]],O.vecToidx[b[1]],O.vecToidx[b[2]]])}}mapOBOAtoDATA(a,O){const i=O.IDATA.edgematch[a][0];for(let H=0;H<O.isoVecsOBOA.length;H++){const b=[];for(let G=0;G<3;G++)1===O.vertexTypes[H][G]?b.push(a+"|"+O.isoVecsOBOA[H][G].x+"|"+O.isoVecsOBOA[H][G].y):b.push(i+"|"+O.isoVecsOBOA[H][G].x+"|"+O.isoVecsOBOA[H][G].y);this.face.push([O.vecToidx[b[0]],O.vecToidx[b[1]],O.vecToidx[b[2]]])}}mapBAOAtoDATA(a,O){const i=O.IDATA.edgematch[a][2];for(let H=0;H<O.isoVecsBAOA.length;H++){const b=[];for(let G=0;G<3;G++)1===O.vertexTypes[H][G]?b.push(a+"|"+O.isoVecsBAOA[H][G].x+"|"+O.isoVecsBAOA[H][G].y):b.push(i+"|"+O.isoVecsBAOA[H][G].x+"|"+O.isoVecsBAOA[H][G].y);this.face.push([O.vecToidx[b[0]],O.vecToidx[b[1]],O.vecToidx[b[2]]])}}orderData(a){const O=[];for(let G=0;G<13;G++)O[G]=[];const i=a.closestTo;for(let G=0;G<i.length;G++)i[G][0]>-1?i[G][1]>0&&O[i[G][0]].push([G,i[G][1]]):O[12].push([G,i[G][0]]);const H=[];for(let G=0;G<12;G++)H[G]=G;let b=12;for(let G=0;G<12;G++){O[G].sort(((a,O)=>a[1]-O[1]));for(let a=0;a<O[G].length;a++)H[O[G][a][0]]=b++}for(let G=0;G<O[12].length;G++)H[O[12][G][0]]=b++;for(let G=0;G<this.vertex.length;G++)this.vertex[G].push(H[G]);this.vertex.sort(((a,O)=>a[3]-O[3]));for(let G=0;G<this.vertex.length;G++)this.vertex[G].pop();for(let G=0;G<this.face.length;G++)for(let a=0;a<this.face[G].length;a++)this.face[G][a]=H[this.face[G][a]];this.sharedNodes=O[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(a,O){const i=[],H=[];let b=O.pop();H.push(b);let G=this.face[b].indexOf(a);G=(G+2)%3;let q=this.face[b][G];i.push(q);let Q=0;for(;O.length>0;)b=O[Q],this.face[b].indexOf(q)>-1?(G=(this.face[b].indexOf(q)+1)%3,q=this.face[b][G],i.push(q),H.push(b),O.splice(Q,1),Q=0):Q++;return this.adjacentFaces.push(i),H}toGoldbergPolyhedronData(){const a=new Ha("GeoDual","Goldberg",[],[]);a.name="GD dual";const O=this.vertex.length,i=new Array(O);for(let k=0;k<O;k++)i[k]=[];for(let k=0;k<this.face.length;k++)for(let a=0;a<3;a++)i[this.face[k][a]].push(k);let H=0,b=0,G=0,q=[],Q=[];this.adjacentFaces=[];for(let k=0;k<i.length;k++){a.face[k]=this.setOrder(k,i[k].concat([]));for(const O of i[k]){H=0,b=0,G=0,q=this.face[O];for(let a=0;a<3;a++)Q=this.vertex[q[a]],H+=Q[0],b+=Q[1],G+=Q[2];a.vertex[O]=[H/3,b/3,G/3]}}return a}static BuildGeodesicData(a){const O=new ba("Geodesic-m-n","Geodesic",[[0,aa.f,-1],[-aa.f,1,0],[-1,0,-aa.f],[1,0,-aa.f],[aa.f,1,0],[0,aa.f,1],[-1,0,aa.f],[-aa.f,-1,0],[0,-aa.f,-1],[aa.f,-1,0],[1,0,aa.f],[0,-aa.f,1]],[]);a.setIndices(),a.calcCoeffs(),a.createInnerFacets(),a.edgeVecsABOB(),a.mapABOBtoOBOA(),a.mapABOBtoBAOA();for(let i=0;i<a.IDATA.face.length;i++)a.MapToFace(i,O),O.innerToData(i,a),"B"===a.IDATA.edgematch[i][1]&&O.mapABOBtoDATA(i,a),"O"===a.IDATA.edgematch[i][1]&&O.mapOBOAtoDATA(i,a),"A"===a.IDATA.edgematch[i][3]&&O.mapBAOAtoDATA(i,a);O.orderData(a);return O.vertex=O.vertex.map((function(a){const O=a[0],i=a[1],H=a[2],b=Math.sqrt(O*O+i*i+H*H);return a[0]*=1/b,a[1]*=1/b,a[2]*=1/b,a})),O}}b.d._GoldbergMeshParser=(a,O)=>Ga.Parse(a,O);class Ga extends b.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(a,O){return void 0===O?(a>this.goldbergData.nbUnsharedFaces-1&&(V.c.Warn("Maximum number of unshared faces used"),a=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+a):(a>11&&(V.c.Warn("Last pole used"),a=11),O>this.goldbergData.nbFacesAtPole-1&&(V.c.Warn("Maximum number of faces at a pole used"),O=this.goldbergData.nbFacesAtPole-1),12+a*this.goldbergData.nbFacesAtPole+O)}_changeGoldbergFaceColors(a){for(let i=0;i<a.length;i++){const O=a[i][0],H=a[i][1],b=a[i][2];for(let a=O;a<H+1;a++)this.goldbergData.faceColors[a]=b}const O=[];for(let i=0;i<12;i++)for(let a=0;a<5;a++)O.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);for(let i=12;i<this.goldbergData.faceColors.length;i++)for(let a=0;a<6;a++)O.push(this.goldbergData.faceColors[i].r,this.goldbergData.faceColors[i].g,this.goldbergData.faceColors[i].b,this.goldbergData.faceColors[i].a);return O}setGoldbergFaceColors(a){const O=this._changeGoldbergFaceColors(a);this.Wa(G.c.ColorKind,O)}updateGoldbergFaceColors(a){const O=this._changeGoldbergFaceColors(a);this.updateVerticesData(G.c.ColorKind,O)}_changeGoldbergFaceUVs(a){const O=this.getVerticesData(G.c.UVKind);for(let i=0;i<a.length;i++){const H=a[i][0],b=a[i][1],G=a[i][2],q=a[i][3],Q=a[i][4],k=[],I=[];let P,e;for(let a=0;a<5;a++)P=G.x+q*Math.cos(Q+a*Math.PI/2.5),e=G.y+q*Math.sin(Q+a*Math.PI/2.5),P<0&&(P=0),P>1&&(P=1),k.push(P,e);for(let a=0;a<6;a++)P=G.x+q*Math.cos(Q+a*Math.PI/3),e=G.y+q*Math.sin(Q+a*Math.PI/3),P<0&&(P=0),P>1&&(P=1),I.push(P,e);for(let a=H;a<Math.min(12,b+1);a++)for(let i=0;i<5;i++)O[10*a+2*i]=k[2*i],O[10*a+2*i+1]=k[2*i+1];for(let a=Math.max(12,H);a<b+1;a++)for(let i=0;i<6;i++)O[12*a-24+2*i]=I[2*i],O[12*a-23+2*i]=I[2*i+1]}return O}setGoldbergFaceUVs(a){const O=this._changeGoldbergFaceUVs(a);this.Wa(G.c.UVKind,O)}updateGoldbergFaceUVs(a){const O=this._changeGoldbergFaceUVs(a);this.updateVerticesData(G.c.UVKind,O)}placeOnGoldbergFaceAt(a,O,i){const b=H.ZO.RotationFromAxis(this.goldbergData.faceXaxis[O],this.goldbergData.faceYaxis[O],this.goldbergData.faceZaxis[O]);a.rotation=b,a.position=this.goldbergData.faceCenters[O].add(this.goldbergData.faceXaxis[O].scale(i.x)).add(this.goldbergData.faceYaxis[O].scale(i.y)).add(this.goldbergData.faceZaxis[O].scale(i.z))}serialize(a){super.serialize(a),a.type="GoldbergMesh";const O={};if(O.adjacentFaces=this.goldbergData.adjacentFaces,O.nbSharedFaces=this.goldbergData.nbSharedFaces,O.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,O.nbFaces=this.goldbergData.nbFaces,O.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){O.faceColors=[];for(const a of this.goldbergData.faceColors)O.faceColors.push(a.Cb())}if(this.goldbergData.faceCenters){O.faceCenters=[];for(const a of this.goldbergData.faceCenters)O.faceCenters.push(a.Cb())}if(this.goldbergData.faceZaxis){O.faceZaxis=[];for(const a of this.goldbergData.faceZaxis)O.faceZaxis.push(a.Cb())}if(this.goldbergData.faceYaxis){O.faceYaxis=[];for(const a of this.goldbergData.faceYaxis)O.faceYaxis.push(a.Cb())}if(this.goldbergData.faceXaxis){O.faceXaxis=[];for(const a of this.goldbergData.faceXaxis)O.faceXaxis.push(a.Cb())}a.goldbergData=O}static Parse(a,O){const i=a.goldbergData;i.faceColors=i.faceColors.map((a=>h.Ab.MO(a))),i.faceCenters=i.faceCenters.map((a=>H.ZO.MO(a))),i.faceZaxis=i.faceZaxis.map((a=>H.ZO.MO(a))),i.faceXaxis=i.faceXaxis.map((a=>H.ZO.MO(a))),i.faceYaxis=i.faceYaxis.map((a=>H.ZO.MO(a)));const b=new Ga(a.name,O);return b.goldbergData=i,b}}var qa=i(12946);const Qa={CreateBox:e.b,CreateTiledBox:r,CreateSphere:J.b,CreateDisc:P.c,CreateIcoSphere:x,CreateRibbon:I,CreateCylinder:n,CreateTorus:U,CreateTorusKnot:w,CreateLineSystem:K.g,fI:K.j,CreateDashedLines:K.d,ExtrudeShape:B,ExtrudeShapeCustom:T,CreateLathe:E,CreateTiledPlane:Z,AI:l.d,CreateGround:W.i,CreateTiledGround:W.l,CreateGroundFromHeightMap:W.e,CreatePolygon:S.d,ExtrudePolygon:S.f,CreateTube:u,CreatePolyhedron:R,CreateGeodesic:function(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=O.m||1;H!==Math.floor(H)&&(H=Math.floor(H),V.c.Warn("m not an integer only floor(m) used"));let b=O.n||0;if(b!==Math.floor(b)&&(b=Math.floor(b),V.c.Warn("n not an integer only floor(n) used")),b>H){const a=b;b=H,H=a,V.c.Warn("n > m therefore m and n swapped")}const G=new ia;return G.build(H,b),R(a,{custom:ba.BuildGeodesicData(G),size:O.size,sizeX:O.sizeX,sizeY:O.sizeY,sizeZ:O.sizeZ,faceUV:O.faceUV,faceColors:O.faceColors,flat:O.flat,updatable:O.updatable,sideOrientation:O.sideOrientation,frontUVs:O.frontUVs,backUVs:O.backUVs},i)},CreateGoldberg:function(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=O.size,k=O.sizeX||G||1,I=O.sizeY||G||1,P=O.sizeZ||G||1;let e=O.m||1;e!==Math.floor(e)&&(e=Math.floor(e),V.c.Warn("m not an integer only floor(m) used"));let j=O.n||0;if(j!==Math.floor(j)&&(j=Math.floor(j),V.c.Warn("n not an integer only floor(n) used")),j>e){const a=j;j=e,e=a,V.c.Warn("n > m therefore m and n swapped")}const Z=new ia;Z.build(e,j);const F=ba.BuildGeodesicData(Z),r=F.toGoldbergPolyhedronData(),J=new Ga(a,i);O.sideOrientation=b.d._GetDefaultSideOrientation(O.sideOrientation),J._originalBuilderSideOrientation=O.sideOrientation;(function(a,O){const i=a.size,b=a.sizeX||i||1,G=a.sizeY||i||1,k=a.sizeZ||i||1,I=0===a.sideOrientation?0:a.sideOrientation||q.d.DEFAULTSIDE,P=[],e=[],h=[],j=[];let Z=1/0,F=-1/0,r=1/0,J=-1/0;for(let H=0;H<O.vertex.length;H++)Z=Math.min(Z,O.vertex[H][0]*b),F=Math.max(F,O.vertex[H][0]*b),r=Math.min(r,O.vertex[H][1]*G),J=Math.max(J,O.vertex[H][1]*G);let ma=0;for(let q=0;q<O.face.length;q++){const a=O.face[q],i=H.ZO.MO(O.vertex[a[0]]),I=H.ZO.MO(O.vertex[a[2]]),M=H.ZO.MO(O.vertex[a[1]]),C=I.FO(i),n=M.FO(i),D=H.ZO.Cross(n,C).normalize();for(let H=0;H<a.length;H++){h.push(D.x,D.y,D.z);const i=O.vertex[a[H]];P.push(i[0]*b,i[1]*G,i[2]*k);const q=(i[1]*G-r)/(J-r);j.push((i[0]*b-Z)/(F-Z),Q.c?1-q:q)}for(let O=0;O<a.length-2;O++)e.push(ma,ma+O+2,ma+O+1);ma+=a.length}q.d._ComputeSides(I,P,e,h,j);const M=new q.d;return M.wa=P,M.indices=e,M.Ka=h,M.fa=j,M})(O,r).Ta(J,O.updatable),J.goldbergData.nbSharedFaces=F.sharedNodes,J.goldbergData.nbUnsharedFaces=F.poleNodes,J.goldbergData.adjacentFaces=F.adjacentFaces,J.goldbergData.nbFaces=J.goldbergData.nbSharedFaces+J.goldbergData.nbUnsharedFaces,J.goldbergData.nbFacesAtPole=(J.goldbergData.nbUnsharedFaces-12)/12;for(let b=0;b<F.vertex.length;b++)J.goldbergData.faceCenters.push(H.ZO.MO(F.vertex[b])),J.goldbergData.faceCenters[b].x*=k,J.goldbergData.faceCenters[b].y*=I,J.goldbergData.faceCenters[b].z*=P,J.goldbergData.faceColors.push(new h.Ab(1,1,1,1));for(let b=0;b<r.face.length;b++){const a=r.face[b],O=H.ZO.MO(r.vertex[a[0]]),i=H.ZO.MO(r.vertex[a[2]]),G=H.ZO.MO(r.vertex[a[1]]),q=i.FO(O),Q=G.FO(O),k=H.ZO.Cross(Q,q).normalize(),I=H.ZO.Cross(Q,k).normalize();J.goldbergData.faceXaxis.push(Q.normalize()),J.goldbergData.faceYaxis.push(k),J.goldbergData.faceZaxis.push(I)}return J},CreateDecal:L,CreateCapsule:t,CreateText:qa.e}},13710:(a,O,i)=>{"use strict";i.d(O,{c:()=>QO});var H=i(12395),b=i(12783);class G extends b.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var q=i(12436),Q=(i(12568),i(12346));class k{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(a){this._targetStopDuration!==a&&(this._targetStopDuration=a)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(a){this._noiseTexture!==a&&(this._noiseTexture=a,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(a){this._animationSheetEnabled!==a&&(this._animationSheetEnabled=a)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(a){this._isAnimationSheetEnabled!=a&&(this._isAnimationSheetEnabled=a,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(a){this._useLogarithmicDepth=a&&this.Ua().getEngine().getCaps().fragmentDepthSupported}Ua(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(a){switch(a){case k.BLENDMODE_MULTIPLYADD:return;case k.BLENDMODE_ADD:a=1;break;case k.BLENDMODE_ONEONE:a=6;break;case k.BLENDMODE_STANDARD:a=2;break;case k.BLENDMODE_MULTIPLY:a=4;break;case k.BLENDMODE_SUBTRACT:a=3}this._engine.setAlphaMode(a)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:H.ZO.Zero()}set direction1(a){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=a)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:H.ZO.Zero()}set direction2(a){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=a)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:H.ZO.Zero()}set minEmitBox(a){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=a)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:H.ZO.Zero()}set maxEmitBox(a){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=a)}get billboardMode(){return this._billboardMode}set billboardMode(a){this._billboardMode!==a&&(this._billboardMode=a,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(a){this._isBillboardBased!==a&&(this._isBillboardBased=a,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(a){this._attachImageProcessingConfiguration(a)}_attachImageProcessingConfiguration(a){a!==this._imageProcessingConfiguration&&(!a&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=a)}_reset(){}_removeGradientAndTexture(a,O,i){if(!O)return this;let H=0;for(const b of O){if(b.gradient===a){O.splice(H,1);break}H++}return i&&i.dispose(),this}constructor(a){this.animations=[],this.renderingGroupId=0,this.HO=H.ZO.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new H.ZO(10,10,10),this.onAnimationEnd=null,this.blendMode=k.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new H.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.wI=new H.ZO(0,0,0),this._useLogarithmicDepth=!1,this.gravity=H.ZO.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new q.Ab(1,1,1,1),this.color2=new q.Ab(1,1,1,1),this.colorDead=new q.Ab(0,0,0,1),this.textureMask=new q.Ab(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new G,this.id=a,this.name=a}createPointEmitter(a,O){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new H.ZO(0,1,0),arguments.length>2&&void 0!==arguments[2]||new H.ZO(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new H.ZO(0,1,0),arguments.length>4&&void 0!==arguments[4]||new H.ZO(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new H.ZO(0,1,0),arguments.length>3&&void 0!==arguments[3]||new H.ZO(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(a,O,i,H){throw new Error("Method not implemented.")}}k.BLENDMODE_ONEONE=0,k.BLENDMODE_STANDARD=1,k.BLENDMODE_ADD=2,k.BLENDMODE_MULTIPLY=3,k.BLENDMODE_MULTIPLYADD=4,k.BLENDMODE_SUBTRACT=-1,(0,Q.h)("BABYLON.BaseParticleSystem",k);var I=i(12412),P=i(12211);class e{constructor(){this.direction1=new H.ZO(0,1,0),this.direction2=new H.ZO(0,1,0),this.minEmitBox=new H.ZO(-.5,-.5,-.5),this.maxEmitBox=new H.ZO(.5,.5,.5)}startDirectionFunction(a,O,i,b){const G=(0,I.RandomRange)(this.direction1.x,this.direction2.x),q=(0,I.RandomRange)(this.direction1.y,this.direction2.y),Q=(0,I.RandomRange)(this.direction1.z,this.direction2.z);if(b)return O.x=G,O.y=q,void(O.z=Q);H.ZO.TransformNormalFromFloatsToRef(G,q,Q,a,O)}startPositionFunction(a,O,i,b){const G=(0,I.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),q=(0,I.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),Q=(0,I.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(b)return O.x=G,O.y=q,void(O.z=Q);H.ZO.TransformCoordinatesFromFloatsToRef(G,q,Q,a,O)}clone(){const a=new e;return P.c.DeepCopy(this,a),a}applyToShader(a){a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2),a.setVector3("minEmitBox",this.minEmitBox),a.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(a){a.addUniform("direction1",3),a.addUniform("direction2",3),a.addUniform("minEmitBox",3),a.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.direction1=this.direction1.Cb(),a.direction2=this.direction2.Cb(),a.minEmitBox=this.minEmitBox.Cb(),a.maxEmitBox=this.maxEmitBox.Cb(),a}parse(a){H.ZO.FromArrayToRef(a.direction1,0,this.direction1),H.ZO.FromArrayToRef(a.direction2,0,this.direction2),H.ZO.FromArrayToRef(a.minEmitBox,0,this.minEmitBox),H.ZO.FromArrayToRef(a.maxEmitBox,0,this.maxEmitBox)}}class h{get radius(){return this._radius}set radius(a){this._radius=a,this._buildHeight()}get angle(){return this._angle}set angle(a){this._angle=a,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=i,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=O,this.radius=a}startDirectionFunction(a,O,i,b){b?H.TmpVectors.ZO[0].q(i.Hk).normalize():i.position.subtractToRef(a.getTranslation(),H.TmpVectors.ZO[0]).normalize();const G=(0,I.RandomRange)(0,this.directionRandomizer),q=(0,I.RandomRange)(0,this.directionRandomizer),Q=(0,I.RandomRange)(0,this.directionRandomizer);O.x=H.TmpVectors.ZO[0].x+G,O.y=H.TmpVectors.ZO[0].y+q,O.z=H.TmpVectors.ZO[0].z+Q,O.normalize()}startPositionFunction(a,O,i,b){const G=(0,I.RandomRange)(0,2*Math.PI);let q;this.emitFromSpawnPointOnly?q=1e-4:(q=(0,I.RandomRange)(0,this.heightRange),q=1-q*q);let Q=this._radius-(0,I.RandomRange)(0,this._radius*this.radiusRange);Q*=q;const k=Q*Math.sin(G),P=Q*Math.cos(G),e=q*this._height;if(b)return O.x=k,O.y=e,void(O.z=P);H.ZO.TransformCoordinatesFromFloatsToRef(k,e,P,a,O)}clone(){const a=new h(this._radius,this._angle,this.directionRandomizer);return P.c.DeepCopy(this,a),a}applyToShader(a){a.setFloat2("radius",this._radius,this.radiusRange),a.setFloat("coneAngle",this._angle),a.setFloat2("height",this._height,this.heightRange),a.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(a){a.addUniform("radius",2),a.addUniform("coneAngle",1),a.addUniform("height",2),a.addUniform("directionRandomizer",1)}getEffectDefines(){let a="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(a+="\n#define CONEEMITTERSPAWNPOINT"),a}getClassName(){return"ConeParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.radius=this._radius,a.angle=this._angle,a.directionRandomizer=this.directionRandomizer,a.radiusRange=this.radiusRange,a.heightRange=this.heightRange,a.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,a}parse(a){this.radius=a.radius,this.angle=a.angle,this.directionRandomizer=a.directionRandomizer,this.radiusRange=void 0!==a.radiusRange?a.radiusRange:1,this.heightRange=void 0!==a.radiusRange?a.heightRange:1,this.emitFromSpawnPointOnly=void 0!==a.emitFromSpawnPointOnly&&a.emitFromSpawnPointOnly}}class j extends h{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.ZO(0,1,0),b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.ZO(0,1,0);super(a,O),this.direction1=i,this.direction2=b}startDirectionFunction(a,O){const i=(0,I.RandomRange)(this.direction1.x,this.direction2.x),b=(0,I.RandomRange)(this.direction1.y,this.direction2.y),G=(0,I.RandomRange)(this.direction1.z,this.direction2.z);H.ZO.TransformNormalFromFloatsToRef(i,b,G,a,O)}clone(){const a=new j(this.radius,this.angle,this.direction1,this.direction2);return P.c.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("radiusRange",1),a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const a=super.serialize();return a.direction1=this.direction1.Cb(),a.direction2=this.direction2.Cb(),a}parse(a){super.parse(a),this.direction1.q(a.direction1),this.direction2.q(a.direction2)}}class Z{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=a,this.height=O,this.radiusRange=i,this.directionRandomizer=b,this._tempVector=H.ZO.Zero()}startDirectionFunction(a,O,i,b,G){i.position.subtractToRef(a.getTranslation(),this._tempVector),this._tempVector.normalize(),H.ZO.TransformNormalToRef(this._tempVector,G,this._tempVector);const q=(0,I.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let Q=Math.atan2(this._tempVector.x,this._tempVector.z);Q+=(0,I.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=q,this._tempVector.x=Math.sin(Q),this._tempVector.z=Math.cos(Q),this._tempVector.normalize(),b?O.q(this._tempVector):H.ZO.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,a,O)}startPositionFunction(a,O,i,b){const G=(0,I.RandomRange)(-this.height/2,this.height/2),q=(0,I.RandomRange)(0,2*Math.PI),Q=(0,I.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),k=Math.sqrt(Q)*this.radius,P=k*Math.cos(q),e=k*Math.sin(q);b?O.fb(P,G,e):H.ZO.TransformCoordinatesFromFloatsToRef(P,G,e,a,O)}clone(){const a=new Z(this.radius,this.directionRandomizer);return P.c.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("height",this.height),a.setFloat("radiusRange",this.radiusRange),a.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("height",1),a.addUniform("radiusRange",1),a.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.radius=this.radius,a.height=this.height,a.radiusRange=this.radiusRange,a.directionRandomizer=this.directionRandomizer,a}parse(a){this.radius=a.radius,this.height=a.height,this.radiusRange=a.radiusRange,this.directionRandomizer=a.directionRandomizer}}class F extends Z{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.ZO(0,1,0),G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new H.ZO(0,1,0);super(a,O,i),this.direction1=b,this.direction2=G}startDirectionFunction(a,O,i,b){const G=(0,I.RandomRange)(this.direction1.x,this.direction2.x),q=(0,I.RandomRange)(this.direction1.y,this.direction2.y),Q=(0,I.RandomRange)(this.direction1.z,this.direction2.z);b?O.fb(G,q,Q):H.ZO.TransformNormalFromFloatsToRef(G,q,Q,a,O)}clone(){const a=new F(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return P.c.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("height",this.height),a.setFloat("radiusRange",this.radiusRange),a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("height",1),a.addUniform("radiusRange",1),a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const a=super.serialize();return a.direction1=this.direction1.Cb(),a.direction2=this.direction2.Cb(),a}parse(a){super.parse(a),H.ZO.FromArrayToRef(a.direction1,0,this.direction1),H.ZO.FromArrayToRef(a.direction2,0,this.direction2)}}class r{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=a,this.radiusRange=O,this.directionRandomizer=i}startDirectionFunction(a,O,i,b){const G=i.position.FO(a.getTranslation()).normalize(),q=(0,I.RandomRange)(0,this.directionRandomizer),Q=(0,I.RandomRange)(0,this.directionRandomizer),k=(0,I.RandomRange)(0,this.directionRandomizer);G.x+=q,G.y+=Q,G.z+=k,G.normalize(),b?O.q(G):H.ZO.TransformNormalFromFloatsToRef(G.x,G.y,G.z,a,O)}startPositionFunction(a,O,i,b){const G=this.radius-(0,I.RandomRange)(0,this.radius*this.radiusRange),q=(0,I.RandomRange)(0,1),Q=(0,I.RandomRange)(0,2*Math.PI),k=Math.acos(2*q-1),P=G*Math.cos(Q)*Math.sin(k),e=G*Math.cos(k),h=G*Math.sin(Q)*Math.sin(k);b?O.fb(P,Math.abs(e),h):H.ZO.TransformCoordinatesFromFloatsToRef(P,Math.abs(e),h,a,O)}clone(){const a=new r(this.radius,this.directionRandomizer);return P.c.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("radiusRange",1),a.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.radius=this.radius,a.radiusRange=this.radiusRange,a.directionRandomizer=this.directionRandomizer,a}parse(a){this.radius=a.radius,this.radiusRange=a.radiusRange,this.directionRandomizer=a.directionRandomizer}}class J{constructor(){this.direction1=new H.ZO(0,1,0),this.direction2=new H.ZO(0,1,0)}startDirectionFunction(a,O,i,b){const G=(0,I.RandomRange)(this.direction1.x,this.direction2.x),q=(0,I.RandomRange)(this.direction1.y,this.direction2.y),Q=(0,I.RandomRange)(this.direction1.z,this.direction2.z);b?O.fb(G,q,Q):H.ZO.TransformNormalFromFloatsToRef(G,q,Q,a,O)}startPositionFunction(a,O,i,b){b?O.fb(0,0,0):H.ZO.TransformCoordinatesFromFloatsToRef(0,0,0,a,O)}clone(){const a=new J;return P.c.DeepCopy(this,a),a}applyToShader(a){a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.direction1=this.direction1.Cb(),a.direction2=this.direction2.Cb(),a}parse(a){H.ZO.FromArrayToRef(a.direction1,0,this.direction1),H.ZO.FromArrayToRef(a.direction2,0,this.direction2)}}class ma{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=a,this.radiusRange=O,this.directionRandomizer=i}startDirectionFunction(a,O,i,b){const G=i.position.FO(a.getTranslation()).normalize(),q=(0,I.RandomRange)(0,this.directionRandomizer),Q=(0,I.RandomRange)(0,this.directionRandomizer),k=(0,I.RandomRange)(0,this.directionRandomizer);G.x+=q,G.y+=Q,G.z+=k,G.normalize(),b?O.q(G):H.ZO.TransformNormalFromFloatsToRef(G.x,G.y,G.z,a,O)}startPositionFunction(a,O,i,b){const G=this.radius-(0,I.RandomRange)(0,this.radius*this.radiusRange),q=(0,I.RandomRange)(0,1),Q=(0,I.RandomRange)(0,2*Math.PI),k=Math.acos(2*q-1),P=G*Math.cos(Q)*Math.sin(k),e=G*Math.cos(k),h=G*Math.sin(Q)*Math.sin(k);b?O.fb(P,e,h):H.ZO.TransformCoordinatesFromFloatsToRef(P,e,h,a,O)}clone(){const a=new ma(this.radius,this.directionRandomizer);return P.c.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("radiusRange",1),a.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.radius=this.radius,a.radiusRange=this.radiusRange,a.directionRandomizer=this.directionRandomizer,a}parse(a){this.radius=a.radius,this.radiusRange=a.radiusRange,this.directionRandomizer=a.directionRandomizer}}class M extends ma{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new H.ZO(0,1,0),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.ZO(0,1,0);super(a),this.direction1=O,this.direction2=i}startDirectionFunction(a,O){const i=(0,I.RandomRange)(this.direction1.x,this.direction2.x),b=(0,I.RandomRange)(this.direction1.y,this.direction2.y),G=(0,I.RandomRange)(this.direction1.z,this.direction2.z);H.ZO.TransformNormalFromFloatsToRef(i,b,G,a,O)}clone(){const a=new M(this.radius,this.direction1,this.direction2);return P.c.DeepCopy(this,a),a}applyToShader(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("radius",1),a.addUniform("radiusRange",1),a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const a=super.serialize();return a.direction1=this.direction1.Cb(),a.direction2=this.direction2.Cb(),a}parse(a){super.parse(a),this.direction1.q(a.direction1),this.direction2.q(a.direction2)}}class C{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(a,O,i,b){const G=H.TmpVectors.ZO[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,i,G);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,i,G);const a=H.TmpVectors.ZO[1];G.subtractToRef(i.position,a),a.scaleToRef(1/i.lifeTime,G)}else G.set(0,0,0);b?O.q(G):H.ZO.TransformNormalToRef(G,a,O)}startPositionFunction(a,O,i,b){const G=H.TmpVectors.ZO[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,i,G):G.set(0,0,0),b?O.q(G):H.ZO.TransformCoordinatesToRef(G,a,O)}clone(){const a=new C;return P.c.DeepCopy(this,a),a}applyToShader(a){}buildUniformLayout(a){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const a={};return a.type=this.getClassName(),a.particlePositionGenerator=this.particlePositionGenerator,a.particleDestinationGenerator=this.particleDestinationGenerator,a}parse(a){a.particlePositionGenerator&&(this.particlePositionGenerator=a.particlePositionGenerator),a.particleDestinationGenerator&&(this.particleDestinationGenerator=a.particleDestinationGenerator)}}var n=i(12470);class D{get mesh(){return this._mesh}set mesh(a){this._mesh!==a&&(this._mesh=a,a?(this._indices=a.Kb(),this._positions=a.getVerticesData(n.c.PositionKind),this._normals=a.getVerticesData(n.c.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=H.ZO.Zero(),this._mesh=null,this.direction1=new H.ZO(0,1,0),this.direction2=new H.ZO(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=a}startDirectionFunction(a,O,i,b){if(this.useMeshNormalsForDirection&&this._normals)return void H.ZO.TransformNormalToRef(this._storedNormal,a,O);const G=(0,I.RandomRange)(this.direction1.x,this.direction2.x),q=(0,I.RandomRange)(this.direction1.y,this.direction2.y),Q=(0,I.RandomRange)(this.direction1.z,this.direction2.z);b?O.fb(G,q,Q):H.ZO.TransformNormalFromFloatsToRef(G,q,Q,a,O)}startPositionFunction(a,O,i,b){if(!this._indices||!this._positions)return;const G=3*(Math.random()*(this._indices.length/3)|0),q=Math.random(),Q=Math.random()*(1-q),k=1-q-Q,I=this._indices[G],P=this._indices[G+1],e=this._indices[G+2],h=H.TmpVectors.ZO[0],j=H.TmpVectors.ZO[1],Z=H.TmpVectors.ZO[2],F=H.TmpVectors.ZO[3];H.ZO.FromArrayToRef(this._positions,3*I,h),H.ZO.FromArrayToRef(this._positions,3*P,j),H.ZO.FromArrayToRef(this._positions,3*e,Z),F.x=q*h.x+Q*j.x+k*Z.x,F.y=q*h.y+Q*j.y+k*Z.y,F.z=q*h.z+Q*j.z+k*Z.z,b?O.fb(F.x,F.y,F.z):H.ZO.TransformCoordinatesFromFloatsToRef(F.x,F.y,F.z,a,O),this.useMeshNormalsForDirection&&this._normals&&(H.ZO.FromArrayToRef(this._normals,3*I,h),H.ZO.FromArrayToRef(this._normals,3*P,j),H.ZO.FromArrayToRef(this._normals,3*e,Z),this._storedNormal.x=q*h.x+Q*j.x+k*Z.x,this._storedNormal.y=q*h.y+Q*j.y+k*Z.y,this._storedNormal.z=q*h.z+Q*j.z+k*Z.z)}clone(){const a=new D(this.mesh);return P.c.DeepCopy(this,a),a}applyToShader(a){a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)}buildUniformLayout(a){a.addUniform("direction1",3),a.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var a;const O={};return O.type=this.getClassName(),O.direction1=this.direction1.Cb(),O.direction2=this.direction2.Cb(),O.meshId=null===(a=this.mesh)||void 0===a?void 0:a.id,O.useMeshNormalsForDirection=this.useMeshNormalsForDirection,O}parse(a,O){H.ZO.FromArrayToRef(a.direction1,0,this.direction1),H.ZO.FromArrayToRef(a.direction2,0,this.direction2),a.meshId&&O&&(this.mesh=O.getLastMeshById(a.meshId)),this.useMeshNormalsForDirection=a.useMeshNormalsForDirection}}class U{_isUbo(a){return void 0!==a.addUniform}constructor(a){this._isUbo(a)?(this.setMatrix3x3=a.updateMatrix3x3.bind(a),this.setMatrix2x2=a.updateMatrix2x2.bind(a),this.setFloat=a.updateFloat.bind(a),this.setFloat2=a.updateFloat2.bind(a),this.setFloat3=a.updateFloat3.bind(a),this.setFloat4=a.updateFloat4.bind(a),this.setFloatArray=a.updateFloatArray.bind(a),this.setArray=a.updateArray.bind(a),this.setIntArray=a.updateIntArray.bind(a),this.setMatrix=a.Ub.bind(a),this.setMatrices=a.updateMatrices.bind(a),this.setVector3=a.updateVector3.bind(a),this.setVector4=a.updateVector4.bind(a),this.setColor3=a.updateColor3.bind(a),this.setColor4=a.updateColor4.bind(a),this.setDirectColor4=a.updateDirectColor4.bind(a),this.setInt=a.updateInt.bind(a),this.setInt2=a.updateInt2.bind(a),this.setInt3=a.updateInt3.bind(a),this.setInt4=a.updateInt4.bind(a)):(this.setMatrix3x3=a.setMatrix3x3.bind(a),this.setMatrix2x2=a.setMatrix2x2.bind(a),this.setFloat=a.setFloat.bind(a),this.setFloat2=a.setFloat2.bind(a),this.setFloat3=a.setFloat3.bind(a),this.setFloat4=a.setFloat4.bind(a),this.setFloatArray=a.setFloatArray.bind(a),this.setArray=a.setArray.bind(a),this.setIntArray=a.setIntArray.bind(a),this.setMatrix=a.setMatrix.bind(a),this.setMatrices=a.setMatrices.bind(a),this.setVector3=a.setVector3.bind(a),this.setVector4=a.setVector4.bind(a),this.setColor3=a.setColor3.bind(a),this.setColor4=a.setColor4.bind(a),this.setDirectColor4=a.setDirectColor4.bind(a),this.setInt=a.setInt.bind(a),this.setInt2=a.setInt2.bind(a),this.setInt3=a.setInt3.bind(a),this.setInt4=a.setInt4.bind(a))}}var y=i(12287);const w="gpuUpdateParticlesPixelShader",K="#version 300 es\nvoid main() {discard;}\n";y.c.ShadersStore[w]||(y.c.ShadersStore[w]=K);const S="gpuUpdateParticlesVertexShader",f="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";y.c.ShadersStore[S]||(y.c.ShadersStore[S]=f);(0,Q.h)("BABYLON.WebGL2ParticleSystem",class{constructor(a,O){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=a,this._engine=O,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var a;return(null===(a=this._updateEffect)||void 0===a?void 0:a.isReady())??!1}createUpdateBuffer(a){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof C&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=a,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new U(this._updateEffect)}createVertexBuffers(a,O){this._updateVAO.push(this._createUpdateVAO(a)),this._renderVAO.push(this._engine.recordVertexArrayObject(O,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=O}createParticleBuffer(a){return a}bindDrawBuffers(a,O,i){i?this._engine.bindBuffers(this._renderVertexBuffers,i,O):this._engine.bindVertexArrayObject(this._renderVAO[a],null)}preUpdateParticleBuffer(){const a=this._engine;if(this._engine.enableEffect(this._updateEffect),!a.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(a,O,i){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[a],null);const H=this._engine;H.bindTransformFeedbackBuffer(O.getBuffer()),H.setRasterizerState(!1),H.beginTransformFeedback(!0),H.drawArraysType(3,0,i),H.endTransformFeedback(),H.setRasterizerState(!0),H.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let a=0;a<this._updateVAO.length;a++)this._engine.releaseVertexArrayObject(this._updateVAO[a]);this._updateVAO.length=0;for(let a=0;a<this._renderVAO.length;a++)this._engine.releaseVertexArrayObject(this._renderVAO[a]);this._renderVAO.length=0}_createUpdateVAO(a){const O={};O.position=a.createVertexBuffer("position",0,3);let i=3;O.age=a.createVertexBuffer("age",i,1),i+=1,O.size=a.createVertexBuffer("size",i,3),i+=3,O.life=a.createVertexBuffer("life",i,1),i+=1,O.seed=a.createVertexBuffer("seed",i,4),i+=4,O.direction=a.createVertexBuffer("direction",i,3),i+=3,this._parent.particleEmitterType instanceof C&&(O.initialPosition=a.createVertexBuffer("initialPosition",i,3),i+=3),this._parent._colorGradientsTexture||(O.color=a.createVertexBuffer("color",i,4),i+=4),this._parent._isBillboardBased||(O.initialDirection=a.createVertexBuffer("initialDirection",i,3),i+=3),this._parent.noiseTexture&&(O.noiseCoordinates1=a.createVertexBuffer("noiseCoordinates1",i,3),i+=3,O.noiseCoordinates2=a.createVertexBuffer("noiseCoordinates2",i,3),i+=3),this._parent._angularSpeedGradientsTexture?(O.angle=a.createVertexBuffer("angle",i,1),i+=1):(O.angle=a.createVertexBuffer("angle",i,2),i+=2),this._parent._isAnimationSheetEnabled&&(O.cellIndex=a.createVertexBuffer("cellIndex",i,1),i+=1,this._parent.spriteRandomStartCell&&(O.cellStartOffset=a.createVertexBuffer("cellStartOffset",i,1),i+=1));const H=this._engine.recordVertexArrayObject(O,null,this._updateEffect);return this._engine.bindArrayBuffer(null),H}});class B{constructor(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,H=arguments.length>3?arguments[3]:void 0;this._engine=a,this._label=H,this._engine._storageBuffers.push(this),this._create(O,i)}_create(a,O){this._bufferSize=a,this._creationFlags=O,this._buffer=this._engine.createStorageBuffer(a,O,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(a,O,i){this._buffer&&this._engine.updateStorageBuffer(this._buffer,a,O,i)}async read(a,O,i,H){return await this._engine.readFromStorageBuffer(this._buffer,a,O,i,H)}dispose(){const a=this._engine._storageBuffers,O=a.indexOf(this);-1!==O&&(a[O]=a[a.length-1],a.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var T=i(12375),A=i(12384),E=i(12427),l=i(12370),W=i(12712),u=i(12209),c=i(12326),R=i(12622);class z{constructor(){this._gpuTimeInFrameId=-1,this.counter=new R.d}_addDuration(a,O){a<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==a?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(O,!1),this._gpuTimeInFrameId=a):this.counter.addCount(O,!1))}}var x=i(12265);class g{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=a,this._engine=O,this.uniqueId=W.e.UniqueId,O.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new z),this._engine.getCaps().supportComputeShaders?H.bindingsMapping?(this._context=O.createComputeContext(),this._shaderPath=i,this._options={bindingsMapping:{},defines:[],...H}):u.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):u.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(a,O){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const H=this._bindings[a];this._bindings[a]={type:i?0:4,object:O,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!H||H.object!==O||H.type!==this._bindings[a].type)}setStorageTexture(a,O){const i=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==O),this._bindings[a]={type:1,object:O,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setExternalTexture(a,O){const i=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==O),this._bindings[a]={type:6,object:O,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setVideoTexture(a,O){return!!O.externalTexture&&(this.setExternalTexture(a,O.externalTexture),!0)}setUniformBuffer(a,O){const i=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==O),this._bindings[a]={type:g._BufferIsDataBuffer(O)?7:2,object:O,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setStorageBuffer(a,O){const i=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!i||i.object!==O),this._bindings[a]={type:g._BufferIsDataBuffer(O)?7:3,object:O,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}setTextureSampler(a,O){const i=this._bindings[a];this._contextIsDirty||(this._contextIsDirty=!i||!O.compareSampler(i.object)),this._bindings[a]={type:5,object:O,indexInGroupEntries:null===i||void 0===i?void 0:i.indexInGroupEntries}}isReady(){let a=this._effect;for(const b in this._bindings){const a=this._bindings[b],O=a.type,i=a.object;switch(O){case 0:case 4:case 1:if(!i.isReady())return!1;break;case 6:if(!i.isReady())return!1;break}}const O=[],i=this._shaderPath;if(this._options.defines)for(let b=0;b<this._options.defines.length;b++)O.push(this._options.defines[b]);const H=O.join("\n");return this._cachedDefines!==H&&(this._cachedDefines=H,a=this._engine.createComputeEffect(i,{defines:H,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=a),!!a.isReady()}dispatch(a,O,i){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,a,O,i,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const i=g._BufferIsDataBuffer(a)?a:a.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,i,O,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const O in this._bindings){const i=this._bindings[O];if(!this._options.bindingsMapping[O])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+O+"'");switch(i.type){case 0:{const H=this._samplers[O],b=i.object;var a;if(!H||!b._texture||!H.compareSampler(b._texture))this._samplers[O]=(new c.c).setParameters(b.wrapU,b.wrapV,b.wrapR,b.anisotropicFilteringLevel,b._texture.samplingMode,null===(a=b._texture)||void 0===a?void 0:a._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const a=i.object;a.getBuffer()!==i.buffer&&(i.buffer=a.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((b=>{(0,x.f)((()=>this.dispatch(a,O,i)),b,void 0,H)}))}serialize(){const a=E.d.Serialize(this);a.options=this._options,a.shaderPath=this._shaderPath,a.oh={},a.textures={};for(const O in this._bindings){const i=this._bindings[O],H=i.object;switch(i.type){case 0:case 4:case 1:{const b=H.serialize();b&&(a.textures[O]=b,a.oh[O]={type:i.type});break}}}return a}static Parse(a,O,i){const H=E.d.Parse((()=>new g(a.name,O.getEngine(),a.shaderPath,a.options)),a,O,i);for(const b in a.textures){const G=a.oh[b],q=l.e.Parse(a.textures[b],O,i);0===G.type?H.setTexture(b,q):4===G.type?H.setTexture(b,q,!1):H.setStorageTexture(b,q)}return H}static _BufferIsDataBuffer(a){return void 0!==a.underlyingResource}}(0,T.c)([(0,A.G)()],g.prototype,"name",void 0),(0,T.c)([(0,A.G)()],g.prototype,"fastMode",void 0),(0,Q.h)("BABYLON.ComputeShader",g);var N=i(12674);const v="gpuUpdateParticlesComputeShader",X="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";y.c.ShadersStoreWGSL[v]||(y.c.ShadersStoreWGSL[v]=X);(0,Q.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(a,O){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=a,this._engine=O}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var a;return(null===(a=this._updateComputeShader)||void 0===a?void 0:a.isReady())??!1}createUpdateBuffer(a){var O;const i={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(i.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(i.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(i.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(i.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(i.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(i.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(i.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new g("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:i,defines:a.split("\n")}),null===(O=this._simParamsComputeShader)||void 0===O||O.dispose(),this._simParamsComputeShader=new N.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new U(this._simParamsComputeShader)}createVertexBuffers(a,O){this._renderVertexBuffers.push(O)}createParticleBuffer(a){const O=new B(this._engine,4*a.length,11,"ComputeShaderParticleSystemBuffer");return O.update(a),this._bufferComputeShader.push(O),O.getBuffer()}bindDrawBuffers(a,O,i){this._engine.bindBuffers(this._renderVertexBuffers[a],i,O)}preUpdateParticleBuffer(){}updateParticleBuffer(a,O,i){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[a]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^a]),this._updateComputeShader.dispatch(Math.ceil(i/64))}releaseBuffers(){var a;for(let O=0;O<this._bufferComputeShader.length;++O)this._bufferComputeShader[O].dispose();this._bufferComputeShader.length=0,null===(a=this._simParamsComputeShader)||void 0===a||a.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class p{constructor(a,O,i){this.gradient=a,this.color1=O,this.color2=i}getColorToRef(a){this.color2?q.Ab.LerpToRef(this.color1,this.color2,Math.random(),a):a.q(this.color1)}}class o{constructor(a,O){this.gradient=a,this.color=O}}class d{constructor(a,O,i){this.gradient=a,this.factor1=O,this.factor2=i}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class Y{static GetCurrentGradient(a,O,i){if(O[0].gradient>a)return void i(O[0],O[0],1);for(let b=0;b<O.length-1;b++){const H=O[b],G=O[b+1];if(a>=H.gradient&&a<=G.gradient){return void i(H,G,(a-H.gradient)/(G.gradient-H.gradient))}}const H=O.length-1;i(O[H],O[H],1)}}var L=i(12193),s=i(12869),t=i(12236);class V{constructor(a){this.particleSystem=a,this.position=H.ZO.Zero(),this.direction=H.ZO.Zero(),this.color=new q.Ab(0,0,0,0),this.colorStep=new q.Ab(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new H.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new q.Ab(0,0,0,0),this._currentColor2=new q.Ab(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=V._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let a=this.age,O=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===O?(O=1,a=this._randomCellOffset):a+=this._randomCellOffset);const i=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let H;H=this._initialSpriteCellLoop?(0,I.Clamp)(a*O%this.lifeTime/this.lifeTime):(0,I.Clamp)(a*O/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+H*i|0}_inheritParticleInfoToSubEmitter(a){if(a.particleSystem.HO.position){const O=a.particleSystem.HO;if(O.position.q(this.position),a.inheritDirection){const a=H.TmpVectors.ZO[0];this.direction.normalizeToRef(a),O.setDirection(a,0,Math.PI/2)}}else{a.particleSystem.HO.q(this.position)}this.direction.scaleToRef(a.inheritedVelocityAmount/2,H.TmpVectors.ZO[0]),a.particleSystem._inheritedVelocityOffset.q(H.TmpVectors.ZO[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const a of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(a)}_reset(){this.age=0,this.id=V._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(a){a.position.q(this.position),this._initialDirection?a._initialDirection?a._initialDirection.q(this._initialDirection):a._initialDirection=this._initialDirection.clone():a._initialDirection=null,a.direction.q(this.direction),this.Hk&&(a.Hk?a.Hk.q(this.Hk):a.Hk=this.Hk.clone()),a.color.q(this.color),a.colorStep.q(this.colorStep),a.lifeTime=this.lifeTime,a.age=this.age,a._randomCellOffset=this._randomCellOffset,a.size=this.size,a.scale.q(this.scale),a.angle=this.angle,a.angularSpeed=this.angularSpeed,a.particleSystem=this.particleSystem,a.cellIndex=this.cellIndex,a.id=this.id,a._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(a._currentColorGradient=this._currentColorGradient,a._currentColor1.q(this._currentColor1),a._currentColor2.q(this._currentColor2)),this._currentSizeGradient&&(a._currentSizeGradient=this._currentSizeGradient,a._currentSize1=this._currentSize1,a._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(a._currentAngularSpeedGradient=this._currentAngularSpeedGradient,a._currentAngularSpeed1=this._currentAngularSpeed1,a._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(a._currentVelocityGradient=this._currentVelocityGradient,a._currentVelocity1=this._currentVelocity1,a._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(a._currentLimitVelocityGradient=this._currentLimitVelocityGradient,a._currentLimitVelocity1=this._currentLimitVelocity1,a._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(a._currentDragGradient=this._currentDragGradient,a._currentDrag1=this._currentDrag1,a._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(a._initialStartSpriteCellId=this._initialStartSpriteCellId,a._initialEndSpriteCellId=this._initialEndSpriteCellId,a._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(a.remapData&&this.remapData?a.remapData.q(this.remapData):a.remapData=new H.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(a._randomNoiseCoordinates1?(a._randomNoiseCoordinates1.q(this._randomNoiseCoordinates1),a._randomNoiseCoordinates2.q(this._randomNoiseCoordinates2)):(a._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),a._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}V._Count=0;var aa=i(12518),Oa=(i(12561),i(12773)),ia=i(12771),Ha=i(12668);function ba(a,O){const i=(0,I.RandomRange)(0,1);q.Ab.LerpToRef(O.color1,O.color2,i,a.color),O.colorDead.subtractToRef(a.color,O._colorDiff),O._colorDiff.scaleToRef(1/a.lifeTime,a.colorStep)}function Ga(a,O){a._currentColorGradient=O._colorGradients[0],a._currentColorGradient.getColorToRef(a.color),a._currentColor1.q(a.color),O._colorGradients.length>1?O._colorGradients[1].getColorToRef(a._currentColor2):a._currentColor2.q(a.color)}function qa(a,O){const i=O._colorGradients;Y.GetCurrentGradient(O._ratio,i,((O,i,H)=>{O!==a._currentColorGradient&&(a._currentColor1.q(a._currentColor2),i.getColorToRef(a._currentColor2),a._currentColorGradient=O),q.Ab.LerpToRef(a._currentColor1,a._currentColor2,H,a.color)}))}function Qa(a,O){a.colorStep.scaleToRef(O._scaledUpdateSpeed,O._scaledColorStep),a.color.addInPlace(O._scaledColorStep),a.color.a<0&&(a.color.a=0)}function ka(a,O){Y.GetCurrentGradient(O._ratio,O._angularSpeedGradients,((O,i,H)=>{O!==a._currentAngularSpeedGradient&&(a._currentAngularSpeed1=a._currentAngularSpeed2,a._currentAngularSpeed2=i.getFactor(),a._currentAngularSpeedGradient=O),a.angularSpeed=(0,I.Lerp)(a._currentAngularSpeed1,a._currentAngularSpeed2,H)}))}function Ia(a,O){a.angle+=a.angularSpeed*O._scaledUpdateSpeed}function Pa(a,O){O.particleEmitterType.startDirectionFunction(O._emitterWorldMatrix,a.direction,a,O.isLocal,O._emitterInverseWorldMatrix)}function ea(a,O){O.startDirectionFunction(O._emitterWorldMatrix,a.direction,a,O.isLocal)}function ha(a,O){a._currentVelocityGradient=O._velocityGradients[0],a._currentVelocity1=a._currentVelocityGradient.getFactor(),O._velocityGradients.length>1?a._currentVelocity2=O._velocityGradients[1].getFactor():a._currentVelocity2=a._currentVelocity1}function ja(a,O){a._currentLimitVelocityGradient=O._limitVelocityGradients[0],a._currentLimitVelocity1=a._currentLimitVelocityGradient.getFactor(),O._limitVelocityGradients.length>1?a._currentLimitVelocity2=O._limitVelocityGradients[1].getFactor():a._currentLimitVelocity2=a._currentLimitVelocity1}function Za(a,O){Y.GetCurrentGradient(O._ratio,O._velocityGradients,((i,H,b)=>{i!==a._currentVelocityGradient&&(a._currentVelocity1=a._currentVelocity2,a._currentVelocity2=H.getFactor(),a._currentVelocityGradient=i),O._directionScale*=(0,I.Lerp)(a._currentVelocity1,a._currentVelocity2,b)}))}function Fa(a,O){Y.GetCurrentGradient(O._ratio,O._limitVelocityGradients,((i,H,b)=>{i!==a._currentLimitVelocityGradient&&(a._currentLimitVelocity1=a._currentLimitVelocity2,a._currentLimitVelocity2=H.getFactor(),a._currentLimitVelocityGradient=i);const G=(0,I.Lerp)(a._currentLimitVelocity1,a._currentLimitVelocity2,b);a.direction.length()>G&&a.direction.scaleInPlace(O.limitVelocityDamping)}))}function ra(a,O){a.direction.scaleToRef(O._directionScale,O._scaledDirection)}function Ja(a,O){O.particleEmitterType.startPositionFunction(O._emitterWorldMatrix,a.position,a,O.isLocal)}function mO(a,O){O.startPositionFunction(O._emitterWorldMatrix,a.position,a,O.isLocal)}function Ma(a,O){a.Hk?a.Hk.q(a.position):a.Hk=a.position.clone(),H.ZO.TransformCoordinatesToRef(a.Hk,O._emitterWorldMatrix,a.position)}function Ca(a,O){O.isLocal&&a.Hk?(a.Hk.addInPlace(O._scaledDirection),H.ZO.TransformCoordinatesToRef(a.Hk,O._emitterWorldMatrix,a.position)):a.position.addInPlace(O._scaledDirection)}function na(a,O){a._currentDragGradient=O._dragGradients[0],a._currentDrag1=a._currentDragGradient.getFactor(),O._dragGradients.length>1?a._currentDrag2=O._dragGradients[1].getFactor():a._currentDrag2=a._currentDrag1}function Da(a,O){Y.GetCurrentGradient(O._ratio,O._dragGradients,((i,H,b)=>{i!==a._currentDragGradient&&(a._currentDrag1=a._currentDrag2,a._currentDrag2=H.getFactor(),a._currentDragGradient=i);const G=(0,I.Lerp)(a._currentDrag1,a._currentDrag2,b);O._scaledDirection.scaleInPlace(1-G)}))}function Ua(a,O){a._randomNoiseCoordinates1?(a._randomNoiseCoordinates1.fb(Math.random(),Math.random(),Math.random()),a._randomNoiseCoordinates2.fb(Math.random(),Math.random(),Math.random())):(a._randomNoiseCoordinates1=new H.ZO(Math.random(),Math.random(),Math.random()),a._randomNoiseCoordinates2=new H.ZO(Math.random(),Math.random(),Math.random()))}function ya(a,O){const i=O._noiseTextureData,b=O._noiseTextureSize;if(i&&b&&a._randomNoiseCoordinates1){const G=O._fetchR(a._randomNoiseCoordinates1.x,a._randomNoiseCoordinates1.y,b.width,b.height,i),q=O._fetchR(a._randomNoiseCoordinates1.z,a._randomNoiseCoordinates2.x,b.width,b.height,i),Q=O._fetchR(a._randomNoiseCoordinates2.y,a._randomNoiseCoordinates2.z,b.width,b.height,i),k=H.TmpVectors.ZO[0],I=H.TmpVectors.ZO[1];k.fb((2*G-1)*O.noiseStrength.x,(2*q-1)*O.noiseStrength.y,(2*Q-1)*O.noiseStrength.z),k.scaleToRef(O._tempScaledUpdateSpeed,I),a.direction.addInPlace(I)}}function wa(a,O){O.gravity.scaleToRef(O._tempScaledUpdateSpeed,O._scaledGravity),a.direction.addInPlace(O._scaledGravity)}function Ka(a,O){a.size=(0,I.RandomRange)(O.minSize,O.maxSize),a.scale.fb((0,I.RandomRange)(O.minScaleX,O.maxScaleX),(0,I.RandomRange)(O.minScaleY,O.maxScaleY))}function Sa(a,O){a._currentSizeGradient=O._sizeGradients[0],a._currentSize1=a._currentSizeGradient.getFactor(),a.size=a._currentSize1,O._sizeGradients.length>1?a._currentSize2=O._sizeGradients[1].getFactor():a._currentSize2=a._currentSize1,a.scale.fb((0,I.RandomRange)(O.minScaleX,O.maxScaleX),(0,I.RandomRange)(O.minScaleY,O.maxScaleY))}function fa(a,O){const i=O._actualFrame/O.targetStopDuration;Y.GetCurrentGradient(i,O._startSizeGradients,((i,H,b)=>{i!==O._currentStartSizeGradient&&(O._currentStartSize1=O._currentStartSize2,O._currentStartSize2=H.getFactor(),O._currentStartSizeGradient=i);const G=(0,I.Lerp)(O._currentStartSize1,O._currentStartSize2,b);a.scale.scaleInPlace(G)}))}function Ba(a,O){Y.GetCurrentGradient(O._ratio,O._sizeGradients,((O,i,H)=>{O!==a._currentSizeGradient&&(a._currentSize1=a._currentSize2,a._currentSize2=i.getFactor(),a._currentSizeGradient=O),a.size=(0,I.Lerp)(a._currentSize1,a._currentSize2,H)}))}function Ta(a,O){a.remapData=new H.Vector4(0,1,0,1)}function Aa(a,O){O._colorRemapGradients&&O._colorRemapGradients.length>0&&Y.GetCurrentGradient(O._ratio,O._colorRemapGradients,((O,i,H)=>{const b=(0,I.Lerp)(O.factor1,i.factor1,H),G=(0,I.Lerp)(O.factor2,i.factor2,H);a.remapData.x=b,a.remapData.y=G-b})),O._alphaRemapGradients&&O._alphaRemapGradients.length>0&&Y.GetCurrentGradient(O._ratio,O._alphaRemapGradients,((O,i,H)=>{const b=(0,I.Lerp)(O.factor1,i.factor1,H),G=(0,I.Lerp)(O.factor2,i.factor2,H);a.remapData.z=b,a.remapData.w=G-b}))}function Ea(a,O){const i=(0,I.Clamp)(O._actualFrame/O.targetStopDuration);Y.GetCurrentGradient(i,O._lifeTimeGradients,((O,H)=>{const b=O,G=H,q=b.getFactor(),Q=G.getFactor(),k=(i-b.gradient)/(G.gradient-b.gradient);a.lifeTime=(0,I.Lerp)(q,Q,k)})),O._emitPower=(0,I.RandomRange)(O.minEmitPower,O.maxEmitPower)}function la(a,O){a.lifeTime=(0,I.RandomRange)(O.minLifeTime,O.maxLifeTime),O._emitPower=(0,I.RandomRange)(O.minEmitPower,O.maxEmitPower)}function Wa(a,O){0===O._emitPower?(a._initialDirection?a._initialDirection.q(a.direction):a._initialDirection=a.direction.clone(),a.direction.set(0,0,0)):(a._initialDirection=null,a.direction.scaleInPlace(O._emitPower)),a.direction.addInPlace(O._inheritedVelocityOffset)}function ua(a,O){a.angularSpeed=(0,I.RandomRange)(O.minAngularSpeed,O.maxAngularSpeed),a.angle=(0,I.RandomRange)(O.minInitialRotation,O.maxInitialRotation)}function ca(a,O){a._currentAngularSpeedGradient=O._angularSpeedGradients[0],a.angularSpeed=a._currentAngularSpeedGradient.getFactor(),a._currentAngularSpeed1=a.angularSpeed,O._angularSpeedGradients.length>1?a._currentAngularSpeed2=O._angularSpeedGradients[1].getFactor():a._currentAngularSpeed2=a._currentAngularSpeed1,a.angle=(0,I.RandomRange)(O.minInitialRotation,O.maxInitialRotation)}function Ra(a,O){a._initialStartSpriteCellId=O.startSpriteCellID,a._initialEndSpriteCellId=O.endSpriteCellID,a._initialSpriteCellLoop=O.spriteCellLoop}function za(a,O){a.previousItem=O.previousItem,a.nextItem=O,O.previousItem&&(O.previousItem.nextItem=a),O.previousItem=a}function xa(a,O){a.previousItem=O,a.nextItem=O.nextItem,O.nextItem&&(O.nextItem.previousItem=a),O.nextItem=a}function ga(a,O){let i=O;for(;i.nextItem;)i=i.nextItem;a.previousItem=i,a.nextItem=i.nextItem,i.nextItem=a}function Na(a){a.previousItem&&(a.previousItem.nextItem=a.nextItem),a.nextItem&&(a.nextItem.previousItem=a.previousItem)}class va extends k{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(a){this._startDirectionFunction!==a&&(this._startDirectionFunction=a,this._directionProcessing.process=a?ea:Pa)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(a){this._startPositionFunction!==a&&(this._startPositionFunction=a,this._positionCreation.process=a?mO:Ja)}set onDispose(a){this._onDisposeObserver&&this.Pb.remove(this._onDisposeObserver),this._onDisposeObserver=this.Pb.add(a)}get h(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(a){this._useRampGradients!==a&&(this._useRampGradients=a,this._resetEffect(),a?(this._rampCreation={process:Ta,previousItem:null,nextItem:null},xa(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Aa,previousItem:null,nextItem:null},xa(this._remapGradientProcessing,this._gravityProcessing)):(Na(this._rampCreation),Na(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(a){this._isLocal!==a&&(this._isLocal=a,a?(this._isLocalCreation={process:Ma,previousItem:null,nextItem:null},xa(this._isLocalCreation,this._positionCreation)):Na(this._isLocalCreation))}get particles(){return this.Rh}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(a){this._animationSheetEnabled!==a&&(this._animationSheetEnabled=a,a?(this._sheetCreation={process:Ra,previousItem:null,nextItem:null},xa(this._sheetCreation,this._colorCreation)):Na(this._sheetCreation),this._reset())}getActiveCount(){return this.Rh.length}getClassName(){return"cb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var a;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(a=this._customWrappers[O])||void 0===a?void 0:a.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[a]??this._customWrappers[0]}setCustomEffect(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new aa.e(this._engine),this._customWrappers[O].effect=a,this._customWrappers[O].drawContext&&(this._customWrappers[O].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new L.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(a){if(this.noiseTexture!==a){if(this._noiseTexture=a,!a)return Na(this._noiseCreation),void Na(this._noiseProcessing);this._noiseCreation={process:Ua,previousItem:null,nextItem:null},xa(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:ya,previousItem:null,nextItem:null},xa(this._noiseProcessing,this._positionProcessing)}}constructor(a,O,i){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(a),this._emitterInverseWorldMatrix=H.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new H.ZO,this.Pb=new L.e,this.onStoppedObservable=new L.e,this.onStartedObservable=new L.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.Rh=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new q.Ab(0,0,0,0),this._colorDiff=new q.Ab(0,0,0,0),this._scaledDirection=H.ZO.Zero(),this._scaledGravity=H.ZO.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=a=>{},this.recycleParticle=a=>{const O=this.Rh.pop();O!==a&&O.copyTo(a),this._stockParticles.push(O)},this._createParticle=()=>{let a;return 0!==this._stockParticles.length?(a=this._stockParticles.pop(),a._reset()):a=new V(this),this._prepareParticle(a),a},this.paused=!1,this._shadersLoaded=!1,this._capacity=O,this._epsilon=Q,i&&"Scene"!==i.getClassName()?(this._engine=i,this.defaultProjectionMatrix=H.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=i||t.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Eh.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:la,previousItem:null,nextItem:null},this._positionCreation={process:Ja,previousItem:null,nextItem:null},xa(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Pa,previousItem:null,nextItem:null},xa(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Wa,previousItem:null,nextItem:null},xa(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Ka,previousItem:null,nextItem:null},xa(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:ua,previousItem:null,nextItem:null},xa(this._angleCreation,this._sizeCreation),this._colorCreation={process:ba,previousItem:null,nextItem:null},xa(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,k||(this._colorProcessing={process:Qa,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Ia,previousItem:null,nextItem:null},xa(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:ra,previousItem:null,nextItem:null},xa(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Ca,previousItem:null,nextItem:null},xa(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:wa,previousItem:null,nextItem:null},xa(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=G,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new aa.e(this._engine)},this._customWrappers[0].effect=b,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new e,this.updateFunction=a=>{var O;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(O=this.noiseTexture.getContent())||void 0===O||O.then((a=>{this._noiseTextureData=a})));const i=a===this.Rh;for(let H=0;H<a.length;H++){const O=a[H];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const b=O.age;if(O.age+=this._tempScaledUpdateSpeed,O.age>O.lifeTime){const a=O.age-b,i=O.lifeTime-b;this._tempScaledUpdateSpeed=i*this._tempScaledUpdateSpeed/a,O.age=O.lifeTime}this._ratio=O.age/O.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let G=this._updateQueueStart;for(;G;)G.process(O,this),G=G.nextItem;if(this._isAnimationSheetEnabled&&!k&&O.updateCellIndex(),O._inheritParticleInfoToSubEmitters(),O.age>=O.lifeTime){if(this._emitFromParticle(O),O._attachedSubEmitters){for(const a of O._attachedSubEmitters)a.particleSystem.disposeOnStop=!0,a.particleSystem.stop();O._attachedSubEmitters=null}this.recycleParticle(O),i&&H--}else;}}}serialize(a){throw new Error("Method not implemented.")}clone(a,O){throw new Error("Method not implemented.")}_addFactorGradient(a,O,i,H){const b=new d(O,i,H);a.push(b),a.sort(((a,O)=>a.gradient<O.gradient?-1:a.gradient>O.gradient?1:0))}_removeFactorGradient(a,O){if(!a)return;let i=0;for(const H of a){if(H.gradient===O){a.splice(i,1);break}i++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Ea:this._lifeTimeCreation.process=la}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:fa,previousItem:null,nextItem:null},xa(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Na(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(a){this.targetStopDuration!==a&&(this._targetStopDuration=a,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(a,O,i){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,a,O,i),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(a){return this._removeFactorGradient(this._lifeTimeGradients,a),this._syncLifeTimeCreation(),this}addSizeGradient(a,O,i){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Sa,this._sizeGradientProcessing={process:Ba,previousItem:null,nextItem:null},za(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,a,O,i),this}removeSizeGradient(a){var O;return this._removeFactorGradient(this._sizeGradients,a),0===(null===(O=this._sizeGradients)||void 0===O?void 0:O.length)&&(Na(this._sizeGradientProcessing),this._sizeCreation.process=Ka),this}addColorRemapGradient(a,O,i){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,a,O,i),this}removeColorRemapGradient(a){return this._removeFactorGradient(this._colorRemapGradients,a),this}addAlphaRemapGradient(a,O,i){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,a,O,i),this}removeAlphaRemapGradient(a){return this._removeFactorGradient(this._alphaRemapGradients,a),this}addAngularSpeedGradient(a,O,i){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=ca,this._angularSpeedGradientProcessing={process:ka,previousItem:null,nextItem:null},za(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,a,O,i),this}removeAngularSpeedGradient(a){var O;return this._removeFactorGradient(this._angularSpeedGradients,a),0===(null===(O=this._angularSpeedGradients)||void 0===O?void 0:O.length)&&(this._angleCreation.process=ua,Na(this._angularSpeedGradientProcessing)),this}addVelocityGradient(a,O,i){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:ha,previousItem:null,nextItem:null},xa(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Za,previousItem:null,nextItem:null},za(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,a,O,i),this}removeVelocityGradient(a){var O;return this._removeFactorGradient(this._velocityGradients,a),0===(null===(O=this._velocityGradients)||void 0===O?void 0:O.length)&&(Na(this._velocityCreation),Na(this._velocityGradientProcessing)),this}addLimitVelocityGradient(a,O,i){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:ja,previousItem:null,nextItem:null},xa(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Fa,previousItem:null,nextItem:null},xa(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,a,O,i),this}removeLimitVelocityGradient(a){var O;return this._removeFactorGradient(this._limitVelocityGradients,a),0===(null===(O=this._limitVelocityGradients)||void 0===O?void 0:O.length)&&(Na(this._limitVelocityCreation),Na(this._limitVelocityGradientProcessing)),this}addDragGradient(a,O,i){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:na,previousItem:null,nextItem:null},za(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Da,previousItem:null,nextItem:null},za(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,a,O,i),this}removeDragGradient(a){var O;return this._removeFactorGradient(this._dragGradients,a),0===(null===(O=this._dragGradients)||void 0===O?void 0:O.length)&&(Na(this._dragCreation),Na(this._dragGradientProcessing)),this}addEmitRateGradient(a,O,i){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,a,O,i),this}removeEmitRateGradient(a){return this._removeFactorGradient(this._emitRateGradients,a),this}addStartSizeGradient(a,O,i){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,a,O,i),this._syncStartSizeCreation(),this}removeStartSizeGradient(a){return this._removeFactorGradient(this._startSizeGradients,a),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const a=new Uint8Array(4*this._rawTextureWidth),O=q.TmpColors.mi[0];for(let i=0;i<this._rawTextureWidth;i++){const H=i/this._rawTextureWidth;Y.GetCurrentGradient(H,this._rampGradients,((H,b,G)=>{q.mi.LerpToRef(H.color,b.color,G,O),a[4*i]=255*O.r,a[4*i+1]=255*O.g,a[4*i+2]=255*O.b,a[4*i+3]=255}))}this._rampGradientsTexture=s.d.CreateRGBATexture(a,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((a,O)=>a.gradient<O.gradient?-1:a.gradient>O.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(a,O){this._rampGradients||(this._rampGradients=[]);const i=new o(a,O);return this._rampGradients.push(i),this._syncRampGradientTexture(),this}removeRampGradient(a){return this._removeGradientAndTexture(a,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(a,O,i){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Ga,this._colorProcessing.process=qa);const H=new p(a,O,i);return this._colorGradients.push(H),this._colorGradients.sort(((a,O)=>a.gradient<O.gradient?-1:a.gradient>O.gradient?1:0)),this}removeColorGradient(a){if(!this._colorGradients)return this;let O=0;for(const i of this._colorGradients){if(i.gradient===a){this._colorGradients.splice(O,1);break}O++}return 0===this._colorGradients.length&&(this._colorCreation.process=ba,this._colorProcessing.process=Qa),this}resetDrawCache(){if(this._drawWrappers){for(const a of this._drawWrappers)if(a)for(const O of a)null===O||void 0===O||O.dispose();this._drawWrappers=[]}}_fetchR(a,O,i,H,b){return b[4*(((a=.5*Math.abs(a)+.5)*i%i|0)+((O=.5*Math.abs(O)+.5)*H%H|0)*i)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const a=this._engine,O=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*O),this._vertexBuffer=new n.b(a,this._vertexData,!0,O);let i=0;const H=this._vertexBuffer.createVertexBuffer(n.c.PositionKind,i,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[n.c.PositionKind]=H,i+=3;const b=this._vertexBuffer.createVertexBuffer(n.c.ColorKind,i,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[n.c.ColorKind]=b,i+=4;const G=this._vertexBuffer.createVertexBuffer("angle",i,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=G,i+=1;const q=this._vertexBuffer.createVertexBuffer("size",i,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=q,i+=2,this._isAnimationSheetEnabled){const a=this._vertexBuffer.createVertexBuffer("cellIndex",i,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=a,i+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const a=this._vertexBuffer.createVertexBuffer("direction",i,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=a,i+=3}if(this._useRampGradients){const a=this._vertexBuffer.createVertexBuffer("remapData",i,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=a,i+=4}let Q;if(this._useInstancing){const O=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new n.b(a,O,!1,2),Q=this._spriteBuffer.createVertexBuffer("offset",0,2)}else Q=this._vertexBuffer.createVertexBuffer("offset",i,2,this._vertexBufferSize,this._useInstancing),i+=2;this._vertexBuffers.offset=Q,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const a=[],O=[];let i=0;for(let H=0;H<this._capacity;H++)a.push(i),a.push(i+1),a.push(i+2),a.push(i),a.push(i+2),a.push(i+3),O.push(i,i+1,i+1,i+2,i+2,i+3,i+3,i,i,i+3),i+=4;this._indexBuffer=this._engine.createIndexBuffer(a),this._linesIndexBuffer=this._engine.createIndexBuffer(O)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(a)setTimeout((()=>{this.start(0)}),a);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var O;-1!==(null===(O=this.HO)||void 0===O?void 0:O.getClassName().indexOf("Mesh"))&&this.HO.yb(!0);const a=this.noiseTexture;if(a&&a.onGeneratedObservable)a.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let O=0;O<this.preWarmCycles;O++)this.animate(!0),a.render()}))}));else for(let O=0;O<this.preWarmCycles;O++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(a))}_postStop(a){}reset(){this._stockParticles.length=0,this.Rh.length=0}_appendParticleVertex(a,O,i,b){let G=a*this._vertexBufferSize;if(this._vertexData[G++]=O.position.x+this.wI.x,this._vertexData[G++]=O.position.y+this.wI.y,this._vertexData[G++]=O.position.z+this.wI.z,this._vertexData[G++]=O.color.r,this._vertexData[G++]=O.color.g,this._vertexData[G++]=O.color.b,this._vertexData[G++]=O.color.a,this._vertexData[G++]=O.angle,this._vertexData[G++]=O.scale.x*O.size,this._vertexData[G++]=O.scale.y*O.size,this._isAnimationSheetEnabled&&(this._vertexData[G++]=O.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[G++]=O.direction.x,this._vertexData[G++]=O.direction.y,this._vertexData[G++]=O.direction.z);else if(O._initialDirection){let a=O._initialDirection;this.isLocal&&(H.ZO.TransformNormalToRef(a,this._emitterWorldMatrix,H.TmpVectors.ZO[0]),a=H.TmpVectors.ZO[0]),0===a.x&&0===a.z&&(a.x=.001),this._vertexData[G++]=a.x,this._vertexData[G++]=a.y,this._vertexData[G++]=a.z}else{let a=O.direction;this.isLocal&&(H.ZO.TransformNormalToRef(a,this._emitterWorldMatrix,H.TmpVectors.ZO[0]),a=H.TmpVectors.ZO[0]),0===a.x&&0===a.z&&(a.x=.001),this._vertexData[G++]=a.x,this._vertexData[G++]=a.y,this._vertexData[G++]=a.z}this._useRampGradients&&O.remapData&&(this._vertexData[G++]=O.remapData.x,this._vertexData[G++]=O.remapData.y,this._vertexData[G++]=O.remapData.z,this._vertexData[G++]=O.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),0===b?b=this._epsilon:1===b&&(b=1-this._epsilon)),this._vertexData[G++]=i,this._vertexData[G++]=b)}_prepareParticle(a){}_createNewOnes(a){let O;for(let i=0;i<a&&this.Rh.length!==this._capacity;i++){O=this._createParticle(),this.Rh.push(O);let a=this._createQueueStart;for(;a;)a.process(O,this),a=a.nextItem;O._inheritParticleInfoToSubEmitters()}}_update(a){if(this._alive=this.Rh.length>0,this.HO.position){const a=this.HO;this._emitterWorldMatrix=a.getWorldMatrix()}else{const a=this.HO;this._emitterWorldMatrix=H.Matrix.Translation(a.x,a.y,a.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Rh),this._createNewOnes(a)}static _GetAttributeNamesOrOptions(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H=[n.c.PositionKind,n.c.ColorKind,"angle","offset","size"];return a&&H.push("cellIndex"),O||H.push("direction"),i&&H.push("remapData"),H}static _GetEffectCreationOptions(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Oa.d)(H),a&&H.push("particlesInfos"),O&&H.push("logarithmicDepthConstant"),i&&(H.push("vFogInfos"),H.push("vFogColor")),H}fillDefines(a,O){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Oa.h)(this,this._scene,a),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&a.push("#define FOG")),this._isAnimationSheetEnabled&&a.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&a.push("#define LOGARITHMICDEPTH"),O===k.BLENDMODE_MULTIPLY&&a.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&a.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(a.push("#define BILLBOARD"),this.billboardMode){case 2:a.push("#define BILLBOARDY");break;case 8:case 9:a.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&a.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:a.push("#define BILLBOARDMODE_ALL")}i&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),a.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(a,O,i){O.push(...va._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),a.push(...va._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),i.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Ha.g)(a,this._imageProcessingConfigurationDefines),(0,Ha.e)(i,this._imageProcessingConfigurationDefines))}_getWrapper(a){const O=this._getCustomDrawWrapper(a);if(null!==O&&void 0!==O&&O.effect)return O;const i=[];this.fillDefines(i,a);const H=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let b=this._drawWrappers[H];b||(b=this._drawWrappers[H]=[]);let G=b[a];G||(G=new aa.e(this._engine),G.drawContext&&(G.drawContext.useInstancing=this._useInstancing),b[a]=G);const q=i.join("\n");if(G.defines!==q){const a=[],O=[],i=[];this.fillUniformsAttributesAndSamplerNames(O,a,i),G.setEffect(this._engine.createEffect("particles",a,O,i,q,void 0,void 0,void 0,void 0,this._shaderLanguage),q)}return G}animate(){var a;let O,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!i&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(i?this.preWarmStepOffset:(null===(a=this._scene)||void 0===a?void 0:a.getAnimationRatio())||1),this.manualEmitCount>-1)O=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let a=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const O=this._actualFrame/this.targetStopDuration;Y.GetCurrentGradient(O,this._emitRateGradients,((O,i,H)=>{O!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=i.getFactor(),this._currentEmitRateGradient=O),a=(0,I.Lerp)(this._currentEmitRate1,this._currentEmitRate2,H)}))}O=a*this._scaledUpdateSpeed|0,this._newPartsExcess+=a*this._scaledUpdateSpeed-O}if(this._newPartsExcess>1&&(O+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?O=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(O),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!i){let a=0;for(let O=0;O<this.Rh.length;O++){const i=this.Rh[O];this._appendParticleVertices(a,i),a+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Rh.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(a,O){this._appendParticleVertex(a++,O,0,0),this._useInstancing||(this._appendParticleVertex(a++,O,1,0),this._appendParticleVertex(a++,O,1,1),this._appendParticleVertex(a++,O,0,1))}rebuild(){var a;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(a=this._spriteBuffer)||void 0===a||a._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!va.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(i.bind(i,13900)),Promise.resolve().then(i.bind(i,13841))])):await Promise.all([Promise.resolve().then(i.bind(i,13828)),Promise.resolve().then(i.bind(i,13814))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.HO||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==k.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(k.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(k.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(a){const O=this._getWrapper(a),i=O.effect,b=this._engine;b.enableEffect(O);const G=this.defaultViewMatrix??this._scene.getViewMatrix();if(i.setTexture("diffuseSampler",this.particleTexture),i.setMatrix("view",G),i.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const a=this.particleTexture.getBaseSize();i.setFloat3("particlesInfos",this.spriteCellWidth/a.width,this.spriteCellHeight/a.height,this.spriteCellWidth/a.width)}if(i.setVector2("translationPivot",this.translationPivot),i.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const a=this._scene.activeCamera;i.setVector3("eyePosition",a.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),i.setTexture("rampSampler",this._rampGradientsTexture));const q=i.defines;var Q,k,I,P,e,h;(this._scene&&((0,Oa.f)(i,this,this._scene),this.applyFog&&(0,ia.d)(this._scene,void 0,i)),q.indexOf("#define BILLBOARDMODE_ALL")>=0&&(G.invertToRef(H.TmpVectors.Matrix[0]),i.setMatrix("invView",H.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?b.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,i):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,i)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?b.bindBuffers(this._vertexBuffers,null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?this._linesIndexBuffer:this._indexBuffer,i):b.bindBuffers(this._vertexBuffers,null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?this._linesIndexBufferUseInstancing:null,i);(this.useLogarithmicDepth&&this._scene&&(0,ia.h)(q,i,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(i),this._setEngineBasedOnBlendMode(a),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(i),this._useInstancing)?null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?b.drawElementsType(6,0,10,this.Rh.length):b.drawArraysType(7,0,4,this.Rh.length):null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?b.drawElementsType(1,0,10*this.Rh.length):b.drawElementsType(0,0,6*this.Rh.length);return this.Rh.length}render(){if(!this.isReady()||!this.Rh.length)return 0;const a=this._engine;a.setState&&(a.setState(!1),this.forceDepthWrite&&a.setDepthWrite(!0));let O=0;return O=this.blendMode===k.BLENDMODE_MULTIPLYADD?this._render(k.BLENDMODE_MULTIPLY)+this._render(k.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),O}_onDispose(){}dispose(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),a&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),a&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(O,i),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const a=this._scene.Eh.indexOf(this);a>-1&&this._scene.Eh.splice(a,1),this._scene._activeParticleSystems.dispose()}this.Pb.notifyObservers(this),this.Pb.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}va.ForceGLSL=!1;var Xa,pa=i(12225);!function(a){a[a.ATTACHED=0]="ATTACHED",a[a.END=1]="END"}(Xa||(Xa={}));class oa{constructor(a){if(this.particleSystem=a,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!a.HO||!a.HO.dispose){const O=(0,Q.e)("BABYLON.AbstractMesh");a.HO=new O("SubemitterSystemEmitter",a.Ua()),a._disposeEmitterOnDispose=!0}}clone(){let a=this.particleSystem.HO;if(a){if(a instanceof H.ZO)a=a.clone();else if(-1!==a.getClassName().indexOf("Mesh")){a=new((0,Q.e)("BABYLON.Mesh"))("",a.Ua()),a.isVisible=!1}}else a=new H.ZO;const O=new oa(this.particleSystem.clone(this.particleSystem.name,a));return O.particleSystem.name+="Clone",O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem._disposeEmitterOnDispose=!0,O.particleSystem.disposeOnStop=!0,O}serialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem=this.particleSystem.serialize(a),O}static _ParseParticleSystem(a,O,i){throw(0,pa.e)("ParseParticle")}static Parse(a,O,i){const H=a.particleSystem,b=new oa(oa._ParseParticleSystem(H,O,i,!0));return b.type=a.type,b.inheritDirection=a.inheritDirection,b.inheritedVelocityAmount=a.inheritedVelocityAmount,b.particleSystem._isSubEmitter=!0,b}dispose(){this.particleSystem.dispose()}}var da=i(12273);function Ya(a,O){const i=new J;return i.direction1=a,i.direction2=O,i}function La(){return new r(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function sa(){return new ma(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ta(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new H.ZO(0,1,0),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.ZO(0,1,0);return new M(a,O,i)}function Va(){return new Z(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function aO(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.ZO(0,1,0),G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new H.ZO(0,1,0);return new F(a,O,i,b,G)}function OO(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new h(a,O)}function iO(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.ZO(0,1,0),b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.ZO(0,1,0);return new j(a,O,i,b)}const HO=H.ZO.Zero(),bO=H.ZO.Zero(),GO=H.ZO.Zero();class qO{constructor(){this.strength=0,this.position=H.ZO.Zero()}_processParticle(a,O){this.position.subtractToRef(a.position,HO);const i=HO.lengthSquared()+1;HO.normalize().scaleToRef(this.strength/i,bO),bO.scaleToRef(O._tempScaledUpdateSpeed,GO),a.direction.addInPlace(GO)}serialize(){return{position:this.position.Cb(),strength:this.strength}}}class QO extends va{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=a=>{if(!this._subEmitters||0===this._subEmitters.length)return;const O=Math.floor(Math.random()*this._subEmitters.length);for(const i of this._subEmitters[O])if(1===i.type){const O=i.clone();a._inheritParticleInfoToSubEmitter(O),O.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(O.particleSystem),O.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(a,O){const i=Ya(a,O);return this.particleEmitterType=i,i}get flowMap(){return this._flowMap}set flowMap(a){this._flowMap!==a&&(this._flowMap=a,this._flowMapUpdate&&(Na(this._flowMapUpdate),this._flowMapUpdate=null),a&&(this._flowMapUpdate={process:a=>{var O;const i=null===(O=this.Ua())||void 0===O?void 0:O.getTransformMatrix();this._flowMap._processParticle(a,this.flowMapStrength*this._tempScaledUpdateSpeed,i)},previousItem:null,nextItem:null},xa(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(a){this._attractors.push(a),1===this._attractors.length&&(this._attractorUpdate={process:a=>{for(const O of this._attractors)O._processParticle(a,this)},previousItem:null,nextItem:null},xa(this._attractorUpdate,this._directionProcessing))}removeAttractor(a){const O=this._attractors.indexOf(a);-1!==O&&this._attractors.splice(O,1),0===this._attractors.length&&Na(this._attractorUpdate)}start(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(a)}createHemisphericEmitter(){const a=La(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=a,a}createSphereEmitter(){const a=sa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=a,a}createDirectedSphereEmitter(){const a=ta(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new H.ZO(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.ZO(0,1,0));return this.particleEmitterType=a,a}createCylinderEmitter(){const a=Va(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=a,a}createDirectedCylinderEmitter(){const a=aO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.ZO(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new H.ZO(0,1,0));return this.particleEmitterType=a,a}createConeEmitter(){const a=OO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=a,a}createDirectedConeEmitter(){const a=iO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.ZO(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.ZO(0,1,0));return this.particleEmitterType=a,a}createBoxEmitter(a,O,i,H){const b=new e;return this.particleEmitterType=b,this.direction1=a,this.direction2=O,this.minEmitBox=i,this.maxEmitBox=H,b}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const a of this.subEmitters)a instanceof QO?this._subEmitters.push([new oa(a)]):a instanceof oa?this._subEmitters.push([a]):a instanceof Array&&this._subEmitters.push(a)}_stopSubEmitters(){if(this.activeSubSystems){for(const a of this.activeSubSystems)a.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const a=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==a&&this._rootParticleSystem.activeSubSystems.splice(a,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(a){a&&this._stopSubEmitters()}_prepareParticle(a){if(this._subEmitters&&this._subEmitters.length>0){const O=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];a._attachedSubEmitters=[];for(const i of O)if(0===i.type){const O=i.clone();a._attachedSubEmitters.push(O),O.particleSystem.start()}}}_onDispose(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),a&&this.particles)for(const i of this.particles)if(i._attachedSubEmitters)for(let a=i._attachedSubEmitters.length-1;a>=0;a-=1)i._attachedSubEmitters[a].dispose();if(O&&this.activeSubSystems)for(let i=this.activeSubSystems.length-1;i>=0;i-=1)this.activeSubSystems[i].dispose();if(this._subEmitters&&this._subEmitters.length){for(let a=0;a<this._subEmitters.length;a++)for(const O of this._subEmitters[a])O.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.HO&&this.HO.dispose&&this.HO.dispose(!0)}static _Parse(a,O,i,b){let G;G=i instanceof da.c?null:i;const k=(0,Q.e)("BABYLON.Texture");if(k&&G&&(a.texture?O.particleTexture=k.Parse(a.texture,G,b):a.textureName&&(O.particleTexture=new k(b+a.textureName,G,!1,void 0===a.invertY||a.invertY),O.particleTexture.name=a.textureName)),a.emitterId||0===a.emitterId||void 0!==a.HO?a.emitterId&&G?O.HO=G.getLastMeshById(a.emitterId):O.HO=H.ZO.MO(a.HO):O.HO=H.ZO.Zero(),O.isLocal=!!a.isLocal,void 0!==a.renderingGroupId&&(O.renderingGroupId=a.renderingGroupId),void 0!==a.isBillboardBased&&(O.isBillboardBased=a.isBillboardBased),void 0!==a.billboardMode&&(O.billboardMode=a.billboardMode),void 0!==a.useLogarithmicDepth&&(O.useLogarithmicDepth=a.useLogarithmicDepth),a.animations){for(let i=0;i<a.animations.length;i++){const H=a.animations[i],b=(0,Q.e)("BABYLON.Animation");b&&O.animations.push(b.Parse(H))}O.beginAnimationOnStart=a.beginAnimationOnStart,O.beginAnimationFrom=a.beginAnimationFrom,O.beginAnimationTo=a.beginAnimationTo,O.beginAnimationLoop=a.beginAnimationLoop}if(a.autoAnimate&&G&&G.beginAnimation(O,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),O.startDelay=0|a.startDelay,O.minAngularSpeed=a.minAngularSpeed,O.maxAngularSpeed=a.maxAngularSpeed,O.minSize=a.minSize,O.maxSize=a.maxSize,a.minScaleX&&(O.minScaleX=a.minScaleX,O.maxScaleX=a.maxScaleX,O.minScaleY=a.minScaleY,O.maxScaleY=a.maxScaleY),void 0!==a.preWarmCycles&&(O.preWarmCycles=a.preWarmCycles,O.preWarmStepOffset=a.preWarmStepOffset),void 0!==a.minInitialRotation&&(O.minInitialRotation=a.minInitialRotation,O.maxInitialRotation=a.maxInitialRotation),O.minLifeTime=a.minLifeTime,O.maxLifeTime=a.maxLifeTime,O.minEmitPower=a.minEmitPower,O.maxEmitPower=a.maxEmitPower,O.emitRate=a.emitRate,O.gravity=H.ZO.MO(a.gravity),a.noiseStrength&&(O.noiseStrength=H.ZO.MO(a.noiseStrength)),O.color1=q.Ab.MO(a.color1),O.color2=q.Ab.MO(a.color2),O.colorDead=q.Ab.MO(a.colorDead),O.updateSpeed=a.updateSpeed,O.targetStopDuration=a.targetStopDuration,O.blendMode=a.blendMode,a.colorGradients)for(const H of a.colorGradients)O.addColorGradient(H.gradient,q.Ab.MO(H.color1),H.color2?q.Ab.MO(H.color2):void 0);if(a.rampGradients){for(const i of a.rampGradients)O.addRampGradient(i.gradient,q.mi.MO(i.color));O.useRampGradients=a.useRampGradients}if(a.colorRemapGradients)for(const H of a.colorRemapGradients)O.addColorRemapGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(a.alphaRemapGradients)for(const H of a.alphaRemapGradients)O.addAlphaRemapGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(a.sizeGradients)for(const H of a.sizeGradients)O.addSizeGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(a.angularSpeedGradients)for(const H of a.angularSpeedGradients)O.addAngularSpeedGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(a.velocityGradients)for(const H of a.velocityGradients)O.addVelocityGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(a.dragGradients)for(const H of a.dragGradients)O.addDragGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(a.emitRateGradients)for(const H of a.emitRateGradients)O.addEmitRateGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(a.startSizeGradients)for(const H of a.startSizeGradients)O.addStartSizeGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(a.lifeTimeGradients)for(const H of a.lifeTimeGradients)O.addLifeTimeGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(a.limitVelocityGradients){for(const i of a.limitVelocityGradients)O.addLimitVelocityGradient(i.gradient,void 0!==i.factor1?i.factor1:i.factor,i.factor2);O.limitVelocityDamping=a.limitVelocityDamping}if(a.noiseTexture&&G){const i=(0,Q.e)("BABYLON.ProceduralTexture");O.noiseTexture=i.Parse(a.noiseTexture,G,b)}let I;if(a.particleEmitterType){switch(a.particleEmitterType.type){case"SphereParticleEmitter":I=new ma;break;case"SphereDirectedParticleEmitter":I=new M;break;case"ConeEmitter":case"ConeParticleEmitter":I=new h;break;case"ConeDirectedParticleEmitter":I=new j;break;case"CylinderParticleEmitter":I=new Z;break;case"CylinderDirectedParticleEmitter":I=new F;break;case"HemisphericParticleEmitter":I=new r;break;case"PointParticleEmitter":I=new J;break;case"MeshParticleEmitter":I=new D;break;case"CustomParticleEmitter":I=new C;break;default:I=new e}I.parse(a.particleEmitterType,G)}else I=new e,I.parse(a,G);O.particleEmitterType=I,O.startSpriteCellID=a.startSpriteCellID,O.endSpriteCellID=a.endSpriteCellID,O.spriteCellLoop=a.spriteCellLoop??!0,O.spriteCellWidth=a.spriteCellWidth,O.spriteCellHeight=a.spriteCellHeight,O.spriteCellChangeSpeed=a.spriteCellChangeSpeed,O.spriteRandomStartCell=a.spriteRandomStartCell,O.disposeOnStop=a.disposeOnStop??!1,O.manualEmitCount=a.manualEmitCount??-1}static Parse(a,O,i){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4?arguments[4]:void 0;const Q=a.name;let k,I,P=null,e=null;if(O instanceof da.c?k=O:(I=O,k=I.getEngine()),a.customShader&&k.createEffectForParticles){e=a.customShader;const O=e.shaderOptions.defines.length>0?e.shaderOptions.defines.join("\n"):"";P=k.createEffectForParticles(e.shaderPath.fragmentElement,e.shaderOptions.uniforms,e.shaderOptions.samplers,O)}const h=new QO(Q,G||a.Zi,O,P,a.isAnimationSheetEnabled);if(h.customShader=e,h._rootUrl=i,a.id&&(h.id=a.id),a.subEmitters){h.subEmitters=[];for(const H of a.subEmitters){const a=[];for(const b of H)a.push(oa.Parse(b,O,i));h.subEmitters.push(a)}}if(a.attractors)for(const q of a.attractors){const a=new qO;a.position=H.ZO.MO(q.position),a.strength=q.strength,h.addAttractor(a)}return QO._Parse(a,h,O,i),a.textureMask&&(h.textureMask=q.Ab.MO(a.textureMask)),a.wI&&(h.wI=H.ZO.MO(a.wI)),a.preventAutoStart&&(h.preventAutoStart=a.preventAutoStart),b||h.preventAutoStart||h.start(),h}serialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};if(QO._Serialize(O,this,a),O.textureMask=this.textureMask.Cb(),O.customShader=this.customShader,O.preventAutoStart=this.preventAutoStart,O.wI=this.wI.Cb(),this.subEmitters){O.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const i of this._subEmitters){const H=[];for(const O of i)H.push(O.serialize(a));O.subEmitters.push(H)}}if(this._attractors&&this._attractors.length){O.attractors=[];for(const a of this._attractors)O.attractors.push(a.serialize())}return O}static _Serialize(a,O,i){if(a.name=O.name,a.id=O.id,a.Zi=O.getCapacity(),a.disposeOnStop=O.disposeOnStop,a.manualEmitCount=O.manualEmitCount,O.HO.position){const i=O.HO;a.emitterId=i.id}else{const i=O.HO;a.HO=i.Cb()}O.particleEmitterType&&(a.particleEmitterType=O.particleEmitterType.serialize()),O.particleTexture&&(i?a.texture=O.particleTexture.serialize():(a.textureName=O.particleTexture.name,a.invertY=!!O.particleTexture._invertY)),a.isLocal=O.isLocal,E.d.AppendSerializedAnimations(O,a),a.beginAnimationOnStart=O.beginAnimationOnStart,a.beginAnimationFrom=O.beginAnimationFrom,a.beginAnimationTo=O.beginAnimationTo,a.beginAnimationLoop=O.beginAnimationLoop,a.startDelay=O.startDelay,a.renderingGroupId=O.renderingGroupId,a.isBillboardBased=O.isBillboardBased,a.billboardMode=O.billboardMode,a.minAngularSpeed=O.minAngularSpeed,a.maxAngularSpeed=O.maxAngularSpeed,a.minSize=O.minSize,a.maxSize=O.maxSize,a.minScaleX=O.minScaleX,a.maxScaleX=O.maxScaleX,a.minScaleY=O.minScaleY,a.maxScaleY=O.maxScaleY,a.minEmitPower=O.minEmitPower,a.maxEmitPower=O.maxEmitPower,a.minLifeTime=O.minLifeTime,a.maxLifeTime=O.maxLifeTime,a.emitRate=O.emitRate,a.gravity=O.gravity.Cb(),a.noiseStrength=O.noiseStrength.Cb(),a.color1=O.color1.Cb(),a.color2=O.color2.Cb(),a.colorDead=O.colorDead.Cb(),a.updateSpeed=O.updateSpeed,a.targetStopDuration=O.targetStopDuration,a.blendMode=O.blendMode,a.preWarmCycles=O.preWarmCycles,a.preWarmStepOffset=O.preWarmStepOffset,a.minInitialRotation=O.minInitialRotation,a.maxInitialRotation=O.maxInitialRotation,a.startSpriteCellID=O.startSpriteCellID,a.spriteCellLoop=O.spriteCellLoop,a.endSpriteCellID=O.endSpriteCellID,a.spriteCellChangeSpeed=O.spriteCellChangeSpeed,a.spriteCellWidth=O.spriteCellWidth,a.spriteCellHeight=O.spriteCellHeight,a.spriteRandomStartCell=O.spriteRandomStartCell,a.isAnimationSheetEnabled=O.isAnimationSheetEnabled,a.useLogarithmicDepth=O.useLogarithmicDepth;const H=O.getColorGradients();if(H){a.colorGradients=[];for(const O of H){const i={gradient:O.gradient,color1:O.color1.Cb()};O.color2?i.color2=O.color2.Cb():i.color2=O.color1.Cb(),a.colorGradients.push(i)}}const b=O.getRampGradients();if(b){a.rampGradients=[];for(const O of b){const i={gradient:O.gradient,color:O.color.Cb()};a.rampGradients.push(i)}a.useRampGradients=O.useRampGradients}const G=O.getColorRemapGradients();if(G){a.colorRemapGradients=[];for(const O of G){const i={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?i.factor2=O.factor2:i.factor2=O.factor1,a.colorRemapGradients.push(i)}}const q=O.getAlphaRemapGradients();if(q){a.alphaRemapGradients=[];for(const O of q){const i={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?i.factor2=O.factor2:i.factor2=O.factor1,a.alphaRemapGradients.push(i)}}const Q=O.getSizeGradients();if(Q){a.sizeGradients=[];for(const O of Q){const i={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?i.factor2=O.factor2:i.factor2=O.factor1,a.sizeGradients.push(i)}}const k=O.getAngularSpeedGradients();if(k){a.angularSpeedGradients=[];for(const O of k){const i={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?i.factor2=O.factor2:i.factor2=O.factor1,a.angularSpeedGradients.push(i)}}const I=O.getVelocityGradients();if(I){a.velocityGradients=[];for(const O of I){const i={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?i.factor2=O.factor2:i.factor2=O.factor1,a.velocityGradients.push(i)}}const P=O.getDragGradients();if(P){a.dragGradients=[];for(const O of P){const i={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?i.factor2=O.factor2:i.factor2=O.factor1,a.dragGradients.push(i)}}const e=O.getEmitRateGradients();if(e){a.emitRateGradients=[];for(const O of e){const i={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?i.factor2=O.factor2:i.factor2=O.factor1,a.emitRateGradients.push(i)}}const h=O.getStartSizeGradients();if(h){a.startSizeGradients=[];for(const O of h){const i={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?i.factor2=O.factor2:i.factor2=O.factor1,a.startSizeGradients.push(i)}}const j=O.getLifeTimeGradients();if(j){a.lifeTimeGradients=[];for(const O of j){const i={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?i.factor2=O.factor2:i.factor2=O.factor1,a.lifeTimeGradients.push(i)}}const Z=O.getLimitVelocityGradients();if(Z){a.limitVelocityGradients=[];for(const O of Z){const i={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?i.factor2=O.factor2:i.factor2=O.factor1,a.limitVelocityGradients.push(i)}a.limitVelocityDamping=O.limitVelocityDamping}O.noiseTexture&&(a.noiseTexture=O.noiseTexture.serialize())}clone(a,O){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H={...this._customWrappers};let b=null;const G=this._engine;if(G.createEffectForParticles&&null!=this.customShader){b=this.customShader;const a=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"",O=G.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,a);H[0]?H[0].effect=O:this.setCustomEffect(O,0)}const q=this.serialize(i),Q=QO.Parse(q,this._scene||this._engine,this._rootUrl);return Q.name=a,Q.customShader=b,Q._customWrappers=H,void 0===O&&(O=this.HO),this.noiseTexture&&(Q.noiseTexture=this.noiseTexture.clone()),Q.HO=O,this.preventAutoStart||Q.start(),Q}}QO.BILLBOARDMODE_Y=2,QO.BILLBOARDMODE_ALL=7,QO.BILLBOARDMODE_STRETCHED=8,QO.BILLBOARDMODE_STRETCHED_LOCAL=9,oa._ParseParticleSystem=QO.Parse;var kO=i(12654),IO=i(12648),PO=i(12528);PO.b.prototype.createTransformFeedback=function(){const a=this._gl.createTransformFeedback();if(!a)throw new Error("Unable to create Transform Feedback");return a},PO.b.prototype.deleteTransformFeedback=function(a){this._gl.deleteTransformFeedback(a)},PO.b.prototype.bindTransformFeedback=function(a){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,a)},PO.b.prototype.beginTransformFeedback=function(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(a?this._gl.POINTS:this._gl.TRIANGLES)},PO.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},PO.b.prototype.setTranformFeedbackVaryings=function(a,O){this._gl.transformFeedbackVaryings(a,O,this._gl.INTERLEAVED_ATTRIBS)},PO.b.prototype.bindTransformFeedbackBuffer=function(a){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,a?a.underlyingResource:null)},PO.b.prototype.readTransformFeedbackBuffer=function(a){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,a)};const eO="clipPlaneFragmentDeclaration2",hO="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";y.c.IncludesShadersStore[eO]||(y.c.IncludesShadersStore[eO]=hO);i(13713),i(13719),i(13724),i(13727),i(13732),i(13739),i(13742),i(13751);const jO="gpuRenderParticlesPixelShader",ZO="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";y.c.ShadersStore[jO]||(y.c.ShadersStore[jO]=ZO);const FO="clipPlaneVertexDeclaration2",rO="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";y.c.IncludesShadersStore[FO]||(y.c.IncludesShadersStore[FO]=rO);i(13760),i(13766),i(13769),i(13778);const JO="gpuRenderParticlesVertexShader",mi="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";y.c.ShadersStore[JO]||(y.c.ShadersStore[JO]=mi);class MO extends k{static get IsSupported(){if(!t.b.LastCreatedEngine)return!1;const a=t.b.LastCreatedEngine.getCaps();return a.supportTransformFeedbacks||a.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(a){this._maxActiveParticleCount=Math.min(a,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(a){this.maxActiveParticleCount=a}createPointEmitter(a,O){const i=Ya(a,O);return this.particleEmitterType=i,i}createHemisphericEmitter(){const a=La(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=a,a}createSphereEmitter(){const a=sa(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=a,a}createDirectedSphereEmitter(){const a=ta(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new H.ZO(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.ZO(0,1,0));return this.particleEmitterType=a,a}createCylinderEmitter(){const a=Va(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=a,a}createDirectedCylinderEmitter(){const a=aO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.ZO(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new H.ZO(0,1,0));return this.particleEmitterType=a,a}createConeEmitter(){const a=OO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=a,a}createDirectedConeEmitter(){const a=iO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.ZO(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.ZO(0,1,0));return this.particleEmitterType=a,a}createBoxEmitter(a,O,i,H){const b=new e;return this.particleEmitterType=b,this.direction1=a,this.direction2=O,this.minEmitBox=i,this.maxEmitBox=H,b}get flowMap(){return this._flowMap}set flowMap(a){this._flowMap!==a&&(this._flowMap=a)}isReady(){if(!this.HO||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==QO.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(QO.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(QO.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";a?setTimeout((()=>{this.start(0)}),a):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var a;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(a=this._customWrappers[O])||void 0===a?void 0:a.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[a]??this._customWrappers[0]}setCustomEffect(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new aa.e(this._engine),this._customWrappers[O].effect=a}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new L.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(a,O,i){return super._removeGradientAndTexture(a,O,i),this._releaseBuffers(),this}addColorGradient(a,O){this._colorGradients||(this._colorGradients=[]);const i=new p(a,O);return this._colorGradients.push(i),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(a&&this._colorGradients.sort(((a,O)=>a.gradient<O.gradient?-1:a.gradient>O.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(a){return this._removeGradientAndTexture(a,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const O in this._drawWrappers){var a;null===(a=this._drawWrappers[O].drawContext)||void 0===a||a.reset()}}_addFactorGradient(a,O,i){const H=new d(O,i);a.push(H),this._releaseBuffers()}addSizeGradient(a,O){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,a,O),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(a){return this._removeGradientAndTexture(a,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(a,O){if(!a)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&a.sort(((a,O)=>a.gradient<O.gradient?-1:a.gradient>O.gradient?1:0));const i=this;i[O]&&(i[O].dispose(),i[O]=null)}addAngularSpeedGradient(a,O){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,a,O),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(a){return this._removeGradientAndTexture(a,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(a,O){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,a,O),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(a){return this._removeGradientAndTexture(a,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(a,O){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,a,O),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(a){return this._removeGradientAndTexture(a,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(a,O){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,a,O),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(a){return this._removeGradientAndTexture(a,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(a){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(a,O,i){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(a),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Pb=new L.e,this.onStoppedObservable=new L.e,this.onStartedObservable=new L.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,i&&"Scene"!==i.getClassName()?(this._engine=i,this.defaultProjectionMatrix=H.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=i||t.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Eh.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,Q.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,Q.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,Q.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,Q.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new aa.e(this._engine)},this._customWrappers[0].effect=b,this._drawWrappers={0:new aa.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(O=O??{}).randomTextureSize||delete O.randomTextureSize;const q={Zi:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...O},k=O;isFinite(k)&&(q.Zi=k),this._capacity=q.Zi,this._maxActiveParticleCount=q.Zi,this._currentActiveCount=0,this._isAnimationSheetEnabled=G,this.particleEmitterType=new e;const I=Math.min(this._engine.getCaps().maxTextureSize,q.randomTextureSize);let P=[];for(let H=0;H<I;++H)P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),P.push(Math.random());this._randomTexture=new s.d(new Float32Array(P),I,1,5,i,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,P=[];for(let H=0;H<I;++H)P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),P.push(Math.random());this._randomTexture2=new s.d(new Float32Array(P),I,1,5,i,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=I}_reset(){this._releaseBuffers()}_createVertexBuffers(a,O,i){const H={};H.position=O.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let b=3;H.age=O.createVertexBuffer("age",b,1,this._attributesStrideSize,!0),b+=1,H.size=O.createVertexBuffer("size",b,3,this._attributesStrideSize,!0),b+=3,H.life=O.createVertexBuffer("life",b,1,this._attributesStrideSize,!0),b+=1,b+=4,this.billboardMode===QO.BILLBOARDMODE_STRETCHED&&(H.direction=O.createVertexBuffer("direction",b,3,this._attributesStrideSize,!0)),b+=3,this._platform.alignDataInBuffer&&(b+=1),this.particleEmitterType instanceof C&&(b+=3,this._platform.alignDataInBuffer&&(b+=1)),this._colorGradientsTexture||(H.color=O.createVertexBuffer("color",b,4,this._attributesStrideSize,!0),b+=4),this._isBillboardBased||(H.initialDirection=O.createVertexBuffer("initialDirection",b,3,this._attributesStrideSize,!0),b+=3,this._platform.alignDataInBuffer&&(b+=1)),this.noiseTexture&&(H.noiseCoordinates1=O.createVertexBuffer("noiseCoordinates1",b,3,this._attributesStrideSize,!0),b+=3,this._platform.alignDataInBuffer&&(b+=1),H.noiseCoordinates2=O.createVertexBuffer("noiseCoordinates2",b,3,this._attributesStrideSize,!0),b+=3,this._platform.alignDataInBuffer&&(b+=1)),H.angle=O.createVertexBuffer("angle",b,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?b++:b+=2,this._isAnimationSheetEnabled&&(H.cellIndex=O.createVertexBuffer("cellIndex",b,1,this._attributesStrideSize,!0),b+=1,this.spriteRandomStartCell&&(H.cellStartOffset=O.createVertexBuffer("cellStartOffset",b,1,this._attributesStrideSize,!0),b+=1)),H.offset=i.createVertexBuffer("offset",0,2),H.uv=i.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(H),this._platform.createVertexBuffers(a,H),this.resetDrawCache()}_initialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!a)return;const O=this._engine,i=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof C&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const b=this.particleEmitterType instanceof C,G=H.TmpVectors.ZO[0];let q=0;for(let H=0;H<this._capacity;H++)if(i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(0),i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),b?(this.particleEmitterType.particleDestinationGenerator(H,null,G),i.push(G.x),i.push(G.y),i.push(G.z)):(i.push(0),i.push(0),i.push(0)),this._platform.alignDataInBuffer&&i.push(0),q+=16,b&&(this.particleEmitterType.particlePositionGenerator(H,null,G),i.push(G.x),i.push(G.y),i.push(G.z),this._platform.alignDataInBuffer&&i.push(0),q+=4),this._colorGradientsTexture||(i.push(0),i.push(0),i.push(0),i.push(0),q+=4),this.isBillboardBased||(i.push(0),i.push(0),i.push(0),this._platform.alignDataInBuffer&&i.push(0),q+=4),this.noiseTexture&&(i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),this._platform.alignDataInBuffer&&i.push(0),i.push(Math.random()),i.push(Math.random()),i.push(Math.random()),this._platform.alignDataInBuffer&&i.push(0),q+=8),i.push(0),q+=1,this._angularSpeedGradientsTexture||(i.push(0),q+=1),this._isAnimationSheetEnabled&&(i.push(0),q+=1,this.spriteRandomStartCell&&(i.push(0),q+=1)),this._platform.alignDataInBuffer){let a=3-(q+3&3);for(q+=a;a-- >0;)i.push(0)}const Q=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),k=this._platform.createParticleBuffer(i),I=this._platform.createParticleBuffer(i);this._buffer0=new n.b(O,k,!1,this._attributesStrideSize),this._buffer1=new n.b(O,I,!1,this._attributesStrideSize),this._spriteBuffer=new n.b(O,Q,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let a=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(a+="\n#define BILLBOARD"),this._colorGradientsTexture&&(a+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(a+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(a+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(a+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(a+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(a+="\n#define DRAGGRADIENTS"),this._flowMap&&(a+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(a+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(a+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(a+="\n#define NOISE"),this.isLocal&&(a+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===a||(this._cachedUpdateDefines=a,this._updateBuffer=this._platform.createUpdateBuffer(a)),this._platform.isUpdateBufferReady()}_getWrapper(a){const O=this._getCustomDrawWrapper(a);if(null!==O&&void 0!==O&&O.effect)return O;const i=[];this.fillDefines(i,a);let H=this._drawWrappers[a];H||(H=new aa.e(this._engine),H.drawContext&&(H.drawContext.useInstancing=!0),this._drawWrappers[a]=H);const b=i.join("\n");if(H.defines!==b){const a=[],O=[],i=[];this.fillUniformsAttributesAndSamplerNames(O,a,i),H.setEffect(this._engine.createEffect("gpuRenderParticles",a,O,i,b),b)}return H}static _GetAttributeNamesOrOptions(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const b=[n.c.PositionKind,"age","life","size","angle"];return a||b.push(n.c.ColorKind),O&&b.push("cellIndex"),i||b.push("initialDirection"),H&&b.push("direction"),b.push("offset",n.c.UVKind),b}static _GetEffectCreationOptions(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H=["emitterWM","wI","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Oa.d)(H),a&&H.push("sheetInfos"),O&&H.push("logarithmicDepthConstant"),i&&(H.push("vFogInfos"),H.push("vFogColor")),H}fillDefines(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Oa.h)(this,this._scene,a),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==IO.c.FOGMODE_NONE&&a.push("#define FOG")),O===QO.BLENDMODE_MULTIPLY&&a.push("#define BLENDMULTIPLYMODE"),this.isLocal&&a.push("#define LOCAL"),this.useLogarithmicDepth&&a.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(a.push("#define BILLBOARD"),this.billboardMode){case QO.BILLBOARDMODE_Y:a.push("#define BILLBOARDY");break;case QO.BILLBOARDMODE_STRETCHED:a.push("#define BILLBOARDSTRETCHED");break;case QO.BILLBOARDMODE_ALL:a.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&a.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&a.push("#define ANIMATESHEET"),i&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),a.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(a,O,i){O.push(...MO._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===QO.BILLBOARDMODE_STRETCHED)),a.push(...MO._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),i.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(kO.b.PrepareUniforms(a,this._imageProcessingConfigurationDefines),kO.b.PrepareSamplers(i,this._imageProcessingConfigurationDefines))}animate(){var a;let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(O?this.preWarmStepOffset:(null===(a=this._scene)||void 0===a?void 0:a.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(a,O){const i=this[O];if(!a||!a.length||i)return;const H=new Float32Array(this._rawTextureWidth);for(let b=0;b<this._rawTextureWidth;b++){const O=b/this._rawTextureWidth;Y.GetCurrentGradient(O,a,((a,O,i)=>{H[b]=(0,I.Lerp)(a.factor1,O.factor1,i)}))}this[O]=s.d.CreateRTexture(H,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[O].name=O.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const a=new Uint8Array(4*this._rawTextureWidth),O=q.TmpColors.Ab[0];for(let i=0;i<this._rawTextureWidth;i++){const H=i/this._rawTextureWidth;Y.GetCurrentGradient(H,this._colorGradients,((H,b,G)=>{q.Ab.LerpToRef(H.color1,b.color1,G,O),a[4*i]=255*O.r,a[4*i+1]=255*O.g,a[4*i+2]=255*O.b,a[4*i+3]=255*O.a}))}this._colorGradientsTexture=s.d.CreateRGBATexture(a,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(a,O){var i,b,G,q;const Q=this._getWrapper(a),k=Q.effect;this._engine.enableEffect(Q);const I=(null===(i=this._scene)||void 0===i?void 0:i.getViewMatrix())||H.Matrix.IdentityReadOnly;if(k.setMatrix("view",I),k.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),k.setTexture("diffuseSampler",this.particleTexture),k.setVector2("translationPivot",this.translationPivot),k.setVector3("wI",this.wI),this.isLocal&&k.setMatrix("emitterWM",O),this._colorGradientsTexture?k.setTexture("colorGradientSampler",this._colorGradientsTexture):k.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const a=this.particleTexture.getBaseSize();k.setFloat3("sheetInfos",this.spriteCellWidth/a.width,this.spriteCellHeight/a.height,a.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const a=this._scene.activeCamera;k.setVector3("eyePosition",a.globalPosition)}const P=k.defines;if(this._scene&&((0,Oa.f)(k,this,this._scene),this.applyFog&&(0,ia.d)(this._scene,void 0,k)),P.indexOf("#define BILLBOARDMODE_ALL")>=0){const a=I.clone();a.invert(),k.setMatrix("invView",a)}return this.useLogarithmicDepth&&this._scene&&(0,ia.h)(P,k,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(k),this._setEngineBasedOnBlendMode(a),this._platform.bindDrawBuffers(this._targetIndex,k,null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(k),null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(q=this._scene)&&void 0!==q&&q.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(a){if(!this.HO||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!a)if(this.HO.position){a=this.HO.getWorldMatrix()}else{const O=this.HO;a=H.TmpVectors.Matrix[0],H.Matrix.TranslationToRef(O.x,O.y,O.z,a)}const O=this._engine,i=O.getDepthWrite();if(O.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const a=this.Ua();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",a.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",a),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const b=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=b,O.setDepthWrite(i)}render(){let a,O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!O&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let a=0;a<this.preWarmCycles;a++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const a=0|this._accumulatedCount;this._accumulatedCount-=a,this._currentActiveCount+=a}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.HO.position){a=this.HO.getWorldMatrix()}else{const O=this.HO;a=H.TmpVectors.Matrix[0],H.Matrix.TranslationToRef(O.x,O.y,O.z,a)}const b=this._engine;this.updateInAnimate||this._update(a);let G=0;return O||i||(b.setState(!1),this.forceDepthWrite&&b.setDepthWrite(!0),G=this.blendMode===QO.BLENDMODE_MULTIPLYADD?this._render(QO.BLENDMODE_MULTIPLY,a)+this._render(QO.BLENDMODE_ADD,a):this._render(this.blendMode,a),this._engine.setAlphaMode(0)),G}rebuild(){const a=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(a,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,a()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const O in this._drawWrappers){this._drawWrappers[O].dispose()}if(this._drawWrappers={},this._scene){const a=this._scene.Eh.indexOf(this);a>-1&&this._scene.Eh.splice(a,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let O=0;O<this._renderVertexBuffers.length;++O){const a=this._renderVertexBuffers[O];for(const O in a)a[O].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),a&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),a&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Pb.notifyObservers(this),this.Pb.clear()}clone(a,O){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H={...this._customWrappers};let b=null;const G=this._engine;if(G.createEffectForParticles&&null!=this.customShader){b=this.customShader;const a=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"";H[0]=G.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,a,void 0,void 0,void 0,this)}const q=this.serialize(i),Q=MO.Parse(q,this._scene||this._engine,this._rootUrl);return Q.name=a,Q.customShader=b,Q._customWrappers=H,void 0===O&&(O=this.HO),this.noiseTexture&&(Q.noiseTexture=this.noiseTexture.clone()),Q.HO=O,Q}serialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return QO._Serialize(O,this,a),O.activeParticleCount=this.activeParticleCount,O.randomTextureSize=this._randomTextureSize,O.customShader=this.customShader,O}static Parse(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4?arguments[4]:void 0;const G=a.name;let q,Q;O instanceof da.c?q=O:(Q=O,q=Q.getEngine());const k=new MO(G,{Zi:b||a.Zi,randomTextureSize:a.randomTextureSize},O,null,a.isAnimationSheetEnabled);if(k._rootUrl=i,a.customShader&&q.createEffectForParticles){const O=a.customShader,i=O.shaderOptions.defines.length>0?O.shaderOptions.defines.join("\n"):"",H=q.createEffectForParticles(O.shaderPath.fragmentElement,O.shaderOptions.uniforms,O.shaderOptions.samplers,i,void 0,void 0,void 0,k);k.setCustomEffect(H,0),k.customShader=O}return a.id&&(k.id=a.id),a.activeParticleCount&&(k.activeParticleCount=a.activeParticleCount),QO._Parse(a,k,O,i),a.preventAutoStart&&(k.preventAutoStart=a.preventAutoStart),H||k.preventAutoStart||k.start(),k}}var CO=i(12184),nO=i(13783),DO=i(12777);class UO{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(a){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const O of this.systems)O.HO=a;this._emitterNode=a}setEmitterAsSphere(a,O,i){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:a,renderingGroupId:O};const H=(0,nO.b)("emitterSphere",{diameter:a.diameter,segments:a.segments},i);H.renderingGroupId=O;const b=new DO.JO("emitterSphereMaterial",i);b.emissiveColor=a.color,H.material=b;for(const G of this.systems)G.HO=H;this._emitterNode=H}start(a){for(const O of this.systems)a&&(O.HO=a),O.start()}dispose(){for(const a of this.systems)a.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={systems:[]};for(const i of this.systems)O.systems.push(i.serialize(a));return this._emitterNode&&(O.HO=this._emitterCreationOptions),O}static Parse(a,O){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3?arguments[3]:void 0;const b=new UO,G=this.BaseAssetsUrl+"/textures/";O=O||t.b.LastCreatedScene;for(const q of a.systems)b.systems.push(i?MO.Parse(q,O,G,!0,H):QO.Parse(q,O,G,!0,H));if(a.HO){const i=a.HO.options;if("Sphere"===a.HO.kind)b.setEmitterAsSphere({diameter:i.diameter,segments:i.segments,color:q.mi.MO(i.color)},a.HO.renderingGroupId,O)}return b}}UO.BaseAssetsUrl="https://assets.babylonjs.com/particles";var yO=i(12227);class wO{static CreateDefault(a){let O,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,H=arguments.length>2?arguments[2]:void 0;O=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new MO("default system",{Zi:i},H):new QO("default system",i,H),O.HO=a;const b=CO.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return O.particleTexture=new l.e(b,O.Ua()),O.createConeEmitter(.1,Math.PI/4),O.color1=new q.Ab(1,1,1,1),O.color2=new q.Ab(1,1,1,1),O.colorDead=new q.Ab(1,1,1,0),O.minSize=.1,O.maxSize=.1,O.minEmitPower=2,O.maxEmitPower=2,O.updateSpeed=1/60,O.emitRate=30,O}static CreateAsync(a,O){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3?arguments[3]:void 0;O||(O=t.b.LastCreatedScene);const b={};return O.addPendingData(b),new Promise(((G,q)=>{if(i&&!MO.IsSupported)return O.removePendingData(b),q("Particle system with GPU is not supported.");CO.Tools.LoadFile(`${wO.BaseAssetsUrl}/systems/${a}.json`,(a=>{O.removePendingData(b);const q=JSON.parse(a.toString());return G(UO.Parse(q,O,i,H))}),void 0,void 0,void 0,(()=>(O.removePendingData(b),q(`An error occurred with the creation of your particle system. Check if your type '${a}' exists.`))))}))}static ExportSet(a){const O=new UO;for(const i of a)O.systems.push(i);return O}static ParseFromFileAsync(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",G=arguments.length>5?arguments[5]:void 0;return new Promise(((q,Q)=>{const k=new yO.e;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){const O=JSON.parse(k.responseText);let Q;Q=H?MO.Parse(O,i,b,!1,G):QO.Parse(O,i,b,!1,G),a&&(Q.name=a),q(Q)}else Q("Unable to load the particle system")})),k.open("GET",O),k.send()}))}static ParseFromSnippetAsync(a,O){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",b=arguments.length>4?arguments[4]:void 0;if("_BLANK"===a){const a=this.CreateDefault(null);return a.start(),Promise.resolve(a)}return new Promise(((G,q)=>{const Q=new yO.e;Q.addEventListener("readystatechange",(()=>{if(4==Q.readyState)if(200==Q.status){const q=JSON.parse(JSON.parse(Q.responseText).jsonPayload),k=JSON.parse(q.particleSystem);let I;I=i?MO.Parse(k,O,H,!1,b):QO.Parse(k,O,H,!1,b),I.snippetId=a,G(I)}else q("Unable to load the snippet "+a)})),Q.open("GET",this.SnippetUrl+"/"+a.replace(/#/g,"/")),Q.send()}))}}wO.BaseAssetsUrl=UO.BaseAssetsUrl,wO.SnippetUrl="https://snippet.babylonjs.com",wO.CreateFromSnippetAsync=wO.ParseFromSnippetAsync;var KO=i(12841),SO=i(12682),fO=i(13787);(0,fO.f)(SO.b.NAME_PARTICLESYSTEM,((a,O,i,H)=>{const b=(0,fO.i)(SO.b.NAME_PARTICLESYSTEM);if(b&&void 0!==a.Eh&&null!==a.Eh)for(let G=0,q=a.Eh.length;G<q;G++){const q=a.Eh[G];i.Eh.push(b(q,O,H))}})),(0,fO.e)(SO.b.NAME_PARTICLESYSTEM,((a,O,i)=>{if(a.activeParticleCount){return MO.Parse(a,O,i)}return QO.Parse(a,O,i)})),da.c.prototype.createEffectForParticles=function(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",G=arguments.length>4?arguments[4]:void 0,q=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6?arguments[6]:void 0,k=arguments.length>7?arguments[7]:void 0,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,P=arguments.length>9?arguments[9]:void 0,e=[],h=[];const j=[];return k?k.fillUniformsAttributesAndSamplerNames(h,e,j):(e=QO._GetAttributeNamesOrOptions(),h=QO._GetEffectCreationOptions()),-1===b.indexOf(" BILLBOARD")&&(b+="\n#define BILLBOARD\n"),null!==k&&void 0!==k&&k.isAnimationSheetEnabled&&-1===b.indexOf(" ANIMATESHEET")&&(b+="\n#define ANIMATESHEET\n"),-1===H.indexOf("diffuseSampler")&&H.push("diffuseSampler"),this.createEffect({vertex:P??(null===k||void 0===k?void 0:k.vertexShaderName)??"particles",fragmentElement:a},e,h.concat(O),j.concat(H),b,G,q,Q,void 0,I,(async()=>{0===I?await Promise.resolve().then(i.bind(i,13828)):await Promise.resolve().then(i.bind(i,13900))}))},KO.d.prototype.getEmittedParticleSystems=function(){const a=[];for(let O=0;O<this.Ua().Eh.length;O++){const i=this.Ua().Eh[O];i.HO===this&&a.push(i)}return a},KO.d.prototype.getHierarchyEmittedParticleSystems=function(){const a=[],O=this.getDescendants();O.push(this);for(let i=0;i<this.Ua().Eh.length;i++){const H=this.Ua().Eh[i],b=H.HO;b.position&&-1!==O.indexOf(b)&&a.push(H)}return a};i(12748),i(12760),i(12826);i(12829),i(13796),i(12602),i(12739),i(12866);i(12597);var BO;i(13800),i(12417);!function(a){a[a.Color=2]="Color",a[a.UV=1]="UV",a[a.Random=0]="Random",a[a.Stated=3]="Stated"}(BO||(BO={}));var TO=i(12638);const AO=new H.ZO(0,0,0),EO=new H.ZO(0,0,0),lO=new H.ZO(0,0,0);class WO{constructor(a,O,i){this.width=a,this.height=O,this.data=i}processFlowable(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0;if(!i)return;i instanceof H.Matrix?H.ZO.TransformCoordinatesToRef(a.position,i,lO):(lO.x=i.x,lO.y=i.y,lO.z=i.z);const b=.5*lO.x+.5,G=1-(.5*lO.y+.5),q=Math.floor(b*this.width),Q=Math.floor(G*this.height);if(q<0||q>=this.width||Q<0||Q>=this.height)return;const k=4*(Q*this.width+q),I=this.data[k]/255*2-1,P=this.data[k+1]/255*2-1,e=this.data[k+2]/255*2-1,h=this.data[k+3]/255;AO.set(I,P,e),AO.scaleToRef(O*h,EO),a.direction.addInPlace(EO)}_processParticle(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0;this.processFlowable(a,O,i)}static async FromUrlAsync(a){return await new Promise(((O,i)=>{const H=document.createElement("canvas"),b=H.getContext("2d");let G=null;const q=new Image;q.crossOrigin="anonymous",q.src=a,q.onerror=O=>{i(new Error(`Failed to load image: ${a} : ${O}`))},q.onload=()=>{H.width=q.width,H.height=q.height,b.drawImage(q,0,0),G=b.getImageData(0,0,H.width,H.height),O(new WO(H.width,H.height,G.data))}}))}static async ExtractFromTextureAsync(a){return await new Promise(((O,i)=>{if(!a.isReady())return void a.onLoadObservable.addOnce((async()=>{try{const i=await this.ExtractFromTextureAsync(a);O(i)}catch(H){i(H)}}));const H=a.getSize();TO.j.GetTextureDataAsync(a,H.width,H.height).then((a=>{O(new WO(H.width,H.height,new Uint8ClampedArray(a)))})).catch(i)}))}}var uO,cO,RO,zO,xO,gO,NO,vO,XO;!function(a){a[a.Int=1]="Int",a[a.Float=2]="Float",a[a.Vector2=4]="Vector2",a[a.ZO=8]="ZO",a[a.Matrix=16]="Matrix",a[a.Particle=32]="Particle",a[a.Texture=64]="Texture",a[a.Ab=128]="Ab",a[a.FloatGradient=256]="FloatGradient",a[a.Vector2Gradient=512]="Vector2Gradient",a[a.Vector3Gradient=1024]="Vector3Gradient",a[a.Color4Gradient=2048]="Color4Gradient",a[a.System=4096]="System",a[a.AutoDetect=8192]="AutoDetect",a[a.BasedOnInput=16384]="BasedOnInput",a[a.Undefined=32768]="Undefined",a[a.All=65535]="All"}(uO||(uO={})),function(a){a[a.Compatible=0]="Compatible",a[a.TypeIncompatible=1]="TypeIncompatible",a[a.HierarchyIssue=2]="HierarchyIssue"}(cO||(cO={})),function(a){a[a.Input=0]="Input",a[a.Output=1]="Output"}(RO||(RO={}));class pO{get direction(){return this._direction}get type(){if(this._type===uO.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===uO.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(a){this._type=a}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((a=>a.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(a,O,i){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=uO.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new L.e,this.onDisconnectionObservable=new L.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=O,this.name=a,this._direction=i}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(a){var O;return this.isConnected?null!==(O=this._connectedPoint)&&void 0!==O&&O._storedFunction?this._connectedPoint._storedFunction(a):this._connectedPoint._storedValue:this.value}canConnectTo(a){return 0===this.checkCompatibilityState(a)}checkCompatibilityState(a){const O=this._ownerBlock,i=a.ownerBlock;if(this.type!==a.type&&a.innerType!==uO.AutoDetect)return a.acceptedConnectionPointTypes&&-1!==a.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(a.excludedConnectionPointTypes&&-1!==a.excludedConnectionPointTypes.indexOf(this.type))return 1;let H=i,b=O;return 0===this.direction&&(H=O,b=i),H.isAnAncestorOf(b)?2:0}connectTo(a){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(a))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${a.ownerBlock.name}".${a.name}`;return this._endpoints.push(a),a._connectedPoint=this,this.onConnectionObservable.notifyObservers(a),a.onConnectionObservable.notifyObservers(this),this}disconnectFrom(a){const O=this._endpoints.indexOf(a);return-1===O||(this._endpoints.splice(O,1),a._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(a),a.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(a){let O=1;for(;O<uO.All;)a&O||this.excludedConnectionPointTypes.push(O),O<<=1}serialize(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const O={};return O.name=this.name,O.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Cb?(O.valueType="BABYLON."+this.value.getClassName(),O.value=this.value.Cb()):(O.valueType="number",O.value=this.value)),a&&this.connectedPoint&&(O.inputName=this.name,O.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,O.targetConnectionName=this.connectedPoint.name,O.isExposedOnFrame=!0,O.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(O.isExposedOnFrame=!0,O.exposedPortPosition=this.exposedPortPosition),O}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class oO{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(a){this._name=a}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(a){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new L.e,this.Pb=new L.e,this.onInputChangedObservable=new L.e,this.visibleOnFrame=!1,this._name=a,this.uniqueId=W.e.UniqueId}_inputRename(a){return a}_outputRename(a){return a}isAnAncestorOf(a){for(const O of this._outputs)if(O.hasEndpoints)for(const i of O.endpoints){if(i.ownerBlock===a)return!0;if(i.ownerBlock.isAnAncestorOf(a))return!0}return!1}isAnAncestorOfType(a){if(this.getClassName()===a)return!0;for(const O of this._outputs)if(O.hasEndpoints)for(const i of O.endpoints)if(i.ownerBlock.isAnAncestorOfType(a))return!0;return!1}getInputByName(a){const O=this._inputs.filter((O=>O.name===a));return O.length?O[0]:null}_linkConnectionTypes(a,O){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[O]._acceptedConnectionPointType=this._inputs[a]:(this._inputs[a]._linkedConnectionSource=this._inputs[O],this._inputs[a]._isMainLinkSource=!0),this._inputs[O]._linkedConnectionSource=this._inputs[a]}registerInput(a,O){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3?arguments[3]:void 0,b=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0;const q=new pO(a,this,0);return q.type=O,q.isOptional=i,q.defaultValue=H,q.value=H,q.valueMin=b,q.valueMax=G,this._inputs.push(q),this.onInputChangedObservable.notifyObservers(q),this}registerOutput(a,O,i){return(i=i??new pO(a,this,1)).type=O,this._outputs.push(i),this}_build(a){}_customBuildStep(a){}build(a){if(this._buildId===a.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((a=>a.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=a.buildId;for(const O of this._inputs){if(!O.connectedPoint){O.isOptional||a.notConnectedNonOptionalInputs.push(O);continue}const i=O.connectedPoint.ownerBlock;i&&i!==this&&!i.isSystem&&i.build(a)}return this._customBuildStep(a),a.verbose&&u.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(a),this.onBuildObservable.notifyObservers(this),!1}serialize(){const a={};a.customType="BABYLON."+this.getClassName(),a.id=this.uniqueId,a.name=this.name,a.visibleOnFrame=this.visibleOnFrame,a.inputs=[],a.outputs=[];for(const O of this.inputs)a.inputs.push(O.serialize());for(const O of this.outputs)a.outputs.push(O.serialize(!1));return a}_deserialize(a){this._name=a.name,this.comments=a.comments,this.visibleOnFrame=!!a.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(a)}_deserializePortDisplayNamesAndExposedOnFrame(a){const O=a.inputs,i=a.outputs;if(O)for(const H of O){const a=this.inputs.find((a=>a.name===H.name));if(!a)return;if(H.displayName&&(a.displayName=H.displayName),H.isExposedOnFrame&&(a.isExposedOnFrame=H.isExposedOnFrame,a.exposedPortPosition=H.exposedPortPosition),void 0!==H.value&&null!==H.value)if("number"===H.valueType)a.value=H.value;else{const O=(0,Q.e)(H.valueType);O&&(a.value=O.MO(H.value))}}if(i)for(let H=0;H<i.length;H++){const a=i[H];a.displayName&&(this.outputs[H].displayName=a.displayName),a.isExposedOnFrame&&(this.outputs[H].isExposedOnFrame=a.isExposedOnFrame,this.outputs[H].exposedPortPosition=a.exposedPortPosition)}}clone(){const a=this.serialize(),O=(0,Q.e)(a.customType);if(O){const i=new O;return i._deserialize(a),i}return null}dispose(){this.Pb.notifyObservers(this),this.Pb.clear();for(const a of this.inputs)a.dispose();for(const a of this.outputs)a.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function dO(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",H=arguments.length>3?arguments[3]:void 0;return(b,G)=>{let q=b._propStore;q||(q=[],b._propStore=q),q.push({propertyName:G,displayName:a,type:O,groupName:i,options:H??{},className:b.getClassName()})}}(0,T.c)([(0,A.G)("comment")],oO.prototype,"comments",void 0),function(a){a[a.Boolean=0]="Boolean",a[a.Float=1]="Float",a[a.Int=2]="Int",a[a.Vector2=3]="Vector2",a[a.List=4]="List",a[a.Ab=5]="Ab",a[a.SamplingMode=6]="SamplingMode",a[a.TextureFormat=7]="TextureFormat",a[a.TextureType=8]="TextureType"}(zO||(zO={})),function(a){a[a.None=0]="None",a[a.Position=1]="Position",a[a.Direction=2]="Direction",a[a.Age=3]="Age",a[a.Lifetime=4]="Lifetime",a[a.Color=5]="Color",a[a.ScaledDirection=6]="ScaledDirection",a[a.Scale=7]="Scale",a[a.AgeGradient=8]="AgeGradient",a[a.Angle=9]="Angle",a[a.SpriteCellIndex=16]="SpriteCellIndex",a[a.SpriteCellStart=17]="SpriteCellStart",a[a.SpriteCellEnd=18]="SpriteCellEnd"}(xO||(xO={})),function(a){a[a.None=0]="None",a[a.Time=1]="Time",a[a.Delta=2]="Delta",a[a.Emitter=3]="Emitter"}(gO||(gO={}));class YO{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let a="";for(const O of this.notConnectedNonOptionalInputs)a+=`input ${O.name} from block ${O.ownerBlock.name}[${O.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(a)throw"Build of Node Particle System Set failed:\n"+a}adapt(a,O){const i=a.getConnectedValue(this)||0;if(a.type===O)return i;switch(O){case uO.Vector2:return new H.Vector2(i,i);case uO.ZO:return new H.ZO(i,i,i);case uO.Ab:return new q.Ab(i,i,i,i)}return null}getContextualValue(a){if(!this.particleContext||!this.systemContext)return null;switch(a){case xO.Position:return this.particleContext.position;case xO.Direction:return this.particleContext.direction;case xO.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case xO.Color:return this.particleContext.color;case xO.Age:return this.particleContext.age;case xO.Lifetime:return this.particleContext.lifeTime;case xO.Angle:return this.particleContext.angle;case xO.Scale:return this.particleContext.scale;case xO.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case xO.SpriteCellEnd:return this.systemContext.endSpriteCellID;case xO.SpriteCellIndex:return this.particleContext.cellIndex;case xO.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.HO.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.HO.absolutePosition:this.systemContext.HO:null}getSystemValue(a){if(!this.particleContext||!this.systemContext)return null;switch(a){case gO.Time:return this.systemContext._actualFrame;case gO.Delta:return this.systemContext._scaledUpdateSpeed;case gO.Emitter:if(this.isEmitterTransformNode){return this.systemContext.HO.absolutePosition}return this.systemContext.HO}return null}}function LO(a,O,i){const H=new YO;H.rO=O;const b=a.createSystem(H);return b.canStart=()=>!0,b.HO=i.clone(),b.disposeOnStop=!0,b.start(),b}class sO extends oO{constructor(a){super(a),this.blendMode=k.BLENDMODE_ONEONE,this.Zi=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",uO.Particle),this.registerInput("texture",uO.Texture),this.registerInput("onStart",uO.System,!0),this.registerInput("onEnd",uO.System,!0),this.registerOutput("system",uO.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(a){a.Zi=this.Zi,a.buildId=this._buildId++,this.build(a);const O=this.particle.getConnectedValue(a);return O.particleTexture=this.texture.getConnectedValue(a),O.emitRate=this.emitRate,O.blendMode=this.blendMode,O.name=this.name,O._nodeGenerated=!0,O._targetStopDuration=this.targetStopDuration,O.startDelay=this.startDelay,this.system._storedValue=this,O.canStart=()=>!this.doNoStart,O.onStartedObservable.add((i=>{const H=this.onStart.getConnectedValue(a);H&&i.onStartedObservable.addOnce((()=>{a.systemContext=O;const i=LO(H,a.rO,a.emitterPosition);this.Pb.addOnce((()=>{i.dispose()}))}));const b=this.onEnd.getConnectedValue(a);b&&i.onStoppedObservable.addOnce((()=>{a.systemContext=O;const i=LO(b,a.rO,a.emitterPosition);this.Pb.addOnce((()=>{i.dispose()}))}))})),this.Pb.addOnce((()=>{O.dispose()})),O}serialize(){const a=super.serialize();return a.Zi=this.Zi,a.emitRate=this.emitRate,a.blendMode=this.blendMode,a.doNoStart=this.doNoStart,a.targetStopDuration=this.targetStopDuration,a.startDelay=this.startDelay,a}_deserialize(a){super._deserialize(a),this.Zi=a.Zi,this.emitRate=a.emitRate,this.doNoStart=!!a.doNoStart,void 0!==a.blendMode&&(this.blendMode=a.blendMode),void 0!==a.targetStopDuration&&(this.targetStopDuration=a.targetStopDuration),void 0!==a.startDelay&&(this.startDelay=a.startDelay)}}(0,T.c)([dO("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:k.BLENDMODE_ONEONE},{label:"Standard",value:k.BLENDMODE_STANDARD},{label:"Add",value:k.BLENDMODE_ADD},{label:"Multiply",value:k.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:k.BLENDMODE_MULTIPLYADD}]})],sO.prototype,"blendMode",void 0),(0,T.c)([dO("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],sO.prototype,"Zi",void 0),(0,T.c)([dO("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sO.prototype,"emitRate",void 0),(0,T.c)([dO("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sO.prototype,"targetStopDuration",void 0),(0,T.c)([dO("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],sO.prototype,"startDelay",void 0),(0,T.c)([dO("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],sO.prototype,"doNoStart",void 0),(0,Q.h)("BABYLON.SystemBlock",sO);class tO extends oO{get type(){if(this._type===uO.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=uO.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=uO.Vector2,this._type;case"ZO":return this._type=uO.ZO,this._type;case"Ab":return this._type=uO.Ab,this._type;case"Matrix":return this._type=uO.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===xO.None&&this._systemSource!==gO.None}get systemSource(){return this._systemSource}set systemSource(a){if(this._systemSource=a,a!==gO.None){switch(this._contextualSource=xO.None,this._type=uO.Float,a){case gO.Time:case gO.Delta:this._type=uO.Float;break;case gO.Emitter:this._type=uO.ZO}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==xO.None}get contextualValue(){return this._contextualSource}set contextualValue(a){if(this._contextualSource=a,a!==xO.None){switch(this._systemSource=gO.None,a){case xO.Scale:this._type=uO.Vector2;break;case xO.Position:case xO.Direction:case xO.ScaledDirection:this._type=uO.ZO;break;case xO.Color:this._type=uO.Ab;break;case xO.Age:case xO.Lifetime:case xO.Angle:case xO.AgeGradient:this._type=uO.Float;break;case xO.SpriteCellEnd:case xO.SpriteCellStart:case xO.SpriteCellIndex:this._type=uO.Int}this.output&&(this.output.type=this._type)}}constructor(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:uO.AutoDetect;super(a),this._type=uO.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new L.e,this._systemSource=gO.None,this._contextualSource=xO.None,this._type=O,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",O)}get value(){return this._storedValue}set value(a){this.type===uO.Float&&this.min!==this.max&&(a=Math.max(this.min,a),a=Math.min(this.max,a)),this._storedValue=a,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(a){this._valueCallback=a}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case uO.Int:case uO.Float:this.value=0;break;case uO.Vector2:this.value=H.Vector2.Zero();break;case uO.ZO:this.value=H.ZO.Zero();break;case uO.Ab:this.value=new q.Ab(1,1,1,1);break;case uO.Matrix:this.value=H.Matrix.Identity()}}_build(a){super._build(a),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=a=>a.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=a=>a.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const a=super.serialize();return a.type=this.type,a.contextualValue=this.contextualValue,a.systemSource=this.systemSource,a.min=this.min,a.max=this.max,a.groupInInspector=this.groupInInspector,a.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Cb?(a.valueType="BABYLON."+this._storedValue.getClassName(),a.value=this._storedValue.Cb()):(a.valueType="number",a.value=this._storedValue)),a}_deserialize(a){if(super._deserialize(a),this._type=a.type,this.contextualValue=a.contextualValue,this.systemSource=a.systemSource||gO.None,this.min=a.min||0,this.max=a.max||0,this.groupInInspector=a.groupInInspector||"",void 0!==a.displayInInspector&&(this.displayInInspector=a.displayInInspector),a.valueType)if("number"===a.valueType)this._storedValue=a.value;else{const O=(0,Q.e)(a.valueType);O&&(this._storedValue=O.MO(a.value))}}}(0,Q.h)("BABYLON.ParticleInputBlock",tO);class VO extends oO{get url(){return this._url}set url(a){this._url!==a&&(this._cachedData=null,this._url=a,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(a){this._textureDataUrl!==a&&(this._cachedData=null,this._textureDataUrl=a,this._url="",this._sourceTexture=null)}set sourceTexture(a){this._sourceTexture!==a&&(this._cachedData=null,this._sourceTexture=a,this._url="",this._textureDataUrl="")}constructor(a){super(a),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",uO.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const a=this.texture._storedValue;return await new Promise(((O,i)=>{if(!a.isReady())return void a.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),O(this._cachedData)}catch(a){i(a)}}));const H=a.getSize();TO.j.GetTextureDataAsync(a,H.width,H.height).then((i=>{this._cachedData={width:H.width,height:H.height,data:new Uint8ClampedArray(i)},a.dispose(),O(this._cachedData)})).catch(i)}))}_build(a){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new l.e(this._textureDataUrl,a.rO):this.texture._storedValue=new l.e(this._url,a.rO):this.texture._storedValue=null}serialize(){const a=super.serialize();return a.url=this.url,a.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(a.textureDataUrl=this.textureDataUrl),a}_deserialize(a){super._deserialize(a),this.url=a.url,this.serializedCachedData=!!a.serializedCachedData,a.textureDataUrl&&(this.textureDataUrl=a.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,Q.h)("BABYLON.ParticleTextureSourceBlock",VO);class ai extends oO{constructor(a){super(a),this.registerInput("particle",uO.Particle),this.registerInput("position",uO.ZO),this.registerOutput("output",uO.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(a){const O=this.particle.getConnectedValue(a);if(this.output._storedValue=O,!this.position.isConnected)return;const i={process:i=>{a.particleContext=i,a.systemContext=O,i.position.q(this.position.getConnectedValue(a))},previousItem:null,nextItem:null};O._updateQueueStart?ga(i,O._updateQueueStart):O._updateQueueStart=i}}(0,Q.h)("BABYLON.UpdatePositionBlock",ai),function(a){a[a.Add=0]="Add",a[a.Subtract=1]="Subtract",a[a.Multiply=2]="Multiply",a[a.Divide=3]="Divide",a[a.Max=4]="Max",a[a.Min=5]="Min"}(NO||(NO={}));class Oi extends oO{constructor(a){super(a),this.operation=NO.Add,this.registerInput("left",uO.AutoDetect),this.registerInput("right",uO.AutoDetect),this.registerOutput("output",uO.BasedOnInput),this.output._typeConnectionSource=this.left;const O=[uO.Matrix,uO.Particle,uO.Texture,uO.System,uO.FloatGradient,uO.Color4Gradient,uO.Vector2Gradient,uO.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...O),this.right.excludedConnectionPointTypes.push(...O),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(a){let O;const i=this.left,b=this.right;if(!i.isConnected||!b.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const G=i.type===uO.Float||i.type===uO.Int,Q=b.type===uO.Float||b.type===uO.Int,k=G&&Q;switch(this.operation){case NO.Add:O=k?a=>i.getConnectedValue(a)+b.getConnectedValue(a):G?a=>a.adapt(i,b.type).add(b.getConnectedValue(a)):a=>i.getConnectedValue(a).add(a.adapt(b,i.type));break;case NO.Subtract:O=k?a=>i.getConnectedValue(a)-b.getConnectedValue(a):G?a=>a.adapt(i,b.type).FO(b.getConnectedValue(a)):a=>i.getConnectedValue(a).FO(a.adapt(b,i.type));break;case NO.Multiply:O=k?a=>i.getConnectedValue(a)*b.getConnectedValue(a):G?a=>a.adapt(i,b.type).multiply(b.getConnectedValue(a)):a=>i.getConnectedValue(a).multiply(a.adapt(b,i.type));break;case NO.Divide:O=k?a=>i.getConnectedValue(a)/b.getConnectedValue(a):G?a=>a.adapt(i,b.type).divide(b.getConnectedValue(a)):a=>i.getConnectedValue(a).divide(a.adapt(b,i.type));break;case NO.Min:if(k)O=a=>Math.min(i.getConnectedValue(a),b.getConnectedValue(a));else{const[a,Q]=G?[b,i]:[i,b];switch(a.type){case uO.Vector2:O=O=>H.Vector2.Minimize(a.getConnectedValue(O),O.adapt(Q,a.type));break;case uO.ZO:O=O=>H.ZO.Minimize(a.getConnectedValue(O),O.adapt(Q,a.type));break;case uO.Ab:O=O=>{const i=a.getConnectedValue(O),{r:H,g:b,b:G,a:k}=O.adapt(Q,a.type);return new q.Ab(Math.min(i.r,H),Math.min(i.g,b),Math.min(i.b,G),Math.min(i.a,k))}}}break;case NO.Max:if(!k){const[a,Q]=G?[b,i]:[i,b];switch(a.type){case uO.Vector2:O=O=>H.Vector2.Maximize(a.getConnectedValue(O),O.adapt(Q,a.type));break;case uO.ZO:O=O=>H.ZO.Maximize(a.getConnectedValue(O),O.adapt(Q,a.type));break;case uO.Ab:O=O=>{const i=a.getConnectedValue(O),{r:H,g:b,b:G,a:k}=O.adapt(Q,a.type);return new q.Ab(Math.max(i.r,H),Math.min(i.g,b),Math.min(i.b,G),Math.min(i.a,k))}}break}O=a=>Math.max(i.getConnectedValue(a),b.getConnectedValue(a))}this.output._storedFunction=a=>i.type===uO.Int?0|O(a):O(a)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===uO.Int||this.left.type===uO.Float&&this.right.type!==uO.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[a,O]of[[this.left,this.right],[this.right,this.left]])a.acceptedConnectionPointTypes=[uO.Int,uO.Float],O.isConnected&&(a.acceptedConnectionPointTypes.push(O.type),O.type!==uO.Int&&O.type!==uO.Float||a.acceptedConnectionPointTypes.push(uO.Vector2,uO.ZO,uO.Ab))}dispose(){super.dispose();for(const a of this._connectionObservers)a.remove();this._connectionObservers.length=0}serialize(){const a=super.serialize();return a.operation=this.operation,a}_deserialize(a){super._deserialize(a),this.operation=a.operation}}(0,T.c)([dO("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:NO.Add},{label:"Subtract",value:NO.Subtract},{label:"Multiply",value:NO.Multiply},{label:"Divide",value:NO.Divide},{label:"Max",value:NO.Max},{label:"Min",value:NO.Min}]})],Oi.prototype,"operation",void 0),(0,Q.h)("BABYLON.ParticleMathBlock",Oi);class ii extends oO{constructor(a){super(a),this.registerInput("particle",uO.Particle),this.registerInput("direction1",uO.ZO,!0,new H.ZO(0,1,0)),this.registerInput("direction2",uO.ZO,!0,new H.ZO(0,1,0)),this.registerInput("minEmitBox",uO.ZO,!0,new H.ZO(-.5,-.5,-.5)),this.registerInput("maxEmitBox",uO.ZO,!0,new H.ZO(.5,.5,.5)),this.registerOutput("output",uO.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(a){const O=this.particle.getConnectedValue(a);O._directionCreation.process=i=>{a.particleContext=i,a.systemContext=O;const b=this.direction1.getConnectedValue(a),G=this.direction2.getConnectedValue(a),q=(0,I.RandomRange)(b.x,G.x),Q=(0,I.RandomRange)(b.y,G.y),k=(0,I.RandomRange)(b.z,G.z);a.isEmitterTransformNode?H.ZO.TransformNormalFromFloatsToRef(q,Q,k,a.emitterWorldMatrix,i.direction):i.direction.fb(q,Q,k)},O._positionCreation.process=i=>{a.particleContext=i,a.systemContext=O;const b=this.minEmitBox.getConnectedValue(a),G=this.maxEmitBox.getConnectedValue(a),q=(0,I.RandomRange)(b.x,G.x),Q=(0,I.RandomRange)(b.y,G.y),k=(0,I.RandomRange)(b.z,G.z);a.isEmitterTransformNode?H.ZO.TransformCoordinatesFromFloatsToRef(q,Q,k,a.emitterWorldMatrix,i.position):(i.position.fb(q,Q,k),i.position.addInPlace(a.emitterPosition))},this.output._storedValue=O}}(0,Q.h)("BABYLON.BoxShapeBlock",ii);class Hi extends oO{constructor(a){super(a),this.registerInput("emitPower",uO.Float,!0,1),this.registerInput("lifeTime",uO.Float,!0,1),this.registerInput("color",uO.Ab,!0,new q.Ab(1,1,1,1)),this.registerInput("scale",uO.Vector2,!0,new H.Vector2(1,1)),this.registerInput("angle",uO.Float,!0,0),this.registerOutput("particle",uO.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(a){const O=new QO(this.name,a.Zi,a.rO,null,!1,void 0,!0);O.particleEmitterType=new J,O._lifeTimeCreation.process=(O,i)=>{a.particleContext=O,O.lifeTime=this.lifeTime.getConnectedValue(a),i._emitPower=this.emitPower.getConnectedValue(a)},O._colorCreation.process=O=>{a.particleContext=O,O.color.q(this.color.getConnectedValue(a))},O._sizeCreation.process=O=>{a.particleContext=O,O.size=1,O.scale.q(this.scale.getConnectedValue(a))},O._angleCreation.process=O=>{a.particleContext=O,O.angle=this.angle.getConnectedValue(a)},this.particle._storedValue=O}}(0,Q.h)("BABYLON.CreateParticleBlock",Hi);class bi{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const a=[];for(const O of this.attachedBlocks)O.isInput&&a.push(O);return a}constructor(a){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new L.e,this.name=a}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(a){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(a)&&this.attachedBlocks.push(a);for(const i of a.inputs){const H=i.connectedPoint;if(H){const i=H.ownerBlock;i!==a&&this._initializeBlock(i,O)}}}async buildAsync(a){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((i=>{const H=new UO;for(const a of this._systemBlocks)this._initializeBlock(a);for(const b of this.systemBlocks){const i=new YO;i.buildId=this._buildId++,i.rO=a,i.verbose=O;const G=b.createSystem(i);i.emitErrors(),H.systems.push(G)}this.onBuildObservable.notifyObservers(this),i(H)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const a=new sO("Particle system"),O=new ai("Update position");O.output.connectTo(a.particle);const i=new tO("Position");i.contextualValue=xO.Position;const H=new tO("Scaled direction");H.contextualValue=xO.ScaledDirection;const b=new Oi("Add");b.operation=NO.Add,i.output.connectTo(b.left),H.output.connectTo(b.right),b.output.connectTo(O.position);const G=new Hi("Create particle"),q=new ii("Box shape");G.particle.connectTo(q.particle),q.output.connectTo(O.particle);const Q=new VO("Texture");Q.texture.connectTo(a.texture),Q.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(a)}removeBlock(a){const O=this.attachedBlocks.indexOf(a);if(O>-1&&this.attachedBlocks.splice(O,1),a.isSystem){const O=this._systemBlocks.indexOf(a);O>-1&&this._systemBlocks.splice(O,1)}}parseSerializedObject(a){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];O||this.clear();const i={};for(const H of a.wP){const a=(0,Q.e)(H.customType);if(a){const O=new a;O._deserialize(H),i[H.id]=O,this.attachedBlocks.push(O),O.isSystem&&this._systemBlocks.push(O)}}for(const H of this.attachedBlocks)if(H.isTeleportOut){const a=H,O=a._tempEntryPointUniqueId;if(O){const H=i[O];H&&H.attachToEndpoint(a)}}for(let H=0;H<a.wP.length;H++){const b=a.wP[H],G=i[b.id];G&&(G.inputs.length&&b.inputs.some((a=>a.targetConnectionName))&&!O||this._restoreConnections(G,a,i))}if(a.locations||a.editorData&&a.editorData.locations){const H=a.locations||a.editorData.locations;for(const a of H)i[a.UG]&&(a.UG=i[a.UG].uniqueId);O&&this.editorData&&this.editorData.locations&&H.concat(this.editorData.locations),a.locations?this.editorData={locations:H}:(this.editorData=a.editorData,this.editorData.locations=H);const b=[];for(const a in i)b[a]=i[a].uniqueId;this.editorData.map=b}this.comment=a.comment}_restoreConnections(a,O,i){for(const H of a.outputs)for(const b of O.wP){const G=i[b.id];if(G)for(const q of b.inputs)if(i[q.targetBlockId]!==a||q.targetConnectionName!==H.name);else{const a=G.getInputByName(q.inputName);if(!a||a.isConnected)continue;H.connectTo(a,!0),this._restoreConnections(G,O,i)}}}serialize(a){const O=a?{}:E.d.Serialize(this);O.editorData=JSON.parse(JSON.stringify(this.editorData));let i=[];a?i=a:O.customType="BABYLON.NodeParticleSystemSet",O.wP=[];for(const H of i)O.wP.push(H.serialize());if(!a)for(const H of this.attachedBlocks)-1===i.indexOf(H)&&O.wP.push(H.serialize());return O}dispose(){for(const a of this.attachedBlocks)a.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(a){const O=new bi(a);return O.setToDefault(),O}static Parse(a){const O=E.d.Parse((()=>new bi(a.name)),a,null);return O.parseSerializedObject(a),O}static ParseFromSnippetAsync(a,O){return"_BLANK"===a?Promise.resolve(bi.CreateDefault("blank")):new Promise(((i,H)=>{const b=new yO.e;b.addEventListener("readystatechange",(()=>{if(4==b.readyState)if(200==b.status){const q=JSON.parse(JSON.parse(b.responseText).jsonPayload),Q=JSON.parse(q.nodeParticle);O||(O=E.d.Parse((()=>new bi(a)),Q,null)),O.parseSerializedObject(Q),O.snippetId=a;try{i(O)}catch(G){H(G)}}else H("Unable to load the snippet "+a)})),b.open("GET",this.SnippetUrl+"/"+a.replace(/#/g,"/")),b.send()}))}}bi.EditorURL=`${CO.Tools._DefaultCdnUrl}/v${da.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,bi.SnippetUrl="https://snippet.babylonjs.com",(0,T.c)([(0,A.G)()],bi.prototype,"name",void 0),(0,T.c)([(0,A.G)("comment")],bi.prototype,"comment",void 0),function(a){a[a.None=0]="None",a[a.PerParticle=1]="PerParticle",a[a.PerSystem=2]="PerSystem"}(vO||(vO={}));class Gi extends oO{constructor(a){super(a),this._currentLockId=-2,this.lockMode=vO.PerParticle,this.registerInput("min",uO.AutoDetect,!0,0),this.registerInput("max",uO.AutoDetect,!0,1),this.registerOutput("output",uO.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(uO.Float|uO.Int|uO.Vector2|uO.ZO|uO.Ab),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(uO.Float|uO.Int|uO.Vector2|uO.ZO|uO.Ab),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=uO.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let a=null;switch(this._currentLockId=-2,this.min.type){case uO.AutoDetect:case uO.Int:case uO.Float:a=a=>{const O=this.min.getConnectedValue(a)||0,i=this.max.getConnectedValue(a)||1;return O+Math.random()*(i-O)};break;case uO.Vector2:a=a=>{const O=this.min.getConnectedValue(a)||H.Vector2.Zero(),i=this.max.getConnectedValue(a)||H.Vector2.One();return new H.Vector2(O.x+Math.random()*(i.x-O.x),O.y+Math.random()*(i.y-O.y))};break;case uO.ZO:a=a=>{const O=this.min.getConnectedValue(a)||H.ZO.Zero(),i=this.max.getConnectedValue(a)||H.ZO.One();return new H.ZO(O.x+Math.random()*(i.x-O.x),O.y+Math.random()*(i.y-O.y),O.z+Math.random()*(i.z-O.z))};break;case uO.Ab:a=a=>{const O=this.min.getConnectedValue(a)||new q.Ab(0,0,0,0),i=this.max.getConnectedValue(a)||new q.Ab(1,1,1,1);return new q.Ab(O.x+Math.random()*(i.x-O.x),O.y+Math.random()*(i.y-O.y),O.z+Math.random()*(i.z-O.z),O.w+Math.random()*(i.w-O.w))}}this.output._storedFunction=O=>{var i;let H=0;switch(this.lockMode){case vO.PerParticle:H=(null===(i=O.particleContext)||void 0===i?void 0:i.id)||-1;break;case vO.PerSystem:H=O.buildId||0}return this._currentLockId!==H&&(this.lockMode!==vO.None&&(this._currentLockId=H),this.output._storedValue=a(O)),this.output._storedValue}}serialize(){const a=super.serialize();return a.lockMode=this.lockMode,a}_deserialize(a){super._deserialize(a),this.lockMode=a.lockMode}}(0,T.c)([dO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:vO.None},{label:"Per particle",value:vO.PerParticle},{label:"Per system",value:vO.PerSystem}]})],Gi.prototype,"lockMode",void 0),(0,Q.h)("BABYLON.ParticleRandomBlock",Gi);class qi extends oO{constructor(a){super(a),this._currentLockId=-2,this.lockMode=vO.PerParticle,this.registerInput("min",uO.AutoDetect),this.registerInput("max",uO.AutoDetect),this.registerOutput("output",uO.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const O=[uO.Matrix,uO.Particle,uO.Texture,uO.System,uO.FloatGradient,uO.Color4Gradient,uO.Vector2Gradient,uO.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...O),this.max.excludedConnectionPointTypes.push(...O)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let a=null;switch(this._currentLockId=-2,this.min.type){case uO.Float:case uO.Int:a=a=>{const O=this.min.getConnectedValue(a),i=this.max.getConnectedValue(a);return Math.random()*(i-O)+O};break;case uO.Vector2:a=a=>{const O=this.min.getConnectedValue(a),i=this.max.getConnectedValue(a);return new H.Vector2(Math.random()*(i.x-O.x)+O.x,Math.random()*(i.y-O.y)+O.y)};break;case uO.ZO:a=a=>{const O=this.min.getConnectedValue(a),i=this.max.getConnectedValue(a);return new H.ZO(Math.random()*(i.x-O.x)+O.x,Math.random()*(i.y-O.y)+O.y,Math.random()*(i.z-O.z)+O.z)};break;case uO.Ab:a=a=>{const O=this.min.getConnectedValue(a),i=this.max.getConnectedValue(a);return new q.Ab(Math.random()*(i.r-O.r)+O.r,Math.random()*(i.g-O.g)+O.g,Math.random()*(i.b-O.b)+O.b,Math.random()*(i.a-O.a)+O.a)}}this.output._storedFunction=O=>{var i;let H=0;switch(this.lockMode){case vO.PerParticle:H=(null===(i=O.particleContext)||void 0===i?void 0:i.id)||-1;break;case vO.PerSystem:H=O.buildId||0}return this._currentLockId!==H&&(this.lockMode!==vO.None&&(this._currentLockId=H),this.output._storedValue=a(O)),this.output._storedValue}}serialize(){const a=super.serialize();return a.lockMode=this.lockMode,a}_deserialize(a){super._deserialize(a),void 0!==a.lockMode&&(this.lockMode=a.lockMode)}}(0,T.c)([dO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:vO.None},{label:"Per particle",value:vO.PerParticle},{label:"Per system",value:vO.PerSystem}]})],qi.prototype,"lockMode",void 0),(0,Q.h)("BABYLON.RandomRangeBlock",qi);(0,Q.h)("BABYLON.ParticleLerpBlock",class extends oO{constructor(a){super(a),this.registerInput("left",uO.AutoDetect),this.registerInput("right",uO.AutoDetect),this.registerInput("gradient",uO.Float,!0,0,0,1),this.registerOutput("output",uO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(uO.Float|uO.Int|uO.Vector2|uO.ZO|uO.Ab)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const a=(a,O,i)=>(1-a)*O+a*i;this.output._storedFunction=O=>{const i=this.left.getConnectedValue(O),b=this.right.getConnectedValue(O),G=this.gradient.getConnectedValue(O);switch(this.left.type){case uO.Int:case uO.Float:return a(G,i,b);case uO.Vector2:return new H.Vector2(a(G,i.x,b.x),a(G,i.y,b.y));case uO.ZO:return new H.ZO(a(G,i.x,b.x),a(G,i.y,b.y),a(G,i.z,b.z));case uO.Ab:return new q.Ab(a(G,i.r,b.r),a(G,i.g,b.g),a(G,i.b,b.b),a(G,i.a,b.a))}return 0}}});(0,Q.h)("BABYLON.UpdateDirectionBlock",class extends oO{constructor(a){super(a),this.registerInput("particle",uO.Particle),this.registerInput("direction",uO.ZO),this.registerOutput("output",uO.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(a){const O=this.particle.getConnectedValue(a);if(this.output._storedValue=O,!this.direction.isConnected)return;const i={process:i=>{a.particleContext=i,a.systemContext=O,i.direction.q(this.direction.getConnectedValue(a))},previousItem:null,nextItem:null};O._updateQueueStart?ga(i,O._updateQueueStart):O._updateQueueStart=i}});(0,Q.h)("BABYLON.UpdateColorBlock",class extends oO{constructor(a){super(a),this.registerInput("particle",uO.Particle),this.registerInput("color",uO.Ab),this.registerOutput("output",uO.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(a){const O=this.particle.getConnectedValue(a);if(this.output._storedValue=O,!this.color.isConnected)return;const i={process:i=>{a.particleContext=i,a.systemContext=O,i.color.q(this.color.getConnectedValue(a))},previousItem:null,nextItem:null};O._updateQueueStart?ga(i,O._updateQueueStart):O._updateQueueStart=i}});(0,Q.h)("BABYLON.UpdateScaleBlock",class extends oO{constructor(a){super(a),this.registerInput("particle",uO.Particle),this.registerInput("scale",uO.Vector2),this.registerOutput("output",uO.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(a){const O=this.particle.getConnectedValue(a);if(this.output._storedValue=O,!this.scale.isConnected)return;const i={process:i=>{a.particleContext=i,a.systemContext=O,i.scale.q(this.scale.getConnectedValue(a))},previousItem:null,nextItem:null};O._updateQueueStart?ga(i,O._updateQueueStart):O._updateQueueStart=i}});(0,Q.h)("BABYLON.UpdateAngleBlock",class extends oO{constructor(a){super(a),this.registerInput("particle",uO.Particle),this.registerInput("angle",uO.Float),this.registerOutput("output",uO.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(a){const O=this.particle.getConnectedValue(a);if(this.output._storedValue=O,!this.angle.isConnected)return;const i={process:i=>{a.particleContext=i,a.systemContext=O,i.angle=this.angle.getConnectedValue(a)},previousItem:null,nextItem:null};O._updateQueueStart?ga(i,O._updateQueueStart):O._updateQueueStart=i}});(0,Q.h)("BABYLON.BasicPositionUpdateBlock",class extends oO{constructor(a){super(a),this.registerInput("particle",uO.Particle),this.registerOutput("output",uO.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(a){const O=this.particle.getConnectedValue(a),i={process:i=>{a.particleContext=i,a.systemContext=O,i.direction.scaleToRef(O._directionScale,O._scaledDirection),i.position.addInPlace(O._scaledDirection)},previousItem:null,nextItem:null};O._updateQueueStart?ga(i,O._updateQueueStart):O._updateQueueStart=i,this.output._storedValue=O}});(0,Q.h)("BABYLON.BasicSpriteUpdateBlock",class extends oO{constructor(a){super(a),this.registerInput("particle",uO.Particle),this.registerOutput("output",uO.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(a){const O=this.particle.getConnectedValue(a),i={process:i=>{a.particleContext=i,a.systemContext=O,i.updateCellIndex()},previousItem:null,nextItem:null};O._updateQueueStart?ga(i,O._updateQueueStart):O._updateQueueStart=i,this.output._storedValue=O}});(0,Q.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends oO{constructor(a){super(a),this.registerInput("particle",uO.Particle),this.registerInput("cellIndex",uO.Int),this.registerOutput("output",uO.Particle),this.cellIndex.acceptedConnectionPointTypes=[uO.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(a){const O=this.particle.getConnectedValue(a);if(this.output._storedValue=O,!this.cellIndex.isConnected)return;const i={process:i=>{a.particleContext=i,a.systemContext=O,i.cellIndex=Math.floor(this.cellIndex.getConnectedValue(a))},previousItem:null,nextItem:null};O._updateQueueStart?ga(i,O._updateQueueStart):O._updateQueueStart=i}});class Qi extends oO{constructor(a){super(a),this.strength=1,this.registerInput("particle",uO.Particle),this.registerInput("flowMap",uO.Texture),this.registerOutput("output",uO.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(a){var O;const i=this.particle.getConnectedValue(a),H=a.rO;let b;(null===(O=this.flowMap.connectedPoint)||void 0===O?void 0:O.ownerBlock).extractTextureContentAsync().then((a=>{a&&(b=new WO(a.width,a.height,a.data))}));const G={process:a=>{const O=H.getTransformMatrix();b&&b._processParticle(a,this.strength*i._tempScaledUpdateSpeed,O)},previousItem:null,nextItem:null};i._updateQueueStart?ga(G,i._updateQueueStart):i._updateQueueStart=G,this.output._storedValue=i}serialize(){const a=super.serialize();return a.strength=this.strength,a}_deserialize(a){super._deserialize(a),this.strength=a.strength}}(0,T.c)([dO("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Qi.prototype,"strength",void 0),(0,Q.h)("BABYLON.UpdateFlowMapBlock",Qi);(0,Q.h)("BABYLON.SphereShapeBlock",class extends oO{constructor(a){super(a),this.registerInput("input",uO.Particle),this.registerInput("radius",uO.Float,!0,1),this.registerInput("radiusRange",uO.Float,!0,1,0,1),this.registerInput("directionRandomizer",uO.Float,!0,0,0,1),this.registerOutput("output",uO.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(a){const O=this.input.getConnectedValue(a);O._directionCreation.process=i=>{a.particleContext=i,a.systemContext=O;const b=this.directionRandomizer.getConnectedValue(a),G=i.position.FO(a.emitterPosition).normalize(),q=(0,I.RandomRange)(0,b),Q=(0,I.RandomRange)(0,b),k=(0,I.RandomRange)(0,b);G.x+=q,G.y+=Q,G.z+=k,G.normalize(),a.isEmitterTransformNode?H.ZO.TransformNormalFromFloatsToRef(q,Q,k,a.emitterWorldMatrix,i.direction):i.direction.fb(q,Q,k)},O._positionCreation.process=i=>{a.particleContext=i,a.systemContext=O;const b=this.radius.getConnectedValue(a),G=this.radiusRange.getConnectedValue(a),q=b-(0,I.RandomRange)(0,b*G),Q=(0,I.RandomRange)(0,1),k=(0,I.RandomRange)(0,2*Math.PI),P=Math.acos(2*Q-1),e=q*Math.cos(k)*Math.sin(P),h=q*Math.cos(P),j=q*Math.sin(k)*Math.sin(P);a.isEmitterTransformNode?H.ZO.TransformCoordinatesFromFloatsToRef(e,h,j,a.emitterWorldMatrix,i.position):(i.position.fb(e,h,j),i.position.addInPlace(a.emitterPosition))},this.output._storedValue=O}});(0,Q.h)("BABYLON.PointShapeBlock",class extends oO{constructor(a){super(a),this.registerInput("particle",uO.Particle),this.registerInput("direction1",uO.ZO,!0,new H.ZO(0,1,0)),this.registerInput("direction2",uO.ZO,!0,new H.ZO(0,1,0)),this.registerOutput("output",uO.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(a){const O=this.particle.getConnectedValue(a);O._directionCreation.process=i=>{a.particleContext=i,a.systemContext=O;const b=this.direction1.getConnectedValue(a),G=this.direction2.getConnectedValue(a),q=(0,I.RandomRange)(b.x,G.x),Q=(0,I.RandomRange)(b.y,G.y),k=(0,I.RandomRange)(b.z,G.z);a.isEmitterTransformNode?H.ZO.TransformNormalFromFloatsToRef(q,Q,k,a.emitterWorldMatrix,i.direction):i.direction.fb(q,Q,k)},O._positionCreation.process=i=>{a.systemContext=O,a.isEmitterTransformNode?H.ZO.TransformCoordinatesFromFloatsToRef(0,0,0,a.emitterWorldMatrix,i.position):i.position.q(a.emitterPosition)},this.output._storedValue=O}});(0,Q.h)("BABYLON.CustomShapeBlock",class extends oO{constructor(a){super(a),this.registerInput("particle",uO.Particle),this.registerInput("position",uO.ZO,!0,new H.ZO(0,0,0)),this.registerInput("direction",uO.ZO,!0,new H.ZO(0,1,0)),this.registerOutput("output",uO.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(a){const O=this.particle.getConnectedValue(a);O._directionCreation.process=i=>{a.particleContext=i,a.systemContext=O;const b=this.direction.getConnectedValue(a);a.isEmitterTransformNode?H.ZO.TransformNormalToRef(b,a.emitterWorldMatrix,i.direction):i.direction.q(b)},O._positionCreation.process=i=>{a.particleContext=i,a.systemContext=O;const b=this.position.getConnectedValue(a);a.isEmitterTransformNode?H.ZO.TransformCoordinatesToRef(b,a.emitterWorldMatrix,i.position):(i.position.q(b),i.position.addInPlace(a.emitterPosition))},this.output._storedValue=O}});(0,Q.h)("BABYLON.CylinderShapeBlock",class extends oO{constructor(a){super(a),this._tempVector=H.ZO.Zero(),this.registerInput("particle",uO.Particle),this.registerInput("radius",uO.Float,!0,1),this.registerInput("height",uO.Float,!0,1,0),this.registerInput("radiusRange",uO.Float,!0,1,0,1),this.registerInput("directionRandomizer",uO.Float,!0,0,0,1),this.registerOutput("output",uO.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(a){const O=this.particle.getConnectedValue(a);O._directionCreation.process=i=>{a.particleContext=i,a.systemContext=O;const b=this.directionRandomizer.getConnectedValue(a);i.position.subtractToRef(a.emitterPosition,this._tempVector),this._tempVector.normalize(),a.isEmitterTransformNode&&H.ZO.TransformNormalToRef(this._tempVector,a.emitterInverseWorldMatrix,this._tempVector);const G=(0,I.RandomRange)(-b/2,b/2);let q=Math.atan2(this._tempVector.x,this._tempVector.z);q+=(0,I.RandomRange)(-Math.PI/2,Math.PI/2)*b,this._tempVector.y=G,this._tempVector.x=Math.sin(q),this._tempVector.z=Math.cos(q),this._tempVector.normalize(),a.isEmitterTransformNode?H.ZO.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,a.emitterWorldMatrix,i.direction):i.direction.q(this._tempVector)},O._positionCreation.process=i=>{a.particleContext=i,a.systemContext=O;const b=this.height.getConnectedValue(a),G=this.radiusRange.getConnectedValue(a),q=this.radius.getConnectedValue(a),Q=(0,I.RandomRange)(-b/2,b/2),k=(0,I.RandomRange)(0,2*Math.PI),P=(0,I.RandomRange)((1-G)*(1-G),1),e=Math.sqrt(P)*q,h=e*Math.cos(k),j=e*Math.sin(k);a.isEmitterTransformNode?H.ZO.TransformCoordinatesFromFloatsToRef(h,Q,j,a.emitterWorldMatrix,i.position):(i.position.fb(h,Q,j),i.position.addInPlace(a.emitterPosition))},this.output._storedValue=O}});class ki extends oO{constructor(a){super(a),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",uO.Particle),this.registerOutput("output",uO.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(a){super._build(a);const O=this.particle.getConnectedValue(a);O._isAnimationSheetEnabled=!0,O.spriteCellWidth=this.width,O.spriteCellHeight=this.height,O.startSpriteCellID=this.start,O.endSpriteCellID=this.end,O.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=O}serialize(){const a=super.serialize();return a.width=this.width,a.height=this.height,a.start=this.start,a.end=this.end,a.randomStartCell=this.randomStartCell,a}_deserialize(a){super._deserialize(a),this.width=a.width,this.height=a.height,this.start=a.start,this.end=a.end,this.randomStartCell=a.randomStartCell}}(0,T.c)([dO("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ki.prototype,"start",void 0),(0,T.c)([dO("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ki.prototype,"end",void 0),(0,T.c)([dO("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ki.prototype,"width",void 0),(0,T.c)([dO("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ki.prototype,"height",void 0),(0,T.c)([dO("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ki.prototype,"loop",void 0),(0,T.c)([dO("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ki.prototype,"randomStartCell",void 0),(0,Q.h)("BABYLON.SetupSpriteSheetBlock",ki);class Ii extends oO{constructor(a){super(a),this.reference=0,this.registerInput("value",uO.AutoDetect),this.registerOutput("output",uO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=a=>{switch(a){case uO.Float:return uO.FloatGradient;case uO.Vector2:return uO.Vector2Gradient;case uO.ZO:return uO.Vector3Gradient;case uO.Ab:return uO.Color4Gradient}return a},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(uO.Float|uO.Vector2|uO.ZO|uO.Ab)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=a=>null}serialize(){const a=super.serialize();return a.reference=this.reference,a}_deserialize(a){super._deserialize(a),this.reference=a.reference}}(0,T.c)([dO("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Ii.prototype,"reference",void 0),(0,Q.h)("BABYLON.ParticleGradientValueBlock",Ii);(0,Q.h)("BABYLON.ParticleGradientBlock",class extends oO{constructor(a){super(a),this._entryCount=1,this.registerInput("gradient",uO.Float,!0,1,0,1),this.registerInput("value0",uO.AutoDetect),this.registerOutput("output",uO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=a=>{switch(a){case uO.FloatGradient:return uO.Float;case uO.Vector2Gradient:return uO.Vector2;case uO.Vector3Gradient:return uO.ZO;case uO.Color4Gradient:return uO.Ab}return a},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(uO.FloatGradient|uO.Vector2Gradient|uO.Vector3Gradient|uO.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(a){this._inputs[a].onConnectionObservable.add((()=>{this._entryCount>a||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),uO.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const a=[];for(let i=1;i<this._inputs.length;i++){var O;if(this._inputs[i].isConnected)a.push(null===(O=this._inputs[i].connectedPoint)||void 0===O?void 0:O.ownerBlock)}a.sort(((a,O)=>a.reference-O.reference)),this.output._storedFunction=O=>{const i=this.gradient.getConnectedValue(O);if(1===a.length)return a[0].value.getConnectedValue(O);let b=null;for(let G=a.length-1;G>=0;G--){const Q=a[G];if(Q.reference<=i){const a=Q.value.getConnectedValue(O);if(b){const G=b.value.getConnectedValue(O),k=b.reference,P=Q.reference,e=Math.max(0,Math.min(1,(i-P)/(k-P)));switch(this.output.type){case uO.Float:return(0,I.Lerp)(a,G,e);case uO.Vector2:return H.Vector2.Lerp(a,G,e);case uO.ZO:return H.ZO.Lerp(a,G,e);case uO.Ab:return q.Ab.Lerp(a,G,e)}}return a}b=Q}return 0}}});(0,Q.h)("BABYLON.ParticleConverterBlock",class extends oO{constructor(a){super(a),this.registerInput("color ",uO.Ab,!0),this.registerInput("xyz ",uO.ZO,!0),this.registerInput("xy ",uO.Vector2,!0),this.registerInput("zw ",uO.Vector2,!0),this.registerInput("x ",uO.Float,!0),this.registerInput("y ",uO.Float,!0),this.registerInput("z ",uO.Float,!0),this.registerInput("w ",uO.Float,!0),this.registerOutput("color",uO.Ab),this.registerOutput("xyz",uO.ZO),this.registerOutput("xy",uO.Vector2),this.registerOutput("zw",uO.Vector2),this.registerOutput("x",uO.Float),this.registerOutput("y",uO.Float),this.registerOutput("z",uO.Float),this.registerOutput("w",uO.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(a){return"color "===a?"colorIn":"xyz "===a?"xyzIn":"xy "===a?"xyIn":"zw "===a?"zwIn":"x "===a?"xIn":"y "===a?"yIn":"z "===a?"zIn":"w "===a?"wIn":a}_outputRename(a){switch(a){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return a}}_build(a){super._build(a);const O=this.xIn,i=this.yIn,b=this.zIn,G=this.wIn,Q=this.xyIn,k=this.zwIn,I=this.xyzIn,P=this.colorIn,e=this.colorOut,h=this.xyzOut,j=this.xyOut,Z=this.zwOut,F=this.xOut,r=this.yOut,J=this.zOut,ma=this.wOut,M=a=>{if(P.isConnected)return P.getConnectedValue(a);let H=0,e=0,h=0,j=0;if(O.isConnected&&(H=O.getConnectedValue(a)),i.isConnected&&(e=i.getConnectedValue(a)),b.isConnected&&(h=b.getConnectedValue(a)),G.isConnected&&(j=G.getConnectedValue(a)),Q.isConnected){const O=Q.getConnectedValue(a);O&&(H=O.x,e=O.y)}if(k.isConnected){const O=k.getConnectedValue(a);O&&(h=O.x,j=O.y)}if(I.isConnected){const O=I.getConnectedValue(a);O&&(H=O.x,e=O.y,h=O.z)}return new q.Ab(H,e,h,j)};e._storedFunction=a=>M(a),h._storedFunction=a=>{const O=M(a);return new H.ZO(O.r,O.g,O.b)},j._storedFunction=a=>{const O=M(a);return new H.Vector2(O.r,O.g)},Z._storedFunction=a=>{const O=M(a);return new H.Vector2(O.b,O.a)},F._storedFunction=a=>M(a).r,r._storedFunction=a=>M(a).g,J._storedFunction=a=>M(a).b,ma._storedFunction=a=>M(a).a}}),function(a){a[a.Cos=0]="Cos",a[a.Sin=1]="Sin",a[a.Abs=2]="Abs",a[a.Exp=3]="Exp",a[a.Exp2=4]="Exp2",a[a.Round=5]="Round",a[a.Floor=6]="Floor",a[a.Ceiling=7]="Ceiling",a[a.Sqrt=8]="Sqrt",a[a.Log=9]="Log",a[a.Tan=10]="Tan",a[a.ArcTan=11]="ArcTan",a[a.ArcCos=12]="ArcCos",a[a.ArcSin=13]="ArcSin",a[a.Sign=14]="Sign",a[a.Negate=15]="Negate",a[a.OneMinus=16]="OneMinus",a[a.Reciprocal=17]="Reciprocal",a[a.ToDegrees=18]="ToDegrees",a[a.ToRadians=19]="ToRadians",a[a.Fract=20]="Fract"}(XO||(XO={}));class Pi extends oO{constructor(a){super(a),this.operation=XO.Cos,this.registerInput("input",uO.AutoDetect),this.registerOutput("output",uO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(uO.Float|uO.Int|uO.Vector2|uO.ZO|uO.Ab)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(a){super._build(a);let O=null;switch(this.operation){case XO.Cos:O=a=>Math.cos(a);break;case XO.Sin:O=a=>Math.sin(a);break;case XO.Abs:O=a=>Math.abs(a);break;case XO.Exp:O=a=>Math.exp(a);break;case XO.Exp2:O=a=>Math.pow(2,a);break;case XO.Round:O=a=>Math.round(a);break;case XO.Floor:O=a=>Math.floor(a);break;case XO.Ceiling:O=a=>Math.ceil(a);break;case XO.Sqrt:O=a=>Math.sqrt(a);break;case XO.Log:O=a=>Math.log(a);break;case XO.Tan:O=a=>Math.tan(a);break;case XO.ArcTan:O=a=>Math.atan(a);break;case XO.ArcCos:O=a=>Math.acos(a);break;case XO.ArcSin:O=a=>Math.asin(a);break;case XO.Sign:O=a=>Math.sign(a);break;case XO.Negate:O=a=>-a;break;case XO.OneMinus:O=a=>1-a;break;case XO.Reciprocal:O=a=>1/a;break;case XO.ToRadians:O=a=>a*Math.PI/180;break;case XO.ToDegrees:O=a=>180*a/Math.PI;break;case XO.Fract:O=a=>a>=0?a-Math.floor(a):a-Math.ceil(a)}if(!O)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case uO.Int:case uO.Float:this.output._storedFunction=a=>{const i=this.input.getConnectedValue(a);return O(i)};break;case uO.Vector2:this.output._storedFunction=a=>{const i=this.input.getConnectedValue(a);return new H.Vector2(O(i.x),O(i.y))};break;case uO.ZO:this.output._storedFunction=a=>{const i=this.input.getConnectedValue(a);return new H.ZO(O(i.x),O(i.y),O(i.z))};break;case uO.Ab:this.output._storedFunction=a=>{const i=this.input.getConnectedValue(a);return new q.Ab(O(i.r),O(i.g),O(i.b),O(i.a))}}return this}serialize(){const a=super.serialize();return a.operation=this.operation,a}_deserialize(a){super._deserialize(a),this.operation=a.operation}}(0,T.c)([dO("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:XO.Cos},{label:"Sin",value:XO.Sin},{label:"Abs",value:XO.Abs},{label:"Exp",value:XO.Exp},{label:"Exp2",value:XO.Exp2},{label:"Round",value:XO.Round},{label:"Floor",value:XO.Floor},{label:"Ceiling",value:XO.Ceiling},{label:"Sqrt",value:XO.Sqrt},{label:"Log",value:XO.Log},{label:"Tan",value:XO.Tan},{label:"ArcTan",value:XO.ArcTan},{label:"ArcCos",value:XO.ArcCos},{label:"ArcSin",value:XO.ArcSin},{label:"Sign",value:XO.Sign},{label:"Negate",value:XO.Negate},{label:"OneMinus",value:XO.OneMinus},{label:"Reciprocal",value:XO.Reciprocal},{label:"ToDegrees",value:XO.ToDegrees},{label:"ToRadians",value:XO.ToRadians},{label:"Fract",value:XO.Fract}]})],Pi.prototype,"operation",void 0),(0,Q.h)("BABYLON.ParticleTrigonometryBlock",Pi);var ei,hi=i(13807);class ji extends oO{constructor(a){super(a),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",uO.AutoDetect),this.registerOutput("output",uO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(uO.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(uO.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(uO.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(uO.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(uO.System),this._inputs[0].excludedConnectionPointTypes.push(uO.Particle),this._inputs[0].excludedConnectionPointTypes.push(uO.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(a){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const O=a=>{const O=this.input.getConnectedValue(a);if(this.log.length>=this.stackSize)return O;if(null===O||void 0===O)return this.log.push(["null",""]),O;switch(this.input.type){case uO.Vector2:this.log.push([(0,hi.h)(O,4),O.toString()]);break;case uO.ZO:this.log.push([(0,hi.i)(O,4),O.toString()]);break;case uO.Ab:this.log.push([`{R: ${O.r.toFixed(4)} G: ${O.g.toFixed(4)} B: ${O.b.toFixed(4)} A: ${O.a.toFixed(4)}}`,O.toString()]);break;default:this.log.push([O.toString(),O.toString()])}return O};this.output.isConnected?this.output._storedFunction=O:this.output._storedValue=O(a)}serialize(){const a=super.serialize();return a.stackSize=this.stackSize,a}_deserialize(a){super._deserialize(a),this.stackSize=a.stackSize}}(0,T.c)([dO("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],ji.prototype,"stackSize",void 0),(0,Q.h)("BABYLON.ParticleDebugBlock",ji);(0,Q.h)("BABYLON.ParticleElbowBlock",class extends oO{constructor(a){super(a),this.registerInput("input",uO.AutoDetect),this.registerOutput("output",uO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(a){super._build(a);const O=this._outputs[0],i=this._inputs[0];O._storedFunction=a=>i.getConnectedValue(a)}});(0,Q.h)("BABYLON.ParticleTeleportInBlock",class extends oO{get endpoints(){return this._endpoints}constructor(a){super(a),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",uO.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(a){if(this.getClassName()===a)return!0;for(const O of this.endpoints)if(O.isAnAncestorOfType(a))return!0;return!1}isAnAncestorOf(a){for(const O of this.endpoints){if(O===a)return!0;if(O.isAnAncestorOf(a))return!0}return!1}attachToEndpoint(a){a.detach(),this._endpoints.push(a),a._entryPoint=this,a._outputs[0]._typeConnectionSource=this._inputs[0],a._tempEntryPointUniqueId=null,a.name="> "+this.name}detachFromEndpoint(a){const O=this._endpoints.indexOf(a);-1!==O&&(this._endpoints.splice(O,1),a._outputs[0]._typeConnectionSource=null,a._entryPoint=null)}_build(){for(const a of this._endpoints)a.output._storedFunction=a=>this.input.getConnectedValue(a)}});(0,Q.h)("BABYLON.ParticleTeleportOutBlock",class extends oO{constructor(a){super(a),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",uO.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(a){this.entryPoint&&this.entryPoint.build(a)}clone(){const a=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(a),a}serialize(){var a;const O=super.serialize();return O.entryPoint=(null===(a=this.entryPoint)||void 0===a?void 0:a.uniqueId)??"",O}_deserialize(a){super._deserialize(a),this._tempEntryPointUniqueId=a.entryPoint}}),function(a){a[a.Equal=0]="Equal",a[a.NotEqual=1]="NotEqual",a[a.LessThan=2]="LessThan",a[a.GreaterThan=3]="GreaterThan",a[a.LessOrEqual=4]="LessOrEqual",a[a.GreaterOrEqual=5]="GreaterOrEqual",a[a.Xor=6]="Xor",a[a.Or=7]="Or",a[a.And=8]="And"}(ei||(ei={}));class Zi extends oO{constructor(a){super(a),this.test=ei.Equal,this.epsilon=0,this.registerInput("left",uO.Float),this.registerInput("right",uO.Float,!0,0),this.registerInput("ifTrue",uO.AutoDetect,!0,1),this.registerInput("ifFalse",uO.AutoDetect,!0,0),this.registerOutput("output",uO.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=uO.Float,this._inputs[0].acceptedConnectionPointTypes.push(uO.Int),this._inputs[1].acceptedConnectionPointTypes.push(uO.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const a=a=>{const O=this.left.getConnectedValue(a),i=this.right.getConnectedValue(a);let H=!1;switch(this.test){case ei.Equal:H=(0,I.WithinEpsilon)(O,i,this.epsilon);break;case ei.NotEqual:H=!(0,I.WithinEpsilon)(O,i,this.epsilon);break;case ei.LessThan:H=O<i+this.epsilon;break;case ei.GreaterThan:H=O>i-this.epsilon;break;case ei.LessOrEqual:H=O<=i+this.epsilon;break;case ei.GreaterOrEqual:H=O>=i-this.epsilon;break;case ei.Xor:H=!!O&&!i||!O&&!!i;break;case ei.Or:H=!!O||!!i;break;case ei.And:H=!!O&&!!i}return H};this.output._storedFunction=O=>a(O)?this.ifTrue.getConnectedValue(O):this.ifFalse.getConnectedValue(O)}serialize(){const a=super.serialize();return a.test=this.test,a.epsilon=this.epsilon,a}_deserialize(a){super._deserialize(a),this.test=a.test,void 0!==a.epsilon&&(this.epsilon=a.epsilon)}}(0,T.c)([dO("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:ei.Equal},{label:"NotEqual",value:ei.NotEqual},{label:"LessThan",value:ei.LessThan},{label:"GreaterThan",value:ei.GreaterThan},{label:"LessOrEqual",value:ei.LessOrEqual},{label:"GreaterOrEqual",value:ei.GreaterOrEqual},{label:"Xor",value:ei.Xor},{label:"Or",value:ei.Or},{label:"And",value:ei.And}]})],Zi.prototype,"test",void 0),(0,T.c)([dO("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Zi.prototype,"epsilon",void 0),(0,Q.h)("BABYLON.ParticleConditionBlock",Zi);class Fi extends oO{constructor(a){super(a),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",uO.Particle),this.registerInput("condition",uO.Float,!0,0),this.registerInput("system",uO.System),this.registerOutput("output",uO.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(a){this._triggerCount=0;const O=this.input.getConnectedValue(a),i={process:i=>{if(a.particleContext=i,a.systemContext=O,0!==this.condition.getConnectedValue(a)&&(0===this.limit||this._triggerCount<this.limit)){const H=(new Date).getTime();if(this._previousOne&&H-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=H;const b=this.system.getConnectedValue(a);if(b){const H=LO(b,a.rO,i.position);H.Pb.addOnce((()=>{this._triggerCount--})),O.Pb.addOnce((()=>{H.dispose()}))}}},previousItem:null,nextItem:null};O._updateQueueStart?ga(i,O._updateQueueStart):O._updateQueueStart=i,this.output._storedValue=O}serialize(){const a=super.serialize();return a.limit=this.limit,a.delay=this.delay,a}_deserialize(a){super._deserialize(a),void 0!==a.limit&&(this.limit=a.limit),void 0!==a.delay&&(this.delay=a.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,T.c)([dO("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Fi.prototype,"limit",void 0),(0,T.c)([dO("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Fi.prototype,"delay",void 0),(0,Q.h)("BABYLON.ParticleTriggerBlock",Fi);i(13814),i(13828),i(13841),i(13900)},13880:(a,O,i)=>{"use strict";var H=i(12287);const b="clipPlaneFragment",G="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13845:(a,O,i)=>{"use strict";var H=i(12287);const b="clipPlaneFragmentDeclaration",G="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13913:(a,O,i)=>{"use strict";var H=i(12287);const b="clipPlaneVertex",G="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13906:(a,O,i)=>{"use strict";var H=i(12287);const b="clipPlaneVertexDeclaration",G="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13891:(a,O,i)=>{"use strict";var H=i(12287);const b="fogFragment",G="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13874:(a,O,i)=>{"use strict";var H=i(12287);const b="fogFragmentDeclaration",G="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13917:(a,O,i)=>{"use strict";var H=i(12287);const b="fogVertex",G="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13910:(a,O,i)=>{"use strict";var H=i(12287);const b="fogVertexDeclaration",G="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13861:(a,O,i)=>{"use strict";var H=i(12287);const b="helperFunctions",G="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13848:(a,O,i)=>{"use strict";var H=i(12287);const b="imageProcessingDeclaration",G="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13870:(a,O,i)=>{"use strict";var H=i(12287);const b="imageProcessingFunctions",G="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13854:(a,O,i)=>{"use strict";var H=i(12287);const b="logDepthDeclaration",G="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13887:(a,O,i)=>{"use strict";var H=i(12287);const b="logDepthFragment",G="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13923:(a,O,i)=>{"use strict";var H=i(12287);const b="logDepthVertex",G="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";H.c.IncludesShadersStoreWGSL[b]||(H.c.IncludesShadersStoreWGSL[b]=G)},13841:(a,O,i)=>{"use strict";i.r(O),i.d(O,{particlesPixelShaderWGSL:()=>q});var H=i(12287);i(13845),i(13848),i(13854),i(13861),i(13870),i(13874),i(13880),i(13887),i(13891);const b="particlesPixelShader",G="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";H.c.ShadersStoreWGSL[b]||(H.c.ShadersStoreWGSL[b]=G);const q={name:b,shader:G}},13900:(a,O,i)=>{"use strict";i.r(O),i.d(O,{particlesVertexShaderWGSL:()=>q});var H=i(12287);i(13906),i(13910),i(13854),i(13913),i(13917),i(13923);const b="particlesVertexShader",G="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";H.c.ShadersStoreWGSL[b]||(H.c.ShadersStoreWGSL[b]=G);const q={name:b,shader:G}},13739:(a,O,i)=>{"use strict";var H=i(12287);const b="clipPlaneFragment",G="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13820:(a,O,i)=>{"use strict";var H=i(12287);const b="clipPlaneFragmentDeclaration",G="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13766:(a,O,i)=>{"use strict";var H=i(12287);const b="clipPlaneVertex",G="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13836:(a,O,i)=>{"use strict";var H=i(12287);const b="clipPlaneVertexDeclaration",G="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13751:(a,O,i)=>{"use strict";var H=i(12287);const b="fogFragment",G="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13732:(a,O,i)=>{"use strict";var H=i(12287);const b="fogFragmentDeclaration",G="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13769:(a,O,i)=>{"use strict";var H=i(12287);const b="fogVertex",G="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13760:(a,O,i)=>{"use strict";var H=i(12287);const b="fogVertexDeclaration",G="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13724:(a,O,i)=>{"use strict";var H=i(12287);const b="helperFunctions",G="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13713:(a,O,i)=>{"use strict";var H=i(12287);const b="imageProcessingDeclaration",G="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13727:(a,O,i)=>{"use strict";var H=i(12287);const b="imageProcessingFunctions",G="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13719:(a,O,i)=>{"use strict";var H=i(12287);const b="logDepthDeclaration",G="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13742:(a,O,i)=>{"use strict";var H=i(12287);const b="logDepthFragment",G="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13778:(a,O,i)=>{"use strict";var H=i(12287);const b="logDepthVertex",G="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";H.c.IncludesShadersStore[b]||(H.c.IncludesShadersStore[b]=G)},13814:(a,O,i)=>{"use strict";i.r(O),i.d(O,{particlesPixelShader:()=>q});var H=i(12287);i(13820),i(13713),i(13719),i(13724),i(13727),i(13732),i(13739),i(13742),i(13751);const b="particlesPixelShader",G="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";H.c.ShadersStore[b]||(H.c.ShadersStore[b]=G);const q={name:b,shader:G}},13828:(a,O,i)=>{"use strict";i.r(O),i.d(O,{particlesVertexShader:()=>q});var H=i(12287);i(13836),i(13760),i(13719),i(13766),i(13769),i(13778);const b="particlesVertexShader",G="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";H.c.ShadersStore[b]||(H.c.ShadersStore[b]=G);const q={name:b,shader:G}},14167:(a,O,i)=>{"use strict";i.r(O),i.d(O,{FlowGraphGLTFDataProvider:()=>G});var H=i(14139),b=i(14124);class G extends H.c{constructor(a){var O,i;super();const H=a.glTF,G=(null===(O=H.animations)||void 0===O?void 0:O.map((a=>a._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",b.e,G);const q=(null===(i=H.nodes)||void 0===i?void 0:i.map((a=>a._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",b.e,q)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14065:(a,O,i)=>{"use strict";i.d(O,{e:()=>r,f:()=>Z,g:()=>j,k:()=>F});var H=i(12395),b=i(12878),G=i(12436),q=i(14073);const Q=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class k{constructor(a,O){this._gltf=a,this._infoTree=O}convert(a){let O,i=this._gltf,H=this._infoTree;if(!a.startsWith("/"))throw new Error("Path must start with a /");const b=a.split("/");if(b.shift(),b[b.length-1].includes(".length")){const a=b[b.length-1].split(".");b.pop(),b.push(...a)}let G=!1;for(const k of b){const b="length"===k;if(b&&!H.__array__)throw new Error(`Path ${a} is invalid`);if(H.__ignoreObjectTree__&&(G=!0),H.__array__&&!b)H=H.__array__;else if(H=H[k],!H)throw new Error(`Path ${a} is invalid`);if(!G)if(void 0===i){if(!Q.find((O=>O.regex.test(a))))throw new Error(`Path ${a} is invalid`)}else if(!b){var q;i=null===(q=i)||void 0===q?void 0:q[k]}(H.__target__||b)&&(O=i)}return{object:O,info:H}}}function I(a,O,i,H){const b=P(a,O);return H?b[i][H]:b[i]}function P(a,O,i){var H,G;return null===(H=a._data)||void 0===H||null===(G=H[(null===i||void 0===i?void 0:i.fillMode)??b.d.MATERIAL_TriangleFillMode])||void 0===G?void 0:G.babylonMaterial}function e(a,O){return{offset:{componentsCount:2,type:"Vector2",get:(i,b,G)=>{const q=I(i,G,a,O);return new H.Vector2(null===q||void 0===q?void 0:q.uOffset,null===q||void 0===q?void 0:q.vOffset)},getTarget:P,set:(i,H,b,G)=>{const q=I(H,G,a,O);q.uOffset=i.x,q.vOffset=i.y},getPropertyName:[()=>`${a}${O?"."+O:""}.uOffset`,()=>`${a}${O?"."+O:""}.vOffset`]},rotation:{type:"number",get:(i,H,b)=>{var G;return null===(G=I(i,b,a,O))||void 0===G?void 0:G.wAng},getTarget:P,set:(i,H,b,G)=>I(H,G,a,O).wAng=i,getPropertyName:[()=>`${a}${O?"."+O:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(i,b,G)=>{const q=I(i,G,a,O);return new H.Vector2(null===q||void 0===q?void 0:q.uScale,null===q||void 0===q?void 0:q.vScale)},getTarget:P,set:(i,H,b,G)=>{const q=I(H,G,a,O);q.uScale=i.x,q.vScale=i.y},getPropertyName:[()=>`${a}${O?"."+O:""}.uScale`,()=>`${a}${O?"."+O:""}.vScale`]}}}const h={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:a=>{var O,i;return new H.Vector2((null===(O=a._babylonCamera)||void 0===O?void 0:O.orthoLeft)??0,(null===(i=a._babylonCamera)||void 0===i?void 0:i.orthoRight)??0)},set:(a,O)=>{O._babylonCamera&&(O._babylonCamera.orthoLeft=a.x,O._babylonCamera.orthoRight=a.y)},getTarget:a=>a,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:a=>{var O,i;return new H.Vector2((null===(O=a._babylonCamera)||void 0===O?void 0:O.orthoBottom)??0,(null===(i=a._babylonCamera)||void 0===i?void 0:i.orthoTop)??0)},set:(a,O)=>{O._babylonCamera&&(O._babylonCamera.orthoBottom=a.x,O._babylonCamera.orthoTop=a.y)},getTarget:a=>a,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:a=>{var O;return null===(O=a._babylonCamera)||void 0===O?void 0:O.maxZ},set:(a,O)=>{O._babylonCamera&&(O._babylonCamera.maxZ=a)},getTarget:a=>a,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:a=>{var O;return null===(O=a._babylonCamera)||void 0===O?void 0:O.Db},set:(a,O)=>{O._babylonCamera&&(O._babylonCamera.Db=a)},getTarget:a=>a,getPropertyName:[()=>"Db"]}},perspective:{aspectRatio:{type:"number",get:a=>{var O;return null===(O=a._babylonCamera)||void 0===O?void 0:O.getEngine().getAspectRatio(a._babylonCamera)},getTarget:a=>a,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:a=>{var O;return null===(O=a._babylonCamera)||void 0===O?void 0:O.fov},set:(a,O)=>{O._babylonCamera&&(O._babylonCamera.fov=a)},getTarget:a=>a,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:a=>{var O;return null===(O=a._babylonCamera)||void 0===O?void 0:O.maxZ},set:(a,O)=>{O._babylonCamera&&(O._babylonCamera.maxZ=a)},getTarget:a=>a,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:a=>{var O;return null===(O=a._babylonCamera)||void 0===O?void 0:O.Db},set:(a,O)=>{O._babylonCamera&&(O._babylonCamera.Db=a)},getTarget:a=>a,getPropertyName:[()=>"Db"]}}}},nodes:{length:{type:"number",get:a=>a.length,getTarget:a=>a.map((a=>a._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"ZO",get:a=>{var O;return null===(O=a._babylonTransformNode)||void 0===O?void 0:O.position},set:(a,O)=>{var i;return null===(i=O._babylonTransformNode)||void 0===i?void 0:i.position.q(a)},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:a=>{var O;return null===(O=a._babylonTransformNode)||void 0===O?void 0:O.rotationQuaternion},set:(a,O)=>{var i,H;return null===(i=O._babylonTransformNode)||void 0===i||null===(H=i.rotationQuaternion)||void 0===H?void 0:H.q(a)},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"ZO",get:a=>{var O;return null===(O=a._babylonTransformNode)||void 0===O?void 0:O.Bb},set:(a,O)=>{var i;return null===(i=O._babylonTransformNode)||void 0===i?void 0:i.Bb.q(a)},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"Bb"]},weights:{length:{type:"number",get:a=>a._numMorphTargets,getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(a,O)=>{var i,H;return void 0!==O?null===(i=a._primitiveBabylonMeshes)||void 0===i||null===(H=i[0].morphTargetManager)||void 0===H?void 0:H.getTarget(O).influence:void 0},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(a,O)=>[0],getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:a=>{var O,i,b;return H.Matrix.Compose(null===(O=a._babylonTransformNode)||void 0===O?void 0:O.Bb,null===(i=a._babylonTransformNode)||void 0===i?void 0:i.rotationQuaternion,null===(b=a._babylonTransformNode)||void 0===b?void 0:b.position)},getTarget:a=>a._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:a=>{var O,i,b,G;const q=H.Matrix.Identity();let Q=a.parent;for(;Q&&Q.parent;)Q=Q.parent;const k=(null===(O=a._babylonTransformNode)||void 0===O?void 0:O.position._isDirty)||(null===(i=a._babylonTransformNode)||void 0===i||null===(b=i.rotationQuaternion)||void 0===b?void 0:b._isDirty)||(null===(G=a._babylonTransformNode)||void 0===G?void 0:G.Bb._isDirty);if(Q){var I;const O=null===(I=Q._babylonTransformNode)||void 0===I?void 0:I.yb(!0).invert();var P,e;if(O)null===(P=a._babylonTransformNode)||void 0===P||null===(e=P.yb(k))||void 0===e||e.multiplyToRef(O,q)}else a._babylonTransformNode&&q.q(a._babylonTransformNode.yb(k));return q},getTarget:a=>a._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:a=>{var O,i;return null===(O=a._babylonTransformNode)||void 0===O||null===(i=O.getChildren((a=>a instanceof q.b),!0)[0])||void 0===i?void 0:i.Wb},getTarget:a=>{var O;return null===(O=a._babylonTransformNode)||void 0===O?void 0:O.getChildren((a=>a instanceof q.b),!0)[0]},set:(a,O)=>{if(O._babylonTransformNode){const i=O._babylonTransformNode.getChildren((a=>a instanceof q.b),!0)[0];i&&(i.Wb=a)}}},color:{type:"mi",get:a=>{var O,i;return null===(O=a._babylonTransformNode)||void 0===O||null===(i=O.getChildren((a=>a instanceof q.b),!0)[0])||void 0===i?void 0:i.ub},getTarget:a=>{var O;return null===(O=a._babylonTransformNode)||void 0===O?void 0:O.getChildren((a=>a instanceof q.b),!0)[0]},set:(a,O)=>{if(O._babylonTransformNode){const i=O._babylonTransformNode.getChildren((a=>a instanceof q.b),!0)[0];i&&(i.ub=a)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"mi",get:(a,O,i)=>P(a,O,i).emissiveColor,set:(a,O,i,H)=>P(O,i,H).emissiveColor.q(a),getTarget:(a,O,i)=>P(a,O,i),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:e("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(a,O,i)=>{var H;return null===(H=I(a,i,"bumpTexture"))||void 0===H?void 0:H.level},set:(a,O,i,H)=>{const b=I(O,H,"bumpTexture");b&&(b.level=a)},getTarget:(a,O,i)=>P(a,O,i),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:e("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(a,O,i)=>P(a,O,i).ambientTextureStrength,set:(a,O,i,H)=>{const b=P(O,i,H);b&&(b.ambientTextureStrength=a)},getTarget:(a,O,i)=>P(a,O,i),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:e("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Ab",get:(a,O,i)=>{const H=P(a,O,i);return G.Ab.FromColor3(H.albedoColor,H.alpha)},set:(a,O,i,H)=>{const b=P(O,i,H);b.albedoColor.set(a.r,a.g,a.b),b.alpha=a.a},getTarget:(a,O,i)=>P(a,O,i),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:e("albedoTexture")}},metallicFactor:{type:"number",get:(a,O,i)=>P(a,O,i).metallic,set:(a,O,i,H)=>{const b=P(O,i,H);b&&(b.metallic=a)},getTarget:(a,O,i)=>P(a,O,i),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(a,O,i)=>P(a,O,i).roughness,set:(a,O,i,H)=>{const b=P(O,i,H);b&&(b.roughness=a)},getTarget:(a,O,i)=>P(a,O,i),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:e("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(a,O,i)=>P(a,O,i).anisotropy.Wb,set:(a,O,i,H)=>{P(O,i,H).anisotropy.Wb=a},getTarget:(a,O,i)=>P(a,O,i),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(a,O,i)=>P(a,O,i).anisotropy.angle,set:(a,O,i,H)=>{P(O,i,H).anisotropy.angle=a},getTarget:(a,O,i)=>P(a,O,i),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:e("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(a,O,i)=>P(a,O,i).clearCoat.Wb,set:(a,O,i,H)=>{P(O,i,H).clearCoat.Wb=a},getTarget:(a,O,i)=>P(a,O,i),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(a,O,i)=>P(a,O,i).clearCoat.roughness,set:(a,O,i,H)=>{P(O,i,H).clearCoat.roughness=a},getTarget:(a,O,i)=>P(a,O,i),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:e("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(a,O,i)=>{var H;return null===(H=P(a,O,i).clearCoat.bumpTexture)||void 0===H?void 0:H.level},getTarget:P,set:(a,O,i,H)=>P(O,i,H).clearCoat.bumpTexture.level=a},extensions:{KHR_texture_transform:e("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:e("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(a,O,i)=>P(a,O,i).subSurface.dispersion,getTarget:P,set:(a,O,i,H)=>P(O,i,H).subSurface.dispersion=a}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(a,O,i)=>P(a,O,i).emissiveIntensity,getTarget:P,set:(a,O,i,H)=>P(O,i,H).emissiveIntensity=a}},KHR_materials_ior:{ior:{type:"number",get:(a,O,i)=>P(a,O,i).indexOfRefraction,getTarget:P,set:(a,O,i,H)=>P(O,i,H).indexOfRefraction=a}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(a,O,i)=>P(a,O,i).iridescence.Wb,getTarget:P,set:(a,O,i,H)=>P(O,i,H).iridescence.Wb=a},iridescenceIor:{type:"number",get:(a,O,i)=>P(a,O,i).iridescence.indexOfRefraction,getTarget:P,set:(a,O,i,H)=>P(O,i,H).iridescence.indexOfRefraction=a},iridescenceTexture:{extensions:{KHR_texture_transform:e("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(a,O,i)=>P(a,O,i).iridescence.maximumThickness,getTarget:P,set:(a,O,i,H)=>P(O,i,H).iridescence.maximumThickness=a},iridescenceThicknessMinimum:{type:"number",get:(a,O,i)=>P(a,O,i).iridescence.minimumThickness,getTarget:P,set:(a,O,i,H)=>P(O,i,H).iridescence.minimumThickness=a},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:e("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"mi",get:(a,O,i)=>P(a,O,i).sheen.color,getTarget:P,set:(a,O,i,H)=>P(O,i,H).sheen.color.q(a)},sheenColorTexture:{extensions:{KHR_texture_transform:e("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(a,O,i)=>P(a,O,i).sheen.Wb,getTarget:P,set:(a,O,i,H)=>P(O,i,H).sheen.Wb=a},sheenRoughnessTexture:{extensions:{KHR_texture_transform:e("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(a,O,i)=>P(a,O,i).metallicF0Factor,getTarget:P,set:(a,O,i,H)=>P(O,i,H).metallicF0Factor=a,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"mi",get:(a,O,i)=>P(a,O,i).metallicReflectanceColor,getTarget:P,set:(a,O,i,H)=>P(O,i,H).metallicReflectanceColor.q(a),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:e("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:e("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(a,O,i)=>P(a,O,i).subSurface.refractionIntensity,getTarget:P,set:(a,O,i,H)=>P(O,i,H).subSurface.refractionIntensity=a,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:e("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(a,O,i)=>P(a,O,i).subSurface.translucencyIntensity,getTarget:P,set:(a,O,i,H)=>P(O,i,H).subSurface.translucencyIntensity=a},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:e("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"mi",get:(a,O,i)=>P(a,O,i).subSurface.translucencyColor,getTarget:P,set:(a,O,i,H)=>{var b;return a&&(null===(b=P(O,i,H).subSurface.translucencyColor)||void 0===b?void 0:b.q(a))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:e("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"mi",get:(a,O,i)=>P(a,O,i).subSurface.tintColor,getTarget:P,set:(a,O,i,H)=>P(O,i,H).subSurface.tintColor.q(a)},attenuationDistance:{type:"number",get:(a,O,i)=>P(a,O,i).subSurface.tintColorAtDistance,getTarget:P,set:(a,O,i,H)=>P(O,i,H).subSurface.tintColorAtDistance=a},thicknessFactor:{type:"number",get:(a,O,i)=>P(a,O,i).subSurface.maximumThickness,getTarget:P,set:(a,O,i,H)=>P(O,i,H).subSurface.maximumThickness=a},thicknessTexture:{extensions:{KHR_texture_transform:e("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:a=>a.length,getTarget:a=>a.map((a=>a._babylonLight)),getPropertyName:[a=>"length"]},__array__:{__target__:!0,color:{type:"mi",get:a=>{var O;return null===(O=a._babylonLight)||void 0===O?void 0:O.ub},set:(a,O)=>{var i;return null===(i=O._babylonLight)||void 0===i?void 0:i.ub.q(a)},getTarget:a=>a._babylonLight,getPropertyName:[a=>"diffuse"]},Wb:{type:"number",get:a=>{var O;return null===(O=a._babylonLight)||void 0===O?void 0:O.Wb},set:(a,O)=>O._babylonLight?O._babylonLight.Wb=a:void 0,getTarget:a=>a._babylonLight,getPropertyName:[a=>"intensity"]},range:{type:"number",get:a=>{var O;return null===(O=a._babylonLight)||void 0===O?void 0:O.range},set:(a,O)=>O._babylonLight?O._babylonLight.range=a:void 0,getTarget:a=>a._babylonLight,getPropertyName:[a=>"range"]},spot:{innerConeAngle:{type:"number",get:a=>{var O;return null===(O=a._babylonLight)||void 0===O?void 0:O.innerAngle},set:(a,O)=>O._babylonLight?O._babylonLight.innerAngle=a:void 0,getTarget:a=>a._babylonLight,getPropertyName:[a=>"innerConeAngle"]},outerConeAngle:{type:"number",get:a=>{var O;return null===(O=a._babylonLight)||void 0===O?void 0:O.angle},set:(a,O)=>O._babylonLight?O._babylonLight.angle=a:void 0,getTarget:a=>a._babylonLight,getPropertyName:[a=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:a=>a.length,getTarget:a=>a.map((a=>a._babylonLight)),getPropertyName:[a=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:a=>a.length,getTarget:a=>a.map((a=>a._babylonTexture)),getPropertyName:[a=>"length"]},__array__:{__target__:!0,Wb:{type:"number",get:a=>{var O;return null===(O=a._babylonTexture)||void 0===O?void 0:O.level},set:(a,O)=>{O._babylonTexture&&(O._babylonTexture.level=a)},getTarget:a=>a._babylonTexture},rotation:{type:"Quaternion",get:a=>{var O;return a._babylonTexture&&H.Quaternion.FromRotationMatrix(null===(O=a._babylonTexture)||void 0===O?void 0:O.getReflectionTextureMatrix())},set:(a,O)=>{var i;O._babylonTexture&&(null!==(i=O._babylonTexture.Ua())&&void 0!==i&&i.useRightHandedSystem||(a=H.Quaternion.Inverse(a)),H.Matrix.FromQuaternionToRef(a,O._babylonTexture.getReflectionTextureMatrix()))},getTarget:a=>a._babylonTexture}}}}},animations:{length:{type:"number",get:a=>a.length,getTarget:a=>a.map((a=>a._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:a=>a.length,getTarget:a=>a.map((a=>{var O;return null===(O=a.primitives[0]._instanceData)||void 0===O?void 0:O.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function j(a){return new k(a,h)}function Z(a){const O=a.split("/").map((a=>a.replace(/{}/g,"__array__")));let i=h;for(const H of O)H&&(i=i[H]);if(i&&i.type&&i.get)return i}function F(a,O){const i=a.split("/").map((a=>a.replace(/{}/g,"__array__")));let H=h;for(const b of i)b&&(H=H[b]);H&&H.type&&H.get&&(H.interpolation=O)}function r(a,O){const i=a.split("/").map((a=>a.replace(/{}/g,"__array__")));let H=h;for(const b of i)if(b){if(!H[b]){if("?"===b){H.__ignoreObjectTree__=!0;continue}H[b]={},"__array__"===b&&(H[b].__target__=!0)}H=H[b]}Object.assign(H,O)}},14075:(a,O,i)=>{"use strict";i.r(O),i.d(O,{AnimationPropertyInfo:()=>I,TransformNodeAnimationPropertyInfo:()=>P,WeightAnimationPropertyInfo:()=>e,getQuaternion:()=>Q,getVector3:()=>q,getWeights:()=>k});var H=i(12916),b=i(12395),G=i(14065);function q(a,O,i,H){return b.ZO.MO(O,i).scaleInPlace(H)}function Q(a,O,i,H){return b.Quaternion.MO(O,i).scaleInPlace(H)}function k(a,O,i,H){const b=new Array(a._numMorphTargets);for(let G=0;G<b.length;G++)b[G]=O[i++]*H;return b}class I{constructor(a,O,i,H){this.type=a,this.name=O,this.getValue=i,this.getStride=H}_buildAnimation(a,O,i){const b=new H.b(a,this.name,O,this.type);return b.setKeys(i),b}}class P extends I{buildAnimations(a,O,i,H){const b=[];return b.push({babylonAnimatable:a._babylonTransformNode,babylonAnimation:this._buildAnimation(O,i,H)}),b}}class e extends I{buildAnimations(a,O,i,b){const G=[];if(a._numMorphTargets)for(let q=0;q<a._numMorphTargets;q++){const Q=new H.b(`${O}_${q}`,this.name,i,this.type);if(Q.setKeys(b.map((a=>({frame:a.frame,inTangent:a.inTangent?a.inTangent[q]:void 0,value:a.value[q],outTangent:a.outTangent?a.outTangent[q]:void 0,interpolation:a.interpolation})))),a._primitiveBabylonMeshes)for(const O of a._primitiveBabylonMeshes)if(O.morphTargetManager){const a=O.morphTargetManager.getTarget(q),i=Q.clone();a.animations.push(i),G.push({babylonAnimatable:a,babylonAnimation:i})}}return G}}(0,G.k)("/nodes/{}/translation",[new P(H.b.ANIMATIONTYPE_VECTOR3,"position",q,(()=>3))]),(0,G.k)("/nodes/{}/rotation",[new P(H.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",Q,(()=>4))]),(0,G.k)("/nodes/{}/scale",[new P(H.b.ANIMATIONTYPE_VECTOR3,"Bb",q,(()=>3))]),(0,G.k)("/nodes/{}/weights",[new e(H.b.ANIMATIONTYPE_FLOAT,"influence",k,(a=>a._numMorphTargets))])},14046:(a,O,i)=>{"use strict";class H{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((a,O)=>{this._resolve=a,this._reject=O}))}}var b=i(12395),G=i(12436),q=i(12184),Q=i(12846),k=i(14049),I=i(14057),P=i(12193),e=i(12869),h=i(12916),j=i(12924),Z=i(12236),F=i(12209),r=i(12211);class J{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(a){this._useTextureToStoreBoneMatrices=a,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(a){this._animationPropertiesOverride=a}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(a,O,i){this.name=a,this.id=O,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=b.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new P.e,this.bones=[],this._scene=i||Z.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const H=this._scene.getEngine().getCaps();this._canUseTextureForBones=H.textureFloat&&H.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((a=>!a.getParent()))}getTransformMatrices(a){if(this.needInitialSkinMatrix){if(!a)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return a._bonesTransformMatrices||this.prepare(!0),a._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(a){return this.needInitialSkinMatrix&&a._transformMatrixTexture?a._transformMatrixTexture:this._transformMatrixTexture}Ua(){return this._scene}toString(a){let O=`Name: ${this.name}, nBones: ${this.bones.length}`;if(O+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,a){O+=", Ranges: {";let a=!0;for(const i in this._ranges)a&&(O+=", ",a=!1),O+=i;O+="}"}return O}getBoneIndexByName(a){for(let O=0,i=this.bones.length;O<i;O++)if(this.bones[O].name===a)return O;return-1}createAnimationRange(a,O,i){if(!this._ranges[a]){this._ranges[a]=new j.c(a,O,i);for(let H=0,b=this.bones.length;H<b;H++)this.bones[H].animations[0]&&this.bones[H].animations[0].createRange(a,O,i)}}deleteAnimationRange(a){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let i=0,H=this.bones.length;i<H;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].deleteRange(a,O);this._ranges[a]=null}getAnimationRange(a){return this._ranges[a]||null}getAnimationRanges(){const a=[];let O;for(O in this._ranges)a.push(this._ranges[O]);return a}copyAnimationRange(a,O){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[O]||!a.getAnimationRange(O))return!1;let H=!0;const b=this._getHighestAnimationFrame()+1,G={},q=a.bones;let Q,k;for(k=0,Q=q.length;k<Q;k++)G[q[k].name]=q[k];this.bones.length!==q.length&&(F.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${q.length}`),H=!1);const I=i&&this.dimensionsAtRest&&a.dimensionsAtRest?this.dimensionsAtRest.divide(a.dimensionsAtRest):null;for(k=0,Q=this.bones.length;k<Q;k++){const a=this.bones[k].name,q=G[a];q?H=H&&this.bones[k].copyAnimationRange(q,O,b,i,I):(F.c.Warn("copyAnimationRange: not same rig, missing source bone "+a),H=!1)}const P=a.getAnimationRange(O);return P&&(this._ranges[O]=new j.c(O,P.from+b,P.to+b)),H}returnToRest(){for(const a of this.bones)-1!==a._index&&a.returnToRest()}_getHighestAnimationFrame(){let a=0;for(let O=0,i=this.bones.length;O<i;O++)if(this.bones[O].animations[0]){const i=this.bones[O].animations[0].getHighestFrame();a<i&&(a=i)}return a}beginAnimation(a,O,i,H){const b=this.getAnimationRange(a);return b?this._scene.beginAnimation(this,b.from,b.to,O,i,H):null}static MakeAnimationAdditive(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;const H=a.getAnimationRange(i);if(!H)return null;const b=a._scene.getAllAnimatablesByTarget(a);let G=null;for(let Q=0;Q<b.length;Q++){const a=b[Q];if(a.fromFrame===(null===H||void 0===H?void 0:H.from)&&a.toFrame===(null===H||void 0===H?void 0:H.to)){G=a;break}}const q=a.getAnimatables();for(let Q=0;Q<q.length;Q++){const a=q[Q].animations;if(a)for(let H=0;H<a.length;H++)h.b.MakeAnimationAdditive(a[H],O,i)}return G&&(G.isAdditive=!0),a}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(a){this._meshesWithPoseMatrix.push(a)}_unregisterMeshWithPoseMatrix(a){const O=this._meshesWithPoseMatrix.indexOf(a);O>-1&&this._meshesWithPoseMatrix.splice(O,1)}_computeTransformMatrices(a,O){this.onBeforeComputeObservable.notifyObservers(this);for(let i=0;i<this.bones.length;i++){const H=this.bones[i];H._childUpdateId++;const b=H.getParent();if(b?H.getLocalMatrix().multiplyToRef(b.getFinalMatrix(),H.getFinalMatrix()):O?H.getLocalMatrix().multiplyToRef(O,H.getFinalMatrix()):H.getFinalMatrix().q(H.getLocalMatrix()),-1!==H._index){const O=null===H._index?i:H._index;H.getAbsoluteInverseBindMatrix().multiplyToArray(H.getFinalMatrix(),a,16*O)}}this._identity.copyToArray(a,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const a=this.Ua().getRenderId();if(this._currentRenderId===a)return;this._currentRenderId=a}if(this._numBonesWithLinkedTransformNode>0)for(const a of this.bones)if(a._linkedTransformNode){const O=a._linkedTransformNode;a.position=O.position,O.rotationQuaternion?a.rotationQuaternion=O.rotationQuaternion:a.rotation=O.rotation,a.Bb=O.Bb}if(this.needInitialSkinMatrix)for(const a of this._meshesWithPoseMatrix){const O=a.getPoseMatrix();let i=this._isDirty;if(a._bonesTransformMatrices&&a._bonesTransformMatrices.length===16*(this.bones.length+1)||(a._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),i=!0),i){if(this._synchronizedWithMesh!==a){this._synchronizedWithMesh=a;for(const a of this.bones)if(!a.getParent()){a.getBindMatrix().multiplyToRef(O,b.TmpVectors.Matrix[1]),a._updateAbsoluteBindMatrices(b.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const O=4*(this.bones.length+1);a._transformMatrixTexture&&a._transformMatrixTexture.getSize().width===O||(a._transformMatrixTexture&&a._transformMatrixTexture.dispose(),a._transformMatrixTexture=e.d.CreateRGBATexture(a._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(a._bonesTransformMatrices,O),this.isUsingTextureForMatrices&&a._transformMatrixTexture&&a._transformMatrixTexture.update(a._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=e.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let a=0;a<this.bones.length;a++)this._animatables.push(this.bones[a])}return this._animatables}clone(a,O){const i=new J(a,O||a,this._scene);i.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let H=0;H<this.bones.length;H++){const a=this.bones[H];let O=null;const b=a.getParent();if(b){const a=this.bones.indexOf(b);O=i.bones[a]}const G=new I.d(a.name,i,O,a.getBindMatrix().clone(),a.getRestMatrix().clone());G._index=a._index,a._linkedTransformNode&&G.linkTransformNode(a._linkedTransformNode),r.c.DeepCopy(a.animations,G.animations)}if(this._ranges){i._ranges={};for(const a in this._ranges){const O=this._ranges[a];O&&(i._ranges[a]=O.clone())}}return this._isDirty=!0,i.prepare(!0),i}enableBlending(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const O of this.bones)for(const i of O.animations)i.enableBlending=!0,i.blendingSpeed=a}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Ua().stopAnimation(this),this.Ua().removeSkeleton(this),this._parentContainer){const a=this._parentContainer.skeletons.indexOf(this);a>-1&&this._parentContainer.skeletons.splice(a,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const a={};a.name=this.name,a.id=this.id,this.dimensionsAtRest&&(a.dimensionsAtRest=this.dimensionsAtRest.Cb()),a.bones=[],a.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let i=0;i<this.bones.length;i++){var O;const H=this.bones[i],b=H.getParent(),G={parentBoneIndex:b?this.bones.indexOf(b):-1,index:H.getIndex(),name:H.name,id:H.id,matrix:H.getBindMatrix().Cb(),rest:H.getRestMatrix().Cb(),linkedTransformNodeId:null===(O=H.getTransformNode())||void 0===O?void 0:O.id};a.bones.push(G),H.length&&(G.length=H.length),H.metadata&&(G.metadata=H.metadata),H.animations&&H.animations.length>0&&(G.animation=H.animations[0].serialize()),a.ranges=[];for(const O in this._ranges){const i=this._ranges[O];if(!i)continue;const H={};H.name=O,H.from=i.from,H.to=i.to,a.ranges.push(H)}}return a}static Parse(a,O){const i=new J(a.name,a.id,O);let H;for(a.dimensionsAtRest&&(i.dimensionsAtRest=b.ZO.MO(a.dimensionsAtRest)),i.needInitialSkinMatrix=a.needInitialSkinMatrix,H=0;H<a.bones.length;H++){const O=a.bones[H],G=a.bones[H].index;let q=null;O.parentBoneIndex>-1&&(q=i.bones[O.parentBoneIndex]);const Q=O.rest?b.Matrix.MO(O.rest):null,k=new I.d(O.name,i,q,b.Matrix.MO(O.matrix),Q,null,G);void 0!==O.id&&null!==O.id&&(k.id=O.id),O.length&&(k.length=O.length),O.metadata&&(k.metadata=O.metadata),O.animation&&k.animations.push(h.b.Parse(O.animation)),void 0!==O.linkedTransformNodeId&&null!==O.linkedTransformNodeId&&(i._hasWaitingData=!0,k._waitingTransformNodeId=O.linkedTransformNodeId)}if(a.ranges)for(H=0;H<a.ranges.length;H++){const O=a.ranges[H];i.createAnimationRange(O.name,O.from,O.to)}return i}computeAbsoluteMatrices(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||a)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(a)}getPoseMatrix(){let a=null;return this._meshesWithPoseMatrix.length>0&&(a=this._meshesWithPoseMatrix[0].getPoseMatrix()),a}sortBones(){const a=[],O=new Array(this.bones.length);for(let i=0;i<this.bones.length;i++)this._sortBones(i,a,O);this.bones=a}_sortBones(a,O,i){if(i[a])return;i[a]=!0;const H=this.bones[a];if(!H)return;void 0===H._index&&(H._index=a);const b=H.getParent();b&&this._sortBones(this.bones.indexOf(b),O,i),O.push(H)}setCurrentPoseAsRest(){for(const a of this.bones)a.setCurrentPoseAsRest()}}var ma=i(12730),M=i(12884),C=i(12370),n=i(12813),D=i(12470),U=i(12854),y=i(12826),w=i(12841),K=i(12933),S=i(12492),f=i(14013);class B{set areUpdatesFrozen(a){a?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new S.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,a||(a=Z.b.LastCreatedScene),this._scene=a,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const a=this._scene.getEngine().getCaps();this._canUseTextureForTargets=a.canUseGLVertexID&&a.textureFloat&&a.maxVertexTextureImageUnits>0&&a.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return B.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?B.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(a){this._numMaxInfluencers!==a&&(this._numMaxInfluencers=a,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(a){this._useTextureToStoreTargets!==a&&(this._useTextureToStoreTargets=a,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var a;return B.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(a=this._scene)&&void 0!==a&&a.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(a){return this._activeTargets.data[a]}getTarget(a){return this._targets[a]}getTargetByName(a){for(const O of this._targets)if(O.name===a)return O;return null}addTarget(a){this._targets.push(a),this._targetInfluenceChangedObservers.push(a.onInfluenceChanged.add((a=>{this.areUpdatesFrozen&&a&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(a)}))),this._targetDataLayoutChangedObservers.push(a._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(a){const O=this._targets.indexOf(a);O>=0&&(this._targets.splice(O,1),a.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(O,1)[0]),a._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(O,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(a)}_bind(a){a.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),a.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),a.setTexture("morphTargets",this._targetStoreTexture),a.setInt("morphTargetCount",this.numInfluencers)}clone(){const a=new B(this._scene);for(const O of this._targets)a.addTarget(O.clone());return a.enablePositionMorphing=this.enablePositionMorphing,a.enableNormalMorphing=this.enableNormalMorphing,a.enableTangentMorphing=this.enableTangentMorphing,a.enableUVMorphing=this.enableUVMorphing,a.enableUV2Morphing=this.enableUV2Morphing,a.enableColorMorphing=this.enableColorMorphing,a}serialize(){const a={};a.id=this.uniqueId,a.targets=[];for(const O of this._targets)a.targets.push(O.serialize());return a}_syncActiveTargets(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const O=!!this._targetStoreTexture,i=this.isUsingTextureForTargets;(this._mustSynchronize||O!==i)&&(this._mustSynchronize=!1,this.synchronize());let H=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let b=-1;for(const G of this._targets)if(b++,0!==G.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=B.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(G),this._morphTargetTextureIndices[H]=b,this._tempInfluences[H++]=G.influence}this._morphTargetTextureIndices.length!==H&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,H)),this._influences&&this._influences.length===H||(this._influences=new Float32Array(H));for(let G=0;G<H;G++)this._influences[G]=this._tempInfluences[G];if(a&&this._scene)for(const G of this._scene.meshes)G.morphTargetManager===this&&(i?G._markSubMeshesAsAttributesDirty():G._syncGeometryWithMorphTargetManager())}synchronize(){var a;if(!this._scene||this.areUpdatesFrozen)return;const O=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(a=this._targetStoreTexture)||void 0===a||a.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>O.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const i of this._targets){this._supportsPositions=this._supportsPositions&&i.hasPositions,this._supportsNormals=this._supportsNormals&&i.hasNormals,this._supportsTangents=this._supportsTangents&&i.hasTangents,this._supportsUVs=this._supportsUVs&&i.hasUVs,this._supportsUV2s=this._supportsUV2s&&i.hasUV2s,this._supportsColors=this._supportsColors&&i.hasColors;const a=i.vertexCount;if(0===this._vertexCount)this._vertexCount=a;else if(this._vertexCount!==a)return void F.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${i.name}": ${a}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const a=O.getCaps().maxTextureSize;this._textureWidth>a&&(this._textureHeight=Math.ceil(this._textureWidth/a),this._textureWidth=a);const i=this._targets.length,H=new Float32Array(i*this._textureWidth*this._textureHeight*4);let b=0;for(let O=0;O<i;O++){const a=this._targets[O],i=a.getPositions(),G=a.getNormals(),q=a.getUVs(),Q=a.getTangents(),k=a.getUV2s(),I=a.getColors();b=O*this._textureWidth*this._textureHeight*4;for(let O=0;O<this._vertexCount;O++)this._supportsPositions&&i&&(H[b]=i[3*O],H[b+1]=i[3*O+1],H[b+2]=i[3*O+2],b+=4),this._supportsNormals&&G&&(H[b]=G[3*O],H[b+1]=G[3*O+1],H[b+2]=G[3*O+2],b+=4),this._supportsUVs&&q&&(H[b]=q[2*O],H[b+1]=q[2*O+1],b+=4),this._supportsTangents&&Q&&(H[b]=Q[3*O],H[b+1]=Q[3*O+1],H[b+2]=Q[3*O+2],b+=4),this._supportsUV2s&&k&&(H[b]=k[2*O],H[b+1]=k[2*O+1],b+=4),this._supportsColors&&I&&(H[b]=I[4*O],H[b+1]=I[4*O+1],H[b+2]=I[4*O+2],H[b+3]=I[4*O+3],b+=4)}this._targetStoreTexture=f.d.CreateRGBATexture(H,this._textureWidth,this._textureHeight,i,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const i of this._scene.meshes)i.morphTargetManager===this&&i._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const a=this._parentContainer.morphTargetManagers.indexOf(this);a>-1&&this._parentContainer.morphTargetManagers.splice(a,1),this._parentContainer=null}for(const a of this._targets)this._scene.stopAnimation(a)}}static Parse(a,O){const i=new B(O);for(const H of a.targets)i.addTarget(K.b.Parse(H,O));return i}}B.EnableTextureStorage=!0,B.MaxActiveMorphTargetsInVertexAttributeMode=8,B.ConstantTargetCountForTextureMode=0;var T=i(14060),A=i(12243),E=i(12748);const l=new Map,W=l;function u(a,O,i){c(a)&&F.c.Warn(`Extension with the name '${a}' already exists`),l.set(a,{isGLTFExtension:O,factory:i})}function c(a){return l.delete(a)}var R=i(14065),z=i(12988),x=i(12482);class g{static Get(a,O,i){if(!O||void 0==i||!O[i])throw new Error(`${a}: Failed to find index (${i})`);return O[i]}static TryGet(a,O){return a&&void 0!=O&&a[O]?a[O]:null}static Assign(a){if(a)for(let O=0;O<a.length;O++)a[O].index=O}}function N(a){if(a.min&&a.max){const O=a.min,i=a.max,H=b.TmpVectors.ZO[0].fb(O[0],O[1],O[2]),G=b.TmpVectors.ZO[1].fb(i[0],i[1],i[2]);if(a.normalized&&5126!==a.componentType){let O=1;switch(a.componentType){case 5120:O=127;break;case 5121:O=255;break;case 5122:O=32767;break;case 5123:O=65535}const i=1/O;H.scaleInPlace(i),G.scaleInPlace(i)}return new E.e(H,G)}return null}class v{static RegisterExtension(a,O){u(a,!1,O)}static UnregisterExtension(a){return c(a)}get Fb(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(a){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=a}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((a=>a.dispose&&a.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(a,O,i,H,b,G){let q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=O,this._assetContainer=i,this._loadData(H);let G=null;if(a){const O={};if(this._gltf.nodes)for(const a of this._gltf.nodes)a.name&&(O[a.name]=a.index);G=(a instanceof Array?a:[a]).map((a=>{const i=O[a];if(void 0===i)throw new Error(`Failed to find node '${a}'`);return i}))}return await this._loadAsync(b,q,G,(()=>({meshes:this._getMeshes(),Eh:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=a,this._loadData(O),await this._loadAsync(i,b,null,(()=>{}))}async _loadAsync(a,O,i,H){return await Promise.resolve().then((async()=>{this._rootUrl=a,this._uniqueRootUrl=!a.startsWith("file:")&&O?a:`${a}${Date.now()}/`,this._fileName=O,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const b=`${T.h[T.h.LOADING]} => ${T.h[T.h.READY]}`,G=`${T.h[T.h.LOADING]} => ${T.h[T.h.COMPLETE]}`;this._parent._startPerformanceCounter(b),this._parent._startPerformanceCounter(G),this._parent._setState(T.h.LOADING),this._extensionsOnLoading();const Q=new Array;if(!this.parent.loadOnlyMaterials)if(i)Q.push(this.loadSceneAsync("/nodes",{nodes:i,index:-1}));else if(void 0!=this._gltf.rO||this._gltf.scenes&&this._gltf.scenes[0]){const a=g.Get("/scene",this._gltf.scenes,this._gltf.rO||0);Q.push(this.loadSceneAsync(`/scenes/${a.index}`,a))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let a=0;a<this._gltf.materials.length;++a){const O=this._gltf.materials[a],i="/materials/"+a,H=ma.b.TriangleFillMode;Q.push(this._loadMaterialAsync(i,O,null,H,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&Q.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&Q.push(this._compileShadowGeneratorsAsync());const k=Promise.all(Q).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Ok(!0);for(const a of this._babylonScene.materials){const O=a;void 0!==O.maxSimultaneousLights&&(O.maxSimultaneousLights=Math.max(O.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(T.h.READY),this._skipStartAnimationStep||this._startAnimations(),H()}));return await k.then((a=>(this._parent._endPerformanceCounter(b),q.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(G),this._parent._setState(T.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(a=>{this._parent.onErrorObservable.notifyObservers(a),this._parent.onErrorObservable.clear(),this.dispose()}))})),a)))})).catch((a=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(a),this._parent.onErrorObservable.clear(),this.dispose()),a}))}_loadData(a){if(this._gltf=a.json,this._setupData(),a.bin){const O=this._gltf.buffers;if(O&&O[0]&&!O[0].uri){const i=O[0];(i.byteLength<a.bin.byteLength-3||i.byteLength>a.bin.byteLength)&&F.c.Warn(`Binary buffer length (${i.byteLength}) from JSON does not match chunk length (${a.bin.byteLength})`),this._bin=a.bin}else F.c.Warn("Unexpected BIN chunk")}}_setupData(){if(g.Assign(this._gltf.accessors),g.Assign(this._gltf.animations),g.Assign(this._gltf.buffers),g.Assign(this._gltf.bufferViews),g.Assign(this._gltf.cameras),g.Assign(this._gltf.images),g.Assign(this._gltf.materials),g.Assign(this._gltf.meshes),g.Assign(this._gltf.nodes),g.Assign(this._gltf.samplers),g.Assign(this._gltf.scenes),g.Assign(this._gltf.skins),g.Assign(this._gltf.textures),this._gltf.nodes){const a={};for(const i of this._gltf.nodes)if(i.children)for(const O of i.children)a[O]=i.index;const O=this._createRootNode();for(const i of this._gltf.nodes){const H=a[i.index];i.parent=void 0===H?O:this._gltf.nodes[H]}}}async _loadExtensionsAsync(){const a=[];if(W.forEach(((O,i)=>{var H;!1===(null===(H=this.parent.extensionOptions[i])||void 0===H?void 0:H.enabled)?O.isGLTFExtension&&this.isExtensionUsed(i)&&F.c.Warn(`Extension ${i} is used but has been explicitly disabled.`):O.isGLTFExtension&&!this.isExtensionUsed(i)||a.push((async()=>{const a=await O.factory(this);return a.name!==i&&F.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${a.name} !== ${i}`),this._parent.onExtensionLoadedObservable.notifyObservers(a),a})())})),this._extensions.push(...await Promise.all(a)),this._extensions.sort(((a,O)=>(a.order||Number.MAX_VALUE)-(O.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const i of this._gltf.extensionsRequired){if(!this._extensions.some((a=>a.name===i&&a.enabled))){var O;if(!1===(null===(O=this.parent.extensionOptions[i])||void 0===O?void 0:O.enabled))throw new Error(`Required extension ${i} is disabled`);throw new Error(`Required extension ${i} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new w.d("__root__",this._babylonScene);this._rootBabylonMesh=a,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Ok(!1);const O={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case T.e.AUTO:this._babylonScene.useRightHandedSystem||(O.rotation=[0,1,0,0],O.scale=[1,1,-1],v._LoadTransform(O,this._rootBabylonMesh));break;case T.e.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(a),O}loadSceneAsync(a,O){const i=this._extensionsLoadSceneAsync(a,O);if(i)return i;const H=new Array;if(this.logOpen(`${a} ${O.name||""}`),O.nodes)for(const b of O.nodes){const O=g.Get(`${a}/nodes/${b}`,this._gltf.nodes,b);H.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(a=>{a.parent=this._rootBabylonMesh})))}for(const b of this._postSceneLoadActions)b();return H.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(H).then((()=>{}))}_forEachPrimitive(a,O){if(a._primitiveBabylonMeshes)for(const i of a._primitiveBabylonMeshes)O(i)}_getGeometries(){const a=[],O=this._gltf.nodes;if(O)for(const i of O)this._forEachPrimitive(i,(O=>{const i=O.wb;i&&-1===a.indexOf(i)&&a.push(i)}));return a}_getMeshes(){const a=[];this._rootBabylonMesh instanceof y.e&&a.push(this._rootBabylonMesh);const O=this._gltf.nodes;if(O)for(const i of O)this._forEachPrimitive(i,(O=>{a.push(O)}));return a}_getTransformNodes(){const a=[],O=this._gltf.nodes;if(O)for(const i of O)i._babylonTransformNode&&"zb"===i._babylonTransformNode.getClassName()&&a.push(i._babylonTransformNode),i._babylonTransformNodeForSkin&&a.push(i._babylonTransformNodeForSkin);return a}_getSkeletons(){const a=[],O=this._gltf.skins;if(O)for(const i of O)i._data&&a.push(i._data.babylonSkeleton);return a}_getAnimationGroups(){const a=[],O=this._gltf.animations;if(O)for(const i of O)i._babylonAnimationGroup&&a.push(i._babylonAnimationGroup);return a}_startAnimations(){switch(this._parent.animationStartMode){case T.c.NONE:break;case T.c.FIRST:{const a=this._getAnimationGroups();0!==a.length&&a[0].start(!0);break}case T.c.ALL:{const a=this._getAnimationGroups();for(const O of a)O.start(!0);break}default:return void F.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const H=this._extensionsLoadNodeAsync(a,O,i);if(H)return H;if(O._babylonTransformNode)throw new Error(`${a}: Invalid recursive node hierarchy`);const b=new Array;this.logOpen(`${a} ${O.name||""}`);const G=H=>{if(v.AddPointerMetadata(H,a),v._LoadTransform(O,H),void 0!=O.camera){const i=g.Get(`${a}/camera`,this._gltf.cameras,O.camera);b.push(this.loadCameraAsync(`/cameras/${i.index}`,i,(a=>{a.parent=H,this._babylonScene.useRightHandedSystem||(H.Bb.x=-1)})))}if(O.children)for(const i of O.children){const O=g.Get(`${a}/children/${i}`,this._gltf.nodes,i);b.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(a=>{a.parent=H})))}i(H)},q=void 0!=O.mesh,Q=this._parent.loadSkins&&void 0!=O.skin;if(!q||Q){const a=O.name||`node${O.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new n.d(a,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==O.mesh?O._babylonTransformNode=i:O._babylonTransformNodeForSkin=i,G(i)}if(q)if(Q){const i=g.Get(`${a}/mesh`,this._gltf.meshes,O.mesh);b.push(this._loadMeshAsync(`/meshes/${i.index}`,O,i,(i=>{const H=O._babylonTransformNodeForSkin;i.metadata=(0,z.c)(H.metadata,i.metadata||{});const G=g.Get(`${a}/skin`,this._gltf.skins,O.skin);b.push(this._loadSkinAsync(`/skins/${G.index}`,O,G,(a=>{this._forEachPrimitive(O,(O=>{O.skeleton=a})),this._postSceneLoadActions.push((()=>{if(void 0!=G.skeleton){const a=g.Get(`/skins/${G.index}/skeleton`,this._gltf.nodes,G.skeleton).parent;O.index===a.index?i.parent=H.parent:i.parent=a._babylonTransformNode}else i.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:H,skinnedNode:i})}))})))})))}else{const i=g.Get(`${a}/mesh`,this._gltf.meshes,O.mesh);b.push(this._loadMeshAsync(`/meshes/${i.index}`,O,i,G))}return this.logClose(),Promise.all(b).then((()=>(this._forEachPrimitive(O,(a=>{const O=a;!O.isAnInstance&&O.wb&&O.wb.useBoundingInfoFromGeometry?a.Ea():a.refreshBoundingInfo(!0,!0)})),O._babylonTransformNode)))}_loadMeshAsync(a,O,i,H){const b=i.primitives;if(!b||!b.length)throw new Error(`${a}: Primitives are missing`);void 0==b[0].index&&g.Assign(b);const G=new Array;this.logOpen(`${a} ${i.name||""}`);const q=O.name||`node${O.index}`;if(1===b.length){const H=i.primitives[0];G.push(this._loadMeshPrimitiveAsync(`${a}/primitives/${H.index}`,q,O,i,H,(a=>{O._babylonTransformNode=a,O._primitiveBabylonMeshes=[a]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,O._babylonTransformNode=new n.d(q,this._babylonScene),O._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._primitiveBabylonMeshes=[];for(const H of b)G.push(this._loadMeshPrimitiveAsync(`${a}/primitives/${H.index}`,`${q}_primitive${H.index}`,O,i,H,(a=>{a.parent=O._babylonTransformNode,O._primitiveBabylonMeshes.push(a)})))}return H(O._babylonTransformNode),this.logClose(),Promise.all(G).then((()=>O._babylonTransformNode))}_loadMeshPrimitiveAsync(a,O,i,H,b,G){const q=this._extensionsLoadMeshPrimitiveAsync(a,O,i,H,b,G);if(q)return q;this.logOpen(`${a}`);const Q=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==i.skin&&!H.primitives[0].targets;let k,I;if(Q&&b._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,k=b._instanceData.babylonSourceMesh.createInstance(O),k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I=b._instanceData.promise;else{const G=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new w.d(O,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.sideOrientation=this._babylonScene.useRightHandedSystem?ma.b.CounterClockWiseSideOrientation:ma.b.ClockWiseSideOrientation,this._createMorphTargets(a,i,H,b,q),G.push(this._loadVertexDataAsync(a,b,q).then((async O=>await this._loadMorphTargetsAsync(a,b,q,O).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,O.Ta(q),O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const P=v._GetDrawMode(a,b.mode);if(void 0==b.material){let a=this._defaultBabylonMaterialData[P];a||(a=this._createDefaultMaterial("__GLTFLoader._default",P),this._parent.onMaterialLoadedObservable.notifyObservers(a),this._defaultBabylonMaterialData[P]=a),q.material=a}else if(!this.parent.skipMaterials){const O=g.Get(`${a}/material`,this._gltf.materials,b.material);G.push(this._loadMaterialAsync(`/materials/${O.index}`,O,q,P,(a=>{q.material=a})))}I=Promise.all(G),Q&&(b._instanceData={babylonSourceMesh:q,promise:I}),k=q}return v.AddPointerMetadata(k,a),this._parent.onMeshLoadedObservable.notifyObservers(k),G(k),this.logClose(),I.then((()=>k))}_loadVertexDataAsync(a,O,i){const H=this._extensionsLoadVertexDataAsync(a,O,i);if(H)return H;const b=O.attributes;if(!b)throw new Error(`${a}: Attributes are missing`);const G=new Array,q=new U.b(i.name,this._babylonScene);if(void 0==O.indices)i.isUnIndexed=!0;else{const i=g.Get(`${a}/indices`,this._gltf.accessors,O.indices);G.push(this._loadIndicesAccessorAsync(`/accessors/${i.index}`,i).then((a=>{q.setIndices(a)})))}const Q=(O,H,Q)=>{if(void 0==b[O])return;i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(H)&&i._delayInfo.push(H);const k=g.Get(`${a}/attributes/${O}`,this._gltf.accessors,b[O]);G.push(this._loadVertexAccessorAsync(`/accessors/${k.index}`,k,H).then((a=>{if(a.getKind()===D.c.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!i.skeleton){const a=N(k);a&&(q._boundingInfo=a,q.useBoundingInfoFromGeometry=!0)}q.setVerticesBuffer(a,k.count)}))),H==D.c.MatricesIndicesExtraKind&&(i.numBoneInfluencers=8),Q&&Q(k)};return Q("POSITION",D.c.PositionKind),Q("NORMAL",D.c.NormalKind),Q("TANGENT",D.c.TangentKind),Q("TEXCOORD_0",D.c.UVKind),Q("TEXCOORD_1",D.c.UV2Kind),Q("TEXCOORD_2",D.c.UV3Kind),Q("TEXCOORD_3",D.c.UV4Kind),Q("TEXCOORD_4",D.c.UV5Kind),Q("TEXCOORD_5",D.c.UV6Kind),Q("JOINTS_0",D.c.MatricesIndicesKind),Q("WEIGHTS_0",D.c.MatricesWeightsKind),Q("JOINTS_1",D.c.MatricesIndicesExtraKind),Q("WEIGHTS_1",D.c.MatricesWeightsExtraKind),Q("COLOR_0",D.c.ColorKind,(a=>{"VEC4"===a.type&&(i.hasVertexAlpha=!0)})),Promise.all(G).then((()=>q))}_createMorphTargets(a,O,i,H,b){if(!H.targets||!this._parent.loadMorphTargets)return;if(void 0==O._numMorphTargets)O._numMorphTargets=H.targets.length;else if(H.targets.length!==O._numMorphTargets)throw new Error(`${a}: Primitives do not have the same number of targets`);const G=i.extras?i.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,b.morphTargetManager=new B(this._babylonScene),b.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.morphTargetManager.areUpdatesFrozen=!0;for(let q=0;q<H.targets.length;q++){const a=O.weights?O.weights[q]:i.weights?i.weights[q]:0,H=G?G[q]:`morphTarget${q}`;b.morphTargetManager.addTarget(new K.b(H,a,b.Ua()))}}_loadMorphTargetsAsync(a,O,i,H){if(!O.targets||!this._parent.loadMorphTargets)return Promise.resolve();const b=new Array,G=i.morphTargetManager;for(let q=0;q<G.numTargets;q++){const i=G.getTarget(q);b.push(this._loadMorphTargetVertexDataAsync(`${a}/targets/${q}`,H,O.targets[q],i))}return Promise.all(b).then((()=>{G.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(a,O,i,H){const b=new Array,G=(H,G,q)=>{if(void 0==i[H])return;const Q=O.getVertexBuffer(G);if(!Q)return;const k=g.Get(`${a}/${H}`,this._gltf.accessors,i[H]);b.push(this._loadFloatAccessorAsync(`/accessors/${k.index}`,k).then((a=>{q(Q,a)})))};return G("POSITION",D.c.PositionKind,((a,O)=>{const i=new Float32Array(O.length);a.forEach(O.length,((a,H)=>{i[H]=O[H]+a})),H.setPositions(i)})),G("NORMAL",D.c.NormalKind,((a,O)=>{const i=new Float32Array(O.length);a.forEach(i.length,((a,H)=>{i[H]=O[H]+a})),H.setNormals(i)})),G("TANGENT",D.c.TangentKind,((a,O)=>{const i=new Float32Array(O.length/3*4);let b=0;a.forEach(O.length/3*4,((a,H)=>{(H+1)%4!==0&&(i[b]=O[b]+a,b++)})),H.setTangents(i)})),G("TEXCOORD_0",D.c.UVKind,((a,O)=>{const i=new Float32Array(O.length);a.forEach(O.length,((a,H)=>{i[H]=O[H]+a})),H.setUVs(i)})),G("TEXCOORD_1",D.c.UV2Kind,((a,O)=>{const i=new Float32Array(O.length);a.forEach(O.length,((a,H)=>{i[H]=O[H]+a})),H.setUV2s(i)})),G("COLOR_0",D.c.ColorKind,((O,i)=>{let b=null;const G=O.getSize();if(3===G){b=new Float32Array(i.length/3*4),O.forEach(i.length,((a,O)=>{const H=Math.floor(O/3),G=O%3;b[4*H+G]=i[3*H+G]+a}));for(let a=0;a<i.length/3;++a)b[4*a+3]=1}else{if(4!==G)throw new Error(`${a}: Invalid number of components (${G}) for COLOR_0 attribute`);b=new Float32Array(i.length),O.forEach(i.length,((a,O)=>{b[O]=i[O]+a}))}H.setColors(b)})),await Promise.all(b).then((()=>{}))}static _LoadTransform(a,O){if(void 0!=a.skin)return;let i=b.ZO.Zero(),H=b.Quaternion.Identity(),G=b.ZO.One();if(a.matrix){b.Matrix.MO(a.matrix).decompose(G,H,i)}else a.translation&&(i=b.ZO.MO(a.translation)),a.rotation&&(H=b.Quaternion.MO(a.rotation)),a.scale&&(G=b.ZO.MO(a.scale));O.position=i,O.rotationQuaternion=H,O.Bb=G}_loadSkinAsync(a,O,i,H){if(!this._parent.loadSkins)return Promise.resolve();const b=this._extensionsLoadSkinAsync(a,O,i);if(b)return b;if(i._data)return H(i._data.babylonSkeleton),i._data.promise;const G=`skeleton${i.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new J(i.name||G,G,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(a,i,q);const Q=this._loadSkinInverseBindMatricesDataAsync(a,i).then((a=>{this._updateBoneMatrices(q,a)}));return i._data={babylonSkeleton:q,promise:Q},H(q),Q}_loadBones(a,O,i){if(void 0==O.skeleton||this._parent.alwaysComputeSkeletonRootNode){const i=this._findSkeletonRootNode(`${a}/joints`,O.joints);if(i)if(void 0===O.skeleton)O.skeleton=i.index;else{const H=(a,O)=>{for(;O.parent;O=O.parent)if(O.parent===a)return!0;return!1},b=g.Get(`${a}/skeleton`,this._gltf.nodes,O.skeleton);b===i||H(b,i)||(F.c.Warn(`${a}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),O.skeleton=i.index)}else F.c.Warn(`${a}: Failed to find common root`)}const H={};for(const b of O.joints){const G=g.Get(`${a}/joints/${b}`,this._gltf.nodes,b);this._loadBone(G,O,i,H)}}_findSkeletonRootNode(a,O){if(0===O.length)return null;const i={};for(const b of O){const O=[];let H=g.Get(`${a}/${b}`,this._gltf.nodes,b);for(;-1!==H.index;)O.unshift(H),H=H.parent;i[b]=O}let H=null;for(let b=0;;++b){let a=i[O[0]];if(b>=a.length)return H;const G=a[b];for(let q=1;q<O.length;++q)if(a=i[O[q]],b>=a.length||G!==a[b])return H;H=G}}_loadBone(a,O,i,H){a._isJoint=!0;let b=H[a.index];if(b)return b;let G=null;a.index!==O.skeleton&&(a.parent&&-1!==a.parent.index?G=this._loadBone(a.parent,O,i,H):void 0!==O.skeleton&&F.c.Warn(`/skins/${O.index}/skeleton: Skeleton node is not a common root`));const q=O.joints.indexOf(a.index);return b=new I.d(a.name||`joint${a.index}`,i,G,this._getNodeMatrix(a),null,null,q),H[a.index]=b,this._postSceneLoadActions.push((()=>{b.linkTransformNode(a._babylonTransformNode)})),b}_loadSkinInverseBindMatricesDataAsync(a,O){if(void 0==O.inverseBindMatrices)return Promise.resolve(null);const i=g.Get(`${a}/inverseBindMatrices`,this._gltf.accessors,O.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${i.index}`,i)}_updateBoneMatrices(a,O){for(const i of a.bones){const a=b.Matrix.Identity(),H=i._index;O&&-1!==H&&(b.Matrix.FromArrayToRef(O,16*H,a),a.invertToRef(a));const G=i.getParent();G&&a.multiplyToRef(G.getAbsoluteInverseBindMatrix(),a),i.Ub(a,!1,!1),i._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(a){return a.matrix?b.Matrix.MO(a.matrix):b.Matrix.Compose(a.scale?b.ZO.MO(a.scale):b.ZO.One(),a.rotation?b.Quaternion.MO(a.rotation):b.Quaternion.Identity(),a.translation?b.ZO.MO(a.translation):b.ZO.Zero())}loadCameraAsync(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const H=this._extensionsLoadCameraAsync(a,O,i);if(H)return H;const G=new Array;this.logOpen(`${a} ${O.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new k.c(O.name||`camera${O.index}`,b.ZO.Zero(),this._babylonScene,!1);switch(q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._babylonCamera=q,q.setTarget(new b.ZO(0,0,-1)),O.type){case"perspective":{const i=O.perspective;if(!i)throw new Error(`${a}: Camera perspective properties are missing`);q.fov=i.yfov,q.Db=i.znear,q.maxZ=i.zfar||0;break}case"orthographic":if(!O.orthographic)throw new Error(`${a}: Camera orthographic properties are missing`);q.mode=Q.e.ORTHOGRAPHIC_CAMERA,q.orthoLeft=-O.orthographic.xmag,q.orthoRight=O.orthographic.xmag,q.orthoBottom=-O.orthographic.ymag,q.orthoTop=O.orthographic.ymag,q.Db=O.orthographic.znear,q.maxZ=O.orthographic.zfar;break;default:throw new Error(`${a}: Invalid camera type (${O.type})`)}return v.AddPointerMetadata(q,a),this._parent.onCameraLoadedObservable.notifyObservers(q),i(q),this.logClose(),Promise.all(G).then((()=>q))}_loadAnimationsAsync(){const a=this._gltf.animations;if(!a)return Promise.resolve();const O=new Array;for(let i=0;i<a.length;i++){const H=a[i];O.push(this.loadAnimationAsync(`/animations/${H.index}`,H).then((a=>{0===a.targetedAnimations.length&&a.dispose()})))}return Promise.all(O).then((()=>{}))}loadAnimationAsync(a,O){const H=this._extensionsLoadAnimationAsync(a,O);return H||i.e(78).then(i.bind(i,15571)).then((i=>{let{AnimationGroup:H}=i;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new H(O.name||`animation${O.index}`,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._babylonAnimationGroup=b;const G=new Array;g.Assign(O.channels),g.Assign(O.samplers);for(const q of O.channels)G.push(this._loadAnimationChannelAsync(`${a}/channels/${q.index}`,a,O,q,((a,O)=>{a.animations=a.animations||[],a.animations.push(O),b.addTargetedAnimation(O,a)})));return Promise.all(G).then((()=>(b.normalize(0),b)))}))}async _loadAnimationChannelAsync(a,O,H,b,G){const q=this._extensionsLoadAnimationChannelAsync(a,O,H,b,G);if(q)return await q;if(void 0==b.target.node)return await Promise.resolve();const Q=g.Get(`${a}/target/node`,this._gltf.nodes,b.target.node),k=b.target.path,I="weights"===k;if(I&&!Q._numMorphTargets||!I&&!Q._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!I&&!Q._isJoint)return await Promise.resolve();let P;switch(await Promise.resolve().then(i.bind(i,14075)),k){case"translation":var e;P=null===(e=(0,R.f)("/nodes/{}/translation"))||void 0===e?void 0:e.interpolation;break;case"rotation":var h;P=null===(h=(0,R.f)("/nodes/{}/rotation"))||void 0===h?void 0:h.interpolation;break;case"scale":var j;P=null===(j=(0,R.f)("/nodes/{}/scale"))||void 0===j?void 0:j.interpolation;break;case"weights":var Z;P=null===(Z=(0,R.f)("/nodes/{}/weights"))||void 0===Z?void 0:Z.interpolation;break;default:throw new Error(`${a}/target/path: Invalid value (${b.target.path})`)}if(!P)throw new Error(`${a}/target/path: Could not find interpolation properties for target path (${b.target.path})`);const F={object:Q,info:P};return await this._loadAnimationChannelFromTargetInfoAsync(a,O,H,b,F,G)}_loadAnimationChannelFromTargetInfoAsync(a,O,i,H,b,G){const q=this.parent.targetFps,Q=1/q,k=g.Get(`${a}/sampler`,i.samplers,H.sampler);return this._loadAnimationSamplerAsync(`${O}/samplers/${H.sampler}`,k).then((a=>{let O=0;const k=b.object,I=b.info;for(const b of I){const I=b.getStride(k),P=a.input,e=a.output,h=new Array(P.length);let j=0;switch(a.interpolation){case"STEP":for(let a=0;a<P.length;a++){const O=b.getValue(k,e,j,1);j+=I,h[a]={frame:P[a]*q,value:O,interpolation:1}}break;case"CUBICSPLINE":for(let a=0;a<P.length;a++){const O=b.getValue(k,e,j,Q);j+=I;const i=b.getValue(k,e,j,1);j+=I;const H=b.getValue(k,e,j,Q);j+=I,h[a]={frame:P[a]*q,inTangent:O,value:i,outTangent:H}}break;case"LINEAR":for(let a=0;a<P.length;a++){const O=b.getValue(k,e,j,1);j+=I,h[a]={frame:P[a]*q,value:O}}}if(j>0){const a=`${i.name||`animation${i.index}`}_channel${H.index}_${O}`,Q=b.buildAnimations(k,a,q,h);for(const i of Q)O++,G(i.babylonAnimatable,i.babylonAnimation)}}}))}_loadAnimationSamplerAsync(a,O){if(O._data)return O._data;const i=O.interpolation||"LINEAR";switch(i){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${a}/interpolation: Invalid value (${O.interpolation})`)}const H=g.Get(`${a}/input`,this._gltf.accessors,O.input),b=g.Get(`${a}/output`,this._gltf.accessors,O.output);return O._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${H.index}`,H),this._loadFloatAccessorAsync(`/accessors/${b.index}`,b)]).then((a=>{let[O,H]=a;return{input:O,interpolation:i,output:H}})),O._data}loadBufferAsync(a,O,i,H){const b=this._extensionsLoadBufferAsync(a,O,i,H);if(b)return b;if(!O._data)if(O.uri)O._data=this.loadUriAsync(`${a}/uri`,O,O.uri);else{if(!this._bin)throw new Error(`${a}: Uri is missing or the binary glTF is missing its binary chunk`);O._data=this._bin.readAsync(0,O.byteLength)}return O._data.then((O=>{try{return new Uint8Array(O.buffer,O.byteOffset+i,H)}catch(b){throw new Error(`${a}: ${b.message}`)}}))}loadBufferViewAsync(a,O){const i=this._extensionsLoadBufferViewAsync(a,O);if(i)return i;if(O._data)return O._data;const H=g.Get(`${a}/buffer`,this._gltf.buffers,O.buffer);return O._data=this.loadBufferAsync(`/buffers/${H.index}`,H,O.byteOffset||0,O.byteLength),O._data}_loadAccessorAsync(a,O,i){if(O._data)return O._data;const H=v._GetNumComponents(a,O.type),b=H*D.c.GetTypeByteLength(O.componentType),G=H*O.count;if(void 0==O.bufferView)O._data=Promise.resolve(new i(G));else{const q=g.Get(`${a}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((Q=>{if(5126!==O.componentType||O.normalized||q.byteStride&&q.byteStride!==b){const a=new i(G);return D.c.ForEach(Q,O.byteOffset||0,q.byteStride||b,H,O.componentType,a.length,O.normalized||!1,((O,i)=>{a[i]=O})),a}return v._GetTypedArray(a,O.componentType,Q,O.byteOffset,G)}))}if(O.sparse){const G=O.sparse;O._data=O._data.then((q=>{const Q=q,k=g.Get(`${a}/sparse/indices/bufferView`,this._gltf.bufferViews,G.indices.bufferView),I=g.Get(`${a}/sparse/values/bufferView`,this._gltf.bufferViews,G.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${k.index}`,k),this.loadBufferViewAsync(`/bufferViews/${I.index}`,I)]).then((q=>{let[k,I]=q;const P=v._GetTypedArray(`${a}/sparse/indices`,G.indices.componentType,k,G.indices.byteOffset,G.count),e=H*G.count;let h;if(5126!==O.componentType||O.normalized){const q=v._GetTypedArray(`${a}/sparse/values`,O.componentType,I,G.values.byteOffset,e);h=new i(e),D.c.ForEach(q,0,b,H,O.componentType,h.length,O.normalized||!1,((a,O)=>{h[O]=a}))}else h=v._GetTypedArray(`${a}/sparse/values`,O.componentType,I,G.values.byteOffset,e);let j=0;for(let a=0;a<P.length;a++){let O=P[a]*H;for(let a=0;a<H;a++)Q[O++]=h[j++]}return Q}))}))}return O._data}_loadFloatAccessorAsync(a,O){return this._loadAccessorAsync(a,O,Float32Array)}_loadIndicesAccessorAsync(a,O){if("SCALAR"!==O.type)throw new Error(`${a}/type: Invalid value ${O.type}`);if(5121!==O.componentType&&5123!==O.componentType&&5125!==O.componentType)throw new Error(`${a}/componentType: Invalid value ${O.componentType}`);if(O._data)return O._data;if(O.sparse){const i=v._GetTypedArrayConstructor(`${a}/componentType`,O.componentType);O._data=this._loadAccessorAsync(a,O,i)}else{const i=g.Get(`${a}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i).then((i=>v._GetTypedArray(a,O.componentType,i,O.byteOffset,O.count)))}return O._data}_loadVertexBufferViewAsync(a){if(a._babylonBuffer)return a._babylonBuffer;const O=this._babylonScene.getEngine();return a._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${a.index}`,a).then((a=>new D.b(O,a,!1))),a._babylonBuffer}_loadVertexAccessorAsync(a,O,i){var H;if(null!==(H=O._babylonVertexBuffer)&&void 0!==H&&H[i])return O._babylonVertexBuffer[i];O._babylonVertexBuffer||(O._babylonVertexBuffer={});const b=this._babylonScene.getEngine();if(O.sparse||void 0==O.bufferView)O._babylonVertexBuffer[i]=this._loadFloatAccessorAsync(a,O).then((a=>new D.c(b,a,i,!1)));else{const H=g.Get(`${a}/bufferView`,this._gltf.bufferViews,O.bufferView);O._babylonVertexBuffer[i]=this._loadVertexBufferViewAsync(H).then((G=>{const q=v._GetNumComponents(a,O.type);return new D.c(b,G,i,!1,void 0,H.byteStride,void 0,O.byteOffset,q,O.componentType,O.normalized,!0,void 0,!0)}))}return O._babylonVertexBuffer[i]}_loadMaterialMetallicRoughnessPropertiesAsync(a,O,i){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);const H=new Array;return O&&(O.baseColorFactor?(i.albedoColor=G.mi.MO(O.baseColorFactor),i.alpha=O.baseColorFactor[3]):i.albedoColor=G.mi.White(),i.metallic=void 0==O.metallicFactor?1:O.metallicFactor,i.roughness=void 0==O.roughnessFactor?1:O.roughnessFactor,O.baseColorTexture&&H.push(this.loadTextureInfoAsync(`${a}/baseColorTexture`,O.baseColorTexture,(a=>{a.name=`${i.name} (Base Color)`,i.albedoTexture=a}))),O.metallicRoughnessTexture&&(O.metallicRoughnessTexture.nonColorData=!0,H.push(this.loadTextureInfoAsync(`${a}/metallicRoughnessTexture`,O.metallicRoughnessTexture,(a=>{a.name=`${i.name} (Metallic Roughness)`,i.metallicTexture=a}))),i.useMetallnessFromMetallicTextureBlue=!0,i.useRoughnessFromMetallicTextureGreen=!0,i.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(H).then((()=>{}))}_loadMaterialAsync(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const G=this._extensionsLoadMaterialAsync(a,O,i,H,b);if(G)return G;O._data=O._data||{};let q=O._data[H];if(!q){this.logOpen(`${a} ${O.name||""}`);const i=this.createMaterial(a,O,H);q={babylonMaterial:i,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(a,O,i)},O._data[H]=q,v.AddPointerMetadata(i,a),this._parent.onMaterialLoadedObservable.notifyObservers(i),this.logClose()}return i&&(q.babylonMeshes.push(i),i.Pb.addOnce((()=>{const a=q.babylonMeshes.indexOf(i);-1!==a&&q.babylonMeshes.splice(a,1)}))),b(q.babylonMaterial),q.promise.then((()=>q.babylonMaterial))}_createDefaultMaterial(a,O){this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new M.e(a,this._babylonScene);return i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.fillMode=O,i.enableSpecularAntiAliasing=!0,i.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,i.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,i.transparencyMode=M.e.PBRMATERIAL_OPAQUE,i.metallic=1,i.roughness=1,i}createMaterial(a,O,i){const H=this._extensionsCreateMaterial(a,O,i);if(H)return H;const b=O.name||`material${O.index}`;return this._createDefaultMaterial(b,i)}loadMaterialPropertiesAsync(a,O,i){const H=this._extensionsLoadMaterialPropertiesAsync(a,O,i);if(H)return H;const b=new Array;return b.push(this.loadMaterialBasePropertiesAsync(a,O,i)),O.pbrMetallicRoughness&&b.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${a}/pbrMetallicRoughness`,O.pbrMetallicRoughness,i)),this.loadMaterialAlphaProperties(a,O,i),Promise.all(b).then((()=>{}))}loadMaterialBasePropertiesAsync(a,O,i){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);const H=new Array;return i.emissiveColor=O.emissiveFactor?G.mi.MO(O.emissiveFactor):new G.mi(0,0,0),O.doubleSided&&(i.Sb=!1,i.twoSidedLighting=!0),O.normalTexture&&(O.normalTexture.nonColorData=!0,H.push(this.loadTextureInfoAsync(`${a}/normalTexture`,O.normalTexture,(a=>{a.name=`${i.name} (Normal)`,i.bumpTexture=a}))),i.invertNormalMapX=!this._babylonScene.useRightHandedSystem,i.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=O.normalTexture.scale&&i.bumpTexture&&(i.bumpTexture.level=O.normalTexture.scale),i.forceIrradianceInFragment=!0),O.occlusionTexture&&(O.occlusionTexture.nonColorData=!0,H.push(this.loadTextureInfoAsync(`${a}/occlusionTexture`,O.occlusionTexture,(a=>{a.name=`${i.name} (Occlusion)`,i.ambientTexture=a}))),i.useAmbientInGrayScale=!0,void 0!=O.occlusionTexture.strength&&(i.ambientTextureStrength=O.occlusionTexture.strength)),O.emissiveTexture&&H.push(this.loadTextureInfoAsync(`${a}/emissiveTexture`,O.emissiveTexture,(a=>{a.name=`${i.name} (Emissive)`,i.emissiveTexture=a}))),Promise.all(H).then((()=>{}))}loadMaterialAlphaProperties(a,O,i){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);switch(O.alphaMode||"OPAQUE"){case"OPAQUE":i.transparencyMode=M.e.PBRMATERIAL_OPAQUE,i.alpha=1;break;case"MASK":i.transparencyMode=M.e.PBRMATERIAL_ALPHATEST,i.alphaCutOff=void 0==O.alphaCutoff?.5:O.alphaCutoff,i.albedoTexture&&(i.albedoTexture.nb=!0);break;case"BLEND":i.transparencyMode=M.e.PBRMATERIAL_ALPHABLEND,i.albedoTexture&&(i.albedoTexture.nb=!0,i.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${a}/alphaMode: Invalid value (${O.alphaMode})`)}}loadTextureInfoAsync(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const H=this._extensionsLoadTextureInfoAsync(a,O,i);if(H)return H;if(this.logOpen(`${a}`),O.texCoord>=6)throw new Error(`${a}/texCoord: Invalid value (${O.texCoord})`);const b=g.Get(`${a}/index`,this._gltf.textures,O.index);b._textureInfo=O;const G=this._loadTextureAsync(`/textures/${O.index}`,b,(H=>{H.coordinatesIndex=O.texCoord||0,v.AddPointerMetadata(H,a),this._parent.onTextureLoadedObservable.notifyObservers(H),i(H)}));return this.logClose(),G}_loadTextureAsync(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const H=this._extensionsLoadTextureAsync(a,O,i);if(H)return H;this.logOpen(`${a} ${O.name||""}`);const b=void 0==O.sampler?v.DefaultSampler:g.Get(`${a}/sampler`,this._gltf.samplers,O.sampler),G=g.Get(`${a}/source`,this._gltf.images,O.source),q=this._createTextureAsync(a,b,G,i,void 0,!O._textureInfo.nonColorData);return this.logClose(),q}_createTextureAsync(a,O,i){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},G=arguments.length>4?arguments[4]:void 0,q=arguments.length>5?arguments[5]:void 0;const Q=this._loadSampler(`/samplers/${O.index}`,O),k=new Array,I=new H;this._babylonScene._blockEntityCollection=!!this._assetContainer;const P={noMipmap:Q.noMipMaps,invertY:!1,samplingMode:Q.samplingMode,L:()=>{this._disposed||I.resolve()},onError:(O,i)=>{this._disposed||I.reject(new Error(`${a}: ${i&&i.message?i.message:O||"Failed to load texture"}`))},mimeType:i.mimeType??(0,A.j)(i.uri??""),loaderOptions:G,useSRGBBuffer:!!q&&this._parent.useSRGBBuffers},e=new C.e(null,this._babylonScene,P);return e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k.push(I.promise),k.push(this.loadImageAsync(`/images/${i.index}`,i).then((a=>{const O=i.uri||`${this._fileName}#image${i.index}`,H=`data:${this._uniqueRootUrl}${O}`;e.updateURL(H,a);const b=e.getInternalTexture();b&&(b.label=i.name)}))),e.wrapU=Q.wrapU,e.wrapV=Q.wrapV,b(e),this._parent.useGltfTextureNames&&(e.name=i.name||i.uri||`image${i.index}`),Promise.all(k).then((()=>e))}_loadSampler(a,O){return O._data||(O._data={noMipMaps:9728===O.minFilter||9729===O.minFilter,samplingMode:v._GetTextureSamplingMode(a,O),wrapU:v._GetTextureWrapMode(`${a}/wrapS`,O.wrapS),wrapV:v._GetTextureWrapMode(`${a}/wrapT`,O.wrapT)}),O._data}loadImageAsync(a,O){if(!O._data){if(this.logOpen(`${a} ${O.name||""}`),O.uri)O._data=this.loadUriAsync(`${a}/uri`,O,O.uri);else{const i=g.Get(`${a}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i)}this.logClose()}return O._data}loadUriAsync(a,O,i){const H=this._extensionsLoadUriAsync(a,O,i);if(H)return H;if(!v._ValidateUri(i))throw new Error(`${a}: '${i}' is invalid`);if((0,A.n)(i)){const O=new Uint8Array((0,A.b)(i));return this.log(`${a}: Decoded ${i.substring(0,64)}... (${O.length} bytes)`),Promise.resolve(O)}return this.log(`${a}: Loading ${i}`),this._parent.preprocessUrlAsync(this._rootUrl+i).then((O=>new Promise(((H,b)=>{this._parent._loadFile(this._babylonScene,O,(O=>{this._disposed||(this.log(`${a}: Loaded ${i} (${O.byteLength} bytes)`),H(new Uint8Array(O)))}),!0,(O=>{b(new A.o(`${a}: Failed to load '${i}'${O?": "+O.status+" "+O.statusText:""}`,O))}))}))))}static AddPointerMetadata(a,O){a.metadata=a.metadata||{};const i=a._internalMetadata=a._internalMetadata||{},H=i.Fb=i.Fb||{};(H.pointers=H.pointers||[]).push(O)}static _GetTextureWrapMode(a,O){switch(O=void 0==O?10497:O){case 33071:return C.e.CLAMP_ADDRESSMODE;case 33648:return C.e.MIRROR_ADDRESSMODE;case 10497:return C.e.WRAP_ADDRESSMODE;default:return F.c.Warn(`${a}: Invalid value (${O})`),C.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(a,O){const i=void 0==O.magFilter?9729:O.magFilter,H=void 0==O.minFilter?9987:O.minFilter;if(9729===i)switch(H){case 9728:return C.e.LINEAR_NEAREST;case 9729:return C.e.LINEAR_LINEAR;case 9984:return C.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return C.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return C.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return C.e.LINEAR_LINEAR_MIPLINEAR;default:return F.c.Warn(`${a}/minFilter: Invalid value (${H})`),C.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==i&&F.c.Warn(`${a}/magFilter: Invalid value (${i})`),H){case 9728:return C.e.NEAREST_NEAREST;case 9729:return C.e.NEAREST_LINEAR;case 9984:return C.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return C.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return C.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return C.e.NEAREST_LINEAR_MIPLINEAR;default:return F.c.Warn(`${a}/minFilter: Invalid value (${H})`),C.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(a,O){try{return(0,x.m)(O)}catch(i){throw new Error(`${a}: ${i.message}`)}}static _GetTypedArray(a,O,i,H,b){const G=i.buffer;H=i.byteOffset+(H||0);const q=v._GetTypedArrayConstructor(`${a}/componentType`,O),Q=D.c.GetTypeByteLength(O);return H%Q!==0?(F.c.Warn(`${a}: Copying buffer as byte offset (${H}) is not a multiple of component type byte length (${Q})`),new q(G.slice(H,H+b*Q),0)):new q(G,H,b)}static _GetNumComponents(a,O){switch(O){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${a}: Invalid type (${O})`)}static _ValidateUri(a){return q.Tools.IsBase64(a)||-1===a.indexOf("..")}static _GetDrawMode(a,O){switch(void 0==O&&(O=4),O){case 0:return ma.b.PointListDrawMode;case 1:return ma.b.LineListDrawMode;case 2:return ma.b.LineLoopDrawMode;case 3:return ma.b.LineStripDrawMode;case 4:return ma.b.TriangleFillMode;case 5:return ma.b.TriangleStripDrawMode;case 6:return ma.b.TriangleFanDrawMode}throw new Error(`${a}: Invalid mesh primitive mode (${O})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const a=new Array;if(this._gltf.materials)for(const O of this._gltf.materials)if(O._data)for(const i in O._data){const H=O._data[i];for(const O of H.babylonMeshes){O.yb(!0);const i=H.babylonMaterial;a.push(i.forceCompilationAsync(O)),a.push(i.forceCompilationAsync(O,{useInstances:!0})),this._parent.useClipPlane&&(a.push(i.forceCompilationAsync(O,{clipPlane:!0})),a.push(i.forceCompilationAsync(O,{clipPlane:!0,useInstances:!0})))}}return Promise.all(a).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const a=new Array,O=this._babylonScene.lights;for(const i of O){const O=i.getShadowGenerator();O&&a.push(O.forceCompilationAsync())}return Promise.all(a).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(a){for(const O of this._extensions)O.enabled&&a(O)}_applyExtensions(a,O,i){for(const H of this._extensions)if(H.enabled){const b=`${H.name}.${O}`,G=a;G._activeLoaderExtensionFunctions=G._activeLoaderExtensionFunctions||{};const q=G._activeLoaderExtensionFunctions;if(!q[b]){q[b]=!0;try{const a=i(H);if(a)return a}finally{delete q[b]}}}return null}_extensionsOnLoading(){this._forEachExtensions((a=>a.onLoading&&a.onLoading()))}_extensionsOnReady(){this._forEachExtensions((a=>a.onReady&&a.onReady()))}_extensionsLoadSceneAsync(a,O){return this._applyExtensions(O,"loadScene",(i=>i.loadSceneAsync&&i.loadSceneAsync(a,O)))}_extensionsLoadNodeAsync(a,O,i){return this._applyExtensions(O,"loadNode",(H=>H.loadNodeAsync&&H.loadNodeAsync(a,O,i)))}_extensionsLoadCameraAsync(a,O,i){return this._applyExtensions(O,"loadCamera",(H=>H.loadCameraAsync&&H.loadCameraAsync(a,O,i)))}_extensionsLoadVertexDataAsync(a,O,i){return this._applyExtensions(O,"loadVertexData",(H=>H._loadVertexDataAsync&&H._loadVertexDataAsync(a,O,i)))}_extensionsLoadMeshPrimitiveAsync(a,O,i,H,b,G){return this._applyExtensions(b,"loadMeshPrimitive",(q=>q._loadMeshPrimitiveAsync&&q._loadMeshPrimitiveAsync(a,O,i,H,b,G)))}_extensionsLoadMaterialAsync(a,O,i,H,b){return this._applyExtensions(O,"loadMaterial",(G=>G._loadMaterialAsync&&G._loadMaterialAsync(a,O,i,H,b)))}_extensionsCreateMaterial(a,O,i){return this._applyExtensions(O,"createMaterial",(H=>H.createMaterial&&H.createMaterial(a,O,i)))}_extensionsLoadMaterialPropertiesAsync(a,O,i){return this._applyExtensions(O,"loadMaterialProperties",(H=>H.loadMaterialPropertiesAsync&&H.loadMaterialPropertiesAsync(a,O,i)))}_extensionsLoadTextureInfoAsync(a,O,i){return this._applyExtensions(O,"loadTextureInfo",(H=>H.loadTextureInfoAsync&&H.loadTextureInfoAsync(a,O,i)))}_extensionsLoadTextureAsync(a,O,i){return this._applyExtensions(O,"loadTexture",(H=>H._loadTextureAsync&&H._loadTextureAsync(a,O,i)))}_extensionsLoadAnimationAsync(a,O){return this._applyExtensions(O,"loadAnimation",(i=>i.loadAnimationAsync&&i.loadAnimationAsync(a,O)))}_extensionsLoadAnimationChannelAsync(a,O,i,H,b){return this._applyExtensions(i,"loadAnimationChannel",(G=>G._loadAnimationChannelAsync&&G._loadAnimationChannelAsync(a,O,i,H,b)))}_extensionsLoadSkinAsync(a,O,i){return this._applyExtensions(i,"loadSkin",(H=>H._loadSkinAsync&&H._loadSkinAsync(a,O,i)))}_extensionsLoadUriAsync(a,O,i){return this._applyExtensions(O,"loadUri",(H=>H._loadUriAsync&&H._loadUriAsync(a,O,i)))}_extensionsLoadBufferViewAsync(a,O){return this._applyExtensions(O,"loadBufferView",(i=>i.loadBufferViewAsync&&i.loadBufferViewAsync(a,O)))}_extensionsLoadBufferAsync(a,O,i,H){return this._applyExtensions(O,"loadBuffer",(b=>b.loadBufferAsync&&b.loadBufferAsync(a,O,i,H)))}static LoadExtensionAsync(a,O,i,H){if(!O.extensions)return null;const b=O.extensions[i];return b?H(`${a}/extensions/${i}`,b):null}static LoadExtraAsync(a,O,i,H){if(!O.extras)return null;const b=O.extras[i];return b?H(`${a}/extras/${i}`,b):null}isExtensionUsed(a){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(a)}logOpen(a){this._parent._logOpen(a)}logClose(){this._parent._logClose()}log(a){this._parent._log(a)}startPerformanceCounter(a){this._parent._startPerformanceCounter(a)}endPerformanceCounter(a){this._parent._endPerformanceCounter(a)}}v.DefaultSampler={index:-1},T.b._CreateGLTF2Loader=a=>new v(a);var X=i(14075),p=i(12593),o=i(12427),d=i(14078),Y=i(14084);class L extends Y.e{constructor(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",a),this._texture=a.getEngine().createRawCubeTexture(O,i,H,b,G,q,Q,k)}update(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,a,O,i,H,b)}updateRGBDAsync(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,d.k)(this._texture,a,O,i,H).then((()=>{}))}clone(){return o.d.Clone((()=>{const a=this.Ua(),O=this._texture,i=new L(a,O._bufferViewArray,O.width,O.format,O.type,O.generateMipMaps,O.invertY,O.samplingMode,O._compression);return 13===O.source&&i.updateRGBDAsync(O._bufferViewArrayArray,O._sphericalPolynomial,O._lodGenerationScale,O._lodGenerationOffset),i}),this)}}const s="EXT_lights_image_based";class t{constructor(a){this.name=s,this._loader=a,this.enabled=this._loader.isExtensionUsed(s)}dispose(){this._loader=null,delete this._lights}onLoading(){const a=this._loader.Fb.extensions;if(a&&a[this.name]){const O=a[this.name];this._lights=O.lights}}loadSceneAsync(a,O){return v.LoadExtensionAsync(a,O,this.name,(async(i,H)=>{this._loader._allMaterialsDirtyRequired=!0;const b=new Array;b.push(this._loader.loadSceneAsync(a,O)),this._loader.logOpen(`${i}`);const G=g.Get(`${i}/light`,this._lights,H.bb);return b.push(this._loadLightAsync(`/extensions/${this.name}/lights/${H.bb}`,G).then((a=>{this._loader.babylonScene.environmentTexture=a}))),this._loader.logClose(),await Promise.all(b).then((()=>{}))}))}_loadLightAsync(a,O){if(!O._loaded){const i=new Array;this._loader.logOpen(`${a}`);const H=new Array(O.specularImages.length);for(let b=0;b<O.specularImages.length;b++){const G=O.specularImages[b];H[b]=new Array(G.length);for(let O=0;O<G.length;O++){const q=`${a}/specularImages/${b}/${O}`;this._loader.logOpen(`${q}`);const Q=G[O],k=g.Get(q,this._loader.Fb.images,Q);i.push(this._loader.loadImageAsync(`/images/${Q}`,k).then((a=>{H[b][O]=a}))),this._loader.logClose()}}this._loader.logClose(),O._loaded=Promise.all(i).then((async()=>{const i=new L(this._loader.babylonScene,null,O.specularImageSize);if(i.name=O.name||"environment",O._babylonTexture=i,void 0!=O.Wb&&(i.level=O.Wb),O.rotation){let a=b.Quaternion.MO(O.rotation);this._loader.babylonScene.useRightHandedSystem||(a=b.Quaternion.Inverse(a)),b.Matrix.FromQuaternionToRef(a,i.getReflectionTextureMatrix())}if(!O.irradianceCoefficients)throw new Error(`${a}: Irradiance coefficients are missing`);const G=p.b.MO(O.irradianceCoefficients);G.scaleInPlace(O.Wb),G.convertIrradianceToLambertianRadiance();const q=p.d.FromHarmonics(G),Q=(H.length-1)/Math.log2(O.specularImageSize);return await i.updateRGBDAsync(H,q,Q)}))}return O._loaded.then((()=>O._babylonTexture))}}c(s),u(s,!0,(a=>new t(a)));i(12961);const V="EXT_mesh_gpu_instancing";class aa{constructor(a){this.name=V,this._loader=a,this.enabled=this._loader.isExtensionUsed(V)}dispose(){this._loader=null}loadNodeAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(a,H)=>{this._loader._disableInstancedMesh++;const G=this._loader.loadNodeAsync(`/nodes/${O.index}`,O,i);if(this._loader._disableInstancedMesh--,!O._primitiveBabylonMeshes)return await G;const q=new Array;let Q=0;const k=O=>{if(void 0==H.attributes[O])return void q.push(Promise.resolve(null));const i=g.Get(`${a}/attributes/${O}`,this._loader.Fb.accessors,H.attributes[O]);if(q.push(this._loader._loadFloatAccessorAsync(`/accessors/${i.bufferView}`,i)),0===Q)Q=i.count;else if(Q!==i.count)throw new Error(`${a}/attributes: Instance buffer accessors do not have the same count.`)};return k("TRANSLATION"),k("ROTATION"),k("SCALE"),await G.then((async a=>{const[i,H,G]=await Promise.all(q),k=new Float32Array(16*Q);b.TmpVectors.ZO[0].fb(0,0,0),b.TmpVectors.Quaternion[0].fb(0,0,0,1),b.TmpVectors.ZO[1].fb(1,1,1);for(let O=0;O<Q;++O)i&&b.ZO.FromArrayToRef(i,3*O,b.TmpVectors.ZO[0]),H&&b.Quaternion.FromArrayToRef(H,4*O,b.TmpVectors.Quaternion[0]),G&&b.ZO.FromArrayToRef(G,3*O,b.TmpVectors.ZO[1]),b.Matrix.ComposeToRef(b.TmpVectors.ZO[1],b.TmpVectors.Quaternion[0],b.TmpVectors.ZO[0],b.TmpVectors.Matrix[0]),b.TmpVectors.Matrix[0].copyToArray(k,16*O);for(const b of O._primitiveBabylonMeshes)b.Xe("matrix",k,16,!0);return a}))}))}}c(V),u(V,!0,(a=>new aa(a)));let Oa=0,ia=null;class Ha{static get Default(){return Ha._Default||(Ha._Default=new Ha),Ha._Default}constructor(){const a=Ha.Configuration.decoder;this._decoderModulePromise=q.Tools.LoadBabylonScriptAsync(a.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(a,O,i,H,b){await this._decoderModulePromise,0===Oa&&(MeshoptDecoder.useWorkers(1),Oa=1);const G=await MeshoptDecoder.decodeGltfBufferAsync(O,i,a,H,b);return null!==ia&&clearTimeout(ia),ia=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Oa=0,ia=null}),1e3),G}}Ha.Configuration={decoder:{url:`${q.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Ha._Default=null;const ba="EXT_meshopt_compression";class Ga{constructor(a){this.name=ba,this.enabled=a.isExtensionUsed(ba),this._loader=a}dispose(){this._loader=null}loadBufferViewAsync(a,O){return v.LoadExtensionAsync(a,O,this.name,(async(i,H)=>{const b=O;if(b._meshOptData)return await b._meshOptData;const G=g.Get(`${a}/buffer`,this._loader.Fb.buffers,H.buffer);return b._meshOptData=this._loader.loadBufferAsync(`/buffers/${G.index}`,G,H.byteOffset||0,H.byteLength).then((async a=>await Ha.Default.decodeGltfBufferAsync(a,H.count,H.byteStride,H.mode,H.filter))),await b._meshOptData}))}}c(ba),u(ba,!0,(a=>new Ga(a)));const qa="EXT_texture_webp";class Qa{constructor(a){this.name=qa,this._loader=a,this.enabled=a.isExtensionUsed(qa)}dispose(){this._loader=null}_loadTextureAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=void 0==O.sampler?v.DefaultSampler:g.Get(`${a}/sampler`,this._loader.Fb.samplers,O.sampler),q=g.Get(`${H}/source`,this._loader.Fb.images,b.source);return await this._loader._createTextureAsync(a,G,q,(a=>{i(a)}),void 0,!O._textureInfo.nonColorData)}))}}c(qa),u(qa,!0,(a=>new Qa(a)));const ka="EXT_texture_avif";class Ia{constructor(a){this.name=ka,this._loader=a,this.enabled=a.isExtensionUsed(ka)}dispose(){this._loader=null}_loadTextureAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=void 0==O.sampler?v.DefaultSampler:g.Get(`${a}/sampler`,this._loader.Fb.samplers,O.sampler),q=g.Get(`${H}/source`,this._loader.Fb.images,b.source);return await this._loader._createTextureAsync(a,G,q,(a=>{i(a)}),void 0,!O._textureInfo.nonColorData)}))}}c(ka),u(ka,!0,(a=>new Ia(a)));var Pa=i(14073),ea=i(12936);const ha="EXT_lights_ies";class ja{constructor(a){this.name=ha,this._loader=a,this.enabled=this._loader.isExtensionUsed(ha)}dispose(){this._loader=null,delete this._lights}onLoading(){const a=this._loader.Fb.extensions;if(a&&a[this.name]){const O=a[this.name];this._lights=O.lights,g.Assign(this._lights)}}loadNodeAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,q)=>{let Q,k;this._loader._allMaterialsDirtyRequired=!0;const I=await this._loader.loadNodeAsync(a,O,(a=>{k=g.Get(H,this._lights,q.bb);const O=k.name||a.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,Q=new Pa.b(O,b.ZO.Zero(),b.ZO.Backward(),0,1,this._loader.babylonScene),Q.angle=Math.PI/2,Q.innerAngle=0,Q._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,k._babylonLight=Q,Q.falloffType=ea.b.FALLOFF_GLTF,Q.ub=q.color?G.mi.MO(q.color):G.mi.White(),Q.Wb=q.multiplier||1,Q.range=Number.MAX_VALUE,Q.parent=a,this._loader._babylonLights.push(Q),v.AddPointerMetadata(Q,H),i(a)}));let P;if(k.uri)P=await this._loader.loadUriAsync(a,k,k.uri);else{const O=g.Get(`${a}/bufferView`,this._loader.Fb.bufferViews,k.bufferView);P=await this._loader.loadBufferViewAsync(`/bufferViews/${O.index}`,O)}return Q.iesProfileTexture=new C.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,P,!0,void 0,void 0,void 0,void 0,".ies"),I}))}}c(ha),u(ha,!0,(a=>new ja(a)));var Za=i(14095);const Fa="KHR_draco_mesh_compression";class ra{constructor(a){this.name=Fa,this.useNormalizedFlagFromAccessor=!0,this._loader=a,this.enabled=Za.b.DefaultAvailable&&this._loader.isExtensionUsed(Fa)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{if(void 0!=O.mode&&4!==O.mode&&5!==O.mode)throw new Error(`${a}: Unsupported mode ${O.mode}`);const G={},q={},Q=(a,H)=>{const Q=b.attributes[a];if(void 0!=Q&&(i._delayInfo=i._delayInfo||[],-1===i._delayInfo.indexOf(H)&&i._delayInfo.push(H),G[H]=Q,this.useNormalizedFlagFromAccessor)){const i=g.TryGet(this._loader.Fb.accessors,O.attributes[a]);i&&(q[H]=i.normalized||!1)}};Q("POSITION",D.c.PositionKind),Q("NORMAL",D.c.NormalKind),Q("TANGENT",D.c.TangentKind),Q("TEXCOORD_0",D.c.UVKind),Q("TEXCOORD_1",D.c.UV2Kind),Q("TEXCOORD_2",D.c.UV3Kind),Q("TEXCOORD_3",D.c.UV4Kind),Q("TEXCOORD_4",D.c.UV5Kind),Q("TEXCOORD_5",D.c.UV6Kind),Q("JOINTS_0",D.c.MatricesIndicesKind),Q("WEIGHTS_0",D.c.MatricesWeightsKind),Q("COLOR_0",D.c.ColorKind);const k=g.Get(H,this._loader.Fb.bufferViews,b.bufferView);return k._dracoBabylonGeometry||(k._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${k.index}`,k).then((async H=>{const b=this.dracoDecoder||Za.b.Default,Q=g.TryGet(this._loader.Fb.accessors,O.attributes.POSITION),k=this._loader.parent.alwaysComputeBoundingBox||i.skeleton||!Q?null:N(Q);return await b._decodeMeshToGeometryForGltfAsync(i.name,this._loader.babylonScene,H,G,q,k).catch((O=>{throw new Error(`${a}: ${O.message}`)}))}))),await k._dracoBabylonGeometry}))}}c(Fa),u(Fa,!0,(a=>new ra(a)));var Ja=i(14100),mO=i(12375),Ma=i(12384),Ca=i(12820),na=i(12994),Da=i(12346);Ca.c.AddNodeConstructor("Light_Type_0",((a,O)=>()=>new Ua(a,b.ZO.Zero(),O)));class Ua extends na.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(a){this._shadowAngle=a,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(a){const O=this.needCube();if(this._direction=a,this.needCube()!==O&&this._shadowGenerators){const a=this._shadowGenerators.values();for(let O=a.next();!0!==O.done;O=a.next()){O.value.recreateShadowMap()}}}constructor(a,O,i){super(a,i),this._shadowAngle=Math.PI/2,this.position=O}getClassName(){return"PointLight"}getTypeID(){return ea.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(a){if(this.direction)return super.getShadowDirection(a);switch(a){case 0:return new b.ZO(1,0,0);case 1:return new b.ZO(-1,0,0);case 2:return new b.ZO(0,-1,0);case 3:return new b.ZO(0,1,0);case 4:return new b.ZO(0,0,1);case 5:return new b.ZO(0,0,-1)}return b.ZO.Zero()}_setDefaultShadowProjectionMatrix(a,O,i){const H=this.Ua().activeCamera;if(!H)return;const G=void 0!==this.shadowMinZ?this.shadowMinZ:H.Db,q=void 0!==this.shadowMaxZ?this.shadowMaxZ:H.maxZ,Q=this.Ua().getEngine().qb;b.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,Q?q:G,Q?G:q,a,!0,this._scene.getEngine().isNDCHalfZRange,void 0,Q)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(a,O){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,O):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,O),this}transferToNodeMaterialEffect(a,O){return this.computeTransformedInformation()?a.setFloat3(O,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):a.setFloat3(O,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(a,O){a["POINTLIGHT"+O]=!0}}(0,mO.c)([(0,Ma.G)()],Ua.prototype,"shadowAngle",null),(0,Da.h)("BABYLON.PointLight",Ua);const ya="KHR_lights_punctual";class wa{constructor(a){this.name=ya,this._loader=a,this.enabled=this._loader.isExtensionUsed(ya)}dispose(){this._loader=null,delete this._lights}onLoading(){const a=this._loader.Fb.extensions;if(a&&a[this.name]){const O=a[this.name];this._lights=O.lights,g.Assign(this._lights)}}loadNodeAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,q)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(a,O,(a=>{let O;const Q=g.Get(H,this._lights,q.bb),k=Q.name||a.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,Q.type){case"directional":{const a=new Ja.b(k,b.ZO.Backward(),this._loader.babylonScene);a.position.Tb(0),O=a;break}case"point":O=new Ua(k,b.ZO.Zero(),this._loader.babylonScene);break;case"spot":{const a=new Pa.b(k,b.ZO.Zero(),b.ZO.Backward(),0,1,this._loader.babylonScene);a.angle=2*(Q.spot&&Q.spot.outerConeAngle||Math.PI/4),a.innerAngle=2*(Q.spot&&Q.spot.innerConeAngle||0),O=a;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${H}: Invalid light type (${Q.type})`)}O._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,Q._babylonLight=O,O.falloffType=ea.b.FALLOFF_GLTF,O.ub=Q.color?G.mi.MO(Q.color):G.mi.White(),O.Wb=void 0==Q.Wb?1:Q.Wb,O.range=void 0==Q.range?Number.MAX_VALUE:Q.range,O.parent=a,this._loader._babylonLights.push(O),v.AddPointerMetadata(O,H),i(a)})))))}}c(ya),u(ya,!0,(a=>new wa(a)));const Ka="KHR_materials_pbrSpecularGlossiness";class Sa{constructor(a){this.name=Ka,this.order=200,this._loader=a,this.enabled=this._loader.isExtensionUsed(Ka)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=new Array;return G.push(this._loader.loadMaterialBasePropertiesAsync(a,O,i)),G.push(this._loadSpecularGlossinessPropertiesAsync(H,b,i)),this._loader.loadMaterialAlphaProperties(a,O,i),await Promise.all(G).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(a,O,i){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);const H=new Array;return i.metallic=null,i.roughness=null,O.diffuseFactor?(i.albedoColor=G.mi.MO(O.diffuseFactor),i.alpha=O.diffuseFactor[3]):i.albedoColor=G.mi.White(),i.reflectivityColor=O.specularFactor?G.mi.MO(O.specularFactor):G.mi.White(),i.microSurface=void 0==O.glossinessFactor?1:O.glossinessFactor,O.diffuseTexture&&H.push(this._loader.loadTextureInfoAsync(`${a}/diffuseTexture`,O.diffuseTexture,(a=>{a.name=`${i.name} (Diffuse)`,i.albedoTexture=a}))),O.specularGlossinessTexture&&(H.push(this._loader.loadTextureInfoAsync(`${a}/specularGlossinessTexture`,O.specularGlossinessTexture,(a=>{a.name=`${i.name} (Specular Glossiness)`,i.reflectivityTexture=a,i.reflectivityTexture.nb=!0}))),i.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(H).then((()=>{}))}}c(Ka),u(Ka,!0,(a=>new Sa(a)));const fa="KHR_materials_unlit";class Ba{constructor(a){this.name=fa,this.order=210,this._loader=a,this.enabled=this._loader.isExtensionUsed(fa)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async()=>await this._loadUnlitPropertiesAsync(a,O,i)))}_loadUnlitPropertiesAsync(a,O,i){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);const H=new Array;i.unlit=!0;const b=O.pbrMetallicRoughness;return b&&(b.baseColorFactor?(i.albedoColor=G.mi.MO(b.baseColorFactor),i.alpha=b.baseColorFactor[3]):i.albedoColor=G.mi.White(),b.baseColorTexture&&H.push(this._loader.loadTextureInfoAsync(`${a}/baseColorTexture`,b.baseColorTexture,(a=>{a.name=`${i.name} (Base Color)`,i.albedoTexture=a})))),O.doubleSided&&(i.Sb=!1,i.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(a,O,i),Promise.all(H).then((()=>{}))}}c(fa),u(fa,!0,(a=>new Ba(a)));const Ta="KHR_materials_clearcoat";class Aa{constructor(a){this.name=Ta,this.order=190,this._loader=a,this.enabled=this._loader.isExtensionUsed(Ta)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=new Array;G.push(this._loader.loadMaterialPropertiesAsync(a,O,i)),G.push(this._loadClearCoatPropertiesAsync(H,b,i)),await Promise.all(G)}))}_loadClearCoatPropertiesAsync(a,O,i){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);const H=new Array;return i.clearCoat.isEnabled=!0,i.clearCoat.useRoughnessFromMainTexture=!1,i.clearCoat.remapF0OnInterfaceChange=!1,void 0!=O.clearcoatFactor?i.clearCoat.Wb=O.clearcoatFactor:i.clearCoat.Wb=0,O.clearcoatTexture&&H.push(this._loader.loadTextureInfoAsync(`${a}/clearcoatTexture`,O.clearcoatTexture,(a=>{a.name=`${i.name} (ClearCoat)`,i.clearCoat.texture=a}))),void 0!=O.clearcoatRoughnessFactor?i.clearCoat.roughness=O.clearcoatRoughnessFactor:i.clearCoat.roughness=0,O.clearcoatRoughnessTexture&&(O.clearcoatRoughnessTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${a}/clearcoatRoughnessTexture`,O.clearcoatRoughnessTexture,(a=>{a.name=`${i.name} (ClearCoat Roughness)`,i.clearCoat.textureRoughness=a})))),O.clearcoatNormalTexture&&(O.clearcoatNormalTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${a}/clearcoatNormalTexture`,O.clearcoatNormalTexture,(a=>{a.name=`${i.name} (ClearCoat Normal)`,i.clearCoat.bumpTexture=a}))),i.invertNormalMapX=!i.Ua().useRightHandedSystem,i.invertNormalMapY=i.Ua().useRightHandedSystem,void 0!=O.clearcoatNormalTexture.scale&&(i.clearCoat.bumpTexture.level=O.clearcoatNormalTexture.scale)),Promise.all(H).then((()=>{}))}}c(Ta),u(Ta,!0,(a=>new Aa(a)));const Ea="KHR_materials_iridescence";class la{constructor(a){this.name=Ea,this.order=195,this._loader=a,this.enabled=this._loader.isExtensionUsed(Ea)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(a,O,i)),G.push(this._loadIridescencePropertiesAsync(H,b,i)),await Promise.all(G).then((()=>{}))}))}_loadIridescencePropertiesAsync(a,O,i){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);const H=new Array;return i.iridescence.isEnabled=!0,i.iridescence.Wb=O.iridescenceFactor??0,i.iridescence.indexOfRefraction=O.iridescenceIor??O.iridescenceIOR??1.3,i.iridescence.minimumThickness=O.iridescenceThicknessMinimum??100,i.iridescence.maximumThickness=O.iridescenceThicknessMaximum??400,O.iridescenceTexture&&H.push(this._loader.loadTextureInfoAsync(`${a}/iridescenceTexture`,O.iridescenceTexture,(a=>{a.name=`${i.name} (Iridescence)`,i.iridescence.texture=a}))),O.iridescenceThicknessTexture&&H.push(this._loader.loadTextureInfoAsync(`${a}/iridescenceThicknessTexture`,O.iridescenceThicknessTexture,(a=>{a.name=`${i.name} (Iridescence Thickness)`,i.iridescence.thicknessTexture=a}))),Promise.all(H).then((()=>{}))}}c(Ea),u(Ea,!0,(a=>new la(a)));const Wa="KHR_materials_anisotropy";class ua{constructor(a){this.name=Wa,this.order=195,this._loader=a,this.enabled=this._loader.isExtensionUsed(Wa)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=new Array;G.push(this._loader.loadMaterialPropertiesAsync(a,O,i)),G.push(this._loadIridescencePropertiesAsync(H,b,i)),await Promise.all(G)}))}async _loadIridescencePropertiesAsync(a,O,i){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);const H=new Array;i.anisotropy.isEnabled=!0,i.anisotropy.Wb=O.anisotropyStrength??0,i.anisotropy.angle=O.anisotropyRotation??0,O.anisotropyTexture&&(O.anisotropyTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${a}/anisotropyTexture`,O.anisotropyTexture,(a=>{a.name=`${i.name} (Anisotropy Intensity)`,i.anisotropy.texture=a})))),await Promise.all(H)}}c(Wa),u(Wa,!0,(a=>new ua(a)));const ca="KHR_materials_emissive_strength";class Ra{constructor(a){this.name=ca,this.order=170,this._loader=a,this.enabled=this._loader.isExtensionUsed(ca)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>await this._loader.loadMaterialPropertiesAsync(a,O,i).then((()=>{this._loadEmissiveProperties(H,b,i)}))))}_loadEmissiveProperties(a,O,i){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);void 0!==O.emissiveStrength&&(i.emissiveIntensity=O.emissiveStrength)}}c(ca),u(ca,!0,(a=>new Ra(a)));const za="KHR_materials_sheen";class xa{constructor(a){this.name=za,this.order=190,this._loader=a,this.enabled=this._loader.isExtensionUsed(za)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(a,O,i)),G.push(this._loadSheenPropertiesAsync(H,b,i)),await Promise.all(G).then((()=>{}))}))}_loadSheenPropertiesAsync(a,O,i){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);const H=new Array;return i.sheen.isEnabled=!0,i.sheen.Wb=1,void 0!=O.sheenColorFactor?i.sheen.color=G.mi.MO(O.sheenColorFactor):i.sheen.color=G.mi.Black(),O.sheenColorTexture&&H.push(this._loader.loadTextureInfoAsync(`${a}/sheenColorTexture`,O.sheenColorTexture,(a=>{a.name=`${i.name} (Sheen Color)`,i.sheen.texture=a}))),void 0!==O.sheenRoughnessFactor?i.sheen.roughness=O.sheenRoughnessFactor:i.sheen.roughness=0,O.sheenRoughnessTexture&&(O.sheenRoughnessTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${a}/sheenRoughnessTexture`,O.sheenRoughnessTexture,(a=>{a.name=`${i.name} (Sheen Roughness)`,i.sheen.textureRoughness=a})))),i.sheen.albedoScaling=!0,i.sheen.useRoughnessFromMainTexture=!1,Promise.all(H).then((()=>{}))}}c(za),u(za,!0,(a=>new xa(a)));var ga=i(12878);const Na="KHR_materials_specular";class va{constructor(a){this.name=Na,this.order=190,this._loader=a,this.enabled=this._loader.isExtensionUsed(Na)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=new Array;if(G.push(this._loader.loadMaterialPropertiesAsync(a,O,i)),G.push(this._loadSpecularPropertiesAsync(H,b,i)),b.extensions&&b.extensions.EXT_materials_specular_edge_color&&i instanceof M.e){b.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(i.brdf.dielectricSpecularModel=ga.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,i.brdf.conductorSpecularModel=ga.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(G).then((()=>{}))}))}_loadSpecularPropertiesAsync(a,O,i){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);const H=new Array;return void 0!==O.specularFactor&&(i.metallicF0Factor=O.specularFactor),void 0!==O.specularColorFactor&&(i.metallicReflectanceColor=G.mi.MO(O.specularColorFactor)),O.specularTexture&&(O.specularTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${a}/specularTexture`,O.specularTexture,(a=>{a.name=`${i.name} (Specular)`,i.metallicReflectanceTexture=a,i.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),O.specularColorTexture&&H.push(this._loader.loadTextureInfoAsync(`${a}/specularColorTexture`,O.specularColorTexture,(a=>{a.name=`${i.name} (Specular Color)`,i.reflectanceTexture=a}))),Promise.all(H).then((()=>{}))}}c(Na),u(Na,!0,(a=>new va(a)));const Xa="KHR_materials_ior";class pa{constructor(a){this.name=Xa,this.order=180,this._loader=a,this.enabled=this._loader.isExtensionUsed(Xa)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(a,O,i)),G.push(this._loadIorPropertiesAsync(H,b,i)),await Promise.all(G).then((()=>{}))}))}_loadIorPropertiesAsync(a,O,i){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);return void 0!==O.ior?i.indexOfRefraction=O.ior:i.indexOfRefraction=pa._DEFAULT_IOR,Promise.resolve()}}pa._DEFAULT_IOR=1.5,c(Xa),u(Xa,!0,(a=>new pa(a)));const oa="KHR_materials_variants";class da{constructor(a){this.name=oa,this._loader=a,this.enabled=this._loader.isExtensionUsed(oa)}dispose(){this._loader=null}static GetAvailableVariants(a){const O=this._GetExtensionMetadata(a);return O?Object.keys(O.variants):[]}getAvailableVariants(a){return da.GetAvailableVariants(a)}static SelectVariant(a,O){const i=this._GetExtensionMetadata(a);if(!i)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${oa} extension`);const H=a=>{const O=i.variants[a];if(O)for(const i of O)i.mesh.material=i.material};if(O instanceof Array)for(const b of O)H(b);else H(O);i.lastSelected=O}selectVariant(a,O){da.SelectVariant(a,O)}static Reset(a){const O=this._GetExtensionMetadata(a);if(!O)throw new Error(`Cannot reset on a glTF mesh that does not have the ${oa} extension`);for(const i of O.original)i.mesh.material=i.material;O.lastSelected=null}reset(a){da.Reset(a)}static GetLastSelectedVariant(a){const O=this._GetExtensionMetadata(a);if(!O)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${oa} extension`);return O.lastSelected}getLastSelectedVariant(a){return da.GetLastSelectedVariant(a)}static _GetExtensionMetadata(a){var O,i;return(null===a||void 0===a||null===(O=a._internalMetadata)||void 0===O||null===(i=O.Fb)||void 0===i?void 0:i[oa])||null}onLoading(){const a=this._loader.Fb.extensions;if(a&&a[this.name]){const O=a[this.name];this._variants=O.variants}}onReady(){const a=this._loader.rootBabylonMesh;if(a){var O;const i=this._loader.parent.extensionOptions[oa];null!==i&&void 0!==i&&i.defaultVariant&&da.SelectVariant(a,i.defaultVariant),null===i||void 0===i||null===(O=i.onLoaded)||void 0===O||O.call(i,{get variants(){return da.GetAvailableVariants(a)},get selectedVariant(){const O=da.GetLastSelectedVariant(a);return O?Array.isArray(O)?O[0]:O:da.GetAvailableVariants(a)[0]},set selectedVariant(O){da.SelectVariant(a,O)}})}}_loadMeshPrimitiveAsync(a,O,i,H,b,G){return v.LoadExtensionAsync(a,b,this.name,(async(q,Q)=>{const k=new Array;return k.push(this._loader._loadMeshPrimitiveAsync(a,O,i,H,b,(O=>{if(G(O),O instanceof w.d){const i=v._GetDrawMode(a,b.mode),H=this._loader.rootBabylonMesh,G=H?H._internalMetadata=H._internalMetadata||{}:{},I=G.Fb=G.Fb||{},P=I[oa]=I[oa]||{lastSelected:null,original:[],variants:{}};P.original.push({mesh:O,material:O.material});for(let a=0;a<Q.mappings.length;++a){const b=Q.mappings[a],G=g.Get(`${q}/mappings/${a}/material`,this._loader.Fb.materials,b.material);k.push(this._loader._loadMaterialAsync(`#/materials/${b.material}`,G,O,i,(a=>{for(let i=0;i<b.variants.length;++i){const G=b.variants[i],q=g.Get(`/extensions/${oa}/variants/${G}`,this._variants,G);P.variants[q.name]=P.variants[q.name]||[],P.variants[q.name].push({mesh:O,material:a}),O.onClonedObservable.add((a=>{const i=a;let b=null,G=i;do{if(G=G.parent,!G)return;b=da._GetExtensionMetadata(G)}while(null===b);if(H&&b===da._GetExtensionMetadata(H)){G._internalMetadata={};for(const a in H._internalMetadata)G._internalMetadata[a]=H._internalMetadata[a];G._internalMetadata.Fb=[];for(const a in H._internalMetadata.Fb)G._internalMetadata.Fb[a]=H._internalMetadata.Fb[a];G._internalMetadata.Fb[oa]={lastSelected:null,original:[],variants:{}};for(const a of b.original)G._internalMetadata.Fb[oa].original.push({mesh:a.mesh,material:a.material});for(const a in b.variants)if(Object.prototype.hasOwnProperty.call(b.variants,a)){G._internalMetadata.Fb[oa].variants[a]=[];for(const O of b.variants[a])G._internalMetadata.Fb[oa].variants[a].push({mesh:O.mesh,material:O.material})}b=G._internalMetadata.Fb[oa]}for(const H of b.original)H.mesh===O&&(H.mesh=i);for(const H of b.variants[q.name])H.mesh===O&&(H.mesh=i)}))}})))}}}))),await Promise.all(k).then((a=>{let[O]=a;return O}))}))}}c(oa),u(oa,!0,(a=>new da(a)));var Ya=i(12454);class La{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:ga.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(a,O){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...La._GetDefaultOptions(),...a},this._scene=O,this._scene._transmissionHelper=this,this.onErrorObservable=new P.e,this._scene.Pb.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(a){if(!Object.keys(a).filter((O=>this._options[O]!==a[O])).length)return;const O={...this._options,...a},i=this._options;this._options=O,O.renderSize===i.renderSize&&O.renderTargetTextureType===i.renderTargetTextureType&&O.generateMipmaps===i.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=O.samples,this._opaqueRenderTarget.lodGenerationScale=O.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=O.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(a){return!!a&&!!(a instanceof M.e&&a.subSurface.isRefractionEnabled)}_addMesh(a){this._materialObservers[a.uniqueId]=a.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),q.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(a.material)?(a.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(a)&&this._transparentMeshesCache.push(a)):-1===this._opaqueMeshesCache.indexOf(a)&&this._opaqueMeshesCache.push(a)}))}_removeMesh(a){a.onMaterialChangedObservable.remove(this._materialObservers[a.uniqueId]),delete this._materialObservers[a.uniqueId];let O=this._transparentMeshesCache.indexOf(a);-1!==O&&this._transparentMeshesCache.splice(O,1),O=this._opaqueMeshesCache.indexOf(a),-1!==O&&this._opaqueMeshesCache.splice(O,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(a){const O=this._transparentMeshesCache.indexOf(a),i=this._opaqueMeshesCache.indexOf(a);this._shouldRenderAsTransmission(a.material)?(a.material instanceof M.e&&(a.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==i?(this._opaqueMeshesCache.splice(i,1),this._transparentMeshesCache.push(a)):-1===O&&this._transparentMeshesCache.push(a)):-1!==O?(this._transparentMeshesCache.splice(O,1),this._opaqueMeshesCache.push(a)):-1===i&&this._opaqueMeshesCache.push(a)}_isRenderTargetValid(){var a;return null!==(null===(a=this._opaqueRenderTarget)||void 0===a?void 0:a.getInternalTexture())}_setupRenderTargets(){var a;let O;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Ya.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(a=this._options.clearColor)||void 0===a?void 0:a.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((a=>{O=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?a.clearColor.q(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(a.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=O}));for(const i of this._transparentMeshesCache)this._shouldRenderAsTransmission(i.material)&&(i.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const sa="KHR_materials_transmission";class ta{constructor(a){this.name=sa,this.order=175,this._loader=a,this.enabled=this._loader.isExtensionUsed(sa),this.enabled&&(a.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(a,O,i)),G.push(this._loadTransparentPropertiesAsync(H,O,i,b)),await Promise.all(G).then((()=>{}))}))}_loadTransparentPropertiesAsync(a,O,i,H){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);const b=i;if(b.subSurface.isRefractionEnabled=!0,b.subSurface.volumeIndexOfRefraction=1,b.subSurface.useAlbedoToTintRefraction=!0,void 0===H.transmissionFactor)return b.subSurface.refractionIntensity=0,b.subSurface.isRefractionEnabled=!1,Promise.resolve();{var G;b.subSurface.refractionIntensity=H.transmissionFactor;const a=b.Ua();if(b.subSurface.refractionIntensity&&!a._transmissionHelper)new La({},b.Ua());else if(b.subSurface.refractionIntensity&&(null===(G=a._transmissionHelper)||void 0===G||!G._isRenderTargetValid())){var q;null===(q=a._transmissionHelper)||void 0===q||q._setupRenderTargets()}}return b.subSurface.minimumThickness=0,b.subSurface.maximumThickness=0,H.transmissionTexture?(H.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${a}/transmissionTexture`,H.transmissionTexture,void 0).then((a=>{a.name=`${i.name} (Transmission)`,b.subSurface.refractionIntensityTexture=a,b.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}c(sa),u(sa,!0,(a=>new ta(a)));const Va="KHR_materials_diffuse_transmission";class aO{constructor(a){this.name=Va,this.order=174,this._loader=a,this.enabled=this._loader.isExtensionUsed(Va),this.enabled&&(a.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(a,O,i)),G.push(this._loadTranslucentPropertiesAsync(H,O,i,b)),await Promise.all(G).then((()=>{}))}))}_loadTranslucentPropertiesAsync(a,O,i,H){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);const b=i;if(b.subSurface.isTranslucencyEnabled=!0,b.subSurface.volumeIndexOfRefraction=1,b.subSurface.minimumThickness=0,b.subSurface.maximumThickness=0,b.subSurface.useAlbedoToTintTranslucency=!1,void 0===H.diffuseTransmissionFactor)return b.subSurface.translucencyIntensity=0,b.subSurface.isTranslucencyEnabled=!1,Promise.resolve();b.subSurface.translucencyIntensity=H.diffuseTransmissionFactor;const q=new Array;return b.subSurface.useGltfStyleTextures=!0,H.diffuseTransmissionTexture&&(H.diffuseTransmissionTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${a}/diffuseTransmissionTexture`,H.diffuseTransmissionTexture).then((a=>{a.name=`${i.name} (Diffuse Transmission)`,b.subSurface.translucencyIntensityTexture=a})))),void 0!==H.diffuseTransmissionColorFactor?b.subSurface.translucencyColor=G.mi.MO(H.diffuseTransmissionColorFactor):b.subSurface.translucencyColor=G.mi.White(),H.diffuseTransmissionColorTexture&&q.push(this._loader.loadTextureInfoAsync(`${a}/diffuseTransmissionColorTexture`,H.diffuseTransmissionColorTexture).then((a=>{a.name=`${i.name} (Diffuse Transmission Color)`,b.subSurface.translucencyColorTexture=a}))),Promise.all(q).then((()=>{}))}}c(Va),u(Va,!0,(a=>new aO(a)));const OO="KHR_materials_volume";class iO{constructor(a){this.name=OO,this.order=173,this._loader=a,this.enabled=this._loader.isExtensionUsed(OO),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(a,O,i)),G.push(this._loadVolumePropertiesAsync(H,O,i,b)),await Promise.all(G).then((()=>{}))}))}_loadVolumePropertiesAsync(a,O,i,H){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);if(!i.subSurface.isRefractionEnabled&&!i.subSurface.isTranslucencyEnabled||!H.thicknessFactor)return Promise.resolve();i.subSurface.volumeIndexOfRefraction=i.indexOfRefraction;const b=void 0!==H.attenuationDistance?H.attenuationDistance:Number.MAX_VALUE;return i.subSurface.tintColorAtDistance=b,void 0!==H.attenuationColor&&3==H.attenuationColor.length&&i.subSurface.tintColor.fb(H.attenuationColor[0],H.attenuationColor[1],H.attenuationColor[2]),i.subSurface.minimumThickness=0,i.subSurface.maximumThickness=H.thicknessFactor,i.subSurface.useThicknessAsDepth=!0,H.thicknessTexture?(H.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${a}/thicknessTexture`,H.thicknessTexture).then((a=>{a.name=`${i.name} (Thickness)`,i.subSurface.thicknessTexture=a,i.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}c(OO),u(OO,!0,(a=>new iO(a)));const HO="KHR_materials_dispersion";class bO{constructor(a){this.name=HO,this.order=174,this._loader=a,this.enabled=this._loader.isExtensionUsed(HO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(a,O,i)),G.push(this._loadDispersionPropertiesAsync(H,O,i,b)),await Promise.all(G).then((()=>{}))}))}_loadDispersionPropertiesAsync(a,O,i,H){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);return i.subSurface.isRefractionEnabled&&H.dispersion?(i.subSurface.isDispersionEnabled=!0,i.subSurface.dispersion=H.dispersion,Promise.resolve()):Promise.resolve()}}c(HO),u(HO,!0,(a=>new bO(a)));const GO="EXT_materials_diffuse_roughness";class qO{constructor(a){this.name=GO,this.order=190,this._loader=a,this.enabled=this._loader.isExtensionUsed(GO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=new Array;return G.push(this._loader.loadMaterialPropertiesAsync(a,O,i)),G.push(this._loadDiffuseRoughnessPropertiesAsync(H,b,i)),await Promise.all(G).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(a,O,i){if(!(i instanceof M.e))throw new Error(`${a}: Material type not supported`);const H=new Array;return i.brdf.baseDiffuseModel=ga.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=O.diffuseRoughnessFactor?i.baseDiffuseRoughness=O.diffuseRoughnessFactor:i.baseDiffuseRoughness=0,O.diffuseRoughnessTexture&&H.push(this._loader.loadTextureInfoAsync(`${a}/diffuseRoughnessTexture`,O.diffuseRoughnessTexture,(a=>{a.name=`${i.name} (Diffuse Roughness)`,i.baseDiffuseRoughnessTexture=a}))),Promise.all(H).then((()=>{}))}}c(GO),u(GO,!0,(a=>new qO(a)));const QO="KHR_mesh_quantization";class kO{constructor(a){this.name=QO,this.enabled=a.isExtensionUsed(QO)}dispose(){}}c(QO),u(QO,!0,(a=>new kO(a)));const IO="KHR_texture_basisu";class PO{constructor(a){this.name=IO,this._loader=a,this.enabled=a.isExtensionUsed(IO)}dispose(){this._loader=null}_loadTextureAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>{const G=void 0==O.sampler?v.DefaultSampler:g.Get(`${a}/sampler`,this._loader.Fb.samplers,O.sampler),q=g.Get(`${H}/source`,this._loader.Fb.images,b.source);return await this._loader._createTextureAsync(a,G,q,(a=>{i(a)}),O._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!O._textureInfo.nonColorData)}))}}c(IO),u(IO,!0,(a=>new PO(a)));const eO="KHR_texture_transform";class hO{constructor(a){this.name=eO,this._loader=a,this.enabled=this._loader.isExtensionUsed(eO)}dispose(){this._loader=null}loadTextureInfoAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(H,b)=>await this._loader.loadTextureInfoAsync(a,O,(a=>{if(!(a instanceof C.e))throw new Error(`${H}: Texture type not supported`);b.offset&&(a.uOffset=b.offset[0],a.vOffset=b.offset[1]),a.uRotationCenter=0,a.vRotationCenter=0,b.rotation&&(a.wAng=-b.rotation),b.scale&&(a.uScale=b.scale[0],a.vScale=b.scale[1]),void 0!=b.texCoord&&(a.coordinatesIndex=b.texCoord),i(a)}))))}}c(eO),u(eO,!0,(a=>new hO(a)));const jO="KHR_xmp_json_ld";class ZO{constructor(a){this.name=jO,this.order=100,this._loader=a,this.enabled=this._loader.isExtensionUsed(jO)}dispose(){this._loader=null}onLoading(){var a,O,i;if(null===this._loader.rootBabylonMesh)return;const H=null===(a=this._loader.Fb.extensions)||void 0===a?void 0:a.KHR_xmp_json_ld,b=null===(O=this._loader.Fb.asset)||void 0===O||null===(i=O.extensions)||void 0===i?void 0:i.KHR_xmp_json_ld;if(H&&b){const a=+b.packet;H.packets&&a<H.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=H.packets[a])}}}function FO(a,O,i,H){return G.mi.MO(O,i).scale(H)}function rO(a,O,i,H){return O[i]*H}function JO(a,O,i,H){return-O[i]*H}function mi(a,O,i,H){return O[i+1]*H}function MO(a,O,i,H){return O[i]*H*2}function CO(a){return{scale:[new DO(h.b.ANIMATIONTYPE_FLOAT,`${a}.uScale`,rO,(()=>2)),new DO(h.b.ANIMATIONTYPE_FLOAT,`${a}.vScale`,mi,(()=>2))],offset:[new DO(h.b.ANIMATIONTYPE_FLOAT,`${a}.uOffset`,rO,(()=>2)),new DO(h.b.ANIMATIONTYPE_FLOAT,`${a}.vOffset`,mi,(()=>2))],rotation:[new DO(h.b.ANIMATIONTYPE_FLOAT,`${a}.wAng`,JO,(()=>1))]}}c(jO),u(jO,!0,(a=>new ZO(a)));class nO extends X.AnimationPropertyInfo{buildAnimations(a,O,i,H){return[{babylonAnimatable:a._babylonCamera,babylonAnimation:this._buildAnimation(O,i,H)}]}}class DO extends X.AnimationPropertyInfo{buildAnimations(a,O,i,H){const b=[];for(const G in a._data)b.push({babylonAnimatable:a._data[G].babylonMaterial,babylonAnimation:this._buildAnimation(O,i,H)});return b}}class UO extends X.AnimationPropertyInfo{buildAnimations(a,O,i,H){return[{babylonAnimatable:a._babylonLight,babylonAnimation:this._buildAnimation(O,i,H)}]}}(0,R.k)("/cameras/{}/orthographic/xmag",[new nO(h.b.ANIMATIONTYPE_FLOAT,"orthoLeft",JO,(()=>1)),new nO(h.b.ANIMATIONTYPE_FLOAT,"orthoRight",mi,(()=>1))]),(0,R.k)("/cameras/{}/orthographic/ymag",[new nO(h.b.ANIMATIONTYPE_FLOAT,"orthoBottom",JO,(()=>1)),new nO(h.b.ANIMATIONTYPE_FLOAT,"orthoTop",mi,(()=>1))]),(0,R.k)("/cameras/{}/orthographic/zfar",[new nO(h.b.ANIMATIONTYPE_FLOAT,"maxZ",rO,(()=>1))]),(0,R.k)("/cameras/{}/orthographic/znear",[new nO(h.b.ANIMATIONTYPE_FLOAT,"Db",rO,(()=>1))]),(0,R.k)("/cameras/{}/perspective/yfov",[new nO(h.b.ANIMATIONTYPE_FLOAT,"fov",rO,(()=>1))]),(0,R.k)("/cameras/{}/perspective/zfar",[new nO(h.b.ANIMATIONTYPE_FLOAT,"maxZ",rO,(()=>1))]),(0,R.k)("/cameras/{}/perspective/znear",[new nO(h.b.ANIMATIONTYPE_FLOAT,"Db",rO,(()=>1))]),(0,R.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new DO(h.b.ANIMATIONTYPE_COLOR3,"albedoColor",FO,(()=>4)),new DO(h.b.ANIMATIONTYPE_FLOAT,"alpha",(function(a,O,i,H){return O[i+3]*H}),(()=>4))]),(0,R.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new DO(h.b.ANIMATIONTYPE_FLOAT,"metallic",rO,(()=>1))]),(0,R.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new DO(h.b.ANIMATIONTYPE_FLOAT,"roughness",rO,(()=>1))]);const yO=CO("albedoTexture");(0,R.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",yO.scale),(0,R.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",yO.offset),(0,R.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",yO.rotation);const wO=CO("metallicTexture");(0,R.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",wO.scale),(0,R.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",wO.offset),(0,R.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",wO.rotation),(0,R.k)("/materials/{}/emissiveFactor",[new DO(h.b.ANIMATIONTYPE_COLOR3,"emissiveColor",FO,(()=>3))]);const KO=CO("bumpTexture");(0,R.k)("/materials/{}/normalTexture/scale",[new DO(h.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",rO,(()=>1))]),(0,R.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",KO.scale),(0,R.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",KO.offset),(0,R.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",KO.rotation),(0,R.k)("/materials/{}/occlusionTexture/strength",[new DO(h.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",rO,(()=>1))]);const SO=CO("ambientTexture");(0,R.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",SO.scale),(0,R.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",SO.offset),(0,R.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",SO.rotation);const fO=CO("emissiveTexture");(0,R.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",fO.scale),(0,R.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",fO.offset),(0,R.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",fO.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new DO(h.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",rO,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new DO(h.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",rO,(()=>1))]);const BO=CO("anisotropy.texture");(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",BO.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",BO.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",BO.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new DO(h.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",rO,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new DO(h.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",rO,(()=>1))]);const TO=CO("clearCoat.texture");(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",TO.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",TO.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",TO.rotation);const AO=CO("clearCoat.bumpTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new DO(h.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",rO,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",AO.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",AO.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",AO.rotation);const EO=CO("clearCoat.textureRoughness");(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",EO.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",EO.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",EO.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new DO(h.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",rO,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new DO(h.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",rO,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new DO(h.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",rO,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new DO(h.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",rO,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new DO(h.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",rO,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new DO(h.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",rO,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new DO(h.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",rO,(()=>1))]);const lO=CO("iridescence.texture");(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",lO.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",lO.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",lO.rotation);const WO=CO("iridescence.thicknessTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",WO.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",WO.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",WO.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new DO(h.b.ANIMATIONTYPE_COLOR3,"sheen.color",FO,(()=>3))]),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new DO(h.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",rO,(()=>1))]);const uO=CO("sheen.texture");(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",uO.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",uO.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",uO.rotation);const cO=CO("sheen.textureRoughness");(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",cO.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",cO.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",cO.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new DO(h.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",rO,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new DO(h.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",FO,(()=>3))]);const RO=CO("metallicReflectanceTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",RO.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",RO.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",RO.rotation);const zO=CO("reflectanceTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",zO.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",zO.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",zO.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new DO(h.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",rO,(()=>1))]);const xO=CO("subSurface.refractionIntensityTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",xO.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",xO.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",xO.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new DO(h.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",FO,(()=>3))]),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new DO(h.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",rO,(()=>1))]),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new DO(h.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",rO,(()=>1))]);const gO=CO("subSurface.thicknessTexture");(0,R.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",gO.scale),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",gO.offset),(0,R.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",gO.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new DO(h.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",rO,(()=>1))]);const NO=CO("subSurface.translucencyIntensityTexture");(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",NO.scale),(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",NO.offset),(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",NO.rotation),(0,R.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new DO(h.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",FO,(()=>3))]);const vO=CO("subSurface.translucencyColorTexture");(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",vO.scale),(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",vO.offset),(0,R.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",vO.rotation),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new UO(h.b.ANIMATIONTYPE_COLOR3,"diffuse",FO,(()=>3))]),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new UO(h.b.ANIMATIONTYPE_FLOAT,"intensity",rO,(()=>1))]),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new UO(h.b.ANIMATIONTYPE_FLOAT,"range",rO,(()=>1))]),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new UO(h.b.ANIMATIONTYPE_FLOAT,"innerAngle",MO,(()=>1))]),(0,R.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new UO(h.b.ANIMATIONTYPE_FLOAT,"angle",MO,(()=>1))]),(0,R.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new UO(h.b.ANIMATIONTYPE_COLOR3,"diffuse",FO,(()=>3))]),(0,R.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new UO(h.b.ANIMATIONTYPE_FLOAT,"intensity",rO,(()=>1))]);const XO="KHR_animation_pointer";class pO{constructor(a){this.name=XO,this._loader=a,this._pathToObjectConverter=(0,R.g)(this._loader.Fb)}get enabled(){return this._loader.isExtensionUsed(XO)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(a,O,i,H,b){var G;const q=null===(G=H.target.extensions)||void 0===G?void 0:G.KHR_animation_pointer;if(!q||!this._pathToObjectConverter)return null;"pointer"!==H.target.path&&F.c.Warn(`${a}/target/path: Value (${H.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=H.target.node&&F.c.Warn(`${a}/target/node: Value (${H.target.node}) must not be present when using the ${this.name} extension`);const Q=`${a}/extensions/${this.name}`,k=q.pointer;if(!k)throw new Error(`${Q}: Pointer is missing`);try{const G=this._pathToObjectConverter.convert(k);if(!G.info.interpolation)throw new Error(`${Q}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(a,O,i,H,{object:G.object,info:G.info.interpolation},b)}catch(I){return F.c.Warn(`${Q}/pointer: Invalid pointer (${k}) skipped`),null}}}c(XO),u(XO,!0,(a=>new pO(a)));class oO{constructor(a,O,i){this.frame=a,this.action=O,this.onlyOnce=i,this.isDone=!1}_clone(){return new oO(this.frame,this.action,this.onlyOnce)}}var dO=i(12225),YO=i(12273),LO=i(12265);class sO{get loop(){return this._loop}set loop(a){a!==this._loop&&(this._loop=a,this.updateOptions({loop:a}))}get currentTime(){var a;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(a=YO.c.audioEngine)&&void 0!==a&&a.audioContext&&(this.isPlaying||this.isPaused)){const a=this.isPaused?0:YO.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+a}return 0}get spatialSound(){return this._spatialSound}set spatialSound(a){if(a==this._spatialSound)return;const O=this.isPlaying;this.pause(),a?(this._spatialSound=a,this._updateSpatialParameters()):this._disableSpatialSound(),O&&this.play()}constructor(a,O,i){var H;let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new P.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=b.ZO.Zero(),this._localDirection=new b.ZO(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=a,i=i||Z.b.LastCreatedScene)if(this._scene=i,sO._SceneComponentInitialization(i),this._readyToPlayCallback=G,this._customAttenuationFunction=(a,O,i,H,b)=>O<i?a*(1-O/i):0,Q&&(this.autoplay=Q.autoplay||!1,this._loop=Q.loop||!1,void 0!==Q.volume&&(this._volume=Q.volume),this._spatialSound=Q.spatialSound??!1,this.maxDistance=Q.maxDistance??100,this.useCustomAttenuation=Q.useCustomAttenuation??!1,this.rolloffFactor=Q.rolloffFactor||1,this.refDistance=Q.refDistance||1,this.distanceModel=Q.distanceModel||"linear",this._playbackRate=Q.playbackRate||1,this._streaming=Q.streaming??!1,this._length=Q.length,this._offset=Q.offset),null!==(H=YO.c.audioEngine)&&void 0!==H&&H.canUseWebAudio&&YO.c.audioEngine.audioContext){this._soundGain=YO.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let a=!0;if(O)try{"string"===typeof O?(this._urlType="String",this._url=O):O instanceof ArrayBuffer?this._urlType="ArrayBuffer":O instanceof HTMLMediaElement?this._urlType="MediaElement":O instanceof MediaStream?this._urlType="MediaStream":O instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(O)&&(this._urlType="Array");let i=[],H=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=YO.c.audioEngine.audioContext.createMediaElementSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=YO.c.audioEngine.audioContext.createMediaStreamSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":O.byteLength>0&&(H=!0,this._soundLoaded(O));break;case"AudioBuffer":this._audioBufferLoaded(O);break;case"String":i.push(O);case"Array":0===i.length&&(i=O);for(let a=0;a<i.length;a++){const O=i[a];if(H=Q&&Q.skipCodecCheck||-1!==O.indexOf(".mp3",O.length-4)&&YO.c.audioEngine.isMP3supported||-1!==O.indexOf(".ogg",O.length-4)&&YO.c.audioEngine.isOGGsupported||-1!==O.indexOf(".wav",O.length-4)||-1!==O.indexOf(".m4a",O.length-4)||-1!==O.indexOf(".mp4",O.length-4)||-1!==O.indexOf("blob:"),H){this._streaming?(this._htmlAudioElement=new Audio(O),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,q.Tools.SetCorsBehavior(O,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(O,(a=>{this._soundLoaded(a)}),void 0,!0,!0,(a=>{a&&F.c.Error("XHR "+a.status+" error on: "+O+"."),F.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:a=!1}a?H||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):F.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(k){F.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),YO.c.audioEngine&&!YO.c.audioEngine.WarnedWebAudioUnsupported&&(F.c.Error("Web Audio is not supported by your browser."),YO.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var a;null!==(a=YO.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(a){var O;null!==(O=YO.c.audioEngine)&&void 0!==O&&O.audioContext&&(this._audioBuffer=a,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(a){var O;null!==(O=YO.c.audioEngine)&&void 0!==O&&O.audioContext&&YO.c.audioEngine.audioContext.decodeAudioData(a,(a=>{this._audioBufferLoaded(a)}),(a=>{F.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+a)}))}setAudioBuffer(a){var O;null!==(O=YO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&(this._audioBuffer=a,this._isReadyToPlay=!0)}updateOptions(a){a&&(this.loop=a.loop??this.loop,this.maxDistance=a.maxDistance??this.maxDistance,this.useCustomAttenuation=a.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=a.rolloffFactor??this.rolloffFactor,this.refDistance=a.refDistance??this.refDistance,this.distanceModel=a.distanceModel??this.distanceModel,this._playbackRate=a.playbackRate??this._playbackRate,this._length=a.length??void 0,this.spatialSound=a.spatialSound??this._spatialSound,this._setOffset(a.offset??void 0),this.setVolume(a.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var a;null!==(a=YO.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&YO.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??YO.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var a;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(a=this._soundPanner)||void 0===a||a.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var a;null!==(a=YO.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(a){var O;null!==(O=YO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(a),this._isOutputConnected=!0)}setDirectionalCone(a,O,i){O<a?F.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=a,this._coneOuterAngle=O,this._coneOuterGain=i,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(a){if(a!=this._coneInnerAngle){var O;if(this._coneOuterAngle<a)return void F.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=a,null!==(O=YO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(a){if(a!=this._coneOuterAngle){var O;if(a<this._coneInnerAngle)return void F.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=a,null!==(O=YO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(a){var O;a.equals(this._position)||(this._position.q(a),null!==(O=YO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(a){var O;this._localDirection=a,null!==(O=YO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const a=this._connectedTransformNode.getWorldMatrix(),O=b.ZO.TransformNormal(this._localDirection,a);O.normalize(),this._soundPanner.orientationX.value=O.x,this._soundPanner.orientationY.value=O.y,this._soundPanner.orientationZ.value=O.z}updateDistanceFromListener(){var a;if(null!==(a=YO.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const a=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.FO(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,a,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(a){this._customAttenuationFunction=a}play(a,O,i){var H;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(H=YO.c.audioEngine)&&void 0!==H&&H.audioContext)try{var b,G;this._clearTimeoutsAndObservers();let H=a?(null===(b=YO.c.audioEngine)||void 0===b?void 0:b.audioContext.currentTime)+a:null===(G=YO.c.audioEngine)||void 0===G?void 0:G.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=YO.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const a=()=>{var i;if(null!==(i=YO.c.audioEngine)&&void 0!==i&&i.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=O??0;const i=this._htmlAudioElement.play();void 0!==i&&i.catch((()=>{var O,i;(null===(O=YO.c.audioEngine)||void 0===O||O.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(i=YO.c.audioEngine)||void 0===i?void 0:i.onAudioUnlockedObservable.addOnce((()=>{a()})))}))}else{var H;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(H=YO.c.audioEngine)||void 0===H?void 0:H.onAudioUnlockedObservable.addOnce((()=>{a()}))}};a()}}else{var q;const b=()=>{var b;if(null!==(b=YO.c.audioEngine)&&void 0!==b&&b.audioContext){var G;if(i=i||this._length,void 0!==O&&this._setOffset(O),this._soundSource){const a=this._soundSource;a.onended=()=>{a.disconnect()}}if(this._soundSource=null===(G=YO.c.audioEngine)||void 0===G?void 0:G.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var q;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==O&&(this._soundSource.loopStart=O),void 0!==i&&(this._soundSource.loopEnd=(0|O)+i),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},H=a?(null===(q=YO.c.audioEngine)||void 0===q?void 0:q.audioContext.currentTime)+a:YO.c.audioEngine.audioContext.currentTime;const b=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(H,b,this.loop?void 0:i)}}};"suspended"===(null===(q=YO.c.audioEngine)||void 0===q?void 0:q.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var a;"suspended"===(null===(a=YO.c.audioEngine)||void 0===a?void 0:a.audioContext.state)?(YO.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=YO.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{b()})))):b()}),500):b()}this._startTime=H,this.isPlaying=!0,this.isPaused=!1}catch(Q){F.c.Error("Error while trying to play audio: "+this.name+", "+Q.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(a){var O;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var i;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(i=this._streamingSource)||void 0===i||i.disconnect();this.isPlaying=!1}else if(null!==(O=YO.c.audioEngine)&&void 0!==O&&O.audioContext&&this._soundSource){const O=a?YO.c.audioEngine.audioContext.currentTime+a:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(O)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var a;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var O;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(O=this._streamingSource)||void 0===O||O.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(a=YO.c.audioEngine)&&void 0!==a&&a.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=YO.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(a,O){var i;null!==(i=YO.c.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._soundGain&&(O&&YO.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(YO.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,YO.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(a,YO.c.audioEngine.audioContext.currentTime+O)):this._soundGain.gain.value=a),this._volume=a}setPlaybackRate(a){this._playbackRate=a,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(a){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=a,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=a=>this._onRegisterAfterWorldMatrixUpdate(a),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(a){var O;if(a.getBoundingInfo){const O=a.getBoundingInfo();this.setPosition(O.boundingSphere.centerWorld)}else this.setPosition(a.absolutePosition);null!==(O=YO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const a=()=>{(0,LO.f)((()=>this._isReadyToPlay),(()=>{i._audioBuffer=this.getAudioBuffer(),i._isReadyToPlay=!0,i.autoplay&&i.play(0,this._offset,this._length)}),void 0,300)},O={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},i=new sO(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,O);return this.useCustomAttenuation&&i.setAttenuationFunction(this._customAttenuationFunction),i.setPosition(this._position),i.setPlaybackRate(this._playbackRate),a(),i}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const a={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(a.connectedMeshId=this._connectedTransformNode.id),a.position=this._position.Cb(),a.refDistance=this.refDistance,a.distanceModel=this.distanceModel,a.isDirectional=this._isDirectional,a.localDirectionToMesh=this._localDirection.Cb(),a.coneInnerAngle=this._coneInnerAngle,a.coneOuterAngle=this._coneOuterAngle,a.coneOuterGain=this._coneOuterGain),a}static Parse(a,O,i,H){const G=a.name;let q;q=a.url?i+a.url:i+G;const Q={autoplay:a.autoplay,loop:a.loop,volume:a.volume,spatialSound:a.spatialSound,maxDistance:a.maxDistance,rolloffFactor:a.rolloffFactor,refDistance:a.refDistance,distanceModel:a.distanceModel,playbackRate:a.playbackRate};let k;if(H){const a=()=>{(0,LO.f)((()=>H._isReadyToPlay),(()=>{k._audioBuffer=H.getAudioBuffer(),k._isReadyToPlay=!0,k.autoplay&&k.play(0,k._offset,k._length)}),void 0,300)};k=new sO(G,new ArrayBuffer(0),O,null,Q),a()}else k=new sO(G,q,O,(()=>{O.removePendingData(k)}),Q),O.addPendingData(k);if(a.position){const O=b.ZO.MO(a.position);k.setPosition(O)}if(a.isDirectional&&(k.setDirectionalCone(a.coneInnerAngle||360,a.coneOuterAngle||360,a.coneOuterGain||0),a.localDirectionToMesh)){const O=b.ZO.MO(a.localDirectionToMesh);k.setLocalDirectionToMesh(O)}if(a.connectedMeshId){const i=O.getMeshById(a.connectedMeshId);i&&k.attachToMesh(i)}return a.metadata&&(k.metadata=a.metadata),k}_setOffset(a){this._offset!==a&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=a)}_clearTimeoutsAndObservers(){var a;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(a=YO.c.audioEngine)||void 0===a||a.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}sO._SceneComponentInitialization=a=>{throw(0,dO.e)("AudioSceneComponent")},(0,Da.h)("BABYLON.Sound",sO);class tO{constructor(a,O,i){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],O.length!==i.length)throw new Error("Sounds length does not equal weights length");this.loop=a,this._weights=i;let H=0;for(const G of i)H+=G;const b=H>0?1/H:0;for(let G=0;G<this._weights.length;G++)this._weights[G]*=b;this._sounds=O;for(const G of this._sounds)G.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(a){if(a!==this._coneInnerAngle){if(this._coneOuterAngle<a)return void F.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=a;for(const O of this._sounds)O.directionalConeInnerAngle=a}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(a){if(a!==this._coneOuterAngle){if(a<this._coneInnerAngle)return void F.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=a;for(const O of this._sounds)O.directionalConeOuterAngle=a}}get volume(){return this._volume}set volume(a){if(a!==this._volume)for(const O of this._sounds)O.setVolume(a)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(a){if(!this.isPaused){this.stop();const a=Math.random();let O=0;for(let i=0;i<this._weights.length;i++)if(O+=this._weights[i],a<=O){this._currentIndex=i;break}}const O=this._sounds[this._currentIndex??0];O.isReady()?O.play(0,this.isPaused?void 0:a):O.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class VO{constructor(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(a=a||Z.b.LastCreatedScene)&&(this._scene=a,this.soundCollection=[],this._options=O,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var a;null!==(a=YO.c.audioEngine)&&void 0!==a&&a.canUseWebAudio&&YO.c.audioEngine.audioContext&&(this._outputAudioNode=YO.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(YO.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(YO.c.audioEngine&&YO.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(a){var O;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(O=YO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&a.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==a.soundTrackId&&(-1===a.soundTrackId?this._scene.mainSoundTrack.removeSound(a):this._scene.soundTracks&&this._scene.soundTracks[a.soundTrackId].removeSound(a)),this.soundCollection.push(a),a.soundTrackId=this.id}removeSound(a){const O=this.soundCollection.indexOf(a);-1!==O&&this.soundCollection.splice(O,1)}setVolume(a){var O;null!==(O=YO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=a)}switchPanningModelToHRTF(){var a;if(null!==(a=YO.c.audioEngine)&&void 0!==a&&a.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var a;if(null!==(a=YO.c.audioEngine)&&void 0!==a&&a.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToEqualPower()}connectToAnalyser(a){var O;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=a,null!==(O=YO.c.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,YO.c.audioEngine.masterGain))}}var ai=i(12682),Oi=i(12648),ii=i(12201);YO.c.AudioEngineFactory=(a,O,i)=>new Hi(a,O,i);class Hi{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new P.e,this.onAudioLockedObservable=new P.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,ii.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const H=document.createElement("audio");this._hostElement=a,this._audioContext=O,this._audioDestination=i;try{H&&H.canPlayType&&(H.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||H.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(b){}try{H&&H.canPlayType&&H.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(b){}}lock(){this._triggerSuspendedState()}unlock(){var a,O;if("running"===(null===(a=this._audioContext)||void 0===a?void 0:a.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(O=this._audioContext)||void 0===O||O.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{F.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var a;null===(a=this._audioContext)||void 0===a||a.addEventListener("statechange",(()=>{var a;this.unlocked&&"running"!==(null===(a=this._audioContext)||void 0===a?void 0:a.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var a;return null!==(a=this._audioContext)&&void 0!==a&&a.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(a){this.canUseWebAudio=!1,F.c.Error("Web Audio: "+a.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(a){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const a=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",O=document.createElement("style");O.appendChild(document.createTextNode(a)),document.getElementsByTagName("head")[0].appendChild(O),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var a;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(a=this._audioContext)||void 0===a||a.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(a){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=a)}connectToAnalyser(a){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=a,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var bi=i(12218);(0,i(13787).f)(ai.b.NAME_AUDIO,((a,O,i,H)=>{let b,G=[];if(i.Mj=i.Mj||[],void 0!==a.Mj&&null!==a.Mj)for(let Q=0,k=a.Mj.length;Q<k;Q++){var q;const k=a.Mj[Q];null!==(q=YO.c.audioEngine)&&void 0!==q&&q.canUseWebAudio?(k.url||(k.url=k.name),G[k.url]?i.Mj.push(sO.Parse(k,O,H,G[k.url])):(b=sO.Parse(k,O,H),G[k.url]=b,i.Mj.push(b))):i.Mj.push(new sO(k.name,null,O))}G=[]})),Object.defineProperty(Oi.c.prototype,"mainSoundTrack",{get:function(){let a=this._getComponent(ai.b.NAME_AUDIO);return a||(a=new Gi(this),this.o(a)),this._mainSoundTrack||(this._mainSoundTrack=new VO(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Oi.c.prototype.getSoundByName=function(a){let O;for(O=0;O<this.mainSoundTrack.soundCollection.length;O++)if(this.mainSoundTrack.soundCollection[O].name===a)return this.mainSoundTrack.soundCollection[O];if(this.soundTracks)for(let i=0;i<this.soundTracks.length;i++)for(O=0;O<this.soundTracks[i].soundCollection.length;O++)if(this.soundTracks[i].soundCollection[O].name===a)return this.soundTracks[i].soundCollection[O];return null},Object.defineProperty(Oi.c.prototype,"audioEnabled",{get:function(){let a=this._getComponent(ai.b.NAME_AUDIO);return a||(a=new Gi(this),this.o(a)),a.audioEnabled},set:function(a){let O=this._getComponent(ai.b.NAME_AUDIO);O||(O=new Gi(this),this.o(O)),a?O.enableAudio():O.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Oi.c.prototype,"headphone",{get:function(){let a=this._getComponent(ai.b.NAME_AUDIO);return a||(a=new Gi(this),this.o(a)),a.headphone},set:function(a){let O=this._getComponent(ai.b.NAME_AUDIO);O||(O=new Gi(this),this.o(O)),a?O.switchAudioModeForHeadphones():O.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Oi.c.prototype,"audioListenerPositionProvider",{get:function(){let a=this._getComponent(ai.b.NAME_AUDIO);return a||(a=new Gi(this),this.o(a)),a.audioListenerPositionProvider},set:function(a){let O=this._getComponent(ai.b.NAME_AUDIO);if(O||(O=new Gi(this),this.o(O)),a&&"function"!==typeof a)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");O.audioListenerPositionProvider=a},enumerable:!0,configurable:!0}),Object.defineProperty(Oi.c.prototype,"audioListenerRotationProvider",{get:function(){let a=this._getComponent(ai.b.NAME_AUDIO);return a||(a=new Gi(this),this.o(a)),a.audioListenerRotationProvider},set:function(a){let O=this._getComponent(ai.b.NAME_AUDIO);if(O||(O=new Gi(this),this.o(O)),a&&"function"!==typeof a)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");O.audioListenerRotationProvider=a},enumerable:!0,configurable:!0}),Object.defineProperty(Oi.c.prototype,"audioPositioningRefreshRate",{get:function(){let a=this._getComponent(ai.b.NAME_AUDIO);return a||(a=new Gi(this),this.o(a)),a.audioPositioningRefreshRate},set:function(a){let O=this._getComponent(ai.b.NAME_AUDIO);O||(O=new Gi(this),this.o(O)),O.audioPositioningRefreshRate=a},enumerable:!0,configurable:!0});class Gi{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(a){this.name=ai.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new b.ZO,this._cachedCameraPosition=new b.ZO,this._lastCheck=0,this._invertMatrixTemp=new b.Matrix,this._cameraDirectionTemp=new b.ZO,(a=a||Z.b.LastCreatedScene)&&(this.rO=a,a.soundTracks=[],a.Mj=[])}register(){this.rO._afterRenderStage.registerStep(ai.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(a){if(a.Mj=[],this.rO.soundTracks)for(let O=0;O<this.rO.soundTracks.length;O++){const i=this.rO.soundTracks[O];for(let O=0;O<i.soundCollection.length;O++)a.Mj.push(i.soundCollection[O].serialize())}}addFromContainer(a){if(a.Mj)for(const O of a.Mj)O.play(),O.autoplay=!0,this.rO.mainSoundTrack.addSound(O)}removeFromContainer(a){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(a.Mj)for(const i of a.Mj)i.stop(),i.autoplay=!1,this.rO.mainSoundTrack.removeSound(i),O&&i.dispose()}dispose(){const a=this.rO;if(a._mainSoundTrack&&a.mainSoundTrack.dispose(),a.soundTracks)for(let O=0;O<a.soundTracks.length;O++)a.soundTracks[O].dispose()}disableAudio(){const a=this.rO;let O;for(this._audioEnabled=!1,YO.c.audioEngine&&YO.c.audioEngine.audioContext&&YO.c.audioEngine.audioContext.suspend(),O=0;O<a.mainSoundTrack.soundCollection.length;O++)a.mainSoundTrack.soundCollection[O].pause();if(a.soundTracks)for(O=0;O<a.soundTracks.length;O++)for(let i=0;i<a.soundTracks[O].soundCollection.length;i++)a.soundTracks[O].soundCollection[i].pause()}enableAudio(){const a=this.rO;let O;for(this._audioEnabled=!0,YO.c.audioEngine&&YO.c.audioEngine.audioContext&&YO.c.audioEngine.audioContext.resume(),O=0;O<a.mainSoundTrack.soundCollection.length;O++)a.mainSoundTrack.soundCollection[O].isPaused&&a.mainSoundTrack.soundCollection[O].play();if(a.soundTracks)for(O=0;O<a.soundTracks.length;O++)for(let i=0;i<a.soundTracks[O].soundCollection.length;i++)a.soundTracks[O].soundCollection[i].isPaused&&a.soundTracks[O].soundCollection[i].play()}switchAudioModeForHeadphones(){const a=this.rO;if(this._headphone=!0,a.mainSoundTrack.switchPanningModelToHRTF(),a.soundTracks)for(let O=0;O<a.soundTracks.length;O++)a.soundTracks[O].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const a=this.rO;if(this._headphone=!1,a.mainSoundTrack.switchPanningModelToEqualPower(),a.soundTracks)for(let O=0;O<a.soundTracks.length;O++)a.soundTracks[O].switchPanningModelToEqualPower()}_afterRender(){const a=bi.c.Now;if(this._lastCheck&&a-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=a;const O=this.rO;if(!this._audioEnabled||!O._mainSoundTrack||!O.soundTracks||0===O._mainSoundTrack.soundCollection.length&&1===O.soundTracks.length)return;const i=YO.c.audioEngine;if(i&&i.audioContext){let a,H=O.activeCamera;if(O.activeCameras&&O.activeCameras.length>0&&(H=O.activeCameras[0]),this.audioListenerPositionProvider){const a=this.audioListenerPositionProvider();i.audioContext.listener.setPosition(a.x||0,a.y||0,a.z||0)}else H?this._cachedCameraPosition.equals(H.globalPosition)||(this._cachedCameraPosition.q(H.globalPosition),i.audioContext.listener.setPosition(H.globalPosition.x,H.globalPosition.y,H.globalPosition.z)):i.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const a=this.audioListenerRotationProvider();i.audioContext.listener.setOrientation(a.x||0,a.y||0,a.z||0,0,1,0)}else H?(H.rigCameras&&H.rigCameras.length>0&&(H=H.rigCameras[0]),H.getViewMatrix().invertToRef(this._invertMatrixTemp),b.ZO.TransformNormalToRef(Gi._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.q(this._cameraDirectionTemp),i.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):i.audioContext.listener.setOrientation(0,0,0,0,1,0);for(a=0;a<O.mainSoundTrack.soundCollection.length;a++){const i=O.mainSoundTrack.soundCollection[a];i.useCustomAttenuation&&i.updateDistanceFromListener()}if(O.soundTracks)for(a=0;a<O.soundTracks.length;a++)for(let i=0;i<O.soundTracks[a].soundCollection.length;i++){const H=O.soundTracks[a].soundCollection[i];H.useCustomAttenuation&&H.updateDistanceFromListener()}}}}Gi._CameraDirection=new b.ZO(0,0,-1),sO._SceneComponentInitialization=a=>{let O=a._getComponent(ai.b.NAME_AUDIO);O||(O=new Gi(a),a.o(O))};const qi="MSFT_audio_emitter";class Qi{constructor(a){this.name=qi,this._loader=a,this.enabled=this._loader.isExtensionUsed(qi)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const a=this._loader.Fb.extensions;if(a&&a[this.name]){const O=a[this.name];this._clips=O.clips,this._emitters=O.emitters,g.Assign(this._clips),g.Assign(this._emitters)}}loadSceneAsync(a,O){return v.LoadExtensionAsync(a,O,this.name,(async(i,H)=>{const b=new Array;b.push(this._loader.loadSceneAsync(a,O));for(const a of H.emitters){const O=g.Get(`${i}/emitters`,this._emitters,a);if(void 0!=O.refDistance||void 0!=O.maxDistance||void 0!=O.rolloffFactor||void 0!=O.distanceModel||void 0!=O.innerAngle||void 0!=O.outerAngle)throw new Error(`${i}: Direction or Distance properties are not allowed on emitters attached to a scene`);b.push(this._loadEmitterAsync(`${i}/emitters/${O.index}`,O))}await Promise.all(b)}))}loadNodeAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(a,H)=>{const G=new Array,Q=await this._loader.loadNodeAsync(a,O,(O=>{for(const i of H.emitters){const H=g.Get(`${a}/emitters`,this._emitters,i);G.push(this._loadEmitterAsync(`${a}/emitters/${H.index}`,H).then((()=>{for(const a of H._babylonSounds)a.attachToMesh(O),void 0==H.innerAngle&&void 0==H.outerAngle||(a.setLocalDirectionToMesh(b.ZO.Forward()),a.setDirectionalCone(2*q.Tools.ToDegrees(void 0==H.innerAngle?Math.PI:H.innerAngle),2*q.Tools.ToDegrees(void 0==H.outerAngle?Math.PI:H.outerAngle),0))})))}i(O)}));return await Promise.all(G),Q}))}loadAnimationAsync(a,O){return v.LoadExtensionAsync(a,O,this.name,(async(i,H)=>{const b=await this._loader.loadAnimationAsync(a,O),G=new Array;g.Assign(H.events);for(const q of H.events)G.push(this._loadAnimationEventAsync(`${i}/events/${q.index}`,a,O,q,b));return await Promise.all(G),b}))}_loadClipAsync(a,O){if(O._objectURL)return O._objectURL;let i;if(O.uri)i=this._loader.loadUriAsync(a,O,O.uri);else{const H=g.Get(`${a}/bufferView`,this._loader.Fb.bufferViews,O.bufferView);i=this._loader.loadBufferViewAsync(`/bufferViews/${H.index}`,H)}return O._objectURL=i.then((a=>URL.createObjectURL(new Blob([a],{type:O.mimeType})))),O._objectURL}_loadEmitterAsync(a,O){if(O._babylonSounds=O._babylonSounds||[],!O._babylonData){const a=new Array,i=O.name||`emitter${O.index}`,H={loop:!1,autoplay:!1,volume:void 0==O.volume?1:O.volume};for(let G=0;G<O.clips.length;G++){const b=`/extensions/${this.name}/clips`,q=g.Get(b,this._clips,O.clips[G].clip);a.push(this._loadClipAsync(`${b}/${O.clips[G].clip}`,q).then((a=>{const b=O._babylonSounds[G]=new sO(i,a,this._loader.babylonScene,null,H);b.refDistance=O.refDistance||1,b.maxDistance=O.maxDistance||256,b.rolloffFactor=O.rolloffFactor||1,b.distanceModel=O.distanceModel||"exponential"})))}const b=Promise.all(a).then((()=>{const a=O.clips.map((a=>a.weight||1)),i=new tO(O.loop||!1,O._babylonSounds,a);O.innerAngle&&(i.directionalConeInnerAngle=2*q.Tools.ToDegrees(O.innerAngle)),O.outerAngle&&(i.directionalConeOuterAngle=2*q.Tools.ToDegrees(O.outerAngle)),O.volume&&(i.volume=O.volume),O._babylonData.sound=i}));O._babylonData={loaded:b}}return O._babylonData.loaded}_getEventAction(a,O,i,H,b){switch(i){case"play":return a=>{const i=(b||0)+(a-H);O.play(i)};case"stop":return()=>{O.stop()};case"pause":return()=>{O.pause()};default:throw new Error(`${a}: Unsupported action ${i}`)}}_loadAnimationEventAsync(a,O,i,H,b){if(0==b.targetedAnimations.length)return Promise.resolve();const G=b.targetedAnimations[0],q=H.HO,Q=g.Get(`/extensions/${this.name}/emitters`,this._emitters,q);return this._loadEmitterAsync(a,Q).then((()=>{const O=Q._babylonData.sound;if(O){const i=new oO(H.time,this._getEventAction(a,O,H.action,H.time,H.startOffset));G.animation.addEvent(i),b.onAnimationGroupEndObservable.add((()=>{O.stop()})),b.onAnimationGroupPauseObservable.add((()=>{O.pause()}))}}))}}c(qi),u(qi,!0,(a=>new Qi(a)));const ki="MSFT_lod";class Ii{constructor(a){var O;this.name=ki,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new P.e,this.onMaterialLODsLoadedObservable=new P.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=a,this.maxLODsToLoad=(null===(O=this._loader.parent.extensionOptions[ki])||void 0===O?void 0:O.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(ki)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let a=0;a<this._nodePromiseLODs.length;a++){const O=Promise.all(this._nodePromiseLODs[a]).then((()=>{0!==a&&(this._loader.endPerformanceCounter(`Node LOD ${a}`),this._loader.log(`Loaded node LOD ${a}`)),this.onNodeLODsLoadedObservable.notifyObservers(a),a!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${a+1}`),this._loadBufferLOD(this._nodeBufferLODs,a+1),this._nodeSignalLODs[a]&&this._nodeSignalLODs[a].resolve())}));this._loader._completePromises.push(O)}for(let a=0;a<this._materialPromiseLODs.length;a++){const O=Promise.all(this._materialPromiseLODs[a]).then((()=>{0!==a&&(this._loader.endPerformanceCounter(`Material LOD ${a}`),this._loader.log(`Loaded material LOD ${a}`)),this.onMaterialLODsLoadedObservable.notifyObservers(a),a!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${a+1}`),this._loadBufferLOD(this._materialBufferLODs,a+1),this._materialSignalLODs[a]&&this._materialSignalLODs[a].resolve())}));this._loader._completePromises.push(O)}}loadSceneAsync(a,O){const i=this._loader.loadSceneAsync(a,O);return this._loadBufferLOD(this._bufferLODs,0),i}loadNodeAsync(a,O,i){return v.LoadExtensionAsync(a,O,this.name,(async(a,b)=>{let G;const q=this._getLODs(a,O,this._loader.Fb.nodes,b.ids);this._loader.logOpen(`${a}`);for(let O=0;O<q.length;O++){const a=q[O];0!==O&&(this._nodeIndexLOD=O,this._nodeSignalLODs[O]=this._nodeSignalLODs[O]||new H);const b=a=>{i(a),a.Ok(!1)},Q=this._loader.loadNodeAsync(`/nodes/${a.index}`,a,b).then((a=>{if(0!==O){const a=q[O-1];a._babylonTransformNode&&(this._disposeTransformNode(a._babylonTransformNode),delete a._babylonTransformNode)}return a.Ok(!0),a}));this._nodePromiseLODs[O]=this._nodePromiseLODs[O]||[],0===O?G=Q:(this._nodeIndexLOD=null,this._nodePromiseLODs[O].push(Q))}return this._loader.logClose(),await G}))}_loadMaterialAsync(a,O,i,H,b){return this._nodeIndexLOD?null:v.LoadExtensionAsync(a,O,this.name,(async(a,G)=>{let q;const Q=this._getLODs(a,O,this._loader.Fb.materials,G.ids);this._loader.logOpen(`${a}`);for(let O=0;O<Q.length;O++){const a=Q[O];0!==O&&(this._materialIndexLOD=O);const G=this._loader._loadMaterialAsync(`/materials/${a.index}`,a,i,H,(a=>{0===O&&b(a)})).then((a=>{if(0!==O){b(a);const i=Q[O-1]._data;i[H]&&(this._disposeMaterials([i[H].babylonMaterial]),delete i[H])}return a}));this._materialPromiseLODs[O]=this._materialPromiseLODs[O]||[],0===O?q=G:(this._materialIndexLOD=null,this._materialPromiseLODs[O].push(G))}return this._loader.logClose(),await q}))}_loadUriAsync(a,O,i){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const b=this._nodeIndexLOD-1;return this._nodeSignalLODs[b]=this._nodeSignalLODs[b]||new H,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(a,O,i)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const b=this._materialIndexLOD-1;return this._materialSignalLODs[b]=this._materialSignalLODs[b]||new H,this._materialSignalLODs[b].promise.then((async()=>await this._loader.loadUriAsync(a,O,i)))}return null}loadBufferAsync(a,O,i,b){if(this._loader.parent.useRangeRequests&&!O.uri){if(!this._loader.bin)throw new Error(`${a}: Uri is missing or the binary glTF is missing its binary chunk`);const O=async(a,O)=>{const G=i,q=G+b-1;let Q=a[O];return Q?(Q.start=Math.min(Q.start,G),Q.end=Math.max(Q.end,q)):(Q={start:G,end:q,loaded:new H},a[O]=Q),await Q.loaded.promise.then((a=>new Uint8Array(a.buffer,a.byteOffset+i-Q.start,b)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?O(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?O(this._materialBufferLODs,this._materialIndexLOD):O(this._bufferLODs,0)}return null}_loadBufferLOD(a,O){const i=a[O];i&&(this._loader.log(`Loading buffer range [${i.start}-${i.end}]`),this._loader.bin.readAsync(i.start,i.end-i.start+1).then((a=>{i.loaded.resolve(a)}),(a=>{i.loaded.reject(a)})))}_getLODs(a,O,i,H){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const b=[];for(let G=H.length-1;G>=0;G--)if(b.push(g.Get(`${a}/ids/${H[G]}`,i,H[G])),b.length===this.maxLODsToLoad)return b;return b.push(O),b}_disposeTransformNode(a){const O=[],i=a.material;i&&O.push(i);for(const b of a.getChildMeshes())b.material&&O.push(b.material);a.dispose();const H=O.filter((a=>this._loader.babylonScene.meshes.every((O=>O.material!=a))));this._disposeMaterials(H)}_disposeMaterials(a){const O={};for(const i of a){for(const a of i.getActiveTextures())O[a.uniqueId]=a;i.dispose()}for(const i in O)for(const a of this._loader.babylonScene.materials)a.hasTexture(O[i])&&delete O[i];for(const i in O)O[i].dispose()}}c(ki),u(ki,!0,(a=>new Ii(a)));const Pi="MSFT_minecraftMesh";class ei{constructor(a){this.name=Pi,this._loader=a,this.enabled=this._loader.isExtensionUsed(Pi)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtraAsync(a,O,this.name,(async(H,b)=>{if(b){if(!(i instanceof M.e))throw new Error(`${H}: Material type not supported`);const b=this._loader.loadMaterialPropertiesAsync(a,O,i);return i.needAlphaBlending()&&(i.forceDepthWrite=!0,i.separateCullingPass=!0),i.Sb=i.forceDepthWrite,i.twoSidedLighting=!0,await b}}))}}c(Pi),u(Pi,!0,(a=>new ei(a)));const hi="MSFT_sRGBFactors";class ji{constructor(a){this.name=hi,this._loader=a,this.enabled=this._loader.isExtensionUsed(hi)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,O,i){return v.LoadExtraAsync(a,O,this.name,(async(H,b)=>{if(b){if(!(i instanceof M.e))throw new Error(`${H}: Material type not supported`);const b=this._loader.loadMaterialPropertiesAsync(a,O,i),G=i.Ua().getEngine().useExactSrgbConversions;return i.albedoTexture||i.albedoColor.toLinearSpaceToRef(i.albedoColor,G),i.reflectivityTexture||i.reflectivityColor.toLinearSpaceToRef(i.reflectivityColor,G),await b}}))}}c(hi),u(hi,!0,(a=>new ji(a)));var Zi=i(14107);const Fi={};var ri=i(14157),Ji=i(14132),mH=i(14113),Mi=i(14124);function Ci(a,O){for(const i of a)for(const a of i.dataOutputs)if(a.uniqueId===O)return a;throw new Error("Could not find data out connection with unique id "+O)}function ni(a,O){for(const i of a)if(i instanceof Ji.c)for(const a of i.signalInputs)if(a.uniqueId===O)return a;throw new Error("Could not find signal in connection with unique id "+O)}async function Di(a,O){const H=await Promise.all(a.allBlocks.map((async a=>{const O=function(a){switch(a){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([i.e(78),i.e(79)]).then(i.bind(i,15577))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await i.e(80).then(i.bind(i,15580))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await i.e(81).then(i.bind(i,15582))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await i.e(82).then(i.bind(i,15591))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await i.e(83).then(i.bind(i,15600))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await i.e(84).then(i.bind(i,15608))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await i.e(85).then(i.bind(i,15613))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await i.e(86).then(i.bind(i,15617))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await i.e(87).then(i.bind(i,15624))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await i.e(89).then(i.bind(i,15638))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await i.e(89).then(i.bind(i,15638))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await i.e(89).then(i.bind(i,15638))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await i.e(89).then(i.bind(i,15638))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await i.e(89).then(i.bind(i,15638))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await i.e(89).then(i.bind(i,15638))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await i.e(90).then(i.bind(i,15645))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await i.e(90).then(i.bind(i,15645))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await i.e(90).then(i.bind(i,15645))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await i.e(90).then(i.bind(i,15645))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await i.e(95).then(i.bind(i,15648))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await i.e(96).then(i.bind(i,15650))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await i.e(97).then(i.bind(i,15654))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await i.e(98).then(i.bind(i,15656))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await i.e(99).then(i.bind(i,15660))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await i.e(100).then(i.bind(i,15666))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await i.e(101).then(i.bind(i,15669))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await i.e(102).then(i.bind(i,15674))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await i.e(103).then(i.bind(i,15677))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await i.e(104).then(i.bind(i,15682))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await i.e(105).then(i.bind(i,15687))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await i.e(106).then(i.bind(i,15691))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await i.e(107).then(i.bind(i,15700))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await i.e(108).then(i.bind(i,15702))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await i.e(109).then(i.bind(i,15711))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await i.e(110).then(i.bind(i,15719))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await i.e(111).then(i.bind(i,15728))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await i.e(112).then(i.bind(i,15730))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await i.e(113).then(i.bind(i,15735))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await i.e(92).then(i.bind(i,15741))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await i.e(114).then(i.bind(i,15749))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await i.e(115).then(i.bind(i,15758))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await i.e(116).then(i.bind(i,15763))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await i.e(93).then(i.bind(i,15768))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await i.e(88).then(i.bind(i,15626))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await i.e(94).then(i.bind(i,15777))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await i.e(94).then(i.bind(i,15777))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await i.e(94).then(i.bind(i,15777))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await i.e(94).then(i.bind(i,15777))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await i.e(94).then(i.bind(i,15777))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await i.e(94).then(i.bind(i,15777))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await i.e(94).then(i.bind(i,15777))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await i.e(94).then(i.bind(i,15777))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await i.e(89).then(i.bind(i,15638))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await i.e(89).then(i.bind(i,15638))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await i.e(89).then(i.bind(i,15638))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await i.e(89).then(i.bind(i,15638))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await i.e(89).then(i.bind(i,15638))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await i.e(89).then(i.bind(i,15638))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await i.e(89).then(i.bind(i,15638))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await i.e(90).then(i.bind(i,15645))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await i.e(90).then(i.bind(i,15645))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await i.e(91).then(i.bind(i,15782))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await i.e(91).then(i.bind(i,15782))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await i.e(91).then(i.bind(i,15782))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await i.e(91).then(i.bind(i,15782))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await i.e(91).then(i.bind(i,15782))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await i.e(91).then(i.bind(i,15782))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await i.e(117).then(i.bind(i,15785))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await i.e(118).then(i.bind(i,15787))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await i.e(119).then(i.bind(i,15791))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await i.e(120).then(i.bind(i,15794))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await i.e(121).then(i.bind(i,15799))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await i.e(122).then(i.bind(i,15808))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await i.e(123).then(i.bind(i,15816))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await i.e(124).then(i.bind(i,15819))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await i.e(125).then(i.bind(i,15823))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await i.e(126).then(i.bind(i,15831))).FlowGraphDataSwitchBlock;default:if(Fi[a])return Fi[a];throw new Error(`Unknown block name ${a}`)}}(a.className);return await O()})));return function(a,O,i){const H=O.coordinator.createGraph(),b=[],G=O.valueParseFunction??mH.c;for(let q=0;q<a.allBlocks.length;q++){const Q=yi(a.allBlocks[q],{rO:O.coordinator.config.rO,pathConverter:O.pathConverter,assetsContainer:O.coordinator.config.rO,valueParseFunction:G},i[q]);b.push(Q),Q instanceof ri.c&&H.addEventBlock(Q)}for(const q of b){for(const a of q.dataInputs)for(const O of a.connectedPointIds){const i=Ci(b,O);a.connectTo(i)}if(q instanceof Ji.c)for(const a of q.signalOutputs)for(const O of a.connectedPointIds){const i=ni(b,O);a.connectTo(i)}}for(const q of a.executionContexts)Ui(q,{graph:H,valueParseFunction:G},a.rightHanded);return H}(a,O,H)}function Ui(a,O,i){const H=O.graph.createContext();a.enableLogging&&(H.enableLogging=!0),H.treatDataAsRightHanded=i||!1;const b=O.valueParseFunction??mH.c;H.uniqueId=a.uniqueId;const G=H.Ua();if(a._assetsContext){var q,Q,k,I,P,e,h,j,Z,F;const O=a._assetsContext,i={meshes:null===(q=O.meshes)||void 0===q?void 0:q.map((a=>G.getMeshById(a))),lights:null===(Q=O.lights)||void 0===Q?void 0:Q.map((a=>G.getLightByName(a))),cameras:null===(k=O.cameras)||void 0===k?void 0:k.map((a=>G.getCameraByName(a))),materials:null===(I=O.materials)||void 0===I?void 0:I.map((a=>G.getMaterialById(a))),textures:null===(P=O.textures)||void 0===P?void 0:P.map((a=>G.getTextureByName(a))),animations:null===(e=O.animations)||void 0===e?void 0:e.map((a=>G.animations.find((O=>O.name===a)))),skeletons:null===(h=O.skeletons)||void 0===h?void 0:h.map((a=>G.getSkeletonByName(a))),Eh:null===(j=O.Eh)||void 0===j?void 0:j.map((a=>G.getParticleSystemById(a))),animationGroups:null===(Z=O.animationGroups)||void 0===Z?void 0:Z.map((a=>G.getAnimationGroupByName(a))),transformNodes:null===(F=O.transformNodes)||void 0===F?void 0:F.map((a=>G.getTransformNodeById(a))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Mj:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};H.assetsContext=i}for(const r in a._userVariables){const O=b(r,a._userVariables,H.assetsContext,G);H.userVariables[r]=O}for(const r in a._connectionValues){const O=b(r,a._connectionValues,H.assetsContext,G);H._setConnectionValueByKey(r,O)}return H}function yi(a,O,i){const H={},b=O.valueParseFunction??mH.c;if(a.config)for(const q in a.config)H[q]=b(q,a.config,O.assetsContainer||O.rO,O.rO);if((0,mH.h)(a.className)){if(!O.pathConverter)throw new Error("Path converter is required for this block");H.pathConverter=O.pathConverter}const G=new i(H);G.uniqueId=a.uniqueId;for(let q=0;q<a.dataInputs.length;q++){const O=G.getDataInput(a.dataInputs[q].name);if(!O)throw new Error("Could not find data input with name "+a.dataInputs[q].name+" in block "+a.className);O.deserialize(a.dataInputs[q])}for(let q=0;q<a.dataOutputs.length;q++){const O=G.getDataOutput(a.dataOutputs[q].name);if(!O)throw new Error("Could not find data output with name "+a.dataOutputs[q].name+" in block "+a.className);O.deserialize(a.dataOutputs[q])}return G.metadata=a.metadata,G.deserialize&&G.deserialize(a),G}function wi(a){const[O,i]=a.split(":");return Ki({op:O,extension:i})}function Ki(a){var O;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const H=a.extension?null===(O=fi[a.extension])||void 0===O?void 0:O[a.op]:Bi[a.op];if(!H&&(F.c.Warn(`No mapping found for operation ${a.op} and extension ${a.extension||"KHR_interactivity"}`),i)){const O={},i={flows:{}};if(a.inputValueSockets){O.values={};for(const i in a.inputValueSockets)O.values[i]={name:i}}return a.outputValueSockets&&(i.values={},Object.keys(a.outputValueSockets).forEach((a=>{i.values[a]={name:a}}))),{wP:[],inputs:O,outputs:i}}return H}function Si(a,O,i){fi[O]||(fi[O]={}),fi[O][a]=i}const fi={BABYLON:{"flow/log":{wP:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Bi={"event/onStart":{wP:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{wP:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{wP:["FlowGraphSendCustomEventBlock"],extraProcessor(a,O,i,H,b){if("event/send"!==O.op||!a.configuration||1!==Object.keys(a.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const G=a.configuration.event.value[0];if("number"!==typeof G)throw new Error("Event id should be a number");const q=H.arrays.events[G],Q=b[0];return Q.config||(Q.config={}),Q.config.eventId=q.eventId,Q.config.eventData=q.eventData,b}},"event/receive":{wP:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(a,O){var i;if(!a.configuration)return F.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const H=a.configuration.event;if(!H)return F.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const b=H.value[0];if("number"!==typeof b)return F.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(i=O.events)||void 0===i?void 0:i[b])?{valid:!0}:(F.c.Error(`Event with id ${b} not found`),{valid:!1,error:`Event with id ${b} not found`})},extraProcessor(a,O,i,H,b){if("event/receive"!==O.op||!a.configuration||1!==Object.keys(a.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const G=a.configuration.event.value[0];if("number"!==typeof G)throw new Error("Event id should be a number");const q=H.arrays.events[G],Q=b[0];return Q.config||(Q.config={}),Q.config.eventId=q.eventId,Q.config.eventData=q.eventData,b}},"math/e":Ti("FlowGraphEBlock"),"math/pi":Ti("FlowGraphPIBlock"),"math/inf":Ti("FlowGraphInfBlock"),"math/nan":Ti("FlowGraphNaNBlock"),"math/abs":Ti("FlowGraphAbsBlock"),"math/sign":Ti("FlowGraphSignBlock"),"math/trunc":Ti("FlowGraphTruncBlock"),"math/floor":Ti("FlowGraphFloorBlock"),"math/ceil":Ti("FlowGraphCeilBlock"),"math/round":{wP:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,O,i,H,b){var G;return(G=b[0]).config||(G.config={}),b[0].config.roundHalfAwayFromZero=!0,b}},"math/fract":Ti("FlowGraphFractBlock"),"math/neg":Ti("FlowGraphNegationBlock"),"math/add":Ti("FlowGraphAddBlock",["a","b"],!0),"math/sub":Ti("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{wP:["FlowGraphMultiplyBlock"],extraProcessor(a,O,i,H,b){var G;(G=b[0]).config||(G.config={}),b[0].config.useMatrixPerComponent=!0,b[0].config.preventIntegerFloatArithmetic=!0;let q=-1;return Object.keys(a.values||{}).find((O=>{var i;return void 0!==(null===(i=a.values)||void 0===i?void 0:i[O].type)&&(q=a.values[O].type,!0)})),-1!==q&&(b[0].config.type=H.arrays.types[q].flowGraphType),b},validation:a=>a.values?Ai(a):{valid:!0}},"math/div":Ti("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Ti("FlowGraphModuloBlock",["a","b"]),"math/min":Ti("FlowGraphMinBlock",["a","b"]),"math/max":Ti("FlowGraphMaxBlock",["a","b"]),"math/clamp":Ti("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Ti("FlowGraphSaturateBlock"),"math/mix":Ti("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Ti("FlowGraphEqualityBlock",["a","b"]),"math/lt":Ti("FlowGraphLessThanBlock",["a","b"]),"math/le":Ti("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Ti("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Ti("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Ti("FlowGraphIsNaNBlock"),"math/isinf":Ti("FlowGraphIsInfBlock"),"math/select":{wP:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{wP:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Ti("FlowGraphSinBlock"),"math/cos":Ti("FlowGraphCosBlock"),"math/tan":Ti("FlowGraphTanBlock"),"math/asin":Ti("FlowGraphASinBlock"),"math/acos":Ti("FlowGraphACosBlock"),"math/atan":Ti("FlowGraphATanBlock"),"math/atan2":Ti("FlowGraphATan2Block",["a","b"]),"math/sinh":Ti("FlowGraphSinhBlock"),"math/cosh":Ti("FlowGraphCoshBlock"),"math/tanh":Ti("FlowGraphTanhBlock"),"math/asinh":Ti("FlowGraphASinhBlock"),"math/acosh":Ti("FlowGraphACoshBlock"),"math/atanh":Ti("FlowGraphATanhBlock"),"math/exp":Ti("FlowGraphExponentialBlock"),"math/log":Ti("FlowGraphLogBlock"),"math/log2":Ti("FlowGraphLog2Block"),"math/log10":Ti("FlowGraphLog10Block"),"math/sqrt":Ti("FlowGraphSquareRootBlock"),"math/cbrt":Ti("FlowGraphCubeRootBlock"),"math/pow":Ti("FlowGraphPowerBlock",["a","b"]),"math/length":Ti("FlowGraphLengthBlock"),"math/normalize":Ti("FlowGraphNormalizeBlock"),"math/dot":Ti("FlowGraphDotBlock",["a","b"]),"math/cross":Ti("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Ti("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Ti("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{wP:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{wP:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{wP:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{wP:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{wP:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{wP:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{wP:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Ti("FlowGraphTransposeBlock"),"math/determinant":Ti("FlowGraphDeterminantBlock"),"math/inverse":Ti("FlowGraphInvertMatrixBlock"),"math/matmul":Ti("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{wP:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Bb",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,O,i,H,b,G){const q=b[0].dataInputs.find((a=>"rotationQuaternion"===a.name));if(!q)throw new Error("Rotation quaternion input not found");return G._connectionValues[q.uniqueId]&&(G._connectionValues[q.uniqueId].type="Quaternion"),b}},"math/matDecompose":{wP:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Bb"}}}},"math/quatConjugate":Ti("FlowGraphConjugateBlock",["a"]),"math/quatMul":{wP:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,O,i,H,b){var G;return(G=b[0]).config||(G.config={}),b[0].config.type="Quaternion",b}},"math/quatAngleBetween":Ti("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{wP:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Ti("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Ti("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{wP:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,O,i,H,b){var G;return(G=b[0]).config||(G.config={}),b[0].config.inputIsColumnMajor=!0,b}},"math/extract2x2":{wP:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{wP:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,O,i,H,b){var G;return(G=b[0]).config||(G.config={}),b[0].config.inputIsColumnMajor=!0,b}},"math/extract3x3":{wP:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{wP:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,O,i,H,b){var G;return(G=b[0]).config||(G.config={}),b[0].config.inputIsColumnMajor=!0,b}},"math/extract4x4":{wP:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{wP:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,O,i,H,b,G){var q,Q;(Q=b[0]).config||(Q.config={});const k=b[0].dataInputs[0];return b[0].config.valueType=(null===(q=G._connectionValues[k.uniqueId])||void 0===q?void 0:q.type)??"FlowGraphInteger",b}},"math/and":{wP:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,O,i,H,b,G){var q,Q,k;(k=b[0]).config||(k.config={});const I=b[0].dataInputs[0],P=b[0].dataInputs[1];return b[0].config.valueType=(null===(q=G._connectionValues[I.uniqueId])||void 0===q?void 0:q.type)??(null===(Q=G._connectionValues[P.uniqueId])||void 0===Q?void 0:Q.type)??"FlowGraphInteger",b}},"math/or":{wP:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,O,i,H,b,G){var q,Q,k;(k=b[0]).config||(k.config={});const I=b[0].dataInputs[0],P=b[0].dataInputs[1];return b[0].config.valueType=(null===(q=G._connectionValues[I.uniqueId])||void 0===q?void 0:q.type)??(null===(Q=G._connectionValues[P.uniqueId])||void 0===Q?void 0:Q.type)??"FlowGraphInteger",b}},"math/xor":{wP:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(a,O,i,H,b,G){var q,Q,k;(k=b[0]).config||(k.config={});const I=b[0].dataInputs[0],P=b[0].dataInputs[1];return b[0].config.valueType=(null===(q=G._connectionValues[I.uniqueId])||void 0===q?void 0:q.type)??(null===(Q=G._connectionValues[P.uniqueId])||void 0===Q?void 0:Q.type)??"FlowGraphInteger",b}},"math/asr":Ti("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Ti("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Ti("FlowGraphLeadingZerosBlock"),"math/ctz":Ti("FlowGraphTrailingZerosBlock"),"math/popcnt":Ti("FlowGraphOneBitsCounterBlock"),"math/rad":Ti("FlowGraphDegToRadBlock"),"math/deg":Ti("FlowGraphRadToDegBlock"),"type/boolToInt":Ti("FlowGraphBooleanToInt"),"type/boolToFloat":Ti("FlowGraphBooleanToFloat"),"type/intToBool":Ti("FlowGraphIntToBoolean"),"type/intToFloat":Ti("FlowGraphIntToFloat"),"type/floatToInt":Ti("FlowGraphFloatToInt"),"type/floatToBool":Ti("FlowGraphFloatToBoolean"),"flow/sequence":{wP:["FlowGraphSequenceBlock"],extraProcessor(a,O,i,H,b){const G=b[0];return G.config||(G.config={}),G.config.outputSignalCount=Object.keys(a.flows||[]).length,G.signalOutputs.forEach(((a,O)=>{a.name="out_"+O})),b}},"flow/branch":{wP:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{wP:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(a){if(a.configuration&&a.configuration.cases){const O=a.configuration.cases.value;if(!O.every((a=>"number"===typeof a&&/^-?\d+$/.test(a.toString()))))return F.c.Warn("Switch cases should be integers. Using empty array instead."),a.configuration.cases.value=[],{valid:!0};const i=new Set(O);a.configuration.cases.value=Array.from(i)}return{valid:!0}},extraProcessor(a,O,i,H,b){if("flow/switch"!==O.op||!a.flows||0===Object.keys(a.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return b[0].signalOutputs.forEach((a=>{"default"!==a.name&&(a.name="out_"+a.name)})),b}},"flow/while":{wP:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{wP:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(a,O,i,H,b){const G=b[0];return G.config||(G.config={}),G.config.incrementIndexWhenLoopDone=!0,b}},"flow/doN":{wP:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{wP:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(a,O,i,H,b){if("flow/multiGate"!==O.op||!a.flows||0===Object.keys(a.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const G=b[0];return G.config||(G.config={}),G.config.outputSignalCount=Object.keys(a.flows).length,G.signalOutputs.forEach(((a,O)=>{a.name="out_"+O})),b}},"flow/waitAll":{wP:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(a){var O,i;return"number"!==typeof(null===(O=a.configuration)||void 0===O||null===(i=O.inputFlows)||void 0===i?void 0:i.value[0])&&(a.configuration=a.configuration||{inputFlows:{value:[0]}},a.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{wP:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{wP:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{wP:["FlowGraphCancelDelayBlock"]},"variable/get":{wP:["FlowGraphGetVariableBlock"],validation(a){var O,i;return null!==(O=a.configuration)&&void 0!==O&&null!==(i=O.variable)&&void 0!==i&&i.value?{valid:!0}:(F.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(a,O)=>[O.getVariableName(a[0])]}}},"variable/set":{wP:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(a,O)=>[O.getVariableName(a[0])]}}},"variable/setMultiple":{wP:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(a,O)=>[a[0].map((a=>O.getVariableName(a)))]}},extraProcessor:(a,O,i,H,b)=>(b[0].dataInputs.forEach((a=>{a.name=H.getVariableName(+a.name)})),b)},"variable/interpolate":{wP:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(a,O)=>[O.getVariableName(a[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:a=>!0===a[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Mi:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Mi:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Mi:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Mi:"FlowGraphPlayAnimationBlock"},out:{name:"out",Mi:"FlowGraphPlayAnimationBlock"},done:{name:"done",Mi:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(a,O,i,H,b){var G,q,Q;const k=b[0],I=null===(G=a.configuration)||void 0===G?void 0:G.variable.value[0];if("number"!==typeof I)throw F.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const P=H.arrays.staticVariables[I];"undefined"===typeof k.config.animationType.value&&(H.arrays.staticVariables,k.config.animationType.value=(0,Mi.M)(P.type));const e=b[4];return e.config||(e.config={}),(q=e.config).variable||(q.variable={}),e.config.variable.value=H.getVariableName(I),(Q=b[3]).config||(Q.config={}),b}},"pointer/get":{wP:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Mi:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Mi:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(a,O,i,H,b)=>(b.forEach((a=>{"FlowGraphJsonPointerParserBlock"===a.className&&(a.config||(a.config={}),a.config.outputValue=!0)})),b)},"pointer/set":{wP:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Mi:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Mi:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(a,O,i,H,b)=>(b.forEach((a=>{"FlowGraphJsonPointerParserBlock"===a.className&&(a.config||(a.config={}),a.config.outputValue=!0)})),b)},"pointer/interpolate":{wP:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Mi:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Mi:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Mi:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Mi:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Mi:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Mi:"FlowGraphPlayAnimationBlock"},out:{name:"out",Mi:"FlowGraphPlayAnimationBlock"},done:{name:"done",Mi:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(a,O,i,H,b)=>(b.forEach((O=>{"FlowGraphJsonPointerParserBlock"===O.className?(O.config||(O.config={}),O.config.outputValue=!0):"FlowGraphInterpolationBlock"===O.className&&(O.config||(O.config={}),Object.keys(a.values||[]).forEach((i=>{var b;const G=null===(b=a.values)||void 0===b?void 0:b[i];if("value"===i&&G){const a=G.type;void 0!==a&&(O.config.animationType=H.arrays.types[a].flowGraphType)}})))})),b)},"animation/start":{wP:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Mi:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(a,O)=>[a[0]*O._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(a,O)=>[a[0]*O._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(a,O,i,H,b,G,q){const Q=b[b.length-1];return Q.config||(Q.config={}),Q.config.glTF=q,b}},"animation/stop":{wP:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Mi:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(a,O,i,H,b,G,q){const Q=b[b.length-1];return Q.config||(Q.config={}),Q.config.glTF=q,b}},"animation/stopAt":{wP:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Mi:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(a,O)=>[a[0]*O._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(a,O,i,H,b,G,q){const Q=b[b.length-1];return Q.config||(Q.config={}),Q.config.glTF=q,b}},"math/switch":{wP:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(a){if(a.configuration&&a.configuration.cases){const O=a.configuration.cases.value;if(!O.every((a=>"number"===typeof a&&/^-?\d+$/.test(a.toString()))))return F.c.Warn("Switch cases should be integers. Using empty array instead."),a.configuration.cases.value=[],{valid:!0};const i=new Set(O);a.configuration.cases.value=Array.from(i)}return{valid:!0}},extraProcessor(a,O,i,H,b){const G=b[0];return G.dataInputs.forEach((a=>{"default"!==a.name&&"case"!==a.name&&(a.name="in_"+a.name)})),G.config||(G.config={}),G.config.treatCasesAsIntegers=!0,b}},"debug/log":{wP:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Ti(a){let O=arguments.length>2?arguments[2]:void 0;return{wP:[a],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((a,O)=>(a[O]={name:O},a)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(a,i,H,b,G){var q;if(O){(q=G[0]).config||(q.config={}),G[0].config.preventIntegerFloatArithmetic=!0;let O=-1;Object.keys(a.values||{}).find((i=>{var H;return void 0!==(null===(H=a.values)||void 0===H?void 0:H[i].type)&&(O=a.values[i].type,!0)})),-1!==O&&(G[0].config.type=b.arrays.types[O].flowGraphType)}return G},validation:a=>O?Ai(a):{valid:!0}}}function Ai(a){if(a.values){const O=Object.keys(a.values).map((O=>a.values[O].type)).filter((a=>void 0!==a));if(!O.every((a=>a===O[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Bi["math/compose"]=Bi["math/matCompose"],Bi["math/decompose"]=Bi["math/matDecompose"];var Ei=i(12350);const li={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"ZO",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Wi{constructor(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=a,this._gltf=O,this._animationTargetFps=i,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const a of this._interactivityGraph.types)this._types.push(li[a.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const a of this._interactivityGraph.declarations){const O=Ki(a);if(!O)throw F.c.Error(["No mapping found for declaration",a]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:O,fullOperationName:a.extension?a.op+":"+a.extension:a.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const a of this._interactivityGraph.variables){const O=this._parseVariable(a);this._staticVariables.push(O)}}_parseVariable(a,O){const i=this._types[a.type];if(!i)throw F.c.Error(["No type found for variable",a]),new Error("Error parsing variables");if(a.value&&a.value.length!==i.length)throw F.c.Error(["Invalid value length for variable",a,i]),new Error("Error parsing variables");const H=a.value||[];if(!H.length)switch(i.flowGraphType){case"boolean":H.push(!1);break;case"FlowGraphInteger":H.push(0);break;case"number":H.push(NaN);break;case"Vector2":H.push(NaN,NaN);break;case"ZO":H.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":H.fill(NaN,0,4);break;case"Matrix":H.fill(NaN,0,16);break;case"Matrix3D":H.fill(NaN,0,9)}return"number"===i.elementType&&"string"===typeof H[0]&&(H[0]=parseFloat(H[0])),{type:i.flowGraphType,value:O?O(H,this):H}}_parseEvents(){if(this._interactivityGraph.events)for(const a of this._interactivityGraph.events){const O={eventId:a.id||"internalEvent_"+this._internalEventsCounter++};a.values&&(O.eventData=Object.keys(a.values).map((O=>{var i;const H=null===(i=a.values)||void 0===i?void 0:i[O];if(!H)throw F.c.Error(["No value found for event key",O]),new Error("Error parsing events");const b=this._types[H.type];if(!b)throw F.c.Error(["No type found for event value",H]),new Error("Error parsing events");const G="undefined"!==typeof H.value?this._parseVariable(H):void 0;return{id:O,type:b.flowGraphType,eventData:!0,value:G}}))),this._events.push(O)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const O of this._interactivityGraph.nodes){if("number"!==typeof O.declaration)throw F.c.Error(["No declaration found for node",O]),new Error("Error parsing nodes");const i=this._mappings[O.declaration];if(!i)throw F.c.Error(["No mapping found for node",O]),new Error("Error parsing nodes");if(i.flowGraphMapping.validation){const H=i.flowGraphMapping.validation(O,this._interactivityGraph,this._gltf);var a;if(!H.valid)throw new Error(`Error validating interactivity node ${null===(a=this._interactivityGraph.declarations)||void 0===a?void 0:a[O.declaration].op} - ${H.error}`)}const H=[];for(const a of i.flowGraphMapping.wP){const b=this._getEmptyBlock(a,i.fullOperationName);this._parseNodeConfiguration(O,b,i.flowGraphMapping,a),H.push(b)}this._nodes.push({wP:H,fullOperationName:i.fullOperationName})}}_getEmptyBlock(a,O){return{uniqueId:(0,Ei.c)(),className:a,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:O,metadata:{}}}_parseNodeConfiguration(a,O,i,H){const b=O.config;if(a.configuration){const O=Object.keys(a.configuration);for(const Q of O){var G,q;const O=null===(G=a.configuration)||void 0===G?void 0:G[Q];if(!O)throw F.c.Error(["No value found for node configuration",Q]),new Error("Error parsing node configuration");const k=null===(q=i.configuration)||void 0===q?void 0:q[Q];if(k&&k.Mi?k.Mi===H:0===i.wP.indexOf(H)){const a=(null===k||void 0===k?void 0:k.name)||Q;O&&"undefined"!==typeof O.value||"undefined"===typeof(null===k||void 0===k?void 0:k.defaultValue)?O.value.length>=0?b[a]={value:1===O.value.length?O.value[0]:O.value}:F.c.Warn(["Invalid value for node configuration",O]):b[a]={value:k.defaultValue},k&&k.dataTransformer&&(b[a].value=k.dataTransformer([b[a].value],this)[0])}}}}_parseNodeConnections(a){for(let D=0;D<this._nodes.length;D++){var O;const U=null===(O=this._interactivityGraph.nodes)||void 0===O?void 0:O[D];if(!U)throw F.c.Error(["No node found for interactivity node",this._nodes[D]]),new Error("Error parsing node connections");const y=this._nodes[D],w=this._mappings[U.declaration];if(!w)throw F.c.Error(["No mapping found for node",U]),new Error("Error parsing node connections");const K=U.flows||{},S=Object.keys(K).sort();for(const a of S){var i,H,b,G;const O=K[a],I=null===(i=w.flowGraphMapping.outputs)||void 0===i||null===(H=i.flows)||void 0===H?void 0:H[a],P=(null===I||void 0===I?void 0:I.name)||a,e=this._createNewSocketConnection(P,!0);(I&&I.Mi&&y.wP.find((a=>a.className===I.Mi))||y.wP[0]).signalOutputs.push(e);const h=O.node,j=this._nodes[h];if(!j)throw F.c.Error(["No node found for input node id",h]),new Error("Error parsing node connections");const Z=wi(j.fullOperationName);if(!Z)throw F.c.Error(["No mapping found for input node",j]),new Error("Error parsing node connections");let r=null===(b=Z.inputs)||void 0===b||null===(G=b.flows)||void 0===G?void 0:G[O.socket||"in"],J=!1;if(!r)for(const a in null===(q=Z.inputs)||void 0===q?void 0:q.flows){var q,Q,k;if(a.startsWith("[")&&a.endsWith("]"))J=!0,r=null===(Q=Z.inputs)||void 0===Q||null===(k=Q.flows)||void 0===k?void 0:k[a]}const ma=r?J?r.name.replace("$1",O.socket||""):r.name:O.socket||"in",M=r&&r.Mi&&j.wP.find((a=>a.className===r.Mi))||j.wP[0];let C=M.signalInputs.find((a=>a.name===ma));C||(C=this._createNewSocketConnection(ma),M.signalInputs.push(C)),C.connectedPointIds.push(e.uniqueId),e.connectedPointIds.push(C.uniqueId)}const f=U.values||{},B=Object.keys(f);for(const O of B){var I,P;const i=f[O];let H=null===(I=w.flowGraphMapping.inputs)||void 0===I||null===(P=I.values)||void 0===P?void 0:P[O],b=!1;if(!H)for(const a in null===(e=w.flowGraphMapping.inputs)||void 0===e?void 0:e.values){var e,h,j;if(a.startsWith("[")&&a.endsWith("]"))b=!0,H=null===(h=w.flowGraphMapping.inputs)||void 0===h||null===(j=h.values)||void 0===j?void 0:j[a]}const G=H?b?H.name.replace("$1",O):H.name:O,q=this._createNewSocketConnection(G);if((H&&H.Mi&&y.wP.find((a=>a.className===H.Mi))||y.wP[0]).dataInputs.push(q),void 0!==i.value){const O=this._parseVariable(i,H&&H.dataTransformer);a._connectionValues[q.uniqueId]=O}else{if("undefined"===typeof i.node)throw F.c.Error(["Invalid value for value connection",i]),new Error("Error parsing node connections");{var Z,r,J;const a=i.node,O=i.socket||"value",H=this._nodes[a];if(!H)throw F.c.Error(["No node found for output socket reference",i]),new Error("Error parsing node connections");const b=wi(H.fullOperationName);if(!b)throw F.c.Error(["No mapping found for output socket reference",i]),new Error("Error parsing node connections");let G=null===(Z=b.outputs)||void 0===Z||null===(r=Z.values)||void 0===r?void 0:r[O],Q=!1;if(!G)for(const i in null===(ma=b.outputs)||void 0===ma?void 0:ma.values){var ma,M,C;if(i.startsWith("[")&&i.endsWith("]"))Q=!0,G=null===(M=b.outputs)||void 0===M||null===(C=M.values)||void 0===C?void 0:C[i]}const k=G?Q?G.name.replace("$1",O):null===(J=G)||void 0===J?void 0:J.name:O,I=G&&G.Mi&&H.wP.find((a=>a.className===G.Mi))||H.wP[0];let P=I.dataOutputs.find((a=>a.name===k));P||(P=this._createNewSocketConnection(k,!0),I.dataOutputs.push(P)),q.connectedPointIds.push(P.uniqueId),P.connectedPointIds.push(q.uniqueId)}}}if(w.flowGraphMapping.interBlockConnectors)for(const a of w.flowGraphMapping.interBlockConnectors){const O=a.input,i=a.output,H=a.isVariable;this._connectFlowGraphNodes(O,i,y.wP[a.inputBlockIndex],y.wP[a.outputBlockIndex],H)}if(w.flowGraphMapping.extraProcessor){var n;const O=null===(n=this._interactivityGraph.declarations)||void 0===n?void 0:n[U.declaration];if(!O)throw F.c.Error(["No declaration found for extra processor",U]),new Error("Error parsing node connections");y.wP=w.flowGraphMapping.extraProcessor(U,O,w.flowGraphMapping,this,y.wP,a,this._gltf)}}}_createNewSocketConnection(a,O){return{uniqueId:(0,Ei.c)(),name:a,_connectionType:O?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(a,O,i,H,b){const G=b?i.dataInputs:i.signalInputs,q=b?H.dataOutputs:H.signalOutputs,Q=G.find((O=>O.name===a))||this._createNewSocketConnection(a),k=q.find((a=>a.name===O))||this._createNewSocketConnection(O,!0);G.find((O=>O.name===a))||G.push(Q),q.find((a=>a.name===O))||q.push(k),Q.connectedPointIds.push(k.uniqueId),k.connectedPointIds.push(Q.uniqueId)}getVariableName(a){return"staticVariable_"+a}serializeToFlowGraph(){const a={uniqueId:(0,Ei.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(a);for(let O=0;O<this._staticVariables.length;O++){const i=this._staticVariables[O];a._userVariables[this.getVariableName(O)]=i}return{rightHanded:!0,allBlocks:this._nodes.reduce(((a,O)=>a.concat(O.wP)),[]),executionContexts:[a]}}}const ui="KHR_interactivity";class ci{constructor(a){this._loader=a,this.name=ui,this.enabled=this._loader.isExtensionUsed(ui),this._pathConverter=(0,R.g)(this._loader.Fb),a._skipStartAnimationStep=!0;const O=a.babylonScene;O&&function(a){(0,R.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!a.activeCamera)return new b.Quaternion(NaN,NaN,NaN,NaN);const O=b.Quaternion.FromRotationMatrix(a.activeCamera.getWorldMatrix()).normalize();return a.useRightHandedSystem||(O.w*=-1,O.x*=-1),O},type:"Quaternion",getTarget:()=>a.activeCamera}),(0,R.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!a.activeCamera)return new b.ZO(NaN,NaN,NaN);const O=a.activeCamera.getWorldMatrix().getTranslation();return a.useRightHandedSystem||(O.x*=-1),O},type:"ZO",getTarget:()=>a.activeCamera}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:a=>{var O;return(null===(O=a._babylonAnimationGroup)||void 0===O?void 0:O.isPlaying)??!1},type:"boolean",getTarget:a=>a._babylonAnimationGroup}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:a=>{var O;return((null===(O=a._babylonAnimationGroup)||void 0===O?void 0:O.from)??0)/60},type:"number",getTarget:a=>a._babylonAnimationGroup}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:a=>{var O;return((null===(O=a._babylonAnimationGroup)||void 0===O?void 0:O.to)??0)/60},type:"number",getTarget:a=>a._babylonAnimationGroup}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:a=>{var O;return((null===(O=a._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())??0)/60},type:"number",getTarget:a=>a._babylonAnimationGroup}),(0,R.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:a=>{var O;return((null===(O=a._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())??0)/60},type:"number",getTarget:a=>a._babylonAnimationGroup})}(O)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var a;if(!this._loader.babylonScene||!this._pathConverter)return;const O=this._loader.babylonScene,i=null===(a=this._loader.Fb.extensions)||void 0===a?void 0:a.KHR_interactivity;if(!i)return;const H=new Zi.b({rO:O});H.dispatchEventsSynchronously=!1;const b=i.graphs.map((a=>new Wi(a,this._loader.Fb,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(b.map((async a=>await Di(a,{coordinator:H,pathConverter:this._pathConverter})))),H.start()}}var Ri;Ri=async()=>(await Promise.resolve().then(i.bind(i,14167))).FlowGraphGLTFDataProvider,Fi[`${ui}/${"FlowGraphGLTFDataProvider"}`]=Ri,c(ui),u(ui,!0,(a=>new ci(a)));const zi="KHR_node_visibility";(0,R.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:a=>{const O=a._babylonTransformNode;return!O||void 0===O.isVisible||O.isVisible},set:(a,O)=>{var i,H;null===(i=O._primitiveBabylonMeshes)||void 0===i||i.forEach((a=>{a.inheritVisibility=!0})),O._babylonTransformNode&&(O._babylonTransformNode.isVisible=a),null===(H=O._primitiveBabylonMeshes)||void 0===H||H.forEach((O=>{O.isVisible=a}))},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class xi{constructor(a){this.name=zi,this._loader=a,this.enabled=a.isExtensionUsed(zi)}async onReady(){var a;null===(a=this._loader.Fb.nodes)||void 0===a||a.forEach((a=>{var O,i,H,b;(null===(O=a._primitiveBabylonMeshes)||void 0===O||O.forEach((a=>{a.inheritVisibility=!0})),null!==(i=a.extensions)&&void 0!==i&&i.KHR_node_visibility)&&(!1===(null===(H=a.extensions)||void 0===H?void 0:H.KHR_node_visibility.visible)&&(a._babylonTransformNode&&(a._babylonTransformNode.isVisible=!1),null===(b=a._primitiveBabylonMeshes)||void 0===b||b.forEach((a=>{a.isVisible=!1}))))}))}dispose(){this._loader=null}}c(zi),u(zi,!0,(a=>new xi(a)));const gi="KHR_node_selectability";Si("event/onSelect",gi,{wP:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Mi:"FlowGraphGetVariableBlock",dataTransformer:a=>["pickedMesh_"+a[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Mi:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(a,O,i,H,b,G,q){var Q,k,I,P,e,h;const j=b[b.length-1];j.config=j.config||{},j.config.glTF=q;const Z=null===(Q=a.configuration)||void 0===Q||null===(k=Q.nodeIndex)||void 0===k?void 0:k.value[0];if(void 0===Z||"number"!==typeof Z)throw new Error("nodeIndex not found in configuration");const F="pickedMesh_"+Z;return b[1].config.variable=F,G._userVariables[F]={className:"Mesh",id:null===q||void 0===q||null===(I=q.nodes)||void 0===I||null===(P=I[Z]._babylonTransformNode)||void 0===P?void 0:P.id,uniqueId:null===q||void 0===q||null===(e=q.nodes)||void 0===e||null===(h=e[Z]._babylonTransformNode)||void 0===h?void 0:h.uniqueId},b}}),(0,R.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:a=>{const O=a._babylonTransformNode;return!O||void 0===O.Lk||O.Lk},set:(a,O)=>{var i;null===(i=O._primitiveBabylonMeshes)||void 0===i||i.forEach((O=>{O.Lk=a}))},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"Lk"],type:"boolean"});class Ni{constructor(a){this.name=gi,this._loader=a,this.enabled=a.isExtensionUsed(gi)}async onReady(){var a;null===(a=this._loader.Fb.nodes)||void 0===a||a.forEach((a=>{var O,i,H;null!==(O=a.extensions)&&void 0!==O&&O.KHR_node_selectability&&!1===(null===(i=a.extensions)||void 0===i?void 0:i.KHR_node_selectability.selectable)&&(null===(H=a._babylonTransformNode)||void 0===H||H.getChildMeshes().forEach((a=>{a.Lk=!1})))}))}dispose(){this._loader=null}}c(gi),u(gi,!0,(a=>new Ni(a)));const vi="KHR_node_hoverability",Xi="targetMeshPointerOver_";Si("event/onHoverIn",vi,{wP:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Mi:"FlowGraphGetVariableBlock",dataTransformer:a=>[Xi+a[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Mi:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(a,O,i,H,b,G,q){var Q,k,I,P,e,h;const j=b[b.length-1];j.config=j.config||{},j.config.glTF=q;const Z=null===(Q=a.configuration)||void 0===Q||null===(k=Q.nodeIndex)||void 0===k?void 0:k.value[0];if(void 0===Z||"number"!==typeof Z)throw new Error("nodeIndex not found in configuration");const F=Xi+Z;return b[1].config.variable=F,G._userVariables[F]={className:"Mesh",id:null===q||void 0===q||null===(I=q.nodes)||void 0===I||null===(P=I[Z]._babylonTransformNode)||void 0===P?void 0:P.id,uniqueId:null===q||void 0===q||null===(e=q.nodes)||void 0===e||null===(h=e[Z]._babylonTransformNode)||void 0===h?void 0:h.uniqueId},b}});const pi="targetMeshPointerOut_";Si("event/onHoverOut",vi,{wP:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Mi:"FlowGraphGetVariableBlock",dataTransformer:a=>[pi+a[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Mi:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(a,O,i,H,b,G,q){var Q,k,I,P,e,h;const j=b[b.length-1];j.config=j.config||{},j.config.glTF=q;const Z=null===(Q=a.configuration)||void 0===Q||null===(k=Q.nodeIndex)||void 0===k?void 0:k.value[0];if(void 0===Z||"number"!==typeof Z)throw new Error("nodeIndex not found in configuration");const F=pi+Z;return b[1].config.variable=F,G._userVariables[F]={className:"Mesh",id:null===q||void 0===q||null===(I=q.nodes)||void 0===I||null===(P=I[Z]._babylonTransformNode)||void 0===P?void 0:P.id,uniqueId:null===q||void 0===q||null===(e=q.nodes)||void 0===e||null===(h=e[Z]._babylonTransformNode)||void 0===h?void 0:h.uniqueId},b}}),(0,R.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:a=>{const O=a._babylonTransformNode;return!O||void 0===O.pointerOverDisableMeshTesting||O.pointerOverDisableMeshTesting},set:(a,O)=>{var i;null===(i=O._primitiveBabylonMeshes)||void 0===i||i.forEach((O=>{O.pointerOverDisableMeshTesting=!a}))},getTarget:a=>a._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class oi{constructor(a){this.name=vi,this._loader=a,this.enabled=a.isExtensionUsed(vi)}async onReady(){var a;null===(a=this._loader.Fb.nodes)||void 0===a||a.forEach((a=>{var O,i,H;null!==(O=a.extensions)&&void 0!==O&&O.KHR_node_hoverability&&!1===(null===(i=a.extensions)||void 0===i?void 0:i.KHR_node_hoverability.hoverable)&&(null===(H=a._babylonTransformNode)||void 0===H||H.getChildMeshes().forEach((a=>{a.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}c(vi),u(vi,!0,(a=>new oi(a)));const di="ExtrasAsMetadata";class Yi{_assignExtras(a,O){if(O.extras&&Object.keys(O.extras).length>0){const i=a.metadata=a.metadata||{};(i.Fb=i.Fb||{}).extras=O.extras}}constructor(a){this.name=di,this.enabled=!0,this._loader=a}dispose(){this._loader=null}loadNodeAsync(a,O,i){return this._loader.loadNodeAsync(a,O,(a=>{this._assignExtras(a,O),i(a)}))}loadCameraAsync(a,O,i){return this._loader.loadCameraAsync(a,O,(a=>{this._assignExtras(a,O),i(a)}))}createMaterial(a,O,i){const H=this._loader.createMaterial(a,O,i);return this._assignExtras(H,O),H}}c(di),u(di,!1,(a=>new Yi(a)));i(14167)},14060:(a,O,i)=>{"use strict";i.d(O,{b:()=>A,c:()=>w,e:()=>y,h:()=>K});var H=i(12193),b=i(12184),G=i(13687),q=i(12841),Q=i(12813),k=i(12826),I=i(12209),P=i(12236),e=i(12837),h=i(12936),j=i(12846),Z=i(12433);class F{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Eh=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Mj=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(a){this._environmentTexture=a}getNodes(){let a=[];a=a.concat(this.meshes),a=a.concat(this.lights),a=a.concat(this.cameras),a=a.concat(this.transformNodes);for(const O of this.skeletons)a=a.concat(O.bones);return a}}class r extends F{}class J{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const a=this.rootNodes;for(const H of a)H.dispose();a.length=0;const O=this.skeletons;for(const H of O)H.dispose();O.length=0;const i=this.animationGroups;for(const H of i)H.dispose();i.length=0}}class ma extends F{constructor(a){super(),this._wasAddedToScene=!1,(a=a||P.b.LastCreatedScene)&&(this.rO=a,this.proceduralTextures=[],a.Pb.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=a.getEngine().onContextRestoredObservable.add((()=>{for(const a of this.geometries)a._rebuild();for(const a of this.meshes)a._rebuild();for(const a of this.Eh)a.rebuild();for(const a of this.textures)a._rebuild()})))}_topologicalSort(a){const O=new Map;for(const q of a)O.set(q.uniqueId,q);const i={dependsOn:new Map,dependedBy:new Map};for(const q of a){const a=q.uniqueId;i.dependsOn.set(a,new Set),i.dependedBy.set(a,new Set)}for(const q of a){const a=q.uniqueId,H=i.dependsOn.get(a);if(q instanceof e.b){const b=q.sourceMesh;O.has(b.uniqueId)&&(H.add(b.uniqueId),i.dependedBy.get(b.uniqueId).add(a))}const b=i.dependedBy.get(a);for(const G of q.getDescendants()){const H=G.uniqueId;if(O.has(H)){b.add(H);i.dependsOn.get(H).add(a)}}}const H=[],b=[];for(const q of a){const a=q.uniqueId;0===i.dependsOn.get(a).size&&(b.push(q),O.delete(a))}const G=b;for(;G.length>0;){const a=G.shift();H.push(a);const b=i.dependedBy.get(a.uniqueId);for(const H of Array.from(b.values())){const b=i.dependsOn.get(H);b.delete(a.uniqueId),0===b.size&&O.get(H)&&(G.push(O.get(H)),O.delete(H))}}return O.size>0&&(I.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),O.forEach((a=>{I.c.Error(a.name)}))),H}_addNodeAndDescendantsToList(a,O,i,H){if(i&&(!H||H(i))&&!O.has(i.uniqueId)){a.push(i),O.add(i.uniqueId);for(const b of i.getDescendants(!0))this._addNodeAndDescendantsToList(a,O,b,H)}}_isNodeInContainer(a){return a instanceof k.e&&-1!==this.meshes.indexOf(a)||(a instanceof Q.d&&-1!==this.transformNodes.indexOf(a)||(a instanceof h.b&&-1!==this.lights.indexOf(a)||a instanceof j.e&&-1!==this.cameras.indexOf(a)))}_isValidHierarchy(){for(const a of this.meshes)if(a.parent&&!this._isNodeInContainer(a.parent))return I.c.Warn(`Node ${a.name} has a parent that is not in the container.`),!1;for(const a of this.transformNodes)if(a.parent&&!this._isNodeInContainer(a.parent))return I.c.Warn(`Node ${a.name} has a parent that is not in the container.`),!1;for(const a of this.lights)if(a.parent&&!this._isNodeInContainer(a.parent))return I.c.Warn(`Node ${a.name} has a parent that is not in the container.`),!1;for(const a of this.cameras)if(a.parent&&!this._isNodeInContainer(a.parent))return I.c.Warn(`Node ${a.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(a){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||b.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const H={},G={},Q=new J,k=[],I=[],P={doNotInstantiate:!0,...i},e=[],h=new Set;for(const b of this.transformNodes)null===b.parent&&this._addNodeAndDescendantsToList(e,h,b,P.predicate);for(const b of this.meshes)null===b.parent&&this._addNodeAndDescendantsToList(e,h,b,P.predicate);const j=this._topologicalSort(e),Z=(i,b)=>{if(((O,i)=>{if(H[O.uniqueId]=i.uniqueId,G[i.uniqueId]=i,a&&(i.name=a(O.name)),i instanceof q.d){const a=i;if(a.morphTargetManager){const i=O.morphTargetManager;a.morphTargetManager=i.clone();for(let O=0;O<i.numTargets;O++){const b=i.getTarget(O),q=a.morphTargetManager.getTarget(O);H[b.uniqueId]=q.uniqueId,G[q.uniqueId]=q}}}})(i,b),i.parent){const a=H[i.parent.uniqueId],O=G[a];b.parent=O||i.parent}if(b.position&&i.position&&b.position.q(i.position),b.rotationQuaternion&&i.rotationQuaternion&&b.rotationQuaternion.q(i.rotationQuaternion),b.rotation&&i.rotation&&b.rotation.q(i.rotation),b.Bb&&i.Bb&&b.Bb.q(i.Bb),b.material){const q=b;if(q.material)if(O){const O=i.material;if(-1===I.indexOf(O)){let i=O.clone(a?a(O.name):"Clone of "+O.name);if(I.push(O),H[O.uniqueId]=i.uniqueId,G[i.uniqueId]=i,"MultiMaterial"===O.getClassName()){const b=O;for(const O of b.Eb)O&&(i=O.clone(a?a(O.name):"Clone of "+O.name),I.push(O),H[O.uniqueId]=i.uniqueId,G[i.uniqueId]=i);b.Eb=b.Eb.map((a=>a&&G[H[a.uniqueId]]))}}"InstancedMesh"!==q.getClassName()&&(q.material=G[H[O.uniqueId]])}else"MultiMaterial"===q.material.getClassName()?-1===this.rO.multiMaterials.indexOf(q.material)&&this.rO.addMultiMaterial(q.material):-1===this.rO.materials.indexOf(q.material)&&this.rO.addMaterial(q.material)}null===b.parent&&Q.rootNodes.push(b)};for(const b of j)if("InstancedMesh"===b.getClassName()){const a=b,O=a.sourceMesh,i=H[O.uniqueId];Z(a,("number"===typeof i?G[i]:O).createInstance(a.name))}else{let a=!0;"zb"===b.getClassName()||"Node"===b.getClassName()||b.skeleton||!b.getTotalVertices||0===b.getTotalVertices()?a=!1:P.doNotInstantiate&&(a="function"===typeof P.doNotInstantiate?!P.doNotInstantiate(b):!P.doNotInstantiate);const O=a?b.createInstance(`instance of ${b.name}`):b.clone(`Clone of ${b.name}`,null,!0);if(!O)throw new Error(`Could not clone or instantiate node on Asset Container ${b.name}`);Z(b,O)}for(const b of this.skeletons){if(P.predicate&&!P.predicate(b))continue;const O=b.clone(a?a(b.name):"Clone of "+b.name);for(const a of this.meshes)if(a.skeleton===b&&!a.isAnInstance){const i=G[H[a.uniqueId]];if(!i||i.isAnInstance)continue;if(i.skeleton=O,-1!==k.indexOf(O))continue;k.push(O);for(const a of O.bones)a._linkedTransformNode&&(a._linkedTransformNode=G[H[a._linkedTransformNode.uniqueId]])}Q.skeletons.push(O)}for(const b of this.animationGroups){if(P.predicate&&!P.predicate(b))continue;const O=b.clone(a?a(b.name):"Clone of "+b.name,(a=>G[H[a.uniqueId]]||a));Q.animationGroups.push(O)}return Q}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||b.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.rO.environmentTexture=this.environmentTexture);for(const a of this.rO._serializableComponents)a.addFromContainer(this);this.rO.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=[];for(const i of this.cameras)a&&!a(i)||(this.rO.addCamera(i),O.push(i));for(const i of this.lights)a&&!a(i)||(this.rO.addLight(i),O.push(i));for(const i of this.meshes)a&&!a(i)||(this.rO.jP(i),O.push(i));for(const i of this.skeletons)a&&!a(i)||this.rO.addSkeleton(i);for(const i of this.animations)a&&!a(i)||this.rO.addAnimation(i);for(const i of this.animationGroups)a&&!a(i)||this.rO.addAnimationGroup(i);for(const i of this.multiMaterials)a&&!a(i)||this.rO.addMultiMaterial(i);for(const i of this.materials)a&&!a(i)||this.rO.addMaterial(i);for(const i of this.morphTargetManagers)a&&!a(i)||this.rO.addMorphTargetManager(i);for(const i of this.geometries)a&&!a(i)||this.rO.addGeometry(i);for(const i of this.transformNodes)a&&!a(i)||(this.rO.addTransformNode(i),O.push(i));for(const i of this.actionManagers)a&&!a(i)||this.rO.addActionManager(i);for(const i of this.textures)a&&!a(i)||this.rO.addTexture(i);for(const i of this.reflectionProbes)a&&!a(i)||this.rO.addReflectionProbe(i);for(const i of O)i.parent&&-1===this.rO.getNodes().indexOf(i.parent)&&(i.setParent?i.setParent(null):i.parent=null)}removeAllFromScene(){this._isValidHierarchy()||b.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.rO.environmentTexture&&(this.rO.environmentTexture=null);for(const a of this.rO._serializableComponents)a.removeFromContainer(this)}removeFromScene(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const O of this.cameras)a&&!a(O)||this.rO.removeCamera(O);for(const O of this.lights)a&&!a(O)||this.rO.removeLight(O);for(const O of this.meshes)a&&!a(O)||this.rO.hP(O,!0);for(const O of this.skeletons)a&&!a(O)||this.rO.removeSkeleton(O);for(const O of this.animations)a&&!a(O)||this.rO.removeAnimation(O);for(const O of this.animationGroups)a&&!a(O)||this.rO.removeAnimationGroup(O);for(const O of this.multiMaterials)a&&!a(O)||this.rO.removeMultiMaterial(O);for(const O of this.materials)a&&!a(O)||this.rO.removeMaterial(O);for(const O of this.morphTargetManagers)a&&!a(O)||this.rO.removeMorphTargetManager(O);for(const O of this.geometries)a&&!a(O)||this.rO.removeGeometry(O);for(const O of this.transformNodes)a&&!a(O)||this.rO.removeTransformNode(O);for(const O of this.actionManagers)a&&!a(O)||this.rO.removeActionManager(O);for(const O of this.textures)a&&!a(O)||this.rO.removeTexture(O);for(const O of this.reflectionProbes)a&&!a(O)||this.rO.removeReflectionProbe(O)}dispose(){const a=this.cameras.slice(0);for(const j of a)j.dispose();this.cameras.length=0;const O=this.lights.slice(0);for(const j of O)j.dispose();this.lights.length=0;const i=this.meshes.slice(0);for(const j of i)j.dispose();this.meshes.length=0;const H=this.skeletons.slice(0);for(const j of H)j.dispose();this.skeletons.length=0;const b=this.animationGroups.slice(0);for(const j of b)j.dispose();this.animationGroups.length=0;const G=this.multiMaterials.slice(0);for(const j of G)j.dispose();this.multiMaterials.length=0;const q=this.materials.slice(0);for(const j of q)j.dispose();this.materials.length=0;const Q=this.geometries.slice(0);for(const j of Q)j.dispose();this.geometries.length=0;const k=this.transformNodes.slice(0);for(const j of k)j.dispose();this.transformNodes.length=0;const I=this.actionManagers.slice(0);for(const j of I)j.dispose();this.actionManagers.length=0;const P=this.textures.slice(0);for(const j of P)j.dispose();this.textures.length=0;const e=this.reflectionProbes.slice(0);for(const j of e)j.dispose();this.reflectionProbes.length=0;const h=this.morphTargetManagers.slice(0);for(const j of h)j.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const j of this.rO._serializableComponents)j.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.rO.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(a,O,i){if(a&&O)for(const H of a){let a=!0;if(i)for(const O of i)if(H===O){a=!1;break}a&&(O.push(H),H._parentContainer=this)}}moveAllFromScene(a){this._wasAddedToScene=!1,void 0===a&&(a=new r);for(const O in this)Object.prototype.hasOwnProperty.call(this,O)&&(this[O]=this[O]||("_environmentTexture"===O?null:[]),this._moveAssets(this.rO[O],this[O],a[O]));this.environmentTexture=this.rO.environmentTexture,this.removeAllFromScene()}createRootMesh(){const a=new q.d("assetContainerRootMesh",this.rO);for(const O of this.meshes)O.parent||a.addChild(O);return this.meshes.unshift(a),a}mergeAnimationsTo(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P.b.LastCreatedScene,O=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!a)return I.c.Error("No scene available to merge animations to"),[];const H=i||(O=>{let i=null;const H=O.animations.length?O.animations[0].targetProperty:"",b=O.name.split(".").join("").split("_primitive")[0];switch(H){case"position":case"rotationQuaternion":i=a.getTransformNodeByName(O.name)||a.getTransformNodeByName(b);break;case"influence":i=a.getMorphTargetByName(O.name)||a.getMorphTargetByName(b);break;default:i=a.getNodeByName(O.name)||a.getNodeByName(b)}return i}),b=this.getNodes();for(const Q of b){const a=H(Q);if(null!==a){for(const O of Q.animations){const i=a.animations.filter((a=>a.targetProperty===O.targetProperty));for(const O of i){const i=a.animations.indexOf(O,0);i>-1&&a.animations.splice(i,1)}}a.animations=a.animations.concat(Q.animations)}}const G=[],q=this.animationGroups.slice();for(const Q of q){G.push(Q.clone(Q.name,H));for(const a of Q.animatables)a.stop()}for(const Q of O){const O=H(Q.target);O&&(a.beginAnimation(O,Q.fromFrame,Q.toFrame,Q.loopAnimation,Q.speedRatio,Q.onAnimationEnd?Q.onAnimationEnd:void 0,void 0,!0,void 0,Q.onAnimationLoop?Q.onAnimationLoop:void 0),a.stopAnimation(Q.target))}return G}populateRootNodes(){this.rootNodes.length=0;for(const a of this.meshes)a.parent||-1!==this.rootNodes.indexOf(a)||this.rootNodes.push(a);for(const a of this.transformNodes)a.parent||-1!==this.rootNodes.indexOf(a)||this.rootNodes.push(a);for(const a of this.lights)a.parent||-1!==this.rootNodes.indexOf(a)||this.rootNodes.push(a);for(const a of this.cameras)a.parent||-1!==this.rootNodes.indexOf(a)||this.rootNodes.push(a)}addAllAssetsToContainer(a){if(!a)return;const O=[],i=new Set;for(O.push(a);O.length>0;){const a=O.pop();if(a instanceof q.d?(a.wb&&-1===this.geometries.indexOf(a.wb)&&this.geometries.push(a.wb),this.meshes.push(a)):a instanceof e.b?this.meshes.push(a):a instanceof Q.d?this.transformNodes.push(a):a instanceof h.b?this.lights.push(a):a instanceof j.e&&this.cameras.push(a),a instanceof k.e){if(a.material&&-1===this.materials.indexOf(a.material)){this.materials.push(a.material);for(const O of a.material.getActiveTextures())-1===this.textures.indexOf(O)&&this.textures.push(O)}a.skeleton&&-1===this.skeletons.indexOf(a.skeleton)&&this.skeletons.push(a.skeleton),a.morphTargetManager&&-1===this.morphTargetManagers.indexOf(a.morphTargetManager)&&this.morphTargetManagers.push(a.morphTargetManager)}for(const H of a.getChildren())i.has(H)||O.push(H);i.add(a)}this.populateRootNodes()}_getByTags(a,O,i){if(void 0===O)return a;const H=[];for(const b in a){const G=a[b];Z.d&&Z.d.MatchesQuery(G,O)&&(!i||i(G))&&H.push(G)}return H}getMeshesByTags(a,O){return this._getByTags(this.meshes,a,O)}getCamerasByTags(a,O){return this._getByTags(this.cameras,a,O)}getLightsByTags(a,O){return this._getByTags(this.lights,a,O)}getMaterialsByTags(a,O){return this._getByTags(this.materials,a,O).concat(this._getByTags(this.multiMaterials,a,O))}getTransformNodesByTags(a,O){return this._getByTags(this.transformNodes,a,O)}}var M=i(12249);class C{constructor(a){this.byteOffset=0,this.buffer=a}async loadAsync(a){const O=await this.buffer.readAsync(this.byteOffset,a);this._dataView=new DataView(O.buffer,O.byteOffset,O.byteLength),this._dataByteOffset=0}readUint32(){const a=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,a}readUint8Array(a){const O=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,a);return this._dataByteOffset+=a,this.byteOffset+=a,O}readString(a){return(0,M.i)(this.readUint8Array(a))}skipBytes(a){this._dataByteOffset+=a,this.byteOffset+=a}}var n=i(14062);const D="Z2xURg",U={name:"Fb",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:a=>-1!==a.indexOf("asset")&&-1!==a.indexOf("version")||a.startsWith("data:base64,"+D)||a.startsWith("data:;base64,"+D)||a.startsWith("data:application/octet-stream;base64,"+D)||a.startsWith("data:model/gltf-binary;base64,"+D)};var y,w,K,S=i(12243),f=i(12245);function B(a,O,i){try{return Promise.resolve(new Uint8Array(a,O,i))}catch(H){return Promise.reject(H)}}!function(a){a[a.AUTO=0]="AUTO",a[a.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(y||(y={})),function(a){a[a.NONE=0]="NONE",a[a.FIRST=1]="FIRST",a[a.ALL=2]="ALL"}(w||(w={})),function(a){a[a.LOADING=0]="LOADING",a[a.READY=1]="READY",a[a.COMPLETE=2]="COMPLETE"}(K||(K={}));class T{constructor(){this.coordinateSystemMode=y.AUTO,this.animationStartMode=w.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=a=>Promise.resolve(a),this.extensionOptions={}}q(a){a&&(this.onParsed=a.onParsed,this.coordinateSystemMode=a.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=a.animationStartMode??this.animationStartMode,this.loadNodeAnimations=a.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=a.loadSkins??this.loadSkins,this.loadMorphTargets=a.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=a.compileMaterials??this.compileMaterials,this.useClipPlane=a.useClipPlane??this.useClipPlane,this.compileShadowGenerators=a.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=a.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=a.useRangeRequests??this.useRangeRequests,this.createInstances=a.createInstances??this.createInstances,this.alwaysComputeBoundingBox=a.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=a.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=a.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=a.skipMaterials??this.skipMaterials,this.useSRGBBuffers=a.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=a.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=a.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=a.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=a.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=a.customRootNode,this.onMeshLoaded=a.onMeshLoaded,this.onSkinLoaded=a.onSkinLoaded,this.onTextureLoaded=a.onTextureLoaded,this.onMaterialLoaded=a.onMaterialLoaded,this.onCameraLoaded=a.onCameraLoaded,this.extensionOptions=a.extensionOptions??this.extensionOptions)}}class A extends T{constructor(a){super(),this.onParsedObservable=new H.e,this.onMeshLoadedObservable=new H.e,this.onSkinLoadedObservable=new H.e,this.onTextureLoadedObservable=new H.e,this.onMaterialLoadedObservable=new H.e,this.onCameraLoadedObservable=new H.e,this.onCompleteObservable=new H.e,this.onErrorObservable=new H.e,this.Pb=new H.e,this.onExtensionLoadedObservable=new H.e,this.validate=!1,this.onValidatedObservable=new H.e,this._loader=null,this._state=null,this._requests=new Array,this.name=U.name,this.extensions=U.extensions,this.onLoaderStateChangedObservable=new H.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.q(a)}set onParsed(a){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),a&&(this._onParsedObserver=this.onParsedObservable.add(a))}set onMeshLoaded(a){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),a&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(a))}set onSkinLoaded(a){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),a&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((O=>a(O.node,O.skinnedNode))))}set onTextureLoaded(a){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),a&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(a))}set onMaterialLoaded(a){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),a&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(a))}set onCameraLoaded(a){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),a&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(a))}set onComplete(a){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(a)}set onError(a){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(a)}set onDispose(a){this._onDisposeObserver&&this.Pb.remove(this._onDisposeObserver),this._onDisposeObserver=this.Pb.add(a)}set onExtensionLoaded(a){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(a)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(a){this._loggingEnabled!==a&&(this._loggingEnabled=a,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(a){this._capturePerformanceCounters!==a&&(this._capturePerformanceCounters=a,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(a){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(a)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const a of this._requests)a.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=a=>Promise.resolve(a),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Pb.notifyObservers(void 0),this.Pb.clear()}loadFile(a,O,i,G,q,Q,k,P){if(ArrayBuffer.isView(O))return this._loadBinary(a,O,i,G,k,P),null;this._progressCallback=q;const e=O.name||b.Tools.GetFilename(O);if(Q){if(this.useRangeRequests){this.validate&&I.c.Warn("glTF validation is not supported when range requests are enabled");const i={abort:()=>{},onCompleteObservable:new H.e},b={readAsync:(i,H)=>new Promise(((b,G)=>{this._loadFile(a,O,(a=>{b(new Uint8Array(a))}),!0,(a=>{G(a)}),(a=>{a.setRequestHeader("Range",`bytes=${i}-${i+H-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new C(b)).then((a=>{i.onCompleteObservable.notifyObservers(i),G(a)}),k?a=>k(void 0,a):void 0),i}return this._loadFile(a,O,(O=>{this._validate(a,new Uint8Array(O,0,O.byteLength),i,e),this._unpackBinaryAsync(new C({readAsync:(a,i)=>B(O,a,i),byteLength:O.byteLength})).then((a=>{G(a)}),k?a=>k(void 0,a):void 0)}),!0,k)}return this._loadFile(a,O,(O=>{try{this._validate(a,O,i,e),G({json:this._parseJson(O)})}catch{k&&k()}}),!1,k)}_loadBinary(a,O,i,H,b,G){this._validate(a,new Uint8Array(O.buffer,O.byteOffset,O.byteLength),i,G),this._unpackBinaryAsync(new C({readAsync:(a,i)=>function(a,O,i){try{if(O<0||O>=a.byteLength)throw new RangeError("Offset is out of range.");if(O+i>a.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(a.buffer,a.byteOffset+O,i))}catch(H){return Promise.reject(H)}}(O,a,i),byteLength:O.byteLength})).then((a=>{H(a)}),b?a=>b(void 0,a):void 0)}importMeshAsync(a,O,i,H,b,G){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(i),this.onParsedObservable.clear(),this._log(`Loading ${G||""}`),this._loader=this._getLoader(i),this._loader.importMeshAsync(a,O,null,i,H,b,G))))}loadAsync(a,O,i,H,b){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${b||""}`),this._loader=this._getLoader(O),this._loader.loadAsync(a,O,i,H,b))))}loadAssetContainerAsync(a,O,i,H,b){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${b||""}`),this._loader=this._getLoader(O);const G=new ma(a),q=[];this.onMaterialLoadedObservable.add((a=>{q.push(a)}));const Q=[];this.onTextureLoadedObservable.add((a=>{Q.push(a)}));const k=[];this.onCameraLoadedObservable.add((a=>{k.push(a)}));const I=[];return this.onMeshLoadedObservable.add((a=>{a.morphTargetManager&&I.push(a.morphTargetManager)})),this._loader.importMeshAsync(null,a,G,O,i,H,b).then((a=>(Array.prototype.push.apply(G.geometries,a.geometries),Array.prototype.push.apply(G.meshes,a.meshes),Array.prototype.push.apply(G.Eh,a.Eh),Array.prototype.push.apply(G.skeletons,a.skeletons),Array.prototype.push.apply(G.animationGroups,a.animationGroups),Array.prototype.push.apply(G.materials,q),Array.prototype.push.apply(G.textures,Q),Array.prototype.push.apply(G.lights,a.lights),Array.prototype.push.apply(G.transformNodes,a.transformNodes),Array.prototype.push.apply(G.cameras,k),Array.prototype.push.apply(G.morphTargetManagers,I),G)))}))}canDirectLoad(a){return U.canDirectLoad(a)}directLoad(a,O){if(O.startsWith("base64,"+D)||O.startsWith(";base64,"+D)||O.startsWith("application/octet-stream;base64,"+D)||O.startsWith("model/gltf-binary;base64,"+D)){const i=(0,S.b)(O);return this._validate(a,new Uint8Array(i,0,i.byteLength)),this._unpackBinaryAsync(new C({readAsync:(a,O)=>B(i,a,O),byteLength:i.byteLength}))}return this._validate(a,O),Promise.resolve({json:this._parseJson(O)})}createPlugin(a){return new A(a[U.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((a,O)=>{this.onCompleteObservable.addOnce((()=>{a()})),this.onErrorObservable.addOnce((a=>{O(a)}))}))}_setState(a){this._state!==a&&(this._state=a,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(K[this._state]))}_loadFile(a,O,i,H,b,G){const q=a._loadFile(O,i,(a=>{this._onProgress(a,q)}),!0,H,b,G);return q.onCompleteObservable.add((()=>{q._lengthComputable=!0,q._total=q._loaded})),this._requests.push(q),q}_onProgress(a,O){if(!this._progressCallback)return;O._lengthComputable=a.lengthComputable,O._loaded=a.loaded,O._total=a.total;let i=!0,H=0,b=0;for(const G of this._requests){if(void 0===G._lengthComputable||void 0===G._loaded||void 0===G._total)return;i=i&&G._lengthComputable,H+=G._loaded,b+=G._total}this._progressCallback({lengthComputable:i,loaded:H,total:i?b:0})}_validate(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),n.b.ValidateAsync(O,i,H,(O=>this.preprocessUrlAsync(i+O).then((O=>a._loadFileAsync(O,void 0,!0,!0).then((a=>new Uint8Array(a,0,a.byteLength))))))).then((a=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(a),this.onValidatedObservable.clear()}),(a=>{this._endPerformanceCounter("Validate JSON"),b.Tools.Warn(`Failed to validate: ${a.message}`),this.onValidatedObservable.clear()})))}_getLoader(a){const O=a.json.asset||{};this._log(`Asset version: ${O.version}`),O.minVersion&&this._log(`Asset minimum version: ${O.minVersion}`),O.generator&&this._log(`Asset generator: ${O.generator}`);const i=A._parseVersion(O.version);if(!i)throw new Error("Invalid version: "+O.version);if(void 0!==O.minVersion){const a=A._parseVersion(O.minVersion);if(!a)throw new Error("Invalid minimum version: "+O.minVersion);if(A._compareVersion(a,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+O.minVersion)}const H={1:A._CreateGLTF1Loader,2:A._CreateGLTF2Loader}[i.major];if(!H)throw new Error("Unsupported version: "+O.version);return H(this)}_parseJson(a){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${a.length}`);const O=JSON.parse(a);return this._endPerformanceCounter("Parse JSON"),O}_unpackBinaryAsync(a){return this._startPerformanceCounter("Unpack Binary"),a.loadAsync(20).then((()=>{const O=a.readUint32();if(1179937895!==O)throw new f.m("Unexpected magic: "+O,f.i.GLTFLoaderUnexpectedMagicError);const i=a.readUint32();this.loggingEnabled&&this._log(`Binary version: ${i}`);const H=a.readUint32();let b;switch(this.useRangeRequests||H===a.buffer.byteLength||I.c.Warn(`Length in header does not match actual data length: ${H} != ${a.buffer.byteLength}`),i){case 1:b=this._unpackBinaryV1Async(a,H);break;case 2:b=this._unpackBinaryV2Async(a,H);break;default:throw new Error("Unsupported version: "+i)}return this._endPerformanceCounter("Unpack Binary"),b}))}_unpackBinaryV1Async(a,O){const i=a.readUint32(),H=a.readUint32();if(0!==H)throw new Error(`Unexpected content format: ${H}`);const b=O-a.byteOffset,G={json:this._parseJson(a.readString(i)),bin:null};if(0!==b){const O=a.byteOffset;G.bin={readAsync:(i,H)=>a.buffer.readAsync(O+i,H),byteLength:b}}return Promise.resolve(G)}_unpackBinaryV2Async(a,O){const i=1313821514,H=5130562,b=a.readUint32();if(a.readUint32()!==i)throw new Error("First chunk format is not JSON");return a.byteOffset+b===O?a.loadAsync(b).then((()=>({json:this._parseJson(a.readString(b)),bin:null}))):a.loadAsync(b+8).then((()=>{const G={json:this._parseJson(a.readString(b)),bin:null},q=()=>{const b=a.readUint32();switch(a.readUint32()){case i:throw new Error("Unexpected JSON chunk");case H:{const O=a.byteOffset;G.bin={readAsync:(i,H)=>a.buffer.readAsync(O+i,H),byteLength:b},a.skipBytes(b);break}default:a.skipBytes(b)}return a.byteOffset!==O?a.loadAsync(8).then(q):Promise.resolve(G)};return q()}))}static _parseVersion(a){if("1.0"===a||"1.0.1"===a)return{major:1,minor:0};const O=(a+"").match(/^(\d+)\.(\d+)/);return O?{major:parseInt(O[1]),minor:parseInt(O[2])}:null}static _compareVersion(a,O){return a.major>O.major?1:a.major<O.major?-1:a.minor>O.minor?1:a.minor<O.minor?-1:0}_logOpen(a){this._log(a),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(a){const O=A._logSpaces.substring(0,2*this._logIndentLevel);I.c.Log(`${O}${a}`)}_logDisabled(a){}_startPerformanceCounterEnabled(a){b.Tools.StartPerformanceCounter(a)}_startPerformanceCounterDisabled(a){}_endPerformanceCounterEnabled(a){b.Tools.EndPerformanceCounter(a)}_endPerformanceCounterDisabled(a){}}A.IncrementalLoading=!0,A.HomogeneousCoordinates=!1,A._logSpaces="                                ",(0,G.c)(new A)},14062:(a,O,i)=>{"use strict";i.d(O,{b:()=>q});var H=i(12184);function b(a,O,i,H){const b={externalResourceFunction:H};return i&&(b.uri="file:"===O?i:O+i),ArrayBuffer.isView(a)?GLTFValidator.validateBytes(a,b):GLTFValidator.validateString(a,b)}function G(){const a=[];onmessage=O=>{const i=O.data;switch(i.id){case"init":importScripts(i.url);break;case"validate":b(i.data,i.rootUrl,i.fileName,(O=>new Promise(((i,H)=>{const b=a.length;a.push({resolve:i,reject:H}),postMessage({id:"getExternalResource",index:b,uri:O})})))).then((a=>{postMessage({id:"validate.resolve",value:a})}),(a=>{postMessage({id:"validate.reject",reason:a})}));break;case"getExternalResource.resolve":a[i.index].resolve(i.value);break;case"getExternalResource.reject":a[i.index].reject(i.reason)}}}class q{static ValidateAsync(a,O,i,q){return"function"===typeof Worker?new Promise(((Q,k)=>{const I=`${b}(${G})()`,P=URL.createObjectURL(new Blob([I],{type:"application/javascript"})),e=new Worker(P),h=a=>{e.removeEventListener("error",h),e.removeEventListener("message",j),k(a)},j=a=>{const O=a.data;switch(O.id){case"getExternalResource":q(O.uri).then((a=>{e.postMessage({id:"getExternalResource.resolve",index:O.index,value:a},[a.buffer])}),(a=>{e.postMessage({id:"getExternalResource.reject",index:O.index,reason:a})}));break;case"validate.resolve":e.removeEventListener("error",h),e.removeEventListener("message",j),Q(O.value),e.terminate();break;case"validate.reject":e.removeEventListener("error",h),e.removeEventListener("message",j),k(O.reason),e.terminate()}};if(e.addEventListener("error",h),e.addEventListener("message",j),e.postMessage({id:"init",url:H.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(a)){const H=a.slice();e.postMessage({id:"validate",data:H,rootUrl:O,fileName:i},[H.buffer])}else e.postMessage({id:"validate",data:a,rootUrl:O,fileName:i})})):(this._LoadScriptPromise||(this._LoadScriptPromise=H.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>b(a,O,i,q))))}}q.Configuration={url:`${H.Tools._DefaultCdnUrl}/gltf_validator.js`}},14597:(a,O,i)=>{"use strict";i.d(O,{b:()=>U});var H=i(12375),b=i(12384),G=i(12427),q=i(12395),Q=i(12783),k=i(12726),I=i(12470),P=i(12648),e=i(12346),h=i(12287);i(13820),i(13719),i(13732),i(13724),i(13739),i(13742),i(13751);const j="imageProcessingCompatibility",Z="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";h.c.IncludesShadersStore[j]||(h.c.IncludesShadersStore[j]=Z);const F="skyPixelShader",r="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";h.c.ShadersStore[F]||(h.c.ShadersStore[F]=r);i(13836),i(13760),i(13766),i(13778),i(13769);const J="skyVertexShader",ma="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";h.c.ShadersStore[J]||(h.c.ShadersStore[J]=ma);var M=i(12722),C=i(12773),n=i(12771);class D extends Q.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class U extends k.d{constructor(a,O){super(a,O),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new q.ZO(0,100,0),this.useSunPosition=!1,this.cameraOffset=q.ZO.Zero(),this.up=q.ZO.Up(),this.dithering=!1,this._cameraPosition=q.ZO.Zero(),this._skyOrientation=new q.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(a,O){const i=O._drawWrapper;if(this.isFrozen&&i.effect&&i._wasPreviouslyReady)return!0;O.materialDefines||(O.materialDefines=new D);const H=O.materialDefines,b=this.Ua();if(this._isReadyForSubMesh(O))return!0;if((0,n.R)(a,b,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,H),(0,n.H)(a,H,!0,!1),H.IMAGEPROCESSINGPOSTPROCESS!==b.imageProcessingConfiguration.applyByPostProcess&&H.markAsMiscDirty(),H.DITHER!==this.dithering&&H.markAsMiscDirty(),H.isDirty){H.markAsProcessed(),b.resetCachedMaterial();const a=new M.c;H.FOG&&a.addFallback(1,"FOG"),H.IMAGEPROCESSINGPOSTPROCESS=b.imageProcessingConfiguration.applyByPostProcess,H.DITHER=this.dithering;const i=[I.c.PositionKind];H.VERTEXCOLOR&&i.push(I.c.ColorKind);const G="sky",q=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,C.d)(q);const Q=H.toString();O.setEffect(b.getEngine().createEffect(G,i,q,[],Q,a,this.onCompiled,this.onError),H,this._materialContext)}return!(!O.effect||!O.effect.isReady())&&(H._renderId=b.getRenderId(),i._wasPreviouslyReady=!0,!0)}bindForSubMesh(a,O,i){const H=this.Ua(),b=i.materialDefines;if(!b)return;const G=i.effect;if(!G)return;this._activeEffect=G,this.bindOnlyWorldMatrix(a),this._activeEffect.setMatrix("viewProjection",H.getTransformMatrix()),this._mustRebind(H,G,i)&&((0,C.f)(G,this,H),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,n.h)(b,G,H)),H.fogEnabled&&O.applyFog&&H.fogMode!==P.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",H.getViewMatrix()),(0,n.d)(H,O,this._activeEffect);const Q=H.activeCamera;if(Q){const a=Q.getWorldMatrix();this._cameraPosition.x=a.m[12],this._cameraPosition.y=a.m[13],this._cameraPosition.z=a.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const a=Math.PI*(this.inclination-.5),O=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(O)*Math.cos(a),this.sunPosition.y=this.distance*Math.sin(-a),this.sunPosition.z=this.distance*Math.sin(O)*Math.cos(a),q.Quaternion.FromUnitVectorsToRef(q.ZO.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(O,this._activeEffect,i)}getAnimatables(){return[]}dispose(a){super.dispose(a)}clone(a){return G.d.Clone((()=>new U(a,this.Ua())),this)}serialize(){const a=super.serialize();return a.customType="BABYLON.SkyMaterial",a}getClassName(){return"SkyMaterial"}static Parse(a,O,i){return G.d.Parse((()=>new U(a.name,O)),a,O,i)}}(0,H.c)([(0,b.G)()],U.prototype,"luminance",void 0),(0,H.c)([(0,b.G)()],U.prototype,"turbidity",void 0),(0,H.c)([(0,b.G)()],U.prototype,"rayleigh",void 0),(0,H.c)([(0,b.G)()],U.prototype,"mieCoefficient",void 0),(0,H.c)([(0,b.G)()],U.prototype,"mieDirectionalG",void 0),(0,H.c)([(0,b.G)()],U.prototype,"distance",void 0),(0,H.c)([(0,b.G)()],U.prototype,"inclination",void 0),(0,H.c)([(0,b.G)()],U.prototype,"azimuth",void 0),(0,H.c)([(0,b.D)()],U.prototype,"sunPosition",void 0),(0,H.c)([(0,b.G)()],U.prototype,"useSunPosition",void 0),(0,H.c)([(0,b.D)()],U.prototype,"cameraOffset",void 0),(0,H.c)([(0,b.D)()],U.prototype,"up",void 0),(0,H.c)([(0,b.G)()],U.prototype,"dithering",void 0),(0,e.h)("BABYLON.SkyMaterial",U)},13094:(a,O,i)=>{"use strict";function H(a,O){O.headers=a.headers||{},O.statusMessage=a.statusText,O.statusCode=a.status,O.data=a.response}function b(a,O,i){return new Promise((function(b,G){i=i||{};var q,Q,k,I=new XMLHttpRequest,P=i.body,e=i.headers||{};for(q in i.timeout&&(I.timeout=i.timeout),I.ontimeout=I.onerror=function(a){a.timeout="timeout"==a.type,G(a)},I.open(a,O.href||O),I.onload=function(){for(k=I.getAllResponseHeaders().trim().split(/[\r\n]+/),H(I,I);Q=k.shift();)Q=Q.split(": "),I.headers[Q.shift().toLowerCase()]=Q.join(": ");if((Q=I.headers["content-type"])&&~Q.indexOf("application/json"))try{I.data=JSON.parse(I.data,i.reviver)}catch(a){return H(I,a),G(a)}(I.status>=400?G:b)(I)},typeof FormData<"u"&&P instanceof FormData||P&&"object"==typeof P&&(e["content-type"]="application/json",P=JSON.stringify(P)),I.withCredentials=!!i.withCredentials,e)I.setRequestHeader(q,e[q]);I.send(P)}))}i.r(O),i.d(O,{del:()=>k,get:()=>G,patch:()=>Q,post:()=>q,put:()=>I,send:()=>b});var G=b.bind(b,"GET"),q=b.bind(b,"POST"),Q=b.bind(b,"PATCH"),k=b.bind(b,"DELETE"),I=b.bind(b,"PUT")},14705:(a,O,i)=>{"use strict";i.d(O,{d:()=>e});const H=.5*(Math.sqrt(3)-1),b=(3-Math.sqrt(3))/6,G=1/3,q=1/6,Q=(Math.sqrt(5)-1)/4,k=(5-Math.sqrt(5))/20,I=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),P=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const e=class{constructor(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const O="function"==typeof a?a:function(a){let O=0,i=0,H=0,b=1;const G=function(){let a=4022871197;return function(O){O=O.toString();for(let i=0;i<O.length;i++){a+=O.charCodeAt(i);let H=.02519603282416938*a;a=H>>>0,H-=a,H*=a,a=H>>>0,H-=a,a+=4294967296*H}return 2.3283064365386963e-10*(a>>>0)}}();O=G(" "),i=G(" "),H=G(" "),O-=G(a),O<0&&(O+=1);i-=G(a),i<0&&(i+=1);H-=G(a),H<0&&(H+=1);return function(){const a=2091639*O+2.3283064365386963e-10*b;return O=i,i=H,H=a-(b=0|a)}}(a);this.p=function(a){const O=new Uint8Array(256);for(let i=0;i<256;i++)O[i]=i;for(let i=0;i<255;i++){const H=i+~~(a()*(256-i)),b=O[i];O[i]=O[H],O[H]=b}return O}(O),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let i=0;i<512;i++)this.perm[i]=this.p[255&i],this.permMod12[i]=this.perm[i]%12}noise2D(a,O){const i=this.permMod12,G=this.perm;let q=0,Q=0,k=0;const P=(a+O)*H,e=Math.floor(a+P),h=Math.floor(O+P),j=(e+h)*b,Z=a-(e-j),F=O-(h-j);let r,J;Z>F?(r=1,J=0):(r=0,J=1);const ma=Z-r+b,M=F-J+b,C=Z-1+2*b,n=F-1+2*b,D=255&e,U=255&h;let y=.5-Z*Z-F*F;if(y>=0){const a=3*i[D+G[U]];y*=y,q=y*y*(I[a]*Z+I[a+1]*F)}let w=.5-ma*ma-M*M;if(w>=0){const a=3*i[D+r+G[U+J]];w*=w,Q=w*w*(I[a]*ma+I[a+1]*M)}let K=.5-C*C-n*n;if(K>=0){const a=3*i[D+1+G[U+1]];K*=K,k=K*K*(I[a]*C+I[a+1]*n)}return 70*(q+Q+k)}noise3D(a,O,i){const H=this.permMod12,b=this.perm;let Q,k,P,e;const h=(a+O+i)*G,j=Math.floor(a+h),Z=Math.floor(O+h),F=Math.floor(i+h),r=(j+Z+F)*q,J=a-(j-r),ma=O-(Z-r),M=i-(F-r);let C,n,D,U,y,w;J>=ma?ma>=M?(C=1,n=0,D=0,U=1,y=1,w=0):J>=M?(C=1,n=0,D=0,U=1,y=0,w=1):(C=0,n=0,D=1,U=1,y=0,w=1):ma<M?(C=0,n=0,D=1,U=0,y=1,w=1):J<M?(C=0,n=1,D=0,U=0,y=1,w=1):(C=0,n=1,D=0,U=1,y=1,w=0);const K=J-C+q,S=ma-n+q,f=M-D+q,B=J-U+2*q,T=ma-y+2*q,A=M-w+2*q,E=J-1+.5,l=ma-1+.5,W=M-1+.5,u=255&j,c=255&Z,R=255&F;let z=.6-J*J-ma*ma-M*M;if(z<0)Q=0;else{const a=3*H[u+b[c+b[R]]];z*=z,Q=z*z*(I[a]*J+I[a+1]*ma+I[a+2]*M)}let x=.6-K*K-S*S-f*f;if(x<0)k=0;else{const a=3*H[u+C+b[c+n+b[R+D]]];x*=x,k=x*x*(I[a]*K+I[a+1]*S+I[a+2]*f)}let g=.6-B*B-T*T-A*A;if(g<0)P=0;else{const a=3*H[u+U+b[c+y+b[R+w]]];g*=g,P=g*g*(I[a]*B+I[a+1]*T+I[a+2]*A)}let N=.6-E*E-l*l-W*W;if(N<0)e=0;else{const a=3*H[u+1+b[c+1+b[R+1]]];N*=N,e=N*N*(I[a]*E+I[a+1]*l+I[a+2]*W)}return 32*(Q+k+P+e)}noise4D(a,O,i,H){const b=this.perm;let G,q,I,e,h;const j=(a+O+i+H)*Q,Z=Math.floor(a+j),F=Math.floor(O+j),r=Math.floor(i+j),J=Math.floor(H+j),ma=(Z+F+r+J)*k,M=a-(Z-ma),C=O-(F-ma),n=i-(r-ma),D=H-(J-ma);let U=0,y=0,w=0,K=0;M>C?U++:y++,M>n?U++:w++,M>D?U++:K++,C>n?y++:w++,C>D?y++:K++,n>D?w++:K++;const S=U>=3?1:0,f=y>=3?1:0,B=w>=3?1:0,T=K>=3?1:0,A=U>=2?1:0,E=y>=2?1:0,l=w>=2?1:0,W=K>=2?1:0,u=U>=1?1:0,c=y>=1?1:0,R=w>=1?1:0,z=K>=1?1:0,x=M-S+k,g=C-f+k,N=n-B+k,v=D-T+k,X=M-A+2*k,p=C-E+2*k,o=n-l+2*k,d=D-W+2*k,Y=M-u+3*k,L=C-c+3*k,s=n-R+3*k,t=D-z+3*k,V=M-1+4*k,aa=C-1+4*k,Oa=n-1+4*k,ia=D-1+4*k,Ha=255&Z,ba=255&F,Ga=255&r,qa=255&J;let Qa=.6-M*M-C*C-n*n-D*D;if(Qa<0)G=0;else{const a=b[Ha+b[ba+b[Ga+b[qa]]]]%32*4;Qa*=Qa,G=Qa*Qa*(P[a]*M+P[a+1]*C+P[a+2]*n+P[a+3]*D)}let ka=.6-x*x-g*g-N*N-v*v;if(ka<0)q=0;else{const a=b[Ha+S+b[ba+f+b[Ga+B+b[qa+T]]]]%32*4;ka*=ka,q=ka*ka*(P[a]*x+P[a+1]*g+P[a+2]*N+P[a+3]*v)}let Ia=.6-X*X-p*p-o*o-d*d;if(Ia<0)I=0;else{const a=b[Ha+A+b[ba+E+b[Ga+l+b[qa+W]]]]%32*4;Ia*=Ia,I=Ia*Ia*(P[a]*X+P[a+1]*p+P[a+2]*o+P[a+3]*d)}let Pa=.6-Y*Y-L*L-s*s-t*t;if(Pa<0)e=0;else{const a=b[Ha+u+b[ba+c+b[Ga+R+b[qa+z]]]]%32*4;Pa*=Pa,e=Pa*Pa*(P[a]*Y+P[a+1]*L+P[a+2]*s+P[a+3]*t)}let ea=.6-V*V-aa*aa-Oa*Oa-ia*ia;if(ea<0)h=0;else{const a=b[Ha+1+b[ba+1+b[Ga+1+b[qa+1]]]]%32*4;ea*=ea,h=ea*ea*(P[a]*V+P[a+1]*aa+P[a+2]*Oa+P[a+3]*ia)}return 27*(G+q+I+e+h)}}}}]);