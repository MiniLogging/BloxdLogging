/*! For license information please see ohk0vd.32.829554cc.chunk.js.LICENSE.txt */
(self["686i8587bmi"]=self["686i8587bmi"]||[]).push([[32],{14818:(h,d,T)=>{"use strict";var Y=T(14823),y=T(14829),C=T(14838);T.g.__TYPEDARRAY_POOL||(T.g.__TYPEDARRAY_POOL={UINT8:y([32,0]),UINT16:y([32,0]),UINT32:y([32,0]),INT8:y([32,0]),INT16:y([32,0]),INT32:y([32,0]),FLOAT:y([32,0]),DOUBLE:y([32,0]),DATA:y([32,0]),UINT8C:y([32,0]),BUFFER:y([32,0])});var n="undefined"!==typeof Uint8ClampedArray,X=T.g.__TYPEDARRAY_POOL;X.UINT8C||(X.UINT8C=y([32,0])),X.BUFFER||(X.BUFFER=y([32,0]));var F=X.DATA,U=X.BUFFER;function Z(h){if(h){var d=h.length||h.byteLength,T=Y.log2(d);F[T].push(h)}}function S(h){h=Y.nextPow2(h);var d=Y.log2(h),T=F[d];return T.length>0?T.pop():new ArrayBuffer(h)}function r(h){return new Uint8Array(S(h),0,h)}function c(h){return new Uint16Array(S(2*h),0,h)}function O(h){return new Uint32Array(S(4*h),0,h)}function f(h){return new Int8Array(S(h),0,h)}function J(h){return new Int16Array(S(2*h),0,h)}function W(h){return new Int32Array(S(4*h),0,h)}function L(h){return new Float32Array(S(4*h),0,h)}function D(h){return new Float64Array(S(8*h),0,h)}function V(h){return n?new Uint8ClampedArray(S(h),0,h):r(h)}function i(h){return new DataView(S(h),0,h)}d.free=function(h){if(C(h))U[Y.log2(h.length)].push(h);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(h)&&(h=h.buffer),!h)return;var d=h.length||h.byteLength,T=0|Y.log2(d);F[T].push(h)}},d.freeUint8=d.freeUint16=d.freeUint32=d.freeInt8=d.freeInt16=d.freeInt32=d.freeFloat32=d.freeFloat=d.freeFloat64=d.freeDouble=d.freeUint8Clamped=d.freeDataView=function(h){Z(h.buffer)},d.freeArrayBuffer=Z,d.freeBuffer=function(h){U[Y.log2(h.length)].push(h)},d.malloc=function(h,d){if(void 0===d||"arraybuffer"===d)return S(h);switch(d){case"uint8":return r(h);case"uint16":return c(h);case"uint32":return O(h);case"int8":return f(h);case"int16":return J(h);case"int32":return W(h);case"float":case"float32":return L(h);case"double":case"float64":return D(h);case"uint8_clamped":return V(h);case"buffer":throw"Buffer not supported";case"data":case"dataview":return i(h);default:return null}return null},d.mallocArrayBuffer=S,d.mallocUint8=r,d.mallocUint16=c,d.mallocUint32=O,d.mallocInt8=f,d.mallocInt16=J,d.mallocInt32=W,d.mallocFloat32=d.mallocFloat=L,d.mallocFloat64=d.mallocDouble=D,d.mallocUint8Clamped=V,d.mallocDataView=i,d.clearCache=function(){for(var h=0;h<32;++h)X.UINT8[h].length=0,X.UINT16[h].length=0,X.UINT32[h].length=0,X.INT8[h].length=0,X.INT16[h].length=0,X.INT32[h].length=0,X.FLOAT[h].length=0,X.DOUBLE[h].length=0,X.UINT8C[h].length=0,F[h].length=0,U[h].length=0}},14909:(h,d,T)=>{h.exports=y;var Y=T(13593);function y(h,d){if(!(this instanceof y))return new y(h,d);var T=Y.create();Y.add(T,h,d),this.base=Y.min(Y.create(),h,T),this.SZ=Y.clone(d),this.max=Y.max(Y.create(),h,T),this.mag=Y.length(this.SZ)}var C=y.prototype;C.width=function(){return this.SZ[0]},C.height=function(){return this.SZ[1]},C.depth=function(){return this.SZ[2]},C.x0=function(){return this.base[0]},C.y0=function(){return this.base[1]},C.z0=function(){return this.base[2]},C.x1=function(){return this.max[0]},C.y1=function(){return this.max[1]},C.z1=function(){return this.max[2]},C.translate=function(h){return Y.add(this.max,this.max,h),Y.add(this.base,this.base,h),this},C.setPosition=function(h){return Y.add(this.max,h,this.SZ),Y.j(this.base,h),this},C.expand=function(h){var d=Y.create(),T=Y.create();return Y.max(d,h.max,this.max),Y.min(T,h.base,this.base),Y.Nd(d,d,T),new y(T,d)},C.intersects=function(h){return!(h.base[0]>this.max[0])&&(!(h.base[1]>this.max[1])&&(!(h.base[2]>this.max[2])&&(!(h.max[0]<this.base[0])&&(!(h.max[1]<this.base[1])&&!(h.max[2]<this.base[2])))))},C.touches=function(h){var d=this.union(h);return null!==d&&(0==d.width()||0==d.height()||0==d.depth())},C.union=function(h){if(!this.intersects(h))return null;var d=Math.max(h.base[0],this.base[0]),T=Math.max(h.base[1],this.base[1]),Y=Math.max(h.base[2],this.base[2]);return new y([d,T,Y],[Math.min(h.max[0],this.max[0])-d,Math.min(h.max[1],this.max[1])-T,Math.min(h.max[2],this.max[2])-Y])}},14823:(h,d)=>{"use strict";function T(h){var d=32;return(h&=-h)&&d--,65535&h&&(d-=16),16711935&h&&(d-=8),252645135&h&&(d-=4),858993459&h&&(d-=2),1431655765&h&&(d-=1),d}d.INT_BITS=32,d.INT_MAX=2147483647,d.INT_MIN=-1<<31,d.sign=function(h){return(h>0)-(h<0)},d.abs=function(h){var d=h>>31;return(h^d)-d},d.min=function(h,d){return d^(h^d)&-(h<d)},d.max=function(h,d){return h^(h^d)&-(h<d)},d.isPow2=function(h){return!(h&h-1)&&!!h},d.log2=function(h){var d,T;return d=(h>65535)<<4,d|=T=((h>>>=d)>255)<<3,d|=T=((h>>>=T)>15)<<2,(d|=T=((h>>>=T)>3)<<1)|(h>>>=T)>>1},d.log10=function(h){return h>=1e9?9:h>=1e8?8:h>=1e7?7:h>=1e6?6:h>=1e5?5:h>=1e4?4:h>=1e3?3:h>=100?2:h>=10?1:0},d.popCount=function(h){return 16843009*((h=(858993459&(h-=h>>>1&1431655765))+(h>>>2&858993459))+(h>>>4)&252645135)>>>24},d.countTrailingZeros=T,d.nextPow2=function(h){return h+=0===h,--h,h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)+1},d.prevPow2=function(h){return h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)-(h>>>1)},d.parity=function(h){return h^=h>>>16,h^=h>>>8,h^=h>>>4,27030>>>(h&=15)&1};var Y=new Array(256);!function(h){for(var d=0;d<256;++d){var T=d,Y=d,y=7;for(T>>>=1;T;T>>>=1)Y<<=1,Y|=1&T,--y;h[d]=Y<<y&255}}(Y),d.reverse=function(h){return Y[255&h]<<24|Y[h>>>8&255]<<16|Y[h>>>16&255]<<8|Y[h>>>24&255]},d.interleave2=function(h,d){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))|(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d&=65535)|d<<8))|d<<4))|d<<2))|d<<1))<<1},d.deinterleave2=function(h,d){return(h=65535&((h=16711935&((h=252645135&((h=858993459&((h=h>>>d&1431655765)|h>>>1))|h>>>2))|h>>>4))|h>>>16))<<16>>16},d.interleave3=function(h,d,T){return h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2),(h|=(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<1)|(T=1227133513&((T=3272356035&((T=251719695&((T=4278190335&((T&=1023)|T<<16))|T<<8))|T<<4))|T<<2))<<2},d.deinterleave3=function(h,d){return(h=1023&((h=4278190335&((h=251719695&((h=3272356035&((h=h>>>d&1227133513)|h>>>2))|h>>>4))|h>>>8))|h>>>16))<<22>>22},d.nextCombination=function(h){var d=h|h-1;return d+1|(~d&-~d)-1>>>T(h)+1}},14814:(h,d,T)=>{"use strict";h.exports=function(h,d,T){switch(arguments.length){case 1:return Y=[],U(y=h,y,Z,!0),Y;case 2:return"function"===typeof d?U(h,h,d,!0):function(h,d){return Y=[],U(h,d,Z,!1),Y}(h,d);case 3:return U(h,d,T,!1);default:throw new Error("box-intersect: Invalid arguments")}var y};var Y,y=T(14818),C=T(14840),n=T(14850);function X(h,d){for(var T=0;T<h;++T)if(!(d[T]<=d[T+h]))return!0;return!1}function F(h,d,T,Y){for(var y=0,C=0,n=0,F=h.length;n<F;++n){var U=h[n];if(!X(d,U)){for(var Z=0;Z<2*d;++Z)T[y++]=U[Z];Y[C++]=n}}return C}function U(h,d,T,Y){var X=h.length,U=d.length;if(!(X<=0||U<=0)){var Z=h[0].length>>>1;if(!(Z<=0)){var S,r=y.mallocDouble(2*Z*X),c=y.mallocInt32(X);if((X=F(h,Z,r,c))>0){if(1===Z&&Y)C.init(X),S=C.sweepComplete(Z,T,0,X,r,c,0,X,r,c);else{var O=y.mallocDouble(2*Z*U),f=y.mallocInt32(U);(U=F(d,Z,O,f))>0&&(C.init(X+U),S=1===Z?C.sweepBipartite(Z,T,0,X,r,c,0,U,O,f):n(Z,T,Y,X,r,c,U,O,f),y.free(O),y.free(f))}y.free(r),y.free(c)}return S}}}function Z(h,d){Y.push([h,d])}},14852:(h,d)=>{"use strict";var T="d",Y="ax",y="fp",C="es",n="rs",X="re",F="rb",U="bs",Z="be",S="bb",r=[T,Y,"vv",n,X,F,"ri",U,Z,S,"bi"];function c(h){var d="bruteForce"+(h?"Full":"Partial"),Y=[],n=r.slice();h||n.splice(3,0,y);var X=["function "+d+"("+n.join()+"){"];function F(d,y){var n=function(h,d,Y){var y="bruteForce"+(h?"Red":"Blue")+(d?"Flip":"")+(Y?"Full":""),n=["function ",y,"(",r.join(),"){","var ",C,"=2*",T,";"],X="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",F="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(Y?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return h?n.push(X,"Q",":",F):n.push(F,"Q",":",X),Y?n.push("if(y1<x0||x1<y0)continue;"):d?n.push("if(y0<=x0||x1<y0)continue;"):n.push("if(y0<x0||x1<y0)continue;"),n.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),d?n.push("yi,xi"):n.push("xi,yi"),n.push(");if(rv!==void 0)return rv;}}}"),{name:y,code:n.join("")}}(d,y,h);Y.push(n.code),X.push("return "+n.name+"("+r.join()+");")}X.push("if(re-rs>be-bs){"),h?(F(!0,!1),X.push("}else{"),F(!1,!1)):(X.push("if(fp){"),F(!0,!0),X.push("}else{"),F(!0,!1),X.push("}}else{if(fp){"),F(!1,!0),X.push("}else{"),F(!1,!1),X.push("}")),X.push("}}return "+d);var U=Y.join("")+X.join("");return new Function(U)()}d.partial=c(!1),d.full=c(!0)},14850:(h,d,T)=>{"use strict";h.exports=function(h,d,T,C,Z,g,H,p,k){!function(h,d){var T=8*y.log2(d+1)*(h+1)|0,C=y.nextPow2(V*T);w.length<C&&(Y.free(w),w=Y.mallocInt32(C));var n=y.nextPow2(i*T);s.length<n&&(Y.free(s),s=Y.mallocDouble(n))}(h,C+H);var o,u=0,N=2*h;E(u++,0,0,C,0,H,T?16:0,-1/0,1/0),T||E(u++,0,0,H,0,C,1,-1/0,1/0);for(;u>0;){var K=(u-=1)*V,l=w[K],q=w[K+1],j=w[K+2],a=w[K+3],e=w[K+4],v=w[K+5],G=u*i,b=s[G],B=s[G+1],M=1&v,mh=!!(16&v),R=Z,Q=g,I=p,A=k;if(M&&(R=p,Q=k,I=Z,A=g),!(2&v&&q>=(j=J(h,l,q,j,R,Q,B)))&&!(4&v&&(q=W(h,l,q,j,R,Q,b))>=j)){var P=j-q,t=e-a;if(mh){if(h*P*(P+t)<c){if(void 0!==(o=F.scanComplete(h,l,d,q,j,R,Q,a,e,I,A)))return o;continue}}else{if(h*Math.min(P,t)<S){if(void 0!==(o=n(h,l,d,M,q,j,R,Q,a,e,I,A)))return o;continue}if(h*P*t<r){if(void 0!==(o=F.scanBipartite(h,l,d,M,q,j,R,Q,a,e,I,A)))return o;continue}}var hh=O(h,l,q,j,R,Q,b,B);if(q<hh)if(h*(hh-q)<S){if(void 0!==(o=X(h,l+1,d,q,hh,R,Q,a,e,I,A)))return o}else if(l===h-2){if(void 0!==(o=M?F.sweepBipartite(h,d,a,e,I,A,q,hh,R,Q):F.sweepBipartite(h,d,q,hh,R,Q,a,e,I,A)))return o}else E(u++,l+1,q,hh,a,e,M,-1/0,1/0),E(u++,l+1,a,e,q,hh,1^M,-1/0,1/0);if(hh<j){var dh=U(h,l,a,e,I,A),Th=I[N*dh+l],Yh=f(h,l,dh,e,I,A,Th);if(Yh<e&&E(u++,l,hh,j,Yh,e,(4|M)+(mh?16:0),Th,B),a<dh&&E(u++,l,hh,j,a,dh,(2|M)+(mh?16:0),b,Th),dh+1===Yh){if(void 0!==(o=mh?x(h,l,d,hh,j,R,Q,dh,I,A[dh]):z(h,l,d,M,hh,j,R,Q,dh,I,A[dh])))return o}else if(dh<Yh){var yh;if(mh){if(hh<(yh=L(h,l,hh,j,R,Q,Th))){var Ch=f(h,l,hh,yh,R,Q,Th);if(l===h-2){if(hh<Ch&&void 0!==(o=F.sweepComplete(h,d,hh,Ch,R,Q,dh,Yh,I,A)))return o;if(Ch<yh&&void 0!==(o=F.sweepBipartite(h,d,Ch,yh,R,Q,dh,Yh,I,A)))return o}else hh<Ch&&E(u++,l+1,hh,Ch,dh,Yh,16,-1/0,1/0),Ch<yh&&(E(u++,l+1,Ch,yh,dh,Yh,0,-1/0,1/0),E(u++,l+1,dh,Yh,Ch,yh,1,-1/0,1/0))}}else hh<(yh=M?D(h,l,hh,j,R,Q,Th):L(h,l,hh,j,R,Q,Th))&&(l===h-2?o=M?F.sweepBipartite(h,d,dh,Yh,I,A,hh,yh,R,Q):F.sweepBipartite(h,d,hh,yh,R,Q,dh,Yh,I,A):(E(u++,l+1,hh,yh,dh,Yh,M,-1/0,1/0),E(u++,l+1,dh,Yh,hh,yh,1^M,-1/0,1/0)))}}}}};var Y=T(14818),y=T(14823),C=T(14852),n=C.partial,X=C.full,F=T(14840),U=T(14861),Z=T(14866),S=128,r=1<<22,c=1<<22,O=Z("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),f=Z("lo===p0",["p0"]),J=Z("lo<p0",["p0"]),W=Z("hi<=p0",["p0"]),L=Z("lo<=p0&&p0<=hi",["p0"]),D=Z("lo<p0&&p0<=hi",["p0"]),V=6,i=2,w=Y.mallocInt32(1024),s=Y.mallocDouble(1024);function E(h,d,T,Y,y,C,n,X,F){var U=V*h;w[U]=d,w[U+1]=T,w[U+2]=Y,w[U+3]=y,w[U+4]=C,w[U+5]=n;var Z=i*h;s[Z]=X,s[Z+1]=F}function z(h,d,T,Y,y,C,n,X,F,U,Z){var S=2*h,r=F*S,c=U[r+d];h:for(var O=y,f=y*S;O<C;++O,f+=S){var J=n[f+d],W=n[f+d+h];if(!(c<J||W<c)&&(!Y||c!==J)){for(var L,D=X[O],V=d+1;V<h;++V){J=n[f+V],W=n[f+V+h];var i=U[r+V],w=U[r+V+h];if(W<i||w<J)continue h}if(void 0!==(L=Y?T(Z,D):T(D,Z)))return L}}}function x(h,d,T,Y,y,C,n,X,F,U){var Z=2*h,S=X*Z,r=F[S+d];h:for(var c=Y,O=Y*Z;c<y;++c,O+=Z){var f=n[c];if(f!==U){var J=C[O+d],W=C[O+d+h];if(!(r<J||W<r)){for(var L=d+1;L<h;++L){J=C[O+L],W=C[O+L+h];var D=F[S+L],V=F[S+L+h];if(W<D||V<J)continue h}var i=T(f,U);if(void 0!==i)return i}}}}},14861:(h,d,T)=>{"use strict";h.exports=function(h,d,T,n,X,F){if(n<=T+1)return T;var U=T,Z=n,S=n+T>>>1,r=2*h,c=S,O=X[r*S+d];for(;U<Z;){if(Z-U<y){C(h,d,U,Z,X,F),O=X[r*S+d];break}var f=Z-U,J=Math.random()*f+U|0,W=X[r*J+d],L=Math.random()*f+U|0,D=X[r*L+d],V=Math.random()*f+U|0,i=X[r*V+d];W<=D?i>=D?(c=L,O=D):W>=i?(c=J,O=W):(c=V,O=i):D>=i?(c=L,O=D):i>=W?(c=J,O=W):(c=V,O=i);for(var w=r*(Z-1),s=r*c,E=0;E<r;++E,++w,++s){var z=X[w];X[w]=X[s],X[s]=z}var x=F[Z-1];F[Z-1]=F[c],F[c]=x;for(w=r*(Z-1),s=r*(c=Y(h,d,U,Z-1,X,F,O)),E=0;E<r;++E,++w,++s){z=X[w];X[w]=X[s],X[s]=z}x=F[Z-1];if(F[Z-1]=F[c],F[c]=x,S<c){for(Z=c-1;U<Z&&X[r*(Z-1)+d]===O;)Z-=1;Z+=1}else{if(!(c<S))break;for(U=c+1;U<Z&&X[r*U+d]===O;)U+=1}}return Y(h,d,T,S,X,F,X[r*S+d])};var Y=T(14866)("lo<p0",["p0"]),y=8;function C(h,d,T,Y,y,C){for(var n=2*h,X=n*(T+1)+d,F=T+1;F<Y;++F,X+=n)for(var U=y[X],Z=F,S=n*(F-1);Z>T&&y[S+d]>U;--Z,S-=n){for(var r=S,c=S+n,O=0;O<n;++O,++r,++c){var f=y[r];y[r]=y[c],y[c]=f}var J=C[Z];C[Z]=C[Z-1],C[Z-1]=J}}},14866:h=>{"use strict";h.exports=function(h,T){var Y="abcdef".split("").concat(T),y=[];h.indexOf("lo")>=0&&y.push("lo=e[k+n]");h.indexOf("hi")>=0&&y.push("hi=e[k+o]");return Y.push(d.replace("_",y.join()).replace("$",h)),Function.apply(void 0,Y)};var d="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14848:h=>{"use strict";h.exports=function(h,Y){Y<=4*d?T(0,Y-1,h):U(0,Y-1,h)};var d=32;function T(h,d,T){for(var Y=2*(h+1),y=h+1;y<=d;++y){for(var C=T[Y++],n=T[Y++],X=y,F=Y-2;X-- >h;){var U=T[F-2],Z=T[F-1];if(U<C)break;if(U===C&&Z<n)break;T[F]=U,T[F+1]=Z,F-=2}T[F]=C,T[F+1]=n}}function Y(h,d,T){d*=2;var Y=T[h*=2],y=T[h+1];T[h]=T[d],T[h+1]=T[d+1],T[d]=Y,T[d+1]=y}function y(h,d,T){d*=2,T[h*=2]=T[d],T[h+1]=T[d+1]}function C(h,d,T,Y){d*=2,T*=2;var y=Y[h*=2],C=Y[h+1];Y[h]=Y[d],Y[h+1]=Y[d+1],Y[d]=Y[T],Y[d+1]=Y[T+1],Y[T]=y,Y[T+1]=C}function n(h,d,T,Y,y){d*=2,y[h*=2]=y[d],y[d]=T,y[h+1]=y[d+1],y[d+1]=Y}function X(h,d,T){d*=2;var Y=T[h*=2],y=T[d];return!(Y<y)&&(Y!==y||T[h+1]>T[d+1])}function F(h,d,T,Y){var y=Y[h*=2];return y<d||y===d&&Y[h+1]<T}function U(h,Z,S){var r=(Z-h+1)/6|0,c=h+r,O=Z-r,f=h+Z>>1,J=f-r,W=f+r,L=c,D=J,V=f,i=W,w=O,s=h+1,E=Z-1,z=0;X(L,D,S)&&(z=L,L=D,D=z),X(i,w,S)&&(z=i,i=w,w=z),X(L,V,S)&&(z=L,L=V,V=z),X(D,V,S)&&(z=D,D=V,V=z),X(L,i,S)&&(z=L,L=i,i=z),X(V,i,S)&&(z=V,V=i,i=z),X(D,w,S)&&(z=D,D=w,w=z),X(D,V,S)&&(z=D,D=V,V=z),X(i,w,S)&&(z=i,i=w,w=z);for(var x=S[2*D],g=S[2*D+1],H=S[2*i],p=S[2*i+1],k=2*L,o=2*V,u=2*w,N=2*c,K=2*f,l=2*O,q=0;q<2;++q){var j=S[k+q],a=S[o+q],e=S[u+q];S[N+q]=j,S[K+q]=a,S[l+q]=e}y(J,h,S),y(W,Z,S);for(var v=s;v<=E;++v)if(F(v,x,g,S))v!==s&&Y(v,s,S),++s;else if(!F(v,H,p,S))for(;;){if(F(E,H,p,S)){F(E,x,g,S)?(C(v,s,E,S),++s,--E):(Y(v,E,S),--E);break}if(--E<v)break}n(h,s-1,x,g,S),n(Z,E+1,H,p,S),s-2-h<=d?T(h,s-2,S):U(h,s-2,S),Z-(E+2)<=d?T(E+2,Z,S):U(E+2,Z,S),E-s<=d?T(s,E,S):U(s,E,S)}},14840:(h,d,T)=>{"use strict";h.exports={init:function(h){var d=y.nextPow2(h);F.length<d&&(Y.free(F),F=Y.mallocInt32(d));U.length<d&&(Y.free(U),U=Y.mallocInt32(d));Z.length<d&&(Y.free(Z),Z=Y.mallocInt32(d));S.length<d&&(Y.free(S),S=Y.mallocInt32(d));r.length<d&&(Y.free(r),r=Y.mallocInt32(d));c.length<d&&(Y.free(c),c=Y.mallocInt32(d));var T=8*d;O.length<T&&(Y.free(O),O=Y.mallocDouble(T))},sweepBipartite:function(h,d,T,Y,y,X,r,c,W,L){for(var D=0,V=2*h,i=h-1,w=V-1,s=T;s<Y;++s){var E=X[s],z=V*s;O[D++]=y[z+i],O[D++]=-(E+1),O[D++]=y[z+w],O[D++]=E}for(s=r;s<c;++s){E=L[s]+n;var x=V*s;O[D++]=W[x+i],O[D++]=-E,O[D++]=W[x+w],O[D++]=E}var g=D>>>1;C(O,g);var H=0,p=0;for(s=0;s<g;++s){var k=0|O[2*s+1];if(k>=n)f(Z,S,p--,k=k-n|0);else if(k>=0)f(F,U,H--,k);else if(k<=-n){k=-k-n|0;for(var o=0;o<H;++o){if(void 0!==(u=d(F[o],k)))return u}J(Z,S,p++,k)}else{k=-k-1|0;for(o=0;o<p;++o){var u;if(void 0!==(u=d(k,Z[o])))return u}J(F,U,H++,k)}}},sweepComplete:function(h,d,T,Y,y,n,X,W,L,D){for(var V=0,i=2*h,w=h-1,s=i-1,E=T;E<Y;++E){var z=n[E]+1<<1,x=i*E;O[V++]=y[x+w],O[V++]=-z,O[V++]=y[x+s],O[V++]=z}for(E=X;E<W;++E){z=D[E]+1<<1;var g=i*E;O[V++]=L[g+w],O[V++]=1|-z,O[V++]=L[g+s],O[V++]=1|z}var H=V>>>1;C(O,H);var p=0,k=0,o=0;for(E=0;E<H;++E){var u=0|O[2*E+1],N=1&u;if(E<H-1&&u>>1===O[2*E+3]>>1&&(N=2,E+=1),u<0){for(var K=-(u>>1)-1,l=0;l<o;++l){if(void 0!==(q=d(r[l],K)))return q}if(0!==N)for(l=0;l<p;++l){if(void 0!==(q=d(F[l],K)))return q}if(1!==N)for(l=0;l<k;++l){var q;if(void 0!==(q=d(Z[l],K)))return q}0===N?J(F,U,p++,K):1===N?J(Z,S,k++,K):2===N&&J(r,c,o++,K)}else{K=(u>>1)-1;0===N?f(F,U,p--,K):1===N?f(Z,S,k--,K):2===N&&f(r,c,o--,K)}}},scanBipartite:function(h,d,T,Y,y,X,Z,S,r,c,W,L){var D=0,V=2*h,i=d,w=d+h,s=1,E=1;Y?E=n:s=n;for(var z=y;z<X;++z){var x=z+s,g=V*z;O[D++]=Z[g+i],O[D++]=-x,O[D++]=Z[g+w],O[D++]=x}for(z=r;z<c;++z){x=z+E;var H=V*z;O[D++]=W[H+i],O[D++]=-x}var p=D>>>1;C(O,p);var k=0;for(z=0;z<p;++z){var o=0|O[2*z+1];if(o<0){var u=!1;if((x=-o)>=n?(u=!Y,x-=n):(u=!!Y,x-=1),u)J(F,U,k++,x);else{var N=L[x],K=V*x,l=W[K+d+1],q=W[K+d+1+h];h:for(var j=0;j<k;++j){var a=F[j],e=V*a;if(!(q<Z[e+d+1]||Z[e+d+1+h]<l)){for(var v=d+2;v<h;++v)if(W[K+v+h]<Z[e+v]||Z[e+v+h]<W[K+v])continue h;var G,b=S[a];if(void 0!==(G=Y?T(N,b):T(b,N)))return G}}}}else f(F,U,k--,o-s)}},scanComplete:function(h,d,T,Y,y,X,U,Z,S,r,c){for(var f=0,J=2*h,W=d,L=d+h,D=Y;D<y;++D){var V=D+n,i=J*D;O[f++]=X[i+W],O[f++]=-V,O[f++]=X[i+L],O[f++]=V}for(D=Z;D<S;++D){V=D+1;var w=J*D;O[f++]=r[w+W],O[f++]=-V}var s=f>>>1;C(O,s);var E=0;for(D=0;D<s;++D){var z=0|O[2*D+1];if(z<0){if((V=-z)>=n)F[E++]=V-n;else{var x=c[V-=1],g=J*V,H=r[g+d+1],p=r[g+d+1+h];h:for(var k=0;k<E;++k){var o=F[k],u=U[o];if(u===x)break;var N=J*o;if(!(p<X[N+d+1]||X[N+d+1+h]<H)){for(var K=d+2;K<h;++K)if(r[g+K+h]<X[N+K]||X[N+K+h]<r[g+K])continue h;var l=T(u,x);if(void 0!==l)return l}}}}else{for(V=z-n,k=E-1;k>=0;--k)if(F[k]===V){for(K=k+1;K<E;++K)F[K-1]=F[K];break}--E}}}};var Y=T(14818),y=T(14823),C=T(14848),n=1<<28,X=1024,F=Y.mallocInt32(X),U=Y.mallocInt32(X),Z=Y.mallocInt32(X),S=Y.mallocInt32(X),r=Y.mallocInt32(X),c=Y.mallocInt32(X),O=Y.mallocDouble(8192);function f(h,d,T,Y){var y=d[Y],C=h[T-1];h[y]=C,d[C]=y}function J(h,d,T,Y){h[T]=Y,d[Y]=T}},14829:h=>{"use strict";function d(h,T,Y){var y=0|h[Y];if(y<=0)return[];var C,n=new Array(y);if(Y===h.length-1)for(C=0;C<y;++C)n[C]=T;else for(C=0;C<y;++C)n[C]=d(h,T,Y+1);return n}h.exports=function(h,T){switch("undefined"===typeof T&&(T=0),typeof h){case"number":if(h>0)return function(h,d){var T,Y;for(T=new Array(h),Y=0;Y<h;++Y)T[Y]=d;return T}(0|h,T);break;case"object":if("number"===typeof h.length)return d(h,T,0)}return[]}},14790:(h,d,T)=>{h.exports=function(){var h=this;this.components={},this.comps=this.components;var d=this.components,T=1,y={},C=[],n=[],X={timeout:!1,removals:[],multiComps:[]};function F(h,T){var Y=d[T],C=y[T],n=C.hash[h];n&&(C.remove(h),Y.Ud&&(Y.multi?(n.forEach((d=>{d&&Y.Ud(h,d)})),n.length=0):Y.Ud(h,n)),X.removals.push(C),U())}function U(){X.timeout||(X.timeout=!0,setTimeout(Z,1))}function Z(){X.timeout=!1,S()}function S(){X.multiComps.length&&function(h){for(var d=0;d<h.length;d++){var{entID:T,data:Y}=h[d],y=Y.hash[T];if(y){for(var C=0;C<y.length;C++)y[C]||(y.splice(C,1),C--);0===y.length&&(Y.remove(T),X.removals.push(Y))}}h.length=0}(X.multiComps),X.removals.length&&function(h){for(var d=0;d<h.length;d++){h[d].flush()}h.length=0}(X.removals)}this.ES=y,this._systems=C,this._renderSystems=n,this.yU=function(d){var Y=T++;return Array.isArray(d)&&d.forEach((d=>h.IF(Y,d))),Y},this.deleteEntity=function(d){return Object.keys(y).forEach((h=>{y[h].hash[d]&&F(d,h)})),h},this.HZ=function(h){if(!h)throw new Error("Missing component definition");var T=h.name;if(!T)throw new Error("Component definition must have a name property.");if("string"!==typeof T)throw new Error("Component name must be a string.");if(""===T)throw new Error("Component name must be a non-empty string.");if(y[T])throw new Error(`Component ${T} already exists.`);var X={};return X.name=T,X.multi=!!h.multi,X.order=isNaN(h.order)?99:h.order,X.stateConstructor=h.stateConstructor||null,X.state=h.state||{},X.RX=h.RX||null,X.Ud=h.Ud||null,X.system=h.system||null,X.hF=h.hF||null,d[T]=X,y[T]=new Y,y[T]._pendingMultiCleanup=!1,y[T]._multiCleanupIDs=X.multi?[]:null,X.system&&(C.push(T),C.sort(((h,T)=>d[h].order-d[T].order))),X.hF&&(n.push(T),n.sort(((h,T)=>d[h].order-d[T].order))),T},this.overwriteComponent=function(h,T){var Y=d[h];if(!Y)throw new Error(`Unknown component: ${h}`);if(!T)throw new Error("Missing component definition");if(Y.name!==T.name)throw new Error("Overwriting component must use the same name property.");var X={};X.name=h,X.multi=!!T.multi,X.order=isNaN(T.order)?99:T.order,X.state=T.state||{},X.RX=T.RX||null,X.Ud=T.Ud||null,X.system=T.system||null,X.hF=T.hF||null,d[h]=X,y[h]._pendingMultiCleanup=!1,y[h]._multiCleanupIDs=X.multi?[]:null;var F=C.indexOf(h);X.system&&F<0&&C.push(h),!X.system&&F>=0&&C.splice(F,1),C.sort(((h,T)=>d[h].order-d[T].order));var U=n.indexOf(h);X.hF&&U<0&&n.push(h),!X.hF&&U>=0&&n.splice(U,1),n.sort(((h,T)=>d[h].order-d[T].order));var Z=X.state;return this.QU(h).forEach((h=>{for(var d in Z)d in h||(h[d]=Z[d]);X.RX&&X.RX(h.PX,h)})),h},this.deleteComponent=function(T){var Y=y[T];if(!Y)throw new Error(`Unknown component: ${T}`);Y.flush(),Y.list.forEach((h=>{h&&F(h.PX||h[0].PX,T)}));var X=C.indexOf(T),U=n.indexOf(T);return X>-1&&C.splice(X,1),U>-1&&n.splice(U,1),y[T].dispose(),delete y[T],delete d[T],h},this.IF=function(h,T,Y){var C,n=d[T],X=y[T];if(!X)throw new Error(`Unknown component: ${T}.`);if(X.hash[h]&&!n.multi)throw new Error(`Entity ${h} already has component: ${T}.`);if(n.stateConstructor){if(!(C=new n.stateConstructor).hasOwnProperty("PX"))throw new Error(`Component ${n.name} stateConstructor type does not have property __id`)}else C=Object.assign({},{PX:h},n.state,Y);if(C.PX=h,n.multi){var F=X.hash[h];F||(F=[],X.add(h,F)),F.push(C)}else X.add(h,C);return n.RX&&n.RX(h,C),this},this.XU=function(h,d){var T=y[d];if(!T)throw new Error(`Unknown component: ${d}.`);return!!T.hash[h]},this.hU=function(d,T){if(!y[T])throw new Error(`Unknown component: ${T}.`);return F(d,T),h},this.getState=function(h,d){var T=y[d];if(!T)throw new Error(`Unknown component: ${d}.`);return T.hash[h]},this.QU=function(h){var d=y[h];if(!d)throw new Error(`Unknown component: ${h}.`);return S(),d.list},this.bc=function(h){if(!y[h])throw new Error(`Unknown component: ${h}.`);var d=y[h].hash;return h=>d[h]},this.dO=function(h){if(!y[h])throw new Error(`Unknown component: ${h}.`);var d=y[h].hash;return h=>!!d[h]},this.qX=function(T){S();for(var Y=0;Y<C.length;Y++){var n=C[Y],X=d[n],F=y[n];X.system(T,F.list),S()}return h},this.render=function(T){S();for(var Y=0;Y<n.length;Y++){var C=n[Y],X=d[C],F=y[C];X.hF(T,F.list),S()}return h},this.removeMultiComponent=function(T,Y,C){var n=d[Y],F=y[Y];if(!F)throw new Error(`Unknown component: ${Y}.`);if(!n.multi)throw new Error("removeMultiComponent called on non-multi component");return function(h,d,T,Y){var y=T.hash[h];if(y){var C=y[Y];C&&(y[Y]=null,d.Ud&&d.Ud(h,C),X.multiComps.push({entID:h,data:T}),U())}}(T,n,F,C),h}};var Y=T(14792)},14792:h=>{function d(h,d){var T=h._map[d];if(delete h.hash[d],delete h._map[d],T===h.list.length-1)h.list.pop();else{var Y=h.list.pop();if(h.list[T]=Y,null===Y||null===Y[0]){var y=h.list.length;for(var C in h._map)if(h._map[C]===y)return void(h._map[C]=T)}else{var n=Y.PX||Y[0].PX;h._map[n]=T}}}h.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(h,d){if("number"===typeof this._map[h]){var T=this._map[h];this.hash[h]=d,this.list[T]=d}else this._map[h]=this.list.length,this.hash[h]=d,this.list.push(d)}remove(h){var d=this._map[h];this.hash[h]=null,this.list[d]=null,this._pendingRemovals.push(h)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var h=0;h<this._pendingRemovals.length;h++){var T=this._pendingRemovals[h];null===this.hash[T]&&d(this,T)}this._pendingRemovals.length=0}}},14751:h=>{"use strict";var d,T="object"===typeof Reflect?Reflect:null,Y=function(h,d,T){return Function.prototype.apply.call(h,d,T)};d=T&&"function"===typeof T.ownKeys?T.ownKeys:Object.getOwnPropertySymbols?function(h){return Object.getOwnPropertyNames(h).concat(Object.getOwnPropertySymbols(h))}:function(h){return Object.getOwnPropertyNames(h)};var y=Number.isNaN||function(h){return h!==h};function C(){C.init.call(this)}h.exports=C,h.exports.once=function(h,d){return new Promise((function(T,Y){function y(T){h.removeListener(d,C),Y(T)}function C(){"function"===typeof h.removeListener&&h.removeListener("error",y),T([].slice.call(arguments))}f(h,d,C,{once:!0}),"error"!==d&&function(h,d,T){"function"===typeof h.on&&f(h,"error",d,T)}(h,y,{once:!0})}))},C.EventEmitter=C,C.prototype._events=void 0,C.prototype._eventsCount=0,C.prototype._maxListeners=void 0;var n=10;function X(h){if("function"!==typeof h)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof h)}function F(h){return void 0===h._maxListeners?C.defaultMaxListeners:h._maxListeners}function U(h,d,T,Y){var y,C,n,U;if(X(T),void 0===(C=h._events)?(C=h._events=Object.create(null),h._eventsCount=0):(void 0!==C.newListener&&(h.emit("newListener",d,T.listener?T.listener:T),C=h._events),n=C[d]),void 0===n)n=C[d]=T,++h._eventsCount;else if("function"===typeof n?n=C[d]=Y?[T,n]:[n,T]:Y?n.unshift(T):n.push(T),(y=F(h))>0&&n.length>y&&!n.warned){n.warned=!0;var Z=new Error("Possible EventEmitter memory leak detected. "+n.length+" "+String(d)+" listeners added. Use emitter.setMaxListeners() to increase limit");Z.name="MaxListenersExceededWarning",Z.nd=h,Z.type=d,Z.count=n.length,U=Z,console&&console.warn&&console.warn(U)}return h}function Z(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function S(h,d,T){var Y={fired:!1,wrapFn:void 0,target:h,type:d,listener:T},y=Z.bind(Y);return y.listener=T,Y.wrapFn=y,y}function r(h,d,T){var Y=h._events;if(void 0===Y)return[];var y=Y[d];return void 0===y?[]:"function"===typeof y?T?[y.listener||y]:[y]:T?function(h){for(var d=new Array(h.length),T=0;T<d.length;++T)d[T]=h[T].listener||h[T];return d}(y):O(y,y.length)}function c(h){var d=this._events;if(void 0!==d){var T=d[h];if("function"===typeof T)return 1;if(void 0!==T)return T.length}return 0}function O(h,d){for(var T=new Array(d),Y=0;Y<d;++Y)T[Y]=h[Y];return T}function f(h,d,T,Y){if("function"===typeof h.on)Y.once?h.once(d,T):h.on(d,T);else{if("function"!==typeof h.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof h);h.addEventListener(d,(function y(C){Y.once&&h.removeEventListener(d,y),T(C)}))}}Object.defineProperty(C,"defaultMaxListeners",{enumerable:!0,get:function(){return n},set:function(h){if("number"!==typeof h||h<0||y(h))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+h+".");n=h}}),C.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},C.prototype.setMaxListeners=function(h){if("number"!==typeof h||h<0||y(h))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+h+".");return this._maxListeners=h,this},C.prototype.getMaxListeners=function(){return F(this)},C.prototype.emit=function(h){for(var d=[],T=1;T<arguments.length;T++)d.push(arguments[T]);var y="error"===h,C=this._events;if(void 0!==C)y=y&&void 0===C.error;else if(!y)return!1;if(y){var n;if(d.length>0&&(n=d[0]),n instanceof Error)throw n;var X=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw X.context=n,X}var F=C[h];if(void 0===F)return!1;if("function"===typeof F)Y(F,this,d);else{var U=F.length,Z=O(F,U);for(T=0;T<U;++T)Y(Z[T],this,d)}return!0},C.prototype.addListener=function(h,d){return U(this,h,d,!1)},C.prototype.on=C.prototype.addListener,C.prototype.prependListener=function(h,d){return U(this,h,d,!0)},C.prototype.once=function(h,d){return X(d),this.on(h,S(this,h,d)),this},C.prototype.prependOnceListener=function(h,d){return X(d),this.prependListener(h,S(this,h,d)),this},C.prototype.removeListener=function(h,d){var T,Y,y,C,n;if(X(d),void 0===(Y=this._events))return this;if(void 0===(T=Y[h]))return this;if(T===d||T.listener===d)0===--this._eventsCount?this._events=Object.create(null):(delete Y[h],Y.removeListener&&this.emit("removeListener",h,T.listener||d));else if("function"!==typeof T){for(y=-1,C=T.length-1;C>=0;C--)if(T[C]===d||T[C].listener===d){n=T[C].listener,y=C;break}if(y<0)return this;0===y?T.shift():function(h,d){for(;d+1<h.length;d++)h[d]=h[d+1];h.pop()}(T,y),1===T.length&&(Y[h]=T[0]),void 0!==Y.removeListener&&this.emit("removeListener",h,n||d)}return this},C.prototype.off=C.prototype.removeListener,C.prototype.Xd=function(h){var d,T,Y;if(void 0===(T=this._events))return this;if(void 0===T.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==T[h]&&(0===--this._eventsCount?this._events=Object.create(null):delete T[h]),this;if(0===arguments.length){var y,C=Object.keys(T);for(Y=0;Y<C.length;++Y)"removeListener"!==(y=C[Y])&&this.Xd(y);return this.Xd("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(d=T[h]))this.removeListener(h,d);else if(void 0!==d)for(Y=d.length-1;Y>=0;Y--)this.removeListener(h,d[Y]);return this},C.prototype.listeners=function(h){return r(this,h,!0)},C.prototype.rawListeners=function(h){return r(this,h,!1)},C.listenerCount=function(h,d){return"function"===typeof h.listenerCount?h.listenerCount(d):c.call(h,d)},C.prototype.listenerCount=c,C.prototype.eventNames=function(){return this._eventsCount>0?d(this._events):[]}},15048:h=>{"use strict";h.exports=function(h,d,T,Y,y,C){var n=+d[0],X=+d[1],F=+d[2],U=+T[0],Z=+T[1],S=+T[2],r=Math.sqrt(U*U+Z*Z+S*S);if(0===r)throw new Error("Can't raycast along a zero vector");return function(h,d,T,Y,y,C,n,X,F,U){for(var Z=0,S=Math.floor,r=0|S(d),c=0|S(T),O=0|S(Y),f=y>0?1:-1,J=C>0?1:-1,W=n>0?1:-1,L=Math.abs(1/y),D=Math.abs(1/C),V=Math.abs(1/n),i=L<1/0?L*(f>0?r+1-d:d-r):1/0,w=D<1/0?D*(J>0?c+1-T:T-c):1/0,s=V<1/0?V*(W>0?O+1-Y:Y-O):1/0,E=-1;Z<=X;){var z=h(r,c,O);if(z)return F&&(F[0]=d+Z*y,F[1]=T+Z*C,F[2]=Y+Z*n),U&&(U[0]=U[1]=U[2]=0,0===E&&(U[0]=-f),1===E&&(U[1]=-J),2===E&&(U[2]=-W)),z;i<w?i<s?(r+=f,Z=i,i+=L,E=0):(O+=W,Z=s,s+=V,E=2):w<s?(c+=J,Z=w,w+=D,E=1):(O+=W,Z=s,s+=V,E=2)}return F&&(F[0]=d+Z*y,F[1]=T+Z*C,F[2]=Y+Z*n),U&&(U[0]=U[1]=U[2]=0),0}(h,n,X,F,U/=r,Z/=r,S/=r,Y="undefined"===typeof Y?64:+Y,y,C)}},15075:(h,d,T)=>{"use strict";T.d(d,{e:()=>C});var Y=T(14751);function y(){this.cr=!1,this.stopPropagation=!1,this.Or=!1,this.disabled=!1}class C{constructor(h,d){this.version="0.7.0";var T=Object.assign({},new y,d||{});this.element=h||document,this.cr=!!T.cr,this.stopPropagation=!!T.stopPropagation,this.Or=!!T.Or,this.disabled=!!T.disabled,this.filterEvents=(h,d)=>!0,this.down=new Y.EventEmitter,this.up=new Y.EventEmitter,this.state={},this.GU={dx:0,dy:0,Jc:0,vU:0,Dc:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?X(this):document.addEventListener("DOMContentLoaded",(h=>{X(this)}),{once:!0})}bind(h){for(var d=arguments.length,T=new Array(d>1?d-1:0),Y=1;Y<d;Y++)T[Y-1]=arguments[Y];T.forEach((d=>{var T=this._keyBindmap[d]||[];T.includes(h)||(T.push(h),this._keyBindmap[d]=T)})),this.state[h]=!!this.state[h],this.pressCount[h]=this.pressCount[h]||0,this.releaseCount[h]=this.releaseCount[h]||0}unbind(h){for(var d in this._keyBindmap){var T=this._keyBindmap[d],Y=T.indexOf(h);Y>-1&&T.splice(Y,1)}}getBindings(){var h={};for(var d in this._keyBindmap){this._keyBindmap[d].forEach((T=>{h[T]=h[T]||[],h[T].push(d)}))}return h}qX(){n(this.GU),n(this.pressCount),n(this.releaseCount)}}function n(h){for(var d in h)h[d]=0}function X(h){window.addEventListener("keydown",O.bind(null,h,!0),!1),window.addEventListener("keyup",O.bind(null,h,!1),!1);var d={passive:!0};h.element.addEventListener("touchstart",S.bind(void 0,h),{passive:!1}),h.element.addEventListener("touchend",c.bind(void 0,h),d),h.element.addEventListener("mousedown",f.bind(null,h,!0),d),window.document.addEventListener("mouseup",f.bind(null,h,!1),d),h.element.addEventListener("touchmove",J.bind(null,h),d),h.element.addEventListener("mousemove",J.bind(null,h),d),window.PointerEvent,h.element.addEventListener("wheel",W.bind(null,h),d),h.element.addEventListener("contextmenu",L.bind(null,h),!1),window.addEventListener("blur",D.bind(null,h),!1)}var F=0,U=0,Z=null;function S(h,d){d.preventDefault(),r(d)}function r(h){let d=!1;for(let T=0;T<h.touches.length;++T)if(h.touches[T].identifier===Z){d=!0;break}if(!d){const d=h.changedTouches[0];F=d.clientX,U=d.clientY,Z=d.identifier}}function c(h,d){for(var T=d.changedTouches,Y=0;Y<T.length;++Y)T[Y].identifier===Z&&(Z=null)}function O(h,d,T){V(T.code,d,h,T)}function f(h,d,T){if("pointerId"in T)if(d){if(null!==h._touches.currID)return;h._touches.currID=T.pointerId}else{if(h._touches.currID!==T.pointerId)return;h._touches.currID=null}return V("Mouse"+("button"in T?T.button+1:1),d,h,T),!1}function J(h,d){var T=d.movementX||d.mozMovementX||0,Y=d.movementY||d.mozMovementY||0;if(d.touches&&0===(T|Y)){var y=function(h){r(h);for(let d=0;d<h.changedTouches.length;++d)if(h.changedTouches[d].identifier==Z){const T=h.changedTouches[d],Y=[T.clientX-F,T.clientY-U];return F=T.clientX,U=T.clientY,Y}return console.error(`Did not find touch id ${Z}`),[0,0]}(d);T=y[0],Y=y[1]}h.GU.dx+=T,h.GU.dy+=Y}function W(h,d){var T=1;switch(d.deltaMode){case 0:T=1;break;case 1:T=12;break;case 2:T=h.element.clientHeight||window.innerHeight}h.GU.Jc+=(d.deltaX||0)*T,h.GU.vU+=(d.deltaY||0)*T,h.GU.Dc+=(d.deltaZ||0)*T}function L(h,d){if(!h.Or)return d.preventDefault(),!1}function D(h){for(var d in h._keyStates)h._keyStates[d]&&(/^Mouse\d/.test(d)||V(d,!1,h,{code:d,note:"asguews8a98",preventDefault:()=>{},stopPropagation:()=>{}}))}function V(h,d,T,Y){var y=T._keyBindmap[h];y&&(i(T._keyStates[h],d)&&(T._keyStates[h]=d,y.forEach((h=>{(!T.filterEvents||T.filterEvents(Y,h))&&function(h,d,T,Y){var y=d?T.pressCount:T.releaseCount;y[h]=(y[h]||0)+1;var C=T._bindPressCount[h]||0;(C+=d?1:-1)<0&&(C=0);T._bindPressCount[h]=C;var n=T.state[h];if(i(n,C)){T.state[h]=C>0;var X=d?T.down:T.up;T.disabled||X.emit(h,Y)}}(h,d,T,Y)}))),"button"in Y||(T.cr&&!Y.defaultPrevented&&Y.preventDefault(),T.stopPropagation&&Y.stopPropagation()))}function i(h,d){return h?!d:d}},13676:h=>{h.exports=function(h,d,T){return h[0]=d[0]+T[0],h[1]=d[1]+T[1],h[2]=d[2]+T[2],h}},13621:(h,d,T)=>{h.exports=function(h,d){var T=Y(h[0],h[1],h[2]),n=Y(d[0],d[1],d[2]);y(T,T),y(n,n);var X=C(T,n);return X>1?0:Math.acos(X)};var Y=T(13629),y=T(13635),C=T(13644)},13734:h=>{h.exports=function(h,d){return h[0]=Math.ceil(d[0]),h[1]=Math.ceil(d[1]),h[2]=Math.ceil(d[2]),h}},13613:h=>{h.exports=function(h){var d=new Float32Array(3);return d[0]=h[0],d[1]=h[1],d[2]=h[2],d}},13651:h=>{h.exports=function(h,d){return h[0]=d[0],h[1]=d[1],h[2]=d[2],h}},13606:h=>{h.exports=function(){var h=new Float32Array(3);return h[0]=0,h[1]=0,h[2]=0,h}},13805:h=>{h.exports=function(h,d,T){var Y=d[0],y=d[1],C=d[2],n=T[0],X=T[1],F=T[2];return h[0]=y*F-C*X,h[1]=C*n-Y*F,h[2]=Y*X-y*n,h}},13763:(h,d,T)=>{h.exports=T(13755)},13755:h=>{h.exports=function(h,d){var T=d[0]-h[0],Y=d[1]-h[1],y=d[2]-h[2];return Math.sqrt(T*T+Y*Y+y*y)}},13711:(h,d,T)=>{h.exports=T(13705)},13705:h=>{h.exports=function(h,d,T){return h[0]=d[0]/T[0],h[1]=d[1]/T[1],h[2]=d[2]/T[2],h}},13644:h=>{h.exports=function(h,d){return h[0]*d[0]+h[1]*d[1]+h[2]*d[2]}},13599:h=>{h.exports=1e-6},13662:(h,d,T)=>{h.exports=function(h,d){var T=h[0],y=h[1],C=h[2],n=d[0],X=d[1],F=d[2];return Math.abs(T-n)<=Y*Math.max(1,Math.abs(T),Math.abs(n))&&Math.abs(y-X)<=Y*Math.max(1,Math.abs(y),Math.abs(X))&&Math.abs(C-F)<=Y*Math.max(1,Math.abs(C),Math.abs(F))};var Y=T(13599)},13669:h=>{h.exports=function(h,d){return h[0]===d[0]&&h[1]===d[1]&&h[2]===d[2]}},13731:h=>{h.exports=function(h,d){return h[0]=Math.floor(d[0]),h[1]=Math.floor(d[1]),h[2]=Math.floor(d[2]),h}},13857:(h,d,T)=>{h.exports=function(h,d,T,y,C,n){var X,F;d||(d=3);T||(T=0);F=y?Math.min(y*d+T,h.length):h.length;for(X=T;X<F;X+=d)Y[0]=h[X],Y[1]=h[X+1],Y[2]=h[X+2],C(Y,Y,n),h[X]=Y[0],h[X+1]=Y[1],h[X+2]=Y[2];return h};var Y=T(13606)()},13629:h=>{h.exports=function(h,d,T){var Y=new Float32Array(3);return Y[0]=h,Y[1]=d,Y[2]=T,Y}},13593:(h,d,T)=>{h.exports={EPSILON:T(13599),create:T(13606),clone:T(13613),angle:T(13621),gX:T(13629),j:T(13651),set:T(13658),equals:T(13662),exactEquals:T(13669),add:T(13676),Nd:T(13680),sub:T(13688),multiply:T(13690),mul:T(13699),divide:T(13705),div:T(13711),min:T(13720),max:T(13726),floor:T(13731),ceil:T(13734),round:T(13738),scale:T(13744),HX:T(13750),distance:T(13755),i:T(13763),squaredDistance:T(13765),sqrDist:T(13772),length:T(13779),len:T(13782),squaredLength:T(13786),pX:T(13790),negate:T(13798),inverse:T(13800),normalize:T(13635),dot:T(13644),cross:T(13805),LX:T(13810),random:T(13816),transformMat4:T(13824),transformMat3:T(13830),transformQuat:T(13832),kX:T(13839),oX:T(13847),uX:T(13853),forEach:T(13857)}},13800:h=>{h.exports=function(h,d){return h[0]=1/d[0],h[1]=1/d[1],h[2]=1/d[2],h}},13782:(h,d,T)=>{h.exports=T(13779)},13779:h=>{h.exports=function(h){var d=h[0],T=h[1],Y=h[2];return Math.sqrt(d*d+T*T+Y*Y)}},13810:h=>{h.exports=function(h,d,T,Y){var y=d[0],C=d[1],n=d[2];return h[0]=y+Y*(T[0]-y),h[1]=C+Y*(T[1]-C),h[2]=n+Y*(T[2]-n),h}},13726:h=>{h.exports=function(h,d,T){return h[0]=Math.max(d[0],T[0]),h[1]=Math.max(d[1],T[1]),h[2]=Math.max(d[2],T[2]),h}},13720:h=>{h.exports=function(h,d,T){return h[0]=Math.min(d[0],T[0]),h[1]=Math.min(d[1],T[1]),h[2]=Math.min(d[2],T[2]),h}},13699:(h,d,T)=>{h.exports=T(13690)},13690:h=>{h.exports=function(h,d,T){return h[0]=d[0]*T[0],h[1]=d[1]*T[1],h[2]=d[2]*T[2],h}},13798:h=>{h.exports=function(h,d){return h[0]=-d[0],h[1]=-d[1],h[2]=-d[2],h}},13635:h=>{h.exports=function(h,d){var T=d[0],Y=d[1],y=d[2],C=T*T+Y*Y+y*y;C>0&&(C=1/Math.sqrt(C),h[0]=d[0]*C,h[1]=d[1]*C,h[2]=d[2]*C);return h}},13816:h=>{h.exports=function(h,d){d=d||1;var T=2*Math.random()*Math.PI,Y=2*Math.random()-1,y=Math.sqrt(1-Y*Y)*d;return h[0]=Math.cos(T)*y,h[1]=Math.sin(T)*y,h[2]=Y*d,h}},13839:h=>{h.exports=function(h,d,T,Y){var y=T[1],C=T[2],n=d[1]-y,X=d[2]-C,F=Math.sin(Y),U=Math.cos(Y);return h[0]=d[0],h[1]=y+n*U-X*F,h[2]=C+n*F+X*U,h}},13847:h=>{h.exports=function(h,d,T,Y){var y=T[0],C=T[2],n=d[0]-y,X=d[2]-C,F=Math.sin(Y),U=Math.cos(Y);return h[0]=y+X*F+n*U,h[1]=d[1],h[2]=C+X*U-n*F,h}},13853:h=>{h.exports=function(h,d,T,Y){var y=T[0],C=T[1],n=d[0]-y,X=d[1]-C,F=Math.sin(Y),U=Math.cos(Y);return h[0]=y+n*U-X*F,h[1]=C+n*F+X*U,h[2]=d[2],h}},13738:h=>{h.exports=function(h,d){return h[0]=Math.round(d[0]),h[1]=Math.round(d[1]),h[2]=Math.round(d[2]),h}},13744:h=>{h.exports=function(h,d,T){return h[0]=d[0]*T,h[1]=d[1]*T,h[2]=d[2]*T,h}},13750:h=>{h.exports=function(h,d,T,Y){return h[0]=d[0]+T[0]*Y,h[1]=d[1]+T[1]*Y,h[2]=d[2]+T[2]*Y,h}},13658:h=>{h.exports=function(h,d,T,Y){return h[0]=d,h[1]=T,h[2]=Y,h}},13772:(h,d,T)=>{h.exports=T(13765)},13790:(h,d,T)=>{h.exports=T(13786)},13765:h=>{h.exports=function(h,d){var T=d[0]-h[0],Y=d[1]-h[1],y=d[2]-h[2];return T*T+Y*Y+y*y}},13786:h=>{h.exports=function(h){var d=h[0],T=h[1],Y=h[2];return d*d+T*T+Y*Y}},13688:(h,d,T)=>{h.exports=T(13680)},13680:h=>{h.exports=function(h,d,T){return h[0]=d[0]-T[0],h[1]=d[1]-T[1],h[2]=d[2]-T[2],h}},13830:h=>{h.exports=function(h,d,T){var Y=d[0],y=d[1],C=d[2];return h[0]=Y*T[0]+y*T[3]+C*T[6],h[1]=Y*T[1]+y*T[4]+C*T[7],h[2]=Y*T[2]+y*T[5]+C*T[8],h}},13824:h=>{h.exports=function(h,d,T){var Y=d[0],y=d[1],C=d[2],n=T[3]*Y+T[7]*y+T[11]*C+T[15];return n=n||1,h[0]=(T[0]*Y+T[4]*y+T[8]*C+T[12])/n,h[1]=(T[1]*Y+T[5]*y+T[9]*C+T[13])/n,h[2]=(T[2]*Y+T[6]*y+T[10]*C+T[14])/n,h}},13832:h=>{h.exports=function(h,d,T){var Y=d[0],y=d[1],C=d[2],n=T[0],X=T[1],F=T[2],U=T[3],Z=U*Y+X*C-F*y,S=U*y+F*Y-n*C,r=U*C+n*y-X*Y,c=-n*Y-X*y-F*C;return h[0]=Z*U+c*-n+S*-F-r*-X,h[1]=S*U+c*-X+r*-n-Z*-F,h[2]=r*U+c*-F+Z*-X-S*-n,h}},14775:h=>{"use strict";h.exports=function(h){for(var d=new Array(h),T=0;T<h;++T)d[T]=T;return d}},14838:h=>{h.exports=function(h){return null!=h&&null!=h.constructor&&"function"===typeof h.constructor.isBuffer&&h.constructor.isBuffer(h)}},15053:(h,d,T)=>{"use strict";T.d(d,{c:()=>Y});class Y{constructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.IZ=!1,this.AZ=!1,this.RZ=30,this.QZ=0,this.CS=!1,this.fullscreen=!1,this.tZ=function(h){},this.hS=function(){},this.YS=function(){},this.Sd=function(){},this.dS=function(h){},this.onFullscreenChanged=function(h){},U((()=>{!function(h,d){h._nowObject=performance||Date,h._lastTick=0,h._renderAccum=0,h._rt=0,h._frameCB=X.bind(null,h),requestAnimationFrame(h._frameCB),d>0&&(h._intervalCB=n.bind(null,h),h._interval=setInterval(h._intervalCB,Math.max(d,1e3/h.RZ/2)))}(this,d),function(h,d){if(!d)return;var T=!1,Y=!1;document.addEventListener("pointerlockchange",(Y=>{T=document.pointerLockElement===d,h.dS(T)})),document.addEventListener("fullscreenchange",(T=>{Y=document.fullscreenElement===d,h.onFullscreenChanged(Y)})),Object.defineProperty(h,"CS",{get:()=>T,set:h=>{h&&!T?F(d):T&&!h&&function(h){h.exitPointerLock&&h.exitPointerLock()}(document)}}),Object.defineProperty(h,"fullscreen",{get:()=>Y,set:h=>{h&&!Y?d.requestFullscreen():Y&&!h&&document.exitFullscreen()}}),d.addEventListener("click",(y=>{h.IZ&&!T&&F(d),h.AZ&&!Y&&d.requestFullscreen()}));var y=()=>h.Sd();if(window.ResizeObserver){new ResizeObserver(y).observe(d)}else window.addEventListener("resize",y)}(this,h),this.YS()}))}}var y=3,C=20;function n(h){for(var d=1e3/h.RZ,T=h._nowObject.now()+C,Y=0;h._nowObject.now()>=h._lastTick+d&&h._nowObject.now()<T&&++Y<=y;)h.tZ(d),h._lastTick+=d;var n=5*(d+5),X=h._nowObject.now();if(X-h._lastTick>n)for(;X>=h._lastTick+d;)h._lastTick+=d}function X(h){requestAnimationFrame(h._frameCB),n(h);var d=h._nowObject.now(),T=d-h._rt;if(h._rt=d,h.QZ>0){h._renderAccum+=T;var Y=1e3/h.QZ;if(h._renderAccum<Y)return;h._renderAccum=Math.min(h._renderAccum-Y,Y)}var y=1e3/h.RZ,C=(d-h._lastTick)/y;h.hS(T,C,y)}function F(h){h.requestPointerLock&&h.requestPointerLock()}var U=h=>{if("loading"===document.readyState){var d=()=>{document.removeEventListener("readystatechange",d),h()};document.addEventListener("readystatechange",d)}else setTimeout(h,1)}},14767:(h,d,T)=>{var Y=T(14775),y=T(14779),C="undefined"!==typeof Float64Array;function n(h,d){return h[0]-d[0]}function X(){var h,d=this.stride,T=new Array(d.length);for(h=0;h<T.length;++h)T[h]=[Math.abs(d[h]),h];T.sort(n);var Y=new Array(T.length);for(h=0;h<Y.length;++h)Y[h]=T[h][1];return Y}function F(h,d){var T=["View",d,"d",h].join("");d<0&&(T="View_Nil"+h);var y="generic"===h;if(-1===d){var C="function "+T+"(a){this.data=a;};var proto="+T+".prototype;proto.dtype='"+h+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+T+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+T+"(a){return new "+T+"(a);}";return new Function(C)()}if(0===d){C="function "+T+"(a,d) {this.data = a;this.offset = d};var proto="+T+".prototype;proto.dtype='"+h+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+T+"_copy() {return new "+T+"(this.data,this.offset)};proto.pick=function "+T+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+T+"_get(){return "+(y?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+T+"_set(v){return "+(y?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+T+"(a,b,c,d){return new "+T+"(a,d)}";return new Function("TrivialArray",C)(U[h][0])}C=["'use strict'"];var n=Y(d),F=n.map((function(h){return"i"+h})),Z="this.offset+"+n.map((function(h){return"this.stride["+h+"]*i"+h})).join("+"),S=n.map((function(h){return"b"+h})).join(","),r=n.map((function(h){return"c"+h})).join(",");C.push("function "+T+"(a,"+S+","+r+",d){this.data=a","this.shape=["+S+"]","this.stride=["+r+"]","this.offset=d|0}","var proto="+T+".prototype","proto.dtype='"+h+"'","proto.dimension="+d),C.push("Object.defineProperty(proto,'size',{get:function "+T+"_size(){return "+n.map((function(h){return"this.shape["+h+"]"})).join("*"),"}})"),1===d?C.push("proto.order=[0]"):(C.push("Object.defineProperty(proto,'order',{get:"),d<4?(C.push("function "+T+"_order(){"),2===d?C.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===d&&C.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):C.push("ORDER})")),C.push("proto.set=function "+T+"_set("+F.join(",")+",v){"),y?C.push("return this.data.set("+Z+",v)}"):C.push("return this.data["+Z+"]=v}"),C.push("proto.get=function "+T+"_get("+F.join(",")+"){"),y?C.push("return this.data.get("+Z+")}"):C.push("return this.data["+Z+"]}"),C.push("proto.index=function "+T+"_index(",F.join(),"){return "+Z+"}"),C.push("proto.hi=function "+T+"_hi("+F.join(",")+"){return new "+T+"(this.data,"+n.map((function(h){return["(typeof i",h,"!=='number'||i",h,"<0)?this.shape[",h,"]:i",h,"|0"].join("")})).join(",")+","+n.map((function(h){return"this.stride["+h+"]"})).join(",")+",this.offset)}");var c=n.map((function(h){return"a"+h+"=this.shape["+h+"]"})),O=n.map((function(h){return"c"+h+"=this.stride["+h+"]"}));C.push("proto.lo=function "+T+"_lo("+F.join(",")+"){var b=this.offset,d=0,"+c.join(",")+","+O.join(","));for(var f=0;f<d;++f)C.push("if(typeof i"+f+"==='number'&&i"+f+">=0){d=i"+f+"|0;b+=c"+f+"*d;a"+f+"-=d}");C.push("return new "+T+"(this.data,"+n.map((function(h){return"a"+h})).join(",")+","+n.map((function(h){return"c"+h})).join(",")+",b)}"),C.push("proto.step=function "+T+"_step("+F.join(",")+"){var "+n.map((function(h){return"a"+h+"=this.shape["+h+"]"})).join(",")+","+n.map((function(h){return"b"+h+"=this.stride["+h+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(f=0;f<d;++f)C.push("if(typeof i"+f+"==='number'){d=i"+f+"|0;if(d<0){c+=b"+f+"*(a"+f+"-1);a"+f+"=ceil(-a"+f+"/d)}else{a"+f+"=ceil(a"+f+"/d)}b"+f+"*=d}");C.push("return new "+T+"(this.data,"+n.map((function(h){return"a"+h})).join(",")+","+n.map((function(h){return"b"+h})).join(",")+",c)}");var J=new Array(d),W=new Array(d);for(f=0;f<d;++f)J[f]="a[i"+f+"]",W[f]="b[i"+f+"]";C.push("proto.transpose=function "+T+"_transpose("+F+"){"+F.map((function(h,d){return h+"=("+h+"===undefined?"+d+":"+h+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+T+"(this.data,"+J.join(",")+","+W.join(",")+",this.offset)}"),C.push("proto.pick=function "+T+"_pick("+F+"){var a=[],b=[],c=this.offset");for(f=0;f<d;++f)C.push("if(typeof i"+f+"==='number'&&i"+f+">=0){c=(c+this.stride["+f+"]*i"+f+")|0}else{a.push(this.shape["+f+"]);b.push(this.stride["+f+"])}");return C.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),C.push("return function construct_"+T+"(data,shape,stride,offset){return new "+T+"(data,"+n.map((function(h){return"shape["+h+"]"})).join(",")+","+n.map((function(h){return"stride["+h+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",C.join("\n"))(U[h],X)}var U={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};h.exports=function(h,d,T,Y){if(void 0===h)return(0,U.array[0])([]);"number"===typeof h&&(h=[h]),void 0===d&&(d=[h.length]);var n=d.length;if(void 0===T){T=new Array(n);for(var X=n-1,Z=1;X>=0;--X)T[X]=Z,Z*=d[X]}if(void 0===Y){Y=0;for(X=0;X<n;++X)T[X]<0&&(Y-=(d[X]-1)*T[X])}for(var S=function(h){if(y(h))return"buffer";if(C)switch(Object.prototype.toString.call(h)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(h)?"array":"generic"}(h),r=U[S];r.length<=n+1;)r.push(F(S,r.length-1));return(0,r[n+1])(h,d,T,Y)}},14779:h=>{function d(h){return!!h.constructor&&"function"===typeof h.constructor.isBuffer&&h.constructor.isBuffer(h)}h.exports=function(h){return null!=h&&(d(h)||function(h){return"function"===typeof h.readFloatLE&&"function"===typeof h.slice&&d(h.slice(0,0))}(h)||!!h._isBuffer)}},14911:h=>{"use strict";var d=[],T=[],Y=[],y=[],C=[],n=[],X=[],F=[],U=[],Z=[],S=[],r=[];h.exports=function(h,c,O,f,J,W){for(var L=X,D=U,V=Z,i=r,w=0;w<3;w++)L[w]=+O[w],V[w]=+c.max[w],D[w]=+c.base[w];W||(W=1e-10);var s=function(h,X,U,Z,r,c){var O=d,f=T,J=Y,W=y,L=C,D=n,V=F,i=Math.floor,w=0,s=0,E=0,z=0,x=0;if(g(),0===E)return 0;for(z=k();s<=E;){if(H(z)&&p())return w;z=k()}for(w+=E,x=0;x<3;x++)Z[x]+=U[x],r[x]+=U[x];return w;function g(){if(s=0,0!==(E=Math.sqrt(U[0]*U[0]+U[1]*U[1]+U[2]*U[2])))for(var h=0;h<3;h++){var d=U[h]>=0;W[h]=d?1:-1;var T=d?r[h]:Z[h];O[h]=d?Z[h]:r[h],f[h]=o(T,W[h]),J[h]=u(O[h],W[h]),V[h]=U[h]/E,L[h]=Math.abs(1/V[h]);var Y=d?f[h]+1-T:T-f[h];D[h]=L[h]<1/0?L[h]*Y:1/0}}function H(d){for(var T=W[0],Y=0===d?f[0]:J[0],y=f[0]+T,C=W[1],n=1===d?f[1]:J[1],X=f[1]+C,F=W[2],U=2===d?f[2]:J[2],Z=f[2]+F,S=Y;S!=y;S+=T)for(var r=n;r!=X;r+=C)for(var c=U;c!=Z;c+=F)if(h(S,r,c))return!0;return!1}function p(){w+=s;var h=W[z],d=s/E,T=S;for(x=0;x<3;x++){var Y=U[x]*d;Z[x]+=Y,r[x]+=Y,T[x]=U[x]-Y}if(h>0?r[z]=Math.round(r[z]):Z[z]=Math.round(Z[z]),X(w,z,h,T))return!0;for(x=0;x<3;x++)U[x]=T[x];return g(),0===E}function k(){var h=D[0]<D[1]?D[0]<D[2]?0:2:D[1]<D[2]?1:2,d=D[h]-s;for(s=D[h],f[h]+=W[h],D[h]+=L[h],x=0;x<3;x++)O[x]+=d*V[x],J[x]=u(O[x],W[x]);return h}function o(h,d){return i(h-d*c)}function u(h,d){return i(h+d*c)}}(h,f,L,D,V,W);if(!J){for(w=0;w<3;w++)i[w]=O[w]>0?V[w]-c.max[w]:D[w]-c.base[w];c.translate(i)}return s}},15078:(h,d,T)=>{"use strict";T.d(d,{c:()=>S});var Y=T(14909),y=T(13593);class C{constructor(h,d,T,C,n,X,F){this.RU=new Y(h.base,h.SZ),this.Fy=d,this.friction=T,this.restitution=C,this.SX=n,this.UO=X,this.rX=!!F,this.ZZ=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.IO=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.wU=y.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=y.create(),this._impulses=y.create(),this._sleepFrameCount=10}loadFromCopy(h){y.j(this.RU.base,h.RU.base),y.j(this.RU.SZ,h.RU.SZ),y.j(this.RU.max,h.RU.max),this.RU.mag=h.RU.mag,this.Fy=h.Fy,this.friction=h.friction,this.restitution=h.restitution,this.SX=h.SX,this.UO=h.UO,this.rX=h.rX,this.ZZ=h.ZZ,this.fluidDrag=h.fluidDrag,this.IO=h.IO,this.preventFallOffEdge=h.preventFallOffEdge,this.rolledBackLastTick=h.rolledBackLastTick,y.j(this.wU,h.wU),y.j(this.resting,h.resting),this.inFluid=h.inFluid,this._ratioInFluid=h._ratioInFluid,y.j(this._forces,h._forces),y.j(this._impulses,h._impulses),this._sleepFrameCount=h._sleepFrameCount}setPosition(h){n(h),y.Nd(h,h,this.RU.base),this.RU.translate(h),this.zU()}rd(){return y.clone(this.RU.base)}applyForce(h){n(h),y.add(this._forces,this._forces,h),this.zU()}applyImpulse(h){n(h),y.add(this._impulses,this._impulses,h),this.zU()}zU(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var n=h=>{};var X=T(14909),F=T(13593),U=T(14911);function Z(){this.ZZ=.1,this.fluidDrag=.4,this.WX=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function S(h,d,T){h=Object.assign(new Z,h),this.gravity=h.gravity||[0,-10,0],this.ZZ=h.ZZ||.1,this.WX=h.WX||2,this.fluidDrag=h.fluidDrag||.4,this.minBounceImpulse=h.minBounceImpulse,this.bodies=[],this.Ir=h.Ir,this.testSolid=d,this.testFluid=T}S.prototype.JO=function(h,d,T,Y,y,n){h=h||new X([0,0,0],[1,1,1]),"undefined"==typeof d&&(d=1),"undefined"==typeof T&&(T=1),"undefined"==typeof Y&&(Y=0),"undefined"==typeof y&&(y=1);var F=new C(h,d,T,Y,y,n);return this.bodies.push(F),F},S.prototype.WO=function(h){var d=this.bodies.indexOf(h);d<0||(this.bodies.splice(d,1),h.RU=h.UO=null)};var r=F.create(),c=F.create(),O=F.create(),f=F.create(),J=F.create(),W=F.create(),L=F.create(),D=new X([0,0,0],[1,1,1]),V=new C(D,1,1,0,1,(()=>{}),!1);function i(h,d,T){return d=T,d*=1-(1-h.ratioInFluid)**2}S.prototype.qX=function(h){h/=1e3;var d=j(0,F.squaredLength(this.gravity));this.bodies.forEach((T=>function(h,d,T,Y){F.j(J,d.resting),h.Ir&&V.loadFromCopy(d);if(d.Fy<=0)return F.set(d.wU,0,0,0),F.set(d._forces,0,0,0),void F.set(d._impulses,0,0,0);var y=Y||0===d.SX;if(function(h,d,T,Y){if(d._sleepFrameCount>0)return!1;if(Y)return!0;var y=!1,C=.5*T*T*d.SX;return F.scale(q,h.gravity,C),U(h.testSolid,d.RU,q,(function(){return y=!0,!0}),!0),y}(h,d,T,y))return;d._sleepFrameCount--,function(h,d){var T=d.RU,Y=Math.floor(T.base[0]),y=Math.floor(T.base[2]),C=Math.floor(T.base[1]),n=Math.floor(T.max[1]);if(!h.testFluid(Y,C,y))return d.inFluid=!1,void(d.ratioInFluid=0);var X=1,U=C+1;for(;U<=n&&h.testFluid(Y,U,y);)X++,U++;var Z=(C+X-T.base[1])/T.SZ[1];Z>1&&(Z=1);var S=T.SZ[0]*T.SZ[1]*T.SZ[2]*Z,r=s;F.scale(r,h.gravity,-h.WX*S*d.SX),d.applyForce(r),d.inFluid=!0,d.ratioInFluid=Z}(h,d),e(d._forces),e(d._impulses),e(d.wU),e(d.resting),F.scale(r,d._forces,1/d.Fy),F.HX(r,r,h.gravity,d.SX),F.scale(c,d._impulses,1/d.Fy),F.HX(c,c,r,T),F.add(d.wU,d.wU,c),d.friction&&(E(h,0,d,c,T),E(h,1,d,c,T),E(h,2,d,c,T));var C=d.fluidDrag>=0?d.fluidDrag:h.fluidDrag,n=d.ZZ>=0?d.ZZ:h.ZZ,X=n,Z=n;d.inFluid&&(X=i(d,X,d.fluidDragHoriz>=0?d.fluidDragHoriz:C),Z=i(d,Z,d.fluidDragVert>=0?d.fluidDragVert:C));X=Math.max(1-X*T/d.Fy,0),Z=Math.max(1-Z*T/d.Fy,0),F.set(w,X,Z,X),F.multiply(d.wU,d.wU,w),F.scale(O,d.wU,T),F.set(d._forces,0,0,0),F.set(d._impulses,0,0,0),d.rX&&a(g,d.RU);F.j(W,O),F.set(L,0,0,0),d.preventFallOffEdge&&function(h,d,T,Y){if(!d.resting[1]||T[1]>0)return;var y=N;a(y,d.RU);for(var C=0;C<3;C+=2){F.set(u,0,0,0),u[C]=T[C];var n=!0;(n=(n=(n=(n=n&&!l(h,y.base[0]+u[0]+1e-5,y.base[1],y.base[2]+u[2]+1e-5))&&!l(h,y.max[0]+u[0]-1e-5,y.base[1],y.base[2]+u[2]+1e-5))&&!l(h,y.base[0]+u[0]+1e-5,y.base[1],y.max[2]+u[2]-1e-5))&&!l(h,y.max[0]+u[0]-1e-5,y.base[1],y.max[2]+u[2]-1e-5))?(Y[C]=T[C]>0?1:-1,T[C]=0):0===C&&(F.set(K,T[0],0,0),x(h,y,K,Y,d.slideOnCollision))}}(h,d,O,L);x(h,d.RU,O,d.resting,d.slideOnCollision),d.rX&&function(h,d,T,Y){if(d.resting[1]>=0&&!d.inFluid)return;var y=0!==d.resting[0],C=0!==d.resting[2];if(!y&&!C)return;var n=Math.abs(Y[0]/Y[2]),X=4;if(!y&&n>X)return;if(!C&&n<1/X)return;F.add(p,T.base,Y);var Z=h.testSolid;U(Z,T,Y,(function(h,d,T,Y){if(1!==d)return!0;Y[d]=0}));var S=T.base[1],r=d.inFluid?1.951:1.001,c=Math.floor(S+r)-S;F.set(k,0,c,0);var O=!1;if(U(Z,T,k,(function(h,d,T,Y){return O=!0,!0})),O)return;F.Nd(o,p,T.base),o[1]=0,x(h,T,o,H,!0);var f=j(T.base[0],p[0]),J=j(T.base[2],p[2]);if(y&&!f&&(!J||!C))return;if(C&&(!f||!y)&&!J)return;var W=!0;if(W=W&&!l(h,T.base[0]+1e-5,T.base[1],T.base[2]+1e-5),W=W&&!l(h,T.max[0]-1e-5,T.base[1],T.base[2]+1e-5),W=W&&!l(h,T.base[0]+1e-5,T.base[1],T.max[2]-1e-5),W=W&&!l(h,T.max[0]-1e-5,T.base[1],T.max[2]-1e-5),W)return;a(d.RU,T),d.resting[0]=H[0],d.resting[2]=H[2],d.IO&&d.IO()}(h,d,g,W);for(var S=0;S<3;++S)d.resting[S]=d.resting[S]||L[S],f[S]=0,d.resting[S]&&(J[S]||(f[S]=-d.wU[S]),d.wU[S]=0);var D=F.length(f);D>.001&&(F.scale(f,f,d.Fy),d.UO&&d.UO(f),d.restitution>0&&D>h.minBounceImpulse&&(F.scale(f,f,d.restitution),d.applyImpulse(f)));var z=F.squaredLength(d.wU);z>1e-5&&d.zU();h.Ir&&h.Ir(d)?(d.loadFromCopy(V),d.rolledBackLastTick=!0):d.rolledBackLastTick=!1}(this,T,h,d)))};var w=F.create([0,0,0]);var s=F.create();function E(h,d,T,Y,y){var C=T.resting[d],n=Y[d];if(!T.alwaysApplyHorizFriction||1!==d){if(0===C)return;if(C*n<=0)return}F.j(z,T.wU),z[d]=0;var X=F.length(z);if(!j(X,0)){var U=Math.abs(T.friction*h.gravity[d]*y),Z=X>U?(X-U)/X:0;T.wU[(d+1)%3]*=Z,T.wU[(d+2)%3]*=Z}}var z=F.create();function x(h,d,T,Y,y){return F.set(Y,0,0,0),U(h.testSolid,d,T,(function(h,d,T,C){Y[d]=T,C[d]=0,y||(C[0]=0,C[1]=0,C[2]=0)}))}var g=new X([],[]),H=F.create(),p=F.create(),k=F.create(),o=F.create();var u=F.create(),N=new X([],[]),K=F.create();function l(h,d,T,Y){return h.testSolid(Math.floor(d),Math.floor(T-1),Math.floor(Y))}var q=F.create();function j(h,d){return Math.abs(h-d)<1e-5}function a(h,d){for(var T=0;T<3;T++)h.base[T]=d.base[T],h.max[T]=d.max[T],h.SZ[T]=d.SZ[T]}var e=function(h){}},13472:function(h,d){!function(h){"use strict";var d=function(h,T){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,d){h.__proto__=d}||function(h,d){for(var T in d)Object.prototype.hasOwnProperty.call(d,T)&&(h[T]=d[T])},d(h,T)};function T(h,T){if("function"!==typeof T&&null!==T)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function Y(){this.constructor=h}d(h,T),h.prototype=null===T?Object.create(T):(Y.prototype=T.prototype,new Y)}function Y(h,d,T,Y){var y,C=arguments.length,n=C<3?d:null===Y?Y=Object.getOwnPropertyDescriptor(d,T):Y;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)n=Reflect.decorate(h,d,T,Y);else for(var X=h.length-1;X>=0;X--)(y=h[X])&&(n=(C<3?y(n):C>3?y(d,T,n):y(d,T))||n);return C>3&&n&&Object.defineProperty(d,T,n),n}function y(h,d,T){if(T||2===arguments.length)for(var Y,y=0,C=d.length;y<C;y++)!Y&&y in d||(Y||(Y=Array.prototype.slice.call(d,0,y)),Y[y]=d[y]);return h.concat(Y||Array.prototype.slice.call(d))}var C,n=255,X=213;h.OPERATION=void 0,(C=h.OPERATION||(h.OPERATION={}))[C.ADD=128]="ADD",C[C.REPLACE=0]="REPLACE",C[C.DELETE=64]="DELETE",C[C.DELETE_AND_ADD=192]="DELETE_AND_ADD",C[C.TOUCH=1]="TOUCH",C[C.CLEAR=10]="CLEAR";var F=function(){function d(h,d,T){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=h,this.setParent(d,T)}return d.prototype.setParent=function(h,d,T){var Y=this;if(this.indexes||(this.indexes=this.ref instanceof oh?this.ref._definition.indexes:{}),this.parent=h,this.parentIndex=T,d)if(this.root=d,this.ref instanceof oh){var y=this.ref._definition;for(var C in y.schema){var n=this.ref[C];if(n&&n.$changes){var X=y.indexes[C];n.$changes.setParent(this.ref,d,X)}}}else"object"===typeof this.ref&&this.ref.forEach((function(h,d){if(h instanceof oh){var T=h.$changes,y=Y.ref.$changes.indexes[d];T.setParent(Y.ref,Y.root,y)}}))},d.prototype.operation=function(h){this.changes.set(--this.currentCustomOperation,h)},d.prototype.change=function(d,T){void 0===T&&(T=h.OPERATION.ADD);var Y="number"===typeof d?d:this.indexes[d];this.assertValidIndex(Y,d);var y=this.changes.get(Y);y&&y.op!==h.OPERATION.DELETE&&y.op!==h.OPERATION.TOUCH||this.changes.set(Y,{op:y&&y.op===h.OPERATION.DELETE?h.OPERATION.DELETE_AND_ADD:T,index:Y}),this.allChanges.add(Y),this.changed=!0,this.touchParents()},d.prototype.touch=function(d){var T="number"===typeof d?d:this.indexes[d];this.assertValidIndex(T,d),this.changes.has(T)||this.changes.set(T,{op:h.OPERATION.TOUCH,index:T}),this.allChanges.add(T),this.touchParents()},d.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},d.prototype.getType=function(h){if(this.ref._definition)return(d=this.ref._definition).schema[d.fieldsByIndex[h]];var d,T=(d=this.parent._definition).schema[d.fieldsByIndex[this.parentIndex]];return Object.values(T)[0]},d.prototype.getChildrenFilter=function(){var h=this.parent._definition.childFilters;return h&&h[this.parentIndex]},d.prototype.getValue=function(h){return this.ref.getByIndex(h)},d.prototype.delete=function(d){var T="number"===typeof d?d:this.indexes[d];if(void 0!==T){var Y=this.getValue(T);this.changes.set(T,{op:h.OPERATION.DELETE,index:T}),this.allChanges.delete(T),delete this.caches[T],Y&&Y.$changes&&(Y.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(d," (").concat(T,")"))},d.prototype.discard=function(d,T){var Y=this;void 0===d&&(d=!1),void 0===T&&(T=!1),this.ref instanceof oh||this.changes.forEach((function(d){if(d.op===h.OPERATION.DELETE){var T=Y.ref.getIndex(d.index);delete Y.indexes[T]}})),this.changes.clear(),this.changed=d,T&&this.allChanges.clear(),this.currentCustomOperation=0},d.prototype.discardAll=function(){var h=this;this.changes.forEach((function(d){var T=h.getValue(d.index);T&&T.$changes&&T.$changes.discardAll()})),this.discard()},d.prototype.cache=function(h,d){this.caches[h]=d},d.prototype.clone=function(){return new d(this.ref,this.parent,this.root)},d.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},d.prototype.assertValidIndex=function(h,d){if(void 0===h)throw new Error('ChangeTree: missing index for field "'.concat(d,'"'))},d}();function U(h,d,T,Y){return h[d]||(h[d]=[]),h[d].push(T),null===Y||void 0===Y||Y.forEach((function(h,d){return T(h,d)})),function(){return S(h[d],h[d].indexOf(T))}}function Z(d){var T=this,Y="string"!==typeof this.$changes.getType();this.$items.forEach((function(y,C){d.push({refId:T.$changes.refId,op:h.OPERATION.DELETE,field:C,value:void 0,previousValue:y}),Y&&T.$changes.root.removeRef(y.$changes.refId)}))}function S(h,d){if(-1===d||d>=h.length)return!1;for(var T=h.length-1,Y=d;Y<T;Y++)h[Y]=h[Y+1];return h.length=T,!0}var r=function(h,d){var T=h.toString(),Y=d.toString();return T<Y?-1:T>Y?1:0};function c(h){return h.$proxy=!0,h=new Proxy(h,{get:function(h,d){return"symbol"===typeof d||isNaN(d)?h[d]:h.at(d)},set:function(h,d,T){if("symbol"===typeof d||isNaN(d))h[d]=T;else{var Y=Array.from(h.$items.keys()),y=parseInt(Y[d]||d);void 0===T||null===T?h.deleteAt(y):h.setAt(y,T)}return!0},deleteProperty:function(h,d){return"number"===typeof d?h.deleteAt(d):delete h[d],!0}})}var O=function(){function d(){for(var h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];this.$changes=new F(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,h)}return d.prototype.RX=function(d,T){return void 0===T&&(T=!0),U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,d,T?this.$items:void 0)},d.prototype.Ud=function(d){return U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,d)},d.is=function(h){return Array.isArray(h)||void 0!==h.array},Object.defineProperty(d.prototype,"length",{get:function(){return this.$items.size},set:function(h){0===h?this.clear():this.splice(h,this.length-h)},enumerable:!1,configurable:!0}),d.prototype.push=function(){for(var h,d=this,T=[],Y=0;Y<arguments.length;Y++)T[Y]=arguments[Y];return T.forEach((function(T){h=d.$refId++,d.setAt(h,T)})),h},d.prototype.pop=function(){var h=Array.from(this.$indexes.values()).pop();if(void 0!==h){this.$changes.delete(h),this.$indexes.delete(h);var d=this.$items.get(h);return this.$items.delete(h),d}},d.prototype.at=function(h){var d=Array.from(this.$items.keys())[h];return this.$items.get(d)},d.prototype.setAt=function(d,T){var Y,y;if(void 0!==T&&null!==T){if(this.$items.get(d)!==T){void 0!==T.$changes&&T.$changes.setParent(this,this.$changes.root,d);var C=null!==(y=null===(Y=this.$changes.indexes[d])||void 0===Y?void 0:Y.op)&&void 0!==y?y:h.OPERATION.ADD;this.$changes.indexes[d]=d,this.$indexes.set(d,d),this.$items.set(d,T),this.$changes.change(d,C)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},d.prototype.deleteAt=function(h){var d=Array.from(this.$items.keys())[h];return void 0!==d&&this.$deleteAt(d)},d.prototype.$deleteAt=function(h){return this.$changes.delete(h),this.$indexes.delete(h),this.$items.delete(h)},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&Z.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.concat=function(){for(var h,T=[],Y=0;Y<arguments.length;Y++)T[Y]=arguments[Y];return new(d.bind.apply(d,y([void 0],(h=Array.from(this.$items.values())).concat.apply(h,T),!1)))},d.prototype.join=function(h){return Array.from(this.$items.values()).join(h)},d.prototype.reverse=function(){var h=this,d=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(T,Y){h.setAt(d[Y],T)})),this},d.prototype.shift=function(){var h=Array.from(this.$items.keys()).shift();if(void 0!==h){var d=this.$items.get(h);return this.$deleteAt(h),d}},d.prototype.slice=function(h,T){var Y=new d;return Y.push.apply(Y,Array.from(this.$items.values()).slice(h,T)),Y},d.prototype.sort=function(h){var d=this;void 0===h&&(h=r);var T=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(h).forEach((function(h,Y){d.setAt(T[Y],h)})),this},d.prototype.splice=function(h,d){void 0===d&&(d=this.length-h);for(var T=Array.from(this.$items.keys()),Y=[],y=h;y<h+d;y++)Y.push(this.$items.get(T[y])),this.$deleteAt(T[y]);return Y},d.prototype.unshift=function(){for(var h=this,d=[],T=0;T<arguments.length;T++)d[T]=arguments[T];var Y=this.length,y=d.length,C=Array.from(this.$items.values());return d.forEach((function(d,T){h.setAt(T,d)})),C.forEach((function(d,T){h.setAt(y+T,d)})),Y+y},d.prototype.indexOf=function(h,d){return Array.from(this.$items.values()).indexOf(h,d)},d.prototype.lastIndexOf=function(h,d){return void 0===d&&(d=this.length-1),Array.from(this.$items.values()).lastIndexOf(h,d)},d.prototype.every=function(h,d){return Array.from(this.$items.values()).every(h,d)},d.prototype.some=function(h,d){return Array.from(this.$items.values()).some(h,d)},d.prototype.forEach=function(h,d){Array.from(this.$items.values()).forEach(h,d)},d.prototype.map=function(h,d){return Array.from(this.$items.values()).map(h,d)},d.prototype.filter=function(h,d){return Array.from(this.$items.values()).filter(h,d)},d.prototype.reduce=function(h,d){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},d.prototype.reduceRight=function(h,d){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},d.prototype.find=function(h,d){return Array.from(this.$items.values()).find(h,d)},d.prototype.findIndex=function(h,d){return Array.from(this.$items.values()).findIndex(h,d)},d.prototype.fill=function(h,d,T){throw new Error("ArraySchema#fill() not implemented")},d.prototype.copyWithin=function(h,d,T){throw new Error("ArraySchema#copyWithin() not implemented")},d.prototype.toString=function(){return this.$items.toString()},d.prototype.toLocaleString=function(){return this.$items.toLocaleString()},d.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(d,Symbol.species,{get:function(){return d},enumerable:!1,configurable:!0}),d.prototype.entries=function(){return this.$items.entries()},d.prototype.keys=function(){return this.$items.keys()},d.prototype.values=function(){return this.$items.values()},d.prototype.includes=function(h,d){return Array.from(this.$items.values()).includes(h,d)},d.prototype.flatMap=function(h,d){throw new Error("ArraySchema#flatMap() is not supported.")},d.prototype.flat=function(h){throw new Error("ArraySchema#flat() is not supported.")},d.prototype.findLast=function(){var h=Array.from(this.$items.values());return h.findLast.apply(h,arguments)},d.prototype.findLastIndex=function(){var h=Array.from(this.$items.values());return h.findLastIndex.apply(h,arguments)},d.prototype.setIndex=function(h,d){this.$indexes.set(h,d)},d.prototype.getIndex=function(h){return this.$indexes.get(h)},d.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},d.prototype.deleteByIndex=function(h){var d=this.$indexes.get(h);this.$items.delete(d),this.$indexes.delete(h)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){return this.toArray().map((function(h){return"function"===typeof h.toJSON?h.toJSON():h}))},d.prototype.clone=function(h){return h?new(d.bind.apply(d,y([void 0],Array.from(this.$items.values()),!1))):new(d.bind.apply(d,y([void 0],this.map((function(h){return h.$changes?h.clone():h})),!1)))},d}();function f(h){return h.$proxy=!0,h=new Proxy(h,{get:function(h,d){return"symbol"!==typeof d&&"undefined"===typeof h[d]?h.get(d):h[d]},set:function(h,d,T){return"symbol"!==typeof d&&-1===d.indexOf("$")&&"RX"!==d&&"Ud"!==d&&"onChange"!==d?h.set(d,T):h[d]=T,!0},deleteProperty:function(h,d){return h.delete(d),!0}})}var J=function(){function d(h){var T=this;if(this.$changes=new F(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,h)if(h instanceof Map||h instanceof d)h.forEach((function(h,d){return T.set(d,h)}));else for(var Y in h)this.set(Y,h[Y])}return d.prototype.RX=function(d,T){return void 0===T&&(T=!0),U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,d,T?this.$items:void 0)},d.prototype.Ud=function(d){return U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,d)},d.is=function(h){return void 0!==h.map},d.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(d.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(d,Symbol.species,{get:function(){return d},enumerable:!1,configurable:!0}),d.prototype.set=function(d,T){if(void 0===T||null===T)throw new Error("MapSchema#set('".concat(d,"', ").concat(T,"): trying to set ").concat(T," value on '").concat(d,"'."));d=d.toString();var Y="undefined"!==typeof this.$changes.indexes[d],y=Y?this.$changes.indexes[d]:this.$refId++,C=Y?h.OPERATION.REPLACE:h.OPERATION.ADD,n=void 0!==T.$changes;if(n&&T.$changes.setParent(this,this.$changes.root,y),Y){if(!n&&this.$items.get(d)===T)return;n&&this.$items.get(d)!==T&&(C=h.OPERATION.ADD)}else this.$changes.indexes[d]=y,this.$indexes.set(y,d);return this.$items.set(d,T),this.$changes.change(d,C),this},d.prototype.get=function(h){return this.$items.get(h)},d.prototype.delete=function(h){return this.$changes.delete(h),this.$items.delete(h)},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&Z.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(h){return this.$items.has(h)},d.prototype.forEach=function(h){this.$items.forEach(h)},d.prototype.entries=function(){return this.$items.entries()},d.prototype.keys=function(){return this.$items.keys()},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(h,d){this.$indexes.set(h,d)},d.prototype.getIndex=function(h){return this.$indexes.get(h)},d.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},d.prototype.deleteByIndex=function(h){var d=this.$indexes.get(h);this.$items.delete(d),this.$indexes.delete(h)},d.prototype.toJSON=function(){var h={};return this.forEach((function(d,T){h[T]="function"===typeof d.toJSON?d.toJSON():d})),h},d.prototype.clone=function(h){var T;return h?T=Object.assign(new d,this):(T=new d,this.forEach((function(h,d){h.$changes?T.set(d,h.clone()):T.set(d,h)}))),T},d}(),W={};function L(h,d){W[h]=d}function D(h){return W[h]}var V=function(){function h(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return h.create=function(d){var T=new h;return T.schema=Object.assign({},d&&d.schema||{}),T.indexes=Object.assign({},d&&d.indexes||{}),T.fieldsByIndex=Object.assign({},d&&d.fieldsByIndex||{}),T.descriptors=Object.assign({},d&&d.descriptors||{}),T.deprecated=Object.assign({},d&&d.deprecated||{}),T},h.prototype.addField=function(h,d){var T=this.getNextFieldIndex();this.fieldsByIndex[T]=h,this.indexes[h]=T,this.schema[h]=Array.isArray(d)?{array:d[0]}:d},h.prototype.hasField=function(h){return void 0!==this.indexes[h]},h.prototype.addFilter=function(h,d){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[h]]=d,this.indexesWithFilters.push(this.indexes[h]),!0},h.prototype.addChildrenFilter=function(h,d){var T=this.indexes[h],Y=this.schema[h];if(D(Object.keys(Y)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[T]=d,!0;console.warn("@filterChildren: field '".concat(h,"' can't have children. Ignoring filter."))},h.prototype.getChildrenFilter=function(h){return this.childFilters&&this.childFilters[this.indexes[h]]},h.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},h}();function i(h){return h._context&&h._context.useFilters}var w=function(){function h(){this.types={},this.schemas=new Map,this.useFilters=!1}return h.prototype.has=function(h){return this.schemas.has(h)},h.prototype.get=function(h){return this.types[h]},h.prototype.add=function(h,d){void 0===d&&(d=this.schemas.size),h._definition=V.create(h._definition),h._typeid=d,this.types[d]=h,this.schemas.set(h,d)},h.create=function(d){return void 0===d&&(d={}),function(T){return d.context||(d.context=new h),E(T,d)}},h}(),s=new w;function E(h,d){return void 0===d&&(d={}),function(T,Y){var C=d.context||s,n=T.constructor;if(n._context=C,!h)throw new Error("".concat(n.name,': @type() reference provided for "').concat(Y,"\" is undefined. Make sure you don't have any circular dependencies."));C.has(n)||C.add(n);var X=n._definition;if(X.addField(Y,h),X.descriptors[Y]){if(X.deprecated[Y])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(Y,"' definition on '").concat(n.name,"'.\nCheck @type() annotation"))}catch(W){var F=W.stack.split("\n")[4].trim();throw new Error("".concat(W.message," ").concat(F))}}var U=O.is(h),Z=!U&&J.is(h);if("string"!==typeof h&&!oh.is(h)){var S=Object.values(h)[0];"string"===typeof S||C.has(S)||C.add(S)}if(d.manual)X.descriptors[Y]={enumerable:!0,configurable:!0,writable:!0};else{var r="_".concat(Y);X.descriptors[r]={enumerable:!1,configurable:!1,writable:!0},X.descriptors[Y]={get:function(){return this[r]},set:function(h){h!==this[r]&&(void 0!==h&&null!==h?(!U||h instanceof O||(h=new(O.bind.apply(O,y([void 0],h,!1)))),!Z||h instanceof J||(h=new J(h)),void 0===h.$proxy&&(Z?h=f(h):U&&(h=c(h))),this.$changes.change(Y),h.$changes&&h.$changes.setParent(this,this.$changes.root,this._definition.indexes[Y])):this[r]&&this.$changes.delete(Y),this[r]=h)},enumerable:!0,configurable:!0}}}}function z(h){return function(d,T){var Y=d.constructor;Y._definition.addFilter(T,h)&&(Y._context.useFilters=!0)}}function x(h){return function(d,T){var Y=d.constructor;Y._definition.addChildrenFilter(T,h)&&(Y._context.useFilters=!0)}}function g(h){return void 0===h&&(h=!0),function(d,T){var Y=d.constructor._definition;Y.deprecated[T]=!0,h&&(Y.descriptors[T]={get:function(){throw new Error("".concat(T," is deprecated."))},set:function(h){},enumerable:!1,configurable:!0})}}function H(h,d,T){for(var Y in void 0===T&&(T={}),T.context||(T.context=h._context||T.context||s),d)E(d[Y],T)(h.prototype,Y);return h}function p(h){for(var d=0,T=0,Y=0,y=h.length;Y<y;Y++)(d=h.charCodeAt(Y))<128?T+=1:d<2048?T+=2:d<55296||d>=57344?T+=3:(Y++,T+=4);return T}function k(h,d,T){for(var Y=0,y=0,C=T.length;y<C;y++)(Y=T.charCodeAt(y))<128?h[d++]=Y:Y<2048?(h[d++]=192|Y>>6,h[d++]=128|63&Y):Y<55296||Y>=57344?(h[d++]=224|Y>>12,h[d++]=128|Y>>6&63,h[d++]=128|63&Y):(y++,Y=65536+((1023&Y)<<10|1023&T.charCodeAt(y)),h[d++]=240|Y>>18,h[d++]=128|Y>>12&63,h[d++]=128|Y>>6&63,h[d++]=128|63&Y)}function o(h,d){h.push(255&d)}function u(h,d){h.push(255&d)}function N(h,d){h.push(255&d),h.push(d>>8&255)}function K(h,d){h.push(255&d),h.push(d>>8&255)}function l(h,d){h.push(255&d),h.push(d>>8&255),h.push(d>>16&255),h.push(d>>24&255)}function q(h,d){var T=d>>24,Y=d>>16,y=d>>8,C=d;h.push(255&C),h.push(255&y),h.push(255&Y),h.push(255&T)}function j(h,d){var T=Math.floor(d/Math.pow(2,32));q(h,d>>>0),q(h,T)}function a(h,d){var T=d/Math.pow(2,32)|0;q(h,d>>>0),q(h,T)}function e(h,d){M(h,d)}function v(h,d){mh(h,d)}var G=new Int32Array(2),b=new Float32Array(G.buffer),B=new Float64Array(G.buffer);function M(h,d){b[0]=d,l(h,G[0])}function mh(h,d){B[0]=d,l(h,G[0]),l(h,G[1])}function R(h,d){return u(h,d?1:0)}function Q(h,d){d||(d="");var T=p(d),Y=0;if(T<32)h.push(160|T),Y=1;else if(T<256)h.push(217),u(h,T),Y=2;else if(T<65536)h.push(218),K(h,T),Y=3;else{if(!(T<4294967296))throw new Error("String too long");h.push(219),q(h,T),Y=5}return k(h,h.length,d),Y+T}function I(h,d){return isNaN(d)?I(h,0):isFinite(d)?d!==(0|d)?(h.push(203),mh(h,d),9):d>=0?d<128?(u(h,d),1):d<256?(h.push(204),u(h,d),2):d<65536?(h.push(205),K(h,d),3):d<4294967296?(h.push(206),q(h,d),5):(h.push(207),a(h,d),9):d>=-32?(h.push(224|d+32),1):d>=-128?(h.push(208),o(h,d),2):d>=-32768?(h.push(209),N(h,d),3):d>=-2147483648?(h.push(210),l(h,d),5):(h.push(211),j(h,d),9):I(h,d>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var A=Object.freeze({__proto__:null,utf8Write:k,int8:o,uint8:u,int16:N,uint16:K,int32:l,uint32:q,int64:j,uint64:a,float32:e,float64:v,writeFloat32:M,writeFloat64:mh,boolean:R,string:Q,number:I});function P(h,d,T){for(var Y="",y=0,C=d,n=d+T;C<n;C++){var X=h[C];0!==(128&X)?192!==(224&X)?224!==(240&X)?240!==(248&X)?console.error("Invalid byte "+X.toString(16)):(y=(7&X)<<18|(63&h[++C])<<12|(63&h[++C])<<6|63&h[++C])>=65536?(y-=65536,Y+=String.fromCharCode(55296+(y>>>10),56320+(1023&y))):Y+=String.fromCharCode(y):Y+=String.fromCharCode((15&X)<<12|(63&h[++C])<<6|63&h[++C]):Y+=String.fromCharCode((31&X)<<6|63&h[++C]):Y+=String.fromCharCode(X)}return Y}function t(h,d){return hh(h,d)<<24>>24}function hh(h,d){return h[d.offset++]}function dh(h,d){return Th(h,d)<<16>>16}function Th(h,d){return h[d.offset++]|h[d.offset++]<<8}function Yh(h,d){return h[d.offset++]|h[d.offset++]<<8|h[d.offset++]<<16|h[d.offset++]<<24}function yh(h,d){return Yh(h,d)>>>0}function Ch(h,d){return rh(h,d)}function nh(h,d){return ch(h,d)}function Xh(h,d){var T=yh(h,d);return Yh(h,d)*Math.pow(2,32)+T}function Fh(h,d){var T=yh(h,d);return yh(h,d)*Math.pow(2,32)+T}var Uh=new Int32Array(2),Zh=new Float32Array(Uh.buffer),Sh=new Float64Array(Uh.buffer);function rh(h,d){return Uh[0]=Yh(h,d),Zh[0]}function ch(h,d){return Uh[0]=Yh(h,d),Uh[1]=Yh(h,d),Sh[0]}function Oh(h,d){return hh(h,d)>0}function fh(h,d){var T,Y=h[d.offset++];Y<192?T=31&Y:217===Y?T=hh(h,d):218===Y?T=Th(h,d):219===Y&&(T=yh(h,d));var y=P(h,d.offset,T);return d.offset+=T,y}function Jh(h,d){var T=h[d.offset];return T<192&&T>160||217===T||218===T||219===T}function Wh(h,d){var T=h[d.offset++];return T<128?T:202===T?rh(h,d):203===T?ch(h,d):204===T?hh(h,d):205===T?Th(h,d):206===T?yh(h,d):207===T?Fh(h,d):208===T?t(h,d):209===T?dh(h,d):210===T?Yh(h,d):211===T?Xh(h,d):T>223?-1*(255-T+1):void 0}function Lh(h,d){var T=h[d.offset];return T<128||T>=202&&T<=211}function Dh(h,d){return h[d.offset]<160}function Vh(h,d){return h[d.offset-1]===n&&(h[d.offset]<128||h[d.offset]>=202&&h[d.offset]<=211)}var ih=Object.freeze({__proto__:null,int8:t,uint8:hh,int16:dh,uint16:Th,int32:Yh,uint32:yh,float32:Ch,float64:nh,int64:Xh,uint64:Fh,readFloat32:rh,readFloat64:ch,boolean:Oh,string:fh,stringCheck:Jh,number:Wh,numberCheck:Lh,arrayCheck:Dh,switchStructureCheck:Vh}),wh=function(){function d(h){var d=this;this.$changes=new F(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,h&&h.forEach((function(h){return d.add(h)}))}return d.prototype.RX=function(d,T){return void 0===T&&(T=!0),U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,d,T?this.$items:void 0)},d.prototype.Ud=function(d){return U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,d)},d.is=function(h){return void 0!==h.collection},d.prototype.add=function(h){var d=this.$refId++;return void 0!==h.$changes&&h.$changes.setParent(this,this.$changes.root,d),this.$changes.indexes[d]=d,this.$indexes.set(d,d),this.$items.set(d,h),this.$changes.change(d),d},d.prototype.at=function(h){var d=Array.from(this.$items.keys())[h];return this.$items.get(d)},d.prototype.entries=function(){return this.$items.entries()},d.prototype.delete=function(h){for(var d,T,Y=this.$items.entries();(T=Y.next())&&!T.done;)if(h===T.value[1]){d=T.value[0];break}return void 0!==d&&(this.$changes.delete(d),this.$indexes.delete(d),this.$items.delete(d))},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&Z.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(h){return Array.from(this.$items.values()).some((function(d){return d===h}))},d.prototype.forEach=function(h){var d=this;this.$items.forEach((function(T,Y,y){return h(T,Y,d)}))},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(h,d){this.$indexes.set(h,d)},d.prototype.getIndex=function(h){return this.$indexes.get(h)},d.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},d.prototype.deleteByIndex=function(h){var d=this.$indexes.get(h);this.$items.delete(d),this.$indexes.delete(h)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){var h=[];return this.forEach((function(d,T){h.push("function"===typeof d.toJSON?d.toJSON():d)})),h},d.prototype.clone=function(h){var T;return h?T=Object.assign(new d,this):(T=new d,this.forEach((function(h){h.$changes?T.add(h.clone()):T.add(h)}))),T},d}(),sh=function(){function d(h){var d=this;this.$changes=new F(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,h&&h.forEach((function(h){return d.add(h)}))}return d.prototype.RX=function(d,T){return void 0===T&&(T=!0),U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.ADD,d,T?this.$items:void 0)},d.prototype.Ud=function(d){return U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,d)},d.is=function(h){return void 0!==h.set},d.prototype.add=function(d){var T,Y;if(this.has(d))return!1;var y=this.$refId++;void 0!==d.$changes&&d.$changes.setParent(this,this.$changes.root,y);var C=null!==(Y=null===(T=this.$changes.indexes[y])||void 0===T?void 0:T.op)&&void 0!==Y?Y:h.OPERATION.ADD;return this.$changes.indexes[y]=y,this.$indexes.set(y,y),this.$items.set(y,d),this.$changes.change(y,C),y},d.prototype.entries=function(){return this.$items.entries()},d.prototype.delete=function(h){for(var d,T,Y=this.$items.entries();(T=Y.next())&&!T.done;)if(h===T.value[1]){d=T.value[0];break}return void 0!==d&&(this.$changes.delete(d),this.$indexes.delete(d),this.$items.delete(d))},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&Z.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:h.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(h){for(var d,T=this.$items.values(),Y=!1;(d=T.next())&&!d.done;)if(h===d.value){Y=!0;break}return Y},d.prototype.forEach=function(h){var d=this;this.$items.forEach((function(T,Y,y){return h(T,Y,d)}))},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(h,d){this.$indexes.set(h,d)},d.prototype.getIndex=function(h){return this.$indexes.get(h)},d.prototype.getByIndex=function(h){return this.$items.get(this.$indexes.get(h))},d.prototype.deleteByIndex=function(h){var d=this.$indexes.get(h);this.$items.delete(d),this.$indexes.delete(h)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){var h=[];return this.forEach((function(d,T){h.push("function"===typeof d.toJSON?d.toJSON():d)})),h},d.prototype.clone=function(h){var T;return h?T=Object.assign(new d,this):(T=new d,this.forEach((function(h){h.$changes?T.add(h.clone()):T.add(h)}))),T},d}(),Eh=function(){function h(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return h.prototype.addRefId=function(h){this.refIds.has(h)||(this.refIds.add(h),this.containerIndexes.set(h,new Set))},h.get=function(d){return void 0===d.$filterState&&(d.$filterState=new h),d.$filterState},h}(),zh=function(){function h(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return h.prototype.getNextUniqueId=function(){return this.nextUniqueId++},h.prototype.addRef=function(h,d,T){void 0===T&&(T=!0),this.refs.set(h,d),T&&(this.refCounts[h]=(this.refCounts[h]||0)+1)},h.prototype.removeRef=function(h){this.refCounts[h]=this.refCounts[h]-1,this.deletedRefs.add(h)},h.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},h.prototype.garbageCollectDeletedRefs=function(){var h=this;this.deletedRefs.forEach((function(d){if(!(h.refCounts[d]>0)){var T=h.refs.get(d);if(T instanceof oh)for(var Y in T._definition.schema)"string"!==typeof T._definition.schema[Y]&&T[Y]&&T[Y].$changes&&h.removeRef(T[Y].$changes.refId);else{var y=T.$changes.parent._definition,C=y.schema[y.fieldsByIndex[T.$changes.parentIndex]];"function"===typeof Object.values(C)[0]&&Array.from(T.values()).forEach((function(d){return h.removeRef(d.$changes.refId)}))}h.refs.delete(d),delete h.refCounts[d]}})),this.deletedRefs.clear()},h}(),xh=function(h){function d(){return null!==h&&h.apply(this,arguments)||this}return T(d,h),d}(Error);function gh(h,d,T,Y){var y,C=!1;switch(d){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":y="number",isNaN(h)&&console.log('trying to encode "NaN" in '.concat(T.constructor.name,"#").concat(Y));break;case"string":y="string",C=!0;break;case"boolean":return}if(typeof h!==y&&(!C||C&&null!==h)){var n="'".concat(JSON.stringify(h),"'").concat(h&&h.constructor&&" (".concat(h.constructor.name,")")||"");throw new xh("a '".concat(y,"' was expected, but ").concat(n," was provided in ").concat(T.constructor.name,"#").concat(Y))}}function Hh(h,d,T,Y){if(!(h instanceof d))throw new xh("a '".concat(d.name,"' was expected, but '").concat(h.constructor.name,"' was provided in ").concat(T.constructor.name,"#").concat(Y))}function ph(h,d,T,Y,y){gh(T,h,Y,y);var C=A[h];if(!C)throw new xh("a '".concat(h,"' was expected, but ").concat(T," was provided in ").concat(Y.constructor.name,"#").concat(y));C(d,T)}function kh(h,d,T){return ih[h](d,T)}var oh=function(){function d(){for(var h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];Object.defineProperties(this,{$changes:{value:new F(this,void 0,new zh),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var T=this._definition.descriptors;T&&Object.defineProperties(this,T),h[0]&&this.assign(h[0])}return d.onError=function(h){console.error(h)},d.is=function(h){return h._definition&&void 0!==h._definition.schema},d.prototype.onChange=function(d){return U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.REPLACE,d)},d.prototype.Ud=function(d){return U(this.$callbacks||(this.$callbacks=[]),h.OPERATION.DELETE,d)},d.prototype.assign=function(h){return Object.assign(this,h),this},Object.defineProperty(d.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),d.prototype.setDirty=function(h,d){this.$changes.change(h,d)},d.prototype.listen=function(h,d,T){var Y=this;return void 0===T&&(T=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[h]||(this.$callbacks[h]=[]),this.$callbacks[h].push(d),T&&void 0!==this[h]&&d(this[h],void 0),function(){return S(Y.$callbacks[h],Y.$callbacks[h].indexOf(d))}},d.prototype.decode=function(T,Y,y){var C;void 0===Y&&(Y={offset:0}),void 0===y&&(y=this);var X=[],F=this.$changes.root,U=T.length,Z=0;for(F.refs.set(Z,this);Y.offset<U;){var S=T[Y.offset++];if(S!=n){var r=y.$changes,c=void 0!==y._definition,f=c?S>>6<<6:S;if(f!==h.OPERATION.CLEAR){var W=c?S%(f||255):Wh(T,Y),L=c?y._definition.fieldsByIndex[W]:"",V=r.getType(W),i=void 0,w=void 0,s=void 0;if(c?w=y["_".concat(L)]:(w=y.getByIndex(W),(f&h.OPERATION.ADD)===h.OPERATION.ADD?(s=y instanceof J?fh(T,Y):W,y.setIndex(W,s)):s=y.getIndex(W)),(f&h.OPERATION.DELETE)===h.OPERATION.DELETE&&(f!==h.OPERATION.DELETE_AND_ADD&&y.deleteByIndex(W),w&&w.$changes&&F.removeRef(w.$changes.refId),i=null),void 0!==L){if(f===h.OPERATION.DELETE);else if(d.is(V)){var E=Wh(T,Y);if(i=F.refs.get(E),f!==h.OPERATION.REPLACE){var z=this.getSchemaType(T,Y,V);i||((i=this.createTypeInstance(z)).$changes.refId=E,w&&(i.$callbacks=w.$callbacks,w.$changes.refId&&E!==w.$changes.refId&&F.removeRef(w.$changes.refId))),F.addRef(E,i,i!==w)}}else if("string"===typeof V)i=kh(V,T,Y);else{var x=D(Object.keys(V)[0]),g=Wh(T,Y),H=F.refs.has(g)?w||F.refs.get(g):new x.constructor;if((i=H.clone(!0)).$changes.refId=g,w&&(i.$callbacks=w.$callbacks,w.$changes.refId&&g!==w.$changes.refId)){F.removeRef(w.$changes.refId);for(var p=w.entries(),k=void 0;(k=p.next())&&!k.done;){var o=(C=k.value)[0],u=C[1];X.push({refId:g,op:h.OPERATION.DELETE,field:o,value:void 0,previousValue:u})}}F.addRef(g,i,H!==w)}if(null!==i&&void 0!==i)if(i.$changes&&i.$changes.setParent(r.ref,r.root,W),y instanceof d)y[L]=i;else if(y instanceof J)o=s,y.$items.set(o,i),y.$changes.allChanges.add(W);else if(y instanceof O)y.setAt(W,i);else if(y instanceof wh){var N=y.add(i);y.setIndex(W,N)}else y instanceof sh&&!1!==(N=y.add(i))&&y.setIndex(W,N);w!==i&&X.push({refId:Z,op:f,field:L,dynamicIndex:s,value:i,previousValue:w})}else{console.warn("@colyseus/schema: definition mismatch");for(var K={offset:Y.offset};Y.offset<U&&(!Vh(T,Y)||(K.offset=Y.offset+1,!F.refs.has(Wh(T,K))));)Y.offset++}}else y.clear(X)}else{Z=Wh(T,Y);var l=F.refs.get(Z);if(!l)throw new Error('"refId" not found: '.concat(Z));y=l}}return this._triggerChanges(X),F.garbageCollectDeletedRefs(),X},d.prototype.encode=function(T,Y,y){void 0===T&&(T=!1),void 0===Y&&(Y=[]),void 0===y&&(y=!1);for(var C=this.$changes,X=new WeakSet,F=[C],U=1,Z=0;Z<U;Z++){var S=F[Z],r=S.ref,c=r instanceof d;S.ensureRefId(),X.add(S),S!==C&&(S.changed||T)&&(u(Y,n),I(Y,S.refId));for(var O=T?Array.from(S.allChanges):Array.from(S.changes.values()),f=0,W=O.length;f<W;f++){var L=T?{op:h.OPERATION.ADD,index:O[f]}:O[f],V=L.index,i=c?r._definition.fieldsByIndex&&r._definition.fieldsByIndex[V]:V,w=Y.length;if(L.op!==h.OPERATION.TOUCH)if(c)u(Y,V|L.op);else{if(u(Y,L.op),L.op===h.OPERATION.CLEAR)continue;I(Y,V)}if(c||(L.op&h.OPERATION.ADD)!=h.OPERATION.ADD||r instanceof J&&Q(Y,S.ref.$indexes.get(V)),L.op!==h.OPERATION.DELETE){var s=S.getType(V),E=S.getValue(V);if(E&&E.$changes&&!X.has(E.$changes)&&(F.push(E.$changes),E.$changes.ensureRefId(),U++),L.op!==h.OPERATION.TOUCH){if(d.is(s))Hh(E,s,r,i),I(Y,E.$changes.refId),(L.op&h.OPERATION.ADD)===h.OPERATION.ADD&&this.tryEncodeTypeId(Y,s,E.constructor);else if("string"===typeof s)ph(s,Y,E,r,i);else{var z=D(Object.keys(s)[0]);Hh(r["_".concat(i)],z.constructor,r,i),I(Y,E.$changes.refId)}y&&S.cache(V,Y.slice(w))}}}T||y||S.discard()}return Y},d.prototype.encodeAll=function(h){return this.encode(!0,[],h)},d.prototype.applyFilters=function(T,Y){var y,C;void 0===Y&&(Y=!1);for(var X=this,F=new Set,U=Eh.get(T),Z=[this.$changes],S=1,r=[],c=function(c){var O=Z[c];if(F.has(O.refId))return"continue";var f=O.ref,W=f instanceof d;u(r,n),I(r,O.refId);var L=U.refIds.has(O),D=Y||!L;U.addRefId(O);var V=U.containerIndexes.get(O),i=D?Array.from(O.allChanges):Array.from(O.changes.values());!Y&&W&&f._definition.indexesWithFilters&&f._definition.indexesWithFilters.forEach((function(d){!V.has(d)&&O.allChanges.has(d)&&(D?i.push(d):i.push({op:h.OPERATION.ADD,index:d}))}));for(var w=0,s=i.length;w<s;w++){var E=D?{op:h.OPERATION.ADD,index:i[w]}:i[w];if(E.op!==h.OPERATION.CLEAR){var z=E.index;if(E.op!==h.OPERATION.DELETE){var x=O.getValue(z),g=O.getType(z);if(W){if((H=f._definition.filters&&f._definition.filters[z])&&!H.call(f,T,x,X)){x&&x.$changes&&F.add(x.$changes.refId);continue}}else{var H,p=O.parent;if((H=O.getChildrenFilter())&&!H.call(p,T,f.$indexes.get(z),x,X)){x&&x.$changes&&F.add(x.$changes.refId);continue}}if(x.$changes&&(Z.push(x.$changes),S++),E.op!==h.OPERATION.TOUCH)if(E.op===h.OPERATION.ADD||W)r.push.apply(r,null!==(y=O.caches[z])&&void 0!==y?y:[]),V.add(z);else if(V.has(z))r.push.apply(r,null!==(C=O.caches[z])&&void 0!==C?C:[]);else{if(V.add(z),u(r,h.OPERATION.ADD),I(r,z),f instanceof J){var k=O.ref.$indexes.get(z);Q(r,k)}x.$changes?I(r,x.$changes.refId):A[g](r,x)}else x.$changes&&!W&&(u(r,h.OPERATION.ADD),I(r,z),f instanceof J&&(k=O.ref.$indexes.get(z),Q(r,k)),I(r,x.$changes.refId))}else W?u(r,E.op|z):(u(r,E.op),I(r,z))}else u(r,E.op)}},O=0;O<S;O++)c(O);return r},d.prototype.clone=function(){var h,d=new this.constructor,T=this._definition.schema;for(var Y in T)"object"===typeof this[Y]&&"function"===typeof(null===(h=this[Y])||void 0===h?void 0:h.clone)?d[Y]=this[Y].clone():d[Y]=this[Y];return d},d.prototype.toJSON=function(){var h=this._definition.schema,d=this._definition.deprecated,T={};for(var Y in h)d[Y]||null===this[Y]||"undefined"===typeof this[Y]||(T[Y]="function"===typeof this[Y].toJSON?this[Y].toJSON():this["_".concat(Y)]);return T},d.prototype.discardAllChanges=function(){this.$changes.discardAll()},d.prototype.getByIndex=function(h){return this[this._definition.fieldsByIndex[h]]},d.prototype.deleteByIndex=function(h){this[this._definition.fieldsByIndex[h]]=void 0},d.prototype.tryEncodeTypeId=function(h,d,T){d._typeid!==T._typeid&&(u(h,X),I(h,T._typeid))},d.prototype.getSchemaType=function(h,d,T){var Y;return h[d.offset]===X&&(d.offset++,Y=this.constructor._context.get(Wh(h,d))),Y||T},d.prototype.createTypeInstance=function(h){var d=new h;return d.$changes.root=this.$changes.root,d},d.prototype._triggerChanges=function(T){for(var Y,y,C,n,X,F,U,Z,S,r=new Set,c=this.$changes.root.refs,O=function(O){var f=T[O],J=f.refId,W=c.get(J),L=W.$callbacks;if((f.op&h.OPERATION.DELETE)===h.OPERATION.DELETE&&f.previousValue instanceof d&&(null===(y=null===(Y=f.previousValue.$callbacks)||void 0===Y?void 0:Y[h.OPERATION.DELETE])||void 0===y||y.forEach((function(h){return h()}))),!L)return"continue";if(W instanceof d){if(!r.has(J))try{null===(C=null===L||void 0===L?void 0:L[h.OPERATION.REPLACE])||void 0===C||C.forEach((function(h){return h()}))}catch(D){d.onError(D)}try{L.hasOwnProperty(f.field)&&(null===(n=L[f.field])||void 0===n||n.forEach((function(h){return h(f.value,f.previousValue)})))}catch(D){d.onError(D)}}else f.op===h.OPERATION.ADD&&void 0===f.previousValue?null===(X=L[h.OPERATION.ADD])||void 0===X||X.forEach((function(h){var d;return h(f.value,null!==(d=f.dynamicIndex)&&void 0!==d?d:f.field)})):f.op===h.OPERATION.DELETE?void 0!==f.previousValue&&(null===(F=L[h.OPERATION.DELETE])||void 0===F||F.forEach((function(h){var d;return h(f.previousValue,null!==(d=f.dynamicIndex)&&void 0!==d?d:f.field)}))):f.op===h.OPERATION.DELETE_AND_ADD&&(void 0!==f.previousValue&&(null===(U=L[h.OPERATION.DELETE])||void 0===U||U.forEach((function(h){var d;return h(f.previousValue,null!==(d=f.dynamicIndex)&&void 0!==d?d:f.field)}))),null===(Z=L[h.OPERATION.ADD])||void 0===Z||Z.forEach((function(h){var d;return h(f.value,null!==(d=f.dynamicIndex)&&void 0!==d?d:f.field)}))),f.value!==f.previousValue&&(null===(S=L[h.OPERATION.REPLACE])||void 0===S||S.forEach((function(h){var d;return h(f.value,null!==(d=f.dynamicIndex)&&void 0!==d?d:f.field)})));r.add(J)},f=0;f<T.length;f++)O(f)},d._definition=V.create(),d}();function uh(h){for(var d=[h.$changes],T=1,Y={},y=Y,C=function(h){var T=d[h];T.changes.forEach((function(h){var d=T.ref,Y=h.index,C=d._definition?d._definition.fieldsByIndex[Y]:d.$indexes.get(Y);y[C]=T.getValue(Y)}))},n=0;n<T;n++)C(n);return Y}var Nh={context:new w},Kh=function(h){function d(){return null!==h&&h.apply(this,arguments)||this}return T(d,h),Y([E("string",Nh)],d.prototype,"name",void 0),Y([E("string",Nh)],d.prototype,"type",void 0),Y([E("number",Nh)],d.prototype,"referencedType",void 0),d}(oh),lh=function(h){function d(){var d=null!==h&&h.apply(this,arguments)||this;return d.fields=new O,d}return T(d,h),Y([E("number",Nh)],d.prototype,"id",void 0),Y([E([Kh],Nh)],d.prototype,"fields",void 0),d}(oh),qh=function(h){function d(){var d=null!==h&&h.apply(this,arguments)||this;return d.types=new O,d}return T(d,h),d.encode=function(h){var T=h.constructor,Y=new d;Y.rootType=T._typeid;var y=function(h,d){for(var T in d){var y=new Kh;y.name=T;var C=void 0;if("string"===typeof d[T])C=d[T];else{var n=d[T],X=void 0;oh.is(n)?(C="ref",X=d[T]):"string"===typeof n[C=Object.keys(n)[0]]?C+=":"+n[C]:X=n[C],y.referencedType=X?X._typeid:-1}y.type=C,h.fields.push(y)}Y.types.push(h)},C=T._context.types;for(var n in C){var X=new lh;X.id=Number(n),y(X,C[n]._definition.schema)}return Y.encodeAll()},d.decode=function(h,Y){var y=new w,C=new d;C.decode(h,Y);var n=C.types.reduce((function(h,d){var Y=function(h){function d(){return null!==h&&h.apply(this,arguments)||this}return T(d,h),d}(oh),C=d.id;return h[C]=Y,y.add(Y,C),h}),{});C.types.forEach((function(h){var d=n[h.id];h.fields.forEach((function(h){var T;if(void 0!==h.referencedType){var Y=h.type,C=n[h.referencedType];if(!C){var X=h.type.split(":");Y=X[0],C=X[1]}"ref"===Y?E(C,{context:y})(d.prototype,h.name):E(((T={})[Y]=C,T),{context:y})(d.prototype,h.name)}else E(h.type,{context:y})(d.prototype,h.name)}))}));var X=n[C.rootType],F=new X;for(var U in X._definition.schema){var Z=X._definition.schema[U];"string"!==typeof Z&&(F[U]="function"===typeof Z?new Z:new(D(Object.keys(Z)[0]).constructor))}return F},Y([E([lh],Nh)],d.prototype,"types",void 0),Y([E("number",Nh)],d.prototype,"rootType",void 0),d}(oh);L("map",{constructor:J}),L("array",{constructor:O}),L("set",{constructor:sh}),L("collection",{constructor:wh}),h.ArraySchema=O,h.CollectionSchema=wh,h.Context=w,h.MapSchema=J,h.Reflection=qh,h.ReflectionField=Kh,h.ReflectionType=lh,h.Schema=oh,h.SchemaDefinition=V,h.SetSchema=sh,h.decode=ih,h.defineTypes=H,h.deprecated=g,h.dumpChanges=uh,h.encode=A,h.filter=z,h.filterChildren=x,h.hasFilter=i,h.registerType=L,h.type=E,Object.defineProperty(h,"__esModule",{value:!0})}(d)},14946:function(h,d,T){var Y,y,C;function n(){const h=["endCurrentSession","function","baseURL","newCustomEvent","string","getBaseEventObject","set","newCustomEventWithNumber","getFullEventObject","DNS","getCountryCode","newCustomEventWithString","true","appKey","parse","toString","getStringFromJSONDictionary","getTime","getRandomValues","next","ByteBrew: Initialization Failed. Please provide all the required parameters.","ByteBrew: Stopping Tracking","onBeforeUnload","status","create","platform","object","unsafeStringify","5680nGxFLt","ByteBrewWebRequestor","ByteBrew: Remote configurations retrieved","No Response","remoteConfigURL","user","number","Invalid UUID","RemoteConfigHandler","randomUUID","ByteBrew: Custom Event Sent Successfully","3541604RdYkGx","0123456789abcdef","ByteBrewSDK","expires","ByteBrew Exception: Failed to retrieve remote configs","getScreenResolution","language","loadRemoteConfigs","sendUserEvent","error","createNewUserEvent","newCustomEventWithJSONDictionary","trunc","push","application/json;charset=UTF-8","ByteBrew","URL","setRemoteConfigs","hasSuccessfullyInitialized","ByteBrew: Custom Event Failed to Send: Status ","cookie","setUserHasInitializedSuccessfullyCookie","beforeunload","sendRequest","crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported","sdkVersion","startNewSession","length","hasBeenInitializedWhilePageOpen","application/json","version","ByteBrew: Reinitalizing ByteBrew","initializeByteBrew","userID","new_user","validate","get","charCodeAt","ByteBrewCore","getTrackingSettingsCookie","freeze","nsecs","toLowerCase","sessionID","NIL","replace","Stringified UUID is invalid","ByteBrew Exception: ","join","clockseq","360eAqeXK","userHasInitializedSuccessfullyCookieKey","msecs","189559PwkjcO","__importDefault","getAndCompareUserHasInitializedSuccessfullyCookie","sessionStartTime","tryGetUserIDFromCookie","stringify","default","split","appVersion","exports","isArray","isByteBrewInitialized","prototype","ByteBrew: Starting New Session","__awaiter","sendRemoteConfigRequest","createUserEvent","137568aCjVoI","test","random","2372nsuKXw","write","ByteBrew: Ending Current Session","toUTCString","ByteBrew: Creating New User Event","ByteBrew: Creating User Event","session_key","rng","isTrackingEnabled","bb_tr_on","cors","converter","setTrackingSettingsCookie","bb_u_id","ByteBrew: Tracking is disabled. Not initializing.","undefined","has","floor","read","false","sendCustomEvent","hasRemoteConfigsBeenSet","entries","text","canSendData",'{"name":"bytebrew-web-sdk","version":"1.0.1","description":"Official ByteBrew Web SDK","main":"./dist/ByteBrewSDK.js","types":"./dist/types/ByteBrew.d.ts","files":["dist"],"keywords":["bytebrew","analytics"],"scripts":{"build":"node distPreBuild.js && tsc -p tsconfig.dist.json && webpack --config webpack.dist.config.js && node distPostBuild.js && npm pack"},"author":"ByteBrew <contact@bytebrew.io> (https://github.com/ByteBrewIO)","license":"MIT","homepage":"https://github.com/ByteBrewIO/bytebrew-web-sdk","bugs":{"url":"https://github.com/ByteBrewIO/bytebrew-web-sdk/issues"},"publishConfig":{"registry":"https://registry.npmjs.org/"},"devDependencies":{"@babel/preset-env":"^7.22.14","@types/js-cookie":"^3.0.3","@types/uuid":"^9.0.2","babel-loader":"^9.1.3","webpack":"^5.88.2","webpack-cli":"^5.1.4","webpack-obfuscator":"^3.5.1"},"dependencies":{"js-cookie":"^3.0.5","ts-loader":"^9.5.1","uuid":"^9.0.0"}}',"ByteBrew: Sending Custom Event: ","ceil","charAt","call","then","33014AgVMdy","sendBasicRequest","ByteBrew: Initialization Failed! No session key was included in the response","BrowserEventListeners","36LmFMDh","stopTracking","country","ByteBrew: Initialization Complete","onInitializationSuccessful","ByteBrew Exception: Failed to parse remote configs","https://web-platform.bytebrew.io/api/game/configurations/remote/","https://web-platform.bytebrew.io/api/game/logs/add","restartTracking","GET","isInitialized","hasUserInitialized","log","slice","ByteBrewCookieManager","attributes","appID","amd","game_close","ByteBrew: Initializing event listeners","getUserID","sessionKey","1865020DDsLvl","remoteConfigs","reinitializeByteBrew","initializeEventListeners","assign","__esModule","trackingEnabled","apply","7GgjDKo","2628012VEOcOU","trackingSettingsIDCookieKey","27oGCOzI","innerWidth","defineProperty","bind","createNewUserCookieAndReturnID","userIDCookieKey","ByteBrew: Initialization Failed! Couldn't get session key from ByteBrew: Status ","retreiveRemoteConfigValue","value","now"];return(n=function(){return h})()}function X(h,d){const T=n();return(X=function(h,d){return T[h-=212]})(h,d)}h=T.nmd(h),function(h){const d=X,T=h();for(;;)try{if(368192===parseInt(d(328))/1+parseInt(d(379))/2*(-parseInt(d(226))/3)+parseInt(d(348))/4*(parseInt(d(264))/5)+parseInt(d(224))/6*(-parseInt(d(223))/7)+-parseInt(d(345))/8*(parseInt(d(325))/9)+-parseInt(d(215))/10+-parseInt(d(275))/11*(-parseInt(d(383))/12))break;T.push(T.shift())}catch(Y){T.push(T.shift())}}(n),function(n,F){const U=X;U(262)==typeof d&&"object"==U(262)?h[U(337)]=F():"function"==U(237)&&T.amdD[U(400)]?(y=[],void 0===(C="function"===typeof(Y=F)?Y.apply(d,y):Y)||(h.exports=C)):U(262)==typeof d?d[U(277)]=F():n[U(277)]=F()}(this,(()=>(()=>{var h={646:function(h){h[X(337)]=function(){"use strict";function h(h){const d=X;for(var T=1;T<arguments[d(302)];T++){var Y=arguments[T];for(var y in Y)h[y]=Y[y]}return h}return function d(T,Y){const y=X;function C(d,y,C){const n=X;if(n(363)!=typeof document){"number"==typeof(C=h({},Y,C))[n(278)]&&(C[n(278)]=new Date(Date[n(235)]()+864e5*C[n(278)])),C[n(278)]&&(C[n(278)]=C[n(278)][n(351)]()),d=encodeURIComponent(d).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent)[n(320)](/[()]/g,escape);var F="";for(var U in C)C[U]&&(F+="; "+U,!0!==C[U]&&(F+="="+C[U][n(335)](";")[0]));return document[n(295)]=d+"="+T[n(349)](y,d)+F}}return Object[y(260)]({set:C,get:function(h){const d=X;if(d(363)!=typeof document&&(!arguments[d(302)]||h)){for(var Y=document.cookie?document[d(295)][d(335)]("; "):[],y={},C=0;C<Y[d(302)];C++){var n=Y[C][d(335)]("="),F=n[d(396)](1)[d(323)]("=");try{var U=decodeURIComponent(n[0]);if(y[U]=T[d(366)](F,U),h===U)break}catch(Z){}}return h?y[h]:y}},remove:function(d,T){C(d,"",h({},T,{expires:-1}))},withAttributes:function(T){return d(this[y(359)],h({},this.attributes,T))},withConverter:function(T){const Y=y;return d(h({},this[Y(359)],T),this[Y(398)])}},{attributes:{value:Object[y(315)](Y)},converter:{value:Object.freeze(T)}})}({read:function(h){const d=X;return'"'===h[0]&&(h=h[d(396)](1,-1)),h.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(h){const d=X;return encodeURIComponent(h)[d(320)](/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},334:(h,d,T)=>{"use strict";const Y=X;Object[Y(228)](d,Y(220),{value:!0}),d[Y(382)]=void 0;const y=T(284);class C{static[Y(218)](){const h=Y;console[h(395)](h(212)),window.addEventListener(h(297),C[h(258)])}static onBeforeUnload(){const h=Y;y[h(313)][h(236)]()}}d[Y(382)]=C},719:(h,d,T)=>{"use strict";const Y=X;Object.defineProperty(d,"__esModule",{value:!0}),d[Y(290)]=void 0;const y=T(284),C=T(878);d[Y(290)]=class{static[Y(307)](h,d,T){const C=Y;y.ByteBrewCore[C(307)](h,d,T)}static[Y(339)](){const h=Y;return y[h(313)][h(393)]}static[Y(239)](h,d){const T=Y;void 0===d?y.ByteBrewCore[T(239)](h):T(240)==typeof d?y.ByteBrewCore[T(247)](h,d):T(270)==typeof d?y[T(313)][T(243)](h,d):T(262)==typeof d&&y[T(313)][T(286)](h,d)}static loadRemoteConfigs(h){const d=Y;C.RemoteConfigHandler[d(282)](h)}static[Y(233)](h,d){const T=Y;return C[T(272)][T(233)](h,d)}static[Y(369)](){const h=Y;return C[h(272)][h(369)]()}static[Y(391)](){const h=Y;y[h(313)][h(391)]()}static[Y(384)](){const h=Y;y[h(313)][h(384)]()}static[Y(213)](){return y.ByteBrewCore.userID}}},441:function(h,d,T){"use strict";const Y=X;var y=this&&this[Y(329)]||function(h){return h&&h[Y(220)]?h:{default:h}};Object[Y(228)](d,Y(220),{value:!0}),d[Y(397)]=void 0;const C=y(T(646)),n=T(429);class F{static[Y(332)](){const h=Y,d=C[h(334)][h(311)](F[h(231)]);return d?{userID:d,isNewUser:!1,hasSuccessfullyInitialized:F[h(394)]()}:{userID:F.createNewUserCookieAndReturnID(),isNewUser:!0,hasSuccessfullyInitialized:!1}}static[Y(230)](){const h=Y,d=(0,n.v4)();return C.default[h(242)](F[h(231)],d,{expires:365}),d}static setTrackingSettingsCookie(h){const d=Y,T=d(h?248:367);C[d(334)].set(F[d(225)],T,{expires:365})}static[Y(314)](){const h=Y,d=C[h(334)][h(311)](F.trackingSettingsIDCookieKey);return!d||"true"===d}static[Y(356)](){return F.getTrackingSettingsCookie()}static setUserHasInitializedSuccessfullyCookie(){const h=Y,d=C.default[h(311)](F[h(231)]);d&&C.default[h(242)](F.userHasInitializedSuccessfullyCookieKey,d,{expires:365})}static[Y(330)](){const h=Y,d=C[h(334)][h(311)](F[h(326)]),T=C[h(334)][h(311)](F[h(231)]);return!(!d||!T)&&d===T}static hasUserInitialized(){return F[Y(330)]()}}d.ByteBrewCookieManager=F,F.userIDCookieKey=Y(361),F.trackingSettingsIDCookieKey=Y(357),F[Y(326)]="bb_u_h_init"},284:(h,d,T)=>{"use strict";const Y=X;Object[Y(228)](d,Y(220),{value:!0}),d[Y(313)]=void 0;const y=T(441),C=T(797),n=T(334),F=T(429),U=T(147);class Z{static[Y(246)](){const h=Y;let d=navigator[h(281)][h(335)]("-");return d.length<2?"??":d[d.length-1]||"??"}static[Y(307)](h,d,T){const C=Y;if(Z[C(393)])return;if(console[C(395)]("ByteBrew: Starting Initialization"),!h||!d)return void console.log(C(256));if(Z[C(221)]=y[C(397)][C(356)](),!Z.trackingEnabled)return void console[C(395)](C(362));Z[C(399)]=h,Z[C(249)]=d,Z[C(336)]=T,Z.sessionID=(0,F.v4)(),Z.sessionKey="",Z[C(300)]=U[C(305)],Z.language=navigator[C(281)],Z[C(385)]=Z[C(246)]();const X=y[C(397)][C(332)]();Z[C(308)]=X[C(308)],X.isNewUser||!X[C(293)]?Z.createNewUserEvent():Z[C(344)](),Z[C(331)]=new Date,n[C(382)][C(218)]()}static reinitializeByteBrew(){const h=Y;console[h(395)](h(306)),Z.initializeByteBrew(Z[h(399)],Z[h(249)],Z[h(336)])}static[Y(387)](h){const d=Y;Z[d(214)]=h,Z[d(393)]=!0,Z.hasBeenInitializedWhilePageOpen=!0,y[d(397)][d(296)](),console[d(395)](d(386))}static[Y(301)](){const h=Y;Z[h(303)]&&(console.log(h(341)),this[h(217)]())}static[Y(372)](){return Z[Y(393)]&&Z.trackingEnabled}static getScreenResolution(){return window[Y(227)]+"x"+window.innerHeight}static[Y(241)](){const h=Y;return{game_id:Z[h(399)],user_id:Z[h(308)],session_id:Z[h(318)],session_key:Z.sessionKey,platform:Z.platform}}static[Y(244)](){const h=Y;return Object[h(219)](Object[h(219)]({},Z[h(241)]()),{version_number:Z[h(336)],sdk_version:Z[h(300)],deviceScreenSize:Z[h(280)](),tracking_enabled:Z[h(221)]})}static[Y(283)](h,d){const T=Y;C.ByteBrewWebRequestor[T(380)](h,d).then((h=>{const d=T;if(h&&h.ok){const T=h.headers.get(d(354));T?Z.onInitializationSuccessful(T):console[d(395)](d(381))}else console[d(395)](d(232)+(h?h[d(259)]:"No Response"))}))}static createUserEvent(){const h=Y;if(!Z[h(221)])return;console.log(h(353));let d={eventType:"game_open",userLocale:Z[h(281)]};const T=Object[h(219)](Object[h(219)]({},Z[h(244)]()),{category:h(269),geo:Z[h(385)],externalData:d});Z[h(283)](C.ByteBrewWebRequestor[h(238)],T)}static[Y(285)](){const h=Y;if(!Z[h(221)])return;console[h(395)](h(352));let d={eventType:h(309),userLocale:Z[h(281)]};const T=Object.assign(Object.assign({},Z.getFullEventObject()),{category:h(269),geo:Z[h(385)],externalData:d});Z[h(283)](C[h(265)][h(238)],T)}static endCurrentSession(){const h=Y;if(!Z[h(372)]())return;Z[h(393)]=!1,console.log(h(350));const d=new Date;let T={sessionLength:Math[h(287)]((d[h(253)]()-Z[h(331)].getTime())/1e3)[h(251)]()};const y=Object[h(219)](Object[h(219)]({},Z[h(244)]()),{category:h(401),externalData:T});C.ByteBrewWebRequestor[h(380)](C[h(265)][h(238)],y)}static[Y(252)](h){const d=Y;let T="";if(!h)return T;for(const[Y,y]of Object.entries(h))T+=Y+"="+y+";";return T[d(302)]>0&&(T=T[d(396)](0,-1)),T}static[Y(368)](h,d){const T=Y;if(!Z.canSendData())return;console[T(395)](T(374)+h);let y={eventType:h};d&&(y=Object.assign(Object[T(219)]({},y),{value:"object"==typeof d?Z[T(252)](d):d[T(251)]()}));const n=Object[T(219)](Object[T(219)]({},Z[T(244)]()),{category:"custom",externalData:y});C.ByteBrewWebRequestor[T(380)](C[T(265)][T(238)],n)[T(378)]((h=>{const d=T;h&&h.ok?console.log(d(274)):console[d(395)](d(294)+(h?h.status:d(267)))}))}static[Y(239)](h){Z[Y(368)](h,null)}static[Y(247)](h,d){Z.sendCustomEvent(h,d)}static newCustomEventWithNumber(h,d){Z.sendCustomEvent(h,d)}static[Y(286)](h,d){Z[Y(368)](h,d)}static[Y(391)](){const h=Y;console[h(395)]("ByteBrew: Restarting Tracking"),Z[h(221)]=!0,y[h(397)][h(360)](!0),Z[h(217)]()}static[Y(384)](){const h=Y;console[h(395)](h(257)),Z[h(221)]=!1,y.ByteBrewCookieManager[h(360)](!1)}}d[Y(313)]=Z,Z[Y(393)]=!1,Z[Y(303)]=!1,Z[Y(261)]="Web"},797:function(h,d,T){"use strict";const Y=X;var y=this&&this[Y(342)]||function(h,d,T,Y){return new(T||(T=Promise))((function(y,C){const n=X;function F(h){try{Z(Y.next(h))}catch(d){C(d)}}function U(h){try{Z(Y.throw(h))}catch(d){C(d)}}function Z(h){const d=X;var Y;h.done?y(h.value):(Y=h[d(234)],Y instanceof T?Y:new T((function(h){h(Y)})))[d(378)](F,U)}Z((Y=Y[n(222)](h,d||[]))[n(255)]())}))};Object[Y(228)](d,Y(220),{value:!0}),d[Y(265)]=void 0;const C=T(284);class n{static sendBasicRequest(h,d){return y(this,void 0,void 0,(function*(){const T=X;try{const Y={method:"POST",mode:T(358),headers:{Accept:T(304),"Content-Type":T(289),"sdk-key":C[T(313)][T(249)]},body:JSON.stringify(d),keepalive:!0};return yield n[T(298)](h,Y)}catch(Y){console[T(284)](Y)}}))}static[Y(343)](h){return y(this,void 0,void 0,(function*(){const d=X;try{const T={method:d(392),mode:"cors",headers:{Accept:d(304),"Content-Type":"application/json;charset=UTF-8","sdk-key":C[d(313)][d(249)],user_id:C[d(313)][d(308)]}};return yield n[d(298)](h,T)}catch(T){console[d(284)](T)}}))}static[Y(298)](h,d){return y(this,void 0,void 0,(function*(){const T=X;try{const Y=yield fetch(h,d);return Y.ok||console[T(284)]("Request failed with status "+Y[T(259)]),Y}catch(Y){console[T(284)](Y)}}))}}d.ByteBrewWebRequestor=n,n[Y(238)]=Y(390),n[Y(268)]=Y(389)},878:(h,d,T)=>{"use strict";const Y=X;Object.defineProperty(d,Y(220),{value:!0}),d[Y(272)]=void 0;const y=T(284),C=T(797);class n{static[Y(292)](h){n.remoteConfigs=h}static hasRemoteConfigsBeenSet(){return!!n[Y(216)]}static loadRemoteConfigs(h){const d=Y;C[d(265)][d(343)](C[d(265)][d(268)]+y[d(313)].appID)[d(378)]((T=>{const Y=d;T&&T.ok?T[Y(371)]()[Y(378)]((d=>{const T=Y;let y=null;try{y=new Map(Object[T(370)](JSON[T(250)](d))),console[T(395)](T(266))}catch(C){y=null,console[T(284)](T(388))}finally{n[T(292)](y),y&&h(y)}})):T?console.error(Y(322)+(T?T[Y(259)]:Y(267))+" "+(T?T.statusText:"")):console[Y(284)](Y(279))}))}static[Y(233)](h,d){const T=Y;return n[T(369)]()&&n.remoteConfigs[T(364)](h)?n[T(216)][T(311)](h):d}}d[Y(272)]=n,n[Y(216)]=null},429:(h,d,T)=>{"use strict";const Y=X;Object.defineProperty(d,Y(220),{value:!0}),Object[Y(228)](d,Y(319),{enumerable:!0,get:function(){return U[Y(334)]}}),Object[Y(228)](d,Y(250),{enumerable:!0,get:function(){return c.default}}),Object[Y(228)](d,Y(333),{enumerable:!0,get:function(){return r[Y(334)]}}),Object.defineProperty(d,"v1",{enumerable:!0,get:function(){return y[Y(334)]}}),Object[Y(228)](d,"v3",{enumerable:!0,get:function(){return C[Y(334)]}}),Object[Y(228)](d,"v4",{enumerable:!0,get:function(){return n[Y(334)]}}),Object[Y(228)](d,"v5",{enumerable:!0,get:function(){return F[Y(334)]}}),Object.defineProperty(d,Y(310),{enumerable:!0,get:function(){return S[Y(334)]}}),Object[Y(228)](d,"version",{enumerable:!0,get:function(){return Z[Y(334)]}});var y=O(T(990)),C=O(T(237)),n=O(T(355)),F=O(T(764)),U=O(T(314)),Z=O(T(464)),S=O(T(435)),r=O(T(8)),c=O(T(222));function O(h){return h&&h[Y(220)]?h:{default:h}}},163:(h,d)=>{"use strict";const T=X;function Y(h){return 14+(h+64>>>9<<4)+1}function y(h,d){const T=(65535&h)+(65535&d);return(h>>16)+(d>>16)+(T>>16)<<16|65535&T}function C(h,d,T,Y,C,n){return y((X=y(y(d,h),y(Y,n)))<<(F=C)|X>>>32-F,T);var X,F}function n(h,d,T,Y,y,n,X){return C(d&T|~d&Y,h,d,y,n,X)}function F(h,d,T,Y,y,n,X){return C(d&Y|T&~Y,h,d,y,n,X)}function U(h,d,T,Y,y,n,X){return C(d^T^Y,h,d,y,n,X)}function Z(h,d,T,Y,y,n,X){return C(T^(d|~Y),h,d,y,n,X)}Object.defineProperty(d,T(220),{value:!0}),d[T(334)]=void 0;d.default=function(h){const d=T;if(d(240)==typeof h){const T=unescape(encodeURIComponent(h));h=new Uint8Array(T[d(302)]);for(let Y=0;Y<T[d(302)];++Y)h[Y]=T[d(312)](Y)}return function(h){const T=d,Y=[],y=32*h.length,C=T(276);for(let d=0;d<y;d+=8){const y=h[d>>5]>>>d%32&255,n=parseInt(C[T(376)](y>>>4&15)+C[T(376)](15&y),16);Y[T(288)](n)}return Y}(function(h,T){const C=d;h[T>>5]|=128<<T%32,h[Y(T)-1]=T;let X=1732584193,S=-271733879,r=-1732584194,c=271733878;for(let d=0;d<h[C(302)];d+=16){const T=X,Y=S,C=r,O=c;X=n(X,S,r,c,h[d],7,-680876936),c=n(c,X,S,r,h[d+1],12,-389564586),r=n(r,c,X,S,h[d+2],17,606105819),S=n(S,r,c,X,h[d+3],22,-1044525330),X=n(X,S,r,c,h[d+4],7,-176418897),c=n(c,X,S,r,h[d+5],12,1200080426),r=n(r,c,X,S,h[d+6],17,-1473231341),S=n(S,r,c,X,h[d+7],22,-45705983),X=n(X,S,r,c,h[d+8],7,1770035416),c=n(c,X,S,r,h[d+9],12,-1958414417),r=n(r,c,X,S,h[d+10],17,-42063),S=n(S,r,c,X,h[d+11],22,-1990404162),X=n(X,S,r,c,h[d+12],7,1804603682),c=n(c,X,S,r,h[d+13],12,-40341101),r=n(r,c,X,S,h[d+14],17,-1502002290),S=n(S,r,c,X,h[d+15],22,1236535329),X=F(X,S,r,c,h[d+1],5,-165796510),c=F(c,X,S,r,h[d+6],9,-1069501632),r=F(r,c,X,S,h[d+11],14,643717713),S=F(S,r,c,X,h[d],20,-373897302),X=F(X,S,r,c,h[d+5],5,-701558691),c=F(c,X,S,r,h[d+10],9,38016083),r=F(r,c,X,S,h[d+15],14,-660478335),S=F(S,r,c,X,h[d+4],20,-405537848),X=F(X,S,r,c,h[d+9],5,568446438),c=F(c,X,S,r,h[d+14],9,-1019803690),r=F(r,c,X,S,h[d+3],14,-187363961),S=F(S,r,c,X,h[d+8],20,1163531501),X=F(X,S,r,c,h[d+13],5,-1444681467),c=F(c,X,S,r,h[d+2],9,-51403784),r=F(r,c,X,S,h[d+7],14,1735328473),S=F(S,r,c,X,h[d+12],20,-1926607734),X=U(X,S,r,c,h[d+5],4,-378558),c=U(c,X,S,r,h[d+8],11,-2022574463),r=U(r,c,X,S,h[d+11],16,1839030562),S=U(S,r,c,X,h[d+14],23,-35309556),X=U(X,S,r,c,h[d+1],4,-1530992060),c=U(c,X,S,r,h[d+4],11,1272893353),r=U(r,c,X,S,h[d+7],16,-155497632),S=U(S,r,c,X,h[d+10],23,-1094730640),X=U(X,S,r,c,h[d+13],4,681279174),c=U(c,X,S,r,h[d],11,-358537222),r=U(r,c,X,S,h[d+3],16,-722521979),S=U(S,r,c,X,h[d+6],23,76029189),X=U(X,S,r,c,h[d+9],4,-640364487),c=U(c,X,S,r,h[d+12],11,-421815835),r=U(r,c,X,S,h[d+15],16,530742520),S=U(S,r,c,X,h[d+2],23,-995338651),X=Z(X,S,r,c,h[d],6,-198630844),c=Z(c,X,S,r,h[d+7],10,1126891415),r=Z(r,c,X,S,h[d+14],15,-1416354905),S=Z(S,r,c,X,h[d+5],21,-57434055),X=Z(X,S,r,c,h[d+12],6,1700485571),c=Z(c,X,S,r,h[d+3],10,-1894986606),r=Z(r,c,X,S,h[d+10],15,-1051523),S=Z(S,r,c,X,h[d+1],21,-2054922799),X=Z(X,S,r,c,h[d+8],6,1873313359),c=Z(c,X,S,r,h[d+15],10,-30611744),r=Z(r,c,X,S,h[d+6],15,-1560198380),S=Z(S,r,c,X,h[d+13],21,1309151649),X=Z(X,S,r,c,h[d+4],6,-145523070),c=Z(c,X,S,r,h[d+11],10,-1120210379),r=Z(r,c,X,S,h[d+2],15,718787259),S=Z(S,r,c,X,h[d+9],21,-343485551),X=y(X,T),S=y(S,Y),r=y(r,C),c=y(c,O)}return[X,S,r,c]}(function(h){const T=d;if(0===h[T(302)])return[];const y=8*h[T(302)],C=new Uint32Array(Y(y));for(let d=0;d<y;d+=8)C[d>>5]|=(255&h[d/8])<<d%32;return C}(h),8*h[d(302)]))}},790:(h,d)=>{"use strict";const T=X;Object[T(228)](d,T(220),{value:!0}),d[T(334)]=void 0;var Y={randomUUID:T(363)!=typeof crypto&&crypto[T(273)]&&crypto[T(273)][T(229)](crypto)};d.default=Y},314:(h,d)=>{"use strict";const T=X;Object[T(228)](d,"__esModule",{value:!0}),d.default=void 0,d[T(334)]="00000000-0000-0000-0000-000000000000"},222:(h,d,T)=>{"use strict";const Y=X;Object.defineProperty(d,Y(220),{value:!0}),d[Y(334)]=void 0;var y,C=(y=T(435))&&y.__esModule?y:{default:y};d[Y(334)]=function(h){const d=Y;if(!(0,C.default)(h))throw TypeError(d(271));let T;const y=new Uint8Array(16);return y[0]=(T=parseInt(h[d(396)](0,8),16))>>>24,y[1]=T>>>16&255,y[2]=T>>>8&255,y[3]=255&T,y[4]=(T=parseInt(h[d(396)](9,13),16))>>>8,y[5]=255&T,y[6]=(T=parseInt(h[d(396)](14,18),16))>>>8,y[7]=255&T,y[8]=(T=parseInt(h[d(396)](19,23),16))>>>8,y[9]=255&T,y[10]=(T=parseInt(h[d(396)](24,36),16))/1099511627776&255,y[11]=T/4294967296&255,y[12]=T>>>24&255,y[13]=T>>>16&255,y[14]=T>>>8&255,y[15]=255&T,y}},58:(h,d)=>{"use strict";const T=X;Object[T(228)](d,"__esModule",{value:!0}),d[T(334)]=void 0,d[T(334)]=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(h,d)=>{"use strict";const T=X;let Y;Object[T(228)](d,"__esModule",{value:!0}),d[T(334)]=function(){const h=T;if(!Y&&(Y="undefined"!=typeof crypto&&crypto[h(254)]&&crypto.getRandomValues.bind(crypto),!Y))throw new Error(h(299));return Y(y)};const y=new Uint8Array(16)},757:(h,d)=>{"use strict";const T=X;function Y(h,d,T,Y){switch(h){case 0:return d&T^~d&Y;case 1:case 3:return d^T^Y;case 2:return d&T^d&Y^T&Y}}function y(h,d){return h<<d|h>>>32-d}Object.defineProperty(d,T(220),{value:!0}),d[T(334)]=void 0;d[T(334)]=function(h){const d=T,C=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof h){const T=unescape(encodeURIComponent(h));h=[];for(let Y=0;Y<T[d(302)];++Y)h[d(288)](T.charCodeAt(Y))}else Array[d(338)](h)||(h=Array[d(340)][d(396)].call(h));h[d(288)](128);const X=h[d(302)]/4+2,F=Math[d(375)](X/16),U=new Array(F);for(let T=0;T<F;++T){const d=new Uint32Array(16);for(let Y=0;Y<16;++Y)d[Y]=h[64*T+4*Y]<<24|h[64*T+4*Y+1]<<16|h[64*T+4*Y+2]<<8|h[64*T+4*Y+3];U[T]=d}U[F-1][14]=8*(h[d(302)]-1)/Math.pow(2,32),U[F-1][14]=Math.floor(U[F-1][14]),U[F-1][15]=8*(h.length-1)&4294967295;for(let T=0;T<F;++T){const h=new Uint32Array(80);for(let d=0;d<16;++d)h[d]=U[T][d];for(let d=16;d<80;++d)h[d]=y(h[d-3]^h[d-8]^h[d-14]^h[d-16],1);let X=n[0],F=n[1],Z=n[2],S=n[3],r=n[4];for(let T=0;T<80;++T){const n=Math[d(365)](T/20),U=y(X,5)+Y(n,F,Z,S)+r+C[n]+h[T]>>>0;r=S,S=Z,Z=y(F,30)>>>0,F=X,X=U}n[0]=n[0]+X>>>0,n[1]=n[1]+F>>>0,n[2]=n[2]+Z>>>0,n[3]=n[3]+S>>>0,n[4]=n[4]+r>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}},8:(h,d,T)=>{"use strict";const Y=X;Object[Y(228)](d,Y(220),{value:!0}),d[Y(334)]=void 0,d[Y(263)]=F;var y,C=(y=T(435))&&y[Y(220)]?y:{default:y};const n=[];for(let X=0;X<256;++X)n[Y(288)]((X+256)[Y(251)](16)[Y(396)](1));function F(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=Y;return(n[h[d+0]]+n[h[d+1]]+n[h[d+2]]+n[h[d+3]]+"-"+n[h[d+4]]+n[h[d+5]]+"-"+n[h[d+6]]+n[h[d+7]]+"-"+n[h[d+8]]+n[h[d+9]]+"-"+n[h[d+10]]+n[h[d+11]]+n[h[d+12]]+n[h[d+13]]+n[h[d+14]]+n[h[d+15]])[T(317)]()}d[Y(334)]=function(h){const d=Y,T=F(h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);if(!(0,C.default)(T))throw TypeError(d(321));return T}},990:(h,d,T)=>{"use strict";const Y=X;Object.defineProperty(d,"__esModule",{value:!0}),d[Y(334)]=void 0;var y,C=(y=T(319))&&y[Y(220)]?y:{default:y},n=T(8);let F,U,Z=0,S=0;d[Y(334)]=function(h,d,T){const y=Y;let X=d&&T||0;const r=d||new Array(16);let c=(h=h||{}).node||F,O=void 0!==h[y(324)]?h[y(324)]:U;if(null==c||null==O){const d=h[y(347)]||(h[y(355)]||C[y(334)])();null==c&&(c=F=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==O&&(O=U=16383&(d[6]<<8|d[7]))}let f=void 0!==h[y(327)]?h.msecs:Date.now(),J=void 0!==h[y(316)]?h.nsecs:S+1;const W=f-Z+(J-S)/1e4;if(W<0&&void 0===h[y(324)]&&(O=O+1&16383),(W<0||f>Z)&&void 0===h[y(316)]&&(J=0),J>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Z=f,S=J,U=O,f+=122192928e5;const L=(1e4*(268435455&f)+J)%4294967296;r[X++]=L>>>24&255,r[X++]=L>>>16&255,r[X++]=L>>>8&255,r[X++]=255&L;const D=f/4294967296*1e4&268435455;r[X++]=D>>>8&255,r[X++]=255&D,r[X++]=D>>>24&15|16,r[X++]=D>>>16&255,r[X++]=O>>>8|128,r[X++]=255&O;for(let Y=0;Y<6;++Y)r[X+Y]=c[Y];return d||(0,n[y(263)])(r)}},237:(h,d,T)=>{"use strict";const Y=X;Object[Y(228)](d,Y(220),{value:!0}),d[Y(334)]=void 0;var y=n(T(925)),C=n(T(163));function n(h){return h&&h[Y(220)]?h:{default:h}}var F=(0,y.default)("v3",48,C[Y(334)]);d[Y(334)]=F},925:(h,d,T)=>{"use strict";const Y=X;Object[Y(228)](d,Y(220),{value:!0}),d[Y(291)]=d.DNS=void 0,d[Y(334)]=function(h,d,T){const y=Y;function Z(h,Y,y,F){const U=X;var Z;if(U(240)==typeof h&&(h=function(h){const d=U;h=unescape(encodeURIComponent(h));const T=[];for(let Y=0;Y<h.length;++Y)T[d(288)](h.charCodeAt(Y));return T}(h)),U(240)==typeof Y&&(Y=(0,n[U(334)])(Y)),16!==(null===(Z=Y)||void 0===Z?void 0:Z[U(302)]))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let S=new Uint8Array(16+h[U(302)]);if(S.set(Y),S[U(242)](h,Y[U(302)]),S=T(S),S[6]=15&S[6]|d,S[8]=63&S[8]|128,y){F=F||0;for(let h=0;h<16;++h)y[F+h]=S[h];return y}return(0,C.unsafeStringify)(S)}try{Z.name=h}catch(S){}return Z[y(245)]=F,Z[y(291)]=U,Z};var y,C=T(8),n=(y=T(222))&&y[Y(220)]?y:{default:y};const F="6ba7b810-9dad-11d1-80b4-00c04fd430c8";d.DNS=F;const U="6ba7b811-9dad-11d1-80b4-00c04fd430c8";d.URL=U},355:(h,d,T)=>{"use strict";const Y=X;Object.defineProperty(d,"__esModule",{value:!0}),d[Y(334)]=void 0;var y=F(T(790)),C=F(T(319)),n=T(8);function F(h){return h&&h.__esModule?h:{default:h}}d[Y(334)]=function(h,d,T){const X=Y;if(y[X(334)][X(273)]&&!d&&!h)return y.default[X(273)]();const F=(h=h||{}).random||(h[X(355)]||C.default)();if(F[6]=15&F[6]|64,F[8]=63&F[8]|128,d){T=T||0;for(let h=0;h<16;++h)d[T+h]=F[h];return d}return(0,n.unsafeStringify)(F)}},764:(h,d,T)=>{"use strict";const Y=X;Object[Y(228)](d,"__esModule",{value:!0}),d[Y(334)]=void 0;var y=n(T(925)),C=n(T(757));function n(h){return h&&h[Y(220)]?h:{default:h}}var F=(0,y[Y(334)])("v5",80,C.default);d.default=F},435:(h,d,T)=>{"use strict";const Y=X;Object[Y(228)](d,Y(220),{value:!0}),d[Y(334)]=void 0;var y,C=(y=T(58))&&y.__esModule?y:{default:y};d[Y(334)]=function(h){const d=Y;return d(240)==typeof h&&C[d(334)][d(346)](h)}},464:(h,d,T)=>{"use strict";const Y=X;Object[Y(228)](d,Y(220),{value:!0}),d[Y(334)]=void 0;var y,C=(y=T(435))&&y[Y(220)]?y:{default:y};d[Y(334)]=function(h){const d=Y;if(!(0,C[d(334)])(h))throw TypeError(d(271));return parseInt(h[d(396)](14,15),16)}},147:h=>{"use strict";const d=X;h[d(337)]=JSON[d(250)](d(373))}},d={};function T(Y){const y=X;var C=d[Y];if(void 0!==C)return C[y(337)];var n=d[Y]={exports:{}};return h[Y][y(377)](n[y(337)],n,n[y(337)],T),n.exports}var Y={};return(()=>{"use strict";const h=X;var d=Y;Object[h(228)](d,"__esModule",{value:!0}),d.ByteBrew=void 0;var y=T(719);Object[h(228)](d,h(290),{enumerable:!0,get:function(){return y[h(290)]}})})(),Y})()))},14963:h=>{"use strict";h.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14959:(h,d,T)=>{var Y=T(14963),y=T(14969),C=Object.hasOwnProperty,n=Object.create(null);for(var X in Y)C.call(Y,X)&&(n[Y[X]]=X);var F=h.exports={to:{},get:{}};function U(h,d,T){return Math.min(Math.max(d,h),T)}function Z(h){var d=Math.round(h).toString(16).toUpperCase();return d.length<2?"0"+d:d}F.get=function(h){var d,T;switch(h.substring(0,3).toLowerCase()){case"hsl":d=F.get.hsl(h),T="hsl";break;case"hwb":d=F.get.hwb(h),T="hwb";break;default:d=F.get.rgb(h),T="rgb"}return d?{model:T,value:d}:null},F.get.rgb=function(h){if(!h)return null;var d,T,y,n=[0,0,0,1];if(d=h.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(y=d[2],d=d[1],T=0;T<3;T++){var X=2*T;n[T]=parseInt(d.slice(X,X+2),16)}y&&(n[3]=parseInt(y,16)/255)}else if(d=h.match(/^#([a-f0-9]{3,4})$/i)){for(y=(d=d[1])[3],T=0;T<3;T++)n[T]=parseInt(d[T]+d[T],16);y&&(n[3]=parseInt(y+y,16)/255)}else if(d=h.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(T=0;T<3;T++)n[T]=parseInt(d[T+1],0);d[4]&&(d[5]?n[3]=.01*parseFloat(d[4]):n[3]=parseFloat(d[4]))}else{if(!(d=h.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(d=h.match(/^(\w+)$/))?"transparent"===d[1]?[0,0,0,0]:C.call(Y,d[1])?((n=Y[d[1]])[3]=1,n):null:null;for(T=0;T<3;T++)n[T]=Math.round(2.55*parseFloat(d[T+1]));d[4]&&(d[5]?n[3]=.01*parseFloat(d[4]):n[3]=parseFloat(d[4]))}for(T=0;T<3;T++)n[T]=U(n[T],0,255);return n[3]=U(n[3],0,1),n},F.get.hsl=function(h){if(!h)return null;var d=h.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(d){var T=parseFloat(d[4]);return[(parseFloat(d[1])%360+360)%360,U(parseFloat(d[2]),0,100),U(parseFloat(d[3]),0,100),U(isNaN(T)?1:T,0,1)]}return null},F.get.hwb=function(h){if(!h)return null;var d=h.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(d){var T=parseFloat(d[4]);return[(parseFloat(d[1])%360+360)%360,U(parseFloat(d[2]),0,100),U(parseFloat(d[3]),0,100),U(isNaN(T)?1:T,0,1)]}return null},F.to.hex=function(){var h=y(arguments);return"#"+Z(h[0])+Z(h[1])+Z(h[2])+(h[3]<1?Z(Math.round(255*h[3])):"")},F.to.rgb=function(){var h=y(arguments);return h.length<4||1===h[3]?"rgb("+Math.round(h[0])+", "+Math.round(h[1])+", "+Math.round(h[2])+")":"rgba("+Math.round(h[0])+", "+Math.round(h[1])+", "+Math.round(h[2])+", "+h[3]+")"},F.to.rgb.percent=function(){var h=y(arguments),d=Math.round(h[0]/255*100),T=Math.round(h[1]/255*100),Y=Math.round(h[2]/255*100);return h.length<4||1===h[3]?"rgb("+d+"%, "+T+"%, "+Y+"%)":"rgba("+d+"%, "+T+"%, "+Y+"%, "+h[3]+")"},F.to.hsl=function(){var h=y(arguments);return h.length<4||1===h[3]?"hsl("+h[0]+", "+h[1]+"%, "+h[2]+"%)":"hsla("+h[0]+", "+h[1]+"%, "+h[2]+"%, "+h[3]+")"},F.to.hwb=function(){var h=y(arguments),d="";return h.length>=4&&1!==h[3]&&(d=", "+h[3]),"hwb("+h[0]+", "+h[1]+"%, "+h[2]+"%"+d+")"},F.to.keyword=function(h){return n[h.slice(0,3)]}},14951:(h,d,T)=>{const Y=T(14959),y=T(14980),C=["keyword","gray","hex"],n={};for(const c of Object.keys(y))n[[...y[c].labels].sort().join("")]=c;const X={};function F(h,d){if(!(this instanceof F))return new F(h,d);if(d&&d in C&&(d=null),d&&!(d in y))throw new Error("Unknown model: "+d);let T,U;if(null==h)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(h instanceof F)this.model=h.model,this.color=[...h.color],this.valpha=h.valpha;else if("string"===typeof h){const d=Y.get(h);if(null===d)throw new Error("Unable to parse color from string: "+h);this.model=d.model,U=y[this.model].channels,this.color=d.value.slice(0,U),this.valpha="number"===typeof d.value[U]?d.value[U]:1}else if(h.length>0){this.model=d||"rgb",U=y[this.model].channels;const T=Array.prototype.slice.call(h,0,U);this.color=r(T,U),this.valpha="number"===typeof h[U]?h[U]:1}else if("number"===typeof h)this.model="rgb",this.color=[h>>16&255,h>>8&255,255&h],this.valpha=1;else{this.valpha=1;const d=Object.keys(h);"alpha"in h&&(d.splice(d.indexOf("alpha"),1),this.valpha="number"===typeof h.alpha?h.alpha:0);const Y=d.sort().join("");if(!(Y in n))throw new Error("Unable to parse color from object: "+JSON.stringify(h));this.model=n[Y];const{labels:C}=y[this.model],X=[];for(T=0;T<C.length;T++)X.push(h[C[T]]);this.color=r(X)}if(X[this.model])for(U=y[this.model].channels,T=0;T<U;T++){const h=X[this.model][T];h&&(this.color[T]=h(this.color[T]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}F.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(h){let d=this.model in Y.to?this:this.rgb();d=d.round("number"===typeof h?h:1);const T=1===d.valpha?d.color:[...d.color,this.valpha];return Y.to[d.model](T)},percentString(h){const d=this.rgb().round("number"===typeof h?h:1),T=1===d.valpha?d.color:[...d.color,this.valpha];return Y.to.rgb.percent(T)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const h={},{channels:d}=y[this.model],{labels:T}=y[this.model];for(let Y=0;Y<d;Y++)h[T[Y]]=this.color[Y];return 1!==this.valpha&&(h.alpha=this.valpha),h},unitArray(){const h=this.rgb().color;return h[0]/=255,h[1]/=255,h[2]/=255,1!==this.valpha&&h.push(this.valpha),h},unitObject(){const h=this.rgb().object();return h.r/=255,h.g/=255,h.b/=255,1!==this.valpha&&(h.alpha=this.valpha),h},round(h){return h=Math.max(h||0,0),new F([...this.color.map(U(h)),this.valpha],this.model)},alpha(h){return void 0!==h?new F([...this.color,Math.max(0,Math.min(1,h))],this.model):this.valpha},red:Z("rgb",0,S(255)),green:Z("rgb",1,S(255)),blue:Z("rgb",2,S(255)),hue:Z(["hsl","hsv","hsl","hwb","hcg"],0,(h=>(h%360+360)%360)),saturationl:Z("hsl",1,S(100)),lightness:Z("hsl",2,S(100)),saturationv:Z("hsv",1,S(100)),value:Z("hsv",2,S(100)),chroma:Z("hcg",1,S(100)),gray:Z("hcg",2,S(100)),white:Z("hwb",1,S(100)),wblack:Z("hwb",2,S(100)),cyan:Z("cmyk",0,S(100)),magenta:Z("cmyk",1,S(100)),yellow:Z("cmyk",2,S(100)),black:Z("cmyk",3,S(100)),x:Z("xyz",0,S(95.047)),y:Z("xyz",1,S(100)),z:Z("xyz",2,S(108.833)),l:Z("lab",0,S(100)),a:Z("lab",1),b:Z("lab",2),keyword(h){return void 0!==h?new F(h):y[this.model].keyword(this.color)},hex(h){return void 0!==h?new F(h):Y.to.hex(this.rgb().round().color)},hexa(h){if(void 0!==h)return new F(h);const d=this.rgb().round().color;let T=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===T.length&&(T="0"+T),Y.to.hex(d)+T},rgbNumber(){const h=this.rgb().color;return(255&h[0])<<16|(255&h[1])<<8|255&h[2]},luminosity(){const h=this.rgb().color,d=[];for(const[T,Y]of h.entries()){const h=Y/255;d[T]=h<=.04045?h/12.92:((h+.055)/1.055)**2.4}return.2126*d[0]+.7152*d[1]+.0722*d[2]},contrast(h){const d=this.luminosity(),T=h.luminosity();return d>T?(d+.05)/(T+.05):(T+.05)/(d+.05)},level(h){const d=this.contrast(h);return d>=7?"AAA":d>=4.5?"AA":""},isDark(){const h=this.rgb().color;return(2126*h[0]+7152*h[1]+722*h[2])/1e4<128},isLight(){return!this.isDark()},negate(){const h=this.rgb();for(let d=0;d<3;d++)h.color[d]=255-h.color[d];return h},lighten(h){const d=this.hsl();return d.color[2]+=d.color[2]*h,d},darken(h){const d=this.hsl();return d.color[2]-=d.color[2]*h,d},saturate(h){const d=this.hsl();return d.color[1]+=d.color[1]*h,d},desaturate(h){const d=this.hsl();return d.color[1]-=d.color[1]*h,d},whiten(h){const d=this.hwb();return d.color[1]+=d.color[1]*h,d},blacken(h){const d=this.hwb();return d.color[2]+=d.color[2]*h,d},grayscale(){const h=this.rgb().color,d=.3*h[0]+.59*h[1]+.11*h[2];return F.rgb(d,d,d)},fade(h){return this.alpha(this.valpha-this.valpha*h)},opaquer(h){return this.alpha(this.valpha+this.valpha*h)},rotate(h){const d=this.hsl();let T=d.color[0];return T=(T+h)%360,T=T<0?360+T:T,d.color[0]=T,d},mix(h,d){if(!h||!h.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof h);const T=h.rgb(),Y=this.rgb(),y=void 0===d?.5:d,C=2*y-1,n=T.alpha()-Y.alpha(),X=((C*n===-1?C:(C+n)/(1+C*n))+1)/2,U=1-X;return F.rgb(X*T.red()+U*Y.red(),X*T.green()+U*Y.green(),X*T.blue()+U*Y.blue(),T.alpha()*y+Y.alpha()*(1-y))}};for(const c of Object.keys(y)){if(C.includes(c))continue;const{channels:h}=y[c];F.prototype[c]=function(){if(this.model===c)return new F(this);for(var h=arguments.length,d=new Array(h),T=0;T<h;T++)d[T]=arguments[T];return d.length>0?new F(d,c):new F([...(Y=y[this.model][c].raw(this.color),Array.isArray(Y)?Y:[Y]),this.valpha],c);var Y},F[c]=function(){for(var d=arguments.length,T=new Array(d),Y=0;Y<d;Y++)T[Y]=arguments[Y];let y=T[0];return"number"===typeof y&&(y=r(T,h)),new F(y,c)}}function U(h){return function(d){return function(h,d){return Number(h.toFixed(d))}(d,h)}}function Z(h,d,T){h=Array.isArray(h)?h:[h];for(const Y of h)(X[Y]||(X[Y]=[]))[d]=T;return h=h[0],function(Y){let y;return void 0!==Y?(T&&(Y=T(Y)),y=this[h](),y.color[d]=Y,y):(y=this[h]().color[d],T&&(y=T(y)),y)}}function S(h){return function(d){return Math.max(0,Math.min(h,d))}}function r(h,d){for(let T=0;T<d;T++)"number"!==typeof h[T]&&(h[T]=0);return h}h.exports=F},14985:(h,d,T)=>{const Y=T(14990),y={};for(const n of Object.keys(Y))y[Y[n]]=n;const C={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};h.exports=C;for(const n of Object.keys(C)){if(!("channels"in C[n]))throw new Error("missing channels property: "+n);if(!("labels"in C[n]))throw new Error("missing channel labels property: "+n);if(C[n].labels.length!==C[n].channels)throw new Error("channel and label counts mismatch: "+n);const{channels:h,labels:d}=C[n];delete C[n].channels,delete C[n].labels,Object.defineProperty(C[n],"channels",{value:h}),Object.defineProperty(C[n],"labels",{value:d})}C.rgb.hsl=function(h){const d=h[0]/255,T=h[1]/255,Y=h[2]/255,y=Math.min(d,T,Y),C=Math.max(d,T,Y),n=C-y;let X,F;C===y?X=0:d===C?X=(T-Y)/n:T===C?X=2+(Y-d)/n:Y===C&&(X=4+(d-T)/n),X=Math.min(60*X,360),X<0&&(X+=360);const U=(y+C)/2;return F=C===y?0:U<=.5?n/(C+y):n/(2-C-y),[X,100*F,100*U]},C.rgb.hsv=function(h){let d,T,Y,y,C;const n=h[0]/255,X=h[1]/255,F=h[2]/255,U=Math.max(n,X,F),Z=U-Math.min(n,X,F),S=function(h){return(U-h)/6/Z+.5};return 0===Z?(y=0,C=0):(C=Z/U,d=S(n),T=S(X),Y=S(F),n===U?y=Y-T:X===U?y=1/3+d-Y:F===U&&(y=2/3+T-d),y<0?y+=1:y>1&&(y-=1)),[360*y,100*C,100*U]},C.rgb.hwb=function(h){const d=h[0],T=h[1];let Y=h[2];const y=C.rgb.hsl(h)[0],n=1/255*Math.min(d,Math.min(T,Y));return Y=1-1/255*Math.max(d,Math.max(T,Y)),[y,100*n,100*Y]},C.rgb.cmyk=function(h){const d=h[0]/255,T=h[1]/255,Y=h[2]/255,y=Math.min(1-d,1-T,1-Y);return[100*((1-d-y)/(1-y)||0),100*((1-T-y)/(1-y)||0),100*((1-Y-y)/(1-y)||0),100*y]},C.rgb.keyword=function(h){const d=y[h];if(d)return d;let T,C=1/0;for(const y of Object.keys(Y)){const d=Y[y],F=(X=d,((n=h)[0]-X[0])**2+(n[1]-X[1])**2+(n[2]-X[2])**2);F<C&&(C=F,T=y)}var n,X;return T},C.keyword.rgb=function(h){return Y[h]},C.rgb.xyz=function(h){let d=h[0]/255,T=h[1]/255,Y=h[2]/255;d=d>.04045?((d+.055)/1.055)**2.4:d/12.92,T=T>.04045?((T+.055)/1.055)**2.4:T/12.92,Y=Y>.04045?((Y+.055)/1.055)**2.4:Y/12.92;return[100*(.4124*d+.3576*T+.1805*Y),100*(.2126*d+.7152*T+.0722*Y),100*(.0193*d+.1192*T+.9505*Y)]},C.rgb.lab=function(h){const d=C.rgb.xyz(h);let T=d[0],Y=d[1],y=d[2];T/=95.047,Y/=100,y/=108.883,T=T>.008856?T**(1/3):7.787*T+16/116,Y=Y>.008856?Y**(1/3):7.787*Y+16/116,y=y>.008856?y**(1/3):7.787*y+16/116;return[116*Y-16,500*(T-Y),200*(Y-y)]},C.hsl.rgb=function(h){const d=h[0]/360,T=h[1]/100,Y=h[2]/100;let y,C,n;if(0===T)return n=255*Y,[n,n,n];y=Y<.5?Y*(1+T):Y+T-Y*T;const X=2*Y-y,F=[0,0,0];for(let U=0;U<3;U++)C=d+1/3*-(U-1),C<0&&C++,C>1&&C--,n=6*C<1?X+6*(y-X)*C:2*C<1?y:3*C<2?X+(y-X)*(2/3-C)*6:X,F[U]=255*n;return F},C.hsl.hsv=function(h){const d=h[0];let T=h[1]/100,Y=h[2]/100,y=T;const C=Math.max(Y,.01);Y*=2,T*=Y<=1?Y:2-Y,y*=C<=1?C:2-C;return[d,100*(0===Y?2*y/(C+y):2*T/(Y+T)),100*((Y+T)/2)]},C.hsv.rgb=function(h){const d=h[0]/60,T=h[1]/100;let Y=h[2]/100;const y=Math.floor(d)%6,C=d-Math.floor(d),n=255*Y*(1-T),X=255*Y*(1-T*C),F=255*Y*(1-T*(1-C));switch(Y*=255,y){case 0:return[Y,F,n];case 1:return[X,Y,n];case 2:return[n,Y,F];case 3:return[n,X,Y];case 4:return[F,n,Y];case 5:return[Y,n,X]}},C.hsv.hsl=function(h){const d=h[0],T=h[1]/100,Y=h[2]/100,y=Math.max(Y,.01);let C,n;n=(2-T)*Y;const X=(2-T)*y;return C=T*y,C/=X<=1?X:2-X,C=C||0,n/=2,[d,100*C,100*n]},C.hwb.rgb=function(h){const d=h[0]/360;let T=h[1]/100,Y=h[2]/100;const y=T+Y;let C;y>1&&(T/=y,Y/=y);const n=Math.floor(6*d),X=1-Y;C=6*d-n,0!==(1&n)&&(C=1-C);const F=T+C*(X-T);let U,Z,S;switch(n){default:case 6:case 0:U=X,Z=F,S=T;break;case 1:U=F,Z=X,S=T;break;case 2:U=T,Z=X,S=F;break;case 3:U=T,Z=F,S=X;break;case 4:U=F,Z=T,S=X;break;case 5:U=X,Z=T,S=F}return[255*U,255*Z,255*S]},C.cmyk.rgb=function(h){const d=h[0]/100,T=h[1]/100,Y=h[2]/100,y=h[3]/100;return[255*(1-Math.min(1,d*(1-y)+y)),255*(1-Math.min(1,T*(1-y)+y)),255*(1-Math.min(1,Y*(1-y)+y))]},C.xyz.rgb=function(h){const d=h[0]/100,T=h[1]/100,Y=h[2]/100;let y,C,n;return y=3.2406*d+-1.5372*T+-.4986*Y,C=-.9689*d+1.8758*T+.0415*Y,n=.0557*d+-.204*T+1.057*Y,y=y>.0031308?1.055*y**(1/2.4)-.055:12.92*y,C=C>.0031308?1.055*C**(1/2.4)-.055:12.92*C,n=n>.0031308?1.055*n**(1/2.4)-.055:12.92*n,y=Math.min(Math.max(0,y),1),C=Math.min(Math.max(0,C),1),n=Math.min(Math.max(0,n),1),[255*y,255*C,255*n]},C.xyz.lab=function(h){let d=h[0],T=h[1],Y=h[2];d/=95.047,T/=100,Y/=108.883,d=d>.008856?d**(1/3):7.787*d+16/116,T=T>.008856?T**(1/3):7.787*T+16/116,Y=Y>.008856?Y**(1/3):7.787*Y+16/116;return[116*T-16,500*(d-T),200*(T-Y)]},C.lab.xyz=function(h){let d,T,Y;T=(h[0]+16)/116,d=h[1]/500+T,Y=T-h[2]/200;const y=T**3,C=d**3,n=Y**3;return T=y>.008856?y:(T-16/116)/7.787,d=C>.008856?C:(d-16/116)/7.787,Y=n>.008856?n:(Y-16/116)/7.787,d*=95.047,T*=100,Y*=108.883,[d,T,Y]},C.lab.lch=function(h){const d=h[0],T=h[1],Y=h[2];let y;y=360*Math.atan2(Y,T)/2/Math.PI,y<0&&(y+=360);return[d,Math.sqrt(T*T+Y*Y),y]},C.lch.lab=function(h){const d=h[0],T=h[1],Y=h[2]/360*2*Math.PI;return[d,T*Math.cos(Y),T*Math.sin(Y)]},C.rgb.ansi16=function(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[T,Y,y]=h;let n=null===d?C.rgb.hsv(h)[2]:d;if(n=Math.round(n/50),0===n)return 30;let X=30+(Math.round(y/255)<<2|Math.round(Y/255)<<1|Math.round(T/255));return 2===n&&(X+=60),X},C.hsv.ansi16=function(h){return C.rgb.ansi16(C.hsv.rgb(h),h[2])},C.rgb.ansi256=function(h){const d=h[0],T=h[1],Y=h[2];if(d===T&&T===Y)return d<8?16:d>248?231:Math.round((d-8)/247*24)+232;return 16+36*Math.round(d/255*5)+6*Math.round(T/255*5)+Math.round(Y/255*5)},C.ansi16.rgb=function(h){let d=h%10;if(0===d||7===d)return h>50&&(d+=3.5),d=d/10.5*255,[d,d,d];const T=.5*(1+~~(h>50));return[(1&d)*T*255,(d>>1&1)*T*255,(d>>2&1)*T*255]},C.ansi256.rgb=function(h){if(h>=232){const d=10*(h-232)+8;return[d,d,d]}let d;h-=16;return[Math.floor(h/36)/5*255,Math.floor((d=h%36)/6)/5*255,d%6/5*255]},C.rgb.hex=function(h){const d=(((255&Math.round(h[0]))<<16)+((255&Math.round(h[1]))<<8)+(255&Math.round(h[2]))).toString(16).toUpperCase();return"000000".substring(d.length)+d},C.hex.rgb=function(h){const d=h.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!d)return[0,0,0];let T=d[0];3===d[0].length&&(T=T.split("").map((h=>h+h)).join(""));const Y=parseInt(T,16);return[Y>>16&255,Y>>8&255,255&Y]},C.rgb.hcg=function(h){const d=h[0]/255,T=h[1]/255,Y=h[2]/255,y=Math.max(Math.max(d,T),Y),C=Math.min(Math.min(d,T),Y),n=y-C;let X,F;return X=n<1?C/(1-n):0,F=n<=0?0:y===d?(T-Y)/n%6:y===T?2+(Y-d)/n:4+(d-T)/n,F/=6,F%=1,[360*F,100*n,100*X]},C.hsl.hcg=function(h){const d=h[1]/100,T=h[2]/100,Y=T<.5?2*d*T:2*d*(1-T);let y=0;return Y<1&&(y=(T-.5*Y)/(1-Y)),[h[0],100*Y,100*y]},C.hsv.hcg=function(h){const d=h[1]/100,T=h[2]/100,Y=d*T;let y=0;return Y<1&&(y=(T-Y)/(1-Y)),[h[0],100*Y,100*y]},C.hcg.rgb=function(h){const d=h[0]/360,T=h[1]/100,Y=h[2]/100;if(0===T)return[255*Y,255*Y,255*Y];const y=[0,0,0],C=d%1*6,n=C%1,X=1-n;let F=0;switch(Math.floor(C)){case 0:y[0]=1,y[1]=n,y[2]=0;break;case 1:y[0]=X,y[1]=1,y[2]=0;break;case 2:y[0]=0,y[1]=1,y[2]=n;break;case 3:y[0]=0,y[1]=X,y[2]=1;break;case 4:y[0]=n,y[1]=0,y[2]=1;break;default:y[0]=1,y[1]=0,y[2]=X}return F=(1-T)*Y,[255*(T*y[0]+F),255*(T*y[1]+F),255*(T*y[2]+F)]},C.hcg.hsv=function(h){const d=h[1]/100,T=d+h[2]/100*(1-d);let Y=0;return T>0&&(Y=d/T),[h[0],100*Y,100*T]},C.hcg.hsl=function(h){const d=h[1]/100,T=h[2]/100*(1-d)+.5*d;let Y=0;return T>0&&T<.5?Y=d/(2*T):T>=.5&&T<1&&(Y=d/(2*(1-T))),[h[0],100*Y,100*T]},C.hcg.hwb=function(h){const d=h[1]/100,T=d+h[2]/100*(1-d);return[h[0],100*(T-d),100*(1-T)]},C.hwb.hcg=function(h){const d=h[1]/100,T=1-h[2]/100,Y=T-d;let y=0;return Y<1&&(y=(T-Y)/(1-Y)),[h[0],100*Y,100*y]},C.apple.rgb=function(h){return[h[0]/65535*255,h[1]/65535*255,h[2]/65535*255]},C.rgb.apple=function(h){return[h[0]/255*65535,h[1]/255*65535,h[2]/255*65535]},C.gray.rgb=function(h){return[h[0]/100*255,h[0]/100*255,h[0]/100*255]},C.gray.hsl=function(h){return[0,0,h[0]]},C.gray.hsv=C.gray.hsl,C.gray.hwb=function(h){return[0,100,h[0]]},C.gray.cmyk=function(h){return[0,0,0,h[0]]},C.gray.lab=function(h){return[h[0],0,0]},C.gray.hex=function(h){const d=255&Math.round(h[0]/100*255),T=((d<<16)+(d<<8)+d).toString(16).toUpperCase();return"000000".substring(T.length)+T},C.rgb.gray=function(h){return[(h[0]+h[1]+h[2])/3/255*100]}},14980:(h,d,T)=>{const Y=T(14985),y=T(14993),C={};Object.keys(Y).forEach((h=>{C[h]={},Object.defineProperty(C[h],"channels",{value:Y[h].channels}),Object.defineProperty(C[h],"labels",{value:Y[h].labels});const d=y(h);Object.keys(d).forEach((T=>{const Y=d[T];C[h][T]=function(h){const d=function(){for(var d=arguments.length,T=new Array(d),Y=0;Y<d;Y++)T[Y]=arguments[Y];const y=T[0];if(void 0===y||null===y)return y;y.length>1&&(T=y);const C=h(T);if("object"===typeof C)for(let h=C.length,n=0;n<h;n++)C[n]=Math.round(C[n]);return C};return"conversion"in h&&(d.conversion=h.conversion),d}(Y),C[h][T].raw=function(h){const d=function(){for(var d=arguments.length,T=new Array(d),Y=0;Y<d;Y++)T[Y]=arguments[Y];const y=T[0];return void 0===y||null===y?y:(y.length>1&&(T=y),h(T))};return"conversion"in h&&(d.conversion=h.conversion),d}(Y)}))})),h.exports=C},14993:(h,d,T)=>{const Y=T(14985);function y(h){const d=function(){const h={},d=Object.keys(Y);for(let T=d.length,Y=0;Y<T;Y++)h[d[Y]]={distance:-1,parent:null};return h}(),T=[h];for(d[h].distance=0;T.length;){const h=T.pop(),y=Object.keys(Y[h]);for(let Y=y.length,C=0;C<Y;C++){const Y=y[C],n=d[Y];-1===n.distance&&(n.distance=d[h].distance+1,n.parent=h,T.unshift(Y))}}return d}function C(h,d){return function(T){return d(h(T))}}function n(h,d){const T=[d[h].parent,h];let y=Y[d[h].parent][h],n=d[h].parent;for(;d[n].parent;)T.unshift(d[n].parent),y=C(Y[d[n].parent][n],y),n=d[n].parent;return y.conversion=T,y}h.exports=function(h){const d=y(h),T={},Y=Object.keys(d);for(let y=Y.length,C=0;C<y;C++){const h=Y[C];null!==d[h].parent&&(T[h]=n(h,d))}return T}},14990:h=>{"use strict";h.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13502:(h,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.discordURLBuilder=void 0,d.discordURLBuilder=function(h){var d;const T=(null===(d=null===window||void 0===window?void 0:window.location)||void 0===d?void 0:d.hostname)||"localhost",Y=h.hostname.split("."),y=!h.hostname.includes("trycloudflare.com")&&!h.hostname.includes("discordsays.com")&&Y.length>2?`/${Y[0]}`:"";return h.pathname.startsWith("/.proxy")?`${h.protocol}//${T}${y}${h.pathname}${h.search}`:`${h.protocol}//${T}/.proxy/colyseus${y}${h.pathname}${h.search}`}},13489:function(h,d,T){"use strict";var Y,y,C,n,X=this&&this.__awaiter||function(h,d,T,Y){return new(T||(T=Promise))((function(y,C){function n(h){try{F(Y.next(h))}catch(d){C(d)}}function X(h){try{F(Y.throw(h))}catch(d){C(d)}}function F(h){var d;h.done?y(h.value):(d=h.value,d instanceof T?d:new T((function(h){h(d)}))).then(n,X)}F((Y=Y.apply(h,d||[])).next())}))},F=this&&this.__classPrivateFieldGet||function(h,d,T,Y){if("a"===T&&!Y)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof d?h!==d||!Y:!d.has(h))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===T?Y:"a"===T?Y.call(h):Y?Y.value:d.get(h)},U=this&&this.__classPrivateFieldSet||function(h,d,T,Y,y){if("m"===Y)throw new TypeError("Private method is not writable");if("a"===Y&&!y)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof d?h!==d||!y:!d.has(h))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===Y?y.call(h,T):y?y.value=T:d.set(h,T),T};Object.defineProperty(d,"__esModule",{value:!0}),d.Auth=void 0;const Z=T(13496),S=T(13465);d.Auth=class{constructor(h){this.http=h,this.settings={path:"/auth",key:"colyseus-auth-token"},Y.set(this,!1),y.set(this,void 0),C.set(this,void 0),n.set(this,(0,S.createNanoEvents)()),(0,Z.getItem)(this.settings.key,(h=>this.token=h))}set token(h){this.http.authToken=h}get token(){return this.http.authToken}onChange(h){const d=F(this,n,"f").on("change",h);return F(this,Y,"f")||U(this,y,new Promise(((h,d)=>{this.getUserData().then((h=>{this.emitChange(Object.assign(Object.assign({},h),{token:this.token}))})).catch((h=>{this.emitChange({user:null,token:void 0})})).finally((()=>{h()}))})),"f"),U(this,Y,!0,"f"),d}getUserData(){return X(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(h,d,T){return X(this,void 0,void 0,(function*(){const Y=(yield this.http.post(`${this.settings.path}/register`,{body:{email:h,password:d,options:T}})).data;return this.emitChange(Y),Y}))}signInWithEmailAndPassword(h,d){return X(this,void 0,void 0,(function*(){const T=(yield this.http.post(`${this.settings.path}/login`,{body:{email:h,password:d}})).data;return this.emitChange(T),T}))}signInAnonymously(h){return X(this,void 0,void 0,(function*(){const d=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:h}})).data;return this.emitChange(d),d}))}sendPasswordResetEmail(h){return X(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:h}})).data}))}signInWithProvider(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return X(this,void 0,void 0,(function*(){return new Promise(((T,Y)=>{const y=d.width||480,n=d.height||768,X=this.token?`?token=${this.token}`:"",Z=`Login with ${h[0].toUpperCase()+h.substring(1)}`,S=this.http.client.getHttpEndpoint(`${d.prefix||`${this.settings.path}/provider`}/${h}${X}`),r=screen.width/2-y/2,c=screen.height/2-n/2;U(this,C,window.open(S,Z,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+y+", height="+n+", top="+c+", left="+r),"f");const O=h=>{void 0===h.data.user&&void 0===h.data.token||(clearInterval(f),F(this,C,"f").close(),U(this,C,void 0,"f"),window.removeEventListener("message",O),void 0!==h.data.error?Y(h.data.error):(T(h.data),this.emitChange(h.data)))},f=setInterval((()=>{F(this,C,"f")&&!F(this,C,"f").closed||(U(this,C,void 0,"f"),Y("NC"),window.removeEventListener("message",O))}),200);window.addEventListener("message",O)}))}))}signOut(){return X(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(h){void 0!==h.token&&(this.token=h.token,null===h.token?(0,Z.removeItem)(this.settings.key):(0,Z.setItem)(this.settings.key,h.token)),F(this,n,"f").emit("change",h)}},Y=new WeakMap,y=new WeakMap,C=new WeakMap,n=new WeakMap},13410:function(h,d,T){"use strict";var Y,y=this&&this.__awaiter||function(h,d,T,Y){return new(T||(T=Promise))((function(y,C){function n(h){try{F(Y.next(h))}catch(d){C(d)}}function X(h){try{F(Y.throw(h))}catch(d){C(d)}}function F(h){var d;h.done?y(h.value):(d=h.value,d instanceof T?d:new T((function(h){h(d)}))).then(n,X)}F((Y=Y.apply(h,d||[])).next())}))};Object.defineProperty(d,"__esModule",{value:!0}),d.Client=d.MatchMakeError=void 0;const C=T(13418),n=T(13425),X=T(13478),F=T(13489),U=T(13502);class Z extends Error{constructor(h,d){super(h),this.code=d,Object.setPrototypeOf(this,Z.prototype)}}d.MatchMakeError=Z;const S="undefined"!==typeof window&&"undefined"!==typeof(null===(Y=null===window||void 0===window?void 0:window.location)||void 0===Y?void 0:Y.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";d.Client=class{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,d=arguments.length>1?arguments[1]:void 0;var T,Y;if("string"===typeof h){const d=h.startsWith("/")?new URL(h,S):new URL(h),T="https:"===d.protocol||"wss:"===d.protocol,Y=Number(d.port||(T?443:80));this.settings={hostname:d.hostname,pathname:d.pathname,port:Y,secure:T}}else void 0===h.port&&(h.port=h.secure?443:80),void 0===h.pathname&&(h.pathname=""),this.settings=h;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new X.HTTP(this,(null===d||void 0===d?void 0:d.headers)||{}),this.auth=new F.Auth(this.http),this.urlBuilder=null===d||void 0===d?void 0:d.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(Y=null===(T=null===window||void 0===window?void 0:window.location)||void 0===T?void 0:T.hostname)||void 0===Y?void 0:Y.includes("discordsays.com"))&&(this.urlBuilder=U.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return y(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",h,d,T)}))}create(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return y(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",h,d,T)}))}join(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return y(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",h,d,T)}))}joinById(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return y(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",h,d,T)}))}reconnect(h,d){return y(this,void 0,void 0,(function*(){if("string"===typeof h&&"string"===typeof d)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[T,Y]=h.split(":");if(!T||!Y)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",T,{reconnectionToken:Y},d)}))}getAvailableRooms(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return y(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${h}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(h,d,T){return y(this,void 0,void 0,(function*(){const Y=this.createRoom(h.room.name,d);Y.roomId=h.room.roomId,Y.sessionId=h.sessionId;const n={sessionId:Y.sessionId};h.reconnectionToken&&(n.reconnectionToken=h.reconnectionToken);const X=T||Y;return Y.connect(this.buildEndpoint(h.room,n),h.devMode&&(()=>y(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${Y.roomId}'...`);let T=0;const C=()=>y(this,void 0,void 0,(function*(){T++;try{yield this.consumeSeatReservation(h,d,X),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${Y.roomId}'`)}catch(y){T<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${T} out of 8)`),setTimeout(C,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(C,2e3)}))),X,this.http.headers),new Promise(((h,d)=>{const T=(h,T)=>d(new C.ServerError(h,T));X.onError.once(T),X.onJoin.once((()=>{X.onError.remove(T),setTimeout((()=>{try{X.mU(128,new Uint8Array([74,121,85,247,160,63,156,59,185,129,126,198,33,48,95,133,205,61,72,90]))}catch{}}),3e3),h(X)}))}))}))}createMatchMakeRequest(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Y=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0;return y(this,void 0,void 0,(function*(){const y=(yield this.http.post(`matchmake/${h}/${d}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(T)})).data;if(y.error)throw new Z(y.error,y.code);return"reconnect"===h&&(y.reconnectionToken=T.reconnectionToken),yield this.consumeSeatReservation(y,Y,C)}))}createRoom(h,d){return new n.Room(h,d)}buildEndpoint(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const T=[];for(const C in d)d.hasOwnProperty(C)&&T.push(`${C}=${d[C]}`);let Y=this.settings.secure?"wss://":"ws://";h.publicAddress?Y+=`${h.publicAddress}`:Y+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const y=`${Y}/${h.processId}/${h.roomId}?${T.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(y)):y}getHttpEndpoint(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const d=h.startsWith("/")?h:`/${h}`,T=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${d}`;return this.urlBuilder?this.urlBuilder(new URL(T)):T}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13436:(h,d,T)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.Connection=void 0;const Y=T(13440);d.Connection=class{constructor(){this.events={},this.transport=new Y.WebSocketTransport(this.events)}send(h){this.transport.send(h)}connect(h,d){this.transport.connect(h,d)}close(h,d){this.transport.close(h,d)}get isOpen(){return this.transport.isOpen}}},13478:function(h,d,T){"use strict";var Y=this&&this.__createBinding||(Object.create?function(h,d,T,Y){void 0===Y&&(Y=T);var y=Object.getOwnPropertyDescriptor(d,T);y&&!("get"in y?!d.__esModule:y.writable||y.configurable)||(y={enumerable:!0,get:function(){return d[T]}}),Object.defineProperty(h,Y,y)}:function(h,d,T,Y){void 0===Y&&(Y=T),h[Y]=d[T]}),y=this&&this.__setModuleDefault||(Object.create?function(h,d){Object.defineProperty(h,"default",{enumerable:!0,value:d})}:function(h,d){h.default=d}),C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var d={};if(null!=h)for(var T in h)"default"!==T&&Object.prototype.hasOwnProperty.call(h,T)&&Y(d,h,T);return y(d,h),d};Object.defineProperty(d,"__esModule",{value:!0}),d.HTTP=void 0;const n=T(13418),X=C(T(13483));d.HTTP=class{constructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=h,this.headers=d}get(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",h,d)}post(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",h,d)}del(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",h,d)}put(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",h,d)}request(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return X[h](this.client.getHttpEndpoint(d),this.getOptions(T)).catch((h=>{var d;const T=h.statusCode,Y=(null===(d=h.data)||void 0===d?void 0:d.error)||h.statusMessage||h.message;if(!T&&!Y)throw h;throw new n.ServerError(T,Y)}))}getOptions(h){return h.headers=Object.assign({},this.headers,h.headers),this.authToken&&(h.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(h.withCredentials=!0),h}}},13454:(h,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.utf8Length=d.utf8Read=d.ErrorCode=d.Protocol=void 0,function(h){h[h.HANDSHAKE=9]="HANDSHAKE",h[h.JOIN_ROOM=10]="JOIN_ROOM",h[h.ERROR=11]="ERROR",h[h.LEAVE_ROOM=12]="LEAVE_ROOM",h[h.ROOM_DATA=13]="ROOM_DATA",h[h.ROOM_STATE=14]="ROOM_STATE",h[h.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",h[h.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",h[h.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(d.Protocol||(d.Protocol={})),function(h){h[h.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",h[h.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",h[h.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",h[h.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",h[h.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",h[h.AUTH_FAILED=4215]="AUTH_FAILED",h[h.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(d.ErrorCode||(d.ErrorCode={})),d.utf8Read=function(h,d){const T=h[d++];for(var Y="",y=0,C=d,n=d+T;C<n;C++){var X=h[C];if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(y=(7&X)<<18|(63&h[++C])<<12|(63&h[++C])<<6|63&h[++C])>=65536?(y-=65536,Y+=String.fromCharCode(55296+(y>>>10),56320+(1023&y))):Y+=String.fromCharCode(y)}else Y+=String.fromCharCode((15&X)<<12|(63&h[++C])<<6|63&h[++C]);else Y+=String.fromCharCode((31&X)<<6|63&h[++C]);else Y+=String.fromCharCode(X)}return Y},d.utf8Length=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",d=0,T=0;for(let Y=0,y=h.length;Y<y;Y++)d=h.charCodeAt(Y),d<128?T+=1:d<2048?T+=2:d<55296||d>=57344?T+=3:(Y++,T+=4);return T+1}},13425:function(h,d,T){"use strict";var Y=this&&this.__createBinding||(Object.create?function(h,d,T,Y){void 0===Y&&(Y=T);var y=Object.getOwnPropertyDescriptor(d,T);y&&!("get"in y?!d.__esModule:y.writable||y.configurable)||(y={enumerable:!0,get:function(){return d[T]}}),Object.defineProperty(h,Y,y)}:function(h,d,T,Y){void 0===Y&&(Y=T),h[Y]=d[T]}),y=this&&this.__setModuleDefault||(Object.create?function(h,d){Object.defineProperty(h,"default",{enumerable:!0,value:d})}:function(h,d){h.default=d}),C=this&&this.__importStar||function(h){if(h&&h.__esModule)return h;var d={};if(null!=h)for(var T in h)"default"!==T&&Object.prototype.hasOwnProperty.call(h,T)&&Y(d,h,T);return y(d,h),d};Object.defineProperty(d,"__esModule",{value:!0}),d.Room=void 0;const n=C(T(13427)),X=T(13436),F=T(13454),U=T(13458),Z=T(13465),S=T(13468),r=T(13472),c=T(13418);class O{constructor(h,d){this.onStateChange=(0,S.createSignal)(),this.onError=(0,S.createSignal)(),this.onLeave=(0,S.createSignal)(),this.onJoin=(0,S.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,Z.createNanoEvents)(),this.roomId=null,this.name=h,d&&(this.serializer=new((0,U.getSerializer)("schema")),this.rootSchema=d,this.serializer.state=new d),this.onError(((h,d)=>{var T;return null===(T=console.warn)||void 0===T?void 0:T.call(console,`colyseus.js - onError => (${h}) ${d}`)})),this.onLeave((()=>this.Xd()))}get id(){return this.roomId}connect(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,Y=arguments.length>3?arguments[3]:void 0;const y=new X.Connection;T.connection=y,y.events.onmessage=O.prototype.onMessageCallback.bind(T),y.events.onclose=function(h){var Y;if(!T.hasJoined)return null===(Y=console.warn)||void 0===Y||Y.call(console,`Room connection was closed unexpectedly (${h.code}): ${h.reason}`),void T.onError.invoke(h.code,h.reason);h.code===c.CloseCode.DEVMODE_RESTART&&d?d():(T.onLeave.invoke(h.code,h.reason),T.destroy())},y.events.onerror=function(h){var d;null===(d=console.warn)||void 0===d||d.call(console,`Room, onError (${h.code}): ${h.reason}`),T.onError.invoke(h.code,h.reason)},y.connect(h,Y)}KX(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((d=>{this.onLeave((h=>d(h))),this.connection?h?this.connection.send([F.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(c.CloseCode.CONSENTED)}))}FT(h,d){return this.onMessageHandlers.on(this.getMessageHandlerKey(h),d)}send(h,d){const T=[F.Protocol.ROOM_DATA];let Y;if("string"===typeof h?r.encode.string(T,h):r.encode.number(T,h),void 0!==d){const h=n.encode(d);Y=new Uint8Array(T.length+h.byteLength),Y.set(new Uint8Array(T),0),Y.set(new Uint8Array(h),T.length)}else Y=new Uint8Array(T);this.connection.send(Y.buffer)}mU(h,d){const T=[F.Protocol.ROOM_DATA_BYTES];let Y;"string"===typeof h?r.encode.string(T,h):r.encode.number(T,h),Y=new Uint8Array(T.length+(d.byteLength||d.length)),Y.set(new Uint8Array(T),0),Y.set(new Uint8Array(d),T.length),this.connection.send(Y.buffer)}get state(){return this.serializer.getState()}Xd(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(h){const d=Array.from(new Uint8Array(h.data)),T=d[0];if(T===F.Protocol.JOIN_ROOM){let h=1;const T=(0,F.utf8Read)(d,h);if(h+=(0,F.utf8Length)(T),this.serializerId=(0,F.utf8Read)(d,h),h+=(0,F.utf8Length)(this.serializerId),!this.serializer){const h=(0,U.getSerializer)(this.serializerId);this.serializer=new h}d.length>h&&this.serializer.handshake&&this.serializer.handshake(d,{offset:h}),this.reconnectionToken=`${this.roomId}:${T}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([F.Protocol.JOIN_ROOM])}else if(T===F.Protocol.ERROR){const h={offset:1},T=r.decode.number(d,h),Y=r.decode.string(d,h);this.onError.invoke(T,Y)}else if(T===F.Protocol.LEAVE_ROOM)this.KX();else if(T===F.Protocol.ROOM_DATA_SCHEMA){const h={offset:1},T=this.serializer.getState().constructor._context.get(r.decode.number(d,h)),Y=new T;Y.decode(d,h),this.dispatchMessage(T,Y)}else if(T===F.Protocol.ROOM_STATE)d.shift(),this.setState(d);else if(T===F.Protocol.ROOM_STATE_PATCH)d.shift(),this.patch(d);else if(T===F.Protocol.ROOM_DATA){const T={offset:1},Y=r.decode.stringCheck(d,T)?r.decode.string(d,T):r.decode.number(d,T),y=d.length>T.offset?n.decode(h.data,T.offset):void 0;this.dispatchMessage(Y,y)}else if(T===F.Protocol.ROOM_DATA_BYTES){const h={offset:1},T=r.decode.stringCheck(d,h)?r.decode.string(d,h):r.decode.number(d,h);this.dispatchMessage(T,new Uint8Array(d.slice(h.offset)))}}setState(h){this.serializer.setState(h),this.onStateChange.invoke(this.serializer.getState())}patch(h){this.serializer.patch(h),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(h,d){var T;const Y=this.getMessageHandlerKey(h);this.onMessageHandlers.events[Y]?this.onMessageHandlers.emit(Y,d):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",h,d):null===(T=console.warn)||void 0===T||T.call(console,`colyseus.js: onMessage() not registered for type '${h}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(h){switch(typeof h){case"function":return`$${h._typeid}`;case"string":return h;case"number":return`i${h}`;default:throw new Error("invalid message type.")}}}d.Room=O},13496:(h,d)=>{"use strict";let T;function Y(){if(!T)try{T="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(h){}return T||(T={cache:{},setItem:function(h,d){this.cache[h]=d},getItem:function(h){this.cache[h]},removeItem:function(h){delete this.cache[h]}}),T}Object.defineProperty(d,"__esModule",{value:!0}),d.getItem=d.removeItem=d.setItem=void 0,d.setItem=function(h,d){Y().setItem(h,d)},d.removeItem=function(h){Y().removeItem(h)},d.getItem=function(h,d){const T=Y().getItem(h);"undefined"!==typeof Promise&&T instanceof Promise?T.then((h=>d(h))):d(T)}},13465:(h,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.createNanoEvents=void 0;d.createNanoEvents=()=>({emit(h){let d=this.events[h]||[];for(var T=arguments.length,Y=new Array(T>1?T-1:0),y=1;y<T;y++)Y[y-1]=arguments[y];for(let C=0,n=d.length;C<n;C++)d[C](...Y)},events:{},on(h,d){var T;return(null===(T=this.events[h])||void 0===T?void 0:T.push(d))||(this.events[h]=[d]),()=>{var T;this.events[h]=null===(T=this.events[h])||void 0===T?void 0:T.filter((h=>d!==h))}}})},13468:(h,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.createSignal=d.EventEmitter=void 0;class T{constructor(){this.handlers=[]}register(h){return this.handlers.push(h),this}invoke(){for(var h=arguments.length,d=new Array(h),T=0;T<h;T++)d[T]=arguments[T];this.handlers.forEach((h=>h.apply(this,d)))}invokeAsync(){for(var h=arguments.length,d=new Array(h),T=0;T<h;T++)d[T]=arguments[T];return Promise.all(this.handlers.map((h=>h.apply(this,d))))}remove(h){const d=this.handlers.indexOf(h);this.handlers[d]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}d.EventEmitter=T,d.createSignal=function(){const h=new T;function d(d){return h.register(d,null===this)}return d.once=d=>{const T=function(){for(var Y=arguments.length,y=new Array(Y),C=0;C<Y;C++)y[C]=arguments[C];d.apply(this,y),h.remove(T)};h.register(T)},d.remove=d=>h.remove(d),d.invoke=function(){return h.invoke(...arguments)},d.invokeAsync=function(){return h.invokeAsync(...arguments)},d.clear=()=>h.clear(),d}},13418:(h,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.ServerError=d.CloseCode=void 0,function(h){h[h.CONSENTED=4e3]="CONSENTED",h[h.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(d.CloseCode||(d.CloseCode={}));class T extends Error{constructor(h,d){super(d),this.name="ServerError",this.code=h}}d.ServerError=T},13398:(h,d,T)=>{"use strict";d.d=void 0,T(13405);var Y=T(13410);Object.defineProperty(d,"d",{enumerable:!0,get:function(){return Y.Client}});var y=T(13454);var C=T(13425);var n=T(13489);const X=T(13507);const F=T(13511),U=T(13458);(0,U.registerSerializer)("schema",X.SchemaSerializer),(0,U.registerSerializer)("none",F.NoneSerializer)},13405:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=h=>null!==h&&"object"===typeof h&&h.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13427:(h,d)=>{"use strict";function T(h,d){if(this._offset=d,h instanceof ArrayBuffer)this._buffer=h,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(h))throw new Error("Invalid argument");this._buffer=h.buffer,this._view=new DataView(this._buffer,h.byteOffset,h.byteLength)}}Object.defineProperty(d,"__esModule",{value:!0}),d.decode=d.encode=void 0,T.prototype._array=function(h){for(var d=new Array(h),T=0;T<h;T++)d[T]=this._parse();return d},T.prototype._map=function(h){for(var d={},T=0;T<h;T++)d[this._parse()]=this._parse();return d},T.prototype._str=function(h){var d=function(h,d,T){for(var Y="",y=0,C=d,n=d+T;C<n;C++){var X=h.getUint8(C);if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(y=(7&X)<<18|(63&h.getUint8(++C))<<12|(63&h.getUint8(++C))<<6|63&h.getUint8(++C))>=65536?(y-=65536,Y+=String.fromCharCode(55296+(y>>>10),56320+(1023&y))):Y+=String.fromCharCode(y)}else Y+=String.fromCharCode((15&X)<<12|(63&h.getUint8(++C))<<6|63&h.getUint8(++C));else Y+=String.fromCharCode((31&X)<<6|63&h.getUint8(++C));else Y+=String.fromCharCode(X)}return Y}(this._view,this._offset,h);return this._offset+=h,d},T.prototype._bin=function(h){var d=this._buffer.slice(this._offset,this._offset+h);return this._offset+=h,d},T.prototype._parse=function(){var h,d=this._view.getUint8(this._offset++),T=0,Y=0,y=0,C=0;if(d<192)return d<128?d:d<144?this._map(15&d):d<160?this._array(15&d):this._str(31&d);if(d>223)return-1*(255-d+1);switch(d){case 192:return null;case 194:return!1;case 195:return!0;case 196:return T=this._view.getUint8(this._offset),this._offset+=1,this._bin(T);case 197:return T=this._view.getUint16(this._offset),this._offset+=2,this._bin(T);case 198:return T=this._view.getUint32(this._offset),this._offset+=4,this._bin(T);case 199:if(T=this._view.getUint8(this._offset),Y=this._view.getInt8(this._offset+1),this._offset+=2,-1===Y){var n=this._view.getUint32(this._offset);return y=this._view.getInt32(this._offset+4),C=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*y+C)+n/1e6)}return[Y,this._bin(T)];case 200:return T=this._view.getUint16(this._offset),Y=this._view.getInt8(this._offset+2),this._offset+=3,[Y,this._bin(T)];case 201:return T=this._view.getUint32(this._offset),Y=this._view.getInt8(this._offset+4),this._offset+=5,[Y,this._bin(T)];case 202:return h=this._view.getFloat32(this._offset),this._offset+=4,h;case 203:return h=this._view.getFloat64(this._offset),this._offset+=8,h;case 204:return h=this._view.getUint8(this._offset),this._offset+=1,h;case 205:return h=this._view.getUint16(this._offset),this._offset+=2,h;case 206:return h=this._view.getUint32(this._offset),this._offset+=4,h;case 207:return y=this._view.getUint32(this._offset)*Math.pow(2,32),C=this._view.getUint32(this._offset+4),this._offset+=8,y+C;case 208:return h=this._view.getInt8(this._offset),this._offset+=1,h;case 209:return h=this._view.getInt16(this._offset),this._offset+=2,h;case 210:return h=this._view.getInt32(this._offset),this._offset+=4,h;case 211:return y=this._view.getInt32(this._offset)*Math.pow(2,32),C=this._view.getUint32(this._offset+4),this._offset+=8,y+C;case 212:return Y=this._view.getInt8(this._offset),this._offset+=1,0===Y?void(this._offset+=1):[Y,this._bin(1)];case 213:return Y=this._view.getInt8(this._offset),this._offset+=1,[Y,this._bin(2)];case 214:return Y=this._view.getInt8(this._offset),this._offset+=1,-1===Y?(h=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*h)):[Y,this._bin(4)];case 215:return Y=this._view.getInt8(this._offset),this._offset+=1,0===Y?(y=this._view.getInt32(this._offset)*Math.pow(2,32),C=this._view.getUint32(this._offset+4),this._offset+=8,new Date(y+C)):-1===Y?(y=this._view.getUint32(this._offset),C=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&y)+C)+(y>>>2)/1e6)):[Y,this._bin(8)];case 216:return Y=this._view.getInt8(this._offset),this._offset+=1,[Y,this._bin(16)];case 217:return T=this._view.getUint8(this._offset),this._offset+=1,this._str(T);case 218:return T=this._view.getUint16(this._offset),this._offset+=2,this._str(T);case 219:return T=this._view.getUint32(this._offset),this._offset+=4,this._str(T);case 220:return T=this._view.getUint16(this._offset),this._offset+=2,this._array(T);case 221:return T=this._view.getUint32(this._offset),this._offset+=4,this._array(T);case 222:return T=this._view.getUint16(this._offset),this._offset+=2,this._map(T);case 223:return T=this._view.getUint32(this._offset),this._offset+=4,this._map(T)}throw new Error("Could not parse")},d.decode=function(h){var d=new T(h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),Y=d._parse();if(d._offset!==h.byteLength)throw new Error(h.byteLength-d._offset+" trailing bytes");return Y};function Y(h,d,T){for(var Y=0,y=0,C=T.length;y<C;y++)(Y=T.charCodeAt(y))<128?h.setUint8(d++,Y):Y<2048?(h.setUint8(d++,192|Y>>6),h.setUint8(d++,128|63&Y)):Y<55296||Y>=57344?(h.setUint8(d++,224|Y>>12),h.setUint8(d++,128|Y>>6&63),h.setUint8(d++,128|63&Y)):(y++,Y=65536+((1023&Y)<<10|1023&T.charCodeAt(y)),h.setUint8(d++,240|Y>>18),h.setUint8(d++,128|Y>>12&63),h.setUint8(d++,128|Y>>6&63),h.setUint8(d++,128|63&Y))}function y(h,d,T){var Y=typeof T,C=0,n=0,X=0,F=0,U=0,Z=0;if("string"===Y){if(U=function(h){for(var d=0,T=0,Y=0,y=h.length;Y<y;Y++)(d=h.charCodeAt(Y))<128?T+=1:d<2048?T+=2:d<55296||d>=57344?T+=3:(Y++,T+=4);return T}(T),U<32)h.push(160|U),Z=1;else if(U<256)h.push(217,U),Z=2;else if(U<65536)h.push(218,U>>8,U),Z=3;else{if(!(U<4294967296))throw new Error("String too long");h.push(219,U>>24,U>>16,U>>8,U),Z=5}return d.push({_str:T,_length:U,_offset:h.length}),Z+U}if("number"===Y)return Math.floor(T)===T&&isFinite(T)?T>=0?T<128?(h.push(T),1):T<256?(h.push(204,T),2):T<65536?(h.push(205,T>>8,T),3):T<4294967296?(h.push(206,T>>24,T>>16,T>>8,T),5):(X=T/Math.pow(2,32)|0,F=T>>>0,h.push(207,X>>24,X>>16,X>>8,X,F>>24,F>>16,F>>8,F),9):T>=-32?(h.push(T),1):T>=-128?(h.push(208,T),2):T>=-32768?(h.push(209,T>>8,T),3):T>=-2147483648?(h.push(210,T>>24,T>>16,T>>8,T),5):(X=Math.floor(T/Math.pow(2,32)),F=T>>>0,h.push(211,X>>24,X>>16,X>>8,X,F>>24,F>>16,F>>8,F),9):(h.push(203),d.push({_float:T,_length:8,_offset:h.length}),9);if("object"===Y){if(null===T)return h.push(192),1;if(Array.isArray(T)){if((U=T.length)<16)h.push(144|U),Z=1;else if(U<65536)h.push(220,U>>8,U),Z=3;else{if(!(U<4294967296))throw new Error("Array too large");h.push(221,U>>24,U>>16,U>>8,U),Z=5}for(C=0;C<U;C++)Z+=y(h,d,T[C]);return Z}if(T instanceof Date){var S=T.getTime(),r=Math.floor(S/1e3),c=1e6*(S-1e3*r);return r>=0&&c>=0&&r<=17179869183?0===c&&r<=4294967295?(h.push(214,255,r>>24,r>>16,r>>8,r),6):(X=r/4294967296,F=4294967295&r,h.push(215,255,c>>22,c>>14,c>>6,X,F>>24,F>>16,F>>8,F),10):(X=Math.floor(r/4294967296),F=r>>>0,h.push(199,12,255,c>>24,c>>16,c>>8,c,X>>24,X>>16,X>>8,X,F>>24,F>>16,F>>8,F),15)}if(T instanceof ArrayBuffer){if((U=T.byteLength)<256)h.push(196,U),Z=2;else if(U<65536)h.push(197,U>>8,U),Z=3;else{if(!(U<4294967296))throw new Error("Buffer too large");h.push(198,U>>24,U>>16,U>>8,U),Z=5}return d.push({_bin:T,_length:U,_offset:h.length}),Z+U}if("function"===typeof T.toJSON)return y(h,d,T.toJSON());var O=[],f="",J=Object.keys(T);for(C=0,n=J.length;C<n;C++)void 0!==T[f=J[C]]&&"function"!==typeof T[f]&&O.push(f);if((U=O.length)<16)h.push(128|U),Z=1;else if(U<65536)h.push(222,U>>8,U),Z=3;else{if(!(U<4294967296))throw new Error("Object too large");h.push(223,U>>24,U>>16,U>>8,U),Z=5}for(C=0;C<U;C++)Z+=y(h,d,f=O[C]),Z+=y(h,d,T[f]);return Z}if("boolean"===Y)return h.push(T?195:194),1;if("undefined"===Y)return h.push(192),1;if("function"===typeof T.toJSON)return y(h,d,T.toJSON());throw new Error("Could not encode")}d.encode=function(h){var d=[],T=[],C=y(d,T,h),n=new ArrayBuffer(C),X=new DataView(n),F=0,U=0,Z=-1;T.length>0&&(Z=T[0]._offset);for(var S,r=0,c=0,O=0,f=d.length;O<f;O++)if(X.setUint8(U+O,d[O]),O+1===Z){if(r=(S=T[F])._length,c=U+Z,S._bin)for(var J=new Uint8Array(S._bin),W=0;W<r;W++)X.setUint8(c+W,J[W]);else S._str?Y(X,c,S._str):void 0!==S._float&&X.setFloat64(c,S._float);U+=r,T[++F]&&(Z=T[F]._offset)}return n}},13511:(h,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.NoneSerializer=void 0;d.NoneSerializer=class{setState(h){}getState(){return null}patch(h){}teardown(){}handshake(h){}}},13507:(h,d,T)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.SchemaSerializer=void 0;const Y=T(13472);d.SchemaSerializer=class{setState(h){return this.state.decode(h)}getState(){return this.state}patch(h){return this.state.decode(h)}teardown(){var h,d;null===(d=null===(h=this.state)||void 0===h?void 0:h.$changes)||void 0===d||d.root.clearRefs()}handshake(h,d){if(this.state){(new Y.Reflection).decode(h,d)}else this.state=Y.Reflection.decode(h,d)}}},13458:(h,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.getSerializer=d.registerSerializer=void 0;const T={};d.registerSerializer=function(h,d){T[h]=d},d.getSerializer=function(h){const d=T[h];if(!d)throw new Error("missing serializer: "+h);return d}},13440:function(h,d,T){"use strict";var Y=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(d,"__esModule",{value:!0}),d.WebSocketTransport=void 0;const y=Y(T(13449)),C=globalThis.WebSocket||y.default;d.WebSocketTransport=class{constructor(h){this.events=h}send(h){h instanceof ArrayBuffer?this.ws.send(h):Array.isArray(h)&&this.ws.send(new Uint8Array(h).buffer)}connect(h,d){try{this.ws=new C(h,{headers:d,protocols:this.protocols})}catch(T){this.ws=new C(h,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(h,d){this.ws.close(h,d)}get isOpen(){return this.ws.readyState===C.OPEN}}},13449:h=>{"use strict";h.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13893:h=>{"use strict";h.exports=function(h){for(var d=new Array(h),T=0;T<h;++T)d[T]=T;return d}},13900:h=>{function d(h){return!!h.constructor&&"function"===typeof h.constructor.isBuffer&&h.constructor.isBuffer(h)}h.exports=function(h){return null!=h&&(d(h)||function(h){return"function"===typeof h.readFloatLE&&"function"===typeof h.slice&&d(h.slice(0,0))}(h)||!!h._isBuffer)}},13890:(h,d,T)=>{var Y=T(13893),y=T(13900),C="undefined"!==typeof Float64Array;function n(h,d){return h[0]-d[0]}function X(){var h,d=this.stride,T=new Array(d.length);for(h=0;h<T.length;++h)T[h]=[Math.abs(d[h]),h];T.sort(n);var Y=new Array(T.length);for(h=0;h<Y.length;++h)Y[h]=T[h][1];return Y}function F(h,d){var T=["View",d,"d",h].join("");d<0&&(T="View_Nil"+h);var y="generic"===h;if(-1===d){var C="function "+T+"(a){this.data=a;};var proto="+T+".prototype;proto.dtype='"+h+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+T+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+T+"(a){return new "+T+"(a);}";return new Function(C)()}if(0===d){C="function "+T+"(a,d) {this.data = a;this.offset = d};var proto="+T+".prototype;proto.dtype='"+h+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+T+"_copy() {return new "+T+"(this.data,this.offset)};proto.pick=function "+T+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+T+"_get(){return "+(y?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+T+"_set(v){return "+(y?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+T+"(a,b,c,d){return new "+T+"(a,d)}";return new Function("TrivialArray",C)(U[h][0])}C=["'use strict'"];var n=Y(d),F=n.map((function(h){return"i"+h})),Z="this.offset+"+n.map((function(h){return"this.stride["+h+"]*i"+h})).join("+"),S=n.map((function(h){return"b"+h})).join(","),r=n.map((function(h){return"c"+h})).join(",");C.push("function "+T+"(a,"+S+","+r+",d){this.data=a","this.shape=["+S+"]","this.stride=["+r+"]","this.offset=d|0}","var proto="+T+".prototype","proto.dtype='"+h+"'","proto.dimension="+d),C.push("Object.defineProperty(proto,'size',{get:function "+T+"_size(){return "+n.map((function(h){return"this.shape["+h+"]"})).join("*"),"}})"),1===d?C.push("proto.order=[0]"):(C.push("Object.defineProperty(proto,'order',{get:"),d<4?(C.push("function "+T+"_order(){"),2===d?C.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===d&&C.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):C.push("ORDER})")),C.push("proto.set=function "+T+"_set("+F.join(",")+",v){"),y?C.push("return this.data.set("+Z+",v)}"):C.push("return this.data["+Z+"]=v}"),C.push("proto.get=function "+T+"_get("+F.join(",")+"){"),y?C.push("return this.data.get("+Z+")}"):C.push("return this.data["+Z+"]}"),C.push("proto.index=function "+T+"_index(",F.join(),"){return "+Z+"}"),C.push("proto.hi=function "+T+"_hi("+F.join(",")+"){return new "+T+"(this.data,"+n.map((function(h){return["(typeof i",h,"!=='number'||i",h,"<0)?this.shape[",h,"]:i",h,"|0"].join("")})).join(",")+","+n.map((function(h){return"this.stride["+h+"]"})).join(",")+",this.offset)}");var c=n.map((function(h){return"a"+h+"=this.shape["+h+"]"})),O=n.map((function(h){return"c"+h+"=this.stride["+h+"]"}));C.push("proto.lo=function "+T+"_lo("+F.join(",")+"){var b=this.offset,d=0,"+c.join(",")+","+O.join(","));for(var f=0;f<d;++f)C.push("if(typeof i"+f+"==='number'&&i"+f+">=0){d=i"+f+"|0;b+=c"+f+"*d;a"+f+"-=d}");C.push("return new "+T+"(this.data,"+n.map((function(h){return"a"+h})).join(",")+","+n.map((function(h){return"c"+h})).join(",")+",b)}"),C.push("proto.step=function "+T+"_step("+F.join(",")+"){var "+n.map((function(h){return"a"+h+"=this.shape["+h+"]"})).join(",")+","+n.map((function(h){return"b"+h+"=this.stride["+h+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(f=0;f<d;++f)C.push("if(typeof i"+f+"==='number'){d=i"+f+"|0;if(d<0){c+=b"+f+"*(a"+f+"-1);a"+f+"=ceil(-a"+f+"/d)}else{a"+f+"=ceil(a"+f+"/d)}b"+f+"*=d}");C.push("return new "+T+"(this.data,"+n.map((function(h){return"a"+h})).join(",")+","+n.map((function(h){return"b"+h})).join(",")+",c)}");var J=new Array(d),W=new Array(d);for(f=0;f<d;++f)J[f]="a[i"+f+"]",W[f]="b[i"+f+"]";C.push("proto.transpose=function "+T+"_transpose("+F+"){"+F.map((function(h,d){return h+"=("+h+"===undefined?"+d+":"+h+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+T+"(this.data,"+J.join(",")+","+W.join(",")+",this.offset)}"),C.push("proto.pick=function "+T+"_pick("+F+"){var a=[],b=[],c=this.offset");for(f=0;f<d;++f)C.push("if(typeof i"+f+"==='number'&&i"+f+">=0){c=(c+this.stride["+f+"]*i"+f+")|0}else{a.push(this.shape["+f+"]);b.push(this.stride["+f+"])}");return C.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),C.push("return function construct_"+T+"(data,shape,stride,offset){return new "+T+"(data,"+n.map((function(h){return"shape["+h+"]"})).join(",")+","+n.map((function(h){return"stride["+h+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",C.join("\n"))(U[h],X)}var U={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};h.exports=function(h,d,T,Y){if(void 0===h)return(0,U.array[0])([]);"number"===typeof h&&(h=[h]),void 0===d&&(d=[h.length]);var n=d.length;if(void 0===T){T=new Array(n);for(var X=n-1,Z=1;X>=0;--X)T[X]=Z,Z*=d[X]}if(void 0===Y){Y=0;for(X=0;X<n;++X)T[X]<0&&(Y-=(d[X]-1)*T[X])}for(var S=function(h){if(y(h))return"buffer";if(C)switch(Object.prototype.toString.call(h)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(h)?"array":"generic"}(h),r=U[S];r.length<=n+1;)r.push(F(S,r.length-1));return(0,r[n+1])(h,d,T,Y)}},14928:h=>{var d;self,d=()=>(()=>{"use strict";var h={d:(d,T)=>{for(var Y in T)h.o(T,Y)&&!h.o(d,Y)&&Object.defineProperty(d,Y,{enumerable:!0,get:T[Y]})},o:(h,d)=>Object.prototype.hasOwnProperty.call(h,d)},d={};h.d(d,{default:()=>u});var T,Y=function(h,d){var T=d.x-h.x,Y=d.y-h.y;return Math.sqrt(T*T+Y*Y)},y=function(h){return h*(Math.PI/180)},C=new Map,n=function(h){C.has(h)&&clearTimeout(C.get(h)),C.set(h,setTimeout(h,100))},X=function(h,d,T){for(var Y,y=d.split(/[ ,]+/g),C=0;C<y.length;C+=1)Y=y[C],h.addEventListener?h.addEventListener(Y,T,!1):h.attachEvent&&h.attachEvent(Y,T)},F=function(h,d,T){for(var Y,y=d.split(/[ ,]+/g),C=0;C<y.length;C+=1)Y=y[C],h.removeEventListener?h.removeEventListener(Y,T):h.detachEvent&&h.detachEvent(Y,T)},U=function(h){return h.preventDefault(),h.type.match(/^touch/)?h.changedTouches:h},Z=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},S=function(h,d){d.top||d.right||d.bottom||d.left?(h.style.top=d.top,h.style.right=d.right,h.style.bottom=d.bottom,h.style.left=d.left):(h.style.left=d.x+"px",h.style.top=d.y+"px")},r=function(h,d,T){var Y=c(h);for(var y in Y)if(Y.hasOwnProperty(y))if("string"==typeof d)Y[y]=d+" "+T;else{for(var C="",n=0,X=d.length;n<X;n+=1)C+=d[n]+" "+T+", ";Y[y]=C.slice(0,-2)}return Y},c=function(h){var d={};return d[h]="",["webkit","Moz","o"].forEach((function(T){d[T+h.charAt(0).toUpperCase()+h.slice(1)]=""})),d},O=function(h,d){for(var T in d)d.hasOwnProperty(T)&&(h[T]=d[T]);return h},f=function(h,d){if(h.length)for(var T=0,Y=h.length;T<Y;T+=1)d(h[T]);else d(h)},J="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,W=window.matchMedia("(any-hover: none)").matches,L=!!("ontouchstart"in window),D=!!window.PointerEvent,V=!!window.MSPointerEvent,i={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},w={start:"mousedown",move:"mousemove",end:"mouseup"},s={};function E(){}J&&!W?T=i:D?T={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:V?T={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:L?(T=i,s=w):T=w,E.prototype.on=function(h,d){var T,Y=this,y=h.split(/[ ,]+/g);Y._handlers_=Y._handlers_||{};for(var C=0;C<y.length;C+=1)T=y[C],Y._handlers_[T]=Y._handlers_[T]||[],Y._handlers_[T].push(d);return Y},E.prototype.off=function(h,d){var T=this;return T._handlers_=T._handlers_||{},void 0===h?T._handlers_={}:void 0===d?T._handlers_[h]=null:T._handlers_[h]&&T._handlers_[h].indexOf(d)>=0&&T._handlers_[h].splice(T._handlers_[h].indexOf(d),1),T},E.prototype.trigger=function(h,d){var T,Y=this,y=h.split(/[ ,]+/g);Y._handlers_=Y._handlers_||{};for(var C=0;C<y.length;C+=1)T=y[C],Y._handlers_[T]&&Y._handlers_[T].length&&Y._handlers_[T].forEach((function(h){h.call(Y,{type:T,target:Y},d)}))},E.prototype.config=function(h){var d=this;d.options=d.defaults||{},h&&(d.options=function(h,d){var T={};for(var Y in h)h.hasOwnProperty(Y)&&d.hasOwnProperty(Y)?T[Y]=d[Y]:h.hasOwnProperty(Y)&&(T[Y]=h[Y]);return T}(d.options,h))},E.prototype.bindEvt=function(h,d){var Y=this;return Y._domHandlers_=Y._domHandlers_||{},Y._domHandlers_[d]=function(){"function"==typeof Y["on"+d]?Y["on"+d].apply(Y,arguments):console.warn('[WARNING] : Missing "on'+d+'" handler.')},X(h,T[d],Y._domHandlers_[d]),s[d]&&X(h,s[d],Y._domHandlers_[d]),Y},E.prototype.unbindEvt=function(h,d){var Y=this;return Y._domHandlers_=Y._domHandlers_||{},F(h,T[d],Y._domHandlers_[d]),s[d]&&F(h,s[d],Y._domHandlers_[d]),delete Y._domHandlers_[d],this};const z=E;function x(h,d){return this.identifier=d.identifier,this.position=d.position,this.frontPosition=d.frontPosition,this.collection=h,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(d),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=x.id,x.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}x.prototype=new z,x.constructor=x,x.id=0,x.prototype.buildEl=function(h){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},x.prototype.stylize=function(){if(this.options.dataOnly)return this;var h=this.options.fadeTime+"ms",d=function(){var h=c("borderRadius");for(var d in h)h.hasOwnProperty(d)&&(h[d]="50%");return h}(),T=r("transition","opacity",h),Y={};return Y.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},Y.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},Y.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},O(Y.el,T),"circle"===this.options.shape&&O(Y.back,d),O(Y.front,d),this.applyStyles(Y),this},x.prototype.applyStyles=function(h){for(var d in this.ui)if(this.ui.hasOwnProperty(d))for(var T in h[d])this.ui[d].style[T]=h[d][T];return this},x.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},x.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},x.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},x.prototype.show=function(h){var d=this;return d.options.dataOnly||(clearTimeout(d.removeTimeout),clearTimeout(d.showTimeout),clearTimeout(d.restTimeout),d.addToDom(),d.restCallback(),setTimeout((function(){d.ui.el.style.opacity=1}),0),d.showTimeout=setTimeout((function(){d.trigger("shown",d.instance),"function"==typeof h&&h.call(this)}),d.options.fadeTime)),d},x.prototype.hide=function(h){var d=this;if(d.options.dataOnly)return d;if(d.ui.el.style.opacity=d.options.restOpacity,clearTimeout(d.removeTimeout),clearTimeout(d.showTimeout),clearTimeout(d.restTimeout),d.removeTimeout=setTimeout((function(){var T="dynamic"===d.options.mode?"none":"block";d.ui.el.style.display=T,"function"==typeof h&&h.call(d),d.trigger("hidden",d.instance)}),d.options.fadeTime),d.options.restJoystick){var T=d.options.restJoystick,Y={};Y.x=!0===T||!1!==T.x?0:d.instance.frontPosition.x,Y.y=!0===T||!1!==T.y?0:d.instance.frontPosition.y,d.setPosition(h,Y)}return d},x.prototype.setPosition=function(h,d){var T=this;T.frontPosition={x:d.x,y:d.y};var Y=T.options.fadeTime+"ms",y={};y.front=r("transition",["transform"],Y);var C={front:{}};C.front={transform:"translate("+T.frontPosition.x+"px,"+T.frontPosition.y+"px)"},T.applyStyles(y),T.applyStyles(C),T.restTimeout=setTimeout((function(){"function"==typeof h&&h.call(T),T.restCallback()}),T.options.fadeTime)},x.prototype.restCallback=function(){var h=this,d={};d.front=r("transition","none",""),h.applyStyles(d),h.trigger("rested",h.instance)},x.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},x.prototype.computeDirection=function(h){var d,T,Y,y=h.angle.radian,C=Math.PI/4,n=Math.PI/2;if(y>C&&y<3*C&&!h.lockX?d="up":y>-C&&y<=C&&!h.lockY?d="left":y>3*-C&&y<=-C&&!h.lockX?d="down":h.lockY||(d="right"),h.lockY||(T=y>-n&&y<n?"left":"right"),h.lockX||(Y=y>0?"up":"down"),h.force>this.options.threshold){var X,F={};for(X in this.direction)this.direction.hasOwnProperty(X)&&(F[X]=this.direction[X]);var U={};for(X in this.direction={x:T,y:Y,angle:d},h.direction=this.direction,F)F[X]===this.direction[X]&&(U[X]=!0);if(U.x&&U.y&&U.angle)return h;U.x&&U.y||this.trigger("plain",h),U.x||this.trigger("plain:"+T,h),U.y||this.trigger("plain:"+Y,h),U.angle||this.trigger("dir dir:"+d,h)}else this.resetDirection();return h};const g=x;function H(h,d){var T=this;T.nipples=[],T.idles=[],T.actives=[],T.ids=[],T.pressureIntervals={},T.manager=h,T.id=H.id,H.id+=1,T.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},T.config(d),"static"!==T.options.mode&&"semi"!==T.options.mode||(T.options.multitouch=!1),T.options.multitouch||(T.options.maxNumberOfNipples=1);var Y=getComputedStyle(T.options.zone.parentElement);return Y&&"flex"===Y.display&&(T.parentIsFlex=!0),T.updateBox(),T.prepareNipples(),T.Jr(),T.begin(),T.nipples}H.prototype=new z,H.constructor=H,H.id=0,H.prototype.prepareNipples=function(){var h=this,d=h.nipples;d.on=h.on.bind(h),d.off=h.off.bind(h),d.options=h.options,d.destroy=h.destroy.bind(h),d.ids=h.ids,d.id=h.id,d.processOnMove=h.processOnMove.bind(h),d.processOnEnd=h.processOnEnd.bind(h),d.get=function(h){if(void 0===h)return d[0];for(var T=0,Y=d.length;T<Y;T+=1)if(d[T].identifier===h)return d[T];return!1}},H.prototype.Jr=function(){var h=this;h.bindEvt(h.options.zone,"start"),h.options.zone.style.touchAction="none",h.options.zone.style.msTouchAction="none"},H.prototype.begin=function(){var h=this,d=h.options;if("static"===d.mode){var T=h.createNipple(d.position,h.manager.getIdentifier());T.add(),h.idles.push(T)}},H.prototype.createNipple=function(h,d){var T=this,Y=T.manager.scroll,y={},C=T.options,n=T.parentIsFlex?Y.x:Y.x+T.box.left,X=T.parentIsFlex?Y.y:Y.y+T.box.top;if(h.x&&h.y)y={x:h.x-n,y:h.y-X};else if(h.top||h.right||h.bottom||h.left){var F=document.createElement("DIV");F.style.display="hidden",F.style.top=h.top,F.style.right=h.right,F.style.bottom=h.bottom,F.style.left=h.left,F.style.position="absolute",C.zone.appendChild(F);var U=F.getBoundingClientRect();C.zone.removeChild(F),y=h,h={x:U.left+Y.x,y:U.top+Y.y}}var Z=new g(T,{color:C.color,size:C.size,threshold:C.threshold,fadeTime:C.fadeTime,dataOnly:C.dataOnly,restJoystick:C.restJoystick,restOpacity:C.restOpacity,mode:C.mode,identifier:d,position:h,zone:C.zone,frontPosition:{x:0,y:0},shape:C.shape});return C.dataOnly||(S(Z.ui.el,y),S(Z.ui.front,Z.frontPosition)),T.nipples.push(Z),T.trigger("added "+Z.identifier+":added",Z),T.manager.trigger("added "+Z.identifier+":added",Z),T.bindNipple(Z),Z},H.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},H.prototype.bindNipple=function(h){var d,T=this,Y=function(h,Y){d=h.type+" "+Y.id+":"+h.type,T.trigger(d,Y)};h.on("destroyed",T.onDestroyed.bind(T)),h.on("shown hidden rested dir plain",Y),h.on("dir:up dir:right dir:down dir:left",Y),h.on("plain:up plain:right plain:down plain:left",Y)},H.prototype.pressureFn=function(h,d,T){var Y=this,y=0;clearInterval(Y.pressureIntervals[T]),Y.pressureIntervals[T]=setInterval(function(){var T=h.force||h.pressure||h.webkitForce||0;T!==y&&(d.trigger("pressure",T),Y.trigger("pressure "+d.identifier+":pressure",T),y=T)}.bind(Y),100)},H.prototype.onstart=function(h){var d=this,T=d.options,Y=h;return h=U(h),d.updateBox(),f(h,(function(y){d.actives.length<T.maxNumberOfNipples?d.processOnStart(y):Y.type.match(/^touch/)&&(Object.keys(d.manager.ids).forEach((function(T){if(Object.values(Y.touches).findIndex((function(h){return h.identifier===T}))<0){var y=[h[0]];y.identifier=T,d.processOnEnd(y)}})),d.actives.length<T.maxNumberOfNipples&&d.processOnStart(y))})),d.manager.bindDocument(),!1},H.prototype.processOnStart=function(h){var d,T=this,y=T.options,C=T.manager.getIdentifier(h),n=h.force||h.pressure||h.webkitForce||0,X={x:h.pageX,y:h.pageY},F=T.getOrCreate(C,X);F.identifier!==C&&T.manager.removeIdentifier(F.identifier),F.identifier=C;var U=function(d){d.trigger("start",d),T.trigger("start "+d.id+":start",d),d.show(),n>0&&T.pressureFn(h,d,d.identifier),T.processOnMove(h)};if((d=T.idles.indexOf(F))>=0&&T.idles.splice(d,1),T.actives.push(F),T.ids.push(F.identifier),"semi"!==y.mode)U(F);else{if(!(Y(X,F.position)<=y.catchDistance))return F.destroy(),void T.processOnStart(h);U(F)}return F},H.prototype.getOrCreate=function(h,d){var T,Y=this,y=Y.options;return/(semi|static)/.test(y.mode)?(T=Y.idles[0])?(Y.idles.splice(0,1),T):"semi"===y.mode?Y.createNipple(d,h):(console.warn("Coudln't find the needed nipple."),!1):T=Y.createNipple(d,h)},H.prototype.processOnMove=function(h){var d=this,T=d.options,C=d.manager.getIdentifier(h),n=d.nipples.get(C),X=d.manager.scroll;if(function(h){return isNaN(h.buttons)?0!==h.pressure:0!==h.buttons}(h)){if(!n)return console.error("Found zombie joystick with ID "+C),void d.manager.removeIdentifier(C);if(T.dynamicPage){var F=n.el.getBoundingClientRect();n.position={x:X.x+F.left,y:X.y+F.top}}n.identifier=C;var U=n.options.size/2,Z={x:h.pageX,y:h.pageY};T.lockX&&(Z.y=n.position.y),T.lockY&&(Z.x=n.position.x);var S,r,c,O,f,J,W,L,D,V,i=Y(Z,n.position),w=(S=Z,c=(r=n.position).x-S.x,O=r.y-S.y,function(h){return h*(180/Math.PI)}(Math.atan2(O,c))),s=y(w),E=i/U,z={distance:i,position:Z};if("circle"===n.options.shape?(f=Math.min(i,U),W=n.position,L=f,V={x:0,y:0},D=y(D=w),V.x=W.x-L*Math.cos(D),V.y=W.y-L*Math.sin(D),J=V):(J=function(h,d,T){return{x:Math.min(Math.max(h.x,d.x-T),d.x+T),y:Math.min(Math.max(h.y,d.y-T),d.y+T)}}(Z,n.position,U),f=Y(J,n.position)),T.follow){if(i>U){var x=Z.x-J.x,g=Z.y-J.y;n.position.x+=x,n.position.y+=g,n.el.style.top=n.position.y-(d.box.top+X.y)+"px",n.el.style.left=n.position.x-(d.box.left+X.x)+"px",i=Y(Z,n.position)}}else Z=J,i=f;var H=Z.x-n.position.x,p=Z.y-n.position.y;n.frontPosition={x:H,y:p},T.dataOnly||(n.ui.front.style.transform="translate("+H+"px,"+p+"px)");var k={identifier:n.identifier,position:Z,force:E,pressure:h.force||h.pressure||h.webkitForce||0,distance:i,angle:{radian:s,degree:w},vector:{x:H/U,y:-p/U},raw:z,instance:n,lockX:T.lockX,lockY:T.lockY};(k=n.computeDirection(k)).angle={radian:y(180-w),degree:180-w},n.trigger("move",k),d.trigger("move "+n.id+":move",k)}else this.processOnEnd(h)},H.prototype.processOnEnd=function(h){var d=this,T=d.options,Y=d.manager.getIdentifier(h),y=d.nipples.get(Y),C=d.manager.removeIdentifier(y.identifier);y&&(T.dataOnly||y.hide((function(){"dynamic"===T.mode&&(y.trigger("removed",y),d.trigger("removed "+y.id+":removed",y),d.manager.trigger("removed "+y.id+":removed",y),y.destroy())})),clearInterval(d.pressureIntervals[y.identifier]),y.resetDirection(),y.trigger("end",y),d.trigger("end "+y.id+":end",y),d.ids.indexOf(y.identifier)>=0&&d.ids.splice(d.ids.indexOf(y.identifier),1),d.actives.indexOf(y)>=0&&d.actives.splice(d.actives.indexOf(y),1),/(semi|static)/.test(T.mode)?d.idles.push(y):d.nipples.indexOf(y)>=0&&d.nipples.splice(d.nipples.indexOf(y),1),d.manager.unbindDocument(),/(semi|static)/.test(T.mode)&&(d.manager.ids[C.id]=C.identifier))},H.prototype.onDestroyed=function(h,d){var T=this;T.nipples.indexOf(d)>=0&&T.nipples.splice(T.nipples.indexOf(d),1),T.actives.indexOf(d)>=0&&T.actives.splice(T.actives.indexOf(d),1),T.idles.indexOf(d)>=0&&T.idles.splice(T.idles.indexOf(d),1),T.ids.indexOf(d.identifier)>=0&&T.ids.splice(T.ids.indexOf(d.identifier),1),T.manager.removeIdentifier(d.identifier),T.manager.unbindDocument()},H.prototype.destroy=function(){var h=this;for(var d in h.unbindEvt(h.options.zone,"start"),h.nipples.forEach((function(h){h.destroy()})),h.pressureIntervals)h.pressureIntervals.hasOwnProperty(d)&&clearInterval(h.pressureIntervals[d]);h.trigger("destroyed",h.nipples),h.manager.unbindDocument(),h.off()};const p=H;function k(h){var d=this;d.ids={},d.index=0,d.collections=[],d.scroll=Z(),d.config(h),d.prepareCollections();var T=function(){var h;d.collections.forEach((function(T){T.forEach((function(T){h=T.el.getBoundingClientRect(),T.position={x:d.scroll.x+h.left,y:d.scroll.y+h.top}}))}))};X(window,"resize",(function(){n(T)}));var Y=function(){d.scroll=Z()};return X(window,"scroll",(function(){n(Y)})),d.collections}k.prototype=new z,k.constructor=k,k.prototype.prepareCollections=function(){var h=this;h.collections.create=h.create.bind(h),h.collections.on=h.on.bind(h),h.collections.off=h.off.bind(h),h.collections.destroy=h.destroy.bind(h),h.collections.get=function(d){var T;return h.collections.every((function(h){return!(T=h.get(d))})),T}},k.prototype.create=function(h){return this.createCollection(h)},k.prototype.createCollection=function(h){var d=this,T=new p(d,h);return d.bindCollection(T),d.collections.push(T),T},k.prototype.bindCollection=function(h){var d,T=this,Y=function(h,Y){d=h.type+" "+Y.id+":"+h.type,T.trigger(d,Y)};h.on("destroyed",T.onDestroyed.bind(T)),h.on("shown hidden rested dir plain",Y),h.on("dir:up dir:right dir:down dir:left",Y),h.on("plain:up plain:right plain:down plain:left",Y)},k.prototype.bindDocument=function(){var h=this;h.binded||(h.bindEvt(document,"move").bindEvt(document,"end"),h.binded=!0)},k.prototype.unbindDocument=function(h){var d=this;Object.keys(d.ids).length&&!0!==h||(d.unbindEvt(document,"move").unbindEvt(document,"end"),d.binded=!1)},k.prototype.getIdentifier=function(h){var d;return h?void 0===(d=void 0===h.identifier?h.pointerId:h.identifier)&&(d=this.latest||0):d=this.index,void 0===this.ids[d]&&(this.ids[d]=this.index,this.index+=1),this.latest=d,this.ids[d]},k.prototype.removeIdentifier=function(h){var d={};for(var T in this.ids)if(this.ids[T]===h){d.id=T,d.identifier=this.ids[T],delete this.ids[T];break}return d},k.prototype.onmove=function(h){return this.onAny("move",h),!1},k.prototype.onend=function(h){return this.onAny("end",h),!1},k.prototype.oncancel=function(h){return this.onAny("end",h),!1},k.prototype.onAny=function(h,d){var T,Y=this,y="processOn"+h.charAt(0).toUpperCase()+h.slice(1);d=U(d);var C=function(h,d,T){T.ids.indexOf(d)>=0&&(T[y](h),h._found_=!0)};return f(d,(function(h){T=Y.getIdentifier(h),f(Y.collections,C.bind(null,h,T)),h._found_||Y.removeIdentifier(T)})),!1},k.prototype.destroy=function(){var h=this;h.unbindDocument(!0),h.ids={},h.index=0,h.collections.forEach((function(h){h.destroy()})),h.off()},k.prototype.onDestroyed=function(h,d){var T=this;if(T.collections.indexOf(d)<0)return!1;T.collections.splice(T.collections.indexOf(d),1)};var o=new k;const u={create:function(h){return o.create(h)},factory:o};return d.default})(),h.exports=d()},13914:(h,d,T)=>{"use strict";const{Deflate:Y,deflate:y,deflateRaw:C,gzip:n}=T(13920),{Inflate:X,inflate:F,inflateRaw:U,ungzip:Z}=T(13978),S=T(13956);h.exports.Deflate=Y,h.exports.deflate=y,h.exports.deflateRaw=C,h.exports.gzip=n,h.exports.Inflate=X,h.exports.inflate=F,h.exports.inflateRaw=U,h.exports.ungzip=Z,h.exports.constants=S},13920:(h,d,T)=>{"use strict";const Y=T(13926),y=T(13962),C=T(13965),n=T(13951),X=T(13971),F=Object.prototype.toString,{Z_NO_FLUSH:U,Z_SYNC_FLUSH:Z,Z_FULL_FLUSH:S,Z_FINISH:r,Z_OK:c,Z_STREAM_END:O,Z_DEFAULT_COMPRESSION:f,Z_DEFAULT_STRATEGY:J,Z_DEFLATED:W}=T(13956);function L(h){this.options=y.assign({level:f,method:W,eh:16384,windowBits:15,memLevel:8,strategy:J},h||{});let d=this.options;d.raw&&d.windowBits>0?d.windowBits=-d.windowBits:d.gzip&&d.windowBits>0&&d.windowBits<16&&(d.windowBits+=16),this.err=0,this.Ld="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let T=Y.deflateInit2(this.strm,d.level,d.method,d.windowBits,d.memLevel,d.strategy);if(T!==c)throw new Error(n[T]);if(d.header&&Y.deflateSetHeader(this.strm,d.header),d.dictionary){let h;if(h="string"===typeof d.dictionary?C.string2buf(d.dictionary):"[object ArrayBuffer]"===F.call(d.dictionary)?new Uint8Array(d.dictionary):d.dictionary,T=Y.deflateSetDictionary(this.strm,h),T!==c)throw new Error(n[T]);this._dict_set=!0}}function D(h,d){const T=new L(d);if(T.push(h,!0),T.err)throw T.Ld||n[T.err];return T.result}L.prototype.push=function(h,d){const T=this.strm,y=this.options.eh;let n,X;if(this.ended)return!1;for(X=d===~~d?d:!0===d?r:U,"string"===typeof h?T.input=C.string2buf(h):"[object ArrayBuffer]"===F.call(h)?T.input=new Uint8Array(h):T.input=h,T.next_in=0,T.avail_in=T.input.length;;)if(0===T.avail_out&&(T.output=new Uint8Array(y),T.next_out=0,T.avail_out=y),(X===Z||X===S)&&T.avail_out<=6)this.onData(T.output.subarray(0,T.next_out)),T.avail_out=0;else{if(n=Y.deflate(T,X),n===O)return T.next_out>0&&this.onData(T.output.subarray(0,T.next_out)),n=Y.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c;if(0!==T.avail_out){if(X>0&&T.next_out>0)this.onData(T.output.subarray(0,T.next_out)),T.avail_out=0;else if(0===T.avail_in)break}else this.onData(T.output)}return!0},L.prototype.onData=function(h){this.chunks.push(h)},L.prototype.onEnd=function(h){h===c&&(this.result=y.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.Ld=this.strm.Ld},h.exports.Deflate=L,h.exports.deflate=D,h.exports.deflateRaw=function(h,d){return(d=d||{}).raw=!0,D(h,d)},h.exports.gzip=function(h,d){return(d=d||{}).gzip=!0,D(h,d)},h.exports.constants=T(13956)},13978:(h,d,T)=>{"use strict";const Y=T(13980),y=T(13962),C=T(13965),n=T(13951),X=T(13971),F=T(14001),U=Object.prototype.toString,{Z_NO_FLUSH:Z,Z_FINISH:S,Z_OK:r,Z_STREAM_END:c,Z_NEED_DICT:O,Z_STREAM_ERROR:f,Z_DATA_ERROR:J,Z_MEM_ERROR:W}=T(13956);function L(h){this.options=y.assign({eh:65536,windowBits:15,to:""},h||{});const d=this.options;d.raw&&d.windowBits>=0&&d.windowBits<16&&(d.windowBits=-d.windowBits,0===d.windowBits&&(d.windowBits=-15)),!(d.windowBits>=0&&d.windowBits<16)||h&&h.windowBits||(d.windowBits+=32),d.windowBits>15&&d.windowBits<48&&0===(15&d.windowBits)&&(d.windowBits|=15),this.err=0,this.Ld="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let T=Y.inflateInit2(this.strm,d.windowBits);if(T!==r)throw new Error(n[T]);if(this.header=new F,Y.inflateGetHeader(this.strm,this.header),d.dictionary&&("string"===typeof d.dictionary?d.dictionary=C.string2buf(d.dictionary):"[object ArrayBuffer]"===U.call(d.dictionary)&&(d.dictionary=new Uint8Array(d.dictionary)),d.raw&&(T=Y.inflateSetDictionary(this.strm,d.dictionary),T!==r)))throw new Error(n[T])}function D(h,d){const T=new L(d);if(T.push(h),T.err)throw T.Ld||n[T.err];return T.result}L.prototype.push=function(h,d){const T=this.strm,y=this.options.eh,n=this.options.dictionary;let X,F,L;if(this.ended)return!1;for(F=d===~~d?d:!0===d?S:Z,"[object ArrayBuffer]"===U.call(h)?T.input=new Uint8Array(h):T.input=h,T.next_in=0,T.avail_in=T.input.length;;){for(0===T.avail_out&&(T.output=new Uint8Array(y),T.next_out=0,T.avail_out=y),X=Y.inflate(T,F),X===O&&n&&(X=Y.inflateSetDictionary(T,n),X===r?X=Y.inflate(T,F):X===J&&(X=O));T.avail_in>0&&X===c&&T.state.wrap>0&&0!==h[T.next_in];)Y.inflateReset(T),X=Y.inflate(T,F);switch(X){case f:case J:case O:case W:return this.onEnd(X),this.ended=!0,!1}if(L=T.avail_out,T.next_out&&(0===T.avail_out||X===c))if("string"===this.options.to){let h=C.utf8border(T.output,T.next_out),d=T.next_out-h,Y=C.buf2string(T.output,h);T.next_out=d,T.avail_out=y-d,d&&T.output.set(T.output.subarray(h,h+d),0),this.onData(Y)}else this.onData(T.output.length===T.next_out?T.output:T.output.subarray(0,T.next_out));if(X!==r||0!==L){if(X===c)return X=Y.inflateEnd(this.strm),this.onEnd(X),this.ended=!0,!0;if(0===T.avail_in)break}}return!0},L.prototype.onData=function(h){this.chunks.push(h)},L.prototype.onEnd=function(h){h===r&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=y.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.Ld=this.strm.Ld},h.exports.Inflate=L,h.exports.inflate=D,h.exports.inflateRaw=function(h,d){return(d=d||{}).raw=!0,D(h,d)},h.exports.ungzip=D,h.exports.constants=T(13956)},13962:h=>{"use strict";const d=(h,d)=>Object.prototype.hasOwnProperty.call(h,d);h.exports.assign=function(h){const T=Array.prototype.slice.call(arguments,1);for(;T.length;){const Y=T.shift();if(Y){if("object"!==typeof Y)throw new TypeError(Y+"must be non-object");for(const T in Y)d(Y,T)&&(h[T]=Y[T])}}return h},h.exports.flattenChunks=h=>{let d=0;for(let Y=0,y=h.length;Y<y;Y++)d+=h[Y].length;const T=new Uint8Array(d);for(let Y=0,y=0,C=h.length;Y<C;Y++){let d=h[Y];T.set(d,y),y+=d.length}return T}},13965:h=>{"use strict";let d=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Y){d=!1}const T=new Uint8Array(256);for(let y=0;y<256;y++)T[y]=y>=252?6:y>=248?5:y>=240?4:y>=224?3:y>=192?2:1;T[254]=T[254]=1,h.exports.string2buf=h=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(h);let d,T,Y,y,C,n=h.length,X=0;for(y=0;y<n;y++)T=h.charCodeAt(y),55296===(64512&T)&&y+1<n&&(Y=h.charCodeAt(y+1),56320===(64512&Y)&&(T=65536+(T-55296<<10)+(Y-56320),y++)),X+=T<128?1:T<2048?2:T<65536?3:4;for(d=new Uint8Array(X),C=0,y=0;C<X;y++)T=h.charCodeAt(y),55296===(64512&T)&&y+1<n&&(Y=h.charCodeAt(y+1),56320===(64512&Y)&&(T=65536+(T-55296<<10)+(Y-56320),y++)),T<128?d[C++]=T:T<2048?(d[C++]=192|T>>>6,d[C++]=128|63&T):T<65536?(d[C++]=224|T>>>12,d[C++]=128|T>>>6&63,d[C++]=128|63&T):(d[C++]=240|T>>>18,d[C++]=128|T>>>12&63,d[C++]=128|T>>>6&63,d[C++]=128|63&T);return d};h.exports.buf2string=(h,Y)=>{const y=Y||h.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(h.subarray(0,Y));let C,n;const X=new Array(2*y);for(n=0,C=0;C<y;){let d=h[C++];if(d<128){X[n++]=d;continue}let Y=T[d];if(Y>4)X[n++]=65533,C+=Y-1;else{for(d&=2===Y?31:3===Y?15:7;Y>1&&C<y;)d=d<<6|63&h[C++],Y--;Y>1?X[n++]=65533:d<65536?X[n++]=d:(d-=65536,X[n++]=55296|d>>10&1023,X[n++]=56320|1023&d)}}return((h,T)=>{if(T<65534&&h.subarray&&d)return String.fromCharCode.apply(null,h.length===T?h:h.subarray(0,T));let Y="";for(let d=0;d<T;d++)Y+=String.fromCharCode(h[d]);return Y})(X,n)},h.exports.utf8border=(h,d)=>{(d=d||h.length)>h.length&&(d=h.length);let Y=d-1;for(;Y>=0&&128===(192&h[Y]);)Y--;return Y<0||0===Y?d:Y+T[h[Y]]>d?Y:d}},13940:h=>{"use strict";h.exports=(h,d,T,Y)=>{let y=65535&h,C=h>>>16&65535,n=0;for(;0!==T;){n=T>2e3?2e3:T,T-=n;do{y=y+d[Y++]|0,C=C+y|0}while(--n);y%=65521,C%=65521}return y|C<<16}},13956:h=>{"use strict";h.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13945:h=>{"use strict";const d=new Uint32Array((()=>{let h,d=[];for(var T=0;T<256;T++){h=T;for(var Y=0;Y<8;Y++)h=1&h?3988292384^h>>>1:h>>>1;d[T]=h}return d})());h.exports=(h,T,Y,y)=>{const C=d,n=y+Y;h^=-1;for(let d=y;d<n;d++)h=h>>>8^C[255&(h^T[d])];return~h}},13926:(h,d,T)=>{"use strict";const{_tr_init:Y,_tr_stored_block:y,_tr_flush_block:C,_tr_tally:n,_tr_align:X}=T(13935),F=T(13940),U=T(13945),Z=T(13951),{Z_NO_FLUSH:S,Z_PARTIAL_FLUSH:r,Z_FULL_FLUSH:c,Z_FINISH:O,Z_BLOCK:f,Z_OK:J,Z_STREAM_END:W,Z_STREAM_ERROR:L,Z_DATA_ERROR:D,Z_BUF_ERROR:V,Z_DEFAULT_COMPRESSION:i,Z_FILTERED:w,Z_HUFFMAN_ONLY:s,Z_RLE:E,Z_FIXED:z,Z_DEFAULT_STRATEGY:x,Z_UNKNOWN:g,Z_DEFLATED:H}=T(13956),p=258,k=262,o=103,u=113,N=666,K=(h,d)=>(h.Ld=Z[d],d),l=h=>(h<<1)-(h>4?9:0),q=h=>{let d=h.length;for(;--d>=0;)h[d]=0};let j=(h,d,T)=>(d<<h.hash_shift^T)&h.hash_mask;const a=h=>{const d=h.state;let T=d.pending;T>h.avail_out&&(T=h.avail_out),0!==T&&(h.output.set(d.pending_buf.subarray(d.pending_out,d.pending_out+T),h.next_out),h.next_out+=T,d.pending_out+=T,h.total_out+=T,h.avail_out-=T,d.pending-=T,0===d.pending&&(d.pending_out=0))},e=(h,d)=>{C(h,h.block_start>=0?h.block_start:-1,h.strstart-h.block_start,d),h.block_start=h.strstart,a(h.strm)},v=(h,d)=>{h.pending_buf[h.pending++]=d},G=(h,d)=>{h.pending_buf[h.pending++]=d>>>8&255,h.pending_buf[h.pending++]=255&d},b=(h,d,T,Y)=>{let y=h.avail_in;return y>Y&&(y=Y),0===y?0:(h.avail_in-=y,d.set(h.input.subarray(h.next_in,h.next_in+y),T),1===h.state.wrap?h.adler=F(h.adler,d,y,T):2===h.state.wrap&&(h.adler=U(h.adler,d,y,T)),h.next_in+=y,h.total_in+=y,y)},B=(h,d)=>{let T,Y,y=h.max_chain_length,C=h.strstart,n=h.prev_length,X=h.nice_match;const F=h.strstart>h.w_size-k?h.strstart-(h.w_size-k):0,U=h.window,Z=h.w_mask,S=h.prev,r=h.strstart+p;let c=U[C+n-1],O=U[C+n];h.prev_length>=h.good_match&&(y>>=2),X>h.lookahead&&(X=h.lookahead);do{if(T=d,U[T+n]===O&&U[T+n-1]===c&&U[T]===U[C]&&U[++T]===U[C+1]){C+=2,T++;do{}while(U[++C]===U[++T]&&U[++C]===U[++T]&&U[++C]===U[++T]&&U[++C]===U[++T]&&U[++C]===U[++T]&&U[++C]===U[++T]&&U[++C]===U[++T]&&U[++C]===U[++T]&&C<r);if(Y=p-(r-C),C=r-p,Y>n){if(h.match_start=d,n=Y,Y>=X)break;c=U[C+n-1],O=U[C+n]}}}while((d=S[d&Z])>F&&0!==--y);return n<=h.lookahead?n:h.lookahead},M=h=>{const d=h.w_size;let T,Y,y,C,n;do{if(C=h.window_size-h.lookahead-h.strstart,h.strstart>=d+(d-k)){h.window.set(h.window.subarray(d,d+d),0),h.match_start-=d,h.strstart-=d,h.block_start-=d,Y=h.hash_size,T=Y;do{y=h.head[--T],h.head[T]=y>=d?y-d:0}while(--Y);Y=d,T=Y;do{y=h.prev[--T],h.prev[T]=y>=d?y-d:0}while(--Y);C+=d}if(0===h.strm.avail_in)break;if(Y=b(h.strm,h.window,h.strstart+h.lookahead,C),h.lookahead+=Y,h.lookahead+h.insert>=3)for(n=h.strstart-h.insert,h.ins_h=h.window[n],h.ins_h=j(h,h.ins_h,h.window[n+1]);h.insert&&(h.ins_h=j(h,h.ins_h,h.window[n+3-1]),h.prev[n&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=n,n++,h.insert--,!(h.lookahead+h.insert<3)););}while(h.lookahead<k&&0!==h.strm.avail_in)},mh=(h,d)=>{let T,Y;for(;;){if(h.lookahead<k){if(M(h),h.lookahead<k&&d===S)return 1;if(0===h.lookahead)break}if(T=0,h.lookahead>=3&&(h.ins_h=j(h,h.ins_h,h.window[h.strstart+3-1]),T=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),0!==T&&h.strstart-T<=h.w_size-k&&(h.match_length=B(h,T)),h.match_length>=3)if(Y=n(h,h.strstart-h.match_start,h.match_length-3),h.lookahead-=h.match_length,h.match_length<=h.max_lazy_match&&h.lookahead>=3){h.match_length--;do{h.strstart++,h.ins_h=j(h,h.ins_h,h.window[h.strstart+3-1]),T=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart}while(0!==--h.match_length);h.strstart++}else h.strstart+=h.match_length,h.match_length=0,h.ins_h=h.window[h.strstart],h.ins_h=j(h,h.ins_h,h.window[h.strstart+1]);else Y=n(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++;if(Y&&(e(h,!1),0===h.strm.avail_out))return 1}return h.insert=h.strstart<2?h.strstart:2,d===O?(e(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(e(h,!1),0===h.strm.avail_out)?1:2},R=(h,d)=>{let T,Y,y;for(;;){if(h.lookahead<k){if(M(h),h.lookahead<k&&d===S)return 1;if(0===h.lookahead)break}if(T=0,h.lookahead>=3&&(h.ins_h=j(h,h.ins_h,h.window[h.strstart+3-1]),T=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),h.prev_length=h.match_length,h.prev_match=h.match_start,h.match_length=2,0!==T&&h.prev_length<h.max_lazy_match&&h.strstart-T<=h.w_size-k&&(h.match_length=B(h,T),h.match_length<=5&&(h.strategy===w||3===h.match_length&&h.strstart-h.match_start>4096)&&(h.match_length=2)),h.prev_length>=3&&h.match_length<=h.prev_length){y=h.strstart+h.lookahead-3,Y=n(h,h.strstart-1-h.prev_match,h.prev_length-3),h.lookahead-=h.prev_length-1,h.prev_length-=2;do{++h.strstart<=y&&(h.ins_h=j(h,h.ins_h,h.window[h.strstart+3-1]),T=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart)}while(0!==--h.prev_length);if(h.match_available=0,h.match_length=2,h.strstart++,Y&&(e(h,!1),0===h.strm.avail_out))return 1}else if(h.match_available){if(Y=n(h,0,h.window[h.strstart-1]),Y&&e(h,!1),h.strstart++,h.lookahead--,0===h.strm.avail_out)return 1}else h.match_available=1,h.strstart++,h.lookahead--}return h.match_available&&(Y=n(h,0,h.window[h.strstart-1]),h.match_available=0),h.insert=h.strstart<2?h.strstart:2,d===O?(e(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(e(h,!1),0===h.strm.avail_out)?1:2};function Q(h,d,T,Y,y){this.good_length=h,this.max_lazy=d,this.nice_length=T,this.max_chain=Y,this.func=y}const I=[new Q(0,0,0,0,((h,d)=>{let T=65535;for(T>h.pending_buf_size-5&&(T=h.pending_buf_size-5);;){if(h.lookahead<=1){if(M(h),0===h.lookahead&&d===S)return 1;if(0===h.lookahead)break}h.strstart+=h.lookahead,h.lookahead=0;const Y=h.block_start+T;if((0===h.strstart||h.strstart>=Y)&&(h.lookahead=h.strstart-Y,h.strstart=Y,e(h,!1),0===h.strm.avail_out))return 1;if(h.strstart-h.block_start>=h.w_size-k&&(e(h,!1),0===h.strm.avail_out))return 1}return h.insert=0,d===O?(e(h,!0),0===h.strm.avail_out?3:4):(h.strstart>h.block_start&&(e(h,!1),h.strm.avail_out),1)})),new Q(4,4,8,4,mh),new Q(4,5,16,8,mh),new Q(4,6,32,32,mh),new Q(4,4,16,16,R),new Q(8,16,32,32,R),new Q(8,16,128,128,R),new Q(8,32,128,256,R),new Q(32,128,258,1024,R),new Q(32,258,258,4096,R)];function A(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=H,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),q(this.dyn_ltree),q(this.dyn_dtree),q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const P=h=>{if(!h||!h.state)return K(h,L);h.total_in=h.total_out=0,h.data_type=g;const d=h.state;return d.pending=0,d.pending_out=0,d.wrap<0&&(d.wrap=-d.wrap),d.status=d.wrap?42:u,h.adler=2===d.wrap?0:1,d.last_flush=S,Y(d),J},t=h=>{const d=P(h);var T;return d===J&&((T=h.state).window_size=2*T.w_size,q(T.head),T.max_lazy_match=I[T.level].max_lazy,T.good_match=I[T.level].good_length,T.nice_match=I[T.level].nice_length,T.max_chain_length=I[T.level].max_chain,T.strstart=0,T.block_start=0,T.lookahead=0,T.insert=0,T.match_length=T.prev_length=2,T.match_available=0,T.ins_h=0),d},hh=(h,d,T,Y,y,C)=>{if(!h)return L;let n=1;if(d===i&&(d=6),Y<0?(n=0,Y=-Y):Y>15&&(n=2,Y-=16),y<1||y>9||T!==H||Y<8||Y>15||d<0||d>9||C<0||C>z)return K(h,L);8===Y&&(Y=9);const X=new A;return h.state=X,X.strm=h,X.wrap=n,X.gzhead=null,X.w_bits=Y,X.w_size=1<<X.w_bits,X.w_mask=X.w_size-1,X.hash_bits=y+7,X.hash_size=1<<X.hash_bits,X.hash_mask=X.hash_size-1,X.hash_shift=~~((X.hash_bits+3-1)/3),X.window=new Uint8Array(2*X.w_size),X.head=new Uint16Array(X.hash_size),X.prev=new Uint16Array(X.w_size),X.lit_bufsize=1<<y+6,X.pending_buf_size=4*X.lit_bufsize,X.pending_buf=new Uint8Array(X.pending_buf_size),X.d_buf=1*X.lit_bufsize,X.l_buf=3*X.lit_bufsize,X.level=d,X.strategy=C,X.method=T,t(h)};h.exports.deflateInit=(h,d)=>hh(h,d,H,15,8,x),h.exports.deflateInit2=hh,h.exports.deflateReset=t,h.exports.deflateResetKeep=P,h.exports.deflateSetHeader=(h,d)=>h&&h.state?2!==h.state.wrap?L:(h.state.gzhead=d,J):L,h.exports.deflate=(h,d)=>{let T,Y;if(!h||!h.state||d>f||d<0)return h?K(h,L):L;const C=h.state;if(!h.output||!h.input&&0!==h.avail_in||C.status===N&&d!==O)return K(h,0===h.avail_out?V:L);C.strm=h;const F=C.last_flush;if(C.last_flush=d,42===C.status)if(2===C.wrap)h.adler=0,v(C,31),v(C,139),v(C,8),C.gzhead?(v(C,(C.gzhead.text?1:0)+(C.gzhead.hcrc?2:0)+(C.gzhead.extra?4:0)+(C.gzhead.name?8:0)+(C.gzhead.comment?16:0)),v(C,255&C.gzhead.time),v(C,C.gzhead.time>>8&255),v(C,C.gzhead.time>>16&255),v(C,C.gzhead.time>>24&255),v(C,9===C.level?2:C.strategy>=s||C.level<2?4:0),v(C,255&C.gzhead.os),C.gzhead.extra&&C.gzhead.extra.length&&(v(C,255&C.gzhead.extra.length),v(C,C.gzhead.extra.length>>8&255)),C.gzhead.hcrc&&(h.adler=U(h.adler,C.pending_buf,C.pending,0)),C.gzindex=0,C.status=69):(v(C,0),v(C,0),v(C,0),v(C,0),v(C,0),v(C,9===C.level?2:C.strategy>=s||C.level<2?4:0),v(C,3),C.status=u);else{let d=H+(C.w_bits-8<<4)<<8,T=-1;T=C.strategy>=s||C.level<2?0:C.level<6?1:6===C.level?2:3,d|=T<<6,0!==C.strstart&&(d|=32),d+=31-d%31,C.status=u,G(C,d),0!==C.strstart&&(G(C,h.adler>>>16),G(C,65535&h.adler)),h.adler=1}if(69===C.status)if(C.gzhead.extra){for(T=C.pending;C.gzindex<(65535&C.gzhead.extra.length)&&(C.pending!==C.pending_buf_size||(C.gzhead.hcrc&&C.pending>T&&(h.adler=U(h.adler,C.pending_buf,C.pending-T,T)),a(h),T=C.pending,C.pending!==C.pending_buf_size));)v(C,255&C.gzhead.extra[C.gzindex]),C.gzindex++;C.gzhead.hcrc&&C.pending>T&&(h.adler=U(h.adler,C.pending_buf,C.pending-T,T)),C.gzindex===C.gzhead.extra.length&&(C.gzindex=0,C.status=73)}else C.status=73;if(73===C.status)if(C.gzhead.name){T=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>T&&(h.adler=U(h.adler,C.pending_buf,C.pending-T,T)),a(h),T=C.pending,C.pending===C.pending_buf_size)){Y=1;break}Y=C.gzindex<C.gzhead.name.length?255&C.gzhead.name.charCodeAt(C.gzindex++):0,v(C,Y)}while(0!==Y);C.gzhead.hcrc&&C.pending>T&&(h.adler=U(h.adler,C.pending_buf,C.pending-T,T)),0===Y&&(C.gzindex=0,C.status=91)}else C.status=91;if(91===C.status)if(C.gzhead.comment){T=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>T&&(h.adler=U(h.adler,C.pending_buf,C.pending-T,T)),a(h),T=C.pending,C.pending===C.pending_buf_size)){Y=1;break}Y=C.gzindex<C.gzhead.comment.length?255&C.gzhead.comment.charCodeAt(C.gzindex++):0,v(C,Y)}while(0!==Y);C.gzhead.hcrc&&C.pending>T&&(h.adler=U(h.adler,C.pending_buf,C.pending-T,T)),0===Y&&(C.status=o)}else C.status=o;if(C.status===o&&(C.gzhead.hcrc?(C.pending+2>C.pending_buf_size&&a(h),C.pending+2<=C.pending_buf_size&&(v(C,255&h.adler),v(C,h.adler>>8&255),h.adler=0,C.status=u)):C.status=u),0!==C.pending){if(a(h),0===h.avail_out)return C.last_flush=-1,J}else if(0===h.avail_in&&l(d)<=l(F)&&d!==O)return K(h,V);if(C.status===N&&0!==h.avail_in)return K(h,V);if(0!==h.avail_in||0!==C.lookahead||d!==S&&C.status!==N){let T=C.strategy===s?((h,d)=>{let T;for(;;){if(0===h.lookahead&&(M(h),0===h.lookahead)){if(d===S)return 1;break}if(h.match_length=0,T=n(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++,T&&(e(h,!1),0===h.strm.avail_out))return 1}return h.insert=0,d===O?(e(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(e(h,!1),0===h.strm.avail_out)?1:2})(C,d):C.strategy===E?((h,d)=>{let T,Y,y,C;const X=h.window;for(;;){if(h.lookahead<=p){if(M(h),h.lookahead<=p&&d===S)return 1;if(0===h.lookahead)break}if(h.match_length=0,h.lookahead>=3&&h.strstart>0&&(y=h.strstart-1,Y=X[y],Y===X[++y]&&Y===X[++y]&&Y===X[++y])){C=h.strstart+p;do{}while(Y===X[++y]&&Y===X[++y]&&Y===X[++y]&&Y===X[++y]&&Y===X[++y]&&Y===X[++y]&&Y===X[++y]&&Y===X[++y]&&y<C);h.match_length=p-(C-y),h.match_length>h.lookahead&&(h.match_length=h.lookahead)}if(h.match_length>=3?(T=n(h,1,h.match_length-3),h.lookahead-=h.match_length,h.strstart+=h.match_length,h.match_length=0):(T=n(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++),T&&(e(h,!1),0===h.strm.avail_out))return 1}return h.insert=0,d===O?(e(h,!0),0===h.strm.avail_out?3:4):h.last_lit&&(e(h,!1),0===h.strm.avail_out)?1:2})(C,d):I[C.level].func(C,d);if(3!==T&&4!==T||(C.status=N),1===T||3===T)return 0===h.avail_out&&(C.last_flush=-1),J;if(2===T&&(d===r?X(C):d!==f&&(y(C,0,0,!1),d===c&&(q(C.head),0===C.lookahead&&(C.strstart=0,C.block_start=0,C.insert=0))),a(h),0===h.avail_out))return C.last_flush=-1,J}return d!==O?J:C.wrap<=0?W:(2===C.wrap?(v(C,255&h.adler),v(C,h.adler>>8&255),v(C,h.adler>>16&255),v(C,h.adler>>24&255),v(C,255&h.total_in),v(C,h.total_in>>8&255),v(C,h.total_in>>16&255),v(C,h.total_in>>24&255)):(G(C,h.adler>>>16),G(C,65535&h.adler)),a(h),C.wrap>0&&(C.wrap=-C.wrap),0!==C.pending?J:W)},h.exports.deflateEnd=h=>{if(!h||!h.state)return L;const d=h.state.status;return 42!==d&&69!==d&&73!==d&&91!==d&&d!==o&&d!==u&&d!==N?K(h,L):(h.state=null,d===u?K(h,D):J)},h.exports.deflateSetDictionary=(h,d)=>{let T=d.length;if(!h||!h.state)return L;const Y=h.state,y=Y.wrap;if(2===y||1===y&&42!==Y.status||Y.lookahead)return L;if(1===y&&(h.adler=F(h.adler,d,T,0)),Y.wrap=0,T>=Y.w_size){0===y&&(q(Y.head),Y.strstart=0,Y.block_start=0,Y.insert=0);let h=new Uint8Array(Y.w_size);h.set(d.subarray(T-Y.w_size,T),0),d=h,T=Y.w_size}const C=h.avail_in,n=h.next_in,X=h.input;for(h.avail_in=T,h.next_in=0,h.input=d,M(Y);Y.lookahead>=3;){let h=Y.strstart,d=Y.lookahead-2;do{Y.ins_h=j(Y,Y.ins_h,Y.window[h+3-1]),Y.prev[h&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=h,h++}while(--d);Y.strstart=h,Y.lookahead=2,M(Y)}return Y.strstart+=Y.lookahead,Y.block_start=Y.strstart,Y.insert=Y.lookahead,Y.lookahead=0,Y.match_length=Y.prev_length=2,Y.match_available=0,h.next_in=n,h.input=X,h.avail_in=C,Y.wrap=y,J},h.exports.deflateInfo="pako deflate (from Nodeca project)"},14001:h=>{"use strict";h.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13986:h=>{"use strict";h.exports=function(h,d){let T,Y,y,C,n,X,F,U,Z,S,r,c,O,f,J,W,L,D,V,i,w,s,E,z;const x=h.state;T=h.next_in,E=h.input,Y=T+(h.avail_in-5),y=h.next_out,z=h.output,C=y-(d-h.avail_out),n=y+(h.avail_out-257),X=x.dmax,F=x.wsize,U=x.whave,Z=x.wnext,S=x.window,r=x.hold,c=x.bits,O=x.lencode,f=x.distcode,J=(1<<x.lenbits)-1,W=(1<<x.distbits)-1;h:do{c<15&&(r+=E[T++]<<c,c+=8,r+=E[T++]<<c,c+=8),L=O[r&J];d:for(;;){if(D=L>>>24,r>>>=D,c-=D,D=L>>>16&255,0===D)z[y++]=65535&L;else{if(!(16&D)){if(0===(64&D)){L=O[(65535&L)+(r&(1<<D)-1)];continue d}if(32&D){x.mode=12;break h}h.Ld="invalid literal/length code",x.mode=30;break h}V=65535&L,D&=15,D&&(c<D&&(r+=E[T++]<<c,c+=8),V+=r&(1<<D)-1,r>>>=D,c-=D),c<15&&(r+=E[T++]<<c,c+=8,r+=E[T++]<<c,c+=8),L=f[r&W];T:for(;;){if(D=L>>>24,r>>>=D,c-=D,D=L>>>16&255,!(16&D)){if(0===(64&D)){L=f[(65535&L)+(r&(1<<D)-1)];continue T}h.Ld="invalid distance code",x.mode=30;break h}if(i=65535&L,D&=15,c<D&&(r+=E[T++]<<c,c+=8,c<D&&(r+=E[T++]<<c,c+=8)),i+=r&(1<<D)-1,i>X){h.Ld="invalid distance too far back",x.mode=30;break h}if(r>>>=D,c-=D,D=y-C,i>D){if(D=i-D,D>U&&x.sane){h.Ld="invalid distance too far back",x.mode=30;break h}if(w=0,s=S,0===Z){if(w+=F-D,D<V){V-=D;do{z[y++]=S[w++]}while(--D);w=y-i,s=z}}else if(Z<D){if(w+=F+Z-D,D-=Z,D<V){V-=D;do{z[y++]=S[w++]}while(--D);if(w=0,Z<V){D=Z,V-=D;do{z[y++]=S[w++]}while(--D);w=y-i,s=z}}}else if(w+=Z-D,D<V){V-=D;do{z[y++]=S[w++]}while(--D);w=y-i,s=z}for(;V>2;)z[y++]=s[w++],z[y++]=s[w++],z[y++]=s[w++],V-=3;V&&(z[y++]=s[w++],V>1&&(z[y++]=s[w++]))}else{w=y-i;do{z[y++]=z[w++],z[y++]=z[w++],z[y++]=z[w++],V-=3}while(V>2);V&&(z[y++]=z[w++],V>1&&(z[y++]=z[w++]))}break}}break}}while(T<Y&&y<n);V=c>>3,T-=V,c-=V<<3,r&=(1<<c)-1,h.next_in=T,h.next_out=y,h.avail_in=T<Y?Y-T+5:5-(T-Y),h.avail_out=y<n?n-y+257:257-(y-n),x.hold=r,x.bits=c}},13980:(h,d,T)=>{"use strict";const Y=T(13940),y=T(13945),C=T(13986),n=T(13992),{Z_FINISH:X,Z_BLOCK:F,Z_TREES:U,Z_OK:Z,Z_STREAM_END:S,Z_NEED_DICT:r,Z_STREAM_ERROR:c,Z_DATA_ERROR:O,Z_MEM_ERROR:f,Z_BUF_ERROR:J,Z_DEFLATED:W}=T(13956),L=12,D=30,V=h=>(h>>>24&255)+(h>>>8&65280)+((65280&h)<<8)+((255&h)<<24);function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const w=h=>{if(!h||!h.state)return c;const d=h.state;return h.total_in=h.total_out=d.total=0,h.Ld="",d.wrap&&(h.adler=1&d.wrap),d.mode=1,d.last=0,d.havedict=0,d.dmax=32768,d.head=null,d.hold=0,d.bits=0,d.lencode=d.lendyn=new Int32Array(852),d.distcode=d.distdyn=new Int32Array(592),d.sane=1,d.back=-1,Z},s=h=>{if(!h||!h.state)return c;const d=h.state;return d.wsize=0,d.whave=0,d.wnext=0,w(h)},E=(h,d)=>{let T;if(!h||!h.state)return c;const Y=h.state;return d<0?(T=0,d=-d):(T=1+(d>>4),d<48&&(d&=15)),d&&(d<8||d>15)?c:(null!==Y.window&&Y.wbits!==d&&(Y.window=null),Y.wrap=T,Y.wbits=d,s(h))},z=(h,d)=>{if(!h)return c;const T=new i;h.state=T,T.window=null;const Y=E(h,d);return Y!==Z&&(h.state=null),Y};let x,g,H=!0;const p=h=>{if(H){x=new Int32Array(512),g=new Int32Array(32);let d=0;for(;d<144;)h.lens[d++]=8;for(;d<256;)h.lens[d++]=9;for(;d<280;)h.lens[d++]=7;for(;d<288;)h.lens[d++]=8;for(n(1,h.lens,0,288,x,0,h.work,{bits:9}),d=0;d<32;)h.lens[d++]=5;n(2,h.lens,0,32,g,0,h.work,{bits:5}),H=!1}h.lencode=x,h.lenbits=9,h.distcode=g,h.distbits=5},k=(h,d,T,Y)=>{let y;const C=h.state;return null===C.window&&(C.wsize=1<<C.wbits,C.wnext=0,C.whave=0,C.window=new Uint8Array(C.wsize)),Y>=C.wsize?(C.window.set(d.subarray(T-C.wsize,T),0),C.wnext=0,C.whave=C.wsize):(y=C.wsize-C.wnext,y>Y&&(y=Y),C.window.set(d.subarray(T-Y,T-Y+y),C.wnext),(Y-=y)?(C.window.set(d.subarray(T-Y,T),0),C.wnext=Y,C.whave=C.wsize):(C.wnext+=y,C.wnext===C.wsize&&(C.wnext=0),C.whave<C.wsize&&(C.whave+=y))),0};h.exports.inflateReset=s,h.exports.inflateReset2=E,h.exports.inflateResetKeep=w,h.exports.inflateInit=h=>z(h,15),h.exports.inflateInit2=z,h.exports.inflate=(h,d)=>{let T,i,w,s,E,z,x,g,H,o,u,N,K,l,q,j,a,e,v,G,b,B,M=0;const mh=new Uint8Array(4);let R,Q;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!h||!h.state||!h.output||!h.input&&0!==h.avail_in)return c;T=h.state,T.mode===L&&(T.mode=13),E=h.next_out,w=h.output,x=h.avail_out,s=h.next_in,i=h.input,z=h.avail_in,g=T.hold,H=T.bits,o=z,u=x,B=Z;h:for(;;)switch(T.mode){case 1:if(0===T.wrap){T.mode=13;break}for(;H<16;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}if(2&T.wrap&&35615===g){T.check=0,mh[0]=255&g,mh[1]=g>>>8&255,T.check=y(T.check,mh,2,0),g=0,H=0,T.mode=2;break}if(T.flags=0,T.head&&(T.head.done=!1),!(1&T.wrap)||(((255&g)<<8)+(g>>8))%31){h.Ld="incorrect header check",T.mode=D;break}if((15&g)!==W){h.Ld="unknown compression method",T.mode=D;break}if(g>>>=4,H-=4,b=8+(15&g),0===T.wbits)T.wbits=b;else if(b>T.wbits){h.Ld="invalid window size",T.mode=D;break}T.dmax=1<<T.wbits,h.adler=T.check=1,T.mode=512&g?10:L,g=0,H=0;break;case 2:for(;H<16;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}if(T.flags=g,(255&T.flags)!==W){h.Ld="unknown compression method",T.mode=D;break}if(57344&T.flags){h.Ld="unknown header flags set",T.mode=D;break}T.head&&(T.head.text=g>>8&1),512&T.flags&&(mh[0]=255&g,mh[1]=g>>>8&255,T.check=y(T.check,mh,2,0)),g=0,H=0,T.mode=3;case 3:for(;H<32;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}T.head&&(T.head.time=g),512&T.flags&&(mh[0]=255&g,mh[1]=g>>>8&255,mh[2]=g>>>16&255,mh[3]=g>>>24&255,T.check=y(T.check,mh,4,0)),g=0,H=0,T.mode=4;case 4:for(;H<16;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}T.head&&(T.head.xflags=255&g,T.head.os=g>>8),512&T.flags&&(mh[0]=255&g,mh[1]=g>>>8&255,T.check=y(T.check,mh,2,0)),g=0,H=0,T.mode=5;case 5:if(1024&T.flags){for(;H<16;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}T.length=g,T.head&&(T.head.extra_len=g),512&T.flags&&(mh[0]=255&g,mh[1]=g>>>8&255,T.check=y(T.check,mh,2,0)),g=0,H=0}else T.head&&(T.head.extra=null);T.mode=6;case 6:if(1024&T.flags&&(N=T.length,N>z&&(N=z),N&&(T.head&&(b=T.head.extra_len-T.length,T.head.extra||(T.head.extra=new Uint8Array(T.head.extra_len)),T.head.extra.set(i.subarray(s,s+N),b)),512&T.flags&&(T.check=y(T.check,i,N,s)),z-=N,s+=N,T.length-=N),T.length))break h;T.length=0,T.mode=7;case 7:if(2048&T.flags){if(0===z)break h;N=0;do{b=i[s+N++],T.head&&b&&T.length<65536&&(T.head.name+=String.fromCharCode(b))}while(b&&N<z);if(512&T.flags&&(T.check=y(T.check,i,N,s)),z-=N,s+=N,b)break h}else T.head&&(T.head.name=null);T.length=0,T.mode=8;case 8:if(4096&T.flags){if(0===z)break h;N=0;do{b=i[s+N++],T.head&&b&&T.length<65536&&(T.head.comment+=String.fromCharCode(b))}while(b&&N<z);if(512&T.flags&&(T.check=y(T.check,i,N,s)),z-=N,s+=N,b)break h}else T.head&&(T.head.comment=null);T.mode=9;case 9:if(512&T.flags){for(;H<16;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}if(g!==(65535&T.check)){h.Ld="header crc mismatch",T.mode=D;break}g=0,H=0}T.head&&(T.head.hcrc=T.flags>>9&1,T.head.done=!0),h.adler=T.check=0,T.mode=L;break;case 10:for(;H<32;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}h.adler=T.check=V(g),g=0,H=0,T.mode=11;case 11:if(0===T.havedict)return h.next_out=E,h.avail_out=x,h.next_in=s,h.avail_in=z,T.hold=g,T.bits=H,r;h.adler=T.check=1,T.mode=L;case L:if(d===F||d===U)break h;case 13:if(T.last){g>>>=7&H,H-=7&H,T.mode=27;break}for(;H<3;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}switch(T.last=1&g,g>>>=1,H-=1,3&g){case 0:T.mode=14;break;case 1:if(p(T),T.mode=20,d===U){g>>>=2,H-=2;break h}break;case 2:T.mode=17;break;case 3:h.Ld="invalid block type",T.mode=D}g>>>=2,H-=2;break;case 14:for(g>>>=7&H,H-=7&H;H<32;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}if((65535&g)!==(g>>>16^65535)){h.Ld="invalid stored block lengths",T.mode=D;break}if(T.length=65535&g,g=0,H=0,T.mode=15,d===U)break h;case 15:T.mode=16;case 16:if(N=T.length,N){if(N>z&&(N=z),N>x&&(N=x),0===N)break h;w.set(i.subarray(s,s+N),E),z-=N,s+=N,x-=N,E+=N,T.length-=N;break}T.mode=L;break;case 17:for(;H<14;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}if(T.nlen=257+(31&g),g>>>=5,H-=5,T.ndist=1+(31&g),g>>>=5,H-=5,T.ncode=4+(15&g),g>>>=4,H-=4,T.nlen>286||T.ndist>30){h.Ld="too many length or distance symbols",T.mode=D;break}T.have=0,T.mode=18;case 18:for(;T.have<T.ncode;){for(;H<3;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}T.lens[I[T.have++]]=7&g,g>>>=3,H-=3}for(;T.have<19;)T.lens[I[T.have++]]=0;if(T.lencode=T.lendyn,T.lenbits=7,R={bits:T.lenbits},B=n(0,T.lens,0,19,T.lencode,0,T.work,R),T.lenbits=R.bits,B){h.Ld="invalid code lengths set",T.mode=D;break}T.have=0,T.mode=19;case 19:for(;T.have<T.nlen+T.ndist;){for(;M=T.lencode[g&(1<<T.lenbits)-1],q=M>>>24,j=M>>>16&255,a=65535&M,!(q<=H);){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}if(a<16)g>>>=q,H-=q,T.lens[T.have++]=a;else{if(16===a){for(Q=q+2;H<Q;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}if(g>>>=q,H-=q,0===T.have){h.Ld="invalid bit length repeat",T.mode=D;break}b=T.lens[T.have-1],N=3+(3&g),g>>>=2,H-=2}else if(17===a){for(Q=q+3;H<Q;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}g>>>=q,H-=q,b=0,N=3+(7&g),g>>>=3,H-=3}else{for(Q=q+7;H<Q;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}g>>>=q,H-=q,b=0,N=11+(127&g),g>>>=7,H-=7}if(T.have+N>T.nlen+T.ndist){h.Ld="invalid bit length repeat",T.mode=D;break}for(;N--;)T.lens[T.have++]=b}}if(T.mode===D)break;if(0===T.lens[256]){h.Ld="invalid code -- missing end-of-block",T.mode=D;break}if(T.lenbits=9,R={bits:T.lenbits},B=n(1,T.lens,0,T.nlen,T.lencode,0,T.work,R),T.lenbits=R.bits,B){h.Ld="invalid literal/lengths set",T.mode=D;break}if(T.distbits=6,T.distcode=T.distdyn,R={bits:T.distbits},B=n(2,T.lens,T.nlen,T.ndist,T.distcode,0,T.work,R),T.distbits=R.bits,B){h.Ld="invalid distances set",T.mode=D;break}if(T.mode=20,d===U)break h;case 20:T.mode=21;case 21:if(z>=6&&x>=258){h.next_out=E,h.avail_out=x,h.next_in=s,h.avail_in=z,T.hold=g,T.bits=H,C(h,u),E=h.next_out,w=h.output,x=h.avail_out,s=h.next_in,i=h.input,z=h.avail_in,g=T.hold,H=T.bits,T.mode===L&&(T.back=-1);break}for(T.back=0;M=T.lencode[g&(1<<T.lenbits)-1],q=M>>>24,j=M>>>16&255,a=65535&M,!(q<=H);){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}if(j&&0===(240&j)){for(e=q,v=j,G=a;M=T.lencode[G+((g&(1<<e+v)-1)>>e)],q=M>>>24,j=M>>>16&255,a=65535&M,!(e+q<=H);){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}g>>>=e,H-=e,T.back+=e}if(g>>>=q,H-=q,T.back+=q,T.length=a,0===j){T.mode=26;break}if(32&j){T.back=-1,T.mode=L;break}if(64&j){h.Ld="invalid literal/length code",T.mode=D;break}T.extra=15&j,T.mode=22;case 22:if(T.extra){for(Q=T.extra;H<Q;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}T.length+=g&(1<<T.extra)-1,g>>>=T.extra,H-=T.extra,T.back+=T.extra}T.was=T.length,T.mode=23;case 23:for(;M=T.distcode[g&(1<<T.distbits)-1],q=M>>>24,j=M>>>16&255,a=65535&M,!(q<=H);){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}if(0===(240&j)){for(e=q,v=j,G=a;M=T.distcode[G+((g&(1<<e+v)-1)>>e)],q=M>>>24,j=M>>>16&255,a=65535&M,!(e+q<=H);){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}g>>>=e,H-=e,T.back+=e}if(g>>>=q,H-=q,T.back+=q,64&j){h.Ld="invalid distance code",T.mode=D;break}T.offset=a,T.extra=15&j,T.mode=24;case 24:if(T.extra){for(Q=T.extra;H<Q;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}T.offset+=g&(1<<T.extra)-1,g>>>=T.extra,H-=T.extra,T.back+=T.extra}if(T.offset>T.dmax){h.Ld="invalid distance too far back",T.mode=D;break}T.mode=25;case 25:if(0===x)break h;if(N=u-x,T.offset>N){if(N=T.offset-N,N>T.whave&&T.sane){h.Ld="invalid distance too far back",T.mode=D;break}N>T.wnext?(N-=T.wnext,K=T.wsize-N):K=T.wnext-N,N>T.length&&(N=T.length),l=T.window}else l=w,K=E-T.offset,N=T.length;N>x&&(N=x),x-=N,T.length-=N;do{w[E++]=l[K++]}while(--N);0===T.length&&(T.mode=21);break;case 26:if(0===x)break h;w[E++]=T.length,x--,T.mode=21;break;case 27:if(T.wrap){for(;H<32;){if(0===z)break h;z--,g|=i[s++]<<H,H+=8}if(u-=x,h.total_out+=u,T.total+=u,u&&(h.adler=T.check=T.flags?y(T.check,w,u,E-u):Y(T.check,w,u,E-u)),u=x,(T.flags?g:V(g))!==T.check){h.Ld="incorrect data check",T.mode=D;break}g=0,H=0}T.mode=28;case 28:if(T.wrap&&T.flags){for(;H<32;){if(0===z)break h;z--,g+=i[s++]<<H,H+=8}if(g!==(4294967295&T.total)){h.Ld="incorrect length check",T.mode=D;break}g=0,H=0}T.mode=29;case 29:B=S;break h;case D:B=O;break h;case 31:return f;default:return c}return h.next_out=E,h.avail_out=x,h.next_in=s,h.avail_in=z,T.hold=g,T.bits=H,(T.wsize||u!==h.avail_out&&T.mode<D&&(T.mode<27||d!==X))&&k(h,h.output,h.next_out,u-h.avail_out)?(T.mode=31,f):(o-=h.avail_in,u-=h.avail_out,h.total_in+=o,h.total_out+=u,T.total+=u,T.wrap&&u&&(h.adler=T.check=T.flags?y(T.check,w,u,h.next_out-u):Y(T.check,w,u,h.next_out-u)),h.data_type=T.bits+(T.last?64:0)+(T.mode===L?128:0)+(20===T.mode||15===T.mode?256:0),(0===o&&0===u||d===X)&&B===Z&&(B=J),B)},h.exports.inflateEnd=h=>{if(!h||!h.state)return c;let d=h.state;return d.window&&(d.window=null),h.state=null,Z},h.exports.inflateGetHeader=(h,d)=>{if(!h||!h.state)return c;const T=h.state;return 0===(2&T.wrap)?c:(T.head=d,d.done=!1,Z)},h.exports.inflateSetDictionary=(h,d)=>{const T=d.length;let y,C,n;return h&&h.state?(y=h.state,0!==y.wrap&&11!==y.mode?c:11===y.mode&&(C=1,C=Y(C,d,T,0),C!==y.check)?O:(n=k(h,d,T,T),n?(y.mode=31,f):(y.havedict=1,Z))):c},h.exports.inflateInfo="pako inflate (from Nodeca project)"},13992:h=>{"use strict";const d=15,T=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Y=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),y=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),C=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);h.exports=(h,n,X,F,U,Z,S,r)=>{const c=r.bits;let O,f,J,W,L,D,V=0,i=0,w=0,s=0,E=0,z=0,x=0,g=0,H=0,p=0,k=null,o=0;const u=new Uint16Array(16),N=new Uint16Array(16);let K,l,q,j=null,a=0;for(V=0;V<=d;V++)u[V]=0;for(i=0;i<F;i++)u[n[X+i]]++;for(E=c,s=d;s>=1&&0===u[s];s--);if(E>s&&(E=s),0===s)return U[Z++]=20971520,U[Z++]=20971520,r.bits=1,0;for(w=1;w<s&&0===u[w];w++);for(E<w&&(E=w),g=1,V=1;V<=d;V++)if(g<<=1,g-=u[V],g<0)return-1;if(g>0&&(0===h||1!==s))return-1;for(N[1]=0,V=1;V<d;V++)N[V+1]=N[V]+u[V];for(i=0;i<F;i++)0!==n[X+i]&&(S[N[n[X+i]]++]=i);if(0===h?(k=j=S,D=19):1===h?(k=T,o-=257,j=Y,a-=257,D=256):(k=y,j=C,D=-1),p=0,i=0,V=w,L=Z,z=E,x=0,J=-1,H=1<<E,W=H-1,1===h&&H>852||2===h&&H>592)return 1;for(;;){K=V-x,S[i]<D?(l=0,q=S[i]):S[i]>D?(l=j[a+S[i]],q=k[o+S[i]]):(l=96,q=0),O=1<<V-x,f=1<<z,w=f;do{f-=O,U[L+(p>>x)+f]=K<<24|l<<16|q}while(0!==f);for(O=1<<V-1;p&O;)O>>=1;if(0!==O?(p&=O-1,p+=O):p=0,i++,0===--u[V]){if(V===s)break;V=n[X+S[i]]}if(V>E&&(p&W)!==J){for(0===x&&(x=E),L+=w,z=V-x,g=1<<z;z+x<s&&(g-=u[z+x],!(g<=0));)z++,g<<=1;if(H+=1<<z,1===h&&H>852||2===h&&H>592)return 1;J=p&W,U[J]=E<<24|z<<16|L-Z}}return 0!==p&&(U[L+p]=V-x<<24|64<<16),r.bits=E,0}},13951:h=>{"use strict";h.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13935:h=>{"use strict";function d(h){let d=h.length;for(;--d>=0;)h[d]=0}const T=256,Y=286,y=30,C=15,n=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),X=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),F=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),U=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Z=new Array(576);d(Z);const S=new Array(60);d(S);const r=new Array(512);d(r);const c=new Array(256);d(c);const O=new Array(29);d(O);const f=new Array(y);function J(h,d,T,Y,y){this.static_tree=h,this.extra_bits=d,this.extra_base=T,this.elems=Y,this.max_length=y,this.has_stree=h&&h.length}let W,L,D;function V(h,d){this.dyn_tree=h,this.max_code=0,this.stat_desc=d}d(f);const i=h=>h<256?r[h]:r[256+(h>>>7)],w=(h,d)=>{h.pending_buf[h.pending++]=255&d,h.pending_buf[h.pending++]=d>>>8&255},s=(h,d,T)=>{h.bi_valid>16-T?(h.bi_buf|=d<<h.bi_valid&65535,w(h,h.bi_buf),h.bi_buf=d>>16-h.bi_valid,h.bi_valid+=T-16):(h.bi_buf|=d<<h.bi_valid&65535,h.bi_valid+=T)},E=(h,d,T)=>{s(h,T[2*d],T[2*d+1])},z=(h,d)=>{let T=0;do{T|=1&h,h>>>=1,T<<=1}while(--d>0);return T>>>1},x=(h,d,T)=>{const Y=new Array(16);let y,n,X=0;for(y=1;y<=C;y++)Y[y]=X=X+T[y-1]<<1;for(n=0;n<=d;n++){let d=h[2*n+1];0!==d&&(h[2*n]=z(Y[d]++,d))}},g=h=>{let d;for(d=0;d<Y;d++)h.dyn_ltree[2*d]=0;for(d=0;d<y;d++)h.dyn_dtree[2*d]=0;for(d=0;d<19;d++)h.bl_tree[2*d]=0;h.dyn_ltree[512]=1,h.opt_len=h.static_len=0,h.last_lit=h.matches=0},H=h=>{h.bi_valid>8?w(h,h.bi_buf):h.bi_valid>0&&(h.pending_buf[h.pending++]=h.bi_buf),h.bi_buf=0,h.bi_valid=0},p=(h,d,T,Y)=>{const y=2*d,C=2*T;return h[y]<h[C]||h[y]===h[C]&&Y[d]<=Y[T]},k=(h,d,T)=>{const Y=h.heap[T];let y=T<<1;for(;y<=h.heap_len&&(y<h.heap_len&&p(d,h.heap[y+1],h.heap[y],h.depth)&&y++,!p(d,Y,h.heap[y],h.depth));)h.heap[T]=h.heap[y],T=y,y<<=1;h.heap[T]=Y},o=(h,d,Y)=>{let y,C,F,U,Z=0;if(0!==h.last_lit)do{y=h.pending_buf[h.d_buf+2*Z]<<8|h.pending_buf[h.d_buf+2*Z+1],C=h.pending_buf[h.l_buf+Z],Z++,0===y?E(h,C,d):(F=c[C],E(h,F+T+1,d),U=n[F],0!==U&&(C-=O[F],s(h,C,U)),y--,F=i(y),E(h,F,Y),U=X[F],0!==U&&(y-=f[F],s(h,y,U)))}while(Z<h.last_lit);E(h,256,d)},u=(h,d)=>{const T=d.dyn_tree,Y=d.stat_desc.static_tree,y=d.stat_desc.has_stree,n=d.stat_desc.elems;let X,F,U,Z=-1;for(h.heap_len=0,h.heap_max=573,X=0;X<n;X++)0!==T[2*X]?(h.heap[++h.heap_len]=Z=X,h.depth[X]=0):T[2*X+1]=0;for(;h.heap_len<2;)U=h.heap[++h.heap_len]=Z<2?++Z:0,T[2*U]=1,h.depth[U]=0,h.opt_len--,y&&(h.static_len-=Y[2*U+1]);for(d.max_code=Z,X=h.heap_len>>1;X>=1;X--)k(h,T,X);U=n;do{X=h.heap[1],h.heap[1]=h.heap[h.heap_len--],k(h,T,1),F=h.heap[1],h.heap[--h.heap_max]=X,h.heap[--h.heap_max]=F,T[2*U]=T[2*X]+T[2*F],h.depth[U]=(h.depth[X]>=h.depth[F]?h.depth[X]:h.depth[F])+1,T[2*X+1]=T[2*F+1]=U,h.heap[1]=U++,k(h,T,1)}while(h.heap_len>=2);h.heap[--h.heap_max]=h.heap[1],((h,d)=>{const T=d.dyn_tree,Y=d.max_code,y=d.stat_desc.static_tree,n=d.stat_desc.has_stree,X=d.stat_desc.extra_bits,F=d.stat_desc.extra_base,U=d.stat_desc.max_length;let Z,S,r,c,O,f,J=0;for(c=0;c<=C;c++)h.bl_count[c]=0;for(T[2*h.heap[h.heap_max]+1]=0,Z=h.heap_max+1;Z<573;Z++)S=h.heap[Z],c=T[2*T[2*S+1]+1]+1,c>U&&(c=U,J++),T[2*S+1]=c,S>Y||(h.bl_count[c]++,O=0,S>=F&&(O=X[S-F]),f=T[2*S],h.opt_len+=f*(c+O),n&&(h.static_len+=f*(y[2*S+1]+O)));if(0!==J){do{for(c=U-1;0===h.bl_count[c];)c--;h.bl_count[c]--,h.bl_count[c+1]+=2,h.bl_count[U]--,J-=2}while(J>0);for(c=U;0!==c;c--)for(S=h.bl_count[c];0!==S;)r=h.heap[--Z],r>Y||(T[2*r+1]!==c&&(h.opt_len+=(c-T[2*r+1])*T[2*r],T[2*r+1]=c),S--)}})(h,d),x(T,Z,h.bl_count)},N=(h,d,T)=>{let Y,y,C=-1,n=d[1],X=0,F=7,U=4;for(0===n&&(F=138,U=3),d[2*(T+1)+1]=65535,Y=0;Y<=T;Y++)y=n,n=d[2*(Y+1)+1],++X<F&&y===n||(X<U?h.bl_tree[2*y]+=X:0!==y?(y!==C&&h.bl_tree[2*y]++,h.bl_tree[32]++):X<=10?h.bl_tree[34]++:h.bl_tree[36]++,X=0,C=y,0===n?(F=138,U=3):y===n?(F=6,U=3):(F=7,U=4))},K=(h,d,T)=>{let Y,y,C=-1,n=d[1],X=0,F=7,U=4;for(0===n&&(F=138,U=3),Y=0;Y<=T;Y++)if(y=n,n=d[2*(Y+1)+1],!(++X<F&&y===n)){if(X<U)do{E(h,y,h.bl_tree)}while(0!==--X);else 0!==y?(y!==C&&(E(h,y,h.bl_tree),X--),E(h,16,h.bl_tree),s(h,X-3,2)):X<=10?(E(h,17,h.bl_tree),s(h,X-3,3)):(E(h,18,h.bl_tree),s(h,X-11,7));X=0,C=y,0===n?(F=138,U=3):y===n?(F=6,U=3):(F=7,U=4)}};let l=!1;const q=(h,d,T,Y)=>{s(h,0+(Y?1:0),3),((h,d,T,Y)=>{H(h),Y&&(w(h,T),w(h,~T)),h.pending_buf.set(h.window.subarray(d,d+T),h.pending),h.pending+=T})(h,d,T,!0)};h.exports._tr_init=h=>{l||((()=>{let h,d,T,U,V;const i=new Array(16);for(T=0,U=0;U<28;U++)for(O[U]=T,h=0;h<1<<n[U];h++)c[T++]=U;for(c[T-1]=U,V=0,U=0;U<16;U++)for(f[U]=V,h=0;h<1<<X[U];h++)r[V++]=U;for(V>>=7;U<y;U++)for(f[U]=V<<7,h=0;h<1<<X[U]-7;h++)r[256+V++]=U;for(d=0;d<=C;d++)i[d]=0;for(h=0;h<=143;)Z[2*h+1]=8,h++,i[8]++;for(;h<=255;)Z[2*h+1]=9,h++,i[9]++;for(;h<=279;)Z[2*h+1]=7,h++,i[7]++;for(;h<=287;)Z[2*h+1]=8,h++,i[8]++;for(x(Z,287,i),h=0;h<y;h++)S[2*h+1]=5,S[2*h]=z(h,5);W=new J(Z,n,257,Y,C),L=new J(S,X,0,y,C),D=new J(new Array(0),F,0,19,7)})(),l=!0),h.l_desc=new V(h.dyn_ltree,W),h.d_desc=new V(h.dyn_dtree,L),h.bl_desc=new V(h.bl_tree,D),h.bi_buf=0,h.bi_valid=0,g(h)},h.exports._tr_stored_block=q,h.exports._tr_flush_block=(h,d,Y,y)=>{let C,n,X=0;h.level>0?(2===h.strm.data_type&&(h.strm.data_type=(h=>{let d,Y=4093624447;for(d=0;d<=31;d++,Y>>>=1)if(1&Y&&0!==h.dyn_ltree[2*d])return 0;if(0!==h.dyn_ltree[18]||0!==h.dyn_ltree[20]||0!==h.dyn_ltree[26])return 1;for(d=32;d<T;d++)if(0!==h.dyn_ltree[2*d])return 1;return 0})(h)),u(h,h.l_desc),u(h,h.d_desc),X=(h=>{let d;for(N(h,h.dyn_ltree,h.l_desc.max_code),N(h,h.dyn_dtree,h.d_desc.max_code),u(h,h.bl_desc),d=18;d>=3&&0===h.bl_tree[2*U[d]+1];d--);return h.opt_len+=3*(d+1)+5+5+4,d})(h),C=h.opt_len+3+7>>>3,n=h.static_len+3+7>>>3,n<=C&&(C=n)):C=n=Y+5,Y+4<=C&&-1!==d?q(h,d,Y,y):4===h.strategy||n===C?(s(h,2+(y?1:0),3),o(h,Z,S)):(s(h,4+(y?1:0),3),((h,d,T,Y)=>{let y;for(s(h,d-257,5),s(h,T-1,5),s(h,Y-4,4),y=0;y<Y;y++)s(h,h.bl_tree[2*U[y]+1],3);K(h,h.dyn_ltree,d-1),K(h,h.dyn_dtree,T-1)})(h,h.l_desc.max_code+1,h.d_desc.max_code+1,X+1),o(h,h.dyn_ltree,h.dyn_dtree)),g(h),y&&H(h)},h.exports._tr_tally=(h,d,Y)=>(h.pending_buf[h.d_buf+2*h.last_lit]=d>>>8&255,h.pending_buf[h.d_buf+2*h.last_lit+1]=255&d,h.pending_buf[h.l_buf+h.last_lit]=255&Y,h.last_lit++,0===d?h.dyn_ltree[2*Y]++:(h.matches++,d--,h.dyn_ltree[2*(c[Y]+T+1)]++,h.dyn_dtree[2*i(d)]++),h.last_lit===h.lit_bufsize-1),h.exports._tr_align=h=>{s(h,2,3),E(h,256,Z),(h=>{16===h.bi_valid?(w(h,h.bi_buf),h.bi_buf=0,h.bi_valid=0):h.bi_valid>=8&&(h.pending_buf[h.pending++]=255&h.bi_buf,h.bi_buf>>=8,h.bi_valid-=8)})(h)}},13971:h=>{"use strict";h.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Ld="",this.state=null,this.data_type=2,this.adler=0}},13580:h=>{function d(h,d,T){for(var Y=h.length,y=-1/0,C=1/0,n=0;n<Y;n++){var X=(T[0][n]-h[n])/d[n],F=(T[1][n]-h[n])/d[n];if(X>F){var U=X;X=F,F=U}if(F<y||X>C)return 1/0;X>y&&(y=X),F<C&&(C=F)}return y>C?1/0:y}h.exports=function(h,T,Y,y){var C=d(T,Y,y);if(C===1/0)h=null;else{h=h||[];for(var n=0;n<T.length;n++)h[n]=T[n]+Y[n]*C}return h},h.exports.distance=d},15014:(h,d,T)=>{"use strict";T.d(d,{d:()=>n});var Y=T(23);const y=Y.useLayoutEffect;const C=function(h){var d=(0,Y.useRef)(h);return y((function(){d.current=h})),d};var n=function(h){var d=C(h);(0,Y.Zd)((function(){var h=function(h){var T;if(null!=d.current&&(T=d.current(h)),h.defaultPrevented&&(h.returnValue=""),"string"===typeof T)return h.returnValue=T,T};return window.addEventListener("beforeunload",h),function(){window.removeEventListener("beforeunload",h)}}),[])}},14969:(h,d,T)=>{"use strict";var Y=T(14975),y=Array.prototype.concat,C=Array.prototype.slice,n=h.exports=function(h){for(var d=[],T=0,n=h.length;T<n;T++){var X=h[T];Y(X)?d=y.call(d,C.call(X)):d.push(X)}return d};n.wrap=function(h){return function(){return h(n(arguments))}}},14975:h=>{h.exports=function(h){return!(!h||"string"===typeof h)&&(h instanceof Array||Array.isArray(h)||h.length>=0&&(h.splice instanceof Function||Object.getOwnPropertyDescriptor(h,h.length-1)&&"String"!==h.constructor.name))}},13877:(h,d,T)=>{var Y=T(13881);function y(h){for(var d,T,y=0,C=h.length,n=0;n<h.length;){for(d=h[n],T=0;n<C&&h[n]===d;)++n,++T;y+=Y.log2(T)/7|0,y+=Y.log2(d>>>0)/7|0,y+=2}return y}d.size=y,d.encode=function(h,d){d||(d=new Uint8Array(y(h)));for(var T,Y,C=0,n=d.length,X=0;X<h.length;){for(T=h[X],Y=0;X<h.length&&h[X]===T;)++X,++Y;for(;C<n&&Y>=128;)d[C++]=128+(127&Y),Y>>>=7;if(C>=n)throw new Error("RLE buffer overflow");for(d[C++]=Y,T>>>=0;C<n&&T>=128;)d[C++]=128+(127&T),T>>>=7;if(C>=n)throw new Error("RLE buffer overflow");d[C++]=T}return d},d.decode=function(h,d){for(var T,Y,y,C,n=d.length,X=h.length,F=0,U=0;U<X;){for(T=0,Y=0;U<X&&h[U]>=128;)T+=(127&h[U++])<<Y,Y+=7;if(T+=h[U++]<<Y,U>=X)throw new Error("RLE buffer underrun");if(F+T>n)throw new Error("Chunk buffer overflow");for(y=0,Y=0;U<X&&h[U]>=128;)y+=(127&h[U++])<<Y,Y+=7;if(U>=X)throw new Error("RLE buffer underrun");for(y+=h[U++]<<Y,C=0;C<T;++C)d[F++]=y}return d}},13881:(h,d)=>{"use strict";function T(h){var d=32;return(h&=-h)&&d--,65535&h&&(d-=16),16711935&h&&(d-=8),252645135&h&&(d-=4),858993459&h&&(d-=2),1431655765&h&&(d-=1),d}d.INT_BITS=32,d.INT_MAX=2147483647,d.INT_MIN=-1<<31,d.sign=function(h){return(h>0)-(h<0)},d.abs=function(h){var d=h>>31;return(h^d)-d},d.min=function(h,d){return d^(h^d)&-(h<d)},d.max=function(h,d){return h^(h^d)&-(h<d)},d.isPow2=function(h){return!(h&h-1)&&!!h},d.log2=function(h){var d,T;return d=(h>65535)<<4,d|=T=((h>>>=d)>255)<<3,d|=T=((h>>>=T)>15)<<2,(d|=T=((h>>>=T)>3)<<1)|(h>>>=T)>>1},d.log10=function(h){return h>=1e9?9:h>=1e8?8:h>=1e7?7:h>=1e6?6:h>=1e5?5:h>=1e4?4:h>=1e3?3:h>=100?2:h>=10?1:0},d.popCount=function(h){return 16843009*((h=(858993459&(h-=h>>>1&1431655765))+(h>>>2&858993459))+(h>>>4)&252645135)>>>24},d.countTrailingZeros=T,d.nextPow2=function(h){return h+=0===h,--h,h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)+1},d.prevPow2=function(h){return h|=h>>>1,h|=h>>>2,h|=h>>>4,h|=h>>>8,(h|=h>>>16)-(h>>>1)},d.parity=function(h){return h^=h>>>16,h^=h>>>8,h^=h>>>4,27030>>>(h&=15)&1};var Y=new Array(256);!function(h){for(var d=0;d<256;++d){var T=d,Y=d,y=7;for(T>>>=1;T;T>>>=1)Y<<=1,Y|=1&T,--y;h[d]=Y<<y&255}}(Y),d.reverse=function(h){return Y[255&h]<<24|Y[h>>>8&255]<<16|Y[h>>>16&255]<<8|Y[h>>>24&255]},d.interleave2=function(h,d){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))|(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d&=65535)|d<<8))|d<<4))|d<<2))|d<<1))<<1},d.deinterleave2=function(h,d){return(h=65535&((h=16711935&((h=252645135&((h=858993459&((h=h>>>d&1431655765)|h>>>1))|h>>>2))|h>>>4))|h>>>16))<<16>>16},d.interleave3=function(h,d,T){return h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2),(h|=(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<1)|(T=1227133513&((T=3272356035&((T=251719695&((T=4278190335&((T&=1023)|T<<16))|T<<8))|T<<4))|T<<2))<<2},d.deinterleave3=function(h,d){return(h=1023&((h=4278190335&((h=251719695&((h=3272356035&((h=h>>>d&1227133513)|h>>>2))|h>>>4))|h>>>8))|h>>>16))<<22>>22},d.nextCombination=function(h){var d=h|h-1;return d+1|(~d&-~d)-1>>>T(h)+1}},13905:h=>{"use strict";h.exports=function(h,d,T,Y){var y=self||window;try{try{var C;try{C=new y.Blob([h])}catch(U){(C=new(y.BlobBuilder||y.WebKitBlobBuilder||y.MozBlobBuilder||y.MSBlobBuilder)).append(h),C=C.getBlob()}var n=y.URL||y.webkitURL,X=n.createObjectURL(C),F=new y[d](X,T);return n.revokeObjectURL(X),F}catch(U){return new y[d]("data:application/javascript,".concat(encodeURIComponent(h)),T)}}catch(U){if(!Y)throw Error("Inline worker is not supported");return new y[d](Y,T)}}},13568:(h,d,T)=>{"use strict";function Y(h,d,T,Y,y){var C={};return Object.keys(Y).forEach((function(h){C[h]=Y[h]})),C.enumerable=!!C.enumerable,C.configurable=!!C.configurable,("value"in C||C.initializer)&&(C.writable=!0),C=T.slice().reverse().reduce((function(T,Y){return Y(h,d,T)||T}),C),y&&void 0!==C.initializer&&(C.value=C.initializer?C.initializer.call(y):void 0,C.initializer=void 0),void 0===C.initializer&&(Object.defineProperty(h,d,C),C=null),C}T.d(d,{e:()=>Y})},13565:(h,d,T)=>{"use strict";function Y(h,d,T,Y){T&&Object.defineProperty(h,d,{enumerable:T.enumerable,configurable:T.configurable,writable:T.writable,value:T.initializer?T.initializer.call(Y):void 0})}T.d(d,{e:()=>Y})},15003:(h,d,T)=>{"use strict";T.d(d,{b:()=>n,d:()=>S,h:()=>X,j:()=>C,l:()=>F,m:()=>y,p:()=>U,s:()=>Z});var Y=T(12963);class y{constructor(){this._easingMode=y.EASINGMODE_EASEIN}setEasingMode(h){const d=Math.min(Math.max(h,0),2);this._easingMode=d}getEasingMode(){return this._easingMode}easeInCore(h){throw new Error("You must implement this method")}ease(h){switch(this._easingMode){case y.EASINGMODE_EASEIN:return this.easeInCore(h);case y.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-h)}return h>=.5?.5*(1-this.easeInCore(2*(1-h)))+.5:.5*this.easeInCore(2*h)}}y.EASINGMODE_EASEIN=0,y.EASINGMODE_EASEOUT=1,y.EASINGMODE_EASEINOUT=2;class C extends y{easeInCore(h){return h=Math.max(0,Math.min(1,h)),1-Math.sqrt(1-h*h)}}class n extends y{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=h}easeInCore(h){const d=Math.max(0,this.amplitude);return Math.pow(h,3)-h*d*Math.sin(3.141592653589793*h)}}class X extends y{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=h,this.bounciness=d}easeInCore(h){const d=Math.max(0,this.bounces);let T=this.bounciness;T<=1&&(T=1.001);const Y=Math.pow(T,d),y=1-T,C=(1-Y)/y+.5*Y,n=h*C,X=Math.log(-n*(1-T)+1)/Math.log(T),F=Math.floor(X),U=F+1,Z=(1-Math.pow(T,F))/(y*C),S=.5*(Z+(1-Math.pow(T,U))/(y*C)),r=h-S,c=S-Z;return-Math.pow(1/T,d-F)/(c*c)*(r-c)*(r+c)}}class F extends y{easeInCore(h){return h*h*h}}class U extends y{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=h,this.springiness=d}easeInCore(h){let d;const T=Math.max(0,this.oscillations),Y=Math.max(0,this.springiness);return d=0==Y?h:(Math.exp(Y*h)-1)/(Math.exp(Y)-1),d*Math.sin((6.283185307179586*T+1.5707963267948966)*h)}}class Z extends y{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=h}easeInCore(h){return this.exponent<=0?h:(Math.exp(this.exponent*h)-1)/(Math.exp(this.exponent)-1)}}class S extends y{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=h,this.y1=d,this.x2=T,this.y2=Y}easeInCore(h){return Y.d.Interpolate(h,this.x1,this.y1,this.x2,this.y2)}}},14457:(h,d,T)=>{"use strict";T.d(d,{e:()=>n});var Y=T(12765),y=T(12779),C=T(13196);class n extends C.d{get _matrix(){return this._compose(),this.Nr}set _matrix(h){(h.updateFlag!==this.Nr.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Nr.C(h),this._markAsDirtyAndDecompose())}constructor(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(h,d.Eh(),!1),this.name=h,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=d,this.Nr=(null===y||void 0===y?void 0:y.clone())??Y.Matrix.Identity(),this._restMatrix=C??this.Nr.clone(),this._bindMatrix=n??this.Nr.clone(),this._index=X,this._absoluteMatrix=new Y.Matrix,this._absoluteBindMatrix=new Y.Matrix,this._absoluteInverseBindMatrix=new Y.Matrix,this._finalMatrix=new Y.Matrix,d.bones.push(this),this.setParent(T,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(h){this.setParent(h)}setParent(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==h){if(this.parent){const h=this.parent.children.indexOf(this);-1!==h&&this.parent.children.splice(h,1)}this._parentNode=h,this.parent&&this.parent.children.push(this),d&&this._updateAbsoluteBindMatrices(),this.YZ()}}getLocalMatrix(){return this._compose(),this.Nr}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(h){this._restMatrix.C(h)}setRestPose(h){this.setRestMatrix(h)}getBindPose(){return this.getBindMatrix()}setBindMatrix(h){this.bd(h)}setBindPose(h){this.setBindMatrix(h)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const h=Y.TmpVectors.pd[0],d=Y.TmpVectors.Quaternion[0],T=Y.TmpVectors.pd[1];this.getRestMatrix().decompose(h,d,T),this._linkedTransformNode.position.C(T),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??Y.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.C(d),this._linkedTransformNode.py.C(h)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(h){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=h,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.nF}set position(h){this._decompose(),this.nF.C(h),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(h){this.setRotation(h)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(h){this.setRotationQuaternion(h)}get py(){return this.getScale()}set py(h){this.setScale(h)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=Y.pd.Zero(),this._localRotation=Y.Quaternion.Zero(),this.nF=Y.pd.Zero()),this.Nr.decompose(this._localScaling,this._localRotation,this.nF))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,Y.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.nF,this.Nr)):this._needToCompose=!1)}bd(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.C(h),d&&this._updateAbsoluteBindMatrices(),T?this._matrix=h:this.YZ()}_updateAbsoluteBindMatrices(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(h||(h=this._bindMatrix),this.parent?h.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.C(h),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),d)for(let T=0;T<this.children.length;T++)this.children[T]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}YZ(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.YZ(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.YZ(),this._needToDecompose=!0}_updatePosition(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0,y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const C=this.getLocalMatrix();if(0==d)y?(C.addAtIndex(12,h.x),C.addAtIndex(13,h.y),C.addAtIndex(14,h.z)):C.setTranslationFromFloats(h.x,h.y,h.z);else{let d=null;T&&(d=T.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const X=n._TmpMats[0],F=n._TmpVecs[0];this.parent?T&&d?(X.C(this.parent.getAbsoluteMatrix()),X.multiplyToRef(d,X)):X.C(this.parent.getAbsoluteMatrix()):Y.Matrix.IdentityToRef(X),y&&X.setTranslationFromFloats(0,0,0),X.invert(),Y.pd.TransformCoordinatesToRef(h,X,F),y?(C.addAtIndex(12,F.x),C.addAtIndex(13,F.y),C.addAtIndex(14,F.z)):C.setTranslationFromFloats(F.x,F.y,F.z)}this._markAsDirtyAndDecompose()}translate(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;this._updatePosition(h,d,T,!0)}setPosition(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;this._updatePosition(h,d,T,!1)}setAbsolutePosition(h,d){this.setPosition(h,1,d)}scale(h,d,T){let y=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const C=this.getLocalMatrix(),X=n._TmpMats[0];Y.Matrix.ScalingToRef(h,d,T,X),X.multiplyToRef(C,C),X.invert();for(const Y of this.children){const y=Y.getLocalMatrix();y.multiplyToRef(X,y),y.multiplyAtIndex(12,h),y.multiplyAtIndex(13,d),y.multiplyAtIndex(14,T),Y._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),y)for(const Y of this.children)Y.scale(h,d,T,y)}setScale(h){this._decompose(),this._localScaling.C(h),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(h){this._decompose(),h.C(this._localScaling)}setYawPitchRoll(h,d,T){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4?arguments[4]:void 0;if(0===y){const X=n._TmpQuat;return Y.Quaternion.RotationYawPitchRollToRef(h,d,T,X),void this.setRotationQuaternion(X,y,C)}const X=n._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,C))return;const F=n._TmpMats[1];Y.Matrix.RotationYawPitchRollToRef(h,d,T,F),X.multiplyToRef(F,F),this._rotateWithMatrix(F,y,C)}rotate(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,y=arguments.length>3?arguments[3]:void 0;const C=n._TmpMats[0];C.setTranslationFromFloats(0,0,0),Y.Matrix.RotationAxisToRef(h,d,C),this._rotateWithMatrix(C,T,y)}setAxisAngle(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,y=arguments.length>3?arguments[3]:void 0;if(0===T){const C=n._TmpQuat;return Y.Quaternion.RotationAxisToRef(h,d,C),void this.setRotationQuaternion(C,T,y)}const C=n._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(C,y))return;const X=n._TmpMats[1];Y.Matrix.RotationAxisToRef(h,d,X),C.multiplyToRef(X,X),this._rotateWithMatrix(X,T,y)}setRotation(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(h.y,h.x,h.z,d,T)}setRotationQuaternion(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;if(0===d)return this._decompose(),this._localRotation.C(h),void this._markAsDirtyAndCompose();const y=n._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(y,T))return;const C=n._TmpMats[1];Y.Matrix.FromQuaternionToRef(h,C),y.multiplyToRef(C,C),this._rotateWithMatrix(C,d,T)}setRotationMatrix(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;if(0===d){const y=n._TmpQuat;return Y.Quaternion.FromRotationMatrixToRef(h,y),void this.setRotationQuaternion(y,d,T)}const y=n._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(y,T))return;const C=n._TmpMats[1];C.C(h),y.multiplyToRef(h,C),this._rotateWithMatrix(C,d,T)}_rotateWithMatrix(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;const Y=this.getLocalMatrix(),y=Y.m[12],C=Y.m[13],X=Y.m[14],F=this.getParent(),U=n._TmpMats[3],Z=n._TmpMats[4];F&&1==d?(T?(U.C(T.getWorldMatrix()),F.getAbsoluteMatrix().multiplyToRef(U,U)):U.C(F.getAbsoluteMatrix()),Z.C(U),Z.invert(),Y.multiplyToRef(U,Y),Y.multiplyToRef(h,Y),Y.multiplyToRef(Z,Y)):1==d&&T?(U.C(T.getWorldMatrix()),Z.C(U),Z.invert(),Y.multiplyToRef(U,Y),Y.multiplyToRef(h,Y),Y.multiplyToRef(Z,Y)):Y.multiplyToRef(h,Y),Y.setTranslationFromFloats(y,C,X),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(h,d){const T=n._TmpMats[2];return h.C(this.getAbsoluteMatrix()),d?(h.multiplyToRef(d.getWorldMatrix(),h),Y.Matrix.ScalingToRef(d.py.x,d.py.y,d.py.z,T)):Y.Matrix.IdentityToRef(T),h.invert(),!isNaN(h.m[0])&&(T.multiplyAtIndex(0,this._scalingDeterminant),h.multiplyToRef(T,h),!0)}rd(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=Y.pd.Zero();return this.getPositionToRef(h,d,T),T}getPositionToRef(){let h=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const h=this.getLocalMatrix();d.x=h.m[12],d.y=h.m[13],d.z=h.m[14]}else{let T=null;h&&(T=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let Y=n._TmpMats[0];h&&T?(Y.C(this.getAbsoluteMatrix()),Y.multiplyToRef(T,Y)):Y=this.getAbsoluteMatrix(),d.x=Y.m[12],d.y=Y.m[13],d.z=Y.m[14]}}getAbsolutePosition(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const d=Y.pd.Zero();return this.getPositionToRef(1,h,d),d}getAbsolutePositionToRef(h,d){this.getPositionToRef(1,h,d)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Nr.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.C(this.Nr);const h=this._skeleton.getPoseMatrix();h&&this._absoluteMatrix.multiplyToRef(h,this._absoluteMatrix)}const h=this.children,d=h.length;for(let T=0;T<d;T++)h[T].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}NF(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=Y.pd.Zero();return this.getDirectionToRef(h,d,T),T}getDirectionToRef(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,y=null;d&&(y=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=n._TmpMats[0];C.C(this.getAbsoluteMatrix()),d&&y&&C.multiplyToRef(y,C),Y.pd.TransformNormalToRef(h,C,T),T.normalize()}getRotation(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=Y.pd.Zero();return this.getRotationToRef(h,d,T),T}getRotationToRef(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0;const Y=n._TmpQuat;this.getRotationQuaternionToRef(h,d,Y),Y.toEulerAnglesToRef(T)}getRotationQuaternion(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=Y.Quaternion.Identity();return this.getRotationQuaternionToRef(h,d,T),T}getRotationQuaternionToRef(){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),d.C(this._localRotation);else{const T=n._TmpMats[0],Y=this.getAbsoluteMatrix();h?Y.multiplyToRef(h.getWorldMatrix(),T):T.C(Y),T.multiplyAtIndex(0,this._scalingDeterminant),T.multiplyAtIndex(1,this._scalingDeterminant),T.multiplyAtIndex(2,this._scalingDeterminant),T.decompose(void 0,d,void 0)}}getRotationMatrix(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1?arguments[1]:void 0;const T=Y.Matrix.Identity();return this.getRotationMatrixToRef(h,d,T),T}getRotationMatrixToRef(){let h=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(d);else{const T=n._TmpMats[0],Y=this.getAbsoluteMatrix();h?Y.multiplyToRef(h.getWorldMatrix(),T):T.C(Y),T.multiplyAtIndex(0,this._scalingDeterminant),T.multiplyAtIndex(1,this._scalingDeterminant),T.multiplyAtIndex(2,this._scalingDeterminant),T.getRotationMatrixToRef(d)}}getAbsolutePositionFromLocal(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=Y.pd.Zero();return this.getAbsolutePositionFromLocalToRef(h,d,T),T}getAbsolutePositionFromLocalToRef(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,y=null;d&&(y=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=n._TmpMats[0];C.C(this.getAbsoluteMatrix()),d&&y&&C.multiplyToRef(y,C),Y.pd.TransformCoordinatesToRef(h,C,T)}getLocalPositionFromAbsolute(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=Y.pd.Zero();return this.getLocalPositionFromAbsoluteToRef(h,d,T),T}getLocalPositionFromAbsoluteToRef(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,y=null;d&&(y=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=n._TmpMats[0];C.C(this.getAbsoluteMatrix()),d&&y&&C.multiplyToRef(y,C),C.invert(),Y.pd.TransformCoordinatesToRef(h,C,T)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const h=this._skeleton.bones.indexOf(this);if(-1!==h&&this._skeleton.bones.splice(h,1),this._parentNode&&this._parentNode.children){const h=this._parentNode.children,d=h.indexOf(this);-1!==d&&h.splice(d,1)}super.dispose()}}n._TmpVecs=(0,y.e)(2,Y.pd.Zero),n._TmpQuat=Y.Quaternion.Identity(),n._TmpMats=(0,y.e)(5,Y.Matrix.Identity)},15e3:(h,d,T)=>{"use strict";T.d(d,{d:()=>u});var Y=T(12750),y=T(12757),C=T(12583),n=T(12765),X=T(12787),F=T(13196),U=T(13213),Z=T(13040),S=T(12609),r=T(12772);class c{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(h){this._zoomStopsAnimation=h}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(h){this._idleRotationSpeed=h}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(h){this._idleRotationWaitTime=h}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(h){this._idleRotationSpinupTime=h}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(h){this._attachedCamera=h;const d=this._attachedCamera.Eh();this._onPrePointerObservableObserver=d.onPrePointerObservable.add((h=>{h.type!==Z.e.POINTERDOWN?h.type===Z.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=h.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const h=S.b.Now;let d=0;null!=this._lastFrameTime&&(d=h-this._lastFrameTime),this._lastFrameTime=h,this._applyUserInteraction();const T=h-this._lastInteractionTime-this._idleRotationWaitTime,Y=Math.max(Math.min(T/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*Y,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(d/1e3))}))}detach(){if(!this._attachedCamera)return;const h=this._attachedCamera.Eh();this._onPrePointerObservableObserver&&h.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(h){this._lastInteractionTime=h??S.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<r.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let h=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(h=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?h:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=S.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var O=T(15003),f=T(13301);class J{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(h){if(this._autoTransitionRange===h)return;this._autoTransitionRange=h;const d=this._attachedCamera;d&&(h?this._onMeshTargetChangedObserver=d.onMeshTargetChangedObservable.add((h=>{if(h&&(h.Md(!0),h.getBoundingInfo)){const d=h.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*d,this.upperRadiusTransitionRange=.05*d}})):this._onMeshTargetChangedObserver&&d.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(h){this._attachedCamera=h,this._onAfterCheckInputsObserver=h.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(h){return!!this._attachedCamera&&(this._attachedCamera.radius===h&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(h){if(!this._attachedCamera)return;this._radiusBounceTransition||(J.EasingFunction.setEasingMode(J.EasingMode),this._radiusBounceTransition=f.c.CreateAnimation("radius",f.c.ANIMATIONTYPE_FLOAT,60,J.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const d=f.c.TransitionTo("radius",this._attachedCamera.radius+h,this._attachedCamera,this._attachedCamera.Eh(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));d&&this._animatables.push(d)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}J.EasingFunction=new O.b(.3),J.EasingMode=O.m.EASINGMODE_EASEOUT;class W{constructor(){this.onTargetFramingAnimationEndObservable=new C.e,this._mode=W.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(h){this._mode=h}get mode(){return this._mode}set radiusScale(h){this._radiusScale=h}get radiusScale(){return this._radiusScale}set positionScale(h){this._positionScale=h}get positionScale(){return this._positionScale}set defaultElevation(h){this._defaultElevation=h}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(h){this._elevationReturnTime=h}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(h){this._elevationReturnWaitTime=h}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(h){this._zoomStopsAnimation=h}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(h){this._framingTime=h}get framingTime(){return this._framingTime}init(){}attach(h){this._attachedCamera=h;const d=this._attachedCamera.Eh();W.EasingFunction.setEasingMode(W.EasingMode),this._onPrePointerObservableObserver=d.onPrePointerObservable.add((h=>{h.type!==Z.e.POINTERDOWN?h.type===Z.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=h.onMeshTargetChangedObservable.add((h=>{h&&h.getBoundingInfo&&this.zoomOnMesh(h,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=h.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const h=this._attachedCamera.Eh();this._onPrePointerObservableObserver&&h.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h.Md(!0);const Y=h.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(Y.minimumWorld,Y.maximumWorld,d,T)}zoomOnMeshHierarchy(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h.Md(!0);const Y=h.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(Y.min,Y.max,d,T)}zoomOnMeshesHierarchy(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=new n.pd(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),y=new n.pd(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let C=0;C<h.length;C++){const d=h[C].getHierarchyBoundingVectors(!0);n.pd.CheckExtends(d.min,Y,y),n.pd.CheckExtends(d.max,Y,y)}this.zoomOnBoundingInfo(Y,y,d,T)}zoomOnBoundingInfo(h,d){let T,Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const C=h.y,X=C+(d.y-C)*this._positionScale,F=d.Nd(h).scale(.5);if(!isFinite(X))return!1;if(Y)T=new n.pd(0,X,0);else{const d=h.add(F);T=new n.pd(d.x,X,d.z)}this._vectorTransition||(this._vectorTransition=f.c.CreateAnimation("target",f.c.ANIMATIONTYPE_VECTOR3,60,W.EasingFunction)),this._betaIsAnimating=!0;let U=f.c.TransitionTo("target",T,this._attachedCamera,this._attachedCamera.Eh(),60,this._vectorTransition,this._framingTime);U&&this._animatables.push(U);let Z=0;if(this._mode===W.FitFrustumSidesMode){const T=this._calculateLowerRadiusFromModelBoundingSphere(h,d);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=F.length()+this._attachedCamera.Gd),Z=T}else this._mode===W.IgnoreBoundsSizeMode&&(Z=this._calculateLowerRadiusFromModelBoundingSphere(h,d),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Gd));if(this.autoCorrectCameraLimitsAndSensibility){const T=d.Nd(h).length();this._attachedCamera.panningSensibility=5e3/T,this._attachedCamera.wheelPrecision=100/Z}return this._radiusTransition||(this._radiusTransition=f.c.CreateAnimation("radius",f.c.ANIMATIONTYPE_FLOAT,60,W.EasingFunction)),U=f.c.TransitionTo("radius",Z,this._attachedCamera,this._attachedCamera.Eh(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),y&&y(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),U&&this._animatables.push(U),!0}_calculateLowerRadiusFromModelBoundingSphere(h,d){const T=this._attachedCamera;if(!T)return 0;let Y=T._calculateLowerRadiusFromModelBoundingSphere(h,d,this._radiusScale);return T.lowerRadiusLimit&&this._mode===W.IgnoreBoundsSizeMode&&(Y=Y<T.lowerRadiusLimit?T.lowerRadiusLimit:Y),T.upperRadiusLimit&&(Y=Y>T.upperRadiusLimit?T.upperRadiusLimit:Y),Y}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const h=S.b.Now-this._lastInteractionTime,d=.5*Math.PI-this._defaultElevation,T=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>T&&h>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=f.c.CreateAnimation("beta",f.c.ANIMATIONTYPE_FLOAT,60,W.EasingFunction));const h=f.c.TransitionTo("beta",d,this._attachedCamera,this._attachedCamera.Eh(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));h&&this._animatables.push(h)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=S.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}W.EasingFunction=new O.s,W.EasingMode=O.m.EASINGMODE_EASEINOUT,W.IgnoreBoundsSizeMode=0,W.FitFrustumSidesMode=1;var L=T(13222),D=T(13252),V=T(14453),i=T(12574);class w{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(h){h=i.Tools.BackCompatCameraNoPreventDefault(arguments);const d=this.camera.getEngine(),T=d.getInputElement();let Y=0,y=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=C=>{var n,X;const F=C.event,U="touch"===F.pointerType;if(C.type!==Z.e.POINTERMOVE&&-1===this.buttons.indexOf(F.button))return;const S=F.target;if(this._altKey=F.altKey,this._ctrlKey=F.ctrlKey,this._metaKey=F.metaKey,this._shiftKey=F.shiftKey,this._buttonsPressed=F.buttons,d.isPointerLock){const h=F.movementX,d=F.movementY;this.onTouch(null,h,d),this._pointA=null,this._pointB=null}else{if(C.type!==Z.e.POINTERDOWN&&C.type!==Z.e.POINTERDOUBLETAP&&U&&(null===(n=this._pointA)||void 0===n?void 0:n.pointerId)!==F.pointerId&&(null===(X=this._pointB)||void 0===X?void 0:X.pointerId)!==F.pointerId)return;if(C.type!==Z.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!U)if(C.type===Z.e.POINTERDOUBLETAP)this.onDoubleTap(F.pointerType);else if(C.type!==Z.e.POINTERUP||this._currentMousePointerIdDown!==F.pointerId&&!U){if(C.type===Z.e.POINTERMOVE)if(h||F.preventDefault(),this._pointA&&null===this._pointB){const h=F.clientX-this._pointA.x,d=F.clientY-this._pointA.y;this._pointA.x=F.clientX,this._pointA.y=F.clientY,this.onTouch(this._pointA,h,d)}else if(this._pointA&&this._pointB){const h=this._pointA.pointerId===F.pointerId?this._pointA:this._pointB;h.x=F.clientX,h.y=F.clientY;const d=this._pointA.x-this._pointB.x,T=this._pointA.y-this._pointB.y,n=d*d+T*T,X={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:F.pointerId,type:C.type};this.onMultiTouch(this._pointA,this._pointB,Y,n,y,X),y=X,Y=n}}else{try{null===S||void 0===S||S.releasePointerCapture(F.pointerId)}catch(r){}U||(this._pointB=null),d._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==F.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==F.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==Y||y)&&(this.onMultiTouch(this._pointA,this._pointB,Y,0,y,null),Y=0,y=null),this._currentMousePointerIdDown=-1,this.onButtonUp(F),h||F.preventDefault()}else{try{null===S||void 0===S||S.setPointerCapture(F.pointerId)}catch(r){}if(null===this._pointA)this._pointA={x:F.clientX,y:F.clientY,pointerId:F.pointerId,type:F.pointerType};else{if(null!==this._pointB)return;this._pointB={x:F.clientX,y:F.clientY,pointerId:F.pointerId,type:F.pointerType}}-1!==this._currentMousePointerIdDown||U||(this._currentMousePointerIdDown=F.pointerId),this.onButtonDown(F),h||(F.preventDefault(),T&&T.focus())}}},this._observer=this.camera.Eh()._inputManager._addCameraPointerObserver(this._pointerInput,Z.e.POINTERDOWN|Z.e.POINTERUP|Z.e.POINTERMOVE|Z.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,Y=0,y=null,this.onLostFocus()},this._contextMenuBind=h=>this.onContextMenu(h),T&&T.addEventListener("contextmenu",this._contextMenuBind,!1);const C=this.camera.Eh().getEngine().getHostWindow();C&&i.Tools.RegisterTopRootEvents(C,[{name:"blur",handler:this._onLostFocus}])}GS(){if(this._onLostFocus){const h=this.camera.Eh().getEngine().getHostWindow();h&&i.Tools.UnregisterTopRootEvents(h,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Eh()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const h=this.camera.Eh().getEngine().getInputElement();h&&h.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(h){}onTouch(h,d,T){}onMultiTouch(h,d,T,Y,y,C){}onContextMenu(h){h.preventDefault()}onButtonDown(h){}onButtonUp(h){}onLostFocus(){}}(0,Y.c)([(0,y.E)()],w.prototype,"buttons",void 0);class s extends w{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(h,d){if(0!==this.panningSensibility&&h&&d){const T=d.x-h.x,Y=d.y-h.y;this.camera.inertialPanningX+=-T/this.panningSensibility,this.camera.inertialPanningY+=Y/this.panningSensibility}}_computePinchZoom(h,d){const T=this.camera.radius||s.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=T*Math.sqrt(h)/Math.sqrt(d):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(d-h)*T*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(d-h)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(h,d,T){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-d/this.panningSensibility,this.camera.inertialPanningY+=T/this.panningSensibility):(this.camera.inertialAlphaOffset-=d/this.angularSensibilityX,this.camera.inertialBetaOffset-=T/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(h,d,T,Y,y,C){0===T&&null===y||0===Y&&null===C||(this.multiTouchPanAndZoom?(this._computePinchZoom(T,Y),this._computeMultiTouchPanning(y,C)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(Y)-Math.sqrt(T))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(T,Y),this._isPinching=!0):this._computeMultiTouchPanning(y,C)):this.multiTouchPanning?this._computeMultiTouchPanning(y,C):this.pinchZoom&&this._computePinchZoom(T,Y))}onButtonDown(h){this._isPanClick=h.button===this.camera._panningMouseButton}onButtonUp(h){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}s.MinimumRadiusForPinch=.001,(0,Y.c)([(0,y.E)()],s.prototype,"buttons",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"angularSensibilityX",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"angularSensibilityY",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"pinchPrecision",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"pinchDeltaPercentage",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"useNaturalPinchZoom",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"pinchZoom",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"panningSensibility",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"multiTouchPanning",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"multiTouchPanAndZoom",void 0),V.d.ArcRotateCameraPointersInput=s;var E=T(13047);class z{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(h){h=i.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Eh(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((d=>{const T=d.event;if(!T.metaKey)if(d.type===E.c.KEYDOWN){if(this._ctrlPressed=T.ctrlKey,this._altPressed=T.altKey,-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysReset.indexOf(T.keyCode)){-1===this._keys.indexOf(T.keyCode)&&this._keys.push(T.keyCode),T.preventDefault&&(h||T.preventDefault())}}else if(-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysReset.indexOf(T.keyCode)){const d=this._keys.indexOf(T.keyCode);d>=0&&this._keys.splice(d,1),T.preventDefault&&(h||T.preventDefault())}})))}GS(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const h=this.camera;for(let d=0;d<this._keys.length;d++){const T=this._keys[d];-1!==this.keysLeft.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningX-=1/this.panningSensibility:h.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?h.inertialRadiusOffset+=1/this.zoomingSensibility:h.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningX+=1/this.panningSensibility:h.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?h.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?h.inertialRadiusOffset-=1/this.zoomingSensibility:h.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(T)&&h.useInputToRestoreState&&h.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,Y.c)([(0,y.E)()],z.prototype,"keysUp",void 0),(0,Y.c)([(0,y.E)()],z.prototype,"keysDown",void 0),(0,Y.c)([(0,y.E)()],z.prototype,"keysLeft",void 0),(0,Y.c)([(0,y.E)()],z.prototype,"keysRight",void 0),(0,Y.c)([(0,y.E)()],z.prototype,"keysReset",void 0),(0,Y.c)([(0,y.E)()],z.prototype,"panningSensibility",void 0),(0,Y.c)([(0,y.E)()],z.prototype,"zoomingSensibility",void 0),(0,Y.c)([(0,y.E)()],z.prototype,"useAltToZoom",void 0),(0,Y.c)([(0,y.E)()],z.prototype,"angularSpeed",void 0),V.d.ArcRotateCameraKeyboardMoveInput=z;var x=T(12814),g=T(13055);class H{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new n.pd(0,0,0),this._globalOffset=new n.pd(0,0,0),this._inertialPanning=n.pd.Zero()}_computeDeltaFromMouseWheelLegacyEvent(h,d){let T=0;const Y=.01*h*this.wheelDeltaPercentage*d;return T=h>0?Y/(1+this.wheelDeltaPercentage):Y*(1+this.wheelDeltaPercentage),T}attachControl(h){h=i.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=d=>{if(d.type!==Z.e.POINTERWHEEL)return;const T=d.event;let Y=0;const y=T.deltaMode===g.e.DOM_DELTA_LINE?40:1,C=-T.deltaY*y;if(this.customComputeDeltaFromMouseWheel)Y=this.customComputeDeltaFromMouseWheel(C,this,T);else if(this.wheelDeltaPercentage){if(Y=this._computeDeltaFromMouseWheelLegacyEvent(C,this.camera.radius),Y>0){let h=this.camera.radius,d=this.camera.inertialRadiusOffset+Y;for(let T=0;T<20&&!(h<=d)&&!(Math.abs(d*this.camera.inertia)<.001);T++)h-=d,d*=this.camera.inertia;h=(0,X.Clamp)(h,0,Number.MAX_VALUE),Y=this._computeDeltaFromMouseWheelLegacyEvent(C,h)}}else Y=C/(40*this.wheelPrecision);Y&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(Y)):this.camera.inertialRadiusOffset+=Y),T.preventDefault&&(h||T.preventDefault())},this._observer=this.camera.Eh()._inputManager._addCameraPointerObserver(this._wheel,Z.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.XC(0)}GS(){this._observer&&(this.camera.Eh()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const h=this.camera;0+h.inertialAlphaOffset+h.inertialBetaOffset+h.inertialRadiusOffset&&(this._updateHitPlane(),h.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(h.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const h=this.camera,d=h.target.Nd(h.position);this._hitPlane=x.d.FromPositionAndNormal(h.target,d)}_getPosition(){const h=this.camera,d=h.Eh(),T=d.createPickingRay(d.pointerX,d.pointerY,n.Matrix.Identity(),h,!1);0===h.targetScreenOffset.x&&0===h.targetScreenOffset.y||(this._viewOffset.set(h.targetScreenOffset.x,h.targetScreenOffset.y,0),h.getViewMatrix().invertToRef(h._cameraTransformMatrix),this._globalOffset=n.pd.TransformNormal(this._viewOffset,h._cameraTransformMatrix),T.origin.addInPlace(this._globalOffset));let Y=0;return this._hitPlane&&(Y=T.intersectsPlane(this._hitPlane)??0),T.origin.addInPlace(T.direction.scaleInPlace(Y))}_zoomToMouse(h){const d=this.camera,T=1-d.inertia;if(d.lowerRadiusLimit){const Y=d.lowerRadiusLimit??0;d.radius-(d.inertialRadiusOffset+h)/T<Y&&(h=(d.radius-Y)*T-d.inertialRadiusOffset)}if(d.upperRadiusLimit){const Y=d.upperRadiusLimit??0;d.radius-(d.inertialRadiusOffset+h)/T>Y&&(h=(d.radius-Y)*T-d.inertialRadiusOffset)}const Y=h/T/d.radius,y=this._getPosition(),C=n.TmpVectors.pd[6];y.subtractToRef(d.target,C),C.scaleInPlace(Y),C.scaleInPlace(T),this._inertialPanning.addInPlace(C),d.inertialRadiusOffset+=h}_zeroIfClose(h){Math.abs(h.x)<r.d&&(h.x=0),Math.abs(h.y)<r.d&&(h.y=0),Math.abs(h.z)<r.d&&(h.z=0)}}(0,Y.c)([(0,y.E)()],H.prototype,"wheelPrecision",void 0),(0,Y.c)([(0,y.E)()],H.prototype,"zoomToMouseLocation",void 0),(0,Y.c)([(0,y.E)()],H.prototype,"wheelDeltaPercentage",void 0),V.d.ArcRotateCameraMouseWheelInput=H;class p extends V.f{constructor(h){super(h)}addMouseWheel(){return this.add(new H),this}addPointers(){return this.add(new s),this}addKeyboard(){return this.add(new z),this}}var k=T(12714);function o(h,d){return isNaN(h)?d:h}F.d.AddNodeConstructor("ArcRotateCamera",((h,d)=>()=>new u(h,0,0,1,n.pd.Zero(),d)));class u extends D.d{get target(){return this._target}set target(h){this.setTarget(h)}get targetHost(){return this._targetHost}set targetHost(h){h&&this.setTarget(h)}getTarget(){return this.target}get position(){return this._position}set position(h){this.setPosition(h)}set upVector(h){this._upToYMatrix||(this._yToUpMatrix=new n.Matrix,this._upToYMatrix=new n.Matrix,this._upVector=n.pd.Zero()),h.normalize(),this._upVector.C(h),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){n.Matrix.RotationAlignToRef(n.pd.UpReadOnly,this._upVector,this._yToUpMatrix),n.Matrix.RotationAlignToRef(this._upVector,n.pd.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const h=this.inputs.attached.pointers;return h?h.angularSensibilityX:0}set angularSensibilityX(h){const d=this.inputs.attached.pointers;d&&(d.angularSensibilityX=h)}get angularSensibilityY(){const h=this.inputs.attached.pointers;return h?h.angularSensibilityY:0}set angularSensibilityY(h){const d=this.inputs.attached.pointers;d&&(d.angularSensibilityY=h)}get pinchPrecision(){const h=this.inputs.attached.pointers;return h?h.pinchPrecision:0}set pinchPrecision(h){const d=this.inputs.attached.pointers;d&&(d.pinchPrecision=h)}get pinchDeltaPercentage(){const h=this.inputs.attached.pointers;return h?h.pinchDeltaPercentage:0}set pinchDeltaPercentage(h){const d=this.inputs.attached.pointers;d&&(d.pinchDeltaPercentage=h)}get useNaturalPinchZoom(){const h=this.inputs.attached.pointers;return!!h&&h.useNaturalPinchZoom}set useNaturalPinchZoom(h){const d=this.inputs.attached.pointers;d&&(d.useNaturalPinchZoom=h)}get panningSensibility(){const h=this.inputs.attached.pointers;return h?h.panningSensibility:0}set panningSensibility(h){const d=this.inputs.attached.pointers;d&&(d.panningSensibility=h)}get keysUp(){const h=this.inputs.attached.keyboard;return h?h.keysUp:[]}set keysUp(h){const d=this.inputs.attached.keyboard;d&&(d.keysUp=h)}get keysDown(){const h=this.inputs.attached.keyboard;return h?h.keysDown:[]}set keysDown(h){const d=this.inputs.attached.keyboard;d&&(d.keysDown=h)}get keysLeft(){const h=this.inputs.attached.keyboard;return h?h.keysLeft:[]}set keysLeft(h){const d=this.inputs.attached.keyboard;d&&(d.keysLeft=h)}get keysRight(){const h=this.inputs.attached.keyboard;return h?h.keysRight:[]}set keysRight(h){const d=this.inputs.attached.keyboard;d&&(d.keysRight=h)}get wheelPrecision(){const h=this.inputs.attached.mousewheel;return h?h.wheelPrecision:0}set wheelPrecision(h){const d=this.inputs.attached.mousewheel;d&&(d.wheelPrecision=h)}get zoomToMouseLocation(){const h=this.inputs.attached.mousewheel;return!!h&&h.zoomToMouseLocation}set zoomToMouseLocation(h){const d=this.inputs.attached.mousewheel;d&&(d.zoomToMouseLocation=h)}get wheelDeltaPercentage(){const h=this.inputs.attached.mousewheel;return h?h.wheelDeltaPercentage:0}set wheelDeltaPercentage(h){const d=this.inputs.attached.mousewheel;d&&(d.wheelDeltaPercentage=h)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(h){h!==this.useBouncingBehavior&&(h?(this._bouncingBehavior=new J,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(h){h!==this.useFramingBehavior&&(h?(this._framingBehavior=new W,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(h){h!==this.useAutoRotationBehavior&&(h?(this._autoRotationBehavior=new c,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(h,d,T,Y,y,X){var F;let U=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(h,n.pd.Zero(),X,U),F=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=n.pd.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=n.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new n.Matrix,this.panningAxis=new n.pd(1,1,0),this._transformedDirection=new n.pd,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new C.e,this.checkCollisions=!1,this.collisionRadius=new n.pd(.5,.5,.5),this._previousPosition=n.pd.Zero(),this._collisionVelocity=n.pd.Zero(),this._newPosition=n.pd.Zero(),this._computationVector=n.pd.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new n.pd(NaN,NaN,NaN),this._goalTargetScreenOffset=new n.Vector2(NaN,NaN),this._onCollisionPositionChange=function(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;T?(F.setPosition(d),F.UO&&F.UO(T)):F._previousPosition.C(F._position);const Y=Math.cos(F.alpha),y=Math.sin(F.alpha),C=Math.cos(F.beta);let n=Math.sin(F.beta);0===n&&(n=1e-4);const X=F._getTargetPosition();F._computationVector.ny(F.radius*Y*n,F.radius*C,F.radius*y*n),X.addToRef(F._computationVector,F._newPosition),F._position.C(F._newPosition);let U=F.upVector;F.allowUpsideDown&&F.beta<0&&(U=U.clone(),U=U.negate()),F._computeViewMatrix(F._position,X,U),F._viewMatrix.addAtIndex(12,F.targetScreenOffset.x),F._viewMatrix.addAtIndex(13,F.targetScreenOffset.y),F._collisionTriggered=!1},this._target=n.pd.Zero(),y&&this.setTarget(y),this.alpha=d,this.beta=T,this.radius=Y,this.getViewMatrix(),this.inputs=new p(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new n.pd(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=n.Vector2.Zero()}_updateCache(h){h||super._updateCache(),this._cache._target.C(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.C(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const h=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?h.addToRef(this._targetBoundingCenter,this._target):this._target.C(h)}const h=this._getLockedTargetPosition();return h||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>r.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,C=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=C?this._currentInterpolationFactor=C:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=o(h,this._goalAlpha),this._goalBeta=o(d,this._goalBeta),this._goalRadius=o(T,this._goalRadius),this._goalTarget.set(o(Y.x,this._goalTarget.x),o(Y.y,this._goalTarget.y),o(Y.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(o(y.x,this._goalTargetScreenOffset.x),o(y.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,X.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,X.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,X.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,X.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(h,d){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const y=arguments;d=i.Tools.BackCompatCameraNoPreventDefault(y),this._useCtrlForPanning=T,this._panningMouseButton=Y,"boolean"===typeof y[0]&&(y.length>1&&(this._useCtrlForPanning=y[1]),y.length>2&&(this._panningMouseButton=y[2])),this.inputs.attachElement(d),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}GS(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let h=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){h=!0;const d=this.invertRotation?-1:1,T=this._calculateHandednessMultiplier();let Y=this.inertialAlphaOffset*T;this.beta<0&&(Y*=-1),this.alpha+=Y*d,this.beta+=this.inertialBetaOffset*d,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<r.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<r.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*r.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){h=!0;const d=new n.pd(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),d.multiplyInPlace(this.panningAxis),n.pd.TransformNormalToRef(d,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const h=this.upVector,d=n.pd.CrossToRef(this._transformedDirection,h,this._transformedDirection);n.pd.CrossToRef(h,d,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);n.pd.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.C(this._transformedDirection)}else{if(this.parent){const h=n.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.transposeToRef(h),n.pd.TransformCoordinatesToRef(this._transformedDirection,h,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*r.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*r.d&&(this.inertialPanningY=0)}if(h)this.stopInterpolation();else if(this._isInterpolating){let h=!1;const d=this._scene.getEngine().getDeltaTime()/1e3,T=1-Math.pow(2,-d/this._currentInterpolationFactor),Y=o(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const d=n.TmpVectors.pd[0].set(o(this._goalTarget.x,this._target.x),o(this._goalTarget.y,this._target.y),o(this._goalTarget.z,this._target.z));n.pd.LerpToRef(this.target,d,T,this._target),10*n.pd.Distance(this.target,d)/Y<r.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.C(d),this.setTarget(this.target,!1,!0,!0)):h=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const d=n.Quaternion.RotationAlphaBetaGammaToRef(o(this._goalAlpha,this.alpha),o(this._goalBeta,this.beta),0,n.TmpVectors.Quaternion[0]),Y=n.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,n.TmpVectors.Quaternion[1]),y=n.Quaternion.SlerpToRef(Y,d,T,n.TmpVectors.Quaternion[2]);y.normalize();const C=y.toAlphaBetaGammaToRef(n.TmpVectors.pd[0]);if(this.alpha=C.x,this.beta=C.y,y.isApprox(d,r.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const h=d.toAlphaBetaGammaToRef(n.TmpVectors.pd[0]);this.alpha=h.x,this.beta=h.y}else h=!0}if(isNaN(this._goalRadius)||(this.radius+=(Y-this.radius)*T,Math.abs(Y/this.radius-1)<r.d?(this._goalRadius=NaN,this.radius=Y):h=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const d=n.TmpVectors.Vector2[0].set(o(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),o(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));n.Vector2.LerpToRef(this.targetScreenOffset,d,T,this.targetScreenOffset),n.Vector2.Distance(this.targetScreenOffset,d)<r.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.C(d)):h=!0}this._isInterpolating=h}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||n.pd.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const h=this.alpha;var d,T;this.alpha=function(h){let d=Math.PI/2;return 0===h.x&&0===h.z||(d=Math.acos(h.x/Math.sqrt(Math.pow(h.x,2)+Math.pow(h.z,2)))),h.z<0&&(d=2*Math.PI-d),d}(this._computationVector),this.beta=(d=this._computationVector.y,T=this.radius,Math.acos(d/T));const Y=Math.round((h-this.alpha)/(2*Math.PI));this.alpha+=2*Y*Math.PI,this._checkLimits()}setPosition(h){this._position.equals(h)||(this._position.C(h),this.rebuildAnglesAndRadius())}setTarget(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Y=this.overrideCloneAlphaBetaRadius??Y,h.Md)d&&h.getBoundingInfo?this._targetBoundingCenter=h.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,h.Md(),this._targetHost=h,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const d=h,Y=this._getTargetPosition();if(Y&&!T&&Y.equals(d))return;this._targetHost=null,this._target=d,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}Y||this.rebuildAnglesAndRadius()}_getViewMatrix(){const h=Math.cos(this.alpha),d=Math.sin(this.alpha),T=Math.cos(this.beta);let Y=Math.sin(this.beta);0===Y&&(Y=1e-4),0===this.radius&&(this.radius=1e-4);const y=this._getTargetPosition();if(this._computationVector.ny(this.radius*h*Y,this.radius*T,this.radius*d*Y),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||n.pd.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),y.addToRef(this._computationVector,this._newPosition),this.Eh().collisionsEnabled&&this.checkCollisions){const h=this.Eh().collisionCoordinator;this._collider||(this._collider=h.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,h.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.C(this._newPosition);let h=this.upVector;this.allowUpsideDown&&Y<0&&(h=h.negate()),this._computeViewMatrix(this._position,y,h),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.C(y),this._viewMatrix}zoomOn(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h=h||this.Eh().meshes;const T=U.d.MinMax(h);let Y=this._calculateLowerRadiusFromModelBoundingSphere(T.min,T.max);if(Y=Math.max(Math.min(Y,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=Y*this.zoomOnFactor,this.mode===L.e.ORTHOGRAPHIC_CAMERA){const h=this.Eh().getEngine().getAspectRatio(this),d=Y*this.zoomOnFactor/2;this.orthoLeft=-d*h,this.orthoRight=d*h,this.orthoBottom=-d,this.orthoTop=d}this.focusOn({min:T.min,max:T.max,distance:Y},d)}focusOn(h){let d,T,Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===h.min){const Y=h||this.Eh().meshes;d=U.d.MinMax(Y),T=n.pd.Distance(d.min,d.max)}else{d=h,T=h.distance}this._target=U.d.Center(d),Y||(this.maxZ=2*T)}createRigCamera(h,d){let T=0;switch(this.cameraRigMode){case L.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case L.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case L.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case L.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case L.e.RIG_MODE_VR:T=this._cameraRigParams.stereoHalfAngle*(0===d?1:-1);break;case L.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:T=this._cameraRigParams.stereoHalfAngle*(0===d?-1:1)}const Y=new u(h,this.alpha+T,this.beta,this.radius,this._target,this.Eh());return Y._cameraRigParams={},Y.isRigCamera=!0,Y.rigParent=this,Y.upVector=this.upVector,Y.mode=this.mode,Y.orthoLeft=this.orthoLeft,Y.orthoRight=this.orthoRight,Y.orthoBottom=this.orthoBottom,Y.orthoTop=this.orthoTop,Y}_updateRigCameras(){const h=this._rigCameras[0],d=this._rigCameras[1];switch(h.beta=d.beta=this.beta,this.cameraRigMode){case L.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case L.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case L.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case L.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case L.e.RIG_MODE_VR:h.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,d.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case L.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:h.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,d.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const Y=n.pd.Distance(h,d),y=this.Eh().getEngine().getAspectRatio(this),C=Math.tan(this.fov/2),X=C*y,F=.5*Y*T,U=F*Math.sqrt(1+1/(X*X)),Z=F*Math.sqrt(1+1/(C*C));return Math.max(U,Z)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,Y.c)([(0,y.E)()],u.prototype,"alpha",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"beta",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"radius",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,Y.c)([(0,y.B)("target")],u.prototype,"_target",void 0),(0,Y.c)([(0,y.v)("targetHost")],u.prototype,"_targetHost",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"inertialAlphaOffset",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"inertialBetaOffset",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"inertialRadiusOffset",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"lowerAlphaLimit",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"upperAlphaLimit",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"lowerBetaLimit",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"upperBetaLimit",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"lowerRadiusLimit",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"upperRadiusLimit",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"lowerTargetYLimit",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"inertialPanningX",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"inertialPanningY",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"pinchToPanMaxDistance",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"panningDistanceLimit",void 0),(0,Y.c)([(0,y.B)()],u.prototype,"panningOriginTarget",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"panningInertia",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"zoomToMouseLocation",null),(0,Y.c)([(0,y.E)()],u.prototype,"zoomOnFactor",void 0),(0,Y.c)([(0,y.A)()],u.prototype,"targetScreenOffset",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"allowUpsideDown",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"useInputToRestoreState",void 0),(0,Y.c)([(0,y.E)()],u.prototype,"restoreStateInterpolationFactor",void 0),(0,k.e)("BABYLON.ArcRotateCamera",u)},14453:(h,d,T)=>{"use strict";T.d(d,{d:()=>n,f:()=>X});var Y=T(12596),y=T(12801),C=T(13222),n={};class X{constructor(h){this.attachedToElement=!1,this.attached={},this.camera=h,this.checkInputs=()=>{}}add(h){const d=h.getSimpleName();this.attached[d]?Y.c.Warn("camera input of type "+d+" already exists on camera"):(this.attached[d]=h,h.camera=this.camera,h.checkInputs&&(this.checkInputs=this._addCheckInputs(h.checkInputs.bind(h))),this.attachedToElement&&h.attachControl(this.noPreventDefault))}remove(h){for(const d in this.attached){const T=this.attached[d];if(T===h)return T.GS(),T.camera=null,delete this.attached[d],void this.rebuildInputCheck()}}removeByType(h){for(const d in this.attached){const T=this.attached[d];T.getClassName()===h&&(T.GS(),T.camera=null,delete this.attached[d],this.rebuildInputCheck())}}_addCheckInputs(h){const d=this.checkInputs;return()=>{d(),h()}}attachInput(h){this.attachedToElement&&h.attachControl(this.noPreventDefault)}attachElement(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){h=!C.e.ForceAttachControlToAlwaysPreventDefault&&h,this.attachedToElement=!0,this.noPreventDefault=h;for(const d in this.attached)this.attached[d].attachControl(h)}}detachElement(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const d in this.attached)this.attached[d].GS(),h&&(this.attached[d].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const h in this.attached){const d=this.attached[h];d.checkInputs&&(this.checkInputs=this._addCheckInputs(d.checkInputs.bind(d)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(h){const d={};for(const T in this.attached){const h=this.attached[T],Y=y.e.Serialize(h);d[h.getClassName()]=Y}h.inputsmgr=d}parse(h){const d=h.inputsmgr;if(d){this.clear();for(const h in d){const T=n[h];if(T){const Y=d[h],C=y.e.Parse((()=>new T),Y,null);this.add(C)}}}else for(const T in this.attached){const d=n[this.attached[T].getClassName()];if(d){const Y=y.e.Parse((()=>new d),h,null);this.remove(this.attached[T]),this.add(Y)}}}}},14450:(h,d,T)=>{"use strict";T.d(d,{e:()=>w});var Y=T(12750),y=T(12757),C=T(12765),n=T(13252),X=T(14453),F=T(13047),U=T(12574);class Z{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(h){h=U.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Eh(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((d=>{const T=d.event;if(!T.metaKey)if(d.type===F.c.KEYDOWN){if(-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysUpward.indexOf(T.keyCode)||-1!==this.keysDownward.indexOf(T.keyCode)||-1!==this.keysRotateLeft.indexOf(T.keyCode)||-1!==this.keysRotateRight.indexOf(T.keyCode)||-1!==this.keysRotateUp.indexOf(T.keyCode)||-1!==this.keysRotateDown.indexOf(T.keyCode)){-1===this._keys.indexOf(T.keyCode)&&this._keys.push(T.keyCode),h||T.preventDefault()}}else if(-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysUpward.indexOf(T.keyCode)||-1!==this.keysDownward.indexOf(T.keyCode)||-1!==this.keysRotateLeft.indexOf(T.keyCode)||-1!==this.keysRotateRight.indexOf(T.keyCode)||-1!==this.keysRotateUp.indexOf(T.keyCode)||-1!==this.keysRotateDown.indexOf(T.keyCode)){const d=this._keys.indexOf(T.keyCode);d>=0&&this._keys.splice(d,1),h||T.preventDefault()}})))}GS(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const h=this.camera;for(let d=0;d<this._keys.length;d++){const T=this._keys[d],Y=h._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(T)?h._localDirection.ny(-Y,0,0):-1!==this.keysUp.indexOf(T)?h._localDirection.ny(0,0,Y):-1!==this.keysRight.indexOf(T)?h._localDirection.ny(Y,0,0):-1!==this.keysDown.indexOf(T)?h._localDirection.ny(0,0,-Y):-1!==this.keysUpward.indexOf(T)?h._localDirection.ny(0,Y,0):-1!==this.keysDownward.indexOf(T)?h._localDirection.ny(0,-Y,0):-1!==this.keysRotateLeft.indexOf(T)?(h._localDirection.ny(0,0,0),h.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(T)?(h._localDirection.ny(0,0,0),h.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(T)?(h._localDirection.ny(0,0,0),h.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(T)&&(h._localDirection.ny(0,0,0),h.cameraRotation.x+=this._getLocalRotation()),h.Eh().useRightHandedSystem&&(h._localDirection.z*=-1),h.getViewMatrix().invertToRef(h._cameraTransformMatrix),C.pd.TransformNormalToRef(h._localDirection,h._cameraTransformMatrix,h._transformedDirection),h.cameraDirection.addInPlace(h._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const h=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*h}}(0,Y.c)([(0,y.E)()],Z.prototype,"keysUp",void 0),(0,Y.c)([(0,y.E)()],Z.prototype,"keysUpward",void 0),(0,Y.c)([(0,y.E)()],Z.prototype,"keysDown",void 0),(0,Y.c)([(0,y.E)()],Z.prototype,"keysDownward",void 0),(0,Y.c)([(0,y.E)()],Z.prototype,"keysLeft",void 0),(0,Y.c)([(0,y.E)()],Z.prototype,"keysRight",void 0),(0,Y.c)([(0,y.E)()],Z.prototype,"rotationSpeed",void 0),(0,Y.c)([(0,y.E)()],Z.prototype,"keysRotateLeft",void 0),(0,Y.c)([(0,y.E)()],Z.prototype,"keysRotateRight",void 0),(0,Y.c)([(0,y.E)()],Z.prototype,"keysRotateUp",void 0),(0,Y.c)([(0,y.E)()],Z.prototype,"keysRotateDown",void 0),X.d.FreeCameraKeyboardMoveInput=Z;var S=T(12583),r=T(13040);class c{constructor(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=h,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new S.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(h){h=U.Tools.BackCompatCameraNoPreventDefault(arguments);const d=this.camera.getEngine(),T=d.getInputElement();this._pointerInput||(this._pointerInput=Y=>{const y=Y.event,C="touch"===y.pointerType;if(!this.touchEnabled&&C)return;if(Y.type!==r.e.POINTERMOVE&&-1===this.buttons.indexOf(y.button))return;const n=y.target;if(Y.type===r.e.POINTERDOWN){if(C&&-1!==this._activePointerId||!C&&-1!==this._currentActiveButton)return;this._activePointerId=y.pointerId;try{null===n||void 0===n||n.setPointerCapture(y.pointerId)}catch(X){}-1===this._currentActiveButton&&(this._currentActiveButton=y.button),this._previousPosition={x:y.clientX,y:y.clientY},h||(y.preventDefault(),T&&T.focus()),d.isPointerLock&&this._onMouseMove&&this._onMouseMove(Y.event)}else if(Y.type===r.e.POINTERUP){if(C&&this._activePointerId!==y.pointerId||!C&&this._currentActiveButton!==y.button)return;try{null===n||void 0===n||n.releasePointerCapture(y.pointerId)}catch(X){}this._currentActiveButton=-1,this._previousPosition=null,h||y.preventDefault(),this._activePointerId=-1}else if(Y.type===r.e.POINTERMOVE&&(this._activePointerId===y.pointerId||!C))if(d.isPointerLock&&this._onMouseMove)this._onMouseMove(Y.event);else if(this._previousPosition){const d=this.camera._calculateHandednessMultiplier(),T=(y.clientX-this._previousPosition.x)*d,Y=y.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=T/this.angularSensibility,this.camera.cameraRotation.x+=Y/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:T,offsetY:Y}),this._previousPosition={x:y.clientX,y:y.clientY},h||y.preventDefault()}}),this._onMouseMove=T=>{if(!d.isPointerLock)return;const Y=this.camera._calculateHandednessMultiplier(),y=T.movementX*Y;this.camera.cameraRotation.y+=y/this.angularSensibility;const C=T.movementY;this.camera.cameraRotation.x+=C/this.angularSensibility,this._previousPosition=null,h||T.preventDefault()},this._observer=this.camera.Eh()._inputManager._addCameraPointerObserver(this._pointerInput,r.e.POINTERDOWN|r.e.POINTERUP|r.e.POINTERMOVE),T&&(this._contextMenuBind=h=>this.onContextMenu(h),T.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(h){h.preventDefault()}GS(){if(this._observer){if(this.camera.Eh()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const h=this.camera.getEngine().getInputElement();h&&h.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,Y.c)([(0,y.E)()],c.prototype,"buttons",void 0),(0,Y.c)([(0,y.E)()],c.prototype,"angularSensibility",void 0),X.d.FreeCameraMouseInput=c;var O,f=T(13055);class J{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new S.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(h){h=U.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=d=>{if(d.type!==r.e.POINTERWHEEL)return;const T=d.event,Y=T.deltaMode===f.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*Y*T.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*Y*T.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*Y*T.deltaZ/this._normalize,T.preventDefault&&(h||T.preventDefault())},this._observer=this.camera.Eh()._inputManager._addCameraPointerObserver(this._wheel,r.e.POINTERWHEEL)}GS(){this._observer&&(this.camera.Eh()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,Y.c)([(0,y.E)()],J.prototype,"wheelPrecisionX",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"wheelPrecisionY",void 0),(0,Y.c)([(0,y.E)()],J.prototype,"wheelPrecisionZ",void 0),function(h){h[h.MoveRelative=0]="MoveRelative",h[h.RotateRelative=1]="RotateRelative",h[h.MoveScene=2]="MoveScene"}(O||(O={}));class W extends J{constructor(){super(...arguments),this._moveRelative=C.pd.Zero(),this._rotateRelative=C.pd.Zero(),this._moveScene=C.pd.Zero(),this._wheelXAction=O.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=O.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(h){null===h&&this._wheelXAction!==O.MoveRelative||(this._wheelXAction=O.MoveRelative,this._wheelXActionCoordinate=h)}get wheelXMoveRelative(){return this._wheelXAction!==O.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(h){null===h&&this._wheelYAction!==O.MoveRelative||(this._wheelYAction=O.MoveRelative,this._wheelYActionCoordinate=h)}get wheelYMoveRelative(){return this._wheelYAction!==O.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(h){null===h&&this._wheelZAction!==O.MoveRelative||(this._wheelZAction=O.MoveRelative,this._wheelZActionCoordinate=h)}get wheelZMoveRelative(){return this._wheelZAction!==O.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(h){null===h&&this._wheelXAction!==O.RotateRelative||(this._wheelXAction=O.RotateRelative,this._wheelXActionCoordinate=h)}get wheelXRotateRelative(){return this._wheelXAction!==O.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(h){null===h&&this._wheelYAction!==O.RotateRelative||(this._wheelYAction=O.RotateRelative,this._wheelYActionCoordinate=h)}get wheelYRotateRelative(){return this._wheelYAction!==O.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(h){null===h&&this._wheelZAction!==O.RotateRelative||(this._wheelZAction=O.RotateRelative,this._wheelZActionCoordinate=h)}get wheelZRotateRelative(){return this._wheelZAction!==O.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(h){null===h&&this._wheelXAction!==O.MoveScene||(this._wheelXAction=O.MoveScene,this._wheelXActionCoordinate=h)}get wheelXMoveScene(){return this._wheelXAction!==O.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(h){null===h&&this._wheelYAction!==O.MoveScene||(this._wheelYAction=O.MoveScene,this._wheelYActionCoordinate=h)}get wheelYMoveScene(){return this._wheelYAction!==O.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(h){null===h&&this._wheelZAction!==O.MoveScene||(this._wheelZAction=O.MoveScene,this._wheelZActionCoordinate=h)}get wheelZMoveScene(){return this._wheelZAction!==O.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.XC(0),this._rotateRelative.XC(0),this._moveScene.XC(0),this._updateCamera(),this.camera.Eh().useRightHandedSystem&&(this._moveRelative.z*=-1);const h=C.Matrix.Zero();this.camera.getViewMatrix().invertToRef(h);const d=C.pd.Zero();C.pd.TransformNormalToRef(this._moveRelative,h,d),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(d),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(h,d,T){if(0===h)return;if(null===d||null===T)return;let Y=null;switch(d){case O.MoveRelative:Y=this._moveRelative;break;case O.RotateRelative:Y=this._rotateRelative;break;case O.MoveScene:Y=this._moveScene}switch(T){case 0:Y.set(h,0,0);break;case 1:Y.set(0,h,0);break;case 2:Y.set(0,0,h)}}}(0,Y.c)([(0,y.E)()],W.prototype,"wheelXMoveRelative",null),(0,Y.c)([(0,y.E)()],W.prototype,"wheelYMoveRelative",null),(0,Y.c)([(0,y.E)()],W.prototype,"wheelZMoveRelative",null),(0,Y.c)([(0,y.E)()],W.prototype,"wheelXRotateRelative",null),(0,Y.c)([(0,y.E)()],W.prototype,"wheelYRotateRelative",null),(0,Y.c)([(0,y.E)()],W.prototype,"wheelZRotateRelative",null),(0,Y.c)([(0,y.E)()],W.prototype,"wheelXMoveScene",null),(0,Y.c)([(0,y.E)()],W.prototype,"wheelYMoveScene",null),(0,Y.c)([(0,y.E)()],W.prototype,"wheelZMoveScene",null),X.d.FreeCameraMouseWheelInput=W;class L{constructor(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=h,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=U.Tools.IsSafari()}attachControl(h){h=U.Tools.BackCompatCameraNoPreventDefault(arguments);let d=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=T=>{const Y=T.event,y="mouse"===Y.pointerType||this._isSafari&&"undefined"===typeof Y.pointerType;if(this.allowMouse||!y)if(T.type===r.e.POINTERDOWN){if(h||Y.preventDefault(),this._pointerPressed.push(Y.pointerId),1!==this._pointerPressed.length)return;d={x:Y.clientX,y:Y.clientY}}else if(T.type===r.e.POINTERUP){h||Y.preventDefault();const T=this._pointerPressed.indexOf(Y.pointerId);if(-1===T)return;if(this._pointerPressed.splice(T,1),0!=T)return;d=null,this._offsetX=null,this._offsetY=null}else if(T.type===r.e.POINTERMOVE){if(h||Y.preventDefault(),!d)return;if(0!=this._pointerPressed.indexOf(Y.pointerId))return;this._offsetX=Y.clientX-d.x,this._offsetY=-(Y.clientY-d.y)}}),this._observer=this.camera.Eh()._inputManager._addCameraPointerObserver(this._pointerInput,r.e.POINTERDOWN|r.e.POINTERUP|r.e.POINTERMOVE),this._onLostFocus){const h=this.camera.getEngine().getInputElement();h&&h.addEventListener("blur",this._onLostFocus)}}GS(){if(this._pointerInput){if(this._observer&&(this.camera.Eh()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const h=this.camera.getEngine().getInputElement();h&&h.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const h=this.camera,d=h._calculateHandednessMultiplier();h.cameraRotation.y=d*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)h.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const d=h._computeLocalCameraSpeed(),T=new C.pd(0,0,0!==this.touchMoveSensibility?d*this._offsetY/this.touchMoveSensibility:0);C.Matrix.RotationYawPitchRollToRef(h.rotation.y,h.rotation.x,0,h._cameraRotationMatrix),h.cameraDirection.addInPlace(C.pd.TransformCoordinates(T,h._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,Y.c)([(0,y.E)()],L.prototype,"touchAngularSensibility",void 0),(0,Y.c)([(0,y.E)()],L.prototype,"touchMoveSensibility",void 0),X.d.FreeCameraTouchInput=L;class D extends X.f{constructor(h){super(h),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new Z),this}addMouse(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new c(h),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new W,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new L),this}clear(){super.clear(),this._mouseInput=null}}var V=T(12714),i=T(12656);class w extends n.d{get angularSensibility(){const h=this.inputs.attached.mouse;return h?h.angularSensibility:0}set angularSensibility(h){const d=this.inputs.attached.mouse;d&&(d.angularSensibility=h)}get keysUp(){const h=this.inputs.attached.keyboard;return h?h.keysUp:[]}set keysUp(h){const d=this.inputs.attached.keyboard;d&&(d.keysUp=h)}get keysUpward(){const h=this.inputs.attached.keyboard;return h?h.keysUpward:[]}set keysUpward(h){const d=this.inputs.attached.keyboard;d&&(d.keysUpward=h)}get keysDown(){const h=this.inputs.attached.keyboard;return h?h.keysDown:[]}set keysDown(h){const d=this.inputs.attached.keyboard;d&&(d.keysDown=h)}get keysDownward(){const h=this.inputs.attached.keyboard;return h?h.keysDownward:[]}set keysDownward(h){const d=this.inputs.attached.keyboard;d&&(d.keysDownward=h)}get keysLeft(){const h=this.inputs.attached.keyboard;return h?h.keysLeft:[]}set keysLeft(h){const d=this.inputs.attached.keyboard;d&&(d.keysLeft=h)}get keysRight(){const h=this.inputs.attached.keyboard;return h?h.keysRight:[]}set keysRight(h){const d=this.inputs.attached.keyboard;d&&(d.keysRight=h)}get keysRotateLeft(){const h=this.inputs.attached.keyboard;return h?h.keysRotateLeft:[]}set keysRotateLeft(h){const d=this.inputs.attached.keyboard;d&&(d.keysRotateLeft=h)}get keysRotateRight(){const h=this.inputs.attached.keyboard;return h?h.keysRotateRight:[]}set keysRotateRight(h){const d=this.inputs.attached.keyboard;d&&(d.keysRotateRight=h)}get keysRotateUp(){const h=this.inputs.attached.keyboard;return h?h.keysRotateUp:[]}set keysRotateUp(h){const d=this.inputs.attached.keyboard;d&&(d.keysRotateUp=h)}get keysRotateDown(){const h=this.inputs.attached.keyboard;return h?h.keysRotateDown:[]}set keysRotateDown(h){const d=this.inputs.attached.keyboard;d&&(d.keysRotateDown=h)}constructor(h,d,T){var Y;super(h,d,T,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),Y=this,this.ellipsoid=new C.pd(.5,1,.5),this.ellipsoidOffset=new C.pd(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=C.pd.Zero(),this._diffPosition=C.pd.Zero(),this._newPosition=C.pd.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Y._newPosition.C(d),Y._newPosition.subtractToRef(Y._oldPosition,Y._diffPosition),Y._diffPosition.length()>i.c.CollisionsEpsilon&&(Y.position.addToRef(Y._diffPosition,Y._deferredPositionUpdate),Y._deferOnly?Y._deferredUpdated=!0:Y.position.C(Y._deferredPositionUpdate),Y.UO&&T&&Y.UO(T))},this.inputs=new D(this),this.inputs.addKeyboard().addMouse()}attachControl(h,d){d=U.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(d)}GS(){this.inputs.detachElement(),this.cameraDirection=new C.pd(0,0,0),this.cameraRotation=new C.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(h){this._collisionMask=isNaN(h)?-1:h}_collideWithWorld(h){let d;d=this.parent?C.pd.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,d.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const T=this.Eh().collisionCoordinator;this._collider||(this._collider=T.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let Y=h;this.applyGravity&&(Y=h.add(this.Eh().gravity)),T.getNewPosition(this._oldPosition,Y,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=C.pd.Zero(),this._transformedDirection=C.pd.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(h){this._needMoveForGravity=h}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Eh().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Tc"}}(0,Y.c)([(0,y.B)()],w.prototype,"ellipsoid",void 0),(0,Y.c)([(0,y.B)()],w.prototype,"ellipsoidOffset",void 0),(0,Y.c)([(0,y.E)()],w.prototype,"checkCollisions",void 0),(0,Y.c)([(0,y.E)()],w.prototype,"applyGravity",void 0),(0,V.e)("BABYLON.FreeCamera",w)},15060:(h,d,T)=>{"use strict";T.d(d,{c:()=>C});var Y=T(12858),y=T(15064);class C{constructor(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=T,this.FS=[],this._maxBlockCapacity=d||64,this._selectionContent=new Y.d(1024),this._creationFunc=h}update(h,d,T){y.b._CreateBlocks(h,d,T,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}fZ(h){for(let d=0;d<this.gZ.length;d++){this.gZ[d].addEntry(h)}}OZ(h){for(let d=0;d<this.gZ.length;d++){this.gZ[d].removeEntry(h)}}select(h,d){this._selectionContent.reset();for(let T=0;T<this.gZ.length;T++){this.gZ[T].select(h,this._selectionContent,d)}return d?this._selectionContent.concat(this.FS):this._selectionContent.concatWithNoDuplicate(this.FS),this._selectionContent}intersects(h,d,T){this._selectionContent.reset();for(let Y=0;Y<this.gZ.length;Y++){this.gZ[Y].intersects(h,d,this._selectionContent,T)}return T?this._selectionContent.concat(this.FS):this._selectionContent.concatWithNoDuplicate(this.FS),this._selectionContent}intersectsRay(h){this._selectionContent.reset();for(let d=0;d<this.gZ.length;d++){this.gZ[d].intersectsRay(h,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.FS),this._selectionContent}}C.CreationFuncForMeshes=(h,d)=>{const T=h.getBoundingInfo();!h.isBlocked&&T.boundingBox.intersectsMinMax(d.cS,d.OS)&&d.entries.push(h)},C.CreationFuncForSubMeshes=(h,d)=>{h.getBoundingInfo().boundingBox.intersectsMinMax(d.cS,d.OS)&&d.entries.push(h)}},15064:(h,d,T)=>{"use strict";T.d(d,{b:()=>C});var Y=T(12765),y=T(13110);class C{constructor(h,d,T,Y,y,C){this.entries=[],this.fS=new Array,this._capacity=T,this._depth=Y,this._maxDepth=y,this._creationFunc=C,this._minPoint=h,this._maxPoint=d,this.fS.push(h.clone()),this.fS.push(d.clone()),this.fS.push(h.clone()),this.fS[2].x=d.x,this.fS.push(h.clone()),this.fS[3].y=d.y,this.fS.push(h.clone()),this.fS[4].z=d.z,this.fS.push(d.clone()),this.fS[5].z=h.z,this.fS.push(d.clone()),this.fS[6].x=h.x,this.fS.push(d.clone()),this.fS[7].y=h.y}get BX(){return this._capacity}get cS(){return this._minPoint}get OS(){return this._maxPoint}addEntry(h){if(this.gZ)for(let d=0;d<this.gZ.length;d++){this.gZ[d].addEntry(h)}else this._creationFunc(h,this),this.entries.length>this.BX&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(h){if(this.gZ){for(let d=0;d<this.gZ.length;d++){this.gZ[d].removeEntry(h)}return}const d=this.entries.indexOf(h);d>-1&&this.entries.splice(d,1)}addEntries(h){for(let d=0;d<h.length;d++){const T=h[d];this.addEntry(T)}}select(h,d,T){if(y.c.IsInFrustum(this.fS,h)){if(this.gZ){for(let Y=0;Y<this.gZ.length;Y++){this.gZ[Y].select(h,d,T)}return}T?d.concat(this.entries):d.concatWithNoDuplicate(this.entries)}}intersects(h,d,T,Y){if(y.c.IntersectsSphere(this._minPoint,this._maxPoint,h,d)){if(this.gZ){for(let y=0;y<this.gZ.length;y++){this.gZ[y].intersects(h,d,T,Y)}return}Y?T.concat(this.entries):T.concatWithNoDuplicate(this.entries)}}intersectsRay(h,d){if(h.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.gZ){for(let T=0;T<this.gZ.length;T++){this.gZ[T].intersectsRay(h,d)}return}d.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){C._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(h,d,T,y,n,X,F,U){F.gZ=new Array;const Z=new Y.pd((d.x-h.x)/2,(d.y-h.y)/2,(d.z-h.z)/2);for(let Y=0;Y<2;Y++)for(let d=0;d<2;d++)for(let S=0;S<2;S++){const r=h.add(Z.multiplyByFloats(Y,d,S)),c=h.add(Z.multiplyByFloats(Y+1,d+1,S+1)),O=new C(r,c,y,n+1,X,U);O.addEntries(T),F.gZ.push(O)}}}},15067:(h,d,T)=>{"use strict";T.d(d,{e:()=>Z});var Y=T(12990),y=T(12765),C=T(13198),n=T(14215),X=T(13032),F=T(15060),U=T(12625);Y.d.prototype.createOrUpdateSelectionOctree=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,T=this._getComponent(X.e.NAME_OCTREE);T||(T=new Z(this),this.Wd(T)),this.nS||(this.nS=new F.c(F.c.CreationFuncForMeshes,h,d));const Y=this.getWorldExtends();return this.nS.update(Y.min,Y.max,this.meshes),this.nS},Object.defineProperty(Y.d.prototype,"selectionOctree",{get:function(){return this.nS},enumerable:!0,configurable:!0}),C.b.prototype.createOrUpdateSubmeshesOctree=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const T=this.Eh();let Y=T._getComponent(X.e.NAME_OCTREE);Y||(Y=new Z(T),T.Wd(Y)),this._submeshesOctree||(this._submeshesOctree=new F.c(F.c.CreationFuncForSubMeshes,h,d)),this.Md(!0);const y=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(y.minimumWorld,y.maximumWorld,this.ld),this._submeshesOctree};class Z{constructor(h){this.name=X.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new n.c(y.pd.Zero(),new y.pd(1,1,1)),(h=h||U.d.LastCreatedScene)&&(this.qd=h,this.qd.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.qd.getActiveSubMeshCandidates=h=>this.getActiveSubMeshCandidates(h),this.qd.getCollidingSubMeshCandidates=(h,d)=>this.getCollidingSubMeshCandidates(h,d),this.qd.getIntersectingSubMeshCandidates=(h,d)=>this.getIntersectingSubMeshCandidates(h,d))}register(){this.qd.onMeshRemovedObservable.add((h=>{const d=this.qd.selectionOctree;if(void 0!==d&&null!==d){const T=d.FS.indexOf(h);-1!==T&&d.FS.splice(T,1)}})),this.qd.onMeshImportedObservable.add((h=>{const d=this.qd.selectionOctree;void 0!==d&&null!==d&&d.fZ(h)}))}getActiveMeshCandidates(){var h;return(null===(h=this.qd.nS)||void 0===h?void 0:h.select(this.qd.frustumPlanes))||this.qd._getDefaultMeshCandidates()}getActiveSubMeshCandidates(h){if(h._submeshesOctree&&h.useOctreeForRenderingSelection){return h._submeshesOctree.select(this.qd.frustumPlanes)}return this.qd._getDefaultSubMeshCandidates(h)}getIntersectingSubMeshCandidates(h,d){if(h._submeshesOctree&&h.useOctreeForPicking){n.c.TransformToRef(d,h.getWorldMatrix(),this._tempRay);return h._submeshesOctree.intersectsRay(this._tempRay)}return this.qd._getDefaultSubMeshCandidates(h)}getCollidingSubMeshCandidates(h,d){if(h._submeshesOctree&&h.useOctreeForCollisions){const T=d._velocityWorldLength+Math.max(d._radius.x,d._radius.y,d._radius.z);return h._submeshesOctree.intersects(d._basePointWorld,T)}return this.qd._getDefaultSubMeshCandidates(h)}rebuild(){}dispose(){}}},14215:(h,d,T)=>{"use strict";T.d(d,{c:()=>c});var Y=T(12990),y=T(13222),C=T(12772),n=T(12765),X=T(12779),F=T(13098),U=T(13024),Z=T(12625),S=T(13060);const r={internalPickerForMesh:void 0};class c{constructor(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.d;this.origin=h,this.direction=d,this.length=T,this.epsilon=Y}clone(){return new c(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const Y=c._TmpVector3[0].ny(h.x-T,h.y-T,h.z-T),y=c._TmpVector3[1].ny(d.x+T,d.y+T,d.z+T);let C,n,X,F,U=0,Z=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<Y.x||this.origin.x>y.x)return!1}else if(C=1/this.direction.x,n=(Y.x-this.origin.x)*C,X=(y.x-this.origin.x)*C,X===-1/0&&(X=1/0),n>X&&(F=n,n=X,X=F),U=Math.max(n,U),Z=Math.min(X,Z),U>Z)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<Y.y||this.origin.y>y.y)return!1}else if(C=1/this.direction.y,n=(Y.y-this.origin.y)*C,X=(y.y-this.origin.y)*C,X===-1/0&&(X=1/0),n>X&&(F=n,n=X,X=F),U=Math.max(n,U),Z=Math.min(X,Z),U>Z)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<Y.z||this.origin.z>y.z)return!1}else if(C=1/this.direction.z,n=(Y.z-this.origin.z)*C,X=(y.z-this.origin.z)*C,X===-1/0&&(X=1/0),n>X&&(F=n,n=X,X=F),U=Math.max(n,U),Z=Math.min(X,Z),U>Z)return!1;return!0}intersectsBox(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(h.minimum,h.maximum,d)}intersectsSphere(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=h.center.x-this.origin.x,Y=h.center.y-this.origin.y,y=h.center.z-this.origin.z,C=T*T+Y*Y+y*y,n=h.radius+d,X=n*n;if(C<=X)return!0;const F=T*this.direction.x+Y*this.direction.y+y*this.direction.z;if(F<0)return!1;return C-F*F<=X}intersectsTriangle(h,d,T){const Y=c._TmpVector3[0],y=c._TmpVector3[1],C=c._TmpVector3[2],X=c._TmpVector3[3],U=c._TmpVector3[4];d.subtractToRef(h,Y),T.subtractToRef(h,y),n.pd.CrossToRef(this.direction,y,C);const Z=n.pd.Dot(Y,C);if(0===Z)return null;const S=1/Z;this.origin.subtractToRef(h,X);const r=n.pd.Dot(X,C)*S;if(r<-this.epsilon||r>1+this.epsilon)return null;n.pd.CrossToRef(X,Y,U);const O=n.pd.Dot(this.direction,U)*S;if(O<-this.epsilon||r+O>1+this.epsilon)return null;const f=n.pd.Dot(y,U)*S;return f>this.length?null:new F.b(1-r-O,r,f)}intersectsPlane(h){let d;const T=n.pd.Dot(h.normal,this.direction);if(Math.abs(T)<9.99999997475243e-7)return null;{const Y=n.pd.Dot(h.normal,this.origin);return d=(-h.d-Y)/T,d<0?d<-9.99999997475243e-7?null:0:d}}intersectsAxis(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(h){case"y":{const h=(this.origin.y-d)/this.direction.y;return h>0?null:new n.pd(this.origin.x+this.direction.x*-h,d,this.origin.z+this.direction.z*-h)}case"x":{const h=(this.origin.x-d)/this.direction.x;return h>0?null:new n.pd(d,this.origin.y+this.direction.y*-h,this.origin.z+this.direction.z*-h)}case"z":{const h=(this.origin.z-d)/this.direction.z;return h>0?null:new n.pd(this.origin.x+this.direction.x*-h,this.origin.y+this.direction.y*-h,d)}default:return null}}intersectsMesh(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],y=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const X=n.TmpVectors.Matrix[0];return h.getWorldMatrix().invertToRef(X),this._tmpRay?c.TransformToRef(this,X,this._tmpRay):this._tmpRay=c.Transform(this,X),h.intersects(this._tmpRay,d,T,Y,y,C)}intersectsMeshes(h,d,T){T?T.length=0:T=[];for(let Y=0;Y<h.length;Y++){const y=this.intersectsMesh(h[Y],d);y.hit&&T.push(y)}return T.sort(this._comparePickingInfo),T}_comparePickingInfo(h,d){return h.distance<d.distance?-1:h.distance>d.distance?1:0}intersectionSegment(h,d,T){const Y=this.origin,y=n.TmpVectors.pd[0],C=n.TmpVectors.pd[1],X=n.TmpVectors.pd[2],F=n.TmpVectors.pd[3];d.subtractToRef(h,y),this.direction.scaleToRef(c._Rayl,X),Y.addToRef(X,C),h.subtractToRef(Y,F);const U=n.pd.Dot(y,y),Z=n.pd.Dot(y,X),S=n.pd.Dot(X,X),r=n.pd.Dot(y,F),O=n.pd.Dot(X,F),f=U*S-Z*Z;let J,W,L=f,D=f;f<c._Smallnum?(J=0,L=1,W=O,D=S):(J=Z*O-S*r,W=U*O-Z*r,J<0?(J=0,W=O,D=S):J>L&&(J=L,W=O+Z,D=S)),W<0?(W=0,-r<0?J=0:-r>U?J=L:(J=-r,L=U)):W>D&&(W=D,-r+Z<0?J=0:-r+Z>U?J=L:(J=-r+Z,L=U));const V=Math.abs(J)<c._Smallnum?0:J/L,i=Math.abs(W)<c._Smallnum?0:W/D,w=n.TmpVectors.pd[4];X.scaleToRef(i,w);const s=n.TmpVectors.pd[5];y.scaleToRef(V,s),s.addInPlace(F);const E=n.TmpVectors.pd[6];s.subtractToRef(w,E);return i>0&&i<=this.length&&E.lengthSquared()<T*T?s.length():-1}update(h,d,T,Y,y,C,X){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){c._RayDistant||(c._RayDistant=c.Zero()),c._RayDistant.unprojectRayToRef(h,d,T,Y,n.Matrix.IdentityReadOnly,C,X);const F=n.TmpVectors.Matrix[0];y.invertToRef(F),c.TransformToRef(c._RayDistant,F,this)}else this.unprojectRayToRef(h,d,T,Y,y,C,X);return this}static Zero(){return new c(n.pd.Zero(),n.pd.Zero())}static CreateNew(h,d,T,Y,y,C,n){return c.Zero().update(h,d,T,Y,y,C,n)}static CreateNewFromTo(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.Matrix.IdentityReadOnly;const Y=new c(new n.pd(0,0,0),new n.pd(0,0,0));return c.CreateFromToToRef(h,d,Y,T)}static CreateFromToToRef(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.Matrix.IdentityReadOnly;T.origin.C(h);const y=d.subtractToRef(h,T.direction),C=Math.sqrt(y.x*y.x+y.y*y.y+y.z*y.z);return T.length=C,T.direction.normalize(),c.TransformToRef(T,Y,T)}static Transform(h,d){const T=new c(new n.pd(0,0,0),new n.pd(0,0,0));return c.TransformToRef(h,d,T),T}static TransformToRef(h,d,T){n.pd.TransformCoordinatesToRef(h.origin,d,T.origin),n.pd.TransformNormalToRef(h.direction,d,T.direction),T.length=h.length,T.epsilon=h.epsilon;const Y=T.direction,y=Y.length();if(0!==y&&1!==y){const h=1/y;Y.x*=h,Y.y*=h,Y.z*=h,T.length*=y}return T}unprojectRayToRef(h,d,T,Y,y,C,X){const F=n.TmpVectors.Matrix[0];y.multiplyToRef(C,F),F.multiplyToRef(X,F),F.invert();const U=Z.d.LastCreatedEngine,S=n.TmpVectors.pd[0];S.x=h/T*2-1,S.y=-(d/Y*2-1),S.z=null!==U&&void 0!==U&&U.Dd?1:null!==U&&void 0!==U&&U.isNDCHalfZRange?0:-1;const r=n.TmpVectors.pd[1].ny(S.x,S.y,1-1e-8),c=n.TmpVectors.pd[2],O=n.TmpVectors.pd[3];n.pd._UnprojectFromInvertedMatrixToRef(S,F,c),n.pd._UnprojectFromInvertedMatrixToRef(r,F,O),this.origin.C(c),O.subtractToRef(c,this.direction),this.direction.normalize()}}function O(h,d,T,Y,y){let C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const n=c.Zero();return f(h,d,T,Y,n,y,C),n}function f(h,d,T,Y,y,C){let X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const U=h.getEngine();if(!C&&!(C=h.activeCamera))return h;const Z=C.viewport,S=U.getRenderHeight(),{x:r,y:c,width:O,height:f}=Z.toGlobal(U.getRenderWidth(),S),J=1/U.getHardwareScalingLevel();return d=d*J-r,T=T*J-(S-c-f),y.update(d,T,O,f,Y||n.Matrix.IdentityReadOnly,X?n.Matrix.IdentityReadOnly:C.getViewMatrix(),C.getProjectionMatrix(),F),h}function J(h,d,T,Y,y){if(!U.c)return h;const C=h.getEngine();if(!y&&!(y=h.activeCamera))throw new Error("Active camera not set");const X=y.viewport,F=C.getRenderHeight(),{x:Z,y:S,width:r,height:c}=X.toGlobal(C.getRenderWidth(),F),O=n.Matrix.Identity(),f=1/C.getHardwareScalingLevel();return d=d*f-Z,T=T*f-(F-S-c),Y.update(d,T,r,c,O,O,y.getProjectionMatrix()),h}function W(h,d,T,Y,y,C,n,X){const F=d(Y,T.enableDistantPicking),U=T.intersects(F,y,n,C,Y,X);return U&&U.hit?!y&&null!=h&&U.distance>=h.distance?null:U:null}function L(h,d,T,Y,y,C){let X=null;const F=!!(h.activeCameras&&h.activeCameras.length>1&&h.cameraToUseForPointers!==h.activeCamera),Z=h.cameraToUseForPointers||h.activeCamera,S=r.internalPickerForMesh||W;for(let U=0;U<h.meshes.length;U++){const r=h.meshes[U];if(T){if(!T(r,-1))continue}else if(!r.isEnabled()||!r.isVisible||!r.PF)continue;const c=F&&r.isWorldMatrixCameraDependent(),O=r.Md(c,Z);if(r.hasThinInstances&&r.oU){const h=S(X,d,r,O,!0,!0,C);if(h){if(y)return h;const F=n.TmpVectors.Matrix[1],U=r.thinInstanceGetWorldMatrices();for(let h=0;h<U.length;h++){if(T&&!T(r,h))continue;U[h].multiplyToRef(O,F);const n=S(X,d,r,F,Y,y,C,!0);if(n&&(X=n,X.thinInstanceIndex=h,Y))return X}}}else{const h=S(X,d,r,O,Y,y,C);if(h&&(X=h,Y))return X}}return X||new U.c}function D(h,d,T,Y){if(!U.c)return null;const y=[],C=!!(h.activeCameras&&h.activeCameras.length>1&&h.cameraToUseForPointers!==h.activeCamera),X=h.cameraToUseForPointers||h.activeCamera,F=r.internalPickerForMesh||W;for(let U=0;U<h.meshes.length;U++){const Z=h.meshes[U];if(T){if(!T(Z,-1))continue}else if(!Z.isEnabled()||!Z.isVisible||!Z.PF)continue;const S=C&&Z.isWorldMatrixCameraDependent(),r=Z.Md(S,X);if(Z.hasThinInstances&&Z.oU){if(F(null,d,Z,r,!0,!0,Y)){const h=n.TmpVectors.Matrix[1],C=Z.thinInstanceGetWorldMatrices();for(let n=0;n<C.length;n++){if(T&&!T(Z,n))continue;C[n].multiplyToRef(r,h);const X=F(null,d,Z,h,!1,!1,Y,!0);X&&(X.thinInstanceIndex=n,y.push(X))}}}else{const h=F(null,d,Z,r,!1,!1,Y);h&&y.push(h)}}return y}function V(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,Y=arguments.length>3?arguments[3]:void 0,y=arguments.length>4?arguments[4]:void 0;Y||(Y=h.getWorldMatrix()),d.length=T,y?d.origin.C(y):d.origin.C(h.position);const C=n.TmpVectors.pd[2];C.set(0,0,h._scene.useRightHandedSystem?-1:1);const X=n.TmpVectors.pd[3];return n.pd.TransformNormalToRef(C,Y,X),n.pd.NormalizeToRef(X,d.direction),d}var i,w;c._TmpVector3=(0,X.e)(6,n.pd.Zero),c._RayDistant=c.Zero(),c._Smallnum=1e-8,c._Rayl=1e9,i=Y.d,(w=y.e)&&(w.prototype.getForwardRay=function(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,d=arguments.length>1?arguments[1]:void 0,T=arguments.length>2?arguments[2]:void 0;return V(this,new c(n.pd.Zero(),n.pd.Zero(),h),h,d,T)},w.prototype.getForwardRayToRef=function(h){return V(this,h,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),i&&(S.e._IsPickingAvailable=!0,i.prototype.createPickingRay=function(h,d,T,Y){return O(this,h,d,T,Y,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),Y.d.prototype.createPickingRayToRef=function(h,d,T,Y,y){return f(this,h,d,T,Y,y,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},Y.d.prototype.createPickingRayInCameraSpace=function(h,d,T){return function(h,d,T,Y){const y=c.Zero();return J(h,d,T,y,Y),y}(this,h,d,T)},Y.d.prototype.createPickingRayInCameraSpaceToRef=function(h,d,T,Y){return J(this,h,d,T,Y)},Y.d.prototype.pickWithBoundingInfo=function(h,d,T,Y,y){return function(h,d,T,Y,y,C){if(!U.c)return null;const X=L(h,(Y=>(h._tempPickingRay||(h._tempPickingRay=c.Zero()),f(h,d,T,Y,h._tempPickingRay,C||null),h._tempPickingRay)),Y,y,!0);return X&&(X.ray=O(h,d,T,n.Matrix.Identity(),C||null)),X}(this,h,d,T,Y,y)},Y.d.prototype.eT=function(h,d,T,Y,y,C){return function(h,d,T,Y,y,C,X){const F=L(h,((Y,y)=>(h._tempPickingRay||(h._tempPickingRay=c.Zero()),f(h,d,T,Y,h._tempPickingRay,C||null,!1,y),h._tempPickingRay)),Y,y,!1,X);return F&&(F.ray=O(h,d,T,n.Matrix.Identity(),C||null)),F}(this,h,d,T,Y,y,C)},Y.d.prototype.pickWithRay=function(h,d,T,Y){return function(h,d,T,Y,y){const C=L(h,(T=>(h._pickWithRayInverseMatrix||(h._pickWithRayInverseMatrix=n.Matrix.Identity()),T.invertToRef(h._pickWithRayInverseMatrix),h._cachedRayForTransform||(h._cachedRayForTransform=c.Zero()),c.TransformToRef(d,h._pickWithRayInverseMatrix,h._cachedRayForTransform),h._cachedRayForTransform)),T,Y,!1,y);return C&&(C.ray=d),C}(this,h,d,T,Y)},Y.d.prototype.multiPick=function(h,d,T,Y,y){return function(h,d,T,Y,y,C){return D(h,(Y=>O(h,d,T,Y,y||null)),Y,C)}(this,h,d,T,Y,y)},Y.d.prototype.multiPickWithRay=function(h,d,T){return function(h,d,T,Y){return D(h,(T=>(h._pickWithRayInverseMatrix||(h._pickWithRayInverseMatrix=n.Matrix.Identity()),T.invertToRef(h._pickWithRayInverseMatrix),h._cachedRayForTransform||(h._cachedRayForTransform=c.Zero()),c.TransformToRef(d,h._pickWithRayInverseMatrix,h._cachedRayForTransform),h._cachedRayForTransform)),T,Y)}(this,h,d,T)}},14494:(h,d,T)=>{"use strict";var Y=T(12684),y=T(12596),C=T(12627),n=T(12722),X=T(12656),F=T(12701);X.c.prototype._partialLoadFile=function(h,d,T,Y){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(h,(h=>{T[d]=h,T._internalCount++,6===T._internalCount&&Y(T)}),void 0,void 0,!0,((h,d)=>{y&&h&&y(h.status+" "+h.statusText,d)}))},X.c.prototype._cascadeLoadFiles=function(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const y=[];y._internalCount=0;for(let C=0;C<6;C++)this._partialLoadFile(T[C],C,y,d,Y)},X.c.prototype._cascadeLoadImgs=function(h,d,T,Y){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5?arguments[5]:void 0;const n=[];n._internalCount=0;for(let X=0;X<6;X++)this._partialLoadImg(Y[X],X,n,h,d,T,y,C)},X.c.prototype._partialLoadImg=function(h,d,T,Y,y,X){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7?arguments[7]:void 0;const Z=(0,n.b)();(0,C.s)(h,(h=>{T[d]=h,T._internalCount++,Y&&Y.removePendingData(Z),6===T._internalCount&&X&&X(y,T)}),((h,d)=>{Y&&Y.removePendingData(Z),F&&F(h,d)}),Y?Y.offlineProvider:null,U),Y&&Y.addPendingData(Z)},X.c.prototype.createCubeTextureBase=function(h,d,T,C){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6?arguments[6]:void 0,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]&&arguments[8],r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,J=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,W=arguments.length>14&&void 0!==arguments[14]&&arguments[14],L=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const D=O||new Y.e(this,7);D.isCube=!0,D.url=h,D.generateMipMaps=!C,D._lodGenerationScale=r,D._lodGenerationOffset=c,D._useSRGBBuffer=!!W&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!C),D!==O&&(D.label=h.substring(0,60)),this._doNotHandleContextLost||(D._extension=Z,D._files=T,D._buffer=L);const V=h;this._transformTextureUrl&&!O&&(h=this._transformTextureUrl(h));const i=Z??function(h){const d=h.split("?")[0],T=d.lastIndexOf(".");return T>-1?d.substring(T).toLowerCase():""}(h),w=(0,F.b)(i),s=(h,d)=>{D.dispose(),X?X(h,d):h&&y.c.Warn(h)},E=(Y,X)=>{h===V?Y&&s(Y.status+" "+Y.statusText,X):(y.c.Warn(`Failed to load ${h}, falling back to the ${V}`),this.createCubeTextureBase(V,d,T,!!C,n,s,U,Z,S,r,c,D,f,J,W,L))};if(w)w.then((Y=>{const y=h=>{f&&f(D,h),Y.loadCubeData(h,D,S,n,((h,d)=>{s(h,d)}))};L?y(L):T&&6===T.length?Y.supportCascades?this._cascadeLoadFiles(d,(h=>y(h.map((h=>new Uint8Array(h))))),T,s):s("Textures type does not support cascades."):this._loadFile(h,(h=>y(new Uint8Array(h))),void 0,void 0,!0,E)}));else{if(!T||0===T.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(d,D,((h,d)=>{J&&J(h,d)}),T,s)}return this._internalTexturesCache.push(D),D}},15072:(h,d,T)=>{"use strict";T(12596);var Y=T(12885);T(12684),T(12843),T(12676),T(12927),T(12895);Y.b},14519:(h,d,T)=>{"use strict";T.d(d,{e:()=>y});var Y=T(12714);class y{constructor(h){this.value=this._toInt(h)}_toInt(h){return 0|h}add(h){return new y(this.value+h.value)}Nd(h){return new y(this.value-h.value)}multiply(h){return new y(Math.imul(this.value,h.value))}divide(h){return new y(this.value/h.value)}getClassName(){return y.ClassName}equals(h){return this.value===h.value}static FromValue(h){return new y(h)}toString(){return this.value.toString()}}y.ClassName="FlowGraphInteger",(0,Y.e)("FlowGraphInteger",y)},14534:(h,d,T)=>{"use strict";T.d(d,{e:()=>y,f:()=>C});var Y=T(12765);class y{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.kd=h}get m(){return this.kd}transformVector(h){return this.transformVectorToRef(h,new Y.Vector2)}transformVectorToRef(h,d){return d.x=h.x*this.kd[0]+h.y*this.kd[1],d.y=h.x*this.kd[2]+h.y*this.kd[3],d}ad(){return this.toArray()}toArray(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let d=0;d<4;d++)h[d]=this.kd[d];return h}vT(h){for(let d=0;d<4;d++)this.kd[d]=h[d];return this}multiplyToRef(h,d){const T=h.kd,Y=this.kd,y=d.kd;return y[0]=T[0]*Y[0]+T[1]*Y[2],y[1]=T[0]*Y[1]+T[1]*Y[3],y[2]=T[2]*Y[0]+T[3]*Y[2],y[3]=T[2]*Y[1]+T[3]*Y[3],d}multiply(h){return this.multiplyToRef(h,new y)}divideToRef(h,d){const T=this.kd,Y=h.kd,y=d.kd;return y[0]=T[0]/Y[0],y[1]=T[1]/Y[1],y[2]=T[2]/Y[2],y[3]=T[3]/Y[3],d}divide(h){return this.divideToRef(h,new y)}addToRef(h,d){const T=this.kd,Y=h.m,y=d.m;return y[0]=T[0]+Y[0],y[1]=T[1]+Y[1],y[2]=T[2]+Y[2],y[3]=T[3]+Y[3],d}add(h){return this.addToRef(h,new y)}subtractToRef(h,d){const T=this.kd,Y=h.m,y=d.m;return y[0]=T[0]-Y[0],y[1]=T[1]-Y[1],y[2]=T[2]-Y[2],y[3]=T[3]-Y[3],d}Nd(h){return this.subtractToRef(h,new y)}transpose(){const h=this.kd;return new y([h[0],h[2],h[1],h[3]])}determinant(){const h=this.kd;return h[0]*h[3]-h[1]*h[2]}inverse(){const h=this.determinant();if(0===h)throw new Error("Matrix is not invertible");const d=this.kd,T=1/h;return new y([d[3]*T,-d[1]*T,-d[2]*T,d[0]*T])}equals(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=this.kd,Y=h.m;return 0===d?T[0]===Y[0]&&T[1]===Y[1]&&T[2]===Y[2]&&T[3]===Y[3]:Math.abs(T[0]-Y[0])<d&&Math.abs(T[1]-Y[1])<d&&Math.abs(T[2]-Y[2])<d&&Math.abs(T[3]-Y[3])<d}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.kd.join(", ")})`}}class C{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.kd=h}get m(){return this.kd}transformVector(h){return this.transformVectorToRef(h,new Y.pd)}transformVectorToRef(h,d){const T=this.kd;return d.x=h.x*T[0]+h.y*T[1]+h.z*T[2],d.y=h.x*T[3]+h.y*T[4]+h.z*T[5],d.z=h.x*T[6]+h.y*T[7]+h.z*T[8],d}multiplyToRef(h,d){const T=h.kd,Y=this.kd,y=d.m;return y[0]=T[0]*Y[0]+T[1]*Y[3]+T[2]*Y[6],y[1]=T[0]*Y[1]+T[1]*Y[4]+T[2]*Y[7],y[2]=T[0]*Y[2]+T[1]*Y[5]+T[2]*Y[8],y[3]=T[3]*Y[0]+T[4]*Y[3]+T[5]*Y[6],y[4]=T[3]*Y[1]+T[4]*Y[4]+T[5]*Y[7],y[5]=T[3]*Y[2]+T[4]*Y[5]+T[5]*Y[8],y[6]=T[6]*Y[0]+T[7]*Y[3]+T[8]*Y[6],y[7]=T[6]*Y[1]+T[7]*Y[4]+T[8]*Y[7],y[8]=T[6]*Y[2]+T[7]*Y[5]+T[8]*Y[8],d}multiply(h){return this.multiplyToRef(h,new C)}divideToRef(h,d){const T=this.kd,Y=h.m,y=d.m;return y[0]=T[0]/Y[0],y[1]=T[1]/Y[1],y[2]=T[2]/Y[2],y[3]=T[3]/Y[3],y[4]=T[4]/Y[4],y[5]=T[5]/Y[5],y[6]=T[6]/Y[6],y[7]=T[7]/Y[7],y[8]=T[8]/Y[8],d}divide(h){return this.divideToRef(h,new C)}addToRef(h,d){const T=this.kd,Y=h.m,y=d.m;return y[0]=T[0]+Y[0],y[1]=T[1]+Y[1],y[2]=T[2]+Y[2],y[3]=T[3]+Y[3],y[4]=T[4]+Y[4],y[5]=T[5]+Y[5],y[6]=T[6]+Y[6],y[7]=T[7]+Y[7],y[8]=T[8]+Y[8],d}add(h){return this.addToRef(h,new C)}subtractToRef(h,d){const T=this.kd,Y=h.m,y=d.m;return y[0]=T[0]-Y[0],y[1]=T[1]-Y[1],y[2]=T[2]-Y[2],y[3]=T[3]-Y[3],y[4]=T[4]-Y[4],y[5]=T[5]-Y[5],y[6]=T[6]-Y[6],y[7]=T[7]-Y[7],y[8]=T[8]-Y[8],d}Nd(h){return this.subtractToRef(h,new C)}toArray(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let d=0;d<9;d++)h[d]=this.kd[d];return h}ad(){return this.toArray()}vT(h){for(let d=0;d<9;d++)this.kd[d]=h[d];return this}transpose(){const h=this.kd;return new C([h[0],h[3],h[6],h[1],h[4],h[7],h[2],h[5],h[8]])}determinant(){const h=this.kd;return h[0]*(h[4]*h[8]-h[5]*h[7])-h[1]*(h[3]*h[8]-h[5]*h[6])+h[2]*(h[3]*h[7]-h[4]*h[6])}inverse(){const h=this.determinant();if(0===h)throw new Error("Matrix is not invertible");const d=this.kd,T=1/h;return new C([(d[4]*d[8]-d[5]*d[7])*T,(d[2]*d[7]-d[1]*d[8])*T,(d[1]*d[5]-d[2]*d[4])*T,(d[5]*d[6]-d[3]*d[8])*T,(d[0]*d[8]-d[2]*d[6])*T,(d[2]*d[3]-d[0]*d[5])*T,(d[3]*d[7]-d[4]*d[6])*T,(d[1]*d[6]-d[0]*d[7])*T,(d[0]*d[4]-d[1]*d[3])*T])}equals(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=this.kd,Y=h.m;return 0===d?T[0]===Y[0]&&T[1]===Y[1]&&T[2]===Y[2]&&T[3]===Y[3]&&T[4]===Y[4]&&T[5]===Y[5]&&T[6]===Y[6]&&T[7]===Y[7]&&T[8]===Y[8]:Math.abs(T[0]-Y[0])<d&&Math.abs(T[1]-Y[1])<d&&Math.abs(T[2]-Y[2])<d&&Math.abs(T[3]-Y[3])<d&&Math.abs(T[4]-Y[4])<d&&Math.abs(T[5]-Y[5])<d&&Math.abs(T[6]-Y[6])<d&&Math.abs(T[7]-Y[7])<d&&Math.abs(T[8]-Y[8])<d}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.kd.join(", ")})`}}},14538:(h,d,T)=>{"use strict";var Y;function y(h,d,T,Y){switch(d){case"Animation":return Y?h.animations.find((h=>h.uniqueId===T))??null:h.animations[T]??null;case"AnimationGroup":return Y?h.animationGroups.find((h=>h.uniqueId===T))??null:h.animationGroups[T]??null;case"Mesh":return Y?h.meshes.find((h=>h.uniqueId===T))??null:h.meshes[T]??null;case"Material":return Y?h.materials.find((h=>h.uniqueId===T))??null:h.materials[T]??null;case"sZ":return Y?h.cameras.find((h=>h.uniqueId===T))??null:h.cameras[T]??null;case"Light":return Y?h.lights.find((h=>h.uniqueId===T))??null:h.lights[T]??null;default:return null}}T.d(d,{b:()=>y}),function(h){h.Animation="Animation",h.AnimationGroup="AnimationGroup",h.Mesh="Mesh",h.Material="Material",h.sZ="sZ",h.Light="Light"}(Y||(Y={}))},14574:(h,d,T)=>{"use strict";T.d(d,{e:()=>y});var Y=T(14578);class y extends Y.e{constructor(h,d){if(super(h),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),d)for(const T of d)this._eventsSignalOutputs[T]=this._registerSignalOutput(T+"Event")}_executeOnTick(h){}_startPendingTasks(h){h._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(h),this._resetAfterCanceled(h)),this._preparePendingTasks(h),h._addPendingBlock(this),this.out._activateSignal(h),h._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(h){h._deleteExecutionVariable(this,"_initialized"),h._removePendingBlock(this)}}},14548:(h,d,T)=>{"use strict";T.d(d,{e:()=>U});var Y=T(12722),y=T(12714),C=T(14556),n=T(12583),X=T(14515);class F extends C.b{constructor(h,d,T,Y){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Y.defaultValue,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(h,d,T),this.richType=Y,this._defaultValue=y,this._optional=C,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new n.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(h){this._isDisabled!==h&&(this._isDisabled=h,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(h,d){d._getConnectionValue(this)!==h&&(d._setConnectionValue(this,h),this.onValueChangedObservable.notifyObservers(h))}resetToDefaultValue(h){h._setConnectionValue(this,this._defaultValue)}connectTo(h){this._isDisabled||super.connectTo(h)}_getValueOrDefault(h){const d=h._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(d):d}getValue(h){if(1===this.connectionType){h._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(h);const d=this._getValueOrDefault(h);return this._lastValue=d,this.richType.typeTransformer?this.richType.typeTransformer(d):d}const d=this.isConnected()?this._connectedPoint[0].getValue(h):this._getValueOrDefault(h);return this._lastValue=d,this.richType.typeTransformer?this.richType.typeTransformer(d):d}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(h),h.richType={},this.richType.serialize(h.richType),h.optional=this._optional,(0,X.e)("defaultValue",this._defaultValue,h)}}(0,y.e)("FlowGraphDataConnection",F);class U{constructor(h){var d;this.config=h,this.uniqueId=(0,Y.b)(),this.name=(null===(d=this.config)||void 0===d?void 0:d.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(h){}registerDataInput(h,d,T){const Y=new F(h,0,this,d,T);return this.dataInputs.push(Y),Y}registerDataOutput(h,d,T){const Y=new F(h,1,this,d,T);return this.dataOutputs.push(Y),Y}getDataInput(h){return this.dataInputs.find((d=>d.name===h))}getDataOutput(h){return this.dataOutputs.find((d=>d.name===h))}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.e;if(h.uniqueId=this.uniqueId,h.config={},this.config){const T=this.config,Y=Object.keys(T);for(const y of Y)d(y,T[y],h.config)}h.dataInputs=[],h.dataOutputs=[],h.className=this.getClassName();for(const T of this.dataInputs){const d={};T.serialize(d),h.dataInputs.push(d)}for(const T of this.dataOutputs){const d={};T.serialize(d),h.dataOutputs.push(d)}}deserialize(h){}_log(h,d,T){var Y;null===(Y=h.logger)||void 0===Y||Y.addLogItem({action:d,GT:T,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14556:(h,d,T)=>{"use strict";T.d(d,{b:()=>C});var Y,y=T(12722);!function(h){h[h.Input=0]="Input",h[h.Output=1]="Output"}(Y||(Y={}));class C{constructor(h,d,T){this._ownerBlock=T,this._connectedPoint=[],this.uniqueId=(0,y.b)(),this.connectedPointIds=[],this.name=h,this._connectionType=d}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(h){if(this._connectionType===h._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||h._isSingularConnection()&&h._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(h),h._connectedPoint.push(this)}disconnectFrom(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const T=this._connectedPoint.indexOf(h),Y=h._connectedPoint.indexOf(this);-1!==T&&-1!==Y&&(d&&this._connectedPoint.splice(T,1),h._connectedPoint.splice(Y,1))}disconnectFromAll(){for(const h of this._connectedPoint)this.disconnectFrom(h,!1);this._connectedPoint.length=0}dispose(){for(const h of this._connectedPoint)this.disconnectFrom(h)}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h.uniqueId=this.uniqueId,h.name=this.name,h._connectionType=this._connectionType,h.connectedPointIds=[],h.className=this.getClassName();for(const d of this._connectedPoint)h.connectedPointIds.push(d.uniqueId)}getClassName(){return"FGConnection"}deserialize(h){this.uniqueId=h.uniqueId,this.name=h.name,this._connectionType=h._connectionType,this.connectedPointIds=h.connectedPointIds}}},14506:(h,d,T)=>{"use strict";T.d(d,{c:()=>D});var Y,y=T(12583),C=T(12750),n=T(12757),X=T(12722),F=T(14515),U=T(14538),Z=T(12596);!function(h){h.ExecuteBlock="ExecuteBlock",h.ExecuteEvent="ExecuteEvent",h.TriggerConnection="TriggerConnection",h.ContextVariableSet="ContextVariableSet",h.GlobalVariableSet="GlobalVariableSet",h.GlobalVariableDelete="GlobalVariableDelete",h.GlobalVariableGet="GlobalVariableGet",h.AddConnection="AddConnection",h.GetConnectionValue="GetConnectionValue",h.SetConnectionValue="SetConnectionValue",h.ActivateSignal="ActivateSignal",h.ContextVariableGet="ContextVariableGet"}(Y||(Y={}));class S{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(h){if(h.time||(h.time=Date.now()),this.log.push(h),this.logToConsole){var d;const T=null===(d=h.GT)||void 0===d?void 0:d.value;"object"===typeof T&&T.getClassName?Z.c.Log(`[FGLog] ${h.className}:${h.uniqueId.split("-")[0]} ${h.action} - ${JSON.stringify(T.getClassName())}: ${T.toString()}`):Z.c.Log(`[FGLog] ${h.className}:${h.uniqueId.split("-")[0]} ${h.action} - ${JSON.stringify(h.GT)}`)}}getItemsOfType(h){return this.log.filter((d=>d.action===h))}}class r{get enableLogging(){return this._enableLogging}set enableLogging(h){this._enableLogging!==h&&(this._enableLogging=h,this._enableLogging?(this.logger=new S,this.logger.logToConsole=!0):this.logger=null)}constructor(h){this.uniqueId=(0,X.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new y.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=h,this.assetsContext=h.assetsContext??h.qd}hasVariable(h){return h in this._userVariables}setVariable(h,d){var T;this._userVariables[h]=d,null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",GT:{name:h,value:d}})}getAsset(h,d){return(0,U.b)(this.assetsContext,h,d)}getVariable(h){var d;return null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",GT:{name:h,value:this._userVariables[h]}}),this._userVariables[h]}get userVariables(){return this._userVariables}Eh(){return this._configuration.qd}_getUniqueIdPrefixedName(h,d){return`${h.uniqueId}_${d}`}_getGlobalContextVariable(h,d){var T;return null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",GT:{name:h,defaultValue:d,possibleValue:this._globalContextVariables[h]}}),this._hasGlobalContextVariable(h)?this._globalContextVariables[h]:d}_setGlobalContextVariable(h,d){var T;null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",GT:{name:h,value:d}}),this._globalContextVariables[h]=d}_deleteGlobalContextVariable(h){var d;null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",GT:{name:h}}),delete this._globalContextVariables[h]}_hasGlobalContextVariable(h){return h in this._globalContextVariables}_setExecutionVariable(h,d,T){this._executionVariables[this._getUniqueIdPrefixedName(h,d)]=T}_getExecutionVariable(h,d,T){return this._hasExecutionVariable(h,d)?this._executionVariables[this._getUniqueIdPrefixedName(h,d)]:T}_deleteExecutionVariable(h,d){delete this._executionVariables[this._getUniqueIdPrefixedName(h,d)]}_hasExecutionVariable(h,d){return this._getUniqueIdPrefixedName(h,d)in this._executionVariables}_hasConnectionValue(h){return h.uniqueId in this._connectionValues}_setConnectionValue(h,d){var T;this._connectionValues[h.uniqueId]=d,null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",GT:{connectionPointId:h.uniqueId,value:d}})}_setConnectionValueByKey(h,d){this._connectionValues[h]=d}_getConnectionValue(h){var d;return null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",GT:{connectionPointId:h.uniqueId,value:this._connectionValues[h.uniqueId]}}),this._connectionValues[h.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(h){this._pendingBlocks.includes(h)||(this._pendingBlocks.push(h),this._pendingBlocks.sort(((h,d)=>h.priority-d.priority)))}_removePendingBlock(h){const d=this._pendingBlocks.indexOf(h);-1!==d&&this._pendingBlocks.splice(d,1)}_clearPendingBlocks(){for(const h of this._pendingBlocks)h._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(h){var d;this.onNodeExecutedObservable.notifyObservers(h),null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:h.getClassName(),uniqueId:h.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(h){this._setGlobalContextVariable("timeSinceStart",h.timeSinceStart),this._setGlobalContextVariable("deltaTime",h.deltaTime);for(const T of this._pendingBlocks){var d;null===(d=T._executeOnTick)||void 0===d||d.call(T,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.e;h.uniqueId=this.uniqueId,h._userVariables={};for(const Y in this._userVariables)d(Y,this._userVariables[Y],h._userVariables);h._connectionValues={};for(const Y in this._connectionValues)d(Y,this._connectionValues[Y],h._connectionValues);var T;this.assetsContext!==this.Eh()&&(h._assetsContext={meshes:this.assetsContext.meshes.map((h=>h.id)),materials:this.assetsContext.materials.map((h=>h.id)),textures:this.assetsContext.textures.map((h=>h.name)),animations:this.assetsContext.animations.map((h=>h.name)),lights:this.assetsContext.lights.map((h=>h.id)),cameras:this.assetsContext.cameras.map((h=>h.id)),Mr:null===(T=this.assetsContext.Mr)||void 0===T?void 0:T.map((h=>h.name)),skeletons:this.assetsContext.skeletons.map((h=>h.id)),Fr:this.assetsContext.Fr.map((h=>h.name)),geometries:this.assetsContext.geometries.map((h=>h.id)),multiMaterials:this.assetsContext.multiMaterials.map((h=>h.id)),transformNodes:this.assetsContext.transformNodes.map((h=>h.id))})}getClassName(){return"FlowGraphContext"}}(0,C.c)([(0,n.E)()],r.prototype,"uniqueId",void 0);var c=T(14540),O=T(13040);class f{constructor(h){this.onEventTriggeredObservable=new y.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=h,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.zd.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const h=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",GT:{timeSinceStart:this._startingTime,deltaTime:h}}),this._startingTime+=h})),this._meshPickedObserver=this._scene.onPointerObservable.add((h=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",GT:h})}),O.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((h=>{const d=h.pointerId,T=h.mesh,Y=this._pointerUnderMeshState[d];!Y&&T?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",GT:{pointerId:d,mesh:T}}):Y&&!T?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",GT:{pointerId:d,mesh:Y}}):Y&&T&&Y!==T&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",GT:{pointerId:d,mesh:Y,over:T}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",GT:{pointerId:d,mesh:T,out:Y}})),this._pointerUnderMeshState[d]=T}),O.e.POINTERMOVE)}dispose(){var h,d,T,Y,y;null===(h=this._sceneDisposeObserver)||void 0===h||h.remove(),null===(d=this._sceneReadyObserver)||void 0===d||d.remove(),null===(T=this._sceneOnBeforeRenderObserver)||void 0===T||T.remove(),null===(Y=this._meshPickedObserver)||void 0===Y||Y.remove(),null===(y=this._meshUnderPointerObserver)||void 0===y||y.remove(),this.onEventTriggeredObservable.clear()}}var J,W=T(14563);!function(h){h[h.Stopped=0]="Stopped",h[h.Started=1]="Started"}(J||(J={}));class L{get state(){return this._state}set state(h){this._state=h,this.onStateChangedObservable.notifyObservers(h)}constructor(h){this.onStateChangedObservable=new y.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=h.qd,this._sceneEventCoordinator=new f(this._scene),this._coordinator=h.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((h=>{for(const d of this._executionContexts){const T=this._getContextualOrder(h.type,d);for(const Y of T)if(!Y._executeEvent(d,h.GT))break}switch(h.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const d of this._executionContexts)d._notifyOnTick(h.GT);break;case"SceneDispose":this.dispose()}}))}createContext(){const h=new r({qd:this._scene,coordinator:this._coordinator});return this._executionContexts.push(h),h}getContext(h){return this._executionContexts[h]}addEventBlock(h){if("PointerOver"!==h.type&&"PointerOut"!==h.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==h.type&&this._eventBlocks[h.type].push(h),1===this.state)for(const d of this._executionContexts)h._startPendingTasks(d);else this.onStateChangedObservable.addOnce((d=>{if(1===d)for(const T of this._executionContexts)h._startPendingTasks(T)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((h=>{1===h&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const h of this._executionContexts)for(const d in this._eventBlocks){const T=this._getContextualOrder(d,h);for(const d of T)d._startPendingTasks(h)}}_getContextualOrder(h,d){const T=this._eventBlocks[h].sort(((h,d)=>d.initPriority-h.initPriority));if("MeshPick"===h){const h=[];for(const Y of T){const y=Y.asset.getValue(d);let C=0;for(;C<T.length;C++){const h=T[C].asset.getValue(d);if(y&&h&&(0,W.k)(y,h))break}h.splice(C,0,Y)}return h}return T}dispose(){var h;if(0!==this.state){this.state=0;for(const h of this._executionContexts)h._clearPendingBlocks();this._executionContexts.length=0;for(const h in this._eventBlocks)this._eventBlocks[h].length=0;null===(h=this._eventObserver)||void 0===h||h.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(h){const d=[],T=new Set;for(const Y in this._eventBlocks)for(const h of this._eventBlocks[Y])d.push(h),T.add(h.uniqueId);for(;d.length>0;){const Y=d.pop();h(Y);for(const h of Y.dataInputs)for(const Y of h._connectedPoint)T.has(Y._ownerBlock.uniqueId)||(d.push(Y._ownerBlock),T.add(Y._ownerBlock.uniqueId));if(Y instanceof c.d)for(const h of Y.signalOutputs)for(const Y of h._connectedPoint)T.has(Y._ownerBlock.uniqueId)||(d.push(Y._ownerBlock),T.add(Y._ownerBlock.uniqueId))}}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1?arguments[1]:void 0;h.allBlocks=[],this.visitAllBlocks((d=>{const T={};d.serialize(T),h.allBlocks.push(T)})),h.executionContexts=[];for(const T of this._executionContexts){const Y={};T.serialize(Y,d),h.executionContexts.push(Y)}}}class D{constructor(h){this.config=h,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.qd.zd.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.qd.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const h=this._executeOnNextFrame.slice(0);if(h.length)for(const d of h){this.notifyCustomEvent(d.id,d.data,!1);const h=this._executeOnNextFrame.findIndex((h=>h.uniqueId===d.uniqueId));-1!==h&&this._executeOnNextFrame.splice(h,1)}}));(D.SceneCoordinators.get(this.config.qd)??[]).push(this)}createGraph(){const h=new L({qd:this.config.qd,coordinator:this});return this._flowGraphs.push(h),h}removeGraph(h){const d=this._flowGraphs.indexOf(h);-1!==d&&(h.dispose(),this._flowGraphs.splice(d,1))}start(){for(const h of this._flowGraphs)h.start()}dispose(){var h,d;for(const y of this._flowGraphs)y.dispose();this._flowGraphs.length=0,null===(h=this._disposeObserver)||void 0===h||h.remove(),null===(d=this._onBeforeRenderObserver)||void 0===d||d.remove();const T=D.SceneCoordinators.get(this.config.qd)??[],Y=T.indexOf(this);-1!==Y&&T.splice(Y,1)}serialize(h,d){h._flowGraphs=[];for(const T of this._flowGraphs){const Y={};T.serialize(Y,d),h._flowGraphs.push(Y)}h.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(h){let d=this._customEventsMap.get(h);return d||(d=new y.e,this._customEventsMap.set(h,d)),d}notifyCustomEvent(h,d){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:h,data:d,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(h)){const d=this._eventExecutionCounter.get(h);if(this._eventExecutionCounter.set(h,d+1),d>=D.MaxEventTypeExecutionPerFrame)return void(d===D.MaxEventTypeExecutionPerFrame&&Z.c.Warn(`FlowGraphCoordinator: Too many executions of event "${h}".`))}else this._eventExecutionCounter.set(h,1);const T=this._customEventsMap.get(h);T&&T.notifyObservers(d)}}D.MaxEventsPerType=30,D.MaxEventTypeExecutionPerFrame=30,D.SceneCoordinators=new Map},14567:(h,d,T)=>{"use strict";T.d(d,{e:()=>y});var Y=T(14574);class y extends Y.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(h){h._notifyExecuteNode(this),this.done._activateSignal(h)}}},14540:(h,d,T)=>{"use strict";T.d(d,{d:()=>X});var Y=T(14548),y=T(14556),C=T(12714);class n extends y.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(h){super.connectTo(h),this._connectedPoint.sort(((h,d)=>d.priority-h.priority))}_activateSignal(h){var d;if(null===(d=h.logger)||void 0===d||d.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,GT:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)h._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(h,this),h._increaseExecutionId();else for(const T of this._connectedPoint)T._activateSignal(h)}}(0,C.e)("FlowGraphSignalConnection",n);class X extends Y.e{constructor(h){super(h),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(h){const d=new n(h,0,this);return this.signalInputs.push(d),d}_registerSignalOutput(h){const d=new n(h,1,this);return this.signalOutputs.push(d),d}_unregisterSignalInput(h){const d=this.signalInputs.findIndex((d=>d.name===h));-1!==d&&(this.signalInputs[d].dispose(),this.signalInputs.splice(d,1))}_unregisterSignalOutput(h){const d=this.signalOutputs.findIndex((d=>d.name===h));-1!==d&&(this.signalOutputs[d].dispose(),this.signalOutputs.splice(d,1))}_reportError(h,d){this.error.GT="string"===typeof d?new Error(d):d,this.error._activateSignal(h)}getSignalInput(h){return this.signalInputs.find((d=>d.name===h))}getSignalOutput(h){return this.signalOutputs.find((d=>d.name===h))}serialize(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(h),h.signalInputs=[],h.signalOutputs=[];for(const d of this.signalInputs){const T={};d.serialize(T),h.signalInputs.push(T)}for(const d of this.signalOutputs){const T={};d.serialize(T),h.signalOutputs.push(T)}}deserialize(h){for(let d=0;d<h.signalInputs.length;d++){const T=this.getSignalInput(h.signalInputs[d].name);if(!T)throw new Error("Could not find signal input with name "+h.signalInputs[d].name+" in block "+h.className);T.deserialize(h.signalInputs[d])}for(let d=0;d<h.signalOutputs.length;d++){const T=this.getSignalOutput(h.signalOutputs[d].name);if(!T)throw new Error("Could not find signal output with name "+h.signalOutputs[d].name+" in block "+h.className);T.deserialize(h.signalOutputs[d])}}getClassName(){return"FlowGraphExecutionBlock"}}},14578:(h,d,T)=>{"use strict";T.d(d,{e:()=>y});var Y=T(14540);class y extends Y.d{constructor(h){super(h),this.out=this._registerSignalOutput("out")}}},14528:(h,d,T)=>{"use strict";T.d(d,{A:()=>O,B:()=>f,F:()=>z,J:()=>x,K:()=>E,N:()=>s,b:()=>U,e:()=>r,h:()=>w,l:()=>J,m:()=>W,q:()=>L,s:()=>S,t:()=>i,w:()=>Z,y:()=>c});var Y,y=T(12765),C=T(12812),n=T(14519),X=T(14534);!function(h){h.Any="any",h.String="string",h.Number="number",h.Boolean="boolean",h.Object="object",h.Integer="FlowGraphInteger",h.Vector2="Vector2",h.pd="pd",h.Vector4="Vector4",h.Quaternion="Quaternion",h.Matrix="Matrix",h.Matrix2D="Matrix2D",h.Matrix3D="Matrix3D",h.ed="ed",h.ln="ln"}(Y||(Y={}));class F{constructor(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=h,this.defaultValue=d,this.animationType=T}serialize(h){h.typeName=this.typeName,h.defaultValue=this.defaultValue}}const U=new F("any",void 0),Z=new F("string",""),S=new F("number",0,0),r=new F("boolean",!1),c=new F("Vector2",y.Vector2.Zero(),5),O=new F("pd",y.pd.Zero(),1),f=new F("Vector4",y.Vector4.Zero()),J=new F("Matrix",y.Matrix.Identity(),3),W=new F("Matrix2D",new X.e),L=new F("Matrix3D",new X.f),D=new F("ed",C.ed.Black(),4),V=new F("ln",new C.ln(0,0,0,0),7),i=new F("Quaternion",y.Quaternion.Identity(),2);i.typeTransformer=h=>{if(h.getClassName){if("Vector4"===h.getClassName())return y.Quaternion.Bd(h.ad());if("pd"===h.getClassName())return y.Quaternion.FromEulerVector(h);if("Matrix"===h.getClassName())return y.Quaternion.FromRotationMatrix(h)}return h};const w=new F("FlowGraphInteger",new n.e(0),0);function s(h){const d=h;switch(typeof h){case"string":return Z;case"number":return S;case"boolean":return r;case"object":if(d.getClassName)switch(d.getClassName()){case"Vector2":return c;case"pd":return O;case"Vector4":return f;case"Matrix":return J;case"ed":return D;case"ln":return V;case"Quaternion":return i;case"FlowGraphInteger":return w;case"Matrix2D":return W;case"Matrix3D":return L}return U;default:return U}}function E(h){switch(h){case"string":return Z;case"number":return S;case"boolean":return r;case"Vector2":return c;case"pd":return O;case"Vector4":return f;case"Matrix":return J;case"ed":return D;case"ln":return V;case"Quaternion":return i;case"FlowGraphInteger":return w;case"Matrix2D":return W;case"Matrix3D":return L;default:return U}}function z(h){switch(h){case"number":default:return 0;case"Vector2":return 5;case"pd":return 1;case"Matrix":return 3;case"ed":return 4;case"ln":return 7;case"Quaternion":return 2}}function x(h){switch(h){case 0:return S;case 5:return c;case 1:return O;case 3:return J;case 4:return D;case 7:return V;case 2:return i;default:return U}}},14515:(h,d,T)=>{"use strict";T.d(d,{b:()=>Z,e:()=>U,h:()=>S});var Y=T(12812),y=T(12765),C=T(14519),n=T(14528),X=T(14534);function F(h){return"Vector2"===h||"pd"===h||"Vector4"===h||"Quaternion"===h||"ed"===h||"ln"===h}function U(h,d,T){var Y;const y=(null===d||void 0===d||null===(Y=d.getClassName)||void 0===Y?void 0:Y.call(d))??"";if(F(y)||function(h){return"Matrix"===h||"Matrix2D"===h||"Matrix3D"===h}(y))T[h]={value:d.ad(),className:y};else if("FlowGraphInteger"===y)T[h]={value:d.value,className:y};else if(y&&(d.id||d.name))T[h]={id:d.id,name:d.name,className:y};else{if("object"===typeof d)throw new Error(`Could not serialize value ${d}`);T[h]=d}}function Z(h,d,T,U){const S=d[h];let r;const c=(null===S||void 0===S?void 0:S.type)??(null===S||void 0===S?void 0:S.className);if(function(h){return"Mesh"===h||"AbstractMesh"===h||"GroundMesh"===h||"InstanceMesh"===h||"LinesMesh"===h||"GoldbergMesh"===h||"GreasedLineMesh"===h||"TrailMesh"===h}(c)){let h=U.meshes.filter((h=>S.id?h.id===S.id:h.name===S.name));0===h.length&&(h=U.transformNodes.filter((h=>S.id?h.id===S.id:h.name===S.name))),r=S.uniqueId?h.find((h=>h.uniqueId===S.uniqueId)):h[0]}else if(F(c))r=function(h,d){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===h)return y.Vector2.Bd(d);if("pd"===h)return T&&(d[2]*=-1),y.pd.Bd(d);if("Vector4"===h)return y.Vector4.Bd(d);if("Quaternion"===h)return T&&(d[2]*=-1,d[3]*=-1),y.Quaternion.Bd(d);if("ed"===h)return new Y.ed(d[0],d[1],d[2]);if("ln"===h)return new Y.ln(d[0],d[1],d[2],d[3]);throw new Error(`Unknown vector class name ${h}`)}(c,S.value);else if(function(h){return"AnimationGroup"===h}(c)){const h=U.animationGroups.filter((h=>h.name===S.name));r=1===h.length?h[0]:h.find((h=>h.uniqueId===S.uniqueId))}else r="Matrix"===c?y.Matrix.Bd(S.value):"Matrix2D"===c?new X.e(S.value):"Matrix3D"===c?new X.f(S.value):"FlowGraphInteger"===c?C.e.FromValue(S.value):"number"===c||"string"===c||"boolean"===c?S.value[0]:S&&void 0!==S.value?S.value:Array.isArray(S)?S.reduce(((h,d)=>d.eventData?(h[d.id]={type:(0,n.K)(d.type)},"undefined"!==typeof d.value&&(h[d.id].value=Z("value",d,T,U)),h):h),{}):S;return r}function S(h){return"FlowGraphJsonPointerParserBlock"===h}},14563:(h,d,T)=>{"use strict";function Y(h,d){return!(!h.parent||h.parent!==d&&!Y(h.parent,d))}function y(h){if(h.getClassName)return h.getClassName()}function C(h,d){return h===d&&("Vector2"===h||"pd"===h||"Vector4"===h||"Quaternion"===h)}function n(h,d){return h===d&&("Matrix"===h||"Matrix2D"===h||"Matrix3D"===h)}function X(h,d){return"FlowGraphInteger"===h&&"FlowGraphInteger"===d}function F(h,d){const T="number"===typeof h||"number"===typeof(null===h||void 0===h?void 0:h.value);return T&&!d?!isNaN(U(h)):T}function U(h){return"number"===typeof h?h:h.value}T.d(d,{b:()=>X,d:()=>n,g:()=>C,h:()=>y,k:()=>Y,n:()=>U,o:()=>F})},13903:(h,d,T)=>{"use strict";T.r(d),T.d(d,{SceneInstrumentation:()=>C});var Y=T(12574),y=T(12966);class C{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(h){h!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=h,h?(this._onBeforeActiveMeshesEvaluationObserver=this.qd.onBeforeActiveMeshesEvaluationObservable.add((()=>{Y.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.qd.onAfterActiveMeshesEvaluationObservable.add((()=>{Y.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.qd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.qd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(h){h!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=h,h?(this._onBeforeRenderTargetsRenderObserver=this.qd.onBeforeRenderTargetsRenderObservable.add((()=>{Y.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.qd.onAfterRenderTargetsRenderObservable.add((()=>{Y.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.qd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.qd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(h){h!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=h,h?(this._onBeforeParticlesRenderingObserver=this.qd.onBeforeParticlesRenderingObservable.add((()=>{Y.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.qd.onAfterParticlesRenderingObservable.add((()=>{Y.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.qd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.qd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(h){h!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=h,this.qd.spriteManagers&&(h?(this._onBeforeSpritesRenderingObserver=this.qd.onBeforeSpritesRenderingObservable.add((()=>{Y.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.qd.onAfterSpritesRenderingObservable.add((()=>{Y.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.qd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.qd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(h){h!==this._capturePhysicsTime&&this.qd.onBeforePhysicsObservable&&(this._capturePhysicsTime=h,h?(this._onBeforePhysicsObserver=this.qd.onBeforePhysicsObservable.add((()=>{Y.Tools.StartPerformanceCounter("yc"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.qd.onAfterPhysicsObservable.add((()=>{Y.Tools.EndPerformanceCounter("yc"),this._physicsTime.endMonitoring()}))):(this.qd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.qd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(h){h!==this._captureAnimationsTime&&(this._captureAnimationsTime=h,h?this._onAfterAnimationsObserver=this.qd.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.qd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(h){this._captureFrameTime=h}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(h){this._captureInterFrameTime=h}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(h){h!==this._captureRenderTime&&(this._captureRenderTime=h,h?(this._onBeforeDrawPhaseObserver=this.qd.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),Y.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.qd.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),Y.Tools.EndPerformanceCounter("Main render")}))):(this.qd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.qd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(h){h!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=h,h?(this._onBeforeCameraRenderObserver=this.qd.onBeforeCameraRenderObservable.add((h=>{this._cameraRenderTime.beginMonitoring(),Y.Tools.StartPerformanceCounter(`Rendering camera ${h.name}`)})),this._onAfterCameraRenderObserver=this.qd.onAfterCameraRenderObservable.add((h=>{this._cameraRenderTime.endMonitoring(!1),Y.Tools.EndPerformanceCounter(`Rendering camera ${h.name}`)}))):(this.qd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.qd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.qd.getEngine()._drawCalls}constructor(h){this.qd=h,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new y.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new y.d,this._captureFrameTime=!1,this._frameTime=new y.d,this._captureRenderTime=!1,this._renderTime=new y.d,this._captureInterFrameTime=!1,this._interFrameTime=new y.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new y.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new y.d,this._capturePhysicsTime=!1,this._physicsTime=new y.d,this._captureAnimationsTime=!1,this._animationsTime=new y.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new y.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=h.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(Y.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.qd.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=h.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(Y.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.sd(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.sd(),this._captureParticlesRenderTime&&this._particlesRenderTime.sd(),this._captureSpritesRenderTime&&this._spritesRenderTime.sd(),this._captureRenderTime&&this._renderTime.sd(),this._captureCameraRenderTime&&this._cameraRenderTime.sd()}))}dispose(){this._disposed||(this.qd.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.qd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.qd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.qd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.qd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.qd.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.qd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.qd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.qd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.qd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.qd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.qd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.qd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.qd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.qd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.qd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.qd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.qd=null,this._disposed=!0)}}},14504:(h,d,T)=>{"use strict";T.d(d,{b:()=>Z});var Y=T(12750),y=T(12757),C=T(12765),n=T(13196),X=T(13322),F=T(13385),U=T(12714);n.d.AddNodeConstructor("Light_Type_1",((h,d)=>()=>new Z(h,C.pd.Zero(),d)));class Z extends F.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(h){this._shadowFrustumSize=h,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(h){this._shadowOrthoScale=h,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(h){this._orthoLeft=h}get orthoRight(){return this._orthoRight}set orthoRight(h){this._orthoRight=h}get orthoTop(){return this._orthoTop}set orthoTop(h){this._orthoTop=h}get orthoBottom(){return this._orthoBottom}set orthoBottom(h){this._orthoBottom=h}constructor(h,d,T){super(h,T),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=d.scale(-1),this.direction=d}getClassName(){return"nc"}getTypeID(){return X.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(h,d,T){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(h):this._setDefaultAutoExtendShadowProjectionMatrix(h,d,T)}_setDefaultFixedFrustumShadowProjectionMatrix(h){const d=this.Eh().activeCamera;d&&C.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:d.Gd,void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ,h,this.Eh().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(h,d,T){const Y=this.Eh().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const h=C.pd.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let Y=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let n=0;n<T.length;n++){const X=T[n];if(!X)continue;const F=X.getBoundingInfo().boundingBox;for(let T=0;T<F.vectorsWorld.length;T++)C.pd.TransformCoordinatesToRef(F.vectorsWorld[T],d,h),h.x<this._orthoLeft&&(this._orthoLeft=h.x),h.y<this._orthoBottom&&(this._orthoBottom=h.y),h.x>this._orthoRight&&(this._orthoRight=h.x),h.y>this._orthoTop&&(this._orthoTop=h.y),this.autoCalcShadowZBounds&&(h.z<Y&&(Y=h.z),h.z>y&&(y=h.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=Y,this._shadowMaxZ=y)}const y=this._orthoRight-this._orthoLeft,n=this._orthoTop-this._orthoBottom,X=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Y||void 0===Y?void 0:Y.Gd)||0,F=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Y||void 0===Y?void 0:Y.maxZ)||1e4,U=this.Eh().getEngine().Dd;C.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-y*this.shadowOrthoScale,this._orthoRight+y*this.shadowOrthoScale,this._orthoBottom-n*this.shadowOrthoScale,this._orthoTop+n*this.shadowOrthoScale,U?F:X,U?X:F,h,this.Eh().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(h,d){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,d),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,d),this)}transferToNodeMaterialEffect(h,d){return this.computeTransformedInformation()?(h.setFloat3(d,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(h.setFloat3(d,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(h){const d=this._scene.getEngine();return!d.Dd&&d.isNDCHalfZRange?0:1}getDepthMaxZ(h){const d=this._scene.getEngine();return d.Dd&&d.isNDCHalfZRange?0:1}prepareLightSpecificDefines(h,d){h["DIRLIGHT"+d]=!0}}(0,Y.c)([(0,y.E)()],Z.prototype,"shadowFrustumSize",null),(0,Y.c)([(0,y.E)()],Z.prototype,"shadowOrthoScale",null),(0,Y.c)([(0,y.E)()],Z.prototype,"autoUpdateExtends",void 0),(0,Y.c)([(0,y.E)()],Z.prototype,"autoCalcShadowZBounds",void 0),(0,Y.c)([(0,y.E)("orthoLeft")],Z.prototype,"_orthoLeft",void 0),(0,Y.c)([(0,y.E)("orthoRight")],Z.prototype,"_orthoRight",void 0),(0,Y.c)([(0,y.E)("orthoTop")],Z.prototype,"_orthoTop",void 0),(0,Y.c)([(0,y.E)("orthoBottom")],Z.prototype,"_orthoBottom",void 0),(0,U.e)("BABYLON.DirectionalLight",Z)},15009:(h,d,T)=>{"use strict";T.d(d,{d:()=>Z});var Y=T(12750),y=T(12757),C=T(12765),n=T(12812),X=T(13196),F=T(13322),U=T(12714);X.d.AddNodeConstructor("Light_Type_3",((h,d)=>()=>new Z(h,C.pd.Zero(),d)));class Z extends F.d{constructor(h,d,T){super(h,T),this.groundColor=new n.ed(0,0,0),this.direction=d||C.pd.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Xc"}setDirectionToTarget(h){return this.direction=C.pd.Normalize(h.Nd(C.pd.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(h,d){const T=C.pd.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",T.x,T.y,T.z,0,d),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.aX),d),this}transferToNodeMaterialEffect(h,d){const T=C.pd.Normalize(this.direction);return h.setFloat3(d,T.x,T.y,T.z),this}Md(){return this._worldMatrix||(this._worldMatrix=C.Matrix.Identity()),this._worldMatrix}getTypeID(){return F.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(h,d){h["HEMILIGHT"+d]=!0}}(0,Y.c)([(0,y.l)()],Z.prototype,"groundColor",void 0),(0,Y.c)([(0,y.B)()],Z.prototype,"direction",void 0),(0,U.e)("BABYLON.HemisphericLight",Z)},14475:(h,d,T)=>{"use strict";T.d(d,{b:()=>S});var Y=T(12750),y=T(12757),C=T(12765),n=T(13196),X=T(13322),F=T(13385),U=T(12741),Z=T(12714);n.d.AddNodeConstructor("Light_Type_2",((h,d)=>()=>new S(h,C.pd.Zero(),C.pd.Zero(),0,0,d)));class S extends F.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(h){this._iesProfileTexture!==h&&(this._iesProfileTexture=h,this._iesProfileTexture&&S._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(h){this._angle=h,this._cosHalfAngle=Math.cos(.5*h),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(h){this._innerAngle=h,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(h){this._shadowAngleScale=h,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(h){this._projectionTextureLightNear=h,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(h){this._projectionTextureLightFar=h,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(h){this._projectionTextureUpDirection=h,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(h){this._projectionTexture!==h&&(this._projectionTexture=h,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(S._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):S._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(h){return void 0!==h.onGeneratedObservable}static _IsTexture(h){return void 0!==h.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(h){this._projectionTextureProjectionLightMatrix=h,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(h,d,T,Y,y,n){super(h,n),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=C.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=C.pd.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=C.pd.Zero(),this._projectionTextureViewLightMatrix=C.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=C.Matrix.Zero(),this._projectionTextureScalingMatrix=C.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=d,this.direction=T,this.angle=Y,this.exponent=y}getClassName(){return"SpotLight"}getTypeID(){return X.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(h){super._setDirection(h),this._projectionTextureViewLightDirty=!0}_setPosition(h){super._setPosition(h),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(h,d,T){const Y=this.Eh().activeCamera;if(!Y)return;this._shadowAngleScale=this._shadowAngleScale||1;const y=this._shadowAngleScale*this._angle,n=void 0!==this.shadowMinZ?this.shadowMinZ:Y.Gd,X=void 0!==this.shadowMaxZ?this.shadowMaxZ:Y.maxZ,F=this.Eh().getEngine().Dd;C.Matrix.PerspectiveFovLHToRef(y,1,F?X:n,F?n:X,h,!0,this._scene.getEngine().isNDCHalfZRange,void 0,F)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),C.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const h=this.projectionTextureLightFar,d=this.projectionTextureLightNear,T=h/(h-d),Y=-T*d,y=1/Math.tan(this._angle/2);C.Matrix.FromValuesToRef(y/1,0,0,0,0,y,0,0,0,0,T,1,0,0,Y,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof U.c){const h=this._projectionTexture.uScale/2,d=this._projectionTexture.vScale/2;C.Matrix.FromValuesToRef(h,0,0,0,0,d,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(h,d){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),h.setMatrix("textureProjectionMatrix"+d,this._projectionTextureMatrix),h.setTexture("projectionLightTexture"+d,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&h.setTexture("iesLightTexture"+d,this._iesProfileTexture),this}transferToEffect(h,d){let T;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,d),T=C.pd.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,d),T=C.pd.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",T.x,T.y,T.z,this._cosHalfAngle,d),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,d),this}transferToNodeMaterialEffect(h,d){let T;return T=this.computeTransformedInformation()?C.pd.Normalize(this.transformedDirection):C.pd.Normalize(this.direction),this.Eh().useRightHandedSystem?h.setFloat3(d,-T.x,-T.y,-T.z):h.setFloat3(d,T.x,T.y,T.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(h){const d=this._scene.getEngine(),T=void 0!==this.shadowMinZ?this.shadowMinZ:(null===h||void 0===h?void 0:h.Gd)??0;return d.Dd&&d.isNDCHalfZRange?T:this._scene.getEngine().isNDCHalfZRange?0:T}getDepthMaxZ(h){const d=this._scene.getEngine(),T=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===h||void 0===h?void 0:h.maxZ)??1e4;return d.Dd&&d.isNDCHalfZRange?0:T}prepareLightSpecificDefines(h,d){h["SPOTLIGHT"+d]=!0,h["PROJECTEDLIGHTTEXTURE"+d]=!(!this.projectionTexture||!this.projectionTexture.isReady()),h["IESLIGHTTEXTURE"+d]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,Y.c)([(0,y.E)()],S.prototype,"angle",null),(0,Y.c)([(0,y.E)()],S.prototype,"innerAngle",null),(0,Y.c)([(0,y.E)()],S.prototype,"shadowAngleScale",null),(0,Y.c)([(0,y.E)()],S.prototype,"exponent",void 0),(0,Y.c)([(0,y.E)()],S.prototype,"projectionTextureLightNear",null),(0,Y.c)([(0,y.E)()],S.prototype,"projectionTextureLightFar",null),(0,Y.c)([(0,y.E)()],S.prototype,"projectionTextureUpDirection",null),(0,Y.c)([(0,y.z)("projectedLightTexture")],S.prototype,"_projectionTexture",void 0),(0,Z.e)("BABYLON.SpotLight",S)},14206:(h,d,T)=>{"use strict";T.d(d,{e:()=>n,f:()=>C,g:()=>X});const Y={},y={};function C(h,d){Y[h]=d}function n(h,d){y[h]=d}function X(h){return y[h]?y[h]:null}},14082:(h,d,T)=>{"use strict";T.d(d,{e:()=>s,i:()=>K});var Y,y=T(12574),C=T(12583),n=T(12990),X=T(12625),F=T(12596),U=T(13232),Z=T(12627),S=T(12629),r=T(12722),c=T(12656),O=T(12623);!function(h){h[h.Clean=0]="Clean",h[h.Stop=1]="Stop",h[h.Sync=2]="Sync",h[h.NoSync=3]="NoSync"}(Y||(Y={}));const f=new C.e,J={};let W=!1;function L(){return J[".babylon"]}function D(h,d){const T=J[h];return T||(F.c.Warn("Unable to find a plugin to load "+h+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),d?L():void 0)}function V(h,d,T){let Y="Unable to load from "+(h.rawData?"binary data":h.url);return d?Y+=`: ${d}`:T&&(Y+=`: ${T}`),Y}async function i(h,d,T,Y,y,C,n,X,F){var U;const S="data:"===(r=h.url).substring(0,5)?r.substring(5):null;var r;if(h.rawData&&!n)throw"When using ArrayBufferView to load data the file extension must be provided.";const W=S||n?"":function(h){const d=h.indexOf("?");-1!==d&&(h=h.substring(0,d));const T=h.lastIndexOf(".");return h.substring(T,h.length).toLowerCase()}(h.url);let V=n?D(n,!0):S?function(h){for(const d in J){const T=J[d].plugin;if(T.canDirectLoad&&T.canDirectLoad(h))return J[d]}return L()}(h.url):D(W,!1);if(!V&&W){if(h.url&&!h.url.startsWith("blob:")){const d=await async function(h,d){const T=d.method||"GET";return await new Promise(((Y,y)=>{const C=new O.b;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const h={};if(d.responseHeaders)for(const T of d.responseHeaders)h[T]=C.getResponseHeader(T)||"";Y({response:C.response,headerValues:h})}else y(`Unable to fetch data from ${h}. Error code: ${C.status}`)})),C.open(T,h),C.send()}))}(h.url,{method:"HEAD",responseHeaders:["Content-Type"]}),T=d.headerValues?d.headerValues["Content-Type"]:"";T&&(V=function(h){for(const d in J){const T=J[d];if(T.mimeType===h)return T}}(T))}V||(V=L())}if(!V)throw new Error(`No plugin or fallback for ${n??h.url}`);if(!1===(null===F||void 0===F||null===(U=F[V.plugin.name])||void 0===U?void 0:U.enabled))throw new Error(`The '${V.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(h.rawData&&!V.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(h=>{if(V.plugin.createPlugin){const d=V.plugin.createPlugin(F??{});return d instanceof Promise?(d.then(h).catch((h=>{y("Error instantiating plugin.",h)})),null):(h(d),d)}return h(V.plugin),V.plugin})((F=>{var U;if(!F)throw`The loader plugin corresponding to the '${n}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(f.notifyObservers(F),S&&(F.canDirectLoad&&F.canDirectLoad(h.url)||!(0,Z.l)(h.url))){if(F.directLoad){const h=F.directLoad(d,S);h instanceof Promise?h.then((h=>{T(F,h)})).catch((h=>{y("Error in directLoad of _loadData: "+h,h)})):T(F,h)}else T(F,S);return}const r=V.isBinary,O=(h,Y)=>{d.U?y("Scene has been disposed"):T(F,h,Y)};let J=null,W=!1;null===(U=F.zd)||void 0===U||U.add((()=>{W=!0,J&&(J.abort(),J=null),C()}));const L=()=>{if(W)return;const T=(h,d)=>{y(null===h||void 0===h?void 0:h.statusText,d)};if(!F.loadFile&&h.rawData)throw"Plugin does not support loading ArrayBufferView.";J=F.loadFile?F.loadFile(d,h.rawData||h.file||h.url,h.rootUrl,O,Y,r,T,X):d._loadFile(h.file||h.url,O,Y,!0,r,T)},D=d.getEngine();let i=D.enableOfflineSupport;if(i){let T=!1;for(const Y of d.disableOfflineSupportExceptionRules)if(Y.test(h.url)){T=!0;break}i=!T}i&&c.c.OfflineProviderFactory?d.offlineProvider=c.c.OfflineProviderFactory(h.url,L,D.disableManifestCheck):L()}))}function w(h,d){let T,Y,C=null,n=null;if(d)if(d.name)T=`file:${d.name}`,Y=d.name,C=d;else if(ArrayBuffer.isView(d))T="",Y=(0,r.b)(),n=d;else if(d.startsWith("data:"))T=d,Y="";else if(h){const C=d;if("/"===C.substring(0,1))return y.Tools.Error("Wrong sceneFilename parameter"),null;T=h+C,Y=C}else T=d,Y=y.Tools.GetFilename(d),h=y.Tools.GetFolderPath(d);else T=h,Y=y.Tools.GetFilename(h),h=y.Tools.GetFolderPath(h);return{url:T,rootUrl:h,name:Y,file:C,rawData:n}}function s(h){if("string"===typeof h.extensions){const d=h.extensions;J[d.toLowerCase()]={plugin:h,isBinary:!1}}else{const d=h.extensions,T=Object.keys(d);for(const Y of T)J[Y.toLowerCase()]={plugin:h,isBinary:d[Y].isBinary,mimeType:d[Y].mimeType}}}async function E(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:X.d.LastCreatedScene,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!Y)return F.c.Error("No scene available to import mesh to"),null;const c=w(d,T);if(!c)return null;const O={};Y.addPendingData(O);const f=()=>{Y.removePendingData(O)},J=(h,d)=>{const T=V(c,h,d);n?n(Y,T,new S.k(T,S.h.SceneLoaderError,d)):F.c.Error(T),f()},W=C?h=>{try{C(h)}catch(d){J("Error in onProgress callback: "+d,d)}}:void 0,L=(h,d,T,C,n,X,F,U)=>{if(Y.importedMeshesFiles.push(c.url),y)try{y(h,d,T,C,n,X,F,U)}catch(Z){J("Error in onSuccess callback: "+Z,Z)}Y.removePendingData(O)};return await i(c,Y,((d,T,y)=>{if(d.rewriteRootURL&&(c.rootUrl=d.rewriteRootURL(c.rootUrl,y)),d.importMesh){const y=[],C=[],n=[];if(!d.importMesh(h,Y,T,c.rootUrl,y,C,n,J))return;Y.loadingPluginName=d.name,L(y,C,n,[],[],[],[],[])}else{d.importMeshAsync(h,Y,T,c.rootUrl,W,c.name).then((h=>{Y.loadingPluginName=d.name,L(h.meshes,h.Fr,h.skeletons,h.animationGroups,h.transformNodes,h.geometries,h.lights,h.spriteManagers)})).catch((h=>{J(h.message,h)}))}}),W,J,f,U,Z,r)}async function z(h,d,T,Y,y,C,n,X){return await new Promise(((F,U)=>{try{E(h,d,T,Y,((h,d,T,Y,y,C,n,X)=>{F({meshes:h,Fr:d,skeletons:T,animationGroups:Y,transformNodes:y,geometries:C,lights:n,spriteManagers:X})}),y,((h,d,T)=>{U(T||new Error(d))}),C,n,X).catch(U)}catch(S){U(S)}}))}async function x(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.d.LastCreatedEngine,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};T?await H(h,d,new n.d(T),Y,C,F,U,Z,S):y.Tools.Error("No engine available")}async function g(h,d,T,Y,y,C,n){return await new Promise(((X,F)=>{x(h,d,T,(h=>{X(h)}),Y,((h,d,T)=>{F(T||new Error(d))}),y,C,n)}))}async function H(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.d.LastCreatedScene,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!T)return F.c.Error("No scene available to append to"),null;const c=w(h,d);if(!c)return null;const O={};T.addPendingData(O);const f=()=>{T.removePendingData(O)};U.b.ShowLoadingScreen&&!W&&(W=!0,T.getEngine().displayLoadingUI(),T.executeWhenReady((()=>{T.getEngine().hideLoadingUI(),W=!1})));const J=(h,d)=>{const Y=V(c,h,d);C?C(T,Y,new S.k(Y,S.h.SceneLoaderError,d)):F.c.Error(Y),f()},L=y?h=>{try{y(h)}catch(d){J("Error in onProgress callback",d)}}:void 0,D=()=>{if(Y)try{Y(T)}catch(h){J("Error in onSuccess callback",h)}T.removePendingData(O)};return await i(c,T,((h,d)=>{if(h.load){if(!h.load(T,d,c.rootUrl,J))return;T.loadingPluginName=h.name,D()}else{h.loadAsync(T,d,c.rootUrl,L,c.name).then((()=>{T.loadingPluginName=h.name,D()})).catch((h=>{J(h.message,h)}))}}),L,J,f,n,Z,r)}async function p(h,d,T,Y,y,C,n){return await new Promise(((X,F)=>{try{H(h,d,T,(h=>{X(h)}),Y,((h,d,T)=>{F(T||new Error(d))}),y,C,n).catch(F)}catch(S){F(S)}}))}async function k(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.d.LastCreatedScene,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!T)return F.c.Error("No scene available to load asset container to"),null;const r=w(h,d);if(!r)return null;const c={};T.addPendingData(c);const O=()=>{T.removePendingData(c)},f=(h,d)=>{const Y=V(r,h,d);C?C(T,Y,new S.k(Y,S.h.SceneLoaderError,d)):F.c.Error(Y),O()},J=y?h=>{try{y(h)}catch(d){f("Error in onProgress callback",d)}}:void 0,W=h=>{if(Y)try{Y(h)}catch(d){f("Error in onSuccess callback",d)}T.removePendingData(c)};return await i(r,T,((h,d)=>{if(h.loadAssetContainer){const Y=h.loadAssetContainer(T,d,r.rootUrl,f);if(!Y)return;Y.populateRootNodes(),T.loadingPluginName=h.name,W(Y)}else if(h.loadAssetContainerAsync){h.loadAssetContainerAsync(T,d,r.rootUrl,J,r.name).then((d=>{d.populateRootNodes(),T.loadingPluginName=h.name,W(d)})).catch((h=>{f(h.message,h)}))}else f("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),J,f,O,n,U,Z)}async function o(h,d,T,Y,y,C,n){return await new Promise(((X,F)=>{try{k(h,d,T,(h=>{X(h)}),Y,((h,d,T)=>{F(T||new Error(d))}),y,C,n).catch(F)}catch(S){F(S)}}))}async function u(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.d.LastCreatedScene,Y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,r=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!T)return void F.c.Error("No scene available to load animations to");if(Y){for(const Y of T.animatables)Y.reset();T.stopAllAnimations();const h=T.animationGroups.slice();for(const T of h)T.dispose();const d=T.getNodes();for(const T of d)T.animations&&(T.animations=[])}else switch(y){case 0:const h=T.animationGroups.slice();for(const d of h)d.dispose();break;case 1:for(const d of T.animationGroups)d.stop();break;case 2:for(const d of T.animationGroups)d.reset(),d.restart();break;case 3:break;default:return void F.c.Error("Unknown animation group loading mode value '"+y+"'")}const O=T.animatables.length;await k(h,d,T,(h=>{h.mergeAnimationsTo(T,T.animatables.slice(O),C),h.dispose(),T.onAnimationFileImportedObservable.notifyObservers(T),n&&n(T)}),U,Z,S,r,c)}async function N(h,d,T,Y,y,C,n,X,F,U){return await new Promise(((Z,r)=>{try{u(h,d,T,Y,y,C,(h=>{Z(h)}),n,((h,d,T)=>{r(T||new Error(d))}),X,F,U).catch(r)}catch(S){r(S)}}))}class K{static get ForceFullSceneLoadingForIncremental(){return U.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(h){U.b.ForceFullSceneLoadingForIncremental=h}static get ShowLoadingScreen(){return U.b.ShowLoadingScreen}static set ShowLoadingScreen(h){U.b.ShowLoadingScreen=h}static get loggingLevel(){return U.b.loggingLevel}static set loggingLevel(h){U.b.loggingLevel=h}static get CleanBoneMatrixWeights(){return U.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(h){U.b.CleanBoneMatrixWeights=h}static GetDefaultPlugin(){return L()}static GetPluginForExtension(h){var d;return null===(d=D(h,!0))||void 0===d?void 0:d.plugin}static IsPluginForExtensionAvailable(h){return function(h){return!!J[h]}(h)}static RegisterPlugin(h){s(h)}static ImportMesh(h,d,T,Y,y,C,n,F,U){E(h,d,T,Y,y,C,n,F,U).catch((h=>null===n||void 0===n?void 0:n(X.d.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async ImportMeshAsync(h,d,T,Y,y,C,n){return await z(h,d,T,Y,y,C,n)}static Load(h,d,T,Y,y,C,n,F){x(h,d,T,Y,y,C,n,F).catch((h=>null===C||void 0===C?void 0:C(X.d.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async LoadAsync(h,d,T,Y,y,C){return await g(h,d,T,Y,y,C)}static Append(h,d,T,Y,y,C,n,F){H(h,d,T,Y,y,C,n,F).catch((h=>null===C||void 0===C?void 0:C(T??X.d.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async AppendAsync(h,d,T,Y,y,C){return await p(h,d,T,Y,y,C)}static LoadAssetContainer(h,d,T,Y,y,C,n,F){k(h,d,T,Y,y,C,n,F).catch((h=>null===C||void 0===C?void 0:C(T??X.d.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async LoadAssetContainerAsync(h,d,T,Y,y,C){return await o(h,d,T,Y,y,C)}static ImportAnimations(h,d,T,Y,y,C,n,F,U,Z,S){u(h,d,T,Y,y,C,n,F,U,Z,S).catch((h=>null===U||void 0===U?void 0:U(T??X.d.LastCreatedScene,null===h||void 0===h?void 0:h.message,h)))}static async ImportAnimationsAsync(h,d,T,Y,y,C,n,X,F,U,Z){return await N(h,d,T,Y,y,C,X,U,Z)}}K.NO_LOGGING=0,K.MINIMAL_LOGGING=1,K.SUMMARY_LOGGING=2,K.DETAILED_LOGGING=3,K.OnPluginActivatedObservable=f},14492:(h,d,T)=>{"use strict";T.d(d,{c:()=>r});var Y=T(12750),y=T(12757),C=T(12574),n=T(12765),X=T(12791),F=T(12741),U=T(12714),Z=T(12583),S=T(12801);T(14494);class r extends X.d{set boundingBoxSize(h){if(this._boundingBoxSize&&this._boundingBoxSize.equals(h))return;this._boundingBoxSize=h;const d=this.Eh();d&&d.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(h){this._rotationY=h,this.setReflectionTextureMatrix(n.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(h,d,T){let Y="";for(const y of h)Y+=y;return new r(Y,d,null,T,h)}static CreateFromPrefilteredData(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const y=d.useDelayedTextureLoading;d.useDelayedTextureLoading=!1;const C=new r(h,d,null,!1,null,null,null,void 0,!0,T,Y);return d.useDelayedTextureLoading=y,C}constructor(h,d){var T;let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,r=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,O=arguments.length>10&&void 0!==arguments[10]&&arguments[10],f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,J=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,W=arguments.length>13?arguments[13]:void 0,L=arguments.length>14?arguments[14]:void 0;super(d),this.onLoadObservable=new Z.e,this.boundingBoxPosition=n.pd.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new n.Matrix,this._buffer=null,this.name=h,this.url=h,this._noMipmap=y,this.vd=!1,this.isCube=!0,this._textureMatrix=n.Matrix.Identity(),this.coordinatesMode=F.c.CUBIC_MODE;let D=null,V=null;null===Y||Array.isArray(Y)?(this._noMipmap=y,this._format=S,this._createPolynomials=O,D=Y,this._loaderOptions=W,this._useSRGBBuffer=L,this._lodScale=f,this._lodOffset=J):(D=Y.extensions??null,this._noMipmap=Y.noMipmap??!1,C=Y.files??null,V=Y.buffer??null,this._format=Y.format??5,r=Y.prefiltered??!1,c=Y.forcedExtension??null,this._createPolynomials=Y.createPolynomials??!1,this._lodScale=Y.lodScale??.8,this._lodOffset=Y.lodOffset??0,this._loaderOptions=Y.loaderOptions,this._useSRGBBuffer=Y.useSRGBBuffer,X=Y.A??null,U=Y.onError??null),(h||C)&&this.updateURL(h,c,X,r,U,D,null===(T=this.Eh())||void 0===T?void 0:T.useDelayedTextureLoading,C,V)}getClassName(){return"CubeTexture"}updateURL(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=h),this.url=h,d&&(this._forcedExtension=d);const U=h.lastIndexOf("."),Z=d||(U>-1?h.substring(U).toLowerCase():""),S=0===Z.indexOf(".dds"),r=0===Z.indexOf(".env"),c=0===Z.indexOf(".basis");if(r?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=Y,Y&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),X)this._files=X;else if(c||r||S||C||(C=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,C){for(let d=0;d<C.length;d++)this._files.push(h+C[d]);this._extensions=C}this._buffer=F,n?(this.delayLoadState=4,this._delayedOnLoad=T,this._delayedOnError=y):this._loadTexture(T,y)}delayLoad(h){4===this.delayLoadState&&(h&&(this._forcedExtension=h),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(h){var d,T;if(h.updateFlag===this._textureMatrix.updateFlag)return;h.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(T=this.Eh())||void 0===T||T.markAllMaterialsAsDirty(1,(h=>-1!==h.getActiveTextures().indexOf(this))));if(this._textureMatrix=h,null===(d=this.Eh())||void 0===d||!d.useRightHandedSystem)return;const Y=n.TmpVectors.pd[0],y=n.TmpVectors.Quaternion[0],C=n.TmpVectors.pd[1];this._textureMatrix.decompose(Y,y,C),y.z*=-1,y.w*=-1,n.Matrix.ComposeToRef(Y,y,C,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var h;return null!==(h=this.Eh())&&void 0!==h&&h.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=this.Eh(),Y=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const y=()=>{var d;(this.onLoadObservable.notifyObservers(this),Y)&&(Y.dispose(),null===(d=this.Eh())||void 0===d||d.markAllMaterialsAsDirty(1));h&&h()},n=(h,T)=>{this._loadingError=!0,this._errorObject={message:h,exception:T},d&&d(h,T),F.c.OnTextureLoadErrorObservable.notifyObservers(this)};var X;this._texture?this._texture.isReady?C.Tools.SetImmediate((()=>y())):this._texture.onLoadedObservable.add((()=>y())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,T,this._lodScale,this._lodOffset,h,n,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,T,this._files,this._noMipmap,h,n,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(X=this._texture)||void 0===X||X.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(h,d,T){const Y=S.e.Parse((()=>{let Y=!1;return h.prefiltered&&(Y=h.prefiltered),new r(T+(h.url??h.name),d,h.extensions,!1,h.files||null,null,null,void 0,Y,h.forcedExtension)}),h,d);if(h.boundingBoxPosition&&(Y.boundingBoxPosition=n.pd.Bd(h.boundingBoxPosition)),h.boundingBoxSize&&(Y.boundingBoxSize=n.pd.Bd(h.boundingBoxSize)),h.animations)for(let y=0;y<h.animations.length;y++){const d=h.animations[y],T=(0,U.d)("BABYLON.Animation");T&&Y.animations.push(T.Parse(d))}return Y}clone(){let h=0;const d=S.e.Clone((()=>{const d=new r(this.url,this.Eh()||this._getEngine(),this._extensions,this._noMipmap,this._files);return h=d.uniqueId,d}),this);return d.uniqueId=h,d}}(0,Y.c)([(0,y.E)()],r.prototype,"url",void 0),(0,Y.c)([(0,y.B)()],r.prototype,"boundingBoxPosition",void 0),(0,Y.c)([(0,y.B)()],r.prototype,"boundingBoxSize",null),(0,Y.c)([(0,y.E)("rotationY")],r.prototype,"rotationY",null),(0,Y.c)([(0,y.E)("files")],r.prototype,"_files",void 0),(0,Y.c)([(0,y.E)("forcedExtension")],r.prototype,"_forcedExtension",void 0),(0,Y.c)([(0,y.E)("extensions")],r.prototype,"_extensions",void 0),(0,Y.c)([(0,y.t)("textureMatrix")],r.prototype,"_textureMatrix",void 0),(0,Y.c)([(0,y.t)("textureMatrixRefraction")],r.prototype,"_textureMatrixRefraction",void 0),F.c._CubeTextureParser=r.Parse,(0,U.e)("BABYLON.CubeTexture",r)},15021:(h,d,T)=>{"use strict";T.d(d,{d:()=>F});var Y=T(12596),y=T(12741),C=T(12727),n=T(12890),X=T(12684);n.ThinEngine.prototype.createDynamicTexture=function(h,d,T,Y){const y=new X.e(this,4);return y.baseWidth=h,y.baseHeight=d,T&&(h=this.needPOTTextures?(0,C.e)(h,this._caps.maxTextureSize):h,d=this.needPOTTextures?(0,C.e)(d,this._caps.maxTextureSize):d),y.width=h,y.height=d,y.isReady=!1,y.generateMipMaps=T,y.samplingMode=Y,this.updateTextureSamplingMode(Y,y),this._internalTexturesCache.push(y),y},n.ThinEngine.prototype.updateDynamicTexture=function(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],y=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!h)return;const n=this._gl,X=n.TEXTURE_2D,F=this._bindTextureDirectly(X,h,!0,C);this._unpackFlipY(void 0===T?h.invertY:T),Y&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const U=this._getWebGLTextureType(h.type),Z=this._getInternalFormat(y||h.format),S=this._getRGBABufferInternalSizedFormat(h.type,Z);n.texImage2D(X,0,S,Z,U,d),h.generateMipMaps&&n.generateMipmap(X),F||this._bindTextureDirectly(X,null),Y&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),y&&(h.format=y),h._dynamicTextureSource=d,h._premulAlpha=Y,h.invertY=T||!1,h.isReady=!0};class F extends y.c{constructor(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,X=arguments.length>6?arguments[6]:void 0;const F=!T||T._isScene;super(null,F?T:null===T||void 0===T?void 0:T.qd,F?!Y:T,X,C,void 0,void 0,void 0,void 0,n),this.name=h,this.wrapU=y.c.CLAMP_ADDRESSMODE,this.wrapV=y.c.CLAMP_ADDRESSMODE,this._generateMipMaps=Y;const U=this._getEngine();if(!U)return;if(d.getContext)this._canvas=d,this._ownCanvas=!1,this._texture=U.createDynamicTexture(this._canvas.width,this._canvas.height,Y,C);else{this._canvas=U.createCanvas(1,1),this._ownCanvas=!0;const h=d;h.width||0===h.width?this._texture=U.createDynamicTexture(h.width,h.height,Y,C):this._texture=U.createDynamicTexture(d,d,Y,C)}const Z=this.getSize();this._canvas.width!==Z.width&&(this._canvas.width=Z.width),this._canvas.height!==Z.height&&(this._canvas.height=Z.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(h){this._canvas.width=h.width,this._canvas.height=h.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(h.width,h.height,this._generateMipMaps,this.samplingMode)}scale(h){const d=this.getSize();d.width*=h,d.height*=h,this._recreate(d)}scaleTo(h,d){const T=this.getSize();T.width=h,T.height=d,this._recreate(T)}getContext(){return this._context}clear(h){const d=this.getSize();h&&(this._context.fillStyle=h),this._context.clearRect(0,0,d.width,d.height)}update(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===h||h,d,this._format||void 0,void 0,T)}drawText(h,d,T,Y,y,C,n){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const F=this.getSize();if(C&&(this._context.fillStyle=C,this._context.fillRect(0,0,F.width,F.height)),this._context.font=Y,null===d||void 0===d){const T=this._context.measureText(h);d=(F.width-T.width)/2}if(null===T||void 0===T){const h=parseInt(Y.replace(/\D/g,""));T=F.height/2+h/3.65}this._context.fillStyle=y||"",this._context.fillText(h,d,T),X&&this.update(n)}dispose(){var h,d;(super.dispose(),this._ownCanvas)&&(null===(h=this._canvas)||void 0===h||null===(d=h.remove)||void 0===d||d.call(h));this._canvas=null,this._context=null}clone(){const h=this.Eh();if(!h)return this;const d=this.getSize(),T=new F(this.name,d,h,this._generateMipMaps);return T.vd=this.vd,T.level=this.level,T.wrapU=this.wrapU,T.wrapV=this.wrapV,T}serialize(){const h=this.Eh();h&&!h.isReady()&&Y.c.Warn("The scene must be ready before serializing the dynamic texture");const d=super.serialize();return F._IsCanvasElement(this._canvas)&&(d.base64String=this._canvas.toDataURL()),d.invertY=this._invertY,d.samplingMode=this.samplingMode,d}static _IsCanvasElement(h){return void 0!==h.toDataURL}_rebuild(){this.update()}}},14401:(h,d,T)=>{"use strict";T.d(d,{d:()=>y});var Y=T(12741);class y extends Y.c{get depth(){return this._depth}constructor(h,d,T,y,C,n){let X=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Y.c.TRILINEAR_SAMPLINGMODE,Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,S=arguments.length>10?arguments[10]:void 0;super(null,n,!X,F),this.format=C,this._texture=n.getEngine().createRawTexture2DArray(h,d,T,y,C,X,F,U,null,Z,S),this._depth=y,this.is2DArray=!0}update(h){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,h,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(h,d,T,Y,C){return new y(h,d,T,Y,5,C,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},14221:(h,d,T)=>{"use strict";T.d(d,{d:()=>X,g:()=>F,j:()=>C,k:()=>n});var Y=T(12787),y=T(12765);function C(h,d){return`{X: ${h.x.toFixed(d)} Y: ${h.y.toFixed(d)}}`}function n(h,d){return`{X: ${h._x.toFixed(d)} Y: ${h._y.toFixed(d)} Z: ${h._z.toFixed(d)}}`}function X(h,d){return 2*Math.acos((0,Y.Clamp)(y.Quaternion.Dot(h,d)))}function F(h,d){const T=new y.Quaternion;return function(h,d,T){const C=y.pd.Cross(h,d),n=Math.acos((0,Y.Clamp)(y.pd.Dot(h,d),-1,1));y.Quaternion.RotationAxisToRef(C,n,T)}(h,d,T),T}},14031:(h,d,T)=>{"use strict";T.d(d,{b:()=>U});var Y=T(12765),y=T(12812),C=T(13213),n=T(13200),X=T(12817);T(14039);function F(h){let d=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const T=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],C=[];let F=[];const U=h.width||h.size||1,Z=h.height||h.size||1,S=h.depth||h.size||1,r=h.wrap||!1;let c=void 0===h.topBaseAt?1:h.topBaseAt,O=void 0===h.bottomBaseAt?0:h.bottomBaseAt;c=(c+4)%4,O=(O+4)%4;let f=[2,0,3,1][c],J=[2,0,1,3][O],W=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(r){d=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],W=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let h=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],T=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const Y=[17,18,19,16],y=[22,23,20,21];for(;f>0;)h.unshift(h.pop()),Y.unshift(Y.pop()),f--;for(;J>0;)T.unshift(T.pop()),y.unshift(y.pop()),J--;h=h.flat(),T=T.flat(),W=W.concat(h).concat(T),d.push(Y[0],Y[2],Y[3],Y[0],Y[1],Y[2]),d.push(y[0],y[2],y[3],y[0],y[1],y[2])}const L=[U/2,Z/2,S/2];F=W.reduce(((h,d,T)=>h.concat(d*L[T%3])),[]);const D=0===h.sideOrientation?0:h.sideOrientation||n.c.DEFAULTSIDE,V=h.faceUV||new Array(6),i=h.faceColors,w=[];for(let n=0;n<6;n++)void 0===V[n]&&(V[n]=new Y.Vector4(0,0,1,1)),i&&void 0===i[n]&&(i[n]=new y.ln(1,1,1,1));for(let Y=0;Y<6;Y++)if(C.push(V[Y].z,X.b?1-V[Y].w:V[Y].w),C.push(V[Y].x,X.b?1-V[Y].w:V[Y].w),C.push(V[Y].x,X.b?1-V[Y].y:V[Y].y),C.push(V[Y].z,X.b?1-V[Y].y:V[Y].y),i)for(let h=0;h<4;h++)w.push(i[Y].r,i[Y].g,i[Y].b,i[Y].a);n.c._ComputeSides(D,F,d,T,C,h.frontUVs,h.backUVs);const s=new n.c;if(s.indices=d,s.xh=F,s.gh=T,s.ph=C,i){const h=D===n.c.DOUBLESIDE?w.concat(w):w;s.Hh=h}return s}function U(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=new C.d(h,T);d.sideOrientation=C.d._GetDefaultSideOrientation(d.sideOrientation),Y._originalBuilderSideOrientation=d.sideOrientation;return F(d).oh(Y,d.updatable),Y}n.c.CreateBox=F,C.d.CreateBox=function(h,d){return U(h,{size:d,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},14210:(h,d,T)=>{"use strict";T.d(d,{e:()=>X});var Y=T(13213),y=T(13200),C=T(12817);function n(h){const d=[],T=[],Y=[],n=[],X=h.radius||.5,F=h.tessellation||64,U=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1,Z=0===h.sideOrientation?0:h.sideOrientation||y.c.DEFAULTSIDE;d.push(0,0,0),n.push(.5,.5);const S=2*Math.PI*U,r=1===U?S/F:S/(F-1);let c=0;for(let y=0;y<F;y++){const h=Math.cos(c),T=Math.sin(c),Y=(h+1)/2,y=(1-T)/2;d.push(X*h,X*T,0),n.push(Y,C.b?1-y:y),c+=r}1===U&&(d.push(d[3],d[4],d[5]),n.push(n[2],C.b?1-n[3]:n[3]));const O=d.length/3;for(let y=1;y<O-1;y++)T.push(y+1,0,y);y.c.ComputeNormals(d,T,Y),y.c._ComputeSides(Z,d,T,Y,n,h.frontUVs,h.backUVs);const f=new y.c;return f.indices=T,f.xh=d,f.gh=Y,f.ph=n,f}function X(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=new Y.d(h,T);d.sideOrientation=Y.d._GetDefaultSideOrientation(d.sideOrientation),y._originalBuilderSideOrientation=d.sideOrientation;return n(d).oh(y,d.updatable),y}y.c.CreateDisc=n,Y.d.CreateDisc=function(h,d,T){return X(h,{radius:d,tessellation:T,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},14039:(h,d,T)=>{"use strict";T.d(d,{e:()=>J,d:()=>L,i:()=>W});var Y=T(12765),y=T(12812),C=T(13213),n=T(13200),X=T(12835);C.d._GroundMeshParser=(h,d)=>F.Parse(h,d);class F extends C.d{constructor(h,d){super(h,d),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=h,this._subdivisionsY=h,this.subdivide(h);const T=this;T.createOrUpdateSubmeshesOctree&&T.createOrUpdateSubmeshesOctree(d)}getHeightAtCoordinates(h,d){const T=this.getWorldMatrix(),y=Y.TmpVectors.Matrix[5];T.invertToRef(y);const C=Y.TmpVectors.pd[8];if(Y.pd.TransformCoordinatesFromFloatsToRef(h,0,d,y,C),h=C.x,d=C.z,h<this._minX||h>=this._maxX||d<=this._minZ||d>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const n=this._getFacetAt(h,d),X=-(n.x*h+n.z*d+n.w)/n.y;return Y.pd.TransformCoordinatesFromFloatsToRef(0,X,0,T,C),C.y}getNormalAtCoordinates(h,d){const T=new Y.pd(0,1,0);return this.getNormalAtCoordinatesToRef(h,d,T),T}getNormalAtCoordinatesToRef(h,d,T){const y=this.getWorldMatrix(),C=Y.TmpVectors.Matrix[5];y.invertToRef(C);const n=Y.TmpVectors.pd[8];if(Y.pd.TransformCoordinatesFromFloatsToRef(h,0,d,C,n),h=n.x,d=n.z,h<this._minX||h>this._maxX||d<this._minZ||d>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const X=this._getFacetAt(h,d);return Y.pd.TransformNormalFromFloatsToRef(X.x,X.y,X.z,y,T),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(h,d){const T=Math.floor((h+this._maxX)*this._subdivisionsX/this._width),Y=Math.floor(-(d+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),y=this._heightQuads[Y*this._subdivisionsX+T];let C;return C=d<y.slope.x*h+y.slope.y?y.facet1:y.facet2,C}_initHeightQuads(){const h=this._subdivisionsX,d=this._subdivisionsY;this._heightQuads=[];for(let T=0;T<d;T++)for(let d=0;d<h;d++){const y={slope:Y.Vector2.Zero(),facet1:new Y.Vector4(0,0,0,0),facet2:new Y.Vector4(0,0,0,0)};this._heightQuads[T*h+d]=y}return this}_computeHeightQuads(){const h=this.getVerticesData(X.g.PositionKind);if(!h)return this;const d=Y.TmpVectors.pd[3],T=Y.TmpVectors.pd[2],y=Y.TmpVectors.pd[1],C=Y.TmpVectors.pd[0],n=Y.TmpVectors.pd[4],F=Y.TmpVectors.pd[5],U=Y.TmpVectors.pd[6],Z=Y.TmpVectors.pd[7],S=Y.TmpVectors.pd[8];let r=0,c=0,O=0,f=0,J=0,W=0,L=0;const D=this._subdivisionsX,V=this._subdivisionsY;for(let X=0;X<V;X++)for(let V=0;V<D;V++){r=3*V,c=X*(D+1)*3,O=(X+1)*(D+1)*3,d.x=h[c+r],d.y=h[c+r+1],d.z=h[c+r+2],T.x=h[c+r+3],T.y=h[c+r+4],T.z=h[c+r+5],y.x=h[O+r],y.y=h[O+r+1],y.z=h[O+r+2],C.x=h[O+r+3],C.y=h[O+r+4],C.z=h[O+r+5],f=(C.z-d.z)/(C.x-d.x),J=d.z-f*d.x,T.subtractToRef(d,n),y.subtractToRef(d,F),C.subtractToRef(d,U),Y.pd.CrossToRef(U,F,Z),Y.pd.CrossToRef(n,U,S),Z.normalize(),S.normalize(),W=-(Z.x*d.x+Z.y*d.y+Z.z*d.z),L=-(S.x*T.x+S.y*T.y+S.z*T.z);const i=this._heightQuads[X*D+V];i.slope.ny(f,J),i.facet1.ny(Z.x,Z.y,Z.z,W),i.facet2.ny(S.x,S.y,S.z,L)}return this}serialize(h){super.serialize(h),h.subdivisionsX=this._subdivisionsX,h.subdivisionsY=this._subdivisionsY,h.minX=this._minX,h.maxX=this._maxX,h.Gd=this._minZ,h.maxZ=this._maxZ,h.width=this._width,h.height=this._height}static Parse(h,d){const T=new F(h.name,d);return T._subdivisionsX=h.subdivisionsX||1,T._subdivisionsY=h.subdivisionsY||1,T._minX=h.minX,T._maxX=h.maxX,T._minZ=h.Gd,T._maxZ=h.maxZ,T._width=h.width,T._height=h.height,T}}var U=T(12574),Z=T(12625),S=T(12772),r=T(12817);function c(h){const d=[],T=[],y=[],C=[];let X,F;const U=h.width||h.size||1,Z=h.height||h.size||1,S=0|(h.subdivisionsX||h.subdivisions||1),c=0|(h.subdivisionsY||h.subdivisions||1);for(X=0;X<=c;X++)for(F=0;F<=S;F++){const h=new Y.pd(F*U/S-U/2,0,(c-X)*Z/c-Z/2),d=new Y.pd(0,1,0);T.push(h.x,h.y,h.z),y.push(d.x,d.y,d.z),C.push(F/S,r.b?X/c:1-X/c)}for(X=0;X<c;X++)for(F=0;F<S;F++)d.push(F+1+(X+1)*(S+1)),d.push(F+1+X*(S+1)),d.push(F+X*(S+1)),d.push(F+(X+1)*(S+1)),d.push(F+1+(X+1)*(S+1)),d.push(F+X*(S+1));const O=new n.c;return O.indices=d,O.xh=T,O.gh=y,O.ph=C,O}function O(h){const d=void 0!==h.xmin&&null!==h.xmin?h.xmin:-1,T=void 0!==h.zmin&&null!==h.zmin?h.zmin:-1,y=void 0!==h.xmax&&null!==h.xmax?h.xmax:1,C=void 0!==h.zmax&&null!==h.zmax?h.zmax:1,X=h.subdivisions||{w:1,h:1},F=h.precision||{w:1,h:1},U=[],Z=[],S=[],r=[];let c,O,f,J;X.h=X.h<1?1:X.h,X.w=X.w<1?1:X.w,F.w=F.w<1?1:F.w,F.h=F.h<1?1:F.h;const W=(y-d)/X.w,L=(C-T)/X.h;function D(h,d,T,y){const C=Z.length/3,n=F.w+1;for(c=0;c<F.h;c++)for(O=0;O<F.w;O++){const h=[C+O+c*n,C+(O+1)+c*n,C+(O+1)+(c+1)*n,C+O+(c+1)*n];U.push(h[1]),U.push(h[2]),U.push(h[3]),U.push(h[0]),U.push(h[1]),U.push(h[3])}const X=Y.pd.Zero(),f=new Y.pd(0,1,0);for(c=0;c<=F.h;c++)for(X.z=c*(y-d)/F.h+d,O=0;O<=F.w;O++)X.x=O*(T-h)/F.w+h,X.y=0,Z.push(X.x,X.y,X.z),S.push(f.x,f.y,f.z),r.push(O/F.w,c/F.h)}for(f=0;f<X.h;f++)for(J=0;J<X.w;J++)D(d+J*W,T+f*L,d+(J+1)*W,T+(f+1)*L);const V=new n.c;return V.indices=U,V.xh=Z,V.gh=S,V.ph=r,V}function f(h){const d=[],T=[],C=[],X=[];let F,U;const Z=h.colorFilter||new y.ed(.3,.59,.11),r=h.alphaFilter||0;let c=!1;if(h.minHeight>h.maxHeight){c=!0;const d=h.maxHeight;h.maxHeight=h.minHeight,h.minHeight=d}for(F=0;F<=h.subdivisions;F++)for(U=0;U<=h.subdivisions;U++){const d=new Y.pd(U*h.width/h.subdivisions-h.width/2,0,(h.subdivisions-F)*h.height/h.subdivisions-h.height/2),y=4*(((d.x+h.width/2)/h.width*(h.bufferWidth-1)|0)+((1-(d.z+h.height/2)/h.height)*(h.bufferHeight-1)|0)*h.bufferWidth);let n=h.buffer[y]/255,O=h.buffer[y+1]/255,f=h.buffer[y+2]/255;const J=h.buffer[y+3]/255;c&&(n=1-n,O=1-O,f=1-f);const W=n*Z.r+O*Z.g+f*Z.b;d.y=J>=r?h.minHeight+(h.maxHeight-h.minHeight)*W:h.minHeight-S.d,h.heightBuffer&&(h.heightBuffer[F*(h.subdivisions+1)+U]=d.y),T.push(d.x,d.y,d.z),C.push(0,0,0),X.push(U/h.subdivisions,1-F/h.subdivisions)}for(F=0;F<h.subdivisions;F++)for(U=0;U<h.subdivisions;U++){const Y=U+1+(F+1)*(h.subdivisions+1),y=U+1+F*(h.subdivisions+1),C=U+F*(h.subdivisions+1),n=U+(F+1)*(h.subdivisions+1),X=T[3*Y+1]>=h.minHeight,Z=T[3*y+1]>=h.minHeight,S=T[3*C+1]>=h.minHeight;X&&Z&&S&&(d.push(Y),d.push(y),d.push(C));T[3*n+1]>=h.minHeight&&X&&S&&(d.push(n),d.push(Y),d.push(C))}n.c.ComputeNormals(T,d,C);const O=new n.c;return O.indices=d,O.xh=T,O.gh=C,O.ph=X,O}function J(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const T=new F(h,arguments.length>2?arguments[2]:void 0);T._setReady(!1),T._subdivisionsX=d.subdivisionsX||d.subdivisions||1,T._subdivisionsY=d.subdivisionsY||d.subdivisions||1,T._width=d.width||1,T._height=d.height||1,T._maxX=T._width/2,T._maxZ=T._height/2,T._minX=-T._maxX,T._minZ=-T._maxZ;return c(d).oh(T,d.updatable),T._setReady(!0),T}function W(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=new C.d(h,T);return O(d).oh(Y,d.updatable),Y}function L(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const C=T.width||10,n=T.height||10,X=T.subdivisions||1,S=T.minHeight||0,r=T.maxHeight||1,c=T.colorFilter||new y.ed(.3,.59,.11),O=T.alphaFilter||0,J=T.updatable,W=T.onReady;Y=Y||Z.d.LastCreatedScene;const L=new F(h,Y);let D;L._subdivisionsX=X,L._subdivisionsY=X,L._width=C,L._height=n,L._maxX=L._width/2,L._maxZ=L._height/2,L._minX=-L._maxX,L._minZ=-L._maxZ,L._setReady(!1),T.passHeightBufferInCallback&&(D=new Float32Array((X+1)*(X+1)));const V=(h,d,T)=>{f({width:C,height:n,subdivisions:X,minHeight:S,maxHeight:r,colorFilter:c,buffer:h,bufferWidth:d,bufferHeight:T,alphaFilter:O,heightBuffer:D}).oh(L,J),W&&W(L,D),L._setReady(!0)};if("string"===typeof d){const h=h=>{var d;const T=h.width,y=h.height;if(Y.U)return;const C=null===(d=Y)||void 0===d?void 0:d.getEngine().resizeImageBitmap(h,T,y);V(C,T,y)};U.Tools.LoadImage(d,h,T.onError?T.onError:()=>{},Y.offlineProvider)}else V(d.data,d.width,d.height);return L}n.c.CreateGround=c,n.c.CreateTiledGround=O,n.c.CreateGroundFromHeightMap=f,C.d.CreateGround=(h,d,T,Y,y,C)=>J(h,{width:d,height:T,subdivisions:Y,updatable:C},y),C.d.CreateTiledGround=(h,d,T,Y,y,C,n,X,F)=>W(h,{xmin:d,zmin:T,xmax:Y,zmax:y,subdivisions:C,precision:n,updatable:F},X),C.d.CreateGroundFromHeightMap=(h,d,T,Y,y,C,n,X,F,U,Z)=>L(h,d,{width:T,height:Y,subdivisions:y,minHeight:C,maxHeight:n,updatable:F,onReady:U,alphaFilter:Z},X)},14715:(h,d,T)=>{"use strict";T.d(d,{b:()=>c,e:()=>S,g:()=>r});var Y=T(12765),y=T(13213),C=T(13200),n=T(13328),X=T(12835),F=T(12596);function U(h){const d=[],T=[],Y=h.lines,y=h.Hh,n=[];let X=0;for(let C=0;C<Y.length;C++){const h=Y[C];for(let Y=0;Y<h.length;Y++){const{x:F,y:U,z:Z}=h[Y];if(T.push(F,U,Z),y){const h=y[C],{r:d,g:T,b:X,a:F}=h[Y];n.push(d,T,X,F)}Y>0&&(d.push(X-1),d.push(X)),X++}}const F=new C.c;return F.indices=d,F.xh=T,y&&(F.Hh=n),F}function Z(h){const d=h.dashSize||3,T=h.gapSize||1,y=h.dashNb||200,n=h.points,X=[],F=[],U=Y.pd.Zero();let Z=0,S=0,r=0,c=0,O=0,f=0,J=0;for(J=0;J<n.length-1;J++)n[J+1].subtractToRef(n[J],U),Z+=U.length();for(r=Z/y,c=d*r/(d+T),J=0;J<n.length-1;J++){n[J+1].subtractToRef(n[J],U),S=Math.floor(U.length()/r),U.normalize();for(let h=0;h<S;h++)O=r*h,X.push(n[J].x+O*U.x,n[J].y+O*U.y,n[J].z+O*U.z),X.push(n[J].x+(O+c)*U.x,n[J].y+(O+c)*U.y,n[J].z+(O+c)*U.z),F.push(f,f+1),f+=2}const W=new C.c;return W.xh=X,W.indices=F,W}function S(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=d.instance,y=d.lines,C=d.Hh;if(Y){const h=Y.getVerticesData(X.g.PositionKind);let d,T;C&&(d=Y.getVerticesData(X.g.ColorKind));let n=0,F=0;for(let Y=0;Y<y.length;Y++){const X=y[Y];for(let y=0;y<X.length;y++)h[n]=X[y].x,h[n+1]=X[y].y,h[n+2]=X[y].z,C&&d&&(T=C[Y],d[F]=T[y].r,d[F+1]=T[y].g,d[F+2]=T[y].b,d[F+3]=T[y].a,F+=4),n+=3}return Y.updateVerticesData(X.g.PositionKind,h,!1,!1),C&&d&&Y.updateVerticesData(X.g.ColorKind,d,!1,!1),Y.refreshBoundingInfo(),Y}const F=!!C,Z=new n.d(h,T,null,void 0,void 0,F,d.useVertexAlpha,d.material);return U(d).oh(Z,d.updatable),Z}function r(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=d.Hh?[d.Hh]:null;return S(h,{lines:[d.points],updatable:d.updatable,instance:d.instance,Hh:Y,useVertexAlpha:d.useVertexAlpha,material:d.material},T)}function c(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=d.points,X=d.instance,U=d.gapSize||1,S=d.dashSize||3;if(X){const h=h=>{const d=Y.pd.Zero(),T=h.length/6;let y=0,n=0,F=0,U=0,Z=0,S=0,r=0,c=0;for(r=0;r<C.length-1;r++)C[r+1].subtractToRef(C[r],d),y+=d.length();F=y/T;const O=X._creationDataStorage.dashSize;for(U=O*F/(O+X._creationDataStorage.gapSize),r=0;r<C.length-1;r++)for(C[r+1].subtractToRef(C[r],d),n=Math.floor(d.length()/F),d.normalize(),c=0;c<n&&S<h.length;)Z=F*c,h[S]=C[r].x+Z*d.x,h[S+1]=C[r].y+Z*d.y,h[S+2]=C[r].z+Z*d.z,h[S+3]=C[r].x+(Z+U)*d.x,h[S+4]=C[r].y+(Z+U)*d.y,h[S+5]=C[r].z+(Z+U)*d.z,S+=6,c++;for(;S<h.length;)h[S]=C[r].x,h[S+1]=C[r].y,h[S+2]=C[r].z,S+=3};return(d.dashNb||d.dashSize||d.gapSize||d.useVertexAlpha||d.material)&&F.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),X.updateMeshPositions(h,!1),X}const r=new n.d(h,T,null,void 0,void 0,void 0,d.useVertexAlpha,d.material);return Z(d).oh(r,d.updatable),r._creationDataStorage=new y.f,r._creationDataStorage.dashSize=S,r._creationDataStorage.gapSize=U,r}C.c.CreateLineSystem=U,C.c.CreateDashedLines=Z,y.d.kU=function(h,d){return r(h,{points:d,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},y.d.CreateDashedLines=function(h,d,T,Y,y){return c(h,{points:d,dashSize:T,gapSize:Y,dashNb:y,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},14090:(h,d,T)=>{"use strict";T.d(d,{d:()=>X,h:()=>F});var Y=T(13213),y=T(13200),C=T(12817);function n(h){const d=[],T=[],Y=[],n=[],X=void 0!==h.width?h.width:void 0!==h.size?h.size:1,F=void 0!==h.height?h.height:void 0!==h.size?h.size:1,U=0===h.sideOrientation?0:h.sideOrientation||y.c.DEFAULTSIDE,Z=X/2,S=F/2;T.push(-Z,-S,0),Y.push(0,0,-1),n.push(0,C.b?1:0),T.push(Z,-S,0),Y.push(0,0,-1),n.push(1,C.b?1:0),T.push(Z,S,0),Y.push(0,0,-1),n.push(1,C.b?0:1),T.push(-Z,S,0),Y.push(0,0,-1),n.push(0,C.b?0:1),d.push(0),d.push(1),d.push(2),d.push(0),d.push(2),d.push(3),y.c._ComputeSides(U,T,d,Y,n,h.frontUVs,h.backUVs);const r=new y.c;return r.indices=d,r.xh=T,r.gh=Y,r.ph=n,r}function X(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=new Y.d(h,T);d.sideOrientation=Y.d._GetDefaultSideOrientation(d.sideOrientation),y._originalBuilderSideOrientation=d.sideOrientation;return n(d).oh(y,d.updatable),d.sourcePlane&&(y.translate(d.sourcePlane.normal,-d.sourcePlane.d),y.setDirection(d.sourcePlane.normal.scale(-1))),y}const F={NU:X};y.c.NU=n,Y.d.NU=(h,d,T,Y,y)=>X(h,{size:d,width:d,height:d,sideOrientation:y,updatable:Y},T)},14199:(h,d,T)=>{"use strict";T.d(d,{d:()=>F});var Y=T(12765),y=T(13213),C=T(13200),n=T(12817);function X(h){const d=0|(h.segments||32),T=h.diameterX||h.diameter||1,y=h.diameterY||h.diameter||1,X=h.diameterZ||h.diameter||1,F=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1,U=h.slice&&h.slice<=0?1:h.slice||1,Z=0===h.sideOrientation?0:h.sideOrientation||C.c.DEFAULTSIDE,S=!!h.dedupTopBottomIndices,r=new Y.pd(T/2,y/2,X/2),c=2+d,O=2*c,f=[],J=[],W=[],L=[];for(let C=0;C<=c;C++){const h=C/c,d=h*Math.PI*U;for(let T=0;T<=O;T++){const y=T/O,C=y*Math.PI*2*F,X=Y.Matrix.RotationZ(-d),U=Y.Matrix.RotationY(C),Z=Y.pd.TransformCoordinates(Y.pd.Up(),X),S=Y.pd.TransformCoordinates(Z,U),c=S.multiply(r),f=S.divide(r).normalize();J.push(c.x,c.y,c.z),W.push(f.x,f.y,f.z),L.push(y,n.b?1-h:h)}if(C>0){const h=J.length/3;for(let d=h-2*(O+1);d+O+2<h;d++)S?(C>1&&(f.push(d),f.push(d+1),f.push(d+O+1)),(C<c||U<1)&&(f.push(d+O+1),f.push(d+1),f.push(d+O+2))):(f.push(d),f.push(d+1),f.push(d+O+1),f.push(d+O+1),f.push(d+1),f.push(d+O+2))}}C.c._ComputeSides(Z,J,f,W,L,h.frontUVs,h.backUVs);const D=new C.c;return D.indices=f,D.xh=J,D.gh=W,D.ph=L,D}function F(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=new y.d(h,T);d.sideOrientation=y.d._GetDefaultSideOrientation(d.sideOrientation),Y._originalBuilderSideOrientation=d.sideOrientation;return X(d).oh(Y,d.updatable),Y}C.c.CreateSphere=X,y.d.CreateSphere=(h,d,T,Y,y,C)=>F(h,{segments:d,diameterX:T,diameterY:T,diameterZ:T,sideOrientation:C,updatable:y},Y)},15027:(h,d,T)=>{"use strict";T.d(d,{e:()=>X});var Y=T(13350),y=T(14499),C=T(13374),n=T(13200);class X{static get Configuration(){return{get decoder(){return y.c.DefaultConfiguration},set decoder(h){y.c.DefaultConfiguration=h}}}static set Configuration(h){y.c.DefaultConfiguration=h.decoder}static get DecoderAvailable(){return(0,Y.h)(y.c.DefaultConfiguration)}static get Default(){return X._Default??(X._Default=new X),X._Default}static ResetDefault(h){X._Default&&(h||X._Default.dispose(),X._Default=null)}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.DefaultNumWorkers;const d="number"===typeof h?{...y.c.DefaultConfiguration,numWorkers:h}:{...y.c.DefaultConfiguration,...h};this._decoder=new y.c(d)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(h,d,T){return this._decoder.decodeMeshToMeshDataAsync(h,d,T)}async decodeMeshToGeometryAsync(h,d,T,Y){return await this._decoder.decodeMeshToGeometryAsync(h,d,T,Y)}async _decodeMeshToGeometryForGltfAsync(h,d,T,Y,y,C){return await this._decoder._decodeMeshToGeometryForGltfAsync(h,d,T,Y,y,C)}async decodeMeshAsync(h,d){const T=await this._decoder.decodeMeshToMeshDataAsync(h,d),Y=new n.c;T.indices&&(Y.indices=T.indices);for(const y of T.attributes){const h=C.c.GetFloatData(y.data,y.size,C.c.GetDataType(y.data),y.byteOffset,y.byteStride,y.normalized,T.totalVertices);Y.set(h,y.kind)}return Y}}X.DefaultNumWorkers=(0,Y.e)(),X._Default=null},14499:(h,d,T)=>{"use strict";T.d(d,{c:()=>U});var Y=T(13350),y=T(12574),C=T(13225),n=T(13374),X=T(12596),F=T(13365);class U extends Y.c{static get DefaultAvailable(){return(0,Y.h)(U.DefaultConfiguration)}static get Default(){return U._Default??(U._Default=new U),U._Default}static ResetDefault(h){U._Default&&(h||U._Default.dispose(),U._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(h,d){return{module:await(d||DracoDecoderModule)({wasmBinary:h})}}_getWorkerContent(){return`${F.c}(${F.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:U.DefaultConfiguration)}decodeMeshToMeshDataAsync(h,d,T){const Y=h instanceof ArrayBuffer?new Int8Array(h):new Int8Array(h.buffer,h.byteOffset,h.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async h=>await new Promise(((y,C)=>{h.push(((h,n)=>{let F=null;const U=[],Z=d=>{h.removeEventListener("error",Z),h.removeEventListener("message",S),C(d),n()},S=d=>{const Y=d.data;switch(Y.id){case"indices":F=Y.data;break;case"attribute":U.push({kind:Y.kind,data:Y.data,size:Y.size,byteOffset:Y.byteOffset,byteStride:Y.byteStride,normalized:(C=Y.kind,r=Y.normalized,T&&void 0!==T[C]?(r!==T[C]&&X.c.Warn(`Normalized flag from Draco data (${r}) does not match normalized flag from glTF accessor (${T[C]}). Using flag from glTF accessor.`),T[C]):r)});break;case"decodeMeshDone":h.removeEventListener("error",Z),h.removeEventListener("message",S),y({indices:F,attributes:U,totalVertices:Y.totalVertices}),n()}var C,r};h.addEventListener("error",Z),h.addEventListener("message",S);const r=Y.slice();h.postMessage({id:"decodeMesh",dataView:r,attributes:d},[r.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((h=>{let T=null;const y=[],C=(0,F.c)(h.module,Y,d,(h=>{T=h}),((h,d,T,Y,C,n)=>{y.push({kind:h,data:d,size:T,byteOffset:Y,byteStride:C,normalized:n})}));return{indices:T,attributes:y,totalVertices:C}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(h,d,T,Y){const y=await this.decodeMeshToMeshDataAsync(T,Y),X=new C.e(h,d);y.indices&&X.setIndices(y.indices);for(const C of y.attributes)X.setVerticesBuffer(new n.c(d.getEngine(),C.data,C.kind,!1,void 0,C.byteStride,void 0,C.byteOffset,C.size,void 0,C.normalized,!0),y.totalVertices);return X}async _decodeMeshToGeometryForGltfAsync(h,d,T,Y,y,X){const F=await this.decodeMeshToMeshDataAsync(T,Y,y),U=new C.e(h,d);X&&(U._boundingInfo=X,U.useBoundingInfoFromGeometry=!0),F.indices&&U.setIndices(F.indices);for(const C of F.attributes)U.setVerticesBuffer(new n.c(d.getEngine(),C.data,C.kind,!1,void 0,C.byteStride,void 0,C.byteOffset,C.size,void 0,C.normalized,!0),F.totalVertices);return U}}U.DefaultConfiguration={wasmUrl:`${y.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${y.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${y.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},U._Default=null},14711:(h,d,T)=>{"use strict";T.d(d,{b:()=>Xh});var Y=T(12765),y=T(13213),C=T(12835),n=T(13200),X=T(12817);function F(h){let d=h.pathArray;const T=h.closeArray||!1,Y=h.closePath||!1,y=h.invertUV||!1,F=Math.floor(d[0].length/2);let U=h.offset||F;U=U>F?F:Math.floor(U);const Z=0===h.sideOrientation?0:h.sideOrientation||n.c.DEFAULTSIDE,S=h.ph,r=h.Hh,c=[],O=[],f=[],J=[],W=[],L=[],D=[],V=[];let i;const w=[],s=[];let E,z,x;if(d.length<2){const h=[],T=[];for(z=0;z<d[0].length-U;z++)h.push(d[0][z]),T.push(d[0][z+U]);d=[h,T]}let g=0;const H=Y?1:0,p=T?1:0;let k,o,u,N,K,l;for(i=d[0].length,E=0;E<d.length+p;E++){for(D[E]=0,W[E]=[0],k=E===d.length?d[0]:d[E],o=k.length,i=i<o?i:o,x=0;x<o;)c.push(k[x].x,k[x].y,k[x].z),x>0&&(u=k[x].Nd(k[x-1]).length(),N=u+D[E],W[E].push(N),D[E]=N),x++;Y&&(x--,c.push(k[0].x,k[0].y,k[0].z),u=k[x].Nd(k[0]).length(),N=u+D[E],W[E].push(N),D[E]=N),w[E]=o+H,s[E]=g,g+=o+H}let q,j,a=null,e=null;for(z=0;z<i+H;z++)for(V[z]=0,L[z]=[0],E=0;E<d.length-1+p;E++)K=d[E],l=E===d.length-1?d[0]:d[E+1],z===i?(a=K[0],e=l[0]):(a=K[z],e=l[z]),u=e.Nd(a).length(),N=u+V[z],L[z].push(N),V[z]=N;if(S)for(E=0;E<S.length;E++)J.push(S[E].x,X.b?1-S[E].y:S[E].y);else for(E=0;E<d.length+p;E++)for(z=0;z<i+H;z++)q=0!=D[E]?W[E][z]/D[E]:0,j=0!=V[z]?L[z][E]/V[z]:0,y?J.push(j,q):J.push(q,X.b?1-j:j);E=0;let v=0,G=w[E]-1,b=w[E+1]-1,B=G<b?G:b,M=s[1]-s[0];const mh=w.length-1;for(;v<=B&&E<mh;)O.push(v,v+M,v+1),O.push(v+M+1,v+1,v+M),v+=1,v===B&&(E++,M=s[E+1]-s[E],G=w[E]-1,b=w[E+1]-1,v=s[E],B=G<b?G+v:b+v);if(n.c.ComputeNormals(c,O,f),Y){let h=0,T=0;for(E=0;E<d.length;E++){h=3*s[E],T=E+1<d.length?3*(s[E+1]-1):f.length-3,f[h]=.5*(f[h]+f[T]),f[h+1]=.5*(f[h+1]+f[T+1]),f[h+2]=.5*(f[h+2]+f[T+2]);const Y=Math.sqrt(f[h]*f[h]+f[h+1]*f[h+1]+f[h+2]*f[h+2]);f[h]/=Y,f[h+1]/=Y,f[h+2]/=Y,f[T]=f[h],f[T+1]=f[h+1],f[T+2]=f[h+2]}}if(T){let h=3*s[0],T=3*s[d.length];for(z=0;z<i+H;z++){f[h]=.5*(f[h]+f[T]),f[h+1]=.5*(f[h+1]+f[T+1]),f[h+2]=.5*(f[h+2]+f[T+2]);const d=Math.sqrt(f[h]*f[h]+f[h+1]*f[h+1]+f[h+2]*f[h+2]);f[h]/=d,f[h+1]/=d,f[h+2]/=d,f[T]=f[h],f[T+1]=f[h+1],f[T+2]=f[h+2],h+=3,T+=3}}n.c._ComputeSides(Z,c,O,f,J,h.frontUVs,h.backUVs);let R=null;if(r){R=new Float32Array(4*r.length);for(let h=0;h<r.length;h++)R[4*h]=r[h].r,R[4*h+1]=r[h].g,R[4*h+2]=r[h].b,R[4*h+3]=r[h].a}const Q=new n.c,I=new Float32Array(c),A=new Float32Array(f),P=new Float32Array(J);return Q.indices=O,Q.xh=I,Q.gh=A,Q.ph=P,R&&Q.set(R,C.g.ColorKind),Y&&(Q._idx=s),Q}function U(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=d.pathArray,Z=d.closeArray,S=d.closePath,r=y.d._GetDefaultSideOrientation(d.sideOrientation),c=d.instance,O=d.updatable;if(c){const h=Y.TmpVectors.pd[0].XC(Number.MAX_VALUE),T=Y.TmpVectors.pd[1].XC(-Number.MAX_VALUE),F=d=>{let Y=U[0].length;const C=c;let n=0;const X=C._originalBuilderSideOrientation===y.d.DOUBLESIDE?2:1;for(let y=1;y<=X;++y)for(let X=0;X<U.length;++X){const y=U[X],F=y.length;Y=Y<F?Y:F;for(let C=0;C<Y;++C){const Y=y[C];d[n]=Y.x,d[n+1]=Y.y,d[n+2]=Y.z,h.minimizeInPlaceFromFloats(Y.x,Y.y,Y.z),T.maximizeInPlaceFromFloats(Y.x,Y.y,Y.z),n+=3}if(C._creationDataStorage&&C._creationDataStorage.closePath){const h=y[0];d[n]=h.x,d[n+1]=h.y,d[n+2]=h.z,n+=3}}},Z=c.getVerticesData(C.g.PositionKind);if(F(Z),c.hasBoundingInfo?c.getBoundingInfo().reConstruct(h,T,c._worldMatrix):c.buildBoundingInfo(h,T,c._worldMatrix),c.updateVerticesData(C.g.PositionKind,Z,!1,!1),d.Hh){const h=c.getVerticesData(C.g.ColorKind);for(let T=0,Y=0;T<d.Hh.length;T++,Y+=4){const y=d.Hh[T];h[Y]=y.r,h[Y+1]=y.g,h[Y+2]=y.b,h[Y+3]=y.a}c.updateVerticesData(C.g.ColorKind,h,!1,!1)}if(d.ph){const h=c.getVerticesData(C.g.UVKind);for(let T=0;T<d.ph.length;T++)h[2*T]=d.ph[T].x,h[2*T+1]=X.b?1-d.ph[T].y:d.ph[T].y;c.updateVerticesData(C.g.UVKind,h,!1,!1)}if(!c.areNormalsFrozen||c.isFacetDataEnabled){const h=c.Pd(),d=c.getVerticesData(C.g.NormalKind),T=c.isFacetDataEnabled?c.getFacetDataParameters():null;if(n.c.ComputeNormals(Z,h,d,T),c._creationDataStorage&&c._creationDataStorage.closePath){let h=0,T=0;for(let Y=0;Y<U.length;Y++)h=3*c._creationDataStorage.idx[Y],T=Y+1<U.length?3*(c._creationDataStorage.idx[Y+1]-1):d.length-3,d[h]=.5*(d[h]+d[T]),d[h+1]=.5*(d[h+1]+d[T+1]),d[h+2]=.5*(d[h+2]+d[T+2]),d[T]=d[h],d[T+1]=d[h+1],d[T+2]=d[h+2]}c.areNormalsFrozen||c.updateVerticesData(C.g.NormalKind,d,!1,!1)}return c}{const Y=new y.d(h,T);Y._originalBuilderSideOrientation=r,Y._creationDataStorage=new y.f;const C=F(d);return S&&(Y._creationDataStorage.idx=C._idx),Y._creationDataStorage.closePath=S,Y._creationDataStorage.closeArray=Z,C.oh(Y,O),Y}}n.c.CreateRibbon=F,y.d.CreateRibbon=function(h,d){return U(h,{pathArray:d,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var Z=T(14210),S=T(14031),r=T(12812);function c(h){const d=h.pattern||y.d.NO_FLIP,T=h.tileWidth||h.tileSize||1,Y=h.tileHeight||h.tileSize||1,C=h.alignHorizontal||0,X=h.alignVertical||0,F=h.width||h.size||1,U=Math.floor(F/T);let Z=F-U*T;const S=h.height||h.size||1,r=Math.floor(S/Y);let c=S-r*Y;const O=T*U/2,f=Y*r/2;let J=0,W=0,L=0,D=0,V=0,i=0;if(Z>0||c>0){switch(L=-O,D=-f,V=O,i=f,C){case y.d.CENTER:Z/=2,L-=Z,V+=Z;break;case y.d.LEFT:V+=Z,J=-Z/2;break;case y.d.RIGHT:L-=Z,J=Z/2}switch(X){case y.d.CENTER:c/=2,D-=c,i+=c;break;case y.d.BOTTOM:i+=c,W=-c/2;break;case y.d.TOP:D-=c,W=c/2}}const w=[],s=[],E=[];E[0]=[0,0,1,0,1,1,0,1],E[1]=[0,0,1,0,1,1,0,1],d!==y.d.ROTATE_TILE&&d!==y.d.ROTATE_ROW||(E[1]=[1,1,0,1,0,0,1,0]),d!==y.d.FLIP_TILE&&d!==y.d.FLIP_ROW||(E[1]=[1,0,0,0,0,1,1,1]),d!==y.d.FLIP_N_ROTATE_TILE&&d!==y.d.FLIP_N_ROTATE_ROW||(E[1]=[0,1,1,1,1,0,0,0]);let z=[];const x=[],g=[];let H=0;for(let n=0;n<r;n++)for(let h=0;h<U;h++)w.push(h*T-O+J,n*Y-f+W,0),w.push((h+1)*T-O+J,n*Y-f+W,0),w.push((h+1)*T-O+J,(n+1)*Y-f+W,0),w.push(h*T-O+J,(n+1)*Y-f+W,0),g.push(H,H+1,H+3,H+1,H+2,H+3),z=d===y.d.FLIP_TILE||d===y.d.ROTATE_TILE||d===y.d.FLIP_N_ROTATE_TILE?z.concat(E[(h%2+n%2)%2]):d===y.d.FLIP_ROW||d===y.d.ROTATE_ROW||d===y.d.FLIP_N_ROTATE_ROW?z.concat(E[n%2]):z.concat(E[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),H+=4;if(Z>0||c>0){const h=c>0&&(X===y.d.CENTER||X===y.d.TOP),n=c>0&&(X===y.d.CENTER||X===y.d.BOTTOM),F=Z>0&&(C===y.d.CENTER||C===y.d.RIGHT),S=Z>0&&(C===y.d.CENTER||C===y.d.LEFT);let E,p,k,o,u=[];if(h&&F&&(w.push(L+J,D+W,0),w.push(-O+J,D+W,0),w.push(-O+J,D+c+W,0),w.push(L+J,D+c+W,0),g.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,E=1-Z/T,p=1-c/Y,k=1,o=1,u=[E,p,k,p,k,o,E,o],d===y.d.ROTATE_ROW&&(u=[1-E,1-p,1-k,1-p,1-k,1-o,1-E,1-o]),d===y.d.FLIP_ROW&&(u=[1-E,p,1-k,p,1-k,o,1-E,o]),d===y.d.FLIP_N_ROTATE_ROW&&(u=[E,1-p,k,1-p,k,1-o,E,1-o]),z=z.concat(u),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h&&S&&(w.push(O+J,D+W,0),w.push(V+J,D+W,0),w.push(V+J,D+c+W,0),w.push(O+J,D+c+W,0),g.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,E=0,p=1-c/Y,k=Z/T,o=1,u=[E,p,k,p,k,o,E,o],(d===y.d.ROTATE_ROW||d===y.d.ROTATE_TILE&&U%2===0)&&(u=[1-E,1-p,1-k,1-p,1-k,1-o,1-E,1-o]),(d===y.d.FLIP_ROW||d===y.d.FLIP_TILE&&U%2===0)&&(u=[1-E,p,1-k,p,1-k,o,1-E,o]),(d===y.d.FLIP_N_ROTATE_ROW||d===y.d.FLIP_N_ROTATE_TILE&&U%2===0)&&(u=[E,1-p,k,1-p,k,1-o,E,1-o]),z=z.concat(u),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),n&&F&&(w.push(L+J,f+W,0),w.push(-O+J,f+W,0),w.push(-O+J,i+W,0),w.push(L+J,i+W,0),g.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,E=1-Z/T,p=0,k=1,o=c/Y,u=[E,p,k,p,k,o,E,o],(d===y.d.ROTATE_ROW&&r%2===1||d===y.d.ROTATE_TILE&&r%1===0)&&(u=[1-E,1-p,1-k,1-p,1-k,1-o,1-E,1-o]),(d===y.d.FLIP_ROW&&r%2===1||d===y.d.FLIP_TILE&&r%2===0)&&(u=[1-E,p,1-k,p,1-k,o,1-E,o]),(d===y.d.FLIP_N_ROTATE_ROW&&r%2===1||d===y.d.FLIP_N_ROTATE_TILE&&r%2===0)&&(u=[E,1-p,k,1-p,k,1-o,E,1-o]),z=z.concat(u),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),n&&S&&(w.push(O+J,f+W,0),w.push(V+J,f+W,0),w.push(V+J,i+W,0),w.push(O+J,i+W,0),g.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,E=0,p=0,k=Z/T,o=c/Y,u=[E,p,k,p,k,o,E,o],(d===y.d.ROTATE_ROW&&r%2===1||d===y.d.ROTATE_TILE&&(r+U)%2===1)&&(u=[1-E,1-p,1-k,1-p,1-k,1-o,1-E,1-o]),(d===y.d.FLIP_ROW&&r%2===1||d===y.d.FLIP_TILE&&(r+U)%2===1)&&(u=[1-E,p,1-k,p,1-k,o,1-E,o]),(d===y.d.FLIP_N_ROTATE_ROW&&r%2===1||d===y.d.FLIP_N_ROTATE_TILE&&(r+U)%2===1)&&(u=[E,1-p,k,1-p,k,1-o,E,1-o]),z=z.concat(u),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h){const h=[];E=0,p=1-c/Y,k=1,o=1,h[0]=[E,p,k,p,k,o,E,o],h[1]=[E,p,k,p,k,o,E,o],d!==y.d.ROTATE_TILE&&d!==y.d.ROTATE_ROW||(h[1]=[1-E,1-p,1-k,1-p,1-k,1-o,1-E,1-o]),d!==y.d.FLIP_TILE&&d!==y.d.FLIP_ROW||(h[1]=[1-E,p,1-k,p,1-k,o,1-E,o]),d!==y.d.FLIP_N_ROTATE_TILE&&d!==y.d.FLIP_N_ROTATE_ROW||(h[1]=[E,1-p,k,1-p,k,1-o,E,1-o]);for(let Y=0;Y<U;Y++)w.push(Y*T-O+J,D+W,0),w.push((Y+1)*T-O+J,D+W,0),w.push((Y+1)*T-O+J,D+c+W,0),w.push(Y*T-O+J,D+c+W,0),g.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,z=d===y.d.FLIP_TILE||d===y.d.ROTATE_TILE||d===y.d.FLIP_N_ROTATE_TILE?z.concat(h[(Y+1)%2]):d===y.d.FLIP_ROW||d===y.d.ROTATE_ROW||d===y.d.FLIP_N_ROTATE_ROW?z.concat(h[1]):z.concat(h[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(n){const h=[];E=0,p=0,k=1,o=c/Y,h[0]=[E,p,k,p,k,o,E,o],h[1]=[E,p,k,p,k,o,E,o],d!==y.d.ROTATE_TILE&&d!==y.d.ROTATE_ROW||(h[1]=[1-E,1-p,1-k,1-p,1-k,1-o,1-E,1-o]),d!==y.d.FLIP_TILE&&d!==y.d.FLIP_ROW||(h[1]=[1-E,p,1-k,p,1-k,o,1-E,o]),d!==y.d.FLIP_N_ROTATE_TILE&&d!==y.d.FLIP_N_ROTATE_ROW||(h[1]=[E,1-p,k,1-p,k,1-o,E,1-o]);for(let Y=0;Y<U;Y++)w.push(Y*T-O+J,i-c+W,0),w.push((Y+1)*T-O+J,i-c+W,0),w.push((Y+1)*T-O+J,i+W,0),w.push(Y*T-O+J,i+W,0),g.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,z=d===y.d.FLIP_TILE||d===y.d.ROTATE_TILE||d===y.d.FLIP_N_ROTATE_TILE?z.concat(h[(Y+r)%2]):d===y.d.FLIP_ROW||d===y.d.ROTATE_ROW||d===y.d.FLIP_N_ROTATE_ROW?z.concat(h[r%2]):z.concat(h[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(F){const h=[];E=1-Z/T,p=0,k=1,o=1,h[0]=[E,p,k,p,k,o,E,o],h[1]=[E,p,k,p,k,o,E,o],d!==y.d.ROTATE_TILE&&d!==y.d.ROTATE_ROW||(h[1]=[1-E,1-p,1-k,1-p,1-k,1-o,1-E,1-o]),d!==y.d.FLIP_TILE&&d!==y.d.FLIP_ROW||(h[1]=[1-E,p,1-k,p,1-k,o,1-E,o]),d!==y.d.FLIP_N_ROTATE_TILE&&d!==y.d.FLIP_N_ROTATE_ROW||(h[1]=[E,1-p,k,1-p,k,1-o,E,1-o]);for(let T=0;T<r;T++)w.push(L+J,T*Y-f+W,0),w.push(L+Z+J,T*Y-f+W,0),w.push(L+Z+J,(T+1)*Y-f+W,0),w.push(L+J,(T+1)*Y-f+W,0),g.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,z=d===y.d.FLIP_TILE||d===y.d.ROTATE_TILE||d===y.d.FLIP_N_ROTATE_TILE?z.concat(h[(T+1)%2]):d===y.d.FLIP_ROW||d===y.d.ROTATE_ROW||d===y.d.FLIP_N_ROTATE_ROW?z.concat(h[T%2]):z.concat(h[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(S){const h=[];E=0,p=0,k=Z/Y,o=1,h[0]=[E,p,k,p,k,o,E,o],h[1]=[E,p,k,p,k,o,E,o],d!==y.d.ROTATE_TILE&&d!==y.d.ROTATE_ROW||(h[1]=[1-E,1-p,1-k,1-p,1-k,1-o,1-E,1-o]),d!==y.d.FLIP_TILE&&d!==y.d.FLIP_ROW||(h[1]=[1-E,p,1-k,p,1-k,o,1-E,o]),d!==y.d.FLIP_N_ROTATE_TILE&&d!==y.d.FLIP_N_ROTATE_ROW||(h[1]=[E,1-p,k,1-p,k,1-o,E,1-o]);for(let T=0;T<r;T++)w.push(V-Z+J,T*Y-f+W,0),w.push(V+J,T*Y-f+W,0),w.push(V+J,(T+1)*Y-f+W,0),w.push(V-Z+J,(T+1)*Y-f+W,0),g.push(H,H+1,H+3,H+1,H+2,H+3),H+=4,z=d===y.d.FLIP_TILE||d===y.d.ROTATE_TILE||d===y.d.FLIP_N_ROTATE_TILE?z.concat(h[(T+U)%2]):d===y.d.FLIP_ROW||d===y.d.ROTATE_ROW||d===y.d.FLIP_N_ROTATE_ROW?z.concat(h[T%2]):z.concat(h[0]),x.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),s.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const p=0===h.sideOrientation?0:h.sideOrientation||n.c.DEFAULTSIDE;n.c._ComputeSides(p,w,g,s,z,h.frontUVs,h.backUVs);const k=new n.c;k.indices=g,k.xh=w,k.gh=s,k.ph=z;const o=p===n.c.DOUBLESIDE?x.concat(x):x;return k.Hh=o,k}function O(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=new y.d(h,T);d.sideOrientation=y.d._GetDefaultSideOrientation(d.sideOrientation),Y._originalBuilderSideOrientation=d.sideOrientation;return c(d).oh(Y,d.updatable),Y}function f(h){const d=h.faceUV||new Array(6),T=h.faceColors,C=h.pattern||y.d.NO_FLIP,F=h.width||h.size||1,U=h.height||h.size||1,Z=h.depth||h.size||1,S=h.tileWidth||h.tileSize||1,O=h.tileHeight||h.tileSize||1,f=h.alignHorizontal||0,J=h.alignVertical||0,W=0===h.sideOrientation?0:h.sideOrientation||n.c.DEFAULTSIDE;for(let y=0;y<6;y++)void 0===d[y]&&(d[y]=new Y.Vector4(0,0,1,1)),T&&void 0===T[y]&&(T[y]=new r.ln(1,1,1,1));const L=F/2,D=U/2,V=Z/2,i=[];for(let Y=0;Y<2;Y++)i[Y]=c({pattern:C,tileWidth:S,tileHeight:O,width:F,height:U,alignVertical:J,alignHorizontal:f,sideOrientation:W});for(let Y=2;Y<4;Y++)i[Y]=c({pattern:C,tileWidth:S,tileHeight:O,width:Z,height:U,alignVertical:J,alignHorizontal:f,sideOrientation:W});let w=J;J===y.d.BOTTOM?w=y.d.TOP:J===y.d.TOP&&(w=y.d.BOTTOM);for(let Y=4;Y<6;Y++)i[Y]=c({pattern:C,tileWidth:S,tileHeight:O,width:F,height:Z,alignVertical:w,alignHorizontal:f,sideOrientation:W});let s=[],E=[],z=[],x=[];const g=[],H=[],p=[],k=[];let o=0,u=0;for(let y=0;y<6;y++){const h=i[y].xh.length;H[y]=[],p[y]=[];for(let d=0;d<h/3;d++)H[y].push(new Y.pd(i[y].xh[3*d],i[y].xh[3*d+1],i[y].xh[3*d+2])),p[y].push(new Y.pd(i[y].gh[3*d],i[y].gh[3*d+1],i[y].gh[3*d+2]));o=i[y].ph.length,k[y]=[];for(let T=0;T<o;T+=2)k[y][T]=d[y].x+(d[y].z-d[y].x)*i[y].ph[T],k[y][T+1]=d[y].y+(d[y].w-d[y].y)*i[y].ph[T+1],X.b&&(k[y][T+1]=1-k[y][T+1]);if(z=z.concat(k[y]),x=x.concat(i[y].indices.map((h=>h+u))),u+=H[y].length,T)for(let d=0;d<4;d++)g.push(T[y].r,T[y].g,T[y].b,T[y].a)}const N=new Y.pd(0,0,V),K=Y.Matrix.RotationY(Math.PI);s=H[0].map((h=>Y.pd.TransformNormal(h,K).add(N))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[]),E=p[0].map((h=>Y.pd.TransformNormal(h,K))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[]),s=s.concat(H[1].map((h=>h.Nd(N))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[])),E=E.concat(p[1].map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[]));const l=new Y.pd(L,0,0),q=Y.Matrix.RotationY(-Math.PI/2);s=s.concat(H[2].map((h=>Y.pd.TransformNormal(h,q).add(l))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[])),E=E.concat(p[2].map((h=>Y.pd.TransformNormal(h,q))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[]));const j=Y.Matrix.RotationY(Math.PI/2);s=s.concat(H[3].map((h=>Y.pd.TransformNormal(h,j).Nd(l))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[])),E=E.concat(p[3].map((h=>Y.pd.TransformNormal(h,j))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[]));const a=new Y.pd(0,D,0),e=Y.Matrix.RotationX(Math.PI/2);s=s.concat(H[4].map((h=>Y.pd.TransformNormal(h,e).add(a))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[])),E=E.concat(p[4].map((h=>Y.pd.TransformNormal(h,e))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[]));const v=Y.Matrix.RotationX(-Math.PI/2);s=s.concat(H[5].map((h=>Y.pd.TransformNormal(h,v).Nd(a))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[])),E=E.concat(p[5].map((h=>Y.pd.TransformNormal(h,v))).map((h=>[h.x,h.y,h.z])).reduce(((h,d)=>h.concat(d)),[])),n.c._ComputeSides(W,s,x,E,z);const G=new n.c;if(G.indices=x,G.xh=s,G.gh=E,G.ph=z,T){const h=W===n.c.DOUBLESIDE?g.concat(g):g;G.Hh=h}return G}function J(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=new y.d(h,T);d.sideOrientation=y.d._GetDefaultSideOrientation(d.sideOrientation),Y._originalBuilderSideOrientation=d.sideOrientation;return f(d).oh(Y,d.updatable),Y}n.c.CreateTiledPlane=c;n.c.CreateTiledBox=f;var W=T(14199),L=T(12990),D=T(12949);function V(h){const d=h.height||2;let T=0===h.diameterTop?0:h.diameterTop||h.diameter||1,C=0===h.diameterBottom?0:h.diameterBottom||h.diameter||1;T=T||1e-5,C=C||1e-5;const F=0|(h.tessellation||24),U=0|(h.subdivisions||1),Z=!!h.hasRings,S=!!h.enclose,c=0===h.cap?0:h.cap||y.d.CAP_ALL,O=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1,f=0===h.sideOrientation?0:h.sideOrientation||n.c.DEFAULTSIDE,J=h.faceUV||new Array(3),W=h.faceColors,L=2+(1+(1!==O&&S?2:0))*(Z?U:1);let V;for(V=0;V<L;V++)W&&void 0===W[V]&&(W[V]=new r.ln(1,1,1,1));for(V=0;V<L;V++)J&&void 0===J[V]&&(J[V]=new Y.Vector4(0,0,1,1));const i=[],w=[],s=[],E=[],z=[],x=2*Math.PI*O/F;let g,H,p;const k=(C-T)/2/d,o=Y.pd.Zero(),u=Y.pd.Zero(),N=Y.pd.Zero(),K=Y.pd.Zero(),l=Y.pd.Zero(),q=D.d.Y;let j,a,e,v=1,G=1,b=0,B=0;for(j=0;j<=U;j++)for(H=j/U,p=(H*(T-C)+C)/2,v=Z&&0!==j&&j!==U?2:1,e=0;e<v;e++){for(Z&&(G+=e),S&&(G+=2*e),a=0;a<=F;a++)g=a*x,o.x=Math.cos(-g)*p,o.y=-d/2+H*d,o.z=Math.sin(-g)*p,0===T&&j===U?(u.x=s[s.length-3*(F+1)],u.y=s[s.length-3*(F+1)+1],u.z=s[s.length-3*(F+1)+2]):(u.x=o.x,u.z=o.z,u.y=Math.sqrt(u.x*u.x+u.z*u.z)*k,u.normalize()),0===a&&(N.C(o),K.C(u)),w.push(o.x,o.y,o.z),s.push(u.x,u.y,u.z),B=Z?b!==G?J[G].y:J[G].w:J[G].y+(J[G].w-J[G].y)*H,E.push(J[G].x+(J[G].z-J[G].x)*a/F,X.b?1-B:B),W&&z.push(W[G].r,W[G].g,W[G].b,W[G].a);1!==O&&S&&(w.push(o.x,o.y,o.z),w.push(0,o.y,0),w.push(0,o.y,0),w.push(N.x,N.y,N.z),Y.pd.CrossToRef(q,u,l),l.normalize(),s.push(l.x,l.y,l.z,l.x,l.y,l.z),Y.pd.CrossToRef(K,q,l),l.normalize(),s.push(l.x,l.y,l.z,l.x,l.y,l.z),B=Z?b!==G?J[G+1].y:J[G+1].w:J[G+1].y+(J[G+1].w-J[G+1].y)*H,E.push(J[G+1].x,X.b?1-B:B),E.push(J[G+1].z,X.b?1-B:B),B=Z?b!==G?J[G+2].y:J[G+2].w:J[G+2].y+(J[G+2].w-J[G+2].y)*H,E.push(J[G+2].x,X.b?1-B:B),E.push(J[G+2].z,X.b?1-B:B),W&&(z.push(W[G+1].r,W[G+1].g,W[G+1].b,W[G+1].a),z.push(W[G+1].r,W[G+1].g,W[G+1].b,W[G+1].a),z.push(W[G+2].r,W[G+2].g,W[G+2].b,W[G+2].a),z.push(W[G+2].r,W[G+2].g,W[G+2].b,W[G+2].a))),b!==G&&(b=G)}const M=1!==O&&S?F+4:F;for(j=0,G=0;G<U;G++){let h=0,d=0,T=0,Y=0;for(a=0;a<F;a++)h=j*(M+1)+a,d=(j+1)*(M+1)+a,T=j*(M+1)+(a+1),Y=(j+1)*(M+1)+(a+1),i.push(h,d,T),i.push(Y,T,d);1!==O&&S&&(i.push(h+2,d+2,T+2),i.push(Y+2,T+2,d+2),i.push(h+4,d+4,T+4),i.push(Y+4,T+4,d+4)),j=Z?j+2:j+1}const mh=h=>{const y=h?T/2:C/2;if(0===y)return;let n,U,Z;const S=h?J[L-1]:J[0];let r=null;W&&(r=h?W[L-1]:W[0]);const c=w.length/3,f=h?d/2:-d/2,D=new Y.pd(0,f,0);w.push(D.x,D.y,D.z),s.push(0,h?1:-1,0);const V=S.y+.5*(S.w-S.y);E.push(S.x+.5*(S.z-S.x),X.b?1-V:V),r&&z.push(r.r,r.g,r.b,r.a);const x=new Y.Vector2(.5,.5);for(Z=0;Z<=F;Z++){n=2*Math.PI*Z*O/F;const d=Math.cos(-n),T=Math.sin(-n);U=new Y.pd(d*y,f,T*y);const C=new Y.Vector2(d*x.x+.5,T*x.y+.5);w.push(U.x,U.y,U.z),s.push(0,h?1:-1,0);const c=S.y+(S.w-S.y)*C.y;E.push(S.x+(S.z-S.x)*C.x,X.b?1-c:c),r&&z.push(r.r,r.g,r.b,r.a)}for(Z=0;Z<F;Z++)h?(i.push(c),i.push(c+(Z+2)),i.push(c+(Z+1))):(i.push(c),i.push(c+(Z+1)),i.push(c+(Z+2)))};c!==y.d.CAP_START&&c!==y.d.CAP_ALL||mh(!1),c!==y.d.CAP_END&&c!==y.d.CAP_ALL||mh(!0),n.c._ComputeSides(f,w,i,s,E,h.frontUVs,h.backUVs);const R=new n.c;return R.indices=i,R.xh=w,R.gh=s,R.ph=E,W&&(R.Hh=z),R}function i(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;const Y=new y.d(h,T);d.sideOrientation=y.d._GetDefaultSideOrientation(d.sideOrientation),Y._originalBuilderSideOrientation=d.sideOrientation;return V(d).oh(Y,d.updatable),Y}function w(h){const d=[],T=[],y=[],C=[],F=h.diameter||1,U=h.thickness||.5,Z=0|(h.tessellation||16),S=0===h.sideOrientation?0:h.sideOrientation||n.c.DEFAULTSIDE,r=Z+1;for(let n=0;n<=Z;n++){const h=n/Z,S=n*Math.PI*2/Z-Math.PI/2,c=Y.Matrix.Translation(F/2,0,0).multiply(Y.Matrix.RotationY(S));for(let F=0;F<=Z;F++){const S=1-F/Z,O=F*Math.PI*2/Z+Math.PI,f=Math.cos(O),J=Math.sin(O);let W=new Y.pd(f,J,0),L=W.scale(U/2);const D=new Y.Vector2(h,S);L=Y.pd.TransformCoordinates(L,c),W=Y.pd.TransformNormal(W,c),T.push(L.x,L.y,L.z),y.push(W.x,W.y,W.z),C.push(D.x,X.b?1-D.y:D.y);const V=(n+1)%r,i=(F+1)%r;d.push(n*r+F),d.push(n*r+i),d.push(V*r+F),d.push(n*r+i),d.push(V*r+i),d.push(V*r+F)}}n.c._ComputeSides(S,T,d,y,C,h.frontUVs,h.backUVs);const c=new n.c;return c.indices=d,c.xh=T,c.gh=y,c.ph=C,c}function s(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;const Y=new y.d(h,T);d.sideOrientation=y.d._GetDefaultSideOrientation(d.sideOrientation),Y._originalBuilderSideOrientation=d.sideOrientation;return w(d).oh(Y,d.updatable),Y}n.c.CreateCylinder=V,y.d.CreateCylinder=(h,d,T,Y,C,n,X,F,U)=>{void 0!==X&&X instanceof L.d||(void 0!==X&&(U=F||y.d.DEFAULTSIDE,F=X),X=n,n=1);return i(h,{height:d,diameterTop:T,diameterBottom:Y,tessellation:C,subdivisions:n,sideOrientation:U,updatable:F},X)};function E(h){const d=[],T=[],y=[],C=[],F=h.radius||2,U=h.tube||.5,Z=h.radialSegments||32,S=h.tubularSegments||32,r=h.p||2,c=h.q||3,O=0===h.sideOrientation?0:h.sideOrientation||n.c.DEFAULTSIDE,f=h=>{const d=Math.cos(h),T=Math.sin(h),y=c/r*h,C=Math.cos(y),n=F*(2+C)*.5*d,X=F*(2+C)*T*.5,U=F*Math.sin(y)*.5;return new Y.pd(n,X,U)};let J,W;for(J=0;J<=Z;J++){const h=J%Z/Z*2*r*Math.PI,d=f(h),y=f(h+.01),n=y.Nd(d);let F=y.add(d);const c=Y.pd.Cross(n,F);for(F=Y.pd.Cross(c,n),c.normalize(),F.normalize(),W=0;W<S;W++){const h=W%S/S*2*Math.PI,Y=-U*Math.cos(h),y=U*Math.sin(h);T.push(d.x+Y*F.x+y*c.x),T.push(d.y+Y*F.y+y*c.y),T.push(d.z+Y*F.z+y*c.z),C.push(J/Z),C.push(X.b?1-W/S:W/S)}}for(J=0;J<Z;J++)for(W=0;W<S;W++){const h=(W+1)%S,T=J*S+W,Y=(J+1)*S+W,y=(J+1)*S+h,C=J*S+h;d.push(C),d.push(Y),d.push(T),d.push(C),d.push(y),d.push(Y)}n.c.ComputeNormals(T,d,y),n.c._ComputeSides(O,T,d,y,C,h.frontUVs,h.backUVs);const L=new n.c;return L.indices=d,L.xh=T,L.gh=y,L.ph=C,L}function z(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;const Y=new y.d(h,T);d.sideOrientation=y.d._GetDefaultSideOrientation(d.sideOrientation),Y._originalBuilderSideOrientation=d.sideOrientation;return E(d).oh(Y,d.updatable),Y}n.c.CreateTorus=w,y.d.CreateTorus=(h,d,T,Y,y,C,n)=>s(h,{diameter:d,thickness:T,tessellation:Y,sideOrientation:n,updatable:C},y);n.c.CreateTorusKnot=E,y.d.CreateTorusKnot=(h,d,T,Y,y,C,n,X,F,U)=>z(h,{radius:d,tube:T,radialSegments:Y,tubularSegments:y,p:C,q:n,sideOrientation:U,updatable:F},X);var x=T(14715),g=T(13336),H=T(12963);function p(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=d.path,C=d.shape,n=d.scale||1,X=d.rotation||0,F=0===d.cap?0:d.cap||y.d.NO_CAP,U=d.updatable,Z=y.d._GetDefaultSideOrientation(d.sideOrientation),S=d.instance||null,r=d.invertUV||!1,c=d.closeShape||!1,O=d.closePath||!1,f=d.capFunction||null;return o(h,C,Y,n,X,null,null,O,c,F,!1,T,!!U,Z,S,r,d.frontUVs||null,d.backUVs||null,d.firstNormal||null,!!d.adjustFrame,f)}function k(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=d.path,C=d.shape,n=d.scaleFunction||(()=>1),X=d.rotationFunction||(()=>0),F=d.closePath||d.ribbonCloseArray||!1,U=d.closeShape||d.ribbonClosePath||!1,Z=0===d.cap?0:d.cap||y.d.NO_CAP,S=d.updatable,r=d.firstNormal||null,c=d.adjustFrame||!1,O=y.d._GetDefaultSideOrientation(d.sideOrientation),f=d.instance,J=d.invertUV||!1,W=d.capFunction||null;return o(h,C,Y,null,null,n,X,F,U,Z,!0,T,!!S,O,f||null,J,d.frontUVs||null,d.backUVs||null,r,c,W||null)}function o(h,d,T,C,n,X,F,Z,S,r,c,O,f,J,W,L,D,V,i,w,s){const E=(h,d,T,C,n,X,F,U,Z,S,r)=>{const c=T.getTangents(),O=T.getNormals(),f=T.getBinormals(),J=T.getDistances();if(r)for(let y=0;y<c.length;y++)if(0==c[y].x&&0==c[y].y&&0==c[y].z&&c[y].C(c[y-1]),0==O[y].x&&0==O[y].y&&0==O[y].z&&O[y].C(O[y-1]),0==f[y].x&&0==f[y].y&&0==f[y].z&&f[y].C(f[y-1]),y>0){let h=c[y-1];Y.pd.Dot(h,c[y])<0&&c[y].scaleInPlace(-1),h=O[y-1],Y.pd.Dot(h,O[y])<0&&O[y].scaleInPlace(-1),h=f[y-1],Y.pd.Dot(h,f[y])<0&&f[y].scaleInPlace(-1)}let W=0;const L=S&&U?U:()=>null!==X?X:0,D=S&&F?F:()=>null!==n?n:1;let V=Z===y.d.NO_CAP||Z===y.d.CAP_END?0:2;const i=Y.TmpVectors.Matrix[0];for(let y=0;y<d.length;y++){const T=[],n=L(y,J[y]),X=D(y,J[y]);Y.Matrix.RotationAxisToRef(c[y],W,i);for(let C=0;C<h.length;C++){const n=c[y].scale(h[C].z).add(O[y].scale(h[C].x)).add(f[y].scale(h[C].y)),F=Y.pd.Zero();Y.pd.TransformCoordinatesToRef(n,i,F),F.scaleInPlace(X).addInPlace(d[y]),T[C]=F}C[V]=T,W+=n,V++}const w=s||(h=>{const d=Array(),T=Y.pd.Zero();let y;for(y=0;y<h.length;y++)T.addInPlace(h[y]);for(T.scaleInPlace(1/h.length),y=0;y<h.length;y++)d.push(T);return d});switch(Z){case y.d.NO_CAP:break;case y.d.CAP_START:C[0]=w(C[2]),C[1]=C[2];break;case y.d.CAP_END:C[V]=C[V-1],C[V+1]=w(C[V-1]);break;case y.d.CAP_ALL:C[0]=w(C[2]),C[1]=C[2],C[V]=C[V-1],C[V+1]=w(C[V-1])}return C};let z,x;if(W){const h=W._creationDataStorage;return z=i?h.path3D.update(T,i):h.path3D.update(T),x=E(d,T,h.path3D,h.pathArray,C,n,X,F,h.cap,c,w),W=U("",{pathArray:x,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:W},O||void 0)}z=i?new H.j(T,i):new H.j(T);x=E(d,T,z,new Array,C,n,X,F,r=r<0||r>3?0:r,c,w);const g=U(h,{pathArray:x,closeArray:Z,closePath:S,updatable:f,sideOrientation:J,invertUV:L,frontUVs:D||void 0,backUVs:V||void 0},O);return g._creationDataStorage.pathArray=x,g._creationDataStorage.path3D=z,g._creationDataStorage.cap=r,g}function u(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=d.arc?d.arc<=0||d.arc>1?1:d.arc:1,n=void 0===d.closed||d.closed,X=d.shape,F=d.radius||1,Z=d.tessellation||64,S=d.clip||0,r=d.updatable,c=y.d._GetDefaultSideOrientation(d.sideOrientation),O=d.cap||y.d.NO_CAP,f=2*Math.PI,J=[],W=d.invertUV||!1;let L=0,D=0;const V=f/Z*C;let i,w;for(L=0;L<=Z-S;L++){for(w=[],O!=y.d.CAP_START&&O!=y.d.CAP_ALL||(w.push(new Y.pd(0,X[0].y,0)),w.push(new Y.pd(Math.cos(L*V)*X[0].x*F,X[0].y,Math.sin(L*V)*X[0].x*F))),D=0;D<X.length;D++)i=new Y.pd(Math.cos(L*V)*X[D].x*F,X[D].y,Math.sin(L*V)*X[D].x*F),w.push(i);O!=y.d.CAP_END&&O!=y.d.CAP_ALL||(w.push(new Y.pd(Math.cos(L*V)*X[X.length-1].x*F,X[X.length-1].y,Math.sin(L*V)*X[X.length-1].x*F)),w.push(new Y.pd(0,X[X.length-1].y,0))),J.push(w)}return U(h,{pathArray:J,closeArray:n,sideOrientation:c,updatable:r,invertUV:W,frontUVs:d.frontUVs,backUVs:d.backUVs},T)}y.d.ExtrudeShape=function(h,d,T,Y,C,n){let X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7?arguments[7]:void 0,U=arguments.length>8?arguments[8]:void 0,Z=arguments.length>9?arguments[9]:void 0;return p(h,{shape:d,path:T,scale:Y,rotation:C,cap:0===n?0:n||y.d.NO_CAP,sideOrientation:U,instance:Z,updatable:F},X)},y.d.ExtrudeShapeCustom=(h,d,T,Y,C,n,X,F,U,Z,S,r)=>k(h,{shape:d,path:T,scaleFunction:Y,rotationFunction:C,ribbonCloseArray:n,ribbonClosePath:X,cap:0===F?0:F||y.d.NO_CAP,sideOrientation:S,instance:r,updatable:Z},U);y.d.CreateLathe=(h,d,T,Y,y,C,n)=>u(h,{shape:d,radius:T,tessellation:Y,sideOrientation:n,updatable:C},y);var N=T(14090),K=T(14039);function l(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=d.path;let n=d.instance,X=1;void 0!==d.radius?X=d.radius:n&&(X=n._creationDataStorage.radius);const F=d.tessellation||64,Z=d.radiusFunction||null;let S=d.cap||y.d.NO_CAP;const r=d.invertUV||!1,c=d.updatable,O=y.d._GetDefaultSideOrientation(d.sideOrientation);d.arc=d.arc&&(d.arc<=0||d.arc>1)?1:d.arc||1;const f=(h,d,T,C,n,X,F,U)=>{const Z=d.getTangents(),S=d.getNormals(),r=d.getDistances(),c=2*Math.PI/n*U,O=X||(()=>C);let f,J,W,L;const D=Y.TmpVectors.Matrix[0];let V=F===y.d.NO_CAP||F===y.d.CAP_END?0:2;for(let y=0;y<h.length;y++){J=O(y,r[y]),f=Array(),W=S[y];for(let d=0;d<n;d++)Y.Matrix.RotationAxisToRef(Z[y],c*d,D),L=f[d]?f[d]:Y.pd.Zero(),Y.pd.TransformCoordinatesToRef(W,D,L),L.scaleInPlace(J).addInPlace(h[y]),f[d]=L;T[V]=f,V++}const i=(d,T)=>{const Y=Array();for(let y=0;y<d;y++)Y.push(h[T]);return Y};switch(F){case y.d.NO_CAP:break;case y.d.CAP_START:T[0]=i(n,0),T[1]=T[2].slice(0);break;case y.d.CAP_END:T[V]=T[V-1].slice(0),T[V+1]=i(n,h.length-1);break;case y.d.CAP_ALL:T[0]=i(n,0),T[1]=T[2].slice(0),T[V]=T[V-1].slice(0),T[V+1]=i(n,h.length-1)}return T};let J,W;if(n){const h=n._creationDataStorage,T=d.arc||h.arc;return J=h.path3D.update(C),W=f(C,J,h.pathArray,X,h.tessellation,Z,h.cap,T),n=U("",{pathArray:W,instance:n}),h.path3D=J,h.pathArray=W,h.arc=T,h.radius=X,n}J=new H.j(C);S=S<0||S>3?0:S,W=f(C,J,new Array,X,F,Z,S,d.arc);const L=U(h,{pathArray:W,closePath:!0,closeArray:!1,updatable:c,sideOrientation:O,invertUV:r,frontUVs:d.frontUVs,backUVs:d.backUVs},T);return L._creationDataStorage.pathArray=W,L._creationDataStorage.path3D=J,L._creationDataStorage.tessellation=F,L._creationDataStorage.cap=S,L._creationDataStorage.arc=d.arc,L._creationDataStorage.radius=X,L}function q(h){const d=[];d[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},d[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},d[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},d[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},d[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},d[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},d[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},d[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},d[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},d[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},d[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},d[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},d[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},d[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},d[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const T=h.type&&(h.type<0||h.type>=d.length)?0:h.type||0,y=h.size,C=h.sizeX||y||1,F=h.sizeY||y||1,U=h.sizeZ||y||1,Z=h.custom||d[T],S=Z.face.length,c=h.faceUV||new Array(S),O=h.faceColors,f=void 0===h.flat||h.flat,J=0===h.sideOrientation?0:h.sideOrientation||n.c.DEFAULTSIDE,W=[],L=[],D=[],V=[],i=[];let w=0,s=0;const E=[];let z,x,g,H,p,k,o=0,u=0;if(f)for(u=0;u<S;u++)O&&void 0===O[u]&&(O[u]=new r.ln(1,1,1,1)),c&&void 0===c[u]&&(c[u]=new Y.Vector4(0,0,1,1));if(f)for(u=0;u<S;u++){const h=Z.face[u].length;for(g=2*Math.PI/h,H=.5*Math.tan(g/2),p=.5,o=0;o<h;o++)W.push(Z.vertex[Z.face[u][o]][0]*C,Z.vertex[Z.face[u][o]][1]*F,Z.vertex[Z.face[u][o]][2]*U),E.push(w),w++,z=c[u].x+(c[u].z-c[u].x)*(.5+H),x=c[u].y+(c[u].w-c[u].y)*(p-.5),V.push(z,X.b?1-x:x),k=H*Math.cos(g)-p*Math.sin(g),p=H*Math.sin(g)+p*Math.cos(g),H=k,O&&i.push(O[u].r,O[u].g,O[u].b,O[u].a);for(o=0;o<h-2;o++)L.push(E[0+s],E[o+2+s],E[o+1+s]);s+=h}else{for(o=0;o<Z.vertex.length;o++)W.push(Z.vertex[o][0]*C,Z.vertex[o][1]*F,Z.vertex[o][2]*U),V.push(0,X.b?1:0);for(u=0;u<S;u++)for(o=0;o<Z.face[u].length-2;o++)L.push(Z.face[u][0],Z.face[u][o+2],Z.face[u][o+1])}n.c.ComputeNormals(W,L,D),n.c._ComputeSides(J,W,L,D,V,h.frontUVs,h.backUVs);const N=new n.c;return N.xh=W,N.indices=L,N.gh=D,N.ph=V,O&&f&&(N.Hh=i),N}function j(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=new y.d(h,T);d.sideOrientation=y.d._GetDefaultSideOrientation(d.sideOrientation),Y._originalBuilderSideOrientation=d.sideOrientation;return q(d).oh(Y,d.updatable),Y}y.d.CreateTube=(h,d,T,Y,y,C,n,X,F,U)=>l(h,{path:d,radius:T,tessellation:Y,radiusFunction:y,arc:1,cap:C,updatable:X,sideOrientation:F,instance:U},n);function a(h){const d=h.sideOrientation||n.c.DEFAULTSIDE,T=h.radius||1,y=void 0===h.flat||h.flat,C=0|(h.subdivisions||4),F=h.radiusX||T,U=h.radiusY||T,Z=h.radiusZ||T,S=(1+Math.sqrt(5))/2,r=[-1,S,-0,1,S,0,-1,-S,0,1,-S,0,0,-1,-S,0,1,-S,0,-1,S,0,1,S,S,0,1,S,0,-1,-S,0,1,-S,0,-1],c=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],O=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],f=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],J=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],W=[],L=[],D=[],V=[];let i=0;const w=new Array(3),s=new Array(3);let E;for(E=0;E<3;E++)w[E]=Y.pd.Zero(),s[E]=Y.Vector2.Zero();for(let n=0;n<20;n++){for(E=0;E<3;E++){const h=c[3*n+E];w[E].ny(r[3*O[h]],r[3*O[h]+1],r[3*O[h]+2]),w[E].normalize(),s[E].ny(.134765625*f[2*h]+.05859375+-.0390625*J[n],.2333984375*f[2*h+1]+.025390625+.01953125*J[n])}const h=(h,d,T,n)=>{const S=Y.pd.Lerp(w[0],w[2],d/C),r=Y.pd.Lerp(w[1],w[2],d/C),c=C===d?w[2]:Y.pd.Lerp(S,r,h/(C-d));let O;if(c.normalize(),y){const h=Y.pd.Lerp(w[0],w[2],n/C),d=Y.pd.Lerp(w[1],w[2],n/C);O=Y.pd.Lerp(h,d,T/(C-n))}else O=new Y.pd(c.x,c.y,c.z);O.x/=F,O.y/=U,O.z/=Z,O.normalize();const f=Y.Vector2.Lerp(s[0],s[2],d/C),J=Y.Vector2.Lerp(s[1],s[2],d/C),E=C===d?s[2]:Y.Vector2.Lerp(f,J,h/(C-d));L.push(c.x*F,c.y*U,c.z*Z),D.push(O.x,O.y,O.z),V.push(E.x,X.b?1-E.y:E.y),W.push(i),i++};for(let d=0;d<C;d++)for(let T=0;T+d<C;T++)h(T,d,T+1/3,d+1/3),h(T+1,d,T+1/3,d+1/3),h(T,d+1,T+1/3,d+1/3),T+d+1<C&&(h(T+1,d,T+2/3,d+2/3),h(T+1,d+1,T+2/3,d+2/3),h(T,d+1,T+2/3,d+2/3))}n.c._ComputeSides(d,L,W,D,V,h.frontUVs,h.backUVs);const z=new n.c;return z.indices=W,z.xh=L,z.gh=D,z.ph=V,z}function e(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=new y.d(h,T);d.sideOrientation=y.d._GetDefaultSideOrientation(d.sideOrientation),Y._originalBuilderSideOrientation=d.sideOrientation;return a(d).oh(Y,d.updatable),Y}n.c.CreatePolyhedron=q,y.d.CreatePolyhedron=(h,d,T)=>j(h,d,T);n.c.CreateIcoSphere=a,y.d.CreateIcoSphere=(h,d,T)=>e(h,d,T);var v=T(12787);const G=new Y.pd(1,0,0),b=new Y.pd(-1,0,0),B=new Y.pd(0,1,0),M=new Y.pd(0,-1,0),mh=new Y.pd(0,0,1),R=new Y.pd(0,0,-1);class Q{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y.pd.Zero(),d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Y.pd.Up(),T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.Vector2.Zero(),y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=h,this.normal=d,this.uv=T,this.vertexIdx=y,this.vertexIdxForBones=C,this.localPositionOverride=n,this.localNormalOverride=X,this.matrixIndicesOverride=F,this.matrixWeightsOverride=U}clone(){var h,d,T,Y;return new Q(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(h=this.localPositionOverride)||void 0===h?void 0:h.slice(),null===(d=this.localNormalOverride)||void 0===d?void 0:d.slice(),null===(T=this.matrixIndicesOverride)||void 0===T?void 0:T.slice(),null===(Y=this.matrixWeightsOverride)||void 0===Y?void 0:Y.slice())}}function I(h,d,T){var F,U,Z,S,r;const c=!!d.skeleton,O=!(null===(F=d.morphTargetManager)||void 0===F||!F.numTargets),f=T.localMode||c,J=d.Pd(),W=c||O?d.IX(!0,!0):d.getVerticesData(C.g.PositionKind),L=c||O?d.getNormalsData(!0,!0):d.getVerticesData(C.g.NormalKind),D=f?c?d.getVerticesData(C.g.PositionKind):W:null,V=f?c?d.getVerticesData(C.g.NormalKind):L:null,i=d.getVerticesData(C.g.UVKind),w=c?d.getVerticesData(C.g.MatricesIndicesKind):null,s=c?d.getVerticesData(C.g.MatricesWeightsKind):null,E=c?d.getVerticesData(C.g.MatricesIndicesExtraKind):null,z=c?d.getVerticesData(C.g.MatricesWeightsExtraKind):null,x=T.position||Y.pd.Zero();let g=T.normal||Y.pd.Up();const H=T.size||Y.pd.One(),p=T.angle||0;if(!g){const h=new Y.pd(0,0,1),T=d.Eh().activeCamera,y=Y.pd.TransformCoordinates(h,T.getWorldMatrix());g=T.globalPosition.Nd(y)}const k=-Math.atan2(g.z,g.x)-Math.PI/2,o=Math.sqrt(g.x*g.x+g.z*g.z),u=Math.atan2(g.y,o),N=new n.c;N.indices=[],N.xh=[],N.gh=[],N.ph=[],N.matricesIndices=c?[]:null,N.matricesWeights=c?[]:null,N.matricesIndicesExtra=E?[]:null,N.matricesWeightsExtra=z?[]:null;let K=0;const l=(h,d)=>{const y=new Q;if(!J||!W||!L)return y;const C=J[h];if(y.vertexIdx=3*C,y.vertexIdxForBones=4*C,y.position=new Y.pd(W[3*C],W[3*C+1],W[3*C+2]),Y.pd.TransformCoordinatesToRef(y.position,d,y.position),y.normal=new Y.pd(L[3*C],L[3*C+1],L[3*C+2]),Y.pd.TransformNormalToRef(y.normal,d,y.normal),T.captureUVS&&i){const h=i[2*C+1];y.uv=new Y.Vector2(i[2*C],X.b?1-h:h)}return y},q=[0,0,0,0],j=(h,d)=>{if(0===h.length)return h;const T=.5*Math.abs(Y.pd.Dot(H,d)),y=(h,d,T,Y)=>{for(let y=0;y<Y;++y)if(h[T+y]===d)return T+y;return-1},C=(h,C)=>{const n=Y.pd.GetClipFactor(h.position,C.position,d,T);let X=q,F=q;if(w&&s){const d=h.matrixIndicesOverride?0:h.vertexIdxForBones,T=h.matrixIndicesOverride??w,Y=h.matrixWeightsOverride??s,U=C.matrixIndicesOverride?0:C.vertexIdxForBones,Z=C.matrixIndicesOverride??w,S=C.matrixWeightsOverride??s;X=[0,0,0,0],F=[0,0,0,0];let r=0;for(let h=0;h<4;++h)if(Y[d+h]>0){const C=y(Z,T[d+h],U,4);X[r]=T[d+h],F[r]=(0,v.Lerp)(Y[d+h],C>=0?S[C]:0,n),r++}for(let h=0;h<4&&r<4;++h){const Y=Z[U+h];-1===y(T,Y,d,4)&&(X[r]=Y,F[r]=(0,v.Lerp)(0,S[U+h],n),r++)}const c=F[0]+F[1]+F[2]+F[3];F[0]/=c,F[1]/=c,F[2]/=c,F[3]/=c}const U=h.localPositionOverride?h.localPositionOverride[0]:(null===D||void 0===D?void 0:D[h.vertexIdx])??0,Z=h.localPositionOverride?h.localPositionOverride[1]:(null===D||void 0===D?void 0:D[h.vertexIdx+1])??0,S=h.localPositionOverride?h.localPositionOverride[2]:(null===D||void 0===D?void 0:D[h.vertexIdx+2])??0,r=C.localPositionOverride?C.localPositionOverride[0]:(null===D||void 0===D?void 0:D[C.vertexIdx])??0,c=C.localPositionOverride?C.localPositionOverride[1]:(null===D||void 0===D?void 0:D[C.vertexIdx+1])??0,O=C.localPositionOverride?C.localPositionOverride[2]:(null===D||void 0===D?void 0:D[C.vertexIdx+2])??0,f=h.localNormalOverride?h.localNormalOverride[0]:(null===V||void 0===V?void 0:V[h.vertexIdx])??0,J=h.localNormalOverride?h.localNormalOverride[1]:(null===V||void 0===V?void 0:V[h.vertexIdx+1])??0,W=h.localNormalOverride?h.localNormalOverride[2]:(null===V||void 0===V?void 0:V[h.vertexIdx+2])??0,L=f+((C.localNormalOverride?C.localNormalOverride[0]:(null===V||void 0===V?void 0:V[C.vertexIdx])??0)-f)*n,i=J+((C.localNormalOverride?C.localNormalOverride[1]:(null===V||void 0===V?void 0:V[C.vertexIdx+1])??0)-J)*n,E=W+((C.localNormalOverride?C.localNormalOverride[2]:(null===V||void 0===V?void 0:V[C.vertexIdx+2])??0)-W)*n,z=Math.sqrt(L*L+i*i+E*E);return new Q(Y.pd.Lerp(h.position,C.position,n),Y.pd.Lerp(h.normal,C.normal,n).normalize(),Y.Vector2.Lerp(h.uv,C.uv,n),-1,-1,D?[U+(r-U)*n,Z+(c-Z)*n,S+(O-S)*n]:null,V?[L/z,i/z,E/z]:null,X,F)};let n=null;h.length>3&&(n=[]);for(let X=0;X<h.length;X+=3){let y=0,F=null,U=null,Z=null,S=null;const r=Y.pd.Dot(h[X].position,d)-T>0,c=Y.pd.Dot(h[X+1].position,d)-T>0,O=Y.pd.Dot(h[X+2].position,d)-T>0;switch(y=(r?1:0)+(c?1:0)+(O?1:0),y){case 0:h.length>3?(n.push(h[X]),n.push(h[X+1]),n.push(h[X+2])):n=h;break;case 1:if(n=n??new Array,r&&(F=h[X+1],U=h[X+2],Z=C(h[X],F),S=C(h[X],U)),c){F=h[X],U=h[X+2],Z=C(h[X+1],F),S=C(h[X+1],U),n.push(Z),n.push(U.clone()),n.push(F.clone()),n.push(U.clone()),n.push(Z.clone()),n.push(S);break}O&&(F=h[X],U=h[X+1],Z=C(h[X+2],F),S=C(h[X+2],U)),F&&U&&Z&&S&&(n.push(F.clone()),n.push(U.clone()),n.push(Z),n.push(S),n.push(Z.clone()),n.push(U.clone()));break;case 2:n=n??new Array,r||(F=h[X].clone(),U=C(F,h[X+1]),Z=C(F,h[X+2]),n.push(F),n.push(U),n.push(Z)),c||(F=h[X+1].clone(),U=C(F,h[X+2]),Z=C(F,h[X]),n.push(F),n.push(U),n.push(Z)),O||(F=h[X+2].clone(),U=C(F,h[X]),Z=C(F,h[X+1]),n.push(F),n.push(U),n.push(Z))}}return n},a=d instanceof y.d?d:null,e=null===a||void 0===a?void 0:a._thinInstanceDataStorage.matrixData,I=(null===a||void 0===a?void 0:a.jX)||1,A=Y.TmpVectors.Matrix[0];A.C(Y.Matrix.IdentityReadOnly);for(let y=0;y<I;++y){if(null!==a&&void 0!==a&&a.hasThinInstances&&e){const h=16*y;A.setRowFromFloats(0,e[h+0],e[h+1],e[h+2],e[h+3]),A.setRowFromFloats(1,e[h+4],e[h+5],e[h+6],e[h+7]),A.setRowFromFloats(2,e[h+8],e[h+9],e[h+10],e[h+11]),A.setRowFromFloats(3,e[h+12],e[h+13],e[h+14],e[h+15])}const h=Y.Matrix.RotationYawPitchRoll(k,u,p).multiply(Y.Matrix.Translation(x.x,x.y,x.z)),C=Y.Matrix.Invert(h),n=d.getWorldMatrix(),F=A.multiply(n).multiply(C),U=new Array(3);for(let d=0;d<J.length;d+=3){let h=U;if(h[0]=l(d,F),h[1]=l(d+1,F),h[2]=l(d+2,F),!(T.cullBackFaces&&-h[0].normal.z<=0&&-h[1].normal.z<=0&&-h[2].normal.z<=0)&&(h=j(h,G),h&&(h=j(h,b),h&&(h=j(h,B),h&&(h=j(h,M),h&&(h=j(h,mh),h&&(h=j(h,R),h)))))))for(let d=0;d<h.length;d++){const Y=h[d];if(N.indices.push(K),f?(Y.localPositionOverride?(N.xh[3*K]=Y.localPositionOverride[0],N.xh[3*K+1]=Y.localPositionOverride[1],N.xh[3*K+2]=Y.localPositionOverride[2]):D&&(N.xh[3*K]=D[Y.vertexIdx],N.xh[3*K+1]=D[Y.vertexIdx+1],N.xh[3*K+2]=D[Y.vertexIdx+2]),Y.localNormalOverride?(N.gh[3*K]=Y.localNormalOverride[0],N.gh[3*K+1]=Y.localNormalOverride[1],N.gh[3*K+2]=Y.localNormalOverride[2]):V&&(N.gh[3*K]=V[Y.vertexIdx],N.gh[3*K+1]=V[Y.vertexIdx+1],N.gh[3*K+2]=V[Y.vertexIdx+2])):(Y.position.toArray(N.xh,3*K),Y.normal.toArray(N.gh,3*K)),N.matricesIndices&&N.matricesWeights&&(Y.matrixIndicesOverride?(N.matricesIndices[4*K]=Y.matrixIndicesOverride[0],N.matricesIndices[4*K+1]=Y.matrixIndicesOverride[1],N.matricesIndices[4*K+2]=Y.matrixIndicesOverride[2],N.matricesIndices[4*K+3]=Y.matrixIndicesOverride[3]):(w&&(N.matricesIndices[4*K]=w[Y.vertexIdxForBones],N.matricesIndices[4*K+1]=w[Y.vertexIdxForBones+1],N.matricesIndices[4*K+2]=w[Y.vertexIdxForBones+2],N.matricesIndices[4*K+3]=w[Y.vertexIdxForBones+3]),E&&N.matricesIndicesExtra&&(N.matricesIndicesExtra[4*K]=E[Y.vertexIdxForBones],N.matricesIndicesExtra[4*K+1]=E[Y.vertexIdxForBones+1],N.matricesIndicesExtra[4*K+2]=E[Y.vertexIdxForBones+2],N.matricesIndicesExtra[4*K+3]=E[Y.vertexIdxForBones+3])),Y.matrixWeightsOverride?(N.matricesWeights[4*K]=Y.matrixWeightsOverride[0],N.matricesWeights[4*K+1]=Y.matrixWeightsOverride[1],N.matricesWeights[4*K+2]=Y.matrixWeightsOverride[2],N.matricesWeights[4*K+3]=Y.matrixWeightsOverride[3]):(s&&(N.matricesWeights[4*K]=s[Y.vertexIdxForBones],N.matricesWeights[4*K+1]=s[Y.vertexIdxForBones+1],N.matricesWeights[4*K+2]=s[Y.vertexIdxForBones+2],N.matricesWeights[4*K+3]=s[Y.vertexIdxForBones+3]),z&&N.matricesWeightsExtra&&(N.matricesWeightsExtra[4*K]=z[Y.vertexIdxForBones],N.matricesWeightsExtra[4*K+1]=z[Y.vertexIdxForBones+1],N.matricesWeightsExtra[4*K+2]=z[Y.vertexIdxForBones+2],N.matricesWeightsExtra[4*K+3]=z[Y.vertexIdxForBones+3]))),T.captureUVS)Y.uv.toArray(N.ph,2*K);else{N.ph.push(.5+Y.position.x/H.x);const h=.5+Y.position.y/H.y;N.ph.push(X.b?1-h:h)}K++}}}0===N.indices.length&&(N.indices=null),0===N.xh.length&&(N.xh=null),0===N.gh.length&&(N.gh=null),0===N.ph.length&&(N.ph=null),0===(null===(U=N.matricesIndices)||void 0===U?void 0:U.length)&&(N.matricesIndices=null),0===(null===(Z=N.matricesWeights)||void 0===Z?void 0:Z.length)&&(N.matricesWeights=null),0===(null===(S=N.matricesIndicesExtra)||void 0===S?void 0:S.length)&&(N.matricesIndicesExtra=null),0===(null===(r=N.matricesWeightsExtra)||void 0===r?void 0:r.length)&&(N.matricesWeightsExtra=null);const P=new y.d(h,d.Eh());return N.oh(P),f?(P.skeleton=d.skeleton,P.parent=d):(P.position=x.clone(),P.rotation=new Y.pd(u,k,p)),P.Md(!0),P.refreshBoundingInfo(!0,!0),P}function A(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const d=0|Math.max(h.subdivisions?h.subdivisions:2,1),T=0|Math.max(h.tessellation?h.tessellation:16,3),y=Math.max(h.height?h.height:1,0),C=Math.max(h.radius?h.radius:.25,0),F=0|Math.max(h.capSubdivisions?h.capSubdivisions:6,1),U=T,Z=d,S=Math.max(h.radiusTop?h.radiusTop:C,0),r=Math.max(h.radiusBottom?h.radiusBottom:C,0),c=y-(S+r),O=2*Math.PI,f=Math.max(h.topCapSubdivisions?h.topCapSubdivisions:F,1),J=Math.max(h.bottomCapSubdivisions?h.bottomCapSubdivisions:F,1),W=Math.acos((r-S)/y);let L=[];const D=[],V=[],i=[];let w=0;const s=[],E=.5*c,z=.5*Math.PI;let x,g;const H=Y.pd.Zero(),p=Y.pd.Zero(),k=Math.cos(W),o=Math.sin(W),u=new Y.Vector2(S*o,E+S*k).Nd(new Y.Vector2(r*o,r*k-E)).length(),N=S*W+u+r*(z-W);let K=0;for(g=0;g<=f;g++){const h=[],d=z-W*(g/f);K+=S*W/f;const T=Math.cos(d),Y=Math.sin(d),y=T*S;for(x=0;x<=U;x++){const d=x/U,C=d*O+0,n=Math.sin(C),F=Math.cos(C);p.x=y*n,p.y=E+Y*S,p.z=y*F,D.push(p.x,p.y,p.z),H.set(T*n,Y,T*F),V.push(H.x,H.y,H.z),i.push(d,X.b?K/N:1-K/N),h.push(w),w++}s.push(h)}const l=y-S-r+k*S-k*r,q=o*(r-S)/l;for(g=1;g<=Z;g++){const h=[];K+=u/Z;const d=o*(g*(r-S)/Z+S);for(x=0;x<=U;x++){const T=x/U,Y=T*O+0,y=Math.sin(Y),C=Math.cos(Y);p.x=d*y,p.y=E+k*S-g*l/Z,p.z=d*C,D.push(p.x,p.y,p.z),H.set(y,q,C).normalize(),V.push(H.x,H.y,H.z),i.push(T,X.b?K/N:1-K/N),h.push(w),w++}s.push(h)}for(g=1;g<=J;g++){const h=[],d=z-W-(Math.PI-W)*(g/J);K+=r*W/J;const T=Math.cos(d),Y=Math.sin(d),y=T*r;for(x=0;x<=U;x++){const d=x/U,C=d*O+0,n=Math.sin(C),F=Math.cos(C);p.x=y*n,p.y=Y*r-E,p.z=y*F,D.push(p.x,p.y,p.z),H.set(T*n,Y,T*F),V.push(H.x,H.y,H.z),i.push(d,X.b?K/N:1-K/N),h.push(w),w++}s.push(h)}for(x=0;x<U;x++)for(g=0;g<f+Z+J;g++){const h=s[g][x],d=s[g+1][x],T=s[g+1][x+1],Y=s[g][x+1];L.push(h),L.push(d),L.push(Y),L.push(d),L.push(T),L.push(Y)}if(L=L.reverse(),h.orientation&&!h.orientation.equals(Y.pd.Up())){const d=new Y.Matrix;h.orientation.clone().scale(.5*Math.PI).cross(Y.pd.Up()).toQuaternion().toRotationMatrix(d);const T=Y.pd.Zero();for(let h=0;h<D.length;h+=3)T.set(D[h],D[h+1],D[h+2]),Y.pd.TransformCoordinatesToRef(T.clone(),d,T),D[h]=T.x,D[h+1]=T.y,D[h+2]=T.z}const j=new n.c;return j.xh=D,j.gh=V,j.ph=i,j.indices=L,j}function P(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:Y.pd.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new y.d(h,T);return A(d).oh(C,d.updatable),C}y.d.CreateDecal=(h,d,T,Y,y,C)=>I(h,d,{position:T,normal:Y,size:y,angle:C});y.d.CreateCapsule=(h,d,T)=>P(h,d,T),n.c.CreateCapsule=A;var t=T(12596),hh=T(12772);class dh{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=h,this.y=d,h!==Math.floor(h)&&(h=Math.floor(h),t.c.Warn("x is not an integer, floor(x) used")),d!==Math.floor(d)&&(d=Math.floor(d),t.c.Warn("y is not an integer, floor(y) used"))}clone(){return new dh(this.x,this.y)}rotate60About(h){const d=this.x;return this.x=h.x+h.y-this.y,this.y=d+this.y-h.x,this}rotateNeg60About(h){const d=this.x;return this.x=d+this.y-h.y,this.y=h.x+h.y-d,this}rotate120(h,d){h!==Math.floor(h)&&(h=Math.floor(h),t.c.Warn("m not an integer only floor(m) used")),d!==Math.floor(d)&&(d=Math.floor(d),t.c.Warn("n not an integer only floor(n) used"));const T=this.x;return this.x=h-T-this.y,this.y=d+T,this}rotateNeg120(h,d){h!==Math.floor(h)&&(h=Math.floor(h),t.c.Warn("m is not an integer, floor(m) used")),d!==Math.floor(d)&&(d=Math.floor(d),t.c.Warn("n is not an integer,   floor(n) used"));const T=this.x;return this.x=this.y-d,this.y=h+d-T-this.y,this}toCartesianOrigin(h,d){const T=Y.pd.Zero();return T.x=h.x+2*this.x*d+this.y*d,T.y=h.y+Math.sqrt(3)*this.y*d,T}static Zero(){return new dh(0,0)}}class Th{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Yh("icosahedron","Regular",[[0,hh.f,-1],[-hh.f,1,0],[-1,0,-hh.f],[1,0,-hh.f],[hh.f,1,0],[0,hh.f,1],[-1,0,hh.f],[-hh.f,-1,0],[0,-hh.f,-1],[hh.f,-1,0],[1,0,hh.f],[0,-hh.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let h=12;const d={},T=this.m,Y=this.n;let y,C,n,X,F,U=T,Z=1,S=0;0!==Y&&(U=(0,v.HighestCommonFactor)(T,Y)),Z=T/U,S=Y/U;const r=dh.Zero(),c=new dh(T,Y),O=new dh(-Y,T+Y),f=dh.Zero(),J=dh.Zero(),W=dh.Zero();let L,D,V,i,w=[];const s=[],E=this.vertByDist,z=(T,Y,y,C)=>{L=T+"|"+y,D=Y+"|"+C,L in d||D in d?L in d&&!(D in d)?d[D]=d[L]:D in d&&!(L in d)&&(d[L]=d[D]):(d[L]=h,d[D]=h,h++),E[y][0]>2?s[d[L]]=[-E[y][0],E[y][1],d[L]]:s[d[L]]=[w[E[y][0]],E[y][1],d[L]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let x=0;x<20;x++){if(w=this.IDATA.face[x],n=w[2],X=w[1],F=w[0],V=r.x+"|"+r.y,L=x+"|"+V,L in d||(d[L]=n,s[n]=[w[E[V][0]],E[V][1]]),V=c.x+"|"+c.y,L=x+"|"+V,L in d||(d[L]=X,s[X]=[w[E[V][0]],E[V][1]]),V=O.x+"|"+O.y,L=x+"|"+V,L in d||(d[L]=F,s[F]=[w[E[V][0]],E[V][1]]),y=this.IDATA.edgematch[x][0],C=this.IDATA.edgematch[x][1],"B"===C)for(let h=1;h<U;h++)J.x=T-h*(Z+S),J.y=Y+h*Z,W.x=-h*S,W.y=h*(Z+S),V=J.x+"|"+J.y,i=W.x+"|"+W.y,z(x,y,V,i);if("O"===C)for(let h=1;h<U;h++)W.x=-h*S,W.y=h*(Z+S),f.x=h*Z,f.y=h*S,V=W.x+"|"+W.y,i=f.x+"|"+f.y,z(x,y,V,i);if(y=this.IDATA.edgematch[x][2],C=this.IDATA.edgematch[x][3],C&&"A"===C)for(let h=1;h<U;h++)f.x=h*Z,f.y=h*S,J.x=T-(U-h)*(Z+S),J.y=Y+(U-h)*Z,V=f.x+"|"+f.y,i=J.x+"|"+J.y,z(x,y,V,i);for(let T=0;T<this.vertices.length;T++)V=this.vertices[T].x+"|"+this.vertices[T].y,L=x+"|"+V,L in d||(d[L]=h++,E[V][0]>2?s[d[L]]=[-E[V][0],E[V][1],d[L]]:s[d[L]]=[w[E[V][0]],E[V][1],d[L]])}this.closestTo=s,this.vecToidx=d}calcCoeffs(){const h=this.m,d=this.n,T=Math.sqrt(3)/3,Y=h*h+d*d+h*d;this.coau=(h+d)/Y,this.cobu=-d/Y,this.coav=-T*(h-d)/Y,this.cobv=T*(2*h+d)/Y}createInnerFacets(){const h=this.m,d=this.n;for(let T=0;T<d+h+1;T++)for(let h=this.min[T];h<this.max[T]+1;h++)h<this.max[T]&&h<this.max[T+1]+1&&this.innerFacets.push(["|"+h+"|"+T,"|"+h+"|"+(T+1),"|"+(h+1)+"|"+T]),T>0&&h<this.max[T-1]&&h+1<this.max[T]+1&&this.innerFacets.push(["|"+h+"|"+T,"|"+(h+1)+"|"+T,"|"+(h+1)+"|"+(T-1)])}edgeVecsABOB(){const h=this.m,d=this.n,T=new dh(-d,h+d);for(let Y=1;Y<h+d;Y++){const h=new dh(this.min[Y],Y),d=new dh(this.min[Y-1],Y-1),y=new dh(this.min[Y+1],Y+1),C=h.clone(),n=d.clone(),X=y.clone();C.rotate60About(T),n.rotate60About(T),X.rotate60About(T);const F=new dh(this.max[C.y],C.y),U=new dh(this.max[C.y-1],C.y-1),Z=new dh(this.max[C.y-1]-1,C.y-1);C.x===F.x&&C.y===F.y||(C.x!==U.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([h,U,Z]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([h,Z,F])):C.y===X.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([h,d,U]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([h,U,y])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([h,d,U]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([h,U,F])))}}mapABOBtoOBOA(){const h=new dh(0,0);for(let d=0;d<this.isoVecsABOB.length;d++){const T=[];for(let Y=0;Y<3;Y++)h.x=this.isoVecsABOB[d][Y].x,h.y=this.isoVecsABOB[d][Y].y,0===this.vertexTypes[d][Y]&&h.rotateNeg120(this.m,this.n),T.push(h.clone());this.isoVecsOBOA.push(T)}}mapABOBtoBAOA(){const h=new dh(0,0);for(let d=0;d<this.isoVecsABOB.length;d++){const T=[];for(let Y=0;Y<3;Y++)h.x=this.isoVecsABOB[d][Y].x,h.y=this.isoVecsABOB[d][Y].y,1===this.vertexTypes[d][Y]&&h.rotate120(this.m,this.n),T.push(h.clone());this.isoVecsBAOA.push(T)}}MapToFace(h,d){const T=this.IDATA.face[h],y=T[2],C=T[1],n=T[0],X=Y.pd.Bd(this.IDATA.vertex[y]),F=Y.pd.Bd(this.IDATA.vertex[C]),U=Y.pd.Bd(this.IDATA.vertex[n]),Z=F.Nd(X),S=U.Nd(X),r=Z.scale(this.coau).add(S.scale(this.cobu)),c=Z.scale(this.coav).add(S.scale(this.cobv)),O=[];let f,J=Y.TmpVectors.pd[0];for(let Y=0;Y<this.cartesian.length;Y++)J=r.scale(this.cartesian[Y].x).add(c.scale(this.cartesian[Y].y)).add(X),O[Y]=[J.x,J.y,J.z],f=h+"|"+this.vertices[Y].x+"|"+this.vertices[Y].y,d.vertex[this.vecToidx[f]]=[J.x,J.y,J.z]}build(h,d){const T=[],Y=dh.Zero(),y=new dh(h,d),C=new dh(-d,h+d);T.push(Y,y,C);for(let V=d;V<h+1;V++)for(let d=0;d<h+1-V;d++)T.push(new dh(d,V));if(d>0){const Y=(0,v.HighestCommonFactor)(h,d),y=h/Y,C=d/Y;for(let X=1;X<Y;X++)T.push(new dh(X*y,X*C)),T.push(new dh(-X*C,X*(y+C))),T.push(new dh(h-X*(y+C),d+X*y));const n=h/d;for(let X=1;X<d;X++)for(let Y=0;Y<X*n;Y++)T.push(new dh(Y,X)),T.push(new dh(Y,X).rotate120(h,d)),T.push(new dh(Y,X).rotateNeg120(h,d))}T.sort(((h,d)=>h.x-d.x)),T.sort(((h,d)=>h.y-d.y));const n=new Array(h+d+1),X=new Array(h+d+1);for(let V=0;V<n.length;V++)n[V]=1/0,X[V]=-1/0;let F=0,U=0;const Z=T.length;for(let V=0;V<Z;V++)U=T[V].x,F=T[V].y,n[F]=Math.min(U,n[F]),X[F]=Math.max(U,X[F]);const S=(T,Y)=>{const y=T.clone();return"A"===Y&&y.rotateNeg120(h,d),"B"===Y&&y.rotate120(h,d),y.x<0?y.y:y.x+y.y},r=[],c=[],O=[],f=[],J={},W=[];let L=-1,D=-1;for(let V=0;V<Z;V++)r[V]=T[V].toCartesianOrigin(new dh(0,0),.5),c[V]=S(T[V],"O"),O[V]=S(T[V],"A"),f[V]=S(T[V],"B"),c[V]===O[V]&&O[V]===f[V]?(L=3,D=c[V]):c[V]===O[V]?(L=4,D=c[V]):O[V]===f[V]?(L=5,D=O[V]):f[V]===c[V]&&(L=6,D=c[V]),c[V]<O[V]&&c[V]<f[V]&&(L=2,D=c[V]),O[V]<c[V]&&O[V]<f[V]&&(L=1,D=O[V]),f[V]<O[V]&&f[V]<c[V]&&(L=0,D=f[V]),W.push([L,D,T[V].x,T[V].y]);W.sort(((h,d)=>h[2]-d[2])),W.sort(((h,d)=>h[3]-d[3])),W.sort(((h,d)=>h[1]-d[1])),W.sort(((h,d)=>h[0]-d[0]));for(let V=0;V<W.length;V++)J[W[V][2]+"|"+W[V][3]]=[W[V][0],W[V][1],V];return this.m=h,this.n=d,this.vertices=T,this.vertByDist=J,this.cartesian=r,this.min=n,this.max=X,this}}class Yh{constructor(h,d,T,Y){this.name=h,this.category=d,this.vertex=T,this.face=Y}}class yh extends Yh{innerToData(h,d){for(let T=0;T<d.innerFacets.length;T++)this.face.push(d.innerFacets[T].map((T=>d.vecToidx[h+T])))}mapABOBtoDATA(h,d){const T=d.IDATA.edgematch[h][0];for(let Y=0;Y<d.isoVecsABOB.length;Y++){const y=[];for(let C=0;C<3;C++)0===d.vertexTypes[Y][C]?y.push(h+"|"+d.isoVecsABOB[Y][C].x+"|"+d.isoVecsABOB[Y][C].y):y.push(T+"|"+d.isoVecsABOB[Y][C].x+"|"+d.isoVecsABOB[Y][C].y);this.face.push([d.vecToidx[y[0]],d.vecToidx[y[1]],d.vecToidx[y[2]]])}}mapOBOAtoDATA(h,d){const T=d.IDATA.edgematch[h][0];for(let Y=0;Y<d.isoVecsOBOA.length;Y++){const y=[];for(let C=0;C<3;C++)1===d.vertexTypes[Y][C]?y.push(h+"|"+d.isoVecsOBOA[Y][C].x+"|"+d.isoVecsOBOA[Y][C].y):y.push(T+"|"+d.isoVecsOBOA[Y][C].x+"|"+d.isoVecsOBOA[Y][C].y);this.face.push([d.vecToidx[y[0]],d.vecToidx[y[1]],d.vecToidx[y[2]]])}}mapBAOAtoDATA(h,d){const T=d.IDATA.edgematch[h][2];for(let Y=0;Y<d.isoVecsBAOA.length;Y++){const y=[];for(let C=0;C<3;C++)1===d.vertexTypes[Y][C]?y.push(h+"|"+d.isoVecsBAOA[Y][C].x+"|"+d.isoVecsBAOA[Y][C].y):y.push(T+"|"+d.isoVecsBAOA[Y][C].x+"|"+d.isoVecsBAOA[Y][C].y);this.face.push([d.vecToidx[y[0]],d.vecToidx[y[1]],d.vecToidx[y[2]]])}}orderData(h){const d=[];for(let C=0;C<13;C++)d[C]=[];const T=h.closestTo;for(let C=0;C<T.length;C++)T[C][0]>-1?T[C][1]>0&&d[T[C][0]].push([C,T[C][1]]):d[12].push([C,T[C][0]]);const Y=[];for(let C=0;C<12;C++)Y[C]=C;let y=12;for(let C=0;C<12;C++){d[C].sort(((h,d)=>h[1]-d[1]));for(let h=0;h<d[C].length;h++)Y[d[C][h][0]]=y++}for(let C=0;C<d[12].length;C++)Y[d[12][C][0]]=y++;for(let C=0;C<this.vertex.length;C++)this.vertex[C].push(Y[C]);this.vertex.sort(((h,d)=>h[3]-d[3]));for(let C=0;C<this.vertex.length;C++)this.vertex[C].pop();for(let C=0;C<this.face.length;C++)for(let h=0;h<this.face[C].length;h++)this.face[C][h]=Y[this.face[C][h]];this.sharedNodes=d[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(h,d){const T=[],Y=[];let y=d.pop();Y.push(y);let C=this.face[y].indexOf(h);C=(C+2)%3;let n=this.face[y][C];T.push(n);let X=0;for(;d.length>0;)y=d[X],this.face[y].indexOf(n)>-1?(C=(this.face[y].indexOf(n)+1)%3,n=this.face[y][C],T.push(n),Y.push(y),d.splice(X,1),X=0):X++;return this.adjacentFaces.push(T),Y}toGoldbergPolyhedronData(){const h=new Yh("GeoDual","Goldberg",[],[]);h.name="GD dual";const d=this.vertex.length,T=new Array(d);for(let F=0;F<d;F++)T[F]=[];for(let F=0;F<this.face.length;F++)for(let h=0;h<3;h++)T[this.face[F][h]].push(F);let Y=0,y=0,C=0,n=[],X=[];this.adjacentFaces=[];for(let F=0;F<T.length;F++){h.face[F]=this.setOrder(F,T[F].concat([]));for(const d of T[F]){Y=0,y=0,C=0,n=this.face[d];for(let h=0;h<3;h++)X=this.vertex[n[h]],Y+=X[0],y+=X[1],C+=X[2];h.vertex[d]=[Y/3,y/3,C/3]}}return h}static BuildGeodesicData(h){const d=new yh("Geodesic-m-n","Geodesic",[[0,hh.f,-1],[-hh.f,1,0],[-1,0,-hh.f],[1,0,-hh.f],[hh.f,1,0],[0,hh.f,1],[-1,0,hh.f],[-hh.f,-1,0],[0,-hh.f,-1],[hh.f,-1,0],[1,0,hh.f],[0,-hh.f,1]],[]);h.setIndices(),h.calcCoeffs(),h.createInnerFacets(),h.edgeVecsABOB(),h.mapABOBtoOBOA(),h.mapABOBtoBAOA();for(let T=0;T<h.IDATA.face.length;T++)h.MapToFace(T,d),d.innerToData(T,h),"B"===h.IDATA.edgematch[T][1]&&d.mapABOBtoDATA(T,h),"O"===h.IDATA.edgematch[T][1]&&d.mapOBOAtoDATA(T,h),"A"===h.IDATA.edgematch[T][3]&&d.mapBAOAtoDATA(T,h);d.orderData(h);return d.vertex=d.vertex.map((function(h){const d=h[0],T=h[1],Y=h[2],y=Math.sqrt(d*d+T*T+Y*Y);return h[0]*=1/y,h[1]*=1/y,h[2]*=1/y,h})),d}}y.d._GoldbergMeshParser=(h,d)=>Ch.Parse(h,d);class Ch extends y.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(h,d){return void 0===d?(h>this.goldbergData.nbUnsharedFaces-1&&(t.c.Warn("Maximum number of unshared faces used"),h=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+h):(h>11&&(t.c.Warn("Last pole used"),h=11),d>this.goldbergData.nbFacesAtPole-1&&(t.c.Warn("Maximum number of faces at a pole used"),d=this.goldbergData.nbFacesAtPole-1),12+h*this.goldbergData.nbFacesAtPole+d)}_changeGoldbergFaceColors(h){for(let T=0;T<h.length;T++){const d=h[T][0],Y=h[T][1],y=h[T][2];for(let h=d;h<Y+1;h++)this.goldbergData.faceColors[h]=y}const d=[];for(let T=0;T<12;T++)for(let h=0;h<5;h++)d.push(this.goldbergData.faceColors[T].r,this.goldbergData.faceColors[T].g,this.goldbergData.faceColors[T].b,this.goldbergData.faceColors[T].a);for(let T=12;T<this.goldbergData.faceColors.length;T++)for(let h=0;h<6;h++)d.push(this.goldbergData.faceColors[T].r,this.goldbergData.faceColors[T].g,this.goldbergData.faceColors[T].b,this.goldbergData.faceColors[T].a);return d}setGoldbergFaceColors(h){const d=this._changeGoldbergFaceColors(h);this.qh(C.g.ColorKind,d)}updateGoldbergFaceColors(h){const d=this._changeGoldbergFaceColors(h);this.updateVerticesData(C.g.ColorKind,d)}_changeGoldbergFaceUVs(h){const d=this.getVerticesData(C.g.UVKind);for(let T=0;T<h.length;T++){const Y=h[T][0],y=h[T][1],C=h[T][2],n=h[T][3],X=h[T][4],F=[],U=[];let Z,S;for(let h=0;h<5;h++)Z=C.x+n*Math.cos(X+h*Math.PI/2.5),S=C.y+n*Math.sin(X+h*Math.PI/2.5),Z<0&&(Z=0),Z>1&&(Z=1),F.push(Z,S);for(let h=0;h<6;h++)Z=C.x+n*Math.cos(X+h*Math.PI/3),S=C.y+n*Math.sin(X+h*Math.PI/3),Z<0&&(Z=0),Z>1&&(Z=1),U.push(Z,S);for(let h=Y;h<Math.min(12,y+1);h++)for(let T=0;T<5;T++)d[10*h+2*T]=F[2*T],d[10*h+2*T+1]=F[2*T+1];for(let h=Math.max(12,Y);h<y+1;h++)for(let T=0;T<6;T++)d[12*h-24+2*T]=U[2*T],d[12*h-23+2*T]=U[2*T+1]}return d}setGoldbergFaceUVs(h){const d=this._changeGoldbergFaceUVs(h);this.qh(C.g.UVKind,d)}updateGoldbergFaceUVs(h){const d=this._changeGoldbergFaceUVs(h);this.updateVerticesData(C.g.UVKind,d)}placeOnGoldbergFaceAt(h,d,T){const y=Y.pd.RotationFromAxis(this.goldbergData.faceXaxis[d],this.goldbergData.faceYaxis[d],this.goldbergData.faceZaxis[d]);h.rotation=y,h.position=this.goldbergData.faceCenters[d].add(this.goldbergData.faceXaxis[d].scale(T.x)).add(this.goldbergData.faceYaxis[d].scale(T.y)).add(this.goldbergData.faceZaxis[d].scale(T.z))}serialize(h){super.serialize(h),h.type="GoldbergMesh";const d={};if(d.adjacentFaces=this.goldbergData.adjacentFaces,d.nbSharedFaces=this.goldbergData.nbSharedFaces,d.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,d.nbFaces=this.goldbergData.nbFaces,d.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){d.faceColors=[];for(const h of this.goldbergData.faceColors)d.faceColors.push(h.ad())}if(this.goldbergData.faceCenters){d.faceCenters=[];for(const h of this.goldbergData.faceCenters)d.faceCenters.push(h.ad())}if(this.goldbergData.faceZaxis){d.faceZaxis=[];for(const h of this.goldbergData.faceZaxis)d.faceZaxis.push(h.ad())}if(this.goldbergData.faceYaxis){d.faceYaxis=[];for(const h of this.goldbergData.faceYaxis)d.faceYaxis.push(h.ad())}if(this.goldbergData.faceXaxis){d.faceXaxis=[];for(const h of this.goldbergData.faceXaxis)d.faceXaxis.push(h.ad())}h.goldbergData=d}static Parse(h,d){const T=h.goldbergData;T.faceColors=T.faceColors.map((h=>r.ln.Bd(h))),T.faceCenters=T.faceCenters.map((h=>Y.pd.Bd(h))),T.faceZaxis=T.faceZaxis.map((h=>Y.pd.Bd(h))),T.faceXaxis=T.faceXaxis.map((h=>Y.pd.Bd(h))),T.faceYaxis=T.faceYaxis.map((h=>Y.pd.Bd(h)));const y=new Ch(h.name,d);return y.goldbergData=T,y}}var nh=T(13334);const Xh={CreateBox:S.b,CreateTiledBox:J,CreateSphere:W.d,CreateDisc:Z.e,CreateIcoSphere:e,CreateRibbon:U,CreateCylinder:i,CreateTorus:s,CreateTorusKnot:z,CreateLineSystem:x.e,kU:x.g,CreateDashedLines:x.b,ExtrudeShape:p,ExtrudeShapeCustom:k,CreateLathe:u,CreateTiledPlane:O,NU:N.d,CreateGround:K.e,CreateTiledGround:K.i,CreateGroundFromHeightMap:K.d,CreatePolygon:g.b,ExtrudePolygon:g.d,CreateTube:l,CreatePolyhedron:j,CreateGeodesic:function(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Y=d.m||1;Y!==Math.floor(Y)&&(Y=Math.floor(Y),t.c.Warn("m not an integer only floor(m) used"));let y=d.n||0;if(y!==Math.floor(y)&&(y=Math.floor(y),t.c.Warn("n not an integer only floor(n) used")),y>Y){const h=y;y=Y,Y=h,t.c.Warn("n > m therefore m and n swapped")}const C=new Th;return C.build(Y,y),j(h,{custom:yh.BuildGeodesicData(C),size:d.size,sizeX:d.sizeX,sizeY:d.sizeY,sizeZ:d.sizeZ,faceUV:d.faceUV,faceColors:d.faceColors,flat:d.flat,updatable:d.updatable,sideOrientation:d.sideOrientation,frontUVs:d.frontUVs,backUVs:d.backUVs},T)},CreateGoldberg:function(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=d.size,F=d.sizeX||C||1,U=d.sizeY||C||1,Z=d.sizeZ||C||1;let S=d.m||1;S!==Math.floor(S)&&(S=Math.floor(S),t.c.Warn("m not an integer only floor(m) used"));let c=d.n||0;if(c!==Math.floor(c)&&(c=Math.floor(c),t.c.Warn("n not an integer only floor(n) used")),c>S){const h=c;c=S,S=h,t.c.Warn("n > m therefore m and n swapped")}const O=new Th;O.build(S,c);const f=yh.BuildGeodesicData(O),J=f.toGoldbergPolyhedronData(),W=new Ch(h,T);d.sideOrientation=y.d._GetDefaultSideOrientation(d.sideOrientation),W._originalBuilderSideOrientation=d.sideOrientation;(function(h,d){const T=h.size,y=h.sizeX||T||1,C=h.sizeY||T||1,F=h.sizeZ||T||1,U=0===h.sideOrientation?0:h.sideOrientation||n.c.DEFAULTSIDE,Z=[],S=[],r=[],c=[];let O=1/0,f=-1/0,J=1/0,W=-1/0;for(let Y=0;Y<d.vertex.length;Y++)O=Math.min(O,d.vertex[Y][0]*y),f=Math.max(f,d.vertex[Y][0]*y),J=Math.min(J,d.vertex[Y][1]*C),W=Math.max(W,d.vertex[Y][1]*C);let L=0;for(let n=0;n<d.face.length;n++){const h=d.face[n],T=Y.pd.Bd(d.vertex[h[0]]),U=Y.pd.Bd(d.vertex[h[2]]),D=Y.pd.Bd(d.vertex[h[1]]),V=U.Nd(T),i=D.Nd(T),w=Y.pd.Cross(i,V).normalize();for(let Y=0;Y<h.length;Y++){r.push(w.x,w.y,w.z);const T=d.vertex[h[Y]];Z.push(T[0]*y,T[1]*C,T[2]*F);const n=(T[1]*C-J)/(W-J);c.push((T[0]*y-O)/(f-O),X.b?1-n:n)}for(let d=0;d<h.length-2;d++)S.push(L,L+d+2,L+d+1);L+=h.length}n.c._ComputeSides(U,Z,S,r,c);const D=new n.c;return D.xh=Z,D.indices=S,D.gh=r,D.ph=c,D})(d,J).oh(W,d.updatable),W.goldbergData.nbSharedFaces=f.sharedNodes,W.goldbergData.nbUnsharedFaces=f.poleNodes,W.goldbergData.adjacentFaces=f.adjacentFaces,W.goldbergData.nbFaces=W.goldbergData.nbSharedFaces+W.goldbergData.nbUnsharedFaces,W.goldbergData.nbFacesAtPole=(W.goldbergData.nbUnsharedFaces-12)/12;for(let y=0;y<f.vertex.length;y++)W.goldbergData.faceCenters.push(Y.pd.Bd(f.vertex[y])),W.goldbergData.faceCenters[y].x*=F,W.goldbergData.faceCenters[y].y*=U,W.goldbergData.faceCenters[y].z*=Z,W.goldbergData.faceColors.push(new r.ln(1,1,1,1));for(let y=0;y<J.face.length;y++){const h=J.face[y],d=Y.pd.Bd(J.vertex[h[0]]),T=Y.pd.Bd(J.vertex[h[2]]),C=Y.pd.Bd(J.vertex[h[1]]),n=T.Nd(d),X=C.Nd(d),F=Y.pd.Cross(X,n).normalize(),U=Y.pd.Cross(X,F).normalize();W.goldbergData.faceXaxis.push(X.normalize()),W.goldbergData.faceYaxis.push(F),W.goldbergData.faceZaxis.push(U)}return W},CreateDecal:I,CreateCapsule:P,CreateText:nh.g}},14109:(h,d,T)=>{"use strict";T.d(d,{b:()=>Xd});var Y=T(12765),y=T(13155);class C extends y.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var n=T(12812),X=(T(12917),T(12714));class F{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(h){this._targetStopDuration!==h&&(this._targetStopDuration=h)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(h){this._noiseTexture!==h&&(this._noiseTexture=h,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(h){this._animationSheetEnabled!==h&&(this._animationSheetEnabled=h)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(h){this._isAnimationSheetEnabled!=h&&(this._isAnimationSheetEnabled=h,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(h){this._useLogarithmicDepth=h&&this.Eh().getEngine().getCaps().fragmentDepthSupported}Eh(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(h){switch(h){case F.BLENDMODE_MULTIPLYADD:return;case F.BLENDMODE_ADD:h=1;break;case F.BLENDMODE_ONEONE:h=6;break;case F.BLENDMODE_STANDARD:h=2;break;case F.BLENDMODE_MULTIPLY:h=4;break;case F.BLENDMODE_SUBTRACT:h=3}this._engine.setAlphaMode(h)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:Y.pd.Zero()}set direction1(h){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=h)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:Y.pd.Zero()}set direction2(h){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=h)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:Y.pd.Zero()}set minEmitBox(h){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=h)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:Y.pd.Zero()}set maxEmitBox(h){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=h)}get billboardMode(){return this._billboardMode}set billboardMode(h){this._billboardMode!==h&&(this._billboardMode=h,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(h){this._isBillboardBased!==h&&(this._isBillboardBased=h,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(h){this._attachImageProcessingConfiguration(h)}_attachImageProcessingConfiguration(h){h!==this._imageProcessingConfiguration&&(!h&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=h)}_reset(){}_removeGradientAndTexture(h,d,T){if(!d)return this;let Y=0;for(const y of d){if(y.gradient===h){d.splice(Y,1);break}Y++}return T&&T.dispose(),this}constructor(h){this.animations=[],this.renderingGroupId=0,this.nd=Y.pd.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new Y.pd(10,10,10),this.onAnimationEnd=null,this.blendMode=F.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new Y.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.gU=new Y.pd(0,0,0),this._useLogarithmicDepth=!1,this.gravity=Y.pd.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new n.ln(1,1,1,1),this.color2=new n.ln(1,1,1,1),this.colorDead=new n.ln(0,0,0,1),this.textureMask=new n.ln(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new C,this.id=h,this.name=h}createPointEmitter(h,d){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new Y.pd(0,1,0),arguments.length>2&&void 0!==arguments[2]||new Y.pd(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new Y.pd(0,1,0),arguments.length>4&&void 0!==arguments[4]||new Y.pd(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new Y.pd(0,1,0),arguments.length>3&&void 0!==arguments[3]||new Y.pd(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(h,d,T,Y){throw new Error("Method not implemented.")}}F.BLENDMODE_ONEONE=0,F.BLENDMODE_STANDARD=1,F.BLENDMODE_ADD=2,F.BLENDMODE_MULTIPLY=3,F.BLENDMODE_MULTIPLYADD=4,F.BLENDMODE_SUBTRACT=-1,(0,X.e)("BABYLON.BaseParticleSystem",F);var U=T(12787),Z=T(12604);class S{constructor(){this.direction1=new Y.pd(0,1,0),this.direction2=new Y.pd(0,1,0),this.minEmitBox=new Y.pd(-.5,-.5,-.5),this.maxEmitBox=new Y.pd(.5,.5,.5)}startDirectionFunction(h,d,T,y){const C=(0,U.RandomRange)(this.direction1.x,this.direction2.x),n=(0,U.RandomRange)(this.direction1.y,this.direction2.y),X=(0,U.RandomRange)(this.direction1.z,this.direction2.z);if(y)return d.x=C,d.y=n,void(d.z=X);Y.pd.TransformNormalFromFloatsToRef(C,n,X,h,d)}startPositionFunction(h,d,T,y){const C=(0,U.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),n=(0,U.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),X=(0,U.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(y)return d.x=C,d.y=n,void(d.z=X);Y.pd.TransformCoordinatesFromFloatsToRef(C,n,X,h,d)}clone(){const h=new S;return Z.d.DeepCopy(this,h),h}applyToShader(h){h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2),h.setVector3("minEmitBox",this.minEmitBox),h.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(h){h.addUniform("direction1",3),h.addUniform("direction2",3),h.addUniform("minEmitBox",3),h.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.direction1=this.direction1.ad(),h.direction2=this.direction2.ad(),h.minEmitBox=this.minEmitBox.ad(),h.maxEmitBox=this.maxEmitBox.ad(),h}parse(h){Y.pd.FromArrayToRef(h.direction1,0,this.direction1),Y.pd.FromArrayToRef(h.direction2,0,this.direction2),Y.pd.FromArrayToRef(h.minEmitBox,0,this.minEmitBox),Y.pd.FromArrayToRef(h.maxEmitBox,0,this.maxEmitBox)}}class r{get radius(){return this._radius}set radius(h){this._radius=h,this._buildHeight()}get angle(){return this._angle}set angle(h){this._angle=h,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=T,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=d,this.radius=h}startDirectionFunction(h,d,T,y){y?Y.TmpVectors.pd[0].C(T.nF).normalize():T.position.subtractToRef(h.getTranslation(),Y.TmpVectors.pd[0]).normalize();const C=(0,U.RandomRange)(0,this.directionRandomizer),n=(0,U.RandomRange)(0,this.directionRandomizer),X=(0,U.RandomRange)(0,this.directionRandomizer);d.x=Y.TmpVectors.pd[0].x+C,d.y=Y.TmpVectors.pd[0].y+n,d.z=Y.TmpVectors.pd[0].z+X,d.normalize()}startPositionFunction(h,d,T,y){const C=(0,U.RandomRange)(0,2*Math.PI);let n;this.emitFromSpawnPointOnly?n=1e-4:(n=(0,U.RandomRange)(0,this.heightRange),n=1-n*n);let X=this._radius-(0,U.RandomRange)(0,this._radius*this.radiusRange);X*=n;const F=X*Math.sin(C),Z=X*Math.cos(C),S=n*this._height;if(y)return d.x=F,d.y=S,void(d.z=Z);Y.pd.TransformCoordinatesFromFloatsToRef(F,S,Z,h,d)}clone(){const h=new r(this._radius,this._angle,this.directionRandomizer);return Z.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat2("radius",this._radius,this.radiusRange),h.setFloat("coneAngle",this._angle),h.setFloat2("height",this._height,this.heightRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",2),h.addUniform("coneAngle",1),h.addUniform("height",2),h.addUniform("directionRandomizer",1)}getEffectDefines(){let h="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(h+="\n#define CONEEMITTERSPAWNPOINT"),h}getClassName(){return"ConeParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this._radius,h.angle=this._angle,h.directionRandomizer=this.directionRandomizer,h.radiusRange=this.radiusRange,h.heightRange=this.heightRange,h.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,h}parse(h){this.radius=h.radius,this.angle=h.angle,this.directionRandomizer=h.directionRandomizer,this.radiusRange=void 0!==h.radiusRange?h.radiusRange:1,this.heightRange=void 0!==h.radiusRange?h.heightRange:1,this.emitFromSpawnPointOnly=void 0!==h.emitFromSpawnPointOnly&&h.emitFromSpawnPointOnly}}class c extends r{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Y.pd(0,1,0),y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Y.pd(0,1,0);super(h,d),this.direction1=T,this.direction2=y}startDirectionFunction(h,d){const T=(0,U.RandomRange)(this.direction1.x,this.direction2.x),y=(0,U.RandomRange)(this.direction1.y,this.direction2.y),C=(0,U.RandomRange)(this.direction1.z,this.direction2.z);Y.pd.TransformNormalFromFloatsToRef(T,y,C,h,d)}clone(){const h=new c(this.radius,this.angle,this.direction1,this.direction2);return Z.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const h=super.serialize();return h.direction1=this.direction1.ad(),h.direction2=this.direction2.ad(),h}parse(h){super.parse(h),this.direction1.C(h.direction1),this.direction2.C(h.direction2)}}class O{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=h,this.height=d,this.radiusRange=T,this.directionRandomizer=y,this._tempVector=Y.pd.Zero()}startDirectionFunction(h,d,T,y,C){T.position.subtractToRef(h.getTranslation(),this._tempVector),this._tempVector.normalize(),Y.pd.TransformNormalToRef(this._tempVector,C,this._tempVector);const n=(0,U.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let X=Math.atan2(this._tempVector.x,this._tempVector.z);X+=(0,U.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=n,this._tempVector.x=Math.sin(X),this._tempVector.z=Math.cos(X),this._tempVector.normalize(),y?d.C(this._tempVector):Y.pd.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,h,d)}startPositionFunction(h,d,T,y){const C=(0,U.RandomRange)(-this.height/2,this.height/2),n=(0,U.RandomRange)(0,2*Math.PI),X=(0,U.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),F=Math.sqrt(X)*this.radius,Z=F*Math.cos(n),S=F*Math.sin(n);y?d.ny(Z,C,S):Y.pd.TransformCoordinatesFromFloatsToRef(Z,C,S,h,d)}clone(){const h=new O(this.radius,this.directionRandomizer);return Z.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("height",this.height),h.setFloat("radiusRange",this.radiusRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("height",1),h.addUniform("radiusRange",1),h.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this.radius,h.height=this.height,h.radiusRange=this.radiusRange,h.directionRandomizer=this.directionRandomizer,h}parse(h){this.radius=h.radius,this.height=h.height,this.radiusRange=h.radiusRange,this.directionRandomizer=h.directionRandomizer}}class f extends O{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Y.pd(0,1,0),C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Y.pd(0,1,0);super(h,d,T),this.direction1=y,this.direction2=C}startDirectionFunction(h,d,T,y){const C=(0,U.RandomRange)(this.direction1.x,this.direction2.x),n=(0,U.RandomRange)(this.direction1.y,this.direction2.y),X=(0,U.RandomRange)(this.direction1.z,this.direction2.z);y?d.ny(C,n,X):Y.pd.TransformNormalFromFloatsToRef(C,n,X,h,d)}clone(){const h=new f(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return Z.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("height",this.height),h.setFloat("radiusRange",this.radiusRange),h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("height",1),h.addUniform("radiusRange",1),h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const h=super.serialize();return h.direction1=this.direction1.ad(),h.direction2=this.direction2.ad(),h}parse(h){super.parse(h),Y.pd.FromArrayToRef(h.direction1,0,this.direction1),Y.pd.FromArrayToRef(h.direction2,0,this.direction2)}}class J{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=h,this.radiusRange=d,this.directionRandomizer=T}startDirectionFunction(h,d,T,y){const C=T.position.Nd(h.getTranslation()).normalize(),n=(0,U.RandomRange)(0,this.directionRandomizer),X=(0,U.RandomRange)(0,this.directionRandomizer),F=(0,U.RandomRange)(0,this.directionRandomizer);C.x+=n,C.y+=X,C.z+=F,C.normalize(),y?d.C(C):Y.pd.TransformNormalFromFloatsToRef(C.x,C.y,C.z,h,d)}startPositionFunction(h,d,T,y){const C=this.radius-(0,U.RandomRange)(0,this.radius*this.radiusRange),n=(0,U.RandomRange)(0,1),X=(0,U.RandomRange)(0,2*Math.PI),F=Math.acos(2*n-1),Z=C*Math.cos(X)*Math.sin(F),S=C*Math.cos(F),r=C*Math.sin(X)*Math.sin(F);y?d.ny(Z,Math.abs(S),r):Y.pd.TransformCoordinatesFromFloatsToRef(Z,Math.abs(S),r,h,d)}clone(){const h=new J(this.radius,this.directionRandomizer);return Z.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this.radius,h.radiusRange=this.radiusRange,h.directionRandomizer=this.directionRandomizer,h}parse(h){this.radius=h.radius,this.radiusRange=h.radiusRange,this.directionRandomizer=h.directionRandomizer}}class W{constructor(){this.direction1=new Y.pd(0,1,0),this.direction2=new Y.pd(0,1,0)}startDirectionFunction(h,d,T,y){const C=(0,U.RandomRange)(this.direction1.x,this.direction2.x),n=(0,U.RandomRange)(this.direction1.y,this.direction2.y),X=(0,U.RandomRange)(this.direction1.z,this.direction2.z);y?d.ny(C,n,X):Y.pd.TransformNormalFromFloatsToRef(C,n,X,h,d)}startPositionFunction(h,d,T,y){y?d.ny(0,0,0):Y.pd.TransformCoordinatesFromFloatsToRef(0,0,0,h,d)}clone(){const h=new W;return Z.d.DeepCopy(this,h),h}applyToShader(h){h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.direction1=this.direction1.ad(),h.direction2=this.direction2.ad(),h}parse(h){Y.pd.FromArrayToRef(h.direction1,0,this.direction1),Y.pd.FromArrayToRef(h.direction2,0,this.direction2)}}class L{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=h,this.radiusRange=d,this.directionRandomizer=T}startDirectionFunction(h,d,T,y){const C=T.position.Nd(h.getTranslation()).normalize(),n=(0,U.RandomRange)(0,this.directionRandomizer),X=(0,U.RandomRange)(0,this.directionRandomizer),F=(0,U.RandomRange)(0,this.directionRandomizer);C.x+=n,C.y+=X,C.z+=F,C.normalize(),y?d.C(C):Y.pd.TransformNormalFromFloatsToRef(C.x,C.y,C.z,h,d)}startPositionFunction(h,d,T,y){const C=this.radius-(0,U.RandomRange)(0,this.radius*this.radiusRange),n=(0,U.RandomRange)(0,1),X=(0,U.RandomRange)(0,2*Math.PI),F=Math.acos(2*n-1),Z=C*Math.cos(X)*Math.sin(F),S=C*Math.cos(F),r=C*Math.sin(X)*Math.sin(F);y?d.ny(Z,S,r):Y.pd.TransformCoordinatesFromFloatsToRef(Z,S,r,h,d)}clone(){const h=new L(this.radius,this.directionRandomizer);return Z.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.radius=this.radius,h.radiusRange=this.radiusRange,h.directionRandomizer=this.directionRandomizer,h}parse(h){this.radius=h.radius,this.radiusRange=h.radiusRange,this.directionRandomizer=h.directionRandomizer}}class D extends L{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Y.pd(0,1,0),T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Y.pd(0,1,0);super(h),this.direction1=d,this.direction2=T}startDirectionFunction(h,d){const T=(0,U.RandomRange)(this.direction1.x,this.direction2.x),y=(0,U.RandomRange)(this.direction1.y,this.direction2.y),C=(0,U.RandomRange)(this.direction1.z,this.direction2.z);Y.pd.TransformNormalFromFloatsToRef(T,y,C,h,d)}clone(){const h=new D(this.radius,this.direction1,this.direction2);return Z.d.DeepCopy(this,h),h}applyToShader(h){h.setFloat("radius",this.radius),h.setFloat("radiusRange",this.radiusRange),h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("radius",1),h.addUniform("radiusRange",1),h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const h=super.serialize();return h.direction1=this.direction1.ad(),h.direction2=this.direction2.ad(),h}parse(h){super.parse(h),this.direction1.C(h.direction1),this.direction2.C(h.direction2)}}class V{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(h,d,T,y){const C=Y.TmpVectors.pd[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,T,C);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,T,C);const h=Y.TmpVectors.pd[1];C.subtractToRef(T.position,h),h.scaleToRef(1/T.lifeTime,C)}else C.set(0,0,0);y?d.C(C):Y.pd.TransformNormalToRef(C,h,d)}startPositionFunction(h,d,T,y){const C=Y.TmpVectors.pd[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,T,C):C.set(0,0,0),y?d.C(C):Y.pd.TransformCoordinatesToRef(C,h,d)}clone(){const h=new V;return Z.d.DeepCopy(this,h),h}applyToShader(h){}buildUniformLayout(h){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const h={};return h.type=this.getClassName(),h.particlePositionGenerator=this.particlePositionGenerator,h.particleDestinationGenerator=this.particleDestinationGenerator,h}parse(h){h.particlePositionGenerator&&(this.particlePositionGenerator=h.particlePositionGenerator),h.particleDestinationGenerator&&(this.particleDestinationGenerator=h.particleDestinationGenerator)}}var i=T(12835);class w{get mesh(){return this._mesh}set mesh(h){this._mesh!==h&&(this._mesh=h,h?(this._indices=h.Pd(),this._positions=h.getVerticesData(i.g.PositionKind),this._normals=h.getVerticesData(i.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=Y.pd.Zero(),this._mesh=null,this.direction1=new Y.pd(0,1,0),this.direction2=new Y.pd(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=h}startDirectionFunction(h,d,T,y){if(this.useMeshNormalsForDirection&&this._normals)return void Y.pd.TransformNormalToRef(this._storedNormal,h,d);const C=(0,U.RandomRange)(this.direction1.x,this.direction2.x),n=(0,U.RandomRange)(this.direction1.y,this.direction2.y),X=(0,U.RandomRange)(this.direction1.z,this.direction2.z);y?d.ny(C,n,X):Y.pd.TransformNormalFromFloatsToRef(C,n,X,h,d)}startPositionFunction(h,d,T,y){if(!this._indices||!this._positions)return;const C=3*(Math.random()*(this._indices.length/3)|0),n=Math.random(),X=Math.random()*(1-n),F=1-n-X,U=this._indices[C],Z=this._indices[C+1],S=this._indices[C+2],r=Y.TmpVectors.pd[0],c=Y.TmpVectors.pd[1],O=Y.TmpVectors.pd[2],f=Y.TmpVectors.pd[3];Y.pd.FromArrayToRef(this._positions,3*U,r),Y.pd.FromArrayToRef(this._positions,3*Z,c),Y.pd.FromArrayToRef(this._positions,3*S,O),f.x=n*r.x+X*c.x+F*O.x,f.y=n*r.y+X*c.y+F*O.y,f.z=n*r.z+X*c.z+F*O.z,y?d.ny(f.x,f.y,f.z):Y.pd.TransformCoordinatesFromFloatsToRef(f.x,f.y,f.z,h,d),this.useMeshNormalsForDirection&&this._normals&&(Y.pd.FromArrayToRef(this._normals,3*U,r),Y.pd.FromArrayToRef(this._normals,3*Z,c),Y.pd.FromArrayToRef(this._normals,3*S,O),this._storedNormal.x=n*r.x+X*c.x+F*O.x,this._storedNormal.y=n*r.y+X*c.y+F*O.y,this._storedNormal.z=n*r.z+X*c.z+F*O.z)}clone(){const h=new w(this.mesh);return Z.d.DeepCopy(this,h),h}applyToShader(h){h.setVector3("direction1",this.direction1),h.setVector3("direction2",this.direction2)}buildUniformLayout(h){h.addUniform("direction1",3),h.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var h;const d={};return d.type=this.getClassName(),d.direction1=this.direction1.ad(),d.direction2=this.direction2.ad(),d.meshId=null===(h=this.mesh)||void 0===h?void 0:h.id,d.useMeshNormalsForDirection=this.useMeshNormalsForDirection,d}parse(h,d){Y.pd.FromArrayToRef(h.direction1,0,this.direction1),Y.pd.FromArrayToRef(h.direction2,0,this.direction2),h.meshId&&d&&(this.mesh=d.getLastMeshById(h.meshId)),this.useMeshNormalsForDirection=h.useMeshNormalsForDirection}}class s{_isUbo(h){return void 0!==h.addUniform}constructor(h){this._isUbo(h)?(this.setMatrix3x3=h.updateMatrix3x3.bind(h),this.setMatrix2x2=h.updateMatrix2x2.bind(h),this.setFloat=h.updateFloat.bind(h),this.setFloat2=h.updateFloat2.bind(h),this.setFloat3=h.updateFloat3.bind(h),this.setFloat4=h.updateFloat4.bind(h),this.setFloatArray=h.updateFloatArray.bind(h),this.setArray=h.updateArray.bind(h),this.setIntArray=h.updateIntArray.bind(h),this.setMatrix=h.bd.bind(h),this.setMatrices=h.updateMatrices.bind(h),this.setVector3=h.updateVector3.bind(h),this.setVector4=h.updateVector4.bind(h),this.setColor3=h.updateColor3.bind(h),this.setColor4=h.updateColor4.bind(h),this.setDirectColor4=h.updateDirectColor4.bind(h),this.setInt=h.updateInt.bind(h),this.setInt2=h.updateInt2.bind(h),this.setInt3=h.updateInt3.bind(h),this.setInt4=h.updateInt4.bind(h)):(this.setMatrix3x3=h.setMatrix3x3.bind(h),this.setMatrix2x2=h.setMatrix2x2.bind(h),this.setFloat=h.setFloat.bind(h),this.setFloat2=h.setFloat2.bind(h),this.setFloat3=h.setFloat3.bind(h),this.setFloat4=h.setFloat4.bind(h),this.setFloatArray=h.setFloatArray.bind(h),this.setArray=h.setArray.bind(h),this.setIntArray=h.setIntArray.bind(h),this.setMatrix=h.setMatrix.bind(h),this.setMatrices=h.setMatrices.bind(h),this.setVector3=h.setVector3.bind(h),this.setVector4=h.setVector4.bind(h),this.setColor3=h.setColor3.bind(h),this.setColor4=h.setColor4.bind(h),this.setDirectColor4=h.setDirectColor4.bind(h),this.setInt=h.setInt.bind(h),this.setInt2=h.setInt2.bind(h),this.setInt3=h.setInt3.bind(h),this.setInt4=h.setInt4.bind(h))}}var E=T(12663);const z="gpuUpdateParticlesPixelShader",x="#version 300 es\nvoid main() {discard;}\n";E.e.ShadersStore[z]||(E.e.ShadersStore[z]=x);const g="gpuUpdateParticlesVertexShader",H="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";E.e.ShadersStore[g]||(E.e.ShadersStore[g]=H);(0,X.e)("BABYLON.WebGL2ParticleSystem",class{constructor(h,d){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=h,this._engine=d,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var h;return(null===(h=this._updateEffect)||void 0===h?void 0:h.isReady())??!1}createUpdateBuffer(h){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof V&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=h,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new s(this._updateEffect)}createVertexBuffers(h,d){this._updateVAO.push(this._createUpdateVAO(h)),this._renderVAO.push(this._engine.recordVertexArrayObject(d,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=d}createParticleBuffer(h){return h}bindDrawBuffers(h,d,T){T?this._engine.bindBuffers(this._renderVertexBuffers,T,d):this._engine.bindVertexArrayObject(this._renderVAO[h],null)}preUpdateParticleBuffer(){const h=this._engine;if(this._engine.enableEffect(this._updateEffect),!h.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(h,d,T){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[h],null);const Y=this._engine;Y.bindTransformFeedbackBuffer(d.getBuffer()),Y.setRasterizerState(!1),Y.beginTransformFeedback(!0),Y.drawArraysType(3,0,T),Y.endTransformFeedback(),Y.setRasterizerState(!0),Y.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let h=0;h<this._updateVAO.length;h++)this._engine.releaseVertexArrayObject(this._updateVAO[h]);this._updateVAO.length=0;for(let h=0;h<this._renderVAO.length;h++)this._engine.releaseVertexArrayObject(this._renderVAO[h]);this._renderVAO.length=0}_createUpdateVAO(h){const d={};d.position=h.createVertexBuffer("position",0,3);let T=3;d.age=h.createVertexBuffer("age",T,1),T+=1,d.size=h.createVertexBuffer("size",T,3),T+=3,d.life=h.createVertexBuffer("life",T,1),T+=1,d.seed=h.createVertexBuffer("seed",T,4),T+=4,d.direction=h.createVertexBuffer("direction",T,3),T+=3,this._parent.particleEmitterType instanceof V&&(d.initialPosition=h.createVertexBuffer("initialPosition",T,3),T+=3),this._parent._colorGradientsTexture||(d.color=h.createVertexBuffer("color",T,4),T+=4),this._parent._isBillboardBased||(d.initialDirection=h.createVertexBuffer("initialDirection",T,3),T+=3),this._parent.noiseTexture&&(d.noiseCoordinates1=h.createVertexBuffer("noiseCoordinates1",T,3),T+=3,d.noiseCoordinates2=h.createVertexBuffer("noiseCoordinates2",T,3),T+=3),this._parent._angularSpeedGradientsTexture?(d.angle=h.createVertexBuffer("angle",T,1),T+=1):(d.angle=h.createVertexBuffer("angle",T,2),T+=2),this._parent._isAnimationSheetEnabled&&(d.cellIndex=h.createVertexBuffer("cellIndex",T,1),T+=1,this._parent.spriteRandomStartCell&&(d.cellStartOffset=h.createVertexBuffer("cellStartOffset",T,1),T+=1));const Y=this._engine.recordVertexArrayObject(d,null,this._updateEffect);return this._engine.bindArrayBuffer(null),Y}});class p{constructor(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,Y=arguments.length>3?arguments[3]:void 0;this._engine=h,this._label=Y,this._engine._storageBuffers.push(this),this._create(d,T)}_create(h,d){this._bufferSize=h,this._creationFlags=d,this._buffer=this._engine.createStorageBuffer(h,d,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(h,d,T){this._buffer&&this._engine.updateStorageBuffer(this._buffer,h,d,T)}async read(h,d,T,Y){return await this._engine.readFromStorageBuffer(this._buffer,h,d,T,Y)}dispose(){const h=this._engine._storageBuffers,d=h.indexOf(this);-1!==d&&(h[d]=h[h.length-1],h.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var k=T(12750),o=T(12757),u=T(12801),N=T(12741),K=T(13066),l=T(12596),q=T(12692),j=T(12966);class a{constructor(){this._gpuTimeInFrameId=-1,this.counter=new j.d}_addDuration(h,d){h<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==h?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(d,!1),this._gpuTimeInFrameId=h):this.counter.addCount(d,!1))}}var e=T(12651);class v{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=h,this._engine=d,this.uniqueId=K.c.UniqueId,d.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new a),this._engine.getCaps().supportComputeShaders?Y.bindingsMapping?(this._context=d.createComputeContext(),this._shaderPath=T,this._options={bindingsMapping:{},defines:[],...Y}):l.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):l.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(h,d){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const Y=this._bindings[h];this._bindings[h]={type:T?0:4,object:d,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!Y||Y.object!==d||Y.type!==this._bindings[h].type)}setStorageTexture(h,d){const T=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==d),this._bindings[h]={type:1,object:d,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setExternalTexture(h,d){const T=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==d),this._bindings[h]={type:6,object:d,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setVideoTexture(h,d){return!!d.externalTexture&&(this.setExternalTexture(h,d.externalTexture),!0)}setUniformBuffer(h,d){const T=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==d),this._bindings[h]={type:v._BufferIsDataBuffer(d)?7:2,object:d,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setStorageBuffer(h,d){const T=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==d),this._bindings[h]={type:v._BufferIsDataBuffer(d)?7:3,object:d,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setTextureSampler(h,d){const T=this._bindings[h];this._contextIsDirty||(this._contextIsDirty=!T||!d.compareSampler(T.object)),this._bindings[h]={type:5,object:d,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}isReady(){let h=this._effect;for(const y in this._bindings){const h=this._bindings[y],d=h.type,T=h.object;switch(d){case 0:case 4:case 1:if(!T.isReady())return!1;break;case 6:if(!T.isReady())return!1;break}}const d=[],T=this._shaderPath;if(this._options.defines)for(let y=0;y<this._options.defines.length;y++)d.push(this._options.defines[y]);const Y=d.join("\n");return this._cachedDefines!==Y&&(this._cachedDefines=Y,h=this._engine.createComputeEffect(T,{defines:Y,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=h),!!h.isReady()}dispatch(h,d,T){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,h,d,T,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const T=v._BufferIsDataBuffer(h)?h:h.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,T,d,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const d in this._bindings){const T=this._bindings[d];if(!this._options.bindingsMapping[d])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+d+"'");switch(T.type){case 0:{const Y=this._samplers[d],y=T.object;var h;if(!Y||!y._texture||!Y.compareSampler(y._texture))this._samplers[d]=(new q.b).setParameters(y.wrapU,y.wrapV,y.wrapR,y.anisotropicFilteringLevel,y._texture.samplingMode,null===(h=y._texture)||void 0===h?void 0:h._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const h=T.object;h.getBuffer()!==T.buffer&&(T.buffer=h.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((y=>{(0,e.d)((()=>this.dispatch(h,d,T)),y,void 0,Y)}))}serialize(){const h=u.e.Serialize(this);h.options=this._options,h.shaderPath=this._shaderPath,h.Jr={},h.textures={};for(const d in this._bindings){const T=this._bindings[d],Y=T.object;switch(T.type){case 0:case 4:case 1:{const y=Y.serialize();y&&(h.textures[d]=y,h.Jr[d]={type:T.type});break}}}return h}static Parse(h,d,T){const Y=u.e.Parse((()=>new v(h.name,d.getEngine(),h.shaderPath,h.options)),h,d,T);for(const y in h.textures){const C=h.Jr[y],n=N.c.Parse(h.textures[y],d,T);0===C.type?Y.setTexture(y,n):4===C.type?Y.setTexture(y,n,!1):Y.setStorageTexture(y,n)}return Y}static _BufferIsDataBuffer(h){return void 0!==h.underlyingResource}}(0,k.c)([(0,o.E)()],v.prototype,"name",void 0),(0,k.c)([(0,o.E)()],v.prototype,"fastMode",void 0),(0,X.e)("BABYLON.ComputeShader",v);var G=T(13019);const b="gpuUpdateParticlesComputeShader",B="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";E.e.ShadersStoreWGSL[b]||(E.e.ShadersStoreWGSL[b]=B);(0,X.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(h,d){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=h,this._engine=d}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var h;return(null===(h=this._updateComputeShader)||void 0===h?void 0:h.isReady())??!1}createUpdateBuffer(h){var d;const T={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(T.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(T.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(T.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(T.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(T.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(T.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(T.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new v("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:T,defines:h.split("\n")}),null===(d=this._simParamsComputeShader)||void 0===d||d.dispose(),this._simParamsComputeShader=new G.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new s(this._simParamsComputeShader)}createVertexBuffers(h,d){this._renderVertexBuffers.push(d)}createParticleBuffer(h){const d=new p(this._engine,4*h.length,11,"ComputeShaderParticleSystemBuffer");return d.update(h),this._bufferComputeShader.push(d),d.getBuffer()}bindDrawBuffers(h,d,T){this._engine.bindBuffers(this._renderVertexBuffers[h],T,d)}preUpdateParticleBuffer(){}updateParticleBuffer(h,d,T){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[h]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^h]),this._updateComputeShader.dispatch(Math.ceil(T/64))}releaseBuffers(){var h;for(let d=0;d<this._bufferComputeShader.length;++d)this._bufferComputeShader[d].dispose();this._bufferComputeShader.length=0,null===(h=this._simParamsComputeShader)||void 0===h||h.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class M{constructor(h,d,T){this.gradient=h,this.color1=d,this.color2=T}getColorToRef(h){this.color2?n.ln.LerpToRef(this.color1,this.color2,Math.random(),h):h.C(this.color1)}}class mh{constructor(h,d){this.gradient=h,this.color=d}}class R{constructor(h,d,T){this.gradient=h,this.factor1=d,this.factor2=T}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class Q{static GetCurrentGradient(h,d,T){if(d[0].gradient>h)return void T(d[0],d[0],1);for(let y=0;y<d.length-1;y++){const Y=d[y],C=d[y+1];if(h>=Y.gradient&&h<=C.gradient){return void T(Y,C,(h-Y.gradient)/(C.gradient-Y.gradient))}}const Y=d.length-1;T(d[Y],d[Y],1)}}var I=T(12583),A=T(13238),P=T(12625);class t{constructor(h){this.particleSystem=h,this.position=Y.pd.Zero(),this.direction=Y.pd.Zero(),this.color=new n.ln(0,0,0,0),this.colorStep=new n.ln(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new Y.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new n.ln(0,0,0,0),this._currentColor2=new n.ln(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=t._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let h=this.age,d=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===d?(d=1,h=this._randomCellOffset):h+=this._randomCellOffset);const T=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let Y;Y=this._initialSpriteCellLoop?(0,U.Clamp)(h*d%this.lifeTime/this.lifeTime):(0,U.Clamp)(h*d/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+Y*T|0}_inheritParticleInfoToSubEmitter(h){if(h.particleSystem.nd.position){const d=h.particleSystem.nd;if(d.position.C(this.position),h.inheritDirection){const h=Y.TmpVectors.pd[0];this.direction.normalizeToRef(h),d.setDirection(h,0,Math.PI/2)}}else{h.particleSystem.nd.C(this.position)}this.direction.scaleToRef(h.inheritedVelocityAmount/2,Y.TmpVectors.pd[0]),h.particleSystem._inheritedVelocityOffset.C(Y.TmpVectors.pd[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const h of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(h)}_reset(){this.age=0,this.id=t._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(h){h.position.C(this.position),this._initialDirection?h._initialDirection?h._initialDirection.C(this._initialDirection):h._initialDirection=this._initialDirection.clone():h._initialDirection=null,h.direction.C(this.direction),this.nF&&(h.nF?h.nF.C(this.nF):h.nF=this.nF.clone()),h.color.C(this.color),h.colorStep.C(this.colorStep),h.lifeTime=this.lifeTime,h.age=this.age,h._randomCellOffset=this._randomCellOffset,h.size=this.size,h.scale.C(this.scale),h.angle=this.angle,h.angularSpeed=this.angularSpeed,h.particleSystem=this.particleSystem,h.cellIndex=this.cellIndex,h.id=this.id,h._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(h._currentColorGradient=this._currentColorGradient,h._currentColor1.C(this._currentColor1),h._currentColor2.C(this._currentColor2)),this._currentSizeGradient&&(h._currentSizeGradient=this._currentSizeGradient,h._currentSize1=this._currentSize1,h._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(h._currentAngularSpeedGradient=this._currentAngularSpeedGradient,h._currentAngularSpeed1=this._currentAngularSpeed1,h._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(h._currentVelocityGradient=this._currentVelocityGradient,h._currentVelocity1=this._currentVelocity1,h._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(h._currentLimitVelocityGradient=this._currentLimitVelocityGradient,h._currentLimitVelocity1=this._currentLimitVelocity1,h._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(h._currentDragGradient=this._currentDragGradient,h._currentDrag1=this._currentDrag1,h._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(h._initialStartSpriteCellId=this._initialStartSpriteCellId,h._initialEndSpriteCellId=this._initialEndSpriteCellId,h._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(h.remapData&&this.remapData?h.remapData.C(this.remapData):h.remapData=new Y.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(h._randomNoiseCoordinates1?(h._randomNoiseCoordinates1.C(this._randomNoiseCoordinates1),h._randomNoiseCoordinates2.C(this._randomNoiseCoordinates2)):(h._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),h._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}t._Count=0;var hh=T(12875),dh=(T(12912),T(13132)),Th=T(13124),Yh=T(13014);function yh(h,d){const T=(0,U.RandomRange)(0,1);n.ln.LerpToRef(d.color1,d.color2,T,h.color),d.colorDead.subtractToRef(h.color,d._colorDiff),d._colorDiff.scaleToRef(1/h.lifeTime,h.colorStep)}function Ch(h,d){h._currentColorGradient=d._colorGradients[0],h._currentColorGradient.getColorToRef(h.color),h._currentColor1.C(h.color),d._colorGradients.length>1?d._colorGradients[1].getColorToRef(h._currentColor2):h._currentColor2.C(h.color)}function nh(h,d){const T=d._colorGradients;Q.GetCurrentGradient(d._ratio,T,((d,T,Y)=>{d!==h._currentColorGradient&&(h._currentColor1.C(h._currentColor2),T.getColorToRef(h._currentColor2),h._currentColorGradient=d),n.ln.LerpToRef(h._currentColor1,h._currentColor2,Y,h.color)}))}function Xh(h,d){h.colorStep.scaleToRef(d._scaledUpdateSpeed,d._scaledColorStep),h.color.addInPlace(d._scaledColorStep),h.color.a<0&&(h.color.a=0)}function Fh(h,d){Q.GetCurrentGradient(d._ratio,d._angularSpeedGradients,((d,T,Y)=>{d!==h._currentAngularSpeedGradient&&(h._currentAngularSpeed1=h._currentAngularSpeed2,h._currentAngularSpeed2=T.getFactor(),h._currentAngularSpeedGradient=d),h.angularSpeed=(0,U.Lerp)(h._currentAngularSpeed1,h._currentAngularSpeed2,Y)}))}function Uh(h,d){h.angle+=h.angularSpeed*d._scaledUpdateSpeed}function Zh(h,d){d.particleEmitterType.startDirectionFunction(d._emitterWorldMatrix,h.direction,h,d.isLocal,d._emitterInverseWorldMatrix)}function Sh(h,d){d.startDirectionFunction(d._emitterWorldMatrix,h.direction,h,d.isLocal)}function rh(h,d){h._currentVelocityGradient=d._velocityGradients[0],h._currentVelocity1=h._currentVelocityGradient.getFactor(),d._velocityGradients.length>1?h._currentVelocity2=d._velocityGradients[1].getFactor():h._currentVelocity2=h._currentVelocity1}function ch(h,d){h._currentLimitVelocityGradient=d._limitVelocityGradients[0],h._currentLimitVelocity1=h._currentLimitVelocityGradient.getFactor(),d._limitVelocityGradients.length>1?h._currentLimitVelocity2=d._limitVelocityGradients[1].getFactor():h._currentLimitVelocity2=h._currentLimitVelocity1}function Oh(h,d){Q.GetCurrentGradient(d._ratio,d._velocityGradients,((T,Y,y)=>{T!==h._currentVelocityGradient&&(h._currentVelocity1=h._currentVelocity2,h._currentVelocity2=Y.getFactor(),h._currentVelocityGradient=T),d._directionScale*=(0,U.Lerp)(h._currentVelocity1,h._currentVelocity2,y)}))}function fh(h,d){Q.GetCurrentGradient(d._ratio,d._limitVelocityGradients,((T,Y,y)=>{T!==h._currentLimitVelocityGradient&&(h._currentLimitVelocity1=h._currentLimitVelocity2,h._currentLimitVelocity2=Y.getFactor(),h._currentLimitVelocityGradient=T);const C=(0,U.Lerp)(h._currentLimitVelocity1,h._currentLimitVelocity2,y);h.direction.length()>C&&h.direction.scaleInPlace(d.limitVelocityDamping)}))}function Jh(h,d){h.direction.scaleToRef(d._directionScale,d._scaledDirection)}function Wh(h,d){d.particleEmitterType.startPositionFunction(d._emitterWorldMatrix,h.position,h,d.isLocal)}function Lh(h,d){d.startPositionFunction(d._emitterWorldMatrix,h.position,h,d.isLocal)}function Dh(h,d){h.nF?h.nF.C(h.position):h.nF=h.position.clone(),Y.pd.TransformCoordinatesToRef(h.nF,d._emitterWorldMatrix,h.position)}function Vh(h,d){d.isLocal&&h.nF?(h.nF.addInPlace(d._scaledDirection),Y.pd.TransformCoordinatesToRef(h.nF,d._emitterWorldMatrix,h.position)):h.position.addInPlace(d._scaledDirection)}function ih(h,d){h._currentDragGradient=d._dragGradients[0],h._currentDrag1=h._currentDragGradient.getFactor(),d._dragGradients.length>1?h._currentDrag2=d._dragGradients[1].getFactor():h._currentDrag2=h._currentDrag1}function wh(h,d){Q.GetCurrentGradient(d._ratio,d._dragGradients,((T,Y,y)=>{T!==h._currentDragGradient&&(h._currentDrag1=h._currentDrag2,h._currentDrag2=Y.getFactor(),h._currentDragGradient=T);const C=(0,U.Lerp)(h._currentDrag1,h._currentDrag2,y);d._scaledDirection.scaleInPlace(1-C)}))}function sh(h,d){h._randomNoiseCoordinates1?(h._randomNoiseCoordinates1.ny(Math.random(),Math.random(),Math.random()),h._randomNoiseCoordinates2.ny(Math.random(),Math.random(),Math.random())):(h._randomNoiseCoordinates1=new Y.pd(Math.random(),Math.random(),Math.random()),h._randomNoiseCoordinates2=new Y.pd(Math.random(),Math.random(),Math.random()))}function Eh(h,d){const T=d._noiseTextureData,y=d._noiseTextureSize;if(T&&y&&h._randomNoiseCoordinates1){const C=d._fetchR(h._randomNoiseCoordinates1.x,h._randomNoiseCoordinates1.y,y.width,y.height,T),n=d._fetchR(h._randomNoiseCoordinates1.z,h._randomNoiseCoordinates2.x,y.width,y.height,T),X=d._fetchR(h._randomNoiseCoordinates2.y,h._randomNoiseCoordinates2.z,y.width,y.height,T),F=Y.TmpVectors.pd[0],U=Y.TmpVectors.pd[1];F.ny((2*C-1)*d.noiseStrength.x,(2*n-1)*d.noiseStrength.y,(2*X-1)*d.noiseStrength.z),F.scaleToRef(d._tempScaledUpdateSpeed,U),h.direction.addInPlace(U)}}function zh(h,d){d.gravity.scaleToRef(d._tempScaledUpdateSpeed,d._scaledGravity),h.direction.addInPlace(d._scaledGravity)}function xh(h,d){h.size=(0,U.RandomRange)(d.minSize,d.maxSize),h.scale.ny((0,U.RandomRange)(d.minScaleX,d.maxScaleX),(0,U.RandomRange)(d.minScaleY,d.maxScaleY))}function gh(h,d){h._currentSizeGradient=d._sizeGradients[0],h._currentSize1=h._currentSizeGradient.getFactor(),h.size=h._currentSize1,d._sizeGradients.length>1?h._currentSize2=d._sizeGradients[1].getFactor():h._currentSize2=h._currentSize1,h.scale.ny((0,U.RandomRange)(d.minScaleX,d.maxScaleX),(0,U.RandomRange)(d.minScaleY,d.maxScaleY))}function Hh(h,d){const T=d._actualFrame/d.targetStopDuration;Q.GetCurrentGradient(T,d._startSizeGradients,((T,Y,y)=>{T!==d._currentStartSizeGradient&&(d._currentStartSize1=d._currentStartSize2,d._currentStartSize2=Y.getFactor(),d._currentStartSizeGradient=T);const C=(0,U.Lerp)(d._currentStartSize1,d._currentStartSize2,y);h.scale.scaleInPlace(C)}))}function ph(h,d){Q.GetCurrentGradient(d._ratio,d._sizeGradients,((d,T,Y)=>{d!==h._currentSizeGradient&&(h._currentSize1=h._currentSize2,h._currentSize2=T.getFactor(),h._currentSizeGradient=d),h.size=(0,U.Lerp)(h._currentSize1,h._currentSize2,Y)}))}function kh(h,d){h.remapData=new Y.Vector4(0,1,0,1)}function oh(h,d){d._colorRemapGradients&&d._colorRemapGradients.length>0&&Q.GetCurrentGradient(d._ratio,d._colorRemapGradients,((d,T,Y)=>{const y=(0,U.Lerp)(d.factor1,T.factor1,Y),C=(0,U.Lerp)(d.factor2,T.factor2,Y);h.remapData.x=y,h.remapData.y=C-y})),d._alphaRemapGradients&&d._alphaRemapGradients.length>0&&Q.GetCurrentGradient(d._ratio,d._alphaRemapGradients,((d,T,Y)=>{const y=(0,U.Lerp)(d.factor1,T.factor1,Y),C=(0,U.Lerp)(d.factor2,T.factor2,Y);h.remapData.z=y,h.remapData.w=C-y}))}function uh(h,d){const T=(0,U.Clamp)(d._actualFrame/d.targetStopDuration);Q.GetCurrentGradient(T,d._lifeTimeGradients,((d,Y)=>{const y=d,C=Y,n=y.getFactor(),X=C.getFactor(),F=(T-y.gradient)/(C.gradient-y.gradient);h.lifeTime=(0,U.Lerp)(n,X,F)})),d._emitPower=(0,U.RandomRange)(d.minEmitPower,d.maxEmitPower)}function Nh(h,d){h.lifeTime=(0,U.RandomRange)(d.minLifeTime,d.maxLifeTime),d._emitPower=(0,U.RandomRange)(d.minEmitPower,d.maxEmitPower)}function Kh(h,d){0===d._emitPower?(h._initialDirection?h._initialDirection.C(h.direction):h._initialDirection=h.direction.clone(),h.direction.set(0,0,0)):(h._initialDirection=null,h.direction.scaleInPlace(d._emitPower)),h.direction.addInPlace(d._inheritedVelocityOffset)}function lh(h,d){h.angularSpeed=(0,U.RandomRange)(d.minAngularSpeed,d.maxAngularSpeed),h.angle=(0,U.RandomRange)(d.minInitialRotation,d.maxInitialRotation)}function qh(h,d){h._currentAngularSpeedGradient=d._angularSpeedGradients[0],h.angularSpeed=h._currentAngularSpeedGradient.getFactor(),h._currentAngularSpeed1=h.angularSpeed,d._angularSpeedGradients.length>1?h._currentAngularSpeed2=d._angularSpeedGradients[1].getFactor():h._currentAngularSpeed2=h._currentAngularSpeed1,h.angle=(0,U.RandomRange)(d.minInitialRotation,d.maxInitialRotation)}function jh(h,d){h._initialStartSpriteCellId=d.startSpriteCellID,h._initialEndSpriteCellId=d.endSpriteCellID,h._initialSpriteCellLoop=d.spriteCellLoop}function ah(h,d){h.previousItem=d.previousItem,h.nextItem=d,d.previousItem&&(d.previousItem.nextItem=h),d.previousItem=h}function eh(h,d){h.previousItem=d,h.nextItem=d.nextItem,d.nextItem&&(d.nextItem.previousItem=h),d.nextItem=h}function vh(h,d){let T=d;for(;T.nextItem;)T=T.nextItem;h.previousItem=T,h.nextItem=T.nextItem,T.nextItem=h}function Gh(h){h.previousItem&&(h.previousItem.nextItem=h.nextItem),h.nextItem&&(h.nextItem.previousItem=h.previousItem)}class bh extends F{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(h){this._startDirectionFunction!==h&&(this._startDirectionFunction=h,this._directionProcessing.process=h?Sh:Zh)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(h){this._startPositionFunction!==h&&(this._startPositionFunction=h,this._positionCreation.process=h?Lh:Wh)}set onDispose(h){this._onDisposeObserver&&this.zd.remove(this._onDisposeObserver),this._onDisposeObserver=this.zd.add(h)}get U(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(h){this._useRampGradients!==h&&(this._useRampGradients=h,this._resetEffect(),h?(this._rampCreation={process:kh,previousItem:null,nextItem:null},eh(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:oh,previousItem:null,nextItem:null},eh(this._remapGradientProcessing,this._gravityProcessing)):(Gh(this._rampCreation),Gh(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(h){this._isLocal!==h&&(this._isLocal=h,h?(this._isLocalCreation={process:Dh,previousItem:null,nextItem:null},eh(this._isLocalCreation,this._positionCreation)):Gh(this._isLocalCreation))}get particles(){return this.Zr}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(h){this._animationSheetEnabled!==h&&(this._animationSheetEnabled=h,h?(this._sheetCreation={process:jh,previousItem:null,nextItem:null},eh(this._sheetCreation,this._colorCreation)):Gh(this._sheetCreation),this._reset())}getActiveCount(){return this.Zr.length}getClassName(){return"dZ"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var h;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(h=this._customWrappers[d])||void 0===h?void 0:h.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[h]??this._customWrappers[0]}setCustomEffect(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[d]=new hh.d(this._engine),this._customWrappers[d].effect=h,this._customWrappers[d].drawContext&&(this._customWrappers[d].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new I.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(h){if(this.noiseTexture!==h){if(this._noiseTexture=h,!h)return Gh(this._noiseCreation),void Gh(this._noiseProcessing);this._noiseCreation={process:sh,previousItem:null,nextItem:null},eh(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Eh,previousItem:null,nextItem:null},eh(this._noiseProcessing,this._positionProcessing)}}constructor(h,d,T){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4],X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(h),this._emitterInverseWorldMatrix=Y.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new Y.pd,this.zd=new I.e,this.onStoppedObservable=new I.e,this.onStartedObservable=new I.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.Zr=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new n.ln(0,0,0,0),this._colorDiff=new n.ln(0,0,0,0),this._scaledDirection=Y.pd.Zero(),this._scaledGravity=Y.pd.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=h=>{},this.recycleParticle=h=>{const d=this.Zr.pop();d!==h&&d.copyTo(h),this._stockParticles.push(d)},this._createParticle=()=>{let h;return 0!==this._stockParticles.length?(h=this._stockParticles.pop(),h._reset()):h=new t(this),this._prepareParticle(h),h},this.paused=!1,this._shadersLoaded=!1,this._capacity=d,this._epsilon=X,T&&"Scene"!==T.getClassName()?(this._engine=T,this.defaultProjectionMatrix=Y.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=T||P.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Fr.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Nh,previousItem:null,nextItem:null},this._positionCreation={process:Wh,previousItem:null,nextItem:null},eh(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Zh,previousItem:null,nextItem:null},eh(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Kh,previousItem:null,nextItem:null},eh(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:xh,previousItem:null,nextItem:null},eh(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:lh,previousItem:null,nextItem:null},eh(this._angleCreation,this._sizeCreation),this._colorCreation={process:yh,previousItem:null,nextItem:null},eh(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,F||(this._colorProcessing={process:Xh,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Uh,previousItem:null,nextItem:null},eh(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Jh,previousItem:null,nextItem:null},eh(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Vh,previousItem:null,nextItem:null},eh(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:zh,previousItem:null,nextItem:null},eh(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=C,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new hh.d(this._engine)},this._customWrappers[0].effect=y,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new S,this.updateFunction=h=>{var d;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(d=this.noiseTexture.getContent())||void 0===d||d.then((h=>{this._noiseTextureData=h})));const T=h===this.Zr;for(let Y=0;Y<h.length;Y++){const d=h[Y];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const y=d.age;if(d.age+=this._tempScaledUpdateSpeed,d.age>d.lifeTime){const h=d.age-y,T=d.lifeTime-y;this._tempScaledUpdateSpeed=T*this._tempScaledUpdateSpeed/h,d.age=d.lifeTime}this._ratio=d.age/d.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let C=this._updateQueueStart;for(;C;)C.process(d,this),C=C.nextItem;if(this._isAnimationSheetEnabled&&!F&&d.updateCellIndex(),d._inheritParticleInfoToSubEmitters(),d.age>=d.lifeTime){if(this._emitFromParticle(d),d._attachedSubEmitters){for(const h of d._attachedSubEmitters)h.particleSystem.disposeOnStop=!0,h.particleSystem.stop();d._attachedSubEmitters=null}this.recycleParticle(d),T&&Y--}else;}}}serialize(h){throw new Error("Method not implemented.")}clone(h,d){throw new Error("Method not implemented.")}_addFactorGradient(h,d,T,Y){const y=new R(d,T,Y);h.push(y),h.sort(((h,d)=>h.gradient<d.gradient?-1:h.gradient>d.gradient?1:0))}_removeFactorGradient(h,d){if(!h)return;let T=0;for(const Y of h){if(Y.gradient===d){h.splice(T,1);break}T++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=uh:this._lifeTimeCreation.process=Nh}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Hh,previousItem:null,nextItem:null},eh(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Gh(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(h){this.targetStopDuration!==h&&(this._targetStopDuration=h,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(h,d,T){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,h,d,T),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(h){return this._removeFactorGradient(this._lifeTimeGradients,h),this._syncLifeTimeCreation(),this}addSizeGradient(h,d,T){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=gh,this._sizeGradientProcessing={process:ph,previousItem:null,nextItem:null},ah(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,h,d,T),this}removeSizeGradient(h){var d;return this._removeFactorGradient(this._sizeGradients,h),0===(null===(d=this._sizeGradients)||void 0===d?void 0:d.length)&&(Gh(this._sizeGradientProcessing),this._sizeCreation.process=xh),this}addColorRemapGradient(h,d,T){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,h,d,T),this}removeColorRemapGradient(h){return this._removeFactorGradient(this._colorRemapGradients,h),this}addAlphaRemapGradient(h,d,T){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,h,d,T),this}removeAlphaRemapGradient(h){return this._removeFactorGradient(this._alphaRemapGradients,h),this}addAngularSpeedGradient(h,d,T){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=qh,this._angularSpeedGradientProcessing={process:Fh,previousItem:null,nextItem:null},ah(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,h,d,T),this}removeAngularSpeedGradient(h){var d;return this._removeFactorGradient(this._angularSpeedGradients,h),0===(null===(d=this._angularSpeedGradients)||void 0===d?void 0:d.length)&&(this._angleCreation.process=lh,Gh(this._angularSpeedGradientProcessing)),this}addVelocityGradient(h,d,T){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:rh,previousItem:null,nextItem:null},eh(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Oh,previousItem:null,nextItem:null},ah(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,h,d,T),this}removeVelocityGradient(h){var d;return this._removeFactorGradient(this._velocityGradients,h),0===(null===(d=this._velocityGradients)||void 0===d?void 0:d.length)&&(Gh(this._velocityCreation),Gh(this._velocityGradientProcessing)),this}addLimitVelocityGradient(h,d,T){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:ch,previousItem:null,nextItem:null},eh(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:fh,previousItem:null,nextItem:null},eh(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,h,d,T),this}removeLimitVelocityGradient(h){var d;return this._removeFactorGradient(this._limitVelocityGradients,h),0===(null===(d=this._limitVelocityGradients)||void 0===d?void 0:d.length)&&(Gh(this._limitVelocityCreation),Gh(this._limitVelocityGradientProcessing)),this}addDragGradient(h,d,T){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:ih,previousItem:null,nextItem:null},ah(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:wh,previousItem:null,nextItem:null},ah(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,h,d,T),this}removeDragGradient(h){var d;return this._removeFactorGradient(this._dragGradients,h),0===(null===(d=this._dragGradients)||void 0===d?void 0:d.length)&&(Gh(this._dragCreation),Gh(this._dragGradientProcessing)),this}addEmitRateGradient(h,d,T){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,h,d,T),this}removeEmitRateGradient(h){return this._removeFactorGradient(this._emitRateGradients,h),this}addStartSizeGradient(h,d,T){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,h,d,T),this._syncStartSizeCreation(),this}removeStartSizeGradient(h){return this._removeFactorGradient(this._startSizeGradients,h),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const h=new Uint8Array(4*this._rawTextureWidth),d=n.TmpColors.ed[0];for(let T=0;T<this._rawTextureWidth;T++){const Y=T/this._rawTextureWidth;Q.GetCurrentGradient(Y,this._rampGradients,((Y,y,C)=>{n.ed.LerpToRef(Y.color,y.color,C,d),h[4*T]=255*d.r,h[4*T+1]=255*d.g,h[4*T+2]=255*d.b,h[4*T+3]=255}))}this._rampGradientsTexture=A.b.CreateRGBATexture(h,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((h,d)=>h.gradient<d.gradient?-1:h.gradient>d.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(h,d){this._rampGradients||(this._rampGradients=[]);const T=new mh(h,d);return this._rampGradients.push(T),this._syncRampGradientTexture(),this}removeRampGradient(h){return this._removeGradientAndTexture(h,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(h,d,T){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Ch,this._colorProcessing.process=nh);const Y=new M(h,d,T);return this._colorGradients.push(Y),this._colorGradients.sort(((h,d)=>h.gradient<d.gradient?-1:h.gradient>d.gradient?1:0)),this}removeColorGradient(h){if(!this._colorGradients)return this;let d=0;for(const T of this._colorGradients){if(T.gradient===h){this._colorGradients.splice(d,1);break}d++}return 0===this._colorGradients.length&&(this._colorCreation.process=yh,this._colorProcessing.process=Xh),this}resetDrawCache(){if(this._drawWrappers){for(const h of this._drawWrappers)if(h)for(const d of h)null===d||void 0===d||d.dispose();this._drawWrappers=[]}}_fetchR(h,d,T,Y,y){return y[4*(((h=.5*Math.abs(h)+.5)*T%T|0)+((d=.5*Math.abs(d)+.5)*Y%Y|0)*T)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const h=this._engine,d=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*d),this._vertexBuffer=new i.e(h,this._vertexData,!0,d);let T=0;const Y=this._vertexBuffer.createVertexBuffer(i.g.PositionKind,T,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[i.g.PositionKind]=Y,T+=3;const y=this._vertexBuffer.createVertexBuffer(i.g.ColorKind,T,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[i.g.ColorKind]=y,T+=4;const C=this._vertexBuffer.createVertexBuffer("angle",T,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=C,T+=1;const n=this._vertexBuffer.createVertexBuffer("size",T,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=n,T+=2,this._isAnimationSheetEnabled){const h=this._vertexBuffer.createVertexBuffer("cellIndex",T,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=h,T+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const h=this._vertexBuffer.createVertexBuffer("direction",T,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=h,T+=3}if(this._useRampGradients){const h=this._vertexBuffer.createVertexBuffer("remapData",T,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=h,T+=4}let X;if(this._useInstancing){const d=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new i.e(h,d,!1,2),X=this._spriteBuffer.createVertexBuffer("offset",0,2)}else X=this._vertexBuffer.createVertexBuffer("offset",T,2,this._vertexBufferSize,this._useInstancing),T+=2;this._vertexBuffers.offset=X,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const h=[],d=[];let T=0;for(let Y=0;Y<this._capacity;Y++)h.push(T),h.push(T+1),h.push(T+2),h.push(T),h.push(T+2),h.push(T+3),d.push(T,T+1,T+1,T+2,T+2,T+3,T+3,T,T,T+3),T+=4;this._indexBuffer=this._engine.createIndexBuffer(h),this._linesIndexBuffer=this._engine.createIndexBuffer(d)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(h)setTimeout((()=>{this.start(0)}),h);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var d;-1!==(null===(d=this.nd)||void 0===d?void 0:d.getClassName().indexOf("Mesh"))&&this.nd.Md(!0);const h=this.noiseTexture;if(h&&h.onGeneratedObservable)h.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let d=0;d<this.preWarmCycles;d++)this.animate(!0),h.render()}))}));else for(let d=0;d<this.preWarmCycles;d++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(h))}_postStop(h){}reset(){this._stockParticles.length=0,this.Zr.length=0}_appendParticleVertex(h,d,T,y){let C=h*this._vertexBufferSize;if(this._vertexData[C++]=d.position.x+this.gU.x,this._vertexData[C++]=d.position.y+this.gU.y,this._vertexData[C++]=d.position.z+this.gU.z,this._vertexData[C++]=d.color.r,this._vertexData[C++]=d.color.g,this._vertexData[C++]=d.color.b,this._vertexData[C++]=d.color.a,this._vertexData[C++]=d.angle,this._vertexData[C++]=d.scale.x*d.size,this._vertexData[C++]=d.scale.y*d.size,this._isAnimationSheetEnabled&&(this._vertexData[C++]=d.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[C++]=d.direction.x,this._vertexData[C++]=d.direction.y,this._vertexData[C++]=d.direction.z);else if(d._initialDirection){let h=d._initialDirection;this.isLocal&&(Y.pd.TransformNormalToRef(h,this._emitterWorldMatrix,Y.TmpVectors.pd[0]),h=Y.TmpVectors.pd[0]),0===h.x&&0===h.z&&(h.x=.001),this._vertexData[C++]=h.x,this._vertexData[C++]=h.y,this._vertexData[C++]=h.z}else{let h=d.direction;this.isLocal&&(Y.pd.TransformNormalToRef(h,this._emitterWorldMatrix,Y.TmpVectors.pd[0]),h=Y.TmpVectors.pd[0]),0===h.x&&0===h.z&&(h.x=.001),this._vertexData[C++]=h.x,this._vertexData[C++]=h.y,this._vertexData[C++]=h.z}this._useRampGradients&&d.remapData&&(this._vertexData[C++]=d.remapData.x,this._vertexData[C++]=d.remapData.y,this._vertexData[C++]=d.remapData.z,this._vertexData[C++]=d.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===T?T=this._epsilon:1===T&&(T=1-this._epsilon),0===y?y=this._epsilon:1===y&&(y=1-this._epsilon)),this._vertexData[C++]=T,this._vertexData[C++]=y)}_prepareParticle(h){}_createNewOnes(h){let d;for(let T=0;T<h&&this.Zr.length!==this._capacity;T++){d=this._createParticle(),this.Zr.push(d);let h=this._createQueueStart;for(;h;)h.process(d,this),h=h.nextItem;d._inheritParticleInfoToSubEmitters()}}_update(h){if(this._alive=this.Zr.length>0,this.nd.position){const h=this.nd;this._emitterWorldMatrix=h.getWorldMatrix()}else{const h=this.nd;this._emitterWorldMatrix=Y.Matrix.Translation(h.x,h.y,h.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Zr),this._createNewOnes(h)}static _GetAttributeNamesOrOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Y=[i.g.PositionKind,i.g.ColorKind,"angle","offset","size"];return h&&Y.push("cellIndex"),d||Y.push("direction"),T&&Y.push("remapData"),Y}static _GetEffectCreationOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Y=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,dh.d)(Y),h&&Y.push("particlesInfos"),d&&Y.push("logarithmicDepthConstant"),T&&(Y.push("vFogInfos"),Y.push("vFogColor")),Y}fillDefines(h,d){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,dh.h)(this,this._scene,h),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&h.push("#define FOG")),this._isAnimationSheetEnabled&&h.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&h.push("#define LOGARITHMICDEPTH"),d===F.BLENDMODE_MULTIPLY&&h.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&h.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(h.push("#define BILLBOARD"),this.billboardMode){case 2:h.push("#define BILLBOARDY");break;case 8:case 9:h.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&h.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:h.push("#define BILLBOARDMODE_ALL")}T&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),h.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(h,d,T){d.push(...bh._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),h.push(...bh._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),T.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Yh.g)(h,this._imageProcessingConfigurationDefines),(0,Yh.d)(T,this._imageProcessingConfigurationDefines))}_getWrapper(h){const d=this._getCustomDrawWrapper(h);if(null!==d&&void 0!==d&&d.effect)return d;const T=[];this.fillDefines(T,h);const Y=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let y=this._drawWrappers[Y];y||(y=this._drawWrappers[Y]=[]);let C=y[h];C||(C=new hh.d(this._engine),C.drawContext&&(C.drawContext.useInstancing=this._useInstancing),y[h]=C);const n=T.join("\n");if(C.defines!==n){const h=[],d=[],T=[];this.fillUniformsAttributesAndSamplerNames(d,h,T),C.setEffect(this._engine.createEffect("particles",h,d,T,n,void 0,void 0,void 0,void 0,this._shaderLanguage),n)}return C}animate(){var h;let d,T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!T&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(T?this.preWarmStepOffset:(null===(h=this._scene)||void 0===h?void 0:h.getAnimationRatio())||1),this.manualEmitCount>-1)d=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let h=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const d=this._actualFrame/this.targetStopDuration;Q.GetCurrentGradient(d,this._emitRateGradients,((d,T,Y)=>{d!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=T.getFactor(),this._currentEmitRateGradient=d),h=(0,U.Lerp)(this._currentEmitRate1,this._currentEmitRate2,Y)}))}d=h*this._scaledUpdateSpeed|0,this._newPartsExcess+=h*this._scaledUpdateSpeed-d}if(this._newPartsExcess>1&&(d+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?d=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(d),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!T){let h=0;for(let d=0;d<this.Zr.length;d++){const T=this.Zr[d];this._appendParticleVertices(h,T),h+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Zr.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(h,d){this._appendParticleVertex(h++,d,0,0),this._useInstancing||(this._appendParticleVertex(h++,d,1,0),this._appendParticleVertex(h++,d,1,1),this._appendParticleVertex(h++,d,0,1))}rebuild(){var h;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(h=this._spriteBuffer)||void 0===h||h._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!bh.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(T.bind(T,14295)),Promise.resolve().then(T.bind(T,14246))])):await Promise.all([Promise.resolve().then(T.bind(T,14234)),Promise.resolve().then(T.bind(T,14224))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.nd||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==F.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(F.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(F.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(h){const d=this._getWrapper(h),T=d.effect,y=this._engine;y.enableEffect(d);const C=this.defaultViewMatrix??this._scene.getViewMatrix();if(T.setTexture("diffuseSampler",this.particleTexture),T.setMatrix("view",C),T.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const h=this.particleTexture.getBaseSize();T.setFloat3("particlesInfos",this.spriteCellWidth/h.width,this.spriteCellHeight/h.height,this.spriteCellWidth/h.width)}if(T.setVector2("translationPivot",this.translationPivot),T.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const h=this._scene.activeCamera;T.setVector3("eyePosition",h.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),T.setTexture("rampSampler",this._rampGradientsTexture));const n=T.defines;var X,F,U,Z,S,r;(this._scene&&((0,dh.e)(T,this,this._scene),this.applyFog&&(0,Th.e)(this._scene,void 0,T)),n.indexOf("#define BILLBOARDMODE_ALL")>=0&&(C.invertToRef(Y.TmpVectors.Matrix[0]),T.setMatrix("invView",Y.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?y.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,T):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,T)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?y.bindBuffers(this._vertexBuffers,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBuffer:this._indexBuffer,T):y.bindBuffers(this._vertexBuffers,null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._linesIndexBufferUseInstancing:null,T);(this.useLogarithmicDepth&&this._scene&&(0,Th.i)(n,T,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(T),this._setEngineBasedOnBlendMode(h),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(T),this._useInstancing)?null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?y.drawElementsType(6,0,10,this.Zr.length):y.drawArraysType(7,0,4,this.Zr.length):null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?y.drawElementsType(1,0,10*this.Zr.length):y.drawElementsType(0,0,6*this.Zr.length);return this.Zr.length}render(){if(!this.isReady()||!this.Zr.length)return 0;const h=this._engine;h.setState&&(h.setState(!1),this.forceDepthWrite&&h.setDepthWrite(!0));let d=0;return d=this.blendMode===F.BLENDMODE_MULTIPLYADD?this._render(F.BLENDMODE_MULTIPLY)+this._render(F.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),d}_onDispose(){}dispose(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),h&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),h&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(d,T),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const h=this._scene.Fr.indexOf(this);h>-1&&this._scene.Fr.splice(h,1),this._scene._activeParticleSystems.dispose()}this.zd.notifyObservers(this),this.zd.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}bh.ForceGLSL=!1;var Bh,Mh=T(12617);!function(h){h[h.ATTACHED=0]="ATTACHED",h[h.END=1]="END"}(Bh||(Bh={}));class md{constructor(h){if(this.particleSystem=h,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!h.nd||!h.nd.dispose){const d=(0,X.d)("BABYLON.AbstractMesh");h.nd=new d("SubemitterSystemEmitter",h.Eh()),h._disposeEmitterOnDispose=!0}}clone(){let h=this.particleSystem.nd;if(h){if(h instanceof Y.pd)h=h.clone();else if(-1!==h.getClassName().indexOf("Mesh")){h=new((0,X.d)("BABYLON.Mesh"))("",h.Eh()),h.isVisible=!1}}else h=new Y.pd;const d=new md(this.particleSystem.clone(this.particleSystem.name,h));return d.particleSystem.name+="Clone",d.type=this.type,d.inheritDirection=this.inheritDirection,d.inheritedVelocityAmount=this.inheritedVelocityAmount,d.particleSystem._disposeEmitterOnDispose=!0,d.particleSystem.disposeOnStop=!0,d}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};return d.type=this.type,d.inheritDirection=this.inheritDirection,d.inheritedVelocityAmount=this.inheritedVelocityAmount,d.particleSystem=this.particleSystem.serialize(h),d}static _ParseParticleSystem(h,d,T){throw(0,Mh.e)("ParseParticle")}static Parse(h,d,T){const Y=h.particleSystem,y=new md(md._ParseParticleSystem(Y,d,T,!0));return y.type=h.type,y.inheritDirection=h.inheritDirection,y.inheritedVelocityAmount=h.inheritedVelocityAmount,y.particleSystem._isSubEmitter=!0,y}dispose(){this.particleSystem.dispose()}}var Rh=T(12656);function Qh(h,d){const T=new W;return T.direction1=h,T.direction2=d,T}function Ih(){return new J(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Ah(){return new L(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Ph(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Y.pd(0,1,0),T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Y.pd(0,1,0);return new D(h,d,T)}function th(){return new O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function hd(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Y.pd(0,1,0),C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Y.pd(0,1,0);return new f(h,d,T,y,C)}function dd(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new r(h,d)}function Td(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Y.pd(0,1,0),y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Y.pd(0,1,0);return new c(h,d,T,y)}const Yd=Y.pd.Zero(),yd=Y.pd.Zero(),Cd=Y.pd.Zero();class nd{constructor(){this.strength=0,this.position=Y.pd.Zero()}_processParticle(h,d){this.position.subtractToRef(h.position,Yd);const T=Yd.lengthSquared()+1;Yd.normalize().scaleToRef(this.strength/T,yd),yd.scaleToRef(d._tempScaledUpdateSpeed,Cd),h.direction.addInPlace(Cd)}serialize(){return{position:this.position.ad(),strength:this.strength}}}class Xd extends bh{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=h=>{if(!this._subEmitters||0===this._subEmitters.length)return;const d=Math.floor(Math.random()*this._subEmitters.length);for(const T of this._subEmitters[d])if(1===T.type){const d=T.clone();h._inheritParticleInfoToSubEmitter(d),d.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(d.particleSystem),d.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(h,d){const T=Qh(h,d);return this.particleEmitterType=T,T}get flowMap(){return this._flowMap}set flowMap(h){this._flowMap!==h&&(this._flowMap=h,this._flowMapUpdate&&(Gh(this._flowMapUpdate),this._flowMapUpdate=null),h&&(this._flowMapUpdate={process:h=>{var d;const T=null===(d=this.Eh())||void 0===d?void 0:d.getTransformMatrix();this._flowMap._processParticle(h,this.flowMapStrength*this._tempScaledUpdateSpeed,T)},previousItem:null,nextItem:null},eh(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(h){this._attractors.push(h),1===this._attractors.length&&(this._attractorUpdate={process:h=>{for(const d of this._attractors)d._processParticle(h,this)},previousItem:null,nextItem:null},eh(this._attractorUpdate,this._directionProcessing))}removeAttractor(h){const d=this._attractors.indexOf(h);-1!==d&&this._attractors.splice(d,1),0===this._attractors.length&&Gh(this._attractorUpdate)}start(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(h)}createHemisphericEmitter(){const h=Ih(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createSphereEmitter(){const h=Ah(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createDirectedSphereEmitter(){const h=Ph(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Y.pd(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Y.pd(0,1,0));return this.particleEmitterType=h,h}createCylinderEmitter(){const h=th(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=h,h}createDirectedCylinderEmitter(){const h=hd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Y.pd(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Y.pd(0,1,0));return this.particleEmitterType=h,h}createConeEmitter(){const h=dd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=h,h}createDirectedConeEmitter(){const h=Td(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Y.pd(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Y.pd(0,1,0));return this.particleEmitterType=h,h}createBoxEmitter(h,d,T,Y){const y=new S;return this.particleEmitterType=y,this.direction1=h,this.direction2=d,this.minEmitBox=T,this.maxEmitBox=Y,y}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const h of this.subEmitters)h instanceof Xd?this._subEmitters.push([new md(h)]):h instanceof md?this._subEmitters.push([h]):h instanceof Array&&this._subEmitters.push(h)}_stopSubEmitters(){if(this.activeSubSystems){for(const h of this.activeSubSystems)h.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const h=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==h&&this._rootParticleSystem.activeSubSystems.splice(h,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(h){h&&this._stopSubEmitters()}_prepareParticle(h){if(this._subEmitters&&this._subEmitters.length>0){const d=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];h._attachedSubEmitters=[];for(const T of d)if(0===T.type){const d=T.clone();h._attachedSubEmitters.push(d),d.particleSystem.start()}}}_onDispose(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),h&&this.particles)for(const T of this.particles)if(T._attachedSubEmitters)for(let h=T._attachedSubEmitters.length-1;h>=0;h-=1)T._attachedSubEmitters[h].dispose();if(d&&this.activeSubSystems)for(let T=this.activeSubSystems.length-1;T>=0;T-=1)this.activeSubSystems[T].dispose();if(this._subEmitters&&this._subEmitters.length){for(let h=0;h<this._subEmitters.length;h++)for(const d of this._subEmitters[h])d.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.nd&&this.nd.dispose&&this.nd.dispose(!0)}static _Parse(h,d,T,y){let C;C=T instanceof Rh.c?null:T;const F=(0,X.d)("BABYLON.Texture");if(F&&C&&(h.texture?d.particleTexture=F.Parse(h.texture,C,y):h.textureName&&(d.particleTexture=new F(y+h.textureName,C,!1,void 0===h.invertY||h.invertY),d.particleTexture.name=h.textureName)),h.emitterId||0===h.emitterId||void 0!==h.nd?h.emitterId&&C?d.nd=C.getLastMeshById(h.emitterId):d.nd=Y.pd.Bd(h.nd):d.nd=Y.pd.Zero(),d.isLocal=!!h.isLocal,void 0!==h.renderingGroupId&&(d.renderingGroupId=h.renderingGroupId),void 0!==h.isBillboardBased&&(d.isBillboardBased=h.isBillboardBased),void 0!==h.billboardMode&&(d.billboardMode=h.billboardMode),void 0!==h.useLogarithmicDepth&&(d.useLogarithmicDepth=h.useLogarithmicDepth),h.animations){for(let T=0;T<h.animations.length;T++){const Y=h.animations[T],y=(0,X.d)("BABYLON.Animation");y&&d.animations.push(y.Parse(Y))}d.beginAnimationOnStart=h.beginAnimationOnStart,d.beginAnimationFrom=h.beginAnimationFrom,d.beginAnimationTo=h.beginAnimationTo,d.beginAnimationLoop=h.beginAnimationLoop}if(h.autoAnimate&&C&&C.beginAnimation(d,h.autoAnimateFrom,h.autoAnimateTo,h.autoAnimateLoop,h.autoAnimateSpeed||1),d.startDelay=0|h.startDelay,d.minAngularSpeed=h.minAngularSpeed,d.maxAngularSpeed=h.maxAngularSpeed,d.minSize=h.minSize,d.maxSize=h.maxSize,h.minScaleX&&(d.minScaleX=h.minScaleX,d.maxScaleX=h.maxScaleX,d.minScaleY=h.minScaleY,d.maxScaleY=h.maxScaleY),void 0!==h.preWarmCycles&&(d.preWarmCycles=h.preWarmCycles,d.preWarmStepOffset=h.preWarmStepOffset),void 0!==h.minInitialRotation&&(d.minInitialRotation=h.minInitialRotation,d.maxInitialRotation=h.maxInitialRotation),d.minLifeTime=h.minLifeTime,d.maxLifeTime=h.maxLifeTime,d.minEmitPower=h.minEmitPower,d.maxEmitPower=h.maxEmitPower,d.emitRate=h.emitRate,d.gravity=Y.pd.Bd(h.gravity),h.noiseStrength&&(d.noiseStrength=Y.pd.Bd(h.noiseStrength)),d.color1=n.ln.Bd(h.color1),d.color2=n.ln.Bd(h.color2),d.colorDead=n.ln.Bd(h.colorDead),d.updateSpeed=h.updateSpeed,d.targetStopDuration=h.targetStopDuration,d.blendMode=h.blendMode,h.colorGradients)for(const Y of h.colorGradients)d.addColorGradient(Y.gradient,n.ln.Bd(Y.color1),Y.color2?n.ln.Bd(Y.color2):void 0);if(h.rampGradients){for(const T of h.rampGradients)d.addRampGradient(T.gradient,n.ed.Bd(T.color));d.useRampGradients=h.useRampGradients}if(h.colorRemapGradients)for(const Y of h.colorRemapGradients)d.addColorRemapGradient(Y.gradient,void 0!==Y.factor1?Y.factor1:Y.factor,Y.factor2);if(h.alphaRemapGradients)for(const Y of h.alphaRemapGradients)d.addAlphaRemapGradient(Y.gradient,void 0!==Y.factor1?Y.factor1:Y.factor,Y.factor2);if(h.sizeGradients)for(const Y of h.sizeGradients)d.addSizeGradient(Y.gradient,void 0!==Y.factor1?Y.factor1:Y.factor,Y.factor2);if(h.angularSpeedGradients)for(const Y of h.angularSpeedGradients)d.addAngularSpeedGradient(Y.gradient,void 0!==Y.factor1?Y.factor1:Y.factor,Y.factor2);if(h.velocityGradients)for(const Y of h.velocityGradients)d.addVelocityGradient(Y.gradient,void 0!==Y.factor1?Y.factor1:Y.factor,Y.factor2);if(h.dragGradients)for(const Y of h.dragGradients)d.addDragGradient(Y.gradient,void 0!==Y.factor1?Y.factor1:Y.factor,Y.factor2);if(h.emitRateGradients)for(const Y of h.emitRateGradients)d.addEmitRateGradient(Y.gradient,void 0!==Y.factor1?Y.factor1:Y.factor,Y.factor2);if(h.startSizeGradients)for(const Y of h.startSizeGradients)d.addStartSizeGradient(Y.gradient,void 0!==Y.factor1?Y.factor1:Y.factor,Y.factor2);if(h.lifeTimeGradients)for(const Y of h.lifeTimeGradients)d.addLifeTimeGradient(Y.gradient,void 0!==Y.factor1?Y.factor1:Y.factor,Y.factor2);if(h.limitVelocityGradients){for(const T of h.limitVelocityGradients)d.addLimitVelocityGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);d.limitVelocityDamping=h.limitVelocityDamping}if(h.noiseTexture&&C){const T=(0,X.d)("BABYLON.ProceduralTexture");d.noiseTexture=T.Parse(h.noiseTexture,C,y)}let U;if(h.particleEmitterType){switch(h.particleEmitterType.type){case"SphereParticleEmitter":U=new L;break;case"SphereDirectedParticleEmitter":U=new D;break;case"ConeEmitter":case"ConeParticleEmitter":U=new r;break;case"ConeDirectedParticleEmitter":U=new c;break;case"CylinderParticleEmitter":U=new O;break;case"CylinderDirectedParticleEmitter":U=new f;break;case"HemisphericParticleEmitter":U=new J;break;case"PointParticleEmitter":U=new W;break;case"MeshParticleEmitter":U=new w;break;case"CustomParticleEmitter":U=new V;break;default:U=new S}U.parse(h.particleEmitterType,C)}else U=new S,U.parse(h,C);d.particleEmitterType=U,d.startSpriteCellID=h.startSpriteCellID,d.endSpriteCellID=h.endSpriteCellID,d.spriteCellLoop=h.spriteCellLoop??!0,d.spriteCellWidth=h.spriteCellWidth,d.spriteCellHeight=h.spriteCellHeight,d.spriteCellChangeSpeed=h.spriteCellChangeSpeed,d.spriteRandomStartCell=h.spriteRandomStartCell,d.disposeOnStop=h.disposeOnStop??!1,d.manualEmitCount=h.manualEmitCount??-1}static Parse(h,d,T){let y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0;const X=h.name;let F,U,Z=null,S=null;if(d instanceof Rh.c?F=d:(U=d,F=U.getEngine()),h.customShader&&F.createEffectForParticles){S=h.customShader;const d=S.shaderOptions.defines.length>0?S.shaderOptions.defines.join("\n"):"";Z=F.createEffectForParticles(S.shaderPath.fragmentElement,S.shaderOptions.uniforms,S.shaderOptions.samplers,d)}const r=new Xd(X,C||h.BX,d,Z,h.isAnimationSheetEnabled);if(r.customShader=S,r._rootUrl=T,h.id&&(r.id=h.id),h.subEmitters){r.subEmitters=[];for(const Y of h.subEmitters){const h=[];for(const y of Y)h.push(md.Parse(y,d,T));r.subEmitters.push(h)}}if(h.attractors)for(const n of h.attractors){const h=new nd;h.position=Y.pd.Bd(n.position),h.strength=n.strength,r.addAttractor(h)}return Xd._Parse(h,r,d,T),h.textureMask&&(r.textureMask=n.ln.Bd(h.textureMask)),h.gU&&(r.gU=Y.pd.Bd(h.gU)),h.preventAutoStart&&(r.preventAutoStart=h.preventAutoStart),y||r.preventAutoStart||r.start(),r}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};if(Xd._Serialize(d,this,h),d.textureMask=this.textureMask.ad(),d.customShader=this.customShader,d.preventAutoStart=this.preventAutoStart,d.gU=this.gU.ad(),this.subEmitters){d.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const T of this._subEmitters){const Y=[];for(const d of T)Y.push(d.serialize(h));d.subEmitters.push(Y)}}if(this._attractors&&this._attractors.length){d.attractors=[];for(const h of this._attractors)d.attractors.push(h.serialize())}return d}static _Serialize(h,d,T){if(h.name=d.name,h.id=d.id,h.BX=d.getCapacity(),h.disposeOnStop=d.disposeOnStop,h.manualEmitCount=d.manualEmitCount,d.nd.position){const T=d.nd;h.emitterId=T.id}else{const T=d.nd;h.nd=T.ad()}d.particleEmitterType&&(h.particleEmitterType=d.particleEmitterType.serialize()),d.particleTexture&&(T?h.texture=d.particleTexture.serialize():(h.textureName=d.particleTexture.name,h.invertY=!!d.particleTexture._invertY)),h.isLocal=d.isLocal,u.e.AppendSerializedAnimations(d,h),h.beginAnimationOnStart=d.beginAnimationOnStart,h.beginAnimationFrom=d.beginAnimationFrom,h.beginAnimationTo=d.beginAnimationTo,h.beginAnimationLoop=d.beginAnimationLoop,h.startDelay=d.startDelay,h.renderingGroupId=d.renderingGroupId,h.isBillboardBased=d.isBillboardBased,h.billboardMode=d.billboardMode,h.minAngularSpeed=d.minAngularSpeed,h.maxAngularSpeed=d.maxAngularSpeed,h.minSize=d.minSize,h.maxSize=d.maxSize,h.minScaleX=d.minScaleX,h.maxScaleX=d.maxScaleX,h.minScaleY=d.minScaleY,h.maxScaleY=d.maxScaleY,h.minEmitPower=d.minEmitPower,h.maxEmitPower=d.maxEmitPower,h.minLifeTime=d.minLifeTime,h.maxLifeTime=d.maxLifeTime,h.emitRate=d.emitRate,h.gravity=d.gravity.ad(),h.noiseStrength=d.noiseStrength.ad(),h.color1=d.color1.ad(),h.color2=d.color2.ad(),h.colorDead=d.colorDead.ad(),h.updateSpeed=d.updateSpeed,h.targetStopDuration=d.targetStopDuration,h.blendMode=d.blendMode,h.preWarmCycles=d.preWarmCycles,h.preWarmStepOffset=d.preWarmStepOffset,h.minInitialRotation=d.minInitialRotation,h.maxInitialRotation=d.maxInitialRotation,h.startSpriteCellID=d.startSpriteCellID,h.spriteCellLoop=d.spriteCellLoop,h.endSpriteCellID=d.endSpriteCellID,h.spriteCellChangeSpeed=d.spriteCellChangeSpeed,h.spriteCellWidth=d.spriteCellWidth,h.spriteCellHeight=d.spriteCellHeight,h.spriteRandomStartCell=d.spriteRandomStartCell,h.isAnimationSheetEnabled=d.isAnimationSheetEnabled,h.useLogarithmicDepth=d.useLogarithmicDepth;const Y=d.getColorGradients();if(Y){h.colorGradients=[];for(const d of Y){const T={gradient:d.gradient,color1:d.color1.ad()};d.color2?T.color2=d.color2.ad():T.color2=d.color1.ad(),h.colorGradients.push(T)}}const y=d.getRampGradients();if(y){h.rampGradients=[];for(const d of y){const T={gradient:d.gradient,color:d.color.ad()};h.rampGradients.push(T)}h.useRampGradients=d.useRampGradients}const C=d.getColorRemapGradients();if(C){h.colorRemapGradients=[];for(const d of C){const T={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?T.factor2=d.factor2:T.factor2=d.factor1,h.colorRemapGradients.push(T)}}const n=d.getAlphaRemapGradients();if(n){h.alphaRemapGradients=[];for(const d of n){const T={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?T.factor2=d.factor2:T.factor2=d.factor1,h.alphaRemapGradients.push(T)}}const X=d.getSizeGradients();if(X){h.sizeGradients=[];for(const d of X){const T={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?T.factor2=d.factor2:T.factor2=d.factor1,h.sizeGradients.push(T)}}const F=d.getAngularSpeedGradients();if(F){h.angularSpeedGradients=[];for(const d of F){const T={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?T.factor2=d.factor2:T.factor2=d.factor1,h.angularSpeedGradients.push(T)}}const U=d.getVelocityGradients();if(U){h.velocityGradients=[];for(const d of U){const T={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?T.factor2=d.factor2:T.factor2=d.factor1,h.velocityGradients.push(T)}}const Z=d.getDragGradients();if(Z){h.dragGradients=[];for(const d of Z){const T={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?T.factor2=d.factor2:T.factor2=d.factor1,h.dragGradients.push(T)}}const S=d.getEmitRateGradients();if(S){h.emitRateGradients=[];for(const d of S){const T={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?T.factor2=d.factor2:T.factor2=d.factor1,h.emitRateGradients.push(T)}}const r=d.getStartSizeGradients();if(r){h.startSizeGradients=[];for(const d of r){const T={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?T.factor2=d.factor2:T.factor2=d.factor1,h.startSizeGradients.push(T)}}const c=d.getLifeTimeGradients();if(c){h.lifeTimeGradients=[];for(const d of c){const T={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?T.factor2=d.factor2:T.factor2=d.factor1,h.lifeTimeGradients.push(T)}}const O=d.getLimitVelocityGradients();if(O){h.limitVelocityGradients=[];for(const d of O){const T={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?T.factor2=d.factor2:T.factor2=d.factor1,h.limitVelocityGradients.push(T)}h.limitVelocityDamping=d.limitVelocityDamping}d.noiseTexture&&(h.noiseTexture=d.noiseTexture.serialize())}clone(h,d){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Y={...this._customWrappers};let y=null;const C=this._engine;if(C.createEffectForParticles&&null!=this.customShader){y=this.customShader;const h=y.shaderOptions.defines.length>0?y.shaderOptions.defines.join("\n"):"",d=C.createEffectForParticles(y.shaderPath.fragmentElement,y.shaderOptions.uniforms,y.shaderOptions.samplers,h);Y[0]?Y[0].effect=d:this.setCustomEffect(d,0)}const n=this.serialize(T),X=Xd.Parse(n,this._scene||this._engine,this._rootUrl);return X.name=h,X.customShader=y,X._customWrappers=Y,void 0===d&&(d=this.nd),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.nd=d,this.preventAutoStart||X.start(),X}}Xd.BILLBOARDMODE_Y=2,Xd.BILLBOARDMODE_ALL=7,Xd.BILLBOARDMODE_STRETCHED=8,Xd.BILLBOARDMODE_STRETCHED_LOCAL=9,md._ParseParticleSystem=Xd.Parse;var Fd=T(12999),Ud=T(12990),Zd=T(12885);Zd.b.prototype.createTransformFeedback=function(){const h=this._gl.createTransformFeedback();if(!h)throw new Error("Unable to create Transform Feedback");return h},Zd.b.prototype.deleteTransformFeedback=function(h){this._gl.deleteTransformFeedback(h)},Zd.b.prototype.bindTransformFeedback=function(h){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,h)},Zd.b.prototype.beginTransformFeedback=function(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(h?this._gl.POINTS:this._gl.TRIANGLES)},Zd.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Zd.b.prototype.setTranformFeedbackVaryings=function(h,d){this._gl.transformFeedbackVaryings(h,d,this._gl.INTERLEAVED_ATTRIBS)},Zd.b.prototype.bindTransformFeedbackBuffer=function(h){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,h?h.underlyingResource:null)},Zd.b.prototype.readTransformFeedbackBuffer=function(h){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,h)};const Sd="clipPlaneFragmentDeclaration2",rd="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";E.e.IncludesShadersStore[Sd]||(E.e.IncludesShadersStore[Sd]=rd);T(14116),T(14121),T(14129),T(14138),T(14147),T(14151),T(14159),T(14168);const cd="gpuRenderParticlesPixelShader",Od="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";E.e.ShadersStore[cd]||(E.e.ShadersStore[cd]=Od);const fd="clipPlaneVertexDeclaration2",Jd="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";E.e.IncludesShadersStore[fd]||(E.e.IncludesShadersStore[fd]=Jd);T(14174),T(14183),T(14185),T(14191);const Wd="gpuRenderParticlesVertexShader",Ld="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";E.e.ShadersStore[Wd]||(E.e.ShadersStore[Wd]=Ld);class Dd extends F{static get IsSupported(){if(!P.d.LastCreatedEngine)return!1;const h=P.d.LastCreatedEngine.getCaps();return h.supportTransformFeedbacks||h.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(h){this._maxActiveParticleCount=Math.min(h,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(h){this.maxActiveParticleCount=h}createPointEmitter(h,d){const T=Qh(h,d);return this.particleEmitterType=T,T}createHemisphericEmitter(){const h=Ih(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createSphereEmitter(){const h=Ah(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=h,h}createDirectedSphereEmitter(){const h=Ph(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Y.pd(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Y.pd(0,1,0));return this.particleEmitterType=h,h}createCylinderEmitter(){const h=th(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=h,h}createDirectedCylinderEmitter(){const h=hd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Y.pd(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Y.pd(0,1,0));return this.particleEmitterType=h,h}createConeEmitter(){const h=dd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=h,h}createDirectedConeEmitter(){const h=Td(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Y.pd(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Y.pd(0,1,0));return this.particleEmitterType=h,h}createBoxEmitter(h,d,T,Y){const y=new S;return this.particleEmitterType=y,this.direction1=h,this.direction2=d,this.minEmitBox=T,this.maxEmitBox=Y,y}get flowMap(){return this._flowMap}set flowMap(h){this._flowMap!==h&&(this._flowMap=h)}isReady(){if(!this.nd||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Xd.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Xd.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Xd.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";h?setTimeout((()=>{this.start(0)}),h):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var h;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(h=this._customWrappers[d])||void 0===h?void 0:h.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[h]??this._customWrappers[0]}setCustomEffect(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[d]=new hh.d(this._engine),this._customWrappers[d].effect=h}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new I.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(h,d,T){return super._removeGradientAndTexture(h,d,T),this._releaseBuffers(),this}addColorGradient(h,d){this._colorGradients||(this._colorGradients=[]);const T=new M(h,d);return this._colorGradients.push(T),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(h&&this._colorGradients.sort(((h,d)=>h.gradient<d.gradient?-1:h.gradient>d.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(h){return this._removeGradientAndTexture(h,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const d in this._drawWrappers){var h;null===(h=this._drawWrappers[d].drawContext)||void 0===h||h.reset()}}_addFactorGradient(h,d,T){const Y=new R(d,T);h.push(Y),this._releaseBuffers()}addSizeGradient(h,d){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,h,d),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(h){return this._removeGradientAndTexture(h,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(h,d){if(!h)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&h.sort(((h,d)=>h.gradient<d.gradient?-1:h.gradient>d.gradient?1:0));const T=this;T[d]&&(T[d].dispose(),T[d]=null)}addAngularSpeedGradient(h,d){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,h,d),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(h){return this._removeGradientAndTexture(h,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(h,d){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,h,d),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(h){return this._removeGradientAndTexture(h,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(h,d){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,h,d),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(h){return this._removeGradientAndTexture(h,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(h,d){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,h,d),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(h){return this._removeGradientAndTexture(h,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(h){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(h,d,T){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(h),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.zd=new I.e,this.onStoppedObservable=new I.e,this.onStartedObservable=new I.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,T&&"Scene"!==T.getClassName()?(this._engine=T,this.defaultProjectionMatrix=Y.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=T||P.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Fr.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,X.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,X.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new hh.d(this._engine)},this._customWrappers[0].effect=y,this._drawWrappers={0:new hh.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(d=d??{}).randomTextureSize||delete d.randomTextureSize;const n={BX:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...d},F=d;isFinite(F)&&(n.BX=F),this._capacity=n.BX,this._maxActiveParticleCount=n.BX,this._currentActiveCount=0,this._isAnimationSheetEnabled=C,this.particleEmitterType=new S;const U=Math.min(this._engine.getCaps().maxTextureSize,n.randomTextureSize);let Z=[];for(let Y=0;Y<U;++Y)Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random());this._randomTexture=new A.b(new Float32Array(Z),U,1,5,T,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,Z=[];for(let Y=0;Y<U;++Y)Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random());this._randomTexture2=new A.b(new Float32Array(Z),U,1,5,T,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=U}_reset(){this._releaseBuffers()}_createVertexBuffers(h,d,T){const Y={};Y.position=d.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let y=3;Y.age=d.createVertexBuffer("age",y,1,this._attributesStrideSize,!0),y+=1,Y.size=d.createVertexBuffer("size",y,3,this._attributesStrideSize,!0),y+=3,Y.life=d.createVertexBuffer("life",y,1,this._attributesStrideSize,!0),y+=1,y+=4,this.billboardMode===Xd.BILLBOARDMODE_STRETCHED&&(Y.direction=d.createVertexBuffer("direction",y,3,this._attributesStrideSize,!0)),y+=3,this._platform.alignDataInBuffer&&(y+=1),this.particleEmitterType instanceof V&&(y+=3,this._platform.alignDataInBuffer&&(y+=1)),this._colorGradientsTexture||(Y.color=d.createVertexBuffer("color",y,4,this._attributesStrideSize,!0),y+=4),this._isBillboardBased||(Y.initialDirection=d.createVertexBuffer("initialDirection",y,3,this._attributesStrideSize,!0),y+=3,this._platform.alignDataInBuffer&&(y+=1)),this.noiseTexture&&(Y.noiseCoordinates1=d.createVertexBuffer("noiseCoordinates1",y,3,this._attributesStrideSize,!0),y+=3,this._platform.alignDataInBuffer&&(y+=1),Y.noiseCoordinates2=d.createVertexBuffer("noiseCoordinates2",y,3,this._attributesStrideSize,!0),y+=3,this._platform.alignDataInBuffer&&(y+=1)),Y.angle=d.createVertexBuffer("angle",y,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?y++:y+=2,this._isAnimationSheetEnabled&&(Y.cellIndex=d.createVertexBuffer("cellIndex",y,1,this._attributesStrideSize,!0),y+=1,this.spriteRandomStartCell&&(Y.cellStartOffset=d.createVertexBuffer("cellStartOffset",y,1,this._attributesStrideSize,!0),y+=1)),Y.offset=T.createVertexBuffer("offset",0,2),Y.uv=T.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(Y),this._platform.createVertexBuffers(h,Y),this.resetDrawCache()}_initialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!h)return;const d=this._engine,T=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof V&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const y=this.particleEmitterType instanceof V,C=Y.TmpVectors.pd[0];let n=0;for(let Y=0;Y<this._capacity;Y++)if(T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),y?(this.particleEmitterType.particleDestinationGenerator(Y,null,C),T.push(C.x),T.push(C.y),T.push(C.z)):(T.push(0),T.push(0),T.push(0)),this._platform.alignDataInBuffer&&T.push(0),n+=16,y&&(this.particleEmitterType.particlePositionGenerator(Y,null,C),T.push(C.x),T.push(C.y),T.push(C.z),this._platform.alignDataInBuffer&&T.push(0),n+=4),this._colorGradientsTexture||(T.push(0),T.push(0),T.push(0),T.push(0),n+=4),this.isBillboardBased||(T.push(0),T.push(0),T.push(0),this._platform.alignDataInBuffer&&T.push(0),n+=4),this.noiseTexture&&(T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),this._platform.alignDataInBuffer&&T.push(0),T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),this._platform.alignDataInBuffer&&T.push(0),n+=8),T.push(0),n+=1,this._angularSpeedGradientsTexture||(T.push(0),n+=1),this._isAnimationSheetEnabled&&(T.push(0),n+=1,this.spriteRandomStartCell&&(T.push(0),n+=1)),this._platform.alignDataInBuffer){let h=3-(n+3&3);for(n+=h;h-- >0;)T.push(0)}const X=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),F=this._platform.createParticleBuffer(T),U=this._platform.createParticleBuffer(T);this._buffer0=new i.e(d,F,!1,this._attributesStrideSize),this._buffer1=new i.e(d,U,!1,this._attributesStrideSize),this._spriteBuffer=new i.e(d,X,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let h=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(h+="\n#define BILLBOARD"),this._colorGradientsTexture&&(h+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(h+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(h+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(h+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(h+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(h+="\n#define DRAGGRADIENTS"),this._flowMap&&(h+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(h+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(h+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(h+="\n#define NOISE"),this.isLocal&&(h+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===h||(this._cachedUpdateDefines=h,this._updateBuffer=this._platform.createUpdateBuffer(h)),this._platform.isUpdateBufferReady()}_getWrapper(h){const d=this._getCustomDrawWrapper(h);if(null!==d&&void 0!==d&&d.effect)return d;const T=[];this.fillDefines(T,h);let Y=this._drawWrappers[h];Y||(Y=new hh.d(this._engine),Y.drawContext&&(Y.drawContext.useInstancing=!0),this._drawWrappers[h]=Y);const y=T.join("\n");if(Y.defines!==y){const h=[],d=[],T=[];this.fillUniformsAttributesAndSamplerNames(d,h,T),Y.setEffect(this._engine.createEffect("gpuRenderParticles",h,d,T,y),y)}return Y}static _GetAttributeNamesOrOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const y=[i.g.PositionKind,"age","life","size","angle"];return h||y.push(i.g.ColorKind),d&&y.push("cellIndex"),T||y.push("initialDirection"),Y&&y.push("direction"),y.push("offset",i.g.UVKind),y}static _GetEffectCreationOptions(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Y=["emitterWM","gU","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,dh.d)(Y),h&&Y.push("sheetInfos"),d&&Y.push("logarithmicDepthConstant"),T&&(Y.push("vFogInfos"),Y.push("vFogColor")),Y}fillDefines(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,dh.h)(this,this._scene,h),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Ud.d.FOGMODE_NONE&&h.push("#define FOG")),d===Xd.BLENDMODE_MULTIPLY&&h.push("#define BLENDMULTIPLYMODE"),this.isLocal&&h.push("#define LOCAL"),this.useLogarithmicDepth&&h.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(h.push("#define BILLBOARD"),this.billboardMode){case Xd.BILLBOARDMODE_Y:h.push("#define BILLBOARDY");break;case Xd.BILLBOARDMODE_STRETCHED:h.push("#define BILLBOARDSTRETCHED");break;case Xd.BILLBOARDMODE_ALL:h.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&h.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&h.push("#define ANIMATESHEET"),T&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),h.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(h,d,T){d.push(...Dd._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Xd.BILLBOARDMODE_STRETCHED)),h.push(...Dd._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),T.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Fd.b.PrepareUniforms(h,this._imageProcessingConfigurationDefines),Fd.b.PrepareSamplers(T,this._imageProcessingConfigurationDefines))}animate(){var h;let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(d?this.preWarmStepOffset:(null===(h=this._scene)||void 0===h?void 0:h.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(h,d){const T=this[d];if(!h||!h.length||T)return;const Y=new Float32Array(this._rawTextureWidth);for(let y=0;y<this._rawTextureWidth;y++){const d=y/this._rawTextureWidth;Q.GetCurrentGradient(d,h,((h,d,T)=>{Y[y]=(0,U.Lerp)(h.factor1,d.factor1,T)}))}this[d]=A.b.CreateRTexture(Y,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[d].name=d.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const h=new Uint8Array(4*this._rawTextureWidth),d=n.TmpColors.ln[0];for(let T=0;T<this._rawTextureWidth;T++){const Y=T/this._rawTextureWidth;Q.GetCurrentGradient(Y,this._colorGradients,((Y,y,C)=>{n.ln.LerpToRef(Y.color1,y.color1,C,d),h[4*T]=255*d.r,h[4*T+1]=255*d.g,h[4*T+2]=255*d.b,h[4*T+3]=255*d.a}))}this._colorGradientsTexture=A.b.CreateRGBATexture(h,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(h,d){var T,y,C,n;const X=this._getWrapper(h),F=X.effect;this._engine.enableEffect(X);const U=(null===(T=this._scene)||void 0===T?void 0:T.getViewMatrix())||Y.Matrix.IdentityReadOnly;if(F.setMatrix("view",U),F.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),F.setTexture("diffuseSampler",this.particleTexture),F.setVector2("translationPivot",this.translationPivot),F.setVector3("gU",this.gU),this.isLocal&&F.setMatrix("emitterWM",d),this._colorGradientsTexture?F.setTexture("colorGradientSampler",this._colorGradientsTexture):F.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const h=this.particleTexture.getBaseSize();F.setFloat3("sheetInfos",this.spriteCellWidth/h.width,this.spriteCellHeight/h.height,h.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const h=this._scene.activeCamera;F.setVector3("eyePosition",h.globalPosition)}const Z=F.defines;if(this._scene&&((0,dh.e)(F,this,this._scene),this.applyFog&&(0,Th.e)(this._scene,void 0,F)),Z.indexOf("#define BILLBOARDMODE_ALL")>=0){const h=U.clone();h.invert(),F.setMatrix("invView",h)}return this.useLogarithmicDepth&&this._scene&&(0,Th.i)(Z,F,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(F),this._setEngineBasedOnBlendMode(h),this._platform.bindDrawBuffers(this._targetIndex,F,null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(F),null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(n=this._scene)&&void 0!==n&&n.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(h){if(!this.nd||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!h)if(this.nd.position){h=this.nd.getWorldMatrix()}else{const d=this.nd;h=Y.TmpVectors.Matrix[0],Y.Matrix.TranslationToRef(d.x,d.y,d.z,h)}const d=this._engine,T=d.getDepthWrite();if(d.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const h=this.Eh();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",h.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",h),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const y=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=y,d.setDepthWrite(T)}render(){let h,d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!d&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let h=0;h<this.preWarmCycles;h++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const h=0|this._accumulatedCount;this._accumulatedCount-=h,this._currentActiveCount+=h}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.nd.position){h=this.nd.getWorldMatrix()}else{const d=this.nd;h=Y.TmpVectors.Matrix[0],Y.Matrix.TranslationToRef(d.x,d.y,d.z,h)}const y=this._engine;this.updateInAnimate||this._update(h);let C=0;return d||T||(y.setState(!1),this.forceDepthWrite&&y.setDepthWrite(!0),C=this.blendMode===Xd.BLENDMODE_MULTIPLYADD?this._render(Xd.BLENDMODE_MULTIPLY,h)+this._render(Xd.BLENDMODE_ADD,h):this._render(this.blendMode,h),this._engine.setAlphaMode(0)),C}rebuild(){const h=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(h,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,h()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const d in this._drawWrappers){this._drawWrappers[d].dispose()}if(this._drawWrappers={},this._scene){const h=this._scene.Fr.indexOf(this);h>-1&&this._scene.Fr.splice(h,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let d=0;d<this._renderVertexBuffers.length;++d){const h=this._renderVertexBuffers[d];for(const d in h)h[d].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),h&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),h&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.zd.notifyObservers(this),this.zd.clear()}clone(h,d){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Y={...this._customWrappers};let y=null;const C=this._engine;if(C.createEffectForParticles&&null!=this.customShader){y=this.customShader;const h=y.shaderOptions.defines.length>0?y.shaderOptions.defines.join("\n"):"";Y[0]=C.createEffectForParticles(y.shaderPath.fragmentElement,y.shaderOptions.uniforms,y.shaderOptions.samplers,h,void 0,void 0,void 0,this)}const n=this.serialize(T),X=Dd.Parse(n,this._scene||this._engine,this._rootUrl);return X.name=h,X.customShader=y,X._customWrappers=Y,void 0===d&&(d=this.nd),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.nd=d,X}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};return Xd._Serialize(d,this,h),d.activeParticleCount=this.activeParticleCount,d.randomTextureSize=this._randomTextureSize,d.customShader=this.customShader,d}static Parse(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],y=arguments.length>4?arguments[4]:void 0;const C=h.name;let n,X;d instanceof Rh.c?n=d:(X=d,n=X.getEngine());const F=new Dd(C,{BX:y||h.BX,randomTextureSize:h.randomTextureSize},d,null,h.isAnimationSheetEnabled);if(F._rootUrl=T,h.customShader&&n.createEffectForParticles){const d=h.customShader,T=d.shaderOptions.defines.length>0?d.shaderOptions.defines.join("\n"):"",Y=n.createEffectForParticles(d.shaderPath.fragmentElement,d.shaderOptions.uniforms,d.shaderOptions.samplers,T,void 0,void 0,void 0,F);F.setCustomEffect(Y,0),F.customShader=d}return h.id&&(F.id=h.id),h.activeParticleCount&&(F.activeParticleCount=h.activeParticleCount),Xd._Parse(h,F,d,T),h.preventAutoStart&&(F.preventAutoStart=h.preventAutoStart),Y||F.preventAutoStart||F.start(),F}}var Vd=T(12574),id=T(14199),wd=T(13140);class sd{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(h){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const d of this.systems)d.nd=h;this._emitterNode=h}setEmitterAsSphere(h,d,T){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:h,renderingGroupId:d};const Y=(0,id.d)("emitterSphere",{diameter:h.diameter,segments:h.segments},T);Y.renderingGroupId=d;const y=new wd.jd("emitterSphereMaterial",T);y.emissiveColor=h.color,Y.material=y;for(const C of this.systems)C.nd=Y;this._emitterNode=Y}start(h){for(const d of this.systems)h&&(d.nd=h),d.start()}dispose(){for(const h of this.systems)h.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={systems:[]};for(const T of this.systems)d.systems.push(T.serialize(h));return this._emitterNode&&(d.nd=this._emitterCreationOptions),d}static Parse(h,d){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Y=arguments.length>3?arguments[3]:void 0;const y=new sd,C=this.BaseAssetsUrl+"/textures/";d=d||P.d.LastCreatedScene;for(const n of h.systems)y.systems.push(T?Dd.Parse(n,d,C,!0,Y):Xd.Parse(n,d,C,!0,Y));if(h.nd){const T=h.nd.options;if("Sphere"===h.nd.kind)y.setEmitterAsSphere({diameter:T.diameter,segments:T.segments,color:n.ed.Bd(T.color)},h.nd.renderingGroupId,d)}return y}}sd.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Ed=T(12623);class zd{static CreateDefault(h){let d,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,Y=arguments.length>2?arguments[2]:void 0;d=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Dd("default system",{BX:T},Y):new Xd("default system",T,Y),d.nd=h;const y=Vd.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return d.particleTexture=new N.c(y,d.Eh()),d.createConeEmitter(.1,Math.PI/4),d.color1=new n.ln(1,1,1,1),d.color2=new n.ln(1,1,1,1),d.colorDead=new n.ln(1,1,1,0),d.minSize=.1,d.maxSize=.1,d.minEmitPower=2,d.maxEmitPower=2,d.updateSpeed=1/60,d.emitRate=30,d}static CreateAsync(h,d){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Y=arguments.length>3?arguments[3]:void 0;d||(d=P.d.LastCreatedScene);const y={};return d.addPendingData(y),new Promise(((C,n)=>{if(T&&!Dd.IsSupported)return d.removePendingData(y),n("Particle system with GPU is not supported.");Vd.Tools.LoadFile(`${zd.BaseAssetsUrl}/systems/${h}.json`,(h=>{d.removePendingData(y);const n=JSON.parse(h.toString());return C(sd.Parse(n,d,T,Y))}),void 0,void 0,void 0,(()=>(d.removePendingData(y),n(`An error occurred with the creation of your particle system. Check if your type '${h}' exists.`))))}))}static ExportSet(h){const d=new sd;for(const T of h)d.systems.push(T);return d}static ParseFromFileAsync(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3],y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",C=arguments.length>5?arguments[5]:void 0;return new Promise(((n,X)=>{const F=new Ed.b;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){const d=JSON.parse(F.responseText);let X;X=Y?Dd.Parse(d,T,y,!1,C):Xd.Parse(d,T,y,!1,C),h&&(X.name=h),n(X)}else X("Unable to load the particle system")})),F.open("GET",d),F.send()}))}static ParseFromSnippetAsync(h,d){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",y=arguments.length>4?arguments[4]:void 0;if("_BLANK"===h){const h=this.CreateDefault(null);return h.start(),Promise.resolve(h)}return new Promise(((C,n)=>{const X=new Ed.b;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const n=JSON.parse(JSON.parse(X.responseText).jsonPayload),F=JSON.parse(n.particleSystem);let U;U=T?Dd.Parse(F,d,Y,!1,y):Xd.Parse(F,d,Y,!1,y),U.snippetId=h,C(U)}else n("Unable to load the snippet "+h)})),X.open("GET",this.SnippetUrl+"/"+h.replace(/#/g,"/")),X.send()}))}}zd.BaseAssetsUrl=sd.BaseAssetsUrl,zd.SnippetUrl="https://snippet.babylonjs.com",zd.CreateFromSnippetAsync=zd.ParseFromSnippetAsync;var xd=T(13213),gd=T(13032),Hd=T(14206);(0,Hd.f)(gd.e.NAME_PARTICLESYSTEM,((h,d,T,Y)=>{const y=(0,Hd.g)(gd.e.NAME_PARTICLESYSTEM);if(y&&void 0!==h.Fr&&null!==h.Fr)for(let C=0,n=h.Fr.length;C<n;C++){const n=h.Fr[C];T.Fr.push(y(n,d,Y))}})),(0,Hd.e)(gd.e.NAME_PARTICLESYSTEM,((h,d,T)=>{if(h.activeParticleCount){return Dd.Parse(h,d,T)}return Xd.Parse(h,d,T)})),Rh.c.prototype.createEffectForParticles=function(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",C=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0,X=arguments.length>6?arguments[6]:void 0,F=arguments.length>7?arguments[7]:void 0,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Z=arguments.length>9?arguments[9]:void 0,S=[],r=[];const c=[];return F?F.fillUniformsAttributesAndSamplerNames(r,S,c):(S=Xd._GetAttributeNamesOrOptions(),r=Xd._GetEffectCreationOptions()),-1===y.indexOf(" BILLBOARD")&&(y+="\n#define BILLBOARD\n"),null!==F&&void 0!==F&&F.isAnimationSheetEnabled&&-1===y.indexOf(" ANIMATESHEET")&&(y+="\n#define ANIMATESHEET\n"),-1===Y.indexOf("diffuseSampler")&&Y.push("diffuseSampler"),this.createEffect({vertex:Z??(null===F||void 0===F?void 0:F.vertexShaderName)??"particles",fragmentElement:h},S,r.concat(d),c.concat(Y),y,C,n,X,void 0,U,(async()=>{0===U?await Promise.resolve().then(T.bind(T,14234)):await Promise.resolve().then(T.bind(T,14295))}))},xd.d.prototype.getEmittedParticleSystems=function(){const h=[];for(let d=0;d<this.Eh().Fr.length;d++){const T=this.Eh().Fr[d];T.nd===this&&h.push(T)}return h},xd.d.prototype.getHierarchyEmittedParticleSystems=function(){const h=[],d=this.getDescendants();d.push(this);for(let T=0;T<this.Eh().Fr.length;T++){const Y=this.Eh().Fr[T],y=Y.nd;y.position&&-1!==d.indexOf(y)&&h.push(Y)}return h};T(13107),T(13113),T(13198);T(13200),T(14210),T(12949),T(13095),T(13236);T(12942);var pd;T(14215),T(12791);!function(h){h[h.Color=2]="Color",h[h.UV=1]="UV",h[h.Random=0]="Random",h[h.Stated=3]="Stated"}(pd||(pd={}));var kd=T(12979);const od=new Y.pd(0,0,0),ud=new Y.pd(0,0,0),Nd=new Y.pd(0,0,0);class Kd{constructor(h,d,T){this.width=h,this.height=d,this.data=T}processFlowable(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2?arguments[2]:void 0;if(!T)return;T instanceof Y.Matrix?Y.pd.TransformCoordinatesToRef(h.position,T,Nd):(Nd.x=T.x,Nd.y=T.y,Nd.z=T.z);const y=.5*Nd.x+.5,C=1-(.5*Nd.y+.5),n=Math.floor(y*this.width),X=Math.floor(C*this.height);if(n<0||n>=this.width||X<0||X>=this.height)return;const F=4*(X*this.width+n),U=this.data[F]/255*2-1,Z=this.data[F+1]/255*2-1,S=this.data[F+2]/255*2-1,r=this.data[F+3]/255;od.set(U,Z,S),od.scaleToRef(d*r,ud),h.direction.addInPlace(ud)}_processParticle(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2?arguments[2]:void 0;this.processFlowable(h,d,T)}static async FromUrlAsync(h){return await new Promise(((d,T)=>{const Y=document.createElement("canvas"),y=Y.getContext("2d");let C=null;const n=new Image;n.crossOrigin="anonymous",n.src=h,n.onerror=d=>{T(new Error(`Failed to load image: ${h} : ${d}`))},n.onload=()=>{Y.width=n.width,Y.height=n.height,y.drawImage(n,0,0),C=y.getImageData(0,0,Y.width,Y.height),d(new Kd(Y.width,Y.height,C.data))}}))}static async ExtractFromTextureAsync(h){return await new Promise(((d,T)=>{if(!h.isReady())return void h.onLoadObservable.addOnce((async()=>{try{const T=await this.ExtractFromTextureAsync(h);d(T)}catch(Y){T(Y)}}));const Y=h.getSize();kd.g.GetTextureDataAsync(h,Y.width,Y.height).then((h=>{d(new Kd(Y.width,Y.height,new Uint8ClampedArray(h)))})).catch(T)}))}}var ld,qd,jd,ad,ed,vd,Gd,bd,Bd;!function(h){h[h.Int=1]="Int",h[h.Float=2]="Float",h[h.Vector2=4]="Vector2",h[h.pd=8]="pd",h[h.Matrix=16]="Matrix",h[h.Particle=32]="Particle",h[h.Texture=64]="Texture",h[h.ln=128]="ln",h[h.FloatGradient=256]="FloatGradient",h[h.Vector2Gradient=512]="Vector2Gradient",h[h.Vector3Gradient=1024]="Vector3Gradient",h[h.Color4Gradient=2048]="Color4Gradient",h[h.System=4096]="System",h[h.AutoDetect=8192]="AutoDetect",h[h.BasedOnInput=16384]="BasedOnInput",h[h.Undefined=32768]="Undefined",h[h.All=65535]="All"}(ld||(ld={})),function(h){h[h.Compatible=0]="Compatible",h[h.TypeIncompatible=1]="TypeIncompatible",h[h.HierarchyIssue=2]="HierarchyIssue"}(qd||(qd={})),function(h){h[h.Input=0]="Input",h[h.Output=1]="Output"}(jd||(jd={}));class Md{get direction(){return this._direction}get type(){if(this._type===ld.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===ld.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(h){this._type=h}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((h=>h.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(h,d,T){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=ld.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new I.e,this.onDisconnectionObservable=new I.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=d,this.name=h,this._direction=T}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(h){var d;return this.isConnected?null!==(d=this._connectedPoint)&&void 0!==d&&d._storedFunction?this._connectedPoint._storedFunction(h):this._connectedPoint._storedValue:this.value}canConnectTo(h){return 0===this.checkCompatibilityState(h)}checkCompatibilityState(h){const d=this._ownerBlock,T=h.ownerBlock;if(this.type!==h.type&&h.innerType!==ld.AutoDetect)return h.acceptedConnectionPointTypes&&-1!==h.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(h.excludedConnectionPointTypes&&-1!==h.excludedConnectionPointTypes.indexOf(this.type))return 1;let Y=T,y=d;return 0===this.direction&&(Y=d,y=T),Y.isAnAncestorOf(y)?2:0}connectTo(h){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(h))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${h.ownerBlock.name}".${h.name}`;return this._endpoints.push(h),h._connectedPoint=this,this.onConnectionObservable.notifyObservers(h),h.onConnectionObservable.notifyObservers(this),this}disconnectFrom(h){const d=this._endpoints.indexOf(h);return-1===d||(this._endpoints.splice(d,1),h._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(h),h.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(h){let d=1;for(;d<ld.All;)h&d||this.excludedConnectionPointTypes.push(d),d<<=1}serialize(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const d={};return d.name=this.name,d.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.ad?(d.valueType="BABYLON."+this.value.getClassName(),d.value=this.value.ad()):(d.valueType="number",d.value=this.value)),h&&this.connectedPoint&&(d.inputName=this.name,d.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,d.targetConnectionName=this.connectedPoint.name,d.isExposedOnFrame=!0,d.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(d.isExposedOnFrame=!0,d.exposedPortPosition=this.exposedPortPosition),d}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class mT{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(h){this._name=h}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(h){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new I.e,this.zd=new I.e,this.onInputChangedObservable=new I.e,this.visibleOnFrame=!1,this._name=h,this.uniqueId=K.c.UniqueId}_inputRename(h){return h}_outputRename(h){return h}isAnAncestorOf(h){for(const d of this._outputs)if(d.hasEndpoints)for(const T of d.endpoints){if(T.ownerBlock===h)return!0;if(T.ownerBlock.isAnAncestorOf(h))return!0}return!1}isAnAncestorOfType(h){if(this.getClassName()===h)return!0;for(const d of this._outputs)if(d.hasEndpoints)for(const T of d.endpoints)if(T.ownerBlock.isAnAncestorOfType(h))return!0;return!1}getInputByName(h){const d=this._inputs.filter((d=>d.name===h));return d.length?d[0]:null}_linkConnectionTypes(h,d){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[d]._acceptedConnectionPointType=this._inputs[h]:(this._inputs[h]._linkedConnectionSource=this._inputs[d],this._inputs[h]._isMainLinkSource=!0),this._inputs[d]._linkedConnectionSource=this._inputs[h]}registerInput(h,d){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Y=arguments.length>3?arguments[3]:void 0,y=arguments.length>4?arguments[4]:void 0,C=arguments.length>5?arguments[5]:void 0;const n=new Md(h,this,0);return n.type=d,n.isOptional=T,n.defaultValue=Y,n.value=Y,n.valueMin=y,n.valueMax=C,this._inputs.push(n),this.onInputChangedObservable.notifyObservers(n),this}registerOutput(h,d,T){return(T=T??new Md(h,this,1)).type=d,this._outputs.push(T),this}_build(h){}_customBuildStep(h){}build(h){if(this._buildId===h.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((h=>h.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=h.buildId;for(const d of this._inputs){if(!d.connectedPoint){d.isOptional||h.notConnectedNonOptionalInputs.push(d);continue}const T=d.connectedPoint.ownerBlock;T&&T!==this&&!T.isSystem&&T.build(h)}return this._customBuildStep(h),h.verbose&&l.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(h),this.onBuildObservable.notifyObservers(this),!1}serialize(){const h={};h.customType="BABYLON."+this.getClassName(),h.id=this.uniqueId,h.name=this.name,h.visibleOnFrame=this.visibleOnFrame,h.inputs=[],h.outputs=[];for(const d of this.inputs)h.inputs.push(d.serialize());for(const d of this.outputs)h.outputs.push(d.serialize(!1));return h}_deserialize(h){this._name=h.name,this.comments=h.comments,this.visibleOnFrame=!!h.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(h)}_deserializePortDisplayNamesAndExposedOnFrame(h){const d=h.inputs,T=h.outputs;if(d)for(const Y of d){const h=this.inputs.find((h=>h.name===Y.name));if(!h)return;if(Y.displayName&&(h.displayName=Y.displayName),Y.isExposedOnFrame&&(h.isExposedOnFrame=Y.isExposedOnFrame,h.exposedPortPosition=Y.exposedPortPosition),void 0!==Y.value&&null!==Y.value)if("number"===Y.valueType)h.value=Y.value;else{const d=(0,X.d)(Y.valueType);d&&(h.value=d.Bd(Y.value))}}if(T)for(let Y=0;Y<T.length;Y++){const h=T[Y];h.displayName&&(this.outputs[Y].displayName=h.displayName),h.isExposedOnFrame&&(this.outputs[Y].isExposedOnFrame=h.isExposedOnFrame,this.outputs[Y].exposedPortPosition=h.exposedPortPosition)}}clone(){const h=this.serialize(),d=(0,X.d)(h.customType);if(d){const T=new d;return T._deserialize(h),T}return null}dispose(){this.zd.notifyObservers(this),this.zd.clear();for(const h of this.inputs)h.dispose();for(const h of this.outputs)h.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Rd(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",Y=arguments.length>3?arguments[3]:void 0;return(y,C)=>{let n=y._propStore;n||(n=[],y._propStore=n),n.push({propertyName:C,displayName:h,type:d,groupName:T,options:Y??{},className:y.getClassName()})}}(0,k.c)([(0,o.E)("comment")],mT.prototype,"comments",void 0),function(h){h[h.Boolean=0]="Boolean",h[h.Float=1]="Float",h[h.Int=2]="Int",h[h.Vector2=3]="Vector2",h[h.List=4]="List",h[h.ln=5]="ln",h[h.SamplingMode=6]="SamplingMode",h[h.TextureFormat=7]="TextureFormat",h[h.TextureType=8]="TextureType"}(ad||(ad={})),function(h){h[h.None=0]="None",h[h.Position=1]="Position",h[h.Direction=2]="Direction",h[h.Age=3]="Age",h[h.Lifetime=4]="Lifetime",h[h.Color=5]="Color",h[h.ScaledDirection=6]="ScaledDirection",h[h.Scale=7]="Scale",h[h.AgeGradient=8]="AgeGradient",h[h.Angle=9]="Angle",h[h.SpriteCellIndex=16]="SpriteCellIndex",h[h.SpriteCellStart=17]="SpriteCellStart",h[h.SpriteCellEnd=18]="SpriteCellEnd"}(ed||(ed={})),function(h){h[h.None=0]="None",h[h.Time=1]="Time",h[h.Delta=2]="Delta",h[h.Emitter=3]="Emitter"}(vd||(vd={}));class Qd{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let h="";for(const d of this.notConnectedNonOptionalInputs)h+=`input ${d.name} from block ${d.ownerBlock.name}[${d.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(h)throw"Build of Node Particle System Set failed:\n"+h}adapt(h,d){const T=h.getConnectedValue(this)||0;if(h.type===d)return T;switch(d){case ld.Vector2:return new Y.Vector2(T,T);case ld.pd:return new Y.pd(T,T,T);case ld.ln:return new n.ln(T,T,T,T)}return null}getContextualValue(h){if(!this.particleContext||!this.systemContext)return null;switch(h){case ed.Position:return this.particleContext.position;case ed.Direction:return this.particleContext.direction;case ed.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case ed.Color:return this.particleContext.color;case ed.Age:return this.particleContext.age;case ed.Lifetime:return this.particleContext.lifeTime;case ed.Angle:return this.particleContext.angle;case ed.Scale:return this.particleContext.scale;case ed.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case ed.SpriteCellEnd:return this.systemContext.endSpriteCellID;case ed.SpriteCellIndex:return this.particleContext.cellIndex;case ed.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.nd.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.nd.absolutePosition:this.systemContext.nd:null}getSystemValue(h){if(!this.particleContext||!this.systemContext)return null;switch(h){case vd.Time:return this.systemContext._actualFrame;case vd.Delta:return this.systemContext._scaledUpdateSpeed;case vd.Emitter:if(this.isEmitterTransformNode){return this.systemContext.nd.absolutePosition}return this.systemContext.nd}return null}}function Id(h,d,T){const Y=new Qd;Y.qd=d;const y=h.createSystem(Y);return y.canStart=()=>!0,y.nd=T.clone(),y.disposeOnStop=!0,y.start(),y}class Ad extends mT{constructor(h){super(h),this.blendMode=F.BLENDMODE_ONEONE,this.BX=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",ld.Particle),this.registerInput("texture",ld.Texture),this.registerInput("onStart",ld.System,!0),this.registerInput("onEnd",ld.System,!0),this.registerOutput("system",ld.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(h){h.BX=this.BX,h.buildId=this._buildId++,this.build(h);const d=this.particle.getConnectedValue(h);return d.particleTexture=this.texture.getConnectedValue(h),d.emitRate=this.emitRate,d.blendMode=this.blendMode,d.name=this.name,d._nodeGenerated=!0,d._targetStopDuration=this.targetStopDuration,d.startDelay=this.startDelay,this.system._storedValue=this,d.canStart=()=>!this.doNoStart,d.onStartedObservable.add((T=>{const Y=this.onStart.getConnectedValue(h);Y&&T.onStartedObservable.addOnce((()=>{h.systemContext=d;const T=Id(Y,h.qd,h.emitterPosition);this.zd.addOnce((()=>{T.dispose()}))}));const y=this.onEnd.getConnectedValue(h);y&&T.onStoppedObservable.addOnce((()=>{h.systemContext=d;const T=Id(y,h.qd,h.emitterPosition);this.zd.addOnce((()=>{T.dispose()}))}))})),this.zd.addOnce((()=>{d.dispose()})),d}serialize(){const h=super.serialize();return h.BX=this.BX,h.emitRate=this.emitRate,h.blendMode=this.blendMode,h.doNoStart=this.doNoStart,h.targetStopDuration=this.targetStopDuration,h.startDelay=this.startDelay,h}_deserialize(h){super._deserialize(h),this.BX=h.BX,this.emitRate=h.emitRate,this.doNoStart=!!h.doNoStart,void 0!==h.blendMode&&(this.blendMode=h.blendMode),void 0!==h.targetStopDuration&&(this.targetStopDuration=h.targetStopDuration),void 0!==h.startDelay&&(this.startDelay=h.startDelay)}}(0,k.c)([Rd("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:F.BLENDMODE_ONEONE},{label:"Standard",value:F.BLENDMODE_STANDARD},{label:"Add",value:F.BLENDMODE_ADD},{label:"Multiply",value:F.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:F.BLENDMODE_MULTIPLYADD}]})],Ad.prototype,"blendMode",void 0),(0,k.c)([Rd("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Ad.prototype,"BX",void 0),(0,k.c)([Rd("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ad.prototype,"emitRate",void 0),(0,k.c)([Rd("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ad.prototype,"targetStopDuration",void 0),(0,k.c)([Rd("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ad.prototype,"startDelay",void 0),(0,k.c)([Rd("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ad.prototype,"doNoStart",void 0),(0,X.e)("BABYLON.SystemBlock",Ad);class Pd extends mT{get type(){if(this._type===ld.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=ld.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=ld.Vector2,this._type;case"pd":return this._type=ld.pd,this._type;case"ln":return this._type=ld.ln,this._type;case"Matrix":return this._type=ld.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===ed.None&&this._systemSource!==vd.None}get systemSource(){return this._systemSource}set systemSource(h){if(this._systemSource=h,h!==vd.None){switch(this._contextualSource=ed.None,this._type=ld.Float,h){case vd.Time:case vd.Delta:this._type=ld.Float;break;case vd.Emitter:this._type=ld.pd}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==ed.None}get contextualValue(){return this._contextualSource}set contextualValue(h){if(this._contextualSource=h,h!==ed.None){switch(this._systemSource=vd.None,h){case ed.Scale:this._type=ld.Vector2;break;case ed.Position:case ed.Direction:case ed.ScaledDirection:this._type=ld.pd;break;case ed.Color:this._type=ld.ln;break;case ed.Age:case ed.Lifetime:case ed.Angle:case ed.AgeGradient:this._type=ld.Float;break;case ed.SpriteCellEnd:case ed.SpriteCellStart:case ed.SpriteCellIndex:this._type=ld.Int}this.output&&(this.output.type=this._type)}}constructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ld.AutoDetect;super(h),this._type=ld.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new I.e,this._systemSource=vd.None,this._contextualSource=ed.None,this._type=d,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",d)}get value(){return this._storedValue}set value(h){this.type===ld.Float&&this.min!==this.max&&(h=Math.max(this.min,h),h=Math.min(this.max,h)),this._storedValue=h,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(h){this._valueCallback=h}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case ld.Int:case ld.Float:this.value=0;break;case ld.Vector2:this.value=Y.Vector2.Zero();break;case ld.pd:this.value=Y.pd.Zero();break;case ld.ln:this.value=new n.ln(1,1,1,1);break;case ld.Matrix:this.value=Y.Matrix.Identity()}}_build(h){super._build(h),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=h=>h.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=h=>h.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const h=super.serialize();return h.type=this.type,h.contextualValue=this.contextualValue,h.systemSource=this.systemSource,h.min=this.min,h.max=this.max,h.groupInInspector=this.groupInInspector,h.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.ad?(h.valueType="BABYLON."+this._storedValue.getClassName(),h.value=this._storedValue.ad()):(h.valueType="number",h.value=this._storedValue)),h}_deserialize(h){if(super._deserialize(h),this._type=h.type,this.contextualValue=h.contextualValue,this.systemSource=h.systemSource||vd.None,this.min=h.min||0,this.max=h.max||0,this.groupInInspector=h.groupInInspector||"",void 0!==h.displayInInspector&&(this.displayInInspector=h.displayInInspector),h.valueType)if("number"===h.valueType)this._storedValue=h.value;else{const d=(0,X.d)(h.valueType);d&&(this._storedValue=d.Bd(h.value))}}}(0,X.e)("BABYLON.ParticleInputBlock",Pd);class td extends mT{get url(){return this._url}set url(h){this._url!==h&&(this._cachedData=null,this._url=h,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(h){this._textureDataUrl!==h&&(this._cachedData=null,this._textureDataUrl=h,this._url="",this._sourceTexture=null)}set sourceTexture(h){this._sourceTexture!==h&&(this._cachedData=null,this._sourceTexture=h,this._url="",this._textureDataUrl="")}constructor(h){super(h),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",ld.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const h=this.texture._storedValue;return await new Promise(((d,T)=>{if(!h.isReady())return void h.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),d(this._cachedData)}catch(h){T(h)}}));const Y=h.getSize();kd.g.GetTextureDataAsync(h,Y.width,Y.height).then((T=>{this._cachedData={width:Y.width,height:Y.height,data:new Uint8ClampedArray(T)},h.dispose(),d(this._cachedData)})).catch(T)}))}_build(h){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new N.c(this._textureDataUrl,h.qd):this.texture._storedValue=new N.c(this._url,h.qd):this.texture._storedValue=null}serialize(){const h=super.serialize();return h.url=this.url,h.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(h.textureDataUrl=this.textureDataUrl),h}_deserialize(h){super._deserialize(h),this.url=h.url,this.serializedCachedData=!!h.serializedCachedData,h.textureDataUrl&&(this.textureDataUrl=h.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,X.e)("BABYLON.ParticleTextureSourceBlock",td);class hT extends mT{constructor(h){super(h),this.registerInput("particle",ld.Particle),this.registerInput("position",ld.pd),this.registerOutput("output",ld.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(h){const d=this.particle.getConnectedValue(h);if(this.output._storedValue=d,!this.position.isConnected)return;const T={process:T=>{h.particleContext=T,h.systemContext=d,T.position.C(this.position.getConnectedValue(h))},previousItem:null,nextItem:null};d._updateQueueStart?vh(T,d._updateQueueStart):d._updateQueueStart=T}}(0,X.e)("BABYLON.UpdatePositionBlock",hT),function(h){h[h.Add=0]="Add",h[h.Subtract=1]="Subtract",h[h.Multiply=2]="Multiply",h[h.Divide=3]="Divide",h[h.Max=4]="Max",h[h.Min=5]="Min"}(Gd||(Gd={}));class dT extends mT{constructor(h){super(h),this.operation=Gd.Add,this.registerInput("left",ld.AutoDetect),this.registerInput("right",ld.AutoDetect),this.registerOutput("output",ld.BasedOnInput),this.output._typeConnectionSource=this.left;const d=[ld.Matrix,ld.Particle,ld.Texture,ld.System,ld.FloatGradient,ld.Color4Gradient,ld.Vector2Gradient,ld.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...d),this.right.excludedConnectionPointTypes.push(...d),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(h){let d;const T=this.left,y=this.right;if(!T.isConnected||!y.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const C=T.type===ld.Float||T.type===ld.Int,X=y.type===ld.Float||y.type===ld.Int,F=C&&X;switch(this.operation){case Gd.Add:d=F?h=>T.getConnectedValue(h)+y.getConnectedValue(h):C?h=>h.adapt(T,y.type).add(y.getConnectedValue(h)):h=>T.getConnectedValue(h).add(h.adapt(y,T.type));break;case Gd.Subtract:d=F?h=>T.getConnectedValue(h)-y.getConnectedValue(h):C?h=>h.adapt(T,y.type).Nd(y.getConnectedValue(h)):h=>T.getConnectedValue(h).Nd(h.adapt(y,T.type));break;case Gd.Multiply:d=F?h=>T.getConnectedValue(h)*y.getConnectedValue(h):C?h=>h.adapt(T,y.type).multiply(y.getConnectedValue(h)):h=>T.getConnectedValue(h).multiply(h.adapt(y,T.type));break;case Gd.Divide:d=F?h=>T.getConnectedValue(h)/y.getConnectedValue(h):C?h=>h.adapt(T,y.type).divide(y.getConnectedValue(h)):h=>T.getConnectedValue(h).divide(h.adapt(y,T.type));break;case Gd.Min:if(F)d=h=>Math.min(T.getConnectedValue(h),y.getConnectedValue(h));else{const[h,X]=C?[y,T]:[T,y];switch(h.type){case ld.Vector2:d=d=>Y.Vector2.Minimize(h.getConnectedValue(d),d.adapt(X,h.type));break;case ld.pd:d=d=>Y.pd.Minimize(h.getConnectedValue(d),d.adapt(X,h.type));break;case ld.ln:d=d=>{const T=h.getConnectedValue(d),{r:Y,g:y,b:C,a:F}=d.adapt(X,h.type);return new n.ln(Math.min(T.r,Y),Math.min(T.g,y),Math.min(T.b,C),Math.min(T.a,F))}}}break;case Gd.Max:if(!F){const[h,X]=C?[y,T]:[T,y];switch(h.type){case ld.Vector2:d=d=>Y.Vector2.Maximize(h.getConnectedValue(d),d.adapt(X,h.type));break;case ld.pd:d=d=>Y.pd.Maximize(h.getConnectedValue(d),d.adapt(X,h.type));break;case ld.ln:d=d=>{const T=h.getConnectedValue(d),{r:Y,g:y,b:C,a:F}=d.adapt(X,h.type);return new n.ln(Math.max(T.r,Y),Math.min(T.g,y),Math.min(T.b,C),Math.min(T.a,F))}}break}d=h=>Math.max(T.getConnectedValue(h),y.getConnectedValue(h))}this.output._storedFunction=h=>T.type===ld.Int?0|d(h):d(h)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===ld.Int||this.left.type===ld.Float&&this.right.type!==ld.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[h,d]of[[this.left,this.right],[this.right,this.left]])h.acceptedConnectionPointTypes=[ld.Int,ld.Float],d.isConnected&&(h.acceptedConnectionPointTypes.push(d.type),d.type!==ld.Int&&d.type!==ld.Float||h.acceptedConnectionPointTypes.push(ld.Vector2,ld.pd,ld.ln))}dispose(){super.dispose();for(const h of this._connectionObservers)h.remove();this._connectionObservers.length=0}serialize(){const h=super.serialize();return h.operation=this.operation,h}_deserialize(h){super._deserialize(h),this.operation=h.operation}}(0,k.c)([Rd("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Gd.Add},{label:"Subtract",value:Gd.Subtract},{label:"Multiply",value:Gd.Multiply},{label:"Divide",value:Gd.Divide},{label:"Max",value:Gd.Max},{label:"Min",value:Gd.Min}]})],dT.prototype,"operation",void 0),(0,X.e)("BABYLON.ParticleMathBlock",dT);class TT extends mT{constructor(h){super(h),this.registerInput("particle",ld.Particle),this.registerInput("direction1",ld.pd,!0,new Y.pd(0,1,0)),this.registerInput("direction2",ld.pd,!0,new Y.pd(0,1,0)),this.registerInput("minEmitBox",ld.pd,!0,new Y.pd(-.5,-.5,-.5)),this.registerInput("maxEmitBox",ld.pd,!0,new Y.pd(.5,.5,.5)),this.registerOutput("output",ld.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(h){const d=this.particle.getConnectedValue(h);d._directionCreation.process=T=>{h.particleContext=T,h.systemContext=d;const y=this.direction1.getConnectedValue(h),C=this.direction2.getConnectedValue(h),n=(0,U.RandomRange)(y.x,C.x),X=(0,U.RandomRange)(y.y,C.y),F=(0,U.RandomRange)(y.z,C.z);h.isEmitterTransformNode?Y.pd.TransformNormalFromFloatsToRef(n,X,F,h.emitterWorldMatrix,T.direction):T.direction.ny(n,X,F)},d._positionCreation.process=T=>{h.particleContext=T,h.systemContext=d;const y=this.minEmitBox.getConnectedValue(h),C=this.maxEmitBox.getConnectedValue(h),n=(0,U.RandomRange)(y.x,C.x),X=(0,U.RandomRange)(y.y,C.y),F=(0,U.RandomRange)(y.z,C.z);h.isEmitterTransformNode?Y.pd.TransformCoordinatesFromFloatsToRef(n,X,F,h.emitterWorldMatrix,T.position):(T.position.ny(n,X,F),T.position.addInPlace(h.emitterPosition))},this.output._storedValue=d}}(0,X.e)("BABYLON.BoxShapeBlock",TT);class YT extends mT{constructor(h){super(h),this.registerInput("emitPower",ld.Float,!0,1),this.registerInput("lifeTime",ld.Float,!0,1),this.registerInput("color",ld.ln,!0,new n.ln(1,1,1,1)),this.registerInput("scale",ld.Vector2,!0,new Y.Vector2(1,1)),this.registerInput("angle",ld.Float,!0,0),this.registerOutput("particle",ld.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(h){const d=new Xd(this.name,h.BX,h.qd,null,!1,void 0,!0);d.particleEmitterType=new W,d._lifeTimeCreation.process=(d,T)=>{h.particleContext=d,d.lifeTime=this.lifeTime.getConnectedValue(h),T._emitPower=this.emitPower.getConnectedValue(h)},d._colorCreation.process=d=>{h.particleContext=d,d.color.C(this.color.getConnectedValue(h))},d._sizeCreation.process=d=>{h.particleContext=d,d.size=1,d.scale.C(this.scale.getConnectedValue(h))},d._angleCreation.process=d=>{h.particleContext=d,d.angle=this.angle.getConnectedValue(h)},this.particle._storedValue=d}}(0,X.e)("BABYLON.CreateParticleBlock",YT);class yT{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const h=[];for(const d of this.attachedBlocks)d.isInput&&h.push(d);return h}constructor(h){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new I.e,this.name=h}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(h)&&this.attachedBlocks.push(h);for(const T of h.inputs){const Y=T.connectedPoint;if(Y){const T=Y.ownerBlock;T!==h&&this._initializeBlock(T,d)}}}async buildAsync(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((T=>{const Y=new sd;for(const h of this._systemBlocks)this._initializeBlock(h);for(const y of this.systemBlocks){const T=new Qd;T.buildId=this._buildId++,T.qd=h,T.verbose=d;const C=y.createSystem(T);T.emitErrors(),Y.systems.push(C)}this.onBuildObservable.notifyObservers(this),T(Y)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const h=new Ad("Particle system"),d=new hT("Update position");d.output.connectTo(h.particle);const T=new Pd("Position");T.contextualValue=ed.Position;const Y=new Pd("Scaled direction");Y.contextualValue=ed.ScaledDirection;const y=new dT("Add");y.operation=Gd.Add,T.output.connectTo(y.left),Y.output.connectTo(y.right),y.output.connectTo(d.position);const C=new YT("Create particle"),n=new TT("Box shape");C.particle.connectTo(n.particle),n.output.connectTo(d.particle);const X=new td("Texture");X.texture.connectTo(h.texture),X.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(h)}removeBlock(h){const d=this.attachedBlocks.indexOf(h);if(d>-1&&this.attachedBlocks.splice(d,1),h.isSystem){const d=this._systemBlocks.indexOf(h);d>-1&&this._systemBlocks.splice(d,1)}}parseSerializedObject(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d||this.clear();const T={};for(const Y of h.gZ){const h=(0,X.d)(Y.customType);if(h){const d=new h;d._deserialize(Y),T[Y.id]=d,this.attachedBlocks.push(d),d.isSystem&&this._systemBlocks.push(d)}}for(const Y of this.attachedBlocks)if(Y.isTeleportOut){const h=Y,d=h._tempEntryPointUniqueId;if(d){const Y=T[d];Y&&Y.attachToEndpoint(h)}}for(let Y=0;Y<h.gZ.length;Y++){const y=h.gZ[Y],C=T[y.id];C&&(C.inputs.length&&y.inputs.some((h=>h.targetConnectionName))&&!d||this._restoreConnections(C,h,T))}if(h.locations||h.editorData&&h.editorData.locations){const Y=h.locations||h.editorData.locations;for(const h of Y)T[h.CC]&&(h.CC=T[h.CC].uniqueId);d&&this.editorData&&this.editorData.locations&&Y.concat(this.editorData.locations),h.locations?this.editorData={locations:Y}:(this.editorData=h.editorData,this.editorData.locations=Y);const y=[];for(const h in T)y[h]=T[h].uniqueId;this.editorData.map=y}this.comment=h.comment}_restoreConnections(h,d,T){for(const Y of h.outputs)for(const y of d.gZ){const C=T[y.id];if(C)for(const n of y.inputs)if(T[n.targetBlockId]!==h||n.targetConnectionName!==Y.name);else{const h=C.getInputByName(n.inputName);if(!h||h.isConnected)continue;Y.connectTo(h,!0),this._restoreConnections(C,d,T)}}}serialize(h){const d=h?{}:u.e.Serialize(this);d.editorData=JSON.parse(JSON.stringify(this.editorData));let T=[];h?T=h:d.customType="BABYLON.NodeParticleSystemSet",d.gZ=[];for(const Y of T)d.gZ.push(Y.serialize());if(!h)for(const Y of this.attachedBlocks)-1===T.indexOf(Y)&&d.gZ.push(Y.serialize());return d}dispose(){for(const h of this.attachedBlocks)h.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(h){const d=new yT(h);return d.setToDefault(),d}static Parse(h){const d=u.e.Parse((()=>new yT(h.name)),h,null);return d.parseSerializedObject(h),d}static ParseFromSnippetAsync(h,d){return"_BLANK"===h?Promise.resolve(yT.CreateDefault("blank")):new Promise(((T,Y)=>{const y=new Ed.b;y.addEventListener("readystatechange",(()=>{if(4==y.readyState)if(200==y.status){const n=JSON.parse(JSON.parse(y.responseText).jsonPayload),X=JSON.parse(n.nodeParticle);d||(d=u.e.Parse((()=>new yT(h)),X,null)),d.parseSerializedObject(X),d.snippetId=h;try{T(d)}catch(C){Y(C)}}else Y("Unable to load the snippet "+h)})),y.open("GET",this.SnippetUrl+"/"+h.replace(/#/g,"/")),y.send()}))}}yT.EditorURL=`${Vd.Tools._DefaultCdnUrl}/v${Rh.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,yT.SnippetUrl="https://snippet.babylonjs.com",(0,k.c)([(0,o.E)()],yT.prototype,"name",void 0),(0,k.c)([(0,o.E)("comment")],yT.prototype,"comment",void 0),function(h){h[h.None=0]="None",h[h.PerParticle=1]="PerParticle",h[h.PerSystem=2]="PerSystem"}(bd||(bd={}));class CT extends mT{constructor(h){super(h),this._currentLockId=-2,this.lockMode=bd.PerParticle,this.registerInput("min",ld.AutoDetect,!0,0),this.registerInput("max",ld.AutoDetect,!0,1),this.registerOutput("output",ld.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(ld.Float|ld.Int|ld.Vector2|ld.pd|ld.ln),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(ld.Float|ld.Int|ld.Vector2|ld.pd|ld.ln),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=ld.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let h=null;switch(this._currentLockId=-2,this.min.type){case ld.AutoDetect:case ld.Int:case ld.Float:h=h=>{const d=this.min.getConnectedValue(h)||0,T=this.max.getConnectedValue(h)||1;return d+Math.random()*(T-d)};break;case ld.Vector2:h=h=>{const d=this.min.getConnectedValue(h)||Y.Vector2.Zero(),T=this.max.getConnectedValue(h)||Y.Vector2.One();return new Y.Vector2(d.x+Math.random()*(T.x-d.x),d.y+Math.random()*(T.y-d.y))};break;case ld.pd:h=h=>{const d=this.min.getConnectedValue(h)||Y.pd.Zero(),T=this.max.getConnectedValue(h)||Y.pd.One();return new Y.pd(d.x+Math.random()*(T.x-d.x),d.y+Math.random()*(T.y-d.y),d.z+Math.random()*(T.z-d.z))};break;case ld.ln:h=h=>{const d=this.min.getConnectedValue(h)||new n.ln(0,0,0,0),T=this.max.getConnectedValue(h)||new n.ln(1,1,1,1);return new n.ln(d.x+Math.random()*(T.x-d.x),d.y+Math.random()*(T.y-d.y),d.z+Math.random()*(T.z-d.z),d.w+Math.random()*(T.w-d.w))}}this.output._storedFunction=d=>{var T;let Y=0;switch(this.lockMode){case bd.PerParticle:Y=(null===(T=d.particleContext)||void 0===T?void 0:T.id)||-1;break;case bd.PerSystem:Y=d.buildId||0}return this._currentLockId!==Y&&(this.lockMode!==bd.None&&(this._currentLockId=Y),this.output._storedValue=h(d)),this.output._storedValue}}serialize(){const h=super.serialize();return h.lockMode=this.lockMode,h}_deserialize(h){super._deserialize(h),this.lockMode=h.lockMode}}(0,k.c)([Rd("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:bd.None},{label:"Per particle",value:bd.PerParticle},{label:"Per system",value:bd.PerSystem}]})],CT.prototype,"lockMode",void 0),(0,X.e)("BABYLON.ParticleRandomBlock",CT);class nT extends mT{constructor(h){super(h),this._currentLockId=-2,this.lockMode=bd.PerParticle,this.registerInput("min",ld.AutoDetect),this.registerInput("max",ld.AutoDetect),this.registerOutput("output",ld.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const d=[ld.Matrix,ld.Particle,ld.Texture,ld.System,ld.FloatGradient,ld.Color4Gradient,ld.Vector2Gradient,ld.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...d),this.max.excludedConnectionPointTypes.push(...d)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let h=null;switch(this._currentLockId=-2,this.min.type){case ld.Float:case ld.Int:h=h=>{const d=this.min.getConnectedValue(h),T=this.max.getConnectedValue(h);return Math.random()*(T-d)+d};break;case ld.Vector2:h=h=>{const d=this.min.getConnectedValue(h),T=this.max.getConnectedValue(h);return new Y.Vector2(Math.random()*(T.x-d.x)+d.x,Math.random()*(T.y-d.y)+d.y)};break;case ld.pd:h=h=>{const d=this.min.getConnectedValue(h),T=this.max.getConnectedValue(h);return new Y.pd(Math.random()*(T.x-d.x)+d.x,Math.random()*(T.y-d.y)+d.y,Math.random()*(T.z-d.z)+d.z)};break;case ld.ln:h=h=>{const d=this.min.getConnectedValue(h),T=this.max.getConnectedValue(h);return new n.ln(Math.random()*(T.r-d.r)+d.r,Math.random()*(T.g-d.g)+d.g,Math.random()*(T.b-d.b)+d.b,Math.random()*(T.a-d.a)+d.a)}}this.output._storedFunction=d=>{var T;let Y=0;switch(this.lockMode){case bd.PerParticle:Y=(null===(T=d.particleContext)||void 0===T?void 0:T.id)||-1;break;case bd.PerSystem:Y=d.buildId||0}return this._currentLockId!==Y&&(this.lockMode!==bd.None&&(this._currentLockId=Y),this.output._storedValue=h(d)),this.output._storedValue}}serialize(){const h=super.serialize();return h.lockMode=this.lockMode,h}_deserialize(h){super._deserialize(h),void 0!==h.lockMode&&(this.lockMode=h.lockMode)}}(0,k.c)([Rd("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:bd.None},{label:"Per particle",value:bd.PerParticle},{label:"Per system",value:bd.PerSystem}]})],nT.prototype,"lockMode",void 0),(0,X.e)("BABYLON.RandomRangeBlock",nT);(0,X.e)("BABYLON.ParticleLerpBlock",class extends mT{constructor(h){super(h),this.registerInput("left",ld.AutoDetect),this.registerInput("right",ld.AutoDetect),this.registerInput("gradient",ld.Float,!0,0,0,1),this.registerOutput("output",ld.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(ld.Float|ld.Int|ld.Vector2|ld.pd|ld.ln)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const h=(h,d,T)=>(1-h)*d+h*T;this.output._storedFunction=d=>{const T=this.left.getConnectedValue(d),y=this.right.getConnectedValue(d),C=this.gradient.getConnectedValue(d);switch(this.left.type){case ld.Int:case ld.Float:return h(C,T,y);case ld.Vector2:return new Y.Vector2(h(C,T.x,y.x),h(C,T.y,y.y));case ld.pd:return new Y.pd(h(C,T.x,y.x),h(C,T.y,y.y),h(C,T.z,y.z));case ld.ln:return new n.ln(h(C,T.r,y.r),h(C,T.g,y.g),h(C,T.b,y.b),h(C,T.a,y.a))}return 0}}});(0,X.e)("BABYLON.UpdateDirectionBlock",class extends mT{constructor(h){super(h),this.registerInput("particle",ld.Particle),this.registerInput("direction",ld.pd),this.registerOutput("output",ld.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(h){const d=this.particle.getConnectedValue(h);if(this.output._storedValue=d,!this.direction.isConnected)return;const T={process:T=>{h.particleContext=T,h.systemContext=d,T.direction.C(this.direction.getConnectedValue(h))},previousItem:null,nextItem:null};d._updateQueueStart?vh(T,d._updateQueueStart):d._updateQueueStart=T}});(0,X.e)("BABYLON.UpdateColorBlock",class extends mT{constructor(h){super(h),this.registerInput("particle",ld.Particle),this.registerInput("color",ld.ln),this.registerOutput("output",ld.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(h){const d=this.particle.getConnectedValue(h);if(this.output._storedValue=d,!this.color.isConnected)return;const T={process:T=>{h.particleContext=T,h.systemContext=d,T.color.C(this.color.getConnectedValue(h))},previousItem:null,nextItem:null};d._updateQueueStart?vh(T,d._updateQueueStart):d._updateQueueStart=T}});(0,X.e)("BABYLON.UpdateScaleBlock",class extends mT{constructor(h){super(h),this.registerInput("particle",ld.Particle),this.registerInput("scale",ld.Vector2),this.registerOutput("output",ld.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(h){const d=this.particle.getConnectedValue(h);if(this.output._storedValue=d,!this.scale.isConnected)return;const T={process:T=>{h.particleContext=T,h.systemContext=d,T.scale.C(this.scale.getConnectedValue(h))},previousItem:null,nextItem:null};d._updateQueueStart?vh(T,d._updateQueueStart):d._updateQueueStart=T}});(0,X.e)("BABYLON.UpdateAngleBlock",class extends mT{constructor(h){super(h),this.registerInput("particle",ld.Particle),this.registerInput("angle",ld.Float),this.registerOutput("output",ld.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(h){const d=this.particle.getConnectedValue(h);if(this.output._storedValue=d,!this.angle.isConnected)return;const T={process:T=>{h.particleContext=T,h.systemContext=d,T.angle=this.angle.getConnectedValue(h)},previousItem:null,nextItem:null};d._updateQueueStart?vh(T,d._updateQueueStart):d._updateQueueStart=T}});(0,X.e)("BABYLON.BasicPositionUpdateBlock",class extends mT{constructor(h){super(h),this.registerInput("particle",ld.Particle),this.registerOutput("output",ld.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(h){const d=this.particle.getConnectedValue(h),T={process:T=>{h.particleContext=T,h.systemContext=d,T.direction.scaleToRef(d._directionScale,d._scaledDirection),T.position.addInPlace(d._scaledDirection)},previousItem:null,nextItem:null};d._updateQueueStart?vh(T,d._updateQueueStart):d._updateQueueStart=T,this.output._storedValue=d}});(0,X.e)("BABYLON.BasicSpriteUpdateBlock",class extends mT{constructor(h){super(h),this.registerInput("particle",ld.Particle),this.registerOutput("output",ld.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(h){const d=this.particle.getConnectedValue(h),T={process:T=>{h.particleContext=T,h.systemContext=d,T.updateCellIndex()},previousItem:null,nextItem:null};d._updateQueueStart?vh(T,d._updateQueueStart):d._updateQueueStart=T,this.output._storedValue=d}});(0,X.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends mT{constructor(h){super(h),this.registerInput("particle",ld.Particle),this.registerInput("cellIndex",ld.Int),this.registerOutput("output",ld.Particle),this.cellIndex.acceptedConnectionPointTypes=[ld.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(h){const d=this.particle.getConnectedValue(h);if(this.output._storedValue=d,!this.cellIndex.isConnected)return;const T={process:T=>{h.particleContext=T,h.systemContext=d,T.cellIndex=Math.floor(this.cellIndex.getConnectedValue(h))},previousItem:null,nextItem:null};d._updateQueueStart?vh(T,d._updateQueueStart):d._updateQueueStart=T}});class XT extends mT{constructor(h){super(h),this.strength=1,this.registerInput("particle",ld.Particle),this.registerInput("flowMap",ld.Texture),this.registerOutput("output",ld.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(h){var d;const T=this.particle.getConnectedValue(h),Y=h.qd;let y;(null===(d=this.flowMap.connectedPoint)||void 0===d?void 0:d.ownerBlock).extractTextureContentAsync().then((h=>{h&&(y=new Kd(h.width,h.height,h.data))}));const C={process:h=>{const d=Y.getTransformMatrix();y&&y._processParticle(h,this.strength*T._tempScaledUpdateSpeed,d)},previousItem:null,nextItem:null};T._updateQueueStart?vh(C,T._updateQueueStart):T._updateQueueStart=C,this.output._storedValue=T}serialize(){const h=super.serialize();return h.strength=this.strength,h}_deserialize(h){super._deserialize(h),this.strength=h.strength}}(0,k.c)([Rd("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XT.prototype,"strength",void 0),(0,X.e)("BABYLON.UpdateFlowMapBlock",XT);(0,X.e)("BABYLON.SphereShapeBlock",class extends mT{constructor(h){super(h),this.registerInput("input",ld.Particle),this.registerInput("radius",ld.Float,!0,1),this.registerInput("radiusRange",ld.Float,!0,1,0,1),this.registerInput("directionRandomizer",ld.Float,!0,0,0,1),this.registerOutput("output",ld.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(h){const d=this.input.getConnectedValue(h);d._directionCreation.process=T=>{h.particleContext=T,h.systemContext=d;const y=this.directionRandomizer.getConnectedValue(h),C=T.position.Nd(h.emitterPosition).normalize(),n=(0,U.RandomRange)(0,y),X=(0,U.RandomRange)(0,y),F=(0,U.RandomRange)(0,y);C.x+=n,C.y+=X,C.z+=F,C.normalize(),h.isEmitterTransformNode?Y.pd.TransformNormalFromFloatsToRef(n,X,F,h.emitterWorldMatrix,T.direction):T.direction.ny(n,X,F)},d._positionCreation.process=T=>{h.particleContext=T,h.systemContext=d;const y=this.radius.getConnectedValue(h),C=this.radiusRange.getConnectedValue(h),n=y-(0,U.RandomRange)(0,y*C),X=(0,U.RandomRange)(0,1),F=(0,U.RandomRange)(0,2*Math.PI),Z=Math.acos(2*X-1),S=n*Math.cos(F)*Math.sin(Z),r=n*Math.cos(Z),c=n*Math.sin(F)*Math.sin(Z);h.isEmitterTransformNode?Y.pd.TransformCoordinatesFromFloatsToRef(S,r,c,h.emitterWorldMatrix,T.position):(T.position.ny(S,r,c),T.position.addInPlace(h.emitterPosition))},this.output._storedValue=d}});(0,X.e)("BABYLON.PointShapeBlock",class extends mT{constructor(h){super(h),this.registerInput("particle",ld.Particle),this.registerInput("direction1",ld.pd,!0,new Y.pd(0,1,0)),this.registerInput("direction2",ld.pd,!0,new Y.pd(0,1,0)),this.registerOutput("output",ld.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(h){const d=this.particle.getConnectedValue(h);d._directionCreation.process=T=>{h.particleContext=T,h.systemContext=d;const y=this.direction1.getConnectedValue(h),C=this.direction2.getConnectedValue(h),n=(0,U.RandomRange)(y.x,C.x),X=(0,U.RandomRange)(y.y,C.y),F=(0,U.RandomRange)(y.z,C.z);h.isEmitterTransformNode?Y.pd.TransformNormalFromFloatsToRef(n,X,F,h.emitterWorldMatrix,T.direction):T.direction.ny(n,X,F)},d._positionCreation.process=T=>{h.systemContext=d,h.isEmitterTransformNode?Y.pd.TransformCoordinatesFromFloatsToRef(0,0,0,h.emitterWorldMatrix,T.position):T.position.C(h.emitterPosition)},this.output._storedValue=d}});(0,X.e)("BABYLON.CustomShapeBlock",class extends mT{constructor(h){super(h),this.registerInput("particle",ld.Particle),this.registerInput("position",ld.pd,!0,new Y.pd(0,0,0)),this.registerInput("direction",ld.pd,!0,new Y.pd(0,1,0)),this.registerOutput("output",ld.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(h){const d=this.particle.getConnectedValue(h);d._directionCreation.process=T=>{h.particleContext=T,h.systemContext=d;const y=this.direction.getConnectedValue(h);h.isEmitterTransformNode?Y.pd.TransformNormalToRef(y,h.emitterWorldMatrix,T.direction):T.direction.C(y)},d._positionCreation.process=T=>{h.particleContext=T,h.systemContext=d;const y=this.position.getConnectedValue(h);h.isEmitterTransformNode?Y.pd.TransformCoordinatesToRef(y,h.emitterWorldMatrix,T.position):(T.position.C(y),T.position.addInPlace(h.emitterPosition))},this.output._storedValue=d}});(0,X.e)("BABYLON.CylinderShapeBlock",class extends mT{constructor(h){super(h),this._tempVector=Y.pd.Zero(),this.registerInput("particle",ld.Particle),this.registerInput("radius",ld.Float,!0,1),this.registerInput("height",ld.Float,!0,1,0),this.registerInput("radiusRange",ld.Float,!0,1,0,1),this.registerInput("directionRandomizer",ld.Float,!0,0,0,1),this.registerOutput("output",ld.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(h){const d=this.particle.getConnectedValue(h);d._directionCreation.process=T=>{h.particleContext=T,h.systemContext=d;const y=this.directionRandomizer.getConnectedValue(h);T.position.subtractToRef(h.emitterPosition,this._tempVector),this._tempVector.normalize(),h.isEmitterTransformNode&&Y.pd.TransformNormalToRef(this._tempVector,h.emitterInverseWorldMatrix,this._tempVector);const C=(0,U.RandomRange)(-y/2,y/2);let n=Math.atan2(this._tempVector.x,this._tempVector.z);n+=(0,U.RandomRange)(-Math.PI/2,Math.PI/2)*y,this._tempVector.y=C,this._tempVector.x=Math.sin(n),this._tempVector.z=Math.cos(n),this._tempVector.normalize(),h.isEmitterTransformNode?Y.pd.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,h.emitterWorldMatrix,T.direction):T.direction.C(this._tempVector)},d._positionCreation.process=T=>{h.particleContext=T,h.systemContext=d;const y=this.height.getConnectedValue(h),C=this.radiusRange.getConnectedValue(h),n=this.radius.getConnectedValue(h),X=(0,U.RandomRange)(-y/2,y/2),F=(0,U.RandomRange)(0,2*Math.PI),Z=(0,U.RandomRange)((1-C)*(1-C),1),S=Math.sqrt(Z)*n,r=S*Math.cos(F),c=S*Math.sin(F);h.isEmitterTransformNode?Y.pd.TransformCoordinatesFromFloatsToRef(r,X,c,h.emitterWorldMatrix,T.position):(T.position.ny(r,X,c),T.position.addInPlace(h.emitterPosition))},this.output._storedValue=d}});class FT extends mT{constructor(h){super(h),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",ld.Particle),this.registerOutput("output",ld.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){super._build(h);const d=this.particle.getConnectedValue(h);d._isAnimationSheetEnabled=!0,d.spriteCellWidth=this.width,d.spriteCellHeight=this.height,d.startSpriteCellID=this.start,d.endSpriteCellID=this.end,d.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=d}serialize(){const h=super.serialize();return h.width=this.width,h.height=this.height,h.start=this.start,h.end=this.end,h.randomStartCell=this.randomStartCell,h}_deserialize(h){super._deserialize(h),this.width=h.width,this.height=h.height,this.start=h.start,this.end=h.end,this.randomStartCell=h.randomStartCell}}(0,k.c)([Rd("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FT.prototype,"start",void 0),(0,k.c)([Rd("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FT.prototype,"end",void 0),(0,k.c)([Rd("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FT.prototype,"width",void 0),(0,k.c)([Rd("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FT.prototype,"height",void 0),(0,k.c)([Rd("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],FT.prototype,"loop",void 0),(0,k.c)([Rd("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],FT.prototype,"randomStartCell",void 0),(0,X.e)("BABYLON.SetupSpriteSheetBlock",FT);class UT extends mT{constructor(h){super(h),this.reference=0,this.registerInput("value",ld.AutoDetect),this.registerOutput("output",ld.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=h=>{switch(h){case ld.Float:return ld.FloatGradient;case ld.Vector2:return ld.Vector2Gradient;case ld.pd:return ld.Vector3Gradient;case ld.ln:return ld.Color4Gradient}return h},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(ld.Float|ld.Vector2|ld.pd|ld.ln)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=h=>null}serialize(){const h=super.serialize();return h.reference=this.reference,h}_deserialize(h){super._deserialize(h),this.reference=h.reference}}(0,k.c)([Rd("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],UT.prototype,"reference",void 0),(0,X.e)("BABYLON.ParticleGradientValueBlock",UT);(0,X.e)("BABYLON.ParticleGradientBlock",class extends mT{constructor(h){super(h),this._entryCount=1,this.registerInput("gradient",ld.Float,!0,1,0,1),this.registerInput("value0",ld.AutoDetect),this.registerOutput("output",ld.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=h=>{switch(h){case ld.FloatGradient:return ld.Float;case ld.Vector2Gradient:return ld.Vector2;case ld.Vector3Gradient:return ld.pd;case ld.Color4Gradient:return ld.ln}return h},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(ld.FloatGradient|ld.Vector2Gradient|ld.Vector3Gradient|ld.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(h){this._inputs[h].onConnectionObservable.add((()=>{this._entryCount>h||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),ld.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const h=[];for(let T=1;T<this._inputs.length;T++){var d;if(this._inputs[T].isConnected)h.push(null===(d=this._inputs[T].connectedPoint)||void 0===d?void 0:d.ownerBlock)}h.sort(((h,d)=>h.reference-d.reference)),this.output._storedFunction=d=>{const T=this.gradient.getConnectedValue(d);if(1===h.length)return h[0].value.getConnectedValue(d);let y=null;for(let C=h.length-1;C>=0;C--){const X=h[C];if(X.reference<=T){const h=X.value.getConnectedValue(d);if(y){const C=y.value.getConnectedValue(d),F=y.reference,Z=X.reference,S=Math.max(0,Math.min(1,(T-Z)/(F-Z)));switch(this.output.type){case ld.Float:return(0,U.Lerp)(h,C,S);case ld.Vector2:return Y.Vector2.Lerp(h,C,S);case ld.pd:return Y.pd.Lerp(h,C,S);case ld.ln:return n.ln.Lerp(h,C,S)}}return h}y=X}return 0}}});(0,X.e)("BABYLON.ParticleConverterBlock",class extends mT{constructor(h){super(h),this.registerInput("color ",ld.ln,!0),this.registerInput("xyz ",ld.pd,!0),this.registerInput("xy ",ld.Vector2,!0),this.registerInput("zw ",ld.Vector2,!0),this.registerInput("x ",ld.Float,!0),this.registerInput("y ",ld.Float,!0),this.registerInput("z ",ld.Float,!0),this.registerInput("w ",ld.Float,!0),this.registerOutput("color",ld.ln),this.registerOutput("xyz",ld.pd),this.registerOutput("xy",ld.Vector2),this.registerOutput("zw",ld.Vector2),this.registerOutput("x",ld.Float),this.registerOutput("y",ld.Float),this.registerOutput("z",ld.Float),this.registerOutput("w",ld.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(h){return"color "===h?"colorIn":"xyz "===h?"xyzIn":"xy "===h?"xyIn":"zw "===h?"zwIn":"x "===h?"xIn":"y "===h?"yIn":"z "===h?"zIn":"w "===h?"wIn":h}_outputRename(h){switch(h){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return h}}_build(h){super._build(h);const d=this.xIn,T=this.yIn,y=this.zIn,C=this.wIn,X=this.xyIn,F=this.zwIn,U=this.xyzIn,Z=this.colorIn,S=this.colorOut,r=this.xyzOut,c=this.xyOut,O=this.zwOut,f=this.xOut,J=this.yOut,W=this.zOut,L=this.wOut,D=h=>{if(Z.isConnected)return Z.getConnectedValue(h);let Y=0,S=0,r=0,c=0;if(d.isConnected&&(Y=d.getConnectedValue(h)),T.isConnected&&(S=T.getConnectedValue(h)),y.isConnected&&(r=y.getConnectedValue(h)),C.isConnected&&(c=C.getConnectedValue(h)),X.isConnected){const d=X.getConnectedValue(h);d&&(Y=d.x,S=d.y)}if(F.isConnected){const d=F.getConnectedValue(h);d&&(r=d.x,c=d.y)}if(U.isConnected){const d=U.getConnectedValue(h);d&&(Y=d.x,S=d.y,r=d.z)}return new n.ln(Y,S,r,c)};S._storedFunction=h=>D(h),r._storedFunction=h=>{const d=D(h);return new Y.pd(d.r,d.g,d.b)},c._storedFunction=h=>{const d=D(h);return new Y.Vector2(d.r,d.g)},O._storedFunction=h=>{const d=D(h);return new Y.Vector2(d.b,d.a)},f._storedFunction=h=>D(h).r,J._storedFunction=h=>D(h).g,W._storedFunction=h=>D(h).b,L._storedFunction=h=>D(h).a}}),function(h){h[h.Cos=0]="Cos",h[h.Sin=1]="Sin",h[h.Abs=2]="Abs",h[h.Exp=3]="Exp",h[h.Exp2=4]="Exp2",h[h.Round=5]="Round",h[h.Floor=6]="Floor",h[h.Ceiling=7]="Ceiling",h[h.Sqrt=8]="Sqrt",h[h.Log=9]="Log",h[h.Tan=10]="Tan",h[h.ArcTan=11]="ArcTan",h[h.ArcCos=12]="ArcCos",h[h.ArcSin=13]="ArcSin",h[h.Sign=14]="Sign",h[h.Negate=15]="Negate",h[h.OneMinus=16]="OneMinus",h[h.Reciprocal=17]="Reciprocal",h[h.ToDegrees=18]="ToDegrees",h[h.ToRadians=19]="ToRadians",h[h.Fract=20]="Fract"}(Bd||(Bd={}));class ZT extends mT{constructor(h){super(h),this.operation=Bd.Cos,this.registerInput("input",ld.AutoDetect),this.registerOutput("output",ld.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(ld.Float|ld.Int|ld.Vector2|ld.pd|ld.ln)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){super._build(h);let d=null;switch(this.operation){case Bd.Cos:d=h=>Math.cos(h);break;case Bd.Sin:d=h=>Math.sin(h);break;case Bd.Abs:d=h=>Math.abs(h);break;case Bd.Exp:d=h=>Math.exp(h);break;case Bd.Exp2:d=h=>Math.pow(2,h);break;case Bd.Round:d=h=>Math.round(h);break;case Bd.Floor:d=h=>Math.floor(h);break;case Bd.Ceiling:d=h=>Math.ceil(h);break;case Bd.Sqrt:d=h=>Math.sqrt(h);break;case Bd.Log:d=h=>Math.log(h);break;case Bd.Tan:d=h=>Math.tan(h);break;case Bd.ArcTan:d=h=>Math.atan(h);break;case Bd.ArcCos:d=h=>Math.acos(h);break;case Bd.ArcSin:d=h=>Math.asin(h);break;case Bd.Sign:d=h=>Math.sign(h);break;case Bd.Negate:d=h=>-h;break;case Bd.OneMinus:d=h=>1-h;break;case Bd.Reciprocal:d=h=>1/h;break;case Bd.ToRadians:d=h=>h*Math.PI/180;break;case Bd.ToDegrees:d=h=>180*h/Math.PI;break;case Bd.Fract:d=h=>h>=0?h-Math.floor(h):h-Math.ceil(h)}if(!d)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case ld.Int:case ld.Float:this.output._storedFunction=h=>{const T=this.input.getConnectedValue(h);return d(T)};break;case ld.Vector2:this.output._storedFunction=h=>{const T=this.input.getConnectedValue(h);return new Y.Vector2(d(T.x),d(T.y))};break;case ld.pd:this.output._storedFunction=h=>{const T=this.input.getConnectedValue(h);return new Y.pd(d(T.x),d(T.y),d(T.z))};break;case ld.ln:this.output._storedFunction=h=>{const T=this.input.getConnectedValue(h);return new n.ln(d(T.r),d(T.g),d(T.b),d(T.a))}}return this}serialize(){const h=super.serialize();return h.operation=this.operation,h}_deserialize(h){super._deserialize(h),this.operation=h.operation}}(0,k.c)([Rd("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Bd.Cos},{label:"Sin",value:Bd.Sin},{label:"Abs",value:Bd.Abs},{label:"Exp",value:Bd.Exp},{label:"Exp2",value:Bd.Exp2},{label:"Round",value:Bd.Round},{label:"Floor",value:Bd.Floor},{label:"Ceiling",value:Bd.Ceiling},{label:"Sqrt",value:Bd.Sqrt},{label:"Log",value:Bd.Log},{label:"Tan",value:Bd.Tan},{label:"ArcTan",value:Bd.ArcTan},{label:"ArcCos",value:Bd.ArcCos},{label:"ArcSin",value:Bd.ArcSin},{label:"Sign",value:Bd.Sign},{label:"Negate",value:Bd.Negate},{label:"OneMinus",value:Bd.OneMinus},{label:"Reciprocal",value:Bd.Reciprocal},{label:"ToDegrees",value:Bd.ToDegrees},{label:"ToRadians",value:Bd.ToRadians},{label:"Fract",value:Bd.Fract}]})],ZT.prototype,"operation",void 0),(0,X.e)("BABYLON.ParticleTrigonometryBlock",ZT);var ST,rT=T(14221);class cT extends mT{constructor(h){super(h),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",ld.AutoDetect),this.registerOutput("output",ld.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(ld.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(ld.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(ld.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(ld.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(ld.System),this._inputs[0].excludedConnectionPointTypes.push(ld.Particle),this._inputs[0].excludedConnectionPointTypes.push(ld.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const d=h=>{const d=this.input.getConnectedValue(h);if(this.log.length>=this.stackSize)return d;if(null===d||void 0===d)return this.log.push(["null",""]),d;switch(this.input.type){case ld.Vector2:this.log.push([(0,rT.j)(d,4),d.toString()]);break;case ld.pd:this.log.push([(0,rT.k)(d,4),d.toString()]);break;case ld.ln:this.log.push([`{R: ${d.r.toFixed(4)} G: ${d.g.toFixed(4)} B: ${d.b.toFixed(4)} A: ${d.a.toFixed(4)}}`,d.toString()]);break;default:this.log.push([d.toString(),d.toString()])}return d};this.output.isConnected?this.output._storedFunction=d:this.output._storedValue=d(h)}serialize(){const h=super.serialize();return h.stackSize=this.stackSize,h}_deserialize(h){super._deserialize(h),this.stackSize=h.stackSize}}(0,k.c)([Rd("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],cT.prototype,"stackSize",void 0),(0,X.e)("BABYLON.ParticleDebugBlock",cT);(0,X.e)("BABYLON.ParticleElbowBlock",class extends mT{constructor(h){super(h),this.registerInput("input",ld.AutoDetect),this.registerOutput("output",ld.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(h){super._build(h);const d=this._outputs[0],T=this._inputs[0];d._storedFunction=h=>T.getConnectedValue(h)}});(0,X.e)("BABYLON.ParticleTeleportInBlock",class extends mT{get endpoints(){return this._endpoints}constructor(h){super(h),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",ld.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(h){if(this.getClassName()===h)return!0;for(const d of this.endpoints)if(d.isAnAncestorOfType(h))return!0;return!1}isAnAncestorOf(h){for(const d of this.endpoints){if(d===h)return!0;if(d.isAnAncestorOf(h))return!0}return!1}attachToEndpoint(h){h.detach(),this._endpoints.push(h),h._entryPoint=this,h._outputs[0]._typeConnectionSource=this._inputs[0],h._tempEntryPointUniqueId=null,h.name="> "+this.name}detachFromEndpoint(h){const d=this._endpoints.indexOf(h);-1!==d&&(this._endpoints.splice(d,1),h._outputs[0]._typeConnectionSource=null,h._entryPoint=null)}_build(){for(const h of this._endpoints)h.output._storedFunction=h=>this.input.getConnectedValue(h)}});(0,X.e)("BABYLON.ParticleTeleportOutBlock",class extends mT{constructor(h){super(h),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",ld.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(h){this.entryPoint&&this.entryPoint.build(h)}clone(){const h=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(h),h}serialize(){var h;const d=super.serialize();return d.entryPoint=(null===(h=this.entryPoint)||void 0===h?void 0:h.uniqueId)??"",d}_deserialize(h){super._deserialize(h),this._tempEntryPointUniqueId=h.entryPoint}}),function(h){h[h.Equal=0]="Equal",h[h.NotEqual=1]="NotEqual",h[h.LessThan=2]="LessThan",h[h.GreaterThan=3]="GreaterThan",h[h.LessOrEqual=4]="LessOrEqual",h[h.GreaterOrEqual=5]="GreaterOrEqual",h[h.Xor=6]="Xor",h[h.Or=7]="Or",h[h.And=8]="And"}(ST||(ST={}));class OT extends mT{constructor(h){super(h),this.test=ST.Equal,this.epsilon=0,this.registerInput("left",ld.Float),this.registerInput("right",ld.Float,!0,0),this.registerInput("ifTrue",ld.AutoDetect,!0,1),this.registerInput("ifFalse",ld.AutoDetect,!0,0),this.registerOutput("output",ld.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=ld.Float,this._inputs[0].acceptedConnectionPointTypes.push(ld.Int),this._inputs[1].acceptedConnectionPointTypes.push(ld.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const h=h=>{const d=this.left.getConnectedValue(h),T=this.right.getConnectedValue(h);let Y=!1;switch(this.test){case ST.Equal:Y=(0,U.WithinEpsilon)(d,T,this.epsilon);break;case ST.NotEqual:Y=!(0,U.WithinEpsilon)(d,T,this.epsilon);break;case ST.LessThan:Y=d<T+this.epsilon;break;case ST.GreaterThan:Y=d>T-this.epsilon;break;case ST.LessOrEqual:Y=d<=T+this.epsilon;break;case ST.GreaterOrEqual:Y=d>=T-this.epsilon;break;case ST.Xor:Y=!!d&&!T||!d&&!!T;break;case ST.Or:Y=!!d||!!T;break;case ST.And:Y=!!d&&!!T}return Y};this.output._storedFunction=d=>h(d)?this.ifTrue.getConnectedValue(d):this.ifFalse.getConnectedValue(d)}serialize(){const h=super.serialize();return h.test=this.test,h.epsilon=this.epsilon,h}_deserialize(h){super._deserialize(h),this.test=h.test,void 0!==h.epsilon&&(this.epsilon=h.epsilon)}}(0,k.c)([Rd("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:ST.Equal},{label:"NotEqual",value:ST.NotEqual},{label:"LessThan",value:ST.LessThan},{label:"GreaterThan",value:ST.GreaterThan},{label:"LessOrEqual",value:ST.LessOrEqual},{label:"GreaterOrEqual",value:ST.GreaterOrEqual},{label:"Xor",value:ST.Xor},{label:"Or",value:ST.Or},{label:"And",value:ST.And}]})],OT.prototype,"test",void 0),(0,k.c)([Rd("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],OT.prototype,"epsilon",void 0),(0,X.e)("BABYLON.ParticleConditionBlock",OT);class fT extends mT{constructor(h){super(h),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",ld.Particle),this.registerInput("condition",ld.Float,!0,0),this.registerInput("system",ld.System),this.registerOutput("output",ld.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(h){this._triggerCount=0;const d=this.input.getConnectedValue(h),T={process:T=>{if(h.particleContext=T,h.systemContext=d,0!==this.condition.getConnectedValue(h)&&(0===this.limit||this._triggerCount<this.limit)){const Y=(new Date).getTime();if(this._previousOne&&Y-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=Y;const y=this.system.getConnectedValue(h);if(y){const Y=Id(y,h.qd,T.position);Y.zd.addOnce((()=>{this._triggerCount--})),d.zd.addOnce((()=>{Y.dispose()}))}}},previousItem:null,nextItem:null};d._updateQueueStart?vh(T,d._updateQueueStart):d._updateQueueStart=T,this.output._storedValue=d}serialize(){const h=super.serialize();return h.limit=this.limit,h.delay=this.delay,h}_deserialize(h){super._deserialize(h),void 0!==h.limit&&(this.limit=h.limit),void 0!==h.delay&&(this.delay=h.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,k.c)([Rd("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],fT.prototype,"limit",void 0),(0,k.c)([Rd("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],fT.prototype,"delay",void 0),(0,X.e)("BABYLON.ParticleTriggerBlock",fT);T(14224),T(14234),T(14246),T(14295)},14283:(h,d,T)=>{"use strict";var Y=T(12663);const y="clipPlaneFragment",C="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14249:(h,d,T)=>{"use strict";var Y=T(12663);const y="clipPlaneFragmentDeclaration",C="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14318:(h,d,T)=>{"use strict";var Y=T(12663);const y="clipPlaneVertex",C="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14304:(h,d,T)=>{"use strict";var Y=T(12663);const y="clipPlaneVertexDeclaration",C="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14293:(h,d,T)=>{"use strict";var Y=T(12663);const y="fogFragment",C="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14281:(h,d,T)=>{"use strict";var Y=T(12663);const y="fogFragmentDeclaration",C="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14326:(h,d,T)=>{"use strict";var Y=T(12663);const y="fogVertex",C="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14311:(h,d,T)=>{"use strict";var Y=T(12663);const y="fogVertexDeclaration",C="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14267:(h,d,T)=>{"use strict";var Y=T(12663);const y="helperFunctions",C="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14255:(h,d,T)=>{"use strict";var Y=T(12663);const y="imageProcessingDeclaration",C="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14274:(h,d,T)=>{"use strict";var Y=T(12663);const y="imageProcessingFunctions",C="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14261:(h,d,T)=>{"use strict";var Y=T(12663);const y="logDepthDeclaration",C="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14288:(h,d,T)=>{"use strict";var Y=T(12663);const y="logDepthFragment",C="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14333:(h,d,T)=>{"use strict";var Y=T(12663);const y="logDepthVertex",C="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";Y.e.IncludesShadersStoreWGSL[y]||(Y.e.IncludesShadersStoreWGSL[y]=C)},14246:(h,d,T)=>{"use strict";T.r(d),T.d(d,{particlesPixelShaderWGSL:()=>n});var Y=T(12663);T(14249),T(14255),T(14261),T(14267),T(14274),T(14281),T(14283),T(14288),T(14293);const y="particlesPixelShader",C="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Y.e.ShadersStoreWGSL[y]||(Y.e.ShadersStoreWGSL[y]=C);const n={name:y,shader:C}},14295:(h,d,T)=>{"use strict";T.r(d),T.d(d,{particlesVertexShaderWGSL:()=>n});var Y=T(12663);T(14304),T(14311),T(14261),T(14318),T(14326),T(14333);const y="particlesVertexShader",C="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Y.e.ShadersStoreWGSL[y]||(Y.e.ShadersStoreWGSL[y]=C);const n={name:y,shader:C}},14151:(h,d,T)=>{"use strict";var Y=T(12663);const y="clipPlaneFragment",C="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14227:(h,d,T)=>{"use strict";var Y=T(12663);const y="clipPlaneFragmentDeclaration",C="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14183:(h,d,T)=>{"use strict";var Y=T(12663);const y="clipPlaneVertex",C="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14237:(h,d,T)=>{"use strict";var Y=T(12663);const y="clipPlaneVertexDeclaration",C="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14168:(h,d,T)=>{"use strict";var Y=T(12663);const y="fogFragment",C="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14147:(h,d,T)=>{"use strict";var Y=T(12663);const y="fogFragmentDeclaration",C="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14185:(h,d,T)=>{"use strict";var Y=T(12663);const y="fogVertex",C="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14174:(h,d,T)=>{"use strict";var Y=T(12663);const y="fogVertexDeclaration",C="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14129:(h,d,T)=>{"use strict";var Y=T(12663);const y="helperFunctions",C="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14116:(h,d,T)=>{"use strict";var Y=T(12663);const y="imageProcessingDeclaration",C="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14138:(h,d,T)=>{"use strict";var Y=T(12663);const y="imageProcessingFunctions",C="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14121:(h,d,T)=>{"use strict";var Y=T(12663);const y="logDepthDeclaration",C="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14159:(h,d,T)=>{"use strict";var Y=T(12663);const y="logDepthFragment",C="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14191:(h,d,T)=>{"use strict";var Y=T(12663);const y="logDepthVertex",C="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";Y.e.IncludesShadersStore[y]||(Y.e.IncludesShadersStore[y]=C)},14224:(h,d,T)=>{"use strict";T.r(d),T.d(d,{particlesPixelShader:()=>n});var Y=T(12663);T(14227),T(14116),T(14121),T(14129),T(14138),T(14147),T(14151),T(14159),T(14168);const y="particlesPixelShader",C="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Y.e.ShadersStore[y]||(Y.e.ShadersStore[y]=C);const n={name:y,shader:C}},14234:(h,d,T)=>{"use strict";T.r(d),T.d(d,{particlesVertexShader:()=>n});var Y=T(12663);T(14237),T(14174),T(14121),T(14183),T(14185),T(14191);const y="particlesVertexShader",C="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Y.e.ShadersStore[y]||(Y.e.ShadersStore[y]=C);const n={name:y,shader:C}},14581:(h,d,T)=>{"use strict";T.r(d),T.d(d,{FlowGraphGLTFDataProvider:()=>C});var Y=T(14548),y=T(14528);class C extends Y.e{constructor(h){var d,T;super();const Y=h.glTF,C=(null===(d=Y.animations)||void 0===d?void 0:d.map((h=>h._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",y.b,C);const n=(null===(T=Y.nodes)||void 0===T?void 0:T.map((h=>h._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",y.b,n)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14470:(h,d,T)=>{"use strict";T.d(d,{e:()=>J,h:()=>O,l:()=>c,m:()=>f});var Y=T(12765),y=T(13243),C=T(12812),n=T(14475);const X=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class F{constructor(h,d){this._gltf=h,this._infoTree=d}convert(h){let d,T=this._gltf,Y=this._infoTree;if(!h.startsWith("/"))throw new Error("Path must start with a /");const y=h.split("/");if(y.shift(),y[y.length-1].includes(".length")){const h=y[y.length-1].split(".");y.pop(),y.push(...h)}let C=!1;for(const F of y){const y="length"===F;if(y&&!Y.__array__)throw new Error(`Path ${h} is invalid`);if(Y.__ignoreObjectTree__&&(C=!0),Y.__array__&&!y)Y=Y.__array__;else if(Y=Y[F],!Y)throw new Error(`Path ${h} is invalid`);if(!C)if(void 0===T){if(!X.find((d=>d.regex.test(h))))throw new Error(`Path ${h} is invalid`)}else if(!y){var n;T=null===(n=T)||void 0===n?void 0:n[F]}(Y.__target__||y)&&(d=T)}return{object:d,info:Y}}}function U(h,d,T,Y){const y=Z(h,d);return Y?y[T][Y]:y[T]}function Z(h,d,T){var Y,C;return null===(Y=h._data)||void 0===Y||null===(C=Y[(null===T||void 0===T?void 0:T.fillMode)??y.b.MATERIAL_TriangleFillMode])||void 0===C?void 0:C.babylonMaterial}function S(h,d){return{offset:{componentsCount:2,type:"Vector2",get:(T,y,C)=>{const n=U(T,C,h,d);return new Y.Vector2(null===n||void 0===n?void 0:n.uOffset,null===n||void 0===n?void 0:n.vOffset)},getTarget:Z,set:(T,Y,y,C)=>{const n=U(Y,C,h,d);n.uOffset=T.x,n.vOffset=T.y},getPropertyName:[()=>`${h}${d?"."+d:""}.uOffset`,()=>`${h}${d?"."+d:""}.vOffset`]},rotation:{type:"number",get:(T,Y,y)=>{var C;return null===(C=U(T,y,h,d))||void 0===C?void 0:C.wAng},getTarget:Z,set:(T,Y,y,C)=>U(Y,C,h,d).wAng=T,getPropertyName:[()=>`${h}${d?"."+d:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(T,y,C)=>{const n=U(T,C,h,d);return new Y.Vector2(null===n||void 0===n?void 0:n.uScale,null===n||void 0===n?void 0:n.vScale)},getTarget:Z,set:(T,Y,y,C)=>{const n=U(Y,C,h,d);n.uScale=T.x,n.vScale=T.y},getPropertyName:[()=>`${h}${d?"."+d:""}.uScale`,()=>`${h}${d?"."+d:""}.vScale`]}}}const r={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:h=>{var d,T;return new Y.Vector2((null===(d=h._babylonCamera)||void 0===d?void 0:d.orthoLeft)??0,(null===(T=h._babylonCamera)||void 0===T?void 0:T.orthoRight)??0)},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.orthoLeft=h.x,d._babylonCamera.orthoRight=h.y)},getTarget:h=>h,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:h=>{var d,T;return new Y.Vector2((null===(d=h._babylonCamera)||void 0===d?void 0:d.orthoBottom)??0,(null===(T=h._babylonCamera)||void 0===T?void 0:T.orthoTop)??0)},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.orthoBottom=h.x,d._babylonCamera.orthoTop=h.y)},getTarget:h=>h,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:h=>{var d;return null===(d=h._babylonCamera)||void 0===d?void 0:d.maxZ},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.maxZ=h)},getTarget:h=>h,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:h=>{var d;return null===(d=h._babylonCamera)||void 0===d?void 0:d.Gd},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.Gd=h)},getTarget:h=>h,getPropertyName:[()=>"Gd"]}},perspective:{aspectRatio:{type:"number",get:h=>{var d;return null===(d=h._babylonCamera)||void 0===d?void 0:d.getEngine().getAspectRatio(h._babylonCamera)},getTarget:h=>h,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:h=>{var d;return null===(d=h._babylonCamera)||void 0===d?void 0:d.fov},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.fov=h)},getTarget:h=>h,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:h=>{var d;return null===(d=h._babylonCamera)||void 0===d?void 0:d.maxZ},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.maxZ=h)},getTarget:h=>h,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:h=>{var d;return null===(d=h._babylonCamera)||void 0===d?void 0:d.Gd},set:(h,d)=>{d._babylonCamera&&(d._babylonCamera.Gd=h)},getTarget:h=>h,getPropertyName:[()=>"Gd"]}}}},nodes:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"pd",get:h=>{var d;return null===(d=h._babylonTransformNode)||void 0===d?void 0:d.position},set:(h,d)=>{var T;return null===(T=d._babylonTransformNode)||void 0===T?void 0:T.position.C(h)},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:h=>{var d;return null===(d=h._babylonTransformNode)||void 0===d?void 0:d.rotationQuaternion},set:(h,d)=>{var T,Y;return null===(T=d._babylonTransformNode)||void 0===T||null===(Y=T.rotationQuaternion)||void 0===Y?void 0:Y.C(h)},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"pd",get:h=>{var d;return null===(d=h._babylonTransformNode)||void 0===d?void 0:d.py},set:(h,d)=>{var T;return null===(T=d._babylonTransformNode)||void 0===T?void 0:T.py.C(h)},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"py"]},weights:{length:{type:"number",get:h=>h._numMorphTargets,getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(h,d)=>{var T,Y;return void 0!==d?null===(T=h._primitiveBabylonMeshes)||void 0===T||null===(Y=T[0].morphTargetManager)||void 0===Y?void 0:Y.getTarget(d).influence:void 0},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(h,d)=>[0],getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:h=>{var d,T,y;return Y.Matrix.Compose(null===(d=h._babylonTransformNode)||void 0===d?void 0:d.py,null===(T=h._babylonTransformNode)||void 0===T?void 0:T.rotationQuaternion,null===(y=h._babylonTransformNode)||void 0===y?void 0:y.position)},getTarget:h=>h._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:h=>{var d,T,y,C;const n=Y.Matrix.Identity();let X=h.parent;for(;X&&X.parent;)X=X.parent;const F=(null===(d=h._babylonTransformNode)||void 0===d?void 0:d.position._isDirty)||(null===(T=h._babylonTransformNode)||void 0===T||null===(y=T.rotationQuaternion)||void 0===y?void 0:y._isDirty)||(null===(C=h._babylonTransformNode)||void 0===C?void 0:C.py._isDirty);if(X){var U;const d=null===(U=X._babylonTransformNode)||void 0===U?void 0:U.Md(!0).invert();var Z,S;if(d)null===(Z=h._babylonTransformNode)||void 0===Z||null===(S=Z.Md(F))||void 0===S||S.multiplyToRef(d,n)}else h._babylonTransformNode&&n.C(h._babylonTransformNode.Md(F));return n},getTarget:h=>h._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:h=>{var d,T;return null===(d=h._babylonTransformNode)||void 0===d||null===(T=d.getChildren((h=>h instanceof n.b),!0)[0])||void 0===T?void 0:T.aX},getTarget:h=>{var d;return null===(d=h._babylonTransformNode)||void 0===d?void 0:d.getChildren((h=>h instanceof n.b),!0)[0]},set:(h,d)=>{if(d._babylonTransformNode){const T=d._babylonTransformNode.getChildren((h=>h instanceof n.b),!0)[0];T&&(T.aX=h)}}},color:{type:"ed",get:h=>{var d,T;return null===(d=h._babylonTransformNode)||void 0===d||null===(T=d.getChildren((h=>h instanceof n.b),!0)[0])||void 0===T?void 0:T.eX},getTarget:h=>{var d;return null===(d=h._babylonTransformNode)||void 0===d?void 0:d.getChildren((h=>h instanceof n.b),!0)[0]},set:(h,d)=>{if(d._babylonTransformNode){const T=d._babylonTransformNode.getChildren((h=>h instanceof n.b),!0)[0];T&&(T.eX=h)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"ed",get:(h,d,T)=>Z(h,d,T).emissiveColor,set:(h,d,T,Y)=>Z(d,T,Y).emissiveColor.C(h),getTarget:(h,d,T)=>Z(h,d,T),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:S("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(h,d,T)=>{var Y;return null===(Y=U(h,T,"bumpTexture"))||void 0===Y?void 0:Y.level},set:(h,d,T,Y)=>{const y=U(d,Y,"bumpTexture");y&&(y.level=h)},getTarget:(h,d,T)=>Z(h,d,T),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:S("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(h,d,T)=>Z(h,d,T).ambientTextureStrength,set:(h,d,T,Y)=>{const y=Z(d,T,Y);y&&(y.ambientTextureStrength=h)},getTarget:(h,d,T)=>Z(h,d,T),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:S("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"ln",get:(h,d,T)=>{const Y=Z(h,d,T);return C.ln.FromColor3(Y.albedoColor,Y.alpha)},set:(h,d,T,Y)=>{const y=Z(d,T,Y);y.albedoColor.set(h.r,h.g,h.b),y.alpha=h.a},getTarget:(h,d,T)=>Z(h,d,T),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:S("albedoTexture")}},metallicFactor:{type:"number",get:(h,d,T)=>Z(h,d,T).metallic,set:(h,d,T,Y)=>{const y=Z(d,T,Y);y&&(y.metallic=h)},getTarget:(h,d,T)=>Z(h,d,T),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(h,d,T)=>Z(h,d,T).roughness,set:(h,d,T,Y)=>{const y=Z(d,T,Y);y&&(y.roughness=h)},getTarget:(h,d,T)=>Z(h,d,T),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:S("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(h,d,T)=>Z(h,d,T).anisotropy.aX,set:(h,d,T,Y)=>{Z(d,T,Y).anisotropy.aX=h},getTarget:(h,d,T)=>Z(h,d,T),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(h,d,T)=>Z(h,d,T).anisotropy.angle,set:(h,d,T,Y)=>{Z(d,T,Y).anisotropy.angle=h},getTarget:(h,d,T)=>Z(h,d,T),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:S("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(h,d,T)=>Z(h,d,T).clearCoat.aX,set:(h,d,T,Y)=>{Z(d,T,Y).clearCoat.aX=h},getTarget:(h,d,T)=>Z(h,d,T),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(h,d,T)=>Z(h,d,T).clearCoat.roughness,set:(h,d,T,Y)=>{Z(d,T,Y).clearCoat.roughness=h},getTarget:(h,d,T)=>Z(h,d,T),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:S("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(h,d,T)=>{var Y;return null===(Y=Z(h,d,T).clearCoat.bumpTexture)||void 0===Y?void 0:Y.level},getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).clearCoat.bumpTexture.level=h},extensions:{KHR_texture_transform:S("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:S("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(h,d,T)=>Z(h,d,T).subSurface.dispersion,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).subSurface.dispersion=h}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(h,d,T)=>Z(h,d,T).emissiveIntensity,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).emissiveIntensity=h}},KHR_materials_ior:{ior:{type:"number",get:(h,d,T)=>Z(h,d,T).indexOfRefraction,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).indexOfRefraction=h}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(h,d,T)=>Z(h,d,T).iridescence.aX,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).iridescence.aX=h},iridescenceIor:{type:"number",get:(h,d,T)=>Z(h,d,T).iridescence.indexOfRefraction,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).iridescence.indexOfRefraction=h},iridescenceTexture:{extensions:{KHR_texture_transform:S("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(h,d,T)=>Z(h,d,T).iridescence.maximumThickness,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).iridescence.maximumThickness=h},iridescenceThicknessMinimum:{type:"number",get:(h,d,T)=>Z(h,d,T).iridescence.minimumThickness,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).iridescence.minimumThickness=h},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:S("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"ed",get:(h,d,T)=>Z(h,d,T).sheen.color,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).sheen.color.C(h)},sheenColorTexture:{extensions:{KHR_texture_transform:S("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(h,d,T)=>Z(h,d,T).sheen.aX,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).sheen.aX=h},sheenRoughnessTexture:{extensions:{KHR_texture_transform:S("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(h,d,T)=>Z(h,d,T).metallicF0Factor,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).metallicF0Factor=h,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"ed",get:(h,d,T)=>Z(h,d,T).metallicReflectanceColor,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).metallicReflectanceColor.C(h),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:S("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:S("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(h,d,T)=>Z(h,d,T).subSurface.refractionIntensity,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).subSurface.refractionIntensity=h,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:S("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(h,d,T)=>Z(h,d,T).subSurface.translucencyIntensity,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).subSurface.translucencyIntensity=h},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:S("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"ed",get:(h,d,T)=>Z(h,d,T).subSurface.translucencyColor,getTarget:Z,set:(h,d,T,Y)=>{var y;return h&&(null===(y=Z(d,T,Y).subSurface.translucencyColor)||void 0===y?void 0:y.C(h))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:S("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"ed",get:(h,d,T)=>Z(h,d,T).subSurface.tintColor,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).subSurface.tintColor.C(h)},attenuationDistance:{type:"number",get:(h,d,T)=>Z(h,d,T).subSurface.tintColorAtDistance,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).subSurface.tintColorAtDistance=h},thicknessFactor:{type:"number",get:(h,d,T)=>Z(h,d,T).subSurface.maximumThickness,getTarget:Z,set:(h,d,T,Y)=>Z(d,T,Y).subSurface.maximumThickness=h},thicknessTexture:{extensions:{KHR_texture_transform:S("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonLight)),getPropertyName:[h=>"length"]},__array__:{__target__:!0,color:{type:"ed",get:h=>{var d;return null===(d=h._babylonLight)||void 0===d?void 0:d.eX},set:(h,d)=>{var T;return null===(T=d._babylonLight)||void 0===T?void 0:T.eX.C(h)},getTarget:h=>h._babylonLight,getPropertyName:[h=>"diffuse"]},aX:{type:"number",get:h=>{var d;return null===(d=h._babylonLight)||void 0===d?void 0:d.aX},set:(h,d)=>d._babylonLight?d._babylonLight.aX=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"intensity"]},range:{type:"number",get:h=>{var d;return null===(d=h._babylonLight)||void 0===d?void 0:d.range},set:(h,d)=>d._babylonLight?d._babylonLight.range=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"range"]},spot:{innerConeAngle:{type:"number",get:h=>{var d;return null===(d=h._babylonLight)||void 0===d?void 0:d.innerAngle},set:(h,d)=>d._babylonLight?d._babylonLight.innerAngle=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"innerConeAngle"]},outerConeAngle:{type:"number",get:h=>{var d;return null===(d=h._babylonLight)||void 0===d?void 0:d.angle},set:(h,d)=>d._babylonLight?d._babylonLight.angle=h:void 0,getTarget:h=>h._babylonLight,getPropertyName:[h=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonLight)),getPropertyName:[h=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonTexture)),getPropertyName:[h=>"length"]},__array__:{__target__:!0,aX:{type:"number",get:h=>{var d;return null===(d=h._babylonTexture)||void 0===d?void 0:d.level},set:(h,d)=>{d._babylonTexture&&(d._babylonTexture.level=h)},getTarget:h=>h._babylonTexture},rotation:{type:"Quaternion",get:h=>{var d;return h._babylonTexture&&Y.Quaternion.FromRotationMatrix(null===(d=h._babylonTexture)||void 0===d?void 0:d.getReflectionTextureMatrix())},set:(h,d)=>{var T;d._babylonTexture&&(null!==(T=d._babylonTexture.Eh())&&void 0!==T&&T.useRightHandedSystem||(h=Y.Quaternion.Inverse(h)),Y.Matrix.FromQuaternionToRef(h,d._babylonTexture.getReflectionTextureMatrix()))},getTarget:h=>h._babylonTexture}}}}},animations:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>h._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:h=>h.length,getTarget:h=>h.map((h=>{var d;return null===(d=h.primitives[0]._instanceData)||void 0===d?void 0:d.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function c(h){return new F(h,r)}function O(h){const d=h.split("/").map((h=>h.replace(/{}/g,"__array__")));let T=r;for(const Y of d)Y&&(T=T[Y]);if(T&&T.type&&T.get)return T}function f(h,d){const T=h.split("/").map((h=>h.replace(/{}/g,"__array__")));let Y=r;for(const y of T)y&&(Y=Y[y]);Y&&Y.type&&Y.get&&(Y.interpolation=d)}function J(h,d){const T=h.split("/").map((h=>h.replace(/{}/g,"__array__")));let Y=r;for(const y of T)if(y){if(!Y[y]){if("?"===y){Y.__ignoreObjectTree__=!0;continue}Y[y]={},"__array__"===y&&(Y[y].__target__=!0)}Y=Y[y]}Object.assign(Y,d)}},14483:(h,d,T)=>{"use strict";T.r(d),T.d(d,{AnimationPropertyInfo:()=>U,TransformNodeAnimationPropertyInfo:()=>Z,WeightAnimationPropertyInfo:()=>S,getQuaternion:()=>X,getVector3:()=>n,getWeights:()=>F});var Y=T(13301),y=T(12765),C=T(14470);function n(h,d,T,Y){return y.pd.Bd(d,T).scaleInPlace(Y)}function X(h,d,T,Y){return y.Quaternion.Bd(d,T).scaleInPlace(Y)}function F(h,d,T,Y){const y=new Array(h._numMorphTargets);for(let C=0;C<y.length;C++)y[C]=d[T++]*Y;return y}class U{constructor(h,d,T,Y){this.type=h,this.name=d,this.getValue=T,this.getStride=Y}_buildAnimation(h,d,T){const y=new Y.c(h,this.name,d,this.type);return y.setKeys(T),y}}class Z extends U{buildAnimations(h,d,T,Y){const y=[];return y.push({babylonAnimatable:h._babylonTransformNode,babylonAnimation:this._buildAnimation(d,T,Y)}),y}}class S extends U{buildAnimations(h,d,T,y){const C=[];if(h._numMorphTargets)for(let n=0;n<h._numMorphTargets;n++){const X=new Y.c(`${d}_${n}`,this.name,T,this.type);if(X.setKeys(y.map((h=>({frame:h.frame,inTangent:h.inTangent?h.inTangent[n]:void 0,value:h.value[n],outTangent:h.outTangent?h.outTangent[n]:void 0,interpolation:h.interpolation})))),h._primitiveBabylonMeshes)for(const d of h._primitiveBabylonMeshes)if(d.morphTargetManager){const h=d.morphTargetManager.getTarget(n),T=X.clone();h.animations.push(T),C.push({babylonAnimatable:h,babylonAnimation:T})}}return C}}(0,C.m)("/nodes/{}/translation",[new Z(Y.c.ANIMATIONTYPE_VECTOR3,"position",n,(()=>3))]),(0,C.m)("/nodes/{}/rotation",[new Z(Y.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",X,(()=>4))]),(0,C.m)("/nodes/{}/scale",[new Z(Y.c.ANIMATIONTYPE_VECTOR3,"py",n,(()=>3))]),(0,C.m)("/nodes/{}/weights",[new S(Y.c.ANIMATIONTYPE_FLOAT,"influence",F,(h=>h._numMorphTargets))])},14441:(h,d,T)=>{"use strict";class Y{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((h,d)=>{this._resolve=h,this._reject=d}))}}var y=T(12765),C=T(12812),n=T(12574),X=T(13222),F=T(14450),U=T(14457),Z=T(12583),S=T(13238),r=T(13301),c=T(13306),O=T(12625),f=T(12596),J=T(12604);class W{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(h){this._useTextureToStoreBoneMatrices=h,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(h){this._animationPropertiesOverride=h}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(h,d,T){this.name=h,this.id=d,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=y.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new Z.e,this.bones=[],this._scene=T||O.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const Y=this._scene.getEngine().getCaps();this._canUseTextureForBones=Y.textureFloat&&Y.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((h=>!h.getParent()))}getTransformMatrices(h){if(this.needInitialSkinMatrix){if(!h)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return h._bonesTransformMatrices||this.prepare(!0),h._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(h){return this.needInitialSkinMatrix&&h._transformMatrixTexture?h._transformMatrixTexture:this._transformMatrixTexture}Eh(){return this._scene}toString(h){let d=`Name: ${this.name}, nBones: ${this.bones.length}`;if(d+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,h){d+=", Ranges: {";let h=!0;for(const T in this._ranges)h&&(d+=", ",h=!1),d+=T;d+="}"}return d}getBoneIndexByName(h){for(let d=0,T=this.bones.length;d<T;d++)if(this.bones[d].name===h)return d;return-1}createAnimationRange(h,d,T){if(!this._ranges[h]){this._ranges[h]=new c.b(h,d,T);for(let Y=0,y=this.bones.length;Y<y;Y++)this.bones[Y].animations[0]&&this.bones[Y].animations[0].createRange(h,d,T)}}deleteAnimationRange(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let T=0,Y=this.bones.length;T<Y;T++)this.bones[T].animations[0]&&this.bones[T].animations[0].deleteRange(h,d);this._ranges[h]=null}getAnimationRange(h){return this._ranges[h]||null}getAnimationRanges(){const h=[];let d;for(d in this._ranges)h.push(this._ranges[d]);return h}copyAnimationRange(h,d){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[d]||!h.getAnimationRange(d))return!1;let Y=!0;const y=this._getHighestAnimationFrame()+1,C={},n=h.bones;let X,F;for(F=0,X=n.length;F<X;F++)C[n[F].name]=n[F];this.bones.length!==n.length&&(f.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${n.length}`),Y=!1);const U=T&&this.dimensionsAtRest&&h.dimensionsAtRest?this.dimensionsAtRest.divide(h.dimensionsAtRest):null;for(F=0,X=this.bones.length;F<X;F++){const h=this.bones[F].name,n=C[h];n?Y=Y&&this.bones[F].copyAnimationRange(n,d,y,T,U):(f.c.Warn("copyAnimationRange: not same rig, missing source bone "+h),Y=!1)}const Z=h.getAnimationRange(d);return Z&&(this._ranges[d]=new c.b(d,Z.from+y,Z.to+y)),Y}returnToRest(){for(const h of this.bones)-1!==h._index&&h.returnToRest()}_getHighestAnimationFrame(){let h=0;for(let d=0,T=this.bones.length;d<T;d++)if(this.bones[d].animations[0]){const T=this.bones[d].animations[0].getHighestFrame();h<T&&(h=T)}return h}beginAnimation(h,d,T,Y){const y=this.getAnimationRange(h);return y?this._scene.beginAnimation(this,y.from,y.to,d,T,Y):null}static MakeAnimationAdditive(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;const Y=h.getAnimationRange(T);if(!Y)return null;const y=h._scene.getAllAnimatablesByTarget(h);let C=null;for(let X=0;X<y.length;X++){const h=y[X];if(h.fromFrame===(null===Y||void 0===Y?void 0:Y.from)&&h.toFrame===(null===Y||void 0===Y?void 0:Y.to)){C=h;break}}const n=h.getAnimatables();for(let X=0;X<n.length;X++){const h=n[X].animations;if(h)for(let Y=0;Y<h.length;Y++)r.c.MakeAnimationAdditive(h[Y],d,T)}return C&&(C.isAdditive=!0),h}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(h){this._meshesWithPoseMatrix.push(h)}_unregisterMeshWithPoseMatrix(h){const d=this._meshesWithPoseMatrix.indexOf(h);d>-1&&this._meshesWithPoseMatrix.splice(d,1)}_computeTransformMatrices(h,d){this.onBeforeComputeObservable.notifyObservers(this);for(let T=0;T<this.bones.length;T++){const Y=this.bones[T];Y._childUpdateId++;const y=Y.getParent();if(y?Y.getLocalMatrix().multiplyToRef(y.getFinalMatrix(),Y.getFinalMatrix()):d?Y.getLocalMatrix().multiplyToRef(d,Y.getFinalMatrix()):Y.getFinalMatrix().C(Y.getLocalMatrix()),-1!==Y._index){const d=null===Y._index?T:Y._index;Y.getAbsoluteInverseBindMatrix().multiplyToArray(Y.getFinalMatrix(),h,16*d)}}this._identity.copyToArray(h,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const h=this.Eh().getRenderId();if(this._currentRenderId===h)return;this._currentRenderId=h}if(this._numBonesWithLinkedTransformNode>0)for(const h of this.bones)if(h._linkedTransformNode){const d=h._linkedTransformNode;h.position=d.position,d.rotationQuaternion?h.rotationQuaternion=d.rotationQuaternion:h.rotation=d.rotation,h.py=d.py}if(this.needInitialSkinMatrix)for(const h of this._meshesWithPoseMatrix){const d=h.getPoseMatrix();let T=this._isDirty;if(h._bonesTransformMatrices&&h._bonesTransformMatrices.length===16*(this.bones.length+1)||(h._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),T=!0),T){if(this._synchronizedWithMesh!==h){this._synchronizedWithMesh=h;for(const h of this.bones)if(!h.getParent()){h.getBindMatrix().multiplyToRef(d,y.TmpVectors.Matrix[1]),h._updateAbsoluteBindMatrices(y.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const d=4*(this.bones.length+1);h._transformMatrixTexture&&h._transformMatrixTexture.getSize().width===d||(h._transformMatrixTexture&&h._transformMatrixTexture.dispose(),h._transformMatrixTexture=S.b.CreateRGBATexture(h._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(h._bonesTransformMatrices,d),this.isUsingTextureForMatrices&&h._transformMatrixTexture&&h._transformMatrixTexture.update(h._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=S.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let h=0;h<this.bones.length;h++)this._animatables.push(this.bones[h])}return this._animatables}clone(h,d){const T=new W(h,d||h,this._scene);T.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Y=0;Y<this.bones.length;Y++){const h=this.bones[Y];let d=null;const y=h.getParent();if(y){const h=this.bones.indexOf(y);d=T.bones[h]}const C=new U.e(h.name,T,d,h.getBindMatrix().clone(),h.getRestMatrix().clone());C._index=h._index,h._linkedTransformNode&&C.linkTransformNode(h._linkedTransformNode),J.d.DeepCopy(h.animations,C.animations)}if(this._ranges){T._ranges={};for(const h in this._ranges){const d=this._ranges[h];d&&(T._ranges[h]=d.clone())}}return this._isDirty=!0,T.prepare(!0),T}enableBlending(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const d of this.bones)for(const T of d.animations)T.enableBlending=!0,T.blendingSpeed=h}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Eh().stopAnimation(this),this.Eh().removeSkeleton(this),this._parentContainer){const h=this._parentContainer.skeletons.indexOf(this);h>-1&&this._parentContainer.skeletons.splice(h,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const h={};h.name=this.name,h.id=this.id,this.dimensionsAtRest&&(h.dimensionsAtRest=this.dimensionsAtRest.ad()),h.bones=[],h.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let T=0;T<this.bones.length;T++){var d;const Y=this.bones[T],y=Y.getParent(),C={parentBoneIndex:y?this.bones.indexOf(y):-1,index:Y.getIndex(),name:Y.name,id:Y.id,matrix:Y.getBindMatrix().ad(),rest:Y.getRestMatrix().ad(),linkedTransformNodeId:null===(d=Y.getTransformNode())||void 0===d?void 0:d.id};h.bones.push(C),Y.length&&(C.length=Y.length),Y.metadata&&(C.metadata=Y.metadata),Y.animations&&Y.animations.length>0&&(C.animation=Y.animations[0].serialize()),h.ranges=[];for(const d in this._ranges){const T=this._ranges[d];if(!T)continue;const Y={};Y.name=d,Y.from=T.from,Y.to=T.to,h.ranges.push(Y)}}return h}static Parse(h,d){const T=new W(h.name,h.id,d);let Y;for(h.dimensionsAtRest&&(T.dimensionsAtRest=y.pd.Bd(h.dimensionsAtRest)),T.needInitialSkinMatrix=h.needInitialSkinMatrix,Y=0;Y<h.bones.length;Y++){const d=h.bones[Y],C=h.bones[Y].index;let n=null;d.parentBoneIndex>-1&&(n=T.bones[d.parentBoneIndex]);const X=d.rest?y.Matrix.Bd(d.rest):null,F=new U.e(d.name,T,n,y.Matrix.Bd(d.matrix),X,null,C);void 0!==d.id&&null!==d.id&&(F.id=d.id),d.length&&(F.length=d.length),d.metadata&&(F.metadata=d.metadata),d.animation&&F.animations.push(r.c.Parse(d.animation)),void 0!==d.linkedTransformNodeId&&null!==d.linkedTransformNodeId&&(T._hasWaitingData=!0,F._waitingTransformNodeId=d.linkedTransformNodeId)}if(h.ranges)for(Y=0;Y<h.ranges.length;Y++){const d=h.ranges[Y];T.createAnimationRange(d.name,d.from,d.to)}return T}computeAbsoluteMatrices(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||h)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(h)}getPoseMatrix(){let h=null;return this._meshesWithPoseMatrix.length>0&&(h=this._meshesWithPoseMatrix[0].getPoseMatrix()),h}sortBones(){const h=[],d=new Array(this.bones.length);for(let T=0;T<this.bones.length;T++)this._sortBones(T,h,d);this.bones=h}_sortBones(h,d,T){if(T[h])return;T[h]=!0;const Y=this.bones[h];if(!Y)return;void 0===Y._index&&(Y._index=h);const y=Y.getParent();y&&this._sortBones(this.bones.indexOf(y),d,T),d.push(Y)}setCurrentPoseAsRest(){for(const h of this.bones)h.setCurrentPoseAsRest()}}var L=T(13089),D=T(13259),V=T(12741),i=T(13192),w=T(12835),s=T(13225),E=T(13198),z=T(13213),x=T(13315),g=T(12858),H=T(14401);class p{set areUpdatesFrozen(h){h?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new g.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,h||(h=O.d.LastCreatedScene),this._scene=h,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const h=this._scene.getEngine().getCaps();this._canUseTextureForTargets=h.canUseGLVertexID&&h.textureFloat&&h.maxVertexTextureImageUnits>0&&h.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return p.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?p.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(h){this._numMaxInfluencers!==h&&(this._numMaxInfluencers=h,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(h){this._useTextureToStoreTargets!==h&&(this._useTextureToStoreTargets=h,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var h;return p.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(h=this._scene)&&void 0!==h&&h.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(h){return this._activeTargets.data[h]}getTarget(h){return this._targets[h]}getTargetByName(h){for(const d of this._targets)if(d.name===h)return d;return null}addTarget(h){this._targets.push(h),this._targetInfluenceChangedObservers.push(h.onInfluenceChanged.add((h=>{this.areUpdatesFrozen&&h&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(h)}))),this._targetDataLayoutChangedObservers.push(h._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(h){const d=this._targets.indexOf(h);d>=0&&(this._targets.splice(d,1),h.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(d,1)[0]),h._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(d,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(h)}_bind(h){h.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),h.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),h.setTexture("morphTargets",this._targetStoreTexture),h.setInt("morphTargetCount",this.numInfluencers)}clone(){const h=new p(this._scene);for(const d of this._targets)h.addTarget(d.clone());return h.enablePositionMorphing=this.enablePositionMorphing,h.enableNormalMorphing=this.enableNormalMorphing,h.enableTangentMorphing=this.enableTangentMorphing,h.enableUVMorphing=this.enableUVMorphing,h.enableUV2Morphing=this.enableUV2Morphing,h.enableColorMorphing=this.enableColorMorphing,h}serialize(){const h={};h.id=this.uniqueId,h.targets=[];for(const d of this._targets)h.targets.push(d.serialize());return h}_syncActiveTargets(){let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const d=!!this._targetStoreTexture,T=this.isUsingTextureForTargets;(this._mustSynchronize||d!==T)&&(this._mustSynchronize=!1,this.synchronize());let Y=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let y=-1;for(const C of this._targets)if(y++,0!==C.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=p.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(C),this._morphTargetTextureIndices[Y]=y,this._tempInfluences[Y++]=C.influence}this._morphTargetTextureIndices.length!==Y&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,Y)),this._influences&&this._influences.length===Y||(this._influences=new Float32Array(Y));for(let C=0;C<Y;C++)this._influences[C]=this._tempInfluences[C];if(h&&this._scene)for(const C of this._scene.meshes)C.morphTargetManager===this&&(T?C._markSubMeshesAsAttributesDirty():C._syncGeometryWithMorphTargetManager())}synchronize(){var h;if(!this._scene||this.areUpdatesFrozen)return;const d=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(h=this._targetStoreTexture)||void 0===h||h.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>d.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const T of this._targets){this._supportsPositions=this._supportsPositions&&T.hasPositions,this._supportsNormals=this._supportsNormals&&T.hasNormals,this._supportsTangents=this._supportsTangents&&T.hasTangents,this._supportsUVs=this._supportsUVs&&T.hasUVs,this._supportsUV2s=this._supportsUV2s&&T.hasUV2s,this._supportsColors=this._supportsColors&&T.hasColors;const h=T.vertexCount;if(0===this._vertexCount)this._vertexCount=h;else if(this._vertexCount!==h)return void f.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${T.name}": ${h}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const h=d.getCaps().maxTextureSize;this._textureWidth>h&&(this._textureHeight=Math.ceil(this._textureWidth/h),this._textureWidth=h);const T=this._targets.length,Y=new Float32Array(T*this._textureWidth*this._textureHeight*4);let y=0;for(let d=0;d<T;d++){const h=this._targets[d],T=h.getPositions(),C=h.getNormals(),n=h.getUVs(),X=h.getTangents(),F=h.getUV2s(),U=h.getColors();y=d*this._textureWidth*this._textureHeight*4;for(let d=0;d<this._vertexCount;d++)this._supportsPositions&&T&&(Y[y]=T[3*d],Y[y+1]=T[3*d+1],Y[y+2]=T[3*d+2],y+=4),this._supportsNormals&&C&&(Y[y]=C[3*d],Y[y+1]=C[3*d+1],Y[y+2]=C[3*d+2],y+=4),this._supportsUVs&&n&&(Y[y]=n[2*d],Y[y+1]=n[2*d+1],y+=4),this._supportsTangents&&X&&(Y[y]=X[3*d],Y[y+1]=X[3*d+1],Y[y+2]=X[3*d+2],y+=4),this._supportsUV2s&&F&&(Y[y]=F[2*d],Y[y+1]=F[2*d+1],y+=4),this._supportsColors&&U&&(Y[y]=U[4*d],Y[y+1]=U[4*d+1],Y[y+2]=U[4*d+2],Y[y+3]=U[4*d+3],y+=4)}this._targetStoreTexture=H.d.CreateRGBATexture(Y,this._textureWidth,this._textureHeight,T,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const T of this._scene.meshes)T.morphTargetManager===this&&T._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const h=this._parentContainer.morphTargetManagers.indexOf(this);h>-1&&this._parentContainer.morphTargetManagers.splice(h,1),this._parentContainer=null}for(const h of this._targets)this._scene.stopAnimation(h)}}static Parse(h,d){const T=new p(d);for(const Y of h.targets)T.addTarget(x.d.Parse(Y,d));return T}}p.EnableTextureStorage=!0,p.MaxActiveMorphTargetsInVertexAttributeMode=8,p.ConstantTargetCountForTextureMode=0;var k=T(14460),o=T(12627),u=T(13107);const N=new Map,K=N;function l(h,d,T){q(h)&&f.c.Warn(`Extension with the name '${h}' already exists`),N.set(h,{isGLTFExtension:d,factory:T})}function q(h){return N.delete(h)}var j=T(14470),a=T(13381),e=T(12850);class v{static Get(h,d,T){if(!d||void 0==T||!d[T])throw new Error(`${h}: Failed to find index (${T})`);return d[T]}static TryGet(h,d){return h&&void 0!=d&&h[d]?h[d]:null}static Assign(h){if(h)for(let d=0;d<h.length;d++)h[d].index=d}}function G(h){if(h.min&&h.max){const d=h.min,T=h.max,Y=y.TmpVectors.pd[0].ny(d[0],d[1],d[2]),C=y.TmpVectors.pd[1].ny(T[0],T[1],T[2]);if(h.normalized&&5126!==h.componentType){let d=1;switch(h.componentType){case 5120:d=127;break;case 5121:d=255;break;case 5122:d=32767;break;case 5123:d=65535}const T=1/d;Y.scaleInPlace(T),C.scaleInPlace(T)}return new u.c(Y,C)}return null}class b{static RegisterExtension(h,d){l(h,!1,d)}static UnregisterExtension(h){return q(h)}get ud(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(h){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=h}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((h=>h.dispose&&h.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(h,d,T,Y,y,C){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=d,this._assetContainer=T,this._loadData(Y);let C=null;if(h){const d={};if(this._gltf.nodes)for(const h of this._gltf.nodes)h.name&&(d[h.name]=h.index);C=(h instanceof Array?h:[h]).map((h=>{const T=d[h];if(void 0===T)throw new Error(`Failed to find node '${h}'`);return T}))}return await this._loadAsync(y,n,C,(()=>({meshes:this._getMeshes(),Fr:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(h,d,T,Y){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=h,this._loadData(d),await this._loadAsync(T,y,null,(()=>{}))}async _loadAsync(h,d,T,Y){return await Promise.resolve().then((async()=>{this._rootUrl=h,this._uniqueRootUrl=!h.startsWith("file:")&&d?h:`${h}${Date.now()}/`,this._fileName=d,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const y=`${k.j[k.j.LOADING]} => ${k.j[k.j.READY]}`,C=`${k.j[k.j.LOADING]} => ${k.j[k.j.COMPLETE]}`;this._parent._startPerformanceCounter(y),this._parent._startPerformanceCounter(C),this._parent._setState(k.j.LOADING),this._extensionsOnLoading();const X=new Array;if(!this.parent.loadOnlyMaterials)if(T)X.push(this.loadSceneAsync("/nodes",{nodes:T,index:-1}));else if(void 0!=this._gltf.qd||this._gltf.scenes&&this._gltf.scenes[0]){const h=v.Get("/scene",this._gltf.scenes,this._gltf.qd||0);X.push(this.loadSceneAsync(`/scenes/${h.index}`,h))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let h=0;h<this._gltf.materials.length;++h){const d=this._gltf.materials[h],T="/materials/"+h,Y=L.d.TriangleFillMode;X.push(this._loadMaterialAsync(T,d,null,Y,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&X.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&X.push(this._compileShadowGeneratorsAsync());const F=Promise.all(X).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.yF(!0);for(const h of this._babylonScene.materials){const d=h;void 0!==d.maxSimultaneousLights&&(d.maxSimultaneousLights=Math.max(d.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(k.j.READY),this._skipStartAnimationStep||this._startAnimations(),Y()}));return await F.then((h=>(this._parent._endPerformanceCounter(y),n.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(C),this._parent._setState(k.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(h=>{this._parent.onErrorObservable.notifyObservers(h),this._parent.onErrorObservable.clear(),this.dispose()}))})),h)))})).catch((h=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(h),this._parent.onErrorObservable.clear(),this.dispose()),h}))}_loadData(h){if(this._gltf=h.json,this._setupData(),h.bin){const d=this._gltf.buffers;if(d&&d[0]&&!d[0].uri){const T=d[0];(T.byteLength<h.bin.byteLength-3||T.byteLength>h.bin.byteLength)&&f.c.Warn(`Binary buffer length (${T.byteLength}) from JSON does not match chunk length (${h.bin.byteLength})`),this._bin=h.bin}else f.c.Warn("Unexpected BIN chunk")}}_setupData(){if(v.Assign(this._gltf.accessors),v.Assign(this._gltf.animations),v.Assign(this._gltf.buffers),v.Assign(this._gltf.bufferViews),v.Assign(this._gltf.cameras),v.Assign(this._gltf.images),v.Assign(this._gltf.materials),v.Assign(this._gltf.meshes),v.Assign(this._gltf.nodes),v.Assign(this._gltf.samplers),v.Assign(this._gltf.scenes),v.Assign(this._gltf.skins),v.Assign(this._gltf.textures),this._gltf.nodes){const h={};for(const T of this._gltf.nodes)if(T.children)for(const d of T.children)h[d]=T.index;const d=this._createRootNode();for(const T of this._gltf.nodes){const Y=h[T.index];T.parent=void 0===Y?d:this._gltf.nodes[Y]}}}async _loadExtensionsAsync(){const h=[];if(K.forEach(((d,T)=>{var Y;!1===(null===(Y=this.parent.extensionOptions[T])||void 0===Y?void 0:Y.enabled)?d.isGLTFExtension&&this.isExtensionUsed(T)&&f.c.Warn(`Extension ${T} is used but has been explicitly disabled.`):d.isGLTFExtension&&!this.isExtensionUsed(T)||h.push((async()=>{const h=await d.factory(this);return h.name!==T&&f.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${h.name} !== ${T}`),this._parent.onExtensionLoadedObservable.notifyObservers(h),h})())})),this._extensions.push(...await Promise.all(h)),this._extensions.sort(((h,d)=>(h.order||Number.MAX_VALUE)-(d.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const T of this._gltf.extensionsRequired){if(!this._extensions.some((h=>h.name===T&&h.enabled))){var d;if(!1===(null===(d=this.parent.extensionOptions[T])||void 0===d?void 0:d.enabled))throw new Error(`Required extension ${T} is disabled`);throw new Error(`Required extension ${T} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new z.d("__root__",this._babylonScene);this._rootBabylonMesh=h,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.yF(!1);const d={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case k.i.AUTO:this._babylonScene.useRightHandedSystem||(d.rotation=[0,1,0,0],d.scale=[1,1,-1],b._LoadTransform(d,this._rootBabylonMesh));break;case k.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(h),d}loadSceneAsync(h,d){const T=this._extensionsLoadSceneAsync(h,d);if(T)return T;const Y=new Array;if(this.logOpen(`${h} ${d.name||""}`),d.nodes)for(const y of d.nodes){const d=v.Get(`${h}/nodes/${y}`,this._gltf.nodes,y);Y.push(this.loadNodeAsync(`/nodes/${d.index}`,d,(h=>{h.parent=this._rootBabylonMesh})))}for(const y of this._postSceneLoadActions)y();return Y.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(Y).then((()=>{}))}_forEachPrimitive(h,d){if(h._primitiveBabylonMeshes)for(const T of h._primitiveBabylonMeshes)d(T)}_getGeometries(){const h=[],d=this._gltf.nodes;if(d)for(const T of d)this._forEachPrimitive(T,(d=>{const T=d.Rd;T&&-1===h.indexOf(T)&&h.push(T)}));return h}_getMeshes(){const h=[];this._rootBabylonMesh instanceof E.b&&h.push(this._rootBabylonMesh);const d=this._gltf.nodes;if(d)for(const T of d)this._forEachPrimitive(T,(d=>{h.push(d)}));return h}_getTransformNodes(){const h=[],d=this._gltf.nodes;if(d)for(const T of d)T._babylonTransformNode&&"dc"===T._babylonTransformNode.getClassName()&&h.push(T._babylonTransformNode),T._babylonTransformNodeForSkin&&h.push(T._babylonTransformNodeForSkin);return h}_getSkeletons(){const h=[],d=this._gltf.skins;if(d)for(const T of d)T._data&&h.push(T._data.babylonSkeleton);return h}_getAnimationGroups(){const h=[],d=this._gltf.animations;if(d)for(const T of d)T._babylonAnimationGroup&&h.push(T._babylonAnimationGroup);return h}_startAnimations(){switch(this._parent.animationStartMode){case k.e.NONE:break;case k.e.FIRST:{const h=this._getAnimationGroups();0!==h.length&&h[0].start(!0);break}case k.e.ALL:{const h=this._getAnimationGroups();for(const d of h)d.start(!0);break}default:return void f.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Y=this._extensionsLoadNodeAsync(h,d,T);if(Y)return Y;if(d._babylonTransformNode)throw new Error(`${h}: Invalid recursive node hierarchy`);const y=new Array;this.logOpen(`${h} ${d.name||""}`);const C=Y=>{if(b.AddPointerMetadata(Y,h),b._LoadTransform(d,Y),void 0!=d.camera){const T=v.Get(`${h}/camera`,this._gltf.cameras,d.camera);y.push(this.loadCameraAsync(`/cameras/${T.index}`,T,(h=>{h.parent=Y,this._babylonScene.useRightHandedSystem||(Y.py.x=-1)})))}if(d.children)for(const T of d.children){const d=v.Get(`${h}/children/${T}`,this._gltf.nodes,T);y.push(this.loadNodeAsync(`/nodes/${d.index}`,d,(h=>{h.parent=Y})))}T(Y)},n=void 0!=d.mesh,X=this._parent.loadSkins&&void 0!=d.skin;if(!n||X){const h=d.name||`node${d.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new i.e(h,this._babylonScene);T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==d.mesh?d._babylonTransformNode=T:d._babylonTransformNodeForSkin=T,C(T)}if(n)if(X){const T=v.Get(`${h}/mesh`,this._gltf.meshes,d.mesh);y.push(this._loadMeshAsync(`/meshes/${T.index}`,d,T,(T=>{const Y=d._babylonTransformNodeForSkin;T.metadata=(0,a.b)(Y.metadata,T.metadata||{});const C=v.Get(`${h}/skin`,this._gltf.skins,d.skin);y.push(this._loadSkinAsync(`/skins/${C.index}`,d,C,(h=>{this._forEachPrimitive(d,(d=>{d.skeleton=h})),this._postSceneLoadActions.push((()=>{if(void 0!=C.skeleton){const h=v.Get(`/skins/${C.index}/skeleton`,this._gltf.nodes,C.skeleton).parent;d.index===h.index?T.parent=Y.parent:T.parent=h._babylonTransformNode}else T.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:Y,skinnedNode:T})}))})))})))}else{const T=v.Get(`${h}/mesh`,this._gltf.meshes,d.mesh);y.push(this._loadMeshAsync(`/meshes/${T.index}`,d,T,C))}return this.logClose(),Promise.all(y).then((()=>(this._forEachPrimitive(d,(h=>{const d=h;!d.isAnInstance&&d.Rd&&d.Rd.useBoundingInfoFromGeometry?h.Nh():h.refreshBoundingInfo(!0,!0)})),d._babylonTransformNode)))}_loadMeshAsync(h,d,T,Y){const y=T.primitives;if(!y||!y.length)throw new Error(`${h}: Primitives are missing`);void 0==y[0].index&&v.Assign(y);const C=new Array;this.logOpen(`${h} ${T.name||""}`);const n=d.name||`node${d.index}`;if(1===y.length){const Y=T.primitives[0];C.push(this._loadMeshPrimitiveAsync(`${h}/primitives/${Y.index}`,n,d,T,Y,(h=>{d._babylonTransformNode=h,d._primitiveBabylonMeshes=[h]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,d._babylonTransformNode=new i.e(n,this._babylonScene),d._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._primitiveBabylonMeshes=[];for(const Y of y)C.push(this._loadMeshPrimitiveAsync(`${h}/primitives/${Y.index}`,`${n}_primitive${Y.index}`,d,T,Y,(h=>{h.parent=d._babylonTransformNode,d._primitiveBabylonMeshes.push(h)})))}return Y(d._babylonTransformNode),this.logClose(),Promise.all(C).then((()=>d._babylonTransformNode))}_loadMeshPrimitiveAsync(h,d,T,Y,y,C){const n=this._extensionsLoadMeshPrimitiveAsync(h,d,T,Y,y,C);if(n)return n;this.logOpen(`${h}`);const X=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==T.skin&&!Y.primitives[0].targets;let F,U;if(X&&y._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,F=y._instanceData.babylonSourceMesh.createInstance(d),F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U=y._instanceData.promise;else{const C=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new z.d(d,this._babylonScene);n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.sideOrientation=this._babylonScene.useRightHandedSystem?L.d.CounterClockWiseSideOrientation:L.d.ClockWiseSideOrientation,this._createMorphTargets(h,T,Y,y,n),C.push(this._loadVertexDataAsync(h,y,n).then((async d=>await this._loadMorphTargetsAsync(h,y,n,d).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,d.oh(n),d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const Z=b._GetDrawMode(h,y.mode);if(void 0==y.material){let h=this._defaultBabylonMaterialData[Z];h||(h=this._createDefaultMaterial("__GLTFLoader._default",Z),this._parent.onMaterialLoadedObservable.notifyObservers(h),this._defaultBabylonMaterialData[Z]=h),n.material=h}else if(!this.parent.skipMaterials){const d=v.Get(`${h}/material`,this._gltf.materials,y.material);C.push(this._loadMaterialAsync(`/materials/${d.index}`,d,n,Z,(h=>{n.material=h})))}U=Promise.all(C),X&&(y._instanceData={babylonSourceMesh:n,promise:U}),F=n}return b.AddPointerMetadata(F,h),this._parent.onMeshLoadedObservable.notifyObservers(F),C(F),this.logClose(),U.then((()=>F))}_loadVertexDataAsync(h,d,T){const Y=this._extensionsLoadVertexDataAsync(h,d,T);if(Y)return Y;const y=d.attributes;if(!y)throw new Error(`${h}: Attributes are missing`);const C=new Array,n=new s.e(T.name,this._babylonScene);if(void 0==d.indices)T.isUnIndexed=!0;else{const T=v.Get(`${h}/indices`,this._gltf.accessors,d.indices);C.push(this._loadIndicesAccessorAsync(`/accessors/${T.index}`,T).then((h=>{n.setIndices(h)})))}const X=(d,Y,X)=>{if(void 0==y[d])return;T._delayInfo=T._delayInfo||[],-1===T._delayInfo.indexOf(Y)&&T._delayInfo.push(Y);const F=v.Get(`${h}/attributes/${d}`,this._gltf.accessors,y[d]);C.push(this._loadVertexAccessorAsync(`/accessors/${F.index}`,F,Y).then((h=>{if(h.getKind()===w.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!T.skeleton){const h=G(F);h&&(n._boundingInfo=h,n.useBoundingInfoFromGeometry=!0)}n.setVerticesBuffer(h,F.count)}))),Y==w.g.MatricesIndicesExtraKind&&(T.numBoneInfluencers=8),X&&X(F)};return X("POSITION",w.g.PositionKind),X("NORMAL",w.g.NormalKind),X("TANGENT",w.g.TangentKind),X("TEXCOORD_0",w.g.UVKind),X("TEXCOORD_1",w.g.UV2Kind),X("TEXCOORD_2",w.g.UV3Kind),X("TEXCOORD_3",w.g.UV4Kind),X("TEXCOORD_4",w.g.UV5Kind),X("TEXCOORD_5",w.g.UV6Kind),X("JOINTS_0",w.g.MatricesIndicesKind),X("WEIGHTS_0",w.g.MatricesWeightsKind),X("JOINTS_1",w.g.MatricesIndicesExtraKind),X("WEIGHTS_1",w.g.MatricesWeightsExtraKind),X("COLOR_0",w.g.ColorKind,(h=>{"VEC4"===h.type&&(T.hasVertexAlpha=!0)})),Promise.all(C).then((()=>n))}_createMorphTargets(h,d,T,Y,y){if(!Y.targets||!this._parent.loadMorphTargets)return;if(void 0==d._numMorphTargets)d._numMorphTargets=Y.targets.length;else if(Y.targets.length!==d._numMorphTargets)throw new Error(`${h}: Primitives do not have the same number of targets`);const C=T.extras?T.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,y.morphTargetManager=new p(this._babylonScene),y.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y.morphTargetManager.areUpdatesFrozen=!0;for(let n=0;n<Y.targets.length;n++){const h=d.weights?d.weights[n]:T.weights?T.weights[n]:0,Y=C?C[n]:`morphTarget${n}`;y.morphTargetManager.addTarget(new x.d(Y,h,y.Eh()))}}_loadMorphTargetsAsync(h,d,T,Y){if(!d.targets||!this._parent.loadMorphTargets)return Promise.resolve();const y=new Array,C=T.morphTargetManager;for(let n=0;n<C.numTargets;n++){const T=C.getTarget(n);y.push(this._loadMorphTargetVertexDataAsync(`${h}/targets/${n}`,Y,d.targets[n],T))}return Promise.all(y).then((()=>{C.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(h,d,T,Y){const y=new Array,C=(Y,C,n)=>{if(void 0==T[Y])return;const X=d.getVertexBuffer(C);if(!X)return;const F=v.Get(`${h}/${Y}`,this._gltf.accessors,T[Y]);y.push(this._loadFloatAccessorAsync(`/accessors/${F.index}`,F).then((h=>{n(X,h)})))};return C("POSITION",w.g.PositionKind,((h,d)=>{const T=new Float32Array(d.length);h.forEach(d.length,((h,Y)=>{T[Y]=d[Y]+h})),Y.setPositions(T)})),C("NORMAL",w.g.NormalKind,((h,d)=>{const T=new Float32Array(d.length);h.forEach(T.length,((h,Y)=>{T[Y]=d[Y]+h})),Y.setNormals(T)})),C("TANGENT",w.g.TangentKind,((h,d)=>{const T=new Float32Array(d.length/3*4);let y=0;h.forEach(d.length/3*4,((h,Y)=>{(Y+1)%4!==0&&(T[y]=d[y]+h,y++)})),Y.setTangents(T)})),C("TEXCOORD_0",w.g.UVKind,((h,d)=>{const T=new Float32Array(d.length);h.forEach(d.length,((h,Y)=>{T[Y]=d[Y]+h})),Y.setUVs(T)})),C("TEXCOORD_1",w.g.UV2Kind,((h,d)=>{const T=new Float32Array(d.length);h.forEach(d.length,((h,Y)=>{T[Y]=d[Y]+h})),Y.setUV2s(T)})),C("COLOR_0",w.g.ColorKind,((d,T)=>{let y=null;const C=d.getSize();if(3===C){y=new Float32Array(T.length/3*4),d.forEach(T.length,((h,d)=>{const Y=Math.floor(d/3),C=d%3;y[4*Y+C]=T[3*Y+C]+h}));for(let h=0;h<T.length/3;++h)y[4*h+3]=1}else{if(4!==C)throw new Error(`${h}: Invalid number of components (${C}) for COLOR_0 attribute`);y=new Float32Array(T.length),d.forEach(T.length,((h,d)=>{y[d]=T[d]+h}))}Y.setColors(y)})),await Promise.all(y).then((()=>{}))}static _LoadTransform(h,d){if(void 0!=h.skin)return;let T=y.pd.Zero(),Y=y.Quaternion.Identity(),C=y.pd.One();if(h.matrix){y.Matrix.Bd(h.matrix).decompose(C,Y,T)}else h.translation&&(T=y.pd.Bd(h.translation)),h.rotation&&(Y=y.Quaternion.Bd(h.rotation)),h.scale&&(C=y.pd.Bd(h.scale));d.position=T,d.rotationQuaternion=Y,d.py=C}_loadSkinAsync(h,d,T,Y){if(!this._parent.loadSkins)return Promise.resolve();const y=this._extensionsLoadSkinAsync(h,d,T);if(y)return y;if(T._data)return Y(T._data.babylonSkeleton),T._data.promise;const C=`skeleton${T.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new W(T.name||C,C,this._babylonScene);n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(h,T,n);const X=this._loadSkinInverseBindMatricesDataAsync(h,T).then((h=>{this._updateBoneMatrices(n,h)}));return T._data={babylonSkeleton:n,promise:X},Y(n),X}_loadBones(h,d,T){if(void 0==d.skeleton||this._parent.alwaysComputeSkeletonRootNode){const T=this._findSkeletonRootNode(`${h}/joints`,d.joints);if(T)if(void 0===d.skeleton)d.skeleton=T.index;else{const Y=(h,d)=>{for(;d.parent;d=d.parent)if(d.parent===h)return!0;return!1},y=v.Get(`${h}/skeleton`,this._gltf.nodes,d.skeleton);y===T||Y(y,T)||(f.c.Warn(`${h}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),d.skeleton=T.index)}else f.c.Warn(`${h}: Failed to find common root`)}const Y={};for(const y of d.joints){const C=v.Get(`${h}/joints/${y}`,this._gltf.nodes,y);this._loadBone(C,d,T,Y)}}_findSkeletonRootNode(h,d){if(0===d.length)return null;const T={};for(const y of d){const d=[];let Y=v.Get(`${h}/${y}`,this._gltf.nodes,y);for(;-1!==Y.index;)d.unshift(Y),Y=Y.parent;T[y]=d}let Y=null;for(let y=0;;++y){let h=T[d[0]];if(y>=h.length)return Y;const C=h[y];for(let n=1;n<d.length;++n)if(h=T[d[n]],y>=h.length||C!==h[y])return Y;Y=C}}_loadBone(h,d,T,Y){h._isJoint=!0;let y=Y[h.index];if(y)return y;let C=null;h.index!==d.skeleton&&(h.parent&&-1!==h.parent.index?C=this._loadBone(h.parent,d,T,Y):void 0!==d.skeleton&&f.c.Warn(`/skins/${d.index}/skeleton: Skeleton node is not a common root`));const n=d.joints.indexOf(h.index);return y=new U.e(h.name||`joint${h.index}`,T,C,this._getNodeMatrix(h),null,null,n),Y[h.index]=y,this._postSceneLoadActions.push((()=>{y.linkTransformNode(h._babylonTransformNode)})),y}_loadSkinInverseBindMatricesDataAsync(h,d){if(void 0==d.inverseBindMatrices)return Promise.resolve(null);const T=v.Get(`${h}/inverseBindMatrices`,this._gltf.accessors,d.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${T.index}`,T)}_updateBoneMatrices(h,d){for(const T of h.bones){const h=y.Matrix.Identity(),Y=T._index;d&&-1!==Y&&(y.Matrix.FromArrayToRef(d,16*Y,h),h.invertToRef(h));const C=T.getParent();C&&h.multiplyToRef(C.getAbsoluteInverseBindMatrix(),h),T.bd(h,!1,!1),T._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(h){return h.matrix?y.Matrix.Bd(h.matrix):y.Matrix.Compose(h.scale?y.pd.Bd(h.scale):y.pd.One(),h.rotation?y.Quaternion.Bd(h.rotation):y.Quaternion.Identity(),h.translation?y.pd.Bd(h.translation):y.pd.Zero())}loadCameraAsync(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Y=this._extensionsLoadCameraAsync(h,d,T);if(Y)return Y;const C=new Array;this.logOpen(`${h} ${d.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new F.e(d.name||`camera${d.index}`,y.pd.Zero(),this._babylonScene,!1);switch(n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._babylonCamera=n,n.setTarget(new y.pd(0,0,-1)),d.type){case"perspective":{const T=d.perspective;if(!T)throw new Error(`${h}: Camera perspective properties are missing`);n.fov=T.yfov,n.Gd=T.znear,n.maxZ=T.zfar||0;break}case"orthographic":if(!d.orthographic)throw new Error(`${h}: Camera orthographic properties are missing`);n.mode=X.e.ORTHOGRAPHIC_CAMERA,n.orthoLeft=-d.orthographic.xmag,n.orthoRight=d.orthographic.xmag,n.orthoBottom=-d.orthographic.ymag,n.orthoTop=d.orthographic.ymag,n.Gd=d.orthographic.znear,n.maxZ=d.orthographic.zfar;break;default:throw new Error(`${h}: Invalid camera type (${d.type})`)}return b.AddPointerMetadata(n,h),this._parent.onCameraLoadedObservable.notifyObservers(n),T(n),this.logClose(),Promise.all(C).then((()=>n))}_loadAnimationsAsync(){const h=this._gltf.animations;if(!h)return Promise.resolve();const d=new Array;for(let T=0;T<h.length;T++){const Y=h[T];d.push(this.loadAnimationAsync(`/animations/${Y.index}`,Y).then((h=>{0===h.targetedAnimations.length&&h.dispose()})))}return Promise.all(d).then((()=>{}))}loadAnimationAsync(h,d){const Y=this._extensionsLoadAnimationAsync(h,d);return Y||T.e(78).then(T.bind(T,16001)).then((T=>{let{AnimationGroup:Y}=T;this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new Y(d.name||`animation${d.index}`,this._babylonScene);y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._babylonAnimationGroup=y;const C=new Array;v.Assign(d.channels),v.Assign(d.samplers);for(const n of d.channels)C.push(this._loadAnimationChannelAsync(`${h}/channels/${n.index}`,h,d,n,((h,d)=>{h.animations=h.animations||[],h.animations.push(d),y.addTargetedAnimation(d,h)})));return Promise.all(C).then((()=>(y.normalize(0),y)))}))}async _loadAnimationChannelAsync(h,d,Y,y,C){const n=this._extensionsLoadAnimationChannelAsync(h,d,Y,y,C);if(n)return await n;if(void 0==y.target.node)return await Promise.resolve();const X=v.Get(`${h}/target/node`,this._gltf.nodes,y.target.node),F=y.target.path,U="weights"===F;if(U&&!X._numMorphTargets||!U&&!X._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!U&&!X._isJoint)return await Promise.resolve();let Z;switch(await Promise.resolve().then(T.bind(T,14483)),F){case"translation":var S;Z=null===(S=(0,j.h)("/nodes/{}/translation"))||void 0===S?void 0:S.interpolation;break;case"rotation":var r;Z=null===(r=(0,j.h)("/nodes/{}/rotation"))||void 0===r?void 0:r.interpolation;break;case"scale":var c;Z=null===(c=(0,j.h)("/nodes/{}/scale"))||void 0===c?void 0:c.interpolation;break;case"weights":var O;Z=null===(O=(0,j.h)("/nodes/{}/weights"))||void 0===O?void 0:O.interpolation;break;default:throw new Error(`${h}/target/path: Invalid value (${y.target.path})`)}if(!Z)throw new Error(`${h}/target/path: Could not find interpolation properties for target path (${y.target.path})`);const f={object:X,info:Z};return await this._loadAnimationChannelFromTargetInfoAsync(h,d,Y,y,f,C)}_loadAnimationChannelFromTargetInfoAsync(h,d,T,Y,y,C){const n=this.parent.targetFps,X=1/n,F=v.Get(`${h}/sampler`,T.samplers,Y.sampler);return this._loadAnimationSamplerAsync(`${d}/samplers/${Y.sampler}`,F).then((h=>{let d=0;const F=y.object,U=y.info;for(const y of U){const U=y.getStride(F),Z=h.input,S=h.output,r=new Array(Z.length);let c=0;switch(h.interpolation){case"STEP":for(let h=0;h<Z.length;h++){const d=y.getValue(F,S,c,1);c+=U,r[h]={frame:Z[h]*n,value:d,interpolation:1}}break;case"CUBICSPLINE":for(let h=0;h<Z.length;h++){const d=y.getValue(F,S,c,X);c+=U;const T=y.getValue(F,S,c,1);c+=U;const Y=y.getValue(F,S,c,X);c+=U,r[h]={frame:Z[h]*n,inTangent:d,value:T,outTangent:Y}}break;case"LINEAR":for(let h=0;h<Z.length;h++){const d=y.getValue(F,S,c,1);c+=U,r[h]={frame:Z[h]*n,value:d}}}if(c>0){const h=`${T.name||`animation${T.index}`}_channel${Y.index}_${d}`,X=y.buildAnimations(F,h,n,r);for(const T of X)d++,C(T.babylonAnimatable,T.babylonAnimation)}}}))}_loadAnimationSamplerAsync(h,d){if(d._data)return d._data;const T=d.interpolation||"LINEAR";switch(T){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${h}/interpolation: Invalid value (${d.interpolation})`)}const Y=v.Get(`${h}/input`,this._gltf.accessors,d.input),y=v.Get(`${h}/output`,this._gltf.accessors,d.output);return d._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${Y.index}`,Y),this._loadFloatAccessorAsync(`/accessors/${y.index}`,y)]).then((h=>{let[d,Y]=h;return{input:d,interpolation:T,output:Y}})),d._data}loadBufferAsync(h,d,T,Y){const y=this._extensionsLoadBufferAsync(h,d,T,Y);if(y)return y;if(!d._data)if(d.uri)d._data=this.loadUriAsync(`${h}/uri`,d,d.uri);else{if(!this._bin)throw new Error(`${h}: Uri is missing or the binary glTF is missing its binary chunk`);d._data=this._bin.readAsync(0,d.byteLength)}return d._data.then((d=>{try{return new Uint8Array(d.buffer,d.byteOffset+T,Y)}catch(y){throw new Error(`${h}: ${y.message}`)}}))}loadBufferViewAsync(h,d){const T=this._extensionsLoadBufferViewAsync(h,d);if(T)return T;if(d._data)return d._data;const Y=v.Get(`${h}/buffer`,this._gltf.buffers,d.buffer);return d._data=this.loadBufferAsync(`/buffers/${Y.index}`,Y,d.byteOffset||0,d.byteLength),d._data}_loadAccessorAsync(h,d,T){if(d._data)return d._data;const Y=b._GetNumComponents(h,d.type),y=Y*w.g.GetTypeByteLength(d.componentType),C=Y*d.count;if(void 0==d.bufferView)d._data=Promise.resolve(new T(C));else{const n=v.Get(`${h}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then((X=>{if(5126!==d.componentType||d.normalized||n.byteStride&&n.byteStride!==y){const h=new T(C);return w.g.ForEach(X,d.byteOffset||0,n.byteStride||y,Y,d.componentType,h.length,d.normalized||!1,((d,T)=>{h[T]=d})),h}return b._GetTypedArray(h,d.componentType,X,d.byteOffset,C)}))}if(d.sparse){const C=d.sparse;d._data=d._data.then((n=>{const X=n,F=v.Get(`${h}/sparse/indices/bufferView`,this._gltf.bufferViews,C.indices.bufferView),U=v.Get(`${h}/sparse/values/bufferView`,this._gltf.bufferViews,C.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${F.index}`,F),this.loadBufferViewAsync(`/bufferViews/${U.index}`,U)]).then((n=>{let[F,U]=n;const Z=b._GetTypedArray(`${h}/sparse/indices`,C.indices.componentType,F,C.indices.byteOffset,C.count),S=Y*C.count;let r;if(5126!==d.componentType||d.normalized){const n=b._GetTypedArray(`${h}/sparse/values`,d.componentType,U,C.values.byteOffset,S);r=new T(S),w.g.ForEach(n,0,y,Y,d.componentType,r.length,d.normalized||!1,((h,d)=>{r[d]=h}))}else r=b._GetTypedArray(`${h}/sparse/values`,d.componentType,U,C.values.byteOffset,S);let c=0;for(let h=0;h<Z.length;h++){let d=Z[h]*Y;for(let h=0;h<Y;h++)X[d++]=r[c++]}return X}))}))}return d._data}_loadFloatAccessorAsync(h,d){return this._loadAccessorAsync(h,d,Float32Array)}_loadIndicesAccessorAsync(h,d){if("SCALAR"!==d.type)throw new Error(`${h}/type: Invalid value ${d.type}`);if(5121!==d.componentType&&5123!==d.componentType&&5125!==d.componentType)throw new Error(`${h}/componentType: Invalid value ${d.componentType}`);if(d._data)return d._data;if(d.sparse){const T=b._GetTypedArrayConstructor(`${h}/componentType`,d.componentType);d._data=this._loadAccessorAsync(h,d,T)}else{const T=v.Get(`${h}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${T.index}`,T).then((T=>b._GetTypedArray(h,d.componentType,T,d.byteOffset,d.count)))}return d._data}_loadVertexBufferViewAsync(h){if(h._babylonBuffer)return h._babylonBuffer;const d=this._babylonScene.getEngine();return h._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h).then((h=>new w.e(d,h,!1))),h._babylonBuffer}_loadVertexAccessorAsync(h,d,T){var Y;if(null!==(Y=d._babylonVertexBuffer)&&void 0!==Y&&Y[T])return d._babylonVertexBuffer[T];d._babylonVertexBuffer||(d._babylonVertexBuffer={});const y=this._babylonScene.getEngine();if(d.sparse||void 0==d.bufferView)d._babylonVertexBuffer[T]=this._loadFloatAccessorAsync(h,d).then((h=>new w.g(y,h,T,!1)));else{const Y=v.Get(`${h}/bufferView`,this._gltf.bufferViews,d.bufferView);d._babylonVertexBuffer[T]=this._loadVertexBufferViewAsync(Y).then((C=>{const n=b._GetNumComponents(h,d.type);return new w.g(y,C,T,!1,void 0,Y.byteStride,void 0,d.byteOffset,n,d.componentType,d.normalized,!0,void 0,!0)}))}return d._babylonVertexBuffer[T]}_loadMaterialMetallicRoughnessPropertiesAsync(h,d,T){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);const Y=new Array;return d&&(d.baseColorFactor?(T.albedoColor=C.ed.Bd(d.baseColorFactor),T.alpha=d.baseColorFactor[3]):T.albedoColor=C.ed.White(),T.metallic=void 0==d.metallicFactor?1:d.metallicFactor,T.roughness=void 0==d.roughnessFactor?1:d.roughnessFactor,d.baseColorTexture&&Y.push(this.loadTextureInfoAsync(`${h}/baseColorTexture`,d.baseColorTexture,(h=>{h.name=`${T.name} (Base Color)`,T.albedoTexture=h}))),d.metallicRoughnessTexture&&(d.metallicRoughnessTexture.nonColorData=!0,Y.push(this.loadTextureInfoAsync(`${h}/metallicRoughnessTexture`,d.metallicRoughnessTexture,(h=>{h.name=`${T.name} (Metallic Roughness)`,T.metallicTexture=h}))),T.useMetallnessFromMetallicTextureBlue=!0,T.useRoughnessFromMetallicTextureGreen=!0,T.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(Y).then((()=>{}))}_loadMaterialAsync(h,d,T,Y){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const C=this._extensionsLoadMaterialAsync(h,d,T,Y,y);if(C)return C;d._data=d._data||{};let n=d._data[Y];if(!n){this.logOpen(`${h} ${d.name||""}`);const T=this.createMaterial(h,d,Y);n={babylonMaterial:T,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(h,d,T)},d._data[Y]=n,b.AddPointerMetadata(T,h),this._parent.onMaterialLoadedObservable.notifyObservers(T),this.logClose()}return T&&(n.babylonMeshes.push(T),T.zd.addOnce((()=>{const h=n.babylonMeshes.indexOf(T);-1!==h&&n.babylonMeshes.splice(h,1)}))),y(n.babylonMaterial),n.promise.then((()=>n.babylonMaterial))}_createDefaultMaterial(h,d){this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new D.d(h,this._babylonScene);return T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T.fillMode=d,T.enableSpecularAntiAliasing=!0,T.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,T.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,T.transparencyMode=D.d.PBRMATERIAL_OPAQUE,T.metallic=1,T.roughness=1,T}createMaterial(h,d,T){const Y=this._extensionsCreateMaterial(h,d,T);if(Y)return Y;const y=d.name||`material${d.index}`;return this._createDefaultMaterial(y,T)}loadMaterialPropertiesAsync(h,d,T){const Y=this._extensionsLoadMaterialPropertiesAsync(h,d,T);if(Y)return Y;const y=new Array;return y.push(this.loadMaterialBasePropertiesAsync(h,d,T)),d.pbrMetallicRoughness&&y.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${h}/pbrMetallicRoughness`,d.pbrMetallicRoughness,T)),this.loadMaterialAlphaProperties(h,d,T),Promise.all(y).then((()=>{}))}loadMaterialBasePropertiesAsync(h,d,T){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);const Y=new Array;return T.emissiveColor=d.emissiveFactor?C.ed.Bd(d.emissiveFactor):new C.ed(0,0,0),d.doubleSided&&(T.td=!1,T.twoSidedLighting=!0),d.normalTexture&&(d.normalTexture.nonColorData=!0,Y.push(this.loadTextureInfoAsync(`${h}/normalTexture`,d.normalTexture,(h=>{h.name=`${T.name} (Normal)`,T.bumpTexture=h}))),T.invertNormalMapX=!this._babylonScene.useRightHandedSystem,T.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=d.normalTexture.scale&&T.bumpTexture&&(T.bumpTexture.level=d.normalTexture.scale),T.forceIrradianceInFragment=!0),d.occlusionTexture&&(d.occlusionTexture.nonColorData=!0,Y.push(this.loadTextureInfoAsync(`${h}/occlusionTexture`,d.occlusionTexture,(h=>{h.name=`${T.name} (Occlusion)`,T.ambientTexture=h}))),T.useAmbientInGrayScale=!0,void 0!=d.occlusionTexture.strength&&(T.ambientTextureStrength=d.occlusionTexture.strength)),d.emissiveTexture&&Y.push(this.loadTextureInfoAsync(`${h}/emissiveTexture`,d.emissiveTexture,(h=>{h.name=`${T.name} (Emissive)`,T.emissiveTexture=h}))),Promise.all(Y).then((()=>{}))}loadMaterialAlphaProperties(h,d,T){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);switch(d.alphaMode||"OPAQUE"){case"OPAQUE":T.transparencyMode=D.d.PBRMATERIAL_OPAQUE,T.alpha=1;break;case"MASK":T.transparencyMode=D.d.PBRMATERIAL_ALPHATEST,T.alphaCutOff=void 0==d.alphaCutoff?.5:d.alphaCutoff,T.albedoTexture&&(T.albedoTexture.vd=!0);break;case"BLEND":T.transparencyMode=D.d.PBRMATERIAL_ALPHABLEND,T.albedoTexture&&(T.albedoTexture.vd=!0,T.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${h}/alphaMode: Invalid value (${d.alphaMode})`)}}loadTextureInfoAsync(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Y=this._extensionsLoadTextureInfoAsync(h,d,T);if(Y)return Y;if(this.logOpen(`${h}`),d.texCoord>=6)throw new Error(`${h}/texCoord: Invalid value (${d.texCoord})`);const y=v.Get(`${h}/index`,this._gltf.textures,d.index);y._textureInfo=d;const C=this._loadTextureAsync(`/textures/${d.index}`,y,(Y=>{Y.coordinatesIndex=d.texCoord||0,b.AddPointerMetadata(Y,h),this._parent.onTextureLoadedObservable.notifyObservers(Y),T(Y)}));return this.logClose(),C}_loadTextureAsync(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Y=this._extensionsLoadTextureAsync(h,d,T);if(Y)return Y;this.logOpen(`${h} ${d.name||""}`);const y=void 0==d.sampler?b.DefaultSampler:v.Get(`${h}/sampler`,this._gltf.samplers,d.sampler),C=v.Get(`${h}/source`,this._gltf.images,d.source),n=this._createTextureAsync(h,y,C,T,void 0,!d._textureInfo.nonColorData);return this.logClose(),n}_createTextureAsync(h,d,T){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},C=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0;const X=this._loadSampler(`/samplers/${d.index}`,d),F=new Array,U=new Y;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z={noMipmap:X.noMipMaps,invertY:!1,samplingMode:X.samplingMode,A:()=>{this._disposed||U.resolve()},onError:(d,T)=>{this._disposed||U.reject(new Error(`${h}: ${T&&T.message?T.message:d||"Failed to load texture"}`))},mimeType:T.mimeType??(0,o.i)(T.uri??""),loaderOptions:C,useSRGBBuffer:!!n&&this._parent.useSRGBBuffers},S=new V.c(null,this._babylonScene,Z);return S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.push(U.promise),F.push(this.loadImageAsync(`/images/${T.index}`,T).then((h=>{const d=T.uri||`${this._fileName}#image${T.index}`,Y=`data:${this._uniqueRootUrl}${d}`;S.updateURL(Y,h);const y=S.getInternalTexture();y&&(y.label=T.name)}))),S.wrapU=X.wrapU,S.wrapV=X.wrapV,y(S),this._parent.useGltfTextureNames&&(S.name=T.name||T.uri||`image${T.index}`),Promise.all(F).then((()=>S))}_loadSampler(h,d){return d._data||(d._data={noMipMaps:9728===d.minFilter||9729===d.minFilter,samplingMode:b._GetTextureSamplingMode(h,d),wrapU:b._GetTextureWrapMode(`${h}/wrapS`,d.wrapS),wrapV:b._GetTextureWrapMode(`${h}/wrapT`,d.wrapT)}),d._data}loadImageAsync(h,d){if(!d._data){if(this.logOpen(`${h} ${d.name||""}`),d.uri)d._data=this.loadUriAsync(`${h}/uri`,d,d.uri);else{const T=v.Get(`${h}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${T.index}`,T)}this.logClose()}return d._data}loadUriAsync(h,d,T){const Y=this._extensionsLoadUriAsync(h,d,T);if(Y)return Y;if(!b._ValidateUri(T))throw new Error(`${h}: '${T}' is invalid`);if((0,o.l)(T)){const d=new Uint8Array((0,o.d)(T));return this.log(`${h}: Decoded ${T.substring(0,64)}... (${d.length} bytes)`),Promise.resolve(d)}return this.log(`${h}: Loading ${T}`),this._parent.preprocessUrlAsync(this._rootUrl+T).then((d=>new Promise(((Y,y)=>{this._parent._loadFile(this._babylonScene,d,(d=>{this._disposed||(this.log(`${h}: Loaded ${T} (${d.byteLength} bytes)`),Y(new Uint8Array(d)))}),!0,(d=>{y(new o.o(`${h}: Failed to load '${T}'${d?": "+d.status+" "+d.statusText:""}`,d))}))}))))}static AddPointerMetadata(h,d){h.metadata=h.metadata||{};const T=h._internalMetadata=h._internalMetadata||{},Y=T.ud=T.ud||{};(Y.pointers=Y.pointers||[]).push(d)}static _GetTextureWrapMode(h,d){switch(d=void 0==d?10497:d){case 33071:return V.c.CLAMP_ADDRESSMODE;case 33648:return V.c.MIRROR_ADDRESSMODE;case 10497:return V.c.WRAP_ADDRESSMODE;default:return f.c.Warn(`${h}: Invalid value (${d})`),V.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(h,d){const T=void 0==d.magFilter?9729:d.magFilter,Y=void 0==d.minFilter?9987:d.minFilter;if(9729===T)switch(Y){case 9728:return V.c.LINEAR_NEAREST;case 9729:return V.c.LINEAR_LINEAR;case 9984:return V.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return V.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return V.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return V.c.LINEAR_LINEAR_MIPLINEAR;default:return f.c.Warn(`${h}/minFilter: Invalid value (${Y})`),V.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==T&&f.c.Warn(`${h}/magFilter: Invalid value (${T})`),Y){case 9728:return V.c.NEAREST_NEAREST;case 9729:return V.c.NEAREST_LINEAR;case 9984:return V.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return V.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return V.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return V.c.NEAREST_LINEAR_MIPLINEAR;default:return f.c.Warn(`${h}/minFilter: Invalid value (${Y})`),V.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(h,d){try{return(0,e.s)(d)}catch(T){throw new Error(`${h}: ${T.message}`)}}static _GetTypedArray(h,d,T,Y,y){const C=T.buffer;Y=T.byteOffset+(Y||0);const n=b._GetTypedArrayConstructor(`${h}/componentType`,d),X=w.g.GetTypeByteLength(d);return Y%X!==0?(f.c.Warn(`${h}: Copying buffer as byte offset (${Y}) is not a multiple of component type byte length (${X})`),new n(C.slice(Y,Y+y*X),0)):new n(C,Y,y)}static _GetNumComponents(h,d){switch(d){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${h}: Invalid type (${d})`)}static _ValidateUri(h){return n.Tools.IsBase64(h)||-1===h.indexOf("..")}static _GetDrawMode(h,d){switch(void 0==d&&(d=4),d){case 0:return L.d.PointListDrawMode;case 1:return L.d.LineListDrawMode;case 2:return L.d.LineLoopDrawMode;case 3:return L.d.LineStripDrawMode;case 4:return L.d.TriangleFillMode;case 5:return L.d.TriangleStripDrawMode;case 6:return L.d.TriangleFanDrawMode}throw new Error(`${h}: Invalid mesh primitive mode (${d})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const h=new Array;if(this._gltf.materials)for(const d of this._gltf.materials)if(d._data)for(const T in d._data){const Y=d._data[T];for(const d of Y.babylonMeshes){d.Md(!0);const T=Y.babylonMaterial;h.push(T.forceCompilationAsync(d)),h.push(T.forceCompilationAsync(d,{useInstances:!0})),this._parent.useClipPlane&&(h.push(T.forceCompilationAsync(d,{clipPlane:!0})),h.push(T.forceCompilationAsync(d,{clipPlane:!0,useInstances:!0})))}}return Promise.all(h).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const h=new Array,d=this._babylonScene.lights;for(const T of d){const d=T.getShadowGenerator();d&&h.push(d.forceCompilationAsync())}return Promise.all(h).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(h){for(const d of this._extensions)d.enabled&&h(d)}_applyExtensions(h,d,T){for(const Y of this._extensions)if(Y.enabled){const y=`${Y.name}.${d}`,C=h;C._activeLoaderExtensionFunctions=C._activeLoaderExtensionFunctions||{};const n=C._activeLoaderExtensionFunctions;if(!n[y]){n[y]=!0;try{const h=T(Y);if(h)return h}finally{delete n[y]}}}return null}_extensionsOnLoading(){this._forEachExtensions((h=>h.onLoading&&h.onLoading()))}_extensionsOnReady(){this._forEachExtensions((h=>h.onReady&&h.onReady()))}_extensionsLoadSceneAsync(h,d){return this._applyExtensions(d,"loadScene",(T=>T.loadSceneAsync&&T.loadSceneAsync(h,d)))}_extensionsLoadNodeAsync(h,d,T){return this._applyExtensions(d,"loadNode",(Y=>Y.loadNodeAsync&&Y.loadNodeAsync(h,d,T)))}_extensionsLoadCameraAsync(h,d,T){return this._applyExtensions(d,"loadCamera",(Y=>Y.loadCameraAsync&&Y.loadCameraAsync(h,d,T)))}_extensionsLoadVertexDataAsync(h,d,T){return this._applyExtensions(d,"loadVertexData",(Y=>Y._loadVertexDataAsync&&Y._loadVertexDataAsync(h,d,T)))}_extensionsLoadMeshPrimitiveAsync(h,d,T,Y,y,C){return this._applyExtensions(y,"loadMeshPrimitive",(n=>n._loadMeshPrimitiveAsync&&n._loadMeshPrimitiveAsync(h,d,T,Y,y,C)))}_extensionsLoadMaterialAsync(h,d,T,Y,y){return this._applyExtensions(d,"loadMaterial",(C=>C._loadMaterialAsync&&C._loadMaterialAsync(h,d,T,Y,y)))}_extensionsCreateMaterial(h,d,T){return this._applyExtensions(d,"createMaterial",(Y=>Y.createMaterial&&Y.createMaterial(h,d,T)))}_extensionsLoadMaterialPropertiesAsync(h,d,T){return this._applyExtensions(d,"loadMaterialProperties",(Y=>Y.loadMaterialPropertiesAsync&&Y.loadMaterialPropertiesAsync(h,d,T)))}_extensionsLoadTextureInfoAsync(h,d,T){return this._applyExtensions(d,"loadTextureInfo",(Y=>Y.loadTextureInfoAsync&&Y.loadTextureInfoAsync(h,d,T)))}_extensionsLoadTextureAsync(h,d,T){return this._applyExtensions(d,"loadTexture",(Y=>Y._loadTextureAsync&&Y._loadTextureAsync(h,d,T)))}_extensionsLoadAnimationAsync(h,d){return this._applyExtensions(d,"loadAnimation",(T=>T.loadAnimationAsync&&T.loadAnimationAsync(h,d)))}_extensionsLoadAnimationChannelAsync(h,d,T,Y,y){return this._applyExtensions(T,"loadAnimationChannel",(C=>C._loadAnimationChannelAsync&&C._loadAnimationChannelAsync(h,d,T,Y,y)))}_extensionsLoadSkinAsync(h,d,T){return this._applyExtensions(T,"loadSkin",(Y=>Y._loadSkinAsync&&Y._loadSkinAsync(h,d,T)))}_extensionsLoadUriAsync(h,d,T){return this._applyExtensions(d,"loadUri",(Y=>Y._loadUriAsync&&Y._loadUriAsync(h,d,T)))}_extensionsLoadBufferViewAsync(h,d){return this._applyExtensions(d,"loadBufferView",(T=>T.loadBufferViewAsync&&T.loadBufferViewAsync(h,d)))}_extensionsLoadBufferAsync(h,d,T,Y){return this._applyExtensions(d,"loadBuffer",(y=>y.loadBufferAsync&&y.loadBufferAsync(h,d,T,Y)))}static LoadExtensionAsync(h,d,T,Y){if(!d.extensions)return null;const y=d.extensions[T];return y?Y(`${h}/extensions/${T}`,y):null}static LoadExtraAsync(h,d,T,Y){if(!d.extras)return null;const y=d.extras[T];return y?Y(`${h}/extras/${T}`,y):null}isExtensionUsed(h){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(h)}logOpen(h){this._parent._logOpen(h)}logClose(){this._parent._logClose()}log(h){this._parent._log(h)}startPerformanceCounter(h){this._parent._startPerformanceCounter(h)}endPerformanceCounter(h){this._parent._endPerformanceCounter(h)}}b.DefaultSampler={index:-1},k.c._CreateGLTF2Loader=h=>new b(h);var B=T(14483),M=T(12939),mh=T(12801),R=T(14485),Q=T(14492);class I extends Q.c{constructor(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",h),this._texture=h.getEngine().createRawCubeTexture(d,T,Y,y,C,n,X,F)}update(h,d,T,Y){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,h,d,T,Y,y)}updateRGBDAsync(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,R.g)(this._texture,h,d,T,Y).then((()=>{}))}clone(){return mh.e.Clone((()=>{const h=this.Eh(),d=this._texture,T=new I(h,d._bufferViewArray,d.width,d.format,d.type,d.generateMipMaps,d.invertY,d.samplingMode,d._compression);return 13===d.source&&T.updateRGBDAsync(d._bufferViewArrayArray,d._sphericalPolynomial,d._lodGenerationScale,d._lodGenerationOffset),T}),this)}}const A="EXT_lights_image_based";class P{constructor(h){this.name=A,this._loader=h,this.enabled=this._loader.isExtensionUsed(A)}dispose(){this._loader=null,delete this._lights}onLoading(){const h=this._loader.ud.extensions;if(h&&h[this.name]){const d=h[this.name];this._lights=d.lights}}loadSceneAsync(h,d){return b.LoadExtensionAsync(h,d,this.name,(async(T,Y)=>{this._loader._allMaterialsDirtyRequired=!0;const y=new Array;y.push(this._loader.loadSceneAsync(h,d)),this._loader.logOpen(`${T}`);const C=v.Get(`${T}/light`,this._lights,Y.fd);return y.push(this._loadLightAsync(`/extensions/${this.name}/lights/${Y.fd}`,C).then((h=>{this._loader.babylonScene.environmentTexture=h}))),this._loader.logClose(),await Promise.all(y).then((()=>{}))}))}_loadLightAsync(h,d){if(!d._loaded){const T=new Array;this._loader.logOpen(`${h}`);const Y=new Array(d.specularImages.length);for(let y=0;y<d.specularImages.length;y++){const C=d.specularImages[y];Y[y]=new Array(C.length);for(let d=0;d<C.length;d++){const n=`${h}/specularImages/${y}/${d}`;this._loader.logOpen(`${n}`);const X=C[d],F=v.Get(n,this._loader.ud.images,X);T.push(this._loader.loadImageAsync(`/images/${X}`,F).then((h=>{Y[y][d]=h}))),this._loader.logClose()}}this._loader.logClose(),d._loaded=Promise.all(T).then((async()=>{const T=new I(this._loader.babylonScene,null,d.specularImageSize);if(T.name=d.name||"environment",d._babylonTexture=T,void 0!=d.aX&&(T.level=d.aX),d.rotation){let h=y.Quaternion.Bd(d.rotation);this._loader.babylonScene.useRightHandedSystem||(h=y.Quaternion.Inverse(h)),y.Matrix.FromQuaternionToRef(h,T.getReflectionTextureMatrix())}if(!d.irradianceCoefficients)throw new Error(`${h}: Irradiance coefficients are missing`);const C=M.d.Bd(d.irradianceCoefficients);C.scaleInPlace(d.aX),C.convertIrradianceToLambertianRadiance();const n=M.g.FromHarmonics(C),X=(Y.length-1)/Math.log2(d.specularImageSize);return await T.updateRGBDAsync(Y,n,X)}))}return d._loaded.then((()=>d._babylonTexture))}}q(A),l(A,!0,(h=>new P(h)));T(13344);const t="EXT_mesh_gpu_instancing";class hh{constructor(h){this.name=t,this._loader=h,this.enabled=this._loader.isExtensionUsed(t)}dispose(){this._loader=null}loadNodeAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(h,Y)=>{this._loader._disableInstancedMesh++;const C=this._loader.loadNodeAsync(`/nodes/${d.index}`,d,T);if(this._loader._disableInstancedMesh--,!d._primitiveBabylonMeshes)return await C;const n=new Array;let X=0;const F=d=>{if(void 0==Y.attributes[d])return void n.push(Promise.resolve(null));const T=v.Get(`${h}/attributes/${d}`,this._loader.ud.accessors,Y.attributes[d]);if(n.push(this._loader._loadFloatAccessorAsync(`/accessors/${T.bufferView}`,T)),0===X)X=T.count;else if(X!==T.count)throw new Error(`${h}/attributes: Instance buffer accessors do not have the same count.`)};return F("TRANSLATION"),F("ROTATION"),F("SCALE"),await C.then((async h=>{const[T,Y,C]=await Promise.all(n),F=new Float32Array(16*X);y.TmpVectors.pd[0].ny(0,0,0),y.TmpVectors.Quaternion[0].ny(0,0,0,1),y.TmpVectors.pd[1].ny(1,1,1);for(let d=0;d<X;++d)T&&y.pd.FromArrayToRef(T,3*d,y.TmpVectors.pd[0]),Y&&y.Quaternion.FromArrayToRef(Y,4*d,y.TmpVectors.Quaternion[0]),C&&y.pd.FromArrayToRef(C,3*d,y.TmpVectors.pd[1]),y.Matrix.ComposeToRef(y.TmpVectors.pd[1],y.TmpVectors.Quaternion[0],y.TmpVectors.pd[0],y.TmpVectors.Matrix[0]),y.TmpVectors.Matrix[0].copyToArray(F,16*d);for(const y of d._primitiveBabylonMeshes)y.HS("matrix",F,16,!0);return h}))}))}}q(t),l(t,!0,(h=>new hh(h)));let dh=0,Th=null;class Yh{static get Default(){return Yh._Default||(Yh._Default=new Yh),Yh._Default}constructor(){const h=Yh.Configuration.decoder;this._decoderModulePromise=n.Tools.LoadBabylonScriptAsync(h.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(h,d,T,Y,y){await this._decoderModulePromise,0===dh&&(MeshoptDecoder.useWorkers(1),dh=1);const C=await MeshoptDecoder.decodeGltfBufferAsync(d,T,h,Y,y);return null!==Th&&clearTimeout(Th),Th=setTimeout((()=>{MeshoptDecoder.useWorkers(0),dh=0,Th=null}),1e3),C}}Yh.Configuration={decoder:{url:`${n.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Yh._Default=null;const yh="EXT_meshopt_compression";class Ch{constructor(h){this.name=yh,this.enabled=h.isExtensionUsed(yh),this._loader=h}dispose(){this._loader=null}loadBufferViewAsync(h,d){return b.LoadExtensionAsync(h,d,this.name,(async(T,Y)=>{const y=d;if(y._meshOptData)return await y._meshOptData;const C=v.Get(`${h}/buffer`,this._loader.ud.buffers,Y.buffer);return y._meshOptData=this._loader.loadBufferAsync(`/buffers/${C.index}`,C,Y.byteOffset||0,Y.byteLength).then((async h=>await Yh.Default.decodeGltfBufferAsync(h,Y.count,Y.byteStride,Y.mode,Y.filter))),await y._meshOptData}))}}q(yh),l(yh,!0,(h=>new Ch(h)));const nh="EXT_texture_webp";class Xh{constructor(h){this.name=nh,this._loader=h,this.enabled=h.isExtensionUsed(nh)}dispose(){this._loader=null}_loadTextureAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=void 0==d.sampler?b.DefaultSampler:v.Get(`${h}/sampler`,this._loader.ud.samplers,d.sampler),n=v.Get(`${Y}/source`,this._loader.ud.images,y.source);return await this._loader._createTextureAsync(h,C,n,(h=>{T(h)}),void 0,!d._textureInfo.nonColorData)}))}}q(nh),l(nh,!0,(h=>new Xh(h)));const Fh="EXT_texture_avif";class Uh{constructor(h){this.name=Fh,this._loader=h,this.enabled=h.isExtensionUsed(Fh)}dispose(){this._loader=null}_loadTextureAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=void 0==d.sampler?b.DefaultSampler:v.Get(`${h}/sampler`,this._loader.ud.samplers,d.sampler),n=v.Get(`${Y}/source`,this._loader.ud.images,y.source);return await this._loader._createTextureAsync(h,C,n,(h=>{T(h)}),void 0,!d._textureInfo.nonColorData)}))}}q(Fh),l(Fh,!0,(h=>new Uh(h)));var Zh=T(14475),Sh=T(13322);const rh="EXT_lights_ies";class ch{constructor(h){this.name=rh,this._loader=h,this.enabled=this._loader.isExtensionUsed(rh)}dispose(){this._loader=null,delete this._lights}onLoading(){const h=this._loader.ud.extensions;if(h&&h[this.name]){const d=h[this.name];this._lights=d.lights,v.Assign(this._lights)}}loadNodeAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,n)=>{let X,F;this._loader._allMaterialsDirtyRequired=!0;const U=await this._loader.loadNodeAsync(h,d,(h=>{F=v.Get(Y,this._lights,n.fd);const d=F.name||h.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,X=new Zh.b(d,y.pd.Zero(),y.pd.Backward(),0,1,this._loader.babylonScene),X.angle=Math.PI/2,X.innerAngle=0,X._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,F._babylonLight=X,X.falloffType=Sh.d.FALLOFF_GLTF,X.eX=n.color?C.ed.Bd(n.color):C.ed.White(),X.aX=n.multiplier||1,X.range=Number.MAX_VALUE,X.parent=h,this._loader._babylonLights.push(X),b.AddPointerMetadata(X,Y),T(h)}));let Z;if(F.uri)Z=await this._loader.loadUriAsync(h,F,F.uri);else{const d=v.Get(`${h}/bufferView`,this._loader.ud.bufferViews,F.bufferView);Z=await this._loader.loadBufferViewAsync(`/bufferViews/${d.index}`,d)}return X.iesProfileTexture=new V.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,Z,!0,void 0,void 0,void 0,void 0,".ies"),U}))}}q(rh),l(rh,!0,(h=>new ch(h)));var Oh=T(14499);const fh="KHR_draco_mesh_compression";class Jh{constructor(h){this.name=fh,this.useNormalizedFlagFromAccessor=!0,this._loader=h,this.enabled=Oh.c.DefaultAvailable&&this._loader.isExtensionUsed(fh)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{if(void 0!=d.mode&&4!==d.mode&&5!==d.mode)throw new Error(`${h}: Unsupported mode ${d.mode}`);const C={},n={},X=(h,Y)=>{const X=y.attributes[h];if(void 0!=X&&(T._delayInfo=T._delayInfo||[],-1===T._delayInfo.indexOf(Y)&&T._delayInfo.push(Y),C[Y]=X,this.useNormalizedFlagFromAccessor)){const T=v.TryGet(this._loader.ud.accessors,d.attributes[h]);T&&(n[Y]=T.normalized||!1)}};X("POSITION",w.g.PositionKind),X("NORMAL",w.g.NormalKind),X("TANGENT",w.g.TangentKind),X("TEXCOORD_0",w.g.UVKind),X("TEXCOORD_1",w.g.UV2Kind),X("TEXCOORD_2",w.g.UV3Kind),X("TEXCOORD_3",w.g.UV4Kind),X("TEXCOORD_4",w.g.UV5Kind),X("TEXCOORD_5",w.g.UV6Kind),X("JOINTS_0",w.g.MatricesIndicesKind),X("WEIGHTS_0",w.g.MatricesWeightsKind),X("COLOR_0",w.g.ColorKind);const F=v.Get(Y,this._loader.ud.bufferViews,y.bufferView);return F._dracoBabylonGeometry||(F._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${F.index}`,F).then((async Y=>{const y=this.dracoDecoder||Oh.c.Default,X=v.TryGet(this._loader.ud.accessors,d.attributes.POSITION),F=this._loader.parent.alwaysComputeBoundingBox||T.skeleton||!X?null:G(X);return await y._decodeMeshToGeometryForGltfAsync(T.name,this._loader.babylonScene,Y,C,n,F).catch((d=>{throw new Error(`${h}: ${d.message}`)}))}))),await F._dracoBabylonGeometry}))}}q(fh),l(fh,!0,(h=>new Jh(h)));var Wh=T(14504),Lh=T(12750),Dh=T(12757),Vh=T(13196),ih=T(13385),wh=T(12714);Vh.d.AddNodeConstructor("Light_Type_0",((h,d)=>()=>new sh(h,y.pd.Zero(),d)));class sh extends ih.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(h){this._shadowAngle=h,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(h){const d=this.needCube();if(this._direction=h,this.needCube()!==d&&this._shadowGenerators){const h=this._shadowGenerators.values();for(let d=h.next();!0!==d.done;d=h.next()){d.value.recreateShadowMap()}}}constructor(h,d,T){super(h,T),this._shadowAngle=Math.PI/2,this.position=d}getClassName(){return"PointLight"}getTypeID(){return Sh.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(h){if(this.direction)return super.getShadowDirection(h);switch(h){case 0:return new y.pd(1,0,0);case 1:return new y.pd(-1,0,0);case 2:return new y.pd(0,-1,0);case 3:return new y.pd(0,1,0);case 4:return new y.pd(0,0,1);case 5:return new y.pd(0,0,-1)}return y.pd.Zero()}_setDefaultShadowProjectionMatrix(h,d,T){const Y=this.Eh().activeCamera;if(!Y)return;const C=void 0!==this.shadowMinZ?this.shadowMinZ:Y.Gd,n=void 0!==this.shadowMaxZ?this.shadowMaxZ:Y.maxZ,X=this.Eh().getEngine().Dd;y.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,X?n:C,X?C:n,h,!0,this._scene.getEngine().isNDCHalfZRange,void 0,X)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(h,d){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,d):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,d),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,d),this}transferToNodeMaterialEffect(h,d){return this.computeTransformedInformation()?h.setFloat3(d,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):h.setFloat3(d,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(h,d){h["POINTLIGHT"+d]=!0}}(0,Lh.c)([(0,Dh.E)()],sh.prototype,"shadowAngle",null),(0,wh.e)("BABYLON.PointLight",sh);const Eh="KHR_lights_punctual";class zh{constructor(h){this.name=Eh,this._loader=h,this.enabled=this._loader.isExtensionUsed(Eh)}dispose(){this._loader=null,delete this._lights}onLoading(){const h=this._loader.ud.extensions;if(h&&h[this.name]){const d=h[this.name];this._lights=d.lights,v.Assign(this._lights)}}loadNodeAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,n)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(h,d,(h=>{let d;const X=v.Get(Y,this._lights,n.fd),F=X.name||h.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,X.type){case"directional":{const h=new Wh.b(F,y.pd.Backward(),this._loader.babylonScene);h.position.XC(0),d=h;break}case"point":d=new sh(F,y.pd.Zero(),this._loader.babylonScene);break;case"spot":{const h=new Zh.b(F,y.pd.Zero(),y.pd.Backward(),0,1,this._loader.babylonScene);h.angle=2*(X.spot&&X.spot.outerConeAngle||Math.PI/4),h.innerAngle=2*(X.spot&&X.spot.innerConeAngle||0),d=h;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${Y}: Invalid light type (${X.type})`)}d._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,X._babylonLight=d,d.falloffType=Sh.d.FALLOFF_GLTF,d.eX=X.color?C.ed.Bd(X.color):C.ed.White(),d.aX=void 0==X.aX?1:X.aX,d.range=void 0==X.range?Number.MAX_VALUE:X.range,d.parent=h,this._loader._babylonLights.push(d),b.AddPointerMetadata(d,Y),T(h)})))))}}q(Eh),l(Eh,!0,(h=>new zh(h)));const xh="KHR_materials_pbrSpecularGlossiness";class gh{constructor(h){this.name=xh,this.order=200,this._loader=h,this.enabled=this._loader.isExtensionUsed(xh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=new Array;return C.push(this._loader.loadMaterialBasePropertiesAsync(h,d,T)),C.push(this._loadSpecularGlossinessPropertiesAsync(Y,y,T)),this._loader.loadMaterialAlphaProperties(h,d,T),await Promise.all(C).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(h,d,T){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);const Y=new Array;return T.metallic=null,T.roughness=null,d.diffuseFactor?(T.albedoColor=C.ed.Bd(d.diffuseFactor),T.alpha=d.diffuseFactor[3]):T.albedoColor=C.ed.White(),T.reflectivityColor=d.specularFactor?C.ed.Bd(d.specularFactor):C.ed.White(),T.microSurface=void 0==d.glossinessFactor?1:d.glossinessFactor,d.diffuseTexture&&Y.push(this._loader.loadTextureInfoAsync(`${h}/diffuseTexture`,d.diffuseTexture,(h=>{h.name=`${T.name} (Diffuse)`,T.albedoTexture=h}))),d.specularGlossinessTexture&&(Y.push(this._loader.loadTextureInfoAsync(`${h}/specularGlossinessTexture`,d.specularGlossinessTexture,(h=>{h.name=`${T.name} (Specular Glossiness)`,T.reflectivityTexture=h,T.reflectivityTexture.vd=!0}))),T.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(Y).then((()=>{}))}}q(xh),l(xh,!0,(h=>new gh(h)));const Hh="KHR_materials_unlit";class ph{constructor(h){this.name=Hh,this.order=210,this._loader=h,this.enabled=this._loader.isExtensionUsed(Hh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async()=>await this._loadUnlitPropertiesAsync(h,d,T)))}_loadUnlitPropertiesAsync(h,d,T){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);const Y=new Array;T.unlit=!0;const y=d.pbrMetallicRoughness;return y&&(y.baseColorFactor?(T.albedoColor=C.ed.Bd(y.baseColorFactor),T.alpha=y.baseColorFactor[3]):T.albedoColor=C.ed.White(),y.baseColorTexture&&Y.push(this._loader.loadTextureInfoAsync(`${h}/baseColorTexture`,y.baseColorTexture,(h=>{h.name=`${T.name} (Base Color)`,T.albedoTexture=h})))),d.doubleSided&&(T.td=!1,T.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(h,d,T),Promise.all(Y).then((()=>{}))}}q(Hh),l(Hh,!0,(h=>new ph(h)));const kh="KHR_materials_clearcoat";class oh{constructor(h){this.name=kh,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(kh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=new Array;C.push(this._loader.loadMaterialPropertiesAsync(h,d,T)),C.push(this._loadClearCoatPropertiesAsync(Y,y,T)),await Promise.all(C)}))}_loadClearCoatPropertiesAsync(h,d,T){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);const Y=new Array;return T.clearCoat.isEnabled=!0,T.clearCoat.useRoughnessFromMainTexture=!1,T.clearCoat.remapF0OnInterfaceChange=!1,void 0!=d.clearcoatFactor?T.clearCoat.aX=d.clearcoatFactor:T.clearCoat.aX=0,d.clearcoatTexture&&Y.push(this._loader.loadTextureInfoAsync(`${h}/clearcoatTexture`,d.clearcoatTexture,(h=>{h.name=`${T.name} (ClearCoat)`,T.clearCoat.texture=h}))),void 0!=d.clearcoatRoughnessFactor?T.clearCoat.roughness=d.clearcoatRoughnessFactor:T.clearCoat.roughness=0,d.clearcoatRoughnessTexture&&(d.clearcoatRoughnessTexture.nonColorData=!0,Y.push(this._loader.loadTextureInfoAsync(`${h}/clearcoatRoughnessTexture`,d.clearcoatRoughnessTexture,(h=>{h.name=`${T.name} (ClearCoat Roughness)`,T.clearCoat.textureRoughness=h})))),d.clearcoatNormalTexture&&(d.clearcoatNormalTexture.nonColorData=!0,Y.push(this._loader.loadTextureInfoAsync(`${h}/clearcoatNormalTexture`,d.clearcoatNormalTexture,(h=>{h.name=`${T.name} (ClearCoat Normal)`,T.clearCoat.bumpTexture=h}))),T.invertNormalMapX=!T.Eh().useRightHandedSystem,T.invertNormalMapY=T.Eh().useRightHandedSystem,void 0!=d.clearcoatNormalTexture.scale&&(T.clearCoat.bumpTexture.level=d.clearcoatNormalTexture.scale)),Promise.all(Y).then((()=>{}))}}q(kh),l(kh,!0,(h=>new oh(h)));const uh="KHR_materials_iridescence";class Nh{constructor(h){this.name=uh,this.order=195,this._loader=h,this.enabled=this._loader.isExtensionUsed(uh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(h,d,T)),C.push(this._loadIridescencePropertiesAsync(Y,y,T)),await Promise.all(C).then((()=>{}))}))}_loadIridescencePropertiesAsync(h,d,T){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);const Y=new Array;return T.iridescence.isEnabled=!0,T.iridescence.aX=d.iridescenceFactor??0,T.iridescence.indexOfRefraction=d.iridescenceIor??d.iridescenceIOR??1.3,T.iridescence.minimumThickness=d.iridescenceThicknessMinimum??100,T.iridescence.maximumThickness=d.iridescenceThicknessMaximum??400,d.iridescenceTexture&&Y.push(this._loader.loadTextureInfoAsync(`${h}/iridescenceTexture`,d.iridescenceTexture,(h=>{h.name=`${T.name} (Iridescence)`,T.iridescence.texture=h}))),d.iridescenceThicknessTexture&&Y.push(this._loader.loadTextureInfoAsync(`${h}/iridescenceThicknessTexture`,d.iridescenceThicknessTexture,(h=>{h.name=`${T.name} (Iridescence Thickness)`,T.iridescence.thicknessTexture=h}))),Promise.all(Y).then((()=>{}))}}q(uh),l(uh,!0,(h=>new Nh(h)));const Kh="KHR_materials_anisotropy";class lh{constructor(h){this.name=Kh,this.order=195,this._loader=h,this.enabled=this._loader.isExtensionUsed(Kh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=new Array;C.push(this._loader.loadMaterialPropertiesAsync(h,d,T)),C.push(this._loadIridescencePropertiesAsync(Y,y,T)),await Promise.all(C)}))}async _loadIridescencePropertiesAsync(h,d,T){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);const Y=new Array;T.anisotropy.isEnabled=!0,T.anisotropy.aX=d.anisotropyStrength??0,T.anisotropy.angle=d.anisotropyRotation??0,d.anisotropyTexture&&(d.anisotropyTexture.nonColorData=!0,Y.push(this._loader.loadTextureInfoAsync(`${h}/anisotropyTexture`,d.anisotropyTexture,(h=>{h.name=`${T.name} (Anisotropy Intensity)`,T.anisotropy.texture=h})))),await Promise.all(Y)}}q(Kh),l(Kh,!0,(h=>new lh(h)));const qh="KHR_materials_emissive_strength";class jh{constructor(h){this.name=qh,this.order=170,this._loader=h,this.enabled=this._loader.isExtensionUsed(qh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>await this._loader.loadMaterialPropertiesAsync(h,d,T).then((()=>{this._loadEmissiveProperties(Y,y,T)}))))}_loadEmissiveProperties(h,d,T){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);void 0!==d.emissiveStrength&&(T.emissiveIntensity=d.emissiveStrength)}}q(qh),l(qh,!0,(h=>new jh(h)));const ah="KHR_materials_sheen";class eh{constructor(h){this.name=ah,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(ah)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(h,d,T)),C.push(this._loadSheenPropertiesAsync(Y,y,T)),await Promise.all(C).then((()=>{}))}))}_loadSheenPropertiesAsync(h,d,T){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);const Y=new Array;return T.sheen.isEnabled=!0,T.sheen.aX=1,void 0!=d.sheenColorFactor?T.sheen.color=C.ed.Bd(d.sheenColorFactor):T.sheen.color=C.ed.Black(),d.sheenColorTexture&&Y.push(this._loader.loadTextureInfoAsync(`${h}/sheenColorTexture`,d.sheenColorTexture,(h=>{h.name=`${T.name} (Sheen Color)`,T.sheen.texture=h}))),void 0!==d.sheenRoughnessFactor?T.sheen.roughness=d.sheenRoughnessFactor:T.sheen.roughness=0,d.sheenRoughnessTexture&&(d.sheenRoughnessTexture.nonColorData=!0,Y.push(this._loader.loadTextureInfoAsync(`${h}/sheenRoughnessTexture`,d.sheenRoughnessTexture,(h=>{h.name=`${T.name} (Sheen Roughness)`,T.sheen.textureRoughness=h})))),T.sheen.albedoScaling=!0,T.sheen.useRoughnessFromMainTexture=!1,Promise.all(Y).then((()=>{}))}}q(ah),l(ah,!0,(h=>new eh(h)));var vh=T(13243);const Gh="KHR_materials_specular";class bh{constructor(h){this.name=Gh,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(Gh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=new Array;if(C.push(this._loader.loadMaterialPropertiesAsync(h,d,T)),C.push(this._loadSpecularPropertiesAsync(Y,y,T)),y.extensions&&y.extensions.EXT_materials_specular_edge_color&&T instanceof D.d){y.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(T.brdf.dielectricSpecularModel=vh.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,T.brdf.conductorSpecularModel=vh.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(C).then((()=>{}))}))}_loadSpecularPropertiesAsync(h,d,T){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);const Y=new Array;return void 0!==d.specularFactor&&(T.metallicF0Factor=d.specularFactor),void 0!==d.specularColorFactor&&(T.metallicReflectanceColor=C.ed.Bd(d.specularColorFactor)),d.specularTexture&&(d.specularTexture.nonColorData=!0,Y.push(this._loader.loadTextureInfoAsync(`${h}/specularTexture`,d.specularTexture,(h=>{h.name=`${T.name} (Specular)`,T.metallicReflectanceTexture=h,T.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),d.specularColorTexture&&Y.push(this._loader.loadTextureInfoAsync(`${h}/specularColorTexture`,d.specularColorTexture,(h=>{h.name=`${T.name} (Specular Color)`,T.reflectanceTexture=h}))),Promise.all(Y).then((()=>{}))}}q(Gh),l(Gh,!0,(h=>new bh(h)));const Bh="KHR_materials_ior";class Mh{constructor(h){this.name=Bh,this.order=180,this._loader=h,this.enabled=this._loader.isExtensionUsed(Bh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(h,d,T)),C.push(this._loadIorPropertiesAsync(Y,y,T)),await Promise.all(C).then((()=>{}))}))}_loadIorPropertiesAsync(h,d,T){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);return void 0!==d.ior?T.indexOfRefraction=d.ior:T.indexOfRefraction=Mh._DEFAULT_IOR,Promise.resolve()}}Mh._DEFAULT_IOR=1.5,q(Bh),l(Bh,!0,(h=>new Mh(h)));const md="KHR_materials_variants";class Rh{constructor(h){this.name=md,this._loader=h,this.enabled=this._loader.isExtensionUsed(md)}dispose(){this._loader=null}static GetAvailableVariants(h){const d=this._GetExtensionMetadata(h);return d?Object.keys(d.variants):[]}getAvailableVariants(h){return Rh.GetAvailableVariants(h)}static SelectVariant(h,d){const T=this._GetExtensionMetadata(h);if(!T)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${md} extension`);const Y=h=>{const d=T.variants[h];if(d)for(const T of d)T.mesh.material=T.material};if(d instanceof Array)for(const y of d)Y(y);else Y(d);T.lastSelected=d}selectVariant(h,d){Rh.SelectVariant(h,d)}static Reset(h){const d=this._GetExtensionMetadata(h);if(!d)throw new Error(`Cannot reset on a glTF mesh that does not have the ${md} extension`);for(const T of d.original)T.mesh.material=T.material;d.lastSelected=null}reset(h){Rh.Reset(h)}static GetLastSelectedVariant(h){const d=this._GetExtensionMetadata(h);if(!d)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${md} extension`);return d.lastSelected}getLastSelectedVariant(h){return Rh.GetLastSelectedVariant(h)}static _GetExtensionMetadata(h){var d,T;return(null===h||void 0===h||null===(d=h._internalMetadata)||void 0===d||null===(T=d.ud)||void 0===T?void 0:T[md])||null}onLoading(){const h=this._loader.ud.extensions;if(h&&h[this.name]){const d=h[this.name];this._variants=d.variants}}onReady(){const h=this._loader.rootBabylonMesh;if(h){var d;const T=this._loader.parent.extensionOptions[md];null!==T&&void 0!==T&&T.defaultVariant&&Rh.SelectVariant(h,T.defaultVariant),null===T||void 0===T||null===(d=T.onLoaded)||void 0===d||d.call(T,{get variants(){return Rh.GetAvailableVariants(h)},get selectedVariant(){const d=Rh.GetLastSelectedVariant(h);return d?Array.isArray(d)?d[0]:d:Rh.GetAvailableVariants(h)[0]},set selectedVariant(d){Rh.SelectVariant(h,d)}})}}_loadMeshPrimitiveAsync(h,d,T,Y,y,C){return b.LoadExtensionAsync(h,y,this.name,(async(n,X)=>{const F=new Array;return F.push(this._loader._loadMeshPrimitiveAsync(h,d,T,Y,y,(d=>{if(C(d),d instanceof z.d){const T=b._GetDrawMode(h,y.mode),Y=this._loader.rootBabylonMesh,C=Y?Y._internalMetadata=Y._internalMetadata||{}:{},U=C.ud=C.ud||{},Z=U[md]=U[md]||{lastSelected:null,original:[],variants:{}};Z.original.push({mesh:d,material:d.material});for(let h=0;h<X.mappings.length;++h){const y=X.mappings[h],C=v.Get(`${n}/mappings/${h}/material`,this._loader.ud.materials,y.material);F.push(this._loader._loadMaterialAsync(`#/materials/${y.material}`,C,d,T,(h=>{for(let T=0;T<y.variants.length;++T){const C=y.variants[T],n=v.Get(`/extensions/${md}/variants/${C}`,this._variants,C);Z.variants[n.name]=Z.variants[n.name]||[],Z.variants[n.name].push({mesh:d,material:h}),d.onClonedObservable.add((h=>{const T=h;let y=null,C=T;do{if(C=C.parent,!C)return;y=Rh._GetExtensionMetadata(C)}while(null===y);if(Y&&y===Rh._GetExtensionMetadata(Y)){C._internalMetadata={};for(const h in Y._internalMetadata)C._internalMetadata[h]=Y._internalMetadata[h];C._internalMetadata.ud=[];for(const h in Y._internalMetadata.ud)C._internalMetadata.ud[h]=Y._internalMetadata.ud[h];C._internalMetadata.ud[md]={lastSelected:null,original:[],variants:{}};for(const h of y.original)C._internalMetadata.ud[md].original.push({mesh:h.mesh,material:h.material});for(const h in y.variants)if(Object.prototype.hasOwnProperty.call(y.variants,h)){C._internalMetadata.ud[md].variants[h]=[];for(const d of y.variants[h])C._internalMetadata.ud[md].variants[h].push({mesh:d.mesh,material:d.material})}y=C._internalMetadata.ud[md]}for(const Y of y.original)Y.mesh===d&&(Y.mesh=T);for(const Y of y.variants[n.name])Y.mesh===d&&(Y.mesh=T)}))}})))}}}))),await Promise.all(F).then((h=>{let[d]=h;return d}))}))}}q(md),l(md,!0,(h=>new Rh(h)));var Qh=T(12826);class Ih{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:vh.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(h,d){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Ih._GetDefaultOptions(),...h},this._scene=d,this._scene._transmissionHelper=this,this.onErrorObservable=new Z.e,this._scene.zd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(h){if(!Object.keys(h).filter((d=>this._options[d]!==h[d])).length)return;const d={...this._options,...h},T=this._options;this._options=d,d.renderSize===T.renderSize&&d.renderTargetTextureType===T.renderTargetTextureType&&d.generateMipmaps===T.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=d.samples,this._opaqueRenderTarget.lodGenerationScale=d.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=d.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(h){return!!h&&!!(h instanceof D.d&&h.subSurface.isRefractionEnabled)}_addMesh(h){this._materialObservers[h.uniqueId]=h.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),n.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(h.material)?(h.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(h)&&this._transparentMeshesCache.push(h)):-1===this._opaqueMeshesCache.indexOf(h)&&this._opaqueMeshesCache.push(h)}))}_removeMesh(h){h.onMaterialChangedObservable.remove(this._materialObservers[h.uniqueId]),delete this._materialObservers[h.uniqueId];let d=this._transparentMeshesCache.indexOf(h);-1!==d&&this._transparentMeshesCache.splice(d,1),d=this._opaqueMeshesCache.indexOf(h),-1!==d&&this._opaqueMeshesCache.splice(d,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(h){const d=this._transparentMeshesCache.indexOf(h),T=this._opaqueMeshesCache.indexOf(h);this._shouldRenderAsTransmission(h.material)?(h.material instanceof D.d&&(h.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==T?(this._opaqueMeshesCache.splice(T,1),this._transparentMeshesCache.push(h)):-1===d&&this._transparentMeshesCache.push(h)):-1!==d?(this._transparentMeshesCache.splice(d,1),this._opaqueMeshesCache.push(h)):-1===T&&this._opaqueMeshesCache.push(h)}_isRenderTargetValid(){var h;return null!==(null===(h=this._opaqueRenderTarget)||void 0===h?void 0:h.getInternalTexture())}_setupRenderTargets(){var h;let d;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Qh.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(h=this._options.clearColor)||void 0===h?void 0:h.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((h=>{d=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?h.clearColor.C(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(h.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=d}));for(const T of this._transparentMeshesCache)this._shouldRenderAsTransmission(T.material)&&(T.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Ah="KHR_materials_transmission";class Ph{constructor(h){this.name=Ah,this.order=175,this._loader=h,this.enabled=this._loader.isExtensionUsed(Ah),this.enabled&&(h.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(h,d,T)),C.push(this._loadTransparentPropertiesAsync(Y,d,T,y)),await Promise.all(C).then((()=>{}))}))}_loadTransparentPropertiesAsync(h,d,T,Y){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);const y=T;if(y.subSurface.isRefractionEnabled=!0,y.subSurface.volumeIndexOfRefraction=1,y.subSurface.useAlbedoToTintRefraction=!0,void 0===Y.transmissionFactor)return y.subSurface.refractionIntensity=0,y.subSurface.isRefractionEnabled=!1,Promise.resolve();{var C;y.subSurface.refractionIntensity=Y.transmissionFactor;const h=y.Eh();if(y.subSurface.refractionIntensity&&!h._transmissionHelper)new Ih({},y.Eh());else if(y.subSurface.refractionIntensity&&(null===(C=h._transmissionHelper)||void 0===C||!C._isRenderTargetValid())){var n;null===(n=h._transmissionHelper)||void 0===n||n._setupRenderTargets()}}return y.subSurface.minimumThickness=0,y.subSurface.maximumThickness=0,Y.transmissionTexture?(Y.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${h}/transmissionTexture`,Y.transmissionTexture,void 0).then((h=>{h.name=`${T.name} (Transmission)`,y.subSurface.refractionIntensityTexture=h,y.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}q(Ah),l(Ah,!0,(h=>new Ph(h)));const th="KHR_materials_diffuse_transmission";class hd{constructor(h){this.name=th,this.order=174,this._loader=h,this.enabled=this._loader.isExtensionUsed(th),this.enabled&&(h.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(h,d,T)),C.push(this._loadTranslucentPropertiesAsync(Y,d,T,y)),await Promise.all(C).then((()=>{}))}))}_loadTranslucentPropertiesAsync(h,d,T,Y){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);const y=T;if(y.subSurface.isTranslucencyEnabled=!0,y.subSurface.volumeIndexOfRefraction=1,y.subSurface.minimumThickness=0,y.subSurface.maximumThickness=0,y.subSurface.useAlbedoToTintTranslucency=!1,void 0===Y.diffuseTransmissionFactor)return y.subSurface.translucencyIntensity=0,y.subSurface.isTranslucencyEnabled=!1,Promise.resolve();y.subSurface.translucencyIntensity=Y.diffuseTransmissionFactor;const n=new Array;return y.subSurface.useGltfStyleTextures=!0,Y.diffuseTransmissionTexture&&(Y.diffuseTransmissionTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${h}/diffuseTransmissionTexture`,Y.diffuseTransmissionTexture).then((h=>{h.name=`${T.name} (Diffuse Transmission)`,y.subSurface.translucencyIntensityTexture=h})))),void 0!==Y.diffuseTransmissionColorFactor?y.subSurface.translucencyColor=C.ed.Bd(Y.diffuseTransmissionColorFactor):y.subSurface.translucencyColor=C.ed.White(),Y.diffuseTransmissionColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${h}/diffuseTransmissionColorTexture`,Y.diffuseTransmissionColorTexture).then((h=>{h.name=`${T.name} (Diffuse Transmission Color)`,y.subSurface.translucencyColorTexture=h}))),Promise.all(n).then((()=>{}))}}q(th),l(th,!0,(h=>new hd(h)));const dd="KHR_materials_volume";class Td{constructor(h){this.name=dd,this.order=173,this._loader=h,this.enabled=this._loader.isExtensionUsed(dd),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(h,d,T)),C.push(this._loadVolumePropertiesAsync(Y,d,T,y)),await Promise.all(C).then((()=>{}))}))}_loadVolumePropertiesAsync(h,d,T,Y){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);if(!T.subSurface.isRefractionEnabled&&!T.subSurface.isTranslucencyEnabled||!Y.thicknessFactor)return Promise.resolve();T.subSurface.volumeIndexOfRefraction=T.indexOfRefraction;const y=void 0!==Y.attenuationDistance?Y.attenuationDistance:Number.MAX_VALUE;return T.subSurface.tintColorAtDistance=y,void 0!==Y.attenuationColor&&3==Y.attenuationColor.length&&T.subSurface.tintColor.ny(Y.attenuationColor[0],Y.attenuationColor[1],Y.attenuationColor[2]),T.subSurface.minimumThickness=0,T.subSurface.maximumThickness=Y.thicknessFactor,T.subSurface.useThicknessAsDepth=!0,Y.thicknessTexture?(Y.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${h}/thicknessTexture`,Y.thicknessTexture).then((h=>{h.name=`${T.name} (Thickness)`,T.subSurface.thicknessTexture=h,T.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}q(dd),l(dd,!0,(h=>new Td(h)));const Yd="KHR_materials_dispersion";class yd{constructor(h){this.name=Yd,this.order=174,this._loader=h,this.enabled=this._loader.isExtensionUsed(Yd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(h,d,T)),C.push(this._loadDispersionPropertiesAsync(Y,d,T,y)),await Promise.all(C).then((()=>{}))}))}_loadDispersionPropertiesAsync(h,d,T,Y){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);return T.subSurface.isRefractionEnabled&&Y.dispersion?(T.subSurface.isDispersionEnabled=!0,T.subSurface.dispersion=Y.dispersion,Promise.resolve()):Promise.resolve()}}q(Yd),l(Yd,!0,(h=>new yd(h)));const Cd="EXT_materials_diffuse_roughness";class nd{constructor(h){this.name=Cd,this.order=190,this._loader=h,this.enabled=this._loader.isExtensionUsed(Cd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(h,d,T)),C.push(this._loadDiffuseRoughnessPropertiesAsync(Y,y,T)),await Promise.all(C).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(h,d,T){if(!(T instanceof D.d))throw new Error(`${h}: Material type not supported`);const Y=new Array;return T.brdf.baseDiffuseModel=vh.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=d.diffuseRoughnessFactor?T.baseDiffuseRoughness=d.diffuseRoughnessFactor:T.baseDiffuseRoughness=0,d.diffuseRoughnessTexture&&Y.push(this._loader.loadTextureInfoAsync(`${h}/diffuseRoughnessTexture`,d.diffuseRoughnessTexture,(h=>{h.name=`${T.name} (Diffuse Roughness)`,T.baseDiffuseRoughnessTexture=h}))),Promise.all(Y).then((()=>{}))}}q(Cd),l(Cd,!0,(h=>new nd(h)));const Xd="KHR_mesh_quantization";class Fd{constructor(h){this.name=Xd,this.enabled=h.isExtensionUsed(Xd)}dispose(){}}q(Xd),l(Xd,!0,(h=>new Fd(h)));const Ud="KHR_texture_basisu";class Zd{constructor(h){this.name=Ud,this._loader=h,this.enabled=h.isExtensionUsed(Ud)}dispose(){this._loader=null}_loadTextureAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>{const C=void 0==d.sampler?b.DefaultSampler:v.Get(`${h}/sampler`,this._loader.ud.samplers,d.sampler),n=v.Get(`${Y}/source`,this._loader.ud.images,y.source);return await this._loader._createTextureAsync(h,C,n,(h=>{T(h)}),d._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!d._textureInfo.nonColorData)}))}}q(Ud),l(Ud,!0,(h=>new Zd(h)));const Sd="KHR_texture_transform";class rd{constructor(h){this.name=Sd,this._loader=h,this.enabled=this._loader.isExtensionUsed(Sd)}dispose(){this._loader=null}loadTextureInfoAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(Y,y)=>await this._loader.loadTextureInfoAsync(h,d,(h=>{if(!(h instanceof V.c))throw new Error(`${Y}: Texture type not supported`);y.offset&&(h.uOffset=y.offset[0],h.vOffset=y.offset[1]),h.uRotationCenter=0,h.vRotationCenter=0,y.rotation&&(h.wAng=-y.rotation),y.scale&&(h.uScale=y.scale[0],h.vScale=y.scale[1]),void 0!=y.texCoord&&(h.coordinatesIndex=y.texCoord),T(h)}))))}}q(Sd),l(Sd,!0,(h=>new rd(h)));const cd="KHR_xmp_json_ld";class Od{constructor(h){this.name=cd,this.order=100,this._loader=h,this.enabled=this._loader.isExtensionUsed(cd)}dispose(){this._loader=null}onLoading(){var h,d,T;if(null===this._loader.rootBabylonMesh)return;const Y=null===(h=this._loader.ud.extensions)||void 0===h?void 0:h.KHR_xmp_json_ld,y=null===(d=this._loader.ud.asset)||void 0===d||null===(T=d.extensions)||void 0===T?void 0:T.KHR_xmp_json_ld;if(Y&&y){const h=+y.packet;Y.packets&&h<Y.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=Y.packets[h])}}}function fd(h,d,T,Y){return C.ed.Bd(d,T).scale(Y)}function Jd(h,d,T,Y){return d[T]*Y}function Wd(h,d,T,Y){return-d[T]*Y}function Ld(h,d,T,Y){return d[T+1]*Y}function Dd(h,d,T,Y){return d[T]*Y*2}function Vd(h){return{scale:[new wd(r.c.ANIMATIONTYPE_FLOAT,`${h}.uScale`,Jd,(()=>2)),new wd(r.c.ANIMATIONTYPE_FLOAT,`${h}.vScale`,Ld,(()=>2))],offset:[new wd(r.c.ANIMATIONTYPE_FLOAT,`${h}.uOffset`,Jd,(()=>2)),new wd(r.c.ANIMATIONTYPE_FLOAT,`${h}.vOffset`,Ld,(()=>2))],rotation:[new wd(r.c.ANIMATIONTYPE_FLOAT,`${h}.wAng`,Wd,(()=>1))]}}q(cd),l(cd,!0,(h=>new Od(h)));class id extends B.AnimationPropertyInfo{buildAnimations(h,d,T,Y){return[{babylonAnimatable:h._babylonCamera,babylonAnimation:this._buildAnimation(d,T,Y)}]}}class wd extends B.AnimationPropertyInfo{buildAnimations(h,d,T,Y){const y=[];for(const C in h._data)y.push({babylonAnimatable:h._data[C].babylonMaterial,babylonAnimation:this._buildAnimation(d,T,Y)});return y}}class sd extends B.AnimationPropertyInfo{buildAnimations(h,d,T,Y){return[{babylonAnimatable:h._babylonLight,babylonAnimation:this._buildAnimation(d,T,Y)}]}}(0,j.m)("/cameras/{}/orthographic/xmag",[new id(r.c.ANIMATIONTYPE_FLOAT,"orthoLeft",Wd,(()=>1)),new id(r.c.ANIMATIONTYPE_FLOAT,"orthoRight",Ld,(()=>1))]),(0,j.m)("/cameras/{}/orthographic/ymag",[new id(r.c.ANIMATIONTYPE_FLOAT,"orthoBottom",Wd,(()=>1)),new id(r.c.ANIMATIONTYPE_FLOAT,"orthoTop",Ld,(()=>1))]),(0,j.m)("/cameras/{}/orthographic/zfar",[new id(r.c.ANIMATIONTYPE_FLOAT,"maxZ",Jd,(()=>1))]),(0,j.m)("/cameras/{}/orthographic/znear",[new id(r.c.ANIMATIONTYPE_FLOAT,"Gd",Jd,(()=>1))]),(0,j.m)("/cameras/{}/perspective/yfov",[new id(r.c.ANIMATIONTYPE_FLOAT,"fov",Jd,(()=>1))]),(0,j.m)("/cameras/{}/perspective/zfar",[new id(r.c.ANIMATIONTYPE_FLOAT,"maxZ",Jd,(()=>1))]),(0,j.m)("/cameras/{}/perspective/znear",[new id(r.c.ANIMATIONTYPE_FLOAT,"Gd",Jd,(()=>1))]),(0,j.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new wd(r.c.ANIMATIONTYPE_COLOR3,"albedoColor",fd,(()=>4)),new wd(r.c.ANIMATIONTYPE_FLOAT,"alpha",(function(h,d,T,Y){return d[T+3]*Y}),(()=>4))]),(0,j.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new wd(r.c.ANIMATIONTYPE_FLOAT,"metallic",Jd,(()=>1))]),(0,j.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new wd(r.c.ANIMATIONTYPE_FLOAT,"roughness",Jd,(()=>1))]);const Ed=Vd("albedoTexture");(0,j.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Ed.scale),(0,j.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Ed.offset),(0,j.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Ed.rotation);const zd=Vd("metallicTexture");(0,j.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",zd.scale),(0,j.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",zd.offset),(0,j.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",zd.rotation),(0,j.m)("/materials/{}/emissiveFactor",[new wd(r.c.ANIMATIONTYPE_COLOR3,"emissiveColor",fd,(()=>3))]);const xd=Vd("bumpTexture");(0,j.m)("/materials/{}/normalTexture/scale",[new wd(r.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Jd,(()=>1))]),(0,j.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",xd.scale),(0,j.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",xd.offset),(0,j.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",xd.rotation),(0,j.m)("/materials/{}/occlusionTexture/strength",[new wd(r.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Jd,(()=>1))]);const gd=Vd("ambientTexture");(0,j.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",gd.scale),(0,j.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",gd.offset),(0,j.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",gd.rotation);const Hd=Vd("emissiveTexture");(0,j.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Hd.scale),(0,j.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Hd.offset),(0,j.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Hd.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new wd(r.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Jd,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new wd(r.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Jd,(()=>1))]);const pd=Vd("anisotropy.texture");(0,j.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",pd.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",pd.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",pd.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new wd(r.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Jd,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new wd(r.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Jd,(()=>1))]);const kd=Vd("clearCoat.texture");(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",kd.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",kd.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",kd.rotation);const od=Vd("clearCoat.bumpTexture");(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new wd(r.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Jd,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",od.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",od.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",od.rotation);const ud=Vd("clearCoat.textureRoughness");(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",ud.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",ud.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",ud.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new wd(r.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Jd,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new wd(r.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Jd,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new wd(r.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Jd,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new wd(r.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Jd,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new wd(r.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Jd,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new wd(r.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Jd,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new wd(r.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Jd,(()=>1))]);const Nd=Vd("iridescence.texture");(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Nd.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Nd.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Nd.rotation);const Kd=Vd("iridescence.thicknessTexture");(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Kd.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Kd.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Kd.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new wd(r.c.ANIMATIONTYPE_COLOR3,"sheen.color",fd,(()=>3))]),(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new wd(r.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",Jd,(()=>1))]);const ld=Vd("sheen.texture");(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",ld.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",ld.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",ld.rotation);const qd=Vd("sheen.textureRoughness");(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",qd.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",qd.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",qd.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new wd(r.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Jd,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new wd(r.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",fd,(()=>3))]);const jd=Vd("metallicReflectanceTexture");(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",jd.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",jd.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",jd.rotation);const ad=Vd("reflectanceTexture");(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",ad.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",ad.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",ad.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new wd(r.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Jd,(()=>1))]);const ed=Vd("subSurface.refractionIntensityTexture");(0,j.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",ed.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",ed.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",ed.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new wd(r.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",fd,(()=>3))]),(0,j.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new wd(r.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Jd,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new wd(r.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Jd,(()=>1))]);const vd=Vd("subSurface.thicknessTexture");(0,j.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",vd.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",vd.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",vd.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new wd(r.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Jd,(()=>1))]);const Gd=Vd("subSurface.translucencyIntensityTexture");(0,j.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Gd.scale),(0,j.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Gd.offset),(0,j.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Gd.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new wd(r.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",fd,(()=>3))]);const bd=Vd("subSurface.translucencyColorTexture");(0,j.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",bd.scale),(0,j.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",bd.offset),(0,j.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",bd.rotation),(0,j.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new sd(r.c.ANIMATIONTYPE_COLOR3,"diffuse",fd,(()=>3))]),(0,j.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new sd(r.c.ANIMATIONTYPE_FLOAT,"intensity",Jd,(()=>1))]),(0,j.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new sd(r.c.ANIMATIONTYPE_FLOAT,"range",Jd,(()=>1))]),(0,j.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new sd(r.c.ANIMATIONTYPE_FLOAT,"innerAngle",Dd,(()=>1))]),(0,j.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new sd(r.c.ANIMATIONTYPE_FLOAT,"angle",Dd,(()=>1))]),(0,j.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new sd(r.c.ANIMATIONTYPE_COLOR3,"diffuse",fd,(()=>3))]),(0,j.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new sd(r.c.ANIMATIONTYPE_FLOAT,"intensity",Jd,(()=>1))]);const Bd="KHR_animation_pointer";class Md{constructor(h){this.name=Bd,this._loader=h,this._pathToObjectConverter=(0,j.l)(this._loader.ud)}get enabled(){return this._loader.isExtensionUsed(Bd)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(h,d,T,Y,y){var C;const n=null===(C=Y.target.extensions)||void 0===C?void 0:C.KHR_animation_pointer;if(!n||!this._pathToObjectConverter)return null;"pointer"!==Y.target.path&&f.c.Warn(`${h}/target/path: Value (${Y.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=Y.target.node&&f.c.Warn(`${h}/target/node: Value (${Y.target.node}) must not be present when using the ${this.name} extension`);const X=`${h}/extensions/${this.name}`,F=n.pointer;if(!F)throw new Error(`${X}: Pointer is missing`);try{const C=this._pathToObjectConverter.convert(F);if(!C.info.interpolation)throw new Error(`${X}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(h,d,T,Y,{object:C.object,info:C.info.interpolation},y)}catch(U){return f.c.Warn(`${X}/pointer: Invalid pointer (${F}) skipped`),null}}}q(Bd),l(Bd,!0,(h=>new Md(h)));class mT{constructor(h,d,T){this.frame=h,this.action=d,this.onlyOnce=T,this.isDone=!1}_clone(){return new mT(this.frame,this.action,this.onlyOnce)}}var Rd=T(12617),Qd=T(12656),Id=T(12651);class Ad{get loop(){return this._loop}set loop(h){h!==this._loop&&(this._loop=h,this.updateOptions({loop:h}))}get currentTime(){var h;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(h=Qd.c.audioEngine)&&void 0!==h&&h.audioContext&&(this.isPlaying||this.isPaused)){const h=this.isPaused?0:Qd.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+h}return 0}get spatialSound(){return this._spatialSound}set spatialSound(h){if(h==this._spatialSound)return;const d=this.isPlaying;this.pause(),h?(this._spatialSound=h,this._updateSpatialParameters()):this._disableSpatialSound(),d&&this.play()}constructor(h,d,T){var Y;let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new Z.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=y.pd.Zero(),this._localDirection=new y.pd(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=h,T=T||O.d.LastCreatedScene)if(this._scene=T,Ad._SceneComponentInitialization(T),this._readyToPlayCallback=C,this._customAttenuationFunction=(h,d,T,Y,y)=>d<T?h*(1-d/T):0,X&&(this.autoplay=X.autoplay||!1,this._loop=X.loop||!1,void 0!==X.volume&&(this._volume=X.volume),this._spatialSound=X.spatialSound??!1,this.maxDistance=X.maxDistance??100,this.useCustomAttenuation=X.useCustomAttenuation??!1,this.rolloffFactor=X.rolloffFactor||1,this.refDistance=X.refDistance||1,this.distanceModel=X.distanceModel||"linear",this._playbackRate=X.playbackRate||1,this._streaming=X.streaming??!1,this._length=X.length,this._offset=X.offset),null!==(Y=Qd.c.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&Qd.c.audioEngine.audioContext){this._soundGain=Qd.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let h=!0;if(d)try{"string"===typeof d?(this._urlType="String",this._url=d):d instanceof ArrayBuffer?this._urlType="ArrayBuffer":d instanceof HTMLMediaElement?this._urlType="MediaElement":d instanceof MediaStream?this._urlType="MediaStream":d instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(d)&&(this._urlType="Array");let T=[],Y=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Qd.c.audioEngine.audioContext.createMediaElementSource(d),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Qd.c.audioEngine.audioContext.createMediaStreamSource(d),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":d.byteLength>0&&(Y=!0,this._soundLoaded(d));break;case"AudioBuffer":this._audioBufferLoaded(d);break;case"String":T.push(d);case"Array":0===T.length&&(T=d);for(let h=0;h<T.length;h++){const d=T[h];if(Y=X&&X.skipCodecCheck||-1!==d.indexOf(".mp3",d.length-4)&&Qd.c.audioEngine.isMP3supported||-1!==d.indexOf(".ogg",d.length-4)&&Qd.c.audioEngine.isOGGsupported||-1!==d.indexOf(".wav",d.length-4)||-1!==d.indexOf(".m4a",d.length-4)||-1!==d.indexOf(".mp4",d.length-4)||-1!==d.indexOf("blob:"),Y){this._streaming?(this._htmlAudioElement=new Audio(d),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,n.Tools.SetCorsBehavior(d,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(d,(h=>{this._soundLoaded(h)}),void 0,!0,!0,(h=>{h&&f.c.Error("XHR "+h.status+" error on: "+d+"."),f.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:h=!1}h?Y||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):f.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(F){f.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Qd.c.audioEngine&&!Qd.c.audioEngine.WarnedWebAudioUnsupported&&(f.c.Error("Web Audio is not supported by your browser."),Qd.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var h;null!==(h=Qd.c.audioEngine)&&void 0!==h&&h.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(h){var d;null!==(d=Qd.c.audioEngine)&&void 0!==d&&d.audioContext&&(this._audioBuffer=h,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(h){var d;null!==(d=Qd.c.audioEngine)&&void 0!==d&&d.audioContext&&Qd.c.audioEngine.audioContext.decodeAudioData(h,(h=>{this._audioBufferLoaded(h)}),(h=>{f.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+h)}))}setAudioBuffer(h){var d;null!==(d=Qd.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&(this._audioBuffer=h,this._isReadyToPlay=!0)}updateOptions(h){h&&(this.loop=h.loop??this.loop,this.maxDistance=h.maxDistance??this.maxDistance,this.useCustomAttenuation=h.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=h.rolloffFactor??this.rolloffFactor,this.refDistance=h.refDistance??this.refDistance,this.distanceModel=h.distanceModel??this.distanceModel,this._playbackRate=h.playbackRate??this._playbackRate,this._length=h.length??void 0,this.spatialSound=h.spatialSound??this._spatialSound,this._setOffset(h.offset??void 0),this.setVolume(h.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var h;null!==(h=Qd.c.audioEngine)&&void 0!==h&&h.canUseWebAudio&&Qd.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Qd.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var h;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(h=this._soundPanner)||void 0===h||h.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var h;null!==(h=Qd.c.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(h){var d;null!==(d=Qd.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(h),this._isOutputConnected=!0)}setDirectionalCone(h,d,T){d<h?f.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=h,this._coneOuterAngle=d,this._coneOuterGain=T,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(h){if(h!=this._coneInnerAngle){var d;if(this._coneOuterAngle<h)return void f.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=h,null!==(d=Qd.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(h){if(h!=this._coneOuterAngle){var d;if(h<this._coneInnerAngle)return void f.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=h,null!==(d=Qd.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(h){var d;h.equals(this._position)||(this._position.C(h),null!==(d=Qd.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(h){var d;this._localDirection=h,null!==(d=Qd.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const h=this._connectedTransformNode.getWorldMatrix(),d=y.pd.TransformNormal(this._localDirection,h);d.normalize(),this._soundPanner.orientationX.value=d.x,this._soundPanner.orientationY.value=d.y,this._soundPanner.orientationZ.value=d.z}updateDistanceFromListener(){var h;if(null!==(h=Qd.c.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const h=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Nd(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,h,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(h){this._customAttenuationFunction=h}play(h,d,T){var Y;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(Y=Qd.c.audioEngine)&&void 0!==Y&&Y.audioContext)try{var y,C;this._clearTimeoutsAndObservers();let Y=h?(null===(y=Qd.c.audioEngine)||void 0===y?void 0:y.audioContext.currentTime)+h:null===(C=Qd.c.audioEngine)||void 0===C?void 0:C.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Qd.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const h=()=>{var T;if(null!==(T=Qd.c.audioEngine)&&void 0!==T&&T.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=d??0;const T=this._htmlAudioElement.play();void 0!==T&&T.catch((()=>{var d,T;(null===(d=Qd.c.audioEngine)||void 0===d||d.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(T=Qd.c.audioEngine)||void 0===T?void 0:T.onAudioUnlockedObservable.addOnce((()=>{h()})))}))}else{var Y;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(Y=Qd.c.audioEngine)||void 0===Y?void 0:Y.onAudioUnlockedObservable.addOnce((()=>{h()}))}};h()}}else{var n;const y=()=>{var y;if(null!==(y=Qd.c.audioEngine)&&void 0!==y&&y.audioContext){var C;if(T=T||this._length,void 0!==d&&this._setOffset(d),this._soundSource){const h=this._soundSource;h.onended=()=>{h.disconnect()}}if(this._soundSource=null===(C=Qd.c.audioEngine)||void 0===C?void 0:C.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var n;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==d&&(this._soundSource.loopStart=d),void 0!==T&&(this._soundSource.loopEnd=(0|d)+T),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},Y=h?(null===(n=Qd.c.audioEngine)||void 0===n?void 0:n.audioContext.currentTime)+h:Qd.c.audioEngine.audioContext.currentTime;const y=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(Y,y,this.loop?void 0:T)}}};"suspended"===(null===(n=Qd.c.audioEngine)||void 0===n?void 0:n.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var h;"suspended"===(null===(h=Qd.c.audioEngine)||void 0===h?void 0:h.audioContext.state)?(Qd.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Qd.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{y()})))):y()}),500):y()}this._startTime=Y,this.isPlaying=!0,this.isPaused=!1}catch(X){f.c.Error("Error while trying to play audio: "+this.name+", "+X.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(h){var d;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var T;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(T=this._streamingSource)||void 0===T||T.disconnect();this.isPlaying=!1}else if(null!==(d=Qd.c.audioEngine)&&void 0!==d&&d.audioContext&&this._soundSource){const d=h?Qd.c.audioEngine.audioContext.currentTime+h:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(d)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var h;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var d;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(d=this._streamingSource)||void 0===d||d.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(h=Qd.c.audioEngine)&&void 0!==h&&h.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Qd.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(h,d){var T;null!==(T=Qd.c.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._soundGain&&(d&&Qd.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Qd.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Qd.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(h,Qd.c.audioEngine.audioContext.currentTime+d)):this._soundGain.gain.value=h),this._volume=h}setPlaybackRate(h){this._playbackRate=h,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(h){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=h,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=h=>this._onRegisterAfterWorldMatrixUpdate(h),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(h){var d;if(h.getBoundingInfo){const d=h.getBoundingInfo();this.setPosition(d.boundingSphere.centerWorld)}else this.setPosition(h.absolutePosition);null!==(d=Qd.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const h=()=>{(0,Id.d)((()=>this._isReadyToPlay),(()=>{T._audioBuffer=this.getAudioBuffer(),T._isReadyToPlay=!0,T.autoplay&&T.play(0,this._offset,this._length)}),void 0,300)},d={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},T=new Ad(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,d);return this.useCustomAttenuation&&T.setAttenuationFunction(this._customAttenuationFunction),T.setPosition(this._position),T.setPlaybackRate(this._playbackRate),h(),T}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const h={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(h.connectedMeshId=this._connectedTransformNode.id),h.position=this._position.ad(),h.refDistance=this.refDistance,h.distanceModel=this.distanceModel,h.isDirectional=this._isDirectional,h.localDirectionToMesh=this._localDirection.ad(),h.coneInnerAngle=this._coneInnerAngle,h.coneOuterAngle=this._coneOuterAngle,h.coneOuterGain=this._coneOuterGain),h}static Parse(h,d,T,Y){const C=h.name;let n;n=h.url?T+h.url:T+C;const X={autoplay:h.autoplay,loop:h.loop,volume:h.volume,spatialSound:h.spatialSound,maxDistance:h.maxDistance,rolloffFactor:h.rolloffFactor,refDistance:h.refDistance,distanceModel:h.distanceModel,playbackRate:h.playbackRate};let F;if(Y){const h=()=>{(0,Id.d)((()=>Y._isReadyToPlay),(()=>{F._audioBuffer=Y.getAudioBuffer(),F._isReadyToPlay=!0,F.autoplay&&F.play(0,F._offset,F._length)}),void 0,300)};F=new Ad(C,new ArrayBuffer(0),d,null,X),h()}else F=new Ad(C,n,d,(()=>{d.removePendingData(F)}),X),d.addPendingData(F);if(h.position){const d=y.pd.Bd(h.position);F.setPosition(d)}if(h.isDirectional&&(F.setDirectionalCone(h.coneInnerAngle||360,h.coneOuterAngle||360,h.coneOuterGain||0),h.localDirectionToMesh)){const d=y.pd.Bd(h.localDirectionToMesh);F.setLocalDirectionToMesh(d)}if(h.connectedMeshId){const T=d.getMeshById(h.connectedMeshId);T&&F.attachToMesh(T)}return h.metadata&&(F.metadata=h.metadata),F}_setOffset(h){this._offset!==h&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=h)}_clearTimeoutsAndObservers(){var h;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(h=Qd.c.audioEngine)||void 0===h||h.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Ad._SceneComponentInitialization=h=>{throw(0,Rd.e)("AudioSceneComponent")},(0,wh.e)("BABYLON.Sound",Ad);class Pd{constructor(h,d,T){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],d.length!==T.length)throw new Error("Sounds length does not equal weights length");this.loop=h,this._weights=T;let Y=0;for(const C of T)Y+=C;const y=Y>0?1/Y:0;for(let C=0;C<this._weights.length;C++)this._weights[C]*=y;this._sounds=d;for(const C of this._sounds)C.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(h){if(h!==this._coneInnerAngle){if(this._coneOuterAngle<h)return void f.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=h;for(const d of this._sounds)d.directionalConeInnerAngle=h}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(h){if(h!==this._coneOuterAngle){if(h<this._coneInnerAngle)return void f.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=h;for(const d of this._sounds)d.directionalConeOuterAngle=h}}get volume(){return this._volume}set volume(h){if(h!==this._volume)for(const d of this._sounds)d.setVolume(h)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(h){if(!this.isPaused){this.stop();const h=Math.random();let d=0;for(let T=0;T<this._weights.length;T++)if(d+=this._weights[T],h<=d){this._currentIndex=T;break}}const d=this._sounds[this._currentIndex??0];d.isReady()?d.play(0,this.isPaused?void 0:h):d.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class td{constructor(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(h=h||O.d.LastCreatedScene)&&(this._scene=h,this.soundCollection=[],this._options=d,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var h;null!==(h=Qd.c.audioEngine)&&void 0!==h&&h.canUseWebAudio&&Qd.c.audioEngine.audioContext&&(this._outputAudioNode=Qd.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Qd.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Qd.c.audioEngine&&Qd.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(h){var d;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(d=Qd.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&h.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==h.soundTrackId&&(-1===h.soundTrackId?this._scene.mainSoundTrack.removeSound(h):this._scene.soundTracks&&this._scene.soundTracks[h.soundTrackId].removeSound(h)),this.soundCollection.push(h),h.soundTrackId=this.id}removeSound(h){const d=this.soundCollection.indexOf(h);-1!==d&&this.soundCollection.splice(d,1)}setVolume(h){var d;null!==(d=Qd.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=h)}switchPanningModelToHRTF(){var h;if(null!==(h=Qd.c.audioEngine)&&void 0!==h&&h.canUseWebAudio)for(let d=0;d<this.soundCollection.length;d++)this.soundCollection[d].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var h;if(null!==(h=Qd.c.audioEngine)&&void 0!==h&&h.canUseWebAudio)for(let d=0;d<this.soundCollection.length;d++)this.soundCollection[d].switchPanningModelToEqualPower()}connectToAnalyser(h){var d;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=h,null!==(d=Qd.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Qd.c.audioEngine.masterGain))}}var hT=T(13032),dT=T(12990),TT=T(12589);Qd.c.AudioEngineFactory=(h,d,T)=>new YT(h,d,T);class YT{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new Z.e,this.onAudioLockedObservable=new Z.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,TT.l)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const Y=document.createElement("audio");this._hostElement=h,this._audioContext=d,this._audioDestination=T;try{Y&&Y.canPlayType&&(Y.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||Y.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(y){}try{Y&&Y.canPlayType&&Y.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(y){}}lock(){this._triggerSuspendedState()}unlock(){var h,d;if("running"===(null===(h=this._audioContext)||void 0===h?void 0:h.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(d=this._audioContext)||void 0===d||d.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{f.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var h;null===(h=this._audioContext)||void 0===h||h.addEventListener("statechange",(()=>{var h;this.unlocked&&"running"!==(null===(h=this._audioContext)||void 0===h?void 0:h.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var h;return null!==(h=this._audioContext)&&void 0!==h&&h.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(h){this.canUseWebAudio=!1,f.c.Error("Web Audio: "+h.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(h){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const h=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",d=document.createElement("style");d.appendChild(document.createTextNode(h)),document.getElementsByTagName("head")[0].appendChild(d),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var h;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(h=this._audioContext)||void 0===h||h.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(h){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=h)}connectToAnalyser(h){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=h,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var yT=T(12609);(0,T(14206).f)(hT.e.NAME_AUDIO,((h,d,T,Y)=>{let y,C=[];if(T.Mr=T.Mr||[],void 0!==h.Mr&&null!==h.Mr)for(let X=0,F=h.Mr.length;X<F;X++){var n;const F=h.Mr[X];null!==(n=Qd.c.audioEngine)&&void 0!==n&&n.canUseWebAudio?(F.url||(F.url=F.name),C[F.url]?T.Mr.push(Ad.Parse(F,d,Y,C[F.url])):(y=Ad.Parse(F,d,Y),C[F.url]=y,T.Mr.push(y))):T.Mr.push(new Ad(F.name,null,d))}C=[]})),Object.defineProperty(dT.d.prototype,"mainSoundTrack",{get:function(){let h=this._getComponent(hT.e.NAME_AUDIO);return h||(h=new CT(this),this.Wd(h)),this._mainSoundTrack||(this._mainSoundTrack=new td(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),dT.d.prototype.getSoundByName=function(h){let d;for(d=0;d<this.mainSoundTrack.soundCollection.length;d++)if(this.mainSoundTrack.soundCollection[d].name===h)return this.mainSoundTrack.soundCollection[d];if(this.soundTracks)for(let T=0;T<this.soundTracks.length;T++)for(d=0;d<this.soundTracks[T].soundCollection.length;d++)if(this.soundTracks[T].soundCollection[d].name===h)return this.soundTracks[T].soundCollection[d];return null},Object.defineProperty(dT.d.prototype,"audioEnabled",{get:function(){let h=this._getComponent(hT.e.NAME_AUDIO);return h||(h=new CT(this),this.Wd(h)),h.audioEnabled},set:function(h){let d=this._getComponent(hT.e.NAME_AUDIO);d||(d=new CT(this),this.Wd(d)),h?d.enableAudio():d.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(dT.d.prototype,"headphone",{get:function(){let h=this._getComponent(hT.e.NAME_AUDIO);return h||(h=new CT(this),this.Wd(h)),h.headphone},set:function(h){let d=this._getComponent(hT.e.NAME_AUDIO);d||(d=new CT(this),this.Wd(d)),h?d.switchAudioModeForHeadphones():d.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(dT.d.prototype,"audioListenerPositionProvider",{get:function(){let h=this._getComponent(hT.e.NAME_AUDIO);return h||(h=new CT(this),this.Wd(h)),h.audioListenerPositionProvider},set:function(h){let d=this._getComponent(hT.e.NAME_AUDIO);if(d||(d=new CT(this),this.Wd(d)),h&&"function"!==typeof h)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");d.audioListenerPositionProvider=h},enumerable:!0,configurable:!0}),Object.defineProperty(dT.d.prototype,"audioListenerRotationProvider",{get:function(){let h=this._getComponent(hT.e.NAME_AUDIO);return h||(h=new CT(this),this.Wd(h)),h.audioListenerRotationProvider},set:function(h){let d=this._getComponent(hT.e.NAME_AUDIO);if(d||(d=new CT(this),this.Wd(d)),h&&"function"!==typeof h)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");d.audioListenerRotationProvider=h},enumerable:!0,configurable:!0}),Object.defineProperty(dT.d.prototype,"audioPositioningRefreshRate",{get:function(){let h=this._getComponent(hT.e.NAME_AUDIO);return h||(h=new CT(this),this.Wd(h)),h.audioPositioningRefreshRate},set:function(h){let d=this._getComponent(hT.e.NAME_AUDIO);d||(d=new CT(this),this.Wd(d)),d.audioPositioningRefreshRate=h},enumerable:!0,configurable:!0});class CT{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(h){this.name=hT.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new y.pd,this._cachedCameraPosition=new y.pd,this._lastCheck=0,this._invertMatrixTemp=new y.Matrix,this._cameraDirectionTemp=new y.pd,(h=h||O.d.LastCreatedScene)&&(this.qd=h,h.soundTracks=[],h.Mr=[])}register(){this.qd._afterRenderStage.registerStep(hT.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(h){if(h.Mr=[],this.qd.soundTracks)for(let d=0;d<this.qd.soundTracks.length;d++){const T=this.qd.soundTracks[d];for(let d=0;d<T.soundCollection.length;d++)h.Mr.push(T.soundCollection[d].serialize())}}addFromContainer(h){if(h.Mr)for(const d of h.Mr)d.play(),d.autoplay=!0,this.qd.mainSoundTrack.addSound(d)}removeFromContainer(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(h.Mr)for(const T of h.Mr)T.stop(),T.autoplay=!1,this.qd.mainSoundTrack.removeSound(T),d&&T.dispose()}dispose(){const h=this.qd;if(h._mainSoundTrack&&h.mainSoundTrack.dispose(),h.soundTracks)for(let d=0;d<h.soundTracks.length;d++)h.soundTracks[d].dispose()}disableAudio(){const h=this.qd;let d;for(this._audioEnabled=!1,Qd.c.audioEngine&&Qd.c.audioEngine.audioContext&&Qd.c.audioEngine.audioContext.suspend(),d=0;d<h.mainSoundTrack.soundCollection.length;d++)h.mainSoundTrack.soundCollection[d].pause();if(h.soundTracks)for(d=0;d<h.soundTracks.length;d++)for(let T=0;T<h.soundTracks[d].soundCollection.length;T++)h.soundTracks[d].soundCollection[T].pause()}enableAudio(){const h=this.qd;let d;for(this._audioEnabled=!0,Qd.c.audioEngine&&Qd.c.audioEngine.audioContext&&Qd.c.audioEngine.audioContext.resume(),d=0;d<h.mainSoundTrack.soundCollection.length;d++)h.mainSoundTrack.soundCollection[d].isPaused&&h.mainSoundTrack.soundCollection[d].play();if(h.soundTracks)for(d=0;d<h.soundTracks.length;d++)for(let T=0;T<h.soundTracks[d].soundCollection.length;T++)h.soundTracks[d].soundCollection[T].isPaused&&h.soundTracks[d].soundCollection[T].play()}switchAudioModeForHeadphones(){const h=this.qd;if(this._headphone=!0,h.mainSoundTrack.switchPanningModelToHRTF(),h.soundTracks)for(let d=0;d<h.soundTracks.length;d++)h.soundTracks[d].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const h=this.qd;if(this._headphone=!1,h.mainSoundTrack.switchPanningModelToEqualPower(),h.soundTracks)for(let d=0;d<h.soundTracks.length;d++)h.soundTracks[d].switchPanningModelToEqualPower()}_afterRender(){const h=yT.b.Now;if(this._lastCheck&&h-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=h;const d=this.qd;if(!this._audioEnabled||!d._mainSoundTrack||!d.soundTracks||0===d._mainSoundTrack.soundCollection.length&&1===d.soundTracks.length)return;const T=Qd.c.audioEngine;if(T&&T.audioContext){let h,Y=d.activeCamera;if(d.activeCameras&&d.activeCameras.length>0&&(Y=d.activeCameras[0]),this.audioListenerPositionProvider){const h=this.audioListenerPositionProvider();T.audioContext.listener.setPosition(h.x||0,h.y||0,h.z||0)}else Y?this._cachedCameraPosition.equals(Y.globalPosition)||(this._cachedCameraPosition.C(Y.globalPosition),T.audioContext.listener.setPosition(Y.globalPosition.x,Y.globalPosition.y,Y.globalPosition.z)):T.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const h=this.audioListenerRotationProvider();T.audioContext.listener.setOrientation(h.x||0,h.y||0,h.z||0,0,1,0)}else Y?(Y.rigCameras&&Y.rigCameras.length>0&&(Y=Y.rigCameras[0]),Y.getViewMatrix().invertToRef(this._invertMatrixTemp),y.pd.TransformNormalToRef(CT._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.C(this._cameraDirectionTemp),T.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):T.audioContext.listener.setOrientation(0,0,0,0,1,0);for(h=0;h<d.mainSoundTrack.soundCollection.length;h++){const T=d.mainSoundTrack.soundCollection[h];T.useCustomAttenuation&&T.updateDistanceFromListener()}if(d.soundTracks)for(h=0;h<d.soundTracks.length;h++)for(let T=0;T<d.soundTracks[h].soundCollection.length;T++){const Y=d.soundTracks[h].soundCollection[T];Y.useCustomAttenuation&&Y.updateDistanceFromListener()}}}}CT._CameraDirection=new y.pd(0,0,-1),Ad._SceneComponentInitialization=h=>{let d=h._getComponent(hT.e.NAME_AUDIO);d||(d=new CT(h),h.Wd(d))};const nT="MSFT_audio_emitter";class XT{constructor(h){this.name=nT,this._loader=h,this.enabled=this._loader.isExtensionUsed(nT)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const h=this._loader.ud.extensions;if(h&&h[this.name]){const d=h[this.name];this._clips=d.clips,this._emitters=d.emitters,v.Assign(this._clips),v.Assign(this._emitters)}}loadSceneAsync(h,d){return b.LoadExtensionAsync(h,d,this.name,(async(T,Y)=>{const y=new Array;y.push(this._loader.loadSceneAsync(h,d));for(const h of Y.emitters){const d=v.Get(`${T}/emitters`,this._emitters,h);if(void 0!=d.refDistance||void 0!=d.maxDistance||void 0!=d.rolloffFactor||void 0!=d.distanceModel||void 0!=d.innerAngle||void 0!=d.outerAngle)throw new Error(`${T}: Direction or Distance properties are not allowed on emitters attached to a scene`);y.push(this._loadEmitterAsync(`${T}/emitters/${d.index}`,d))}await Promise.all(y)}))}loadNodeAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(h,Y)=>{const C=new Array,X=await this._loader.loadNodeAsync(h,d,(d=>{for(const T of Y.emitters){const Y=v.Get(`${h}/emitters`,this._emitters,T);C.push(this._loadEmitterAsync(`${h}/emitters/${Y.index}`,Y).then((()=>{for(const h of Y._babylonSounds)h.attachToMesh(d),void 0==Y.innerAngle&&void 0==Y.outerAngle||(h.setLocalDirectionToMesh(y.pd.Forward()),h.setDirectionalCone(2*n.Tools.ToDegrees(void 0==Y.innerAngle?Math.PI:Y.innerAngle),2*n.Tools.ToDegrees(void 0==Y.outerAngle?Math.PI:Y.outerAngle),0))})))}T(d)}));return await Promise.all(C),X}))}loadAnimationAsync(h,d){return b.LoadExtensionAsync(h,d,this.name,(async(T,Y)=>{const y=await this._loader.loadAnimationAsync(h,d),C=new Array;v.Assign(Y.events);for(const n of Y.events)C.push(this._loadAnimationEventAsync(`${T}/events/${n.index}`,h,d,n,y));return await Promise.all(C),y}))}_loadClipAsync(h,d){if(d._objectURL)return d._objectURL;let T;if(d.uri)T=this._loader.loadUriAsync(h,d,d.uri);else{const Y=v.Get(`${h}/bufferView`,this._loader.ud.bufferViews,d.bufferView);T=this._loader.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y)}return d._objectURL=T.then((h=>URL.createObjectURL(new Blob([h],{type:d.mimeType})))),d._objectURL}_loadEmitterAsync(h,d){if(d._babylonSounds=d._babylonSounds||[],!d._babylonData){const h=new Array,T=d.name||`emitter${d.index}`,Y={loop:!1,autoplay:!1,volume:void 0==d.volume?1:d.volume};for(let C=0;C<d.clips.length;C++){const y=`/extensions/${this.name}/clips`,n=v.Get(y,this._clips,d.clips[C].clip);h.push(this._loadClipAsync(`${y}/${d.clips[C].clip}`,n).then((h=>{const y=d._babylonSounds[C]=new Ad(T,h,this._loader.babylonScene,null,Y);y.refDistance=d.refDistance||1,y.maxDistance=d.maxDistance||256,y.rolloffFactor=d.rolloffFactor||1,y.distanceModel=d.distanceModel||"exponential"})))}const y=Promise.all(h).then((()=>{const h=d.clips.map((h=>h.weight||1)),T=new Pd(d.loop||!1,d._babylonSounds,h);d.innerAngle&&(T.directionalConeInnerAngle=2*n.Tools.ToDegrees(d.innerAngle)),d.outerAngle&&(T.directionalConeOuterAngle=2*n.Tools.ToDegrees(d.outerAngle)),d.volume&&(T.volume=d.volume),d._babylonData.sound=T}));d._babylonData={loaded:y}}return d._babylonData.loaded}_getEventAction(h,d,T,Y,y){switch(T){case"play":return h=>{const T=(y||0)+(h-Y);d.play(T)};case"stop":return()=>{d.stop()};case"pause":return()=>{d.pause()};default:throw new Error(`${h}: Unsupported action ${T}`)}}_loadAnimationEventAsync(h,d,T,Y,y){if(0==y.targetedAnimations.length)return Promise.resolve();const C=y.targetedAnimations[0],n=Y.nd,X=v.Get(`/extensions/${this.name}/emitters`,this._emitters,n);return this._loadEmitterAsync(h,X).then((()=>{const d=X._babylonData.sound;if(d){const T=new mT(Y.time,this._getEventAction(h,d,Y.action,Y.time,Y.startOffset));C.animation.addEvent(T),y.onAnimationGroupEndObservable.add((()=>{d.stop()})),y.onAnimationGroupPauseObservable.add((()=>{d.pause()}))}}))}}q(nT),l(nT,!0,(h=>new XT(h)));const FT="MSFT_lod";class UT{constructor(h){var d;this.name=FT,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new Z.e,this.onMaterialLODsLoadedObservable=new Z.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=h,this.maxLODsToLoad=(null===(d=this._loader.parent.extensionOptions[FT])||void 0===d?void 0:d.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(FT)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let h=0;h<this._nodePromiseLODs.length;h++){const d=Promise.all(this._nodePromiseLODs[h]).then((()=>{0!==h&&(this._loader.endPerformanceCounter(`Node LOD ${h}`),this._loader.log(`Loaded node LOD ${h}`)),this.onNodeLODsLoadedObservable.notifyObservers(h),h!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${h+1}`),this._loadBufferLOD(this._nodeBufferLODs,h+1),this._nodeSignalLODs[h]&&this._nodeSignalLODs[h].resolve())}));this._loader._completePromises.push(d)}for(let h=0;h<this._materialPromiseLODs.length;h++){const d=Promise.all(this._materialPromiseLODs[h]).then((()=>{0!==h&&(this._loader.endPerformanceCounter(`Material LOD ${h}`),this._loader.log(`Loaded material LOD ${h}`)),this.onMaterialLODsLoadedObservable.notifyObservers(h),h!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${h+1}`),this._loadBufferLOD(this._materialBufferLODs,h+1),this._materialSignalLODs[h]&&this._materialSignalLODs[h].resolve())}));this._loader._completePromises.push(d)}}loadSceneAsync(h,d){const T=this._loader.loadSceneAsync(h,d);return this._loadBufferLOD(this._bufferLODs,0),T}loadNodeAsync(h,d,T){return b.LoadExtensionAsync(h,d,this.name,(async(h,y)=>{let C;const n=this._getLODs(h,d,this._loader.ud.nodes,y.ids);this._loader.logOpen(`${h}`);for(let d=0;d<n.length;d++){const h=n[d];0!==d&&(this._nodeIndexLOD=d,this._nodeSignalLODs[d]=this._nodeSignalLODs[d]||new Y);const y=h=>{T(h),h.yF(!1)},X=this._loader.loadNodeAsync(`/nodes/${h.index}`,h,y).then((h=>{if(0!==d){const h=n[d-1];h._babylonTransformNode&&(this._disposeTransformNode(h._babylonTransformNode),delete h._babylonTransformNode)}return h.yF(!0),h}));this._nodePromiseLODs[d]=this._nodePromiseLODs[d]||[],0===d?C=X:(this._nodeIndexLOD=null,this._nodePromiseLODs[d].push(X))}return this._loader.logClose(),await C}))}_loadMaterialAsync(h,d,T,Y,y){return this._nodeIndexLOD?null:b.LoadExtensionAsync(h,d,this.name,(async(h,C)=>{let n;const X=this._getLODs(h,d,this._loader.ud.materials,C.ids);this._loader.logOpen(`${h}`);for(let d=0;d<X.length;d++){const h=X[d];0!==d&&(this._materialIndexLOD=d);const C=this._loader._loadMaterialAsync(`/materials/${h.index}`,h,T,Y,(h=>{0===d&&y(h)})).then((h=>{if(0!==d){y(h);const T=X[d-1]._data;T[Y]&&(this._disposeMaterials([T[Y].babylonMaterial]),delete T[Y])}return h}));this._materialPromiseLODs[d]=this._materialPromiseLODs[d]||[],0===d?n=C:(this._materialIndexLOD=null,this._materialPromiseLODs[d].push(C))}return this._loader.logClose(),await n}))}_loadUriAsync(h,d,T){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const y=this._nodeIndexLOD-1;return this._nodeSignalLODs[y]=this._nodeSignalLODs[y]||new Y,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(h,d,T)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const y=this._materialIndexLOD-1;return this._materialSignalLODs[y]=this._materialSignalLODs[y]||new Y,this._materialSignalLODs[y].promise.then((async()=>await this._loader.loadUriAsync(h,d,T)))}return null}loadBufferAsync(h,d,T,y){if(this._loader.parent.useRangeRequests&&!d.uri){if(!this._loader.bin)throw new Error(`${h}: Uri is missing or the binary glTF is missing its binary chunk`);const d=async(h,d)=>{const C=T,n=C+y-1;let X=h[d];return X?(X.start=Math.min(X.start,C),X.end=Math.max(X.end,n)):(X={start:C,end:n,loaded:new Y},h[d]=X),await X.loaded.promise.then((h=>new Uint8Array(h.buffer,h.byteOffset+T-X.start,y)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?d(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?d(this._materialBufferLODs,this._materialIndexLOD):d(this._bufferLODs,0)}return null}_loadBufferLOD(h,d){const T=h[d];T&&(this._loader.log(`Loading buffer range [${T.start}-${T.end}]`),this._loader.bin.readAsync(T.start,T.end-T.start+1).then((h=>{T.loaded.resolve(h)}),(h=>{T.loaded.reject(h)})))}_getLODs(h,d,T,Y){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const y=[];for(let C=Y.length-1;C>=0;C--)if(y.push(v.Get(`${h}/ids/${Y[C]}`,T,Y[C])),y.length===this.maxLODsToLoad)return y;return y.push(d),y}_disposeTransformNode(h){const d=[],T=h.material;T&&d.push(T);for(const y of h.getChildMeshes())y.material&&d.push(y.material);h.dispose();const Y=d.filter((h=>this._loader.babylonScene.meshes.every((d=>d.material!=h))));this._disposeMaterials(Y)}_disposeMaterials(h){const d={};for(const T of h){for(const h of T.getActiveTextures())d[h.uniqueId]=h;T.dispose()}for(const T in d)for(const h of this._loader.babylonScene.materials)h.hasTexture(d[T])&&delete d[T];for(const T in d)d[T].dispose()}}q(FT),l(FT,!0,(h=>new UT(h)));const ZT="MSFT_minecraftMesh";class ST{constructor(h){this.name=ZT,this._loader=h,this.enabled=this._loader.isExtensionUsed(ZT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtraAsync(h,d,this.name,(async(Y,y)=>{if(y){if(!(T instanceof D.d))throw new Error(`${Y}: Material type not supported`);const y=this._loader.loadMaterialPropertiesAsync(h,d,T);return T.needAlphaBlending()&&(T.forceDepthWrite=!0,T.separateCullingPass=!0),T.td=T.forceDepthWrite,T.twoSidedLighting=!0,await y}}))}}q(ZT),l(ZT,!0,(h=>new ST(h)));const rT="MSFT_sRGBFactors";class cT{constructor(h){this.name=rT,this._loader=h,this.enabled=this._loader.isExtensionUsed(rT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(h,d,T){return b.LoadExtraAsync(h,d,this.name,(async(Y,y)=>{if(y){if(!(T instanceof D.d))throw new Error(`${Y}: Material type not supported`);const y=this._loader.loadMaterialPropertiesAsync(h,d,T),C=T.Eh().getEngine().useExactSrgbConversions;return T.albedoTexture||T.albedoColor.toLinearSpaceToRef(T.albedoColor,C),T.reflectivityTexture||T.reflectivityColor.toLinearSpaceToRef(T.reflectivityColor,C),await y}}))}}q(rT),l(rT,!0,(h=>new cT(h)));var OT=T(14506);const fT={};var JT=T(14567),WT=T(14540),LT=T(14515),DT=T(14528);function VT(h,d){for(const T of h)for(const h of T.dataOutputs)if(h.uniqueId===d)return h;throw new Error("Could not find data out connection with unique id "+d)}function iT(h,d){for(const T of h)if(T instanceof WT.d)for(const h of T.signalInputs)if(h.uniqueId===d)return h;throw new Error("Could not find signal in connection with unique id "+d)}async function wT(h,d){const Y=await Promise.all(h.allBlocks.map((async h=>{const d=function(h){switch(h){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([T.e(78),T.e(79)]).then(T.bind(T,16005))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await T.e(80).then(T.bind(T,16011))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await T.e(81).then(T.bind(T,16015))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await T.e(82).then(T.bind(T,16023))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await T.e(83).then(T.bind(T,16032))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await T.e(84).then(T.bind(T,16041))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await T.e(85).then(T.bind(T,16044))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await T.e(86).then(T.bind(T,16047))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await T.e(87).then(T.bind(T,16055))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await T.e(89).then(T.bind(T,16077))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await T.e(89).then(T.bind(T,16077))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await T.e(89).then(T.bind(T,16077))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await T.e(89).then(T.bind(T,16077))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await T.e(89).then(T.bind(T,16077))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await T.e(89).then(T.bind(T,16077))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await T.e(90).then(T.bind(T,16079))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await T.e(90).then(T.bind(T,16079))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await T.e(90).then(T.bind(T,16079))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await T.e(90).then(T.bind(T,16079))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await T.e(95).then(T.bind(T,16087))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await T.e(96).then(T.bind(T,16096))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await T.e(97).then(T.bind(T,16101))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await T.e(98).then(T.bind(T,16108))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await T.e(99).then(T.bind(T,16110))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await T.e(100).then(T.bind(T,16116))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await T.e(101).then(T.bind(T,16121))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await T.e(102).then(T.bind(T,16124))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await T.e(103).then(T.bind(T,16129))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await T.e(104).then(T.bind(T,16138))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await T.e(105).then(T.bind(T,16141))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await T.e(106).then(T.bind(T,16150))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await T.e(107).then(T.bind(T,16157))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await T.e(108).then(T.bind(T,16159))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await T.e(109).then(T.bind(T,16166))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await T.e(110).then(T.bind(T,16173))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await T.e(111).then(T.bind(T,16180))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await T.e(112).then(T.bind(T,16185))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await T.e(113).then(T.bind(T,16189))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await T.e(92).then(T.bind(T,16193))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await T.e(114).then(T.bind(T,16195))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await T.e(115).then(T.bind(T,16201))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await T.e(116).then(T.bind(T,16209))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await T.e(93).then(T.bind(T,16215))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await T.e(88).then(T.bind(T,16058))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await T.e(94).then(T.bind(T,16223))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await T.e(94).then(T.bind(T,16223))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await T.e(94).then(T.bind(T,16223))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await T.e(94).then(T.bind(T,16223))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await T.e(94).then(T.bind(T,16223))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await T.e(94).then(T.bind(T,16223))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await T.e(94).then(T.bind(T,16223))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await T.e(94).then(T.bind(T,16223))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await T.e(89).then(T.bind(T,16077))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await T.e(89).then(T.bind(T,16077))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await T.e(89).then(T.bind(T,16077))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await T.e(89).then(T.bind(T,16077))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await T.e(89).then(T.bind(T,16077))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await T.e(89).then(T.bind(T,16077))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await T.e(89).then(T.bind(T,16077))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await T.e(90).then(T.bind(T,16079))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await T.e(90).then(T.bind(T,16079))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await T.e(91).then(T.bind(T,16228))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await T.e(91).then(T.bind(T,16228))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await T.e(91).then(T.bind(T,16228))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await T.e(91).then(T.bind(T,16228))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await T.e(91).then(T.bind(T,16228))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await T.e(91).then(T.bind(T,16228))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await T.e(117).then(T.bind(T,16234))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await T.e(118).then(T.bind(T,16241))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await T.e(119).then(T.bind(T,16247))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await T.e(120).then(T.bind(T,16256))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await T.e(121).then(T.bind(T,16260))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await T.e(122).then(T.bind(T,16267))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await T.e(123).then(T.bind(T,16271))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await T.e(124).then(T.bind(T,16278))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await T.e(125).then(T.bind(T,16287))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await T.e(126).then(T.bind(T,16292))).FlowGraphDataSwitchBlock;default:if(fT[h])return fT[h];throw new Error(`Unknown block name ${h}`)}}(h.className);return await d()})));return function(h,d,T){const Y=d.coordinator.createGraph(),y=[],C=d.valueParseFunction??LT.b;for(let n=0;n<h.allBlocks.length;n++){const X=ET(h.allBlocks[n],{qd:d.coordinator.config.qd,pathConverter:d.pathConverter,assetsContainer:d.coordinator.config.qd,valueParseFunction:C},T[n]);y.push(X),X instanceof JT.e&&Y.addEventBlock(X)}for(const n of y){for(const h of n.dataInputs)for(const d of h.connectedPointIds){const T=VT(y,d);h.connectTo(T)}if(n instanceof WT.d)for(const h of n.signalOutputs)for(const d of h.connectedPointIds){const T=iT(y,d);h.connectTo(T)}}for(const n of h.executionContexts)sT(n,{graph:Y,valueParseFunction:C},h.rightHanded);return Y}(h,d,Y)}function sT(h,d,T){const Y=d.graph.createContext();h.enableLogging&&(Y.enableLogging=!0),Y.treatDataAsRightHanded=T||!1;const y=d.valueParseFunction??LT.b;Y.uniqueId=h.uniqueId;const C=Y.Eh();if(h._assetsContext){var n,X,F,U,Z,S,r,c,O,f;const d=h._assetsContext,T={meshes:null===(n=d.meshes)||void 0===n?void 0:n.map((h=>C.getMeshById(h))),lights:null===(X=d.lights)||void 0===X?void 0:X.map((h=>C.getLightByName(h))),cameras:null===(F=d.cameras)||void 0===F?void 0:F.map((h=>C.getCameraByName(h))),materials:null===(U=d.materials)||void 0===U?void 0:U.map((h=>C.getMaterialById(h))),textures:null===(Z=d.textures)||void 0===Z?void 0:Z.map((h=>C.getTextureByName(h))),animations:null===(S=d.animations)||void 0===S?void 0:S.map((h=>C.animations.find((d=>d.name===h)))),skeletons:null===(r=d.skeletons)||void 0===r?void 0:r.map((h=>C.getSkeletonByName(h))),Fr:null===(c=d.Fr)||void 0===c?void 0:c.map((h=>C.getParticleSystemById(h))),animationGroups:null===(O=d.animationGroups)||void 0===O?void 0:O.map((h=>C.getAnimationGroupByName(h))),transformNodes:null===(f=d.transformNodes)||void 0===f?void 0:f.map((h=>C.getTransformNodeById(h))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Mr:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};Y.assetsContext=T}for(const J in h._userVariables){const d=y(J,h._userVariables,Y.assetsContext,C);Y.userVariables[J]=d}for(const J in h._connectionValues){const d=y(J,h._connectionValues,Y.assetsContext,C);Y._setConnectionValueByKey(J,d)}return Y}function ET(h,d,T){const Y={},y=d.valueParseFunction??LT.b;if(h.config)for(const n in h.config)Y[n]=y(n,h.config,d.assetsContainer||d.qd,d.qd);if((0,LT.h)(h.className)){if(!d.pathConverter)throw new Error("Path converter is required for this block");Y.pathConverter=d.pathConverter}const C=new T(Y);C.uniqueId=h.uniqueId;for(let n=0;n<h.dataInputs.length;n++){const d=C.getDataInput(h.dataInputs[n].name);if(!d)throw new Error("Could not find data input with name "+h.dataInputs[n].name+" in block "+h.className);d.deserialize(h.dataInputs[n])}for(let n=0;n<h.dataOutputs.length;n++){const d=C.getDataOutput(h.dataOutputs[n].name);if(!d)throw new Error("Could not find data output with name "+h.dataOutputs[n].name+" in block "+h.className);d.deserialize(h.dataOutputs[n])}return C.metadata=h.metadata,C.deserialize&&C.deserialize(h),C}function zT(h){const[d,T]=h.split(":");return xT({op:d,extension:T})}function xT(h){var d;let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Y=h.extension?null===(d=HT[h.extension])||void 0===d?void 0:d[h.op]:pT[h.op];if(!Y&&(f.c.Warn(`No mapping found for operation ${h.op} and extension ${h.extension||"KHR_interactivity"}`),T)){const d={},T={flows:{}};if(h.inputValueSockets){d.values={};for(const T in h.inputValueSockets)d.values[T]={name:T}}return h.outputValueSockets&&(T.values={},Object.keys(h.outputValueSockets).forEach((h=>{T.values[h]={name:h}}))),{gZ:[],inputs:d,outputs:T}}return Y}function gT(h,d,T){HT[d]||(HT[d]={}),HT[d][h]=T}const HT={BABYLON:{"flow/log":{gZ:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},pT={"event/onStart":{gZ:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{gZ:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{gZ:["FlowGraphSendCustomEventBlock"],extraProcessor(h,d,T,Y,y){if("event/send"!==d.op||!h.configuration||1!==Object.keys(h.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const C=h.configuration.event.value[0];if("number"!==typeof C)throw new Error("Event id should be a number");const n=Y.arrays.events[C],X=y[0];return X.config||(X.config={}),X.config.eventId=n.eventId,X.config.eventData=n.eventData,y}},"event/receive":{gZ:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(h,d){var T;if(!h.configuration)return f.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const Y=h.configuration.event;if(!Y)return f.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const y=Y.value[0];if("number"!==typeof y)return f.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(T=d.events)||void 0===T?void 0:T[y])?{valid:!0}:(f.c.Error(`Event with id ${y} not found`),{valid:!1,error:`Event with id ${y} not found`})},extraProcessor(h,d,T,Y,y){if("event/receive"!==d.op||!h.configuration||1!==Object.keys(h.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const C=h.configuration.event.value[0];if("number"!==typeof C)throw new Error("Event id should be a number");const n=Y.arrays.events[C],X=y[0];return X.config||(X.config={}),X.config.eventId=n.eventId,X.config.eventData=n.eventData,y}},"math/e":kT("FlowGraphEBlock"),"math/pi":kT("FlowGraphPIBlock"),"math/inf":kT("FlowGraphInfBlock"),"math/nan":kT("FlowGraphNaNBlock"),"math/abs":kT("FlowGraphAbsBlock"),"math/sign":kT("FlowGraphSignBlock"),"math/trunc":kT("FlowGraphTruncBlock"),"math/floor":kT("FlowGraphFloorBlock"),"math/ceil":kT("FlowGraphCeilBlock"),"math/round":{gZ:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,T,Y,y){var C;return(C=y[0]).config||(C.config={}),y[0].config.roundHalfAwayFromZero=!0,y}},"math/fract":kT("FlowGraphFractBlock"),"math/neg":kT("FlowGraphNegationBlock"),"math/add":kT("FlowGraphAddBlock",["a","b"],!0),"math/sub":kT("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{gZ:["FlowGraphMultiplyBlock"],extraProcessor(h,d,T,Y,y){var C;(C=y[0]).config||(C.config={}),y[0].config.useMatrixPerComponent=!0,y[0].config.preventIntegerFloatArithmetic=!0;let n=-1;return Object.keys(h.values||{}).find((d=>{var T;return void 0!==(null===(T=h.values)||void 0===T?void 0:T[d].type)&&(n=h.values[d].type,!0)})),-1!==n&&(y[0].config.type=Y.arrays.types[n].flowGraphType),y},validation:h=>h.values?oT(h):{valid:!0}},"math/div":kT("FlowGraphDivideBlock",["a","b"],!0),"math/rem":kT("FlowGraphModuloBlock",["a","b"]),"math/min":kT("FlowGraphMinBlock",["a","b"]),"math/max":kT("FlowGraphMaxBlock",["a","b"]),"math/clamp":kT("FlowGraphClampBlock",["a","b","c"]),"math/saturate":kT("FlowGraphSaturateBlock"),"math/mix":kT("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":kT("FlowGraphEqualityBlock",["a","b"]),"math/lt":kT("FlowGraphLessThanBlock",["a","b"]),"math/le":kT("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":kT("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":kT("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":kT("FlowGraphIsNaNBlock"),"math/isinf":kT("FlowGraphIsInfBlock"),"math/select":{gZ:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{gZ:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":kT("FlowGraphSinBlock"),"math/cos":kT("FlowGraphCosBlock"),"math/tan":kT("FlowGraphTanBlock"),"math/asin":kT("FlowGraphASinBlock"),"math/acos":kT("FlowGraphACosBlock"),"math/atan":kT("FlowGraphATanBlock"),"math/atan2":kT("FlowGraphATan2Block",["a","b"]),"math/sinh":kT("FlowGraphSinhBlock"),"math/cosh":kT("FlowGraphCoshBlock"),"math/tanh":kT("FlowGraphTanhBlock"),"math/asinh":kT("FlowGraphASinhBlock"),"math/acosh":kT("FlowGraphACoshBlock"),"math/atanh":kT("FlowGraphATanhBlock"),"math/exp":kT("FlowGraphExponentialBlock"),"math/log":kT("FlowGraphLogBlock"),"math/log2":kT("FlowGraphLog2Block"),"math/log10":kT("FlowGraphLog10Block"),"math/sqrt":kT("FlowGraphSquareRootBlock"),"math/cbrt":kT("FlowGraphCubeRootBlock"),"math/pow":kT("FlowGraphPowerBlock",["a","b"]),"math/length":kT("FlowGraphLengthBlock"),"math/normalize":kT("FlowGraphNormalizeBlock"),"math/dot":kT("FlowGraphDotBlock",["a","b"]),"math/cross":kT("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":kT("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":kT("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{gZ:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{gZ:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{gZ:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{gZ:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{gZ:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{gZ:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{gZ:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":kT("FlowGraphTransposeBlock"),"math/determinant":kT("FlowGraphDeterminantBlock"),"math/inverse":kT("FlowGraphInvertMatrixBlock"),"math/matmul":kT("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{gZ:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"py",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,T,Y,y,C){const n=y[0].dataInputs.find((h=>"rotationQuaternion"===h.name));if(!n)throw new Error("Rotation quaternion input not found");return C._connectionValues[n.uniqueId]&&(C._connectionValues[n.uniqueId].type="Quaternion"),y}},"math/matDecompose":{gZ:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"py"}}}},"math/quatConjugate":kT("FlowGraphConjugateBlock",["a"]),"math/quatMul":{gZ:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,T,Y,y){var C;return(C=y[0]).config||(C.config={}),y[0].config.type="Quaternion",y}},"math/quatAngleBetween":kT("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{gZ:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":kT("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":kT("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{gZ:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,T,Y,y){var C;return(C=y[0]).config||(C.config={}),y[0].config.inputIsColumnMajor=!0,y}},"math/extract2x2":{gZ:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{gZ:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,T,Y,y){var C;return(C=y[0]).config||(C.config={}),y[0].config.inputIsColumnMajor=!0,y}},"math/extract3x3":{gZ:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{gZ:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,T,Y,y){var C;return(C=y[0]).config||(C.config={}),y[0].config.inputIsColumnMajor=!0,y}},"math/extract4x4":{gZ:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{gZ:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,T,Y,y,C){var n,X;(X=y[0]).config||(X.config={});const F=y[0].dataInputs[0];return y[0].config.valueType=(null===(n=C._connectionValues[F.uniqueId])||void 0===n?void 0:n.type)??"FlowGraphInteger",y}},"math/and":{gZ:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,T,Y,y,C){var n,X,F;(F=y[0]).config||(F.config={});const U=y[0].dataInputs[0],Z=y[0].dataInputs[1];return y[0].config.valueType=(null===(n=C._connectionValues[U.uniqueId])||void 0===n?void 0:n.type)??(null===(X=C._connectionValues[Z.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",y}},"math/or":{gZ:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,T,Y,y,C){var n,X,F;(F=y[0]).config||(F.config={});const U=y[0].dataInputs[0],Z=y[0].dataInputs[1];return y[0].config.valueType=(null===(n=C._connectionValues[U.uniqueId])||void 0===n?void 0:n.type)??(null===(X=C._connectionValues[Z.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",y}},"math/xor":{gZ:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(h,d,T,Y,y,C){var n,X,F;(F=y[0]).config||(F.config={});const U=y[0].dataInputs[0],Z=y[0].dataInputs[1];return y[0].config.valueType=(null===(n=C._connectionValues[U.uniqueId])||void 0===n?void 0:n.type)??(null===(X=C._connectionValues[Z.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",y}},"math/asr":kT("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":kT("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":kT("FlowGraphLeadingZerosBlock"),"math/ctz":kT("FlowGraphTrailingZerosBlock"),"math/popcnt":kT("FlowGraphOneBitsCounterBlock"),"math/rad":kT("FlowGraphDegToRadBlock"),"math/deg":kT("FlowGraphRadToDegBlock"),"type/boolToInt":kT("FlowGraphBooleanToInt"),"type/boolToFloat":kT("FlowGraphBooleanToFloat"),"type/intToBool":kT("FlowGraphIntToBoolean"),"type/intToFloat":kT("FlowGraphIntToFloat"),"type/floatToInt":kT("FlowGraphFloatToInt"),"type/floatToBool":kT("FlowGraphFloatToBoolean"),"flow/sequence":{gZ:["FlowGraphSequenceBlock"],extraProcessor(h,d,T,Y,y){const C=y[0];return C.config||(C.config={}),C.config.outputSignalCount=Object.keys(h.flows||[]).length,C.signalOutputs.forEach(((h,d)=>{h.name="out_"+d})),y}},"flow/branch":{gZ:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{gZ:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(h){if(h.configuration&&h.configuration.cases){const d=h.configuration.cases.value;if(!d.every((h=>"number"===typeof h&&/^-?\d+$/.test(h.toString()))))return f.c.Warn("Switch cases should be integers. Using empty array instead."),h.configuration.cases.value=[],{valid:!0};const T=new Set(d);h.configuration.cases.value=Array.from(T)}return{valid:!0}},extraProcessor(h,d,T,Y,y){if("flow/switch"!==d.op||!h.flows||0===Object.keys(h.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return y[0].signalOutputs.forEach((h=>{"default"!==h.name&&(h.name="out_"+h.name)})),y}},"flow/while":{gZ:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{gZ:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(h,d,T,Y,y){const C=y[0];return C.config||(C.config={}),C.config.incrementIndexWhenLoopDone=!0,y}},"flow/doN":{gZ:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{gZ:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(h,d,T,Y,y){if("flow/multiGate"!==d.op||!h.flows||0===Object.keys(h.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const C=y[0];return C.config||(C.config={}),C.config.outputSignalCount=Object.keys(h.flows).length,C.signalOutputs.forEach(((h,d)=>{h.name="out_"+d})),y}},"flow/waitAll":{gZ:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(h){var d,T;return"number"!==typeof(null===(d=h.configuration)||void 0===d||null===(T=d.inputFlows)||void 0===T?void 0:T.value[0])&&(h.configuration=h.configuration||{inputFlows:{value:[0]}},h.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{gZ:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{gZ:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{gZ:["FlowGraphCancelDelayBlock"]},"variable/get":{gZ:["FlowGraphGetVariableBlock"],validation(h){var d,T;return null!==(d=h.configuration)&&void 0!==d&&null!==(T=d.variable)&&void 0!==T&&T.value?{valid:!0}:(f.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(h,d)=>[d.getVariableName(h[0])]}}},"variable/set":{gZ:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(h,d)=>[d.getVariableName(h[0])]}}},"variable/setMultiple":{gZ:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(h,d)=>[h[0].map((h=>d.getVariableName(h)))]}},extraProcessor:(h,d,T,Y,y)=>(y[0].dataInputs.forEach((h=>{h.name=Y.getVariableName(+h.name)})),y)},"variable/interpolate":{gZ:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(h,d)=>[d.getVariableName(h[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:h=>!0===h[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",AT:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",AT:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",AT:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",AT:"FlowGraphPlayAnimationBlock"},out:{name:"out",AT:"FlowGraphPlayAnimationBlock"},done:{name:"done",AT:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(h,d,T,Y,y){var C,n,X;const F=y[0],U=null===(C=h.configuration)||void 0===C?void 0:C.variable.value[0];if("number"!==typeof U)throw f.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const Z=Y.arrays.staticVariables[U];"undefined"===typeof F.config.animationType.value&&(Y.arrays.staticVariables,F.config.animationType.value=(0,DT.F)(Z.type));const S=y[4];return S.config||(S.config={}),(n=S.config).variable||(n.variable={}),S.config.variable.value=Y.getVariableName(U),(X=y[3]).config||(X.config={}),y}},"pointer/get":{gZ:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",AT:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",AT:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(h,d,T,Y,y)=>(y.forEach((h=>{"FlowGraphJsonPointerParserBlock"===h.className&&(h.config||(h.config={}),h.config.outputValue=!0)})),y)},"pointer/set":{gZ:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",AT:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",AT:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(h,d,T,Y,y)=>(y.forEach((h=>{"FlowGraphJsonPointerParserBlock"===h.className&&(h.config||(h.config={}),h.config.outputValue=!0)})),y)},"pointer/interpolate":{gZ:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",AT:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",AT:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",AT:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",AT:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",AT:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",AT:"FlowGraphPlayAnimationBlock"},out:{name:"out",AT:"FlowGraphPlayAnimationBlock"},done:{name:"done",AT:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(h,d,T,Y,y)=>(y.forEach((d=>{"FlowGraphJsonPointerParserBlock"===d.className?(d.config||(d.config={}),d.config.outputValue=!0):"FlowGraphInterpolationBlock"===d.className&&(d.config||(d.config={}),Object.keys(h.values||[]).forEach((T=>{var y;const C=null===(y=h.values)||void 0===y?void 0:y[T];if("value"===T&&C){const h=C.type;void 0!==h&&(d.config.animationType=Y.arrays.types[h].flowGraphType)}})))})),y)},"animation/start":{gZ:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",AT:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(h,d)=>[h[0]*d._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(h,d)=>[h[0]*d._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(h,d,T,Y,y,C,n){const X=y[y.length-1];return X.config||(X.config={}),X.config.glTF=n,y}},"animation/stop":{gZ:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",AT:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(h,d,T,Y,y,C,n){const X=y[y.length-1];return X.config||(X.config={}),X.config.glTF=n,y}},"animation/stopAt":{gZ:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",AT:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(h,d)=>[h[0]*d._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(h,d,T,Y,y,C,n){const X=y[y.length-1];return X.config||(X.config={}),X.config.glTF=n,y}},"math/switch":{gZ:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(h){if(h.configuration&&h.configuration.cases){const d=h.configuration.cases.value;if(!d.every((h=>"number"===typeof h&&/^-?\d+$/.test(h.toString()))))return f.c.Warn("Switch cases should be integers. Using empty array instead."),h.configuration.cases.value=[],{valid:!0};const T=new Set(d);h.configuration.cases.value=Array.from(T)}return{valid:!0}},extraProcessor(h,d,T,Y,y){const C=y[0];return C.dataInputs.forEach((h=>{"default"!==h.name&&"case"!==h.name&&(h.name="in_"+h.name)})),C.config||(C.config={}),C.config.treatCasesAsIntegers=!0,y}},"debug/log":{gZ:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function kT(h){let d=arguments.length>2?arguments[2]:void 0;return{gZ:[h],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((h,d)=>(h[d]={name:d},h)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(h,T,Y,y,C){var n;if(d){(n=C[0]).config||(n.config={}),C[0].config.preventIntegerFloatArithmetic=!0;let d=-1;Object.keys(h.values||{}).find((T=>{var Y;return void 0!==(null===(Y=h.values)||void 0===Y?void 0:Y[T].type)&&(d=h.values[T].type,!0)})),-1!==d&&(C[0].config.type=y.arrays.types[d].flowGraphType)}return C},validation:h=>d?oT(h):{valid:!0}}}function oT(h){if(h.values){const d=Object.keys(h.values).map((d=>h.values[d].type)).filter((h=>void 0!==h));if(!d.every((h=>h===d[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}pT["math/compose"]=pT["math/matCompose"],pT["math/decompose"]=pT["math/matDecompose"];var uT=T(12722);const NT={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"pd",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class KT{constructor(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=h,this._gltf=d,this._animationTargetFps=T,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const h of this._interactivityGraph.types)this._types.push(NT[h.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const h of this._interactivityGraph.declarations){const d=xT(h);if(!d)throw f.c.Error(["No mapping found for declaration",h]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:d,fullOperationName:h.extension?h.op+":"+h.extension:h.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const h of this._interactivityGraph.variables){const d=this._parseVariable(h);this._staticVariables.push(d)}}_parseVariable(h,d){const T=this._types[h.type];if(!T)throw f.c.Error(["No type found for variable",h]),new Error("Error parsing variables");if(h.value&&h.value.length!==T.length)throw f.c.Error(["Invalid value length for variable",h,T]),new Error("Error parsing variables");const Y=h.value||[];if(!Y.length)switch(T.flowGraphType){case"boolean":Y.push(!1);break;case"FlowGraphInteger":Y.push(0);break;case"number":Y.push(NaN);break;case"Vector2":Y.push(NaN,NaN);break;case"pd":Y.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":Y.fill(NaN,0,4);break;case"Matrix":Y.fill(NaN,0,16);break;case"Matrix3D":Y.fill(NaN,0,9)}return"number"===T.elementType&&"string"===typeof Y[0]&&(Y[0]=parseFloat(Y[0])),{type:T.flowGraphType,value:d?d(Y,this):Y}}_parseEvents(){if(this._interactivityGraph.events)for(const h of this._interactivityGraph.events){const d={eventId:h.id||"internalEvent_"+this._internalEventsCounter++};h.values&&(d.eventData=Object.keys(h.values).map((d=>{var T;const Y=null===(T=h.values)||void 0===T?void 0:T[d];if(!Y)throw f.c.Error(["No value found for event key",d]),new Error("Error parsing events");const y=this._types[Y.type];if(!y)throw f.c.Error(["No type found for event value",Y]),new Error("Error parsing events");const C="undefined"!==typeof Y.value?this._parseVariable(Y):void 0;return{id:d,type:y.flowGraphType,eventData:!0,value:C}}))),this._events.push(d)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const d of this._interactivityGraph.nodes){if("number"!==typeof d.declaration)throw f.c.Error(["No declaration found for node",d]),new Error("Error parsing nodes");const T=this._mappings[d.declaration];if(!T)throw f.c.Error(["No mapping found for node",d]),new Error("Error parsing nodes");if(T.flowGraphMapping.validation){const Y=T.flowGraphMapping.validation(d,this._interactivityGraph,this._gltf);var h;if(!Y.valid)throw new Error(`Error validating interactivity node ${null===(h=this._interactivityGraph.declarations)||void 0===h?void 0:h[d.declaration].op} - ${Y.error}`)}const Y=[];for(const h of T.flowGraphMapping.gZ){const y=this._getEmptyBlock(h,T.fullOperationName);this._parseNodeConfiguration(d,y,T.flowGraphMapping,h),Y.push(y)}this._nodes.push({gZ:Y,fullOperationName:T.fullOperationName})}}_getEmptyBlock(h,d){return{uniqueId:(0,uT.b)(),className:h,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:d,metadata:{}}}_parseNodeConfiguration(h,d,T,Y){const y=d.config;if(h.configuration){const d=Object.keys(h.configuration);for(const X of d){var C,n;const d=null===(C=h.configuration)||void 0===C?void 0:C[X];if(!d)throw f.c.Error(["No value found for node configuration",X]),new Error("Error parsing node configuration");const F=null===(n=T.configuration)||void 0===n?void 0:n[X];if(F&&F.AT?F.AT===Y:0===T.gZ.indexOf(Y)){const h=(null===F||void 0===F?void 0:F.name)||X;d&&"undefined"!==typeof d.value||"undefined"===typeof(null===F||void 0===F?void 0:F.defaultValue)?d.value.length>=0?y[h]={value:1===d.value.length?d.value[0]:d.value}:f.c.Warn(["Invalid value for node configuration",d]):y[h]={value:F.defaultValue},F&&F.dataTransformer&&(y[h].value=F.dataTransformer([y[h].value],this)[0])}}}}_parseNodeConnections(h){for(let w=0;w<this._nodes.length;w++){var d;const s=null===(d=this._interactivityGraph.nodes)||void 0===d?void 0:d[w];if(!s)throw f.c.Error(["No node found for interactivity node",this._nodes[w]]),new Error("Error parsing node connections");const E=this._nodes[w],z=this._mappings[s.declaration];if(!z)throw f.c.Error(["No mapping found for node",s]),new Error("Error parsing node connections");const x=s.flows||{},g=Object.keys(x).sort();for(const h of g){var T,Y,y,C;const d=x[h],U=null===(T=z.flowGraphMapping.outputs)||void 0===T||null===(Y=T.flows)||void 0===Y?void 0:Y[h],Z=(null===U||void 0===U?void 0:U.name)||h,S=this._createNewSocketConnection(Z,!0);(U&&U.AT&&E.gZ.find((h=>h.className===U.AT))||E.gZ[0]).signalOutputs.push(S);const r=d.node,c=this._nodes[r];if(!c)throw f.c.Error(["No node found for input node id",r]),new Error("Error parsing node connections");const O=zT(c.fullOperationName);if(!O)throw f.c.Error(["No mapping found for input node",c]),new Error("Error parsing node connections");let J=null===(y=O.inputs)||void 0===y||null===(C=y.flows)||void 0===C?void 0:C[d.socket||"in"],W=!1;if(!J)for(const h in null===(n=O.inputs)||void 0===n?void 0:n.flows){var n,X,F;if(h.startsWith("[")&&h.endsWith("]"))W=!0,J=null===(X=O.inputs)||void 0===X||null===(F=X.flows)||void 0===F?void 0:F[h]}const L=J?W?J.name.replace("$1",d.socket||""):J.name:d.socket||"in",D=J&&J.AT&&c.gZ.find((h=>h.className===J.AT))||c.gZ[0];let V=D.signalInputs.find((h=>h.name===L));V||(V=this._createNewSocketConnection(L),D.signalInputs.push(V)),V.connectedPointIds.push(S.uniqueId),S.connectedPointIds.push(V.uniqueId)}const H=s.values||{},p=Object.keys(H);for(const d of p){var U,Z;const T=H[d];let Y=null===(U=z.flowGraphMapping.inputs)||void 0===U||null===(Z=U.values)||void 0===Z?void 0:Z[d],y=!1;if(!Y)for(const h in null===(S=z.flowGraphMapping.inputs)||void 0===S?void 0:S.values){var S,r,c;if(h.startsWith("[")&&h.endsWith("]"))y=!0,Y=null===(r=z.flowGraphMapping.inputs)||void 0===r||null===(c=r.values)||void 0===c?void 0:c[h]}const C=Y?y?Y.name.replace("$1",d):Y.name:d,n=this._createNewSocketConnection(C);if((Y&&Y.AT&&E.gZ.find((h=>h.className===Y.AT))||E.gZ[0]).dataInputs.push(n),void 0!==T.value){const d=this._parseVariable(T,Y&&Y.dataTransformer);h._connectionValues[n.uniqueId]=d}else{if("undefined"===typeof T.node)throw f.c.Error(["Invalid value for value connection",T]),new Error("Error parsing node connections");{var O,J,W;const h=T.node,d=T.socket||"value",Y=this._nodes[h];if(!Y)throw f.c.Error(["No node found for output socket reference",T]),new Error("Error parsing node connections");const y=zT(Y.fullOperationName);if(!y)throw f.c.Error(["No mapping found for output socket reference",T]),new Error("Error parsing node connections");let C=null===(O=y.outputs)||void 0===O||null===(J=O.values)||void 0===J?void 0:J[d],X=!1;if(!C)for(const T in null===(L=y.outputs)||void 0===L?void 0:L.values){var L,D,V;if(T.startsWith("[")&&T.endsWith("]"))X=!0,C=null===(D=y.outputs)||void 0===D||null===(V=D.values)||void 0===V?void 0:V[T]}const F=C?X?C.name.replace("$1",d):null===(W=C)||void 0===W?void 0:W.name:d,U=C&&C.AT&&Y.gZ.find((h=>h.className===C.AT))||Y.gZ[0];let Z=U.dataOutputs.find((h=>h.name===F));Z||(Z=this._createNewSocketConnection(F,!0),U.dataOutputs.push(Z)),n.connectedPointIds.push(Z.uniqueId),Z.connectedPointIds.push(n.uniqueId)}}}if(z.flowGraphMapping.interBlockConnectors)for(const h of z.flowGraphMapping.interBlockConnectors){const d=h.input,T=h.output,Y=h.isVariable;this._connectFlowGraphNodes(d,T,E.gZ[h.inputBlockIndex],E.gZ[h.outputBlockIndex],Y)}if(z.flowGraphMapping.extraProcessor){var i;const d=null===(i=this._interactivityGraph.declarations)||void 0===i?void 0:i[s.declaration];if(!d)throw f.c.Error(["No declaration found for extra processor",s]),new Error("Error parsing node connections");E.gZ=z.flowGraphMapping.extraProcessor(s,d,z.flowGraphMapping,this,E.gZ,h,this._gltf)}}}_createNewSocketConnection(h,d){return{uniqueId:(0,uT.b)(),name:h,_connectionType:d?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(h,d,T,Y,y){const C=y?T.dataInputs:T.signalInputs,n=y?Y.dataOutputs:Y.signalOutputs,X=C.find((d=>d.name===h))||this._createNewSocketConnection(h),F=n.find((h=>h.name===d))||this._createNewSocketConnection(d,!0);C.find((d=>d.name===h))||C.push(X),n.find((h=>h.name===d))||n.push(F),X.connectedPointIds.push(F.uniqueId),F.connectedPointIds.push(X.uniqueId)}getVariableName(h){return"staticVariable_"+h}serializeToFlowGraph(){const h={uniqueId:(0,uT.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(h);for(let d=0;d<this._staticVariables.length;d++){const T=this._staticVariables[d];h._userVariables[this.getVariableName(d)]=T}return{rightHanded:!0,allBlocks:this._nodes.reduce(((h,d)=>h.concat(d.gZ)),[]),executionContexts:[h]}}}const lT="KHR_interactivity";class qT{constructor(h){this._loader=h,this.name=lT,this.enabled=this._loader.isExtensionUsed(lT),this._pathConverter=(0,j.l)(this._loader.ud),h._skipStartAnimationStep=!0;const d=h.babylonScene;d&&function(h){(0,j.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!h.activeCamera)return new y.Quaternion(NaN,NaN,NaN,NaN);const d=y.Quaternion.FromRotationMatrix(h.activeCamera.getWorldMatrix()).normalize();return h.useRightHandedSystem||(d.w*=-1,d.x*=-1),d},type:"Quaternion",getTarget:()=>h.activeCamera}),(0,j.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!h.activeCamera)return new y.pd(NaN,NaN,NaN);const d=h.activeCamera.getWorldMatrix().getTranslation();return h.useRightHandedSystem||(d.x*=-1),d},type:"pd",getTarget:()=>h.activeCamera}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:h=>{var d;return(null===(d=h._babylonAnimationGroup)||void 0===d?void 0:d.isPlaying)??!1},type:"boolean",getTarget:h=>h._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:h=>{var d;return((null===(d=h._babylonAnimationGroup)||void 0===d?void 0:d.from)??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:h=>{var d;return((null===(d=h._babylonAnimationGroup)||void 0===d?void 0:d.to)??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:h=>{var d;return((null===(d=h._babylonAnimationGroup)||void 0===d?void 0:d.getCurrentFrame())??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:h=>{var d;return((null===(d=h._babylonAnimationGroup)||void 0===d?void 0:d.getCurrentFrame())??0)/60},type:"number",getTarget:h=>h._babylonAnimationGroup})}(d)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var h;if(!this._loader.babylonScene||!this._pathConverter)return;const d=this._loader.babylonScene,T=null===(h=this._loader.ud.extensions)||void 0===h?void 0:h.KHR_interactivity;if(!T)return;const Y=new OT.c({qd:d});Y.dispatchEventsSynchronously=!1;const y=T.graphs.map((h=>new KT(h,this._loader.ud,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(y.map((async h=>await wT(h,{coordinator:Y,pathConverter:this._pathConverter})))),Y.start()}}var jT;jT=async()=>(await Promise.resolve().then(T.bind(T,14581))).FlowGraphGLTFDataProvider,fT[`${lT}/${"FlowGraphGLTFDataProvider"}`]=jT,q(lT),l(lT,!0,(h=>new qT(h)));const aT="KHR_node_visibility";(0,j.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:h=>{const d=h._babylonTransformNode;return!d||void 0===d.isVisible||d.isVisible},set:(h,d)=>{var T,Y;null===(T=d._primitiveBabylonMeshes)||void 0===T||T.forEach((h=>{h.inheritVisibility=!0})),d._babylonTransformNode&&(d._babylonTransformNode.isVisible=h),null===(Y=d._primitiveBabylonMeshes)||void 0===Y||Y.forEach((d=>{d.isVisible=h}))},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class eT{constructor(h){this.name=aT,this._loader=h,this.enabled=h.isExtensionUsed(aT)}async onReady(){var h;null===(h=this._loader.ud.nodes)||void 0===h||h.forEach((h=>{var d,T,Y,y;(null===(d=h._primitiveBabylonMeshes)||void 0===d||d.forEach((h=>{h.inheritVisibility=!0})),null!==(T=h.extensions)&&void 0!==T&&T.KHR_node_visibility)&&(!1===(null===(Y=h.extensions)||void 0===Y?void 0:Y.KHR_node_visibility.visible)&&(h._babylonTransformNode&&(h._babylonTransformNode.isVisible=!1),null===(y=h._primitiveBabylonMeshes)||void 0===y||y.forEach((h=>{h.isVisible=!1}))))}))}dispose(){this._loader=null}}q(aT),l(aT,!0,(h=>new eT(h)));const vT="KHR_node_selectability";gT("event/onSelect",vT,{gZ:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",AT:"FlowGraphGetVariableBlock",dataTransformer:h=>["pickedMesh_"+h[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",AT:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(h,d,T,Y,y,C,n){var X,F,U,Z,S,r;const c=y[y.length-1];c.config=c.config||{},c.config.glTF=n;const O=null===(X=h.configuration)||void 0===X||null===(F=X.nodeIndex)||void 0===F?void 0:F.value[0];if(void 0===O||"number"!==typeof O)throw new Error("nodeIndex not found in configuration");const f="pickedMesh_"+O;return y[1].config.variable=f,C._userVariables[f]={className:"Mesh",id:null===n||void 0===n||null===(U=n.nodes)||void 0===U||null===(Z=U[O]._babylonTransformNode)||void 0===Z?void 0:Z.id,uniqueId:null===n||void 0===n||null===(S=n.nodes)||void 0===S||null===(r=S[O]._babylonTransformNode)||void 0===r?void 0:r.uniqueId},y}}),(0,j.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:h=>{const d=h._babylonTransformNode;return!d||void 0===d.PF||d.PF},set:(h,d)=>{var T;null===(T=d._primitiveBabylonMeshes)||void 0===T||T.forEach((d=>{d.PF=h}))},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"PF"],type:"boolean"});class GT{constructor(h){this.name=vT,this._loader=h,this.enabled=h.isExtensionUsed(vT)}async onReady(){var h;null===(h=this._loader.ud.nodes)||void 0===h||h.forEach((h=>{var d,T,Y;null!==(d=h.extensions)&&void 0!==d&&d.KHR_node_selectability&&!1===(null===(T=h.extensions)||void 0===T?void 0:T.KHR_node_selectability.selectable)&&(null===(Y=h._babylonTransformNode)||void 0===Y||Y.getChildMeshes().forEach((h=>{h.PF=!1})))}))}dispose(){this._loader=null}}q(vT),l(vT,!0,(h=>new GT(h)));const bT="KHR_node_hoverability",BT="targetMeshPointerOver_";gT("event/onHoverIn",bT,{gZ:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",AT:"FlowGraphGetVariableBlock",dataTransformer:h=>[BT+h[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",AT:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(h,d,T,Y,y,C,n){var X,F,U,Z,S,r;const c=y[y.length-1];c.config=c.config||{},c.config.glTF=n;const O=null===(X=h.configuration)||void 0===X||null===(F=X.nodeIndex)||void 0===F?void 0:F.value[0];if(void 0===O||"number"!==typeof O)throw new Error("nodeIndex not found in configuration");const f=BT+O;return y[1].config.variable=f,C._userVariables[f]={className:"Mesh",id:null===n||void 0===n||null===(U=n.nodes)||void 0===U||null===(Z=U[O]._babylonTransformNode)||void 0===Z?void 0:Z.id,uniqueId:null===n||void 0===n||null===(S=n.nodes)||void 0===S||null===(r=S[O]._babylonTransformNode)||void 0===r?void 0:r.uniqueId},y}});const MT="targetMeshPointerOut_";gT("event/onHoverOut",bT,{gZ:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",AT:"FlowGraphGetVariableBlock",dataTransformer:h=>[MT+h[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",AT:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(h,d,T,Y,y,C,n){var X,F,U,Z,S,r;const c=y[y.length-1];c.config=c.config||{},c.config.glTF=n;const O=null===(X=h.configuration)||void 0===X||null===(F=X.nodeIndex)||void 0===F?void 0:F.value[0];if(void 0===O||"number"!==typeof O)throw new Error("nodeIndex not found in configuration");const f=MT+O;return y[1].config.variable=f,C._userVariables[f]={className:"Mesh",id:null===n||void 0===n||null===(U=n.nodes)||void 0===U||null===(Z=U[O]._babylonTransformNode)||void 0===Z?void 0:Z.id,uniqueId:null===n||void 0===n||null===(S=n.nodes)||void 0===S||null===(r=S[O]._babylonTransformNode)||void 0===r?void 0:r.uniqueId},y}}),(0,j.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:h=>{const d=h._babylonTransformNode;return!d||void 0===d.pointerOverDisableMeshTesting||d.pointerOverDisableMeshTesting},set:(h,d)=>{var T;null===(T=d._primitiveBabylonMeshes)||void 0===T||T.forEach((d=>{d.pointerOverDisableMeshTesting=!h}))},getTarget:h=>h._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class mY{constructor(h){this.name=bT,this._loader=h,this.enabled=h.isExtensionUsed(bT)}async onReady(){var h;null===(h=this._loader.ud.nodes)||void 0===h||h.forEach((h=>{var d,T,Y;null!==(d=h.extensions)&&void 0!==d&&d.KHR_node_hoverability&&!1===(null===(T=h.extensions)||void 0===T?void 0:T.KHR_node_hoverability.hoverable)&&(null===(Y=h._babylonTransformNode)||void 0===Y||Y.getChildMeshes().forEach((h=>{h.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}q(bT),l(bT,!0,(h=>new mY(h)));const RT="ExtrasAsMetadata";class QT{_assignExtras(h,d){if(d.extras&&Object.keys(d.extras).length>0){const T=h.metadata=h.metadata||{};(T.ud=T.ud||{}).extras=d.extras}}constructor(h){this.name=RT,this.enabled=!0,this._loader=h}dispose(){this._loader=null}loadNodeAsync(h,d,T){return this._loader.loadNodeAsync(h,d,(h=>{this._assignExtras(h,d),T(h)}))}loadCameraAsync(h,d,T){return this._loader.loadCameraAsync(h,d,(h=>{this._assignExtras(h,d),T(h)}))}createMaterial(h,d,T){const Y=this._loader.createMaterial(h,d,T);return this._assignExtras(Y,d),Y}}q(RT),l(RT,!1,(h=>new QT(h)));T(14581)},14460:(h,d,T)=>{"use strict";T.d(d,{c:()=>o,e:()=>z,i:()=>E,j:()=>x});var Y=T(12583),y=T(12574),C=T(14082),n=T(13213),X=T(13192),F=T(13198),U=T(12596),Z=T(12625),S=T(13211),r=T(13322),c=T(13222),O=T(12809);class f{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Fr=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Mr=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(h){this._environmentTexture=h}getNodes(){let h=[];h=h.concat(this.meshes),h=h.concat(this.lights),h=h.concat(this.cameras),h=h.concat(this.transformNodes);for(const d of this.skeletons)h=h.concat(d.bones);return h}}class J extends f{}class W{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const h=this.rootNodes;for(const Y of h)Y.dispose();h.length=0;const d=this.skeletons;for(const Y of d)Y.dispose();d.length=0;const T=this.animationGroups;for(const Y of T)Y.dispose();T.length=0}}class L extends f{constructor(h){super(),this._wasAddedToScene=!1,(h=h||Z.d.LastCreatedScene)&&(this.qd=h,this.proceduralTextures=[],h.zd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=h.getEngine().onContextRestoredObservable.add((()=>{for(const h of this.geometries)h._rebuild();for(const h of this.meshes)h._rebuild();for(const h of this.Fr)h.rebuild();for(const h of this.textures)h._rebuild()})))}_topologicalSort(h){const d=new Map;for(const n of h)d.set(n.uniqueId,n);const T={dependsOn:new Map,dependedBy:new Map};for(const n of h){const h=n.uniqueId;T.dependsOn.set(h,new Set),T.dependedBy.set(h,new Set)}for(const n of h){const h=n.uniqueId,Y=T.dependsOn.get(h);if(n instanceof S.e){const y=n.sourceMesh;d.has(y.uniqueId)&&(Y.add(y.uniqueId),T.dependedBy.get(y.uniqueId).add(h))}const y=T.dependedBy.get(h);for(const C of n.getDescendants()){const Y=C.uniqueId;if(d.has(Y)){y.add(Y);T.dependsOn.get(Y).add(h)}}}const Y=[],y=[];for(const n of h){const h=n.uniqueId;0===T.dependsOn.get(h).size&&(y.push(n),d.delete(h))}const C=y;for(;C.length>0;){const h=C.shift();Y.push(h);const y=T.dependedBy.get(h.uniqueId);for(const Y of Array.from(y.values())){const y=T.dependsOn.get(Y);y.delete(h.uniqueId),0===y.size&&d.get(Y)&&(C.push(d.get(Y)),d.delete(Y))}}return d.size>0&&(U.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),d.forEach((h=>{U.c.Error(h.name)}))),Y}_addNodeAndDescendantsToList(h,d,T,Y){if(T&&(!Y||Y(T))&&!d.has(T.uniqueId)){h.push(T),d.add(T.uniqueId);for(const y of T.getDescendants(!0))this._addNodeAndDescendantsToList(h,d,y,Y)}}_isNodeInContainer(h){return h instanceof F.b&&-1!==this.meshes.indexOf(h)||(h instanceof X.e&&-1!==this.transformNodes.indexOf(h)||(h instanceof r.d&&-1!==this.lights.indexOf(h)||h instanceof c.e&&-1!==this.cameras.indexOf(h)))}_isValidHierarchy(){for(const h of this.meshes)if(h.parent&&!this._isNodeInContainer(h.parent))return U.c.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;for(const h of this.transformNodes)if(h.parent&&!this._isNodeInContainer(h.parent))return U.c.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;for(const h of this.lights)if(h.parent&&!this._isNodeInContainer(h.parent))return U.c.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;for(const h of this.cameras)if(h.parent&&!this._isNodeInContainer(h.parent))return U.c.Warn(`Node ${h.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(h){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||y.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const Y={},C={},X=new W,F=[],U=[],Z={doNotInstantiate:!0,...T},S=[],r=new Set;for(const y of this.transformNodes)null===y.parent&&this._addNodeAndDescendantsToList(S,r,y,Z.predicate);for(const y of this.meshes)null===y.parent&&this._addNodeAndDescendantsToList(S,r,y,Z.predicate);const c=this._topologicalSort(S),O=(T,y)=>{if(((d,T)=>{if(Y[d.uniqueId]=T.uniqueId,C[T.uniqueId]=T,h&&(T.name=h(d.name)),T instanceof n.d){const h=T;if(h.morphTargetManager){const T=d.morphTargetManager;h.morphTargetManager=T.clone();for(let d=0;d<T.numTargets;d++){const y=T.getTarget(d),n=h.morphTargetManager.getTarget(d);Y[y.uniqueId]=n.uniqueId,C[n.uniqueId]=n}}}})(T,y),T.parent){const h=Y[T.parent.uniqueId],d=C[h];y.parent=d||T.parent}if(y.position&&T.position&&y.position.C(T.position),y.rotationQuaternion&&T.rotationQuaternion&&y.rotationQuaternion.C(T.rotationQuaternion),y.rotation&&T.rotation&&y.rotation.C(T.rotation),y.py&&T.py&&y.py.C(T.py),y.material){const n=y;if(n.material)if(d){const d=T.material;if(-1===U.indexOf(d)){let T=d.clone(h?h(d.name):"Clone of "+d.name);if(U.push(d),Y[d.uniqueId]=T.uniqueId,C[T.uniqueId]=T,"MultiMaterial"===d.getClassName()){const y=d;for(const d of y.en)d&&(T=d.clone(h?h(d.name):"Clone of "+d.name),U.push(d),Y[d.uniqueId]=T.uniqueId,C[T.uniqueId]=T);y.en=y.en.map((h=>h&&C[Y[h.uniqueId]]))}}"InstancedMesh"!==n.getClassName()&&(n.material=C[Y[d.uniqueId]])}else"MultiMaterial"===n.material.getClassName()?-1===this.qd.multiMaterials.indexOf(n.material)&&this.qd.addMultiMaterial(n.material):-1===this.qd.materials.indexOf(n.material)&&this.qd.addMaterial(n.material)}null===y.parent&&X.rootNodes.push(y)};for(const y of c)if("InstancedMesh"===y.getClassName()){const h=y,d=h.sourceMesh,T=Y[d.uniqueId];O(h,("number"===typeof T?C[T]:d).createInstance(h.name))}else{let h=!0;"dc"===y.getClassName()||"Node"===y.getClassName()||y.skeleton||!y.getTotalVertices||0===y.getTotalVertices()?h=!1:Z.doNotInstantiate&&(h="function"===typeof Z.doNotInstantiate?!Z.doNotInstantiate(y):!Z.doNotInstantiate);const d=h?y.createInstance(`instance of ${y.name}`):y.clone(`Clone of ${y.name}`,null,!0);if(!d)throw new Error(`Could not clone or instantiate node on Asset Container ${y.name}`);O(y,d)}for(const y of this.skeletons){if(Z.predicate&&!Z.predicate(y))continue;const d=y.clone(h?h(y.name):"Clone of "+y.name);for(const h of this.meshes)if(h.skeleton===y&&!h.isAnInstance){const T=C[Y[h.uniqueId]];if(!T||T.isAnInstance)continue;if(T.skeleton=d,-1!==F.indexOf(d))continue;F.push(d);for(const h of d.bones)h._linkedTransformNode&&(h._linkedTransformNode=C[Y[h._linkedTransformNode.uniqueId]])}X.skeletons.push(d)}for(const y of this.animationGroups){if(Z.predicate&&!Z.predicate(y))continue;const d=y.clone(h?h(y.name):"Clone of "+y.name,(h=>C[Y[h.uniqueId]]||h));X.animationGroups.push(d)}return X}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||y.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.qd.environmentTexture=this.environmentTexture);for(const h of this.qd._serializableComponents)h.addFromContainer(this);this.qd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const d=[];for(const T of this.cameras)h&&!h(T)||(this.qd.addCamera(T),d.push(T));for(const T of this.lights)h&&!h(T)||(this.qd.addLight(T),d.push(T));for(const T of this.meshes)h&&!h(T)||(this.qd.fZ(T),d.push(T));for(const T of this.skeletons)h&&!h(T)||this.qd.addSkeleton(T);for(const T of this.animations)h&&!h(T)||this.qd.addAnimation(T);for(const T of this.animationGroups)h&&!h(T)||this.qd.addAnimationGroup(T);for(const T of this.multiMaterials)h&&!h(T)||this.qd.addMultiMaterial(T);for(const T of this.materials)h&&!h(T)||this.qd.addMaterial(T);for(const T of this.morphTargetManagers)h&&!h(T)||this.qd.addMorphTargetManager(T);for(const T of this.geometries)h&&!h(T)||this.qd.addGeometry(T);for(const T of this.transformNodes)h&&!h(T)||(this.qd.addTransformNode(T),d.push(T));for(const T of this.actionManagers)h&&!h(T)||this.qd.addActionManager(T);for(const T of this.textures)h&&!h(T)||this.qd.addTexture(T);for(const T of this.reflectionProbes)h&&!h(T)||this.qd.addReflectionProbe(T);for(const T of d)T.parent&&-1===this.qd.getNodes().indexOf(T.parent)&&(T.setParent?T.setParent(null):T.parent=null)}removeAllFromScene(){this._isValidHierarchy()||y.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.qd.environmentTexture&&(this.qd.environmentTexture=null);for(const h of this.qd._serializableComponents)h.removeFromContainer(this)}removeFromScene(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const d of this.cameras)h&&!h(d)||this.qd.removeCamera(d);for(const d of this.lights)h&&!h(d)||this.qd.removeLight(d);for(const d of this.meshes)h&&!h(d)||this.qd.OZ(d,!0);for(const d of this.skeletons)h&&!h(d)||this.qd.removeSkeleton(d);for(const d of this.animations)h&&!h(d)||this.qd.removeAnimation(d);for(const d of this.animationGroups)h&&!h(d)||this.qd.removeAnimationGroup(d);for(const d of this.multiMaterials)h&&!h(d)||this.qd.removeMultiMaterial(d);for(const d of this.materials)h&&!h(d)||this.qd.removeMaterial(d);for(const d of this.morphTargetManagers)h&&!h(d)||this.qd.removeMorphTargetManager(d);for(const d of this.geometries)h&&!h(d)||this.qd.removeGeometry(d);for(const d of this.transformNodes)h&&!h(d)||this.qd.removeTransformNode(d);for(const d of this.actionManagers)h&&!h(d)||this.qd.removeActionManager(d);for(const d of this.textures)h&&!h(d)||this.qd.removeTexture(d);for(const d of this.reflectionProbes)h&&!h(d)||this.qd.removeReflectionProbe(d)}dispose(){const h=this.cameras.slice(0);for(const c of h)c.dispose();this.cameras.length=0;const d=this.lights.slice(0);for(const c of d)c.dispose();this.lights.length=0;const T=this.meshes.slice(0);for(const c of T)c.dispose();this.meshes.length=0;const Y=this.skeletons.slice(0);for(const c of Y)c.dispose();this.skeletons.length=0;const y=this.animationGroups.slice(0);for(const c of y)c.dispose();this.animationGroups.length=0;const C=this.multiMaterials.slice(0);for(const c of C)c.dispose();this.multiMaterials.length=0;const n=this.materials.slice(0);for(const c of n)c.dispose();this.materials.length=0;const X=this.geometries.slice(0);for(const c of X)c.dispose();this.geometries.length=0;const F=this.transformNodes.slice(0);for(const c of F)c.dispose();this.transformNodes.length=0;const U=this.actionManagers.slice(0);for(const c of U)c.dispose();this.actionManagers.length=0;const Z=this.textures.slice(0);for(const c of Z)c.dispose();this.textures.length=0;const S=this.reflectionProbes.slice(0);for(const c of S)c.dispose();this.reflectionProbes.length=0;const r=this.morphTargetManagers.slice(0);for(const c of r)c.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const c of this.qd._serializableComponents)c.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.qd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(h,d,T){if(h&&d)for(const Y of h){let h=!0;if(T)for(const d of T)if(Y===d){h=!1;break}h&&(d.push(Y),Y._parentContainer=this)}}moveAllFromScene(h){this._wasAddedToScene=!1,void 0===h&&(h=new J);for(const d in this)Object.prototype.hasOwnProperty.call(this,d)&&(this[d]=this[d]||("_environmentTexture"===d?null:[]),this._moveAssets(this.qd[d],this[d],h[d]));this.environmentTexture=this.qd.environmentTexture,this.removeAllFromScene()}createRootMesh(){const h=new n.d("assetContainerRootMesh",this.qd);for(const d of this.meshes)d.parent||h.addChild(d);return this.meshes.unshift(h),h}mergeAnimationsTo(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z.d.LastCreatedScene,d=arguments.length>1?arguments[1]:void 0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!h)return U.c.Error("No scene available to merge animations to"),[];const Y=T||(d=>{let T=null;const Y=d.animations.length?d.animations[0].targetProperty:"",y=d.name.split(".").join("").split("_primitive")[0];switch(Y){case"position":case"rotationQuaternion":T=h.getTransformNodeByName(d.name)||h.getTransformNodeByName(y);break;case"influence":T=h.getMorphTargetByName(d.name)||h.getMorphTargetByName(y);break;default:T=h.getNodeByName(d.name)||h.getNodeByName(y)}return T}),y=this.getNodes();for(const X of y){const h=Y(X);if(null!==h){for(const d of X.animations){const T=h.animations.filter((h=>h.targetProperty===d.targetProperty));for(const d of T){const T=h.animations.indexOf(d,0);T>-1&&h.animations.splice(T,1)}}h.animations=h.animations.concat(X.animations)}}const C=[],n=this.animationGroups.slice();for(const X of n){C.push(X.clone(X.name,Y));for(const h of X.animatables)h.stop()}for(const X of d){const d=Y(X.target);d&&(h.beginAnimation(d,X.fromFrame,X.toFrame,X.loopAnimation,X.speedRatio,X.onAnimationEnd?X.onAnimationEnd:void 0,void 0,!0,void 0,X.onAnimationLoop?X.onAnimationLoop:void 0),h.stopAnimation(X.target))}return C}populateRootNodes(){this.rootNodes.length=0;for(const h of this.meshes)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h);for(const h of this.transformNodes)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h);for(const h of this.lights)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h);for(const h of this.cameras)h.parent||-1!==this.rootNodes.indexOf(h)||this.rootNodes.push(h)}addAllAssetsToContainer(h){if(!h)return;const d=[],T=new Set;for(d.push(h);d.length>0;){const h=d.pop();if(h instanceof n.d?(h.Rd&&-1===this.geometries.indexOf(h.Rd)&&this.geometries.push(h.Rd),this.meshes.push(h)):h instanceof S.e?this.meshes.push(h):h instanceof X.e?this.transformNodes.push(h):h instanceof r.d?this.lights.push(h):h instanceof c.e&&this.cameras.push(h),h instanceof F.b){if(h.material&&-1===this.materials.indexOf(h.material)){this.materials.push(h.material);for(const d of h.material.getActiveTextures())-1===this.textures.indexOf(d)&&this.textures.push(d)}h.skeleton&&-1===this.skeletons.indexOf(h.skeleton)&&this.skeletons.push(h.skeleton),h.morphTargetManager&&-1===this.morphTargetManagers.indexOf(h.morphTargetManager)&&this.morphTargetManagers.push(h.morphTargetManager)}for(const Y of h.getChildren())T.has(Y)||d.push(Y);T.add(h)}this.populateRootNodes()}_getByTags(h,d,T){if(void 0===d)return h;const Y=[];for(const y in h){const C=h[y];O.e&&O.e.MatchesQuery(C,d)&&(!T||T(C))&&Y.push(C)}return Y}getMeshesByTags(h,d){return this._getByTags(this.meshes,h,d)}getCamerasByTags(h,d){return this._getByTags(this.cameras,h,d)}getLightsByTags(h,d){return this._getByTags(this.lights,h,d)}getMaterialsByTags(h,d){return this._getByTags(this.materials,h,d).concat(this._getByTags(this.multiMaterials,h,d))}getTransformNodesByTags(h,d){return this._getByTags(this.transformNodes,h,d)}}var D=T(12633);class V{constructor(h){this.byteOffset=0,this.buffer=h}async loadAsync(h){const d=await this.buffer.readAsync(this.byteOffset,h);this._dataView=new DataView(d.buffer,d.byteOffset,d.byteLength),this._dataByteOffset=0}readUint32(){const h=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,h}readUint8Array(h){const d=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,h);return this._dataByteOffset+=h,this.byteOffset+=h,d}readString(h){return(0,D.f)(this.readUint8Array(h))}skipBytes(h){this._dataByteOffset+=h,this.byteOffset+=h}}var i=T(14468);const w="Z2xURg",s={name:"ud",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:h=>-1!==h.indexOf("asset")&&-1!==h.indexOf("version")||h.startsWith("data:base64,"+w)||h.startsWith("data:;base64,"+w)||h.startsWith("data:application/octet-stream;base64,"+w)||h.startsWith("data:model/gltf-binary;base64,"+w)};var E,z,x,g=T(12627),H=T(12629);function p(h,d,T){try{return Promise.resolve(new Uint8Array(h,d,T))}catch(Y){return Promise.reject(Y)}}!function(h){h[h.AUTO=0]="AUTO",h[h.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(E||(E={})),function(h){h[h.NONE=0]="NONE",h[h.FIRST=1]="FIRST",h[h.ALL=2]="ALL"}(z||(z={})),function(h){h[h.LOADING=0]="LOADING",h[h.READY=1]="READY",h[h.COMPLETE=2]="COMPLETE"}(x||(x={}));class k{constructor(){this.coordinateSystemMode=E.AUTO,this.animationStartMode=z.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=h=>Promise.resolve(h),this.extensionOptions={}}C(h){h&&(this.onParsed=h.onParsed,this.coordinateSystemMode=h.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=h.animationStartMode??this.animationStartMode,this.loadNodeAnimations=h.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=h.loadSkins??this.loadSkins,this.loadMorphTargets=h.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=h.compileMaterials??this.compileMaterials,this.useClipPlane=h.useClipPlane??this.useClipPlane,this.compileShadowGenerators=h.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=h.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=h.useRangeRequests??this.useRangeRequests,this.createInstances=h.createInstances??this.createInstances,this.alwaysComputeBoundingBox=h.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=h.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=h.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=h.skipMaterials??this.skipMaterials,this.useSRGBBuffers=h.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=h.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=h.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=h.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=h.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=h.customRootNode,this.onMeshLoaded=h.onMeshLoaded,this.onSkinLoaded=h.onSkinLoaded,this.onTextureLoaded=h.onTextureLoaded,this.onMaterialLoaded=h.onMaterialLoaded,this.onCameraLoaded=h.onCameraLoaded,this.extensionOptions=h.extensionOptions??this.extensionOptions)}}class o extends k{constructor(h){super(),this.onParsedObservable=new Y.e,this.onMeshLoadedObservable=new Y.e,this.onSkinLoadedObservable=new Y.e,this.onTextureLoadedObservable=new Y.e,this.onMaterialLoadedObservable=new Y.e,this.onCameraLoadedObservable=new Y.e,this.onCompleteObservable=new Y.e,this.onErrorObservable=new Y.e,this.zd=new Y.e,this.onExtensionLoadedObservable=new Y.e,this.validate=!1,this.onValidatedObservable=new Y.e,this._loader=null,this._state=null,this._requests=new Array,this.name=s.name,this.extensions=s.extensions,this.onLoaderStateChangedObservable=new Y.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.C(h)}set onParsed(h){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),h&&(this._onParsedObserver=this.onParsedObservable.add(h))}set onMeshLoaded(h){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),h&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(h))}set onSkinLoaded(h){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),h&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((d=>h(d.node,d.skinnedNode))))}set onTextureLoaded(h){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),h&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(h))}set onMaterialLoaded(h){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),h&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(h))}set onCameraLoaded(h){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),h&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(h))}set onComplete(h){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(h)}set onError(h){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(h)}set onDispose(h){this._onDisposeObserver&&this.zd.remove(this._onDisposeObserver),this._onDisposeObserver=this.zd.add(h)}set onExtensionLoaded(h){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(h)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(h){this._loggingEnabled!==h&&(this._loggingEnabled=h,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(h){this._capturePerformanceCounters!==h&&(this._capturePerformanceCounters=h,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(h){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(h)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const h of this._requests)h.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=h=>Promise.resolve(h),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.zd.notifyObservers(void 0),this.zd.clear()}loadFile(h,d,T,C,n,X,F,Z){if(ArrayBuffer.isView(d))return this._loadBinary(h,d,T,C,F,Z),null;this._progressCallback=n;const S=d.name||y.Tools.GetFilename(d);if(X){if(this.useRangeRequests){this.validate&&U.c.Warn("glTF validation is not supported when range requests are enabled");const T={abort:()=>{},onCompleteObservable:new Y.e},y={readAsync:(T,Y)=>new Promise(((y,C)=>{this._loadFile(h,d,(h=>{y(new Uint8Array(h))}),!0,(h=>{C(h)}),(h=>{h.setRequestHeader("Range",`bytes=${T}-${T+Y-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new V(y)).then((h=>{T.onCompleteObservable.notifyObservers(T),C(h)}),F?h=>F(void 0,h):void 0),T}return this._loadFile(h,d,(d=>{this._validate(h,new Uint8Array(d,0,d.byteLength),T,S),this._unpackBinaryAsync(new V({readAsync:(h,T)=>p(d,h,T),byteLength:d.byteLength})).then((h=>{C(h)}),F?h=>F(void 0,h):void 0)}),!0,F)}return this._loadFile(h,d,(d=>{try{this._validate(h,d,T,S),C({json:this._parseJson(d)})}catch{F&&F()}}),!1,F)}_loadBinary(h,d,T,Y,y,C){this._validate(h,new Uint8Array(d.buffer,d.byteOffset,d.byteLength),T,C),this._unpackBinaryAsync(new V({readAsync:(h,T)=>function(h,d,T){try{if(d<0||d>=h.byteLength)throw new RangeError("Offset is out of range.");if(d+T>h.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(h.buffer,h.byteOffset+d,T))}catch(Y){return Promise.reject(Y)}}(d,h,T),byteLength:d.byteLength})).then((h=>{Y(h)}),y?h=>y(void 0,h):void 0)}importMeshAsync(h,d,T,Y,y,C){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(T),this.onParsedObservable.clear(),this._log(`Loading ${C||""}`),this._loader=this._getLoader(T),this._loader.importMeshAsync(h,d,null,T,Y,y,C))))}loadAsync(h,d,T,Y,y){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(d),this.onParsedObservable.clear(),this._log(`Loading ${y||""}`),this._loader=this._getLoader(d),this._loader.loadAsync(h,d,T,Y,y))))}loadAssetContainerAsync(h,d,T,Y,y){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(d),this.onParsedObservable.clear(),this._log(`Loading ${y||""}`),this._loader=this._getLoader(d);const C=new L(h),n=[];this.onMaterialLoadedObservable.add((h=>{n.push(h)}));const X=[];this.onTextureLoadedObservable.add((h=>{X.push(h)}));const F=[];this.onCameraLoadedObservable.add((h=>{F.push(h)}));const U=[];return this.onMeshLoadedObservable.add((h=>{h.morphTargetManager&&U.push(h.morphTargetManager)})),this._loader.importMeshAsync(null,h,C,d,T,Y,y).then((h=>(Array.prototype.push.apply(C.geometries,h.geometries),Array.prototype.push.apply(C.meshes,h.meshes),Array.prototype.push.apply(C.Fr,h.Fr),Array.prototype.push.apply(C.skeletons,h.skeletons),Array.prototype.push.apply(C.animationGroups,h.animationGroups),Array.prototype.push.apply(C.materials,n),Array.prototype.push.apply(C.textures,X),Array.prototype.push.apply(C.lights,h.lights),Array.prototype.push.apply(C.transformNodes,h.transformNodes),Array.prototype.push.apply(C.cameras,F),Array.prototype.push.apply(C.morphTargetManagers,U),C)))}))}canDirectLoad(h){return s.canDirectLoad(h)}directLoad(h,d){if(d.startsWith("base64,"+w)||d.startsWith(";base64,"+w)||d.startsWith("application/octet-stream;base64,"+w)||d.startsWith("model/gltf-binary;base64,"+w)){const T=(0,g.d)(d);return this._validate(h,new Uint8Array(T,0,T.byteLength)),this._unpackBinaryAsync(new V({readAsync:(h,d)=>p(T,h,d),byteLength:T.byteLength}))}return this._validate(h,d),Promise.resolve({json:this._parseJson(d)})}createPlugin(h){return new o(h[s.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((h,d)=>{this.onCompleteObservable.addOnce((()=>{h()})),this.onErrorObservable.addOnce((h=>{d(h)}))}))}_setState(h){this._state!==h&&(this._state=h,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(x[this._state]))}_loadFile(h,d,T,Y,y,C){const n=h._loadFile(d,T,(h=>{this._onProgress(h,n)}),!0,Y,y,C);return n.onCompleteObservable.add((()=>{n._lengthComputable=!0,n._total=n._loaded})),this._requests.push(n),n}_onProgress(h,d){if(!this._progressCallback)return;d._lengthComputable=h.lengthComputable,d._loaded=h.loaded,d._total=h.total;let T=!0,Y=0,y=0;for(const C of this._requests){if(void 0===C._lengthComputable||void 0===C._loaded||void 0===C._total)return;T=T&&C._lengthComputable,Y+=C._loaded,y+=C._total}this._progressCallback({lengthComputable:T,loaded:Y,total:T?y:0})}_validate(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),i.d.ValidateAsync(d,T,Y,(d=>this.preprocessUrlAsync(T+d).then((d=>h._loadFileAsync(d,void 0,!0,!0).then((h=>new Uint8Array(h,0,h.byteLength))))))).then((h=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(h),this.onValidatedObservable.clear()}),(h=>{this._endPerformanceCounter("Validate JSON"),y.Tools.Warn(`Failed to validate: ${h.message}`),this.onValidatedObservable.clear()})))}_getLoader(h){const d=h.json.asset||{};this._log(`Asset version: ${d.version}`),d.minVersion&&this._log(`Asset minimum version: ${d.minVersion}`),d.generator&&this._log(`Asset generator: ${d.generator}`);const T=o._parseVersion(d.version);if(!T)throw new Error("Invalid version: "+d.version);if(void 0!==d.minVersion){const h=o._parseVersion(d.minVersion);if(!h)throw new Error("Invalid minimum version: "+d.minVersion);if(o._compareVersion(h,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+d.minVersion)}const Y={1:o._CreateGLTF1Loader,2:o._CreateGLTF2Loader}[T.major];if(!Y)throw new Error("Unsupported version: "+d.version);return Y(this)}_parseJson(h){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${h.length}`);const d=JSON.parse(h);return this._endPerformanceCounter("Parse JSON"),d}_unpackBinaryAsync(h){return this._startPerformanceCounter("Unpack Binary"),h.loadAsync(20).then((()=>{const d=h.readUint32();if(1179937895!==d)throw new H.k("Unexpected magic: "+d,H.h.GLTFLoaderUnexpectedMagicError);const T=h.readUint32();this.loggingEnabled&&this._log(`Binary version: ${T}`);const Y=h.readUint32();let y;switch(this.useRangeRequests||Y===h.buffer.byteLength||U.c.Warn(`Length in header does not match actual data length: ${Y} != ${h.buffer.byteLength}`),T){case 1:y=this._unpackBinaryV1Async(h,Y);break;case 2:y=this._unpackBinaryV2Async(h,Y);break;default:throw new Error("Unsupported version: "+T)}return this._endPerformanceCounter("Unpack Binary"),y}))}_unpackBinaryV1Async(h,d){const T=h.readUint32(),Y=h.readUint32();if(0!==Y)throw new Error(`Unexpected content format: ${Y}`);const y=d-h.byteOffset,C={json:this._parseJson(h.readString(T)),bin:null};if(0!==y){const d=h.byteOffset;C.bin={readAsync:(T,Y)=>h.buffer.readAsync(d+T,Y),byteLength:y}}return Promise.resolve(C)}_unpackBinaryV2Async(h,d){const T=1313821514,Y=5130562,y=h.readUint32();if(h.readUint32()!==T)throw new Error("First chunk format is not JSON");return h.byteOffset+y===d?h.loadAsync(y).then((()=>({json:this._parseJson(h.readString(y)),bin:null}))):h.loadAsync(y+8).then((()=>{const C={json:this._parseJson(h.readString(y)),bin:null},n=()=>{const y=h.readUint32();switch(h.readUint32()){case T:throw new Error("Unexpected JSON chunk");case Y:{const d=h.byteOffset;C.bin={readAsync:(T,Y)=>h.buffer.readAsync(d+T,Y),byteLength:y},h.skipBytes(y);break}default:h.skipBytes(y)}return h.byteOffset!==d?h.loadAsync(8).then(n):Promise.resolve(C)};return n()}))}static _parseVersion(h){if("1.0"===h||"1.0.1"===h)return{major:1,minor:0};const d=(h+"").match(/^(\d+)\.(\d+)/);return d?{major:parseInt(d[1]),minor:parseInt(d[2])}:null}static _compareVersion(h,d){return h.major>d.major?1:h.major<d.major?-1:h.minor>d.minor?1:h.minor<d.minor?-1:0}_logOpen(h){this._log(h),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(h){const d=o._logSpaces.substring(0,2*this._logIndentLevel);U.c.Log(`${d}${h}`)}_logDisabled(h){}_startPerformanceCounterEnabled(h){y.Tools.StartPerformanceCounter(h)}_startPerformanceCounterDisabled(h){}_endPerformanceCounterEnabled(h){y.Tools.EndPerformanceCounter(h)}_endPerformanceCounterDisabled(h){}}o.IncrementalLoading=!0,o.HomogeneousCoordinates=!1,o._logSpaces="                                ",(0,C.e)(new o)},14468:(h,d,T)=>{"use strict";T.d(d,{d:()=>n});var Y=T(12574);function y(h,d,T,Y){const y={externalResourceFunction:Y};return T&&(y.uri="file:"===d?T:d+T),ArrayBuffer.isView(h)?GLTFValidator.validateBytes(h,y):GLTFValidator.validateString(h,y)}function C(){const h=[];onmessage=d=>{const T=d.data;switch(T.id){case"init":importScripts(T.url);break;case"validate":y(T.data,T.rootUrl,T.fileName,(d=>new Promise(((T,Y)=>{const y=h.length;h.push({resolve:T,reject:Y}),postMessage({id:"getExternalResource",index:y,uri:d})})))).then((h=>{postMessage({id:"validate.resolve",value:h})}),(h=>{postMessage({id:"validate.reject",reason:h})}));break;case"getExternalResource.resolve":h[T.index].resolve(T.value);break;case"getExternalResource.reject":h[T.index].reject(T.reason)}}}class n{static ValidateAsync(h,d,T,n){return"function"===typeof Worker?new Promise(((X,F)=>{const U=`${y}(${C})()`,Z=URL.createObjectURL(new Blob([U],{type:"application/javascript"})),S=new Worker(Z),r=h=>{S.removeEventListener("error",r),S.removeEventListener("message",c),F(h)},c=h=>{const d=h.data;switch(d.id){case"getExternalResource":n(d.uri).then((h=>{S.postMessage({id:"getExternalResource.resolve",index:d.index,value:h},[h.buffer])}),(h=>{S.postMessage({id:"getExternalResource.reject",index:d.index,reason:h})}));break;case"validate.resolve":S.removeEventListener("error",r),S.removeEventListener("message",c),X(d.value),S.terminate();break;case"validate.reject":S.removeEventListener("error",r),S.removeEventListener("message",c),F(d.reason),S.terminate()}};if(S.addEventListener("error",r),S.addEventListener("message",c),S.postMessage({id:"init",url:Y.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(h)){const Y=h.slice();S.postMessage({id:"validate",data:Y,rootUrl:d,fileName:T},[Y.buffer])}else S.postMessage({id:"validate",data:h,rootUrl:d,fileName:T})})):(this._LoadScriptPromise||(this._LoadScriptPromise=Y.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>y(h,d,T,n))))}}n.Configuration={url:`${Y.Tools._DefaultCdnUrl}/gltf_validator.js`}},15024:(h,d,T)=>{"use strict";T.d(d,{c:()=>s});var Y=T(12750),y=T(12757),C=T(12801),n=T(12765),X=T(13155),F=T(13084),U=T(12835),Z=T(12990),S=T(12714),r=T(12663);T(14227),T(14121),T(14147),T(14129),T(14151),T(14159),T(14168);const c="imageProcessingCompatibility",O="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";r.e.IncludesShadersStore[c]||(r.e.IncludesShadersStore[c]=O);const f="skyPixelShader",J="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";r.e.ShadersStore[f]||(r.e.ShadersStore[f]=J);T(14237),T(14174),T(14183),T(14191),T(14185);const W="skyVertexShader",L="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";r.e.ShadersStore[W]||(r.e.ShadersStore[W]=L);var D=T(13081),V=T(13132),i=T(13124);class w extends X.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class s extends F.e{constructor(h,d){super(h,d),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new n.pd(0,100,0),this.useSunPosition=!1,this.cameraOffset=n.pd.Zero(),this.up=n.pd.Up(),this.dithering=!1,this._cameraPosition=n.pd.Zero(),this._skyOrientation=new n.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(h,d){const T=d._drawWrapper;if(this.isFrozen&&T.effect&&T._wasPreviouslyReady)return!0;d.materialDefines||(d.materialDefines=new w);const Y=d.materialDefines,y=this.Eh();if(this._isReadyForSubMesh(d))return!0;if((0,i.Q)(h,y,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,Y),(0,i.G)(h,Y,!0,!1),Y.IMAGEPROCESSINGPOSTPROCESS!==y.imageProcessingConfiguration.applyByPostProcess&&Y.markAsMiscDirty(),Y.DITHER!==this.dithering&&Y.markAsMiscDirty(),Y.isDirty){Y.markAsProcessed(),y.resetCachedMaterial();const h=new D.b;Y.FOG&&h.addFallback(1,"FOG"),Y.IMAGEPROCESSINGPOSTPROCESS=y.imageProcessingConfiguration.applyByPostProcess,Y.DITHER=this.dithering;const T=[U.g.PositionKind];Y.VERTEXCOLOR&&T.push(U.g.ColorKind);const C="sky",n=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,V.d)(n);const X=Y.toString();d.setEffect(y.getEngine().createEffect(C,T,n,[],X,h,this.onCompiled,this.onError),Y,this._materialContext)}return!(!d.effect||!d.effect.isReady())&&(Y._renderId=y.getRenderId(),T._wasPreviouslyReady=!0,!0)}bindForSubMesh(h,d,T){const Y=this.Eh(),y=T.materialDefines;if(!y)return;const C=T.effect;if(!C)return;this._activeEffect=C,this.bindOnlyWorldMatrix(h),this._activeEffect.setMatrix("viewProjection",Y.getTransformMatrix()),this._mustRebind(Y,C,T)&&((0,V.e)(C,this,Y),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,i.i)(y,C,Y)),Y.fogEnabled&&d.applyFog&&Y.fogMode!==Z.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",Y.getViewMatrix()),(0,i.e)(Y,d,this._activeEffect);const X=Y.activeCamera;if(X){const h=X.getWorldMatrix();this._cameraPosition.x=h.m[12],this._cameraPosition.y=h.m[13],this._cameraPosition.z=h.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const h=Math.PI*(this.inclination-.5),d=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(d)*Math.cos(h),this.sunPosition.y=this.distance*Math.sin(-h),this.sunPosition.z=this.distance*Math.sin(d)*Math.cos(h),n.Quaternion.FromUnitVectorsToRef(n.pd.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(d,this._activeEffect,T)}getAnimatables(){return[]}dispose(h){super.dispose(h)}clone(h){return C.e.Clone((()=>new s(h,this.Eh())),this)}serialize(){const h=super.serialize();return h.customType="BABYLON.SkyMaterial",h}getClassName(){return"SkyMaterial"}static Parse(h,d,T){return C.e.Parse((()=>new s(h.name,d)),h,d,T)}}(0,Y.c)([(0,y.E)()],s.prototype,"luminance",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"turbidity",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"rayleigh",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"mieCoefficient",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"mieDirectionalG",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"distance",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"inclination",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"azimuth",void 0),(0,Y.c)([(0,y.B)()],s.prototype,"sunPosition",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"useSunPosition",void 0),(0,Y.c)([(0,y.B)()],s.prototype,"cameraOffset",void 0),(0,Y.c)([(0,y.B)()],s.prototype,"up",void 0),(0,Y.c)([(0,y.E)()],s.prototype,"dithering",void 0),(0,S.e)("BABYLON.SkyMaterial",s)},13483:(h,d,T)=>{"use strict";function Y(h,d){d.headers=h.headers||{},d.statusMessage=h.statusText,d.statusCode=h.status,d.data=h.response}function y(h,d,T){return new Promise((function(y,C){T=T||{};var n,X,F,U=new XMLHttpRequest,Z=T.body,S=T.headers||{};for(n in T.timeout&&(U.timeout=T.timeout),U.ontimeout=U.onerror=function(h){h.timeout="timeout"==h.type,C(h)},U.open(h,d.href||d),U.onload=function(){for(F=U.getAllResponseHeaders().trim().split(/[\r\n]+/),Y(U,U);X=F.shift();)X=X.split(": "),U.headers[X.shift().toLowerCase()]=X.join(": ");if((X=U.headers["content-type"])&&~X.indexOf("application/json"))try{U.data=JSON.parse(U.data,T.reviver)}catch(h){return Y(U,h),C(h)}(U.status>=400?C:y)(U)},typeof FormData<"u"&&Z instanceof FormData||Z&&"object"==typeof Z&&(S["content-type"]="application/json",Z=JSON.stringify(Z)),U.withCredentials=!!T.withCredentials,S)U.setRequestHeader(n,S[n]);U.send(Z)}))}T.r(d),T.d(d,{del:()=>F,get:()=>C,patch:()=>X,post:()=>n,put:()=>U,send:()=>y});var C=y.bind(y,"GET"),n=y.bind(y,"POST"),X=y.bind(y,"PATCH"),F=y.bind(y,"DELETE"),U=y.bind(y,"PUT")},15133:(h,d,T)=>{"use strict";T.d(d,{d:()=>S});const Y=.5*(Math.sqrt(3)-1),y=(3-Math.sqrt(3))/6,C=1/3,n=1/6,X=(Math.sqrt(5)-1)/4,F=(5-Math.sqrt(5))/20,U=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Z=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const S=class{constructor(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const d="function"==typeof h?h:function(h){let d=0,T=0,Y=0,y=1;const C=function(){let h=4022871197;return function(d){d=d.toString();for(let T=0;T<d.length;T++){h+=d.charCodeAt(T);let Y=.02519603282416938*h;h=Y>>>0,Y-=h,Y*=h,h=Y>>>0,Y-=h,h+=4294967296*Y}return 2.3283064365386963e-10*(h>>>0)}}();d=C(" "),T=C(" "),Y=C(" "),d-=C(h),d<0&&(d+=1);T-=C(h),T<0&&(T+=1);Y-=C(h),Y<0&&(Y+=1);return function(){const h=2091639*d+2.3283064365386963e-10*y;return d=T,T=Y,Y=h-(y=0|h)}}(h);this.p=function(h){const d=new Uint8Array(256);for(let T=0;T<256;T++)d[T]=T;for(let T=0;T<255;T++){const Y=T+~~(h()*(256-T)),y=d[T];d[T]=d[Y],d[Y]=y}return d}(d),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let T=0;T<512;T++)this.perm[T]=this.p[255&T],this.permMod12[T]=this.perm[T]%12}noise2D(h,d){const T=this.permMod12,C=this.perm;let n=0,X=0,F=0;const Z=(h+d)*Y,S=Math.floor(h+Z),r=Math.floor(d+Z),c=(S+r)*y,O=h-(S-c),f=d-(r-c);let J,W;O>f?(J=1,W=0):(J=0,W=1);const L=O-J+y,D=f-W+y,V=O-1+2*y,i=f-1+2*y,w=255&S,s=255&r;let E=.5-O*O-f*f;if(E>=0){const h=3*T[w+C[s]];E*=E,n=E*E*(U[h]*O+U[h+1]*f)}let z=.5-L*L-D*D;if(z>=0){const h=3*T[w+J+C[s+W]];z*=z,X=z*z*(U[h]*L+U[h+1]*D)}let x=.5-V*V-i*i;if(x>=0){const h=3*T[w+1+C[s+1]];x*=x,F=x*x*(U[h]*V+U[h+1]*i)}return 70*(n+X+F)}noise3D(h,d,T){const Y=this.permMod12,y=this.perm;let X,F,Z,S;const r=(h+d+T)*C,c=Math.floor(h+r),O=Math.floor(d+r),f=Math.floor(T+r),J=(c+O+f)*n,W=h-(c-J),L=d-(O-J),D=T-(f-J);let V,i,w,s,E,z;W>=L?L>=D?(V=1,i=0,w=0,s=1,E=1,z=0):W>=D?(V=1,i=0,w=0,s=1,E=0,z=1):(V=0,i=0,w=1,s=1,E=0,z=1):L<D?(V=0,i=0,w=1,s=0,E=1,z=1):W<D?(V=0,i=1,w=0,s=0,E=1,z=1):(V=0,i=1,w=0,s=1,E=1,z=0);const x=W-V+n,g=L-i+n,H=D-w+n,p=W-s+2*n,k=L-E+2*n,o=D-z+2*n,u=W-1+.5,N=L-1+.5,K=D-1+.5,l=255&c,q=255&O,j=255&f;let a=.6-W*W-L*L-D*D;if(a<0)X=0;else{const h=3*Y[l+y[q+y[j]]];a*=a,X=a*a*(U[h]*W+U[h+1]*L+U[h+2]*D)}let e=.6-x*x-g*g-H*H;if(e<0)F=0;else{const h=3*Y[l+V+y[q+i+y[j+w]]];e*=e,F=e*e*(U[h]*x+U[h+1]*g+U[h+2]*H)}let v=.6-p*p-k*k-o*o;if(v<0)Z=0;else{const h=3*Y[l+s+y[q+E+y[j+z]]];v*=v,Z=v*v*(U[h]*p+U[h+1]*k+U[h+2]*o)}let G=.6-u*u-N*N-K*K;if(G<0)S=0;else{const h=3*Y[l+1+y[q+1+y[j+1]]];G*=G,S=G*G*(U[h]*u+U[h+1]*N+U[h+2]*K)}return 32*(X+F+Z+S)}noise4D(h,d,T,Y){const y=this.perm;let C,n,U,S,r;const c=(h+d+T+Y)*X,O=Math.floor(h+c),f=Math.floor(d+c),J=Math.floor(T+c),W=Math.floor(Y+c),L=(O+f+J+W)*F,D=h-(O-L),V=d-(f-L),i=T-(J-L),w=Y-(W-L);let s=0,E=0,z=0,x=0;D>V?s++:E++,D>i?s++:z++,D>w?s++:x++,V>i?E++:z++,V>w?E++:x++,i>w?z++:x++;const g=s>=3?1:0,H=E>=3?1:0,p=z>=3?1:0,k=x>=3?1:0,o=s>=2?1:0,u=E>=2?1:0,N=z>=2?1:0,K=x>=2?1:0,l=s>=1?1:0,q=E>=1?1:0,j=z>=1?1:0,a=x>=1?1:0,e=D-g+F,v=V-H+F,G=i-p+F,b=w-k+F,B=D-o+2*F,M=V-u+2*F,mh=i-N+2*F,R=w-K+2*F,Q=D-l+3*F,I=V-q+3*F,A=i-j+3*F,P=w-a+3*F,t=D-1+4*F,hh=V-1+4*F,dh=i-1+4*F,Th=w-1+4*F,Yh=255&O,yh=255&f,Ch=255&J,nh=255&W;let Xh=.6-D*D-V*V-i*i-w*w;if(Xh<0)C=0;else{const h=y[Yh+y[yh+y[Ch+y[nh]]]]%32*4;Xh*=Xh,C=Xh*Xh*(Z[h]*D+Z[h+1]*V+Z[h+2]*i+Z[h+3]*w)}let Fh=.6-e*e-v*v-G*G-b*b;if(Fh<0)n=0;else{const h=y[Yh+g+y[yh+H+y[Ch+p+y[nh+k]]]]%32*4;Fh*=Fh,n=Fh*Fh*(Z[h]*e+Z[h+1]*v+Z[h+2]*G+Z[h+3]*b)}let Uh=.6-B*B-M*M-mh*mh-R*R;if(Uh<0)U=0;else{const h=y[Yh+o+y[yh+u+y[Ch+N+y[nh+K]]]]%32*4;Uh*=Uh,U=Uh*Uh*(Z[h]*B+Z[h+1]*M+Z[h+2]*mh+Z[h+3]*R)}let Zh=.6-Q*Q-I*I-A*A-P*P;if(Zh<0)S=0;else{const h=y[Yh+l+y[yh+q+y[Ch+j+y[nh+a]]]]%32*4;Zh*=Zh,S=Zh*Zh*(Z[h]*Q+Z[h+1]*I+Z[h+2]*A+Z[h+3]*P)}let Sh=.6-t*t-hh*hh-dh*dh-Th*Th;if(Sh<0)r=0;else{const h=y[Yh+1+y[yh+1+y[Ch+1+y[nh+1]]]]%32*4;Sh*=Sh,r=Sh*Sh*(Z[h]*t+Z[h+1]*hh+Z[h+2]*dh+Z[h+3]*Th)}return 27*(C+n+U+S+r)}}}}]);