/*! For license information please see b4ymr8.32.493542fd.chunk.js.LICENSE.txt */
(self.agop5zpabxv=self.agop5zpabxv||[]).push([[32],{14288:(H,u,J)=>{"use strict";var O=J(14296),U=J(14300),h=J(14308);J.g.__TYPEDARRAY_POOL||(J.g.__TYPEDARRAY_POOL={UINT8:U([32,0]),UINT16:U([32,0]),UINT32:U([32,0]),INT8:U([32,0]),INT16:U([32,0]),INT32:U([32,0]),FLOAT:U([32,0]),DOUBLE:U([32,0]),DATA:U([32,0]),UINT8C:U([32,0]),BUFFER:U([32,0])});var w="undefined"!==typeof Uint8ClampedArray,g=J.g.__TYPEDARRAY_POOL;g.UINT8C||(g.UINT8C=U([32,0])),g.BUFFER||(g.BUFFER=U([32,0]));var B=g.DATA,b=g.BUFFER;function d(H){if(H){var u=H.length||H.byteLength,J=O.log2(u);B[J].push(H)}}function G(H){H=O.nextPow2(H);var u=O.log2(H),J=B[u];return J.length>0?J.pop():new ArrayBuffer(H)}function P(H){return new Uint8Array(G(H),0,H)}function mH(H){return new Uint16Array(G(2*H),0,H)}function l(H){return new Uint32Array(G(4*H),0,H)}function r(H){return new Int8Array(G(H),0,H)}function p(H){return new Int16Array(G(2*H),0,H)}function a(H){return new Int32Array(G(4*H),0,H)}function k(H){return new Float32Array(G(4*H),0,H)}function C(H){return new Float64Array(G(8*H),0,H)}function j(H){return w?new Uint8ClampedArray(G(H),0,H):P(H)}function M(H){return new DataView(G(H),0,H)}u.free=function(H){if(h(H))b[O.log2(H.length)].push(H);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(H)&&(H=H.buffer),!H)return;var u=H.length||H.byteLength,J=0|O.log2(u);B[J].push(H)}},u.freeUint8=u.freeUint16=u.freeUint32=u.freeInt8=u.freeInt16=u.freeInt32=u.freeFloat32=u.freeFloat=u.freeFloat64=u.freeDouble=u.freeUint8Clamped=u.freeDataView=function(H){d(H.buffer)},u.freeArrayBuffer=d,u.freeBuffer=function(H){b[O.log2(H.length)].push(H)},u.malloc=function(H,u){if(void 0===u||"arraybuffer"===u)return G(H);switch(u){case"uint8":return P(H);case"uint16":return mH(H);case"uint32":return l(H);case"int8":return r(H);case"int16":return p(H);case"int32":return a(H);case"float":case"float32":return k(H);case"double":case"float64":return C(H);case"uint8_clamped":return j(H);case"buffer":throw"Buffer not supported";case"data":case"dataview":return M(H);default:return null}return null},u.mallocArrayBuffer=G,u.mallocUint8=P,u.mallocUint16=mH,u.mallocUint32=l,u.mallocInt8=r,u.mallocInt16=p,u.mallocInt32=a,u.mallocFloat32=u.mallocFloat=k,u.mallocFloat64=u.mallocDouble=C,u.mallocUint8Clamped=j,u.mallocDataView=M,u.clearCache=function(){for(var H=0;H<32;++H)g.UINT8[H].length=0,g.UINT16[H].length=0,g.UINT32[H].length=0,g.INT8[H].length=0,g.INT16[H].length=0,g.INT32[H].length=0,g.FLOAT[H].length=0,g.DOUBLE[H].length=0,g.UINT8C[H].length=0,B[H].length=0,b[H].length=0}},14385:(H,u,J)=>{H.exports=U;var O=J(13137);function U(H,u){if(!(this instanceof U))return new U(H,u);var J=O.create();O.add(J,H,u),this.base=O.min(O.create(),H,J),this.pG=O.clone(u),this.max=O.max(O.create(),H,J),this.mag=O.length(this.pG)}var h=U.prototype;h.width=function(){return this.pG[0]},h.height=function(){return this.pG[1]},h.depth=function(){return this.pG[2]},h.x0=function(){return this.base[0]},h.y0=function(){return this.base[1]},h.z0=function(){return this.base[2]},h.x1=function(){return this.max[0]},h.y1=function(){return this.max[1]},h.z1=function(){return this.max[2]},h.translate=function(H){return O.add(this.max,this.max,H),O.add(this.base,this.base,H),this},h.setPosition=function(H){return O.add(this.max,H,this.pG),O.i(this.base,H),this},h.expand=function(H){var u=O.create(),J=O.create();return O.max(u,H.max,this.max),O.min(J,H.base,this.base),O.ru(u,u,J),new U(J,u)},h.intersects=function(H){return!(H.base[0]>this.max[0])&&(!(H.base[1]>this.max[1])&&(!(H.base[2]>this.max[2])&&(!(H.max[0]<this.base[0])&&(!(H.max[1]<this.base[1])&&!(H.max[2]<this.base[2])))))},h.touches=function(H){var u=this.union(H);return null!==u&&(0==u.width()||0==u.height()||0==u.depth())},h.union=function(H){if(!this.intersects(H))return null;var u=Math.max(H.base[0],this.base[0]),J=Math.max(H.base[1],this.base[1]),O=Math.max(H.base[2],this.base[2]);return new U([u,J,O],[Math.min(H.max[0],this.max[0])-u,Math.min(H.max[1],this.max[1])-J,Math.min(H.max[2],this.max[2])-O])}},14296:(H,u)=>{"use strict";function J(H){var u=32;return(H&=-H)&&u--,65535&H&&(u-=16),16711935&H&&(u-=8),252645135&H&&(u-=4),858993459&H&&(u-=2),1431655765&H&&(u-=1),u}u.INT_BITS=32,u.INT_MAX=2147483647,u.INT_MIN=-1<<31,u.sign=function(H){return(H>0)-(H<0)},u.abs=function(H){var u=H>>31;return(H^u)-u},u.min=function(H,u){return u^(H^u)&-(H<u)},u.max=function(H,u){return H^(H^u)&-(H<u)},u.isPow2=function(H){return!(H&H-1)&&!!H},u.log2=function(H){var u,J;return u=(H>65535)<<4,u|=J=((H>>>=u)>255)<<3,u|=J=((H>>>=J)>15)<<2,(u|=J=((H>>>=J)>3)<<1)|(H>>>=J)>>1},u.log10=function(H){return H>=1e9?9:H>=1e8?8:H>=1e7?7:H>=1e6?6:H>=1e5?5:H>=1e4?4:H>=1e3?3:H>=100?2:H>=10?1:0},u.popCount=function(H){return 16843009*((H=(858993459&(H-=H>>>1&1431655765))+(H>>>2&858993459))+(H>>>4)&252645135)>>>24},u.countTrailingZeros=J,u.nextPow2=function(H){return H+=0===H,--H,H|=H>>>1,H|=H>>>2,H|=H>>>4,H|=H>>>8,(H|=H>>>16)+1},u.prevPow2=function(H){return H|=H>>>1,H|=H>>>2,H|=H>>>4,H|=H>>>8,(H|=H>>>16)-(H>>>1)},u.parity=function(H){return H^=H>>>16,H^=H>>>8,H^=H>>>4,27030>>>(H&=15)&1};var O=new Array(256);!function(H){for(var u=0;u<256;++u){var J=u,O=u,U=7;for(J>>>=1;J;J>>>=1)O<<=1,O|=1&J,--U;H[u]=O<<U&255}}(O),u.reverse=function(H){return O[255&H]<<24|O[H>>>8&255]<<16|O[H>>>16&255]<<8|O[H>>>24&255]},u.interleave2=function(H,u){return(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H&=65535)|H<<8))|H<<4))|H<<2))|H<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u&=65535)|u<<8))|u<<4))|u<<2))|u<<1))<<1},u.deinterleave2=function(H,u){return(H=65535&((H=16711935&((H=252645135&((H=858993459&((H=H>>>u&1431655765)|H>>>1))|H>>>2))|H>>>4))|H>>>16))<<16>>16},u.interleave3=function(H,u,J){return H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2),(H|=(u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2))<<1)|(J=1227133513&((J=3272356035&((J=251719695&((J=4278190335&((J&=1023)|J<<16))|J<<8))|J<<4))|J<<2))<<2},u.deinterleave3=function(H,u){return(H=1023&((H=4278190335&((H=251719695&((H=3272356035&((H=H>>>u&1227133513)|H>>>2))|H>>>4))|H>>>8))|H>>>16))<<22>>22},u.nextCombination=function(H){var u=H|H-1;return u+1|(~u&-~u)-1>>>J(H)+1}},14279:(H,u,J)=>{"use strict";H.exports=function(H,u,J){switch(arguments.length){case 1:return O=[],b(U=H,U,d,!0),O;case 2:return"function"===typeof u?b(H,H,u,!0):function(H,u){return O=[],b(H,u,d,!1),O}(H,u);case 3:return b(H,u,J,!1);default:throw new Error("box-intersect: Invalid arguments")}var U};var O,U=J(14288),h=J(14312),w=J(14323);function g(H,u){for(var J=0;J<H;++J)if(!(u[J]<=u[J+H]))return!0;return!1}function B(H,u,J,O){for(var U=0,h=0,w=0,B=H.length;w<B;++w){var b=H[w];if(!g(u,b)){for(var d=0;d<2*u;++d)J[U++]=b[d];O[h++]=w}}return h}function b(H,u,J,O){var g=H.length,b=u.length;if(!(g<=0||b<=0)){var d=H[0].length>>>1;if(!(d<=0)){var G,P=U.mallocDouble(2*d*g),mH=U.mallocInt32(g);if((g=B(H,d,P,mH))>0){if(1===d&&O)h.init(g),G=h.sweepComplete(d,J,0,g,P,mH,0,g,P,mH);else{var l=U.mallocDouble(2*d*b),r=U.mallocInt32(b);(b=B(u,d,l,r))>0&&(h.init(g+b),G=1===d?h.sweepBipartite(d,J,0,g,P,mH,0,b,l,r):w(d,J,O,g,P,mH,b,l,r),U.free(l),U.free(r))}U.free(P),U.free(mH)}return G}}}function d(H,u){O.push([H,u])}},14329:(H,u)=>{"use strict";var J="d",O="ax",U="fp",h="es",w="rs",g="re",B="rb",b="bs",d="be",G="bb",P=[J,O,"vv",w,g,B,"ri",b,d,G,"bi"];function mH(H){var u="bruteForce"+(H?"Full":"Partial"),O=[],w=P.slice();H||w.splice(3,0,U);var g=["function "+u+"("+w.join()+"){"];function B(u,U){var w=function(H,u,O){var U="bruteForce"+(H?"Red":"Blue")+(u?"Flip":"")+(O?"Full":""),w=["function ",U,"(",P.join(),"){","var ",h,"=2*",J,";"],g="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",B="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(O?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return H?w.push(g,"Q",":",B):w.push(B,"Q",":",g),O?w.push("if(y1<x0||x1<y0)continue;"):u?w.push("if(y0<=x0||x1<y0)continue;"):w.push("if(y0<x0||x1<y0)continue;"),w.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),u?w.push("yi,xi"):w.push("xi,yi"),w.push(");if(rv!==void 0)return rv;}}}"),{name:U,code:w.join("")}}(u,U,H);O.push(w.code),g.push("return "+w.name+"("+P.join()+");")}g.push("if(re-rs>be-bs){"),H?(B(!0,!1),g.push("}else{"),B(!1,!1)):(g.push("if(fp){"),B(!0,!0),g.push("}else{"),B(!0,!1),g.push("}}else{if(fp){"),B(!1,!0),g.push("}else{"),B(!1,!1),g.push("}")),g.push("}}return "+u);var b=O.join("")+g.join("");return new Function(b)()}u.partial=mH(!1),u.full=mH(!0)},14323:(H,u,J)=>{"use strict";H.exports=function(H,u,J,h,d,A,t,e,c){!function(H,u){var J=8*U.log2(u+1)*(H+1)|0,h=U.nextPow2(j*J);L.length<h&&(O.free(L),L=O.mallocInt32(h));var w=U.nextPow2(M*J);Z.length<w&&(O.free(Z),Z=O.mallocDouble(w))}(H,h+t);var n,V=0,T=2*H;Y(V++,0,0,h,0,t,J?16:0,-1/0,1/0),J||Y(V++,0,0,t,0,h,1,-1/0,1/0);for(;V>0;){var R=(V-=1)*j,X=L[R],W=L[R+1],f=L[R+2],i=L[R+3],S=L[R+4],v=L[R+5],I=V*M,D=Z[I],o=Z[I+1],y=1&v,x=!!(16&v),z=d,K=A,N=e,q=c;if(y&&(z=e,K=c,N=d,q=A),!(2&v&&W>=(f=p(H,X,W,f,z,K,o)))&&!(4&v&&(W=a(H,X,W,f,z,K,D))>=f)){var E=f-W,Q=S-i;if(x){if(H*E*(E+Q)<mH){if(void 0!==(n=B.scanComplete(H,X,u,W,f,z,K,i,S,N,q)))return n;continue}}else{if(H*Math.min(E,Q)<G){if(void 0!==(n=w(H,X,u,y,W,f,z,K,i,S,N,q)))return n;continue}if(H*E*Q<P){if(void 0!==(n=B.scanBipartite(H,X,u,y,W,f,z,K,i,S,N,q)))return n;continue}}var HH=l(H,X,W,f,z,K,D,o);if(W<HH)if(H*(HH-W)<G){if(void 0!==(n=g(H,X+1,u,W,HH,z,K,i,S,N,q)))return n}else if(X===H-2){if(void 0!==(n=y?B.sweepBipartite(H,u,i,S,N,q,W,HH,z,K):B.sweepBipartite(H,u,W,HH,z,K,i,S,N,q)))return n}else Y(V++,X+1,W,HH,i,S,y,-1/0,1/0),Y(V++,X+1,i,S,W,HH,1^y,-1/0,1/0);if(HH<f){var uH=b(H,X,i,S,N,q),JH=N[T*uH+X],OH=r(H,X,uH,S,N,q,JH);if(OH<S&&Y(V++,X,HH,f,OH,S,(4|y)+(x?16:0),JH,o),i<uH&&Y(V++,X,HH,f,i,uH,(2|y)+(x?16:0),D,JH),uH+1===OH){if(void 0!==(n=x?s(H,X,u,HH,f,z,K,uH,N,q[uH]):F(H,X,u,y,HH,f,z,K,uH,N,q[uH])))return n}else if(uH<OH){var UH;if(x){if(HH<(UH=k(H,X,HH,f,z,K,JH))){var hH=r(H,X,HH,UH,z,K,JH);if(X===H-2){if(HH<hH&&void 0!==(n=B.sweepComplete(H,u,HH,hH,z,K,uH,OH,N,q)))return n;if(hH<UH&&void 0!==(n=B.sweepBipartite(H,u,hH,UH,z,K,uH,OH,N,q)))return n}else HH<hH&&Y(V++,X+1,HH,hH,uH,OH,16,-1/0,1/0),hH<UH&&(Y(V++,X+1,hH,UH,uH,OH,0,-1/0,1/0),Y(V++,X+1,uH,OH,hH,UH,1,-1/0,1/0))}}else HH<(UH=y?C(H,X,HH,f,z,K,JH):k(H,X,HH,f,z,K,JH))&&(X===H-2?n=y?B.sweepBipartite(H,u,uH,OH,N,q,HH,UH,z,K):B.sweepBipartite(H,u,HH,UH,z,K,uH,OH,N,q):(Y(V++,X+1,HH,UH,uH,OH,y,-1/0,1/0),Y(V++,X+1,uH,OH,HH,UH,1^y,-1/0,1/0)))}}}}};var O=J(14288),U=J(14296),h=J(14329),w=h.partial,g=h.full,B=J(14312),b=J(14338),d=J(14340),G=128,P=1<<22,mH=1<<22,l=d("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),r=d("lo===p0",["p0"]),p=d("lo<p0",["p0"]),a=d("hi<=p0",["p0"]),k=d("lo<=p0&&p0<=hi",["p0"]),C=d("lo<p0&&p0<=hi",["p0"]),j=6,M=2,L=O.mallocInt32(1024),Z=O.mallocDouble(1024);function Y(H,u,J,O,U,h,w,g,B){var b=j*H;L[b]=u,L[b+1]=J,L[b+2]=O,L[b+3]=U,L[b+4]=h,L[b+5]=w;var d=M*H;Z[d]=g,Z[d+1]=B}function F(H,u,J,O,U,h,w,g,B,b,d){var G=2*H,P=B*G,mH=b[P+u];H:for(var l=U,r=U*G;l<h;++l,r+=G){var p=w[r+u],a=w[r+u+H];if(!(mH<p||a<mH)&&(!O||mH!==p)){for(var k,C=g[l],j=u+1;j<H;++j){p=w[r+j],a=w[r+j+H];var M=b[P+j],L=b[P+j+H];if(a<M||L<p)continue H}if(void 0!==(k=O?J(d,C):J(C,d)))return k}}}function s(H,u,J,O,U,h,w,g,B,b){var d=2*H,G=g*d,P=B[G+u];H:for(var mH=O,l=O*d;mH<U;++mH,l+=d){var r=w[mH];if(r!==b){var p=h[l+u],a=h[l+u+H];if(!(P<p||a<P)){for(var k=u+1;k<H;++k){p=h[l+k],a=h[l+k+H];var C=B[G+k],j=B[G+k+H];if(a<C||j<p)continue H}var M=J(r,b);if(void 0!==M)return M}}}}},14338:(H,u,J)=>{"use strict";H.exports=function(H,u,J,w,g,B){if(w<=J+1)return J;var b=J,d=w,G=w+J>>>1,P=2*H,mH=G,l=g[P*G+u];for(;b<d;){if(d-b<U){h(H,u,b,d,g,B),l=g[P*G+u];break}var r=d-b,p=Math.random()*r+b|0,a=g[P*p+u],k=Math.random()*r+b|0,C=g[P*k+u],j=Math.random()*r+b|0,M=g[P*j+u];a<=C?M>=C?(mH=k,l=C):a>=M?(mH=p,l=a):(mH=j,l=M):C>=M?(mH=k,l=C):M>=a?(mH=p,l=a):(mH=j,l=M);for(var L=P*(d-1),Z=P*mH,Y=0;Y<P;++Y,++L,++Z){var F=g[L];g[L]=g[Z],g[Z]=F}var s=B[d-1];B[d-1]=B[mH],B[mH]=s;for(L=P*(d-1),Z=P*(mH=O(H,u,b,d-1,g,B,l)),Y=0;Y<P;++Y,++L,++Z){F=g[L];g[L]=g[Z],g[Z]=F}s=B[d-1];if(B[d-1]=B[mH],B[mH]=s,G<mH){for(d=mH-1;b<d&&g[P*(d-1)+u]===l;)d-=1;d+=1}else{if(!(mH<G))break;for(b=mH+1;b<d&&g[P*b+u]===l;)b+=1}}return O(H,u,J,G,g,B,g[P*G+u])};var O=J(14340)("lo<p0",["p0"]),U=8;function h(H,u,J,O,U,h){for(var w=2*H,g=w*(J+1)+u,B=J+1;B<O;++B,g+=w)for(var b=U[g],d=B,G=w*(B-1);d>J&&U[G+u]>b;--d,G-=w){for(var P=G,mH=G+w,l=0;l<w;++l,++P,++mH){var r=U[P];U[P]=U[mH],U[mH]=r}var p=h[d];h[d]=h[d-1],h[d-1]=p}}},14340:H=>{"use strict";H.exports=function(H,J){var O="abcdef".split("").concat(J),U=[];H.indexOf("lo")>=0&&U.push("lo=e[k+n]");H.indexOf("hi")>=0&&U.push("hi=e[k+o]");return O.push(u.replace("_",U.join()).replace("$",H)),Function.apply(void 0,O)};var u="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14317:H=>{"use strict";H.exports=function(H,O){O<=4*u?J(0,O-1,H):b(0,O-1,H)};var u=32;function J(H,u,J){for(var O=2*(H+1),U=H+1;U<=u;++U){for(var h=J[O++],w=J[O++],g=U,B=O-2;g-- >H;){var b=J[B-2],d=J[B-1];if(b<h)break;if(b===h&&d<w)break;J[B]=b,J[B+1]=d,B-=2}J[B]=h,J[B+1]=w}}function O(H,u,J){u*=2;var O=J[H*=2],U=J[H+1];J[H]=J[u],J[H+1]=J[u+1],J[u]=O,J[u+1]=U}function U(H,u,J){u*=2,J[H*=2]=J[u],J[H+1]=J[u+1]}function h(H,u,J,O){u*=2,J*=2;var U=O[H*=2],h=O[H+1];O[H]=O[u],O[H+1]=O[u+1],O[u]=O[J],O[u+1]=O[J+1],O[J]=U,O[J+1]=h}function w(H,u,J,O,U){u*=2,U[H*=2]=U[u],U[u]=J,U[H+1]=U[u+1],U[u+1]=O}function g(H,u,J){u*=2;var O=J[H*=2],U=J[u];return!(O<U)&&(O!==U||J[H+1]>J[u+1])}function B(H,u,J,O){var U=O[H*=2];return U<u||U===u&&O[H+1]<J}function b(H,d,G){var P=(d-H+1)/6|0,mH=H+P,l=d-P,r=H+d>>1,p=r-P,a=r+P,k=mH,C=p,j=r,M=a,L=l,Z=H+1,Y=d-1,F=0;g(k,C,G)&&(F=k,k=C,C=F),g(M,L,G)&&(F=M,M=L,L=F),g(k,j,G)&&(F=k,k=j,j=F),g(C,j,G)&&(F=C,C=j,j=F),g(k,M,G)&&(F=k,k=M,M=F),g(j,M,G)&&(F=j,j=M,M=F),g(C,L,G)&&(F=C,C=L,L=F),g(C,j,G)&&(F=C,C=j,j=F),g(M,L,G)&&(F=M,M=L,L=F);for(var s=G[2*C],A=G[2*C+1],t=G[2*M],e=G[2*M+1],c=2*k,n=2*j,V=2*L,T=2*mH,R=2*r,X=2*l,W=0;W<2;++W){var f=G[c+W],i=G[n+W],S=G[V+W];G[T+W]=f,G[R+W]=i,G[X+W]=S}U(p,H,G),U(a,d,G);for(var v=Z;v<=Y;++v)if(B(v,s,A,G))v!==Z&&O(v,Z,G),++Z;else if(!B(v,t,e,G))for(;;){if(B(Y,t,e,G)){B(Y,s,A,G)?(h(v,Z,Y,G),++Z,--Y):(O(v,Y,G),--Y);break}if(--Y<v)break}w(H,Z-1,s,A,G),w(d,Y+1,t,e,G),Z-2-H<=u?J(H,Z-2,G):b(H,Z-2,G),d-(Y+2)<=u?J(Y+2,d,G):b(Y+2,d,G),Y-Z<=u?J(Z,Y,G):b(Z,Y,G)}},14312:(H,u,J)=>{"use strict";H.exports={init:function(H){var u=U.nextPow2(H);B.length<u&&(O.free(B),B=O.mallocInt32(u));b.length<u&&(O.free(b),b=O.mallocInt32(u));d.length<u&&(O.free(d),d=O.mallocInt32(u));G.length<u&&(O.free(G),G=O.mallocInt32(u));P.length<u&&(O.free(P),P=O.mallocInt32(u));mH.length<u&&(O.free(mH),mH=O.mallocInt32(u));var J=8*u;l.length<J&&(O.free(l),l=O.mallocDouble(J))},sweepBipartite:function(H,u,J,O,U,g,P,mH,a,k){for(var C=0,j=2*H,M=H-1,L=j-1,Z=J;Z<O;++Z){var Y=g[Z],F=j*Z;l[C++]=U[F+M],l[C++]=-(Y+1),l[C++]=U[F+L],l[C++]=Y}for(Z=P;Z<mH;++Z){Y=k[Z]+w;var s=j*Z;l[C++]=a[s+M],l[C++]=-Y,l[C++]=a[s+L],l[C++]=Y}var A=C>>>1;h(l,A);var t=0,e=0;for(Z=0;Z<A;++Z){var c=0|l[2*Z+1];if(c>=w)r(d,G,e--,c=c-w|0);else if(c>=0)r(B,b,t--,c);else if(c<=-w){c=-c-w|0;for(var n=0;n<t;++n){if(void 0!==(V=u(B[n],c)))return V}p(d,G,e++,c)}else{c=-c-1|0;for(n=0;n<e;++n){var V;if(void 0!==(V=u(c,d[n])))return V}p(B,b,t++,c)}}},sweepComplete:function(H,u,J,O,U,w,g,a,k,C){for(var j=0,M=2*H,L=H-1,Z=M-1,Y=J;Y<O;++Y){var F=w[Y]+1<<1,s=M*Y;l[j++]=U[s+L],l[j++]=-F,l[j++]=U[s+Z],l[j++]=F}for(Y=g;Y<a;++Y){F=C[Y]+1<<1;var A=M*Y;l[j++]=k[A+L],l[j++]=1|-F,l[j++]=k[A+Z],l[j++]=1|F}var t=j>>>1;h(l,t);var e=0,c=0,n=0;for(Y=0;Y<t;++Y){var V=0|l[2*Y+1],T=1&V;if(Y<t-1&&V>>1===l[2*Y+3]>>1&&(T=2,Y+=1),V<0){for(var R=-(V>>1)-1,X=0;X<n;++X){if(void 0!==(W=u(P[X],R)))return W}if(0!==T)for(X=0;X<e;++X){if(void 0!==(W=u(B[X],R)))return W}if(1!==T)for(X=0;X<c;++X){var W;if(void 0!==(W=u(d[X],R)))return W}0===T?p(B,b,e++,R):1===T?p(d,G,c++,R):2===T&&p(P,mH,n++,R)}else{R=(V>>1)-1;0===T?r(B,b,e--,R):1===T?r(d,G,c--,R):2===T&&r(P,mH,n--,R)}}},scanBipartite:function(H,u,J,O,U,g,d,G,P,mH,a,k){var C=0,j=2*H,M=u,L=u+H,Z=1,Y=1;O?Y=w:Z=w;for(var F=U;F<g;++F){var s=F+Z,A=j*F;l[C++]=d[A+M],l[C++]=-s,l[C++]=d[A+L],l[C++]=s}for(F=P;F<mH;++F){s=F+Y;var t=j*F;l[C++]=a[t+M],l[C++]=-s}var e=C>>>1;h(l,e);var c=0;for(F=0;F<e;++F){var n=0|l[2*F+1];if(n<0){var V=!1;if((s=-n)>=w?(V=!O,s-=w):(V=!!O,s-=1),V)p(B,b,c++,s);else{var T=k[s],R=j*s,X=a[R+u+1],W=a[R+u+1+H];H:for(var f=0;f<c;++f){var i=B[f],S=j*i;if(!(W<d[S+u+1]||d[S+u+1+H]<X)){for(var v=u+2;v<H;++v)if(a[R+v+H]<d[S+v]||d[S+v+H]<a[R+v])continue H;var I,D=G[i];if(void 0!==(I=O?J(T,D):J(D,T)))return I}}}}else r(B,b,c--,n-Z)}},scanComplete:function(H,u,J,O,U,g,b,d,G,P,mH){for(var r=0,p=2*H,a=u,k=u+H,C=O;C<U;++C){var j=C+w,M=p*C;l[r++]=g[M+a],l[r++]=-j,l[r++]=g[M+k],l[r++]=j}for(C=d;C<G;++C){j=C+1;var L=p*C;l[r++]=P[L+a],l[r++]=-j}var Z=r>>>1;h(l,Z);var Y=0;for(C=0;C<Z;++C){var F=0|l[2*C+1];if(F<0){if((j=-F)>=w)B[Y++]=j-w;else{var s=mH[j-=1],A=p*j,t=P[A+u+1],e=P[A+u+1+H];H:for(var c=0;c<Y;++c){var n=B[c],V=b[n];if(V===s)break;var T=p*n;if(!(e<g[T+u+1]||g[T+u+1+H]<t)){for(var R=u+2;R<H;++R)if(P[A+R+H]<g[T+R]||g[T+R+H]<P[A+R])continue H;var X=J(V,s);if(void 0!==X)return X}}}}else{for(j=F-w,c=Y-1;c>=0;--c)if(B[c]===j){for(R=c+1;R<Y;++R)B[R-1]=B[R];break}--Y}}}};var O=J(14288),U=J(14296),h=J(14317),w=1<<28,g=1024,B=O.mallocInt32(g),b=O.mallocInt32(g),d=O.mallocInt32(g),G=O.mallocInt32(g),P=O.mallocInt32(g),mH=O.mallocInt32(g),l=O.mallocDouble(8192);function r(H,u,J,O){var U=u[O],h=H[J-1];H[U]=h,u[h]=U}function p(H,u,J,O){H[J]=O,u[O]=J}},14300:H=>{"use strict";function u(H,J,O){var U=0|H[O];if(U<=0)return[];var h,w=new Array(U);if(O===H.length-1)for(h=0;h<U;++h)w[h]=J;else for(h=0;h<U;++h)w[h]=u(H,J,O+1);return w}H.exports=function(H,J){switch("undefined"===typeof J&&(J=0),typeof H){case"number":if(H>0)return function(H,u){var J,O;for(J=new Array(H),O=0;O<H;++O)J[O]=u;return J}(0|H,J);break;case"object":if("number"===typeof H.length)return u(H,J,0)}return[]}},14260:(H,u,J)=>{H.exports=function(){var H=this;this.components={},this.comps=this.components;var u=this.components,J=1,U={},h=[],w=[],g={timeout:!1,removals:[],multiComps:[]};function B(H,J){var O=u[J],h=U[J],w=h.hash[H];w&&(h.remove(H),O.mh&&(O.multi?(w.forEach((u=>{u&&O.mh(H,u)})),w.length=0):O.mh(H,w)),g.removals.push(h),b())}function b(){g.timeout||(g.timeout=!0,setTimeout(d,1))}function d(){g.timeout=!1,G()}function G(){g.multiComps.length&&function(H){for(var u=0;u<H.length;u++){var{entID:J,data:O}=H[u],U=O.hash[J];if(U){for(var h=0;h<U.length;h++)U[h]||(U.splice(h,1),h--);0===U.length&&(O.remove(J),g.removals.push(O))}}H.length=0}(g.multiComps),g.removals.length&&function(H){for(var u=0;u<H.length;u++){H[u].flush()}H.length=0}(g.removals)}this.VP=U,this._systems=h,this._renderSystems=w,this.CG=function(u){var O=J++;return Array.isArray(u)&&u.forEach((u=>H.vB(O,u))),O},this.deleteEntity=function(u){return Object.keys(U).forEach((H=>{U[H].hash[u]&&B(u,H)})),H},this.XG=function(H){if(!H)throw new Error("Missing component definition");var J=H.name;if(!J)throw new Error("Component definition must have a name property.");if("string"!==typeof J)throw new Error("Component name must be a string.");if(""===J)throw new Error("Component name must be a non-empty string.");if(U[J])throw new Error(`Component ${J} already exists.`);var g={};return g.name=J,g.multi=!!H.multi,g.order=isNaN(H.order)?99:H.order,g.stateConstructor=H.stateConstructor||null,g.state=H.state||{},g.ng=H.ng||null,g.mh=H.mh||null,g.system=H.system||null,g.Sg=H.Sg||null,u[J]=g,U[J]=new O,U[J]._pendingMultiCleanup=!1,U[J]._multiCleanupIDs=g.multi?[]:null,g.system&&(h.push(J),h.sort(((H,J)=>u[H].order-u[J].order))),g.Sg&&(w.push(J),w.sort(((H,J)=>u[H].order-u[J].order))),J},this.overwriteComponent=function(H,J){var O=u[H];if(!O)throw new Error(`Unknown component: ${H}`);if(!J)throw new Error("Missing component definition");if(O.name!==J.name)throw new Error("Overwriting component must use the same name property.");var g={};g.name=H,g.multi=!!J.multi,g.order=isNaN(J.order)?99:J.order,g.state=J.state||{},g.ng=J.ng||null,g.mh=J.mh||null,g.system=J.system||null,g.Sg=J.Sg||null,u[H]=g,U[H]._pendingMultiCleanup=!1,U[H]._multiCleanupIDs=g.multi?[]:null;var B=h.indexOf(H);g.system&&B<0&&h.push(H),!g.system&&B>=0&&h.splice(B,1),h.sort(((H,J)=>u[H].order-u[J].order));var b=w.indexOf(H);g.Sg&&b<0&&w.push(H),!g.Sg&&b>=0&&w.splice(b,1),w.sort(((H,J)=>u[H].order-u[J].order));var d=g.state;return this.uG(H).forEach((H=>{for(var u in d)u in H||(H[u]=d[u]);g.ng&&g.ng(H.Xg,H)})),H},this.deleteComponent=function(J){var O=U[J];if(!O)throw new Error(`Unknown component: ${J}`);O.flush(),O.list.forEach((H=>{H&&B(H.Xg||H[0].Xg,J)}));var g=h.indexOf(J),b=w.indexOf(J);return g>-1&&h.splice(g,1),b>-1&&w.splice(b,1),U[J].dispose(),delete U[J],delete u[J],H},this.vB=function(H,J,O){var h,w=u[J],g=U[J];if(!g)throw new Error(`Unknown component: ${J}.`);if(g.hash[H]&&!w.multi)throw new Error(`Entity ${H} already has component: ${J}.`);if(w.stateConstructor){if(!(h=new w.stateConstructor).hasOwnProperty("Xg"))throw new Error(`Component ${w.name} stateConstructor type does not have property __id`)}else h=Object.assign({},{Xg:H},w.state,O);if(h.Xg=H,w.multi){var B=g.hash[H];B||(B=[],g.add(H,B)),B.push(h)}else g.add(H,h);return w.ng&&w.ng(H,h),this},this.EB=function(H,u){var J=U[u];if(!J)throw new Error(`Unknown component: ${u}.`);return!!J.hash[H]},this.yB=function(u,J){if(!U[J])throw new Error(`Unknown component: ${J}.`);return B(u,J),H},this.getState=function(H,u){var J=U[u];if(!J)throw new Error(`Unknown component: ${u}.`);return J.hash[H]},this.uG=function(H){var u=U[H];if(!u)throw new Error(`Unknown component: ${H}.`);return G(),u.list},this.Zl=function(H){if(!U[H])throw new Error(`Unknown component: ${H}.`);var u=U[H].hash;return H=>u[H]},this.sl=function(H){if(!U[H])throw new Error(`Unknown component: ${H}.`);var u=U[H].hash;return H=>!!u[H]},this.pg=function(J){G();for(var O=0;O<h.length;O++){var w=h[O],g=u[w],B=U[w];g.system(J,B.list),G()}return H},this.render=function(J){G();for(var O=0;O<w.length;O++){var h=w[O],g=u[h],B=U[h];g.Sg(J,B.list),G()}return H},this.removeMultiComponent=function(J,O,h){var w=u[O],B=U[O];if(!B)throw new Error(`Unknown component: ${O}.`);if(!w.multi)throw new Error("removeMultiComponent called on non-multi component");return function(H,u,J,O){var U=J.hash[H];if(U){var h=U[O];h&&(U[O]=null,u.mh&&u.mh(H,h),g.multiComps.push({entID:H,data:J}),b())}}(J,w,B,h),H}};var O=J(14268)},14268:H=>{function u(H,u){var J=H._map[u];if(delete H.hash[u],delete H._map[u],J===H.list.length-1)H.list.pop();else{var O=H.list.pop();if(H.list[J]=O,null===O||null===O[0]){var U=H.list.length;for(var h in H._map)if(H._map[h]===U)return void(H._map[h]=J)}else{var w=O.Xg||O[0].Xg;H._map[w]=J}}}H.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(H,u){if("number"===typeof this._map[H]){var J=this._map[H];this.hash[H]=u,this.list[J]=u}else this._map[H]=this.list.length,this.hash[H]=u,this.list.push(u)}remove(H){var u=this._map[H];this.hash[H]=null,this.list[u]=null,this._pendingRemovals.push(H)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var H=0;H<this._pendingRemovals.length;H++){var J=this._pendingRemovals[H];null===this.hash[J]&&u(this,J)}this._pendingRemovals.length=0}}},14219:H=>{"use strict";var u,J="object"===typeof Reflect?Reflect:null,O=function(H,u,J){return Function.prototype.apply.call(H,u,J)};u=J&&"function"===typeof J.ownKeys?J.ownKeys:Object.getOwnPropertySymbols?function(H){return Object.getOwnPropertyNames(H).concat(Object.getOwnPropertySymbols(H))}:function(H){return Object.getOwnPropertyNames(H)};var U=Number.isNaN||function(H){return H!==H};function h(){h.init.call(this)}H.exports=h,H.exports.once=function(H,u){return new Promise((function(J,O){function U(J){H.removeListener(u,h),O(J)}function h(){"function"===typeof H.removeListener&&H.removeListener("error",U),J([].slice.call(arguments))}r(H,u,h,{once:!0}),"error"!==u&&function(H,u,J){"function"===typeof H.on&&r(H,"error",u,J)}(H,U,{once:!0})}))},h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var w=10;function g(H){if("function"!==typeof H)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof H)}function B(H){return void 0===H._maxListeners?h.defaultMaxListeners:H._maxListeners}function b(H,u,J,O){var U,h,w,b;if(g(J),void 0===(h=H._events)?(h=H._events=Object.create(null),H._eventsCount=0):(void 0!==h.newListener&&(H.emit("newListener",u,J.listener?J.listener:J),h=H._events),w=h[u]),void 0===w)w=h[u]=J,++H._eventsCount;else if("function"===typeof w?w=h[u]=O?[J,w]:[w,J]:O?w.unshift(J):w.push(J),(U=B(H))>0&&w.length>U&&!w.warned){w.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+w.length+" "+String(u)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.Ou=H,d.type=u,d.count=w.length,b=d,console&&console.warn&&console.warn(b)}return H}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function G(H,u,J){var O={fired:!1,wrapFn:void 0,target:H,type:u,listener:J},U=d.bind(O);return U.listener=J,O.wrapFn=U,U}function P(H,u,J){var O=H._events;if(void 0===O)return[];var U=O[u];return void 0===U?[]:"function"===typeof U?J?[U.listener||U]:[U]:J?function(H){for(var u=new Array(H.length),J=0;J<u.length;++J)u[J]=H[J].listener||H[J];return u}(U):l(U,U.length)}function mH(H){var u=this._events;if(void 0!==u){var J=u[H];if("function"===typeof J)return 1;if(void 0!==J)return J.length}return 0}function l(H,u){for(var J=new Array(u),O=0;O<u;++O)J[O]=H[O];return J}function r(H,u,J,O){if("function"===typeof H.on)O.once?H.once(u,J):H.on(u,J);else{if("function"!==typeof H.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof H);H.addEventListener(u,(function U(h){O.once&&H.removeEventListener(u,U),J(h)}))}}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return w},set:function(H){if("number"!==typeof H||H<0||U(H))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+H+".");w=H}}),h.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(H){if("number"!==typeof H||H<0||U(H))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+H+".");return this._maxListeners=H,this},h.prototype.getMaxListeners=function(){return B(this)},h.prototype.emit=function(H){for(var u=[],J=1;J<arguments.length;J++)u.push(arguments[J]);var U="error"===H,h=this._events;if(void 0!==h)U=U&&void 0===h.error;else if(!U)return!1;if(U){var w;if(u.length>0&&(w=u[0]),w instanceof Error)throw w;var g=new Error("Unhandled error."+(w?" ("+w.message+")":""));throw g.context=w,g}var B=h[H];if(void 0===B)return!1;if("function"===typeof B)O(B,this,u);else{var b=B.length,d=l(B,b);for(J=0;J<b;++J)O(d[J],this,u)}return!0},h.prototype.addListener=function(H,u){return b(this,H,u,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(H,u){return b(this,H,u,!0)},h.prototype.once=function(H,u){return g(u),this.on(H,G(this,H,u)),this},h.prototype.prependOnceListener=function(H,u){return g(u),this.prependListener(H,G(this,H,u)),this},h.prototype.removeListener=function(H,u){var J,O,U,h,w;if(g(u),void 0===(O=this._events))return this;if(void 0===(J=O[H]))return this;if(J===u||J.listener===u)0===--this._eventsCount?this._events=Object.create(null):(delete O[H],O.removeListener&&this.emit("removeListener",H,J.listener||u));else if("function"!==typeof J){for(U=-1,h=J.length-1;h>=0;h--)if(J[h]===u||J[h].listener===u){w=J[h].listener,U=h;break}if(U<0)return this;0===U?J.shift():function(H,u){for(;u+1<H.length;u++)H[u]=H[u+1];H.pop()}(J,U),1===J.length&&(O[H]=J[0]),void 0!==O.removeListener&&this.emit("removeListener",H,w||u)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.Uu=function(H){var u,J,O;if(void 0===(J=this._events))return this;if(void 0===J.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==J[H]&&(0===--this._eventsCount?this._events=Object.create(null):delete J[H]),this;if(0===arguments.length){var U,h=Object.keys(J);for(O=0;O<h.length;++O)"removeListener"!==(U=h[O])&&this.Uu(U);return this.Uu("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(u=J[H]))this.removeListener(H,u);else if(void 0!==u)for(O=u.length-1;O>=0;O--)this.removeListener(H,u[O]);return this},h.prototype.listeners=function(H){return P(this,H,!0)},h.prototype.rawListeners=function(H){return P(this,H,!1)},h.listenerCount=function(H,u){return"function"===typeof H.listenerCount?H.listenerCount(u):mH.call(H,u)},h.prototype.listenerCount=mH,h.prototype.eventNames=function(){return this._eventsCount>0?u(this._events):[]}},14514:H=>{"use strict";H.exports=function(H,u,J,O,U,h){var w=+u[0],g=+u[1],B=+u[2],b=+J[0],d=+J[1],G=+J[2],P=Math.sqrt(b*b+d*d+G*G);if(0===P)throw new Error("Can't raycast along a zero vector");return function(H,u,J,O,U,h,w,g,B,b){for(var d=0,G=Math.floor,P=0|G(u),mH=0|G(J),l=0|G(O),r=U>0?1:-1,p=h>0?1:-1,a=w>0?1:-1,k=Math.abs(1/U),C=Math.abs(1/h),j=Math.abs(1/w),M=k<1/0?k*(r>0?P+1-u:u-P):1/0,L=C<1/0?C*(p>0?mH+1-J:J-mH):1/0,Z=j<1/0?j*(a>0?l+1-O:O-l):1/0,Y=-1;d<=g;){var F=H(P,mH,l);if(F)return B&&(B[0]=u+d*U,B[1]=J+d*h,B[2]=O+d*w),b&&(b[0]=b[1]=b[2]=0,0===Y&&(b[0]=-r),1===Y&&(b[1]=-p),2===Y&&(b[2]=-a)),F;M<L?M<Z?(P+=r,d=M,M+=k,Y=0):(l+=a,d=Z,Z+=j,Y=2):L<Z?(mH+=p,d=L,L+=C,Y=1):(l+=a,d=Z,Z+=j,Y=2)}return B&&(B[0]=u+d*U,B[1]=J+d*h,B[2]=O+d*w),b&&(b[0]=b[1]=b[2]=0),0}(H,w,g,B,b/=P,d/=P,G/=P,O="undefined"===typeof O?64:+O,U,h)}},14551:(H,u,J)=>{"use strict";J.d(u,{b:()=>h});var O=J(14219);function U(){this.Mm=!1,this.stopPropagation=!1,this.Lm=!1,this.disabled=!1,this.maxPointerMovement=150}class h{constructor(H,u){this.version="0.7.0";var J=Object.assign({},new U,u||{});this.element=H||document,this.Mm=!!J.Mm,this.stopPropagation=!!J.stopPropagation,this.Lm=!!J.Lm,this.disabled=!!J.disabled,this.filterEvents=(H,u)=>!0,this.down=new O.EventEmitter,this.up=new O.EventEmitter,this.state={},this.od={dx:0,dy:0,mr:0,Dd:0,ll:0},this.maxPointerMovement=J.maxPointerMovement||0,this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?g(this):document.addEventListener("DOMContentLoaded",(H=>{g(this)}),{once:!0})}bind(H){for(var u=arguments.length,J=new Array(u>1?u-1:0),O=1;O<u;O++)J[O-1]=arguments[O];J.forEach((u=>{var J=this._keyBindmap[u]||[];J.includes(H)||(J.push(H),this._keyBindmap[u]=J)})),this.state[H]=!!this.state[H],this.pressCount[H]=this.pressCount[H]||0,this.releaseCount[H]=this.releaseCount[H]||0}unbind(H){for(var u in this._keyBindmap){var J=this._keyBindmap[u],O=J.indexOf(H);O>-1&&J.splice(O,1)}}getBindings(){var H={};for(var u in this._keyBindmap){this._keyBindmap[u].forEach((J=>{H[J]=H[J]||[],H[J].push(u)}))}return H}pg(){w(this.od),w(this.pressCount),w(this.releaseCount)}}function w(H){for(var u in H)H[u]=0}function g(H){window.addEventListener("keydown",l.bind(null,H,!0),!1),window.addEventListener("keyup",l.bind(null,H,!1),!1);var u={passive:!0};H.element.addEventListener("touchstart",G.bind(void 0,H),{passive:!1}),H.element.addEventListener("touchend",mH.bind(void 0,H),u),H.element.addEventListener("mousedown",r.bind(null,H,!0),u),window.document.addEventListener("mouseup",r.bind(null,H,!1),u),H.element.addEventListener("touchmove",p.bind(null,H),u),H.element.addEventListener("mousemove",p.bind(null,H),u),window.PointerEvent,H.element.addEventListener("wheel",j.bind(null,H),u),H.element.addEventListener("contextmenu",M.bind(null,H),!1),window.addEventListener("blur",L.bind(null,H),!1)}var B=0,b=0,d=null;function G(H,u){u.preventDefault(),P(u)}function P(H){let u=!1;for(let J=0;J<H.touches.length;++J)if(H.touches[J].identifier===d){u=!0;break}if(!u){const u=H.changedTouches[0];B=u.clientX,b=u.clientY,d=u.identifier}}function mH(H,u){for(var J=u.changedTouches,O=0;O<J.length;++O)J[O].identifier===d&&(d=null)}function l(H,u,J){Z(J.code,u,H,J)}function r(H,u,J){if("pointerId"in J)if(u){if(null!==H._touches.currID)return;H._touches.currID=J.pointerId}else{if(H._touches.currID!==J.pointerId)return;H._touches.currID=null}return Z("Mouse"+("button"in J?J.button+1:1),u,H,J),!1}function p(H,u){var J=u.movementX||u.mozMovementX||0,O=u.movementY||u.mozMovementY||0;if(u.touches&&0===(J|O)){var U=function(H){P(H);for(let u=0;u<H.changedTouches.length;++u)if(H.changedTouches[u].identifier==d){const J=H.changedTouches[u],O=[J.clientX-B,J.clientY-b];return B=J.clientX,b=J.clientY,O}return console.error(`Did not find touch id ${d}`),[0,0]}(u);J=U[0],O=U[1]}if(H.maxPointerMovement>0){var h=Math.abs(J-a),w=Math.abs(O-k),g=h>H.maxPointerMovement&&h/Math.abs(a||1)>12,G=w>H.maxPointerMovement&&w/Math.abs(k||1)>12,mH=u.timeStamp;mH-(C??mH)<20&&(g||G)||(H.od.dx+=J,H.od.dy+=O,a=J||1,k=O||1),C=mH}}var a=0,k=0,C=null;function j(H,u){var J=1;switch(u.deltaMode){case 0:J=1;break;case 1:J=12;break;case 2:J=H.element.clientHeight||window.innerHeight}H.od.mr+=(u.deltaX||0)*J,H.od.Dd+=(u.deltaY||0)*J,H.od.ll+=(u.deltaZ||0)*J}function M(H,u){if(!H.Lm)return u.preventDefault(),!1}function L(H){for(var u in H._keyStates)H._keyStates[u]&&(/^Mouse\d/.test(u)||Z(u,!1,H,{code:u,note:"ng8obvy9hb",preventDefault:()=>{},stopPropagation:()=>{}}))}function Z(H,u,J,O){var U=J._keyBindmap[H];U&&(Y(J._keyStates[H],u)&&(J._keyStates[H]=u,U.forEach((H=>{(!J.filterEvents||J.filterEvents(O,H))&&function(H,u,J,O){var U=u?J.pressCount:J.releaseCount;U[H]=(U[H]||0)+1;var h=J._bindPressCount[H]||0;(h+=u?1:-1)<0&&(h=0);J._bindPressCount[H]=h;var w=J.state[H];if(Y(w,h)){J.state[H]=h>0;var g=u?J.down:J.up;J.disabled||g.emit(H,O)}}(H,u,J,O)}))),"button"in O||(J.Mm&&!O.defaultPrevented&&O.preventDefault(),J.stopPropagation&&O.stopPropagation()))}function Y(H,u){return H?!u:u}},13212:H=>{H.exports=function(H,u,J){return H[0]=u[0]+J[0],H[1]=u[1]+J[1],H[2]=u[2]+J[2],H}},13156:(H,u,J)=>{H.exports=function(H,u){var J=O(H[0],H[1],H[2]),w=O(u[0],u[1],u[2]);U(J,J),U(w,w);var g=h(J,w);return g>1?0:Math.acos(g)};var O=J(13164),U=J(13172),h=J(13179)},13266:H=>{H.exports=function(H,u){return H[0]=Math.ceil(u[0]),H[1]=Math.ceil(u[1]),H[2]=Math.ceil(u[2]),H}},13152:H=>{H.exports=function(H){var u=new Float32Array(3);return u[0]=H[0],u[1]=H[1],u[2]=H[2],u}},13188:H=>{H.exports=function(H,u){return H[0]=u[0],H[1]=u[1],H[2]=u[2],H}},13148:H=>{H.exports=function(){var H=new Float32Array(3);return H[0]=0,H[1]=0,H[2]=0,H}},13320:H=>{H.exports=function(H,u,J){var O=u[0],U=u[1],h=u[2],w=J[0],g=J[1],B=J[2];return H[0]=U*B-h*g,H[1]=h*w-O*B,H[2]=O*g-U*w,H}},13287:(H,u,J)=>{H.exports=J(13285)},13285:H=>{H.exports=function(H,u){var J=u[0]-H[0],O=u[1]-H[1],U=u[2]-H[2];return Math.sqrt(J*J+O*O+U*U)}},13248:(H,u,J)=>{H.exports=J(13243)},13243:H=>{H.exports=function(H,u,J){return H[0]=u[0]/J[0],H[1]=u[1]/J[1],H[2]=u[2]/J[2],H}},13179:H=>{H.exports=function(H,u){return H[0]*u[0]+H[1]*u[1]+H[2]*u[2]}},13145:H=>{H.exports=1e-6},13204:(H,u,J)=>{H.exports=function(H,u){var J=H[0],U=H[1],h=H[2],w=u[0],g=u[1],B=u[2];return Math.abs(J-w)<=O*Math.max(1,Math.abs(J),Math.abs(w))&&Math.abs(U-g)<=O*Math.max(1,Math.abs(U),Math.abs(g))&&Math.abs(h-B)<=O*Math.max(1,Math.abs(h),Math.abs(B))};var O=J(13145)},13208:H=>{H.exports=function(H,u){return H[0]===u[0]&&H[1]===u[1]&&H[2]===u[2]}},13262:H=>{H.exports=function(H,u){return H[0]=Math.floor(u[0]),H[1]=Math.floor(u[1]),H[2]=Math.floor(u[2]),H}},13378:(H,u,J)=>{H.exports=function(H,u,J,U,h,w){var g,B;u||(u=3);J||(J=0);B=U?Math.min(U*u+J,H.length):H.length;for(g=J;g<B;g+=u)O[0]=H[g],O[1]=H[g+1],O[2]=H[g+2],h(O,O,w),H[g]=O[0],H[g+1]=O[1],H[g+2]=O[2];return H};var O=J(13148)()},13164:H=>{H.exports=function(H,u,J){var O=new Float32Array(3);return O[0]=H,O[1]=u,O[2]=J,O}},13137:(H,u,J)=>{H.exports={EPSILON:J(13145),create:J(13148),clone:J(13152),angle:J(13156),ug:J(13164),i:J(13188),set:J(13195),equals:J(13204),exactEquals:J(13208),add:J(13212),ru:J(13216),sub:J(13220),multiply:J(13227),mul:J(13234),divide:J(13243),div:J(13248),min:J(13251),max:J(13260),floor:J(13262),ceil:J(13266),round:J(13273),scale:J(13280),Jg:J(13283),distance:J(13285),k:J(13287),squaredDistance:J(13292),sqrDist:J(13294),length:J(13296),len:J(13299),squaredLength:J(13301),hg:J(13310),negate:J(13312),inverse:J(13317),normalize:J(13172),dot:J(13179),cross:J(13320),qw:J(13328),random:J(13337),transformMat4:J(13343),transformMat3:J(13345),transformQuat:J(13351),gg:J(13359),Bg:J(13368),bg:J(13370),forEach:J(13378)}},13317:H=>{H.exports=function(H,u){return H[0]=1/u[0],H[1]=1/u[1],H[2]=1/u[2],H}},13299:(H,u,J)=>{H.exports=J(13296)},13296:H=>{H.exports=function(H){var u=H[0],J=H[1],O=H[2];return Math.sqrt(u*u+J*J+O*O)}},13328:H=>{H.exports=function(H,u,J,O){var U=u[0],h=u[1],w=u[2];return H[0]=U+O*(J[0]-U),H[1]=h+O*(J[1]-h),H[2]=w+O*(J[2]-w),H}},13260:H=>{H.exports=function(H,u,J){return H[0]=Math.max(u[0],J[0]),H[1]=Math.max(u[1],J[1]),H[2]=Math.max(u[2],J[2]),H}},13251:H=>{H.exports=function(H,u,J){return H[0]=Math.min(u[0],J[0]),H[1]=Math.min(u[1],J[1]),H[2]=Math.min(u[2],J[2]),H}},13234:(H,u,J)=>{H.exports=J(13227)},13227:H=>{H.exports=function(H,u,J){return H[0]=u[0]*J[0],H[1]=u[1]*J[1],H[2]=u[2]*J[2],H}},13312:H=>{H.exports=function(H,u){return H[0]=-u[0],H[1]=-u[1],H[2]=-u[2],H}},13172:H=>{H.exports=function(H,u){var J=u[0],O=u[1],U=u[2],h=J*J+O*O+U*U;h>0&&(h=1/Math.sqrt(h),H[0]=u[0]*h,H[1]=u[1]*h,H[2]=u[2]*h);return H}},13337:H=>{H.exports=function(H,u){u=u||1;var J=2*Math.random()*Math.PI,O=2*Math.random()-1,U=Math.sqrt(1-O*O)*u;return H[0]=Math.cos(J)*U,H[1]=Math.sin(J)*U,H[2]=O*u,H}},13359:H=>{H.exports=function(H,u,J,O){var U=J[1],h=J[2],w=u[1]-U,g=u[2]-h,B=Math.sin(O),b=Math.cos(O);return H[0]=u[0],H[1]=U+w*b-g*B,H[2]=h+w*B+g*b,H}},13368:H=>{H.exports=function(H,u,J,O){var U=J[0],h=J[2],w=u[0]-U,g=u[2]-h,B=Math.sin(O),b=Math.cos(O);return H[0]=U+g*B+w*b,H[1]=u[1],H[2]=h+g*b-w*B,H}},13370:H=>{H.exports=function(H,u,J,O){var U=J[0],h=J[1],w=u[0]-U,g=u[1]-h,B=Math.sin(O),b=Math.cos(O);return H[0]=U+w*b-g*B,H[1]=h+w*B+g*b,H[2]=u[2],H}},13273:H=>{H.exports=function(H,u){return H[0]=Math.round(u[0]),H[1]=Math.round(u[1]),H[2]=Math.round(u[2]),H}},13280:H=>{H.exports=function(H,u,J){return H[0]=u[0]*J,H[1]=u[1]*J,H[2]=u[2]*J,H}},13283:H=>{H.exports=function(H,u,J,O){return H[0]=u[0]+J[0]*O,H[1]=u[1]+J[1]*O,H[2]=u[2]+J[2]*O,H}},13195:H=>{H.exports=function(H,u,J,O){return H[0]=u,H[1]=J,H[2]=O,H}},13294:(H,u,J)=>{H.exports=J(13292)},13310:(H,u,J)=>{H.exports=J(13301)},13292:H=>{H.exports=function(H,u){var J=u[0]-H[0],O=u[1]-H[1],U=u[2]-H[2];return J*J+O*O+U*U}},13301:H=>{H.exports=function(H){var u=H[0],J=H[1],O=H[2];return u*u+J*J+O*O}},13220:(H,u,J)=>{H.exports=J(13216)},13216:H=>{H.exports=function(H,u,J){return H[0]=u[0]-J[0],H[1]=u[1]-J[1],H[2]=u[2]-J[2],H}},13345:H=>{H.exports=function(H,u,J){var O=u[0],U=u[1],h=u[2];return H[0]=O*J[0]+U*J[3]+h*J[6],H[1]=O*J[1]+U*J[4]+h*J[7],H[2]=O*J[2]+U*J[5]+h*J[8],H}},13343:H=>{H.exports=function(H,u,J){var O=u[0],U=u[1],h=u[2],w=J[3]*O+J[7]*U+J[11]*h+J[15];return w=w||1,H[0]=(J[0]*O+J[4]*U+J[8]*h+J[12])/w,H[1]=(J[1]*O+J[5]*U+J[9]*h+J[13])/w,H[2]=(J[2]*O+J[6]*U+J[10]*h+J[14])/w,H}},13351:H=>{H.exports=function(H,u,J){var O=u[0],U=u[1],h=u[2],w=J[0],g=J[1],B=J[2],b=J[3],d=b*O+g*h-B*U,G=b*U+B*O-w*h,P=b*h+w*U-g*O,mH=-w*O-g*U-B*h;return H[0]=d*b+mH*-w+G*-B-P*-g,H[1]=G*b+mH*-g+P*-w-d*-B,H[2]=P*b+mH*-B+d*-g-G*-w,H}},14243:H=>{"use strict";H.exports=function(H){for(var u=new Array(H),J=0;J<H;++J)u[J]=J;return u}},14308:H=>{H.exports=function(H){return null!=H&&null!=H.constructor&&"function"===typeof H.constructor.isBuffer&&H.constructor.isBuffer(H)}},14517:(H,u,J)=>{"use strict";J.d(u,{e:()=>O});class O{constructor(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.OP=!1,this.UP=!1,this.uP=30,this.JP=0,this.PP=!1,this.fullscreen=!1,this.wP=function(H){},this.gP=function(){},this.dP=function(){},this.hh=function(){},this.BP=function(H){},this.onFullscreenChanged=function(H){},b((()=>{!function(H,u){H._nowObject=performance||Date,H._lastTick=0,H._renderAccum=0,H._rt=0,H._frameCB=g.bind(null,H),requestAnimationFrame(H._frameCB),u>0&&(H._intervalCB=w.bind(null,H),H._interval=setInterval(H._intervalCB,Math.max(u,1e3/H.uP/2)))}(this,u),function(H,u){if(!u)return;var J=!1,O=!1;document.addEventListener("pointerlockchange",(O=>{J=document.pointerLockElement===u,H.BP(J)})),document.addEventListener("fullscreenchange",(J=>{O=document.fullscreenElement===u,H.onFullscreenChanged(O)})),Object.defineProperty(H,"PP",{get:()=>J,set:H=>{H&&!J?B(u):J&&!H&&function(H){H.exitPointerLock&&H.exitPointerLock()}(document)}}),Object.defineProperty(H,"fullscreen",{get:()=>O,set:H=>{H&&!O?u.requestFullscreen():O&&!H&&document.exitFullscreen()}}),u.addEventListener("click",(U=>{H.OP&&!J&&B(u),H.UP&&!O&&u.requestFullscreen()}));var U=()=>H.hh();if(window.ResizeObserver){new ResizeObserver(U).observe(u)}else window.addEventListener("resize",U)}(this,H),this.dP()}))}}var U=3,h=20;function w(H){for(var u=1e3/H.uP,J=H._nowObject.now()+h,O=0;H._nowObject.now()>=H._lastTick+u&&H._nowObject.now()<J&&++O<=U;)H.wP(u),H._lastTick+=u;var w=5*(u+5),g=H._nowObject.now();if(g-H._lastTick>w)for(;g>=H._lastTick+u;)H._lastTick+=u}function g(H){requestAnimationFrame(H._frameCB),w(H);var u=H._nowObject.now(),J=u-H._rt;if(H._rt=u,H.JP>0){H._renderAccum+=J;var O=1e3/H.JP;if(H._renderAccum<O)return;H._renderAccum=Math.min(H._renderAccum-O,O)}var U=1e3/H.uP,h=(u-H._lastTick)/U;H.gP(J,h,U)}function B(H){H.requestPointerLock&&H.requestPointerLock()}var b=H=>{if("loading"===document.readyState){var u=()=>{document.removeEventListener("readystatechange",u),H()};document.addEventListener("readystatechange",u)}else setTimeout(H,1)}},14241:(H,u,J)=>{var O=J(14243),U=J(14251),h="undefined"!==typeof Float64Array;function w(H,u){return H[0]-u[0]}function g(){var H,u=this.stride,J=new Array(u.length);for(H=0;H<J.length;++H)J[H]=[Math.abs(u[H]),H];J.sort(w);var O=new Array(J.length);for(H=0;H<O.length;++H)O[H]=J[H][1];return O}function B(H,u){var J=["View",u,"d",H].join("");u<0&&(J="View_Nil"+H);var U="generic"===H;if(-1===u){var h="function "+J+"(a){this.data=a;};var proto="+J+".prototype;proto.dtype='"+H+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+J+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+J+"(a){return new "+J+"(a);}";return new Function(h)()}if(0===u){h="function "+J+"(a,d) {this.data = a;this.offset = d};var proto="+J+".prototype;proto.dtype='"+H+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+J+"_copy() {return new "+J+"(this.data,this.offset)};proto.pick=function "+J+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+J+"_get(){return "+(U?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+J+"_set(v){return "+(U?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+J+"(a,b,c,d){return new "+J+"(a,d)}";return new Function("TrivialArray",h)(b[H][0])}h=["'use strict'"];var w=O(u),B=w.map((function(H){return"i"+H})),d="this.offset+"+w.map((function(H){return"this.stride["+H+"]*i"+H})).join("+"),G=w.map((function(H){return"b"+H})).join(","),P=w.map((function(H){return"c"+H})).join(",");h.push("function "+J+"(a,"+G+","+P+",d){this.data=a","this.shape=["+G+"]","this.stride=["+P+"]","this.offset=d|0}","var proto="+J+".prototype","proto.dtype='"+H+"'","proto.dimension="+u),h.push("Object.defineProperty(proto,'size',{get:function "+J+"_size(){return "+w.map((function(H){return"this.shape["+H+"]"})).join("*"),"}})"),1===u?h.push("proto.order=[0]"):(h.push("Object.defineProperty(proto,'order',{get:"),u<4?(h.push("function "+J+"_order(){"),2===u?h.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===u&&h.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):h.push("ORDER})")),h.push("proto.set=function "+J+"_set("+B.join(",")+",v){"),U?h.push("return this.data.set("+d+",v)}"):h.push("return this.data["+d+"]=v}"),h.push("proto.get=function "+J+"_get("+B.join(",")+"){"),U?h.push("return this.data.get("+d+")}"):h.push("return this.data["+d+"]}"),h.push("proto.index=function "+J+"_index(",B.join(),"){return "+d+"}"),h.push("proto.hi=function "+J+"_hi("+B.join(",")+"){return new "+J+"(this.data,"+w.map((function(H){return["(typeof i",H,"!=='number'||i",H,"<0)?this.shape[",H,"]:i",H,"|0"].join("")})).join(",")+","+w.map((function(H){return"this.stride["+H+"]"})).join(",")+",this.offset)}");var mH=w.map((function(H){return"a"+H+"=this.shape["+H+"]"})),l=w.map((function(H){return"c"+H+"=this.stride["+H+"]"}));h.push("proto.lo=function "+J+"_lo("+B.join(",")+"){var b=this.offset,d=0,"+mH.join(",")+","+l.join(","));for(var r=0;r<u;++r)h.push("if(typeof i"+r+"==='number'&&i"+r+">=0){d=i"+r+"|0;b+=c"+r+"*d;a"+r+"-=d}");h.push("return new "+J+"(this.data,"+w.map((function(H){return"a"+H})).join(",")+","+w.map((function(H){return"c"+H})).join(",")+",b)}"),h.push("proto.step=function "+J+"_step("+B.join(",")+"){var "+w.map((function(H){return"a"+H+"=this.shape["+H+"]"})).join(",")+","+w.map((function(H){return"b"+H+"=this.stride["+H+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(r=0;r<u;++r)h.push("if(typeof i"+r+"==='number'){d=i"+r+"|0;if(d<0){c+=b"+r+"*(a"+r+"-1);a"+r+"=ceil(-a"+r+"/d)}else{a"+r+"=ceil(a"+r+"/d)}b"+r+"*=d}");h.push("return new "+J+"(this.data,"+w.map((function(H){return"a"+H})).join(",")+","+w.map((function(H){return"b"+H})).join(",")+",c)}");var p=new Array(u),a=new Array(u);for(r=0;r<u;++r)p[r]="a[i"+r+"]",a[r]="b[i"+r+"]";h.push("proto.transpose=function "+J+"_transpose("+B+"){"+B.map((function(H,u){return H+"=("+H+"===undefined?"+u+":"+H+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+J+"(this.data,"+p.join(",")+","+a.join(",")+",this.offset)}"),h.push("proto.pick=function "+J+"_pick("+B+"){var a=[],b=[],c=this.offset");for(r=0;r<u;++r)h.push("if(typeof i"+r+"==='number'&&i"+r+">=0){c=(c+this.stride["+r+"]*i"+r+")|0}else{a.push(this.shape["+r+"]);b.push(this.stride["+r+"])}");return h.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),h.push("return function construct_"+J+"(data,shape,stride,offset){return new "+J+"(data,"+w.map((function(H){return"shape["+H+"]"})).join(",")+","+w.map((function(H){return"stride["+H+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",h.join("\n"))(b[H],g)}var b={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};H.exports=function(H,u,J,O){if(void 0===H)return(0,b.array[0])([]);"number"===typeof H&&(H=[H]),void 0===u&&(u=[H.length]);var w=u.length;if(void 0===J){J=new Array(w);for(var g=w-1,d=1;g>=0;--g)J[g]=d,d*=u[g]}if(void 0===O){O=0;for(g=0;g<w;++g)J[g]<0&&(O-=(u[g]-1)*J[g])}for(var G=function(H){if(U(H))return"buffer";if(h)switch(Object.prototype.toString.call(H)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(H)?"array":"generic"}(H),P=b[G];P.length<=w+1;)P.push(B(G,P.length-1));return(0,P[w+1])(H,u,J,O)}},14251:H=>{function u(H){return!!H.constructor&&"function"===typeof H.constructor.isBuffer&&H.constructor.isBuffer(H)}H.exports=function(H){return null!=H&&(u(H)||function(H){return"function"===typeof H.readFloatLE&&"function"===typeof H.slice&&u(H.slice(0,0))}(H)||!!H._isBuffer)}},14394:H=>{"use strict";var u=[],J=[],O=[],U=[],h=[],w=[],g=[],B=[],b=[],d=[],G=[],P=[];H.exports=function(H,mH,l,r,p,a){for(var k=g,C=b,j=d,M=P,L=0;L<3;L++)k[L]=+l[L],j[L]=+mH.max[L],C[L]=+mH.base[L];a||(a=1e-10);var Z=function(H,g,b,d,P,mH){var l=u,r=J,p=O,a=U,k=h,C=w,j=B,M=Math.floor,L=0,Z=0,Y=0,F=0,s=0;if(A(),0===Y)return 0;for(F=c();Z<=Y;){if(t(F)&&e())return L;F=c()}for(L+=Y,s=0;s<3;s++)d[s]+=b[s],P[s]+=b[s];return L;function A(){if(Z=0,0!==(Y=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2])))for(var H=0;H<3;H++){var u=b[H]>=0;a[H]=u?1:-1;var J=u?P[H]:d[H];l[H]=u?d[H]:P[H],r[H]=n(J,a[H]),p[H]=V(l[H],a[H]),j[H]=b[H]/Y,k[H]=Math.abs(1/j[H]);var O=u?r[H]+1-J:J-r[H];C[H]=k[H]<1/0?k[H]*O:1/0}}function t(u){for(var J=a[0],O=0===u?r[0]:p[0],U=r[0]+J,h=a[1],w=1===u?r[1]:p[1],g=r[1]+h,B=a[2],b=2===u?r[2]:p[2],d=r[2]+B,G=O;G!=U;G+=J)for(var P=w;P!=g;P+=h)for(var mH=b;mH!=d;mH+=B)if(H(G,P,mH))return!0;return!1}function e(){L+=Z;var H=a[F],u=Z/Y,J=G;for(s=0;s<3;s++){var O=b[s]*u;d[s]+=O,P[s]+=O,J[s]=b[s]-O}if(H>0?P[F]=Math.round(P[F]):d[F]=Math.round(d[F]),g(L,F,H,J))return!0;for(s=0;s<3;s++)b[s]=J[s];return A(),0===Y}function c(){var H=C[0]<C[1]?C[0]<C[2]?0:2:C[1]<C[2]?1:2,u=C[H]-Z;for(Z=C[H],r[H]+=a[H],C[H]+=k[H],s=0;s<3;s++)l[s]+=u*j[s],p[s]=V(l[s],a[s]);return H}function n(H,u){return M(H-u*mH)}function V(H,u){return M(H+u*mH)}}(H,r,k,C,j,a);if(!p){for(L=0;L<3;L++)M[L]=l[L]>0?j[L]-mH.max[L]:C[L]-mH.base[L];mH.translate(M)}return Z}},14554:(H,u,J)=>{"use strict";J.d(u,{e:()=>G});var O=J(14385),U=J(13137);class h{constructor(H,u,J,h,w,g,B){this.HG=new O(H.base,H.pG),this.TO=u,this.friction=J,this.restitution=h,this.Dw=w,this.Rl=g,this.ow=!!B,this.rG=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Mr=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Jd=U.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=U.create(),this._impulses=U.create(),this._sleepFrameCount=10}loadFromCopy(H){U.i(this.HG.base,H.HG.base),U.i(this.HG.pG,H.HG.pG),U.i(this.HG.max,H.HG.max),this.HG.mag=H.HG.mag,this.TO=H.TO,this.friction=H.friction,this.restitution=H.restitution,this.Dw=H.Dw,this.Rl=H.Rl,this.ow=H.ow,this.rG=H.rG,this.fluidDrag=H.fluidDrag,this.Mr=H.Mr,this.preventFallOffEdge=H.preventFallOffEdge,this.rolledBackLastTick=H.rolledBackLastTick,U.i(this.Jd,H.Jd),U.i(this.resting,H.resting),this.inFluid=H.inFluid,this._ratioInFluid=H._ratioInFluid,U.i(this._forces,H._forces),U.i(this._impulses,H._impulses),this._sleepFrameCount=H._sleepFrameCount}setPosition(H){w(H),U.ru(H,H,this.HG.base),this.HG.translate(H),this.mG()}dh(){return U.clone(this.HG.base)}applyForce(H){w(H),U.add(this._forces,this._forces,H),this.mG()}applyImpulse(H){w(H),U.add(this._impulses,this._impulses,H),this.mG()}mG(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var w=H=>{};var g=J(14385),B=J(13137),b=J(14394);function d(){this.rG=.1,this.fluidDrag=.4,this.Nw=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function G(H,u,J){H=Object.assign(new d,H),this.gravity=H.gravity||[0,-10,0],this.rG=H.rG||.1,this.Nw=H.Nw||2,this.fluidDrag=H.fluidDrag||.4,this.minBounceImpulse=H.minBounceImpulse,this.bodies=[],this.Ol=H.Ol,this.testSolid=u,this.testFluid=J}G.prototype.Il=function(H,u,J,O,U,w){H=H||new g([0,0,0],[1,1,1]),"undefined"==typeof u&&(u=1),"undefined"==typeof J&&(J=1),"undefined"==typeof O&&(O=0),"undefined"==typeof U&&(U=1);var B=new h(H,u,J,O,U,w);return this.bodies.push(B),B},G.prototype.Dl=function(H){var u=this.bodies.indexOf(H);u<0||(this.bodies.splice(u,1),H.HG=H.Rl=null)};var P=B.create(),mH=B.create(),l=B.create(),r=B.create(),p=B.create(),a=B.create(),k=B.create(),C=new g([0,0,0],[1,1,1]),j=new h(C,1,1,0,1,(()=>{}),!1);function M(H,u,J){return u=J,u*=1-(1-H.ratioInFluid)**2}G.prototype.pg=function(H){H/=1e3;var u=f(0,B.squaredLength(this.gravity));this.bodies.forEach((J=>function(H,u,J,O){B.i(p,u.resting),H.Ol&&j.loadFromCopy(u);if(u.TO<=0)return B.set(u.Jd,0,0,0),B.set(u._forces,0,0,0),void B.set(u._impulses,0,0,0);var U=O||0===u.Dw;if(function(H,u,J,O){if(u._sleepFrameCount>0)return!1;if(O)return!0;var U=!1,h=.5*J*J*u.Dw;return B.scale(W,H.gravity,h),b(H.testSolid,u.HG,W,(function(){return U=!0,!0}),!0),U}(H,u,J,U))return;u._sleepFrameCount--,function(H,u){var J=u.HG,O=Math.floor(J.base[0]),U=Math.floor(J.base[2]),h=Math.floor(J.base[1]),w=Math.floor(J.max[1]);if(!H.testFluid(O,h,U))return u.inFluid=!1,void(u.ratioInFluid=0);var g=1,b=h+1;for(;b<=w&&H.testFluid(O,b,U);)g++,b++;var d=(h+g-J.base[1])/J.pG[1];d>1&&(d=1);var G=J.pG[0]*J.pG[1]*J.pG[2]*d,P=Z;B.scale(P,H.gravity,-H.Nw*G*u.Dw),u.applyForce(P),u.inFluid=!0,u.ratioInFluid=d}(H,u),S(u._forces),S(u._impulses),S(u.Jd),S(u.resting),B.scale(P,u._forces,1/u.TO),B.Jg(P,P,H.gravity,u.Dw),B.scale(mH,u._impulses,1/u.TO),B.Jg(mH,mH,P,J),B.add(u.Jd,u.Jd,mH),u.friction&&(Y(H,0,u,mH,J),Y(H,1,u,mH,J),Y(H,2,u,mH,J));var h=u.fluidDrag>=0?u.fluidDrag:H.fluidDrag,w=u.rG>=0?u.rG:H.rG,g=w,d=w;u.inFluid&&(g=M(u,g,u.fluidDragHoriz>=0?u.fluidDragHoriz:h),d=M(u,d,u.fluidDragVert>=0?u.fluidDragVert:h));g=Math.max(1-g*J/u.TO,0),d=Math.max(1-d*J/u.TO,0),B.set(L,g,d,g),B.multiply(u.Jd,u.Jd,L),B.scale(l,u.Jd,J),B.set(u._forces,0,0,0),B.set(u._impulses,0,0,0),u.ow&&i(A,u.HG);B.i(a,l),B.set(k,0,0,0),u.preventFallOffEdge&&function(H,u,J,O){if(!u.resting[1]||J[1]>0)return;var U=T;i(U,u.HG);for(var h=0;h<3;h+=2){B.set(V,0,0,0),V[h]=J[h];var w=!0;(w=(w=(w=(w=w&&!X(H,U.base[0]+V[0]+1e-5,U.base[1],U.base[2]+V[2]+1e-5))&&!X(H,U.max[0]+V[0]-1e-5,U.base[1],U.base[2]+V[2]+1e-5))&&!X(H,U.base[0]+V[0]+1e-5,U.base[1],U.max[2]+V[2]-1e-5))&&!X(H,U.max[0]+V[0]-1e-5,U.base[1],U.max[2]+V[2]-1e-5))?(O[h]=J[h]>0?1:-1,J[h]=0):0===h&&(B.set(R,J[0],0,0),s(H,U,R,O,u.slideOnCollision))}}(H,u,l,k);s(H,u.HG,l,u.resting,u.slideOnCollision),u.ow&&function(H,u,J,O){if(u.resting[1]>=0&&!u.inFluid)return;var U=0!==u.resting[0],h=0!==u.resting[2];if(!U&&!h)return;var w=Math.abs(O[0]/O[2]),g=4;if(!U&&w>g)return;if(!h&&w<1/g)return;B.add(e,J.base,O);var d=H.testSolid;b(d,J,O,(function(H,u,J,O){if(1!==u)return!0;O[u]=0}));var G=J.base[1],P=u.inFluid?1.951:1.001,mH=Math.floor(G+P)-G;B.set(c,0,mH,0);var l=!1;if(b(d,J,c,(function(H,u,J,O){return l=!0,!0})),l)return;B.ru(n,e,J.base),n[1]=0,s(H,J,n,t,!0);var r=f(J.base[0],e[0]),p=f(J.base[2],e[2]);if(U&&!r&&(!p||!h))return;if(h&&(!r||!U)&&!p)return;var a=!0;if(a=a&&!X(H,J.base[0]+1e-5,J.base[1],J.base[2]+1e-5),a=a&&!X(H,J.max[0]-1e-5,J.base[1],J.base[2]+1e-5),a=a&&!X(H,J.base[0]+1e-5,J.base[1],J.max[2]-1e-5),a=a&&!X(H,J.max[0]-1e-5,J.base[1],J.max[2]-1e-5),a)return;i(u.HG,J),u.resting[0]=t[0],u.resting[2]=t[2],u.Mr&&u.Mr()}(H,u,A,a);for(var G=0;G<3;++G)u.resting[G]=u.resting[G]||k[G],r[G]=0,u.resting[G]&&(p[G]||(r[G]=-u.Jd[G]),u.Jd[G]=0);var C=B.length(r);C>.001&&(B.scale(r,r,u.TO),u.Rl&&u.Rl(r),u.restitution>0&&C>H.minBounceImpulse&&(B.scale(r,r,u.restitution),u.applyImpulse(r)));var F=B.squaredLength(u.Jd);F>1e-5&&u.mG();H.Ol&&H.Ol(u)?(u.loadFromCopy(j),u.rolledBackLastTick=!0):u.rolledBackLastTick=!1}(this,J,H,u)))};var L=B.create([0,0,0]);var Z=B.create();function Y(H,u,J,O,U){var h=J.resting[u],w=O[u];if(!J.alwaysApplyHorizFriction||1!==u){if(0===h)return;if(h*w<=0)return}B.i(F,J.Jd),F[u]=0;var g=B.length(F);if(!f(g,0)){var b=Math.abs(J.friction*H.gravity[u]*U),d=g>b?(g-b)/g:0;J.Jd[(u+1)%3]*=d,J.Jd[(u+2)%3]*=d}}var F=B.create();function s(H,u,J,O,U){return B.set(O,0,0,0),b(H.testSolid,u,J,(function(H,u,J,h){O[u]=J,h[u]=0,U||(h[0]=0,h[1]=0,h[2]=0)}))}var A=new g([],[]),t=B.create(),e=B.create(),c=B.create(),n=B.create();var V=B.create(),T=new g([],[]),R=B.create();function X(H,u,J,O){return H.testSolid(Math.floor(u),Math.floor(J-1),Math.floor(O))}var W=B.create();function f(H,u){return Math.abs(H-u)<1e-5}function i(H,u){for(var J=0;J<3;J++)H.base[J]=u.base[J],H.max[J]=u.max[J],H.pG[J]=u.pG[J]}var S=function(H){}},13011:function(H,u){!function(H){"use strict";var u=function(H,J){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(H,u){H.__proto__=u}||function(H,u){for(var J in u)Object.prototype.hasOwnProperty.call(u,J)&&(H[J]=u[J])},u(H,J)};function J(H,J){if("function"!==typeof J&&null!==J)throw new TypeError("Class extends value "+String(J)+" is not a constructor or null");function O(){this.constructor=H}u(H,J),H.prototype=null===J?Object.create(J):(O.prototype=J.prototype,new O)}function O(H,u,J,O){var U,h=arguments.length,w=h<3?u:null===O?O=Object.getOwnPropertyDescriptor(u,J):O;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)w=Reflect.decorate(H,u,J,O);else for(var g=H.length-1;g>=0;g--)(U=H[g])&&(w=(h<3?U(w):h>3?U(u,J,w):U(u,J))||w);return h>3&&w&&Object.defineProperty(u,J,w),w}function U(H,u,J){if(J||2===arguments.length)for(var O,U=0,h=u.length;U<h;U++)!O&&U in u||(O||(O=Array.prototype.slice.call(u,0,U)),O[U]=u[U]);return H.concat(O||Array.prototype.slice.call(u))}var h,w=255,g=213;H.OPERATION=void 0,(h=H.OPERATION||(H.OPERATION={}))[h.ADD=128]="ADD",h[h.REPLACE=0]="REPLACE",h[h.DELETE=64]="DELETE",h[h.DELETE_AND_ADD=192]="DELETE_AND_ADD",h[h.TOUCH=1]="TOUCH",h[h.CLEAR=10]="CLEAR";var B=function(){function u(H,u,J){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=H,this.setParent(u,J)}return u.prototype.setParent=function(H,u,J){var O=this;if(this.indexes||(this.indexes=this.ref instanceof nH?this.ref._definition.indexes:{}),this.parent=H,this.parentIndex=J,u)if(this.root=u,this.ref instanceof nH){var U=this.ref._definition;for(var h in U.schema){var w=this.ref[h];if(w&&w.$changes){var g=U.indexes[h];w.$changes.setParent(this.ref,u,g)}}}else"object"===typeof this.ref&&this.ref.forEach((function(H,u){if(H instanceof nH){var J=H.$changes,U=O.ref.$changes.indexes[u];J.setParent(O.ref,O.root,U)}}))},u.prototype.operation=function(H){this.changes.set(--this.currentCustomOperation,H)},u.prototype.change=function(u,J){void 0===J&&(J=H.OPERATION.ADD);var O="number"===typeof u?u:this.indexes[u];this.assertValidIndex(O,u);var U=this.changes.get(O);U&&U.op!==H.OPERATION.DELETE&&U.op!==H.OPERATION.TOUCH||this.changes.set(O,{op:U&&U.op===H.OPERATION.DELETE?H.OPERATION.DELETE_AND_ADD:J,index:O}),this.allChanges.add(O),this.changed=!0,this.touchParents()},u.prototype.touch=function(u){var J="number"===typeof u?u:this.indexes[u];this.assertValidIndex(J,u),this.changes.has(J)||this.changes.set(J,{op:H.OPERATION.TOUCH,index:J}),this.allChanges.add(J),this.touchParents()},u.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},u.prototype.getType=function(H){if(this.ref._definition)return(u=this.ref._definition).schema[u.fieldsByIndex[H]];var u,J=(u=this.parent._definition).schema[u.fieldsByIndex[this.parentIndex]];return Object.values(J)[0]},u.prototype.getChildrenFilter=function(){var H=this.parent._definition.childFilters;return H&&H[this.parentIndex]},u.prototype.getValue=function(H){return this.ref.getByIndex(H)},u.prototype.delete=function(u){var J="number"===typeof u?u:this.indexes[u];if(void 0!==J){var O=this.getValue(J);this.changes.set(J,{op:H.OPERATION.DELETE,index:J}),this.allChanges.delete(J),delete this.caches[J],O&&O.$changes&&(O.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(u," (").concat(J,")"))},u.prototype.discard=function(u,J){var O=this;void 0===u&&(u=!1),void 0===J&&(J=!1),this.ref instanceof nH||this.changes.forEach((function(u){if(u.op===H.OPERATION.DELETE){var J=O.ref.getIndex(u.index);delete O.indexes[J]}})),this.changes.clear(),this.changed=u,J&&this.allChanges.clear(),this.currentCustomOperation=0},u.prototype.discardAll=function(){var H=this;this.changes.forEach((function(u){var J=H.getValue(u.index);J&&J.$changes&&J.$changes.discardAll()})),this.discard()},u.prototype.cache=function(H,u){this.caches[H]=u},u.prototype.clone=function(){return new u(this.ref,this.parent,this.root)},u.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},u.prototype.assertValidIndex=function(H,u){if(void 0===H)throw new Error('ChangeTree: missing index for field "'.concat(u,'"'))},u}();function b(H,u,J,O){return H[u]||(H[u]=[]),H[u].push(J),null===O||void 0===O||O.forEach((function(H,u){return J(H,u)})),function(){return G(H[u],H[u].indexOf(J))}}function d(u){var J=this,O="string"!==typeof this.$changes.getType();this.$items.forEach((function(U,h){u.push({refId:J.$changes.refId,op:H.OPERATION.DELETE,field:h,value:void 0,previousValue:U}),O&&J.$changes.root.removeRef(U.$changes.refId)}))}function G(H,u){if(-1===u||u>=H.length)return!1;for(var J=H.length-1,O=u;O<J;O++)H[O]=H[O+1];return H.length=J,!0}var P=function(H,u){var J=H.toString(),O=u.toString();return J<O?-1:J>O?1:0};function mH(H){return H.$proxy=!0,H=new Proxy(H,{get:function(H,u){return"symbol"===typeof u||isNaN(u)?H[u]:H.at(u)},set:function(H,u,J){if("symbol"===typeof u||isNaN(u))H[u]=J;else{var O=Array.from(H.$items.keys()),U=parseInt(O[u]||u);void 0===J||null===J?H.deleteAt(U):H.setAt(U,J)}return!0},deleteProperty:function(H,u){return"number"===typeof u?H.deleteAt(u):delete H[u],!0}})}var l=function(){function u(){for(var H=[],u=0;u<arguments.length;u++)H[u]=arguments[u];this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,H)}return u.prototype.ng=function(u,J){return void 0===J&&(J=!0),b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.ADD,u,J?this.$items:void 0)},u.prototype.mh=function(u){return b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,u)},u.is=function(H){return Array.isArray(H)||void 0!==H.array},Object.defineProperty(u.prototype,"length",{get:function(){return this.$items.size},set:function(H){0===H?this.clear():this.splice(H,this.length-H)},enumerable:!1,configurable:!0}),u.prototype.push=function(){for(var H,u=this,J=[],O=0;O<arguments.length;O++)J[O]=arguments[O];return J.forEach((function(J){H=u.$refId++,u.setAt(H,J)})),H},u.prototype.pop=function(){var H=Array.from(this.$indexes.values()).pop();if(void 0!==H){this.$changes.delete(H),this.$indexes.delete(H);var u=this.$items.get(H);return this.$items.delete(H),u}},u.prototype.at=function(H){var u=Array.from(this.$items.keys())[H];return this.$items.get(u)},u.prototype.setAt=function(u,J){var O,U;if(void 0!==J&&null!==J){if(this.$items.get(u)!==J){void 0!==J.$changes&&J.$changes.setParent(this,this.$changes.root,u);var h=null!==(U=null===(O=this.$changes.indexes[u])||void 0===O?void 0:O.op)&&void 0!==U?U:H.OPERATION.ADD;this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,J),this.$changes.change(u,h)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},u.prototype.deleteAt=function(H){var u=Array.from(this.$items.keys())[H];return void 0!==u&&this.$deleteAt(u)},u.prototype.$deleteAt=function(H){return this.$changes.delete(H),this.$indexes.delete(H),this.$items.delete(H)},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&d.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:H.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.concat=function(){for(var H,J=[],O=0;O<arguments.length;O++)J[O]=arguments[O];return new(u.bind.apply(u,U([void 0],(H=Array.from(this.$items.values())).concat.apply(H,J),!1)))},u.prototype.join=function(H){return Array.from(this.$items.values()).join(H)},u.prototype.reverse=function(){var H=this,u=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(J,O){H.setAt(u[O],J)})),this},u.prototype.shift=function(){var H=Array.from(this.$items.keys()).shift();if(void 0!==H){var u=this.$items.get(H);return this.$deleteAt(H),u}},u.prototype.slice=function(H,J){var O=new u;return O.push.apply(O,Array.from(this.$items.values()).slice(H,J)),O},u.prototype.sort=function(H){var u=this;void 0===H&&(H=P);var J=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(H).forEach((function(H,O){u.setAt(J[O],H)})),this},u.prototype.splice=function(H,u){void 0===u&&(u=this.length-H);for(var J=Array.from(this.$items.keys()),O=[],U=H;U<H+u;U++)O.push(this.$items.get(J[U])),this.$deleteAt(J[U]);return O},u.prototype.unshift=function(){for(var H=this,u=[],J=0;J<arguments.length;J++)u[J]=arguments[J];var O=this.length,U=u.length,h=Array.from(this.$items.values());return u.forEach((function(u,J){H.setAt(J,u)})),h.forEach((function(u,J){H.setAt(U+J,u)})),O+U},u.prototype.indexOf=function(H,u){return Array.from(this.$items.values()).indexOf(H,u)},u.prototype.lastIndexOf=function(H,u){return void 0===u&&(u=this.length-1),Array.from(this.$items.values()).lastIndexOf(H,u)},u.prototype.every=function(H,u){return Array.from(this.$items.values()).every(H,u)},u.prototype.some=function(H,u){return Array.from(this.$items.values()).some(H,u)},u.prototype.forEach=function(H,u){Array.from(this.$items.values()).forEach(H,u)},u.prototype.map=function(H,u){return Array.from(this.$items.values()).map(H,u)},u.prototype.filter=function(H,u){return Array.from(this.$items.values()).filter(H,u)},u.prototype.reduce=function(H,u){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},u.prototype.reduceRight=function(H,u){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},u.prototype.find=function(H,u){return Array.from(this.$items.values()).find(H,u)},u.prototype.findIndex=function(H,u){return Array.from(this.$items.values()).findIndex(H,u)},u.prototype.fill=function(H,u,J){throw new Error("ArraySchema#fill() not implemented")},u.prototype.copyWithin=function(H,u,J){throw new Error("ArraySchema#copyWithin() not implemented")},u.prototype.toString=function(){return this.$items.toString()},u.prototype.toLocaleString=function(){return this.$items.toLocaleString()},u.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(u,Symbol.species,{get:function(){return u},enumerable:!1,configurable:!0}),u.prototype.entries=function(){return this.$items.entries()},u.prototype.keys=function(){return this.$items.keys()},u.prototype.values=function(){return this.$items.values()},u.prototype.includes=function(H,u){return Array.from(this.$items.values()).includes(H,u)},u.prototype.flatMap=function(H,u){throw new Error("ArraySchema#flatMap() is not supported.")},u.prototype.flat=function(H){throw new Error("ArraySchema#flat() is not supported.")},u.prototype.findLast=function(){var H=Array.from(this.$items.values());return H.findLast.apply(H,arguments)},u.prototype.findLastIndex=function(){var H=Array.from(this.$items.values());return H.findLastIndex.apply(H,arguments)},u.prototype.setIndex=function(H,u){this.$indexes.set(H,u)},u.prototype.getIndex=function(H){return this.$indexes.get(H)},u.prototype.getByIndex=function(H){return this.$items.get(this.$indexes.get(H))},u.prototype.deleteByIndex=function(H){var u=this.$indexes.get(H);this.$items.delete(u),this.$indexes.delete(H)},u.prototype.toArray=function(){return Array.from(this.$items.values())},u.prototype.toJSON=function(){return this.toArray().map((function(H){return"function"===typeof H.toJSON?H.toJSON():H}))},u.prototype.clone=function(H){return H?new(u.bind.apply(u,U([void 0],Array.from(this.$items.values()),!1))):new(u.bind.apply(u,U([void 0],this.map((function(H){return H.$changes?H.clone():H})),!1)))},u}();function r(H){return H.$proxy=!0,H=new Proxy(H,{get:function(H,u){return"symbol"!==typeof u&&"undefined"===typeof H[u]?H.get(u):H[u]},set:function(H,u,J){return"symbol"!==typeof u&&-1===u.indexOf("$")&&"ng"!==u&&"mh"!==u&&"onChange"!==u?H.set(u,J):H[u]=J,!0},deleteProperty:function(H,u){return H.delete(u),!0}})}var p=function(){function u(H){var J=this;if(this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,H)if(H instanceof Map||H instanceof u)H.forEach((function(H,u){return J.set(u,H)}));else for(var O in H)this.set(O,H[O])}return u.prototype.ng=function(u,J){return void 0===J&&(J=!0),b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.ADD,u,J?this.$items:void 0)},u.prototype.mh=function(u){return b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,u)},u.is=function(H){return void 0!==H.map},u.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(u.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(u,Symbol.species,{get:function(){return u},enumerable:!1,configurable:!0}),u.prototype.set=function(u,J){if(void 0===J||null===J)throw new Error("MapSchema#set('".concat(u,"', ").concat(J,"): trying to set ").concat(J," value on '").concat(u,"'."));u=u.toString();var O="undefined"!==typeof this.$changes.indexes[u],U=O?this.$changes.indexes[u]:this.$refId++,h=O?H.OPERATION.REPLACE:H.OPERATION.ADD,w=void 0!==J.$changes;if(w&&J.$changes.setParent(this,this.$changes.root,U),O){if(!w&&this.$items.get(u)===J)return;w&&this.$items.get(u)!==J&&(h=H.OPERATION.ADD)}else this.$changes.indexes[u]=U,this.$indexes.set(U,u);return this.$items.set(u,J),this.$changes.change(u,h),this},u.prototype.get=function(H){return this.$items.get(H)},u.prototype.delete=function(H){return this.$changes.delete(H),this.$items.delete(H)},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&d.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:H.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.has=function(H){return this.$items.has(H)},u.prototype.forEach=function(H){this.$items.forEach(H)},u.prototype.entries=function(){return this.$items.entries()},u.prototype.keys=function(){return this.$items.keys()},u.prototype.values=function(){return this.$items.values()},Object.defineProperty(u.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),u.prototype.setIndex=function(H,u){this.$indexes.set(H,u)},u.prototype.getIndex=function(H){return this.$indexes.get(H)},u.prototype.getByIndex=function(H){return this.$items.get(this.$indexes.get(H))},u.prototype.deleteByIndex=function(H){var u=this.$indexes.get(H);this.$items.delete(u),this.$indexes.delete(H)},u.prototype.toJSON=function(){var H={};return this.forEach((function(u,J){H[J]="function"===typeof u.toJSON?u.toJSON():u})),H},u.prototype.clone=function(H){var J;return H?J=Object.assign(new u,this):(J=new u,this.forEach((function(H,u){H.$changes?J.set(u,H.clone()):J.set(u,H)}))),J},u}(),a={};function k(H,u){a[H]=u}function C(H){return a[H]}var j=function(){function H(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return H.create=function(u){var J=new H;return J.schema=Object.assign({},u&&u.schema||{}),J.indexes=Object.assign({},u&&u.indexes||{}),J.fieldsByIndex=Object.assign({},u&&u.fieldsByIndex||{}),J.descriptors=Object.assign({},u&&u.descriptors||{}),J.deprecated=Object.assign({},u&&u.deprecated||{}),J},H.prototype.addField=function(H,u){var J=this.getNextFieldIndex();this.fieldsByIndex[J]=H,this.indexes[H]=J,this.schema[H]=Array.isArray(u)?{array:u[0]}:u},H.prototype.hasField=function(H){return void 0!==this.indexes[H]},H.prototype.addFilter=function(H,u){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[H]]=u,this.indexesWithFilters.push(this.indexes[H]),!0},H.prototype.addChildrenFilter=function(H,u){var J=this.indexes[H],O=this.schema[H];if(C(Object.keys(O)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[J]=u,!0;console.warn("@filterChildren: field '".concat(H,"' can't have children. Ignoring filter."))},H.prototype.getChildrenFilter=function(H){return this.childFilters&&this.childFilters[this.indexes[H]]},H.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},H}();function M(H){return H._context&&H._context.useFilters}var L=function(){function H(){this.types={},this.schemas=new Map,this.useFilters=!1}return H.prototype.has=function(H){return this.schemas.has(H)},H.prototype.get=function(H){return this.types[H]},H.prototype.add=function(H,u){void 0===u&&(u=this.schemas.size),H._definition=j.create(H._definition),H._typeid=u,this.types[u]=H,this.schemas.set(H,u)},H.create=function(u){return void 0===u&&(u={}),function(J){return u.context||(u.context=new H),Y(J,u)}},H}(),Z=new L;function Y(H,u){return void 0===u&&(u={}),function(J,O){var h=u.context||Z,w=J.constructor;if(w._context=h,!H)throw new Error("".concat(w.name,': @type() reference provided for "').concat(O,"\" is undefined. Make sure you don't have any circular dependencies."));h.has(w)||h.add(w);var g=w._definition;if(g.addField(O,H),g.descriptors[O]){if(g.deprecated[O])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(O,"' definition on '").concat(w.name,"'.\nCheck @type() annotation"))}catch(a){var B=a.stack.split("\n")[4].trim();throw new Error("".concat(a.message," ").concat(B))}}var b=l.is(H),d=!b&&p.is(H);if("string"!==typeof H&&!nH.is(H)){var G=Object.values(H)[0];"string"===typeof G||h.has(G)||h.add(G)}if(u.manual)g.descriptors[O]={enumerable:!0,configurable:!0,writable:!0};else{var P="_".concat(O);g.descriptors[P]={enumerable:!1,configurable:!1,writable:!0},g.descriptors[O]={get:function(){return this[P]},set:function(H){H!==this[P]&&(void 0!==H&&null!==H?(!b||H instanceof l||(H=new(l.bind.apply(l,U([void 0],H,!1)))),!d||H instanceof p||(H=new p(H)),void 0===H.$proxy&&(d?H=r(H):b&&(H=mH(H))),this.$changes.change(O),H.$changes&&H.$changes.setParent(this,this.$changes.root,this._definition.indexes[O])):this[P]&&this.$changes.delete(O),this[P]=H)},enumerable:!0,configurable:!0}}}}function F(H){return function(u,J){var O=u.constructor;O._definition.addFilter(J,H)&&(O._context.useFilters=!0)}}function s(H){return function(u,J){var O=u.constructor;O._definition.addChildrenFilter(J,H)&&(O._context.useFilters=!0)}}function A(H){return void 0===H&&(H=!0),function(u,J){var O=u.constructor._definition;O.deprecated[J]=!0,H&&(O.descriptors[J]={get:function(){throw new Error("".concat(J," is deprecated."))},set:function(H){},enumerable:!1,configurable:!0})}}function t(H,u,J){for(var O in void 0===J&&(J={}),J.context||(J.context=H._context||J.context||Z),u)Y(u[O],J)(H.prototype,O);return H}function e(H){for(var u=0,J=0,O=0,U=H.length;O<U;O++)(u=H.charCodeAt(O))<128?J+=1:u<2048?J+=2:u<55296||u>=57344?J+=3:(O++,J+=4);return J}function c(H,u,J){for(var O=0,U=0,h=J.length;U<h;U++)(O=J.charCodeAt(U))<128?H[u++]=O:O<2048?(H[u++]=192|O>>6,H[u++]=128|63&O):O<55296||O>=57344?(H[u++]=224|O>>12,H[u++]=128|O>>6&63,H[u++]=128|63&O):(U++,O=65536+((1023&O)<<10|1023&J.charCodeAt(U)),H[u++]=240|O>>18,H[u++]=128|O>>12&63,H[u++]=128|O>>6&63,H[u++]=128|63&O)}function n(H,u){H.push(255&u)}function V(H,u){H.push(255&u)}function T(H,u){H.push(255&u),H.push(u>>8&255)}function R(H,u){H.push(255&u),H.push(u>>8&255)}function X(H,u){H.push(255&u),H.push(u>>8&255),H.push(u>>16&255),H.push(u>>24&255)}function W(H,u){var J=u>>24,O=u>>16,U=u>>8,h=u;H.push(255&h),H.push(255&U),H.push(255&O),H.push(255&J)}function f(H,u){var J=Math.floor(u/Math.pow(2,32));W(H,u>>>0),W(H,J)}function i(H,u){var J=u/Math.pow(2,32)|0;W(H,u>>>0),W(H,J)}function S(H,u){y(H,u)}function v(H,u){x(H,u)}var I=new Int32Array(2),D=new Float32Array(I.buffer),o=new Float64Array(I.buffer);function y(H,u){D[0]=u,X(H,I[0])}function x(H,u){o[0]=u,X(H,I[0]),X(H,I[1])}function z(H,u){return V(H,u?1:0)}function K(H,u){u||(u="");var J=e(u),O=0;if(J<32)H.push(160|J),O=1;else if(J<256)H.push(217),V(H,J),O=2;else if(J<65536)H.push(218),R(H,J),O=3;else{if(!(J<4294967296))throw new Error("String too long");H.push(219),W(H,J),O=5}return c(H,H.length,u),O+J}function N(H,u){return isNaN(u)?N(H,0):isFinite(u)?u!==(0|u)?(H.push(203),x(H,u),9):u>=0?u<128?(V(H,u),1):u<256?(H.push(204),V(H,u),2):u<65536?(H.push(205),R(H,u),3):u<4294967296?(H.push(206),W(H,u),5):(H.push(207),i(H,u),9):u>=-32?(H.push(224|u+32),1):u>=-128?(H.push(208),n(H,u),2):u>=-32768?(H.push(209),T(H,u),3):u>=-2147483648?(H.push(210),X(H,u),5):(H.push(211),f(H,u),9):N(H,u>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var q=Object.freeze({__proto__:null,utf8Write:c,int8:n,uint8:V,int16:T,uint16:R,int32:X,uint32:W,int64:f,uint64:i,float32:S,float64:v,writeFloat32:y,writeFloat64:x,boolean:z,string:K,number:N});function E(H,u,J){for(var O="",U=0,h=u,w=u+J;h<w;h++){var g=H[h];0!==(128&g)?192!==(224&g)?224!==(240&g)?240!==(248&g)?console.error("Invalid byte "+g.toString(16)):(U=(7&g)<<18|(63&H[++h])<<12|(63&H[++h])<<6|63&H[++h])>=65536?(U-=65536,O+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):O+=String.fromCharCode(U):O+=String.fromCharCode((15&g)<<12|(63&H[++h])<<6|63&H[++h]):O+=String.fromCharCode((31&g)<<6|63&H[++h]):O+=String.fromCharCode(g)}return O}function Q(H,u){return HH(H,u)<<24>>24}function HH(H,u){return H[u.offset++]}function uH(H,u){return JH(H,u)<<16>>16}function JH(H,u){return H[u.offset++]|H[u.offset++]<<8}function OH(H,u){return H[u.offset++]|H[u.offset++]<<8|H[u.offset++]<<16|H[u.offset++]<<24}function UH(H,u){return OH(H,u)>>>0}function hH(H,u){return PH(H,u)}function wH(H,u){return mu(H,u)}function gH(H,u){var J=UH(H,u);return OH(H,u)*Math.pow(2,32)+J}function BH(H,u){var J=UH(H,u);return UH(H,u)*Math.pow(2,32)+J}var bH=new Int32Array(2),dH=new Float32Array(bH.buffer),GH=new Float64Array(bH.buffer);function PH(H,u){return bH[0]=OH(H,u),dH[0]}function mu(H,u){return bH[0]=OH(H,u),bH[1]=OH(H,u),GH[0]}function lH(H,u){return HH(H,u)>0}function rH(H,u){var J,O=H[u.offset++];O<192?J=31&O:217===O?J=HH(H,u):218===O?J=JH(H,u):219===O&&(J=UH(H,u));var U=E(H,u.offset,J);return u.offset+=J,U}function pH(H,u){var J=H[u.offset];return J<192&&J>160||217===J||218===J||219===J}function aH(H,u){var J=H[u.offset++];return J<128?J:202===J?PH(H,u):203===J?mu(H,u):204===J?HH(H,u):205===J?JH(H,u):206===J?UH(H,u):207===J?BH(H,u):208===J?Q(H,u):209===J?uH(H,u):210===J?OH(H,u):211===J?gH(H,u):J>223?-1*(255-J+1):void 0}function kH(H,u){var J=H[u.offset];return J<128||J>=202&&J<=211}function CH(H,u){return H[u.offset]<160}function jH(H,u){return H[u.offset-1]===w&&(H[u.offset]<128||H[u.offset]>=202&&H[u.offset]<=211)}var MH=Object.freeze({__proto__:null,int8:Q,uint8:HH,int16:uH,uint16:JH,int32:OH,uint32:UH,float32:hH,float64:wH,int64:gH,uint64:BH,readFloat32:PH,readFloat64:mu,boolean:lH,string:rH,stringCheck:pH,number:aH,numberCheck:kH,arrayCheck:CH,switchStructureCheck:jH}),LH=function(){function u(H){var u=this;this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,H&&H.forEach((function(H){return u.add(H)}))}return u.prototype.ng=function(u,J){return void 0===J&&(J=!0),b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.ADD,u,J?this.$items:void 0)},u.prototype.mh=function(u){return b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,u)},u.is=function(H){return void 0!==H.collection},u.prototype.add=function(H){var u=this.$refId++;return void 0!==H.$changes&&H.$changes.setParent(this,this.$changes.root,u),this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,H),this.$changes.change(u),u},u.prototype.at=function(H){var u=Array.from(this.$items.keys())[H];return this.$items.get(u)},u.prototype.entries=function(){return this.$items.entries()},u.prototype.delete=function(H){for(var u,J,O=this.$items.entries();(J=O.next())&&!J.done;)if(H===J.value[1]){u=J.value[0];break}return void 0!==u&&(this.$changes.delete(u),this.$indexes.delete(u),this.$items.delete(u))},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&d.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:H.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.has=function(H){return Array.from(this.$items.values()).some((function(u){return u===H}))},u.prototype.forEach=function(H){var u=this;this.$items.forEach((function(J,O,U){return H(J,O,u)}))},u.prototype.values=function(){return this.$items.values()},Object.defineProperty(u.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),u.prototype.setIndex=function(H,u){this.$indexes.set(H,u)},u.prototype.getIndex=function(H){return this.$indexes.get(H)},u.prototype.getByIndex=function(H){return this.$items.get(this.$indexes.get(H))},u.prototype.deleteByIndex=function(H){var u=this.$indexes.get(H);this.$items.delete(u),this.$indexes.delete(H)},u.prototype.toArray=function(){return Array.from(this.$items.values())},u.prototype.toJSON=function(){var H=[];return this.forEach((function(u,J){H.push("function"===typeof u.toJSON?u.toJSON():u)})),H},u.prototype.clone=function(H){var J;return H?J=Object.assign(new u,this):(J=new u,this.forEach((function(H){H.$changes?J.add(H.clone()):J.add(H)}))),J},u}(),ZH=function(){function u(H){var u=this;this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,H&&H.forEach((function(H){return u.add(H)}))}return u.prototype.ng=function(u,J){return void 0===J&&(J=!0),b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.ADD,u,J?this.$items:void 0)},u.prototype.mh=function(u){return b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,u)},u.is=function(H){return void 0!==H.set},u.prototype.add=function(u){var J,O;if(this.has(u))return!1;var U=this.$refId++;void 0!==u.$changes&&u.$changes.setParent(this,this.$changes.root,U);var h=null!==(O=null===(J=this.$changes.indexes[U])||void 0===J?void 0:J.op)&&void 0!==O?O:H.OPERATION.ADD;return this.$changes.indexes[U]=U,this.$indexes.set(U,U),this.$items.set(U,u),this.$changes.change(U,h),U},u.prototype.entries=function(){return this.$items.entries()},u.prototype.delete=function(H){for(var u,J,O=this.$items.entries();(J=O.next())&&!J.done;)if(H===J.value[1]){u=J.value[0];break}return void 0!==u&&(this.$changes.delete(u),this.$indexes.delete(u),this.$items.delete(u))},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&d.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:H.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.has=function(H){for(var u,J=this.$items.values(),O=!1;(u=J.next())&&!u.done;)if(H===u.value){O=!0;break}return O},u.prototype.forEach=function(H){var u=this;this.$items.forEach((function(J,O,U){return H(J,O,u)}))},u.prototype.values=function(){return this.$items.values()},Object.defineProperty(u.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),u.prototype.setIndex=function(H,u){this.$indexes.set(H,u)},u.prototype.getIndex=function(H){return this.$indexes.get(H)},u.prototype.getByIndex=function(H){return this.$items.get(this.$indexes.get(H))},u.prototype.deleteByIndex=function(H){var u=this.$indexes.get(H);this.$items.delete(u),this.$indexes.delete(H)},u.prototype.toArray=function(){return Array.from(this.$items.values())},u.prototype.toJSON=function(){var H=[];return this.forEach((function(u,J){H.push("function"===typeof u.toJSON?u.toJSON():u)})),H},u.prototype.clone=function(H){var J;return H?J=Object.assign(new u,this):(J=new u,this.forEach((function(H){H.$changes?J.add(H.clone()):J.add(H)}))),J},u}(),YH=function(){function H(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return H.prototype.addRefId=function(H){this.refIds.has(H)||(this.refIds.add(H),this.containerIndexes.set(H,new Set))},H.get=function(u){return void 0===u.$filterState&&(u.$filterState=new H),u.$filterState},H}(),FH=function(){function H(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return H.prototype.getNextUniqueId=function(){return this.nextUniqueId++},H.prototype.addRef=function(H,u,J){void 0===J&&(J=!0),this.refs.set(H,u),J&&(this.refCounts[H]=(this.refCounts[H]||0)+1)},H.prototype.removeRef=function(H){this.refCounts[H]=this.refCounts[H]-1,this.deletedRefs.add(H)},H.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},H.prototype.garbageCollectDeletedRefs=function(){var H=this;this.deletedRefs.forEach((function(u){if(!(H.refCounts[u]>0)){var J=H.refs.get(u);if(J instanceof nH)for(var O in J._definition.schema)"string"!==typeof J._definition.schema[O]&&J[O]&&J[O].$changes&&H.removeRef(J[O].$changes.refId);else{var U=J.$changes.parent._definition,h=U.schema[U.fieldsByIndex[J.$changes.parentIndex]];"function"===typeof Object.values(h)[0]&&Array.from(J.values()).forEach((function(u){return H.removeRef(u.$changes.refId)}))}H.refs.delete(u),delete H.refCounts[u]}})),this.deletedRefs.clear()},H}(),sH=function(H){function u(){return null!==H&&H.apply(this,arguments)||this}return J(u,H),u}(Error);function AH(H,u,J,O){var U,h=!1;switch(u){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":U="number",isNaN(H)&&console.log('trying to encode "NaN" in '.concat(J.constructor.name,"#").concat(O));break;case"string":U="string",h=!0;break;case"boolean":return}if(typeof H!==U&&(!h||h&&null!==H)){var w="'".concat(JSON.stringify(H),"'").concat(H&&H.constructor&&" (".concat(H.constructor.name,")")||"");throw new sH("a '".concat(U,"' was expected, but ").concat(w," was provided in ").concat(J.constructor.name,"#").concat(O))}}function tH(H,u,J,O){if(!(H instanceof u))throw new sH("a '".concat(u.name,"' was expected, but '").concat(H.constructor.name,"' was provided in ").concat(J.constructor.name,"#").concat(O))}function eH(H,u,J,O,U){AH(J,H,O,U);var h=q[H];if(!h)throw new sH("a '".concat(H,"' was expected, but ").concat(J," was provided in ").concat(O.constructor.name,"#").concat(U));h(u,J)}function cH(H,u,J){return MH[H](u,J)}var nH=function(){function u(){for(var H=[],u=0;u<arguments.length;u++)H[u]=arguments[u];Object.defineProperties(this,{$changes:{value:new B(this,void 0,new FH),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var J=this._definition.descriptors;J&&Object.defineProperties(this,J),H[0]&&this.assign(H[0])}return u.onError=function(H){console.error(H)},u.is=function(H){return H._definition&&void 0!==H._definition.schema},u.prototype.onChange=function(u){return b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,u)},u.prototype.mh=function(u){return b(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,u)},u.prototype.assign=function(H){return Object.assign(this,H),this},Object.defineProperty(u.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),u.prototype.setDirty=function(H,u){this.$changes.change(H,u)},u.prototype.listen=function(H,u,J){var O=this;return void 0===J&&(J=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[H]||(this.$callbacks[H]=[]),this.$callbacks[H].push(u),J&&void 0!==this[H]&&u(this[H],void 0),function(){return G(O.$callbacks[H],O.$callbacks[H].indexOf(u))}},u.prototype.decode=function(J,O,U){var h;void 0===O&&(O={offset:0}),void 0===U&&(U=this);var g=[],B=this.$changes.root,b=J.length,d=0;for(B.refs.set(d,this);O.offset<b;){var G=J[O.offset++];if(G!=w){var P=U.$changes,mH=void 0!==U._definition,r=mH?G>>6<<6:G;if(r!==H.OPERATION.CLEAR){var a=mH?G%(r||255):aH(J,O),k=mH?U._definition.fieldsByIndex[a]:"",j=P.getType(a),M=void 0,L=void 0,Z=void 0;if(mH?L=U["_".concat(k)]:(L=U.getByIndex(a),(r&H.OPERATION.ADD)===H.OPERATION.ADD?(Z=U instanceof p?rH(J,O):a,U.setIndex(a,Z)):Z=U.getIndex(a)),(r&H.OPERATION.DELETE)===H.OPERATION.DELETE&&(r!==H.OPERATION.DELETE_AND_ADD&&U.deleteByIndex(a),L&&L.$changes&&B.removeRef(L.$changes.refId),M=null),void 0!==k){if(r===H.OPERATION.DELETE);else if(u.is(j)){var Y=aH(J,O);if(M=B.refs.get(Y),r!==H.OPERATION.REPLACE){var F=this.getSchemaType(J,O,j);M||((M=this.createTypeInstance(F)).$changes.refId=Y,L&&(M.$callbacks=L.$callbacks,L.$changes.refId&&Y!==L.$changes.refId&&B.removeRef(L.$changes.refId))),B.addRef(Y,M,M!==L)}}else if("string"===typeof j)M=cH(j,J,O);else{var s=C(Object.keys(j)[0]),A=aH(J,O),t=B.refs.has(A)?L||B.refs.get(A):new s.constructor;if((M=t.clone(!0)).$changes.refId=A,L&&(M.$callbacks=L.$callbacks,L.$changes.refId&&A!==L.$changes.refId)){B.removeRef(L.$changes.refId);for(var e=L.entries(),c=void 0;(c=e.next())&&!c.done;){var n=(h=c.value)[0],V=h[1];g.push({refId:A,op:H.OPERATION.DELETE,field:n,value:void 0,previousValue:V})}}B.addRef(A,M,t!==L)}if(null!==M&&void 0!==M)if(M.$changes&&M.$changes.setParent(P.ref,P.root,a),U instanceof u)U[k]=M;else if(U instanceof p)n=Z,U.$items.set(n,M),U.$changes.allChanges.add(a);else if(U instanceof l)U.setAt(a,M);else if(U instanceof LH){var T=U.add(M);U.setIndex(a,T)}else U instanceof ZH&&!1!==(T=U.add(M))&&U.setIndex(a,T);L!==M&&g.push({refId:d,op:r,field:k,dynamicIndex:Z,value:M,previousValue:L})}else{console.warn("@colyseus/schema: definition mismatch");for(var R={offset:O.offset};O.offset<b&&(!jH(J,O)||(R.offset=O.offset+1,!B.refs.has(aH(J,R))));)O.offset++}}else U.clear(g)}else{d=aH(J,O);var X=B.refs.get(d);if(!X)throw new Error('"refId" not found: '.concat(d));U=X}}return this._triggerChanges(g),B.garbageCollectDeletedRefs(),g},u.prototype.encode=function(J,O,U){void 0===J&&(J=!1),void 0===O&&(O=[]),void 0===U&&(U=!1);for(var h=this.$changes,g=new WeakSet,B=[h],b=1,d=0;d<b;d++){var G=B[d],P=G.ref,mH=P instanceof u;G.ensureRefId(),g.add(G),G!==h&&(G.changed||J)&&(V(O,w),N(O,G.refId));for(var l=J?Array.from(G.allChanges):Array.from(G.changes.values()),r=0,a=l.length;r<a;r++){var k=J?{op:H.OPERATION.ADD,index:l[r]}:l[r],j=k.index,M=mH?P._definition.fieldsByIndex&&P._definition.fieldsByIndex[j]:j,L=O.length;if(k.op!==H.OPERATION.TOUCH)if(mH)V(O,j|k.op);else{if(V(O,k.op),k.op===H.OPERATION.CLEAR)continue;N(O,j)}if(mH||(k.op&H.OPERATION.ADD)!=H.OPERATION.ADD||P instanceof p&&K(O,G.ref.$indexes.get(j)),k.op!==H.OPERATION.DELETE){var Z=G.getType(j),Y=G.getValue(j);if(Y&&Y.$changes&&!g.has(Y.$changes)&&(B.push(Y.$changes),Y.$changes.ensureRefId(),b++),k.op!==H.OPERATION.TOUCH){if(u.is(Z))tH(Y,Z,P,M),N(O,Y.$changes.refId),(k.op&H.OPERATION.ADD)===H.OPERATION.ADD&&this.tryEncodeTypeId(O,Z,Y.constructor);else if("string"===typeof Z)eH(Z,O,Y,P,M);else{var F=C(Object.keys(Z)[0]);tH(P["_".concat(M)],F.constructor,P,M),N(O,Y.$changes.refId)}U&&G.cache(j,O.slice(L))}}}J||U||G.discard()}return O},u.prototype.encodeAll=function(H){return this.encode(!0,[],H)},u.prototype.applyFilters=function(J,O){var U,h;void 0===O&&(O=!1);for(var g=this,B=new Set,b=YH.get(J),d=[this.$changes],G=1,P=[],mH=function(mH){var l=d[mH];if(B.has(l.refId))return"continue";var r=l.ref,a=r instanceof u;V(P,w),N(P,l.refId);var k=b.refIds.has(l),C=O||!k;b.addRefId(l);var j=b.containerIndexes.get(l),M=C?Array.from(l.allChanges):Array.from(l.changes.values());!O&&a&&r._definition.indexesWithFilters&&r._definition.indexesWithFilters.forEach((function(u){!j.has(u)&&l.allChanges.has(u)&&(C?M.push(u):M.push({op:H.OPERATION.ADD,index:u}))}));for(var L=0,Z=M.length;L<Z;L++){var Y=C?{op:H.OPERATION.ADD,index:M[L]}:M[L];if(Y.op!==H.OPERATION.CLEAR){var F=Y.index;if(Y.op!==H.OPERATION.DELETE){var s=l.getValue(F),A=l.getType(F);if(a){if((t=r._definition.filters&&r._definition.filters[F])&&!t.call(r,J,s,g)){s&&s.$changes&&B.add(s.$changes.refId);continue}}else{var t,e=l.parent;if((t=l.getChildrenFilter())&&!t.call(e,J,r.$indexes.get(F),s,g)){s&&s.$changes&&B.add(s.$changes.refId);continue}}if(s.$changes&&(d.push(s.$changes),G++),Y.op!==H.OPERATION.TOUCH)if(Y.op===H.OPERATION.ADD||a)P.push.apply(P,null!==(U=l.caches[F])&&void 0!==U?U:[]),j.add(F);else if(j.has(F))P.push.apply(P,null!==(h=l.caches[F])&&void 0!==h?h:[]);else{if(j.add(F),V(P,H.OPERATION.ADD),N(P,F),r instanceof p){var c=l.ref.$indexes.get(F);K(P,c)}s.$changes?N(P,s.$changes.refId):q[A](P,s)}else s.$changes&&!a&&(V(P,H.OPERATION.ADD),N(P,F),r instanceof p&&(c=l.ref.$indexes.get(F),K(P,c)),N(P,s.$changes.refId))}else a?V(P,Y.op|F):(V(P,Y.op),N(P,F))}else V(P,Y.op)}},l=0;l<G;l++)mH(l);return P},u.prototype.clone=function(){var H,u=new this.constructor,J=this._definition.schema;for(var O in J)"object"===typeof this[O]&&"function"===typeof(null===(H=this[O])||void 0===H?void 0:H.clone)?u[O]=this[O].clone():u[O]=this[O];return u},u.prototype.toJSON=function(){var H=this._definition.schema,u=this._definition.deprecated,J={};for(var O in H)u[O]||null===this[O]||"undefined"===typeof this[O]||(J[O]="function"===typeof this[O].toJSON?this[O].toJSON():this["_".concat(O)]);return J},u.prototype.discardAllChanges=function(){this.$changes.discardAll()},u.prototype.getByIndex=function(H){return this[this._definition.fieldsByIndex[H]]},u.prototype.deleteByIndex=function(H){this[this._definition.fieldsByIndex[H]]=void 0},u.prototype.tryEncodeTypeId=function(H,u,J){u._typeid!==J._typeid&&(V(H,g),N(H,J._typeid))},u.prototype.getSchemaType=function(H,u,J){var O;return H[u.offset]===g&&(u.offset++,O=this.constructor._context.get(aH(H,u))),O||J},u.prototype.createTypeInstance=function(H){var u=new H;return u.$changes.root=this.$changes.root,u},u.prototype._triggerChanges=function(J){for(var O,U,h,w,g,B,b,d,G,P=new Set,mH=this.$changes.root.refs,l=function(l){var r=J[l],p=r.refId,a=mH.get(p),k=a.$callbacks;if((r.op&H.OPERATION.DELETE)===H.OPERATION.DELETE&&r.previousValue instanceof u&&(null===(U=null===(O=r.previousValue.$callbacks)||void 0===O?void 0:O[H.OPERATION.DELETE])||void 0===U||U.forEach((function(H){return H()}))),!k)return"continue";if(a instanceof u){if(!P.has(p))try{null===(h=null===k||void 0===k?void 0:k[H.OPERATION.REPLACE])||void 0===h||h.forEach((function(H){return H()}))}catch(C){u.onError(C)}try{k.hasOwnProperty(r.field)&&(null===(w=k[r.field])||void 0===w||w.forEach((function(H){return H(r.value,r.previousValue)})))}catch(C){u.onError(C)}}else r.op===H.OPERATION.ADD&&void 0===r.previousValue?null===(g=k[H.OPERATION.ADD])||void 0===g||g.forEach((function(H){var u;return H(r.value,null!==(u=r.dynamicIndex)&&void 0!==u?u:r.field)})):r.op===H.OPERATION.DELETE?void 0!==r.previousValue&&(null===(B=k[H.OPERATION.DELETE])||void 0===B||B.forEach((function(H){var u;return H(r.previousValue,null!==(u=r.dynamicIndex)&&void 0!==u?u:r.field)}))):r.op===H.OPERATION.DELETE_AND_ADD&&(void 0!==r.previousValue&&(null===(b=k[H.OPERATION.DELETE])||void 0===b||b.forEach((function(H){var u;return H(r.previousValue,null!==(u=r.dynamicIndex)&&void 0!==u?u:r.field)}))),null===(d=k[H.OPERATION.ADD])||void 0===d||d.forEach((function(H){var u;return H(r.value,null!==(u=r.dynamicIndex)&&void 0!==u?u:r.field)}))),r.value!==r.previousValue&&(null===(G=k[H.OPERATION.REPLACE])||void 0===G||G.forEach((function(H){var u;return H(r.value,null!==(u=r.dynamicIndex)&&void 0!==u?u:r.field)})));P.add(p)},r=0;r<J.length;r++)l(r)},u._definition=j.create(),u}();function VH(H){for(var u=[H.$changes],J=1,O={},U=O,h=function(H){var J=u[H];J.changes.forEach((function(H){var u=J.ref,O=H.index,h=u._definition?u._definition.fieldsByIndex[O]:u.$indexes.get(O);U[h]=J.getValue(O)}))},w=0;w<J;w++)h(w);return O}var TH={context:new L},RH=function(H){function u(){return null!==H&&H.apply(this,arguments)||this}return J(u,H),O([Y("string",TH)],u.prototype,"name",void 0),O([Y("string",TH)],u.prototype,"type",void 0),O([Y("number",TH)],u.prototype,"referencedType",void 0),u}(nH),XH=function(H){function u(){var u=null!==H&&H.apply(this,arguments)||this;return u.fields=new l,u}return J(u,H),O([Y("number",TH)],u.prototype,"id",void 0),O([Y([RH],TH)],u.prototype,"fields",void 0),u}(nH),WH=function(H){function u(){var u=null!==H&&H.apply(this,arguments)||this;return u.types=new l,u}return J(u,H),u.encode=function(H){var J=H.constructor,O=new u;O.rootType=J._typeid;var U=function(H,u){for(var J in u){var U=new RH;U.name=J;var h=void 0;if("string"===typeof u[J])h=u[J];else{var w=u[J],g=void 0;nH.is(w)?(h="ref",g=u[J]):"string"===typeof w[h=Object.keys(w)[0]]?h+=":"+w[h]:g=w[h],U.referencedType=g?g._typeid:-1}U.type=h,H.fields.push(U)}O.types.push(H)},h=J._context.types;for(var w in h){var g=new XH;g.id=Number(w),U(g,h[w]._definition.schema)}return O.encodeAll()},u.decode=function(H,O){var U=new L,h=new u;h.decode(H,O);var w=h.types.reduce((function(H,u){var O=function(H){function u(){return null!==H&&H.apply(this,arguments)||this}return J(u,H),u}(nH),h=u.id;return H[h]=O,U.add(O,h),H}),{});h.types.forEach((function(H){var u=w[H.id];H.fields.forEach((function(H){var J;if(void 0!==H.referencedType){var O=H.type,h=w[H.referencedType];if(!h){var g=H.type.split(":");O=g[0],h=g[1]}"ref"===O?Y(h,{context:U})(u.prototype,H.name):Y(((J={})[O]=h,J),{context:U})(u.prototype,H.name)}else Y(H.type,{context:U})(u.prototype,H.name)}))}));var g=w[h.rootType],B=new g;for(var b in g._definition.schema){var d=g._definition.schema[b];"string"!==typeof d&&(B[b]="function"===typeof d?new d:new(C(Object.keys(d)[0]).constructor))}return B},O([Y([XH],TH)],u.prototype,"types",void 0),O([Y("number",TH)],u.prototype,"rootType",void 0),u}(nH);k("map",{constructor:p}),k("array",{constructor:l}),k("set",{constructor:ZH}),k("collection",{constructor:LH}),H.ArraySchema=l,H.CollectionSchema=LH,H.Context=L,H.MapSchema=p,H.Reflection=WH,H.ReflectionField=RH,H.ReflectionType=XH,H.Schema=nH,H.SchemaDefinition=j,H.SetSchema=ZH,H.decode=MH,H.defineTypes=t,H.deprecated=A,H.dumpChanges=VH,H.encode=q,H.filter=F,H.filterChildren=s,H.hasFilter=M,H.registerType=k,H.type=Y,Object.defineProperty(H,"__esModule",{value:!0})}(u)},14434:H=>{"use strict";H.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14431:(H,u,J)=>{var O=J(14434),U=J(14439),h=Object.hasOwnProperty,w=Object.create(null);for(var g in O)h.call(O,g)&&(w[O[g]]=g);var B=H.exports={to:{},get:{}};function b(H,u,J){return Math.min(Math.max(u,H),J)}function d(H){var u=Math.round(H).toString(16).toUpperCase();return u.length<2?"0"+u:u}B.get=function(H){var u,J;switch(H.substring(0,3).toLowerCase()){case"hsl":u=B.get.hsl(H),J="hsl";break;case"hwb":u=B.get.hwb(H),J="hwb";break;default:u=B.get.rgb(H),J="rgb"}return u?{model:J,value:u}:null},B.get.rgb=function(H){if(!H)return null;var u,J,U,w=[0,0,0,1];if(u=H.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(U=u[2],u=u[1],J=0;J<3;J++){var g=2*J;w[J]=parseInt(u.slice(g,g+2),16)}U&&(w[3]=parseInt(U,16)/255)}else if(u=H.match(/^#([a-f0-9]{3,4})$/i)){for(U=(u=u[1])[3],J=0;J<3;J++)w[J]=parseInt(u[J]+u[J],16);U&&(w[3]=parseInt(U+U,16)/255)}else if(u=H.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(J=0;J<3;J++)w[J]=parseInt(u[J+1],0);u[4]&&(u[5]?w[3]=.01*parseFloat(u[4]):w[3]=parseFloat(u[4]))}else{if(!(u=H.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(u=H.match(/^(\w+)$/))?"transparent"===u[1]?[0,0,0,0]:h.call(O,u[1])?((w=O[u[1]])[3]=1,w):null:null;for(J=0;J<3;J++)w[J]=Math.round(2.55*parseFloat(u[J+1]));u[4]&&(u[5]?w[3]=.01*parseFloat(u[4]):w[3]=parseFloat(u[4]))}for(J=0;J<3;J++)w[J]=b(w[J],0,255);return w[3]=b(w[3],0,1),w},B.get.hsl=function(H){if(!H)return null;var u=H.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(u){var J=parseFloat(u[4]);return[(parseFloat(u[1])%360+360)%360,b(parseFloat(u[2]),0,100),b(parseFloat(u[3]),0,100),b(isNaN(J)?1:J,0,1)]}return null},B.get.hwb=function(H){if(!H)return null;var u=H.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(u){var J=parseFloat(u[4]);return[(parseFloat(u[1])%360+360)%360,b(parseFloat(u[2]),0,100),b(parseFloat(u[3]),0,100),b(isNaN(J)?1:J,0,1)]}return null},B.to.hex=function(){var H=U(arguments);return"#"+d(H[0])+d(H[1])+d(H[2])+(H[3]<1?d(Math.round(255*H[3])):"")},B.to.rgb=function(){var H=U(arguments);return H.length<4||1===H[3]?"rgb("+Math.round(H[0])+", "+Math.round(H[1])+", "+Math.round(H[2])+")":"rgba("+Math.round(H[0])+", "+Math.round(H[1])+", "+Math.round(H[2])+", "+H[3]+")"},B.to.rgb.percent=function(){var H=U(arguments),u=Math.round(H[0]/255*100),J=Math.round(H[1]/255*100),O=Math.round(H[2]/255*100);return H.length<4||1===H[3]?"rgb("+u+"%, "+J+"%, "+O+"%)":"rgba("+u+"%, "+J+"%, "+O+"%, "+H[3]+")"},B.to.hsl=function(){var H=U(arguments);return H.length<4||1===H[3]?"hsl("+H[0]+", "+H[1]+"%, "+H[2]+"%)":"hsla("+H[0]+", "+H[1]+"%, "+H[2]+"%, "+H[3]+")"},B.to.hwb=function(){var H=U(arguments),u="";return H.length>=4&&1!==H[3]&&(u=", "+H[3]),"hwb("+H[0]+", "+H[1]+"%, "+H[2]+"%"+u+")"},B.to.keyword=function(H){return w[H.slice(0,3)]}},14422:(H,u,J)=>{const O=J(14431),U=J(14450),h=["keyword","gray","hex"],w={};for(const mH of Object.keys(U))w[[...U[mH].labels].sort().join("")]=mH;const g={};function B(H,u){if(!(this instanceof B))return new B(H,u);if(u&&u in h&&(u=null),u&&!(u in U))throw new Error("Unknown model: "+u);let J,b;if(null==H)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(H instanceof B)this.model=H.model,this.color=[...H.color],this.valpha=H.valpha;else if("string"===typeof H){const u=O.get(H);if(null===u)throw new Error("Unable to parse color from string: "+H);this.model=u.model,b=U[this.model].channels,this.color=u.value.slice(0,b),this.valpha="number"===typeof u.value[b]?u.value[b]:1}else if(H.length>0){this.model=u||"rgb",b=U[this.model].channels;const J=Array.prototype.slice.call(H,0,b);this.color=P(J,b),this.valpha="number"===typeof H[b]?H[b]:1}else if("number"===typeof H)this.model="rgb",this.color=[H>>16&255,H>>8&255,255&H],this.valpha=1;else{this.valpha=1;const u=Object.keys(H);"alpha"in H&&(u.splice(u.indexOf("alpha"),1),this.valpha="number"===typeof H.alpha?H.alpha:0);const O=u.sort().join("");if(!(O in w))throw new Error("Unable to parse color from object: "+JSON.stringify(H));this.model=w[O];const{labels:h}=U[this.model],g=[];for(J=0;J<h.length;J++)g.push(H[h[J]]);this.color=P(g)}if(g[this.model])for(b=U[this.model].channels,J=0;J<b;J++){const H=g[this.model][J];H&&(this.color[J]=H(this.color[J]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}B.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(H){let u=this.model in O.to?this:this.rgb();u=u.round("number"===typeof H?H:1);const J=1===u.valpha?u.color:[...u.color,this.valpha];return O.to[u.model](J)},percentString(H){const u=this.rgb().round("number"===typeof H?H:1),J=1===u.valpha?u.color:[...u.color,this.valpha];return O.to.rgb.percent(J)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const H={},{channels:u}=U[this.model],{labels:J}=U[this.model];for(let O=0;O<u;O++)H[J[O]]=this.color[O];return 1!==this.valpha&&(H.alpha=this.valpha),H},unitArray(){const H=this.rgb().color;return H[0]/=255,H[1]/=255,H[2]/=255,1!==this.valpha&&H.push(this.valpha),H},unitObject(){const H=this.rgb().object();return H.r/=255,H.g/=255,H.b/=255,1!==this.valpha&&(H.alpha=this.valpha),H},round(H){return H=Math.max(H||0,0),new B([...this.color.map(b(H)),this.valpha],this.model)},alpha(H){return void 0!==H?new B([...this.color,Math.max(0,Math.min(1,H))],this.model):this.valpha},red:d("rgb",0,G(255)),green:d("rgb",1,G(255)),blue:d("rgb",2,G(255)),hue:d(["hsl","hsv","hsl","hwb","hcg"],0,(H=>(H%360+360)%360)),saturationl:d("hsl",1,G(100)),lightness:d("hsl",2,G(100)),saturationv:d("hsv",1,G(100)),value:d("hsv",2,G(100)),chroma:d("hcg",1,G(100)),gray:d("hcg",2,G(100)),white:d("hwb",1,G(100)),wblack:d("hwb",2,G(100)),cyan:d("cmyk",0,G(100)),magenta:d("cmyk",1,G(100)),yellow:d("cmyk",2,G(100)),black:d("cmyk",3,G(100)),x:d("xyz",0,G(95.047)),y:d("xyz",1,G(100)),z:d("xyz",2,G(108.833)),l:d("lab",0,G(100)),a:d("lab",1),b:d("lab",2),keyword(H){return void 0!==H?new B(H):U[this.model].keyword(this.color)},hex(H){return void 0!==H?new B(H):O.to.hex(this.rgb().round().color)},hexa(H){if(void 0!==H)return new B(H);const u=this.rgb().round().color;let J=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===J.length&&(J="0"+J),O.to.hex(u)+J},rgbNumber(){const H=this.rgb().color;return(255&H[0])<<16|(255&H[1])<<8|255&H[2]},luminosity(){const H=this.rgb().color,u=[];for(const[J,O]of H.entries()){const H=O/255;u[J]=H<=.04045?H/12.92:((H+.055)/1.055)**2.4}return.2126*u[0]+.7152*u[1]+.0722*u[2]},contrast(H){const u=this.luminosity(),J=H.luminosity();return u>J?(u+.05)/(J+.05):(J+.05)/(u+.05)},level(H){const u=this.contrast(H);return u>=7?"AAA":u>=4.5?"AA":""},isDark(){const H=this.rgb().color;return(2126*H[0]+7152*H[1]+722*H[2])/1e4<128},isLight(){return!this.isDark()},negate(){const H=this.rgb();for(let u=0;u<3;u++)H.color[u]=255-H.color[u];return H},lighten(H){const u=this.hsl();return u.color[2]+=u.color[2]*H,u},darken(H){const u=this.hsl();return u.color[2]-=u.color[2]*H,u},saturate(H){const u=this.hsl();return u.color[1]+=u.color[1]*H,u},desaturate(H){const u=this.hsl();return u.color[1]-=u.color[1]*H,u},whiten(H){const u=this.hwb();return u.color[1]+=u.color[1]*H,u},blacken(H){const u=this.hwb();return u.color[2]+=u.color[2]*H,u},grayscale(){const H=this.rgb().color,u=.3*H[0]+.59*H[1]+.11*H[2];return B.rgb(u,u,u)},fade(H){return this.alpha(this.valpha-this.valpha*H)},opaquer(H){return this.alpha(this.valpha+this.valpha*H)},rotate(H){const u=this.hsl();let J=u.color[0];return J=(J+H)%360,J=J<0?360+J:J,u.color[0]=J,u},mix(H,u){if(!H||!H.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof H);const J=H.rgb(),O=this.rgb(),U=void 0===u?.5:u,h=2*U-1,w=J.alpha()-O.alpha(),g=((h*w===-1?h:(h+w)/(1+h*w))+1)/2,b=1-g;return B.rgb(g*J.red()+b*O.red(),g*J.green()+b*O.green(),g*J.blue()+b*O.blue(),J.alpha()*U+O.alpha()*(1-U))}};for(const mH of Object.keys(U)){if(h.includes(mH))continue;const{channels:H}=U[mH];B.prototype[mH]=function(){if(this.model===mH)return new B(this);for(var H=arguments.length,u=new Array(H),J=0;J<H;J++)u[J]=arguments[J];return u.length>0?new B(u,mH):new B([...(O=U[this.model][mH].raw(this.color),Array.isArray(O)?O:[O]),this.valpha],mH);var O},B[mH]=function(){for(var u=arguments.length,J=new Array(u),O=0;O<u;O++)J[O]=arguments[O];let U=J[0];return"number"===typeof U&&(U=P(J,H)),new B(U,mH)}}function b(H){return function(u){return function(H,u){return Number(H.toFixed(u))}(u,H)}}function d(H,u,J){H=Array.isArray(H)?H:[H];for(const O of H)(g[O]||(g[O]=[]))[u]=J;return H=H[0],function(O){let U;return void 0!==O?(J&&(O=J(O)),U=this[H](),U.color[u]=O,U):(U=this[H]().color[u],J&&(U=J(U)),U)}}function G(H){return function(u){return Math.max(0,Math.min(H,u))}}function P(H,u){for(let J=0;J<u;J++)"number"!==typeof H[J]&&(H[J]=0);return H}H.exports=B},14452:(H,u,J)=>{const O=J(14457),U={};for(const w of Object.keys(O))U[O[w]]=w;const h={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};H.exports=h;for(const w of Object.keys(h)){if(!("channels"in h[w]))throw new Error("missing channels property: "+w);if(!("labels"in h[w]))throw new Error("missing channel labels property: "+w);if(h[w].labels.length!==h[w].channels)throw new Error("channel and label counts mismatch: "+w);const{channels:H,labels:u}=h[w];delete h[w].channels,delete h[w].labels,Object.defineProperty(h[w],"channels",{value:H}),Object.defineProperty(h[w],"labels",{value:u})}h.rgb.hsl=function(H){const u=H[0]/255,J=H[1]/255,O=H[2]/255,U=Math.min(u,J,O),h=Math.max(u,J,O),w=h-U;let g,B;h===U?g=0:u===h?g=(J-O)/w:J===h?g=2+(O-u)/w:O===h&&(g=4+(u-J)/w),g=Math.min(60*g,360),g<0&&(g+=360);const b=(U+h)/2;return B=h===U?0:b<=.5?w/(h+U):w/(2-h-U),[g,100*B,100*b]},h.rgb.hsv=function(H){let u,J,O,U,h;const w=H[0]/255,g=H[1]/255,B=H[2]/255,b=Math.max(w,g,B),d=b-Math.min(w,g,B),G=function(H){return(b-H)/6/d+.5};return 0===d?(U=0,h=0):(h=d/b,u=G(w),J=G(g),O=G(B),w===b?U=O-J:g===b?U=1/3+u-O:B===b&&(U=2/3+J-u),U<0?U+=1:U>1&&(U-=1)),[360*U,100*h,100*b]},h.rgb.hwb=function(H){const u=H[0],J=H[1];let O=H[2];const U=h.rgb.hsl(H)[0],w=1/255*Math.min(u,Math.min(J,O));return O=1-1/255*Math.max(u,Math.max(J,O)),[U,100*w,100*O]},h.rgb.cmyk=function(H){const u=H[0]/255,J=H[1]/255,O=H[2]/255,U=Math.min(1-u,1-J,1-O);return[100*((1-u-U)/(1-U)||0),100*((1-J-U)/(1-U)||0),100*((1-O-U)/(1-U)||0),100*U]},h.rgb.keyword=function(H){const u=U[H];if(u)return u;let J,h=1/0;for(const U of Object.keys(O)){const u=O[U],B=(g=u,((w=H)[0]-g[0])**2+(w[1]-g[1])**2+(w[2]-g[2])**2);B<h&&(h=B,J=U)}var w,g;return J},h.keyword.rgb=function(H){return O[H]},h.rgb.xyz=function(H){let u=H[0]/255,J=H[1]/255,O=H[2]/255;u=u>.04045?((u+.055)/1.055)**2.4:u/12.92,J=J>.04045?((J+.055)/1.055)**2.4:J/12.92,O=O>.04045?((O+.055)/1.055)**2.4:O/12.92;return[100*(.4124*u+.3576*J+.1805*O),100*(.2126*u+.7152*J+.0722*O),100*(.0193*u+.1192*J+.9505*O)]},h.rgb.lab=function(H){const u=h.rgb.xyz(H);let J=u[0],O=u[1],U=u[2];J/=95.047,O/=100,U/=108.883,J=J>.008856?J**(1/3):7.787*J+16/116,O=O>.008856?O**(1/3):7.787*O+16/116,U=U>.008856?U**(1/3):7.787*U+16/116;return[116*O-16,500*(J-O),200*(O-U)]},h.hsl.rgb=function(H){const u=H[0]/360,J=H[1]/100,O=H[2]/100;let U,h,w;if(0===J)return w=255*O,[w,w,w];U=O<.5?O*(1+J):O+J-O*J;const g=2*O-U,B=[0,0,0];for(let b=0;b<3;b++)h=u+1/3*-(b-1),h<0&&h++,h>1&&h--,w=6*h<1?g+6*(U-g)*h:2*h<1?U:3*h<2?g+(U-g)*(2/3-h)*6:g,B[b]=255*w;return B},h.hsl.hsv=function(H){const u=H[0];let J=H[1]/100,O=H[2]/100,U=J;const h=Math.max(O,.01);O*=2,J*=O<=1?O:2-O,U*=h<=1?h:2-h;return[u,100*(0===O?2*U/(h+U):2*J/(O+J)),100*((O+J)/2)]},h.hsv.rgb=function(H){const u=H[0]/60,J=H[1]/100;let O=H[2]/100;const U=Math.floor(u)%6,h=u-Math.floor(u),w=255*O*(1-J),g=255*O*(1-J*h),B=255*O*(1-J*(1-h));switch(O*=255,U){case 0:return[O,B,w];case 1:return[g,O,w];case 2:return[w,O,B];case 3:return[w,g,O];case 4:return[B,w,O];case 5:return[O,w,g]}},h.hsv.hsl=function(H){const u=H[0],J=H[1]/100,O=H[2]/100,U=Math.max(O,.01);let h,w;w=(2-J)*O;const g=(2-J)*U;return h=J*U,h/=g<=1?g:2-g,h=h||0,w/=2,[u,100*h,100*w]},h.hwb.rgb=function(H){const u=H[0]/360;let J=H[1]/100,O=H[2]/100;const U=J+O;let h;U>1&&(J/=U,O/=U);const w=Math.floor(6*u),g=1-O;h=6*u-w,0!==(1&w)&&(h=1-h);const B=J+h*(g-J);let b,d,G;switch(w){default:case 6:case 0:b=g,d=B,G=J;break;case 1:b=B,d=g,G=J;break;case 2:b=J,d=g,G=B;break;case 3:b=J,d=B,G=g;break;case 4:b=B,d=J,G=g;break;case 5:b=g,d=J,G=B}return[255*b,255*d,255*G]},h.cmyk.rgb=function(H){const u=H[0]/100,J=H[1]/100,O=H[2]/100,U=H[3]/100;return[255*(1-Math.min(1,u*(1-U)+U)),255*(1-Math.min(1,J*(1-U)+U)),255*(1-Math.min(1,O*(1-U)+U))]},h.xyz.rgb=function(H){const u=H[0]/100,J=H[1]/100,O=H[2]/100;let U,h,w;return U=3.2406*u+-1.5372*J+-.4986*O,h=-.9689*u+1.8758*J+.0415*O,w=.0557*u+-.204*J+1.057*O,U=U>.0031308?1.055*U**(1/2.4)-.055:12.92*U,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,w=w>.0031308?1.055*w**(1/2.4)-.055:12.92*w,U=Math.min(Math.max(0,U),1),h=Math.min(Math.max(0,h),1),w=Math.min(Math.max(0,w),1),[255*U,255*h,255*w]},h.xyz.lab=function(H){let u=H[0],J=H[1],O=H[2];u/=95.047,J/=100,O/=108.883,u=u>.008856?u**(1/3):7.787*u+16/116,J=J>.008856?J**(1/3):7.787*J+16/116,O=O>.008856?O**(1/3):7.787*O+16/116;return[116*J-16,500*(u-J),200*(J-O)]},h.lab.xyz=function(H){let u,J,O;J=(H[0]+16)/116,u=H[1]/500+J,O=J-H[2]/200;const U=J**3,h=u**3,w=O**3;return J=U>.008856?U:(J-16/116)/7.787,u=h>.008856?h:(u-16/116)/7.787,O=w>.008856?w:(O-16/116)/7.787,u*=95.047,J*=100,O*=108.883,[u,J,O]},h.lab.lch=function(H){const u=H[0],J=H[1],O=H[2];let U;U=360*Math.atan2(O,J)/2/Math.PI,U<0&&(U+=360);return[u,Math.sqrt(J*J+O*O),U]},h.lch.lab=function(H){const u=H[0],J=H[1],O=H[2]/360*2*Math.PI;return[u,J*Math.cos(O),J*Math.sin(O)]},h.rgb.ansi16=function(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[J,O,U]=H;let w=null===u?h.rgb.hsv(H)[2]:u;if(w=Math.round(w/50),0===w)return 30;let g=30+(Math.round(U/255)<<2|Math.round(O/255)<<1|Math.round(J/255));return 2===w&&(g+=60),g},h.hsv.ansi16=function(H){return h.rgb.ansi16(h.hsv.rgb(H),H[2])},h.rgb.ansi256=function(H){const u=H[0],J=H[1],O=H[2];if(u===J&&J===O)return u<8?16:u>248?231:Math.round((u-8)/247*24)+232;return 16+36*Math.round(u/255*5)+6*Math.round(J/255*5)+Math.round(O/255*5)},h.ansi16.rgb=function(H){let u=H%10;if(0===u||7===u)return H>50&&(u+=3.5),u=u/10.5*255,[u,u,u];const J=.5*(1+~~(H>50));return[(1&u)*J*255,(u>>1&1)*J*255,(u>>2&1)*J*255]},h.ansi256.rgb=function(H){if(H>=232){const u=10*(H-232)+8;return[u,u,u]}let u;H-=16;return[Math.floor(H/36)/5*255,Math.floor((u=H%36)/6)/5*255,u%6/5*255]},h.rgb.hex=function(H){const u=(((255&Math.round(H[0]))<<16)+((255&Math.round(H[1]))<<8)+(255&Math.round(H[2]))).toString(16).toUpperCase();return"000000".substring(u.length)+u},h.hex.rgb=function(H){const u=H.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!u)return[0,0,0];let J=u[0];3===u[0].length&&(J=J.split("").map((H=>H+H)).join(""));const O=parseInt(J,16);return[O>>16&255,O>>8&255,255&O]},h.rgb.hcg=function(H){const u=H[0]/255,J=H[1]/255,O=H[2]/255,U=Math.max(Math.max(u,J),O),h=Math.min(Math.min(u,J),O),w=U-h;let g,B;return g=w<1?h/(1-w):0,B=w<=0?0:U===u?(J-O)/w%6:U===J?2+(O-u)/w:4+(u-J)/w,B/=6,B%=1,[360*B,100*w,100*g]},h.hsl.hcg=function(H){const u=H[1]/100,J=H[2]/100,O=J<.5?2*u*J:2*u*(1-J);let U=0;return O<1&&(U=(J-.5*O)/(1-O)),[H[0],100*O,100*U]},h.hsv.hcg=function(H){const u=H[1]/100,J=H[2]/100,O=u*J;let U=0;return O<1&&(U=(J-O)/(1-O)),[H[0],100*O,100*U]},h.hcg.rgb=function(H){const u=H[0]/360,J=H[1]/100,O=H[2]/100;if(0===J)return[255*O,255*O,255*O];const U=[0,0,0],h=u%1*6,w=h%1,g=1-w;let B=0;switch(Math.floor(h)){case 0:U[0]=1,U[1]=w,U[2]=0;break;case 1:U[0]=g,U[1]=1,U[2]=0;break;case 2:U[0]=0,U[1]=1,U[2]=w;break;case 3:U[0]=0,U[1]=g,U[2]=1;break;case 4:U[0]=w,U[1]=0,U[2]=1;break;default:U[0]=1,U[1]=0,U[2]=g}return B=(1-J)*O,[255*(J*U[0]+B),255*(J*U[1]+B),255*(J*U[2]+B)]},h.hcg.hsv=function(H){const u=H[1]/100,J=u+H[2]/100*(1-u);let O=0;return J>0&&(O=u/J),[H[0],100*O,100*J]},h.hcg.hsl=function(H){const u=H[1]/100,J=H[2]/100*(1-u)+.5*u;let O=0;return J>0&&J<.5?O=u/(2*J):J>=.5&&J<1&&(O=u/(2*(1-J))),[H[0],100*O,100*J]},h.hcg.hwb=function(H){const u=H[1]/100,J=u+H[2]/100*(1-u);return[H[0],100*(J-u),100*(1-J)]},h.hwb.hcg=function(H){const u=H[1]/100,J=1-H[2]/100,O=J-u;let U=0;return O<1&&(U=(J-O)/(1-O)),[H[0],100*O,100*U]},h.apple.rgb=function(H){return[H[0]/65535*255,H[1]/65535*255,H[2]/65535*255]},h.rgb.apple=function(H){return[H[0]/255*65535,H[1]/255*65535,H[2]/255*65535]},h.gray.rgb=function(H){return[H[0]/100*255,H[0]/100*255,H[0]/100*255]},h.gray.hsl=function(H){return[0,0,H[0]]},h.gray.hsv=h.gray.hsl,h.gray.hwb=function(H){return[0,100,H[0]]},h.gray.cmyk=function(H){return[0,0,0,H[0]]},h.gray.lab=function(H){return[H[0],0,0]},h.gray.hex=function(H){const u=255&Math.round(H[0]/100*255),J=((u<<16)+(u<<8)+u).toString(16).toUpperCase();return"000000".substring(J.length)+J},h.rgb.gray=function(H){return[(H[0]+H[1]+H[2])/3/255*100]}},14450:(H,u,J)=>{const O=J(14452),U=J(14462),h={};Object.keys(O).forEach((H=>{h[H]={},Object.defineProperty(h[H],"channels",{value:O[H].channels}),Object.defineProperty(h[H],"labels",{value:O[H].labels});const u=U(H);Object.keys(u).forEach((J=>{const O=u[J];h[H][J]=function(H){const u=function(){for(var u=arguments.length,J=new Array(u),O=0;O<u;O++)J[O]=arguments[O];const U=J[0];if(void 0===U||null===U)return U;U.length>1&&(J=U);const h=H(J);if("object"===typeof h)for(let H=h.length,w=0;w<H;w++)h[w]=Math.round(h[w]);return h};return"conversion"in H&&(u.conversion=H.conversion),u}(O),h[H][J].raw=function(H){const u=function(){for(var u=arguments.length,J=new Array(u),O=0;O<u;O++)J[O]=arguments[O];const U=J[0];return void 0===U||null===U?U:(U.length>1&&(J=U),H(J))};return"conversion"in H&&(u.conversion=H.conversion),u}(O)}))})),H.exports=h},14462:(H,u,J)=>{const O=J(14452);function U(H){const u=function(){const H={},u=Object.keys(O);for(let J=u.length,O=0;O<J;O++)H[u[O]]={distance:-1,parent:null};return H}(),J=[H];for(u[H].distance=0;J.length;){const H=J.pop(),U=Object.keys(O[H]);for(let O=U.length,h=0;h<O;h++){const O=U[h],w=u[O];-1===w.distance&&(w.distance=u[H].distance+1,w.parent=H,J.unshift(O))}}return u}function h(H,u){return function(J){return u(H(J))}}function w(H,u){const J=[u[H].parent,H];let U=O[u[H].parent][H],w=u[H].parent;for(;u[w].parent;)J.unshift(u[w].parent),U=h(O[u[w].parent][w],U),w=u[w].parent;return U.conversion=J,U}H.exports=function(H){const u=U(H),J={},O=Object.keys(u);for(let U=O.length,h=0;h<U;h++){const H=O[h];null!==u[H].parent&&(J[H]=w(H,u))}return J}},14457:H=>{"use strict";H.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13046:(H,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.discordURLBuilder=void 0,u.discordURLBuilder=function(H){var u;const J=(null===(u=null===window||void 0===window?void 0:window.location)||void 0===u?void 0:u.hostname)||"localhost",O=H.hostname.split("."),U=!H.hostname.includes("trycloudflare.com")&&!H.hostname.includes("discordsays.com")&&O.length>2?`/${O[0]}`:"";return H.pathname.startsWith("/.proxy")?`${H.protocol}//${J}${U}${H.pathname}${H.search}`:`${H.protocol}//${J}/.proxy/colyseus${U}${H.pathname}${H.search}`}},13030:function(H,u,J){"use strict";var O,U,h,w,g=this&&this.__awaiter||function(H,u,J,O){return new(J||(J=Promise))((function(U,h){function w(H){try{B(O.next(H))}catch(u){h(u)}}function g(H){try{B(O.throw(H))}catch(u){h(u)}}function B(H){var u;H.done?U(H.value):(u=H.value,u instanceof J?u:new J((function(H){H(u)}))).then(w,g)}B((O=O.apply(H,u||[])).next())}))},B=this&&this.__classPrivateFieldGet||function(H,u,J,O){if("a"===J&&!O)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof u?H!==u||!O:!u.has(H))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===J?O:"a"===J?O.call(H):O?O.value:u.get(H)},b=this&&this.__classPrivateFieldSet||function(H,u,J,O,U){if("m"===O)throw new TypeError("Private method is not writable");if("a"===O&&!U)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof u?H!==u||!U:!u.has(H))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===O?U.call(H,J):U?U.value=J:u.set(H,J),J};Object.defineProperty(u,"__esModule",{value:!0}),u.Auth=void 0;const d=J(13039),G=J(12996);u.Auth=class{constructor(H){this.http=H,this.settings={path:"/auth",key:"colyseus-auth-token"},O.set(this,!1),U.set(this,void 0),h.set(this,void 0),w.set(this,(0,G.createNanoEvents)()),(0,d.getItem)(this.settings.key,(H=>this.token=H))}set token(H){this.http.authToken=H}get token(){return this.http.authToken}onChange(H){const u=B(this,w,"f").on("change",H);return B(this,O,"f")||b(this,U,new Promise(((H,u)=>{this.getUserData().then((H=>{this.emitChange(Object.assign(Object.assign({},H),{token:this.token}))})).catch((H=>{this.emitChange({user:null,token:void 0})})).finally((()=>{H()}))})),"f"),b(this,O,!0,"f"),u}getUserData(){return g(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(H,u,J){return g(this,void 0,void 0,(function*(){const O=(yield this.http.post(`${this.settings.path}/register`,{body:{email:H,password:u,options:J}})).data;return this.emitChange(O),O}))}signInWithEmailAndPassword(H,u){return g(this,void 0,void 0,(function*(){const J=(yield this.http.post(`${this.settings.path}/login`,{body:{email:H,password:u}})).data;return this.emitChange(J),J}))}signInAnonymously(H){return g(this,void 0,void 0,(function*(){const u=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:H}})).data;return this.emitChange(u),u}))}sendPasswordResetEmail(H){return g(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:H}})).data}))}signInWithProvider(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return g(this,void 0,void 0,(function*(){return new Promise(((J,O)=>{const U=u.width||480,w=u.height||768,g=this.token?`?token=${this.token}`:"",d=`Login with ${H[0].toUpperCase()+H.substring(1)}`,G=this.http.client.getHttpEndpoint(`${u.prefix||`${this.settings.path}/provider`}/${H}${g}`),P=screen.width/2-U/2,mH=screen.height/2-w/2;b(this,h,window.open(G,d,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+U+", height="+w+", top="+mH+", left="+P),"f");const l=H=>{void 0===H.data.user&&void 0===H.data.token||(clearInterval(r),B(this,h,"f").close(),b(this,h,void 0,"f"),window.removeEventListener("message",l),void 0!==H.data.error?O(H.data.error):(J(H.data),this.emitChange(H.data)))},r=setInterval((()=>{B(this,h,"f")&&!B(this,h,"f").closed||(b(this,h,void 0,"f"),O("bh"),window.removeEventListener("message",l))}),200);window.addEventListener("message",l)}))}))}signOut(){return g(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(H){void 0!==H.token&&(this.token=H.token,null===H.token?(0,d.removeItem)(this.settings.key):(0,d.setItem)(this.settings.key,H.token)),B(this,w,"f").emit("change",H)}},O=new WeakMap,U=new WeakMap,h=new WeakMap,w=new WeakMap},12949:function(H,u,J){"use strict";var O,U=this&&this.__awaiter||function(H,u,J,O){return new(J||(J=Promise))((function(U,h){function w(H){try{B(O.next(H))}catch(u){h(u)}}function g(H){try{B(O.throw(H))}catch(u){h(u)}}function B(H){var u;H.done?U(H.value):(u=H.value,u instanceof J?u:new J((function(H){H(u)}))).then(w,g)}B((O=O.apply(H,u||[])).next())}))};Object.defineProperty(u,"__esModule",{value:!0}),u.Client=u.MatchMakeError=void 0;const h=J(12956),w=J(12962),g=J(13014),B=J(13030),b=J(13046);class d extends Error{constructor(H,u){super(H),this.code=u,Object.setPrototypeOf(this,d.prototype)}}u.MatchMakeError=d;const G="undefined"!==typeof window&&"undefined"!==typeof(null===(O=null===window||void 0===window?void 0:window.location)||void 0===O?void 0:O.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";u.Client=class{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G,u=arguments.length>1?arguments[1]:void 0;var J,O;if("string"===typeof H){const u=H.startsWith("/")?new URL(H,G):new URL(H),J="https:"===u.protocol||"wss:"===u.protocol,O=Number(u.port||(J?443:80));this.settings={hostname:u.hostname,pathname:u.pathname,port:O,secure:J}}else void 0===H.port&&(H.port=H.secure?443:80),void 0===H.pathname&&(H.pathname=""),this.settings=H;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new g.HTTP(this,(null===u||void 0===u?void 0:u.headers)||{}),this.auth=new B.Auth(this.http),this.urlBuilder=null===u||void 0===u?void 0:u.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(O=null===(J=null===window||void 0===window?void 0:window.location)||void 0===J?void 0:J.hostname)||void 0===O?void 0:O.includes("discordsays.com"))&&(this.urlBuilder=b.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},J=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",H,u,J)}))}create(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},J=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",H,u,J)}))}join(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},J=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",H,u,J)}))}joinById(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},J=arguments.length>2?arguments[2]:void 0;return U(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",H,u,J)}))}reconnect(H,u){return U(this,void 0,void 0,(function*(){if("string"===typeof H&&"string"===typeof u)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[J,O]=H.split(":");if(!J||!O)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",J,{reconnectionToken:O},u)}))}getAvailableRooms(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return U(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${H}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(H,u,J){return U(this,void 0,void 0,(function*(){const O=this.createRoom(H.room.name,u);O.roomId=H.room.roomId,O.sessionId=H.sessionId;const w={sessionId:O.sessionId};H.reconnectionToken&&(w.reconnectionToken=H.reconnectionToken);const g=J||O;return O.connect(this.buildEndpoint(H.room,w),H.devMode&&(()=>U(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${O.roomId}'...`);let J=0;const h=()=>U(this,void 0,void 0,(function*(){J++;try{yield this.consumeSeatReservation(H,u,g),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${O.roomId}'`)}catch(U){J<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${J} out of 8)`),setTimeout(h,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(h,2e3)}))),g,this.http.headers),new Promise(((H,u)=>{const J=(H,J)=>u(new h.ServerError(H,J));g.onError.once(J),g.onJoin.once((()=>{g.onError.remove(J),setTimeout((()=>{try{g.fB(128,new Uint8Array([248,204,170,175,200,221,235,134,133,204,0,160,150,148,204,102,6,112,149,239]))}catch{}}),3e3),H(g)}))}))}))}createMatchMakeRequest(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},O=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0;return U(this,void 0,void 0,(function*(){const U=(yield this.http.post(`matchmake/${H}/${u}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(J)})).data;if(U.error)throw new d(U.error,U.code);return"reconnect"===H&&(U.reconnectionToken=J.reconnectionToken),yield this.consumeSeatReservation(U,O,h)}))}createRoom(H,u){return new w.Room(H,u)}buildEndpoint(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const J=[];for(const h in u)u.hasOwnProperty(h)&&J.push(`${h}=${u[h]}`);let O=this.settings.secure?"wss://":"ws://";H.publicAddress?O+=`${H.publicAddress}`:O+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const U=`${O}/${H.processId}/${H.roomId}?${J.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(U)):U}getHttpEndpoint(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const u=H.startsWith("/")?H:`/${H}`,J=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${u}`;return this.urlBuilder?this.urlBuilder(new URL(J)):J}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12971:(H,u,J)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.Connection=void 0;const O=J(12975);u.Connection=class{constructor(){this.events={},this.transport=new O.WebSocketTransport(this.events)}send(H){this.transport.send(H)}connect(H,u){this.transport.connect(H,u)}close(H,u){this.transport.close(H,u)}get isOpen(){return this.transport.isOpen}}},13014:function(H,u,J){"use strict";var O=this&&this.__createBinding||(Object.create?function(H,u,J,O){void 0===O&&(O=J);var U=Object.getOwnPropertyDescriptor(u,J);U&&!("get"in U?!u.__esModule:U.writable||U.configurable)||(U={enumerable:!0,get:function(){return u[J]}}),Object.defineProperty(H,O,U)}:function(H,u,J,O){void 0===O&&(O=J),H[O]=u[J]}),U=this&&this.__setModuleDefault||(Object.create?function(H,u){Object.defineProperty(H,"default",{enumerable:!0,value:u})}:function(H,u){H.default=u}),h=this&&this.__importStar||function(H){if(H&&H.__esModule)return H;var u={};if(null!=H)for(var J in H)"default"!==J&&Object.prototype.hasOwnProperty.call(H,J)&&O(u,H,J);return U(u,H),u};Object.defineProperty(u,"__esModule",{value:!0}),u.HTTP=void 0;const w=J(12956),g=h(J(13023));u.HTTP=class{constructor(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=H,this.headers=u}get(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",H,u)}post(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",H,u)}del(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",H,u)}put(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",H,u)}request(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return g[H](this.client.getHttpEndpoint(u),this.getOptions(J)).catch((H=>{var u;const J=H.statusCode,O=(null===(u=H.data)||void 0===u?void 0:u.error)||H.statusMessage||H.message;if(!J&&!O)throw H;throw new w.ServerError(J,O)}))}getOptions(H){return H.headers=Object.assign({},this.headers,H.headers),this.authToken&&(H.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(H.withCredentials=!0),H}}},12985:(H,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.utf8Length=u.utf8Read=u.ErrorCode=u.Protocol=void 0,function(H){H[H.HANDSHAKE=9]="HANDSHAKE",H[H.JOIN_ROOM=10]="JOIN_ROOM",H[H.ERROR=11]="ERROR",H[H.LEAVE_ROOM=12]="LEAVE_ROOM",H[H.ROOM_DATA=13]="ROOM_DATA",H[H.ROOM_STATE=14]="ROOM_STATE",H[H.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",H[H.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",H[H.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(u.Protocol||(u.Protocol={})),function(H){H[H.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",H[H.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",H[H.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",H[H.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",H[H.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",H[H.AUTH_FAILED=4215]="AUTH_FAILED",H[H.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(u.ErrorCode||(u.ErrorCode={})),u.utf8Read=function(H,u){const J=H[u++];for(var O="",U=0,h=u,w=u+J;h<w;h++){var g=H[h];if(0!==(128&g))if(192!==(224&g))if(224!==(240&g)){if(240!==(248&g))throw new Error("Invalid byte "+g.toString(16));(U=(7&g)<<18|(63&H[++h])<<12|(63&H[++h])<<6|63&H[++h])>=65536?(U-=65536,O+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):O+=String.fromCharCode(U)}else O+=String.fromCharCode((15&g)<<12|(63&H[++h])<<6|63&H[++h]);else O+=String.fromCharCode((31&g)<<6|63&H[++h]);else O+=String.fromCharCode(g)}return O},u.utf8Length=function(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",u=0,J=0;for(let O=0,U=H.length;O<U;O++)u=H.charCodeAt(O),u<128?J+=1:u<2048?J+=2:u<55296||u>=57344?J+=3:(O++,J+=4);return J+1}},12962:function(H,u,J){"use strict";var O=this&&this.__createBinding||(Object.create?function(H,u,J,O){void 0===O&&(O=J);var U=Object.getOwnPropertyDescriptor(u,J);U&&!("get"in U?!u.__esModule:U.writable||U.configurable)||(U={enumerable:!0,get:function(){return u[J]}}),Object.defineProperty(H,O,U)}:function(H,u,J,O){void 0===O&&(O=J),H[O]=u[J]}),U=this&&this.__setModuleDefault||(Object.create?function(H,u){Object.defineProperty(H,"default",{enumerable:!0,value:u})}:function(H,u){H.default=u}),h=this&&this.__importStar||function(H){if(H&&H.__esModule)return H;var u={};if(null!=H)for(var J in H)"default"!==J&&Object.prototype.hasOwnProperty.call(H,J)&&O(u,H,J);return U(u,H),u};Object.defineProperty(u,"__esModule",{value:!0}),u.Room=void 0;const w=h(J(12969)),g=J(12971),B=J(12985),b=J(12990),d=J(12996),G=J(13004),P=J(13011),mH=J(12956);class l{constructor(H,u){this.onStateChange=(0,G.createSignal)(),this.onError=(0,G.createSignal)(),this.onLeave=(0,G.createSignal)(),this.onJoin=(0,G.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,d.createNanoEvents)(),this.roomId=null,this.name=H,u&&(this.serializer=new((0,b.getSerializer)("schema")),this.rootSchema=u,this.serializer.state=new u),this.onError(((H,u)=>{var J;return null===(J=console.warn)||void 0===J?void 0:J.call(console,`colyseus.js - onError => (${H}) ${u}`)})),this.onLeave((()=>this.Uu()))}get id(){return this.roomId}connect(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,O=arguments.length>3?arguments[3]:void 0;const U=new g.Connection;J.connection=U,U.events.onmessage=l.prototype.onMessageCallback.bind(J),U.events.onclose=function(H){var O;if(!J.hasJoined)return null===(O=console.warn)||void 0===O||O.call(console,`Room connection was closed unexpectedly (${H.code}): ${H.reason}`),void J.onError.invoke(H.code,H.reason);H.code===mH.CloseCode.DEVMODE_RESTART&&u?u():(J.onLeave.invoke(H.code,H.reason),J.destroy())},U.events.onerror=function(H){var u;null===(u=console.warn)||void 0===u||u.call(console,`Room, onError (${H.code}): ${H.reason}`),J.onError.invoke(H.code,H.reason)},U.connect(H,O)}mB(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((u=>{this.onLeave((H=>u(H))),this.connection?H?this.connection.send([B.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(mH.CloseCode.CONSENTED)}))}Vu(H,u){return this.onMessageHandlers.on(this.getMessageHandlerKey(H),u)}send(H,u){const J=[B.Protocol.ROOM_DATA];let O;if("string"===typeof H?P.encode.string(J,H):P.encode.number(J,H),void 0!==u){const H=w.encode(u);O=new Uint8Array(J.length+H.byteLength),O.set(new Uint8Array(J),0),O.set(new Uint8Array(H),J.length)}else O=new Uint8Array(J);this.connection.send(O.buffer)}fB(H,u){const J=[B.Protocol.ROOM_DATA_BYTES];let O;"string"===typeof H?P.encode.string(J,H):P.encode.number(J,H),O=new Uint8Array(J.length+(u.byteLength||u.length)),O.set(new Uint8Array(J),0),O.set(new Uint8Array(u),J.length),this.connection.send(O.buffer)}get state(){return this.serializer.getState()}Uu(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(H){const u=Array.from(new Uint8Array(H.data)),J=u[0];if(J===B.Protocol.JOIN_ROOM){let H=1;const J=(0,B.utf8Read)(u,H);if(H+=(0,B.utf8Length)(J),this.serializerId=(0,B.utf8Read)(u,H),H+=(0,B.utf8Length)(this.serializerId),!this.serializer){const H=(0,b.getSerializer)(this.serializerId);this.serializer=new H}u.length>H&&this.serializer.handshake&&this.serializer.handshake(u,{offset:H}),this.reconnectionToken=`${this.roomId}:${J}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([B.Protocol.JOIN_ROOM])}else if(J===B.Protocol.ERROR){const H={offset:1},J=P.decode.number(u,H),O=P.decode.string(u,H);this.onError.invoke(J,O)}else if(J===B.Protocol.LEAVE_ROOM)this.mB();else if(J===B.Protocol.ROOM_DATA_SCHEMA){const H={offset:1},J=this.serializer.getState().constructor._context.get(P.decode.number(u,H)),O=new J;O.decode(u,H),this.dispatchMessage(J,O)}else if(J===B.Protocol.ROOM_STATE)u.shift(),this.setState(u);else if(J===B.Protocol.ROOM_STATE_PATCH)u.shift(),this.patch(u);else if(J===B.Protocol.ROOM_DATA){const J={offset:1},O=P.decode.stringCheck(u,J)?P.decode.string(u,J):P.decode.number(u,J),U=u.length>J.offset?w.decode(H.data,J.offset):void 0;this.dispatchMessage(O,U)}else if(J===B.Protocol.ROOM_DATA_BYTES){const H={offset:1},J=P.decode.stringCheck(u,H)?P.decode.string(u,H):P.decode.number(u,H);this.dispatchMessage(J,new Uint8Array(u.slice(H.offset)))}}setState(H){this.serializer.setState(H),this.onStateChange.invoke(this.serializer.getState())}patch(H){this.serializer.patch(H),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(H,u){var J;const O=this.getMessageHandlerKey(H);this.onMessageHandlers.events[O]?this.onMessageHandlers.emit(O,u):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",H,u):null===(J=console.warn)||void 0===J||J.call(console,`colyseus.js: onMessage() not registered for type '${H}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(H){switch(typeof H){case"function":return`$${H._typeid}`;case"string":return H;case"number":return`i${H}`;default:throw new Error("invalid message type.")}}}u.Room=l},13039:(H,u)=>{"use strict";let J;function O(){if(!J)try{J="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(H){}return J||(J={cache:{},setItem:function(H,u){this.cache[H]=u},getItem:function(H){this.cache[H]},removeItem:function(H){delete this.cache[H]}}),J}Object.defineProperty(u,"__esModule",{value:!0}),u.getItem=u.removeItem=u.setItem=void 0,u.setItem=function(H,u){O().setItem(H,u)},u.removeItem=function(H){O().removeItem(H)},u.getItem=function(H,u){const J=O().getItem(H);"undefined"!==typeof Promise&&J instanceof Promise?J.then((H=>u(H))):u(J)}},12996:(H,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.createNanoEvents=void 0;u.createNanoEvents=()=>({emit(H){let u=this.events[H]||[];for(var J=arguments.length,O=new Array(J>1?J-1:0),U=1;U<J;U++)O[U-1]=arguments[U];for(let h=0,w=u.length;h<w;h++)u[h](...O)},events:{},on(H,u){var J;return(null===(J=this.events[H])||void 0===J?void 0:J.push(u))||(this.events[H]=[u]),()=>{var J;this.events[H]=null===(J=this.events[H])||void 0===J?void 0:J.filter((H=>u!==H))}}})},13004:(H,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.createSignal=u.EventEmitter=void 0;class J{constructor(){this.handlers=[]}register(H){return this.handlers.push(H),this}invoke(){for(var H=arguments.length,u=new Array(H),J=0;J<H;J++)u[J]=arguments[J];this.handlers.forEach((H=>H.apply(this,u)))}invokeAsync(){for(var H=arguments.length,u=new Array(H),J=0;J<H;J++)u[J]=arguments[J];return Promise.all(this.handlers.map((H=>H.apply(this,u))))}remove(H){const u=this.handlers.indexOf(H);this.handlers[u]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}u.EventEmitter=J,u.createSignal=function(){const H=new J;function u(u){return H.register(u,null===this)}return u.once=u=>{const J=function(){for(var O=arguments.length,U=new Array(O),h=0;h<O;h++)U[h]=arguments[h];u.apply(this,U),H.remove(J)};H.register(J)},u.remove=u=>H.remove(u),u.invoke=function(){return H.invoke(...arguments)},u.invokeAsync=function(){return H.invokeAsync(...arguments)},u.clear=()=>H.clear(),u}},12956:(H,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.ServerError=u.CloseCode=void 0,function(H){H[H.CONSENTED=4e3]="CONSENTED",H[H.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(u.CloseCode||(u.CloseCode={}));class J extends Error{constructor(H,u){super(u),this.name="ServerError",this.code=H}}u.ServerError=J},12940:(H,u,J)=>{"use strict";u.e=void 0,J(12944);var O=J(12949);Object.defineProperty(u,"e",{enumerable:!0,get:function(){return O.Client}});var U=J(12985);var h=J(12962);var w=J(13030);const g=J(13051);const B=J(13059),b=J(12990);(0,b.registerSerializer)("schema",g.SchemaSerializer),(0,b.registerSerializer)("none",B.NoneSerializer)},12944:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=H=>null!==H&&"object"===typeof H&&H.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12969:(H,u)=>{"use strict";function J(H,u){if(this._offset=u,H instanceof ArrayBuffer)this._buffer=H,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(H))throw new Error("Invalid argument");this._buffer=H.buffer,this._view=new DataView(this._buffer,H.byteOffset,H.byteLength)}}Object.defineProperty(u,"__esModule",{value:!0}),u.decode=u.encode=void 0,J.prototype._array=function(H){for(var u=new Array(H),J=0;J<H;J++)u[J]=this._parse();return u},J.prototype._map=function(H){for(var u={},J=0;J<H;J++)u[this._parse()]=this._parse();return u},J.prototype._str=function(H){var u=function(H,u,J){for(var O="",U=0,h=u,w=u+J;h<w;h++){var g=H.getUint8(h);if(0!==(128&g))if(192!==(224&g))if(224!==(240&g)){if(240!==(248&g))throw new Error("Invalid byte "+g.toString(16));(U=(7&g)<<18|(63&H.getUint8(++h))<<12|(63&H.getUint8(++h))<<6|63&H.getUint8(++h))>=65536?(U-=65536,O+=String.fromCharCode(55296+(U>>>10),56320+(1023&U))):O+=String.fromCharCode(U)}else O+=String.fromCharCode((15&g)<<12|(63&H.getUint8(++h))<<6|63&H.getUint8(++h));else O+=String.fromCharCode((31&g)<<6|63&H.getUint8(++h));else O+=String.fromCharCode(g)}return O}(this._view,this._offset,H);return this._offset+=H,u},J.prototype._bin=function(H){var u=this._buffer.slice(this._offset,this._offset+H);return this._offset+=H,u},J.prototype._parse=function(){var H,u=this._view.getUint8(this._offset++),J=0,O=0,U=0,h=0;if(u<192)return u<128?u:u<144?this._map(15&u):u<160?this._array(15&u):this._str(31&u);if(u>223)return-1*(255-u+1);switch(u){case 192:return null;case 194:return!1;case 195:return!0;case 196:return J=this._view.getUint8(this._offset),this._offset+=1,this._bin(J);case 197:return J=this._view.getUint16(this._offset),this._offset+=2,this._bin(J);case 198:return J=this._view.getUint32(this._offset),this._offset+=4,this._bin(J);case 199:if(J=this._view.getUint8(this._offset),O=this._view.getInt8(this._offset+1),this._offset+=2,-1===O){var w=this._view.getUint32(this._offset);return U=this._view.getInt32(this._offset+4),h=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*U+h)+w/1e6)}return[O,this._bin(J)];case 200:return J=this._view.getUint16(this._offset),O=this._view.getInt8(this._offset+2),this._offset+=3,[O,this._bin(J)];case 201:return J=this._view.getUint32(this._offset),O=this._view.getInt8(this._offset+4),this._offset+=5,[O,this._bin(J)];case 202:return H=this._view.getFloat32(this._offset),this._offset+=4,H;case 203:return H=this._view.getFloat64(this._offset),this._offset+=8,H;case 204:return H=this._view.getUint8(this._offset),this._offset+=1,H;case 205:return H=this._view.getUint16(this._offset),this._offset+=2,H;case 206:return H=this._view.getUint32(this._offset),this._offset+=4,H;case 207:return U=this._view.getUint32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,U+h;case 208:return H=this._view.getInt8(this._offset),this._offset+=1,H;case 209:return H=this._view.getInt16(this._offset),this._offset+=2,H;case 210:return H=this._view.getInt32(this._offset),this._offset+=4,H;case 211:return U=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,U+h;case 212:return O=this._view.getInt8(this._offset),this._offset+=1,0===O?void(this._offset+=1):[O,this._bin(1)];case 213:return O=this._view.getInt8(this._offset),this._offset+=1,[O,this._bin(2)];case 214:return O=this._view.getInt8(this._offset),this._offset+=1,-1===O?(H=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*H)):[O,this._bin(4)];case 215:return O=this._view.getInt8(this._offset),this._offset+=1,0===O?(U=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,new Date(U+h)):-1===O?(U=this._view.getUint32(this._offset),h=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&U)+h)+(U>>>2)/1e6)):[O,this._bin(8)];case 216:return O=this._view.getInt8(this._offset),this._offset+=1,[O,this._bin(16)];case 217:return J=this._view.getUint8(this._offset),this._offset+=1,this._str(J);case 218:return J=this._view.getUint16(this._offset),this._offset+=2,this._str(J);case 219:return J=this._view.getUint32(this._offset),this._offset+=4,this._str(J);case 220:return J=this._view.getUint16(this._offset),this._offset+=2,this._array(J);case 221:return J=this._view.getUint32(this._offset),this._offset+=4,this._array(J);case 222:return J=this._view.getUint16(this._offset),this._offset+=2,this._map(J);case 223:return J=this._view.getUint32(this._offset),this._offset+=4,this._map(J)}throw new Error("Could not parse")},u.decode=function(H){var u=new J(H,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),O=u._parse();if(u._offset!==H.byteLength)throw new Error(H.byteLength-u._offset+" trailing bytes");return O};function O(H,u,J){for(var O=0,U=0,h=J.length;U<h;U++)(O=J.charCodeAt(U))<128?H.setUint8(u++,O):O<2048?(H.setUint8(u++,192|O>>6),H.setUint8(u++,128|63&O)):O<55296||O>=57344?(H.setUint8(u++,224|O>>12),H.setUint8(u++,128|O>>6&63),H.setUint8(u++,128|63&O)):(U++,O=65536+((1023&O)<<10|1023&J.charCodeAt(U)),H.setUint8(u++,240|O>>18),H.setUint8(u++,128|O>>12&63),H.setUint8(u++,128|O>>6&63),H.setUint8(u++,128|63&O))}function U(H,u,J){var O=typeof J,h=0,w=0,g=0,B=0,b=0,d=0;if("string"===O){if(b=function(H){for(var u=0,J=0,O=0,U=H.length;O<U;O++)(u=H.charCodeAt(O))<128?J+=1:u<2048?J+=2:u<55296||u>=57344?J+=3:(O++,J+=4);return J}(J),b<32)H.push(160|b),d=1;else if(b<256)H.push(217,b),d=2;else if(b<65536)H.push(218,b>>8,b),d=3;else{if(!(b<4294967296))throw new Error("String too long");H.push(219,b>>24,b>>16,b>>8,b),d=5}return u.push({_str:J,_length:b,_offset:H.length}),d+b}if("number"===O)return Math.floor(J)===J&&isFinite(J)?J>=0?J<128?(H.push(J),1):J<256?(H.push(204,J),2):J<65536?(H.push(205,J>>8,J),3):J<4294967296?(H.push(206,J>>24,J>>16,J>>8,J),5):(g=J/Math.pow(2,32)|0,B=J>>>0,H.push(207,g>>24,g>>16,g>>8,g,B>>24,B>>16,B>>8,B),9):J>=-32?(H.push(J),1):J>=-128?(H.push(208,J),2):J>=-32768?(H.push(209,J>>8,J),3):J>=-2147483648?(H.push(210,J>>24,J>>16,J>>8,J),5):(g=Math.floor(J/Math.pow(2,32)),B=J>>>0,H.push(211,g>>24,g>>16,g>>8,g,B>>24,B>>16,B>>8,B),9):(H.push(203),u.push({_float:J,_length:8,_offset:H.length}),9);if("object"===O){if(null===J)return H.push(192),1;if(Array.isArray(J)){if((b=J.length)<16)H.push(144|b),d=1;else if(b<65536)H.push(220,b>>8,b),d=3;else{if(!(b<4294967296))throw new Error("Array too large");H.push(221,b>>24,b>>16,b>>8,b),d=5}for(h=0;h<b;h++)d+=U(H,u,J[h]);return d}if(J instanceof Date){var G=J.getTime(),P=Math.floor(G/1e3),mH=1e6*(G-1e3*P);return P>=0&&mH>=0&&P<=17179869183?0===mH&&P<=4294967295?(H.push(214,255,P>>24,P>>16,P>>8,P),6):(g=P/4294967296,B=4294967295&P,H.push(215,255,mH>>22,mH>>14,mH>>6,g,B>>24,B>>16,B>>8,B),10):(g=Math.floor(P/4294967296),B=P>>>0,H.push(199,12,255,mH>>24,mH>>16,mH>>8,mH,g>>24,g>>16,g>>8,g,B>>24,B>>16,B>>8,B),15)}if(J instanceof ArrayBuffer){if((b=J.byteLength)<256)H.push(196,b),d=2;else if(b<65536)H.push(197,b>>8,b),d=3;else{if(!(b<4294967296))throw new Error("Buffer too large");H.push(198,b>>24,b>>16,b>>8,b),d=5}return u.push({_bin:J,_length:b,_offset:H.length}),d+b}if("function"===typeof J.toJSON)return U(H,u,J.toJSON());var l=[],r="",p=Object.keys(J);for(h=0,w=p.length;h<w;h++)void 0!==J[r=p[h]]&&"function"!==typeof J[r]&&l.push(r);if((b=l.length)<16)H.push(128|b),d=1;else if(b<65536)H.push(222,b>>8,b),d=3;else{if(!(b<4294967296))throw new Error("Object too large");H.push(223,b>>24,b>>16,b>>8,b),d=5}for(h=0;h<b;h++)d+=U(H,u,r=l[h]),d+=U(H,u,J[r]);return d}if("boolean"===O)return H.push(J?195:194),1;if("undefined"===O)return H.push(192),1;if("function"===typeof J.toJSON)return U(H,u,J.toJSON());throw new Error("Could not encode")}u.encode=function(H){var u=[],J=[],h=U(u,J,H),w=new ArrayBuffer(h),g=new DataView(w),B=0,b=0,d=-1;J.length>0&&(d=J[0]._offset);for(var G,P=0,mH=0,l=0,r=u.length;l<r;l++)if(g.setUint8(b+l,u[l]),l+1===d){if(P=(G=J[B])._length,mH=b+d,G._bin)for(var p=new Uint8Array(G._bin),a=0;a<P;a++)g.setUint8(mH+a,p[a]);else G._str?O(g,mH,G._str):void 0!==G._float&&g.setFloat64(mH,G._float);b+=P,J[++B]&&(d=J[B]._offset)}return w}},13059:(H,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.NoneSerializer=void 0;u.NoneSerializer=class{setState(H){}getState(){return null}patch(H){}teardown(){}handshake(H){}}},13051:(H,u,J)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.SchemaSerializer=void 0;const O=J(13011);u.SchemaSerializer=class{setState(H){return this.state.decode(H)}getState(){return this.state}patch(H){return this.state.decode(H)}teardown(){var H,u;null===(u=null===(H=this.state)||void 0===H?void 0:H.$changes)||void 0===u||u.root.clearRefs()}handshake(H,u){if(this.state){(new O.Reflection).decode(H,u)}else this.state=O.Reflection.decode(H,u)}}},12990:(H,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.getSerializer=u.registerSerializer=void 0;const J={};u.registerSerializer=function(H,u){J[H]=u},u.getSerializer=function(H){const u=J[H];if(!u)throw new Error("missing serializer: "+H);return u}},12975:function(H,u,J){"use strict";var O=this&&this.__importDefault||function(H){return H&&H.__esModule?H:{default:H}};Object.defineProperty(u,"__esModule",{value:!0}),u.WebSocketTransport=void 0;const U=O(J(12977)),h=globalThis.WebSocket||U.default;u.WebSocketTransport=class{constructor(H){this.events=H}send(H){H instanceof ArrayBuffer?this.ws.send(H):Array.isArray(H)&&this.ws.send(new Uint8Array(H).buffer)}connect(H,u){try{this.ws=new h(H,{headers:u,protocols:this.protocols})}catch(J){this.ws=new h(H,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(H,u){this.ws.close(H,u)}get isOpen(){return this.ws.readyState===h.OPEN}}},12977:H=>{"use strict";H.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13416:H=>{"use strict";H.exports=function(H){for(var u=new Array(H),J=0;J<H;++J)u[J]=J;return u}},13423:H=>{function u(H){return!!H.constructor&&"function"===typeof H.constructor.isBuffer&&H.constructor.isBuffer(H)}H.exports=function(H){return null!=H&&(u(H)||function(H){return"function"===typeof H.readFloatLE&&"function"===typeof H.slice&&u(H.slice(0,0))}(H)||!!H._isBuffer)}},13407:(H,u,J)=>{var O=J(13416),U=J(13423),h="undefined"!==typeof Float64Array;function w(H,u){return H[0]-u[0]}function g(){var H,u=this.stride,J=new Array(u.length);for(H=0;H<J.length;++H)J[H]=[Math.abs(u[H]),H];J.sort(w);var O=new Array(J.length);for(H=0;H<O.length;++H)O[H]=J[H][1];return O}function B(H,u){var J=["View",u,"d",H].join("");u<0&&(J="View_Nil"+H);var U="generic"===H;if(-1===u){var h="function "+J+"(a){this.data=a;};var proto="+J+".prototype;proto.dtype='"+H+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+J+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+J+"(a){return new "+J+"(a);}";return new Function(h)()}if(0===u){h="function "+J+"(a,d) {this.data = a;this.offset = d};var proto="+J+".prototype;proto.dtype='"+H+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+J+"_copy() {return new "+J+"(this.data,this.offset)};proto.pick=function "+J+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+J+"_get(){return "+(U?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+J+"_set(v){return "+(U?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+J+"(a,b,c,d){return new "+J+"(a,d)}";return new Function("TrivialArray",h)(b[H][0])}h=["'use strict'"];var w=O(u),B=w.map((function(H){return"i"+H})),d="this.offset+"+w.map((function(H){return"this.stride["+H+"]*i"+H})).join("+"),G=w.map((function(H){return"b"+H})).join(","),P=w.map((function(H){return"c"+H})).join(",");h.push("function "+J+"(a,"+G+","+P+",d){this.data=a","this.shape=["+G+"]","this.stride=["+P+"]","this.offset=d|0}","var proto="+J+".prototype","proto.dtype='"+H+"'","proto.dimension="+u),h.push("Object.defineProperty(proto,'size',{get:function "+J+"_size(){return "+w.map((function(H){return"this.shape["+H+"]"})).join("*"),"}})"),1===u?h.push("proto.order=[0]"):(h.push("Object.defineProperty(proto,'order',{get:"),u<4?(h.push("function "+J+"_order(){"),2===u?h.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===u&&h.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):h.push("ORDER})")),h.push("proto.set=function "+J+"_set("+B.join(",")+",v){"),U?h.push("return this.data.set("+d+",v)}"):h.push("return this.data["+d+"]=v}"),h.push("proto.get=function "+J+"_get("+B.join(",")+"){"),U?h.push("return this.data.get("+d+")}"):h.push("return this.data["+d+"]}"),h.push("proto.index=function "+J+"_index(",B.join(),"){return "+d+"}"),h.push("proto.hi=function "+J+"_hi("+B.join(",")+"){return new "+J+"(this.data,"+w.map((function(H){return["(typeof i",H,"!=='number'||i",H,"<0)?this.shape[",H,"]:i",H,"|0"].join("")})).join(",")+","+w.map((function(H){return"this.stride["+H+"]"})).join(",")+",this.offset)}");var mH=w.map((function(H){return"a"+H+"=this.shape["+H+"]"})),l=w.map((function(H){return"c"+H+"=this.stride["+H+"]"}));h.push("proto.lo=function "+J+"_lo("+B.join(",")+"){var b=this.offset,d=0,"+mH.join(",")+","+l.join(","));for(var r=0;r<u;++r)h.push("if(typeof i"+r+"==='number'&&i"+r+">=0){d=i"+r+"|0;b+=c"+r+"*d;a"+r+"-=d}");h.push("return new "+J+"(this.data,"+w.map((function(H){return"a"+H})).join(",")+","+w.map((function(H){return"c"+H})).join(",")+",b)}"),h.push("proto.step=function "+J+"_step("+B.join(",")+"){var "+w.map((function(H){return"a"+H+"=this.shape["+H+"]"})).join(",")+","+w.map((function(H){return"b"+H+"=this.stride["+H+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(r=0;r<u;++r)h.push("if(typeof i"+r+"==='number'){d=i"+r+"|0;if(d<0){c+=b"+r+"*(a"+r+"-1);a"+r+"=ceil(-a"+r+"/d)}else{a"+r+"=ceil(a"+r+"/d)}b"+r+"*=d}");h.push("return new "+J+"(this.data,"+w.map((function(H){return"a"+H})).join(",")+","+w.map((function(H){return"b"+H})).join(",")+",c)}");var p=new Array(u),a=new Array(u);for(r=0;r<u;++r)p[r]="a[i"+r+"]",a[r]="b[i"+r+"]";h.push("proto.transpose=function "+J+"_transpose("+B+"){"+B.map((function(H,u){return H+"=("+H+"===undefined?"+u+":"+H+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+J+"(this.data,"+p.join(",")+","+a.join(",")+",this.offset)}"),h.push("proto.pick=function "+J+"_pick("+B+"){var a=[],b=[],c=this.offset");for(r=0;r<u;++r)h.push("if(typeof i"+r+"==='number'&&i"+r+">=0){c=(c+this.stride["+r+"]*i"+r+")|0}else{a.push(this.shape["+r+"]);b.push(this.stride["+r+"])}");return h.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),h.push("return function construct_"+J+"(data,shape,stride,offset){return new "+J+"(data,"+w.map((function(H){return"shape["+H+"]"})).join(",")+","+w.map((function(H){return"stride["+H+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",h.join("\n"))(b[H],g)}var b={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};H.exports=function(H,u,J,O){if(void 0===H)return(0,b.array[0])([]);"number"===typeof H&&(H=[H]),void 0===u&&(u=[H.length]);var w=u.length;if(void 0===J){J=new Array(w);for(var g=w-1,d=1;g>=0;--g)J[g]=d,d*=u[g]}if(void 0===O){O=0;for(g=0;g<w;++g)J[g]<0&&(O-=(u[g]-1)*J[g])}for(var G=function(H){if(U(H))return"buffer";if(h)switch(Object.prototype.toString.call(H)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(H)?"array":"generic"}(H),P=b[G];P.length<=w+1;)P.push(B(G,P.length-1));return(0,P[w+1])(H,u,J,O)}},14407:H=>{var u;self,u=()=>(()=>{"use strict";var H={d:(u,J)=>{for(var O in J)H.o(J,O)&&!H.o(u,O)&&Object.defineProperty(u,O,{enumerable:!0,get:J[O]})},o:(H,u)=>Object.prototype.hasOwnProperty.call(H,u)},u={};H.d(u,{default:()=>V});var J,O=function(H,u){var J=u.x-H.x,O=u.y-H.y;return Math.sqrt(J*J+O*O)},U=function(H){return H*(Math.PI/180)},h=new Map,w=function(H){h.has(H)&&clearTimeout(h.get(H)),h.set(H,setTimeout(H,100))},g=function(H,u,J){for(var O,U=u.split(/[ ,]+/g),h=0;h<U.length;h+=1)O=U[h],H.addEventListener?H.addEventListener(O,J,!1):H.attachEvent&&H.attachEvent(O,J)},B=function(H,u,J){for(var O,U=u.split(/[ ,]+/g),h=0;h<U.length;h+=1)O=U[h],H.removeEventListener?H.removeEventListener(O,J):H.detachEvent&&H.detachEvent(O,J)},b=function(H){return H.preventDefault(),H.type.match(/^touch/)?H.changedTouches:H},d=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},G=function(H,u){u.top||u.right||u.bottom||u.left?(H.style.top=u.top,H.style.right=u.right,H.style.bottom=u.bottom,H.style.left=u.left):(H.style.left=u.x+"px",H.style.top=u.y+"px")},P=function(H,u,J){var O=mH(H);for(var U in O)if(O.hasOwnProperty(U))if("string"==typeof u)O[U]=u+" "+J;else{for(var h="",w=0,g=u.length;w<g;w+=1)h+=u[w]+" "+J+", ";O[U]=h.slice(0,-2)}return O},mH=function(H){var u={};return u[H]="",["webkit","Moz","o"].forEach((function(J){u[J+H.charAt(0).toUpperCase()+H.slice(1)]=""})),u},l=function(H,u){for(var J in u)u.hasOwnProperty(J)&&(H[J]=u[J]);return H},r=function(H,u){if(H.length)for(var J=0,O=H.length;J<O;J+=1)u(H[J]);else u(H)},p="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,a=window.matchMedia("(any-hover: none)").matches,k=!!("ontouchstart"in window),C=!!window.PointerEvent,j=!!window.MSPointerEvent,M={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},L={start:"mousedown",move:"mousemove",end:"mouseup"},Z={};function Y(){}p&&!a?J=M:C?J={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:j?J={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:k?(J=M,Z=L):J=L,Y.prototype.on=function(H,u){var J,O=this,U=H.split(/[ ,]+/g);O._handlers_=O._handlers_||{};for(var h=0;h<U.length;h+=1)J=U[h],O._handlers_[J]=O._handlers_[J]||[],O._handlers_[J].push(u);return O},Y.prototype.off=function(H,u){var J=this;return J._handlers_=J._handlers_||{},void 0===H?J._handlers_={}:void 0===u?J._handlers_[H]=null:J._handlers_[H]&&J._handlers_[H].indexOf(u)>=0&&J._handlers_[H].splice(J._handlers_[H].indexOf(u),1),J},Y.prototype.trigger=function(H,u){var J,O=this,U=H.split(/[ ,]+/g);O._handlers_=O._handlers_||{};for(var h=0;h<U.length;h+=1)J=U[h],O._handlers_[J]&&O._handlers_[J].length&&O._handlers_[J].forEach((function(H){H.call(O,{type:J,target:O},u)}))},Y.prototype.config=function(H){var u=this;u.options=u.defaults||{},H&&(u.options=function(H,u){var J={};for(var O in H)H.hasOwnProperty(O)&&u.hasOwnProperty(O)?J[O]=u[O]:H.hasOwnProperty(O)&&(J[O]=H[O]);return J}(u.options,H))},Y.prototype.bindEvt=function(H,u){var O=this;return O._domHandlers_=O._domHandlers_||{},O._domHandlers_[u]=function(){"function"==typeof O["on"+u]?O["on"+u].apply(O,arguments):console.warn('[WARNING] : Missing "on'+u+'" handler.')},g(H,J[u],O._domHandlers_[u]),Z[u]&&g(H,Z[u],O._domHandlers_[u]),O},Y.prototype.unbindEvt=function(H,u){var O=this;return O._domHandlers_=O._domHandlers_||{},B(H,J[u],O._domHandlers_[u]),Z[u]&&B(H,Z[u],O._domHandlers_[u]),delete O._domHandlers_[u],this};const F=Y;function s(H,u){return this.identifier=u.identifier,this.position=u.position,this.frontPosition=u.frontPosition,this.collection=H,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(u),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=s.id,s.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}s.prototype=new F,s.constructor=s,s.id=0,s.prototype.buildEl=function(H){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},s.prototype.stylize=function(){if(this.options.dataOnly)return this;var H=this.options.fadeTime+"ms",u=function(){var H=mH("borderRadius");for(var u in H)H.hasOwnProperty(u)&&(H[u]="50%");return H}(),J=P("transition","opacity",H),O={};return O.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},O.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},O.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},l(O.el,J),"circle"===this.options.shape&&l(O.back,u),l(O.front,u),this.applyStyles(O),this},s.prototype.applyStyles=function(H){for(var u in this.ui)if(this.ui.hasOwnProperty(u))for(var J in H[u])this.ui[u].style[J]=H[u][J];return this},s.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},s.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},s.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},s.prototype.show=function(H){var u=this;return u.options.dataOnly||(clearTimeout(u.removeTimeout),clearTimeout(u.showTimeout),clearTimeout(u.restTimeout),u.addToDom(),u.restCallback(),setTimeout((function(){u.ui.el.style.opacity=1}),0),u.showTimeout=setTimeout((function(){u.trigger("shown",u.instance),"function"==typeof H&&H.call(this)}),u.options.fadeTime)),u},s.prototype.hide=function(H){var u=this;if(u.options.dataOnly)return u;if(u.ui.el.style.opacity=u.options.restOpacity,clearTimeout(u.removeTimeout),clearTimeout(u.showTimeout),clearTimeout(u.restTimeout),u.removeTimeout=setTimeout((function(){var J="dynamic"===u.options.mode?"none":"block";u.ui.el.style.display=J,"function"==typeof H&&H.call(u),u.trigger("hidden",u.instance)}),u.options.fadeTime),u.options.restJoystick){var J=u.options.restJoystick,O={};O.x=!0===J||!1!==J.x?0:u.instance.frontPosition.x,O.y=!0===J||!1!==J.y?0:u.instance.frontPosition.y,u.setPosition(H,O)}return u},s.prototype.setPosition=function(H,u){var J=this;J.frontPosition={x:u.x,y:u.y};var O=J.options.fadeTime+"ms",U={};U.front=P("transition",["transform"],O);var h={front:{}};h.front={transform:"translate("+J.frontPosition.x+"px,"+J.frontPosition.y+"px)"},J.applyStyles(U),J.applyStyles(h),J.restTimeout=setTimeout((function(){"function"==typeof H&&H.call(J),J.restCallback()}),J.options.fadeTime)},s.prototype.restCallback=function(){var H=this,u={};u.front=P("transition","none",""),H.applyStyles(u),H.trigger("rested",H.instance)},s.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},s.prototype.computeDirection=function(H){var u,J,O,U=H.angle.radian,h=Math.PI/4,w=Math.PI/2;if(U>h&&U<3*h&&!H.lockX?u="up":U>-h&&U<=h&&!H.lockY?u="left":U>3*-h&&U<=-h&&!H.lockX?u="down":H.lockY||(u="right"),H.lockY||(J=U>-w&&U<w?"left":"right"),H.lockX||(O=U>0?"up":"down"),H.force>this.options.threshold){var g,B={};for(g in this.direction)this.direction.hasOwnProperty(g)&&(B[g]=this.direction[g]);var b={};for(g in this.direction={x:J,y:O,angle:u},H.direction=this.direction,B)B[g]===this.direction[g]&&(b[g]=!0);if(b.x&&b.y&&b.angle)return H;b.x&&b.y||this.trigger("plain",H),b.x||this.trigger("plain:"+J,H),b.y||this.trigger("plain:"+O,H),b.angle||this.trigger("dir dir:"+u,H)}else this.resetDirection();return H};const A=s;function t(H,u){var J=this;J.nipples=[],J.idles=[],J.actives=[],J.ids=[],J.pressureIntervals={},J.manager=H,J.id=t.id,t.id+=1,J.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},J.config(u),"static"!==J.options.mode&&"semi"!==J.options.mode||(J.options.multitouch=!1),J.options.multitouch||(J.options.maxNumberOfNipples=1);var O=getComputedStyle(J.options.zone.parentElement);return O&&"flex"===O.display&&(J.parentIsFlex=!0),J.updateBox(),J.prepareNipples(),J.Zm(),J.begin(),J.nipples}t.prototype=new F,t.constructor=t,t.id=0,t.prototype.prepareNipples=function(){var H=this,u=H.nipples;u.on=H.on.bind(H),u.off=H.off.bind(H),u.options=H.options,u.destroy=H.destroy.bind(H),u.ids=H.ids,u.id=H.id,u.processOnMove=H.processOnMove.bind(H),u.processOnEnd=H.processOnEnd.bind(H),u.get=function(H){if(void 0===H)return u[0];for(var J=0,O=u.length;J<O;J+=1)if(u[J].identifier===H)return u[J];return!1}},t.prototype.Zm=function(){var H=this;H.bindEvt(H.options.zone,"start"),H.options.zone.style.touchAction="none",H.options.zone.style.msTouchAction="none"},t.prototype.begin=function(){var H=this,u=H.options;if("static"===u.mode){var J=H.createNipple(u.position,H.manager.getIdentifier());J.add(),H.idles.push(J)}},t.prototype.createNipple=function(H,u){var J=this,O=J.manager.scroll,U={},h=J.options,w=J.parentIsFlex?O.x:O.x+J.box.left,g=J.parentIsFlex?O.y:O.y+J.box.top;if(H.x&&H.y)U={x:H.x-w,y:H.y-g};else if(H.top||H.right||H.bottom||H.left){var B=document.createElement("DIV");B.style.display="hidden",B.style.top=H.top,B.style.right=H.right,B.style.bottom=H.bottom,B.style.left=H.left,B.style.position="absolute",h.zone.appendChild(B);var b=B.getBoundingClientRect();h.zone.removeChild(B),U=H,H={x:b.left+O.x,y:b.top+O.y}}var d=new A(J,{color:h.color,size:h.size,threshold:h.threshold,fadeTime:h.fadeTime,dataOnly:h.dataOnly,restJoystick:h.restJoystick,restOpacity:h.restOpacity,mode:h.mode,identifier:u,position:H,zone:h.zone,frontPosition:{x:0,y:0},shape:h.shape});return h.dataOnly||(G(d.ui.el,U),G(d.ui.front,d.frontPosition)),J.nipples.push(d),J.trigger("added "+d.identifier+":added",d),J.manager.trigger("added "+d.identifier+":added",d),J.bindNipple(d),d},t.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},t.prototype.bindNipple=function(H){var u,J=this,O=function(H,O){u=H.type+" "+O.id+":"+H.type,J.trigger(u,O)};H.on("destroyed",J.onDestroyed.bind(J)),H.on("shown hidden rested dir plain",O),H.on("dir:up dir:right dir:down dir:left",O),H.on("plain:up plain:right plain:down plain:left",O)},t.prototype.pressureFn=function(H,u,J){var O=this,U=0;clearInterval(O.pressureIntervals[J]),O.pressureIntervals[J]=setInterval(function(){var J=H.force||H.pressure||H.webkitForce||0;J!==U&&(u.trigger("pressure",J),O.trigger("pressure "+u.identifier+":pressure",J),U=J)}.bind(O),100)},t.prototype.onstart=function(H){var u=this,J=u.options,O=H;return H=b(H),u.updateBox(),r(H,(function(U){u.actives.length<J.maxNumberOfNipples?u.processOnStart(U):O.type.match(/^touch/)&&(Object.keys(u.manager.ids).forEach((function(J){if(Object.values(O.touches).findIndex((function(H){return H.identifier===J}))<0){var U=[H[0]];U.identifier=J,u.processOnEnd(U)}})),u.actives.length<J.maxNumberOfNipples&&u.processOnStart(U))})),u.manager.bindDocument(),!1},t.prototype.processOnStart=function(H){var u,J=this,U=J.options,h=J.manager.getIdentifier(H),w=H.force||H.pressure||H.webkitForce||0,g={x:H.pageX,y:H.pageY},B=J.getOrCreate(h,g);B.identifier!==h&&J.manager.removeIdentifier(B.identifier),B.identifier=h;var b=function(u){u.trigger("start",u),J.trigger("start "+u.id+":start",u),u.show(),w>0&&J.pressureFn(H,u,u.identifier),J.processOnMove(H)};if((u=J.idles.indexOf(B))>=0&&J.idles.splice(u,1),J.actives.push(B),J.ids.push(B.identifier),"semi"!==U.mode)b(B);else{if(!(O(g,B.position)<=U.catchDistance))return B.destroy(),void J.processOnStart(H);b(B)}return B},t.prototype.getOrCreate=function(H,u){var J,O=this,U=O.options;return/(semi|static)/.test(U.mode)?(J=O.idles[0])?(O.idles.splice(0,1),J):"semi"===U.mode?O.createNipple(u,H):(console.warn("Coudln't find the needed nipple."),!1):J=O.createNipple(u,H)},t.prototype.processOnMove=function(H){var u=this,J=u.options,h=u.manager.getIdentifier(H),w=u.nipples.get(h),g=u.manager.scroll;if(function(H){return isNaN(H.buttons)?0!==H.pressure:0!==H.buttons}(H)){if(!w)return console.error("Found zombie joystick with ID "+h),void u.manager.removeIdentifier(h);if(J.dynamicPage){var B=w.el.getBoundingClientRect();w.position={x:g.x+B.left,y:g.y+B.top}}w.identifier=h;var b=w.options.size/2,d={x:H.pageX,y:H.pageY};J.lockX&&(d.y=w.position.y),J.lockY&&(d.x=w.position.x);var G,P,mH,l,r,p,a,k,C,j,M=O(d,w.position),L=(G=d,mH=(P=w.position).x-G.x,l=P.y-G.y,function(H){return H*(180/Math.PI)}(Math.atan2(l,mH))),Z=U(L),Y=M/b,F={distance:M,position:d};if("circle"===w.options.shape?(r=Math.min(M,b),a=w.position,k=r,j={x:0,y:0},C=U(C=L),j.x=a.x-k*Math.cos(C),j.y=a.y-k*Math.sin(C),p=j):(p=function(H,u,J){return{x:Math.min(Math.max(H.x,u.x-J),u.x+J),y:Math.min(Math.max(H.y,u.y-J),u.y+J)}}(d,w.position,b),r=O(p,w.position)),J.follow){if(M>b){var s=d.x-p.x,A=d.y-p.y;w.position.x+=s,w.position.y+=A,w.el.style.top=w.position.y-(u.box.top+g.y)+"px",w.el.style.left=w.position.x-(u.box.left+g.x)+"px",M=O(d,w.position)}}else d=p,M=r;var t=d.x-w.position.x,e=d.y-w.position.y;w.frontPosition={x:t,y:e},J.dataOnly||(w.ui.front.style.transform="translate("+t+"px,"+e+"px)");var c={identifier:w.identifier,position:d,force:Y,pressure:H.force||H.pressure||H.webkitForce||0,distance:M,angle:{radian:Z,degree:L},vector:{x:t/b,y:-e/b},raw:F,instance:w,lockX:J.lockX,lockY:J.lockY};(c=w.computeDirection(c)).angle={radian:U(180-L),degree:180-L},w.trigger("move",c),u.trigger("move "+w.id+":move",c)}else this.processOnEnd(H)},t.prototype.processOnEnd=function(H){var u=this,J=u.options,O=u.manager.getIdentifier(H),U=u.nipples.get(O),h=u.manager.removeIdentifier(U.identifier);U&&(J.dataOnly||U.hide((function(){"dynamic"===J.mode&&(U.trigger("removed",U),u.trigger("removed "+U.id+":removed",U),u.manager.trigger("removed "+U.id+":removed",U),U.destroy())})),clearInterval(u.pressureIntervals[U.identifier]),U.resetDirection(),U.trigger("end",U),u.trigger("end "+U.id+":end",U),u.ids.indexOf(U.identifier)>=0&&u.ids.splice(u.ids.indexOf(U.identifier),1),u.actives.indexOf(U)>=0&&u.actives.splice(u.actives.indexOf(U),1),/(semi|static)/.test(J.mode)?u.idles.push(U):u.nipples.indexOf(U)>=0&&u.nipples.splice(u.nipples.indexOf(U),1),u.manager.unbindDocument(),/(semi|static)/.test(J.mode)&&(u.manager.ids[h.id]=h.identifier))},t.prototype.onDestroyed=function(H,u){var J=this;J.nipples.indexOf(u)>=0&&J.nipples.splice(J.nipples.indexOf(u),1),J.actives.indexOf(u)>=0&&J.actives.splice(J.actives.indexOf(u),1),J.idles.indexOf(u)>=0&&J.idles.splice(J.idles.indexOf(u),1),J.ids.indexOf(u.identifier)>=0&&J.ids.splice(J.ids.indexOf(u.identifier),1),J.manager.removeIdentifier(u.identifier),J.manager.unbindDocument()},t.prototype.destroy=function(){var H=this;for(var u in H.unbindEvt(H.options.zone,"start"),H.nipples.forEach((function(H){H.destroy()})),H.pressureIntervals)H.pressureIntervals.hasOwnProperty(u)&&clearInterval(H.pressureIntervals[u]);H.trigger("destroyed",H.nipples),H.manager.unbindDocument(),H.off()};const e=t;function c(H){var u=this;u.ids={},u.index=0,u.collections=[],u.scroll=d(),u.config(H),u.prepareCollections();var J=function(){var H;u.collections.forEach((function(J){J.forEach((function(J){H=J.el.getBoundingClientRect(),J.position={x:u.scroll.x+H.left,y:u.scroll.y+H.top}}))}))};g(window,"resize",(function(){w(J)}));var O=function(){u.scroll=d()};return g(window,"scroll",(function(){w(O)})),u.collections}c.prototype=new F,c.constructor=c,c.prototype.prepareCollections=function(){var H=this;H.collections.create=H.create.bind(H),H.collections.on=H.on.bind(H),H.collections.off=H.off.bind(H),H.collections.destroy=H.destroy.bind(H),H.collections.get=function(u){var J;return H.collections.every((function(H){return!(J=H.get(u))})),J}},c.prototype.create=function(H){return this.createCollection(H)},c.prototype.createCollection=function(H){var u=this,J=new e(u,H);return u.bindCollection(J),u.collections.push(J),J},c.prototype.bindCollection=function(H){var u,J=this,O=function(H,O){u=H.type+" "+O.id+":"+H.type,J.trigger(u,O)};H.on("destroyed",J.onDestroyed.bind(J)),H.on("shown hidden rested dir plain",O),H.on("dir:up dir:right dir:down dir:left",O),H.on("plain:up plain:right plain:down plain:left",O)},c.prototype.bindDocument=function(){var H=this;H.binded||(H.bindEvt(document,"move").bindEvt(document,"end"),H.binded=!0)},c.prototype.unbindDocument=function(H){var u=this;Object.keys(u.ids).length&&!0!==H||(u.unbindEvt(document,"move").unbindEvt(document,"end"),u.binded=!1)},c.prototype.getIdentifier=function(H){var u;return H?void 0===(u=void 0===H.identifier?H.pointerId:H.identifier)&&(u=this.latest||0):u=this.index,void 0===this.ids[u]&&(this.ids[u]=this.index,this.index+=1),this.latest=u,this.ids[u]},c.prototype.removeIdentifier=function(H){var u={};for(var J in this.ids)if(this.ids[J]===H){u.id=J,u.identifier=this.ids[J],delete this.ids[J];break}return u},c.prototype.onmove=function(H){return this.onAny("move",H),!1},c.prototype.onend=function(H){return this.onAny("end",H),!1},c.prototype.oncancel=function(H){return this.onAny("end",H),!1},c.prototype.onAny=function(H,u){var J,O=this,U="processOn"+H.charAt(0).toUpperCase()+H.slice(1);u=b(u);var h=function(H,u,J){J.ids.indexOf(u)>=0&&(J[U](H),H._found_=!0)};return r(u,(function(H){J=O.getIdentifier(H),r(O.collections,h.bind(null,H,J)),H._found_||O.removeIdentifier(J)})),!1},c.prototype.destroy=function(){var H=this;H.unbindDocument(!0),H.ids={},H.index=0,H.collections.forEach((function(H){H.destroy()})),H.off()},c.prototype.onDestroyed=function(H,u){var J=this;if(J.collections.indexOf(u)<0)return!1;J.collections.splice(J.collections.indexOf(u),1)};var n=new c;const V={create:function(H){return n.create(H)},factory:n};return u.default})(),H.exports=u()},13442:(H,u,J)=>{"use strict";const{Deflate:O,deflate:U,deflateRaw:h,gzip:w}=J(13444),{Inflate:g,inflate:B,inflateRaw:b,ungzip:d}=J(13505),G=J(13485);H.exports.Deflate=O,H.exports.deflate=U,H.exports.deflateRaw=h,H.exports.gzip=w,H.exports.Inflate=g,H.exports.inflate=B,H.exports.inflateRaw=b,H.exports.ungzip=d,H.exports.constants=G},13444:(H,u,J)=>{"use strict";const O=J(13449),U=J(13487),h=J(13494),w=J(13476),g=J(13501),B=Object.prototype.toString,{Z_NO_FLUSH:b,Z_SYNC_FLUSH:d,Z_FULL_FLUSH:G,Z_FINISH:P,Z_OK:mH,Z_STREAM_END:l,Z_DEFAULT_COMPRESSION:r,Z_DEFAULT_STRATEGY:p,Z_DEFLATED:a}=J(13485);function k(H){this.options=U.assign({level:r,method:a,fH:16384,windowBits:15,memLevel:8,strategy:p},H||{});let u=this.options;u.raw&&u.windowBits>0?u.windowBits=-u.windowBits:u.gzip&&u.windowBits>0&&u.windowBits<16&&(u.windowBits+=16),this.err=0,this.bu="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;let J=O.deflateInit2(this.strm,u.level,u.method,u.windowBits,u.memLevel,u.strategy);if(J!==mH)throw new Error(w[J]);if(u.header&&O.deflateSetHeader(this.strm,u.header),u.dictionary){let H;if(H="string"===typeof u.dictionary?h.string2buf(u.dictionary):"[object ArrayBuffer]"===B.call(u.dictionary)?new Uint8Array(u.dictionary):u.dictionary,J=O.deflateSetDictionary(this.strm,H),J!==mH)throw new Error(w[J]);this._dict_set=!0}}function C(H,u){const J=new k(u);if(J.push(H,!0),J.err)throw J.bu||w[J.err];return J.result}k.prototype.push=function(H,u){const J=this.strm,U=this.options.fH;let w,g;if(this.ended)return!1;for(g=u===~~u?u:!0===u?P:b,"string"===typeof H?J.input=h.string2buf(H):"[object ArrayBuffer]"===B.call(H)?J.input=new Uint8Array(H):J.input=H,J.next_in=0,J.avail_in=J.input.length;;)if(0===J.avail_out&&(J.output=new Uint8Array(U),J.next_out=0,J.avail_out=U),(g===d||g===G)&&J.avail_out<=6)this.onData(J.output.subarray(0,J.next_out)),J.avail_out=0;else{if(w=O.deflate(J,g),w===l)return J.next_out>0&&this.onData(J.output.subarray(0,J.next_out)),w=O.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===mH;if(0!==J.avail_out){if(g>0&&J.next_out>0)this.onData(J.output.subarray(0,J.next_out)),J.avail_out=0;else if(0===J.avail_in)break}else this.onData(J.output)}return!0},k.prototype.onData=function(H){this.chunks.push(H)},k.prototype.onEnd=function(H){H===mH&&(this.result=U.flattenChunks(this.chunks)),this.chunks=[],this.err=H,this.bu=this.strm.bu},H.exports.Deflate=k,H.exports.deflate=C,H.exports.deflateRaw=function(H,u){return(u=u||{}).raw=!0,C(H,u)},H.exports.gzip=function(H,u){return(u=u||{}).gzip=!0,C(H,u)},H.exports.constants=J(13485)},13505:(H,u,J)=>{"use strict";const O=J(13512),U=J(13487),h=J(13494),w=J(13476),g=J(13501),B=J(13529),b=Object.prototype.toString,{Z_NO_FLUSH:d,Z_FINISH:G,Z_OK:P,Z_STREAM_END:mH,Z_NEED_DICT:l,Z_STREAM_ERROR:r,Z_DATA_ERROR:p,Z_MEM_ERROR:a}=J(13485);function k(H){this.options=U.assign({fH:65536,windowBits:15,to:""},H||{});const u=this.options;u.raw&&u.windowBits>=0&&u.windowBits<16&&(u.windowBits=-u.windowBits,0===u.windowBits&&(u.windowBits=-15)),!(u.windowBits>=0&&u.windowBits<16)||H&&H.windowBits||(u.windowBits+=32),u.windowBits>15&&u.windowBits<48&&0===(15&u.windowBits)&&(u.windowBits|=15),this.err=0,this.bu="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;let J=O.inflateInit2(this.strm,u.windowBits);if(J!==P)throw new Error(w[J]);if(this.header=new B,O.inflateGetHeader(this.strm,this.header),u.dictionary&&("string"===typeof u.dictionary?u.dictionary=h.string2buf(u.dictionary):"[object ArrayBuffer]"===b.call(u.dictionary)&&(u.dictionary=new Uint8Array(u.dictionary)),u.raw&&(J=O.inflateSetDictionary(this.strm,u.dictionary),J!==P)))throw new Error(w[J])}function C(H,u){const J=new k(u);if(J.push(H),J.err)throw J.bu||w[J.err];return J.result}k.prototype.push=function(H,u){const J=this.strm,U=this.options.fH,w=this.options.dictionary;let g,B,k;if(this.ended)return!1;for(B=u===~~u?u:!0===u?G:d,"[object ArrayBuffer]"===b.call(H)?J.input=new Uint8Array(H):J.input=H,J.next_in=0,J.avail_in=J.input.length;;){for(0===J.avail_out&&(J.output=new Uint8Array(U),J.next_out=0,J.avail_out=U),g=O.inflate(J,B),g===l&&w&&(g=O.inflateSetDictionary(J,w),g===P?g=O.inflate(J,B):g===p&&(g=l));J.avail_in>0&&g===mH&&J.state.wrap>0&&0!==H[J.next_in];)O.inflateReset(J),g=O.inflate(J,B);switch(g){case r:case p:case l:case a:return this.onEnd(g),this.ended=!0,!1}if(k=J.avail_out,J.next_out&&(0===J.avail_out||g===mH))if("string"===this.options.to){let H=h.utf8border(J.output,J.next_out),u=J.next_out-H,O=h.buf2string(J.output,H);J.next_out=u,J.avail_out=U-u,u&&J.output.set(J.output.subarray(H,H+u),0),this.onData(O)}else this.onData(J.output.length===J.next_out?J.output:J.output.subarray(0,J.next_out));if(g!==P||0!==k){if(g===mH)return g=O.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,!0;if(0===J.avail_in)break}}return!0},k.prototype.onData=function(H){this.chunks.push(H)},k.prototype.onEnd=function(H){H===P&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=U.flattenChunks(this.chunks)),this.chunks=[],this.err=H,this.bu=this.strm.bu},H.exports.Inflate=k,H.exports.inflate=C,H.exports.inflateRaw=function(H,u){return(u=u||{}).raw=!0,C(H,u)},H.exports.ungzip=C,H.exports.constants=J(13485)},13487:H=>{"use strict";const u=(H,u)=>Object.prototype.hasOwnProperty.call(H,u);H.exports.assign=function(H){const J=Array.prototype.slice.call(arguments,1);for(;J.length;){const O=J.shift();if(O){if("object"!==typeof O)throw new TypeError(O+"must be non-object");for(const J in O)u(O,J)&&(H[J]=O[J])}}return H},H.exports.flattenChunks=H=>{let u=0;for(let O=0,U=H.length;O<U;O++)u+=H[O].length;const J=new Uint8Array(u);for(let O=0,U=0,h=H.length;O<h;O++){let u=H[O];J.set(u,U),U+=u.length}return J}},13494:H=>{"use strict";let u=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(O){u=!1}const J=new Uint8Array(256);for(let U=0;U<256;U++)J[U]=U>=252?6:U>=248?5:U>=240?4:U>=224?3:U>=192?2:1;J[254]=J[254]=1,H.exports.string2buf=H=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(H);let u,J,O,U,h,w=H.length,g=0;for(U=0;U<w;U++)J=H.charCodeAt(U),55296===(64512&J)&&U+1<w&&(O=H.charCodeAt(U+1),56320===(64512&O)&&(J=65536+(J-55296<<10)+(O-56320),U++)),g+=J<128?1:J<2048?2:J<65536?3:4;for(u=new Uint8Array(g),h=0,U=0;h<g;U++)J=H.charCodeAt(U),55296===(64512&J)&&U+1<w&&(O=H.charCodeAt(U+1),56320===(64512&O)&&(J=65536+(J-55296<<10)+(O-56320),U++)),J<128?u[h++]=J:J<2048?(u[h++]=192|J>>>6,u[h++]=128|63&J):J<65536?(u[h++]=224|J>>>12,u[h++]=128|J>>>6&63,u[h++]=128|63&J):(u[h++]=240|J>>>18,u[h++]=128|J>>>12&63,u[h++]=128|J>>>6&63,u[h++]=128|63&J);return u};H.exports.buf2string=(H,O)=>{const U=O||H.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(H.subarray(0,O));let h,w;const g=new Array(2*U);for(w=0,h=0;h<U;){let u=H[h++];if(u<128){g[w++]=u;continue}let O=J[u];if(O>4)g[w++]=65533,h+=O-1;else{for(u&=2===O?31:3===O?15:7;O>1&&h<U;)u=u<<6|63&H[h++],O--;O>1?g[w++]=65533:u<65536?g[w++]=u:(u-=65536,g[w++]=55296|u>>10&1023,g[w++]=56320|1023&u)}}return((H,J)=>{if(J<65534&&H.subarray&&u)return String.fromCharCode.apply(null,H.length===J?H:H.subarray(0,J));let O="";for(let u=0;u<J;u++)O+=String.fromCharCode(H[u]);return O})(g,w)},H.exports.utf8border=(H,u)=>{(u=u||H.length)>H.length&&(u=H.length);let O=u-1;for(;O>=0&&128===(192&H[O]);)O--;return O<0||0===O?u:O+J[H[O]]>u?O:u}},13461:H=>{"use strict";H.exports=(H,u,J,O)=>{let U=65535&H,h=H>>>16&65535,w=0;for(;0!==J;){w=J>2e3?2e3:J,J-=w;do{U=U+u[O++]|0,h=h+U|0}while(--w);U%=65521,h%=65521}return U|h<<16}},13485:H=>{"use strict";H.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13470:H=>{"use strict";const u=new Uint32Array((()=>{let H,u=[];for(var J=0;J<256;J++){H=J;for(var O=0;O<8;O++)H=1&H?3988292384^H>>>1:H>>>1;u[J]=H}return u})());H.exports=(H,J,O,U)=>{const h=u,w=U+O;H^=-1;for(let u=U;u<w;u++)H=H>>>8^h[255&(H^J[u])];return~H}},13449:(H,u,J)=>{"use strict";const{_tr_init:O,_tr_stored_block:U,_tr_flush_block:h,_tr_tally:w,_tr_align:g}=J(13455),B=J(13461),b=J(13470),d=J(13476),{Z_NO_FLUSH:G,Z_PARTIAL_FLUSH:P,Z_FULL_FLUSH:mH,Z_FINISH:l,Z_BLOCK:r,Z_OK:p,Z_STREAM_END:a,Z_STREAM_ERROR:k,Z_DATA_ERROR:C,Z_BUF_ERROR:j,Z_DEFAULT_COMPRESSION:M,Z_FILTERED:L,Z_HUFFMAN_ONLY:Z,Z_RLE:Y,Z_FIXED:F,Z_DEFAULT_STRATEGY:s,Z_UNKNOWN:A,Z_DEFLATED:t}=J(13485),e=258,c=262,n=103,V=113,T=666,R=(H,u)=>(H.bu=d[u],u),X=H=>(H<<1)-(H>4?9:0),W=H=>{let u=H.length;for(;--u>=0;)H[u]=0};let f=(H,u,J)=>(u<<H.hash_shift^J)&H.hash_mask;const i=H=>{const u=H.state;let J=u.pending;J>H.avail_out&&(J=H.avail_out),0!==J&&(H.output.set(u.pending_buf.subarray(u.pending_out,u.pending_out+J),H.next_out),H.next_out+=J,u.pending_out+=J,H.total_out+=J,H.avail_out-=J,u.pending-=J,0===u.pending&&(u.pending_out=0))},S=(H,u)=>{h(H,H.block_start>=0?H.block_start:-1,H.strstart-H.block_start,u),H.block_start=H.strstart,i(H.strm)},v=(H,u)=>{H.pending_buf[H.pending++]=u},I=(H,u)=>{H.pending_buf[H.pending++]=u>>>8&255,H.pending_buf[H.pending++]=255&u},D=(H,u,J,O)=>{let U=H.avail_in;return U>O&&(U=O),0===U?0:(H.avail_in-=U,u.set(H.input.subarray(H.next_in,H.next_in+U),J),1===H.state.wrap?H.adler=B(H.adler,u,U,J):2===H.state.wrap&&(H.adler=b(H.adler,u,U,J)),H.next_in+=U,H.total_in+=U,U)},o=(H,u)=>{let J,O,U=H.max_chain_length,h=H.strstart,w=H.prev_length,g=H.nice_match;const B=H.strstart>H.w_size-c?H.strstart-(H.w_size-c):0,b=H.window,d=H.w_mask,G=H.prev,P=H.strstart+e;let mH=b[h+w-1],l=b[h+w];H.prev_length>=H.good_match&&(U>>=2),g>H.lookahead&&(g=H.lookahead);do{if(J=u,b[J+w]===l&&b[J+w-1]===mH&&b[J]===b[h]&&b[++J]===b[h+1]){h+=2,J++;do{}while(b[++h]===b[++J]&&b[++h]===b[++J]&&b[++h]===b[++J]&&b[++h]===b[++J]&&b[++h]===b[++J]&&b[++h]===b[++J]&&b[++h]===b[++J]&&b[++h]===b[++J]&&h<P);if(O=e-(P-h),h=P-e,O>w){if(H.match_start=u,w=O,O>=g)break;mH=b[h+w-1],l=b[h+w]}}}while((u=G[u&d])>B&&0!==--U);return w<=H.lookahead?w:H.lookahead},y=H=>{const u=H.w_size;let J,O,U,h,w;do{if(h=H.window_size-H.lookahead-H.strstart,H.strstart>=u+(u-c)){H.window.set(H.window.subarray(u,u+u),0),H.match_start-=u,H.strstart-=u,H.block_start-=u,O=H.hash_size,J=O;do{U=H.head[--J],H.head[J]=U>=u?U-u:0}while(--O);O=u,J=O;do{U=H.prev[--J],H.prev[J]=U>=u?U-u:0}while(--O);h+=u}if(0===H.strm.avail_in)break;if(O=D(H.strm,H.window,H.strstart+H.lookahead,h),H.lookahead+=O,H.lookahead+H.insert>=3)for(w=H.strstart-H.insert,H.ins_h=H.window[w],H.ins_h=f(H,H.ins_h,H.window[w+1]);H.insert&&(H.ins_h=f(H,H.ins_h,H.window[w+3-1]),H.prev[w&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=w,w++,H.insert--,!(H.lookahead+H.insert<3)););}while(H.lookahead<c&&0!==H.strm.avail_in)},x=(H,u)=>{let J,O;for(;;){if(H.lookahead<c){if(y(H),H.lookahead<c&&u===G)return 1;if(0===H.lookahead)break}if(J=0,H.lookahead>=3&&(H.ins_h=f(H,H.ins_h,H.window[H.strstart+3-1]),J=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart),0!==J&&H.strstart-J<=H.w_size-c&&(H.match_length=o(H,J)),H.match_length>=3)if(O=w(H,H.strstart-H.match_start,H.match_length-3),H.lookahead-=H.match_length,H.match_length<=H.max_lazy_match&&H.lookahead>=3){H.match_length--;do{H.strstart++,H.ins_h=f(H,H.ins_h,H.window[H.strstart+3-1]),J=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart}while(0!==--H.match_length);H.strstart++}else H.strstart+=H.match_length,H.match_length=0,H.ins_h=H.window[H.strstart],H.ins_h=f(H,H.ins_h,H.window[H.strstart+1]);else O=w(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++;if(O&&(S(H,!1),0===H.strm.avail_out))return 1}return H.insert=H.strstart<2?H.strstart:2,u===l?(S(H,!0),0===H.strm.avail_out?3:4):H.last_lit&&(S(H,!1),0===H.strm.avail_out)?1:2},z=(H,u)=>{let J,O,U;for(;;){if(H.lookahead<c){if(y(H),H.lookahead<c&&u===G)return 1;if(0===H.lookahead)break}if(J=0,H.lookahead>=3&&(H.ins_h=f(H,H.ins_h,H.window[H.strstart+3-1]),J=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart),H.prev_length=H.match_length,H.prev_match=H.match_start,H.match_length=2,0!==J&&H.prev_length<H.max_lazy_match&&H.strstart-J<=H.w_size-c&&(H.match_length=o(H,J),H.match_length<=5&&(H.strategy===L||3===H.match_length&&H.strstart-H.match_start>4096)&&(H.match_length=2)),H.prev_length>=3&&H.match_length<=H.prev_length){U=H.strstart+H.lookahead-3,O=w(H,H.strstart-1-H.prev_match,H.prev_length-3),H.lookahead-=H.prev_length-1,H.prev_length-=2;do{++H.strstart<=U&&(H.ins_h=f(H,H.ins_h,H.window[H.strstart+3-1]),J=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart)}while(0!==--H.prev_length);if(H.match_available=0,H.match_length=2,H.strstart++,O&&(S(H,!1),0===H.strm.avail_out))return 1}else if(H.match_available){if(O=w(H,0,H.window[H.strstart-1]),O&&S(H,!1),H.strstart++,H.lookahead--,0===H.strm.avail_out)return 1}else H.match_available=1,H.strstart++,H.lookahead--}return H.match_available&&(O=w(H,0,H.window[H.strstart-1]),H.match_available=0),H.insert=H.strstart<2?H.strstart:2,u===l?(S(H,!0),0===H.strm.avail_out?3:4):H.last_lit&&(S(H,!1),0===H.strm.avail_out)?1:2};function K(H,u,J,O,U){this.good_length=H,this.max_lazy=u,this.nice_length=J,this.max_chain=O,this.func=U}const N=[new K(0,0,0,0,((H,u)=>{let J=65535;for(J>H.pending_buf_size-5&&(J=H.pending_buf_size-5);;){if(H.lookahead<=1){if(y(H),0===H.lookahead&&u===G)return 1;if(0===H.lookahead)break}H.strstart+=H.lookahead,H.lookahead=0;const O=H.block_start+J;if((0===H.strstart||H.strstart>=O)&&(H.lookahead=H.strstart-O,H.strstart=O,S(H,!1),0===H.strm.avail_out))return 1;if(H.strstart-H.block_start>=H.w_size-c&&(S(H,!1),0===H.strm.avail_out))return 1}return H.insert=0,u===l?(S(H,!0),0===H.strm.avail_out?3:4):(H.strstart>H.block_start&&(S(H,!1),H.strm.avail_out),1)})),new K(4,4,8,4,x),new K(4,5,16,8,x),new K(4,6,32,32,x),new K(4,4,16,16,z),new K(8,16,32,32,z),new K(8,16,128,128,z),new K(8,32,128,256,z),new K(32,128,258,1024,z),new K(32,258,258,4096,z)];function q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=t,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),W(this.dyn_ltree),W(this.dyn_dtree),W(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),W(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),W(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const E=H=>{if(!H||!H.state)return R(H,k);H.total_in=H.total_out=0,H.data_type=A;const u=H.state;return u.pending=0,u.pending_out=0,u.wrap<0&&(u.wrap=-u.wrap),u.status=u.wrap?42:V,H.adler=2===u.wrap?0:1,u.last_flush=G,O(u),p},Q=H=>{const u=E(H);var J;return u===p&&((J=H.state).window_size=2*J.w_size,W(J.head),J.max_lazy_match=N[J.level].max_lazy,J.good_match=N[J.level].good_length,J.nice_match=N[J.level].nice_length,J.max_chain_length=N[J.level].max_chain,J.strstart=0,J.block_start=0,J.lookahead=0,J.insert=0,J.match_length=J.prev_length=2,J.match_available=0,J.ins_h=0),u},HH=(H,u,J,O,U,h)=>{if(!H)return k;let w=1;if(u===M&&(u=6),O<0?(w=0,O=-O):O>15&&(w=2,O-=16),U<1||U>9||J!==t||O<8||O>15||u<0||u>9||h<0||h>F)return R(H,k);8===O&&(O=9);const g=new q;return H.state=g,g.strm=H,g.wrap=w,g.gzhead=null,g.w_bits=O,g.w_size=1<<g.w_bits,g.w_mask=g.w_size-1,g.hash_bits=U+7,g.hash_size=1<<g.hash_bits,g.hash_mask=g.hash_size-1,g.hash_shift=~~((g.hash_bits+3-1)/3),g.window=new Uint8Array(2*g.w_size),g.head=new Uint16Array(g.hash_size),g.prev=new Uint16Array(g.w_size),g.lit_bufsize=1<<U+6,g.pending_buf_size=4*g.lit_bufsize,g.pending_buf=new Uint8Array(g.pending_buf_size),g.d_buf=1*g.lit_bufsize,g.l_buf=3*g.lit_bufsize,g.level=u,g.strategy=h,g.method=J,Q(H)};H.exports.deflateInit=(H,u)=>HH(H,u,t,15,8,s),H.exports.deflateInit2=HH,H.exports.deflateReset=Q,H.exports.deflateResetKeep=E,H.exports.deflateSetHeader=(H,u)=>H&&H.state?2!==H.state.wrap?k:(H.state.gzhead=u,p):k,H.exports.deflate=(H,u)=>{let J,O;if(!H||!H.state||u>r||u<0)return H?R(H,k):k;const h=H.state;if(!H.output||!H.input&&0!==H.avail_in||h.status===T&&u!==l)return R(H,0===H.avail_out?j:k);h.strm=H;const B=h.last_flush;if(h.last_flush=u,42===h.status)if(2===h.wrap)H.adler=0,v(h,31),v(h,139),v(h,8),h.gzhead?(v(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),v(h,255&h.gzhead.time),v(h,h.gzhead.time>>8&255),v(h,h.gzhead.time>>16&255),v(h,h.gzhead.time>>24&255),v(h,9===h.level?2:h.strategy>=Z||h.level<2?4:0),v(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(v(h,255&h.gzhead.extra.length),v(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(H.adler=b(H.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=69):(v(h,0),v(h,0),v(h,0),v(h,0),v(h,0),v(h,9===h.level?2:h.strategy>=Z||h.level<2?4:0),v(h,3),h.status=V);else{let u=t+(h.w_bits-8<<4)<<8,J=-1;J=h.strategy>=Z||h.level<2?0:h.level<6?1:6===h.level?2:3,u|=J<<6,0!==h.strstart&&(u|=32),u+=31-u%31,h.status=V,I(h,u),0!==h.strstart&&(I(h,H.adler>>>16),I(h,65535&H.adler)),H.adler=1}if(69===h.status)if(h.gzhead.extra){for(J=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>J&&(H.adler=b(H.adler,h.pending_buf,h.pending-J,J)),i(H),J=h.pending,h.pending!==h.pending_buf_size));)v(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>J&&(H.adler=b(H.adler,h.pending_buf,h.pending-J,J)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=73)}else h.status=73;if(73===h.status)if(h.gzhead.name){J=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>J&&(H.adler=b(H.adler,h.pending_buf,h.pending-J,J)),i(H),J=h.pending,h.pending===h.pending_buf_size)){O=1;break}O=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,v(h,O)}while(0!==O);h.gzhead.hcrc&&h.pending>J&&(H.adler=b(H.adler,h.pending_buf,h.pending-J,J)),0===O&&(h.gzindex=0,h.status=91)}else h.status=91;if(91===h.status)if(h.gzhead.comment){J=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>J&&(H.adler=b(H.adler,h.pending_buf,h.pending-J,J)),i(H),J=h.pending,h.pending===h.pending_buf_size)){O=1;break}O=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,v(h,O)}while(0!==O);h.gzhead.hcrc&&h.pending>J&&(H.adler=b(H.adler,h.pending_buf,h.pending-J,J)),0===O&&(h.status=n)}else h.status=n;if(h.status===n&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&i(H),h.pending+2<=h.pending_buf_size&&(v(h,255&H.adler),v(h,H.adler>>8&255),H.adler=0,h.status=V)):h.status=V),0!==h.pending){if(i(H),0===H.avail_out)return h.last_flush=-1,p}else if(0===H.avail_in&&X(u)<=X(B)&&u!==l)return R(H,j);if(h.status===T&&0!==H.avail_in)return R(H,j);if(0!==H.avail_in||0!==h.lookahead||u!==G&&h.status!==T){let J=h.strategy===Z?((H,u)=>{let J;for(;;){if(0===H.lookahead&&(y(H),0===H.lookahead)){if(u===G)return 1;break}if(H.match_length=0,J=w(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++,J&&(S(H,!1),0===H.strm.avail_out))return 1}return H.insert=0,u===l?(S(H,!0),0===H.strm.avail_out?3:4):H.last_lit&&(S(H,!1),0===H.strm.avail_out)?1:2})(h,u):h.strategy===Y?((H,u)=>{let J,O,U,h;const g=H.window;for(;;){if(H.lookahead<=e){if(y(H),H.lookahead<=e&&u===G)return 1;if(0===H.lookahead)break}if(H.match_length=0,H.lookahead>=3&&H.strstart>0&&(U=H.strstart-1,O=g[U],O===g[++U]&&O===g[++U]&&O===g[++U])){h=H.strstart+e;do{}while(O===g[++U]&&O===g[++U]&&O===g[++U]&&O===g[++U]&&O===g[++U]&&O===g[++U]&&O===g[++U]&&O===g[++U]&&U<h);H.match_length=e-(h-U),H.match_length>H.lookahead&&(H.match_length=H.lookahead)}if(H.match_length>=3?(J=w(H,1,H.match_length-3),H.lookahead-=H.match_length,H.strstart+=H.match_length,H.match_length=0):(J=w(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++),J&&(S(H,!1),0===H.strm.avail_out))return 1}return H.insert=0,u===l?(S(H,!0),0===H.strm.avail_out?3:4):H.last_lit&&(S(H,!1),0===H.strm.avail_out)?1:2})(h,u):N[h.level].func(h,u);if(3!==J&&4!==J||(h.status=T),1===J||3===J)return 0===H.avail_out&&(h.last_flush=-1),p;if(2===J&&(u===P?g(h):u!==r&&(U(h,0,0,!1),u===mH&&(W(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),i(H),0===H.avail_out))return h.last_flush=-1,p}return u!==l?p:h.wrap<=0?a:(2===h.wrap?(v(h,255&H.adler),v(h,H.adler>>8&255),v(h,H.adler>>16&255),v(h,H.adler>>24&255),v(h,255&H.total_in),v(h,H.total_in>>8&255),v(h,H.total_in>>16&255),v(h,H.total_in>>24&255)):(I(h,H.adler>>>16),I(h,65535&H.adler)),i(H),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?p:a)},H.exports.deflateEnd=H=>{if(!H||!H.state)return k;const u=H.state.status;return 42!==u&&69!==u&&73!==u&&91!==u&&u!==n&&u!==V&&u!==T?R(H,k):(H.state=null,u===V?R(H,C):p)},H.exports.deflateSetDictionary=(H,u)=>{let J=u.length;if(!H||!H.state)return k;const O=H.state,U=O.wrap;if(2===U||1===U&&42!==O.status||O.lookahead)return k;if(1===U&&(H.adler=B(H.adler,u,J,0)),O.wrap=0,J>=O.w_size){0===U&&(W(O.head),O.strstart=0,O.block_start=0,O.insert=0);let H=new Uint8Array(O.w_size);H.set(u.subarray(J-O.w_size,J),0),u=H,J=O.w_size}const h=H.avail_in,w=H.next_in,g=H.input;for(H.avail_in=J,H.next_in=0,H.input=u,y(O);O.lookahead>=3;){let H=O.strstart,u=O.lookahead-2;do{O.ins_h=f(O,O.ins_h,O.window[H+3-1]),O.prev[H&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=H,H++}while(--u);O.strstart=H,O.lookahead=2,y(O)}return O.strstart+=O.lookahead,O.block_start=O.strstart,O.insert=O.lookahead,O.lookahead=0,O.match_length=O.prev_length=2,O.match_available=0,H.next_in=w,H.input=g,H.avail_in=h,O.wrap=U,p},H.exports.deflateInfo="pako deflate (from Nodeca project)"},13529:H=>{"use strict";H.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13520:H=>{"use strict";H.exports=function(H,u){let J,O,U,h,w,g,B,b,d,G,P,mH,l,r,p,a,k,C,j,M,L,Z,Y,F;const s=H.state;J=H.next_in,Y=H.input,O=J+(H.avail_in-5),U=H.next_out,F=H.output,h=U-(u-H.avail_out),w=U+(H.avail_out-257),g=s.dmax,B=s.wsize,b=s.whave,d=s.wnext,G=s.window,P=s.hold,mH=s.bits,l=s.lencode,r=s.distcode,p=(1<<s.lenbits)-1,a=(1<<s.distbits)-1;H:do{mH<15&&(P+=Y[J++]<<mH,mH+=8,P+=Y[J++]<<mH,mH+=8),k=l[P&p];u:for(;;){if(C=k>>>24,P>>>=C,mH-=C,C=k>>>16&255,0===C)F[U++]=65535&k;else{if(!(16&C)){if(0===(64&C)){k=l[(65535&k)+(P&(1<<C)-1)];continue u}if(32&C){s.mode=12;break H}H.bu="invalid literal/length code",s.mode=30;break H}j=65535&k,C&=15,C&&(mH<C&&(P+=Y[J++]<<mH,mH+=8),j+=P&(1<<C)-1,P>>>=C,mH-=C),mH<15&&(P+=Y[J++]<<mH,mH+=8,P+=Y[J++]<<mH,mH+=8),k=r[P&a];J:for(;;){if(C=k>>>24,P>>>=C,mH-=C,C=k>>>16&255,!(16&C)){if(0===(64&C)){k=r[(65535&k)+(P&(1<<C)-1)];continue J}H.bu="invalid distance code",s.mode=30;break H}if(M=65535&k,C&=15,mH<C&&(P+=Y[J++]<<mH,mH+=8,mH<C&&(P+=Y[J++]<<mH,mH+=8)),M+=P&(1<<C)-1,M>g){H.bu="invalid distance too far back",s.mode=30;break H}if(P>>>=C,mH-=C,C=U-h,M>C){if(C=M-C,C>b&&s.sane){H.bu="invalid distance too far back",s.mode=30;break H}if(L=0,Z=G,0===d){if(L+=B-C,C<j){j-=C;do{F[U++]=G[L++]}while(--C);L=U-M,Z=F}}else if(d<C){if(L+=B+d-C,C-=d,C<j){j-=C;do{F[U++]=G[L++]}while(--C);if(L=0,d<j){C=d,j-=C;do{F[U++]=G[L++]}while(--C);L=U-M,Z=F}}}else if(L+=d-C,C<j){j-=C;do{F[U++]=G[L++]}while(--C);L=U-M,Z=F}for(;j>2;)F[U++]=Z[L++],F[U++]=Z[L++],F[U++]=Z[L++],j-=3;j&&(F[U++]=Z[L++],j>1&&(F[U++]=Z[L++]))}else{L=U-M;do{F[U++]=F[L++],F[U++]=F[L++],F[U++]=F[L++],j-=3}while(j>2);j&&(F[U++]=F[L++],j>1&&(F[U++]=F[L++]))}break}}break}}while(J<O&&U<w);j=mH>>3,J-=j,mH-=j<<3,P&=(1<<mH)-1,H.next_in=J,H.next_out=U,H.avail_in=J<O?O-J+5:5-(J-O),H.avail_out=U<w?w-U+257:257-(U-w),s.hold=P,s.bits=mH}},13512:(H,u,J)=>{"use strict";const O=J(13461),U=J(13470),h=J(13520),w=J(13527),{Z_FINISH:g,Z_BLOCK:B,Z_TREES:b,Z_OK:d,Z_STREAM_END:G,Z_NEED_DICT:P,Z_STREAM_ERROR:mH,Z_DATA_ERROR:l,Z_MEM_ERROR:r,Z_BUF_ERROR:p,Z_DEFLATED:a}=J(13485),k=12,C=30,j=H=>(H>>>24&255)+(H>>>8&65280)+((65280&H)<<8)+((255&H)<<24);function M(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const L=H=>{if(!H||!H.state)return mH;const u=H.state;return H.total_in=H.total_out=u.total=0,H.bu="",u.wrap&&(H.adler=1&u.wrap),u.mode=1,u.last=0,u.havedict=0,u.dmax=32768,u.head=null,u.hold=0,u.bits=0,u.lencode=u.lendyn=new Int32Array(852),u.distcode=u.distdyn=new Int32Array(592),u.sane=1,u.back=-1,d},Z=H=>{if(!H||!H.state)return mH;const u=H.state;return u.wsize=0,u.whave=0,u.wnext=0,L(H)},Y=(H,u)=>{let J;if(!H||!H.state)return mH;const O=H.state;return u<0?(J=0,u=-u):(J=1+(u>>4),u<48&&(u&=15)),u&&(u<8||u>15)?mH:(null!==O.window&&O.wbits!==u&&(O.window=null),O.wrap=J,O.wbits=u,Z(H))},F=(H,u)=>{if(!H)return mH;const J=new M;H.state=J,J.window=null;const O=Y(H,u);return O!==d&&(H.state=null),O};let s,A,t=!0;const e=H=>{if(t){s=new Int32Array(512),A=new Int32Array(32);let u=0;for(;u<144;)H.lens[u++]=8;for(;u<256;)H.lens[u++]=9;for(;u<280;)H.lens[u++]=7;for(;u<288;)H.lens[u++]=8;for(w(1,H.lens,0,288,s,0,H.work,{bits:9}),u=0;u<32;)H.lens[u++]=5;w(2,H.lens,0,32,A,0,H.work,{bits:5}),t=!1}H.lencode=s,H.lenbits=9,H.distcode=A,H.distbits=5},c=(H,u,J,O)=>{let U;const h=H.state;return null===h.window&&(h.wsize=1<<h.wbits,h.wnext=0,h.whave=0,h.window=new Uint8Array(h.wsize)),O>=h.wsize?(h.window.set(u.subarray(J-h.wsize,J),0),h.wnext=0,h.whave=h.wsize):(U=h.wsize-h.wnext,U>O&&(U=O),h.window.set(u.subarray(J-O,J-O+U),h.wnext),(O-=U)?(h.window.set(u.subarray(J-O,J),0),h.wnext=O,h.whave=h.wsize):(h.wnext+=U,h.wnext===h.wsize&&(h.wnext=0),h.whave<h.wsize&&(h.whave+=U))),0};H.exports.inflateReset=Z,H.exports.inflateReset2=Y,H.exports.inflateResetKeep=L,H.exports.inflateInit=H=>F(H,15),H.exports.inflateInit2=F,H.exports.inflate=(H,u)=>{let J,M,L,Z,Y,F,s,A,t,n,V,T,R,X,W,f,i,S,v,I,D,o,y=0;const x=new Uint8Array(4);let z,K;const N=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!H||!H.state||!H.output||!H.input&&0!==H.avail_in)return mH;J=H.state,J.mode===k&&(J.mode=13),Y=H.next_out,L=H.output,s=H.avail_out,Z=H.next_in,M=H.input,F=H.avail_in,A=J.hold,t=J.bits,n=F,V=s,o=d;H:for(;;)switch(J.mode){case 1:if(0===J.wrap){J.mode=13;break}for(;t<16;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}if(2&J.wrap&&35615===A){J.check=0,x[0]=255&A,x[1]=A>>>8&255,J.check=U(J.check,x,2,0),A=0,t=0,J.mode=2;break}if(J.flags=0,J.head&&(J.head.done=!1),!(1&J.wrap)||(((255&A)<<8)+(A>>8))%31){H.bu="incorrect header check",J.mode=C;break}if((15&A)!==a){H.bu="unknown compression method",J.mode=C;break}if(A>>>=4,t-=4,D=8+(15&A),0===J.wbits)J.wbits=D;else if(D>J.wbits){H.bu="invalid window size",J.mode=C;break}J.dmax=1<<J.wbits,H.adler=J.check=1,J.mode=512&A?10:k,A=0,t=0;break;case 2:for(;t<16;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}if(J.flags=A,(255&J.flags)!==a){H.bu="unknown compression method",J.mode=C;break}if(57344&J.flags){H.bu="unknown header flags set",J.mode=C;break}J.head&&(J.head.text=A>>8&1),512&J.flags&&(x[0]=255&A,x[1]=A>>>8&255,J.check=U(J.check,x,2,0)),A=0,t=0,J.mode=3;case 3:for(;t<32;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}J.head&&(J.head.time=A),512&J.flags&&(x[0]=255&A,x[1]=A>>>8&255,x[2]=A>>>16&255,x[3]=A>>>24&255,J.check=U(J.check,x,4,0)),A=0,t=0,J.mode=4;case 4:for(;t<16;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}J.head&&(J.head.xflags=255&A,J.head.os=A>>8),512&J.flags&&(x[0]=255&A,x[1]=A>>>8&255,J.check=U(J.check,x,2,0)),A=0,t=0,J.mode=5;case 5:if(1024&J.flags){for(;t<16;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}J.length=A,J.head&&(J.head.extra_len=A),512&J.flags&&(x[0]=255&A,x[1]=A>>>8&255,J.check=U(J.check,x,2,0)),A=0,t=0}else J.head&&(J.head.extra=null);J.mode=6;case 6:if(1024&J.flags&&(T=J.length,T>F&&(T=F),T&&(J.head&&(D=J.head.extra_len-J.length,J.head.extra||(J.head.extra=new Uint8Array(J.head.extra_len)),J.head.extra.set(M.subarray(Z,Z+T),D)),512&J.flags&&(J.check=U(J.check,M,T,Z)),F-=T,Z+=T,J.length-=T),J.length))break H;J.length=0,J.mode=7;case 7:if(2048&J.flags){if(0===F)break H;T=0;do{D=M[Z+T++],J.head&&D&&J.length<65536&&(J.head.name+=String.fromCharCode(D))}while(D&&T<F);if(512&J.flags&&(J.check=U(J.check,M,T,Z)),F-=T,Z+=T,D)break H}else J.head&&(J.head.name=null);J.length=0,J.mode=8;case 8:if(4096&J.flags){if(0===F)break H;T=0;do{D=M[Z+T++],J.head&&D&&J.length<65536&&(J.head.comment+=String.fromCharCode(D))}while(D&&T<F);if(512&J.flags&&(J.check=U(J.check,M,T,Z)),F-=T,Z+=T,D)break H}else J.head&&(J.head.comment=null);J.mode=9;case 9:if(512&J.flags){for(;t<16;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}if(A!==(65535&J.check)){H.bu="header crc mismatch",J.mode=C;break}A=0,t=0}J.head&&(J.head.hcrc=J.flags>>9&1,J.head.done=!0),H.adler=J.check=0,J.mode=k;break;case 10:for(;t<32;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}H.adler=J.check=j(A),A=0,t=0,J.mode=11;case 11:if(0===J.havedict)return H.next_out=Y,H.avail_out=s,H.next_in=Z,H.avail_in=F,J.hold=A,J.bits=t,P;H.adler=J.check=1,J.mode=k;case k:if(u===B||u===b)break H;case 13:if(J.last){A>>>=7&t,t-=7&t,J.mode=27;break}for(;t<3;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}switch(J.last=1&A,A>>>=1,t-=1,3&A){case 0:J.mode=14;break;case 1:if(e(J),J.mode=20,u===b){A>>>=2,t-=2;break H}break;case 2:J.mode=17;break;case 3:H.bu="invalid block type",J.mode=C}A>>>=2,t-=2;break;case 14:for(A>>>=7&t,t-=7&t;t<32;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}if((65535&A)!==(A>>>16^65535)){H.bu="invalid stored block lengths",J.mode=C;break}if(J.length=65535&A,A=0,t=0,J.mode=15,u===b)break H;case 15:J.mode=16;case 16:if(T=J.length,T){if(T>F&&(T=F),T>s&&(T=s),0===T)break H;L.set(M.subarray(Z,Z+T),Y),F-=T,Z+=T,s-=T,Y+=T,J.length-=T;break}J.mode=k;break;case 17:for(;t<14;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}if(J.nlen=257+(31&A),A>>>=5,t-=5,J.ndist=1+(31&A),A>>>=5,t-=5,J.ncode=4+(15&A),A>>>=4,t-=4,J.nlen>286||J.ndist>30){H.bu="too many length or distance symbols",J.mode=C;break}J.have=0,J.mode=18;case 18:for(;J.have<J.ncode;){for(;t<3;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}J.lens[N[J.have++]]=7&A,A>>>=3,t-=3}for(;J.have<19;)J.lens[N[J.have++]]=0;if(J.lencode=J.lendyn,J.lenbits=7,z={bits:J.lenbits},o=w(0,J.lens,0,19,J.lencode,0,J.work,z),J.lenbits=z.bits,o){H.bu="invalid code lengths set",J.mode=C;break}J.have=0,J.mode=19;case 19:for(;J.have<J.nlen+J.ndist;){for(;y=J.lencode[A&(1<<J.lenbits)-1],W=y>>>24,f=y>>>16&255,i=65535&y,!(W<=t);){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}if(i<16)A>>>=W,t-=W,J.lens[J.have++]=i;else{if(16===i){for(K=W+2;t<K;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}if(A>>>=W,t-=W,0===J.have){H.bu="invalid bit length repeat",J.mode=C;break}D=J.lens[J.have-1],T=3+(3&A),A>>>=2,t-=2}else if(17===i){for(K=W+3;t<K;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}A>>>=W,t-=W,D=0,T=3+(7&A),A>>>=3,t-=3}else{for(K=W+7;t<K;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}A>>>=W,t-=W,D=0,T=11+(127&A),A>>>=7,t-=7}if(J.have+T>J.nlen+J.ndist){H.bu="invalid bit length repeat",J.mode=C;break}for(;T--;)J.lens[J.have++]=D}}if(J.mode===C)break;if(0===J.lens[256]){H.bu="invalid code -- missing end-of-block",J.mode=C;break}if(J.lenbits=9,z={bits:J.lenbits},o=w(1,J.lens,0,J.nlen,J.lencode,0,J.work,z),J.lenbits=z.bits,o){H.bu="invalid literal/lengths set",J.mode=C;break}if(J.distbits=6,J.distcode=J.distdyn,z={bits:J.distbits},o=w(2,J.lens,J.nlen,J.ndist,J.distcode,0,J.work,z),J.distbits=z.bits,o){H.bu="invalid distances set",J.mode=C;break}if(J.mode=20,u===b)break H;case 20:J.mode=21;case 21:if(F>=6&&s>=258){H.next_out=Y,H.avail_out=s,H.next_in=Z,H.avail_in=F,J.hold=A,J.bits=t,h(H,V),Y=H.next_out,L=H.output,s=H.avail_out,Z=H.next_in,M=H.input,F=H.avail_in,A=J.hold,t=J.bits,J.mode===k&&(J.back=-1);break}for(J.back=0;y=J.lencode[A&(1<<J.lenbits)-1],W=y>>>24,f=y>>>16&255,i=65535&y,!(W<=t);){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}if(f&&0===(240&f)){for(S=W,v=f,I=i;y=J.lencode[I+((A&(1<<S+v)-1)>>S)],W=y>>>24,f=y>>>16&255,i=65535&y,!(S+W<=t);){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}A>>>=S,t-=S,J.back+=S}if(A>>>=W,t-=W,J.back+=W,J.length=i,0===f){J.mode=26;break}if(32&f){J.back=-1,J.mode=k;break}if(64&f){H.bu="invalid literal/length code",J.mode=C;break}J.extra=15&f,J.mode=22;case 22:if(J.extra){for(K=J.extra;t<K;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}J.length+=A&(1<<J.extra)-1,A>>>=J.extra,t-=J.extra,J.back+=J.extra}J.was=J.length,J.mode=23;case 23:for(;y=J.distcode[A&(1<<J.distbits)-1],W=y>>>24,f=y>>>16&255,i=65535&y,!(W<=t);){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}if(0===(240&f)){for(S=W,v=f,I=i;y=J.distcode[I+((A&(1<<S+v)-1)>>S)],W=y>>>24,f=y>>>16&255,i=65535&y,!(S+W<=t);){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}A>>>=S,t-=S,J.back+=S}if(A>>>=W,t-=W,J.back+=W,64&f){H.bu="invalid distance code",J.mode=C;break}J.offset=i,J.extra=15&f,J.mode=24;case 24:if(J.extra){for(K=J.extra;t<K;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}J.offset+=A&(1<<J.extra)-1,A>>>=J.extra,t-=J.extra,J.back+=J.extra}if(J.offset>J.dmax){H.bu="invalid distance too far back",J.mode=C;break}J.mode=25;case 25:if(0===s)break H;if(T=V-s,J.offset>T){if(T=J.offset-T,T>J.whave&&J.sane){H.bu="invalid distance too far back",J.mode=C;break}T>J.wnext?(T-=J.wnext,R=J.wsize-T):R=J.wnext-T,T>J.length&&(T=J.length),X=J.window}else X=L,R=Y-J.offset,T=J.length;T>s&&(T=s),s-=T,J.length-=T;do{L[Y++]=X[R++]}while(--T);0===J.length&&(J.mode=21);break;case 26:if(0===s)break H;L[Y++]=J.length,s--,J.mode=21;break;case 27:if(J.wrap){for(;t<32;){if(0===F)break H;F--,A|=M[Z++]<<t,t+=8}if(V-=s,H.total_out+=V,J.total+=V,V&&(H.adler=J.check=J.flags?U(J.check,L,V,Y-V):O(J.check,L,V,Y-V)),V=s,(J.flags?A:j(A))!==J.check){H.bu="incorrect data check",J.mode=C;break}A=0,t=0}J.mode=28;case 28:if(J.wrap&&J.flags){for(;t<32;){if(0===F)break H;F--,A+=M[Z++]<<t,t+=8}if(A!==(4294967295&J.total)){H.bu="incorrect length check",J.mode=C;break}A=0,t=0}J.mode=29;case 29:o=G;break H;case C:o=l;break H;case 31:return r;default:return mH}return H.next_out=Y,H.avail_out=s,H.next_in=Z,H.avail_in=F,J.hold=A,J.bits=t,(J.wsize||V!==H.avail_out&&J.mode<C&&(J.mode<27||u!==g))&&c(H,H.output,H.next_out,V-H.avail_out)?(J.mode=31,r):(n-=H.avail_in,V-=H.avail_out,H.total_in+=n,H.total_out+=V,J.total+=V,J.wrap&&V&&(H.adler=J.check=J.flags?U(J.check,L,V,H.next_out-V):O(J.check,L,V,H.next_out-V)),H.data_type=J.bits+(J.last?64:0)+(J.mode===k?128:0)+(20===J.mode||15===J.mode?256:0),(0===n&&0===V||u===g)&&o===d&&(o=p),o)},H.exports.inflateEnd=H=>{if(!H||!H.state)return mH;let u=H.state;return u.window&&(u.window=null),H.state=null,d},H.exports.inflateGetHeader=(H,u)=>{if(!H||!H.state)return mH;const J=H.state;return 0===(2&J.wrap)?mH:(J.head=u,u.done=!1,d)},H.exports.inflateSetDictionary=(H,u)=>{const J=u.length;let U,h,w;return H&&H.state?(U=H.state,0!==U.wrap&&11!==U.mode?mH:11===U.mode&&(h=1,h=O(h,u,J,0),h!==U.check)?l:(w=c(H,u,J,J),w?(U.mode=31,r):(U.havedict=1,d))):mH},H.exports.inflateInfo="pako inflate (from Nodeca project)"},13527:H=>{"use strict";const u=15,J=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),O=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),U=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),h=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);H.exports=(H,w,g,B,b,d,G,P)=>{const mH=P.bits;let l,r,p,a,k,C,j=0,M=0,L=0,Z=0,Y=0,F=0,s=0,A=0,t=0,e=0,c=null,n=0;const V=new Uint16Array(16),T=new Uint16Array(16);let R,X,W,f=null,i=0;for(j=0;j<=u;j++)V[j]=0;for(M=0;M<B;M++)V[w[g+M]]++;for(Y=mH,Z=u;Z>=1&&0===V[Z];Z--);if(Y>Z&&(Y=Z),0===Z)return b[d++]=20971520,b[d++]=20971520,P.bits=1,0;for(L=1;L<Z&&0===V[L];L++);for(Y<L&&(Y=L),A=1,j=1;j<=u;j++)if(A<<=1,A-=V[j],A<0)return-1;if(A>0&&(0===H||1!==Z))return-1;for(T[1]=0,j=1;j<u;j++)T[j+1]=T[j]+V[j];for(M=0;M<B;M++)0!==w[g+M]&&(G[T[w[g+M]]++]=M);if(0===H?(c=f=G,C=19):1===H?(c=J,n-=257,f=O,i-=257,C=256):(c=U,f=h,C=-1),e=0,M=0,j=L,k=d,F=Y,s=0,p=-1,t=1<<Y,a=t-1,1===H&&t>852||2===H&&t>592)return 1;for(;;){R=j-s,G[M]<C?(X=0,W=G[M]):G[M]>C?(X=f[i+G[M]],W=c[n+G[M]]):(X=96,W=0),l=1<<j-s,r=1<<F,L=r;do{r-=l,b[k+(e>>s)+r]=R<<24|X<<16|W}while(0!==r);for(l=1<<j-1;e&l;)l>>=1;if(0!==l?(e&=l-1,e+=l):e=0,M++,0===--V[j]){if(j===Z)break;j=w[g+G[M]]}if(j>Y&&(e&a)!==p){for(0===s&&(s=Y),k+=L,F=j-s,A=1<<F;F+s<Z&&(A-=V[F+s],!(A<=0));)F++,A<<=1;if(t+=1<<F,1===H&&t>852||2===H&&t>592)return 1;p=e&a,b[p]=Y<<24|F<<16|k-d}}return 0!==e&&(b[k+e]=j-s<<24|64<<16),P.bits=Y,0}},13476:H=>{"use strict";H.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13455:H=>{"use strict";function u(H){let u=H.length;for(;--u>=0;)H[u]=0}const J=256,O=286,U=30,h=15,w=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),g=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),B=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),b=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=new Array(576);u(d);const G=new Array(60);u(G);const P=new Array(512);u(P);const mH=new Array(256);u(mH);const l=new Array(29);u(l);const r=new Array(U);function p(H,u,J,O,U){this.static_tree=H,this.extra_bits=u,this.extra_base=J,this.elems=O,this.max_length=U,this.has_stree=H&&H.length}let a,k,C;function j(H,u){this.dyn_tree=H,this.max_code=0,this.stat_desc=u}u(r);const M=H=>H<256?P[H]:P[256+(H>>>7)],L=(H,u)=>{H.pending_buf[H.pending++]=255&u,H.pending_buf[H.pending++]=u>>>8&255},Z=(H,u,J)=>{H.bi_valid>16-J?(H.bi_buf|=u<<H.bi_valid&65535,L(H,H.bi_buf),H.bi_buf=u>>16-H.bi_valid,H.bi_valid+=J-16):(H.bi_buf|=u<<H.bi_valid&65535,H.bi_valid+=J)},Y=(H,u,J)=>{Z(H,J[2*u],J[2*u+1])},F=(H,u)=>{let J=0;do{J|=1&H,H>>>=1,J<<=1}while(--u>0);return J>>>1},s=(H,u,J)=>{const O=new Array(16);let U,w,g=0;for(U=1;U<=h;U++)O[U]=g=g+J[U-1]<<1;for(w=0;w<=u;w++){let u=H[2*w+1];0!==u&&(H[2*w]=F(O[u]++,u))}},A=H=>{let u;for(u=0;u<O;u++)H.dyn_ltree[2*u]=0;for(u=0;u<U;u++)H.dyn_dtree[2*u]=0;for(u=0;u<19;u++)H.bl_tree[2*u]=0;H.dyn_ltree[512]=1,H.opt_len=H.static_len=0,H.last_lit=H.matches=0},t=H=>{H.bi_valid>8?L(H,H.bi_buf):H.bi_valid>0&&(H.pending_buf[H.pending++]=H.bi_buf),H.bi_buf=0,H.bi_valid=0},e=(H,u,J,O)=>{const U=2*u,h=2*J;return H[U]<H[h]||H[U]===H[h]&&O[u]<=O[J]},c=(H,u,J)=>{const O=H.heap[J];let U=J<<1;for(;U<=H.heap_len&&(U<H.heap_len&&e(u,H.heap[U+1],H.heap[U],H.depth)&&U++,!e(u,O,H.heap[U],H.depth));)H.heap[J]=H.heap[U],J=U,U<<=1;H.heap[J]=O},n=(H,u,O)=>{let U,h,B,b,d=0;if(0!==H.last_lit)do{U=H.pending_buf[H.d_buf+2*d]<<8|H.pending_buf[H.d_buf+2*d+1],h=H.pending_buf[H.l_buf+d],d++,0===U?Y(H,h,u):(B=mH[h],Y(H,B+J+1,u),b=w[B],0!==b&&(h-=l[B],Z(H,h,b)),U--,B=M(U),Y(H,B,O),b=g[B],0!==b&&(U-=r[B],Z(H,U,b)))}while(d<H.last_lit);Y(H,256,u)},V=(H,u)=>{const J=u.dyn_tree,O=u.stat_desc.static_tree,U=u.stat_desc.has_stree,w=u.stat_desc.elems;let g,B,b,d=-1;for(H.heap_len=0,H.heap_max=573,g=0;g<w;g++)0!==J[2*g]?(H.heap[++H.heap_len]=d=g,H.depth[g]=0):J[2*g+1]=0;for(;H.heap_len<2;)b=H.heap[++H.heap_len]=d<2?++d:0,J[2*b]=1,H.depth[b]=0,H.opt_len--,U&&(H.static_len-=O[2*b+1]);for(u.max_code=d,g=H.heap_len>>1;g>=1;g--)c(H,J,g);b=w;do{g=H.heap[1],H.heap[1]=H.heap[H.heap_len--],c(H,J,1),B=H.heap[1],H.heap[--H.heap_max]=g,H.heap[--H.heap_max]=B,J[2*b]=J[2*g]+J[2*B],H.depth[b]=(H.depth[g]>=H.depth[B]?H.depth[g]:H.depth[B])+1,J[2*g+1]=J[2*B+1]=b,H.heap[1]=b++,c(H,J,1)}while(H.heap_len>=2);H.heap[--H.heap_max]=H.heap[1],((H,u)=>{const J=u.dyn_tree,O=u.max_code,U=u.stat_desc.static_tree,w=u.stat_desc.has_stree,g=u.stat_desc.extra_bits,B=u.stat_desc.extra_base,b=u.stat_desc.max_length;let d,G,P,mH,l,r,p=0;for(mH=0;mH<=h;mH++)H.bl_count[mH]=0;for(J[2*H.heap[H.heap_max]+1]=0,d=H.heap_max+1;d<573;d++)G=H.heap[d],mH=J[2*J[2*G+1]+1]+1,mH>b&&(mH=b,p++),J[2*G+1]=mH,G>O||(H.bl_count[mH]++,l=0,G>=B&&(l=g[G-B]),r=J[2*G],H.opt_len+=r*(mH+l),w&&(H.static_len+=r*(U[2*G+1]+l)));if(0!==p){do{for(mH=b-1;0===H.bl_count[mH];)mH--;H.bl_count[mH]--,H.bl_count[mH+1]+=2,H.bl_count[b]--,p-=2}while(p>0);for(mH=b;0!==mH;mH--)for(G=H.bl_count[mH];0!==G;)P=H.heap[--d],P>O||(J[2*P+1]!==mH&&(H.opt_len+=(mH-J[2*P+1])*J[2*P],J[2*P+1]=mH),G--)}})(H,u),s(J,d,H.bl_count)},T=(H,u,J)=>{let O,U,h=-1,w=u[1],g=0,B=7,b=4;for(0===w&&(B=138,b=3),u[2*(J+1)+1]=65535,O=0;O<=J;O++)U=w,w=u[2*(O+1)+1],++g<B&&U===w||(g<b?H.bl_tree[2*U]+=g:0!==U?(U!==h&&H.bl_tree[2*U]++,H.bl_tree[32]++):g<=10?H.bl_tree[34]++:H.bl_tree[36]++,g=0,h=U,0===w?(B=138,b=3):U===w?(B=6,b=3):(B=7,b=4))},R=(H,u,J)=>{let O,U,h=-1,w=u[1],g=0,B=7,b=4;for(0===w&&(B=138,b=3),O=0;O<=J;O++)if(U=w,w=u[2*(O+1)+1],!(++g<B&&U===w)){if(g<b)do{Y(H,U,H.bl_tree)}while(0!==--g);else 0!==U?(U!==h&&(Y(H,U,H.bl_tree),g--),Y(H,16,H.bl_tree),Z(H,g-3,2)):g<=10?(Y(H,17,H.bl_tree),Z(H,g-3,3)):(Y(H,18,H.bl_tree),Z(H,g-11,7));g=0,h=U,0===w?(B=138,b=3):U===w?(B=6,b=3):(B=7,b=4)}};let X=!1;const W=(H,u,J,O)=>{Z(H,0+(O?1:0),3),((H,u,J,O)=>{t(H),O&&(L(H,J),L(H,~J)),H.pending_buf.set(H.window.subarray(u,u+J),H.pending),H.pending+=J})(H,u,J,!0)};H.exports._tr_init=H=>{X||((()=>{let H,u,J,b,j;const M=new Array(16);for(J=0,b=0;b<28;b++)for(l[b]=J,H=0;H<1<<w[b];H++)mH[J++]=b;for(mH[J-1]=b,j=0,b=0;b<16;b++)for(r[b]=j,H=0;H<1<<g[b];H++)P[j++]=b;for(j>>=7;b<U;b++)for(r[b]=j<<7,H=0;H<1<<g[b]-7;H++)P[256+j++]=b;for(u=0;u<=h;u++)M[u]=0;for(H=0;H<=143;)d[2*H+1]=8,H++,M[8]++;for(;H<=255;)d[2*H+1]=9,H++,M[9]++;for(;H<=279;)d[2*H+1]=7,H++,M[7]++;for(;H<=287;)d[2*H+1]=8,H++,M[8]++;for(s(d,287,M),H=0;H<U;H++)G[2*H+1]=5,G[2*H]=F(H,5);a=new p(d,w,257,O,h),k=new p(G,g,0,U,h),C=new p(new Array(0),B,0,19,7)})(),X=!0),H.l_desc=new j(H.dyn_ltree,a),H.d_desc=new j(H.dyn_dtree,k),H.bl_desc=new j(H.bl_tree,C),H.bi_buf=0,H.bi_valid=0,A(H)},H.exports._tr_stored_block=W,H.exports._tr_flush_block=(H,u,O,U)=>{let h,w,g=0;H.level>0?(2===H.strm.data_type&&(H.strm.data_type=(H=>{let u,O=4093624447;for(u=0;u<=31;u++,O>>>=1)if(1&O&&0!==H.dyn_ltree[2*u])return 0;if(0!==H.dyn_ltree[18]||0!==H.dyn_ltree[20]||0!==H.dyn_ltree[26])return 1;for(u=32;u<J;u++)if(0!==H.dyn_ltree[2*u])return 1;return 0})(H)),V(H,H.l_desc),V(H,H.d_desc),g=(H=>{let u;for(T(H,H.dyn_ltree,H.l_desc.max_code),T(H,H.dyn_dtree,H.d_desc.max_code),V(H,H.bl_desc),u=18;u>=3&&0===H.bl_tree[2*b[u]+1];u--);return H.opt_len+=3*(u+1)+5+5+4,u})(H),h=H.opt_len+3+7>>>3,w=H.static_len+3+7>>>3,w<=h&&(h=w)):h=w=O+5,O+4<=h&&-1!==u?W(H,u,O,U):4===H.strategy||w===h?(Z(H,2+(U?1:0),3),n(H,d,G)):(Z(H,4+(U?1:0),3),((H,u,J,O)=>{let U;for(Z(H,u-257,5),Z(H,J-1,5),Z(H,O-4,4),U=0;U<O;U++)Z(H,H.bl_tree[2*b[U]+1],3);R(H,H.dyn_ltree,u-1),R(H,H.dyn_dtree,J-1)})(H,H.l_desc.max_code+1,H.d_desc.max_code+1,g+1),n(H,H.dyn_ltree,H.dyn_dtree)),A(H),U&&t(H)},H.exports._tr_tally=(H,u,O)=>(H.pending_buf[H.d_buf+2*H.last_lit]=u>>>8&255,H.pending_buf[H.d_buf+2*H.last_lit+1]=255&u,H.pending_buf[H.l_buf+H.last_lit]=255&O,H.last_lit++,0===u?H.dyn_ltree[2*O]++:(H.matches++,u--,H.dyn_ltree[2*(mH[O]+J+1)]++,H.dyn_dtree[2*M(u)]++),H.last_lit===H.lit_bufsize-1),H.exports._tr_align=H=>{Z(H,2,3),Y(H,256,d),(H=>{16===H.bi_valid?(L(H,H.bi_buf),H.bi_buf=0,H.bi_valid=0):H.bi_valid>=8&&(H.pending_buf[H.pending++]=255&H.bi_buf,H.bi_buf>>=8,H.bi_valid-=8)})(H)}},13501:H=>{"use strict";H.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.bu="",this.state=null,this.data_type=2,this.adler=0}},13122:H=>{function u(H,u,J){for(var O=H.length,U=-1/0,h=1/0,w=0;w<O;w++){var g=(J[0][w]-H[w])/u[w],B=(J[1][w]-H[w])/u[w];if(g>B){var b=g;g=B,B=b}if(B<U||g>h)return 1/0;g>U&&(U=g),B<h&&(h=B)}return U>h?1/0:U}H.exports=function(H,J,O,U){var h=u(J,O,U);if(h===1/0)H=null;else{H=H||[];for(var w=0;w<J.length;w++)H[w]=J[w]+O[w]*h}return H},H.exports.distance=u},14486:(H,u,J)=>{"use strict";J.d(u,{c:()=>w});var O=J(41);const U=O.useLayoutEffect;const h=function(H){var u=(0,O.useRef)(H);return U((function(){u.current=H})),u};var w=function(H){var u=h(H);(0,O.wu)((function(){var H=function(H){var J;if(null!=u.current&&(J=u.current(H)),H.defaultPrevented&&(H.returnValue=""),"string"===typeof J)return H.returnValue=J,J};return window.addEventListener("beforeunload",H),function(){window.removeEventListener("beforeunload",H)}}),[])}},14439:(H,u,J)=>{"use strict";var O=J(14445),U=Array.prototype.concat,h=Array.prototype.slice,w=H.exports=function(H){for(var u=[],J=0,w=H.length;J<w;J++){var g=H[J];O(g)?u=U.call(u,h.call(g)):u.push(g)}return u};w.wrap=function(H){return function(){return H(w(arguments))}}},14445:H=>{H.exports=function(H){return!(!H||"string"===typeof H)&&(H instanceof Array||Array.isArray(H)||H.length>=0&&(H.splice instanceof Function||Object.getOwnPropertyDescriptor(H,H.length-1)&&"String"!==H.constructor.name))}},13396:(H,u,J)=>{var O=J(13399);function U(H){for(var u,J,U=0,h=H.length,w=0;w<H.length;){for(u=H[w],J=0;w<h&&H[w]===u;)++w,++J;U+=O.log2(J)/7|0,U+=O.log2(u>>>0)/7|0,U+=2}return U}u.size=U,u.encode=function(H,u){u||(u=new Uint8Array(U(H)));for(var J,O,h=0,w=u.length,g=0;g<H.length;){for(J=H[g],O=0;g<H.length&&H[g]===J;)++g,++O;for(;h<w&&O>=128;)u[h++]=128+(127&O),O>>>=7;if(h>=w)throw new Error("RLE buffer overflow");for(u[h++]=O,J>>>=0;h<w&&J>=128;)u[h++]=128+(127&J),J>>>=7;if(h>=w)throw new Error("RLE buffer overflow");u[h++]=J}return u},u.decode=function(H,u){for(var J,O,U,h,w=u.length,g=H.length,B=0,b=0;b<g;){for(J=0,O=0;b<g&&H[b]>=128;)J+=(127&H[b++])<<O,O+=7;if(J+=H[b++]<<O,b>=g)throw new Error("RLE buffer underrun");if(B+J>w)throw new Error("Chunk buffer overflow");for(U=0,O=0;b<g&&H[b]>=128;)U+=(127&H[b++])<<O,O+=7;if(b>=g)throw new Error("RLE buffer underrun");for(U+=H[b++]<<O,h=0;h<J;++h)u[B++]=U}return u}},13399:(H,u)=>{"use strict";function J(H){var u=32;return(H&=-H)&&u--,65535&H&&(u-=16),16711935&H&&(u-=8),252645135&H&&(u-=4),858993459&H&&(u-=2),1431655765&H&&(u-=1),u}u.INT_BITS=32,u.INT_MAX=2147483647,u.INT_MIN=-1<<31,u.sign=function(H){return(H>0)-(H<0)},u.abs=function(H){var u=H>>31;return(H^u)-u},u.min=function(H,u){return u^(H^u)&-(H<u)},u.max=function(H,u){return H^(H^u)&-(H<u)},u.isPow2=function(H){return!(H&H-1)&&!!H},u.log2=function(H){var u,J;return u=(H>65535)<<4,u|=J=((H>>>=u)>255)<<3,u|=J=((H>>>=J)>15)<<2,(u|=J=((H>>>=J)>3)<<1)|(H>>>=J)>>1},u.log10=function(H){return H>=1e9?9:H>=1e8?8:H>=1e7?7:H>=1e6?6:H>=1e5?5:H>=1e4?4:H>=1e3?3:H>=100?2:H>=10?1:0},u.popCount=function(H){return 16843009*((H=(858993459&(H-=H>>>1&1431655765))+(H>>>2&858993459))+(H>>>4)&252645135)>>>24},u.countTrailingZeros=J,u.nextPow2=function(H){return H+=0===H,--H,H|=H>>>1,H|=H>>>2,H|=H>>>4,H|=H>>>8,(H|=H>>>16)+1},u.prevPow2=function(H){return H|=H>>>1,H|=H>>>2,H|=H>>>4,H|=H>>>8,(H|=H>>>16)-(H>>>1)},u.parity=function(H){return H^=H>>>16,H^=H>>>8,H^=H>>>4,27030>>>(H&=15)&1};var O=new Array(256);!function(H){for(var u=0;u<256;++u){var J=u,O=u,U=7;for(J>>>=1;J;J>>>=1)O<<=1,O|=1&J,--U;H[u]=O<<U&255}}(O),u.reverse=function(H){return O[255&H]<<24|O[H>>>8&255]<<16|O[H>>>16&255]<<8|O[H>>>24&255]},u.interleave2=function(H,u){return(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H&=65535)|H<<8))|H<<4))|H<<2))|H<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u&=65535)|u<<8))|u<<4))|u<<2))|u<<1))<<1},u.deinterleave2=function(H,u){return(H=65535&((H=16711935&((H=252645135&((H=858993459&((H=H>>>u&1431655765)|H>>>1))|H>>>2))|H>>>4))|H>>>16))<<16>>16},u.interleave3=function(H,u,J){return H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2),(H|=(u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2))<<1)|(J=1227133513&((J=3272356035&((J=251719695&((J=4278190335&((J&=1023)|J<<16))|J<<8))|J<<4))|J<<2))<<2},u.deinterleave3=function(H,u){return(H=1023&((H=4278190335&((H=251719695&((H=3272356035&((H=H>>>u&1227133513)|H>>>2))|H>>>4))|H>>>8))|H>>>16))<<22>>22},u.nextCombination=function(H){var u=H|H-1;return u+1|(~u&-~u)-1>>>J(H)+1}},13437:H=>{"use strict";H.exports=function(H,u,J,O){var U=self||window;try{try{var h;try{h=new U.Blob([H])}catch(b){(h=new(U.BlobBuilder||U.WebKitBlobBuilder||U.MozBlobBuilder||U.MSBlobBuilder)).append(H),h=h.getBlob()}var w=U.URL||U.webkitURL,g=w.createObjectURL(h),B=new U[u](g,J);return w.revokeObjectURL(g),B}catch(b){return new U[u]("data:application/javascript,".concat(encodeURIComponent(H)),J)}}catch(b){if(!O)throw Error("Inline worker is not supported");return new U[u](O,J)}}},13112:(H,u,J)=>{"use strict";function O(H,u,J,O,U){var h={};return Object.keys(O).forEach((function(H){h[H]=O[H]})),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=J.slice().reverse().reduce((function(J,O){return O(H,u,J)||J}),h),U&&void 0!==h.initializer&&(h.value=h.initializer?h.initializer.call(U):void 0,h.initializer=void 0),void 0===h.initializer&&(Object.defineProperty(H,u,h),h=null),h}J.d(u,{c:()=>O})},13110:(H,u,J)=>{"use strict";function O(H,u,J,O){J&&Object.defineProperty(H,u,{enumerable:J.enumerable,configurable:J.configurable,writable:J.writable,value:J.initializer?J.initializer.call(O):void 0})}J.d(u,{b:()=>O})},14472:(H,u,J)=>{"use strict";J.d(u,{e:()=>w,g:()=>G,k:()=>g,l:()=>h,n:()=>B,p:()=>U,t:()=>b,u:()=>d});var O=J(12532);class U{constructor(){this._easingMode=U.EASINGMODE_EASEIN}setEasingMode(H){const u=Math.min(Math.max(H,0),2);this._easingMode=u}getEasingMode(){return this._easingMode}easeInCore(H){throw new Error("You must implement this method")}ease(H){switch(this._easingMode){case U.EASINGMODE_EASEIN:return this.easeInCore(H);case U.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-H)}return H>=.5?.5*(1-this.easeInCore(2*(1-H)))+.5:.5*this.easeInCore(2*H)}}U.EASINGMODE_EASEIN=0,U.EASINGMODE_EASEOUT=1,U.EASINGMODE_EASEINOUT=2;class h extends U{easeInCore(H){return H=Math.max(0,Math.min(1,H)),1-Math.sqrt(1-H*H)}}class w extends U{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=H}easeInCore(H){const u=Math.max(0,this.amplitude);return Math.pow(H,3)-H*u*Math.sin(3.141592653589793*H)}}class g extends U{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=H,this.bounciness=u}easeInCore(H){const u=Math.max(0,this.bounces);let J=this.bounciness;J<=1&&(J=1.001);const O=Math.pow(J,u),U=1-J,h=(1-O)/U+.5*O,w=H*h,g=Math.log(-w*(1-J)+1)/Math.log(J),B=Math.floor(g),b=B+1,d=(1-Math.pow(J,B))/(U*h),G=.5*(d+(1-Math.pow(J,b))/(U*h)),P=H-G,mH=G-d;return-Math.pow(1/J,u-B)/(mH*mH)*(P-mH)*(P+mH)}}class B extends U{easeInCore(H){return H*H*H}}class b extends U{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=H,this.springiness=u}easeInCore(H){let u;const J=Math.max(0,this.oscillations),O=Math.max(0,this.springiness);return u=0==O?H:(Math.exp(O*H)-1)/(Math.exp(O)-1),u*Math.sin((6.283185307179586*J+1.5707963267948966)*H)}}class d extends U{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=H}easeInCore(H){return this.exponent<=0?H:(Math.exp(this.exponent*H)-1)/(Math.exp(this.exponent)-1)}}class G extends U{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=H,this.y1=u,this.x2=J,this.y2=O}easeInCore(H){return O.b.Interpolate(H,this.x1,this.y1,this.x2,this.y2)}}},13956:(H,u,J)=>{"use strict";J.d(u,{e:()=>w});var O=J(12338),U=J(12345),h=J(12732);class w extends h.d{get _matrix(){return this._compose(),this.vm}set _matrix(H){(H.updateFlag!==this.vm.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.vm.O(H),this._markAsDirtyAndDecompose())}constructor(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(H,u.ZH(),!1),this.name=H,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=u,this.vm=(null===U||void 0===U?void 0:U.clone())??O.Matrix.Identity(),this._restMatrix=h??this.vm.clone(),this._bindMatrix=w??this.vm.clone(),this._index=g,this._absoluteMatrix=new O.Matrix,this._absoluteBindMatrix=new O.Matrix,this._absoluteInverseBindMatrix=new O.Matrix,this._finalMatrix=new O.Matrix,u.bones.push(this),this.setParent(J,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(H){this.setParent(H)}setParent(H){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==H){if(this.parent){const H=this.parent.children.indexOf(this);-1!==H&&this.parent.children.splice(H,1)}this._parentNode=H,this.parent&&this.parent.children.push(this),u&&this._updateAbsoluteBindMatrices(),this.BG()}}getLocalMatrix(){return this._compose(),this.vm}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(H){this._restMatrix.O(H)}setRestPose(H){this.setRestMatrix(H)}getBindPose(){return this.getBindMatrix()}setBindMatrix(H){this.wg(H)}setBindPose(H){this.setBindMatrix(H)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const H=O.TmpVectors.lu[0],u=O.TmpVectors.Quaternion[0],J=O.TmpVectors.lu[1];this.getRestMatrix().decompose(H,u,J),this._linkedTransformNode.position.O(J),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??O.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.O(u),this._linkedTransformNode.Cg.O(H)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(H){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=H,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.zg}set position(H){this._decompose(),this.zg.O(H),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(H){this.setRotation(H)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(H){this.setRotationQuaternion(H)}get Cg(){return this.getScale()}set Cg(H){this.setScale(H)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=O.lu.Zero(),this._localRotation=O.Quaternion.Zero(),this.zg=O.lu.Zero()),this.vm.decompose(this._localScaling,this._localRotation,this.zg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,O.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.zg,this.vm)):this._needToCompose=!1)}wg(H){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],J=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.O(H),u&&this._updateAbsoluteBindMatrices(),J?this._matrix=H:this.BG()}_updateAbsoluteBindMatrices(H){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(H||(H=this._bindMatrix),this.parent?H.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.O(H),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),u)for(let J=0;J<this.children.length;J++)this.children[J]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}BG(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.BG(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.BG(),this._needToDecompose=!0}_updatePosition(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,J=arguments.length>2?arguments[2]:void 0,U=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const h=this.getLocalMatrix();if(0==u)U?(h.addAtIndex(12,H.x),h.addAtIndex(13,H.y),h.addAtIndex(14,H.z)):h.setTranslationFromFloats(H.x,H.y,H.z);else{let u=null;J&&(u=J.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const g=w._TmpMats[0],B=w._TmpVecs[0];this.parent?J&&u?(g.O(this.parent.getAbsoluteMatrix()),g.multiplyToRef(u,g)):g.O(this.parent.getAbsoluteMatrix()):O.Matrix.IdentityToRef(g),U&&g.setTranslationFromFloats(0,0,0),g.invert(),O.lu.TransformCoordinatesToRef(H,g,B),U?(h.addAtIndex(12,B.x),h.addAtIndex(13,B.y),h.addAtIndex(14,B.z)):h.setTranslationFromFloats(B.x,B.y,B.z)}this._markAsDirtyAndDecompose()}translate(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,J=arguments.length>2?arguments[2]:void 0;this._updatePosition(H,u,J,!0)}setPosition(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,J=arguments.length>2?arguments[2]:void 0;this._updatePosition(H,u,J,!1)}setAbsolutePosition(H,u){this.setPosition(H,1,u)}scale(H,u,J){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const h=this.getLocalMatrix(),g=w._TmpMats[0];O.Matrix.ScalingToRef(H,u,J,g),g.multiplyToRef(h,h),g.invert();for(const O of this.children){const U=O.getLocalMatrix();U.multiplyToRef(g,U),U.multiplyAtIndex(12,H),U.multiplyAtIndex(13,u),U.multiplyAtIndex(14,J),O._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),U)for(const O of this.children)O.scale(H,u,J,U)}setScale(H){this._decompose(),this._localScaling.O(H),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(H){this._decompose(),H.O(this._localScaling)}setYawPitchRoll(H,u,J){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4?arguments[4]:void 0;if(0===U){const g=w._TmpQuat;return O.Quaternion.RotationYawPitchRollToRef(H,u,J,g),void this.setRotationQuaternion(g,U,h)}const g=w._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(g,h))return;const B=w._TmpMats[1];O.Matrix.RotationYawPitchRollToRef(H,u,J,B),g.multiplyToRef(B,B),this._rotateWithMatrix(B,U,h)}rotate(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,U=arguments.length>3?arguments[3]:void 0;const h=w._TmpMats[0];h.setTranslationFromFloats(0,0,0),O.Matrix.RotationAxisToRef(H,u,h),this._rotateWithMatrix(h,J,U)}setAxisAngle(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,U=arguments.length>3?arguments[3]:void 0;if(0===J){const h=w._TmpQuat;return O.Quaternion.RotationAxisToRef(H,u,h),void this.setRotationQuaternion(h,J,U)}const h=w._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,U))return;const g=w._TmpMats[1];O.Matrix.RotationAxisToRef(H,u,g),h.multiplyToRef(g,g),this._rotateWithMatrix(g,J,U)}setRotation(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,J=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(H.y,H.x,H.z,u,J)}setRotationQuaternion(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,J=arguments.length>2?arguments[2]:void 0;if(0===u)return this._decompose(),this._localRotation.O(H),void this._markAsDirtyAndCompose();const U=w._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(U,J))return;const h=w._TmpMats[1];O.Matrix.FromQuaternionToRef(H,h),U.multiplyToRef(h,h),this._rotateWithMatrix(h,u,J)}setRotationMatrix(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,J=arguments.length>2?arguments[2]:void 0;if(0===u){const U=w._TmpQuat;return O.Quaternion.FromRotationMatrixToRef(H,U),void this.setRotationQuaternion(U,u,J)}const U=w._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(U,J))return;const h=w._TmpMats[1];h.O(H),U.multiplyToRef(H,h),this._rotateWithMatrix(h,u,J)}_rotateWithMatrix(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,J=arguments.length>2?arguments[2]:void 0;const O=this.getLocalMatrix(),U=O.m[12],h=O.m[13],g=O.m[14],B=this.getParent(),b=w._TmpMats[3],d=w._TmpMats[4];B&&1==u?(J?(b.O(J.getWorldMatrix()),B.getAbsoluteMatrix().multiplyToRef(b,b)):b.O(B.getAbsoluteMatrix()),d.O(b),d.invert(),O.multiplyToRef(b,O),O.multiplyToRef(H,O),O.multiplyToRef(d,O)):1==u&&J?(b.O(J.getWorldMatrix()),d.O(b),d.invert(),O.multiplyToRef(b,O),O.multiplyToRef(H,O),O.multiplyToRef(d,O)):O.multiplyToRef(H,O),O.setTranslationFromFloats(U,h,g),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(H,u){const J=w._TmpMats[2];return H.O(this.getAbsoluteMatrix()),u?(H.multiplyToRef(u.getWorldMatrix(),H),O.Matrix.ScalingToRef(u.Cg.x,u.Cg.y,u.Cg.z,J)):O.Matrix.IdentityToRef(J),H.invert(),!isNaN(H.m[0])&&(J.multiplyAtIndex(0,this._scalingDeterminant),H.multiplyToRef(J,H),!0)}dh(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const J=O.lu.Zero();return this.getPositionToRef(H,u,J),J}getPositionToRef(){let H=arguments.length>1?arguments[1]:void 0,u=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const H=this.getLocalMatrix();u.x=H.m[12],u.y=H.m[13],u.z=H.m[14]}else{let J=null;H&&(J=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let O=w._TmpMats[0];H&&J?(O.O(this.getAbsoluteMatrix()),O.multiplyToRef(J,O)):O=this.getAbsoluteMatrix(),u.x=O.m[12],u.y=O.m[13],u.z=O.m[14]}}getAbsolutePosition(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const u=O.lu.Zero();return this.getPositionToRef(1,H,u),u}getAbsolutePositionToRef(H,u){this.getPositionToRef(1,H,u)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.vm.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.O(this.vm);const H=this._skeleton.getPoseMatrix();H&&this._absoluteMatrix.multiplyToRef(H,this._absoluteMatrix)}const H=this.children,u=H.length;for(let J=0;J<u;J++)H[J].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}FB(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const J=O.lu.Zero();return this.getDirectionToRef(H,u,J),J}getDirectionToRef(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,J=arguments.length>2?arguments[2]:void 0,U=null;u&&(U=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=w._TmpMats[0];h.O(this.getAbsoluteMatrix()),u&&U&&h.multiplyToRef(U,h),O.lu.TransformNormalToRef(H,h,J),J.normalize()}getRotation(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const J=O.lu.Zero();return this.getRotationToRef(H,u,J),J}getRotationToRef(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,J=arguments.length>2?arguments[2]:void 0;const O=w._TmpQuat;this.getRotationQuaternionToRef(H,u,O),O.toEulerAnglesToRef(J)}getRotationQuaternion(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const J=O.Quaternion.Identity();return this.getRotationQuaternionToRef(H,u,J),J}getRotationQuaternionToRef(){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),u.O(this._localRotation);else{const J=w._TmpMats[0],O=this.getAbsoluteMatrix();H?O.multiplyToRef(H.getWorldMatrix(),J):J.O(O),J.multiplyAtIndex(0,this._scalingDeterminant),J.multiplyAtIndex(1,this._scalingDeterminant),J.multiplyAtIndex(2,this._scalingDeterminant),J.decompose(void 0,u,void 0)}}getRotationMatrix(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1?arguments[1]:void 0;const J=O.Matrix.Identity();return this.getRotationMatrixToRef(H,u,J),J}getRotationMatrixToRef(){let H=arguments.length>1?arguments[1]:void 0,u=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(u);else{const J=w._TmpMats[0],O=this.getAbsoluteMatrix();H?O.multiplyToRef(H.getWorldMatrix(),J):J.O(O),J.multiplyAtIndex(0,this._scalingDeterminant),J.multiplyAtIndex(1,this._scalingDeterminant),J.multiplyAtIndex(2,this._scalingDeterminant),J.getRotationMatrixToRef(u)}}getAbsolutePositionFromLocal(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const J=O.lu.Zero();return this.getAbsolutePositionFromLocalToRef(H,u,J),J}getAbsolutePositionFromLocalToRef(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,J=arguments.length>2?arguments[2]:void 0,U=null;u&&(U=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=w._TmpMats[0];h.O(this.getAbsoluteMatrix()),u&&U&&h.multiplyToRef(U,h),O.lu.TransformCoordinatesToRef(H,h,J)}getLocalPositionFromAbsolute(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const J=O.lu.Zero();return this.getLocalPositionFromAbsoluteToRef(H,u,J),J}getLocalPositionFromAbsoluteToRef(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,J=arguments.length>2?arguments[2]:void 0,U=null;u&&(U=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=w._TmpMats[0];h.O(this.getAbsoluteMatrix()),u&&U&&h.multiplyToRef(U,h),h.invert(),O.lu.TransformCoordinatesToRef(H,h,J)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const H=this._skeleton.bones.indexOf(this);if(-1!==H&&this._skeleton.bones.splice(H,1),this._parentNode&&this._parentNode.children){const H=this._parentNode.children,u=H.indexOf(this);-1!==u&&H.splice(u,1)}super.dispose()}}w._TmpVecs=(0,U.b)(2,O.lu.Zero),w._TmpQuat=O.Quaternion.Identity(),w._TmpMats=(0,U.b)(5,O.Matrix.Identity)},14469:(H,u,J)=>{"use strict";J.d(u,{c:()=>V});var O=J(12324),U=J(12329),h=J(12175),w=J(12338),g=J(12349),B=J(12732),b=J(12770),d=J(12608),G=J(12197),P=J(12343);class mH{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(H){this._zoomStopsAnimation=H}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(H){this._idleRotationSpeed=H}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(H){this._idleRotationWaitTime=H}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(H){this._idleRotationSpinupTime=H}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(H){this._attachedCamera=H;const u=this._attachedCamera.ZH();this._onPrePointerObservableObserver=u.onPrePointerObservable.add((H=>{H.type!==d.d.POINTERDOWN?H.type===d.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=H.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const H=G.e.Now;let u=0;null!=this._lastFrameTime&&(u=H-this._lastFrameTime),this._lastFrameTime=H,this._applyUserInteraction();const J=H-this._lastInteractionTime-this._idleRotationWaitTime,O=Math.max(Math.min(J/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*O,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(u/1e3))}))}detach(){if(!this._attachedCamera)return;const H=this._attachedCamera.ZH();this._onPrePointerObservableObserver&&H.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(H){this._lastInteractionTime=H??G.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<P.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let H=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(H=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?H:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=G.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var l=J(14472),r=J(12852);class p{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(H){if(this._autoTransitionRange===H)return;this._autoTransitionRange=H;const u=this._attachedCamera;u&&(H?this._onMeshTargetChangedObserver=u.onMeshTargetChangedObservable.add((H=>{if(H&&(H.dg(!0),H.getBoundingInfo)){const u=H.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*u,this.upperRadiusTransitionRange=.05*u}})):this._onMeshTargetChangedObserver&&u.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(H){this._attachedCamera=H,this._onAfterCheckInputsObserver=H.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(H){return!!this._attachedCamera&&(this._attachedCamera.radius===H&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(H){if(!this._attachedCamera)return;this._radiusBounceTransition||(p.EasingFunction.setEasingMode(p.EasingMode),this._radiusBounceTransition=r.e.CreateAnimation("radius",r.e.ANIMATIONTYPE_FLOAT,60,p.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const u=r.e.TransitionTo("radius",this._attachedCamera.radius+H,this._attachedCamera,this._attachedCamera.ZH(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));u&&this._animatables.push(u)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}p.EasingFunction=new l.e(.3),p.EasingMode=l.p.EASINGMODE_EASEOUT;class a{constructor(){this.onTargetFramingAnimationEndObservable=new h.b,this._mode=a.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(H){this._mode=H}get mode(){return this._mode}set radiusScale(H){this._radiusScale=H}get radiusScale(){return this._radiusScale}set positionScale(H){this._positionScale=H}get positionScale(){return this._positionScale}set defaultElevation(H){this._defaultElevation=H}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(H){this._elevationReturnTime=H}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(H){this._elevationReturnWaitTime=H}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(H){this._zoomStopsAnimation=H}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(H){this._framingTime=H}get framingTime(){return this._framingTime}init(){}attach(H){this._attachedCamera=H;const u=this._attachedCamera.ZH();a.EasingFunction.setEasingMode(a.EasingMode),this._onPrePointerObservableObserver=u.onPrePointerObservable.add((H=>{H.type!==d.d.POINTERDOWN?H.type===d.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=H.onMeshTargetChangedObservable.add((H=>{H&&H.getBoundingInfo&&this.zoomOnMesh(H,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=H.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const H=this._attachedCamera.ZH();this._onPrePointerObservableObserver&&H.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(H){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H.dg(!0);const O=H.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(O.minimumWorld,O.maximumWorld,u,J)}zoomOnMeshHierarchy(H){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H.dg(!0);const O=H.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(O.min,O.max,u,J)}zoomOnMeshesHierarchy(H){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new w.lu(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new w.lu(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let h=0;h<H.length;h++){const u=H[h].getHierarchyBoundingVectors(!0);w.lu.CheckExtends(u.min,O,U),w.lu.CheckExtends(u.max,O,U)}this.zoomOnBoundingInfo(O,U,u,J)}zoomOnBoundingInfo(H,u){let J,O=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const h=H.y,g=h+(u.y-h)*this._positionScale,B=u.ru(H).scale(.5);if(!isFinite(g))return!1;if(O)J=new w.lu(0,g,0);else{const u=H.add(B);J=new w.lu(u.x,g,u.z)}this._vectorTransition||(this._vectorTransition=r.e.CreateAnimation("target",r.e.ANIMATIONTYPE_VECTOR3,60,a.EasingFunction)),this._betaIsAnimating=!0;let b=r.e.TransitionTo("target",J,this._attachedCamera,this._attachedCamera.ZH(),60,this._vectorTransition,this._framingTime);b&&this._animatables.push(b);let d=0;if(this._mode===a.FitFrustumSidesMode){const J=this._calculateLowerRadiusFromModelBoundingSphere(H,u);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=B.length()+this._attachedCamera.Ug),d=J}else this._mode===a.IgnoreBoundsSizeMode&&(d=this._calculateLowerRadiusFromModelBoundingSphere(H,u),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ug));if(this.autoCorrectCameraLimitsAndSensibility){const J=u.ru(H).length();this._attachedCamera.panningSensibility=5e3/J,this._attachedCamera.wheelPrecision=100/d}return this._radiusTransition||(this._radiusTransition=r.e.CreateAnimation("radius",r.e.ANIMATIONTYPE_FLOAT,60,a.EasingFunction)),b=r.e.TransitionTo("radius",d,this._attachedCamera,this._attachedCamera.ZH(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),U&&U(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),b&&this._animatables.push(b),!0}_calculateLowerRadiusFromModelBoundingSphere(H,u){const J=this._attachedCamera;if(!J)return 0;let O=J._calculateLowerRadiusFromModelBoundingSphere(H,u,this._radiusScale);return J.lowerRadiusLimit&&this._mode===a.IgnoreBoundsSizeMode&&(O=O<J.lowerRadiusLimit?J.lowerRadiusLimit:O),J.upperRadiusLimit&&(O=O>J.upperRadiusLimit?J.upperRadiusLimit:O),O}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const H=G.e.Now-this._lastInteractionTime,u=.5*Math.PI-this._defaultElevation,J=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>J&&H>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=r.e.CreateAnimation("beta",r.e.ANIMATIONTYPE_FLOAT,60,a.EasingFunction));const H=r.e.TransitionTo("beta",u,this._attachedCamera,this._attachedCamera.ZH(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));H&&this._animatables.push(H)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=G.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}a.EasingFunction=new l.u,a.EasingMode=l.p.EASINGMODE_EASEINOUT,a.IgnoreBoundsSizeMode=0,a.FitFrustumSidesMode=1;var k=J(12774),C=J(12811),j=J(13950),M=J(12171);class L{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(H){H=M.Tools.BackCompatCameraNoPreventDefault(arguments);const u=this.camera.getEngine(),J=u.getInputElement();let O=0,U=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=h=>{var w,g;const B=h.event,b="touch"===B.pointerType;if(h.type!==d.d.POINTERMOVE&&-1===this.buttons.indexOf(B.button))return;const G=B.target;if(this._altKey=B.altKey,this._ctrlKey=B.ctrlKey,this._metaKey=B.metaKey,this._shiftKey=B.shiftKey,this._buttonsPressed=B.buttons,u.isPointerLock){const H=B.movementX,u=B.movementY;this.onTouch(null,H,u),this._pointA=null,this._pointB=null}else{if(h.type!==d.d.POINTERDOWN&&h.type!==d.d.POINTERDOUBLETAP&&b&&(null===(w=this._pointA)||void 0===w?void 0:w.pointerId)!==B.pointerId&&(null===(g=this._pointB)||void 0===g?void 0:g.pointerId)!==B.pointerId)return;if(h.type!==d.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!b)if(h.type===d.d.POINTERDOUBLETAP)this.onDoubleTap(B.pointerType);else if(h.type!==d.d.POINTERUP||this._currentMousePointerIdDown!==B.pointerId&&!b){if(h.type===d.d.POINTERMOVE)if(H||B.preventDefault(),this._pointA&&null===this._pointB){const H=B.clientX-this._pointA.x,u=B.clientY-this._pointA.y;this._pointA.x=B.clientX,this._pointA.y=B.clientY,this.onTouch(this._pointA,H,u)}else if(this._pointA&&this._pointB){const H=this._pointA.pointerId===B.pointerId?this._pointA:this._pointB;H.x=B.clientX,H.y=B.clientY;const u=this._pointA.x-this._pointB.x,J=this._pointA.y-this._pointB.y,w=u*u+J*J,g={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:B.pointerId,type:h.type};this.onMultiTouch(this._pointA,this._pointB,O,w,U,g),U=g,O=w}}else{try{null===G||void 0===G||G.releasePointerCapture(B.pointerId)}catch(P){}b||(this._pointB=null),u._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==B.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==B.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==O||U)&&(this.onMultiTouch(this._pointA,this._pointB,O,0,U,null),O=0,U=null),this._currentMousePointerIdDown=-1,this.onButtonUp(B),H||B.preventDefault()}else{try{null===G||void 0===G||G.setPointerCapture(B.pointerId)}catch(P){}if(null===this._pointA)this._pointA={x:B.clientX,y:B.clientY,pointerId:B.pointerId,type:B.pointerType};else{if(null!==this._pointB)return;this._pointB={x:B.clientX,y:B.clientY,pointerId:B.pointerId,type:B.pointerType}}-1!==this._currentMousePointerIdDown||b||(this._currentMousePointerIdDown=B.pointerId),this.onButtonDown(B),H||(B.preventDefault(),J&&J.focus())}}},this._observer=this.camera.ZH()._inputManager._addCameraPointerObserver(this._pointerInput,d.d.POINTERDOWN|d.d.POINTERUP|d.d.POINTERMOVE|d.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,O=0,U=null,this.onLostFocus()},this._contextMenuBind=H=>this.onContextMenu(H),J&&J.addEventListener("contextmenu",this._contextMenuBind,!1);const h=this.camera.ZH().getEngine().getHostWindow();h&&M.Tools.RegisterTopRootEvents(h,[{name:"blur",handler:this._onLostFocus}])}qP(){if(this._onLostFocus){const H=this.camera.ZH().getEngine().getHostWindow();H&&M.Tools.UnregisterTopRootEvents(H,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.ZH()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const H=this.camera.ZH().getEngine().getInputElement();H&&H.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(H){}onTouch(H,u,J){}onMultiTouch(H,u,J,O,U,h){}onContextMenu(H){H.preventDefault()}onButtonDown(H){}onButtonUp(H){}onLostFocus(){}}(0,O.c)([(0,U.I)()],L.prototype,"buttons",void 0);class Z extends L{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(H,u){if(0!==this.panningSensibility&&H&&u){const J=u.x-H.x,O=u.y-H.y;this.camera.inertialPanningX+=-J/this.panningSensibility,this.camera.inertialPanningY+=O/this.panningSensibility}}_computePinchZoom(H,u){const J=this.camera.radius||Z.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=J*Math.sqrt(H)/Math.sqrt(u):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(u-H)*J*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(u-H)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(H,u,J){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-u/this.panningSensibility,this.camera.inertialPanningY+=J/this.panningSensibility):(this.camera.inertialAlphaOffset-=u/this.angularSensibilityX,this.camera.inertialBetaOffset-=J/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(H,u,J,O,U,h){0===J&&null===U||0===O&&null===h||(this.multiTouchPanAndZoom?(this._computePinchZoom(J,O),this._computeMultiTouchPanning(U,h)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(O)-Math.sqrt(J))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(J,O),this._isPinching=!0):this._computeMultiTouchPanning(U,h)):this.multiTouchPanning?this._computeMultiTouchPanning(U,h):this.pinchZoom&&this._computePinchZoom(J,O))}onButtonDown(H){this._isPanClick=H.button===this.camera._panningMouseButton}onButtonUp(H){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}Z.MinimumRadiusForPinch=.001,(0,O.c)([(0,U.I)()],Z.prototype,"buttons",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"angularSensibilityX",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"angularSensibilityY",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"pinchPrecision",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"pinchDeltaPercentage",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"useNaturalPinchZoom",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"pinchZoom",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"panningSensibility",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"multiTouchPanning",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"multiTouchPanAndZoom",void 0),j.b.ArcRotateCameraPointersInput=Z;var Y=J(12616);class F{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(H){H=M.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.ZH(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((u=>{const J=u.event;if(!J.metaKey)if(u.type===Y.c.KEYDOWN){if(this._ctrlPressed=J.ctrlKey,this._altPressed=J.altKey,-1!==this.keysUp.indexOf(J.keyCode)||-1!==this.keysDown.indexOf(J.keyCode)||-1!==this.keysLeft.indexOf(J.keyCode)||-1!==this.keysRight.indexOf(J.keyCode)||-1!==this.keysReset.indexOf(J.keyCode)){-1===this._keys.indexOf(J.keyCode)&&this._keys.push(J.keyCode),J.preventDefault&&(H||J.preventDefault())}}else if(-1!==this.keysUp.indexOf(J.keyCode)||-1!==this.keysDown.indexOf(J.keyCode)||-1!==this.keysLeft.indexOf(J.keyCode)||-1!==this.keysRight.indexOf(J.keyCode)||-1!==this.keysReset.indexOf(J.keyCode)){const u=this._keys.indexOf(J.keyCode);u>=0&&this._keys.splice(u,1),J.preventDefault&&(H||J.preventDefault())}})))}qP(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const H=this.camera;for(let u=0;u<this._keys.length;u++){const J=this._keys[u];-1!==this.keysLeft.indexOf(J)?this._ctrlPressed&&this.camera._useCtrlForPanning?H.inertialPanningX-=1/this.panningSensibility:H.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(J)?this._ctrlPressed&&this.camera._useCtrlForPanning?H.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?H.inertialRadiusOffset+=1/this.zoomingSensibility:H.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(J)?this._ctrlPressed&&this.camera._useCtrlForPanning?H.inertialPanningX+=1/this.panningSensibility:H.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(J)?this._ctrlPressed&&this.camera._useCtrlForPanning?H.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?H.inertialRadiusOffset-=1/this.zoomingSensibility:H.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(J)&&H.useInputToRestoreState&&H.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,O.c)([(0,U.I)()],F.prototype,"keysUp",void 0),(0,O.c)([(0,U.I)()],F.prototype,"keysDown",void 0),(0,O.c)([(0,U.I)()],F.prototype,"keysLeft",void 0),(0,O.c)([(0,U.I)()],F.prototype,"keysRight",void 0),(0,O.c)([(0,U.I)()],F.prototype,"keysReset",void 0),(0,O.c)([(0,U.I)()],F.prototype,"panningSensibility",void 0),(0,O.c)([(0,U.I)()],F.prototype,"zoomingSensibility",void 0),(0,O.c)([(0,U.I)()],F.prototype,"useAltToZoom",void 0),(0,O.c)([(0,U.I)()],F.prototype,"angularSpeed",void 0),j.b.ArcRotateCameraKeyboardMoveInput=F;var s=J(12388),A=J(12621);class t{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new w.lu(0,0,0),this._globalOffset=new w.lu(0,0,0),this._inertialPanning=w.lu.Zero()}_computeDeltaFromMouseWheelLegacyEvent(H,u){let J=0;const O=.01*H*this.wheelDeltaPercentage*u;return J=H>0?O/(1+this.wheelDeltaPercentage):O*(1+this.wheelDeltaPercentage),J}attachControl(H){H=M.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=u=>{if(u.type!==d.d.POINTERWHEEL)return;const J=u.event;let O=0;const U=J.deltaMode===A.d.DOM_DELTA_LINE?40:1,h=-J.deltaY*U;if(this.customComputeDeltaFromMouseWheel)O=this.customComputeDeltaFromMouseWheel(h,this,J);else if(this.wheelDeltaPercentage){if(O=this._computeDeltaFromMouseWheelLegacyEvent(h,this.camera.radius),O>0){let H=this.camera.radius,u=this.camera.inertialRadiusOffset+O;for(let J=0;J<20&&!(H<=u)&&!(Math.abs(u*this.camera.inertia)<.001);J++)H-=u,u*=this.camera.inertia;H=(0,g.Clamp)(H,0,Number.MAX_VALUE),O=this._computeDeltaFromMouseWheelLegacyEvent(h,H)}}else O=h/(40*this.wheelPrecision);O&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(O)):this.camera.inertialRadiusOffset+=O),J.preventDefault&&(H||J.preventDefault())},this._observer=this.camera.ZH()._inputManager._addCameraPointerObserver(this._wheel,d.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.jg(0)}qP(){this._observer&&(this.camera.ZH()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const H=this.camera;0+H.inertialAlphaOffset+H.inertialBetaOffset+H.inertialRadiusOffset&&(this._updateHitPlane(),H.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(H.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const H=this.camera,u=H.target.ru(H.position);this._hitPlane=s.d.FromPositionAndNormal(H.target,u)}_getPosition(){const H=this.camera,u=H.ZH(),J=u.createPickingRay(u.pointerX,u.pointerY,w.Matrix.Identity(),H,!1);0===H.targetScreenOffset.x&&0===H.targetScreenOffset.y||(this._viewOffset.set(H.targetScreenOffset.x,H.targetScreenOffset.y,0),H.getViewMatrix().invertToRef(H._cameraTransformMatrix),this._globalOffset=w.lu.TransformNormal(this._viewOffset,H._cameraTransformMatrix),J.origin.addInPlace(this._globalOffset));let O=0;return this._hitPlane&&(O=J.intersectsPlane(this._hitPlane)??0),J.origin.addInPlace(J.direction.scaleInPlace(O))}_zoomToMouse(H){const u=this.camera,J=1-u.inertia;if(u.lowerRadiusLimit){const O=u.lowerRadiusLimit??0;u.radius-(u.inertialRadiusOffset+H)/J<O&&(H=(u.radius-O)*J-u.inertialRadiusOffset)}if(u.upperRadiusLimit){const O=u.upperRadiusLimit??0;u.radius-(u.inertialRadiusOffset+H)/J>O&&(H=(u.radius-O)*J-u.inertialRadiusOffset)}const O=H/J/u.radius,U=this._getPosition(),h=w.TmpVectors.lu[6];U.subtractToRef(u.target,h),h.scaleInPlace(O),h.scaleInPlace(J),this._inertialPanning.addInPlace(h),u.inertialRadiusOffset+=H}_zeroIfClose(H){Math.abs(H.x)<P.d&&(H.x=0),Math.abs(H.y)<P.d&&(H.y=0),Math.abs(H.z)<P.d&&(H.z=0)}}(0,O.c)([(0,U.I)()],t.prototype,"wheelPrecision",void 0),(0,O.c)([(0,U.I)()],t.prototype,"zoomToMouseLocation",void 0),(0,O.c)([(0,U.I)()],t.prototype,"wheelDeltaPercentage",void 0),j.b.ArcRotateCameraMouseWheelInput=t;class e extends j.c{constructor(H){super(H)}addMouseWheel(){return this.add(new t),this}addPointers(){return this.add(new Z),this}addKeyboard(){return this.add(new F),this}}var c=J(12304);function n(H,u){return isNaN(H)?u:H}B.d.AddNodeConstructor("ArcRotateCamera",((H,u)=>()=>new V(H,0,0,1,w.lu.Zero(),u)));class V extends C.e{get target(){return this._target}set target(H){this.setTarget(H)}get targetHost(){return this._targetHost}set targetHost(H){H&&this.setTarget(H)}getTarget(){return this.target}get position(){return this._position}set position(H){this.setPosition(H)}set upVector(H){this._upToYMatrix||(this._yToUpMatrix=new w.Matrix,this._upToYMatrix=new w.Matrix,this._upVector=w.lu.Zero()),H.normalize(),this._upVector.O(H),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){w.Matrix.RotationAlignToRef(w.lu.UpReadOnly,this._upVector,this._yToUpMatrix),w.Matrix.RotationAlignToRef(this._upVector,w.lu.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const H=this.inputs.attached.pointers;return H?H.angularSensibilityX:0}set angularSensibilityX(H){const u=this.inputs.attached.pointers;u&&(u.angularSensibilityX=H)}get angularSensibilityY(){const H=this.inputs.attached.pointers;return H?H.angularSensibilityY:0}set angularSensibilityY(H){const u=this.inputs.attached.pointers;u&&(u.angularSensibilityY=H)}get pinchPrecision(){const H=this.inputs.attached.pointers;return H?H.pinchPrecision:0}set pinchPrecision(H){const u=this.inputs.attached.pointers;u&&(u.pinchPrecision=H)}get pinchDeltaPercentage(){const H=this.inputs.attached.pointers;return H?H.pinchDeltaPercentage:0}set pinchDeltaPercentage(H){const u=this.inputs.attached.pointers;u&&(u.pinchDeltaPercentage=H)}get useNaturalPinchZoom(){const H=this.inputs.attached.pointers;return!!H&&H.useNaturalPinchZoom}set useNaturalPinchZoom(H){const u=this.inputs.attached.pointers;u&&(u.useNaturalPinchZoom=H)}get panningSensibility(){const H=this.inputs.attached.pointers;return H?H.panningSensibility:0}set panningSensibility(H){const u=this.inputs.attached.pointers;u&&(u.panningSensibility=H)}get keysUp(){const H=this.inputs.attached.keyboard;return H?H.keysUp:[]}set keysUp(H){const u=this.inputs.attached.keyboard;u&&(u.keysUp=H)}get keysDown(){const H=this.inputs.attached.keyboard;return H?H.keysDown:[]}set keysDown(H){const u=this.inputs.attached.keyboard;u&&(u.keysDown=H)}get keysLeft(){const H=this.inputs.attached.keyboard;return H?H.keysLeft:[]}set keysLeft(H){const u=this.inputs.attached.keyboard;u&&(u.keysLeft=H)}get keysRight(){const H=this.inputs.attached.keyboard;return H?H.keysRight:[]}set keysRight(H){const u=this.inputs.attached.keyboard;u&&(u.keysRight=H)}get wheelPrecision(){const H=this.inputs.attached.mousewheel;return H?H.wheelPrecision:0}set wheelPrecision(H){const u=this.inputs.attached.mousewheel;u&&(u.wheelPrecision=H)}get zoomToMouseLocation(){const H=this.inputs.attached.mousewheel;return!!H&&H.zoomToMouseLocation}set zoomToMouseLocation(H){const u=this.inputs.attached.mousewheel;u&&(u.zoomToMouseLocation=H)}get wheelDeltaPercentage(){const H=this.inputs.attached.mousewheel;return H?H.wheelDeltaPercentage:0}set wheelDeltaPercentage(H){const u=this.inputs.attached.mousewheel;u&&(u.wheelDeltaPercentage=H)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(H){H!==this.useBouncingBehavior&&(H?(this._bouncingBehavior=new p,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(H){H!==this.useFramingBehavior&&(H?(this._framingBehavior=new a,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(H){H!==this.useAutoRotationBehavior&&(H?(this._autoRotationBehavior=new mH,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(H,u,J,O,U,g){var B;let b=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(H,w.lu.Zero(),g,b),B=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=w.lu.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=w.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new w.Matrix,this.panningAxis=new w.lu(1,1,0),this._transformedDirection=new w.lu,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new h.b,this.checkCollisions=!1,this.collisionRadius=new w.lu(.5,.5,.5),this._previousPosition=w.lu.Zero(),this._collisionVelocity=w.lu.Zero(),this._newPosition=w.lu.Zero(),this._computationVector=w.lu.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new w.lu(NaN,NaN,NaN),this._goalTargetScreenOffset=new w.Vector2(NaN,NaN),this._onCollisionPositionChange=function(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;J?(B.setPosition(u),B.Rl&&B.Rl(J)):B._previousPosition.O(B._position);const O=Math.cos(B.alpha),U=Math.sin(B.alpha),h=Math.cos(B.beta);let w=Math.sin(B.beta);0===w&&(w=1e-4);const g=B._getTargetPosition();B._computationVector.kg(B.radius*O*w,B.radius*h,B.radius*U*w),g.addToRef(B._computationVector,B._newPosition),B._position.O(B._newPosition);let b=B.upVector;B.allowUpsideDown&&B.beta<0&&(b=b.clone(),b=b.negate()),B._computeViewMatrix(B._position,g,b),B._viewMatrix.addAtIndex(12,B.targetScreenOffset.x),B._viewMatrix.addAtIndex(13,B.targetScreenOffset.y),B._collisionTriggered=!1},this._target=w.lu.Zero(),U&&this.setTarget(U),this.alpha=u,this.beta=J,this.radius=O,this.getViewMatrix(),this.inputs=new e(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new w.lu(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=w.Vector2.Zero()}_updateCache(H){H||super._updateCache(),this._cache._target.O(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.O(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const H=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?H.addToRef(this._targetBoundingCenter,this._target):this._target.O(H)}const H=this._getLockedTargetPosition();return H||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>P.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,h=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=h?this._currentInterpolationFactor=h:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=n(H,this._goalAlpha),this._goalBeta=n(u,this._goalBeta),this._goalRadius=n(J,this._goalRadius),this._goalTarget.set(n(O.x,this._goalTarget.x),n(O.y,this._goalTarget.y),n(O.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(n(U.x,this._goalTargetScreenOffset.x),n(U.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,g.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,g.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,g.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,g.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(H,u){let J=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const U=arguments;u=M.Tools.BackCompatCameraNoPreventDefault(U),this._useCtrlForPanning=J,this._panningMouseButton=O,"boolean"===typeof U[0]&&(U.length>1&&(this._useCtrlForPanning=U[1]),U.length>2&&(this._panningMouseButton=U[2])),this.inputs.attachElement(u),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}qP(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let H=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){H=!0;const u=this.invertRotation?-1:1,J=this._calculateHandednessMultiplier();let O=this.inertialAlphaOffset*J;this.beta<0&&(O*=-1),this.alpha+=O*u,this.beta+=this.inertialBetaOffset*u,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<P.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<P.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*P.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){H=!0;const u=new w.lu(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),u.multiplyInPlace(this.panningAxis),w.lu.TransformNormalToRef(u,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const H=this.upVector,u=w.lu.CrossToRef(this._transformedDirection,H,this._transformedDirection);w.lu.CrossToRef(H,u,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);w.lu.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.O(this._transformedDirection)}else{if(this.parent){const H=w.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(H),H.transposeToRef(H),w.lu.TransformCoordinatesToRef(this._transformedDirection,H,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*P.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*P.d&&(this.inertialPanningY=0)}if(H)this.stopInterpolation();else if(this._isInterpolating){let H=!1;const u=this._scene.getEngine().getDeltaTime()/1e3,J=1-Math.pow(2,-u/this._currentInterpolationFactor),O=n(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const u=w.TmpVectors.lu[0].set(n(this._goalTarget.x,this._target.x),n(this._goalTarget.y,this._target.y),n(this._goalTarget.z,this._target.z));w.lu.LerpToRef(this.target,u,J,this._target),10*w.lu.Distance(this.target,u)/O<P.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.O(u),this.setTarget(this.target,!1,!0,!0)):H=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const u=w.Quaternion.RotationAlphaBetaGammaToRef(n(this._goalAlpha,this.alpha),n(this._goalBeta,this.beta),0,w.TmpVectors.Quaternion[0]),O=w.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,w.TmpVectors.Quaternion[1]),U=w.Quaternion.SlerpToRef(O,u,J,w.TmpVectors.Quaternion[2]);U.normalize();const h=U.toAlphaBetaGammaToRef(w.TmpVectors.lu[0]);if(this.alpha=h.x,this.beta=h.y,U.isApprox(u,P.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const H=u.toAlphaBetaGammaToRef(w.TmpVectors.lu[0]);this.alpha=H.x,this.beta=H.y}else H=!0}if(isNaN(this._goalRadius)||(this.radius+=(O-this.radius)*J,Math.abs(O/this.radius-1)<P.d?(this._goalRadius=NaN,this.radius=O):H=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const u=w.TmpVectors.Vector2[0].set(n(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),n(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));w.Vector2.LerpToRef(this.targetScreenOffset,u,J,this.targetScreenOffset),w.Vector2.Distance(this.targetScreenOffset,u)<P.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.O(u)):H=!0}this._isInterpolating=H}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||w.lu.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const H=this.alpha;var u,J;this.alpha=function(H){let u=Math.PI/2;return 0===H.x&&0===H.z||(u=Math.acos(H.x/Math.sqrt(Math.pow(H.x,2)+Math.pow(H.z,2)))),H.z<0&&(u=2*Math.PI-u),u}(this._computationVector),this.beta=(u=this._computationVector.y,J=this.radius,Math.acos(u/J));const O=Math.round((H-this.alpha)/(2*Math.PI));this.alpha+=2*O*Math.PI,this._checkLimits()}setPosition(H){this._position.equals(H)||(this._position.O(H),this.rebuildAnglesAndRadius())}setTarget(H){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(O=this.overrideCloneAlphaBetaRadius??O,H.dg)u&&H.getBoundingInfo?this._targetBoundingCenter=H.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,H.dg(),this._targetHost=H,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const u=H,O=this._getTargetPosition();if(O&&!J&&O.equals(u))return;this._targetHost=null,this._target=u,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}O||this.rebuildAnglesAndRadius()}_getViewMatrix(){const H=Math.cos(this.alpha),u=Math.sin(this.alpha),J=Math.cos(this.beta);let O=Math.sin(this.beta);0===O&&(O=1e-4),0===this.radius&&(this.radius=1e-4);const U=this._getTargetPosition();if(this._computationVector.kg(this.radius*H*O,this.radius*J,this.radius*u*O),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||w.lu.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),U.addToRef(this._computationVector,this._newPosition),this.ZH().collisionsEnabled&&this.checkCollisions){const H=this.ZH().collisionCoordinator;this._collider||(this._collider=H.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,H.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.O(this._newPosition);let H=this.upVector;this.allowUpsideDown&&O<0&&(H=H.negate()),this._computeViewMatrix(this._position,U,H),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.O(U),this._viewMatrix}zoomOn(H){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];H=H||this.ZH().meshes;const J=b.c.MinMax(H);let O=this._calculateLowerRadiusFromModelBoundingSphere(J.min,J.max);if(O=Math.max(Math.min(O,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=O*this.zoomOnFactor,this.mode===k.c.ORTHOGRAPHIC_CAMERA){const H=this.ZH().getEngine().getAspectRatio(this),u=O*this.zoomOnFactor/2;this.orthoLeft=-u*H,this.orthoRight=u*H,this.orthoBottom=-u,this.orthoTop=u}this.focusOn({min:J.min,max:J.max,distance:O},u)}focusOn(H){let u,J,O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===H.min){const O=H||this.ZH().meshes;u=b.c.MinMax(O),J=w.lu.Distance(u.min,u.max)}else{u=H,J=H.distance}this._target=b.c.Center(u),O||(this.maxZ=2*J)}createRigCamera(H,u){let J=0;switch(this.cameraRigMode){case k.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case k.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case k.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case k.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case k.c.RIG_MODE_VR:J=this._cameraRigParams.stereoHalfAngle*(0===u?1:-1);break;case k.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:J=this._cameraRigParams.stereoHalfAngle*(0===u?-1:1)}const O=new V(H,this.alpha+J,this.beta,this.radius,this._target,this.ZH());return O._cameraRigParams={},O.isRigCamera=!0,O.rigParent=this,O.upVector=this.upVector,O.mode=this.mode,O.orthoLeft=this.orthoLeft,O.orthoRight=this.orthoRight,O.orthoBottom=this.orthoBottom,O.orthoTop=this.orthoTop,O}_updateRigCameras(){const H=this._rigCameras[0],u=this._rigCameras[1];switch(H.beta=u.beta=this.beta,this.cameraRigMode){case k.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case k.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case k.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case k.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case k.c.RIG_MODE_VR:H.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,u.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case k.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:H.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,u.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const O=w.lu.Distance(H,u),U=this.ZH().getEngine().getAspectRatio(this),h=Math.tan(this.fov/2),g=h*U,B=.5*O*J,b=B*Math.sqrt(1+1/(g*g)),d=B*Math.sqrt(1+1/(h*h));return Math.max(b,d)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,O.c)([(0,U.I)()],V.prototype,"alpha",void 0),(0,O.c)([(0,U.I)()],V.prototype,"beta",void 0),(0,O.c)([(0,U.I)()],V.prototype,"radius",void 0),(0,O.c)([(0,U.I)()],V.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,O.c)([(0,U.G)("target")],V.prototype,"_target",void 0),(0,O.c)([(0,U.x)("targetHost")],V.prototype,"_targetHost",void 0),(0,O.c)([(0,U.I)()],V.prototype,"inertialAlphaOffset",void 0),(0,O.c)([(0,U.I)()],V.prototype,"inertialBetaOffset",void 0),(0,O.c)([(0,U.I)()],V.prototype,"inertialRadiusOffset",void 0),(0,O.c)([(0,U.I)()],V.prototype,"lowerAlphaLimit",void 0),(0,O.c)([(0,U.I)()],V.prototype,"upperAlphaLimit",void 0),(0,O.c)([(0,U.I)()],V.prototype,"lowerBetaLimit",void 0),(0,O.c)([(0,U.I)()],V.prototype,"upperBetaLimit",void 0),(0,O.c)([(0,U.I)()],V.prototype,"lowerRadiusLimit",void 0),(0,O.c)([(0,U.I)()],V.prototype,"upperRadiusLimit",void 0),(0,O.c)([(0,U.I)()],V.prototype,"lowerTargetYLimit",void 0),(0,O.c)([(0,U.I)()],V.prototype,"inertialPanningX",void 0),(0,O.c)([(0,U.I)()],V.prototype,"inertialPanningY",void 0),(0,O.c)([(0,U.I)()],V.prototype,"pinchToPanMaxDistance",void 0),(0,O.c)([(0,U.I)()],V.prototype,"panningDistanceLimit",void 0),(0,O.c)([(0,U.G)()],V.prototype,"panningOriginTarget",void 0),(0,O.c)([(0,U.I)()],V.prototype,"panningInertia",void 0),(0,O.c)([(0,U.I)()],V.prototype,"zoomToMouseLocation",null),(0,O.c)([(0,U.I)()],V.prototype,"zoomOnFactor",void 0),(0,O.c)([(0,U.F)()],V.prototype,"targetScreenOffset",void 0),(0,O.c)([(0,U.I)()],V.prototype,"allowUpsideDown",void 0),(0,O.c)([(0,U.I)()],V.prototype,"useInputToRestoreState",void 0),(0,O.c)([(0,U.I)()],V.prototype,"restoreStateInterpolationFactor",void 0),(0,c.f)("BABYLON.ArcRotateCamera",V)},13950:(H,u,J)=>{"use strict";J.d(u,{b:()=>w,c:()=>g});var O=J(12185),U=J(12365),h=J(12774),w={};class g{constructor(H){this.attachedToElement=!1,this.attached={},this.camera=H,this.checkInputs=()=>{}}add(H){const u=H.getSimpleName();this.attached[u]?O.b.Warn("camera input of type "+u+" already exists on camera"):(this.attached[u]=H,H.camera=this.camera,H.checkInputs&&(this.checkInputs=this._addCheckInputs(H.checkInputs.bind(H))),this.attachedToElement&&H.attachControl(this.noPreventDefault))}remove(H){for(const u in this.attached){const J=this.attached[u];if(J===H)return J.qP(),J.camera=null,delete this.attached[u],void this.rebuildInputCheck()}}removeByType(H){for(const u in this.attached){const J=this.attached[u];J.getClassName()===H&&(J.qP(),J.camera=null,delete this.attached[u],this.rebuildInputCheck())}}_addCheckInputs(H){const u=this.checkInputs;return()=>{u(),H()}}attachInput(H){this.attachedToElement&&H.attachControl(this.noPreventDefault)}attachElement(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){H=!h.c.ForceAttachControlToAlwaysPreventDefault&&H,this.attachedToElement=!0,this.noPreventDefault=H;for(const u in this.attached)this.attached[u].attachControl(H)}}detachElement(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const u in this.attached)this.attached[u].qP(),H&&(this.attached[u].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const H in this.attached){const u=this.attached[H];u.checkInputs&&(this.checkInputs=this._addCheckInputs(u.checkInputs.bind(u)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(H){const u={};for(const J in this.attached){const H=this.attached[J],O=U.d.Serialize(H);u[H.getClassName()]=O}H.inputsmgr=u}parse(H){const u=H.inputsmgr;if(u){this.clear();for(const H in u){const J=w[H];if(J){const O=u[H],h=U.d.Parse((()=>new J),O,null);this.add(h)}}}else for(const J in this.attached){const u=w[this.attached[J].getClassName()];if(u){const O=U.d.Parse((()=>new u),H,null);this.remove(this.attached[J]),this.add(O)}}}}},13946:(H,u,J)=>{"use strict";J.d(u,{b:()=>L});var O=J(12324),U=J(12329),h=J(12338),w=J(12811),g=J(13950),B=J(12616),b=J(12171);class d{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(H){H=b.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.ZH(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((u=>{const J=u.event;if(!J.metaKey)if(u.type===B.c.KEYDOWN){if(-1!==this.keysUp.indexOf(J.keyCode)||-1!==this.keysDown.indexOf(J.keyCode)||-1!==this.keysLeft.indexOf(J.keyCode)||-1!==this.keysRight.indexOf(J.keyCode)||-1!==this.keysUpward.indexOf(J.keyCode)||-1!==this.keysDownward.indexOf(J.keyCode)||-1!==this.keysRotateLeft.indexOf(J.keyCode)||-1!==this.keysRotateRight.indexOf(J.keyCode)||-1!==this.keysRotateUp.indexOf(J.keyCode)||-1!==this.keysRotateDown.indexOf(J.keyCode)){-1===this._keys.indexOf(J.keyCode)&&this._keys.push(J.keyCode),H||J.preventDefault()}}else if(-1!==this.keysUp.indexOf(J.keyCode)||-1!==this.keysDown.indexOf(J.keyCode)||-1!==this.keysLeft.indexOf(J.keyCode)||-1!==this.keysRight.indexOf(J.keyCode)||-1!==this.keysUpward.indexOf(J.keyCode)||-1!==this.keysDownward.indexOf(J.keyCode)||-1!==this.keysRotateLeft.indexOf(J.keyCode)||-1!==this.keysRotateRight.indexOf(J.keyCode)||-1!==this.keysRotateUp.indexOf(J.keyCode)||-1!==this.keysRotateDown.indexOf(J.keyCode)){const u=this._keys.indexOf(J.keyCode);u>=0&&this._keys.splice(u,1),H||J.preventDefault()}})))}qP(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const H=this.camera;for(let u=0;u<this._keys.length;u++){const J=this._keys[u],O=H._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(J)?H._localDirection.kg(-O,0,0):-1!==this.keysUp.indexOf(J)?H._localDirection.kg(0,0,O):-1!==this.keysRight.indexOf(J)?H._localDirection.kg(O,0,0):-1!==this.keysDown.indexOf(J)?H._localDirection.kg(0,0,-O):-1!==this.keysUpward.indexOf(J)?H._localDirection.kg(0,O,0):-1!==this.keysDownward.indexOf(J)?H._localDirection.kg(0,-O,0):-1!==this.keysRotateLeft.indexOf(J)?(H._localDirection.kg(0,0,0),H.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(J)?(H._localDirection.kg(0,0,0),H.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(J)?(H._localDirection.kg(0,0,0),H.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(J)&&(H._localDirection.kg(0,0,0),H.cameraRotation.x+=this._getLocalRotation()),H.ZH().useRightHandedSystem&&(H._localDirection.z*=-1),H.getViewMatrix().invertToRef(H._cameraTransformMatrix),h.lu.TransformNormalToRef(H._localDirection,H._cameraTransformMatrix,H._transformedDirection),H.cameraDirection.addInPlace(H._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const H=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*H}}(0,O.c)([(0,U.I)()],d.prototype,"keysUp",void 0),(0,O.c)([(0,U.I)()],d.prototype,"keysUpward",void 0),(0,O.c)([(0,U.I)()],d.prototype,"keysDown",void 0),(0,O.c)([(0,U.I)()],d.prototype,"keysDownward",void 0),(0,O.c)([(0,U.I)()],d.prototype,"keysLeft",void 0),(0,O.c)([(0,U.I)()],d.prototype,"keysRight",void 0),(0,O.c)([(0,U.I)()],d.prototype,"rotationSpeed",void 0),(0,O.c)([(0,U.I)()],d.prototype,"keysRotateLeft",void 0),(0,O.c)([(0,U.I)()],d.prototype,"keysRotateRight",void 0),(0,O.c)([(0,U.I)()],d.prototype,"keysRotateUp",void 0),(0,O.c)([(0,U.I)()],d.prototype,"keysRotateDown",void 0),g.b.FreeCameraKeyboardMoveInput=d;var G=J(12175),P=J(12608);class mH{constructor(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=H,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new G.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(H){H=b.Tools.BackCompatCameraNoPreventDefault(arguments);const u=this.camera.getEngine(),J=u.getInputElement();this._pointerInput||(this._pointerInput=O=>{const U=O.event,h="touch"===U.pointerType;if(!this.touchEnabled&&h)return;if(O.type!==P.d.POINTERMOVE&&-1===this.buttons.indexOf(U.button))return;const w=U.target;if(O.type===P.d.POINTERDOWN){if(h&&-1!==this._activePointerId||!h&&-1!==this._currentActiveButton)return;this._activePointerId=U.pointerId;try{null===w||void 0===w||w.setPointerCapture(U.pointerId)}catch(g){}-1===this._currentActiveButton&&(this._currentActiveButton=U.button),this._previousPosition={x:U.clientX,y:U.clientY},H||(U.preventDefault(),J&&J.focus()),u.isPointerLock&&this._onMouseMove&&this._onMouseMove(O.event)}else if(O.type===P.d.POINTERUP){if(h&&this._activePointerId!==U.pointerId||!h&&this._currentActiveButton!==U.button)return;try{null===w||void 0===w||w.releasePointerCapture(U.pointerId)}catch(g){}this._currentActiveButton=-1,this._previousPosition=null,H||U.preventDefault(),this._activePointerId=-1}else if(O.type===P.d.POINTERMOVE&&(this._activePointerId===U.pointerId||!h))if(u.isPointerLock&&this._onMouseMove)this._onMouseMove(O.event);else if(this._previousPosition){const u=this.camera._calculateHandednessMultiplier(),J=(U.clientX-this._previousPosition.x)*u,O=U.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=J/this.angularSensibility,this.camera.cameraRotation.x+=O/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:J,offsetY:O}),this._previousPosition={x:U.clientX,y:U.clientY},H||U.preventDefault()}}),this._onMouseMove=J=>{if(!u.isPointerLock)return;const O=this.camera._calculateHandednessMultiplier(),U=J.movementX*O;this.camera.cameraRotation.y+=U/this.angularSensibility;const h=J.movementY;this.camera.cameraRotation.x+=h/this.angularSensibility,this._previousPosition=null,H||J.preventDefault()},this._observer=this.camera.ZH()._inputManager._addCameraPointerObserver(this._pointerInput,P.d.POINTERDOWN|P.d.POINTERUP|P.d.POINTERMOVE),J&&(this._contextMenuBind=H=>this.onContextMenu(H),J.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(H){H.preventDefault()}qP(){if(this._observer){if(this.camera.ZH()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const H=this.camera.getEngine().getInputElement();H&&H.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,O.c)([(0,U.I)()],mH.prototype,"buttons",void 0),(0,O.c)([(0,U.I)()],mH.prototype,"angularSensibility",void 0),g.b.FreeCameraMouseInput=mH;var l,r=J(12621);class p{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new G.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(H){H=b.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=u=>{if(u.type!==P.d.POINTERWHEEL)return;const J=u.event,O=J.deltaMode===r.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*O*J.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*O*J.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*O*J.deltaZ/this._normalize,J.preventDefault&&(H||J.preventDefault())},this._observer=this.camera.ZH()._inputManager._addCameraPointerObserver(this._wheel,P.d.POINTERWHEEL)}qP(){this._observer&&(this.camera.ZH()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,O.c)([(0,U.I)()],p.prototype,"wheelPrecisionX",void 0),(0,O.c)([(0,U.I)()],p.prototype,"wheelPrecisionY",void 0),(0,O.c)([(0,U.I)()],p.prototype,"wheelPrecisionZ",void 0),function(H){H[H.MoveRelative=0]="MoveRelative",H[H.RotateRelative=1]="RotateRelative",H[H.MoveScene=2]="MoveScene"}(l||(l={}));class a extends p{constructor(){super(...arguments),this._moveRelative=h.lu.Zero(),this._rotateRelative=h.lu.Zero(),this._moveScene=h.lu.Zero(),this._wheelXAction=l.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=l.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(H){null===H&&this._wheelXAction!==l.MoveRelative||(this._wheelXAction=l.MoveRelative,this._wheelXActionCoordinate=H)}get wheelXMoveRelative(){return this._wheelXAction!==l.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(H){null===H&&this._wheelYAction!==l.MoveRelative||(this._wheelYAction=l.MoveRelative,this._wheelYActionCoordinate=H)}get wheelYMoveRelative(){return this._wheelYAction!==l.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(H){null===H&&this._wheelZAction!==l.MoveRelative||(this._wheelZAction=l.MoveRelative,this._wheelZActionCoordinate=H)}get wheelZMoveRelative(){return this._wheelZAction!==l.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(H){null===H&&this._wheelXAction!==l.RotateRelative||(this._wheelXAction=l.RotateRelative,this._wheelXActionCoordinate=H)}get wheelXRotateRelative(){return this._wheelXAction!==l.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(H){null===H&&this._wheelYAction!==l.RotateRelative||(this._wheelYAction=l.RotateRelative,this._wheelYActionCoordinate=H)}get wheelYRotateRelative(){return this._wheelYAction!==l.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(H){null===H&&this._wheelZAction!==l.RotateRelative||(this._wheelZAction=l.RotateRelative,this._wheelZActionCoordinate=H)}get wheelZRotateRelative(){return this._wheelZAction!==l.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(H){null===H&&this._wheelXAction!==l.MoveScene||(this._wheelXAction=l.MoveScene,this._wheelXActionCoordinate=H)}get wheelXMoveScene(){return this._wheelXAction!==l.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(H){null===H&&this._wheelYAction!==l.MoveScene||(this._wheelYAction=l.MoveScene,this._wheelYActionCoordinate=H)}get wheelYMoveScene(){return this._wheelYAction!==l.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(H){null===H&&this._wheelZAction!==l.MoveScene||(this._wheelZAction=l.MoveScene,this._wheelZActionCoordinate=H)}get wheelZMoveScene(){return this._wheelZAction!==l.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.jg(0),this._rotateRelative.jg(0),this._moveScene.jg(0),this._updateCamera(),this.camera.ZH().useRightHandedSystem&&(this._moveRelative.z*=-1);const H=h.Matrix.Zero();this.camera.getViewMatrix().invertToRef(H);const u=h.lu.Zero();h.lu.TransformNormalToRef(this._moveRelative,H,u),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(u),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(H,u,J){if(0===H)return;if(null===u||null===J)return;let O=null;switch(u){case l.MoveRelative:O=this._moveRelative;break;case l.RotateRelative:O=this._rotateRelative;break;case l.MoveScene:O=this._moveScene}switch(J){case 0:O.set(H,0,0);break;case 1:O.set(0,H,0);break;case 2:O.set(0,0,H)}}}(0,O.c)([(0,U.I)()],a.prototype,"wheelXMoveRelative",null),(0,O.c)([(0,U.I)()],a.prototype,"wheelYMoveRelative",null),(0,O.c)([(0,U.I)()],a.prototype,"wheelZMoveRelative",null),(0,O.c)([(0,U.I)()],a.prototype,"wheelXRotateRelative",null),(0,O.c)([(0,U.I)()],a.prototype,"wheelYRotateRelative",null),(0,O.c)([(0,U.I)()],a.prototype,"wheelZRotateRelative",null),(0,O.c)([(0,U.I)()],a.prototype,"wheelXMoveScene",null),(0,O.c)([(0,U.I)()],a.prototype,"wheelYMoveScene",null),(0,O.c)([(0,U.I)()],a.prototype,"wheelZMoveScene",null),g.b.FreeCameraMouseWheelInput=a;class k{constructor(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=H,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=b.Tools.IsSafari()}attachControl(H){H=b.Tools.BackCompatCameraNoPreventDefault(arguments);let u=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=J=>{const O=J.event,U="mouse"===O.pointerType||this._isSafari&&"undefined"===typeof O.pointerType;if(this.allowMouse||!U)if(J.type===P.d.POINTERDOWN){if(H||O.preventDefault(),this._pointerPressed.push(O.pointerId),1!==this._pointerPressed.length)return;u={x:O.clientX,y:O.clientY}}else if(J.type===P.d.POINTERUP){H||O.preventDefault();const J=this._pointerPressed.indexOf(O.pointerId);if(-1===J)return;if(this._pointerPressed.splice(J,1),0!=J)return;u=null,this._offsetX=null,this._offsetY=null}else if(J.type===P.d.POINTERMOVE){if(H||O.preventDefault(),!u)return;if(0!=this._pointerPressed.indexOf(O.pointerId))return;this._offsetX=O.clientX-u.x,this._offsetY=-(O.clientY-u.y)}}),this._observer=this.camera.ZH()._inputManager._addCameraPointerObserver(this._pointerInput,P.d.POINTERDOWN|P.d.POINTERUP|P.d.POINTERMOVE),this._onLostFocus){const H=this.camera.getEngine().getInputElement();H&&H.addEventListener("blur",this._onLostFocus)}}qP(){if(this._pointerInput){if(this._observer&&(this.camera.ZH()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const H=this.camera.getEngine().getInputElement();H&&H.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const H=this.camera,u=H._calculateHandednessMultiplier();H.cameraRotation.y=u*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)H.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const u=H._computeLocalCameraSpeed(),J=new h.lu(0,0,0!==this.touchMoveSensibility?u*this._offsetY/this.touchMoveSensibility:0);h.Matrix.RotationYawPitchRollToRef(H.rotation.y,H.rotation.x,0,H._cameraRotationMatrix),H.cameraDirection.addInPlace(h.lu.TransformCoordinates(J,H._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,O.c)([(0,U.I)()],k.prototype,"touchAngularSensibility",void 0),(0,O.c)([(0,U.I)()],k.prototype,"touchMoveSensibility",void 0),g.b.FreeCameraTouchInput=k;class C extends g.c{constructor(H){super(H),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new d),this}addMouse(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new mH(H),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new a,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new k),this}clear(){super.clear(),this._mouseInput=null}}var j=J(12304),M=J(12247);class L extends w.e{get angularSensibility(){const H=this.inputs.attached.mouse;return H?H.angularSensibility:0}set angularSensibility(H){const u=this.inputs.attached.mouse;u&&(u.angularSensibility=H)}get keysUp(){const H=this.inputs.attached.keyboard;return H?H.keysUp:[]}set keysUp(H){const u=this.inputs.attached.keyboard;u&&(u.keysUp=H)}get keysUpward(){const H=this.inputs.attached.keyboard;return H?H.keysUpward:[]}set keysUpward(H){const u=this.inputs.attached.keyboard;u&&(u.keysUpward=H)}get keysDown(){const H=this.inputs.attached.keyboard;return H?H.keysDown:[]}set keysDown(H){const u=this.inputs.attached.keyboard;u&&(u.keysDown=H)}get keysDownward(){const H=this.inputs.attached.keyboard;return H?H.keysDownward:[]}set keysDownward(H){const u=this.inputs.attached.keyboard;u&&(u.keysDownward=H)}get keysLeft(){const H=this.inputs.attached.keyboard;return H?H.keysLeft:[]}set keysLeft(H){const u=this.inputs.attached.keyboard;u&&(u.keysLeft=H)}get keysRight(){const H=this.inputs.attached.keyboard;return H?H.keysRight:[]}set keysRight(H){const u=this.inputs.attached.keyboard;u&&(u.keysRight=H)}get keysRotateLeft(){const H=this.inputs.attached.keyboard;return H?H.keysRotateLeft:[]}set keysRotateLeft(H){const u=this.inputs.attached.keyboard;u&&(u.keysRotateLeft=H)}get keysRotateRight(){const H=this.inputs.attached.keyboard;return H?H.keysRotateRight:[]}set keysRotateRight(H){const u=this.inputs.attached.keyboard;u&&(u.keysRotateRight=H)}get keysRotateUp(){const H=this.inputs.attached.keyboard;return H?H.keysRotateUp:[]}set keysRotateUp(H){const u=this.inputs.attached.keyboard;u&&(u.keysRotateUp=H)}get keysRotateDown(){const H=this.inputs.attached.keyboard;return H?H.keysRotateDown:[]}set keysRotateDown(H){const u=this.inputs.attached.keyboard;u&&(u.keysRotateDown=H)}constructor(H,u,J){var O;super(H,u,J,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),O=this,this.ellipsoid=new h.lu(.5,1,.5),this.ellipsoidOffset=new h.lu(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=h.lu.Zero(),this._diffPosition=h.lu.Zero(),this._newPosition=h.lu.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;O._newPosition.O(u),O._newPosition.subtractToRef(O._oldPosition,O._diffPosition),O._diffPosition.length()>M.d.CollisionsEpsilon&&(O.position.addToRef(O._diffPosition,O._deferredPositionUpdate),O._deferOnly?O._deferredUpdated=!0:O.position.O(O._deferredPositionUpdate),O.Rl&&J&&O.Rl(J))},this.inputs=new C(this),this.inputs.addKeyboard().addMouse()}attachControl(H,u){u=b.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(u)}qP(){this.inputs.detachElement(),this.cameraDirection=new h.lu(0,0,0),this.cameraRotation=new h.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(H){this._collisionMask=isNaN(H)?-1:H}_collideWithWorld(H){let u;u=this.parent?h.lu.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,u.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const J=this.ZH().collisionCoordinator;this._collider||(this._collider=J.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let O=H;this.applyGravity&&(O=H.add(this.ZH().gravity)),J.getNewPosition(this._oldPosition,O,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=h.lu.Zero(),this._transformedDirection=h.lu.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(H){this._needMoveForGravity=H}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.ZH().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"qg"}}(0,O.c)([(0,U.G)()],L.prototype,"ellipsoid",void 0),(0,O.c)([(0,U.G)()],L.prototype,"ellipsoidOffset",void 0),(0,O.c)([(0,U.I)()],L.prototype,"checkCollisions",void 0),(0,O.c)([(0,U.I)()],L.prototype,"applyGravity",void 0),(0,j.f)("BABYLON.FreeCamera",L)},14522:(H,u,J)=>{"use strict";J.d(u,{d:()=>h});var O=J(12432),U=J(14531);class h{constructor(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=J,this.pP=[],this._maxBlockCapacity=u||64,this._selectionContent=new O.e(1024),this._creationFunc=H}update(H,u,J){U.b._CreateBlocks(H,u,J,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}MG(H){for(let u=0;u<this.TG.length;u++){this.TG[u].addEntry(H)}}jG(H){for(let u=0;u<this.TG.length;u++){this.TG[u].removeEntry(H)}}select(H,u){this._selectionContent.reset();for(let J=0;J<this.TG.length;J++){this.TG[J].select(H,this._selectionContent,u)}return u?this._selectionContent.concat(this.pP):this._selectionContent.concatWithNoDuplicate(this.pP),this._selectionContent}intersects(H,u,J){this._selectionContent.reset();for(let O=0;O<this.TG.length;O++){this.TG[O].intersects(H,u,this._selectionContent,J)}return J?this._selectionContent.concat(this.pP):this._selectionContent.concatWithNoDuplicate(this.pP),this._selectionContent}intersectsRay(H){this._selectionContent.reset();for(let u=0;u<this.TG.length;u++){this.TG[u].intersectsRay(H,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.pP),this._selectionContent}}h.CreationFuncForMeshes=(H,u)=>{const J=H.getBoundingInfo();!H.isBlocked&&J.boundingBox.intersectsMinMax(u.MP,u.LP)&&u.entries.push(H)},h.CreationFuncForSubMeshes=(H,u)=>{H.getBoundingInfo().boundingBox.intersectsMinMax(u.MP,u.LP)&&u.entries.push(H)}},14531:(H,u,J)=>{"use strict";J.d(u,{b:()=>h});var O=J(12338),U=J(12664);class h{constructor(H,u,J,O,U,h){this.entries=[],this.ZP=new Array,this._capacity=J,this._depth=O,this._maxDepth=U,this._creationFunc=h,this._minPoint=H,this._maxPoint=u,this.ZP.push(H.clone()),this.ZP.push(u.clone()),this.ZP.push(H.clone()),this.ZP[2].x=u.x,this.ZP.push(H.clone()),this.ZP[3].y=u.y,this.ZP.push(H.clone()),this.ZP[4].z=u.z,this.ZP.push(u.clone()),this.ZP[5].z=H.z,this.ZP.push(u.clone()),this.ZP[6].x=H.x,this.ZP.push(u.clone()),this.ZP[7].y=H.y}get bJ(){return this._capacity}get MP(){return this._minPoint}get LP(){return this._maxPoint}addEntry(H){if(this.TG)for(let u=0;u<this.TG.length;u++){this.TG[u].addEntry(H)}else this._creationFunc(H,this),this.entries.length>this.bJ&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(H){if(this.TG){for(let u=0;u<this.TG.length;u++){this.TG[u].removeEntry(H)}return}const u=this.entries.indexOf(H);u>-1&&this.entries.splice(u,1)}addEntries(H){for(let u=0;u<H.length;u++){const J=H[u];this.addEntry(J)}}select(H,u,J){if(U.d.IsInFrustum(this.ZP,H)){if(this.TG){for(let O=0;O<this.TG.length;O++){this.TG[O].select(H,u,J)}return}J?u.concat(this.entries):u.concatWithNoDuplicate(this.entries)}}intersects(H,u,J,O){if(U.d.IntersectsSphere(this._minPoint,this._maxPoint,H,u)){if(this.TG){for(let U=0;U<this.TG.length;U++){this.TG[U].intersects(H,u,J,O)}return}O?J.concat(this.entries):J.concatWithNoDuplicate(this.entries)}}intersectsRay(H,u){if(H.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.TG){for(let J=0;J<this.TG.length;J++){this.TG[J].intersectsRay(H,u)}return}u.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){h._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(H,u,J,U,w,g,B,b){B.TG=new Array;const d=new O.lu((u.x-H.x)/2,(u.y-H.y)/2,(u.z-H.z)/2);for(let O=0;O<2;O++)for(let u=0;u<2;u++)for(let G=0;G<2;G++){const P=H.add(d.multiplyByFloats(O,u,G)),mH=H.add(d.multiplyByFloats(O+1,u+1,G+1)),l=new h(P,mH,U,w+1,g,b);l.addEntries(J),B.TG.push(l)}}}},14537:(H,u,J)=>{"use strict";J.d(u,{b:()=>d});var O=J(12568),U=J(12338),h=J(12741),w=J(13711),g=J(12606),B=J(14522),b=J(12203);O.d.prototype.createOrUpdateSelectionOctree=function(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,J=this._getComponent(g.d.NAME_OCTREE);J||(J=new d(this),this.o(J)),this.lP||(this.lP=new B.d(B.d.CreationFuncForMeshes,H,u));const O=this.getWorldExtends();return this.lP.update(O.min,O.max,this.meshes),this.lP},Object.defineProperty(O.d.prototype,"selectionOctree",{get:function(){return this.lP},enumerable:!0,configurable:!0}),h.c.prototype.createOrUpdateSubmeshesOctree=function(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const J=this.ZH();let O=J._getComponent(g.d.NAME_OCTREE);O||(O=new d(J),J.o(O)),this._submeshesOctree||(this._submeshesOctree=new B.d(B.d.CreationFuncForSubMeshes,H,u)),this.dg(!0);const U=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(U.minimumWorld,U.maximumWorld,this.mg),this._submeshesOctree};class d{constructor(H){this.name=g.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new w.d(U.lu.Zero(),new U.lu(1,1,1)),(H=H||b.e.LastCreatedScene)&&(this.pu=H,this.pu.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.pu.getActiveSubMeshCandidates=H=>this.getActiveSubMeshCandidates(H),this.pu.getCollidingSubMeshCandidates=(H,u)=>this.getCollidingSubMeshCandidates(H,u),this.pu.getIntersectingSubMeshCandidates=(H,u)=>this.getIntersectingSubMeshCandidates(H,u))}register(){this.pu.onMeshRemovedObservable.add((H=>{const u=this.pu.selectionOctree;if(void 0!==u&&null!==u){const J=u.pP.indexOf(H);-1!==J&&u.pP.splice(J,1)}})),this.pu.onMeshImportedObservable.add((H=>{const u=this.pu.selectionOctree;void 0!==u&&null!==u&&u.MG(H)}))}getActiveMeshCandidates(){var H;return(null===(H=this.pu.lP)||void 0===H?void 0:H.select(this.pu.frustumPlanes))||this.pu._getDefaultMeshCandidates()}getActiveSubMeshCandidates(H){if(H._submeshesOctree&&H.useOctreeForRenderingSelection){return H._submeshesOctree.select(this.pu.frustumPlanes)}return this.pu._getDefaultSubMeshCandidates(H)}getIntersectingSubMeshCandidates(H,u){if(H._submeshesOctree&&H.useOctreeForPicking){w.d.TransformToRef(u,H.getWorldMatrix(),this._tempRay);return H._submeshesOctree.intersectsRay(this._tempRay)}return this.pu._getDefaultSubMeshCandidates(H)}getCollidingSubMeshCandidates(H,u){if(H._submeshesOctree&&H.useOctreeForCollisions){const J=u._velocityWorldLength+Math.max(u._radius.x,u._radius.y,u._radius.z);return H._submeshesOctree.intersects(u._basePointWorld,J)}return this.pu._getDefaultSubMeshCandidates(H)}rebuild(){}dispose(){}}},13711:(H,u,J)=>{"use strict";J.d(u,{d:()=>mH});var O=J(12568),U=J(12774),h=J(12343),w=J(12338),g=J(12345),B=J(12655),b=J(12604),d=J(12203),G=J(12625);const P={internalPickerForMesh:void 0};class mH{constructor(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.d;this.origin=H,this.direction=u,this.length=J,this.epsilon=O}clone(){return new mH(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const O=mH._TmpVector3[0].kg(H.x-J,H.y-J,H.z-J),U=mH._TmpVector3[1].kg(u.x+J,u.y+J,u.z+J);let h,w,g,B,b=0,d=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<O.x||this.origin.x>U.x)return!1}else if(h=1/this.direction.x,w=(O.x-this.origin.x)*h,g=(U.x-this.origin.x)*h,g===-1/0&&(g=1/0),w>g&&(B=w,w=g,g=B),b=Math.max(w,b),d=Math.min(g,d),b>d)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<O.y||this.origin.y>U.y)return!1}else if(h=1/this.direction.y,w=(O.y-this.origin.y)*h,g=(U.y-this.origin.y)*h,g===-1/0&&(g=1/0),w>g&&(B=w,w=g,g=B),b=Math.max(w,b),d=Math.min(g,d),b>d)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<O.z||this.origin.z>U.z)return!1}else if(h=1/this.direction.z,w=(O.z-this.origin.z)*h,g=(U.z-this.origin.z)*h,g===-1/0&&(g=1/0),w>g&&(B=w,w=g,g=B),b=Math.max(w,b),d=Math.min(g,d),b>d)return!1;return!0}intersectsBox(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(H.minimum,H.maximum,u)}intersectsSphere(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const J=H.center.x-this.origin.x,O=H.center.y-this.origin.y,U=H.center.z-this.origin.z,h=J*J+O*O+U*U,w=H.radius+u,g=w*w;if(h<=g)return!0;const B=J*this.direction.x+O*this.direction.y+U*this.direction.z;if(B<0)return!1;return h-B*B<=g}intersectsTriangle(H,u,J){const O=mH._TmpVector3[0],U=mH._TmpVector3[1],h=mH._TmpVector3[2],g=mH._TmpVector3[3],b=mH._TmpVector3[4];u.subtractToRef(H,O),J.subtractToRef(H,U),w.lu.CrossToRef(this.direction,U,h);const d=w.lu.Dot(O,h);if(0===d)return null;const G=1/d;this.origin.subtractToRef(H,g);const P=w.lu.Dot(g,h)*G;if(P<-this.epsilon||P>1+this.epsilon)return null;w.lu.CrossToRef(g,O,b);const l=w.lu.Dot(this.direction,b)*G;if(l<-this.epsilon||P+l>1+this.epsilon)return null;const r=w.lu.Dot(U,b)*G;return r>this.length?null:new B.e(1-P-l,P,r)}intersectsPlane(H){let u;const J=w.lu.Dot(H.normal,this.direction);if(Math.abs(J)<9.99999997475243e-7)return null;{const O=w.lu.Dot(H.normal,this.origin);return u=(-H.d-O)/J,u<0?u<-9.99999997475243e-7?null:0:u}}intersectsAxis(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(H){case"y":{const H=(this.origin.y-u)/this.direction.y;return H>0?null:new w.lu(this.origin.x+this.direction.x*-H,u,this.origin.z+this.direction.z*-H)}case"x":{const H=(this.origin.x-u)/this.direction.x;return H>0?null:new w.lu(u,this.origin.y+this.direction.y*-H,this.origin.z+this.direction.z*-H)}case"z":{const H=(this.origin.z-u)/this.direction.z;return H>0?null:new w.lu(this.origin.x+this.direction.x*-H,this.origin.y+this.direction.y*-H,u)}default:return null}}intersectsMesh(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const g=w.TmpVectors.Matrix[0];return H.getWorldMatrix().invertToRef(g),this._tmpRay?mH.TransformToRef(this,g,this._tmpRay):this._tmpRay=mH.Transform(this,g),H.intersects(this._tmpRay,u,J,O,U,h)}intersectsMeshes(H,u,J){J?J.length=0:J=[];for(let O=0;O<H.length;O++){const U=this.intersectsMesh(H[O],u);U.hit&&J.push(U)}return J.sort(this._comparePickingInfo),J}_comparePickingInfo(H,u){return H.distance<u.distance?-1:H.distance>u.distance?1:0}intersectionSegment(H,u,J){const O=this.origin,U=w.TmpVectors.lu[0],h=w.TmpVectors.lu[1],g=w.TmpVectors.lu[2],B=w.TmpVectors.lu[3];u.subtractToRef(H,U),this.direction.scaleToRef(mH._Rayl,g),O.addToRef(g,h),H.subtractToRef(O,B);const b=w.lu.Dot(U,U),d=w.lu.Dot(U,g),G=w.lu.Dot(g,g),P=w.lu.Dot(U,B),l=w.lu.Dot(g,B),r=b*G-d*d;let p,a,k=r,C=r;r<mH._Smallnum?(p=0,k=1,a=l,C=G):(p=d*l-G*P,a=b*l-d*P,p<0?(p=0,a=l,C=G):p>k&&(p=k,a=l+d,C=G)),a<0?(a=0,-P<0?p=0:-P>b?p=k:(p=-P,k=b)):a>C&&(a=C,-P+d<0?p=0:-P+d>b?p=k:(p=-P+d,k=b));const j=Math.abs(p)<mH._Smallnum?0:p/k,M=Math.abs(a)<mH._Smallnum?0:a/C,L=w.TmpVectors.lu[4];g.scaleToRef(M,L);const Z=w.TmpVectors.lu[5];U.scaleToRef(j,Z),Z.addInPlace(B);const Y=w.TmpVectors.lu[6];Z.subtractToRef(L,Y);return M>0&&M<=this.length&&Y.lengthSquared()<J*J?Z.length():-1}update(H,u,J,O,U,h,g){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){mH._RayDistant||(mH._RayDistant=mH.Zero()),mH._RayDistant.unprojectRayToRef(H,u,J,O,w.Matrix.IdentityReadOnly,h,g);const B=w.TmpVectors.Matrix[0];U.invertToRef(B),mH.TransformToRef(mH._RayDistant,B,this)}else this.unprojectRayToRef(H,u,J,O,U,h,g);return this}static Zero(){return new mH(w.lu.Zero(),w.lu.Zero())}static CreateNew(H,u,J,O,U,h,w){return mH.Zero().update(H,u,J,O,U,h,w)}static CreateNewFromTo(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.Matrix.IdentityReadOnly;const O=new mH(new w.lu(0,0,0),new w.lu(0,0,0));return mH.CreateFromToToRef(H,u,O,J)}static CreateFromToToRef(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.Matrix.IdentityReadOnly;J.origin.O(H);const U=u.subtractToRef(H,J.direction),h=Math.sqrt(U.x*U.x+U.y*U.y+U.z*U.z);return J.length=h,J.direction.normalize(),mH.TransformToRef(J,O,J)}static Transform(H,u){const J=new mH(new w.lu(0,0,0),new w.lu(0,0,0));return mH.TransformToRef(H,u,J),J}static TransformToRef(H,u,J){w.lu.TransformCoordinatesToRef(H.origin,u,J.origin),w.lu.TransformNormalToRef(H.direction,u,J.direction),J.length=H.length,J.epsilon=H.epsilon;const O=J.direction,U=O.length();if(0!==U&&1!==U){const H=1/U;O.x*=H,O.y*=H,O.z*=H,J.length*=U}return J}unprojectRayToRef(H,u,J,O,U,h,g){const B=w.TmpVectors.Matrix[0];U.multiplyToRef(h,B),B.multiplyToRef(g,B),B.invert();const b=d.e.LastCreatedEngine,G=w.TmpVectors.lu[0];G.x=H/J*2-1,G.y=-(u/O*2-1),G.z=null!==b&&void 0!==b&&b.rh?1:null!==b&&void 0!==b&&b.isNDCHalfZRange?0:-1;const P=w.TmpVectors.lu[1].kg(G.x,G.y,1-1e-8),mH=w.TmpVectors.lu[2],l=w.TmpVectors.lu[3];w.lu._UnprojectFromInvertedMatrixToRef(G,B,mH),w.lu._UnprojectFromInvertedMatrixToRef(P,B,l),this.origin.O(mH),l.subtractToRef(mH,this.direction),this.direction.normalize()}}function l(H,u,J,O,U){let h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const w=mH.Zero();return r(H,u,J,O,w,U,h),w}function r(H,u,J,O,U,h){let g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const b=H.getEngine();if(!h&&!(h=H.activeCamera))return H;const d=h.viewport,G=b.getRenderHeight(),{x:P,y:mH,width:l,height:r}=d.toGlobal(b.getRenderWidth(),G),p=1/b.getHardwareScalingLevel();return u=u*p-P,J=J*p-(G-mH-r),U.update(u,J,l,r,O||w.Matrix.IdentityReadOnly,g?w.Matrix.IdentityReadOnly:h.getViewMatrix(),h.getProjectionMatrix(),B),H}function p(H,u,J,O,U){if(!b.b)return H;const h=H.getEngine();if(!U&&!(U=H.activeCamera))throw new Error("Active camera not set");const g=U.viewport,B=h.getRenderHeight(),{x:d,y:G,width:P,height:mH}=g.toGlobal(h.getRenderWidth(),B),l=w.Matrix.Identity(),r=1/h.getHardwareScalingLevel();return u=u*r-d,J=J*r-(B-G-mH),O.update(u,J,P,mH,l,l,U.getProjectionMatrix()),H}function a(H,u,J,O,U,h,w,g){const B=u(O,J.enableDistantPicking),b=J.intersects(B,U,w,h,O,g);return b&&b.hit?!U&&null!=H&&b.distance>=H.distance?null:b:null}function k(H,u,J,O,U,h){let g=null;const B=!!(H.activeCameras&&H.activeCameras.length>1&&H.cameraToUseForPointers!==H.activeCamera),d=H.cameraToUseForPointers||H.activeCamera,G=P.internalPickerForMesh||a;for(let b=0;b<H.meshes.length;b++){const P=H.meshes[b];if(J){if(!J(P,-1))continue}else if(!P.isEnabled()||!P.isVisible||!P.DB)continue;const mH=B&&P.isWorldMatrixCameraDependent(),l=P.dg(mH,d);if(P.hasThinInstances&&P.Yd){const H=G(g,u,P,l,!0,!0,h);if(H){if(U)return H;const B=w.TmpVectors.Matrix[1],b=P.thinInstanceGetWorldMatrices();for(let H=0;H<b.length;H++){if(J&&!J(P,H))continue;b[H].multiplyToRef(l,B);const w=G(g,u,P,B,O,U,h,!0);if(w&&(g=w,g.thinInstanceIndex=H,O))return g}}}else{const H=G(g,u,P,l,O,U,h);if(H&&(g=H,O))return g}}return g||new b.b}function C(H,u,J,O){if(!b.b)return null;const U=[],h=!!(H.activeCameras&&H.activeCameras.length>1&&H.cameraToUseForPointers!==H.activeCamera),g=H.cameraToUseForPointers||H.activeCamera,B=P.internalPickerForMesh||a;for(let b=0;b<H.meshes.length;b++){const d=H.meshes[b];if(J){if(!J(d,-1))continue}else if(!d.isEnabled()||!d.isVisible||!d.DB)continue;const G=h&&d.isWorldMatrixCameraDependent(),P=d.dg(G,g);if(d.hasThinInstances&&d.Yd){if(B(null,u,d,P,!0,!0,O)){const H=w.TmpVectors.Matrix[1],h=d.thinInstanceGetWorldMatrices();for(let w=0;w<h.length;w++){if(J&&!J(d,w))continue;h[w].multiplyToRef(P,H);const g=B(null,u,d,H,!1,!1,O,!0);g&&(g.thinInstanceIndex=w,U.push(g))}}}else{const H=B(null,u,d,P,!1,!1,O);H&&U.push(H)}}return U}function j(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,O=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0;O||(O=H.getWorldMatrix()),u.length=J,U?u.origin.O(U):u.origin.O(H.position);const h=w.TmpVectors.lu[2];h.set(0,0,H._scene.useRightHandedSystem?-1:1);const g=w.TmpVectors.lu[3];return w.lu.TransformNormalToRef(h,O,g),w.lu.NormalizeToRef(g,u.direction),u}var M,L;mH._TmpVector3=(0,g.b)(6,w.lu.Zero),mH._RayDistant=mH.Zero(),mH._Smallnum=1e-8,mH._Rayl=1e9,M=O.d,(L=U.c)&&(L.prototype.getForwardRay=function(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,u=arguments.length>1?arguments[1]:void 0,J=arguments.length>2?arguments[2]:void 0;return j(this,new mH(w.lu.Zero(),w.lu.Zero(),H),H,u,J)},L.prototype.getForwardRayToRef=function(H){return j(this,H,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),M&&(G.d._IsPickingAvailable=!0,M.prototype.createPickingRay=function(H,u,J,O){return l(this,H,u,J,O,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),O.d.prototype.createPickingRayToRef=function(H,u,J,O,U){return r(this,H,u,J,O,U,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},O.d.prototype.createPickingRayInCameraSpace=function(H,u,J){return function(H,u,J,O){const U=mH.Zero();return p(H,u,J,U,O),U}(this,H,u,J)},O.d.prototype.createPickingRayInCameraSpaceToRef=function(H,u,J,O){return p(this,H,u,J,O)},O.d.prototype.pickWithBoundingInfo=function(H,u,J,O,U){return function(H,u,J,O,U,h){if(!b.b)return null;const g=k(H,(O=>(H._tempPickingRay||(H._tempPickingRay=mH.Zero()),r(H,u,J,O,H._tempPickingRay,h||null),H._tempPickingRay)),O,U,!0);return g&&(g.ray=l(H,u,J,w.Matrix.Identity(),h||null)),g}(this,H,u,J,O,U)},O.d.prototype.PJ=function(H,u,J,O,U,h){return function(H,u,J,O,U,h,g){const B=k(H,((O,U)=>(H._tempPickingRay||(H._tempPickingRay=mH.Zero()),r(H,u,J,O,H._tempPickingRay,h||null,!1,U),H._tempPickingRay)),O,U,!1,g);return B&&(B.ray=l(H,u,J,w.Matrix.Identity(),h||null)),B}(this,H,u,J,O,U,h)},O.d.prototype.pickWithRay=function(H,u,J,O){return function(H,u,J,O,U){const h=k(H,(J=>(H._pickWithRayInverseMatrix||(H._pickWithRayInverseMatrix=w.Matrix.Identity()),J.invertToRef(H._pickWithRayInverseMatrix),H._cachedRayForTransform||(H._cachedRayForTransform=mH.Zero()),mH.TransformToRef(u,H._pickWithRayInverseMatrix,H._cachedRayForTransform),H._cachedRayForTransform)),J,O,!1,U);return h&&(h.ray=u),h}(this,H,u,J,O)},O.d.prototype.multiPick=function(H,u,J,O,U){return function(H,u,J,O,U,h){return C(H,(O=>l(H,u,J,O,U||null)),O,h)}(this,H,u,J,O,U)},O.d.prototype.multiPickWithRay=function(H,u,J){return function(H,u,J,O){return C(H,(J=>(H._pickWithRayInverseMatrix||(H._pickWithRayInverseMatrix=w.Matrix.Identity()),J.invertToRef(H._pickWithRayInverseMatrix),H._cachedRayForTransform||(H._cachedRayForTransform=mH.Zero()),mH.TransformToRef(u,H._pickWithRayInverseMatrix,H._cachedRayForTransform),H._cachedRayForTransform)),J,O)}(this,H,u,J)}},13995:(H,u,J)=>{"use strict";var O=J(12280),U=J(12185),h=J(12210),w=J(12306),g=J(12247),B=J(12290);g.d.prototype._partialLoadFile=function(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(H,(H=>{J[u]=H,J._internalCount++,6===J._internalCount&&O(J)}),void 0,void 0,!0,((H,u)=>{U&&H&&U(H.status+" "+H.statusText,u)}))},g.d.prototype._cascadeLoadFiles=function(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const U=[];U._internalCount=0;for(let h=0;h<6;h++)this._partialLoadFile(J[h],h,U,u,O)},g.d.prototype._cascadeLoadImgs=function(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5?arguments[5]:void 0;const w=[];w._internalCount=0;for(let g=0;g<6;g++)this._partialLoadImg(O[g],g,w,H,u,J,U,h)},g.d.prototype._partialLoadImg=function(H,u,J,O,U,g){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7?arguments[7]:void 0;const d=(0,w.c)();(0,h.p)(H,(H=>{J[u]=H,J._internalCount++,O&&O.removePendingData(d),6===J._internalCount&&g&&g(U,J)}),((H,u)=>{O&&O.removePendingData(d),B&&B(H,u)}),O?O.offlineProvider:null,b),O&&O.addPendingData(d)},g.d.prototype.createCubeTextureBase=function(H,u,J,h){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6?arguments[6]:void 0,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]&&arguments[8],P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,mH=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,l=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,r=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,p=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,a=arguments.length>14&&void 0!==arguments[14]&&arguments[14],k=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const C=l||new O.c(this,7);C.isCube=!0,C.url=H,C.generateMipMaps=!h,C._lodGenerationScale=P,C._lodGenerationOffset=mH,C._useSRGBBuffer=!!a&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!h),C!==l&&(C.label=H.substring(0,60)),this._doNotHandleContextLost||(C._extension=d,C._files=J,C._buffer=k);const j=H;this._transformTextureUrl&&!l&&(H=this._transformTextureUrl(H));const M=d??function(H){const u=H.split("?")[0],J=u.lastIndexOf(".");return J>-1?u.substring(J).toLowerCase():""}(H),L=(0,B.c)(M),Z=(H,u)=>{C.dispose(),g?g(H,u):H&&U.b.Warn(H)},Y=(O,g)=>{H===j?O&&Z(O.status+" "+O.statusText,g):(U.b.Warn(`Failed to load ${H}, falling back to the ${j}`),this.createCubeTextureBase(j,u,J,!!h,w,Z,b,d,G,P,mH,C,r,p,a,k))};if(L)L.then((O=>{const U=H=>{r&&r(C,H),O.loadCubeData(H,C,G,w,((H,u)=>{Z(H,u)}))};k?U(k):J&&6===J.length?O.supportCascades?this._cascadeLoadFiles(u,(H=>U(H.map((H=>new Uint8Array(H))))),J,Z):Z("Textures type does not support cascades."):this._loadFile(H,(H=>U(new Uint8Array(H))),void 0,void 0,!0,Y)}));else{if(!J||0===J.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(u,C,((H,u)=>{p&&p(H,u)}),J,Z)}return this._internalTexturesCache.push(C),C}},14545:(H,u,J)=>{"use strict";J(12185);var O=J(12452);J(12280),J(12419),J(12277),J(12507),J(12465);O.e},14011:(H,u,J)=>{"use strict";J.d(u,{d:()=>U});var O=J(12304);class U{constructor(H){this.value=this._toInt(H)}_toInt(H){return 0|H}add(H){return new U(this.value+H.value)}ru(H){return new U(this.value-H.value)}multiply(H){return new U(Math.imul(this.value,H.value))}divide(H){return new U(this.value/H.value)}getClassName(){return U.ClassName}equals(H){return this.value===H.value}static FromValue(H){return new U(H)}toString(){return this.value.toString()}}U.ClassName="FlowGraphInteger",(0,O.f)("FlowGraphInteger",U)},14027:(H,u,J)=>{"use strict";J.d(u,{c:()=>U,e:()=>h});var O=J(12338);class U{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.ih=H}get m(){return this.ih}transformVector(H){return this.transformVectorToRef(H,new O.Vector2)}transformVectorToRef(H,u){return u.x=H.x*this.ih[0]+H.y*this.ih[1],u.y=H.x*this.ih[2]+H.y*this.ih[3],u}Hg(){return this.toArray()}toArray(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let u=0;u<4;u++)H[u]=this.ih[u];return H}mO(H){for(let u=0;u<4;u++)this.ih[u]=H[u];return this}multiplyToRef(H,u){const J=H.ih,O=this.ih,U=u.ih;return U[0]=J[0]*O[0]+J[1]*O[2],U[1]=J[0]*O[1]+J[1]*O[3],U[2]=J[2]*O[0]+J[3]*O[2],U[3]=J[2]*O[1]+J[3]*O[3],u}multiply(H){return this.multiplyToRef(H,new U)}divideToRef(H,u){const J=this.ih,O=H.ih,U=u.ih;return U[0]=J[0]/O[0],U[1]=J[1]/O[1],U[2]=J[2]/O[2],U[3]=J[3]/O[3],u}divide(H){return this.divideToRef(H,new U)}addToRef(H,u){const J=this.ih,O=H.m,U=u.m;return U[0]=J[0]+O[0],U[1]=J[1]+O[1],U[2]=J[2]+O[2],U[3]=J[3]+O[3],u}add(H){return this.addToRef(H,new U)}subtractToRef(H,u){const J=this.ih,O=H.m,U=u.m;return U[0]=J[0]-O[0],U[1]=J[1]-O[1],U[2]=J[2]-O[2],U[3]=J[3]-O[3],u}ru(H){return this.subtractToRef(H,new U)}transpose(){const H=this.ih;return new U([H[0],H[2],H[1],H[3]])}determinant(){const H=this.ih;return H[0]*H[3]-H[1]*H[2]}inverse(){const H=this.determinant();if(0===H)throw new Error("Matrix is not invertible");const u=this.ih,J=1/H;return new U([u[3]*J,-u[1]*J,-u[2]*J,u[0]*J])}equals(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const J=this.ih,O=H.m;return 0===u?J[0]===O[0]&&J[1]===O[1]&&J[2]===O[2]&&J[3]===O[3]:Math.abs(J[0]-O[0])<u&&Math.abs(J[1]-O[1])<u&&Math.abs(J[2]-O[2])<u&&Math.abs(J[3]-O[3])<u}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.ih.join(", ")})`}}class h{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.ih=H}get m(){return this.ih}transformVector(H){return this.transformVectorToRef(H,new O.lu)}transformVectorToRef(H,u){const J=this.ih;return u.x=H.x*J[0]+H.y*J[1]+H.z*J[2],u.y=H.x*J[3]+H.y*J[4]+H.z*J[5],u.z=H.x*J[6]+H.y*J[7]+H.z*J[8],u}multiplyToRef(H,u){const J=H.ih,O=this.ih,U=u.m;return U[0]=J[0]*O[0]+J[1]*O[3]+J[2]*O[6],U[1]=J[0]*O[1]+J[1]*O[4]+J[2]*O[7],U[2]=J[0]*O[2]+J[1]*O[5]+J[2]*O[8],U[3]=J[3]*O[0]+J[4]*O[3]+J[5]*O[6],U[4]=J[3]*O[1]+J[4]*O[4]+J[5]*O[7],U[5]=J[3]*O[2]+J[4]*O[5]+J[5]*O[8],U[6]=J[6]*O[0]+J[7]*O[3]+J[8]*O[6],U[7]=J[6]*O[1]+J[7]*O[4]+J[8]*O[7],U[8]=J[6]*O[2]+J[7]*O[5]+J[8]*O[8],u}multiply(H){return this.multiplyToRef(H,new h)}divideToRef(H,u){const J=this.ih,O=H.m,U=u.m;return U[0]=J[0]/O[0],U[1]=J[1]/O[1],U[2]=J[2]/O[2],U[3]=J[3]/O[3],U[4]=J[4]/O[4],U[5]=J[5]/O[5],U[6]=J[6]/O[6],U[7]=J[7]/O[7],U[8]=J[8]/O[8],u}divide(H){return this.divideToRef(H,new h)}addToRef(H,u){const J=this.ih,O=H.m,U=u.m;return U[0]=J[0]+O[0],U[1]=J[1]+O[1],U[2]=J[2]+O[2],U[3]=J[3]+O[3],U[4]=J[4]+O[4],U[5]=J[5]+O[5],U[6]=J[6]+O[6],U[7]=J[7]+O[7],U[8]=J[8]+O[8],u}add(H){return this.addToRef(H,new h)}subtractToRef(H,u){const J=this.ih,O=H.m,U=u.m;return U[0]=J[0]-O[0],U[1]=J[1]-O[1],U[2]=J[2]-O[2],U[3]=J[3]-O[3],U[4]=J[4]-O[4],U[5]=J[5]-O[5],U[6]=J[6]-O[6],U[7]=J[7]-O[7],U[8]=J[8]-O[8],u}ru(H){return this.subtractToRef(H,new h)}toArray(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let u=0;u<9;u++)H[u]=this.ih[u];return H}Hg(){return this.toArray()}mO(H){for(let u=0;u<9;u++)this.ih[u]=H[u];return this}transpose(){const H=this.ih;return new h([H[0],H[3],H[6],H[1],H[4],H[7],H[2],H[5],H[8]])}determinant(){const H=this.ih;return H[0]*(H[4]*H[8]-H[5]*H[7])-H[1]*(H[3]*H[8]-H[5]*H[6])+H[2]*(H[3]*H[7]-H[4]*H[6])}inverse(){const H=this.determinant();if(0===H)throw new Error("Matrix is not invertible");const u=this.ih,J=1/H;return new h([(u[4]*u[8]-u[5]*u[7])*J,(u[2]*u[7]-u[1]*u[8])*J,(u[1]*u[5]-u[2]*u[4])*J,(u[5]*u[6]-u[3]*u[8])*J,(u[0]*u[8]-u[2]*u[6])*J,(u[2]*u[3]-u[0]*u[5])*J,(u[3]*u[7]-u[4]*u[6])*J,(u[1]*u[6]-u[0]*u[7])*J,(u[0]*u[4]-u[1]*u[3])*J])}equals(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const J=this.ih,O=H.m;return 0===u?J[0]===O[0]&&J[1]===O[1]&&J[2]===O[2]&&J[3]===O[3]&&J[4]===O[4]&&J[5]===O[5]&&J[6]===O[6]&&J[7]===O[7]&&J[8]===O[8]:Math.abs(J[0]-O[0])<u&&Math.abs(J[1]-O[1])<u&&Math.abs(J[2]-O[2])<u&&Math.abs(J[3]-O[3])<u&&Math.abs(J[4]-O[4])<u&&Math.abs(J[5]-O[5])<u&&Math.abs(J[6]-O[6])<u&&Math.abs(J[7]-O[7])<u&&Math.abs(J[8]-O[8])<u}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.ih.join(", ")})`}}},14033:(H,u,J)=>{"use strict";var O;function U(H,u,J,O){switch(u){case"Animation":return O?H.animations.find((H=>H.uniqueId===J))??null:H.animations[J]??null;case"AnimationGroup":return O?H.animationGroups.find((H=>H.uniqueId===J))??null:H.animationGroups[J]??null;case"Mesh":return O?H.meshes.find((H=>H.uniqueId===J))??null:H.meshes[J]??null;case"Material":return O?H.materials.find((H=>H.uniqueId===J))??null:H.materials[J]??null;case"eG":return O?H.cameras.find((H=>H.uniqueId===J))??null:H.cameras[J]??null;case"Light":return O?H.lights.find((H=>H.uniqueId===J))??null:H.lights[J]??null;default:return null}}J.d(u,{e:()=>U}),function(H){H.Animation="Animation",H.AnimationGroup="AnimationGroup",H.Mesh="Mesh",H.Material="Material",H.eG="eG",H.Light="Light"}(O||(O={}))},14061:(H,u,J)=>{"use strict";J.d(u,{d:()=>U});var O=J(14064);class U extends O.e{constructor(H,u){if(super(H),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),u)for(const J of u)this._eventsSignalOutputs[J]=this._registerSignalOutput(J+"Event")}_executeOnTick(H){}_startPendingTasks(H){H._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(H),this._resetAfterCanceled(H)),this._preparePendingTasks(H),H._addPendingBlock(this),this.out._activateSignal(H),H._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(H){H._deleteExecutionVariable(this,"_initialized"),H._removePendingBlock(this)}}},14041:(H,u,J)=>{"use strict";J.d(u,{b:()=>b});var O=J(12306),U=J(12304),h=J(14045),w=J(12175),g=J(14009);class B extends h.c{constructor(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:O.defaultValue,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(H,u,J),this.richType=O,this._defaultValue=U,this._optional=h,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new w.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(H){this._isDisabled!==H&&(this._isDisabled=H,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(H,u){u._getConnectionValue(this)!==H&&(u._setConnectionValue(this,H),this.onValueChangedObservable.notifyObservers(H))}resetToDefaultValue(H){H._setConnectionValue(this,this._defaultValue)}connectTo(H){this._isDisabled||super.connectTo(H)}_getValueOrDefault(H){const u=H._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(u):u}getValue(H){if(1===this.connectionType){H._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(H);const u=this._getValueOrDefault(H);return this._lastValue=u,this.richType.typeTransformer?this.richType.typeTransformer(u):u}const u=this.isConnected()?this._connectedPoint[0].getValue(H):this._getValueOrDefault(H);return this._lastValue=u,this.richType.typeTransformer?this.richType.typeTransformer(u):u}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(H),H.richType={},this.richType.serialize(H.richType),H.optional=this._optional,(0,g.e)("defaultValue",this._defaultValue,H)}}(0,U.f)("FlowGraphDataConnection",B);class b{constructor(H){var u;this.config=H,this.uniqueId=(0,O.c)(),this.name=(null===(u=this.config)||void 0===u?void 0:u.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(H){}registerDataInput(H,u,J){const O=new B(H,0,this,u,J);return this.dataInputs.push(O),O}registerDataOutput(H,u,J){const O=new B(H,1,this,u,J);return this.dataOutputs.push(O),O}getDataInput(H){return this.dataInputs.find((u=>u.name===H))}getDataOutput(H){return this.dataOutputs.find((u=>u.name===H))}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.e;if(H.uniqueId=this.uniqueId,H.config={},this.config){const J=this.config,O=Object.keys(J);for(const U of O)u(U,J[U],H.config)}H.dataInputs=[],H.dataOutputs=[],H.className=this.getClassName();for(const J of this.dataInputs){const u={};J.serialize(u),H.dataInputs.push(u)}for(const J of this.dataOutputs){const u={};J.serialize(u),H.dataOutputs.push(u)}}deserialize(H){}_log(H,u,J){var O;null===(O=H.logger)||void 0===O||O.addLogItem({action:u,lJ:J,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14045:(H,u,J)=>{"use strict";J.d(u,{c:()=>h});var O,U=J(12306);!function(H){H[H.Input=0]="Input",H[H.Output=1]="Output"}(O||(O={}));class h{constructor(H,u,J){this._ownerBlock=J,this._connectedPoint=[],this.uniqueId=(0,U.c)(),this.connectedPointIds=[],this.name=H,this._connectionType=u}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(H){if(this._connectionType===H._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||H._isSingularConnection()&&H._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(H),H._connectedPoint.push(this)}disconnectFrom(H){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const J=this._connectedPoint.indexOf(H),O=H._connectedPoint.indexOf(this);-1!==J&&-1!==O&&(u&&this._connectedPoint.splice(J,1),H._connectedPoint.splice(O,1))}disconnectFromAll(){for(const H of this._connectedPoint)this.disconnectFrom(H,!1);this._connectedPoint.length=0}dispose(){for(const H of this._connectedPoint)this.disconnectFrom(H)}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};H.uniqueId=this.uniqueId,H.name=this.name,H._connectionType=this._connectionType,H.connectedPointIds=[],H.className=this.getClassName();for(const u of this._connectedPoint)H.connectedPointIds.push(u.uniqueId)}getClassName(){return"FGConnection"}deserialize(H){this.uniqueId=H.uniqueId,this.name=H.name,this._connectionType=H._connectionType,this.connectedPointIds=H.connectedPointIds}}},14007:(H,u,J)=>{"use strict";J.d(u,{b:()=>C});var O,U=J(12175),h=J(12324),w=J(12329),g=J(12306),B=J(14009),b=J(14033),d=J(12185);!function(H){H.ExecuteBlock="ExecuteBlock",H.ExecuteEvent="ExecuteEvent",H.TriggerConnection="TriggerConnection",H.ContextVariableSet="ContextVariableSet",H.GlobalVariableSet="GlobalVariableSet",H.GlobalVariableDelete="GlobalVariableDelete",H.GlobalVariableGet="GlobalVariableGet",H.AddConnection="AddConnection",H.GetConnectionValue="GetConnectionValue",H.SetConnectionValue="SetConnectionValue",H.ActivateSignal="ActivateSignal",H.ContextVariableGet="ContextVariableGet"}(O||(O={}));class G{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(H){if(H.time||(H.time=Date.now()),this.log.push(H),this.logToConsole){var u;const J=null===(u=H.lJ)||void 0===u?void 0:u.value;"object"===typeof J&&J.getClassName?d.b.Log(`[FGLog] ${H.className}:${H.uniqueId.split("-")[0]} ${H.action} - ${JSON.stringify(J.getClassName())}: ${J.toString()}`):d.b.Log(`[FGLog] ${H.className}:${H.uniqueId.split("-")[0]} ${H.action} - ${JSON.stringify(H.lJ)}`)}}getItemsOfType(H){return this.log.filter((u=>u.action===H))}}class P{get enableLogging(){return this._enableLogging}set enableLogging(H){this._enableLogging!==H&&(this._enableLogging=H,this._enableLogging?(this.logger=new G,this.logger.logToConsole=!0):this.logger=null)}constructor(H){this.uniqueId=(0,g.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new U.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=H,this.assetsContext=H.assetsContext??H.pu}hasVariable(H){return H in this._userVariables}setVariable(H,u){var J;this._userVariables[H]=u,null===(J=this.logger)||void 0===J||J.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",lJ:{name:H,value:u}})}getAsset(H,u){return(0,b.e)(this.assetsContext,H,u)}getVariable(H){var u;return null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",lJ:{name:H,value:this._userVariables[H]}}),this._userVariables[H]}get userVariables(){return this._userVariables}ZH(){return this._configuration.pu}_getUniqueIdPrefixedName(H,u){return`${H.uniqueId}_${u}`}_getGlobalContextVariable(H,u){var J;return null===(J=this.logger)||void 0===J||J.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",lJ:{name:H,defaultValue:u,possibleValue:this._globalContextVariables[H]}}),this._hasGlobalContextVariable(H)?this._globalContextVariables[H]:u}_setGlobalContextVariable(H,u){var J;null===(J=this.logger)||void 0===J||J.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",lJ:{name:H,value:u}}),this._globalContextVariables[H]=u}_deleteGlobalContextVariable(H){var u;null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",lJ:{name:H}}),delete this._globalContextVariables[H]}_hasGlobalContextVariable(H){return H in this._globalContextVariables}_setExecutionVariable(H,u,J){this._executionVariables[this._getUniqueIdPrefixedName(H,u)]=J}_getExecutionVariable(H,u,J){return this._hasExecutionVariable(H,u)?this._executionVariables[this._getUniqueIdPrefixedName(H,u)]:J}_deleteExecutionVariable(H,u){delete this._executionVariables[this._getUniqueIdPrefixedName(H,u)]}_hasExecutionVariable(H,u){return this._getUniqueIdPrefixedName(H,u)in this._executionVariables}_hasConnectionValue(H){return H.uniqueId in this._connectionValues}_setConnectionValue(H,u){var J;this._connectionValues[H.uniqueId]=u,null===(J=this.logger)||void 0===J||J.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",lJ:{connectionPointId:H.uniqueId,value:u}})}_setConnectionValueByKey(H,u){this._connectionValues[H]=u}_getConnectionValue(H){var u;return null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",lJ:{connectionPointId:H.uniqueId,value:this._connectionValues[H.uniqueId]}}),this._connectionValues[H.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(H){this._pendingBlocks.includes(H)||(this._pendingBlocks.push(H),this._pendingBlocks.sort(((H,u)=>H.priority-u.priority)))}_removePendingBlock(H){const u=this._pendingBlocks.indexOf(H);-1!==u&&this._pendingBlocks.splice(u,1)}_clearPendingBlocks(){for(const H of this._pendingBlocks)H._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(H){var u;this.onNodeExecutedObservable.notifyObservers(H),null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:H.getClassName(),uniqueId:H.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(H){this._setGlobalContextVariable("timeSinceStart",H.timeSinceStart),this._setGlobalContextVariable("deltaTime",H.deltaTime);for(const J of this._pendingBlocks){var u;null===(u=J._executeOnTick)||void 0===u||u.call(J,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.e;H.uniqueId=this.uniqueId,H._userVariables={};for(const O in this._userVariables)u(O,this._userVariables[O],H._userVariables);H._connectionValues={};for(const O in this._connectionValues)u(O,this._connectionValues[O],H._connectionValues);var J;this.assetsContext!==this.ZH()&&(H._assetsContext={meshes:this.assetsContext.meshes.map((H=>H.id)),materials:this.assetsContext.materials.map((H=>H.id)),textures:this.assetsContext.textures.map((H=>H.name)),animations:this.assetsContext.animations.map((H=>H.name)),lights:this.assetsContext.lights.map((H=>H.id)),cameras:this.assetsContext.cameras.map((H=>H.id)),Qm:null===(J=this.assetsContext.Qm)||void 0===J?void 0:J.map((H=>H.name)),skeletons:this.assetsContext.skeletons.map((H=>H.id)),pm:this.assetsContext.pm.map((H=>H.name)),geometries:this.assetsContext.geometries.map((H=>H.id)),multiMaterials:this.assetsContext.multiMaterials.map((H=>H.id)),transformNodes:this.assetsContext.transformNodes.map((H=>H.id))})}getClassName(){return"FlowGraphContext"}}(0,h.c)([(0,w.I)()],P.prototype,"uniqueId",void 0);var mH=J(14038),l=J(12608);class r{constructor(H){this.onEventTriggeredObservable=new U.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=H,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.nh.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const H=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",lJ:{timeSinceStart:this._startingTime,deltaTime:H}}),this._startingTime+=H})),this._meshPickedObserver=this._scene.onPointerObservable.add((H=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",lJ:H})}),l.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((H=>{const u=H.pointerId,J=H.mesh,O=this._pointerUnderMeshState[u];!O&&J?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",lJ:{pointerId:u,mesh:J}}):O&&!J?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",lJ:{pointerId:u,mesh:O}}):O&&J&&O!==J&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",lJ:{pointerId:u,mesh:O,over:J}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",lJ:{pointerId:u,mesh:J,out:O}})),this._pointerUnderMeshState[u]=J}),l.d.POINTERMOVE)}dispose(){var H,u,J,O,U;null===(H=this._sceneDisposeObserver)||void 0===H||H.remove(),null===(u=this._sceneReadyObserver)||void 0===u||u.remove(),null===(J=this._sceneOnBeforeRenderObserver)||void 0===J||J.remove(),null===(O=this._meshPickedObserver)||void 0===O||O.remove(),null===(U=this._meshUnderPointerObserver)||void 0===U||U.remove(),this.onEventTriggeredObservable.clear()}}var p,a=J(14049);!function(H){H[H.Stopped=0]="Stopped",H[H.Started=1]="Started"}(p||(p={}));class k{get state(){return this._state}set state(H){this._state=H,this.onStateChangedObservable.notifyObservers(H)}constructor(H){this.onStateChangedObservable=new U.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=H.pu,this._sceneEventCoordinator=new r(this._scene),this._coordinator=H.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((H=>{for(const u of this._executionContexts){const J=this._getContextualOrder(H.type,u);for(const O of J)if(!O._executeEvent(u,H.lJ))break}switch(H.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const u of this._executionContexts)u._notifyOnTick(H.lJ);break;case"SceneDispose":this.dispose()}}))}createContext(){const H=new P({pu:this._scene,coordinator:this._coordinator});return this._executionContexts.push(H),H}getContext(H){return this._executionContexts[H]}addEventBlock(H){if("PointerOver"!==H.type&&"PointerOut"!==H.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==H.type&&this._eventBlocks[H.type].push(H),1===this.state)for(const u of this._executionContexts)H._startPendingTasks(u);else this.onStateChangedObservable.addOnce((u=>{if(1===u)for(const J of this._executionContexts)H._startPendingTasks(J)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((H=>{1===H&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const H of this._executionContexts)for(const u in this._eventBlocks){const J=this._getContextualOrder(u,H);for(const u of J)u._startPendingTasks(H)}}_getContextualOrder(H,u){const J=this._eventBlocks[H].sort(((H,u)=>u.initPriority-H.initPriority));if("MeshPick"===H){const H=[];for(const O of J){const U=O.asset.getValue(u);let h=0;for(;h<J.length;h++){const H=J[h].asset.getValue(u);if(U&&H&&(0,a.l)(U,H))break}H.splice(h,0,O)}return H}return J}dispose(){var H;if(0!==this.state){this.state=0;for(const H of this._executionContexts)H._clearPendingBlocks();this._executionContexts.length=0;for(const H in this._eventBlocks)this._eventBlocks[H].length=0;null===(H=this._eventObserver)||void 0===H||H.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(H){const u=[],J=new Set;for(const O in this._eventBlocks)for(const H of this._eventBlocks[O])u.push(H),J.add(H.uniqueId);for(;u.length>0;){const O=u.pop();H(O);for(const H of O.dataInputs)for(const O of H._connectedPoint)J.has(O._ownerBlock.uniqueId)||(u.push(O._ownerBlock),J.add(O._ownerBlock.uniqueId));if(O instanceof mH.e)for(const H of O.signalOutputs)for(const O of H._connectedPoint)J.has(O._ownerBlock.uniqueId)||(u.push(O._ownerBlock),J.add(O._ownerBlock.uniqueId))}}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1?arguments[1]:void 0;H.allBlocks=[],this.visitAllBlocks((u=>{const J={};u.serialize(J),H.allBlocks.push(J)})),H.executionContexts=[];for(const J of this._executionContexts){const O={};J.serialize(O,u),H.executionContexts.push(O)}}}class C{constructor(H){this.config=H,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.pu.nh.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.pu.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const H=this._executeOnNextFrame.slice(0);if(H.length)for(const u of H){this.notifyCustomEvent(u.id,u.data,!1);const H=this._executeOnNextFrame.findIndex((H=>H.uniqueId===u.uniqueId));-1!==H&&this._executeOnNextFrame.splice(H,1)}}));(C.SceneCoordinators.get(this.config.pu)??[]).push(this)}createGraph(){const H=new k({pu:this.config.pu,coordinator:this});return this._flowGraphs.push(H),H}removeGraph(H){const u=this._flowGraphs.indexOf(H);-1!==u&&(H.dispose(),this._flowGraphs.splice(u,1))}start(){for(const H of this._flowGraphs)H.start()}dispose(){var H,u;for(const U of this._flowGraphs)U.dispose();this._flowGraphs.length=0,null===(H=this._disposeObserver)||void 0===H||H.remove(),null===(u=this._onBeforeRenderObserver)||void 0===u||u.remove();const J=C.SceneCoordinators.get(this.config.pu)??[],O=J.indexOf(this);-1!==O&&J.splice(O,1)}serialize(H,u){H._flowGraphs=[];for(const J of this._flowGraphs){const O={};J.serialize(O,u),H._flowGraphs.push(O)}H.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(H){let u=this._customEventsMap.get(H);return u||(u=new U.b,this._customEventsMap.set(H,u)),u}notifyCustomEvent(H,u){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:H,data:u,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(H)){const u=this._eventExecutionCounter.get(H);if(this._eventExecutionCounter.set(H,u+1),u>=C.MaxEventTypeExecutionPerFrame)return void(u===C.MaxEventTypeExecutionPerFrame&&d.b.Warn(`FlowGraphCoordinator: Too many executions of event "${H}".`))}else this._eventExecutionCounter.set(H,1);const J=this._customEventsMap.get(H);J&&J.notifyObservers(u)}}C.MaxEventsPerType=30,C.MaxEventTypeExecutionPerFrame=30,C.SceneCoordinators=new Map},14057:(H,u,J)=>{"use strict";J.d(u,{c:()=>U});var O=J(14061);class U extends O.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(H){H._notifyExecuteNode(this),this.done._activateSignal(H)}}},14038:(H,u,J)=>{"use strict";J.d(u,{e:()=>g});var O=J(14041),U=J(14045),h=J(12304);class w extends U.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(H){super.connectTo(H),this._connectedPoint.sort(((H,u)=>u.priority-H.priority))}_activateSignal(H){var u;if(null===(u=H.logger)||void 0===u||u.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,lJ:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)H._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(H,this),H._increaseExecutionId();else for(const J of this._connectedPoint)J._activateSignal(H)}}(0,h.f)("FlowGraphSignalConnection",w);class g extends O.b{constructor(H){super(H),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(H){const u=new w(H,0,this);return this.signalInputs.push(u),u}_registerSignalOutput(H){const u=new w(H,1,this);return this.signalOutputs.push(u),u}_unregisterSignalInput(H){const u=this.signalInputs.findIndex((u=>u.name===H));-1!==u&&(this.signalInputs[u].dispose(),this.signalInputs.splice(u,1))}_unregisterSignalOutput(H){const u=this.signalOutputs.findIndex((u=>u.name===H));-1!==u&&(this.signalOutputs[u].dispose(),this.signalOutputs.splice(u,1))}_reportError(H,u){this.error.lJ="string"===typeof u?new Error(u):u,this.error._activateSignal(H)}getSignalInput(H){return this.signalInputs.find((u=>u.name===H))}getSignalOutput(H){return this.signalOutputs.find((u=>u.name===H))}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(H),H.signalInputs=[],H.signalOutputs=[];for(const u of this.signalInputs){const J={};u.serialize(J),H.signalInputs.push(J)}for(const u of this.signalOutputs){const J={};u.serialize(J),H.signalOutputs.push(J)}}deserialize(H){for(let u=0;u<H.signalInputs.length;u++){const J=this.getSignalInput(H.signalInputs[u].name);if(!J)throw new Error("Could not find signal input with name "+H.signalInputs[u].name+" in block "+H.className);J.deserialize(H.signalInputs[u])}for(let u=0;u<H.signalOutputs.length;u++){const J=this.getSignalOutput(H.signalOutputs[u].name);if(!J)throw new Error("Could not find signal output with name "+H.signalOutputs[u].name+" in block "+H.className);J.deserialize(H.signalOutputs[u])}}getClassName(){return"FlowGraphExecutionBlock"}}},14064:(H,u,J)=>{"use strict";J.d(u,{e:()=>U});var O=J(14038);class U extends O.e{constructor(H){super(H),this.out=this._registerSignalOutput("out")}}},14018:(H,u,J)=>{"use strict";J.d(u,{D:()=>M,F:()=>d,J:()=>mH,N:()=>l,O:()=>r,S:()=>F,U:()=>s,X:()=>Y,_:()=>Z,d:()=>b,f:()=>P,j:()=>L,n:()=>p,r:()=>a,v:()=>k,z:()=>G});var O,U=J(12338),h=J(12379),w=J(14011),g=J(14027);!function(H){H.Any="any",H.String="string",H.Number="number",H.Boolean="boolean",H.Object="object",H.Integer="FlowGraphInteger",H.Vector2="Vector2",H.lu="lu",H.Vector4="Vector4",H.Quaternion="Quaternion",H.Matrix="Matrix",H.Matrix2D="Matrix2D",H.Matrix3D="Matrix3D",H.ku="ku",H.Mg="Mg"}(O||(O={}));class B{constructor(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=H,this.defaultValue=u,this.animationType=J}serialize(H){H.typeName=this.typeName,H.defaultValue=this.defaultValue}}const b=new B("any",void 0),d=new B("string",""),G=new B("number",0,0),P=new B("boolean",!1),mH=new B("Vector2",U.Vector2.Zero(),5),l=new B("lu",U.lu.Zero(),1),r=new B("Vector4",U.Vector4.Zero()),p=new B("Matrix",U.Matrix.Identity(),3),a=new B("Matrix2D",new g.c),k=new B("Matrix3D",new g.e),C=new B("ku",h.ku.Black(),4),j=new B("Mg",new h.Mg(0,0,0,0),7),M=new B("Quaternion",U.Quaternion.Identity(),2);M.typeTransformer=H=>{if(H.getClassName){if("Vector4"===H.getClassName())return U.Quaternion.Cu(H.Hg());if("lu"===H.getClassName())return U.Quaternion.FromEulerVector(H);if("Matrix"===H.getClassName())return U.Quaternion.FromRotationMatrix(H)}return H};const L=new B("FlowGraphInteger",new w.d(0),0);function Z(H){const u=H;switch(typeof H){case"string":return d;case"number":return G;case"boolean":return P;case"object":if(u.getClassName)switch(u.getClassName()){case"Vector2":return mH;case"lu":return l;case"Vector4":return r;case"Matrix":return p;case"ku":return C;case"Mg":return j;case"Quaternion":return M;case"FlowGraphInteger":return L;case"Matrix2D":return a;case"Matrix3D":return k}return b;default:return b}}function Y(H){switch(H){case"string":return d;case"number":return G;case"boolean":return P;case"Vector2":return mH;case"lu":return l;case"Vector4":return r;case"Matrix":return p;case"ku":return C;case"Mg":return j;case"Quaternion":return M;case"FlowGraphInteger":return L;case"Matrix2D":return a;case"Matrix3D":return k;default:return b}}function F(H){switch(H){case"number":default:return 0;case"Vector2":return 5;case"lu":return 1;case"Matrix":return 3;case"ku":return 4;case"Mg":return 7;case"Quaternion":return 2}}function s(H){switch(H){case 0:return G;case 5:return mH;case 1:return l;case 3:return p;case 4:return C;case 7:return j;case 2:return M;default:return b}}},14009:(H,u,J)=>{"use strict";J.d(u,{d:()=>d,e:()=>b,g:()=>G});var O=J(12379),U=J(12338),h=J(14011),w=J(14018),g=J(14027);function B(H){return"Vector2"===H||"lu"===H||"Vector4"===H||"Quaternion"===H||"ku"===H||"Mg"===H}function b(H,u,J){var O;const U=(null===u||void 0===u||null===(O=u.getClassName)||void 0===O?void 0:O.call(u))??"";if(B(U)||function(H){return"Matrix"===H||"Matrix2D"===H||"Matrix3D"===H}(U))J[H]={value:u.Hg(),className:U};else if("FlowGraphInteger"===U)J[H]={value:u.value,className:U};else if(U&&(u.id||u.name))J[H]={id:u.id,name:u.name,className:U};else{if("object"===typeof u)throw new Error(`Could not serialize value ${u}`);J[H]=u}}function d(H,u,J,b){const G=u[H];let P;const mH=(null===G||void 0===G?void 0:G.type)??(null===G||void 0===G?void 0:G.className);if(function(H){return"Mesh"===H||"AbstractMesh"===H||"GroundMesh"===H||"InstanceMesh"===H||"LinesMesh"===H||"GoldbergMesh"===H||"GreasedLineMesh"===H||"TrailMesh"===H}(mH)){let H=b.meshes.filter((H=>G.id?H.id===G.id:H.name===G.name));0===H.length&&(H=b.transformNodes.filter((H=>G.id?H.id===G.id:H.name===G.name))),P=G.uniqueId?H.find((H=>H.uniqueId===G.uniqueId)):H[0]}else if(B(mH))P=function(H,u){let J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===H)return U.Vector2.Cu(u);if("lu"===H)return J&&(u[2]*=-1),U.lu.Cu(u);if("Vector4"===H)return U.Vector4.Cu(u);if("Quaternion"===H)return J&&(u[2]*=-1,u[3]*=-1),U.Quaternion.Cu(u);if("ku"===H)return new O.ku(u[0],u[1],u[2]);if("Mg"===H)return new O.Mg(u[0],u[1],u[2],u[3]);throw new Error(`Unknown vector class name ${H}`)}(mH,G.value);else if(function(H){return"AnimationGroup"===H}(mH)){const H=b.animationGroups.filter((H=>H.name===G.name));P=1===H.length?H[0]:H.find((H=>H.uniqueId===G.uniqueId))}else P="Matrix"===mH?U.Matrix.Cu(G.value):"Matrix2D"===mH?new g.c(G.value):"Matrix3D"===mH?new g.e(G.value):"FlowGraphInteger"===mH?h.d.FromValue(G.value):"number"===mH||"string"===mH||"boolean"===mH?G.value[0]:G&&void 0!==G.value?G.value:Array.isArray(G)?G.reduce(((H,u)=>u.eventData?(H[u.id]={type:(0,w.X)(u.type)},"undefined"!==typeof u.value&&(H[u.id].value=d("value",u,J,b)),H):H),{}):G;return P}function G(H){return"FlowGraphJsonPointerParserBlock"===H}},14049:(H,u,J)=>{"use strict";function O(H,u){return!(!H.parent||H.parent!==u&&!O(H.parent,u))}function U(H){if(H.getClassName)return H.getClassName()}function h(H,u){return H===u&&("Vector2"===H||"lu"===H||"Vector4"===H||"Quaternion"===H)}function w(H,u){return H===u&&("Matrix"===H||"Matrix2D"===H||"Matrix3D"===H)}function g(H,u){return"FlowGraphInteger"===H&&"FlowGraphInteger"===u}function B(H,u){const J="number"===typeof H||"number"===typeof(null===H||void 0===H?void 0:H.value);return J&&!u?!isNaN(b(H)):J}function b(H){return"number"===typeof H?H:H.value}J.d(u,{c:()=>g,d:()=>w,g:()=>h,i:()=>U,l:()=>O,m:()=>b,p:()=>B})},13432:(H,u,J)=>{"use strict";J.r(u),J.d(u,{SceneInstrumentation:()=>h});var O=J(12171),U=J(12539);class h{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(H){H!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=H,H?(this._onBeforeActiveMeshesEvaluationObserver=this.pu.onBeforeActiveMeshesEvaluationObservable.add((()=>{O.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.pu.onAfterActiveMeshesEvaluationObservable.add((()=>{O.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.pu.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.pu.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(H){H!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=H,H?(this._onBeforeRenderTargetsRenderObserver=this.pu.onBeforeRenderTargetsRenderObservable.add((()=>{O.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.pu.onAfterRenderTargetsRenderObservable.add((()=>{O.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.pu.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.pu.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(H){H!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=H,H?(this._onBeforeParticlesRenderingObserver=this.pu.onBeforeParticlesRenderingObservable.add((()=>{O.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.pu.onAfterParticlesRenderingObservable.add((()=>{O.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.pu.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.pu.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(H){H!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=H,this.pu.spriteManagers&&(H?(this._onBeforeSpritesRenderingObserver=this.pu.onBeforeSpritesRenderingObservable.add((()=>{O.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.pu.onAfterSpritesRenderingObservable.add((()=>{O.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.pu.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.pu.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(H){H!==this._capturePhysicsTime&&this.pu.onBeforePhysicsObservable&&(this._capturePhysicsTime=H,H?(this._onBeforePhysicsObserver=this.pu.onBeforePhysicsObservable.add((()=>{O.Tools.StartPerformanceCounter("Eg"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.pu.onAfterPhysicsObservable.add((()=>{O.Tools.EndPerformanceCounter("Eg"),this._physicsTime.endMonitoring()}))):(this.pu.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.pu.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(H){H!==this._captureAnimationsTime&&(this._captureAnimationsTime=H,H?this._onAfterAnimationsObserver=this.pu.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.pu.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(H){this._captureFrameTime=H}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(H){this._captureInterFrameTime=H}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(H){H!==this._captureRenderTime&&(this._captureRenderTime=H,H?(this._onBeforeDrawPhaseObserver=this.pu.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),O.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.pu.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),O.Tools.EndPerformanceCounter("Main render")}))):(this.pu.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.pu.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(H){H!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=H,H?(this._onBeforeCameraRenderObserver=this.pu.onBeforeCameraRenderObservable.add((H=>{this._cameraRenderTime.beginMonitoring(),O.Tools.StartPerformanceCounter(`Rendering camera ${H.name}`)})),this._onAfterCameraRenderObserver=this.pu.onAfterCameraRenderObservable.add((H=>{this._cameraRenderTime.endMonitoring(!1),O.Tools.EndPerformanceCounter(`Rendering camera ${H.name}`)}))):(this.pu.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.pu.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.pu.getEngine()._drawCalls}constructor(H){this.pu=H,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new U.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new U.e,this._captureFrameTime=!1,this._frameTime=new U.e,this._captureRenderTime=!1,this._renderTime=new U.e,this._captureInterFrameTime=!1,this._interFrameTime=new U.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new U.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new U.e,this._capturePhysicsTime=!1,this._physicsTime=new U.e,this._captureAnimationsTime=!1,this._animationsTime=new U.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new U.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=H.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(O.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.pu.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=H.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(O.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ah(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ah(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ah(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ah(),this._captureRenderTime&&this._renderTime.Ah(),this._captureCameraRenderTime&&this._cameraRenderTime.Ah()}))}dispose(){this._disposed||(this.pu.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.pu.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.pu.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.pu.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.pu.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.pu.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.pu.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.pu.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.pu.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.pu.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.pu.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.pu.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.pu.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.pu.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.pu.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.pu.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.pu.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.pu=null,this._disposed=!0)}}},14004:(H,u,J)=>{"use strict";J.d(u,{b:()=>d});var O=J(12324),U=J(12329),h=J(12338),w=J(12732),g=J(12872),B=J(12926),b=J(12304);w.d.AddNodeConstructor("Light_Type_1",((H,u)=>()=>new d(H,h.lu.Zero(),u)));class d extends B.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(H){this._shadowFrustumSize=H,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(H){this._shadowOrthoScale=H,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(H){this._orthoLeft=H}get orthoRight(){return this._orthoRight}set orthoRight(H){this._orthoRight=H}get orthoTop(){return this._orthoTop}set orthoTop(H){this._orthoTop=H}get orthoBottom(){return this._orthoBottom}set orthoBottom(H){this._orthoBottom=H}constructor(H,u,J){super(H,J),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=u.scale(-1),this.direction=u}getClassName(){return"Qg"}getTypeID(){return g.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(H,u,J){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(H):this._setDefaultAutoExtendShadowProjectionMatrix(H,u,J)}_setDefaultFixedFrustumShadowProjectionMatrix(H){const u=this.ZH().activeCamera;u&&h.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:u.Ug,void 0!==this.shadowMaxZ?this.shadowMaxZ:u.maxZ,H,this.ZH().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(H,u,J){const O=this.ZH().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const H=h.lu.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let O=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(let w=0;w<J.length;w++){const g=J[w];if(!g)continue;const B=g.getBoundingInfo().boundingBox;for(let J=0;J<B.vectorsWorld.length;J++)h.lu.TransformCoordinatesToRef(B.vectorsWorld[J],u,H),H.x<this._orthoLeft&&(this._orthoLeft=H.x),H.y<this._orthoBottom&&(this._orthoBottom=H.y),H.x>this._orthoRight&&(this._orthoRight=H.x),H.y>this._orthoTop&&(this._orthoTop=H.y),this.autoCalcShadowZBounds&&(H.z<O&&(O=H.z),H.z>U&&(U=H.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=O,this._shadowMaxZ=U)}const U=this._orthoRight-this._orthoLeft,w=this._orthoTop-this._orthoBottom,g=void 0!==this.shadowMinZ?this.shadowMinZ:(null===O||void 0===O?void 0:O.Ug)||0,B=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===O||void 0===O?void 0:O.maxZ)||1e4,b=this.ZH().getEngine().rh;h.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-U*this.shadowOrthoScale,this._orthoRight+U*this.shadowOrthoScale,this._orthoBottom-w*this.shadowOrthoScale,this._orthoTop+w*this.shadowOrthoScale,b?B:g,b?g:B,H,this.ZH().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(H,u){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,u),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,u),this)}transferToNodeMaterialEffect(H,u){return this.computeTransformedInformation()?(H.setFloat3(u,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(H.setFloat3(u,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(H){const u=this._scene.getEngine();return!u.rh&&u.isNDCHalfZRange?0:1}getDepthMaxZ(H){const u=this._scene.getEngine();return u.rh&&u.isNDCHalfZRange?0:1}prepareLightSpecificDefines(H,u){H["DIRLIGHT"+u]=!0}}(0,O.c)([(0,U.I)()],d.prototype,"shadowFrustumSize",null),(0,O.c)([(0,U.I)()],d.prototype,"shadowOrthoScale",null),(0,O.c)([(0,U.I)()],d.prototype,"autoUpdateExtends",void 0),(0,O.c)([(0,U.I)()],d.prototype,"autoCalcShadowZBounds",void 0),(0,O.c)([(0,U.I)("orthoLeft")],d.prototype,"_orthoLeft",void 0),(0,O.c)([(0,U.I)("orthoRight")],d.prototype,"_orthoRight",void 0),(0,O.c)([(0,U.I)("orthoTop")],d.prototype,"_orthoTop",void 0),(0,O.c)([(0,U.I)("orthoBottom")],d.prototype,"_orthoBottom",void 0),(0,b.f)("BABYLON.DirectionalLight",d)},14481:(H,u,J)=>{"use strict";J.d(u,{c:()=>d});var O=J(12324),U=J(12329),h=J(12338),w=J(12379),g=J(12732),B=J(12872),b=J(12304);g.d.AddNodeConstructor("Light_Type_3",((H,u)=>()=>new d(H,h.lu.Zero(),u)));class d extends B.d{constructor(H,u,J){super(H,J),this.groundColor=new w.ku(0,0,0),this.direction=u||h.lu.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"mb"}setDirectionToTarget(H){return this.direction=h.lu.Normalize(H.ru(h.lu.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(H,u){const J=h.lu.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",J.x,J.y,J.z,0,u),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Yg),u),this}transferToNodeMaterialEffect(H,u){const J=h.lu.Normalize(this.direction);return H.setFloat3(u,J.x,J.y,J.z),this}dg(){return this._worldMatrix||(this._worldMatrix=h.Matrix.Identity()),this._worldMatrix}getTypeID(){return B.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(H,u){H["HEMILIGHT"+u]=!0}}(0,O.c)([(0,U.l)()],d.prototype,"groundColor",void 0),(0,O.c)([(0,U.G)()],d.prototype,"direction",void 0),(0,b.f)("BABYLON.HemisphericLight",d)},13977:(H,u,J)=>{"use strict";J.d(u,{b:()=>G});var O=J(12324),U=J(12329),h=J(12338),w=J(12732),g=J(12872),B=J(12926),b=J(12321),d=J(12304);w.d.AddNodeConstructor("Light_Type_2",((H,u)=>()=>new G(H,h.lu.Zero(),h.lu.Zero(),0,0,u)));class G extends B.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(H){this._iesProfileTexture!==H&&(this._iesProfileTexture=H,this._iesProfileTexture&&G._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(H){this._angle=H,this._cosHalfAngle=Math.cos(.5*H),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(H){this._innerAngle=H,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(H){this._shadowAngleScale=H,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(H){this._projectionTextureLightNear=H,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(H){this._projectionTextureLightFar=H,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(H){this._projectionTextureUpDirection=H,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(H){this._projectionTexture!==H&&(this._projectionTexture=H,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(G._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):G._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(H){return void 0!==H.onGeneratedObservable}static _IsTexture(H){return void 0!==H.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(H){this._projectionTextureProjectionLightMatrix=H,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(H,u,J,O,U,w){super(H,w),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=h.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=h.lu.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=h.lu.Zero(),this._projectionTextureViewLightMatrix=h.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=h.Matrix.Zero(),this._projectionTextureScalingMatrix=h.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=u,this.direction=J,this.angle=O,this.exponent=U}getClassName(){return"SpotLight"}getTypeID(){return g.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(H){super._setDirection(H),this._projectionTextureViewLightDirty=!0}_setPosition(H){super._setPosition(H),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(H,u,J){const O=this.ZH().activeCamera;if(!O)return;this._shadowAngleScale=this._shadowAngleScale||1;const U=this._shadowAngleScale*this._angle,w=void 0!==this.shadowMinZ?this.shadowMinZ:O.Ug,g=void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ,B=this.ZH().getEngine().rh;h.Matrix.PerspectiveFovLHToRef(U,1,B?g:w,B?w:g,H,!0,this._scene.getEngine().isNDCHalfZRange,void 0,B)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),h.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const H=this.projectionTextureLightFar,u=this.projectionTextureLightNear,J=H/(H-u),O=-J*u,U=1/Math.tan(this._angle/2);h.Matrix.FromValuesToRef(U/1,0,0,0,0,U,0,0,0,0,J,1,0,0,O,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof b.b){const H=this._projectionTexture.uScale/2,u=this._projectionTexture.vScale/2;h.Matrix.FromValuesToRef(H,0,0,0,0,u,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(H,u){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),H.setMatrix("textureProjectionMatrix"+u,this._projectionTextureMatrix),H.setTexture("projectionLightTexture"+u,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&H.setTexture("iesLightTexture"+u,this._iesProfileTexture),this}transferToEffect(H,u){let J;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,u),J=h.lu.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,u),J=h.lu.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",J.x,J.y,J.z,this._cosHalfAngle,u),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,u),this}transferToNodeMaterialEffect(H,u){let J;return J=this.computeTransformedInformation()?h.lu.Normalize(this.transformedDirection):h.lu.Normalize(this.direction),this.ZH().useRightHandedSystem?H.setFloat3(u,-J.x,-J.y,-J.z):H.setFloat3(u,J.x,J.y,J.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(H){const u=this._scene.getEngine(),J=void 0!==this.shadowMinZ?this.shadowMinZ:(null===H||void 0===H?void 0:H.Ug)??0;return u.rh&&u.isNDCHalfZRange?J:this._scene.getEngine().isNDCHalfZRange?0:J}getDepthMaxZ(H){const u=this._scene.getEngine(),J=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===H||void 0===H?void 0:H.maxZ)??1e4;return u.rh&&u.isNDCHalfZRange?0:J}prepareLightSpecificDefines(H,u){H["SPOTLIGHT"+u]=!0,H["PROJECTEDLIGHTTEXTURE"+u]=!(!this.projectionTexture||!this.projectionTexture.isReady()),H["IESLIGHTTEXTURE"+u]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,O.c)([(0,U.I)()],G.prototype,"angle",null),(0,O.c)([(0,U.I)()],G.prototype,"innerAngle",null),(0,O.c)([(0,U.I)()],G.prototype,"shadowAngleScale",null),(0,O.c)([(0,U.I)()],G.prototype,"exponent",void 0),(0,O.c)([(0,U.I)()],G.prototype,"projectionTextureLightNear",null),(0,O.c)([(0,U.I)()],G.prototype,"projectionTextureLightFar",null),(0,O.c)([(0,U.I)()],G.prototype,"projectionTextureUpDirection",null),(0,O.c)([(0,U.E)("projectedLightTexture")],G.prototype,"_projectionTexture",void 0),(0,d.f)("BABYLON.SpotLight",G)},13700:(H,u,J)=>{"use strict";J.d(u,{d:()=>w,h:()=>h,i:()=>g});const O={},U={};function h(H,u){O[H]=u}function w(H,u){U[H]=u}function g(H){return U[H]?U[H]:null}},13599:(H,u,J)=>{"use strict";J.d(u,{c:()=>Z,f:()=>R});var O,U=J(12171),h=J(12175),w=J(12568),g=J(12203),B=J(12185),b=J(12785),d=J(12210),G=J(12213),P=J(12306),mH=J(12247),l=J(12201);!function(H){H[H.Clean=0]="Clean",H[H.Stop=1]="Stop",H[H.Sync=2]="Sync",H[H.NoSync=3]="NoSync"}(O||(O={}));const r=new h.b,p={};let a=!1;function k(){return p[".babylon"]}function C(H,u){const J=p[H];return J||(B.b.Warn("Unable to find a plugin to load "+H+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),u?k():void 0)}function j(H,u,J){let O="Unable to load from "+(H.rawData?"binary data":H.url);return u?O+=`: ${u}`:J&&(O+=`: ${J}`),O}async function M(H,u,J,O,U,h,w,g,B){var b;const G="data:"===(P=H.url).substring(0,5)?P.substring(5):null;var P;if(H.rawData&&!w)throw"When using ArrayBufferView to load data the file extension must be provided.";const a=G||w?"":function(H){const u=H.indexOf("?");-1!==u&&(H=H.substring(0,u));const J=H.lastIndexOf(".");return H.substring(J,H.length).toLowerCase()}(H.url);let j=w?C(w,!0):G?function(H){for(const u in p){const J=p[u].plugin;if(J.canDirectLoad&&J.canDirectLoad(H))return p[u]}return k()}(H.url):C(a,!1);if(!j&&a){if(H.url&&!H.url.startsWith("blob:")){const u=await async function(H,u){const J=u.method||"GET";return await new Promise(((O,U)=>{const h=new l.d;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const H={};if(u.responseHeaders)for(const J of u.responseHeaders)H[J]=h.getResponseHeader(J)||"";O({response:h.response,headerValues:H})}else U(`Unable to fetch data from ${H}. Error code: ${h.status}`)})),h.open(J,H),h.send()}))}(H.url,{method:"HEAD",responseHeaders:["Content-Type"]}),J=u.headerValues?u.headerValues["Content-Type"]:"";J&&(j=function(H){for(const u in p){const J=p[u];if(J.mimeType===H)return J}}(J))}j||(j=k())}if(!j)throw new Error(`No plugin or fallback for ${w??H.url}`);if(!1===(null===B||void 0===B||null===(b=B[j.plugin.name])||void 0===b?void 0:b.enabled))throw new Error(`The '${j.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(H.rawData&&!j.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(H=>{if(j.plugin.createPlugin){const u=j.plugin.createPlugin(B??{});return u instanceof Promise?(u.then(H).catch((H=>{U("Error instantiating plugin.",H)})),null):(H(u),u)}return H(j.plugin),j.plugin})((B=>{var b;if(!B)throw`The loader plugin corresponding to the '${w}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(r.notifyObservers(B),G&&(B.canDirectLoad&&B.canDirectLoad(H.url)||!(0,d.j)(H.url))){if(B.directLoad){const H=B.directLoad(u,G);H instanceof Promise?H.then((H=>{J(B,H)})).catch((H=>{U("Error in directLoad of _loadData: "+H,H)})):J(B,H)}else J(B,G);return}const P=j.isBinary,l=(H,O)=>{u.B?U("Scene has been disposed"):J(B,H,O)};let p=null,a=!1;null===(b=B.nh)||void 0===b||b.add((()=>{a=!0,p&&(p.abort(),p=null),h()}));const k=()=>{if(a)return;const J=(H,u)=>{U(null===H||void 0===H?void 0:H.statusText,u)};if(!B.loadFile&&H.rawData)throw"Plugin does not support loading ArrayBufferView.";p=B.loadFile?B.loadFile(u,H.rawData||H.file||H.url,H.rootUrl,l,O,P,J,g):u._loadFile(H.file||H.url,l,O,!0,P,J)},C=u.getEngine();let M=C.enableOfflineSupport;if(M){let J=!1;for(const O of u.disableOfflineSupportExceptionRules)if(O.test(H.url)){J=!0;break}M=!J}M&&mH.d.OfflineProviderFactory?u.offlineProvider=mH.d.OfflineProviderFactory(H.url,k,C.disableManifestCheck):k()}))}function L(H,u){let J,O,h=null,w=null;if(u)if(u.name)J=`file:${u.name}`,O=u.name,h=u;else if(ArrayBuffer.isView(u))J="",O=(0,P.c)(),w=u;else if(u.startsWith("data:"))J=u,O="";else if(H){const h=u;if("/"===h.substring(0,1))return U.Tools.Error("Wrong sceneFilename parameter"),null;J=H+h,O=h}else J=u,O=U.Tools.GetFilename(u),H=U.Tools.GetFolderPath(u);else J=H,O=U.Tools.GetFilename(H),H=U.Tools.GetFolderPath(H);return{url:J,rootUrl:H,name:O,file:h,rawData:w}}function Z(H){if("string"===typeof H.extensions){const u=H.extensions;p[u.toLowerCase()]={plugin:H,isBinary:!1}}else{const u=H.extensions,J=Object.keys(u);for(const O of J)p[O.toLowerCase()]={plugin:H,isBinary:u[O].isBinary,mimeType:u[O].mimeType}}}async function Y(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.e.LastCreatedScene,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!O)return B.b.Error("No scene available to import mesh to"),null;const mH=L(u,J);if(!mH)return null;const l={};O.addPendingData(l);const r=()=>{O.removePendingData(l)},p=(H,u)=>{const J=j(mH,H,u);w?w(O,J,new G.k(J,G.g.SceneLoaderError,u)):B.b.Error(J),r()},a=h?H=>{try{h(H)}catch(u){p("Error in onProgress callback: "+u,u)}}:void 0,k=(H,u,J,h,w,g,B,b)=>{if(O.importedMeshesFiles.push(mH.url),U)try{U(H,u,J,h,w,g,B,b)}catch(d){p("Error in onSuccess callback: "+d,d)}O.removePendingData(l)};return await M(mH,O,((u,J,U)=>{if(u.rewriteRootURL&&(mH.rootUrl=u.rewriteRootURL(mH.rootUrl,U)),u.importMesh){const U=[],h=[],w=[];if(!u.importMesh(H,O,J,mH.rootUrl,U,h,w,p))return;O.loadingPluginName=u.name,k(U,h,w,[],[],[],[],[])}else{u.importMeshAsync(H,O,J,mH.rootUrl,a,mH.name).then((H=>{O.loadingPluginName=u.name,k(H.meshes,H.pm,H.skeletons,H.animationGroups,H.transformNodes,H.geometries,H.lights,H.spriteManagers)})).catch((H=>{p(H.message,H)}))}}),a,p,r,b,d,P)}async function F(H,u,J,O,U,h,w,g){return await new Promise(((B,b)=>{try{Y(H,u,J,O,((H,u,J,O,U,h,w,g)=>{B({meshes:H,pm:u,skeletons:J,animationGroups:O,transformNodes:U,geometries:h,lights:w,spriteManagers:g})}),U,((H,u,J)=>{b(J||new Error(u))}),h,w,g).catch(b)}catch(G){b(G)}}))}async function s(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.e.LastCreatedEngine,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};J?await t(H,u,new w.d(J),O,h,B,b,d,G):U.Tools.Error("No engine available")}async function A(H,u,J,O,U,h,w){return await new Promise(((g,B)=>{s(H,u,J,(H=>{g(H)}),O,((H,u,J)=>{B(J||new Error(u))}),U,h,w)}))}async function t(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.e.LastCreatedScene,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!J)return B.b.Error("No scene available to append to"),null;const mH=L(H,u);if(!mH)return null;const l={};J.addPendingData(l);const r=()=>{J.removePendingData(l)};b.b.ShowLoadingScreen&&!a&&(a=!0,J.getEngine().displayLoadingUI(),J.executeWhenReady((()=>{J.getEngine().hideLoadingUI(),a=!1})));const p=(H,u)=>{const O=j(mH,H,u);h?h(J,O,new G.k(O,G.g.SceneLoaderError,u)):B.b.Error(O),r()},k=U?H=>{try{U(H)}catch(u){p("Error in onProgress callback",u)}}:void 0,C=()=>{if(O)try{O(J)}catch(H){p("Error in onSuccess callback",H)}J.removePendingData(l)};return await M(mH,J,((H,u)=>{if(H.load){if(!H.load(J,u,mH.rootUrl,p))return;J.loadingPluginName=H.name,C()}else{H.loadAsync(J,u,mH.rootUrl,k,mH.name).then((()=>{J.loadingPluginName=H.name,C()})).catch((H=>{p(H.message,H)}))}}),k,p,r,w,d,P)}async function e(H,u,J,O,U,h,w){return await new Promise(((g,B)=>{try{t(H,u,J,(H=>{g(H)}),O,((H,u,J)=>{B(J||new Error(u))}),U,h,w).catch(B)}catch(G){B(G)}}))}async function c(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.e.LastCreatedScene,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!J)return B.b.Error("No scene available to load asset container to"),null;const P=L(H,u);if(!P)return null;const mH={};J.addPendingData(mH);const l=()=>{J.removePendingData(mH)},r=(H,u)=>{const O=j(P,H,u);h?h(J,O,new G.k(O,G.g.SceneLoaderError,u)):B.b.Error(O),l()},p=U?H=>{try{U(H)}catch(u){r("Error in onProgress callback",u)}}:void 0,a=H=>{if(O)try{O(H)}catch(u){r("Error in onSuccess callback",u)}J.removePendingData(mH)};return await M(P,J,((H,u)=>{if(H.loadAssetContainer){const O=H.loadAssetContainer(J,u,P.rootUrl,r);if(!O)return;O.populateRootNodes(),J.loadingPluginName=H.name,a(O)}else if(H.loadAssetContainerAsync){H.loadAssetContainerAsync(J,u,P.rootUrl,p,P.name).then((u=>{u.populateRootNodes(),J.loadingPluginName=H.name,a(u)})).catch((H=>{r(H.message,H)}))}else r("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),p,r,l,w,b,d)}async function n(H,u,J,O,U,h,w){return await new Promise(((g,B)=>{try{c(H,u,J,(H=>{g(H)}),O,((H,u,J)=>{B(J||new Error(u))}),U,h,w).catch(B)}catch(G){B(G)}}))}async function V(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.e.LastCreatedScene,O=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,P=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",mH=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!J)return void B.b.Error("No scene available to load animations to");if(O){for(const O of J.animatables)O.reset();J.stopAllAnimations();const H=J.animationGroups.slice();for(const J of H)J.dispose();const u=J.getNodes();for(const J of u)J.animations&&(J.animations=[])}else switch(U){case 0:const H=J.animationGroups.slice();for(const u of H)u.dispose();break;case 1:for(const u of J.animationGroups)u.stop();break;case 2:for(const u of J.animationGroups)u.reset(),u.restart();break;case 3:break;default:return void B.b.Error("Unknown animation group loading mode value '"+U+"'")}const l=J.animatables.length;await c(H,u,J,(H=>{H.mergeAnimationsTo(J,J.animatables.slice(l),h),H.dispose(),J.onAnimationFileImportedObservable.notifyObservers(J),w&&w(J)}),b,d,G,P,mH)}async function T(H,u,J,O,U,h,w,g,B,b){return await new Promise(((d,P)=>{try{V(H,u,J,O,U,h,(H=>{d(H)}),w,((H,u,J)=>{P(J||new Error(u))}),g,B,b).catch(P)}catch(G){P(G)}}))}class R{static get ForceFullSceneLoadingForIncremental(){return b.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(H){b.b.ForceFullSceneLoadingForIncremental=H}static get ShowLoadingScreen(){return b.b.ShowLoadingScreen}static set ShowLoadingScreen(H){b.b.ShowLoadingScreen=H}static get loggingLevel(){return b.b.loggingLevel}static set loggingLevel(H){b.b.loggingLevel=H}static get CleanBoneMatrixWeights(){return b.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(H){b.b.CleanBoneMatrixWeights=H}static GetDefaultPlugin(){return k()}static GetPluginForExtension(H){var u;return null===(u=C(H,!0))||void 0===u?void 0:u.plugin}static IsPluginForExtensionAvailable(H){return function(H){return!!p[H]}(H)}static RegisterPlugin(H){Z(H)}static ImportMesh(H,u,J,O,U,h,w,B,b){Y(H,u,J,O,U,h,w,B,b).catch((H=>null===w||void 0===w?void 0:w(g.e.LastCreatedScene,null===H||void 0===H?void 0:H.message,H)))}static async ImportMeshAsync(H,u,J,O,U,h,w){return await F(H,u,J,O,U,h,w)}static Load(H,u,J,O,U,h,w,B){s(H,u,J,O,U,h,w,B).catch((H=>null===h||void 0===h?void 0:h(g.e.LastCreatedScene,null===H||void 0===H?void 0:H.message,H)))}static async LoadAsync(H,u,J,O,U,h){return await A(H,u,J,O,U,h)}static Append(H,u,J,O,U,h,w,B){t(H,u,J,O,U,h,w,B).catch((H=>null===h||void 0===h?void 0:h(J??g.e.LastCreatedScene,null===H||void 0===H?void 0:H.message,H)))}static async AppendAsync(H,u,J,O,U,h){return await e(H,u,J,O,U,h)}static LoadAssetContainer(H,u,J,O,U,h,w,B){c(H,u,J,O,U,h,w,B).catch((H=>null===h||void 0===h?void 0:h(J??g.e.LastCreatedScene,null===H||void 0===H?void 0:H.message,H)))}static async LoadAssetContainerAsync(H,u,J,O,U,h){return await n(H,u,J,O,U,h)}static ImportAnimations(H,u,J,O,U,h,w,B,b,d,G){V(H,u,J,O,U,h,w,B,b,d,G).catch((H=>null===b||void 0===b?void 0:b(J??g.e.LastCreatedScene,null===H||void 0===H?void 0:H.message,H)))}static async ImportAnimationsAsync(H,u,J,O,U,h,w,g,B,b,d){return await T(H,u,J,O,U,h,g,b,d)}}R.NO_LOGGING=0,R.MINIMAL_LOGGING=1,R.SUMMARY_LOGGING=2,R.DETAILED_LOGGING=3,R.OnPluginActivatedObservable=r},13992:(H,u,J)=>{"use strict";J.d(u,{e:()=>P});var O=J(12324),U=J(12329),h=J(12171),w=J(12338),g=J(12358),B=J(12321),b=J(12304),d=J(12175),G=J(12365);J(13995);class P extends g.b{set boundingBoxSize(H){if(this._boundingBoxSize&&this._boundingBoxSize.equals(H))return;this._boundingBoxSize=H;const u=this.ZH();u&&u.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(H){this._rotationY=H,this.setReflectionTextureMatrix(w.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(H,u,J){let O="";for(const U of H)O+=U;return new P(O,u,null,J,H)}static CreateFromPrefilteredData(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,O=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const U=u.useDelayedTextureLoading;u.useDelayedTextureLoading=!1;const h=new P(H,u,null,!1,null,null,null,void 0,!0,J,O);return u.useDelayedTextureLoading=U,h}constructor(H,u){var J;let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,P=arguments.length>8&&void 0!==arguments[8]&&arguments[8],mH=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,l=arguments.length>10&&void 0!==arguments[10]&&arguments[10],r=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,a=arguments.length>13?arguments[13]:void 0,k=arguments.length>14?arguments[14]:void 0;super(u),this.onLoadObservable=new d.b,this.boundingBoxPosition=w.lu.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new w.Matrix,this._buffer=null,this.name=H,this.url=H,this._noMipmap=U,this.Og=!1,this.isCube=!0,this._textureMatrix=w.Matrix.Identity(),this.coordinatesMode=B.b.CUBIC_MODE;let C=null,j=null;null===O||Array.isArray(O)?(this._noMipmap=U,this._format=G,this._createPolynomials=l,C=O,this._loaderOptions=a,this._useSRGBBuffer=k,this._lodScale=r,this._lodOffset=p):(C=O.extensions??null,this._noMipmap=O.noMipmap??!1,h=O.files??null,j=O.buffer??null,this._format=O.format??5,P=O.prefiltered??!1,mH=O.forcedExtension??null,this._createPolynomials=O.createPolynomials??!1,this._lodScale=O.lodScale??.8,this._lodOffset=O.lodOffset??0,this._loaderOptions=O.loaderOptions,this._useSRGBBuffer=O.useSRGBBuffer,g=O.K??null,b=O.onError??null),(H||h)&&this.updateURL(H,mH,g,P,b,C,null===(J=this.ZH())||void 0===J?void 0:J.useDelayedTextureLoading,h,j)}getClassName(){return"CubeTexture"}updateURL(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=H),this.url=H,u&&(this._forcedExtension=u);const b=H.lastIndexOf("."),d=u||(b>-1?H.substring(b).toLowerCase():""),G=0===d.indexOf(".dds"),P=0===d.indexOf(".env"),mH=0===d.indexOf(".basis");if(P?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=O,O&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),g)this._files=g;else if(mH||P||G||h||(h=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,h){for(let u=0;u<h.length;u++)this._files.push(H+h[u]);this._extensions=h}this._buffer=B,w?(this.delayLoadState=4,this._delayedOnLoad=J,this._delayedOnError=U):this._loadTexture(J,U)}delayLoad(H){4===this.delayLoadState&&(H&&(this._forcedExtension=H),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(H){var u,J;if(H.updateFlag===this._textureMatrix.updateFlag)return;H.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(J=this.ZH())||void 0===J||J.markAllMaterialsAsDirty(1,(H=>-1!==H.getActiveTextures().indexOf(this))));if(this._textureMatrix=H,null===(u=this.ZH())||void 0===u||!u.useRightHandedSystem)return;const O=w.TmpVectors.lu[0],U=w.TmpVectors.Quaternion[0],h=w.TmpVectors.lu[1];this._textureMatrix.decompose(O,U,h),U.z*=-1,U.w*=-1,w.Matrix.ComposeToRef(O,U,h,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var H;return null!==(H=this.ZH())&&void 0!==H&&H.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const J=this.ZH(),O=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const U=()=>{var u;(this.onLoadObservable.notifyObservers(this),O)&&(O.dispose(),null===(u=this.ZH())||void 0===u||u.markAllMaterialsAsDirty(1));H&&H()},w=(H,J)=>{this._loadingError=!0,this._errorObject={message:H,exception:J},u&&u(H,J),B.b.OnTextureLoadErrorObservable.notifyObservers(this)};var g;this._texture?this._texture.isReady?h.Tools.SetImmediate((()=>U())):this._texture.onLoadedObservable.add((()=>U())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,J,this._lodScale,this._lodOffset,H,w,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,J,this._files,this._noMipmap,H,w,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(g=this._texture)||void 0===g||g.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(H,u,J){const O=G.d.Parse((()=>{let O=!1;return H.prefiltered&&(O=H.prefiltered),new P(J+(H.url??H.name),u,H.extensions,!1,H.files||null,null,null,void 0,O,H.forcedExtension)}),H,u);if(H.boundingBoxPosition&&(O.boundingBoxPosition=w.lu.Cu(H.boundingBoxPosition)),H.boundingBoxSize&&(O.boundingBoxSize=w.lu.Cu(H.boundingBoxSize)),H.animations)for(let U=0;U<H.animations.length;U++){const u=H.animations[U],J=(0,b.b)("BABYLON.Animation");J&&O.animations.push(J.Parse(u))}return O}clone(){let H=0;const u=G.d.Clone((()=>{const u=new P(this.url,this.ZH()||this._getEngine(),this._extensions,this._noMipmap,this._files);return H=u.uniqueId,u}),this);return u.uniqueId=H,u}}(0,O.c)([(0,U.I)()],P.prototype,"url",void 0),(0,O.c)([(0,U.G)()],P.prototype,"boundingBoxPosition",void 0),(0,O.c)([(0,U.G)()],P.prototype,"boundingBoxSize",null),(0,O.c)([(0,U.I)("rotationY")],P.prototype,"rotationY",null),(0,O.c)([(0,U.I)("files")],P.prototype,"_files",void 0),(0,O.c)([(0,U.I)("forcedExtension")],P.prototype,"_forcedExtension",void 0),(0,O.c)([(0,U.I)("extensions")],P.prototype,"_extensions",void 0),(0,O.c)([(0,U.v)("textureMatrix")],P.prototype,"_textureMatrix",void 0),(0,O.c)([(0,U.v)("textureMatrixRefraction")],P.prototype,"_textureMatrixRefraction",void 0),B.b._CubeTextureParser=P.Parse,(0,b.f)("BABYLON.CubeTexture",P)},14493:(H,u,J)=>{"use strict";J.d(u,{b:()=>B});var O=J(12185),U=J(12321),h=J(12308),w=J(12457),g=J(12280);w.ThinEngine.prototype.createDynamicTexture=function(H,u,J,O){const U=new g.c(this,4);return U.baseWidth=H,U.baseHeight=u,J&&(H=this.needPOTTextures?(0,h.g)(H,this._caps.maxTextureSize):H,u=this.needPOTTextures?(0,h.g)(u,this._caps.maxTextureSize):u),U.width=H,U.height=u,U.isReady=!1,U.generateMipMaps=J,U.samplingMode=O,this.updateTextureSamplingMode(O,U),this._internalTexturesCache.push(U),U},w.ThinEngine.prototype.updateDynamicTexture=function(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!H)return;const w=this._gl,g=w.TEXTURE_2D,B=this._bindTextureDirectly(g,H,!0,h);this._unpackFlipY(void 0===J?H.invertY:J),O&&w.pixelStorei(w.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const b=this._getWebGLTextureType(H.type),d=this._getInternalFormat(U||H.format),G=this._getRGBABufferInternalSizedFormat(H.type,d);w.texImage2D(g,0,G,d,b,u),H.generateMipMaps&&w.generateMipmap(g),B||this._bindTextureDirectly(g,null),O&&w.pixelStorei(w.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),U&&(H.format=U),H._dynamicTextureSource=u,H._premulAlpha=O,H.invertY=J||!1,H.isReady=!0};class B extends U.b{constructor(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,g=arguments.length>6?arguments[6]:void 0;const B=!J||J._isScene;super(null,B?J:null===J||void 0===J?void 0:J.pu,B?!O:J,g,h,void 0,void 0,void 0,void 0,w),this.name=H,this.wrapU=U.b.CLAMP_ADDRESSMODE,this.wrapV=U.b.CLAMP_ADDRESSMODE,this._generateMipMaps=O;const b=this._getEngine();if(!b)return;if(u.getContext)this._canvas=u,this._ownCanvas=!1,this._texture=b.createDynamicTexture(this._canvas.width,this._canvas.height,O,h);else{this._canvas=b.createCanvas(1,1),this._ownCanvas=!0;const H=u;H.width||0===H.width?this._texture=b.createDynamicTexture(H.width,H.height,O,h):this._texture=b.createDynamicTexture(u,u,O,h)}const d=this.getSize();this._canvas.width!==d.width&&(this._canvas.width=d.width),this._canvas.height!==d.height&&(this._canvas.height=d.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(H){this._canvas.width=H.width,this._canvas.height=H.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(H.width,H.height,this._generateMipMaps,this.samplingMode)}scale(H){const u=this.getSize();u.width*=H,u.height*=H,this._recreate(u)}scaleTo(H,u){const J=this.getSize();J.width=H,J.height=u,this._recreate(J)}getContext(){return this._context}clear(H){const u=this.getSize();H&&(this._context.fillStyle=H),this._context.clearRect(0,0,u.width,u.height)}update(H){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===H||H,u,this._format||void 0,void 0,J)}drawText(H,u,J,O,U,h,w){let g=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const B=this.getSize();if(h&&(this._context.fillStyle=h,this._context.fillRect(0,0,B.width,B.height)),this._context.font=O,null===u||void 0===u){const J=this._context.measureText(H);u=(B.width-J.width)/2}if(null===J||void 0===J){const H=parseInt(O.replace(/\D/g,""));J=B.height/2+H/3.65}this._context.fillStyle=U||"",this._context.fillText(H,u,J),g&&this.update(w)}dispose(){var H,u;(super.dispose(),this._ownCanvas)&&(null===(H=this._canvas)||void 0===H||null===(u=H.remove)||void 0===u||u.call(H));this._canvas=null,this._context=null}clone(){const H=this.ZH();if(!H)return this;const u=this.getSize(),J=new B(this.name,u,H,this._generateMipMaps);return J.Og=this.Og,J.level=this.level,J.wrapU=this.wrapU,J.wrapV=this.wrapV,J}serialize(){const H=this.ZH();H&&!H.isReady()&&O.b.Warn("The scene must be ready before serializing the dynamic texture");const u=super.serialize();return B._IsCanvasElement(this._canvas)&&(u.base64String=this._canvas.toDataURL()),u.invertY=this._invertY,u.samplingMode=this.samplingMode,u}static _IsCanvasElement(H){return void 0!==H.toDataURL}_rebuild(){this.update()}}},13909:(H,u,J)=>{"use strict";J.d(u,{d:()=>U});var O=J(12321);class U extends O.b{get depth(){return this._depth}constructor(H,u,J,U,h,w){let g=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],B=arguments.length>7&&void 0!==arguments[7]&&arguments[7],b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:O.b.TRILINEAR_SAMPLINGMODE,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,G=arguments.length>10?arguments[10]:void 0;super(null,w,!g,B),this.format=h,this._texture=w.getEngine().createRawTexture2DArray(H,u,J,U,h,g,B,b,null,d,G),this._depth=U,this.is2DArray=!0}update(H){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,H,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(H,u,J,O,h){return new U(H,u,J,O,5,h,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13720:(H,u,J)=>{"use strict";J.d(u,{b:()=>g,e:()=>B,g:()=>h,i:()=>w});var O=J(12349),U=J(12338);function h(H,u){return`{X: ${H.x.toFixed(u)} Y: ${H.y.toFixed(u)}}`}function w(H,u){return`{X: ${H._x.toFixed(u)} Y: ${H._y.toFixed(u)} Z: ${H._z.toFixed(u)}}`}function g(H,u){return 2*Math.acos((0,O.Clamp)(U.Quaternion.Dot(H,u)))}function B(H,u){const J=new U.Quaternion;return function(H,u,J){const h=U.lu.Cross(H,u),w=Math.acos((0,O.Clamp)(U.lu.Dot(H,u),-1,1));U.Quaternion.RotationAxisToRef(h,w,J)}(H,u,J),J}},13549:(H,u,J)=>{"use strict";J.d(u,{c:()=>b});var O=J(12338),U=J(12379),h=J(12770),w=J(12746),g=J(12396);J(13553);function B(H){let u=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const J=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],h=[];let B=[];const b=H.width||H.size||1,d=H.height||H.size||1,G=H.depth||H.size||1,P=H.wrap||!1;let mH=void 0===H.topBaseAt?1:H.topBaseAt,l=void 0===H.bottomBaseAt?0:H.bottomBaseAt;mH=(mH+4)%4,l=(l+4)%4;let r=[2,0,3,1][mH],p=[2,0,1,3][l],a=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(P){u=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],a=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let H=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],J=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const O=[17,18,19,16],U=[22,23,20,21];for(;r>0;)H.unshift(H.pop()),O.unshift(O.pop()),r--;for(;p>0;)J.unshift(J.pop()),U.unshift(U.pop()),p--;H=H.flat(),J=J.flat(),a=a.concat(H).concat(J),u.push(O[0],O[2],O[3],O[0],O[1],O[2]),u.push(U[0],U[2],U[3],U[0],U[1],U[2])}const k=[b/2,d/2,G/2];B=a.reduce(((H,u,J)=>H.concat(u*k[J%3])),[]);const C=0===H.sideOrientation?0:H.sideOrientation||w.d.DEFAULTSIDE,j=H.faceUV||new Array(6),M=H.faceColors,L=[];for(let w=0;w<6;w++)void 0===j[w]&&(j[w]=new O.Vector4(0,0,1,1)),M&&void 0===M[w]&&(M[w]=new U.Mg(1,1,1,1));for(let O=0;O<6;O++)if(h.push(j[O].z,g.e?1-j[O].w:j[O].w),h.push(j[O].x,g.e?1-j[O].w:j[O].w),h.push(j[O].x,g.e?1-j[O].y:j[O].y),h.push(j[O].z,g.e?1-j[O].y:j[O].y),M)for(let H=0;H<4;H++)L.push(M[O].r,M[O].g,M[O].b,M[O].a);w.d._ComputeSides(C,B,u,J,h,H.frontUVs,H.backUVs);const Z=new w.d;if(Z.indices=u,Z.FH=B,Z.sH=J,Z.tH=h,M){const H=C===w.d.DOUBLESIDE?L.concat(L):L;Z.AH=H}return Z}function b(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new h.c(H,J);u.sideOrientation=h.c._GetDefaultSideOrientation(u.sideOrientation),O._originalBuilderSideOrientation=u.sideOrientation;return B(u).cH(O,u.updatable),O}w.d.CreateBox=B,h.c.CreateBox=function(H,u){return b(H,{size:u,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13704:(H,u,J)=>{"use strict";J.d(u,{b:()=>g});var O=J(12770),U=J(12746),h=J(12396);function w(H){const u=[],J=[],O=[],w=[],g=H.radius||.5,B=H.tessellation||64,b=H.arc&&(H.arc<=0||H.arc>1)?1:H.arc||1,d=0===H.sideOrientation?0:H.sideOrientation||U.d.DEFAULTSIDE;u.push(0,0,0),w.push(.5,.5);const G=2*Math.PI*b,P=1===b?G/B:G/(B-1);let mH=0;for(let U=0;U<B;U++){const H=Math.cos(mH),J=Math.sin(mH),O=(H+1)/2,U=(1-J)/2;u.push(g*H,g*J,0),w.push(O,h.e?1-U:U),mH+=P}1===b&&(u.push(u[3],u[4],u[5]),w.push(w[2],h.e?1-w[3]:w[3]));const l=u.length/3;for(let U=1;U<l-1;U++)J.push(U+1,0,U);U.d.ComputeNormals(u,J,O),U.d._ComputeSides(d,u,J,O,w,H.frontUVs,H.backUVs);const r=new U.d;return r.indices=J,r.FH=u,r.sH=O,r.tH=w,r}function g(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new O.c(H,J);u.sideOrientation=O.c._GetDefaultSideOrientation(u.sideOrientation),U._originalBuilderSideOrientation=u.sideOrientation;return w(u).cH(U,u.updatable),U}U.d.CreateDisc=w,O.c.CreateDisc=function(H,u,J){return g(H,{radius:u,tessellation:J,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13553:(H,u,J)=>{"use strict";J.d(u,{f:()=>p,b:()=>k,i:()=>a});var O=J(12338),U=J(12379),h=J(12770),w=J(12746),g=J(12410);h.c._GroundMeshParser=(H,u)=>B.Parse(H,u);class B extends h.c{constructor(H,u){super(H,u),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=H,this._subdivisionsY=H,this.subdivide(H);const J=this;J.createOrUpdateSubmeshesOctree&&J.createOrUpdateSubmeshesOctree(u)}getHeightAtCoordinates(H,u){const J=this.getWorldMatrix(),U=O.TmpVectors.Matrix[5];J.invertToRef(U);const h=O.TmpVectors.lu[8];if(O.lu.TransformCoordinatesFromFloatsToRef(H,0,u,U,h),H=h.x,u=h.z,H<this._minX||H>=this._maxX||u<=this._minZ||u>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const w=this._getFacetAt(H,u),g=-(w.x*H+w.z*u+w.w)/w.y;return O.lu.TransformCoordinatesFromFloatsToRef(0,g,0,J,h),h.y}getNormalAtCoordinates(H,u){const J=new O.lu(0,1,0);return this.getNormalAtCoordinatesToRef(H,u,J),J}getNormalAtCoordinatesToRef(H,u,J){const U=this.getWorldMatrix(),h=O.TmpVectors.Matrix[5];U.invertToRef(h);const w=O.TmpVectors.lu[8];if(O.lu.TransformCoordinatesFromFloatsToRef(H,0,u,h,w),H=w.x,u=w.z,H<this._minX||H>this._maxX||u<this._minZ||u>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const g=this._getFacetAt(H,u);return O.lu.TransformNormalFromFloatsToRef(g.x,g.y,g.z,U,J),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(H,u){const J=Math.floor((H+this._maxX)*this._subdivisionsX/this._width),O=Math.floor(-(u+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),U=this._heightQuads[O*this._subdivisionsX+J];let h;return h=u<U.slope.x*H+U.slope.y?U.facet1:U.facet2,h}_initHeightQuads(){const H=this._subdivisionsX,u=this._subdivisionsY;this._heightQuads=[];for(let J=0;J<u;J++)for(let u=0;u<H;u++){const U={slope:O.Vector2.Zero(),facet1:new O.Vector4(0,0,0,0),facet2:new O.Vector4(0,0,0,0)};this._heightQuads[J*H+u]=U}return this}_computeHeightQuads(){const H=this.getVerticesData(g.d.PositionKind);if(!H)return this;const u=O.TmpVectors.lu[3],J=O.TmpVectors.lu[2],U=O.TmpVectors.lu[1],h=O.TmpVectors.lu[0],w=O.TmpVectors.lu[4],B=O.TmpVectors.lu[5],b=O.TmpVectors.lu[6],d=O.TmpVectors.lu[7],G=O.TmpVectors.lu[8];let P=0,mH=0,l=0,r=0,p=0,a=0,k=0;const C=this._subdivisionsX,j=this._subdivisionsY;for(let g=0;g<j;g++)for(let j=0;j<C;j++){P=3*j,mH=g*(C+1)*3,l=(g+1)*(C+1)*3,u.x=H[mH+P],u.y=H[mH+P+1],u.z=H[mH+P+2],J.x=H[mH+P+3],J.y=H[mH+P+4],J.z=H[mH+P+5],U.x=H[l+P],U.y=H[l+P+1],U.z=H[l+P+2],h.x=H[l+P+3],h.y=H[l+P+4],h.z=H[l+P+5],r=(h.z-u.z)/(h.x-u.x),p=u.z-r*u.x,J.subtractToRef(u,w),U.subtractToRef(u,B),h.subtractToRef(u,b),O.lu.CrossToRef(b,B,d),O.lu.CrossToRef(w,b,G),d.normalize(),G.normalize(),a=-(d.x*u.x+d.y*u.y+d.z*u.z),k=-(G.x*J.x+G.y*J.y+G.z*J.z);const M=this._heightQuads[g*C+j];M.slope.kg(r,p),M.facet1.kg(d.x,d.y,d.z,a),M.facet2.kg(G.x,G.y,G.z,k)}return this}serialize(H){super.serialize(H),H.subdivisionsX=this._subdivisionsX,H.subdivisionsY=this._subdivisionsY,H.minX=this._minX,H.maxX=this._maxX,H.Ug=this._minZ,H.maxZ=this._maxZ,H.width=this._width,H.height=this._height}static Parse(H,u){const J=new B(H.name,u);return J._subdivisionsX=H.subdivisionsX||1,J._subdivisionsY=H.subdivisionsY||1,J._minX=H.minX,J._maxX=H.maxX,J._minZ=H.Ug,J._maxZ=H.maxZ,J._width=H.width,J._height=H.height,J}}var b=J(12171),d=J(12203),G=J(12343),P=J(12396);function mH(H){const u=[],J=[],U=[],h=[];let g,B;const b=H.width||H.size||1,d=H.height||H.size||1,G=0|(H.subdivisionsX||H.subdivisions||1),mH=0|(H.subdivisionsY||H.subdivisions||1);for(g=0;g<=mH;g++)for(B=0;B<=G;B++){const H=new O.lu(B*b/G-b/2,0,(mH-g)*d/mH-d/2),u=new O.lu(0,1,0);J.push(H.x,H.y,H.z),U.push(u.x,u.y,u.z),h.push(B/G,P.e?g/mH:1-g/mH)}for(g=0;g<mH;g++)for(B=0;B<G;B++)u.push(B+1+(g+1)*(G+1)),u.push(B+1+g*(G+1)),u.push(B+g*(G+1)),u.push(B+(g+1)*(G+1)),u.push(B+1+(g+1)*(G+1)),u.push(B+g*(G+1));const l=new w.d;return l.indices=u,l.FH=J,l.sH=U,l.tH=h,l}function l(H){const u=void 0!==H.xmin&&null!==H.xmin?H.xmin:-1,J=void 0!==H.zmin&&null!==H.zmin?H.zmin:-1,U=void 0!==H.xmax&&null!==H.xmax?H.xmax:1,h=void 0!==H.zmax&&null!==H.zmax?H.zmax:1,g=H.subdivisions||{w:1,h:1},B=H.precision||{w:1,h:1},b=[],d=[],G=[],P=[];let mH,l,r,p;g.h=g.h<1?1:g.h,g.w=g.w<1?1:g.w,B.w=B.w<1?1:B.w,B.h=B.h<1?1:B.h;const a=(U-u)/g.w,k=(h-J)/g.h;function C(H,u,J,U){const h=d.length/3,w=B.w+1;for(mH=0;mH<B.h;mH++)for(l=0;l<B.w;l++){const H=[h+l+mH*w,h+(l+1)+mH*w,h+(l+1)+(mH+1)*w,h+l+(mH+1)*w];b.push(H[1]),b.push(H[2]),b.push(H[3]),b.push(H[0]),b.push(H[1]),b.push(H[3])}const g=O.lu.Zero(),r=new O.lu(0,1,0);for(mH=0;mH<=B.h;mH++)for(g.z=mH*(U-u)/B.h+u,l=0;l<=B.w;l++)g.x=l*(J-H)/B.w+H,g.y=0,d.push(g.x,g.y,g.z),G.push(r.x,r.y,r.z),P.push(l/B.w,mH/B.h)}for(r=0;r<g.h;r++)for(p=0;p<g.w;p++)C(u+p*a,J+r*k,u+(p+1)*a,J+(r+1)*k);const j=new w.d;return j.indices=b,j.FH=d,j.sH=G,j.tH=P,j}function r(H){const u=[],J=[],h=[],g=[];let B,b;const d=H.colorFilter||new U.ku(.3,.59,.11),P=H.alphaFilter||0;let mH=!1;if(H.minHeight>H.maxHeight){mH=!0;const u=H.maxHeight;H.maxHeight=H.minHeight,H.minHeight=u}for(B=0;B<=H.subdivisions;B++)for(b=0;b<=H.subdivisions;b++){const u=new O.lu(b*H.width/H.subdivisions-H.width/2,0,(H.subdivisions-B)*H.height/H.subdivisions-H.height/2),U=4*(((u.x+H.width/2)/H.width*(H.bufferWidth-1)|0)+((1-(u.z+H.height/2)/H.height)*(H.bufferHeight-1)|0)*H.bufferWidth);let w=H.buffer[U]/255,l=H.buffer[U+1]/255,r=H.buffer[U+2]/255;const p=H.buffer[U+3]/255;mH&&(w=1-w,l=1-l,r=1-r);const a=w*d.r+l*d.g+r*d.b;u.y=p>=P?H.minHeight+(H.maxHeight-H.minHeight)*a:H.minHeight-G.d,H.heightBuffer&&(H.heightBuffer[B*(H.subdivisions+1)+b]=u.y),J.push(u.x,u.y,u.z),h.push(0,0,0),g.push(b/H.subdivisions,1-B/H.subdivisions)}for(B=0;B<H.subdivisions;B++)for(b=0;b<H.subdivisions;b++){const O=b+1+(B+1)*(H.subdivisions+1),U=b+1+B*(H.subdivisions+1),h=b+B*(H.subdivisions+1),w=b+(B+1)*(H.subdivisions+1),g=J[3*O+1]>=H.minHeight,d=J[3*U+1]>=H.minHeight,G=J[3*h+1]>=H.minHeight;g&&d&&G&&(u.push(O),u.push(U),u.push(h));J[3*w+1]>=H.minHeight&&g&&G&&(u.push(w),u.push(O),u.push(h))}w.d.ComputeNormals(J,u,h);const l=new w.d;return l.indices=u,l.FH=J,l.sH=h,l.tH=g,l}function p(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const J=new B(H,arguments.length>2?arguments[2]:void 0);J._setReady(!1),J._subdivisionsX=u.subdivisionsX||u.subdivisions||1,J._subdivisionsY=u.subdivisionsY||u.subdivisions||1,J._width=u.width||1,J._height=u.height||1,J._maxX=J._width/2,J._maxZ=J._height/2,J._minX=-J._maxX,J._minZ=-J._maxZ;return mH(u).cH(J,u.updatable),J._setReady(!0),J}function a(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new h.c(H,J);return l(u).cH(O,u.updatable),O}function k(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const h=J.width||10,w=J.height||10,g=J.subdivisions||1,G=J.minHeight||0,P=J.maxHeight||1,mH=J.colorFilter||new U.ku(.3,.59,.11),l=J.alphaFilter||0,p=J.updatable,a=J.onReady;O=O||d.e.LastCreatedScene;const k=new B(H,O);let C;k._subdivisionsX=g,k._subdivisionsY=g,k._width=h,k._height=w,k._maxX=k._width/2,k._maxZ=k._height/2,k._minX=-k._maxX,k._minZ=-k._maxZ,k._setReady(!1),J.passHeightBufferInCallback&&(C=new Float32Array((g+1)*(g+1)));const j=(H,u,J)=>{r({width:h,height:w,subdivisions:g,minHeight:G,maxHeight:P,colorFilter:mH,buffer:H,bufferWidth:u,bufferHeight:J,alphaFilter:l,heightBuffer:C}).cH(k,p),a&&a(k,C),k._setReady(!0)};if("string"===typeof u){const H=H=>{var u;const J=H.width,U=H.height;if(O.B)return;const h=null===(u=O)||void 0===u?void 0:u.getEngine().resizeImageBitmap(H,J,U);j(h,J,U)};b.Tools.LoadImage(u,H,J.onError?J.onError:()=>{},O.offlineProvider)}else j(u.data,u.width,u.height);return k}w.d.CreateGround=mH,w.d.CreateTiledGround=l,w.d.CreateGroundFromHeightMap=r,h.c.CreateGround=(H,u,J,O,U,h)=>p(H,{width:u,height:J,subdivisions:O,updatable:h},U),h.c.CreateTiledGround=(H,u,J,O,U,h,w,g,B)=>a(H,{xmin:u,zmin:J,xmax:O,zmax:U,subdivisions:h,precision:w,updatable:B},g),h.c.CreateGroundFromHeightMap=(H,u,J,O,U,h,w,g,B,b,d)=>k(H,u,{width:J,height:O,subdivisions:U,minHeight:h,maxHeight:w,updatable:B,onReady:b,alphaFilter:d},g)},14194:(H,u,J)=>{"use strict";J.d(u,{b:()=>mH,f:()=>G,h:()=>P});var O=J(12338),U=J(12770),h=J(12746),w=J(12876),g=J(12410),B=J(12185);function b(H){const u=[],J=[],O=H.lines,U=H.AH,w=[];let g=0;for(let h=0;h<O.length;h++){const H=O[h];for(let O=0;O<H.length;O++){const{x:B,y:b,z:d}=H[O];if(J.push(B,b,d),U){const H=U[h],{r:u,g:J,b:g,a:B}=H[O];w.push(u,J,g,B)}O>0&&(u.push(g-1),u.push(g)),g++}}const B=new h.d;return B.indices=u,B.FH=J,U&&(B.AH=w),B}function d(H){const u=H.dashSize||3,J=H.gapSize||1,U=H.dashNb||200,w=H.points,g=[],B=[],b=O.lu.Zero();let d=0,G=0,P=0,mH=0,l=0,r=0,p=0;for(p=0;p<w.length-1;p++)w[p+1].subtractToRef(w[p],b),d+=b.length();for(P=d/U,mH=u*P/(u+J),p=0;p<w.length-1;p++){w[p+1].subtractToRef(w[p],b),G=Math.floor(b.length()/P),b.normalize();for(let H=0;H<G;H++)l=P*H,g.push(w[p].x+l*b.x,w[p].y+l*b.y,w[p].z+l*b.z),g.push(w[p].x+(l+mH)*b.x,w[p].y+(l+mH)*b.y,w[p].z+(l+mH)*b.z),B.push(r,r+1),r+=2}const a=new h.d;return a.FH=g,a.indices=B,a}function G(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=u.instance,U=u.lines,h=u.AH;if(O){const H=O.getVerticesData(g.d.PositionKind);let u,J;h&&(u=O.getVerticesData(g.d.ColorKind));let w=0,B=0;for(let O=0;O<U.length;O++){const g=U[O];for(let U=0;U<g.length;U++)H[w]=g[U].x,H[w+1]=g[U].y,H[w+2]=g[U].z,h&&u&&(J=h[O],u[B]=J[U].r,u[B+1]=J[U].g,u[B+2]=J[U].b,u[B+3]=J[U].a,B+=4),w+=3}return O.updateVerticesData(g.d.PositionKind,H,!1,!1),h&&u&&O.updateVerticesData(g.d.ColorKind,u,!1,!1),O.refreshBoundingInfo(),O}const B=!!h,d=new w.b(H,J,null,void 0,void 0,B,u.useVertexAlpha,u.material);return b(u).cH(d,u.updatable),d}function P(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=u.AH?[u.AH]:null;return G(H,{lines:[u.points],updatable:u.updatable,instance:u.instance,AH:O,useVertexAlpha:u.useVertexAlpha,material:u.material},J)}function mH(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=u.points,g=u.instance,b=u.gapSize||1,G=u.dashSize||3;if(g){const H=H=>{const u=O.lu.Zero(),J=H.length/6;let U=0,w=0,B=0,b=0,d=0,G=0,P=0,mH=0;for(P=0;P<h.length-1;P++)h[P+1].subtractToRef(h[P],u),U+=u.length();B=U/J;const l=g._creationDataStorage.dashSize;for(b=l*B/(l+g._creationDataStorage.gapSize),P=0;P<h.length-1;P++)for(h[P+1].subtractToRef(h[P],u),w=Math.floor(u.length()/B),u.normalize(),mH=0;mH<w&&G<H.length;)d=B*mH,H[G]=h[P].x+d*u.x,H[G+1]=h[P].y+d*u.y,H[G+2]=h[P].z+d*u.z,H[G+3]=h[P].x+(d+b)*u.x,H[G+4]=h[P].y+(d+b)*u.y,H[G+5]=h[P].z+(d+b)*u.z,G+=6,mH++;for(;G<H.length;)H[G]=h[P].x,H[G+1]=h[P].y,H[G+2]=h[P].z,G+=3};return(u.dashNb||u.dashSize||u.gapSize||u.useVertexAlpha||u.material)&&B.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),g.updateMeshPositions(H,!1),g}const P=new w.b(H,J,null,void 0,void 0,void 0,u.useVertexAlpha,u.material);return d(u).cH(P,u.updatable),P._creationDataStorage=new U.d,P._creationDataStorage.dashSize=G,P._creationDataStorage.gapSize=b,P}h.d.CreateLineSystem=b,h.d.CreateDashedLines=d,U.c.Zd=function(H,u){return P(H,{points:u,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},U.c.CreateDashedLines=function(H,u,J,O,U){return mH(H,{points:u,dashSize:J,gapSize:O,dashNb:U,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13605:(H,u,J)=>{"use strict";J.d(u,{b:()=>g,d:()=>B});var O=J(12770),U=J(12746),h=J(12396);function w(H){const u=[],J=[],O=[],w=[],g=void 0!==H.width?H.width:void 0!==H.size?H.size:1,B=void 0!==H.height?H.height:void 0!==H.size?H.size:1,b=0===H.sideOrientation?0:H.sideOrientation||U.d.DEFAULTSIDE,d=g/2,G=B/2;J.push(-d,-G,0),O.push(0,0,-1),w.push(0,h.e?1:0),J.push(d,-G,0),O.push(0,0,-1),w.push(1,h.e?1:0),J.push(d,G,0),O.push(0,0,-1),w.push(1,h.e?0:1),J.push(-d,G,0),O.push(0,0,-1),w.push(0,h.e?0:1),u.push(0),u.push(1),u.push(2),u.push(0),u.push(2),u.push(3),U.d._ComputeSides(b,J,u,O,w,H.frontUVs,H.backUVs);const P=new U.d;return P.indices=u,P.FH=J,P.sH=O,P.tH=w,P}function g(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const U=new O.c(H,J);u.sideOrientation=O.c._GetDefaultSideOrientation(u.sideOrientation),U._originalBuilderSideOrientation=u.sideOrientation;return w(u).cH(U,u.updatable),u.sourcePlane&&(U.translate(u.sourcePlane.normal,-u.sourcePlane.d),U.setDirection(u.sourcePlane.normal.scale(-1))),U}const B={sd:g};U.d.sd=w,O.c.sd=(H,u,J,O,U)=>g(H,{size:u,width:u,height:u,sideOrientation:U,updatable:O},J)},13694:(H,u,J)=>{"use strict";J.d(u,{d:()=>B});var O=J(12338),U=J(12770),h=J(12746),w=J(12396);function g(H){const u=0|(H.segments||32),J=H.diameterX||H.diameter||1,U=H.diameterY||H.diameter||1,g=H.diameterZ||H.diameter||1,B=H.arc&&(H.arc<=0||H.arc>1)?1:H.arc||1,b=H.slice&&H.slice<=0?1:H.slice||1,d=0===H.sideOrientation?0:H.sideOrientation||h.d.DEFAULTSIDE,G=!!H.dedupTopBottomIndices,P=new O.lu(J/2,U/2,g/2),mH=2+u,l=2*mH,r=[],p=[],a=[],k=[];for(let h=0;h<=mH;h++){const H=h/mH,u=H*Math.PI*b;for(let J=0;J<=l;J++){const U=J/l,h=U*Math.PI*2*B,g=O.Matrix.RotationZ(-u),b=O.Matrix.RotationY(h),d=O.lu.TransformCoordinates(O.lu.Up(),g),G=O.lu.TransformCoordinates(d,b),mH=G.multiply(P),r=G.divide(P).normalize();p.push(mH.x,mH.y,mH.z),a.push(r.x,r.y,r.z),k.push(U,w.e?1-H:H)}if(h>0){const H=p.length/3;for(let u=H-2*(l+1);u+l+2<H;u++)G?(h>1&&(r.push(u),r.push(u+1),r.push(u+l+1)),(h<mH||b<1)&&(r.push(u+l+1),r.push(u+1),r.push(u+l+2))):(r.push(u),r.push(u+1),r.push(u+l+1),r.push(u+l+1),r.push(u+1),r.push(u+l+2))}}h.d._ComputeSides(d,p,r,a,k,H.frontUVs,H.backUVs);const C=new h.d;return C.indices=r,C.FH=p,C.sH=a,C.tH=k,C}function B(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new U.c(H,J);u.sideOrientation=U.c._GetDefaultSideOrientation(u.sideOrientation),O._originalBuilderSideOrientation=u.sideOrientation;return g(u).cH(O,u.updatable),O}h.d.CreateSphere=g,U.c.CreateSphere=(H,u,J,O,U,h)=>B(H,{segments:u,diameterX:J,diameterY:J,diameterZ:J,sideOrientation:h,updatable:U},O)},14503:(H,u,J)=>{"use strict";J.d(u,{d:()=>g});var O=J(12895),U=J(14001),h=J(12917),w=J(12746);class g{static get Configuration(){return{get decoder(){return U.d.DefaultConfiguration},set decoder(H){U.d.DefaultConfiguration=H}}}static set Configuration(H){U.d.DefaultConfiguration=H.decoder}static get DecoderAvailable(){return(0,O.i)(U.d.DefaultConfiguration)}static get Default(){return g._Default??(g._Default=new g),g._Default}static ResetDefault(H){g._Default&&(H||g._Default.dispose(),g._Default=null)}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.DefaultNumWorkers;const u="number"===typeof H?{...U.d.DefaultConfiguration,numWorkers:H}:{...U.d.DefaultConfiguration,...H};this._decoder=new U.d(u)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(H,u,J){return this._decoder.decodeMeshToMeshDataAsync(H,u,J)}async decodeMeshToGeometryAsync(H,u,J,O){return await this._decoder.decodeMeshToGeometryAsync(H,u,J,O)}async _decodeMeshToGeometryForGltfAsync(H,u,J,O,U,h){return await this._decoder._decodeMeshToGeometryForGltfAsync(H,u,J,O,U,h)}async decodeMeshAsync(H,u){const J=await this._decoder.decodeMeshToMeshDataAsync(H,u),O=new w.d;J.indices&&(O.indices=J.indices);for(const U of J.attributes){const H=h.c.GetFloatData(U.data,U.size,h.c.GetDataType(U.data),U.byteOffset,U.byteStride,U.normalized,J.totalVertices);O.set(H,U.kind)}return O}}g.DefaultNumWorkers=(0,O.f)(),g._Default=null},14001:(H,u,J)=>{"use strict";J.d(u,{d:()=>b});var O=J(12895),U=J(12171),h=J(12776),w=J(12917),g=J(12185),B=J(12911);class b extends O.b{static get DefaultAvailable(){return(0,O.i)(b.DefaultConfiguration)}static get Default(){return b._Default??(b._Default=new b),b._Default}static ResetDefault(H){b._Default&&(H||b._Default.dispose(),b._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(H,u){return{module:await(u||DracoDecoderModule)({wasmBinary:H})}}_getWorkerContent(){return`${B.e}(${B.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.DefaultConfiguration)}decodeMeshToMeshDataAsync(H,u,J){const O=H instanceof ArrayBuffer?new Int8Array(H):new Int8Array(H.buffer,H.byteOffset,H.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async H=>await new Promise(((U,h)=>{H.push(((H,w)=>{let B=null;const b=[],d=u=>{H.removeEventListener("error",d),H.removeEventListener("message",G),h(u),w()},G=u=>{const O=u.data;switch(O.id){case"indices":B=O.data;break;case"attribute":b.push({kind:O.kind,data:O.data,size:O.size,byteOffset:O.byteOffset,byteStride:O.byteStride,normalized:(h=O.kind,P=O.normalized,J&&void 0!==J[h]?(P!==J[h]&&g.b.Warn(`Normalized flag from Draco data (${P}) does not match normalized flag from glTF accessor (${J[h]}). Using flag from glTF accessor.`),J[h]):P)});break;case"decodeMeshDone":H.removeEventListener("error",d),H.removeEventListener("message",G),U({indices:B,attributes:b,totalVertices:O.totalVertices}),w()}var h,P};H.addEventListener("error",d),H.addEventListener("message",G);const P=O.slice();H.postMessage({id:"decodeMesh",dataView:P,attributes:u},[P.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((H=>{let J=null;const U=[],h=(0,B.e)(H.module,O,u,(H=>{J=H}),((H,u,J,O,h,w)=>{U.push({kind:H,data:u,size:J,byteOffset:O,byteStride:h,normalized:w})}));return{indices:J,attributes:U,totalVertices:h}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(H,u,J,O){const U=await this.decodeMeshToMeshDataAsync(J,O),g=new h.b(H,u);U.indices&&g.setIndices(U.indices);for(const h of U.attributes)g.setVerticesBuffer(new w.c(u.getEngine(),h.data,h.kind,!1,void 0,h.byteStride,void 0,h.byteOffset,h.size,void 0,h.normalized,!0),U.totalVertices);return g}async _decodeMeshToGeometryForGltfAsync(H,u,J,O,U,g){const B=await this.decodeMeshToMeshDataAsync(J,O,U),b=new h.b(H,u);g&&(b._boundingInfo=g,b.useBoundingInfoFromGeometry=!0),B.indices&&b.setIndices(B.indices);for(const h of B.attributes)b.setVerticesBuffer(new w.c(u.getEngine(),h.data,h.kind,!1,void 0,h.byteStride,void 0,h.byteOffset,h.size,void 0,h.normalized,!0),B.totalVertices);return b}}b.DefaultConfiguration={wasmUrl:`${U.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${U.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${U.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},b._Default=null},14189:(H,u,J)=>{"use strict";J.d(u,{b:()=>gH});var O=J(12338),U=J(12770),h=J(12410),w=J(12746),g=J(12396);function B(H){let u=H.pathArray;const J=H.closeArray||!1,O=H.closePath||!1,U=H.invertUV||!1,B=Math.floor(u[0].length/2);let b=H.offset||B;b=b>B?B:Math.floor(b);const d=0===H.sideOrientation?0:H.sideOrientation||w.d.DEFAULTSIDE,G=H.tH,P=H.AH,mH=[],l=[],r=[],p=[],a=[],k=[],C=[],j=[];let M;const L=[],Z=[];let Y,F,s;if(u.length<2){const H=[],J=[];for(F=0;F<u[0].length-b;F++)H.push(u[0][F]),J.push(u[0][F+b]);u=[H,J]}let A=0;const t=O?1:0,e=J?1:0;let c,n,V,T,R,X;for(M=u[0].length,Y=0;Y<u.length+e;Y++){for(C[Y]=0,a[Y]=[0],c=Y===u.length?u[0]:u[Y],n=c.length,M=M<n?M:n,s=0;s<n;)mH.push(c[s].x,c[s].y,c[s].z),s>0&&(V=c[s].ru(c[s-1]).length(),T=V+C[Y],a[Y].push(T),C[Y]=T),s++;O&&(s--,mH.push(c[0].x,c[0].y,c[0].z),V=c[s].ru(c[0]).length(),T=V+C[Y],a[Y].push(T),C[Y]=T),L[Y]=n+t,Z[Y]=A,A+=n+t}let W,f,i=null,S=null;for(F=0;F<M+t;F++)for(j[F]=0,k[F]=[0],Y=0;Y<u.length-1+e;Y++)R=u[Y],X=Y===u.length-1?u[0]:u[Y+1],F===M?(i=R[0],S=X[0]):(i=R[F],S=X[F]),V=S.ru(i).length(),T=V+j[F],k[F].push(T),j[F]=T;if(G)for(Y=0;Y<G.length;Y++)p.push(G[Y].x,g.e?1-G[Y].y:G[Y].y);else for(Y=0;Y<u.length+e;Y++)for(F=0;F<M+t;F++)W=0!=C[Y]?a[Y][F]/C[Y]:0,f=0!=j[F]?k[F][Y]/j[F]:0,U?p.push(f,W):p.push(W,g.e?1-f:f);Y=0;let v=0,I=L[Y]-1,D=L[Y+1]-1,o=I<D?I:D,y=Z[1]-Z[0];const x=L.length-1;for(;v<=o&&Y<x;)l.push(v,v+y,v+1),l.push(v+y+1,v+1,v+y),v+=1,v===o&&(Y++,y=Z[Y+1]-Z[Y],I=L[Y]-1,D=L[Y+1]-1,v=Z[Y],o=I<D?I+v:D+v);if(w.d.ComputeNormals(mH,l,r),O){let H=0,J=0;for(Y=0;Y<u.length;Y++){H=3*Z[Y],J=Y+1<u.length?3*(Z[Y+1]-1):r.length-3,r[H]=.5*(r[H]+r[J]),r[H+1]=.5*(r[H+1]+r[J+1]),r[H+2]=.5*(r[H+2]+r[J+2]);const O=Math.sqrt(r[H]*r[H]+r[H+1]*r[H+1]+r[H+2]*r[H+2]);r[H]/=O,r[H+1]/=O,r[H+2]/=O,r[J]=r[H],r[J+1]=r[H+1],r[J+2]=r[H+2]}}if(J){let H=3*Z[0],J=3*Z[u.length];for(F=0;F<M+t;F++){r[H]=.5*(r[H]+r[J]),r[H+1]=.5*(r[H+1]+r[J+1]),r[H+2]=.5*(r[H+2]+r[J+2]);const u=Math.sqrt(r[H]*r[H]+r[H+1]*r[H+1]+r[H+2]*r[H+2]);r[H]/=u,r[H+1]/=u,r[H+2]/=u,r[J]=r[H],r[J+1]=r[H+1],r[J+2]=r[H+2],H+=3,J+=3}}w.d._ComputeSides(d,mH,l,r,p,H.frontUVs,H.backUVs);let z=null;if(P){z=new Float32Array(4*P.length);for(let H=0;H<P.length;H++)z[4*H]=P[H].r,z[4*H+1]=P[H].g,z[4*H+2]=P[H].b,z[4*H+3]=P[H].a}const K=new w.d,N=new Float32Array(mH),q=new Float32Array(r),E=new Float32Array(p);return K.indices=l,K.FH=N,K.sH=q,K.tH=E,z&&K.set(z,h.d.ColorKind),O&&(K._idx=Z),K}function b(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=u.pathArray,d=u.closeArray,G=u.closePath,P=U.c._GetDefaultSideOrientation(u.sideOrientation),mH=u.instance,l=u.updatable;if(mH){const H=O.TmpVectors.lu[0].jg(Number.MAX_VALUE),J=O.TmpVectors.lu[1].jg(-Number.MAX_VALUE),B=u=>{let O=b[0].length;const h=mH;let w=0;const g=h._originalBuilderSideOrientation===U.c.DOUBLESIDE?2:1;for(let U=1;U<=g;++U)for(let g=0;g<b.length;++g){const U=b[g],B=U.length;O=O<B?O:B;for(let h=0;h<O;++h){const O=U[h];u[w]=O.x,u[w+1]=O.y,u[w+2]=O.z,H.minimizeInPlaceFromFloats(O.x,O.y,O.z),J.maximizeInPlaceFromFloats(O.x,O.y,O.z),w+=3}if(h._creationDataStorage&&h._creationDataStorage.closePath){const H=U[0];u[w]=H.x,u[w+1]=H.y,u[w+2]=H.z,w+=3}}},d=mH.getVerticesData(h.d.PositionKind);if(B(d),mH.hasBoundingInfo?mH.getBoundingInfo().reConstruct(H,J,mH._worldMatrix):mH.buildBoundingInfo(H,J,mH._worldMatrix),mH.updateVerticesData(h.d.PositionKind,d,!1,!1),u.AH){const H=mH.getVerticesData(h.d.ColorKind);for(let J=0,O=0;J<u.AH.length;J++,O+=4){const U=u.AH[J];H[O]=U.r,H[O+1]=U.g,H[O+2]=U.b,H[O+3]=U.a}mH.updateVerticesData(h.d.ColorKind,H,!1,!1)}if(u.tH){const H=mH.getVerticesData(h.d.UVKind);for(let J=0;J<u.tH.length;J++)H[2*J]=u.tH[J].x,H[2*J+1]=g.e?1-u.tH[J].y:u.tH[J].y;mH.updateVerticesData(h.d.UVKind,H,!1,!1)}if(!mH.areNormalsFrozen||mH.isFacetDataEnabled){const H=mH.rg(),u=mH.getVerticesData(h.d.NormalKind),J=mH.isFacetDataEnabled?mH.getFacetDataParameters():null;if(w.d.ComputeNormals(d,H,u,J),mH._creationDataStorage&&mH._creationDataStorage.closePath){let H=0,J=0;for(let O=0;O<b.length;O++)H=3*mH._creationDataStorage.idx[O],J=O+1<b.length?3*(mH._creationDataStorage.idx[O+1]-1):u.length-3,u[H]=.5*(u[H]+u[J]),u[H+1]=.5*(u[H+1]+u[J+1]),u[H+2]=.5*(u[H+2]+u[J+2]),u[J]=u[H],u[J+1]=u[H+1],u[J+2]=u[H+2]}mH.areNormalsFrozen||mH.updateVerticesData(h.d.NormalKind,u,!1,!1)}return mH}{const O=new U.c(H,J);O._originalBuilderSideOrientation=P,O._creationDataStorage=new U.d;const h=B(u);return G&&(O._creationDataStorage.idx=h._idx),O._creationDataStorage.closePath=G,O._creationDataStorage.closeArray=d,h.cH(O,l),O}}w.d.CreateRibbon=B,U.c.CreateRibbon=function(H,u){return b(H,{pathArray:u,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var d=J(13704),G=J(13549),P=J(12379);function mH(H){const u=H.pattern||U.c.NO_FLIP,J=H.tileWidth||H.tileSize||1,O=H.tileHeight||H.tileSize||1,h=H.alignHorizontal||0,g=H.alignVertical||0,B=H.width||H.size||1,b=Math.floor(B/J);let d=B-b*J;const G=H.height||H.size||1,P=Math.floor(G/O);let mH=G-P*O;const l=J*b/2,r=O*P/2;let p=0,a=0,k=0,C=0,j=0,M=0;if(d>0||mH>0){switch(k=-l,C=-r,j=l,M=r,h){case U.c.CENTER:d/=2,k-=d,j+=d;break;case U.c.LEFT:j+=d,p=-d/2;break;case U.c.RIGHT:k-=d,p=d/2}switch(g){case U.c.CENTER:mH/=2,C-=mH,M+=mH;break;case U.c.BOTTOM:M+=mH,a=-mH/2;break;case U.c.TOP:C-=mH,a=mH/2}}const L=[],Z=[],Y=[];Y[0]=[0,0,1,0,1,1,0,1],Y[1]=[0,0,1,0,1,1,0,1],u!==U.c.ROTATE_TILE&&u!==U.c.ROTATE_ROW||(Y[1]=[1,1,0,1,0,0,1,0]),u!==U.c.FLIP_TILE&&u!==U.c.FLIP_ROW||(Y[1]=[1,0,0,0,0,1,1,1]),u!==U.c.FLIP_N_ROTATE_TILE&&u!==U.c.FLIP_N_ROTATE_ROW||(Y[1]=[0,1,1,1,1,0,0,0]);let F=[];const s=[],A=[];let t=0;for(let w=0;w<P;w++)for(let H=0;H<b;H++)L.push(H*J-l+p,w*O-r+a,0),L.push((H+1)*J-l+p,w*O-r+a,0),L.push((H+1)*J-l+p,(w+1)*O-r+a,0),L.push(H*J-l+p,(w+1)*O-r+a,0),A.push(t,t+1,t+3,t+1,t+2,t+3),F=u===U.c.FLIP_TILE||u===U.c.ROTATE_TILE||u===U.c.FLIP_N_ROTATE_TILE?F.concat(Y[(H%2+w%2)%2]):u===U.c.FLIP_ROW||u===U.c.ROTATE_ROW||u===U.c.FLIP_N_ROTATE_ROW?F.concat(Y[w%2]):F.concat(Y[0]),s.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),t+=4;if(d>0||mH>0){const H=mH>0&&(g===U.c.CENTER||g===U.c.TOP),w=mH>0&&(g===U.c.CENTER||g===U.c.BOTTOM),B=d>0&&(h===U.c.CENTER||h===U.c.RIGHT),G=d>0&&(h===U.c.CENTER||h===U.c.LEFT);let Y,e,c,n,V=[];if(H&&B&&(L.push(k+p,C+a,0),L.push(-l+p,C+a,0),L.push(-l+p,C+mH+a,0),L.push(k+p,C+mH+a,0),A.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,Y=1-d/J,e=1-mH/O,c=1,n=1,V=[Y,e,c,e,c,n,Y,n],u===U.c.ROTATE_ROW&&(V=[1-Y,1-e,1-c,1-e,1-c,1-n,1-Y,1-n]),u===U.c.FLIP_ROW&&(V=[1-Y,e,1-c,e,1-c,n,1-Y,n]),u===U.c.FLIP_N_ROTATE_ROW&&(V=[Y,1-e,c,1-e,c,1-n,Y,1-n]),F=F.concat(V),s.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),H&&G&&(L.push(l+p,C+a,0),L.push(j+p,C+a,0),L.push(j+p,C+mH+a,0),L.push(l+p,C+mH+a,0),A.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,Y=0,e=1-mH/O,c=d/J,n=1,V=[Y,e,c,e,c,n,Y,n],(u===U.c.ROTATE_ROW||u===U.c.ROTATE_TILE&&b%2===0)&&(V=[1-Y,1-e,1-c,1-e,1-c,1-n,1-Y,1-n]),(u===U.c.FLIP_ROW||u===U.c.FLIP_TILE&&b%2===0)&&(V=[1-Y,e,1-c,e,1-c,n,1-Y,n]),(u===U.c.FLIP_N_ROTATE_ROW||u===U.c.FLIP_N_ROTATE_TILE&&b%2===0)&&(V=[Y,1-e,c,1-e,c,1-n,Y,1-n]),F=F.concat(V),s.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w&&B&&(L.push(k+p,r+a,0),L.push(-l+p,r+a,0),L.push(-l+p,M+a,0),L.push(k+p,M+a,0),A.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,Y=1-d/J,e=0,c=1,n=mH/O,V=[Y,e,c,e,c,n,Y,n],(u===U.c.ROTATE_ROW&&P%2===1||u===U.c.ROTATE_TILE&&P%1===0)&&(V=[1-Y,1-e,1-c,1-e,1-c,1-n,1-Y,1-n]),(u===U.c.FLIP_ROW&&P%2===1||u===U.c.FLIP_TILE&&P%2===0)&&(V=[1-Y,e,1-c,e,1-c,n,1-Y,n]),(u===U.c.FLIP_N_ROTATE_ROW&&P%2===1||u===U.c.FLIP_N_ROTATE_TILE&&P%2===0)&&(V=[Y,1-e,c,1-e,c,1-n,Y,1-n]),F=F.concat(V),s.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w&&G&&(L.push(l+p,r+a,0),L.push(j+p,r+a,0),L.push(j+p,M+a,0),L.push(l+p,M+a,0),A.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,Y=0,e=0,c=d/J,n=mH/O,V=[Y,e,c,e,c,n,Y,n],(u===U.c.ROTATE_ROW&&P%2===1||u===U.c.ROTATE_TILE&&(P+b)%2===1)&&(V=[1-Y,1-e,1-c,1-e,1-c,1-n,1-Y,1-n]),(u===U.c.FLIP_ROW&&P%2===1||u===U.c.FLIP_TILE&&(P+b)%2===1)&&(V=[1-Y,e,1-c,e,1-c,n,1-Y,n]),(u===U.c.FLIP_N_ROTATE_ROW&&P%2===1||u===U.c.FLIP_N_ROTATE_TILE&&(P+b)%2===1)&&(V=[Y,1-e,c,1-e,c,1-n,Y,1-n]),F=F.concat(V),s.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),H){const H=[];Y=0,e=1-mH/O,c=1,n=1,H[0]=[Y,e,c,e,c,n,Y,n],H[1]=[Y,e,c,e,c,n,Y,n],u!==U.c.ROTATE_TILE&&u!==U.c.ROTATE_ROW||(H[1]=[1-Y,1-e,1-c,1-e,1-c,1-n,1-Y,1-n]),u!==U.c.FLIP_TILE&&u!==U.c.FLIP_ROW||(H[1]=[1-Y,e,1-c,e,1-c,n,1-Y,n]),u!==U.c.FLIP_N_ROTATE_TILE&&u!==U.c.FLIP_N_ROTATE_ROW||(H[1]=[Y,1-e,c,1-e,c,1-n,Y,1-n]);for(let O=0;O<b;O++)L.push(O*J-l+p,C+a,0),L.push((O+1)*J-l+p,C+a,0),L.push((O+1)*J-l+p,C+mH+a,0),L.push(O*J-l+p,C+mH+a,0),A.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,F=u===U.c.FLIP_TILE||u===U.c.ROTATE_TILE||u===U.c.FLIP_N_ROTATE_TILE?F.concat(H[(O+1)%2]):u===U.c.FLIP_ROW||u===U.c.ROTATE_ROW||u===U.c.FLIP_N_ROTATE_ROW?F.concat(H[1]):F.concat(H[0]),s.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(w){const H=[];Y=0,e=0,c=1,n=mH/O,H[0]=[Y,e,c,e,c,n,Y,n],H[1]=[Y,e,c,e,c,n,Y,n],u!==U.c.ROTATE_TILE&&u!==U.c.ROTATE_ROW||(H[1]=[1-Y,1-e,1-c,1-e,1-c,1-n,1-Y,1-n]),u!==U.c.FLIP_TILE&&u!==U.c.FLIP_ROW||(H[1]=[1-Y,e,1-c,e,1-c,n,1-Y,n]),u!==U.c.FLIP_N_ROTATE_TILE&&u!==U.c.FLIP_N_ROTATE_ROW||(H[1]=[Y,1-e,c,1-e,c,1-n,Y,1-n]);for(let O=0;O<b;O++)L.push(O*J-l+p,M-mH+a,0),L.push((O+1)*J-l+p,M-mH+a,0),L.push((O+1)*J-l+p,M+a,0),L.push(O*J-l+p,M+a,0),A.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,F=u===U.c.FLIP_TILE||u===U.c.ROTATE_TILE||u===U.c.FLIP_N_ROTATE_TILE?F.concat(H[(O+P)%2]):u===U.c.FLIP_ROW||u===U.c.ROTATE_ROW||u===U.c.FLIP_N_ROTATE_ROW?F.concat(H[P%2]):F.concat(H[0]),s.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(B){const H=[];Y=1-d/J,e=0,c=1,n=1,H[0]=[Y,e,c,e,c,n,Y,n],H[1]=[Y,e,c,e,c,n,Y,n],u!==U.c.ROTATE_TILE&&u!==U.c.ROTATE_ROW||(H[1]=[1-Y,1-e,1-c,1-e,1-c,1-n,1-Y,1-n]),u!==U.c.FLIP_TILE&&u!==U.c.FLIP_ROW||(H[1]=[1-Y,e,1-c,e,1-c,n,1-Y,n]),u!==U.c.FLIP_N_ROTATE_TILE&&u!==U.c.FLIP_N_ROTATE_ROW||(H[1]=[Y,1-e,c,1-e,c,1-n,Y,1-n]);for(let J=0;J<P;J++)L.push(k+p,J*O-r+a,0),L.push(k+d+p,J*O-r+a,0),L.push(k+d+p,(J+1)*O-r+a,0),L.push(k+p,(J+1)*O-r+a,0),A.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,F=u===U.c.FLIP_TILE||u===U.c.ROTATE_TILE||u===U.c.FLIP_N_ROTATE_TILE?F.concat(H[(J+1)%2]):u===U.c.FLIP_ROW||u===U.c.ROTATE_ROW||u===U.c.FLIP_N_ROTATE_ROW?F.concat(H[J%2]):F.concat(H[0]),s.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(G){const H=[];Y=0,e=0,c=d/O,n=1,H[0]=[Y,e,c,e,c,n,Y,n],H[1]=[Y,e,c,e,c,n,Y,n],u!==U.c.ROTATE_TILE&&u!==U.c.ROTATE_ROW||(H[1]=[1-Y,1-e,1-c,1-e,1-c,1-n,1-Y,1-n]),u!==U.c.FLIP_TILE&&u!==U.c.FLIP_ROW||(H[1]=[1-Y,e,1-c,e,1-c,n,1-Y,n]),u!==U.c.FLIP_N_ROTATE_TILE&&u!==U.c.FLIP_N_ROTATE_ROW||(H[1]=[Y,1-e,c,1-e,c,1-n,Y,1-n]);for(let J=0;J<P;J++)L.push(j-d+p,J*O-r+a,0),L.push(j+p,J*O-r+a,0),L.push(j+p,(J+1)*O-r+a,0),L.push(j-d+p,(J+1)*O-r+a,0),A.push(t,t+1,t+3,t+1,t+2,t+3),t+=4,F=u===U.c.FLIP_TILE||u===U.c.ROTATE_TILE||u===U.c.FLIP_N_ROTATE_TILE?F.concat(H[(J+b)%2]):u===U.c.FLIP_ROW||u===U.c.ROTATE_ROW||u===U.c.FLIP_N_ROTATE_ROW?F.concat(H[J%2]):F.concat(H[0]),s.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const e=0===H.sideOrientation?0:H.sideOrientation||w.d.DEFAULTSIDE;w.d._ComputeSides(e,L,A,Z,F,H.frontUVs,H.backUVs);const c=new w.d;c.indices=A,c.FH=L,c.sH=Z,c.tH=F;const n=e===w.d.DOUBLESIDE?s.concat(s):s;return c.AH=n,c}function l(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new U.c(H,J);u.sideOrientation=U.c._GetDefaultSideOrientation(u.sideOrientation),O._originalBuilderSideOrientation=u.sideOrientation;return mH(u).cH(O,u.updatable),O}function r(H){const u=H.faceUV||new Array(6),J=H.faceColors,h=H.pattern||U.c.NO_FLIP,B=H.width||H.size||1,b=H.height||H.size||1,d=H.depth||H.size||1,G=H.tileWidth||H.tileSize||1,l=H.tileHeight||H.tileSize||1,r=H.alignHorizontal||0,p=H.alignVertical||0,a=0===H.sideOrientation?0:H.sideOrientation||w.d.DEFAULTSIDE;for(let U=0;U<6;U++)void 0===u[U]&&(u[U]=new O.Vector4(0,0,1,1)),J&&void 0===J[U]&&(J[U]=new P.Mg(1,1,1,1));const k=B/2,C=b/2,j=d/2,M=[];for(let O=0;O<2;O++)M[O]=mH({pattern:h,tileWidth:G,tileHeight:l,width:B,height:b,alignVertical:p,alignHorizontal:r,sideOrientation:a});for(let O=2;O<4;O++)M[O]=mH({pattern:h,tileWidth:G,tileHeight:l,width:d,height:b,alignVertical:p,alignHorizontal:r,sideOrientation:a});let L=p;p===U.c.BOTTOM?L=U.c.TOP:p===U.c.TOP&&(L=U.c.BOTTOM);for(let O=4;O<6;O++)M[O]=mH({pattern:h,tileWidth:G,tileHeight:l,width:B,height:d,alignVertical:L,alignHorizontal:r,sideOrientation:a});let Z=[],Y=[],F=[],s=[];const A=[],t=[],e=[],c=[];let n=0,V=0;for(let U=0;U<6;U++){const H=M[U].FH.length;t[U]=[],e[U]=[];for(let u=0;u<H/3;u++)t[U].push(new O.lu(M[U].FH[3*u],M[U].FH[3*u+1],M[U].FH[3*u+2])),e[U].push(new O.lu(M[U].sH[3*u],M[U].sH[3*u+1],M[U].sH[3*u+2]));n=M[U].tH.length,c[U]=[];for(let J=0;J<n;J+=2)c[U][J]=u[U].x+(u[U].z-u[U].x)*M[U].tH[J],c[U][J+1]=u[U].y+(u[U].w-u[U].y)*M[U].tH[J+1],g.e&&(c[U][J+1]=1-c[U][J+1]);if(F=F.concat(c[U]),s=s.concat(M[U].indices.map((H=>H+V))),V+=t[U].length,J)for(let u=0;u<4;u++)A.push(J[U].r,J[U].g,J[U].b,J[U].a)}const T=new O.lu(0,0,j),R=O.Matrix.RotationY(Math.PI);Z=t[0].map((H=>O.lu.TransformNormal(H,R).add(T))).map((H=>[H.x,H.y,H.z])).reduce(((H,u)=>H.concat(u)),[]),Y=e[0].map((H=>O.lu.TransformNormal(H,R))).map((H=>[H.x,H.y,H.z])).reduce(((H,u)=>H.concat(u)),[]),Z=Z.concat(t[1].map((H=>H.ru(T))).map((H=>[H.x,H.y,H.z])).reduce(((H,u)=>H.concat(u)),[])),Y=Y.concat(e[1].map((H=>[H.x,H.y,H.z])).reduce(((H,u)=>H.concat(u)),[]));const X=new O.lu(k,0,0),W=O.Matrix.RotationY(-Math.PI/2);Z=Z.concat(t[2].map((H=>O.lu.TransformNormal(H,W).add(X))).map((H=>[H.x,H.y,H.z])).reduce(((H,u)=>H.concat(u)),[])),Y=Y.concat(e[2].map((H=>O.lu.TransformNormal(H,W))).map((H=>[H.x,H.y,H.z])).reduce(((H,u)=>H.concat(u)),[]));const f=O.Matrix.RotationY(Math.PI/2);Z=Z.concat(t[3].map((H=>O.lu.TransformNormal(H,f).ru(X))).map((H=>[H.x,H.y,H.z])).reduce(((H,u)=>H.concat(u)),[])),Y=Y.concat(e[3].map((H=>O.lu.TransformNormal(H,f))).map((H=>[H.x,H.y,H.z])).reduce(((H,u)=>H.concat(u)),[]));const i=new O.lu(0,C,0),S=O.Matrix.RotationX(Math.PI/2);Z=Z.concat(t[4].map((H=>O.lu.TransformNormal(H,S).add(i))).map((H=>[H.x,H.y,H.z])).reduce(((H,u)=>H.concat(u)),[])),Y=Y.concat(e[4].map((H=>O.lu.TransformNormal(H,S))).map((H=>[H.x,H.y,H.z])).reduce(((H,u)=>H.concat(u)),[]));const v=O.Matrix.RotationX(-Math.PI/2);Z=Z.concat(t[5].map((H=>O.lu.TransformNormal(H,v).ru(i))).map((H=>[H.x,H.y,H.z])).reduce(((H,u)=>H.concat(u)),[])),Y=Y.concat(e[5].map((H=>O.lu.TransformNormal(H,v))).map((H=>[H.x,H.y,H.z])).reduce(((H,u)=>H.concat(u)),[])),w.d._ComputeSides(a,Z,s,Y,F);const I=new w.d;if(I.indices=s,I.FH=Z,I.sH=Y,I.tH=F,J){const H=a===w.d.DOUBLESIDE?A.concat(A):A;I.AH=H}return I}function p(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new U.c(H,J);u.sideOrientation=U.c._GetDefaultSideOrientation(u.sideOrientation),O._originalBuilderSideOrientation=u.sideOrientation;return r(u).cH(O,u.updatable),O}w.d.CreateTiledPlane=mH;w.d.CreateTiledBox=r;var a=J(13694),k=J(12568),C=J(12521);function j(H){const u=H.height||2;let J=0===H.diameterTop?0:H.diameterTop||H.diameter||1,h=0===H.diameterBottom?0:H.diameterBottom||H.diameter||1;J=J||1e-5,h=h||1e-5;const B=0|(H.tessellation||24),b=0|(H.subdivisions||1),d=!!H.hasRings,G=!!H.enclose,mH=0===H.cap?0:H.cap||U.c.CAP_ALL,l=H.arc&&(H.arc<=0||H.arc>1)?1:H.arc||1,r=0===H.sideOrientation?0:H.sideOrientation||w.d.DEFAULTSIDE,p=H.faceUV||new Array(3),a=H.faceColors,k=2+(1+(1!==l&&G?2:0))*(d?b:1);let j;for(j=0;j<k;j++)a&&void 0===a[j]&&(a[j]=new P.Mg(1,1,1,1));for(j=0;j<k;j++)p&&void 0===p[j]&&(p[j]=new O.Vector4(0,0,1,1));const M=[],L=[],Z=[],Y=[],F=[],s=2*Math.PI*l/B;let A,t,e;const c=(h-J)/2/u,n=O.lu.Zero(),V=O.lu.Zero(),T=O.lu.Zero(),R=O.lu.Zero(),X=O.lu.Zero(),W=C.d.Y;let f,i,S,v=1,I=1,D=0,o=0;for(f=0;f<=b;f++)for(t=f/b,e=(t*(J-h)+h)/2,v=d&&0!==f&&f!==b?2:1,S=0;S<v;S++){for(d&&(I+=S),G&&(I+=2*S),i=0;i<=B;i++)A=i*s,n.x=Math.cos(-A)*e,n.y=-u/2+t*u,n.z=Math.sin(-A)*e,0===J&&f===b?(V.x=Z[Z.length-3*(B+1)],V.y=Z[Z.length-3*(B+1)+1],V.z=Z[Z.length-3*(B+1)+2]):(V.x=n.x,V.z=n.z,V.y=Math.sqrt(V.x*V.x+V.z*V.z)*c,V.normalize()),0===i&&(T.O(n),R.O(V)),L.push(n.x,n.y,n.z),Z.push(V.x,V.y,V.z),o=d?D!==I?p[I].y:p[I].w:p[I].y+(p[I].w-p[I].y)*t,Y.push(p[I].x+(p[I].z-p[I].x)*i/B,g.e?1-o:o),a&&F.push(a[I].r,a[I].g,a[I].b,a[I].a);1!==l&&G&&(L.push(n.x,n.y,n.z),L.push(0,n.y,0),L.push(0,n.y,0),L.push(T.x,T.y,T.z),O.lu.CrossToRef(W,V,X),X.normalize(),Z.push(X.x,X.y,X.z,X.x,X.y,X.z),O.lu.CrossToRef(R,W,X),X.normalize(),Z.push(X.x,X.y,X.z,X.x,X.y,X.z),o=d?D!==I?p[I+1].y:p[I+1].w:p[I+1].y+(p[I+1].w-p[I+1].y)*t,Y.push(p[I+1].x,g.e?1-o:o),Y.push(p[I+1].z,g.e?1-o:o),o=d?D!==I?p[I+2].y:p[I+2].w:p[I+2].y+(p[I+2].w-p[I+2].y)*t,Y.push(p[I+2].x,g.e?1-o:o),Y.push(p[I+2].z,g.e?1-o:o),a&&(F.push(a[I+1].r,a[I+1].g,a[I+1].b,a[I+1].a),F.push(a[I+1].r,a[I+1].g,a[I+1].b,a[I+1].a),F.push(a[I+2].r,a[I+2].g,a[I+2].b,a[I+2].a),F.push(a[I+2].r,a[I+2].g,a[I+2].b,a[I+2].a))),D!==I&&(D=I)}const y=1!==l&&G?B+4:B;for(f=0,I=0;I<b;I++){let H=0,u=0,J=0,O=0;for(i=0;i<B;i++)H=f*(y+1)+i,u=(f+1)*(y+1)+i,J=f*(y+1)+(i+1),O=(f+1)*(y+1)+(i+1),M.push(H,u,J),M.push(O,J,u);1!==l&&G&&(M.push(H+2,u+2,J+2),M.push(O+2,J+2,u+2),M.push(H+4,u+4,J+4),M.push(O+4,J+4,u+4)),f=d?f+2:f+1}const x=H=>{const U=H?J/2:h/2;if(0===U)return;let w,b,d;const G=H?p[k-1]:p[0];let P=null;a&&(P=H?a[k-1]:a[0]);const mH=L.length/3,r=H?u/2:-u/2,C=new O.lu(0,r,0);L.push(C.x,C.y,C.z),Z.push(0,H?1:-1,0);const j=G.y+.5*(G.w-G.y);Y.push(G.x+.5*(G.z-G.x),g.e?1-j:j),P&&F.push(P.r,P.g,P.b,P.a);const s=new O.Vector2(.5,.5);for(d=0;d<=B;d++){w=2*Math.PI*d*l/B;const u=Math.cos(-w),J=Math.sin(-w);b=new O.lu(u*U,r,J*U);const h=new O.Vector2(u*s.x+.5,J*s.y+.5);L.push(b.x,b.y,b.z),Z.push(0,H?1:-1,0);const mH=G.y+(G.w-G.y)*h.y;Y.push(G.x+(G.z-G.x)*h.x,g.e?1-mH:mH),P&&F.push(P.r,P.g,P.b,P.a)}for(d=0;d<B;d++)H?(M.push(mH),M.push(mH+(d+2)),M.push(mH+(d+1))):(M.push(mH),M.push(mH+(d+1)),M.push(mH+(d+2)))};mH!==U.c.CAP_START&&mH!==U.c.CAP_ALL||x(!1),mH!==U.c.CAP_END&&mH!==U.c.CAP_ALL||x(!0),w.d._ComputeSides(r,L,M,Z,Y,H.frontUVs,H.backUVs);const z=new w.d;return z.indices=M,z.FH=L,z.sH=Z,z.tH=Y,a&&(z.AH=F),z}function M(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},J=arguments.length>2?arguments[2]:void 0;const O=new U.c(H,J);u.sideOrientation=U.c._GetDefaultSideOrientation(u.sideOrientation),O._originalBuilderSideOrientation=u.sideOrientation;return j(u).cH(O,u.updatable),O}function L(H){const u=[],J=[],U=[],h=[],B=H.diameter||1,b=H.thickness||.5,d=0|(H.tessellation||16),G=0===H.sideOrientation?0:H.sideOrientation||w.d.DEFAULTSIDE,P=d+1;for(let w=0;w<=d;w++){const H=w/d,G=w*Math.PI*2/d-Math.PI/2,mH=O.Matrix.Translation(B/2,0,0).multiply(O.Matrix.RotationY(G));for(let B=0;B<=d;B++){const G=1-B/d,l=B*Math.PI*2/d+Math.PI,r=Math.cos(l),p=Math.sin(l);let a=new O.lu(r,p,0),k=a.scale(b/2);const C=new O.Vector2(H,G);k=O.lu.TransformCoordinates(k,mH),a=O.lu.TransformNormal(a,mH),J.push(k.x,k.y,k.z),U.push(a.x,a.y,a.z),h.push(C.x,g.e?1-C.y:C.y);const j=(w+1)%P,M=(B+1)%P;u.push(w*P+B),u.push(w*P+M),u.push(j*P+B),u.push(w*P+M),u.push(j*P+M),u.push(j*P+B)}}w.d._ComputeSides(G,J,u,U,h,H.frontUVs,H.backUVs);const mH=new w.d;return mH.indices=u,mH.FH=J,mH.sH=U,mH.tH=h,mH}function Z(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},J=arguments.length>2?arguments[2]:void 0;const O=new U.c(H,J);u.sideOrientation=U.c._GetDefaultSideOrientation(u.sideOrientation),O._originalBuilderSideOrientation=u.sideOrientation;return L(u).cH(O,u.updatable),O}w.d.CreateCylinder=j,U.c.CreateCylinder=(H,u,J,O,h,w,g,B,b)=>{void 0!==g&&g instanceof k.d||(void 0!==g&&(b=B||U.c.DEFAULTSIDE,B=g),g=w,w=1);return M(H,{height:u,diameterTop:J,diameterBottom:O,tessellation:h,subdivisions:w,sideOrientation:b,updatable:B},g)};function Y(H){const u=[],J=[],U=[],h=[],B=H.radius||2,b=H.tube||.5,d=H.radialSegments||32,G=H.tubularSegments||32,P=H.p||2,mH=H.q||3,l=0===H.sideOrientation?0:H.sideOrientation||w.d.DEFAULTSIDE,r=H=>{const u=Math.cos(H),J=Math.sin(H),U=mH/P*H,h=Math.cos(U),w=B*(2+h)*.5*u,g=B*(2+h)*J*.5,b=B*Math.sin(U)*.5;return new O.lu(w,g,b)};let p,a;for(p=0;p<=d;p++){const H=p%d/d*2*P*Math.PI,u=r(H),U=r(H+.01),w=U.ru(u);let B=U.add(u);const mH=O.lu.Cross(w,B);for(B=O.lu.Cross(mH,w),mH.normalize(),B.normalize(),a=0;a<G;a++){const H=a%G/G*2*Math.PI,O=-b*Math.cos(H),U=b*Math.sin(H);J.push(u.x+O*B.x+U*mH.x),J.push(u.y+O*B.y+U*mH.y),J.push(u.z+O*B.z+U*mH.z),h.push(p/d),h.push(g.e?1-a/G:a/G)}}for(p=0;p<d;p++)for(a=0;a<G;a++){const H=(a+1)%G,J=p*G+a,O=(p+1)*G+a,U=(p+1)*G+H,h=p*G+H;u.push(h),u.push(O),u.push(J),u.push(h),u.push(U),u.push(O)}w.d.ComputeNormals(J,u,U),w.d._ComputeSides(l,J,u,U,h,H.frontUVs,H.backUVs);const k=new w.d;return k.indices=u,k.FH=J,k.sH=U,k.tH=h,k}function F(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},J=arguments.length>2?arguments[2]:void 0;const O=new U.c(H,J);u.sideOrientation=U.c._GetDefaultSideOrientation(u.sideOrientation),O._originalBuilderSideOrientation=u.sideOrientation;return Y(u).cH(O,u.updatable),O}w.d.CreateTorus=L,U.c.CreateTorus=(H,u,J,O,U,h,w)=>Z(H,{diameter:u,thickness:J,tessellation:O,sideOrientation:w,updatable:h},U);w.d.CreateTorusKnot=Y,U.c.CreateTorusKnot=(H,u,J,O,U,h,w,g,B,b)=>F(H,{radius:u,tube:J,radialSegments:O,tubularSegments:U,p:h,q:w,sideOrientation:b,updatable:B},g);var s=J(14194),A=J(12887),t=J(12532);function e(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=u.path,h=u.shape,w=u.scale||1,g=u.rotation||0,B=0===u.cap?0:u.cap||U.c.NO_CAP,b=u.updatable,d=U.c._GetDefaultSideOrientation(u.sideOrientation),G=u.instance||null,P=u.invertUV||!1,mH=u.closeShape||!1,l=u.closePath||!1,r=u.capFunction||null;return n(H,h,O,w,g,null,null,l,mH,B,!1,J,!!b,d,G,P,u.frontUVs||null,u.backUVs||null,u.firstNormal||null,!!u.adjustFrame,r)}function c(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=u.path,h=u.shape,w=u.scaleFunction||(()=>1),g=u.rotationFunction||(()=>0),B=u.closePath||u.ribbonCloseArray||!1,b=u.closeShape||u.ribbonClosePath||!1,d=0===u.cap?0:u.cap||U.c.NO_CAP,G=u.updatable,P=u.firstNormal||null,mH=u.adjustFrame||!1,l=U.c._GetDefaultSideOrientation(u.sideOrientation),r=u.instance,p=u.invertUV||!1,a=u.capFunction||null;return n(H,h,O,null,null,w,g,B,b,d,!0,J,!!G,l,r||null,p,u.frontUVs||null,u.backUVs||null,P,mH,a||null)}function n(H,u,J,h,w,g,B,d,G,P,mH,l,r,p,a,k,C,j,M,L,Z){const Y=(H,u,J,h,w,g,B,b,d,G,P)=>{const mH=J.getTangents(),l=J.getNormals(),r=J.getBinormals(),p=J.getDistances();if(P)for(let U=0;U<mH.length;U++)if(0==mH[U].x&&0==mH[U].y&&0==mH[U].z&&mH[U].O(mH[U-1]),0==l[U].x&&0==l[U].y&&0==l[U].z&&l[U].O(l[U-1]),0==r[U].x&&0==r[U].y&&0==r[U].z&&r[U].O(r[U-1]),U>0){let H=mH[U-1];O.lu.Dot(H,mH[U])<0&&mH[U].scaleInPlace(-1),H=l[U-1],O.lu.Dot(H,l[U])<0&&l[U].scaleInPlace(-1),H=r[U-1],O.lu.Dot(H,r[U])<0&&r[U].scaleInPlace(-1)}let a=0;const k=G&&b?b:()=>null!==g?g:0,C=G&&B?B:()=>null!==w?w:1;let j=d===U.c.NO_CAP||d===U.c.CAP_END?0:2;const M=O.TmpVectors.Matrix[0];for(let U=0;U<u.length;U++){const J=[],w=k(U,p[U]),g=C(U,p[U]);O.Matrix.RotationAxisToRef(mH[U],a,M);for(let h=0;h<H.length;h++){const w=mH[U].scale(H[h].z).add(l[U].scale(H[h].x)).add(r[U].scale(H[h].y)),B=O.lu.Zero();O.lu.TransformCoordinatesToRef(w,M,B),B.scaleInPlace(g).addInPlace(u[U]),J[h]=B}h[j]=J,a+=w,j++}const L=Z||(H=>{const u=Array(),J=O.lu.Zero();let U;for(U=0;U<H.length;U++)J.addInPlace(H[U]);for(J.scaleInPlace(1/H.length),U=0;U<H.length;U++)u.push(J);return u});switch(d){case U.c.NO_CAP:break;case U.c.CAP_START:h[0]=L(h[2]),h[1]=h[2];break;case U.c.CAP_END:h[j]=h[j-1],h[j+1]=L(h[j-1]);break;case U.c.CAP_ALL:h[0]=L(h[2]),h[1]=h[2],h[j]=h[j-1],h[j+1]=L(h[j-1])}return h};let F,s;if(a){const H=a._creationDataStorage;return F=M?H.path3D.update(J,M):H.path3D.update(J),s=Y(u,J,H.path3D,H.pathArray,h,w,g,B,H.cap,mH,L),a=b("",{pathArray:s,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:a},l||void 0)}F=M?new t.j(J,M):new t.j(J);s=Y(u,J,F,new Array,h,w,g,B,P=P<0||P>3?0:P,mH,L);const A=b(H,{pathArray:s,closeArray:d,closePath:G,updatable:r,sideOrientation:p,invertUV:k,frontUVs:C||void 0,backUVs:j||void 0},l);return A._creationDataStorage.pathArray=s,A._creationDataStorage.path3D=F,A._creationDataStorage.cap=P,A}function V(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=u.arc?u.arc<=0||u.arc>1?1:u.arc:1,w=void 0===u.closed||u.closed,g=u.shape,B=u.radius||1,d=u.tessellation||64,G=u.clip||0,P=u.updatable,mH=U.c._GetDefaultSideOrientation(u.sideOrientation),l=u.cap||U.c.NO_CAP,r=2*Math.PI,p=[],a=u.invertUV||!1;let k=0,C=0;const j=r/d*h;let M,L;for(k=0;k<=d-G;k++){for(L=[],l!=U.c.CAP_START&&l!=U.c.CAP_ALL||(L.push(new O.lu(0,g[0].y,0)),L.push(new O.lu(Math.cos(k*j)*g[0].x*B,g[0].y,Math.sin(k*j)*g[0].x*B))),C=0;C<g.length;C++)M=new O.lu(Math.cos(k*j)*g[C].x*B,g[C].y,Math.sin(k*j)*g[C].x*B),L.push(M);l!=U.c.CAP_END&&l!=U.c.CAP_ALL||(L.push(new O.lu(Math.cos(k*j)*g[g.length-1].x*B,g[g.length-1].y,Math.sin(k*j)*g[g.length-1].x*B)),L.push(new O.lu(0,g[g.length-1].y,0))),p.push(L)}return b(H,{pathArray:p,closeArray:w,sideOrientation:mH,updatable:P,invertUV:a,frontUVs:u.frontUVs,backUVs:u.backUVs},J)}U.c.ExtrudeShape=function(H,u,J,O,h,w){let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7?arguments[7]:void 0,b=arguments.length>8?arguments[8]:void 0,d=arguments.length>9?arguments[9]:void 0;return e(H,{shape:u,path:J,scale:O,rotation:h,cap:0===w?0:w||U.c.NO_CAP,sideOrientation:b,instance:d,updatable:B},g)},U.c.ExtrudeShapeCustom=(H,u,J,O,h,w,g,B,b,d,G,P)=>c(H,{shape:u,path:J,scaleFunction:O,rotationFunction:h,ribbonCloseArray:w,ribbonClosePath:g,cap:0===B?0:B||U.c.NO_CAP,sideOrientation:G,instance:P,updatable:d},b);U.c.CreateLathe=(H,u,J,O,U,h,w)=>V(H,{shape:u,radius:J,tessellation:O,sideOrientation:w,updatable:h},U);var T=J(13605),R=J(13553);function X(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=u.path;let w=u.instance,g=1;void 0!==u.radius?g=u.radius:w&&(g=w._creationDataStorage.radius);const B=u.tessellation||64,d=u.radiusFunction||null;let G=u.cap||U.c.NO_CAP;const P=u.invertUV||!1,mH=u.updatable,l=U.c._GetDefaultSideOrientation(u.sideOrientation);u.arc=u.arc&&(u.arc<=0||u.arc>1)?1:u.arc||1;const r=(H,u,J,h,w,g,B,b)=>{const d=u.getTangents(),G=u.getNormals(),P=u.getDistances(),mH=2*Math.PI/w*b,l=g||(()=>h);let r,p,a,k;const C=O.TmpVectors.Matrix[0];let j=B===U.c.NO_CAP||B===U.c.CAP_END?0:2;for(let U=0;U<H.length;U++){p=l(U,P[U]),r=Array(),a=G[U];for(let u=0;u<w;u++)O.Matrix.RotationAxisToRef(d[U],mH*u,C),k=r[u]?r[u]:O.lu.Zero(),O.lu.TransformCoordinatesToRef(a,C,k),k.scaleInPlace(p).addInPlace(H[U]),r[u]=k;J[j]=r,j++}const M=(u,J)=>{const O=Array();for(let U=0;U<u;U++)O.push(H[J]);return O};switch(B){case U.c.NO_CAP:break;case U.c.CAP_START:J[0]=M(w,0),J[1]=J[2].slice(0);break;case U.c.CAP_END:J[j]=J[j-1].slice(0),J[j+1]=M(w,H.length-1);break;case U.c.CAP_ALL:J[0]=M(w,0),J[1]=J[2].slice(0),J[j]=J[j-1].slice(0),J[j+1]=M(w,H.length-1)}return J};let p,a;if(w){const H=w._creationDataStorage,J=u.arc||H.arc;return p=H.path3D.update(h),a=r(h,p,H.pathArray,g,H.tessellation,d,H.cap,J),w=b("",{pathArray:a,instance:w}),H.path3D=p,H.pathArray=a,H.arc=J,H.radius=g,w}p=new t.j(h);G=G<0||G>3?0:G,a=r(h,p,new Array,g,B,d,G,u.arc);const k=b(H,{pathArray:a,closePath:!0,closeArray:!1,updatable:mH,sideOrientation:l,invertUV:P,frontUVs:u.frontUVs,backUVs:u.backUVs},J);return k._creationDataStorage.pathArray=a,k._creationDataStorage.path3D=p,k._creationDataStorage.tessellation=B,k._creationDataStorage.cap=G,k._creationDataStorage.arc=u.arc,k._creationDataStorage.radius=g,k}function W(H){const u=[];u[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},u[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},u[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},u[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},u[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},u[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},u[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},u[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},u[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},u[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},u[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},u[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},u[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},u[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},u[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const J=H.type&&(H.type<0||H.type>=u.length)?0:H.type||0,U=H.size,h=H.sizeX||U||1,B=H.sizeY||U||1,b=H.sizeZ||U||1,d=H.custom||u[J],G=d.face.length,mH=H.faceUV||new Array(G),l=H.faceColors,r=void 0===H.flat||H.flat,p=0===H.sideOrientation?0:H.sideOrientation||w.d.DEFAULTSIDE,a=[],k=[],C=[],j=[],M=[];let L=0,Z=0;const Y=[];let F,s,A,t,e,c,n=0,V=0;if(r)for(V=0;V<G;V++)l&&void 0===l[V]&&(l[V]=new P.Mg(1,1,1,1)),mH&&void 0===mH[V]&&(mH[V]=new O.Vector4(0,0,1,1));if(r)for(V=0;V<G;V++){const H=d.face[V].length;for(A=2*Math.PI/H,t=.5*Math.tan(A/2),e=.5,n=0;n<H;n++)a.push(d.vertex[d.face[V][n]][0]*h,d.vertex[d.face[V][n]][1]*B,d.vertex[d.face[V][n]][2]*b),Y.push(L),L++,F=mH[V].x+(mH[V].z-mH[V].x)*(.5+t),s=mH[V].y+(mH[V].w-mH[V].y)*(e-.5),j.push(F,g.e?1-s:s),c=t*Math.cos(A)-e*Math.sin(A),e=t*Math.sin(A)+e*Math.cos(A),t=c,l&&M.push(l[V].r,l[V].g,l[V].b,l[V].a);for(n=0;n<H-2;n++)k.push(Y[0+Z],Y[n+2+Z],Y[n+1+Z]);Z+=H}else{for(n=0;n<d.vertex.length;n++)a.push(d.vertex[n][0]*h,d.vertex[n][1]*B,d.vertex[n][2]*b),j.push(0,g.e?1:0);for(V=0;V<G;V++)for(n=0;n<d.face[V].length-2;n++)k.push(d.face[V][0],d.face[V][n+2],d.face[V][n+1])}w.d.ComputeNormals(a,k,C),w.d._ComputeSides(p,a,k,C,j,H.frontUVs,H.backUVs);const T=new w.d;return T.FH=a,T.indices=k,T.sH=C,T.tH=j,l&&r&&(T.AH=M),T}function f(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new U.c(H,J);u.sideOrientation=U.c._GetDefaultSideOrientation(u.sideOrientation),O._originalBuilderSideOrientation=u.sideOrientation;return W(u).cH(O,u.updatable),O}U.c.CreateTube=(H,u,J,O,U,h,w,g,B,b)=>X(H,{path:u,radius:J,tessellation:O,radiusFunction:U,arc:1,cap:h,updatable:g,sideOrientation:B,instance:b},w);function i(H){const u=H.sideOrientation||w.d.DEFAULTSIDE,J=H.radius||1,U=void 0===H.flat||H.flat,h=0|(H.subdivisions||4),B=H.radiusX||J,b=H.radiusY||J,d=H.radiusZ||J,G=(1+Math.sqrt(5))/2,P=[-1,G,-0,1,G,0,-1,-G,0,1,-G,0,0,-1,-G,0,1,-G,0,-1,G,0,1,G,G,0,1,G,0,-1,-G,0,1,-G,0,-1],mH=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],l=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],r=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],p=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],a=[],k=[],C=[],j=[];let M=0;const L=new Array(3),Z=new Array(3);let Y;for(Y=0;Y<3;Y++)L[Y]=O.lu.Zero(),Z[Y]=O.Vector2.Zero();for(let w=0;w<20;w++){for(Y=0;Y<3;Y++){const H=mH[3*w+Y];L[Y].kg(P[3*l[H]],P[3*l[H]+1],P[3*l[H]+2]),L[Y].normalize(),Z[Y].kg(.134765625*r[2*H]+.05859375+-.0390625*p[w],.2333984375*r[2*H+1]+.025390625+.01953125*p[w])}const H=(H,u,J,w)=>{const G=O.lu.Lerp(L[0],L[2],u/h),P=O.lu.Lerp(L[1],L[2],u/h),mH=h===u?L[2]:O.lu.Lerp(G,P,H/(h-u));let l;if(mH.normalize(),U){const H=O.lu.Lerp(L[0],L[2],w/h),u=O.lu.Lerp(L[1],L[2],w/h);l=O.lu.Lerp(H,u,J/(h-w))}else l=new O.lu(mH.x,mH.y,mH.z);l.x/=B,l.y/=b,l.z/=d,l.normalize();const r=O.Vector2.Lerp(Z[0],Z[2],u/h),p=O.Vector2.Lerp(Z[1],Z[2],u/h),Y=h===u?Z[2]:O.Vector2.Lerp(r,p,H/(h-u));k.push(mH.x*B,mH.y*b,mH.z*d),C.push(l.x,l.y,l.z),j.push(Y.x,g.e?1-Y.y:Y.y),a.push(M),M++};for(let u=0;u<h;u++)for(let J=0;J+u<h;J++)H(J,u,J+1/3,u+1/3),H(J+1,u,J+1/3,u+1/3),H(J,u+1,J+1/3,u+1/3),J+u+1<h&&(H(J+1,u,J+2/3,u+2/3),H(J+1,u+1,J+2/3,u+2/3),H(J,u+1,J+2/3,u+2/3))}w.d._ComputeSides(u,k,a,C,j,H.frontUVs,H.backUVs);const F=new w.d;return F.indices=a,F.FH=k,F.sH=C,F.tH=j,F}function S(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const O=new U.c(H,J);u.sideOrientation=U.c._GetDefaultSideOrientation(u.sideOrientation),O._originalBuilderSideOrientation=u.sideOrientation;return i(u).cH(O,u.updatable),O}w.d.CreatePolyhedron=W,U.c.CreatePolyhedron=(H,u,J)=>f(H,u,J);w.d.CreateIcoSphere=i,U.c.CreateIcoSphere=(H,u,J)=>S(H,u,J);var v=J(12349);const I=new O.lu(1,0,0),D=new O.lu(-1,0,0),o=new O.lu(0,1,0),y=new O.lu(0,-1,0),x=new O.lu(0,0,1),z=new O.lu(0,0,-1);class K{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O.lu.Zero(),u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.lu.Up(),J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.Vector2.Zero(),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=H,this.normal=u,this.uv=J,this.vertexIdx=U,this.vertexIdxForBones=h,this.localPositionOverride=w,this.localNormalOverride=g,this.matrixIndicesOverride=B,this.matrixWeightsOverride=b}clone(){var H,u,J,O;return new K(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(H=this.localPositionOverride)||void 0===H?void 0:H.slice(),null===(u=this.localNormalOverride)||void 0===u?void 0:u.slice(),null===(J=this.matrixIndicesOverride)||void 0===J?void 0:J.slice(),null===(O=this.matrixWeightsOverride)||void 0===O?void 0:O.slice())}}function N(H,u,J){var B,b,d,G,P;const mH=!!u.skeleton,l=!(null===(B=u.morphTargetManager)||void 0===B||!B.numTargets),r=J.localMode||mH,p=u.rg(),a=mH||l?u.Tg(!0,!0):u.getVerticesData(h.d.PositionKind),k=mH||l?u.getNormalsData(!0,!0):u.getVerticesData(h.d.NormalKind),C=r?mH?u.getVerticesData(h.d.PositionKind):a:null,j=r?mH?u.getVerticesData(h.d.NormalKind):k:null,M=u.getVerticesData(h.d.UVKind),L=mH?u.getVerticesData(h.d.MatricesIndicesKind):null,Z=mH?u.getVerticesData(h.d.MatricesWeightsKind):null,Y=mH?u.getVerticesData(h.d.MatricesIndicesExtraKind):null,F=mH?u.getVerticesData(h.d.MatricesWeightsExtraKind):null,s=J.position||O.lu.Zero();let A=J.normal||O.lu.Up();const t=J.size||O.lu.One(),e=J.angle||0;if(!A){const H=new O.lu(0,0,1),J=u.ZH().activeCamera,U=O.lu.TransformCoordinates(H,J.getWorldMatrix());A=J.globalPosition.ru(U)}const c=-Math.atan2(A.z,A.x)-Math.PI/2,n=Math.sqrt(A.x*A.x+A.z*A.z),V=Math.atan2(A.y,n),T=new w.d;T.indices=[],T.FH=[],T.sH=[],T.tH=[],T.matricesIndices=mH?[]:null,T.matricesWeights=mH?[]:null,T.matricesIndicesExtra=Y?[]:null,T.matricesWeightsExtra=F?[]:null;let R=0;const X=(H,u)=>{const U=new K;if(!p||!a||!k)return U;const h=p[H];if(U.vertexIdx=3*h,U.vertexIdxForBones=4*h,U.position=new O.lu(a[3*h],a[3*h+1],a[3*h+2]),O.lu.TransformCoordinatesToRef(U.position,u,U.position),U.normal=new O.lu(k[3*h],k[3*h+1],k[3*h+2]),O.lu.TransformNormalToRef(U.normal,u,U.normal),J.captureUVS&&M){const H=M[2*h+1];U.uv=new O.Vector2(M[2*h],g.e?1-H:H)}return U},W=[0,0,0,0],f=(H,u)=>{if(0===H.length)return H;const J=.5*Math.abs(O.lu.Dot(t,u)),U=(H,u,J,O)=>{for(let U=0;U<O;++U)if(H[J+U]===u)return J+U;return-1},h=(H,h)=>{const w=O.lu.GetClipFactor(H.position,h.position,u,J);let g=W,B=W;if(L&&Z){const u=H.matrixIndicesOverride?0:H.vertexIdxForBones,J=H.matrixIndicesOverride??L,O=H.matrixWeightsOverride??Z,b=h.matrixIndicesOverride?0:h.vertexIdxForBones,d=h.matrixIndicesOverride??L,G=h.matrixWeightsOverride??Z;g=[0,0,0,0],B=[0,0,0,0];let P=0;for(let H=0;H<4;++H)if(O[u+H]>0){const h=U(d,J[u+H],b,4);g[P]=J[u+H],B[P]=(0,v.Lerp)(O[u+H],h>=0?G[h]:0,w),P++}for(let H=0;H<4&&P<4;++H){const O=d[b+H];-1===U(J,O,u,4)&&(g[P]=O,B[P]=(0,v.Lerp)(0,G[b+H],w),P++)}const mH=B[0]+B[1]+B[2]+B[3];B[0]/=mH,B[1]/=mH,B[2]/=mH,B[3]/=mH}const b=H.localPositionOverride?H.localPositionOverride[0]:(null===C||void 0===C?void 0:C[H.vertexIdx])??0,d=H.localPositionOverride?H.localPositionOverride[1]:(null===C||void 0===C?void 0:C[H.vertexIdx+1])??0,G=H.localPositionOverride?H.localPositionOverride[2]:(null===C||void 0===C?void 0:C[H.vertexIdx+2])??0,P=h.localPositionOverride?h.localPositionOverride[0]:(null===C||void 0===C?void 0:C[h.vertexIdx])??0,mH=h.localPositionOverride?h.localPositionOverride[1]:(null===C||void 0===C?void 0:C[h.vertexIdx+1])??0,l=h.localPositionOverride?h.localPositionOverride[2]:(null===C||void 0===C?void 0:C[h.vertexIdx+2])??0,r=H.localNormalOverride?H.localNormalOverride[0]:(null===j||void 0===j?void 0:j[H.vertexIdx])??0,p=H.localNormalOverride?H.localNormalOverride[1]:(null===j||void 0===j?void 0:j[H.vertexIdx+1])??0,a=H.localNormalOverride?H.localNormalOverride[2]:(null===j||void 0===j?void 0:j[H.vertexIdx+2])??0,k=r+((h.localNormalOverride?h.localNormalOverride[0]:(null===j||void 0===j?void 0:j[h.vertexIdx])??0)-r)*w,M=p+((h.localNormalOverride?h.localNormalOverride[1]:(null===j||void 0===j?void 0:j[h.vertexIdx+1])??0)-p)*w,Y=a+((h.localNormalOverride?h.localNormalOverride[2]:(null===j||void 0===j?void 0:j[h.vertexIdx+2])??0)-a)*w,F=Math.sqrt(k*k+M*M+Y*Y);return new K(O.lu.Lerp(H.position,h.position,w),O.lu.Lerp(H.normal,h.normal,w).normalize(),O.Vector2.Lerp(H.uv,h.uv,w),-1,-1,C?[b+(P-b)*w,d+(mH-d)*w,G+(l-G)*w]:null,j?[k/F,M/F,Y/F]:null,g,B)};let w=null;H.length>3&&(w=[]);for(let g=0;g<H.length;g+=3){let U=0,B=null,b=null,d=null,G=null;const P=O.lu.Dot(H[g].position,u)-J>0,mH=O.lu.Dot(H[g+1].position,u)-J>0,l=O.lu.Dot(H[g+2].position,u)-J>0;switch(U=(P?1:0)+(mH?1:0)+(l?1:0),U){case 0:H.length>3?(w.push(H[g]),w.push(H[g+1]),w.push(H[g+2])):w=H;break;case 1:if(w=w??new Array,P&&(B=H[g+1],b=H[g+2],d=h(H[g],B),G=h(H[g],b)),mH){B=H[g],b=H[g+2],d=h(H[g+1],B),G=h(H[g+1],b),w.push(d),w.push(b.clone()),w.push(B.clone()),w.push(b.clone()),w.push(d.clone()),w.push(G);break}l&&(B=H[g],b=H[g+1],d=h(H[g+2],B),G=h(H[g+2],b)),B&&b&&d&&G&&(w.push(B.clone()),w.push(b.clone()),w.push(d),w.push(G),w.push(d.clone()),w.push(b.clone()));break;case 2:w=w??new Array,P||(B=H[g].clone(),b=h(B,H[g+1]),d=h(B,H[g+2]),w.push(B),w.push(b),w.push(d)),mH||(B=H[g+1].clone(),b=h(B,H[g+2]),d=h(B,H[g]),w.push(B),w.push(b),w.push(d)),l||(B=H[g+2].clone(),b=h(B,H[g]),d=h(B,H[g+1]),w.push(B),w.push(b),w.push(d))}}return w},i=u instanceof U.c?u:null,S=null===i||void 0===i?void 0:i._thinInstanceDataStorage.matrixData,N=(null===i||void 0===i?void 0:i.Zg)||1,q=O.TmpVectors.Matrix[0];q.O(O.Matrix.IdentityReadOnly);for(let U=0;U<N;++U){if(null!==i&&void 0!==i&&i.hasThinInstances&&S){const H=16*U;q.setRowFromFloats(0,S[H+0],S[H+1],S[H+2],S[H+3]),q.setRowFromFloats(1,S[H+4],S[H+5],S[H+6],S[H+7]),q.setRowFromFloats(2,S[H+8],S[H+9],S[H+10],S[H+11]),q.setRowFromFloats(3,S[H+12],S[H+13],S[H+14],S[H+15])}const H=O.Matrix.RotationYawPitchRoll(c,V,e).multiply(O.Matrix.Translation(s.x,s.y,s.z)),h=O.Matrix.Invert(H),w=u.getWorldMatrix(),B=q.multiply(w).multiply(h),b=new Array(3);for(let u=0;u<p.length;u+=3){let H=b;if(H[0]=X(u,B),H[1]=X(u+1,B),H[2]=X(u+2,B),!(J.cullBackFaces&&-H[0].normal.z<=0&&-H[1].normal.z<=0&&-H[2].normal.z<=0)&&(H=f(H,I),H&&(H=f(H,D),H&&(H=f(H,o),H&&(H=f(H,y),H&&(H=f(H,x),H&&(H=f(H,z),H)))))))for(let u=0;u<H.length;u++){const O=H[u];if(T.indices.push(R),r?(O.localPositionOverride?(T.FH[3*R]=O.localPositionOverride[0],T.FH[3*R+1]=O.localPositionOverride[1],T.FH[3*R+2]=O.localPositionOverride[2]):C&&(T.FH[3*R]=C[O.vertexIdx],T.FH[3*R+1]=C[O.vertexIdx+1],T.FH[3*R+2]=C[O.vertexIdx+2]),O.localNormalOverride?(T.sH[3*R]=O.localNormalOverride[0],T.sH[3*R+1]=O.localNormalOverride[1],T.sH[3*R+2]=O.localNormalOverride[2]):j&&(T.sH[3*R]=j[O.vertexIdx],T.sH[3*R+1]=j[O.vertexIdx+1],T.sH[3*R+2]=j[O.vertexIdx+2])):(O.position.toArray(T.FH,3*R),O.normal.toArray(T.sH,3*R)),T.matricesIndices&&T.matricesWeights&&(O.matrixIndicesOverride?(T.matricesIndices[4*R]=O.matrixIndicesOverride[0],T.matricesIndices[4*R+1]=O.matrixIndicesOverride[1],T.matricesIndices[4*R+2]=O.matrixIndicesOverride[2],T.matricesIndices[4*R+3]=O.matrixIndicesOverride[3]):(L&&(T.matricesIndices[4*R]=L[O.vertexIdxForBones],T.matricesIndices[4*R+1]=L[O.vertexIdxForBones+1],T.matricesIndices[4*R+2]=L[O.vertexIdxForBones+2],T.matricesIndices[4*R+3]=L[O.vertexIdxForBones+3]),Y&&T.matricesIndicesExtra&&(T.matricesIndicesExtra[4*R]=Y[O.vertexIdxForBones],T.matricesIndicesExtra[4*R+1]=Y[O.vertexIdxForBones+1],T.matricesIndicesExtra[4*R+2]=Y[O.vertexIdxForBones+2],T.matricesIndicesExtra[4*R+3]=Y[O.vertexIdxForBones+3])),O.matrixWeightsOverride?(T.matricesWeights[4*R]=O.matrixWeightsOverride[0],T.matricesWeights[4*R+1]=O.matrixWeightsOverride[1],T.matricesWeights[4*R+2]=O.matrixWeightsOverride[2],T.matricesWeights[4*R+3]=O.matrixWeightsOverride[3]):(Z&&(T.matricesWeights[4*R]=Z[O.vertexIdxForBones],T.matricesWeights[4*R+1]=Z[O.vertexIdxForBones+1],T.matricesWeights[4*R+2]=Z[O.vertexIdxForBones+2],T.matricesWeights[4*R+3]=Z[O.vertexIdxForBones+3]),F&&T.matricesWeightsExtra&&(T.matricesWeightsExtra[4*R]=F[O.vertexIdxForBones],T.matricesWeightsExtra[4*R+1]=F[O.vertexIdxForBones+1],T.matricesWeightsExtra[4*R+2]=F[O.vertexIdxForBones+2],T.matricesWeightsExtra[4*R+3]=F[O.vertexIdxForBones+3]))),J.captureUVS)O.uv.toArray(T.tH,2*R);else{T.tH.push(.5+O.position.x/t.x);const H=.5+O.position.y/t.y;T.tH.push(g.e?1-H:H)}R++}}}0===T.indices.length&&(T.indices=null),0===T.FH.length&&(T.FH=null),0===T.sH.length&&(T.sH=null),0===T.tH.length&&(T.tH=null),0===(null===(b=T.matricesIndices)||void 0===b?void 0:b.length)&&(T.matricesIndices=null),0===(null===(d=T.matricesWeights)||void 0===d?void 0:d.length)&&(T.matricesWeights=null),0===(null===(G=T.matricesIndicesExtra)||void 0===G?void 0:G.length)&&(T.matricesIndicesExtra=null),0===(null===(P=T.matricesWeightsExtra)||void 0===P?void 0:P.length)&&(T.matricesWeightsExtra=null);const E=new U.c(H,u.ZH());return T.cH(E),r?(E.skeleton=u.skeleton,E.parent=u):(E.position=s.clone(),E.rotation=new O.lu(V,c,e)),E.dg(!0),E.refreshBoundingInfo(!0,!0),E}function q(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const u=0|Math.max(H.subdivisions?H.subdivisions:2,1),J=0|Math.max(H.tessellation?H.tessellation:16,3),U=Math.max(H.height?H.height:1,0),h=Math.max(H.radius?H.radius:.25,0),B=0|Math.max(H.capSubdivisions?H.capSubdivisions:6,1),b=J,d=u,G=Math.max(H.radiusTop?H.radiusTop:h,0),P=Math.max(H.radiusBottom?H.radiusBottom:h,0),mH=U-(G+P),l=2*Math.PI,r=Math.max(H.topCapSubdivisions?H.topCapSubdivisions:B,1),p=Math.max(H.bottomCapSubdivisions?H.bottomCapSubdivisions:B,1),a=Math.acos((P-G)/U);let k=[];const C=[],j=[],M=[];let L=0;const Z=[],Y=.5*mH,F=.5*Math.PI;let s,A;const t=O.lu.Zero(),e=O.lu.Zero(),c=Math.cos(a),n=Math.sin(a),V=new O.Vector2(G*n,Y+G*c).ru(new O.Vector2(P*n,P*c-Y)).length(),T=G*a+V+P*(F-a);let R=0;for(A=0;A<=r;A++){const H=[],u=F-a*(A/r);R+=G*a/r;const J=Math.cos(u),O=Math.sin(u),U=J*G;for(s=0;s<=b;s++){const u=s/b,h=u*l+0,w=Math.sin(h),B=Math.cos(h);e.x=U*w,e.y=Y+O*G,e.z=U*B,C.push(e.x,e.y,e.z),t.set(J*w,O,J*B),j.push(t.x,t.y,t.z),M.push(u,g.e?R/T:1-R/T),H.push(L),L++}Z.push(H)}const X=U-G-P+c*G-c*P,W=n*(P-G)/X;for(A=1;A<=d;A++){const H=[];R+=V/d;const u=n*(A*(P-G)/d+G);for(s=0;s<=b;s++){const J=s/b,O=J*l+0,U=Math.sin(O),h=Math.cos(O);e.x=u*U,e.y=Y+c*G-A*X/d,e.z=u*h,C.push(e.x,e.y,e.z),t.set(U,W,h).normalize(),j.push(t.x,t.y,t.z),M.push(J,g.e?R/T:1-R/T),H.push(L),L++}Z.push(H)}for(A=1;A<=p;A++){const H=[],u=F-a-(Math.PI-a)*(A/p);R+=P*a/p;const J=Math.cos(u),O=Math.sin(u),U=J*P;for(s=0;s<=b;s++){const u=s/b,h=u*l+0,w=Math.sin(h),B=Math.cos(h);e.x=U*w,e.y=O*P-Y,e.z=U*B,C.push(e.x,e.y,e.z),t.set(J*w,O,J*B),j.push(t.x,t.y,t.z),M.push(u,g.e?R/T:1-R/T),H.push(L),L++}Z.push(H)}for(s=0;s<b;s++)for(A=0;A<r+d+p;A++){const H=Z[A][s],u=Z[A+1][s],J=Z[A+1][s+1],O=Z[A][s+1];k.push(H),k.push(u),k.push(O),k.push(u),k.push(J),k.push(O)}if(k=k.reverse(),H.orientation&&!H.orientation.equals(O.lu.Up())){const u=new O.Matrix;H.orientation.clone().scale(.5*Math.PI).cross(O.lu.Up()).toQuaternion().toRotationMatrix(u);const J=O.lu.Zero();for(let H=0;H<C.length;H+=3)J.set(C[H],C[H+1],C[H+2]),O.lu.TransformCoordinatesToRef(J.clone(),u,J),C[H]=J.x,C[H+1]=J.y,C[H+2]=J.z}const f=new w.d;return f.FH=C,f.sH=j,f.tH=M,f.indices=k,f}function E(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:O.lu.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new U.c(H,J);return q(u).cH(h,u.updatable),h}U.c.CreateDecal=(H,u,J,O,U,h)=>N(H,u,{position:J,normal:O,size:U,angle:h});U.c.CreateCapsule=(H,u,J)=>E(H,u,J),w.d.CreateCapsule=q;var Q=J(12185),HH=J(12343);class uH{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=H,this.y=u,H!==Math.floor(H)&&(H=Math.floor(H),Q.b.Warn("x is not an integer, floor(x) used")),u!==Math.floor(u)&&(u=Math.floor(u),Q.b.Warn("y is not an integer, floor(y) used"))}clone(){return new uH(this.x,this.y)}rotate60About(H){const u=this.x;return this.x=H.x+H.y-this.y,this.y=u+this.y-H.x,this}rotateNeg60About(H){const u=this.x;return this.x=u+this.y-H.y,this.y=H.x+H.y-u,this}rotate120(H,u){H!==Math.floor(H)&&(H=Math.floor(H),Q.b.Warn("m not an integer only floor(m) used")),u!==Math.floor(u)&&(u=Math.floor(u),Q.b.Warn("n not an integer only floor(n) used"));const J=this.x;return this.x=H-J-this.y,this.y=u+J,this}rotateNeg120(H,u){H!==Math.floor(H)&&(H=Math.floor(H),Q.b.Warn("m is not an integer, floor(m) used")),u!==Math.floor(u)&&(u=Math.floor(u),Q.b.Warn("n is not an integer,   floor(n) used"));const J=this.x;return this.x=this.y-u,this.y=H+u-J-this.y,this}toCartesianOrigin(H,u){const J=O.lu.Zero();return J.x=H.x+2*this.x*u+this.y*u,J.y=H.y+Math.sqrt(3)*this.y*u,J}static Zero(){return new uH(0,0)}}class JH{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new OH("icosahedron","Regular",[[0,HH.g,-1],[-HH.g,1,0],[-1,0,-HH.g],[1,0,-HH.g],[HH.g,1,0],[0,HH.g,1],[-1,0,HH.g],[-HH.g,-1,0],[0,-HH.g,-1],[HH.g,-1,0],[1,0,HH.g],[0,-HH.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let H=12;const u={},J=this.m,O=this.n;let U,h,w,g,B,b=J,d=1,G=0;0!==O&&(b=(0,v.HighestCommonFactor)(J,O)),d=J/b,G=O/b;const P=uH.Zero(),mH=new uH(J,O),l=new uH(-O,J+O),r=uH.Zero(),p=uH.Zero(),a=uH.Zero();let k,C,j,M,L=[];const Z=[],Y=this.vertByDist,F=(J,O,U,h)=>{k=J+"|"+U,C=O+"|"+h,k in u||C in u?k in u&&!(C in u)?u[C]=u[k]:C in u&&!(k in u)&&(u[k]=u[C]):(u[k]=H,u[C]=H,H++),Y[U][0]>2?Z[u[k]]=[-Y[U][0],Y[U][1],u[k]]:Z[u[k]]=[L[Y[U][0]],Y[U][1],u[k]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let s=0;s<20;s++){if(L=this.IDATA.face[s],w=L[2],g=L[1],B=L[0],j=P.x+"|"+P.y,k=s+"|"+j,k in u||(u[k]=w,Z[w]=[L[Y[j][0]],Y[j][1]]),j=mH.x+"|"+mH.y,k=s+"|"+j,k in u||(u[k]=g,Z[g]=[L[Y[j][0]],Y[j][1]]),j=l.x+"|"+l.y,k=s+"|"+j,k in u||(u[k]=B,Z[B]=[L[Y[j][0]],Y[j][1]]),U=this.IDATA.edgematch[s][0],h=this.IDATA.edgematch[s][1],"B"===h)for(let H=1;H<b;H++)p.x=J-H*(d+G),p.y=O+H*d,a.x=-H*G,a.y=H*(d+G),j=p.x+"|"+p.y,M=a.x+"|"+a.y,F(s,U,j,M);if("O"===h)for(let H=1;H<b;H++)a.x=-H*G,a.y=H*(d+G),r.x=H*d,r.y=H*G,j=a.x+"|"+a.y,M=r.x+"|"+r.y,F(s,U,j,M);if(U=this.IDATA.edgematch[s][2],h=this.IDATA.edgematch[s][3],h&&"A"===h)for(let H=1;H<b;H++)r.x=H*d,r.y=H*G,p.x=J-(b-H)*(d+G),p.y=O+(b-H)*d,j=r.x+"|"+r.y,M=p.x+"|"+p.y,F(s,U,j,M);for(let J=0;J<this.vertices.length;J++)j=this.vertices[J].x+"|"+this.vertices[J].y,k=s+"|"+j,k in u||(u[k]=H++,Y[j][0]>2?Z[u[k]]=[-Y[j][0],Y[j][1],u[k]]:Z[u[k]]=[L[Y[j][0]],Y[j][1],u[k]])}this.closestTo=Z,this.vecToidx=u}calcCoeffs(){const H=this.m,u=this.n,J=Math.sqrt(3)/3,O=H*H+u*u+H*u;this.coau=(H+u)/O,this.cobu=-u/O,this.coav=-J*(H-u)/O,this.cobv=J*(2*H+u)/O}createInnerFacets(){const H=this.m,u=this.n;for(let J=0;J<u+H+1;J++)for(let H=this.min[J];H<this.max[J]+1;H++)H<this.max[J]&&H<this.max[J+1]+1&&this.innerFacets.push(["|"+H+"|"+J,"|"+H+"|"+(J+1),"|"+(H+1)+"|"+J]),J>0&&H<this.max[J-1]&&H+1<this.max[J]+1&&this.innerFacets.push(["|"+H+"|"+J,"|"+(H+1)+"|"+J,"|"+(H+1)+"|"+(J-1)])}edgeVecsABOB(){const H=this.m,u=this.n,J=new uH(-u,H+u);for(let O=1;O<H+u;O++){const H=new uH(this.min[O],O),u=new uH(this.min[O-1],O-1),U=new uH(this.min[O+1],O+1),h=H.clone(),w=u.clone(),g=U.clone();h.rotate60About(J),w.rotate60About(J),g.rotate60About(J);const B=new uH(this.max[h.y],h.y),b=new uH(this.max[h.y-1],h.y-1),d=new uH(this.max[h.y-1]-1,h.y-1);h.x===B.x&&h.y===B.y||(h.x!==b.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([H,b,d]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([H,d,B])):h.y===g.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([H,u,b]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([H,b,U])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([H,u,b]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([H,b,B])))}}mapABOBtoOBOA(){const H=new uH(0,0);for(let u=0;u<this.isoVecsABOB.length;u++){const J=[];for(let O=0;O<3;O++)H.x=this.isoVecsABOB[u][O].x,H.y=this.isoVecsABOB[u][O].y,0===this.vertexTypes[u][O]&&H.rotateNeg120(this.m,this.n),J.push(H.clone());this.isoVecsOBOA.push(J)}}mapABOBtoBAOA(){const H=new uH(0,0);for(let u=0;u<this.isoVecsABOB.length;u++){const J=[];for(let O=0;O<3;O++)H.x=this.isoVecsABOB[u][O].x,H.y=this.isoVecsABOB[u][O].y,1===this.vertexTypes[u][O]&&H.rotate120(this.m,this.n),J.push(H.clone());this.isoVecsBAOA.push(J)}}MapToFace(H,u){const J=this.IDATA.face[H],U=J[2],h=J[1],w=J[0],g=O.lu.Cu(this.IDATA.vertex[U]),B=O.lu.Cu(this.IDATA.vertex[h]),b=O.lu.Cu(this.IDATA.vertex[w]),d=B.ru(g),G=b.ru(g),P=d.scale(this.coau).add(G.scale(this.cobu)),mH=d.scale(this.coav).add(G.scale(this.cobv)),l=[];let r,p=O.TmpVectors.lu[0];for(let O=0;O<this.cartesian.length;O++)p=P.scale(this.cartesian[O].x).add(mH.scale(this.cartesian[O].y)).add(g),l[O]=[p.x,p.y,p.z],r=H+"|"+this.vertices[O].x+"|"+this.vertices[O].y,u.vertex[this.vecToidx[r]]=[p.x,p.y,p.z]}build(H,u){const J=[],O=uH.Zero(),U=new uH(H,u),h=new uH(-u,H+u);J.push(O,U,h);for(let j=u;j<H+1;j++)for(let u=0;u<H+1-j;u++)J.push(new uH(u,j));if(u>0){const O=(0,v.HighestCommonFactor)(H,u),U=H/O,h=u/O;for(let g=1;g<O;g++)J.push(new uH(g*U,g*h)),J.push(new uH(-g*h,g*(U+h))),J.push(new uH(H-g*(U+h),u+g*U));const w=H/u;for(let g=1;g<u;g++)for(let O=0;O<g*w;O++)J.push(new uH(O,g)),J.push(new uH(O,g).rotate120(H,u)),J.push(new uH(O,g).rotateNeg120(H,u))}J.sort(((H,u)=>H.x-u.x)),J.sort(((H,u)=>H.y-u.y));const w=new Array(H+u+1),g=new Array(H+u+1);for(let j=0;j<w.length;j++)w[j]=1/0,g[j]=-1/0;let B=0,b=0;const d=J.length;for(let j=0;j<d;j++)b=J[j].x,B=J[j].y,w[B]=Math.min(b,w[B]),g[B]=Math.max(b,g[B]);const G=(J,O)=>{const U=J.clone();return"A"===O&&U.rotateNeg120(H,u),"B"===O&&U.rotate120(H,u),U.x<0?U.y:U.x+U.y},P=[],mH=[],l=[],r=[],p={},a=[];let k=-1,C=-1;for(let j=0;j<d;j++)P[j]=J[j].toCartesianOrigin(new uH(0,0),.5),mH[j]=G(J[j],"O"),l[j]=G(J[j],"A"),r[j]=G(J[j],"B"),mH[j]===l[j]&&l[j]===r[j]?(k=3,C=mH[j]):mH[j]===l[j]?(k=4,C=mH[j]):l[j]===r[j]?(k=5,C=l[j]):r[j]===mH[j]&&(k=6,C=mH[j]),mH[j]<l[j]&&mH[j]<r[j]&&(k=2,C=mH[j]),l[j]<mH[j]&&l[j]<r[j]&&(k=1,C=l[j]),r[j]<l[j]&&r[j]<mH[j]&&(k=0,C=r[j]),a.push([k,C,J[j].x,J[j].y]);a.sort(((H,u)=>H[2]-u[2])),a.sort(((H,u)=>H[3]-u[3])),a.sort(((H,u)=>H[1]-u[1])),a.sort(((H,u)=>H[0]-u[0]));for(let j=0;j<a.length;j++)p[a[j][2]+"|"+a[j][3]]=[a[j][0],a[j][1],j];return this.m=H,this.n=u,this.vertices=J,this.vertByDist=p,this.cartesian=P,this.min=w,this.max=g,this}}class OH{constructor(H,u,J,O){this.name=H,this.category=u,this.vertex=J,this.face=O}}class UH extends OH{innerToData(H,u){for(let J=0;J<u.innerFacets.length;J++)this.face.push(u.innerFacets[J].map((J=>u.vecToidx[H+J])))}mapABOBtoDATA(H,u){const J=u.IDATA.edgematch[H][0];for(let O=0;O<u.isoVecsABOB.length;O++){const U=[];for(let h=0;h<3;h++)0===u.vertexTypes[O][h]?U.push(H+"|"+u.isoVecsABOB[O][h].x+"|"+u.isoVecsABOB[O][h].y):U.push(J+"|"+u.isoVecsABOB[O][h].x+"|"+u.isoVecsABOB[O][h].y);this.face.push([u.vecToidx[U[0]],u.vecToidx[U[1]],u.vecToidx[U[2]]])}}mapOBOAtoDATA(H,u){const J=u.IDATA.edgematch[H][0];for(let O=0;O<u.isoVecsOBOA.length;O++){const U=[];for(let h=0;h<3;h++)1===u.vertexTypes[O][h]?U.push(H+"|"+u.isoVecsOBOA[O][h].x+"|"+u.isoVecsOBOA[O][h].y):U.push(J+"|"+u.isoVecsOBOA[O][h].x+"|"+u.isoVecsOBOA[O][h].y);this.face.push([u.vecToidx[U[0]],u.vecToidx[U[1]],u.vecToidx[U[2]]])}}mapBAOAtoDATA(H,u){const J=u.IDATA.edgematch[H][2];for(let O=0;O<u.isoVecsBAOA.length;O++){const U=[];for(let h=0;h<3;h++)1===u.vertexTypes[O][h]?U.push(H+"|"+u.isoVecsBAOA[O][h].x+"|"+u.isoVecsBAOA[O][h].y):U.push(J+"|"+u.isoVecsBAOA[O][h].x+"|"+u.isoVecsBAOA[O][h].y);this.face.push([u.vecToidx[U[0]],u.vecToidx[U[1]],u.vecToidx[U[2]]])}}orderData(H){const u=[];for(let h=0;h<13;h++)u[h]=[];const J=H.closestTo;for(let h=0;h<J.length;h++)J[h][0]>-1?J[h][1]>0&&u[J[h][0]].push([h,J[h][1]]):u[12].push([h,J[h][0]]);const O=[];for(let h=0;h<12;h++)O[h]=h;let U=12;for(let h=0;h<12;h++){u[h].sort(((H,u)=>H[1]-u[1]));for(let H=0;H<u[h].length;H++)O[u[h][H][0]]=U++}for(let h=0;h<u[12].length;h++)O[u[12][h][0]]=U++;for(let h=0;h<this.vertex.length;h++)this.vertex[h].push(O[h]);this.vertex.sort(((H,u)=>H[3]-u[3]));for(let h=0;h<this.vertex.length;h++)this.vertex[h].pop();for(let h=0;h<this.face.length;h++)for(let H=0;H<this.face[h].length;H++)this.face[h][H]=O[this.face[h][H]];this.sharedNodes=u[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(H,u){const J=[],O=[];let U=u.pop();O.push(U);let h=this.face[U].indexOf(H);h=(h+2)%3;let w=this.face[U][h];J.push(w);let g=0;for(;u.length>0;)U=u[g],this.face[U].indexOf(w)>-1?(h=(this.face[U].indexOf(w)+1)%3,w=this.face[U][h],J.push(w),O.push(U),u.splice(g,1),g=0):g++;return this.adjacentFaces.push(J),O}toGoldbergPolyhedronData(){const H=new OH("GeoDual","Goldberg",[],[]);H.name="GD dual";const u=this.vertex.length,J=new Array(u);for(let B=0;B<u;B++)J[B]=[];for(let B=0;B<this.face.length;B++)for(let H=0;H<3;H++)J[this.face[B][H]].push(B);let O=0,U=0,h=0,w=[],g=[];this.adjacentFaces=[];for(let B=0;B<J.length;B++){H.face[B]=this.setOrder(B,J[B].concat([]));for(const u of J[B]){O=0,U=0,h=0,w=this.face[u];for(let H=0;H<3;H++)g=this.vertex[w[H]],O+=g[0],U+=g[1],h+=g[2];H.vertex[u]=[O/3,U/3,h/3]}}return H}static BuildGeodesicData(H){const u=new UH("Geodesic-m-n","Geodesic",[[0,HH.g,-1],[-HH.g,1,0],[-1,0,-HH.g],[1,0,-HH.g],[HH.g,1,0],[0,HH.g,1],[-1,0,HH.g],[-HH.g,-1,0],[0,-HH.g,-1],[HH.g,-1,0],[1,0,HH.g],[0,-HH.g,1]],[]);H.setIndices(),H.calcCoeffs(),H.createInnerFacets(),H.edgeVecsABOB(),H.mapABOBtoOBOA(),H.mapABOBtoBAOA();for(let J=0;J<H.IDATA.face.length;J++)H.MapToFace(J,u),u.innerToData(J,H),"B"===H.IDATA.edgematch[J][1]&&u.mapABOBtoDATA(J,H),"O"===H.IDATA.edgematch[J][1]&&u.mapOBOAtoDATA(J,H),"A"===H.IDATA.edgematch[J][3]&&u.mapBAOAtoDATA(J,H);u.orderData(H);return u.vertex=u.vertex.map((function(H){const u=H[0],J=H[1],O=H[2],U=Math.sqrt(u*u+J*J+O*O);return H[0]*=1/U,H[1]*=1/U,H[2]*=1/U,H})),u}}U.c._GoldbergMeshParser=(H,u)=>hH.Parse(H,u);class hH extends U.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(H,u){return void 0===u?(H>this.goldbergData.nbUnsharedFaces-1&&(Q.b.Warn("Maximum number of unshared faces used"),H=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+H):(H>11&&(Q.b.Warn("Last pole used"),H=11),u>this.goldbergData.nbFacesAtPole-1&&(Q.b.Warn("Maximum number of faces at a pole used"),u=this.goldbergData.nbFacesAtPole-1),12+H*this.goldbergData.nbFacesAtPole+u)}_changeGoldbergFaceColors(H){for(let J=0;J<H.length;J++){const u=H[J][0],O=H[J][1],U=H[J][2];for(let H=u;H<O+1;H++)this.goldbergData.faceColors[H]=U}const u=[];for(let J=0;J<12;J++)for(let H=0;H<5;H++)u.push(this.goldbergData.faceColors[J].r,this.goldbergData.faceColors[J].g,this.goldbergData.faceColors[J].b,this.goldbergData.faceColors[J].a);for(let J=12;J<this.goldbergData.faceColors.length;J++)for(let H=0;H<6;H++)u.push(this.goldbergData.faceColors[J].r,this.goldbergData.faceColors[J].g,this.goldbergData.faceColors[J].b,this.goldbergData.faceColors[J].a);return u}setGoldbergFaceColors(H){const u=this._changeGoldbergFaceColors(H);this.RH(h.d.ColorKind,u)}updateGoldbergFaceColors(H){const u=this._changeGoldbergFaceColors(H);this.updateVerticesData(h.d.ColorKind,u)}_changeGoldbergFaceUVs(H){const u=this.getVerticesData(h.d.UVKind);for(let J=0;J<H.length;J++){const O=H[J][0],U=H[J][1],h=H[J][2],w=H[J][3],g=H[J][4],B=[],b=[];let d,G;for(let H=0;H<5;H++)d=h.x+w*Math.cos(g+H*Math.PI/2.5),G=h.y+w*Math.sin(g+H*Math.PI/2.5),d<0&&(d=0),d>1&&(d=1),B.push(d,G);for(let H=0;H<6;H++)d=h.x+w*Math.cos(g+H*Math.PI/3),G=h.y+w*Math.sin(g+H*Math.PI/3),d<0&&(d=0),d>1&&(d=1),b.push(d,G);for(let H=O;H<Math.min(12,U+1);H++)for(let J=0;J<5;J++)u[10*H+2*J]=B[2*J],u[10*H+2*J+1]=B[2*J+1];for(let H=Math.max(12,O);H<U+1;H++)for(let J=0;J<6;J++)u[12*H-24+2*J]=b[2*J],u[12*H-23+2*J]=b[2*J+1]}return u}setGoldbergFaceUVs(H){const u=this._changeGoldbergFaceUVs(H);this.RH(h.d.UVKind,u)}updateGoldbergFaceUVs(H){const u=this._changeGoldbergFaceUVs(H);this.updateVerticesData(h.d.UVKind,u)}placeOnGoldbergFaceAt(H,u,J){const U=O.lu.RotationFromAxis(this.goldbergData.faceXaxis[u],this.goldbergData.faceYaxis[u],this.goldbergData.faceZaxis[u]);H.rotation=U,H.position=this.goldbergData.faceCenters[u].add(this.goldbergData.faceXaxis[u].scale(J.x)).add(this.goldbergData.faceYaxis[u].scale(J.y)).add(this.goldbergData.faceZaxis[u].scale(J.z))}serialize(H){super.serialize(H),H.type="GoldbergMesh";const u={};if(u.adjacentFaces=this.goldbergData.adjacentFaces,u.nbSharedFaces=this.goldbergData.nbSharedFaces,u.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,u.nbFaces=this.goldbergData.nbFaces,u.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){u.faceColors=[];for(const H of this.goldbergData.faceColors)u.faceColors.push(H.Hg())}if(this.goldbergData.faceCenters){u.faceCenters=[];for(const H of this.goldbergData.faceCenters)u.faceCenters.push(H.Hg())}if(this.goldbergData.faceZaxis){u.faceZaxis=[];for(const H of this.goldbergData.faceZaxis)u.faceZaxis.push(H.Hg())}if(this.goldbergData.faceYaxis){u.faceYaxis=[];for(const H of this.goldbergData.faceYaxis)u.faceYaxis.push(H.Hg())}if(this.goldbergData.faceXaxis){u.faceXaxis=[];for(const H of this.goldbergData.faceXaxis)u.faceXaxis.push(H.Hg())}H.goldbergData=u}static Parse(H,u){const J=H.goldbergData;J.faceColors=J.faceColors.map((H=>P.Mg.Cu(H))),J.faceCenters=J.faceCenters.map((H=>O.lu.Cu(H))),J.faceZaxis=J.faceZaxis.map((H=>O.lu.Cu(H))),J.faceXaxis=J.faceXaxis.map((H=>O.lu.Cu(H))),J.faceYaxis=J.faceYaxis.map((H=>O.lu.Cu(H)));const U=new hH(H.name,u);return U.goldbergData=J,U}}var wH=J(12878);const gH={CreateBox:G.c,CreateTiledBox:p,CreateSphere:a.d,CreateDisc:d.b,CreateIcoSphere:S,CreateRibbon:b,CreateCylinder:M,CreateTorus:Z,CreateTorusKnot:F,CreateLineSystem:s.f,Zd:s.h,CreateDashedLines:s.b,ExtrudeShape:e,ExtrudeShapeCustom:c,CreateLathe:V,CreateTiledPlane:l,sd:T.b,CreateGround:R.f,CreateTiledGround:R.i,CreateGroundFromHeightMap:R.b,CreatePolygon:A.d,ExtrudePolygon:A.h,CreateTube:X,CreatePolyhedron:f,CreateGeodesic:function(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,O=u.m||1;O!==Math.floor(O)&&(O=Math.floor(O),Q.b.Warn("m not an integer only floor(m) used"));let U=u.n||0;if(U!==Math.floor(U)&&(U=Math.floor(U),Q.b.Warn("n not an integer only floor(n) used")),U>O){const H=U;U=O,O=H,Q.b.Warn("n > m therefore m and n swapped")}const h=new JH;return h.build(O,U),f(H,{custom:UH.BuildGeodesicData(h),size:u.size,sizeX:u.sizeX,sizeY:u.sizeY,sizeZ:u.sizeZ,faceUV:u.faceUV,faceColors:u.faceColors,flat:u.flat,updatable:u.updatable,sideOrientation:u.sideOrientation,frontUVs:u.frontUVs,backUVs:u.backUVs},J)},CreateGoldberg:function(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=u.size,B=u.sizeX||h||1,b=u.sizeY||h||1,d=u.sizeZ||h||1;let G=u.m||1;G!==Math.floor(G)&&(G=Math.floor(G),Q.b.Warn("m not an integer only floor(m) used"));let mH=u.n||0;if(mH!==Math.floor(mH)&&(mH=Math.floor(mH),Q.b.Warn("n not an integer only floor(n) used")),mH>G){const H=mH;mH=G,G=H,Q.b.Warn("n > m therefore m and n swapped")}const l=new JH;l.build(G,mH);const r=UH.BuildGeodesicData(l),p=r.toGoldbergPolyhedronData(),a=new hH(H,J);u.sideOrientation=U.c._GetDefaultSideOrientation(u.sideOrientation),a._originalBuilderSideOrientation=u.sideOrientation;(function(H,u){const J=H.size,U=H.sizeX||J||1,h=H.sizeY||J||1,B=H.sizeZ||J||1,b=0===H.sideOrientation?0:H.sideOrientation||w.d.DEFAULTSIDE,d=[],G=[],P=[],mH=[];let l=1/0,r=-1/0,p=1/0,a=-1/0;for(let O=0;O<u.vertex.length;O++)l=Math.min(l,u.vertex[O][0]*U),r=Math.max(r,u.vertex[O][0]*U),p=Math.min(p,u.vertex[O][1]*h),a=Math.max(a,u.vertex[O][1]*h);let k=0;for(let w=0;w<u.face.length;w++){const H=u.face[w],J=O.lu.Cu(u.vertex[H[0]]),b=O.lu.Cu(u.vertex[H[2]]),C=O.lu.Cu(u.vertex[H[1]]),j=b.ru(J),M=C.ru(J),L=O.lu.Cross(M,j).normalize();for(let O=0;O<H.length;O++){P.push(L.x,L.y,L.z);const J=u.vertex[H[O]];d.push(J[0]*U,J[1]*h,J[2]*B);const w=(J[1]*h-p)/(a-p);mH.push((J[0]*U-l)/(r-l),g.e?1-w:w)}for(let u=0;u<H.length-2;u++)G.push(k,k+u+2,k+u+1);k+=H.length}w.d._ComputeSides(b,d,G,P,mH);const C=new w.d;return C.FH=d,C.indices=G,C.sH=P,C.tH=mH,C})(u,p).cH(a,u.updatable),a.goldbergData.nbSharedFaces=r.sharedNodes,a.goldbergData.nbUnsharedFaces=r.poleNodes,a.goldbergData.adjacentFaces=r.adjacentFaces,a.goldbergData.nbFaces=a.goldbergData.nbSharedFaces+a.goldbergData.nbUnsharedFaces,a.goldbergData.nbFacesAtPole=(a.goldbergData.nbUnsharedFaces-12)/12;for(let U=0;U<r.vertex.length;U++)a.goldbergData.faceCenters.push(O.lu.Cu(r.vertex[U])),a.goldbergData.faceCenters[U].x*=B,a.goldbergData.faceCenters[U].y*=b,a.goldbergData.faceCenters[U].z*=d,a.goldbergData.faceColors.push(new P.Mg(1,1,1,1));for(let U=0;U<p.face.length;U++){const H=p.face[U],u=O.lu.Cu(p.vertex[H[0]]),J=O.lu.Cu(p.vertex[H[2]]),h=O.lu.Cu(p.vertex[H[1]]),w=J.ru(u),g=h.ru(u),B=O.lu.Cross(g,w).normalize(),b=O.lu.Cross(g,B).normalize();a.goldbergData.faceXaxis.push(g.normalize()),a.goldbergData.faceYaxis.push(B),a.goldbergData.faceZaxis.push(b)}return a},CreateDecal:N,CreateCapsule:E,CreateText:wH.c}},13621:(H,u,J)=>{"use strict";J.d(u,{c:()=>gu});var O=J(12338),U=J(12691);class h extends U.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var w=J(12379),g=(J(12493),J(12304));class B{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(H){this._targetStopDuration!==H&&(this._targetStopDuration=H)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(H){this._noiseTexture!==H&&(this._noiseTexture=H,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(H){this._animationSheetEnabled!==H&&(this._animationSheetEnabled=H)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(H){this._isAnimationSheetEnabled!=H&&(this._isAnimationSheetEnabled=H,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(H){this._useLogarithmicDepth=H&&this.ZH().getEngine().getCaps().fragmentDepthSupported}ZH(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(H){switch(H){case B.BLENDMODE_MULTIPLYADD:return;case B.BLENDMODE_ADD:H=1;break;case B.BLENDMODE_ONEONE:H=6;break;case B.BLENDMODE_STANDARD:H=2;break;case B.BLENDMODE_MULTIPLY:H=4;break;case B.BLENDMODE_SUBTRACT:H=3}this._engine.setAlphaMode(H)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:O.lu.Zero()}set direction1(H){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=H)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:O.lu.Zero()}set direction2(H){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=H)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:O.lu.Zero()}set minEmitBox(H){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=H)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:O.lu.Zero()}set maxEmitBox(H){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=H)}get billboardMode(){return this._billboardMode}set billboardMode(H){this._billboardMode!==H&&(this._billboardMode=H,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(H){this._isBillboardBased!==H&&(this._isBillboardBased=H,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(H){this._attachImageProcessingConfiguration(H)}_attachImageProcessingConfiguration(H){H!==this._imageProcessingConfiguration&&(!H&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=H)}_reset(){}_removeGradientAndTexture(H,u,J){if(!u)return this;let O=0;for(const U of u){if(U.gradient===H){u.splice(O,1);break}O++}return J&&J.dispose(),this}constructor(H){this.animations=[],this.renderingGroupId=0,this.Ou=O.lu.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new O.lu(10,10,10),this.onAnimationEnd=null,this.blendMode=B.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new O.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Cd=new O.lu(0,0,0),this._useLogarithmicDepth=!1,this.gravity=O.lu.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new w.Mg(1,1,1,1),this.color2=new w.Mg(1,1,1,1),this.colorDead=new w.Mg(0,0,0,1),this.textureMask=new w.Mg(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new h,this.id=H,this.name=H}createPointEmitter(H,u){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new O.lu(0,1,0),arguments.length>2&&void 0!==arguments[2]||new O.lu(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new O.lu(0,1,0),arguments.length>4&&void 0!==arguments[4]||new O.lu(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new O.lu(0,1,0),arguments.length>3&&void 0!==arguments[3]||new O.lu(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(H,u,J,O){throw new Error("Method not implemented.")}}B.BLENDMODE_ONEONE=0,B.BLENDMODE_STANDARD=1,B.BLENDMODE_ADD=2,B.BLENDMODE_MULTIPLY=3,B.BLENDMODE_MULTIPLYADD=4,B.BLENDMODE_SUBTRACT=-1,(0,g.f)("BABYLON.BaseParticleSystem",B);var b=J(12349),d=J(12191);class G{constructor(){this.direction1=new O.lu(0,1,0),this.direction2=new O.lu(0,1,0),this.minEmitBox=new O.lu(-.5,-.5,-.5),this.maxEmitBox=new O.lu(.5,.5,.5)}startDirectionFunction(H,u,J,U){const h=(0,b.RandomRange)(this.direction1.x,this.direction2.x),w=(0,b.RandomRange)(this.direction1.y,this.direction2.y),g=(0,b.RandomRange)(this.direction1.z,this.direction2.z);if(U)return u.x=h,u.y=w,void(u.z=g);O.lu.TransformNormalFromFloatsToRef(h,w,g,H,u)}startPositionFunction(H,u,J,U){const h=(0,b.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),w=(0,b.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),g=(0,b.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(U)return u.x=h,u.y=w,void(u.z=g);O.lu.TransformCoordinatesFromFloatsToRef(h,w,g,H,u)}clone(){const H=new G;return d.e.DeepCopy(this,H),H}applyToShader(H){H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2),H.setVector3("minEmitBox",this.minEmitBox),H.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(H){H.addUniform("direction1",3),H.addUniform("direction2",3),H.addUniform("minEmitBox",3),H.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.direction1=this.direction1.Hg(),H.direction2=this.direction2.Hg(),H.minEmitBox=this.minEmitBox.Hg(),H.maxEmitBox=this.maxEmitBox.Hg(),H}parse(H){O.lu.FromArrayToRef(H.direction1,0,this.direction1),O.lu.FromArrayToRef(H.direction2,0,this.direction2),O.lu.FromArrayToRef(H.minEmitBox,0,this.minEmitBox),O.lu.FromArrayToRef(H.maxEmitBox,0,this.maxEmitBox)}}class P{get radius(){return this._radius}set radius(H){this._radius=H,this._buildHeight()}get angle(){return this._angle}set angle(H){this._angle=H,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=J,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=u,this.radius=H}startDirectionFunction(H,u,J,U){U?O.TmpVectors.lu[0].O(J.zg).normalize():J.position.subtractToRef(H.getTranslation(),O.TmpVectors.lu[0]).normalize();const h=(0,b.RandomRange)(0,this.directionRandomizer),w=(0,b.RandomRange)(0,this.directionRandomizer),g=(0,b.RandomRange)(0,this.directionRandomizer);u.x=O.TmpVectors.lu[0].x+h,u.y=O.TmpVectors.lu[0].y+w,u.z=O.TmpVectors.lu[0].z+g,u.normalize()}startPositionFunction(H,u,J,U){const h=(0,b.RandomRange)(0,2*Math.PI);let w;this.emitFromSpawnPointOnly?w=1e-4:(w=(0,b.RandomRange)(0,this.heightRange),w=1-w*w);let g=this._radius-(0,b.RandomRange)(0,this._radius*this.radiusRange);g*=w;const B=g*Math.sin(h),d=g*Math.cos(h),G=w*this._height;if(U)return u.x=B,u.y=G,void(u.z=d);O.lu.TransformCoordinatesFromFloatsToRef(B,G,d,H,u)}clone(){const H=new P(this._radius,this._angle,this.directionRandomizer);return d.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat2("radius",this._radius,this.radiusRange),H.setFloat("coneAngle",this._angle),H.setFloat2("height",this._height,this.heightRange),H.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(H){H.addUniform("radius",2),H.addUniform("coneAngle",1),H.addUniform("height",2),H.addUniform("directionRandomizer",1)}getEffectDefines(){let H="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(H+="\n#define CONEEMITTERSPAWNPOINT"),H}getClassName(){return"ConeParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.radius=this._radius,H.angle=this._angle,H.directionRandomizer=this.directionRandomizer,H.radiusRange=this.radiusRange,H.heightRange=this.heightRange,H.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,H}parse(H){this.radius=H.radius,this.angle=H.angle,this.directionRandomizer=H.directionRandomizer,this.radiusRange=void 0!==H.radiusRange?H.radiusRange:1,this.heightRange=void 0!==H.radiusRange?H.heightRange:1,this.emitFromSpawnPointOnly=void 0!==H.emitFromSpawnPointOnly&&H.emitFromSpawnPointOnly}}class mH extends P{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.lu(0,1,0),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.lu(0,1,0);super(H,u),this.direction1=J,this.direction2=U}startDirectionFunction(H,u){const J=(0,b.RandomRange)(this.direction1.x,this.direction2.x),U=(0,b.RandomRange)(this.direction1.y,this.direction2.y),h=(0,b.RandomRange)(this.direction1.z,this.direction2.z);O.lu.TransformNormalFromFloatsToRef(J,U,h,H,u)}clone(){const H=new mH(this.radius,this.angle,this.direction1,this.direction2);return d.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("radiusRange",this.radiusRange),H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("radiusRange",1),H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const H=super.serialize();return H.direction1=this.direction1.Hg(),H.direction2=this.direction2.Hg(),H}parse(H){super.parse(H),this.direction1.O(H.direction1),this.direction2.O(H.direction2)}}class l{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=H,this.height=u,this.radiusRange=J,this.directionRandomizer=U,this._tempVector=O.lu.Zero()}startDirectionFunction(H,u,J,U,h){J.position.subtractToRef(H.getTranslation(),this._tempVector),this._tempVector.normalize(),O.lu.TransformNormalToRef(this._tempVector,h,this._tempVector);const w=(0,b.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let g=Math.atan2(this._tempVector.x,this._tempVector.z);g+=(0,b.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=w,this._tempVector.x=Math.sin(g),this._tempVector.z=Math.cos(g),this._tempVector.normalize(),U?u.O(this._tempVector):O.lu.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,H,u)}startPositionFunction(H,u,J,U){const h=(0,b.RandomRange)(-this.height/2,this.height/2),w=(0,b.RandomRange)(0,2*Math.PI),g=(0,b.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),B=Math.sqrt(g)*this.radius,d=B*Math.cos(w),G=B*Math.sin(w);U?u.kg(d,h,G):O.lu.TransformCoordinatesFromFloatsToRef(d,h,G,H,u)}clone(){const H=new l(this.radius,this.directionRandomizer);return d.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("height",this.height),H.setFloat("radiusRange",this.radiusRange),H.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("height",1),H.addUniform("radiusRange",1),H.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.radius=this.radius,H.height=this.height,H.radiusRange=this.radiusRange,H.directionRandomizer=this.directionRandomizer,H}parse(H){this.radius=H.radius,this.height=H.height,this.radiusRange=H.radiusRange,this.directionRandomizer=H.directionRandomizer}}class r extends l{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.lu(0,1,0),h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new O.lu(0,1,0);super(H,u,J),this.direction1=U,this.direction2=h}startDirectionFunction(H,u,J,U){const h=(0,b.RandomRange)(this.direction1.x,this.direction2.x),w=(0,b.RandomRange)(this.direction1.y,this.direction2.y),g=(0,b.RandomRange)(this.direction1.z,this.direction2.z);U?u.kg(h,w,g):O.lu.TransformNormalFromFloatsToRef(h,w,g,H,u)}clone(){const H=new r(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return d.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("height",this.height),H.setFloat("radiusRange",this.radiusRange),H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("height",1),H.addUniform("radiusRange",1),H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const H=super.serialize();return H.direction1=this.direction1.Hg(),H.direction2=this.direction2.Hg(),H}parse(H){super.parse(H),O.lu.FromArrayToRef(H.direction1,0,this.direction1),O.lu.FromArrayToRef(H.direction2,0,this.direction2)}}class p{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=H,this.radiusRange=u,this.directionRandomizer=J}startDirectionFunction(H,u,J,U){const h=J.position.ru(H.getTranslation()).normalize(),w=(0,b.RandomRange)(0,this.directionRandomizer),g=(0,b.RandomRange)(0,this.directionRandomizer),B=(0,b.RandomRange)(0,this.directionRandomizer);h.x+=w,h.y+=g,h.z+=B,h.normalize(),U?u.O(h):O.lu.TransformNormalFromFloatsToRef(h.x,h.y,h.z,H,u)}startPositionFunction(H,u,J,U){const h=this.radius-(0,b.RandomRange)(0,this.radius*this.radiusRange),w=(0,b.RandomRange)(0,1),g=(0,b.RandomRange)(0,2*Math.PI),B=Math.acos(2*w-1),d=h*Math.cos(g)*Math.sin(B),G=h*Math.cos(B),P=h*Math.sin(g)*Math.sin(B);U?u.kg(d,Math.abs(G),P):O.lu.TransformCoordinatesFromFloatsToRef(d,Math.abs(G),P,H,u)}clone(){const H=new p(this.radius,this.directionRandomizer);return d.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("radiusRange",this.radiusRange),H.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("radiusRange",1),H.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.radius=this.radius,H.radiusRange=this.radiusRange,H.directionRandomizer=this.directionRandomizer,H}parse(H){this.radius=H.radius,this.radiusRange=H.radiusRange,this.directionRandomizer=H.directionRandomizer}}class a{constructor(){this.direction1=new O.lu(0,1,0),this.direction2=new O.lu(0,1,0)}startDirectionFunction(H,u,J,U){const h=(0,b.RandomRange)(this.direction1.x,this.direction2.x),w=(0,b.RandomRange)(this.direction1.y,this.direction2.y),g=(0,b.RandomRange)(this.direction1.z,this.direction2.z);U?u.kg(h,w,g):O.lu.TransformNormalFromFloatsToRef(h,w,g,H,u)}startPositionFunction(H,u,J,U){U?u.kg(0,0,0):O.lu.TransformCoordinatesFromFloatsToRef(0,0,0,H,u)}clone(){const H=new a;return d.e.DeepCopy(this,H),H}applyToShader(H){H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.direction1=this.direction1.Hg(),H.direction2=this.direction2.Hg(),H}parse(H){O.lu.FromArrayToRef(H.direction1,0,this.direction1),O.lu.FromArrayToRef(H.direction2,0,this.direction2)}}class k{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=H,this.radiusRange=u,this.directionRandomizer=J}startDirectionFunction(H,u,J,U){const h=J.position.ru(H.getTranslation()).normalize(),w=(0,b.RandomRange)(0,this.directionRandomizer),g=(0,b.RandomRange)(0,this.directionRandomizer),B=(0,b.RandomRange)(0,this.directionRandomizer);h.x+=w,h.y+=g,h.z+=B,h.normalize(),U?u.O(h):O.lu.TransformNormalFromFloatsToRef(h.x,h.y,h.z,H,u)}startPositionFunction(H,u,J,U){const h=this.radius-(0,b.RandomRange)(0,this.radius*this.radiusRange),w=(0,b.RandomRange)(0,1),g=(0,b.RandomRange)(0,2*Math.PI),B=Math.acos(2*w-1),d=h*Math.cos(g)*Math.sin(B),G=h*Math.cos(B),P=h*Math.sin(g)*Math.sin(B);U?u.kg(d,G,P):O.lu.TransformCoordinatesFromFloatsToRef(d,G,P,H,u)}clone(){const H=new k(this.radius,this.directionRandomizer);return d.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("radiusRange",this.radiusRange),H.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("radiusRange",1),H.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.radius=this.radius,H.radiusRange=this.radiusRange,H.directionRandomizer=this.directionRandomizer,H}parse(H){this.radius=H.radius,this.radiusRange=H.radiusRange,this.directionRandomizer=H.directionRandomizer}}class C extends k{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O.lu(0,1,0),J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.lu(0,1,0);super(H),this.direction1=u,this.direction2=J}startDirectionFunction(H,u){const J=(0,b.RandomRange)(this.direction1.x,this.direction2.x),U=(0,b.RandomRange)(this.direction1.y,this.direction2.y),h=(0,b.RandomRange)(this.direction1.z,this.direction2.z);O.lu.TransformNormalFromFloatsToRef(J,U,h,H,u)}clone(){const H=new C(this.radius,this.direction1,this.direction2);return d.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("radiusRange",this.radiusRange),H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("radiusRange",1),H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const H=super.serialize();return H.direction1=this.direction1.Hg(),H.direction2=this.direction2.Hg(),H}parse(H){super.parse(H),this.direction1.O(H.direction1),this.direction2.O(H.direction2)}}class j{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(H,u,J,U){const h=O.TmpVectors.lu[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,J,h);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,J,h);const H=O.TmpVectors.lu[1];h.subtractToRef(J.position,H),H.scaleToRef(1/J.lifeTime,h)}else h.set(0,0,0);U?u.O(h):O.lu.TransformNormalToRef(h,H,u)}startPositionFunction(H,u,J,U){const h=O.TmpVectors.lu[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,J,h):h.set(0,0,0),U?u.O(h):O.lu.TransformCoordinatesToRef(h,H,u)}clone(){const H=new j;return d.e.DeepCopy(this,H),H}applyToShader(H){}buildUniformLayout(H){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.particlePositionGenerator=this.particlePositionGenerator,H.particleDestinationGenerator=this.particleDestinationGenerator,H}parse(H){H.particlePositionGenerator&&(this.particlePositionGenerator=H.particlePositionGenerator),H.particleDestinationGenerator&&(this.particleDestinationGenerator=H.particleDestinationGenerator)}}var M=J(12410);class L{get mesh(){return this._mesh}set mesh(H){this._mesh!==H&&(this._mesh=H,H?(this._indices=H.rg(),this._positions=H.getVerticesData(M.d.PositionKind),this._normals=H.getVerticesData(M.d.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=O.lu.Zero(),this._mesh=null,this.direction1=new O.lu(0,1,0),this.direction2=new O.lu(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=H}startDirectionFunction(H,u,J,U){if(this.useMeshNormalsForDirection&&this._normals)return void O.lu.TransformNormalToRef(this._storedNormal,H,u);const h=(0,b.RandomRange)(this.direction1.x,this.direction2.x),w=(0,b.RandomRange)(this.direction1.y,this.direction2.y),g=(0,b.RandomRange)(this.direction1.z,this.direction2.z);U?u.kg(h,w,g):O.lu.TransformNormalFromFloatsToRef(h,w,g,H,u)}startPositionFunction(H,u,J,U){if(!this._indices||!this._positions)return;const h=3*(Math.random()*(this._indices.length/3)|0),w=Math.random(),g=Math.random()*(1-w),B=1-w-g,b=this._indices[h],d=this._indices[h+1],G=this._indices[h+2],P=O.TmpVectors.lu[0],mH=O.TmpVectors.lu[1],l=O.TmpVectors.lu[2],r=O.TmpVectors.lu[3];O.lu.FromArrayToRef(this._positions,3*b,P),O.lu.FromArrayToRef(this._positions,3*d,mH),O.lu.FromArrayToRef(this._positions,3*G,l),r.x=w*P.x+g*mH.x+B*l.x,r.y=w*P.y+g*mH.y+B*l.y,r.z=w*P.z+g*mH.z+B*l.z,U?u.kg(r.x,r.y,r.z):O.lu.TransformCoordinatesFromFloatsToRef(r.x,r.y,r.z,H,u),this.useMeshNormalsForDirection&&this._normals&&(O.lu.FromArrayToRef(this._normals,3*b,P),O.lu.FromArrayToRef(this._normals,3*d,mH),O.lu.FromArrayToRef(this._normals,3*G,l),this._storedNormal.x=w*P.x+g*mH.x+B*l.x,this._storedNormal.y=w*P.y+g*mH.y+B*l.y,this._storedNormal.z=w*P.z+g*mH.z+B*l.z)}clone(){const H=new L(this.mesh);return d.e.DeepCopy(this,H),H}applyToShader(H){H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var H;const u={};return u.type=this.getClassName(),u.direction1=this.direction1.Hg(),u.direction2=this.direction2.Hg(),u.meshId=null===(H=this.mesh)||void 0===H?void 0:H.id,u.useMeshNormalsForDirection=this.useMeshNormalsForDirection,u}parse(H,u){O.lu.FromArrayToRef(H.direction1,0,this.direction1),O.lu.FromArrayToRef(H.direction2,0,this.direction2),H.meshId&&u&&(this.mesh=u.getLastMeshById(H.meshId)),this.useMeshNormalsForDirection=H.useMeshNormalsForDirection}}class Z{_isUbo(H){return void 0!==H.addUniform}constructor(H){this._isUbo(H)?(this.setMatrix3x3=H.updateMatrix3x3.bind(H),this.setMatrix2x2=H.updateMatrix2x2.bind(H),this.setFloat=H.updateFloat.bind(H),this.setFloat2=H.updateFloat2.bind(H),this.setFloat3=H.updateFloat3.bind(H),this.setFloat4=H.updateFloat4.bind(H),this.setFloatArray=H.updateFloatArray.bind(H),this.setArray=H.updateArray.bind(H),this.setIntArray=H.updateIntArray.bind(H),this.setMatrix=H.wg.bind(H),this.setMatrices=H.updateMatrices.bind(H),this.setVector3=H.updateVector3.bind(H),this.setVector4=H.updateVector4.bind(H),this.setColor3=H.updateColor3.bind(H),this.setColor4=H.updateColor4.bind(H),this.setDirectColor4=H.updateDirectColor4.bind(H),this.setInt=H.updateInt.bind(H),this.setInt2=H.updateInt2.bind(H),this.setInt3=H.updateInt3.bind(H),this.setInt4=H.updateInt4.bind(H)):(this.setMatrix3x3=H.setMatrix3x3.bind(H),this.setMatrix2x2=H.setMatrix2x2.bind(H),this.setFloat=H.setFloat.bind(H),this.setFloat2=H.setFloat2.bind(H),this.setFloat3=H.setFloat3.bind(H),this.setFloat4=H.setFloat4.bind(H),this.setFloatArray=H.setFloatArray.bind(H),this.setArray=H.setArray.bind(H),this.setIntArray=H.setIntArray.bind(H),this.setMatrix=H.setMatrix.bind(H),this.setMatrices=H.setMatrices.bind(H),this.setVector3=H.setVector3.bind(H),this.setVector4=H.setVector4.bind(H),this.setColor3=H.setColor3.bind(H),this.setColor4=H.setColor4.bind(H),this.setDirectColor4=H.setDirectColor4.bind(H),this.setInt=H.setInt.bind(H),this.setInt2=H.setInt2.bind(H),this.setInt3=H.setInt3.bind(H),this.setInt4=H.setInt4.bind(H))}}var Y=J(12259);const F="gpuUpdateParticlesPixelShader",s="#version 300 es\nvoid main() {discard;}\n";Y.b.ShadersStore[F]||(Y.b.ShadersStore[F]=s);const A="gpuUpdateParticlesVertexShader",t="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";Y.b.ShadersStore[A]||(Y.b.ShadersStore[A]=t);(0,g.f)("BABYLON.WebGL2ParticleSystem",class{constructor(H,u){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=H,this._engine=u,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var H;return(null===(H=this._updateEffect)||void 0===H?void 0:H.isReady())??!1}createUpdateBuffer(H){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof j&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=H,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new Z(this._updateEffect)}createVertexBuffers(H,u){this._updateVAO.push(this._createUpdateVAO(H)),this._renderVAO.push(this._engine.recordVertexArrayObject(u,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=u}createParticleBuffer(H){return H}bindDrawBuffers(H,u,J){J?this._engine.bindBuffers(this._renderVertexBuffers,J,u):this._engine.bindVertexArrayObject(this._renderVAO[H],null)}preUpdateParticleBuffer(){const H=this._engine;if(this._engine.enableEffect(this._updateEffect),!H.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(H,u,J){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[H],null);const O=this._engine;O.bindTransformFeedbackBuffer(u.getBuffer()),O.setRasterizerState(!1),O.beginTransformFeedback(!0),O.drawArraysType(3,0,J),O.endTransformFeedback(),O.setRasterizerState(!0),O.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let H=0;H<this._updateVAO.length;H++)this._engine.releaseVertexArrayObject(this._updateVAO[H]);this._updateVAO.length=0;for(let H=0;H<this._renderVAO.length;H++)this._engine.releaseVertexArrayObject(this._renderVAO[H]);this._renderVAO.length=0}_createUpdateVAO(H){const u={};u.position=H.createVertexBuffer("position",0,3);let J=3;u.age=H.createVertexBuffer("age",J,1),J+=1,u.size=H.createVertexBuffer("size",J,3),J+=3,u.life=H.createVertexBuffer("life",J,1),J+=1,u.seed=H.createVertexBuffer("seed",J,4),J+=4,u.direction=H.createVertexBuffer("direction",J,3),J+=3,this._parent.particleEmitterType instanceof j&&(u.initialPosition=H.createVertexBuffer("initialPosition",J,3),J+=3),this._parent._colorGradientsTexture||(u.color=H.createVertexBuffer("color",J,4),J+=4),this._parent._isBillboardBased||(u.initialDirection=H.createVertexBuffer("initialDirection",J,3),J+=3),this._parent.noiseTexture&&(u.noiseCoordinates1=H.createVertexBuffer("noiseCoordinates1",J,3),J+=3,u.noiseCoordinates2=H.createVertexBuffer("noiseCoordinates2",J,3),J+=3),this._parent._angularSpeedGradientsTexture?(u.angle=H.createVertexBuffer("angle",J,1),J+=1):(u.angle=H.createVertexBuffer("angle",J,2),J+=2),this._parent._isAnimationSheetEnabled&&(u.cellIndex=H.createVertexBuffer("cellIndex",J,1),J+=1,this._parent.spriteRandomStartCell&&(u.cellStartOffset=H.createVertexBuffer("cellStartOffset",J,1),J+=1));const O=this._engine.recordVertexArrayObject(u,null,this._updateEffect);return this._engine.bindArrayBuffer(null),O}});class e{constructor(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,O=arguments.length>3?arguments[3]:void 0;this._engine=H,this._label=O,this._engine._storageBuffers.push(this),this._create(u,J)}_create(H,u){this._bufferSize=H,this._creationFlags=u,this._buffer=this._engine.createStorageBuffer(H,u,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(H,u,J){this._buffer&&this._engine.updateStorageBuffer(this._buffer,H,u,J)}async read(H,u,J,O){return await this._engine.readFromStorageBuffer(this._buffer,H,u,J,O)}dispose(){const H=this._engine._storageBuffers,u=H.indexOf(this);-1!==u&&(H[u]=H[H.length-1],H.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var c=J(12324),n=J(12329),V=J(12365),T=J(12321),R=J(12630),X=J(12185),W=J(12284),f=J(12539);class i{constructor(){this._gpuTimeInFrameId=-1,this.counter=new f.e}_addDuration(H,u){H<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==H?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(u,!1),this._gpuTimeInFrameId=H):this.counter.addCount(u,!1))}}var S=J(12240);class v{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=H,this._engine=u,this.uniqueId=R.d.UniqueId,u.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new i),this._engine.getCaps().supportComputeShaders?O.bindingsMapping?(this._context=u.createComputeContext(),this._shaderPath=J,this._options={bindingsMapping:{},defines:[],...O}):X.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):X.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(H,u){let J=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const O=this._bindings[H];this._bindings[H]={type:J?0:4,object:u,indexInGroupEntries:null===O||void 0===O?void 0:O.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!O||O.object!==u||O.type!==this._bindings[H].type)}setStorageTexture(H,u){const J=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!J||J.object!==u),this._bindings[H]={type:1,object:u,indexInGroupEntries:null===J||void 0===J?void 0:J.indexInGroupEntries}}setExternalTexture(H,u){const J=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!J||J.object!==u),this._bindings[H]={type:6,object:u,indexInGroupEntries:null===J||void 0===J?void 0:J.indexInGroupEntries}}setVideoTexture(H,u){return!!u.externalTexture&&(this.setExternalTexture(H,u.externalTexture),!0)}setUniformBuffer(H,u){const J=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!J||J.object!==u),this._bindings[H]={type:v._BufferIsDataBuffer(u)?7:2,object:u,indexInGroupEntries:null===J||void 0===J?void 0:J.indexInGroupEntries}}setStorageBuffer(H,u){const J=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!J||J.object!==u),this._bindings[H]={type:v._BufferIsDataBuffer(u)?7:3,object:u,indexInGroupEntries:null===J||void 0===J?void 0:J.indexInGroupEntries}}setTextureSampler(H,u){const J=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!J||!u.compareSampler(J.object)),this._bindings[H]={type:5,object:u,indexInGroupEntries:null===J||void 0===J?void 0:J.indexInGroupEntries}}isReady(){let H=this._effect;for(const U in this._bindings){const H=this._bindings[U],u=H.type,J=H.object;switch(u){case 0:case 4:case 1:if(!J.isReady())return!1;break;case 6:if(!J.isReady())return!1;break}}const u=[],J=this._shaderPath;if(this._options.defines)for(let U=0;U<this._options.defines.length;U++)u.push(this._options.defines[U]);const O=u.join("\n");return this._cachedDefines!==O&&(this._cachedDefines=O,H=this._engine.createComputeEffect(J,{defines:O,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=H),!!H.isReady()}dispatch(H,u,J){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,H,u,J,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const J=v._BufferIsDataBuffer(H)?H:H.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,J,u,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const u in this._bindings){const J=this._bindings[u];if(!this._options.bindingsMapping[u])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+u+"'");switch(J.type){case 0:{const O=this._samplers[u],U=J.object;var H;if(!O||!U._texture||!O.compareSampler(U._texture))this._samplers[u]=(new W.d).setParameters(U.wrapU,U.wrapV,U.wrapR,U.anisotropicFilteringLevel,U._texture.samplingMode,null===(H=U._texture)||void 0===H?void 0:H._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const H=J.object;H.getBuffer()!==J.buffer&&(J.buffer=H.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((U=>{(0,S.c)((()=>this.dispatch(H,u,J)),U,void 0,O)}))}serialize(){const H=V.d.Serialize(this);H.options=this._options,H.shaderPath=this._shaderPath,H.Zm={},H.textures={};for(const u in this._bindings){const J=this._bindings[u],O=J.object;switch(J.type){case 0:case 4:case 1:{const U=O.serialize();U&&(H.textures[u]=U,H.Zm[u]={type:J.type});break}}}return H}static Parse(H,u,J){const O=V.d.Parse((()=>new v(H.name,u.getEngine(),H.shaderPath,H.options)),H,u,J);for(const U in H.textures){const h=H.Zm[U],w=T.b.Parse(H.textures[U],u,J);0===h.type?O.setTexture(U,w):4===h.type?O.setTexture(U,w,!1):O.setStorageTexture(U,w)}return O}static _BufferIsDataBuffer(H){return void 0!==H.underlyingResource}}(0,c.c)([(0,n.I)()],v.prototype,"name",void 0),(0,c.c)([(0,n.I)()],v.prototype,"fastMode",void 0),(0,g.f)("BABYLON.ComputeShader",v);var I=J(12602);const D="gpuUpdateParticlesComputeShader",o="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";Y.b.ShadersStoreWGSL[D]||(Y.b.ShadersStoreWGSL[D]=o);(0,g.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(H,u){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=H,this._engine=u}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var H;return(null===(H=this._updateComputeShader)||void 0===H?void 0:H.isReady())??!1}createUpdateBuffer(H){var u;const J={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(J.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(J.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(J.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(J.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(J.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(J.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(J.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new v("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:J,defines:H.split("\n")}),null===(u=this._simParamsComputeShader)||void 0===u||u.dispose(),this._simParamsComputeShader=new I.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new Z(this._simParamsComputeShader)}createVertexBuffers(H,u){this._renderVertexBuffers.push(u)}createParticleBuffer(H){const u=new e(this._engine,4*H.length,11,"ComputeShaderParticleSystemBuffer");return u.update(H),this._bufferComputeShader.push(u),u.getBuffer()}bindDrawBuffers(H,u,J){this._engine.bindBuffers(this._renderVertexBuffers[H],J,u)}preUpdateParticleBuffer(){}updateParticleBuffer(H,u,J){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[H]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^H]),this._updateComputeShader.dispatch(Math.ceil(J/64))}releaseBuffers(){var H;for(let u=0;u<this._bufferComputeShader.length;++u)this._bufferComputeShader[u].dispose();this._bufferComputeShader.length=0,null===(H=this._simParamsComputeShader)||void 0===H||H.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class y{constructor(H,u,J){this.gradient=H,this.color1=u,this.color2=J}getColorToRef(H){this.color2?w.Mg.LerpToRef(this.color1,this.color2,Math.random(),H):H.O(this.color1)}}class x{constructor(H,u){this.gradient=H,this.color=u}}class z{constructor(H,u,J){this.gradient=H,this.factor1=u,this.factor2=J}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class K{static GetCurrentGradient(H,u,J){if(u[0].gradient>H)return void J(u[0],u[0],1);for(let U=0;U<u.length-1;U++){const O=u[U],h=u[U+1];if(H>=O.gradient&&H<=h.gradient){return void J(O,h,(H-O.gradient)/(h.gradient-O.gradient))}}const O=u.length-1;J(u[O],u[O],1)}}var N=J(12175),q=J(12801),E=J(12203);class Q{constructor(H){this.particleSystem=H,this.position=O.lu.Zero(),this.direction=O.lu.Zero(),this.color=new w.Mg(0,0,0,0),this.colorStep=new w.Mg(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new O.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new w.Mg(0,0,0,0),this._currentColor2=new w.Mg(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=Q._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let H=this.age,u=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===u?(u=1,H=this._randomCellOffset):H+=this._randomCellOffset);const J=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let O;O=this._initialSpriteCellLoop?(0,b.Clamp)(H*u%this.lifeTime/this.lifeTime):(0,b.Clamp)(H*u/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+O*J|0}_inheritParticleInfoToSubEmitter(H){if(H.particleSystem.Ou.position){const u=H.particleSystem.Ou;if(u.position.O(this.position),H.inheritDirection){const H=O.TmpVectors.lu[0];this.direction.normalizeToRef(H),u.setDirection(H,0,Math.PI/2)}}else{H.particleSystem.Ou.O(this.position)}this.direction.scaleToRef(H.inheritedVelocityAmount/2,O.TmpVectors.lu[0]),H.particleSystem._inheritedVelocityOffset.O(O.TmpVectors.lu[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const H of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(H)}_reset(){this.age=0,this.id=Q._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(H){H.position.O(this.position),this._initialDirection?H._initialDirection?H._initialDirection.O(this._initialDirection):H._initialDirection=this._initialDirection.clone():H._initialDirection=null,H.direction.O(this.direction),this.zg&&(H.zg?H.zg.O(this.zg):H.zg=this.zg.clone()),H.color.O(this.color),H.colorStep.O(this.colorStep),H.lifeTime=this.lifeTime,H.age=this.age,H._randomCellOffset=this._randomCellOffset,H.size=this.size,H.scale.O(this.scale),H.angle=this.angle,H.angularSpeed=this.angularSpeed,H.particleSystem=this.particleSystem,H.cellIndex=this.cellIndex,H.id=this.id,H._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(H._currentColorGradient=this._currentColorGradient,H._currentColor1.O(this._currentColor1),H._currentColor2.O(this._currentColor2)),this._currentSizeGradient&&(H._currentSizeGradient=this._currentSizeGradient,H._currentSize1=this._currentSize1,H._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(H._currentAngularSpeedGradient=this._currentAngularSpeedGradient,H._currentAngularSpeed1=this._currentAngularSpeed1,H._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(H._currentVelocityGradient=this._currentVelocityGradient,H._currentVelocity1=this._currentVelocity1,H._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(H._currentLimitVelocityGradient=this._currentLimitVelocityGradient,H._currentLimitVelocity1=this._currentLimitVelocity1,H._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(H._currentDragGradient=this._currentDragGradient,H._currentDrag1=this._currentDrag1,H._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(H._initialStartSpriteCellId=this._initialStartSpriteCellId,H._initialEndSpriteCellId=this._initialEndSpriteCellId,H._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(H.remapData&&this.remapData?H.remapData.O(this.remapData):H.remapData=new O.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(H._randomNoiseCoordinates1?(H._randomNoiseCoordinates1.O(this._randomNoiseCoordinates1),H._randomNoiseCoordinates2.O(this._randomNoiseCoordinates2)):(H._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),H._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}Q._Count=0;var HH=J(12445),uH=(J(12485),J(12675)),JH=J(12673),OH=J(12593);function UH(H,u){const J=(0,b.RandomRange)(0,1);w.Mg.LerpToRef(u.color1,u.color2,J,H.color),u.colorDead.subtractToRef(H.color,u._colorDiff),u._colorDiff.scaleToRef(1/H.lifeTime,H.colorStep)}function hH(H,u){H._currentColorGradient=u._colorGradients[0],H._currentColorGradient.getColorToRef(H.color),H._currentColor1.O(H.color),u._colorGradients.length>1?u._colorGradients[1].getColorToRef(H._currentColor2):H._currentColor2.O(H.color)}function wH(H,u){const J=u._colorGradients;K.GetCurrentGradient(u._ratio,J,((u,J,O)=>{u!==H._currentColorGradient&&(H._currentColor1.O(H._currentColor2),J.getColorToRef(H._currentColor2),H._currentColorGradient=u),w.Mg.LerpToRef(H._currentColor1,H._currentColor2,O,H.color)}))}function gH(H,u){H.colorStep.scaleToRef(u._scaledUpdateSpeed,u._scaledColorStep),H.color.addInPlace(u._scaledColorStep),H.color.a<0&&(H.color.a=0)}function BH(H,u){K.GetCurrentGradient(u._ratio,u._angularSpeedGradients,((u,J,O)=>{u!==H._currentAngularSpeedGradient&&(H._currentAngularSpeed1=H._currentAngularSpeed2,H._currentAngularSpeed2=J.getFactor(),H._currentAngularSpeedGradient=u),H.angularSpeed=(0,b.Lerp)(H._currentAngularSpeed1,H._currentAngularSpeed2,O)}))}function bH(H,u){H.angle+=H.angularSpeed*u._scaledUpdateSpeed}function dH(H,u){u.particleEmitterType.startDirectionFunction(u._emitterWorldMatrix,H.direction,H,u.isLocal,u._emitterInverseWorldMatrix)}function GH(H,u){u.startDirectionFunction(u._emitterWorldMatrix,H.direction,H,u.isLocal)}function PH(H,u){H._currentVelocityGradient=u._velocityGradients[0],H._currentVelocity1=H._currentVelocityGradient.getFactor(),u._velocityGradients.length>1?H._currentVelocity2=u._velocityGradients[1].getFactor():H._currentVelocity2=H._currentVelocity1}function mu(H,u){H._currentLimitVelocityGradient=u._limitVelocityGradients[0],H._currentLimitVelocity1=H._currentLimitVelocityGradient.getFactor(),u._limitVelocityGradients.length>1?H._currentLimitVelocity2=u._limitVelocityGradients[1].getFactor():H._currentLimitVelocity2=H._currentLimitVelocity1}function lH(H,u){K.GetCurrentGradient(u._ratio,u._velocityGradients,((J,O,U)=>{J!==H._currentVelocityGradient&&(H._currentVelocity1=H._currentVelocity2,H._currentVelocity2=O.getFactor(),H._currentVelocityGradient=J),u._directionScale*=(0,b.Lerp)(H._currentVelocity1,H._currentVelocity2,U)}))}function rH(H,u){K.GetCurrentGradient(u._ratio,u._limitVelocityGradients,((J,O,U)=>{J!==H._currentLimitVelocityGradient&&(H._currentLimitVelocity1=H._currentLimitVelocity2,H._currentLimitVelocity2=O.getFactor(),H._currentLimitVelocityGradient=J);const h=(0,b.Lerp)(H._currentLimitVelocity1,H._currentLimitVelocity2,U);H.direction.length()>h&&H.direction.scaleInPlace(u.limitVelocityDamping)}))}function pH(H,u){H.direction.scaleToRef(u._directionScale,u._scaledDirection)}function aH(H,u){u.particleEmitterType.startPositionFunction(u._emitterWorldMatrix,H.position,H,u.isLocal)}function kH(H,u){u.startPositionFunction(u._emitterWorldMatrix,H.position,H,u.isLocal)}function CH(H,u){H.zg?H.zg.O(H.position):H.zg=H.position.clone(),O.lu.TransformCoordinatesToRef(H.zg,u._emitterWorldMatrix,H.position)}function jH(H,u){u.isLocal&&H.zg?(H.zg.addInPlace(u._scaledDirection),O.lu.TransformCoordinatesToRef(H.zg,u._emitterWorldMatrix,H.position)):H.position.addInPlace(u._scaledDirection)}function MH(H,u){H._currentDragGradient=u._dragGradients[0],H._currentDrag1=H._currentDragGradient.getFactor(),u._dragGradients.length>1?H._currentDrag2=u._dragGradients[1].getFactor():H._currentDrag2=H._currentDrag1}function LH(H,u){K.GetCurrentGradient(u._ratio,u._dragGradients,((J,O,U)=>{J!==H._currentDragGradient&&(H._currentDrag1=H._currentDrag2,H._currentDrag2=O.getFactor(),H._currentDragGradient=J);const h=(0,b.Lerp)(H._currentDrag1,H._currentDrag2,U);u._scaledDirection.scaleInPlace(1-h)}))}function ZH(H,u){H._randomNoiseCoordinates1?(H._randomNoiseCoordinates1.kg(Math.random(),Math.random(),Math.random()),H._randomNoiseCoordinates2.kg(Math.random(),Math.random(),Math.random())):(H._randomNoiseCoordinates1=new O.lu(Math.random(),Math.random(),Math.random()),H._randomNoiseCoordinates2=new O.lu(Math.random(),Math.random(),Math.random()))}function YH(H,u){const J=u._noiseTextureData,U=u._noiseTextureSize;if(J&&U&&H._randomNoiseCoordinates1){const h=u._fetchR(H._randomNoiseCoordinates1.x,H._randomNoiseCoordinates1.y,U.width,U.height,J),w=u._fetchR(H._randomNoiseCoordinates1.z,H._randomNoiseCoordinates2.x,U.width,U.height,J),g=u._fetchR(H._randomNoiseCoordinates2.y,H._randomNoiseCoordinates2.z,U.width,U.height,J),B=O.TmpVectors.lu[0],b=O.TmpVectors.lu[1];B.kg((2*h-1)*u.noiseStrength.x,(2*w-1)*u.noiseStrength.y,(2*g-1)*u.noiseStrength.z),B.scaleToRef(u._tempScaledUpdateSpeed,b),H.direction.addInPlace(b)}}function FH(H,u){u.gravity.scaleToRef(u._tempScaledUpdateSpeed,u._scaledGravity),H.direction.addInPlace(u._scaledGravity)}function sH(H,u){H.size=(0,b.RandomRange)(u.minSize,u.maxSize),H.scale.kg((0,b.RandomRange)(u.minScaleX,u.maxScaleX),(0,b.RandomRange)(u.minScaleY,u.maxScaleY))}function AH(H,u){H._currentSizeGradient=u._sizeGradients[0],H._currentSize1=H._currentSizeGradient.getFactor(),H.size=H._currentSize1,u._sizeGradients.length>1?H._currentSize2=u._sizeGradients[1].getFactor():H._currentSize2=H._currentSize1,H.scale.kg((0,b.RandomRange)(u.minScaleX,u.maxScaleX),(0,b.RandomRange)(u.minScaleY,u.maxScaleY))}function tH(H,u){const J=u._actualFrame/u.targetStopDuration;K.GetCurrentGradient(J,u._startSizeGradients,((J,O,U)=>{J!==u._currentStartSizeGradient&&(u._currentStartSize1=u._currentStartSize2,u._currentStartSize2=O.getFactor(),u._currentStartSizeGradient=J);const h=(0,b.Lerp)(u._currentStartSize1,u._currentStartSize2,U);H.scale.scaleInPlace(h)}))}function eH(H,u){K.GetCurrentGradient(u._ratio,u._sizeGradients,((u,J,O)=>{u!==H._currentSizeGradient&&(H._currentSize1=H._currentSize2,H._currentSize2=J.getFactor(),H._currentSizeGradient=u),H.size=(0,b.Lerp)(H._currentSize1,H._currentSize2,O)}))}function cH(H,u){H.remapData=new O.Vector4(0,1,0,1)}function nH(H,u){u._colorRemapGradients&&u._colorRemapGradients.length>0&&K.GetCurrentGradient(u._ratio,u._colorRemapGradients,((u,J,O)=>{const U=(0,b.Lerp)(u.factor1,J.factor1,O),h=(0,b.Lerp)(u.factor2,J.factor2,O);H.remapData.x=U,H.remapData.y=h-U})),u._alphaRemapGradients&&u._alphaRemapGradients.length>0&&K.GetCurrentGradient(u._ratio,u._alphaRemapGradients,((u,J,O)=>{const U=(0,b.Lerp)(u.factor1,J.factor1,O),h=(0,b.Lerp)(u.factor2,J.factor2,O);H.remapData.z=U,H.remapData.w=h-U}))}function VH(H,u){const J=(0,b.Clamp)(u._actualFrame/u.targetStopDuration);K.GetCurrentGradient(J,u._lifeTimeGradients,((u,O)=>{const U=u,h=O,w=U.getFactor(),g=h.getFactor(),B=(J-U.gradient)/(h.gradient-U.gradient);H.lifeTime=(0,b.Lerp)(w,g,B)})),u._emitPower=(0,b.RandomRange)(u.minEmitPower,u.maxEmitPower)}function TH(H,u){H.lifeTime=(0,b.RandomRange)(u.minLifeTime,u.maxLifeTime),u._emitPower=(0,b.RandomRange)(u.minEmitPower,u.maxEmitPower)}function RH(H,u){0===u._emitPower?(H._initialDirection?H._initialDirection.O(H.direction):H._initialDirection=H.direction.clone(),H.direction.set(0,0,0)):(H._initialDirection=null,H.direction.scaleInPlace(u._emitPower)),H.direction.addInPlace(u._inheritedVelocityOffset)}function XH(H,u){H.angularSpeed=(0,b.RandomRange)(u.minAngularSpeed,u.maxAngularSpeed),H.angle=(0,b.RandomRange)(u.minInitialRotation,u.maxInitialRotation)}function WH(H,u){H._currentAngularSpeedGradient=u._angularSpeedGradients[0],H.angularSpeed=H._currentAngularSpeedGradient.getFactor(),H._currentAngularSpeed1=H.angularSpeed,u._angularSpeedGradients.length>1?H._currentAngularSpeed2=u._angularSpeedGradients[1].getFactor():H._currentAngularSpeed2=H._currentAngularSpeed1,H.angle=(0,b.RandomRange)(u.minInitialRotation,u.maxInitialRotation)}function fH(H,u){H._initialStartSpriteCellId=u.startSpriteCellID,H._initialEndSpriteCellId=u.endSpriteCellID,H._initialSpriteCellLoop=u.spriteCellLoop}function iH(H,u){H.previousItem=u.previousItem,H.nextItem=u,u.previousItem&&(u.previousItem.nextItem=H),u.previousItem=H}function SH(H,u){H.previousItem=u,H.nextItem=u.nextItem,u.nextItem&&(u.nextItem.previousItem=H),u.nextItem=H}function vH(H,u){let J=u;for(;J.nextItem;)J=J.nextItem;H.previousItem=J,H.nextItem=J.nextItem,J.nextItem=H}function IH(H){H.previousItem&&(H.previousItem.nextItem=H.nextItem),H.nextItem&&(H.nextItem.previousItem=H.previousItem)}class DH extends B{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(H){this._startDirectionFunction!==H&&(this._startDirectionFunction=H,this._directionProcessing.process=H?GH:dH)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(H){this._startPositionFunction!==H&&(this._startPositionFunction=H,this._positionCreation.process=H?kH:aH)}set onDispose(H){this._onDisposeObserver&&this.nh.remove(this._onDisposeObserver),this._onDisposeObserver=this.nh.add(H)}get B(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(H){this._useRampGradients!==H&&(this._useRampGradients=H,this._resetEffect(),H?(this._rampCreation={process:cH,previousItem:null,nextItem:null},SH(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:nH,previousItem:null,nextItem:null},SH(this._remapGradientProcessing,this._gravityProcessing)):(IH(this._rampCreation),IH(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(H){this._isLocal!==H&&(this._isLocal=H,H?(this._isLocalCreation={process:CH,previousItem:null,nextItem:null},SH(this._isLocalCreation,this._positionCreation)):IH(this._isLocalCreation))}get particles(){return this.km}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(H){this._animationSheetEnabled!==H&&(this._animationSheetEnabled=H,H?(this._sheetCreation={process:fH,previousItem:null,nextItem:null},SH(this._sheetCreation,this._colorCreation)):IH(this._sheetCreation),this._reset())}getActiveCount(){return this.km.length}getClassName(){return"Wg"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var H;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(H=this._customWrappers[u])||void 0===H?void 0:H.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[H]??this._customWrappers[0]}setCustomEffect(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[u]=new HH.c(this._engine),this._customWrappers[u].effect=H,this._customWrappers[u].drawContext&&(this._customWrappers[u].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new N.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(H){if(this.noiseTexture!==H){if(this._noiseTexture=H,!H)return IH(this._noiseCreation),void IH(this._noiseProcessing);this._noiseCreation={process:ZH,previousItem:null,nextItem:null},SH(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:YH,previousItem:null,nextItem:null},SH(this._noiseProcessing,this._positionProcessing)}}constructor(H,u,J){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(H),this._emitterInverseWorldMatrix=O.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new O.lu,this.nh=new N.b,this.onStoppedObservable=new N.b,this.onStartedObservable=new N.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.km=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new w.Mg(0,0,0,0),this._colorDiff=new w.Mg(0,0,0,0),this._scaledDirection=O.lu.Zero(),this._scaledGravity=O.lu.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=H=>{},this.recycleParticle=H=>{const u=this.km.pop();u!==H&&u.copyTo(H),this._stockParticles.push(u)},this._createParticle=()=>{let H;return 0!==this._stockParticles.length?(H=this._stockParticles.pop(),H._reset()):H=new Q(this),this._prepareParticle(H),H},this.paused=!1,this._shadersLoaded=!1,this._capacity=u,this._epsilon=g,J&&"Scene"!==J.getClassName()?(this._engine=J,this.defaultProjectionMatrix=O.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=J||E.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.pm.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:TH,previousItem:null,nextItem:null},this._positionCreation={process:aH,previousItem:null,nextItem:null},SH(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:dH,previousItem:null,nextItem:null},SH(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:RH,previousItem:null,nextItem:null},SH(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:sH,previousItem:null,nextItem:null},SH(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:XH,previousItem:null,nextItem:null},SH(this._angleCreation,this._sizeCreation),this._colorCreation={process:UH,previousItem:null,nextItem:null},SH(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,B||(this._colorProcessing={process:gH,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:bH,previousItem:null,nextItem:null},SH(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:pH,previousItem:null,nextItem:null},SH(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:jH,previousItem:null,nextItem:null},SH(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:FH,previousItem:null,nextItem:null},SH(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=h,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new HH.c(this._engine)},this._customWrappers[0].effect=U,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new G,this.updateFunction=H=>{var u;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(u=this.noiseTexture.getContent())||void 0===u||u.then((H=>{this._noiseTextureData=H})));const J=H===this.km;for(let O=0;O<H.length;O++){const u=H[O];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const U=u.age;if(u.age+=this._tempScaledUpdateSpeed,u.age>u.lifeTime){const H=u.age-U,J=u.lifeTime-U;this._tempScaledUpdateSpeed=J*this._tempScaledUpdateSpeed/H,u.age=u.lifeTime}this._ratio=u.age/u.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let h=this._updateQueueStart;for(;h;)h.process(u,this),h=h.nextItem;if(this._isAnimationSheetEnabled&&!B&&u.updateCellIndex(),u._inheritParticleInfoToSubEmitters(),u.age>=u.lifeTime){if(this._emitFromParticle(u),u._attachedSubEmitters){for(const H of u._attachedSubEmitters)H.particleSystem.disposeOnStop=!0,H.particleSystem.stop();u._attachedSubEmitters=null}this.recycleParticle(u),J&&O--}else;}}}serialize(H){throw new Error("Method not implemented.")}clone(H,u){throw new Error("Method not implemented.")}_addFactorGradient(H,u,J,O){const U=new z(u,J,O);H.push(U),H.sort(((H,u)=>H.gradient<u.gradient?-1:H.gradient>u.gradient?1:0))}_removeFactorGradient(H,u){if(!H)return;let J=0;for(const O of H){if(O.gradient===u){H.splice(J,1);break}J++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=VH:this._lifeTimeCreation.process=TH}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:tH,previousItem:null,nextItem:null},SH(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(IH(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(H){this.targetStopDuration!==H&&(this._targetStopDuration=H,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(H,u,J){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,H,u,J),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(H){return this._removeFactorGradient(this._lifeTimeGradients,H),this._syncLifeTimeCreation(),this}addSizeGradient(H,u,J){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=AH,this._sizeGradientProcessing={process:eH,previousItem:null,nextItem:null},iH(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,H,u,J),this}removeSizeGradient(H){var u;return this._removeFactorGradient(this._sizeGradients,H),0===(null===(u=this._sizeGradients)||void 0===u?void 0:u.length)&&(IH(this._sizeGradientProcessing),this._sizeCreation.process=sH),this}addColorRemapGradient(H,u,J){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,H,u,J),this}removeColorRemapGradient(H){return this._removeFactorGradient(this._colorRemapGradients,H),this}addAlphaRemapGradient(H,u,J){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,H,u,J),this}removeAlphaRemapGradient(H){return this._removeFactorGradient(this._alphaRemapGradients,H),this}addAngularSpeedGradient(H,u,J){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=WH,this._angularSpeedGradientProcessing={process:BH,previousItem:null,nextItem:null},iH(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,H,u,J),this}removeAngularSpeedGradient(H){var u;return this._removeFactorGradient(this._angularSpeedGradients,H),0===(null===(u=this._angularSpeedGradients)||void 0===u?void 0:u.length)&&(this._angleCreation.process=XH,IH(this._angularSpeedGradientProcessing)),this}addVelocityGradient(H,u,J){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:PH,previousItem:null,nextItem:null},SH(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:lH,previousItem:null,nextItem:null},iH(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,H,u,J),this}removeVelocityGradient(H){var u;return this._removeFactorGradient(this._velocityGradients,H),0===(null===(u=this._velocityGradients)||void 0===u?void 0:u.length)&&(IH(this._velocityCreation),IH(this._velocityGradientProcessing)),this}addLimitVelocityGradient(H,u,J){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:mu,previousItem:null,nextItem:null},SH(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:rH,previousItem:null,nextItem:null},SH(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,H,u,J),this}removeLimitVelocityGradient(H){var u;return this._removeFactorGradient(this._limitVelocityGradients,H),0===(null===(u=this._limitVelocityGradients)||void 0===u?void 0:u.length)&&(IH(this._limitVelocityCreation),IH(this._limitVelocityGradientProcessing)),this}addDragGradient(H,u,J){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:MH,previousItem:null,nextItem:null},iH(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:LH,previousItem:null,nextItem:null},iH(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,H,u,J),this}removeDragGradient(H){var u;return this._removeFactorGradient(this._dragGradients,H),0===(null===(u=this._dragGradients)||void 0===u?void 0:u.length)&&(IH(this._dragCreation),IH(this._dragGradientProcessing)),this}addEmitRateGradient(H,u,J){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,H,u,J),this}removeEmitRateGradient(H){return this._removeFactorGradient(this._emitRateGradients,H),this}addStartSizeGradient(H,u,J){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,H,u,J),this._syncStartSizeCreation(),this}removeStartSizeGradient(H){return this._removeFactorGradient(this._startSizeGradients,H),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const H=new Uint8Array(4*this._rawTextureWidth),u=w.TmpColors.ku[0];for(let J=0;J<this._rawTextureWidth;J++){const O=J/this._rawTextureWidth;K.GetCurrentGradient(O,this._rampGradients,((O,U,h)=>{w.ku.LerpToRef(O.color,U.color,h,u),H[4*J]=255*u.r,H[4*J+1]=255*u.g,H[4*J+2]=255*u.b,H[4*J+3]=255}))}this._rampGradientsTexture=q.d.CreateRGBATexture(H,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((H,u)=>H.gradient<u.gradient?-1:H.gradient>u.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(H,u){this._rampGradients||(this._rampGradients=[]);const J=new x(H,u);return this._rampGradients.push(J),this._syncRampGradientTexture(),this}removeRampGradient(H){return this._removeGradientAndTexture(H,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(H,u,J){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=hH,this._colorProcessing.process=wH);const O=new y(H,u,J);return this._colorGradients.push(O),this._colorGradients.sort(((H,u)=>H.gradient<u.gradient?-1:H.gradient>u.gradient?1:0)),this}removeColorGradient(H){if(!this._colorGradients)return this;let u=0;for(const J of this._colorGradients){if(J.gradient===H){this._colorGradients.splice(u,1);break}u++}return 0===this._colorGradients.length&&(this._colorCreation.process=UH,this._colorProcessing.process=gH),this}resetDrawCache(){if(this._drawWrappers){for(const H of this._drawWrappers)if(H)for(const u of H)null===u||void 0===u||u.dispose();this._drawWrappers=[]}}_fetchR(H,u,J,O,U){return U[4*(((H=.5*Math.abs(H)+.5)*J%J|0)+((u=.5*Math.abs(u)+.5)*O%O|0)*J)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const H=this._engine,u=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*u),this._vertexBuffer=new M.b(H,this._vertexData,!0,u);let J=0;const O=this._vertexBuffer.createVertexBuffer(M.d.PositionKind,J,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[M.d.PositionKind]=O,J+=3;const U=this._vertexBuffer.createVertexBuffer(M.d.ColorKind,J,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[M.d.ColorKind]=U,J+=4;const h=this._vertexBuffer.createVertexBuffer("angle",J,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=h,J+=1;const w=this._vertexBuffer.createVertexBuffer("size",J,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=w,J+=2,this._isAnimationSheetEnabled){const H=this._vertexBuffer.createVertexBuffer("cellIndex",J,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=H,J+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const H=this._vertexBuffer.createVertexBuffer("direction",J,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=H,J+=3}if(this._useRampGradients){const H=this._vertexBuffer.createVertexBuffer("remapData",J,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=H,J+=4}let g;if(this._useInstancing){const u=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new M.b(H,u,!1,2),g=this._spriteBuffer.createVertexBuffer("offset",0,2)}else g=this._vertexBuffer.createVertexBuffer("offset",J,2,this._vertexBufferSize,this._useInstancing),J+=2;this._vertexBuffers.offset=g,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const H=[],u=[];let J=0;for(let O=0;O<this._capacity;O++)H.push(J),H.push(J+1),H.push(J+2),H.push(J),H.push(J+2),H.push(J+3),u.push(J,J+1,J+1,J+2,J+2,J+3,J+3,J,J,J+3),J+=4;this._indexBuffer=this._engine.createIndexBuffer(H),this._linesIndexBuffer=this._engine.createIndexBuffer(u)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(H)setTimeout((()=>{this.start(0)}),H);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var u;-1!==(null===(u=this.Ou)||void 0===u?void 0:u.getClassName().indexOf("Mesh"))&&this.Ou.dg(!0);const H=this.noiseTexture;if(H&&H.onGeneratedObservable)H.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let u=0;u<this.preWarmCycles;u++)this.animate(!0),H.render()}))}));else for(let u=0;u<this.preWarmCycles;u++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(H))}_postStop(H){}reset(){this._stockParticles.length=0,this.km.length=0}_appendParticleVertex(H,u,J,U){let h=H*this._vertexBufferSize;if(this._vertexData[h++]=u.position.x+this.Cd.x,this._vertexData[h++]=u.position.y+this.Cd.y,this._vertexData[h++]=u.position.z+this.Cd.z,this._vertexData[h++]=u.color.r,this._vertexData[h++]=u.color.g,this._vertexData[h++]=u.color.b,this._vertexData[h++]=u.color.a,this._vertexData[h++]=u.angle,this._vertexData[h++]=u.scale.x*u.size,this._vertexData[h++]=u.scale.y*u.size,this._isAnimationSheetEnabled&&(this._vertexData[h++]=u.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[h++]=u.direction.x,this._vertexData[h++]=u.direction.y,this._vertexData[h++]=u.direction.z);else if(u._initialDirection){let H=u._initialDirection;this.isLocal&&(O.lu.TransformNormalToRef(H,this._emitterWorldMatrix,O.TmpVectors.lu[0]),H=O.TmpVectors.lu[0]),0===H.x&&0===H.z&&(H.x=.001),this._vertexData[h++]=H.x,this._vertexData[h++]=H.y,this._vertexData[h++]=H.z}else{let H=u.direction;this.isLocal&&(O.lu.TransformNormalToRef(H,this._emitterWorldMatrix,O.TmpVectors.lu[0]),H=O.TmpVectors.lu[0]),0===H.x&&0===H.z&&(H.x=.001),this._vertexData[h++]=H.x,this._vertexData[h++]=H.y,this._vertexData[h++]=H.z}this._useRampGradients&&u.remapData&&(this._vertexData[h++]=u.remapData.x,this._vertexData[h++]=u.remapData.y,this._vertexData[h++]=u.remapData.z,this._vertexData[h++]=u.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===J?J=this._epsilon:1===J&&(J=1-this._epsilon),0===U?U=this._epsilon:1===U&&(U=1-this._epsilon)),this._vertexData[h++]=J,this._vertexData[h++]=U)}_prepareParticle(H){}_createNewOnes(H){let u;for(let J=0;J<H&&this.km.length!==this._capacity;J++){u=this._createParticle(),this.km.push(u);let H=this._createQueueStart;for(;H;)H.process(u,this),H=H.nextItem;u._inheritParticleInfoToSubEmitters()}}_update(H){if(this._alive=this.km.length>0,this.Ou.position){const H=this.Ou;this._emitterWorldMatrix=H.getWorldMatrix()}else{const H=this.Ou;this._emitterWorldMatrix=O.Matrix.Translation(H.x,H.y,H.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.km),this._createNewOnes(H)}static _GetAttributeNamesOrOptions(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const O=[M.d.PositionKind,M.d.ColorKind,"angle","offset","size"];return H&&O.push("cellIndex"),u||O.push("direction"),J&&O.push("remapData"),O}static _GetEffectCreationOptions(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const O=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,uH.e)(O),H&&O.push("particlesInfos"),u&&O.push("logarithmicDepthConstant"),J&&(O.push("vFogInfos"),O.push("vFogColor")),O}fillDefines(H,u){let J=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,uH.l)(this,this._scene,H),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&H.push("#define FOG")),this._isAnimationSheetEnabled&&H.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&H.push("#define LOGARITHMICDEPTH"),u===B.BLENDMODE_MULTIPLY&&H.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&H.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(H.push("#define BILLBOARD"),this.billboardMode){case 2:H.push("#define BILLBOARDY");break;case 8:case 9:H.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&H.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:H.push("#define BILLBOARDMODE_ALL")}J&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),H.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(H,u,J){u.push(...DH._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),H.push(...DH._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),J.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,OH.e)(H,this._imageProcessingConfigurationDefines),(0,OH.b)(J,this._imageProcessingConfigurationDefines))}_getWrapper(H){const u=this._getCustomDrawWrapper(H);if(null!==u&&void 0!==u&&u.effect)return u;const J=[];this.fillDefines(J,H);const O=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let U=this._drawWrappers[O];U||(U=this._drawWrappers[O]=[]);let h=U[H];h||(h=new HH.c(this._engine),h.drawContext&&(h.drawContext.useInstancing=this._useInstancing),U[H]=h);const w=J.join("\n");if(h.defines!==w){const H=[],u=[],J=[];this.fillUniformsAttributesAndSamplerNames(u,H,J),h.setEffect(this._engine.createEffect("particles",H,u,J,w,void 0,void 0,void 0,void 0,this._shaderLanguage),w)}return h}animate(){var H;let u,J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!J&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(J?this.preWarmStepOffset:(null===(H=this._scene)||void 0===H?void 0:H.getAnimationRatio())||1),this.manualEmitCount>-1)u=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let H=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const u=this._actualFrame/this.targetStopDuration;K.GetCurrentGradient(u,this._emitRateGradients,((u,J,O)=>{u!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=J.getFactor(),this._currentEmitRateGradient=u),H=(0,b.Lerp)(this._currentEmitRate1,this._currentEmitRate2,O)}))}u=H*this._scaledUpdateSpeed|0,this._newPartsExcess+=H*this._scaledUpdateSpeed-u}if(this._newPartsExcess>1&&(u+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?u=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(u),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!J){let H=0;for(let u=0;u<this.km.length;u++){const J=this.km[u];this._appendParticleVertices(H,J),H+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.km.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(H,u){this._appendParticleVertex(H++,u,0,0),this._useInstancing||(this._appendParticleVertex(H++,u,1,0),this._appendParticleVertex(H++,u,1,1),this._appendParticleVertex(H++,u,0,1))}rebuild(){var H;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(H=this._spriteBuffer)||void 0===H||H._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!DH.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(J.bind(J,13813)),Promise.resolve().then(J.bind(J,13751))])):await Promise.all([Promise.resolve().then(J.bind(J,13738)),Promise.resolve().then(J.bind(J,13725))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Ou||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==B.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(B.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(B.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(H){const u=this._getWrapper(H),J=u.effect,U=this._engine;U.enableEffect(u);const h=this.defaultViewMatrix??this._scene.getViewMatrix();if(J.setTexture("diffuseSampler",this.particleTexture),J.setMatrix("view",h),J.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const H=this.particleTexture.getBaseSize();J.setFloat3("particlesInfos",this.spriteCellWidth/H.width,this.spriteCellHeight/H.height,this.spriteCellWidth/H.width)}if(J.setVector2("translationPivot",this.translationPivot),J.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const H=this._scene.activeCamera;J.setVector3("eyePosition",H.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),J.setTexture("rampSampler",this._rampGradientsTexture));const w=J.defines;var g,B,b,d,G,P;(this._scene&&((0,uH.f)(J,this,this._scene),this.applyFog&&(0,JH.c)(this._scene,void 0,J)),w.indexOf("#define BILLBOARDMODE_ALL")>=0&&(h.invertToRef(O.TmpVectors.Matrix[0]),J.setMatrix("invView",O.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?U.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,J):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,J)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?U.bindBuffers(this._vertexBuffers,null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?this._linesIndexBuffer:this._indexBuffer,J):U.bindBuffers(this._vertexBuffers,null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._linesIndexBufferUseInstancing:null,J);(this.useLogarithmicDepth&&this._scene&&(0,JH.h)(w,J,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(J),this._setEngineBasedOnBlendMode(H),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(J),this._useInstancing)?null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?U.drawElementsType(6,0,10,this.km.length):U.drawArraysType(7,0,4,this.km.length):null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?U.drawElementsType(1,0,10*this.km.length):U.drawElementsType(0,0,6*this.km.length);return this.km.length}render(){if(!this.isReady()||!this.km.length)return 0;const H=this._engine;H.setState&&(H.setState(!1),this.forceDepthWrite&&H.setDepthWrite(!0));let u=0;return u=this.blendMode===B.BLENDMODE_MULTIPLYADD?this._render(B.BLENDMODE_MULTIPLY)+this._render(B.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),u}_onDispose(){}dispose(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),H&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),H&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(u,J),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const H=this._scene.pm.indexOf(this);H>-1&&this._scene.pm.splice(H,1),this._scene._activeParticleSystems.dispose()}this.nh.notifyObservers(this),this.nh.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}DH.ForceGLSL=!1;var oH,yH=J(12199);!function(H){H[H.ATTACHED=0]="ATTACHED",H[H.END=1]="END"}(oH||(oH={}));class xH{constructor(H){if(this.particleSystem=H,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!H.Ou||!H.Ou.dispose){const u=(0,g.b)("BABYLON.AbstractMesh");H.Ou=new u("SubemitterSystemEmitter",H.ZH()),H._disposeEmitterOnDispose=!0}}clone(){let H=this.particleSystem.Ou;if(H){if(H instanceof O.lu)H=H.clone();else if(-1!==H.getClassName().indexOf("Mesh")){H=new((0,g.b)("BABYLON.Mesh"))("",H.ZH()),H.isVisible=!1}}else H=new O.lu;const u=new xH(this.particleSystem.clone(this.particleSystem.name,H));return u.particleSystem.name+="Clone",u.type=this.type,u.inheritDirection=this.inheritDirection,u.inheritedVelocityAmount=this.inheritedVelocityAmount,u.particleSystem._disposeEmitterOnDispose=!0,u.particleSystem.disposeOnStop=!0,u}serialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={};return u.type=this.type,u.inheritDirection=this.inheritDirection,u.inheritedVelocityAmount=this.inheritedVelocityAmount,u.particleSystem=this.particleSystem.serialize(H),u}static _ParseParticleSystem(H,u,J){throw(0,yH.d)("ParseParticle")}static Parse(H,u,J){const O=H.particleSystem,U=new xH(xH._ParseParticleSystem(O,u,J,!0));return U.type=H.type,U.inheritDirection=H.inheritDirection,U.inheritedVelocityAmount=H.inheritedVelocityAmount,U.particleSystem._isSubEmitter=!0,U}dispose(){this.particleSystem.dispose()}}var zH=J(12247);function KH(H,u){const J=new a;return J.direction1=H,J.direction2=u,J}function NH(){return new p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function qH(){return new k(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function EH(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O.lu(0,1,0),J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.lu(0,1,0);return new C(H,u,J)}function QH(){return new l(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Hu(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.lu(0,1,0),h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new O.lu(0,1,0);return new r(H,u,J,U,h)}function uu(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new P(H,u)}function Ju(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.lu(0,1,0),U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.lu(0,1,0);return new mH(H,u,J,U)}const Ou=O.lu.Zero(),Uu=O.lu.Zero(),hu=O.lu.Zero();class wu{constructor(){this.strength=0,this.position=O.lu.Zero()}_processParticle(H,u){this.position.subtractToRef(H.position,Ou);const J=Ou.lengthSquared()+1;Ou.normalize().scaleToRef(this.strength/J,Uu),Uu.scaleToRef(u._tempScaledUpdateSpeed,hu),H.direction.addInPlace(hu)}serialize(){return{position:this.position.Hg(),strength:this.strength}}}class gu extends DH{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=H=>{if(!this._subEmitters||0===this._subEmitters.length)return;const u=Math.floor(Math.random()*this._subEmitters.length);for(const J of this._subEmitters[u])if(1===J.type){const u=J.clone();H._inheritParticleInfoToSubEmitter(u),u.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(u.particleSystem),u.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(H,u){const J=KH(H,u);return this.particleEmitterType=J,J}get flowMap(){return this._flowMap}set flowMap(H){this._flowMap!==H&&(this._flowMap=H,this._flowMapUpdate&&(IH(this._flowMapUpdate),this._flowMapUpdate=null),H&&(this._flowMapUpdate={process:H=>{var u;const J=null===(u=this.ZH())||void 0===u?void 0:u.getTransformMatrix();this._flowMap._processParticle(H,this.flowMapStrength*this._tempScaledUpdateSpeed,J)},previousItem:null,nextItem:null},SH(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(H){this._attractors.push(H),1===this._attractors.length&&(this._attractorUpdate={process:H=>{for(const u of this._attractors)u._processParticle(H,this)},previousItem:null,nextItem:null},SH(this._attractorUpdate,this._directionProcessing))}removeAttractor(H){const u=this._attractors.indexOf(H);-1!==u&&this._attractors.splice(u,1),0===this._attractors.length&&IH(this._attractorUpdate)}start(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(H)}createHemisphericEmitter(){const H=NH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=H,H}createSphereEmitter(){const H=qH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=H,H}createDirectedSphereEmitter(){const H=EH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O.lu(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.lu(0,1,0));return this.particleEmitterType=H,H}createCylinderEmitter(){const H=QH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=H,H}createDirectedCylinderEmitter(){const H=Hu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.lu(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new O.lu(0,1,0));return this.particleEmitterType=H,H}createConeEmitter(){const H=uu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=H,H}createDirectedConeEmitter(){const H=Ju(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.lu(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.lu(0,1,0));return this.particleEmitterType=H,H}createBoxEmitter(H,u,J,O){const U=new G;return this.particleEmitterType=U,this.direction1=H,this.direction2=u,this.minEmitBox=J,this.maxEmitBox=O,U}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const H of this.subEmitters)H instanceof gu?this._subEmitters.push([new xH(H)]):H instanceof xH?this._subEmitters.push([H]):H instanceof Array&&this._subEmitters.push(H)}_stopSubEmitters(){if(this.activeSubSystems){for(const H of this.activeSubSystems)H.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const H=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==H&&this._rootParticleSystem.activeSubSystems.splice(H,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(H){H&&this._stopSubEmitters()}_prepareParticle(H){if(this._subEmitters&&this._subEmitters.length>0){const u=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];H._attachedSubEmitters=[];for(const J of u)if(0===J.type){const u=J.clone();H._attachedSubEmitters.push(u),u.particleSystem.start()}}}_onDispose(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),H&&this.particles)for(const J of this.particles)if(J._attachedSubEmitters)for(let H=J._attachedSubEmitters.length-1;H>=0;H-=1)J._attachedSubEmitters[H].dispose();if(u&&this.activeSubSystems)for(let J=this.activeSubSystems.length-1;J>=0;J-=1)this.activeSubSystems[J].dispose();if(this._subEmitters&&this._subEmitters.length){for(let H=0;H<this._subEmitters.length;H++)for(const u of this._subEmitters[H])u.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Ou&&this.Ou.dispose&&this.Ou.dispose(!0)}static _Parse(H,u,J,U){let h;h=J instanceof zH.d?null:J;const B=(0,g.b)("BABYLON.Texture");if(B&&h&&(H.texture?u.particleTexture=B.Parse(H.texture,h,U):H.textureName&&(u.particleTexture=new B(U+H.textureName,h,!1,void 0===H.invertY||H.invertY),u.particleTexture.name=H.textureName)),H.emitterId||0===H.emitterId||void 0!==H.Ou?H.emitterId&&h?u.Ou=h.getLastMeshById(H.emitterId):u.Ou=O.lu.Cu(H.Ou):u.Ou=O.lu.Zero(),u.isLocal=!!H.isLocal,void 0!==H.renderingGroupId&&(u.renderingGroupId=H.renderingGroupId),void 0!==H.isBillboardBased&&(u.isBillboardBased=H.isBillboardBased),void 0!==H.billboardMode&&(u.billboardMode=H.billboardMode),void 0!==H.useLogarithmicDepth&&(u.useLogarithmicDepth=H.useLogarithmicDepth),H.animations){for(let J=0;J<H.animations.length;J++){const O=H.animations[J],U=(0,g.b)("BABYLON.Animation");U&&u.animations.push(U.Parse(O))}u.beginAnimationOnStart=H.beginAnimationOnStart,u.beginAnimationFrom=H.beginAnimationFrom,u.beginAnimationTo=H.beginAnimationTo,u.beginAnimationLoop=H.beginAnimationLoop}if(H.autoAnimate&&h&&h.beginAnimation(u,H.autoAnimateFrom,H.autoAnimateTo,H.autoAnimateLoop,H.autoAnimateSpeed||1),u.startDelay=0|H.startDelay,u.minAngularSpeed=H.minAngularSpeed,u.maxAngularSpeed=H.maxAngularSpeed,u.minSize=H.minSize,u.maxSize=H.maxSize,H.minScaleX&&(u.minScaleX=H.minScaleX,u.maxScaleX=H.maxScaleX,u.minScaleY=H.minScaleY,u.maxScaleY=H.maxScaleY),void 0!==H.preWarmCycles&&(u.preWarmCycles=H.preWarmCycles,u.preWarmStepOffset=H.preWarmStepOffset),void 0!==H.minInitialRotation&&(u.minInitialRotation=H.minInitialRotation,u.maxInitialRotation=H.maxInitialRotation),u.minLifeTime=H.minLifeTime,u.maxLifeTime=H.maxLifeTime,u.minEmitPower=H.minEmitPower,u.maxEmitPower=H.maxEmitPower,u.emitRate=H.emitRate,u.gravity=O.lu.Cu(H.gravity),H.noiseStrength&&(u.noiseStrength=O.lu.Cu(H.noiseStrength)),u.color1=w.Mg.Cu(H.color1),u.color2=w.Mg.Cu(H.color2),u.colorDead=w.Mg.Cu(H.colorDead),u.updateSpeed=H.updateSpeed,u.targetStopDuration=H.targetStopDuration,u.blendMode=H.blendMode,H.colorGradients)for(const O of H.colorGradients)u.addColorGradient(O.gradient,w.Mg.Cu(O.color1),O.color2?w.Mg.Cu(O.color2):void 0);if(H.rampGradients){for(const J of H.rampGradients)u.addRampGradient(J.gradient,w.ku.Cu(J.color));u.useRampGradients=H.useRampGradients}if(H.colorRemapGradients)for(const O of H.colorRemapGradients)u.addColorRemapGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(H.alphaRemapGradients)for(const O of H.alphaRemapGradients)u.addAlphaRemapGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(H.sizeGradients)for(const O of H.sizeGradients)u.addSizeGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(H.angularSpeedGradients)for(const O of H.angularSpeedGradients)u.addAngularSpeedGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(H.velocityGradients)for(const O of H.velocityGradients)u.addVelocityGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(H.dragGradients)for(const O of H.dragGradients)u.addDragGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(H.emitRateGradients)for(const O of H.emitRateGradients)u.addEmitRateGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(H.startSizeGradients)for(const O of H.startSizeGradients)u.addStartSizeGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(H.lifeTimeGradients)for(const O of H.lifeTimeGradients)u.addLifeTimeGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);if(H.limitVelocityGradients){for(const J of H.limitVelocityGradients)u.addLimitVelocityGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);u.limitVelocityDamping=H.limitVelocityDamping}if(H.noiseTexture&&h){const J=(0,g.b)("BABYLON.ProceduralTexture");u.noiseTexture=J.Parse(H.noiseTexture,h,U)}let b;if(H.particleEmitterType){switch(H.particleEmitterType.type){case"SphereParticleEmitter":b=new k;break;case"SphereDirectedParticleEmitter":b=new C;break;case"ConeEmitter":case"ConeParticleEmitter":b=new P;break;case"ConeDirectedParticleEmitter":b=new mH;break;case"CylinderParticleEmitter":b=new l;break;case"CylinderDirectedParticleEmitter":b=new r;break;case"HemisphericParticleEmitter":b=new p;break;case"PointParticleEmitter":b=new a;break;case"MeshParticleEmitter":b=new L;break;case"CustomParticleEmitter":b=new j;break;default:b=new G}b.parse(H.particleEmitterType,h)}else b=new G,b.parse(H,h);u.particleEmitterType=b,u.startSpriteCellID=H.startSpriteCellID,u.endSpriteCellID=H.endSpriteCellID,u.spriteCellLoop=H.spriteCellLoop??!0,u.spriteCellWidth=H.spriteCellWidth,u.spriteCellHeight=H.spriteCellHeight,u.spriteCellChangeSpeed=H.spriteCellChangeSpeed,u.spriteRandomStartCell=H.spriteRandomStartCell,u.disposeOnStop=H.disposeOnStop??!1,u.manualEmitCount=H.manualEmitCount??-1}static Parse(H,u,J){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0;const g=H.name;let B,b,d=null,G=null;if(u instanceof zH.d?B=u:(b=u,B=b.getEngine()),H.customShader&&B.createEffectForParticles){G=H.customShader;const u=G.shaderOptions.defines.length>0?G.shaderOptions.defines.join("\n"):"";d=B.createEffectForParticles(G.shaderPath.fragmentElement,G.shaderOptions.uniforms,G.shaderOptions.samplers,u)}const P=new gu(g,h||H.bJ,u,d,H.isAnimationSheetEnabled);if(P.customShader=G,P._rootUrl=J,H.id&&(P.id=H.id),H.subEmitters){P.subEmitters=[];for(const O of H.subEmitters){const H=[];for(const U of O)H.push(xH.Parse(U,u,J));P.subEmitters.push(H)}}if(H.attractors)for(const w of H.attractors){const H=new wu;H.position=O.lu.Cu(w.position),H.strength=w.strength,P.addAttractor(H)}return gu._Parse(H,P,u,J),H.textureMask&&(P.textureMask=w.Mg.Cu(H.textureMask)),H.Cd&&(P.Cd=O.lu.Cu(H.Cd)),H.preventAutoStart&&(P.preventAutoStart=H.preventAutoStart),U||P.preventAutoStart||P.start(),P}serialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={};if(gu._Serialize(u,this,H),u.textureMask=this.textureMask.Hg(),u.customShader=this.customShader,u.preventAutoStart=this.preventAutoStart,u.Cd=this.Cd.Hg(),this.subEmitters){u.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const J of this._subEmitters){const O=[];for(const u of J)O.push(u.serialize(H));u.subEmitters.push(O)}}if(this._attractors&&this._attractors.length){u.attractors=[];for(const H of this._attractors)u.attractors.push(H.serialize())}return u}static _Serialize(H,u,J){if(H.name=u.name,H.id=u.id,H.bJ=u.getCapacity(),H.disposeOnStop=u.disposeOnStop,H.manualEmitCount=u.manualEmitCount,u.Ou.position){const J=u.Ou;H.emitterId=J.id}else{const J=u.Ou;H.Ou=J.Hg()}u.particleEmitterType&&(H.particleEmitterType=u.particleEmitterType.serialize()),u.particleTexture&&(J?H.texture=u.particleTexture.serialize():(H.textureName=u.particleTexture.name,H.invertY=!!u.particleTexture._invertY)),H.isLocal=u.isLocal,V.d.AppendSerializedAnimations(u,H),H.beginAnimationOnStart=u.beginAnimationOnStart,H.beginAnimationFrom=u.beginAnimationFrom,H.beginAnimationTo=u.beginAnimationTo,H.beginAnimationLoop=u.beginAnimationLoop,H.startDelay=u.startDelay,H.renderingGroupId=u.renderingGroupId,H.isBillboardBased=u.isBillboardBased,H.billboardMode=u.billboardMode,H.minAngularSpeed=u.minAngularSpeed,H.maxAngularSpeed=u.maxAngularSpeed,H.minSize=u.minSize,H.maxSize=u.maxSize,H.minScaleX=u.minScaleX,H.maxScaleX=u.maxScaleX,H.minScaleY=u.minScaleY,H.maxScaleY=u.maxScaleY,H.minEmitPower=u.minEmitPower,H.maxEmitPower=u.maxEmitPower,H.minLifeTime=u.minLifeTime,H.maxLifeTime=u.maxLifeTime,H.emitRate=u.emitRate,H.gravity=u.gravity.Hg(),H.noiseStrength=u.noiseStrength.Hg(),H.color1=u.color1.Hg(),H.color2=u.color2.Hg(),H.colorDead=u.colorDead.Hg(),H.updateSpeed=u.updateSpeed,H.targetStopDuration=u.targetStopDuration,H.blendMode=u.blendMode,H.preWarmCycles=u.preWarmCycles,H.preWarmStepOffset=u.preWarmStepOffset,H.minInitialRotation=u.minInitialRotation,H.maxInitialRotation=u.maxInitialRotation,H.startSpriteCellID=u.startSpriteCellID,H.spriteCellLoop=u.spriteCellLoop,H.endSpriteCellID=u.endSpriteCellID,H.spriteCellChangeSpeed=u.spriteCellChangeSpeed,H.spriteCellWidth=u.spriteCellWidth,H.spriteCellHeight=u.spriteCellHeight,H.spriteRandomStartCell=u.spriteRandomStartCell,H.isAnimationSheetEnabled=u.isAnimationSheetEnabled,H.useLogarithmicDepth=u.useLogarithmicDepth;const O=u.getColorGradients();if(O){H.colorGradients=[];for(const u of O){const J={gradient:u.gradient,color1:u.color1.Hg()};u.color2?J.color2=u.color2.Hg():J.color2=u.color1.Hg(),H.colorGradients.push(J)}}const U=u.getRampGradients();if(U){H.rampGradients=[];for(const u of U){const J={gradient:u.gradient,color:u.color.Hg()};H.rampGradients.push(J)}H.useRampGradients=u.useRampGradients}const h=u.getColorRemapGradients();if(h){H.colorRemapGradients=[];for(const u of h){const J={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?J.factor2=u.factor2:J.factor2=u.factor1,H.colorRemapGradients.push(J)}}const w=u.getAlphaRemapGradients();if(w){H.alphaRemapGradients=[];for(const u of w){const J={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?J.factor2=u.factor2:J.factor2=u.factor1,H.alphaRemapGradients.push(J)}}const g=u.getSizeGradients();if(g){H.sizeGradients=[];for(const u of g){const J={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?J.factor2=u.factor2:J.factor2=u.factor1,H.sizeGradients.push(J)}}const B=u.getAngularSpeedGradients();if(B){H.angularSpeedGradients=[];for(const u of B){const J={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?J.factor2=u.factor2:J.factor2=u.factor1,H.angularSpeedGradients.push(J)}}const b=u.getVelocityGradients();if(b){H.velocityGradients=[];for(const u of b){const J={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?J.factor2=u.factor2:J.factor2=u.factor1,H.velocityGradients.push(J)}}const d=u.getDragGradients();if(d){H.dragGradients=[];for(const u of d){const J={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?J.factor2=u.factor2:J.factor2=u.factor1,H.dragGradients.push(J)}}const G=u.getEmitRateGradients();if(G){H.emitRateGradients=[];for(const u of G){const J={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?J.factor2=u.factor2:J.factor2=u.factor1,H.emitRateGradients.push(J)}}const P=u.getStartSizeGradients();if(P){H.startSizeGradients=[];for(const u of P){const J={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?J.factor2=u.factor2:J.factor2=u.factor1,H.startSizeGradients.push(J)}}const mH=u.getLifeTimeGradients();if(mH){H.lifeTimeGradients=[];for(const u of mH){const J={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?J.factor2=u.factor2:J.factor2=u.factor1,H.lifeTimeGradients.push(J)}}const l=u.getLimitVelocityGradients();if(l){H.limitVelocityGradients=[];for(const u of l){const J={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?J.factor2=u.factor2:J.factor2=u.factor1,H.limitVelocityGradients.push(J)}H.limitVelocityDamping=u.limitVelocityDamping}u.noiseTexture&&(H.noiseTexture=u.noiseTexture.serialize())}clone(H,u){let J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const O={...this._customWrappers};let U=null;const h=this._engine;if(h.createEffectForParticles&&null!=this.customShader){U=this.customShader;const H=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"",u=h.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,H);O[0]?O[0].effect=u:this.setCustomEffect(u,0)}const w=this.serialize(J),g=gu.Parse(w,this._scene||this._engine,this._rootUrl);return g.name=H,g.customShader=U,g._customWrappers=O,void 0===u&&(u=this.Ou),this.noiseTexture&&(g.noiseTexture=this.noiseTexture.clone()),g.Ou=u,this.preventAutoStart||g.start(),g}}gu.BILLBOARDMODE_Y=2,gu.BILLBOARDMODE_ALL=7,gu.BILLBOARDMODE_STRETCHED=8,gu.BILLBOARDMODE_STRETCHED_LOCAL=9,xH._ParseParticleSystem=gu.Parse;var Bu=J(12577),bu=J(12568),du=J(12452);du.e.prototype.createTransformFeedback=function(){const H=this._gl.createTransformFeedback();if(!H)throw new Error("Unable to create Transform Feedback");return H},du.e.prototype.deleteTransformFeedback=function(H){this._gl.deleteTransformFeedback(H)},du.e.prototype.bindTransformFeedback=function(H){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,H)},du.e.prototype.beginTransformFeedback=function(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(H?this._gl.POINTS:this._gl.TRIANGLES)},du.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},du.e.prototype.setTranformFeedbackVaryings=function(H,u){this._gl.transformFeedbackVaryings(H,u,this._gl.INTERLEAVED_ATTRIBS)},du.e.prototype.bindTransformFeedbackBuffer=function(H){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,H?H.underlyingResource:null)},du.e.prototype.readTransformFeedbackBuffer=function(H){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,H)};const Gu="clipPlaneFragmentDeclaration2",Pu="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";Y.b.IncludesShadersStore[Gu]||(Y.b.IncludesShadersStore[Gu]=Pu);J(13626),J(13634),J(13643),J(13650),J(13655),J(13664),J(13669),J(13672);const mJ="gpuRenderParticlesPixelShader",lu="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";Y.b.ShadersStore[mJ]||(Y.b.ShadersStore[mJ]=lu);const ru="clipPlaneVertexDeclaration2",pu="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";Y.b.IncludesShadersStore[ru]||(Y.b.IncludesShadersStore[ru]=pu);J(13675),J(13679),J(13683),J(13687);const au="gpuRenderParticlesVertexShader",ku="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";Y.b.ShadersStore[au]||(Y.b.ShadersStore[au]=ku);class Cu extends B{static get IsSupported(){if(!E.e.LastCreatedEngine)return!1;const H=E.e.LastCreatedEngine.getCaps();return H.supportTransformFeedbacks||H.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(H){this._maxActiveParticleCount=Math.min(H,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(H){this.maxActiveParticleCount=H}createPointEmitter(H,u){const J=KH(H,u);return this.particleEmitterType=J,J}createHemisphericEmitter(){const H=NH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=H,H}createSphereEmitter(){const H=qH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=H,H}createDirectedSphereEmitter(){const H=EH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O.lu(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.lu(0,1,0));return this.particleEmitterType=H,H}createCylinderEmitter(){const H=QH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=H,H}createDirectedCylinderEmitter(){const H=Hu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.lu(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new O.lu(0,1,0));return this.particleEmitterType=H,H}createConeEmitter(){const H=uu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=H,H}createDirectedConeEmitter(){const H=Ju(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new O.lu(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new O.lu(0,1,0));return this.particleEmitterType=H,H}createBoxEmitter(H,u,J,O){const U=new G;return this.particleEmitterType=U,this.direction1=H,this.direction2=u,this.minEmitBox=J,this.maxEmitBox=O,U}get flowMap(){return this._flowMap}set flowMap(H){this._flowMap!==H&&(this._flowMap=H)}isReady(){if(!this.Ou||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==gu.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(gu.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(gu.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";H?setTimeout((()=>{this.start(0)}),H):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var H;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(H=this._customWrappers[u])||void 0===H?void 0:H.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[H]??this._customWrappers[0]}setCustomEffect(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[u]=new HH.c(this._engine),this._customWrappers[u].effect=H}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new N.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(H,u,J){return super._removeGradientAndTexture(H,u,J),this._releaseBuffers(),this}addColorGradient(H,u){this._colorGradients||(this._colorGradients=[]);const J=new y(H,u);return this._colorGradients.push(J),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(H&&this._colorGradients.sort(((H,u)=>H.gradient<u.gradient?-1:H.gradient>u.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(H){return this._removeGradientAndTexture(H,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const u in this._drawWrappers){var H;null===(H=this._drawWrappers[u].drawContext)||void 0===H||H.reset()}}_addFactorGradient(H,u,J){const O=new z(u,J);H.push(O),this._releaseBuffers()}addSizeGradient(H,u){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,H,u),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(H){return this._removeGradientAndTexture(H,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(H,u){if(!H)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&H.sort(((H,u)=>H.gradient<u.gradient?-1:H.gradient>u.gradient?1:0));const J=this;J[u]&&(J[u].dispose(),J[u]=null)}addAngularSpeedGradient(H,u){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,H,u),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(H){return this._removeGradientAndTexture(H,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(H,u){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,H,u),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(H){return this._removeGradientAndTexture(H,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(H,u){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,H,u),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(H){return this._removeGradientAndTexture(H,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(H,u){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,H,u),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(H){return this._removeGradientAndTexture(H,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(H){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(H,u,J){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(H),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.nh=new N.b,this.onStoppedObservable=new N.b,this.onStartedObservable=new N.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,J&&"Scene"!==J.getClassName()?(this._engine=J,this.defaultProjectionMatrix=O.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=J||E.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.pm.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,g.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,g.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,g.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,g.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new HH.c(this._engine)},this._customWrappers[0].effect=U,this._drawWrappers={0:new HH.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(u=u??{}).randomTextureSize||delete u.randomTextureSize;const w={bJ:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...u},B=u;isFinite(B)&&(w.bJ=B),this._capacity=w.bJ,this._maxActiveParticleCount=w.bJ,this._currentActiveCount=0,this._isAnimationSheetEnabled=h,this.particleEmitterType=new G;const b=Math.min(this._engine.getCaps().maxTextureSize,w.randomTextureSize);let d=[];for(let O=0;O<b;++O)d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random());this._randomTexture=new q.d(new Float32Array(d),b,1,5,J,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,d=[];for(let O=0;O<b;++O)d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random());this._randomTexture2=new q.d(new Float32Array(d),b,1,5,J,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=b}_reset(){this._releaseBuffers()}_createVertexBuffers(H,u,J){const O={};O.position=u.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let U=3;O.age=u.createVertexBuffer("age",U,1,this._attributesStrideSize,!0),U+=1,O.size=u.createVertexBuffer("size",U,3,this._attributesStrideSize,!0),U+=3,O.life=u.createVertexBuffer("life",U,1,this._attributesStrideSize,!0),U+=1,U+=4,this.billboardMode===gu.BILLBOARDMODE_STRETCHED&&(O.direction=u.createVertexBuffer("direction",U,3,this._attributesStrideSize,!0)),U+=3,this._platform.alignDataInBuffer&&(U+=1),this.particleEmitterType instanceof j&&(U+=3,this._platform.alignDataInBuffer&&(U+=1)),this._colorGradientsTexture||(O.color=u.createVertexBuffer("color",U,4,this._attributesStrideSize,!0),U+=4),this._isBillboardBased||(O.initialDirection=u.createVertexBuffer("initialDirection",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1)),this.noiseTexture&&(O.noiseCoordinates1=u.createVertexBuffer("noiseCoordinates1",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1),O.noiseCoordinates2=u.createVertexBuffer("noiseCoordinates2",U,3,this._attributesStrideSize,!0),U+=3,this._platform.alignDataInBuffer&&(U+=1)),O.angle=u.createVertexBuffer("angle",U,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?U++:U+=2,this._isAnimationSheetEnabled&&(O.cellIndex=u.createVertexBuffer("cellIndex",U,1,this._attributesStrideSize,!0),U+=1,this.spriteRandomStartCell&&(O.cellStartOffset=u.createVertexBuffer("cellStartOffset",U,1,this._attributesStrideSize,!0),U+=1)),O.offset=J.createVertexBuffer("offset",0,2),O.uv=J.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(O),this._platform.createVertexBuffers(H,O),this.resetDrawCache()}_initialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!H)return;const u=this._engine,J=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof j&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const U=this.particleEmitterType instanceof j,h=O.TmpVectors.lu[0];let w=0;for(let O=0;O<this._capacity;O++)if(J.push(0),J.push(0),J.push(0),J.push(0),J.push(0),J.push(0),J.push(0),J.push(0),J.push(Math.random()),J.push(Math.random()),J.push(Math.random()),J.push(Math.random()),U?(this.particleEmitterType.particleDestinationGenerator(O,null,h),J.push(h.x),J.push(h.y),J.push(h.z)):(J.push(0),J.push(0),J.push(0)),this._platform.alignDataInBuffer&&J.push(0),w+=16,U&&(this.particleEmitterType.particlePositionGenerator(O,null,h),J.push(h.x),J.push(h.y),J.push(h.z),this._platform.alignDataInBuffer&&J.push(0),w+=4),this._colorGradientsTexture||(J.push(0),J.push(0),J.push(0),J.push(0),w+=4),this.isBillboardBased||(J.push(0),J.push(0),J.push(0),this._platform.alignDataInBuffer&&J.push(0),w+=4),this.noiseTexture&&(J.push(Math.random()),J.push(Math.random()),J.push(Math.random()),this._platform.alignDataInBuffer&&J.push(0),J.push(Math.random()),J.push(Math.random()),J.push(Math.random()),this._platform.alignDataInBuffer&&J.push(0),w+=8),J.push(0),w+=1,this._angularSpeedGradientsTexture||(J.push(0),w+=1),this._isAnimationSheetEnabled&&(J.push(0),w+=1,this.spriteRandomStartCell&&(J.push(0),w+=1)),this._platform.alignDataInBuffer){let H=3-(w+3&3);for(w+=H;H-- >0;)J.push(0)}const g=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),B=this._platform.createParticleBuffer(J),b=this._platform.createParticleBuffer(J);this._buffer0=new M.b(u,B,!1,this._attributesStrideSize),this._buffer1=new M.b(u,b,!1,this._attributesStrideSize),this._spriteBuffer=new M.b(u,g,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let H=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(H+="\n#define BILLBOARD"),this._colorGradientsTexture&&(H+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(H+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(H+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(H+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(H+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(H+="\n#define DRAGGRADIENTS"),this._flowMap&&(H+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(H+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(H+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(H+="\n#define NOISE"),this.isLocal&&(H+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===H||(this._cachedUpdateDefines=H,this._updateBuffer=this._platform.createUpdateBuffer(H)),this._platform.isUpdateBufferReady()}_getWrapper(H){const u=this._getCustomDrawWrapper(H);if(null!==u&&void 0!==u&&u.effect)return u;const J=[];this.fillDefines(J,H);let O=this._drawWrappers[H];O||(O=new HH.c(this._engine),O.drawContext&&(O.drawContext.useInstancing=!0),this._drawWrappers[H]=O);const U=J.join("\n");if(O.defines!==U){const H=[],u=[],J=[];this.fillUniformsAttributesAndSamplerNames(u,H,J),O.setEffect(this._engine.createEffect("gpuRenderParticles",H,u,J,U),U)}return O}static _GetAttributeNamesOrOptions(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const U=[M.d.PositionKind,"age","life","size","angle"];return H||U.push(M.d.ColorKind),u&&U.push("cellIndex"),J||U.push("initialDirection"),O&&U.push("direction"),U.push("offset",M.d.UVKind),U}static _GetEffectCreationOptions(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const O=["emitterWM","Cd","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,uH.e)(O),H&&O.push("sheetInfos"),u&&O.push("logarithmicDepthConstant"),J&&(O.push("vFogInfos"),O.push("vFogColor")),O}fillDefines(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,J=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,uH.l)(this,this._scene,H),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==bu.d.FOGMODE_NONE&&H.push("#define FOG")),u===gu.BLENDMODE_MULTIPLY&&H.push("#define BLENDMULTIPLYMODE"),this.isLocal&&H.push("#define LOCAL"),this.useLogarithmicDepth&&H.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(H.push("#define BILLBOARD"),this.billboardMode){case gu.BILLBOARDMODE_Y:H.push("#define BILLBOARDY");break;case gu.BILLBOARDMODE_STRETCHED:H.push("#define BILLBOARDSTRETCHED");break;case gu.BILLBOARDMODE_ALL:H.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&H.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&H.push("#define ANIMATESHEET"),J&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),H.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(H,u,J){u.push(...Cu._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===gu.BILLBOARDMODE_STRETCHED)),H.push(...Cu._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),J.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Bu.c.PrepareUniforms(H,this._imageProcessingConfigurationDefines),Bu.c.PrepareSamplers(J,this._imageProcessingConfigurationDefines))}animate(){var H;let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(u?this.preWarmStepOffset:(null===(H=this._scene)||void 0===H?void 0:H.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(H,u){const J=this[u];if(!H||!H.length||J)return;const O=new Float32Array(this._rawTextureWidth);for(let U=0;U<this._rawTextureWidth;U++){const u=U/this._rawTextureWidth;K.GetCurrentGradient(u,H,((H,u,J)=>{O[U]=(0,b.Lerp)(H.factor1,u.factor1,J)}))}this[u]=q.d.CreateRTexture(O,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[u].name=u.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const H=new Uint8Array(4*this._rawTextureWidth),u=w.TmpColors.Mg[0];for(let J=0;J<this._rawTextureWidth;J++){const O=J/this._rawTextureWidth;K.GetCurrentGradient(O,this._colorGradients,((O,U,h)=>{w.Mg.LerpToRef(O.color1,U.color1,h,u),H[4*J]=255*u.r,H[4*J+1]=255*u.g,H[4*J+2]=255*u.b,H[4*J+3]=255*u.a}))}this._colorGradientsTexture=q.d.CreateRGBATexture(H,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(H,u){var J,U,h,w;const g=this._getWrapper(H),B=g.effect;this._engine.enableEffect(g);const b=(null===(J=this._scene)||void 0===J?void 0:J.getViewMatrix())||O.Matrix.IdentityReadOnly;if(B.setMatrix("view",b),B.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),B.setTexture("diffuseSampler",this.particleTexture),B.setVector2("translationPivot",this.translationPivot),B.setVector3("Cd",this.Cd),this.isLocal&&B.setMatrix("emitterWM",u),this._colorGradientsTexture?B.setTexture("colorGradientSampler",this._colorGradientsTexture):B.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const H=this.particleTexture.getBaseSize();B.setFloat3("sheetInfos",this.spriteCellWidth/H.width,this.spriteCellHeight/H.height,H.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const H=this._scene.activeCamera;B.setVector3("eyePosition",H.globalPosition)}const d=B.defines;if(this._scene&&((0,uH.f)(B,this,this._scene),this.applyFog&&(0,JH.c)(this._scene,void 0,B)),d.indexOf("#define BILLBOARDMODE_ALL")>=0){const H=b.clone();H.invert(),B.setMatrix("invView",H)}return this.useLogarithmicDepth&&this._scene&&(0,JH.h)(d,B,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(B),this._setEngineBasedOnBlendMode(H),this._platform.bindDrawBuffers(this._targetIndex,B,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(B),null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(w=this._scene)&&void 0!==w&&w.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(H){if(!this.Ou||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!H)if(this.Ou.position){H=this.Ou.getWorldMatrix()}else{const u=this.Ou;H=O.TmpVectors.Matrix[0],O.Matrix.TranslationToRef(u.x,u.y,u.z,H)}const u=this._engine,J=u.getDepthWrite();if(u.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const H=this.ZH();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",H.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",H),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const U=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=U,u.setDepthWrite(J)}render(){let H,u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],J=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!u&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let H=0;H<this.preWarmCycles;H++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const H=0|this._accumulatedCount;this._accumulatedCount-=H,this._currentActiveCount+=H}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Ou.position){H=this.Ou.getWorldMatrix()}else{const u=this.Ou;H=O.TmpVectors.Matrix[0],O.Matrix.TranslationToRef(u.x,u.y,u.z,H)}const U=this._engine;this.updateInAnimate||this._update(H);let h=0;return u||J||(U.setState(!1),this.forceDepthWrite&&U.setDepthWrite(!0),h=this.blendMode===gu.BLENDMODE_MULTIPLYADD?this._render(gu.BLENDMODE_MULTIPLY,H)+this._render(gu.BLENDMODE_ADD,H):this._render(this.blendMode,H),this._engine.setAlphaMode(0)),h}rebuild(){const H=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(H,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,H()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const u in this._drawWrappers){this._drawWrappers[u].dispose()}if(this._drawWrappers={},this._scene){const H=this._scene.pm.indexOf(this);H>-1&&this._scene.pm.splice(H,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let u=0;u<this._renderVertexBuffers.length;++u){const H=this._renderVertexBuffers[u];for(const u in H)H[u].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),H&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),H&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.nh.notifyObservers(this),this.nh.clear()}clone(H,u){let J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const O={...this._customWrappers};let U=null;const h=this._engine;if(h.createEffectForParticles&&null!=this.customShader){U=this.customShader;const H=U.shaderOptions.defines.length>0?U.shaderOptions.defines.join("\n"):"";O[0]=h.createEffectForParticles(U.shaderPath.fragmentElement,U.shaderOptions.uniforms,U.shaderOptions.samplers,H,void 0,void 0,void 0,this)}const w=this.serialize(J),g=Cu.Parse(w,this._scene||this._engine,this._rootUrl);return g.name=H,g.customShader=U,g._customWrappers=O,void 0===u&&(u=this.Ou),this.noiseTexture&&(g.noiseTexture=this.noiseTexture.clone()),g.Ou=u,g}serialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={};return gu._Serialize(u,this,H),u.activeParticleCount=this.activeParticleCount,u.randomTextureSize=this._randomTextureSize,u.customShader=this.customShader,u}static Parse(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0;const h=H.name;let w,g;u instanceof zH.d?w=u:(g=u,w=g.getEngine());const B=new Cu(h,{bJ:U||H.bJ,randomTextureSize:H.randomTextureSize},u,null,H.isAnimationSheetEnabled);if(B._rootUrl=J,H.customShader&&w.createEffectForParticles){const u=H.customShader,J=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"",O=w.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,J,void 0,void 0,void 0,B);B.setCustomEffect(O,0),B.customShader=u}return H.id&&(B.id=H.id),H.activeParticleCount&&(B.activeParticleCount=H.activeParticleCount),gu._Parse(H,B,u,J),H.preventAutoStart&&(B.preventAutoStart=H.preventAutoStart),O||B.preventAutoStart||B.start(),B}}var ju=J(12171),Mu=J(13694),Lu=J(12681);class Zu{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(H){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const u of this.systems)u.Ou=H;this._emitterNode=H}setEmitterAsSphere(H,u,J){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:H,renderingGroupId:u};const O=(0,Mu.d)("emitterSphere",{diameter:H.diameter,segments:H.segments},J);O.renderingGroupId=u;const U=new Lu.au("emitterSphereMaterial",J);U.emissiveColor=H.color,O.material=U;for(const h of this.systems)h.Ou=O;this._emitterNode=O}start(H){for(const u of this.systems)H&&(u.Ou=H),u.start()}dispose(){for(const H of this.systems)H.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={systems:[]};for(const J of this.systems)u.systems.push(J.serialize(H));return this._emitterNode&&(u.Ou=this._emitterCreationOptions),u}static Parse(H,u){let J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3?arguments[3]:void 0;const U=new Zu,h=this.BaseAssetsUrl+"/textures/";u=u||E.e.LastCreatedScene;for(const w of H.systems)U.systems.push(J?Cu.Parse(w,u,h,!0,O):gu.Parse(w,u,h,!0,O));if(H.Ou){const J=H.Ou.options;if("Sphere"===H.Ou.kind)U.setEmitterAsSphere({diameter:J.diameter,segments:J.segments,color:w.ku.Cu(J.color)},H.Ou.renderingGroupId,u)}return U}}Zu.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Yu=J(12201);class Fu{static CreateDefault(H){let u,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,O=arguments.length>2?arguments[2]:void 0;u=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Cu("default system",{bJ:J},O):new gu("default system",J,O),u.Ou=H;const U=ju.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return u.particleTexture=new T.b(U,u.ZH()),u.createConeEmitter(.1,Math.PI/4),u.color1=new w.Mg(1,1,1,1),u.color2=new w.Mg(1,1,1,1),u.colorDead=new w.Mg(1,1,1,0),u.minSize=.1,u.maxSize=.1,u.minEmitPower=2,u.maxEmitPower=2,u.updateSpeed=1/60,u.emitRate=30,u}static CreateAsync(H,u){let J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3?arguments[3]:void 0;u||(u=E.e.LastCreatedScene);const U={};return u.addPendingData(U),new Promise(((h,w)=>{if(J&&!Cu.IsSupported)return u.removePendingData(U),w("Particle system with GPU is not supported.");ju.Tools.LoadFile(`${Fu.BaseAssetsUrl}/systems/${H}.json`,(H=>{u.removePendingData(U);const w=JSON.parse(H.toString());return h(Zu.Parse(w,u,J,O))}),void 0,void 0,void 0,(()=>(u.removePendingData(U),w(`An error occurred with the creation of your particle system. Check if your type '${H}' exists.`))))}))}static ExportSet(H){const u=new Zu;for(const J of H)u.systems.push(J);return u}static ParseFromFileAsync(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",h=arguments.length>5?arguments[5]:void 0;return new Promise(((w,g)=>{const B=new Yu.d;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const u=JSON.parse(B.responseText);let g;g=O?Cu.Parse(u,J,U,!1,h):gu.Parse(u,J,U,!1,h),H&&(g.name=H),w(g)}else g("Unable to load the particle system")})),B.open("GET",u),B.send()}))}static ParseFromSnippetAsync(H,u){let J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",U=arguments.length>4?arguments[4]:void 0;if("_BLANK"===H){const H=this.CreateDefault(null);return H.start(),Promise.resolve(H)}return new Promise(((h,w)=>{const g=new Yu.d;g.addEventListener("readystatechange",(()=>{if(4==g.readyState)if(200==g.status){const w=JSON.parse(JSON.parse(g.responseText).jsonPayload),B=JSON.parse(w.particleSystem);let b;b=J?Cu.Parse(B,u,O,!1,U):gu.Parse(B,u,O,!1,U),b.snippetId=H,h(b)}else w("Unable to load the snippet "+H)})),g.open("GET",this.SnippetUrl+"/"+H.replace(/#/g,"/")),g.send()}))}}Fu.BaseAssetsUrl=Zu.BaseAssetsUrl,Fu.SnippetUrl="https://snippet.babylonjs.com",Fu.CreateFromSnippetAsync=Fu.ParseFromSnippetAsync;var su=J(12770),Au=J(12606),tu=J(13700);(0,tu.h)(Au.d.NAME_PARTICLESYSTEM,((H,u,J,O)=>{const U=(0,tu.i)(Au.d.NAME_PARTICLESYSTEM);if(U&&void 0!==H.pm&&null!==H.pm)for(let h=0,w=H.pm.length;h<w;h++){const w=H.pm[h];J.pm.push(U(w,u,O))}})),(0,tu.d)(Au.d.NAME_PARTICLESYSTEM,((H,u,J)=>{if(H.activeParticleCount){return Cu.Parse(H,u,J)}return gu.Parse(H,u,J)})),zH.d.prototype.createEffectForParticles=function(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",h=arguments.length>4?arguments[4]:void 0,w=arguments.length>5?arguments[5]:void 0,g=arguments.length>6?arguments[6]:void 0,B=arguments.length>7?arguments[7]:void 0,b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,d=arguments.length>9?arguments[9]:void 0,G=[],P=[];const mH=[];return B?B.fillUniformsAttributesAndSamplerNames(P,G,mH):(G=gu._GetAttributeNamesOrOptions(),P=gu._GetEffectCreationOptions()),-1===U.indexOf(" BILLBOARD")&&(U+="\n#define BILLBOARD\n"),null!==B&&void 0!==B&&B.isAnimationSheetEnabled&&-1===U.indexOf(" ANIMATESHEET")&&(U+="\n#define ANIMATESHEET\n"),-1===O.indexOf("diffuseSampler")&&O.push("diffuseSampler"),this.createEffect({vertex:d??(null===B||void 0===B?void 0:B.vertexShaderName)??"particles",fragmentElement:H},G,P.concat(u),mH.concat(O),U,h,w,g,void 0,b,(async()=>{0===b?await Promise.resolve().then(J.bind(J,13738)):await Promise.resolve().then(J.bind(J,13813))}))},su.c.prototype.getEmittedParticleSystems=function(){const H=[];for(let u=0;u<this.ZH().pm.length;u++){const J=this.ZH().pm[u];J.Ou===this&&H.push(J)}return H},su.c.prototype.getHierarchyEmittedParticleSystems=function(){const H=[],u=this.getDescendants();u.push(this);for(let J=0;J<this.ZH().pm.length;J++){const O=this.ZH().pm[J],U=O.Ou;U.position&&-1!==u.indexOf(U)&&H.push(O)}return H};J(12659),J(12666),J(12741);J(12746),J(13704),J(12521),J(12653),J(12793);J(12518);var eu;J(13711),J(12358);!function(H){H[H.Color=2]="Color",H[H.UV=1]="UV",H[H.Random=0]="Random",H[H.Stated=3]="Stated"}(eu||(eu={}));var cu=J(12555);const nu=new O.lu(0,0,0),Vu=new O.lu(0,0,0),Tu=new O.lu(0,0,0);class Ru{constructor(H,u,J){this.width=H,this.height=u,this.data=J}processFlowable(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,J=arguments.length>2?arguments[2]:void 0;if(!J)return;J instanceof O.Matrix?O.lu.TransformCoordinatesToRef(H.position,J,Tu):(Tu.x=J.x,Tu.y=J.y,Tu.z=J.z);const U=.5*Tu.x+.5,h=1-(.5*Tu.y+.5),w=Math.floor(U*this.width),g=Math.floor(h*this.height);if(w<0||w>=this.width||g<0||g>=this.height)return;const B=4*(g*this.width+w),b=this.data[B]/255*2-1,d=this.data[B+1]/255*2-1,G=this.data[B+2]/255*2-1,P=this.data[B+3]/255;nu.set(b,d,G),nu.scaleToRef(u*P,Vu),H.direction.addInPlace(Vu)}_processParticle(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,J=arguments.length>2?arguments[2]:void 0;this.processFlowable(H,u,J)}static async FromUrlAsync(H){return await new Promise(((u,J)=>{const O=document.createElement("canvas"),U=O.getContext("2d");let h=null;const w=new Image;w.crossOrigin="anonymous",w.src=H,w.onerror=u=>{J(new Error(`Failed to load image: ${H} : ${u}`))},w.onload=()=>{O.width=w.width,O.height=w.height,U.drawImage(w,0,0),h=U.getImageData(0,0,O.width,O.height),u(new Ru(O.width,O.height,h.data))}}))}static async ExtractFromTextureAsync(H){return await new Promise(((u,J)=>{if(!H.isReady())return void H.onLoadObservable.addOnce((async()=>{try{const J=await this.ExtractFromTextureAsync(H);u(J)}catch(O){J(O)}}));const O=H.getSize();cu.m.GetTextureDataAsync(H,O.width,O.height).then((H=>{u(new Ru(O.width,O.height,new Uint8ClampedArray(H)))})).catch(J)}))}}var Xu,Wu,fu,iu,Su,vu,Iu,Du,ou;!function(H){H[H.Int=1]="Int",H[H.Float=2]="Float",H[H.Vector2=4]="Vector2",H[H.lu=8]="lu",H[H.Matrix=16]="Matrix",H[H.Particle=32]="Particle",H[H.Texture=64]="Texture",H[H.Mg=128]="Mg",H[H.FloatGradient=256]="FloatGradient",H[H.Vector2Gradient=512]="Vector2Gradient",H[H.Vector3Gradient=1024]="Vector3Gradient",H[H.Color4Gradient=2048]="Color4Gradient",H[H.System=4096]="System",H[H.AutoDetect=8192]="AutoDetect",H[H.BasedOnInput=16384]="BasedOnInput",H[H.Undefined=32768]="Undefined",H[H.All=65535]="All"}(Xu||(Xu={})),function(H){H[H.Compatible=0]="Compatible",H[H.TypeIncompatible=1]="TypeIncompatible",H[H.HierarchyIssue=2]="HierarchyIssue"}(Wu||(Wu={})),function(H){H[H.Input=0]="Input",H[H.Output=1]="Output"}(fu||(fu={}));class yu{get direction(){return this._direction}get type(){if(this._type===Xu.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Xu.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(H){this._type=H}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((H=>H.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(H,u,J){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Xu.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new N.b,this.onDisconnectionObservable=new N.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=u,this.name=H,this._direction=J}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(H){var u;return this.isConnected?null!==(u=this._connectedPoint)&&void 0!==u&&u._storedFunction?this._connectedPoint._storedFunction(H):this._connectedPoint._storedValue:this.value}canConnectTo(H){return 0===this.checkCompatibilityState(H)}checkCompatibilityState(H){const u=this._ownerBlock,J=H.ownerBlock;if(this.type!==H.type&&H.innerType!==Xu.AutoDetect)return H.acceptedConnectionPointTypes&&-1!==H.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(H.excludedConnectionPointTypes&&-1!==H.excludedConnectionPointTypes.indexOf(this.type))return 1;let O=J,U=u;return 0===this.direction&&(O=u,U=J),O.isAnAncestorOf(U)?2:0}connectTo(H){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(H))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${H.ownerBlock.name}".${H.name}`;return this._endpoints.push(H),H._connectedPoint=this,this.onConnectionObservable.notifyObservers(H),H.onConnectionObservable.notifyObservers(this),this}disconnectFrom(H){const u=this._endpoints.indexOf(H);return-1===u||(this._endpoints.splice(u,1),H._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(H),H.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(H){let u=1;for(;u<Xu.All;)H&u||this.excludedConnectionPointTypes.push(u),u<<=1}serialize(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const u={};return u.name=this.name,u.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Hg?(u.valueType="BABYLON."+this.value.getClassName(),u.value=this.value.Hg()):(u.valueType="number",u.value=this.value)),H&&this.connectedPoint&&(u.inputName=this.name,u.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,u.targetConnectionName=this.connectedPoint.name,u.isExposedOnFrame=!0,u.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(u.isExposedOnFrame=!0,u.exposedPortPosition=this.exposedPortPosition),u}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class xu{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(H){this._name=H}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(H){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new N.b,this.nh=new N.b,this.onInputChangedObservable=new N.b,this.visibleOnFrame=!1,this._name=H,this.uniqueId=R.d.UniqueId}_inputRename(H){return H}_outputRename(H){return H}isAnAncestorOf(H){for(const u of this._outputs)if(u.hasEndpoints)for(const J of u.endpoints){if(J.ownerBlock===H)return!0;if(J.ownerBlock.isAnAncestorOf(H))return!0}return!1}isAnAncestorOfType(H){if(this.getClassName()===H)return!0;for(const u of this._outputs)if(u.hasEndpoints)for(const J of u.endpoints)if(J.ownerBlock.isAnAncestorOfType(H))return!0;return!1}getInputByName(H){const u=this._inputs.filter((u=>u.name===H));return u.length?u[0]:null}_linkConnectionTypes(H,u){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[u]._acceptedConnectionPointType=this._inputs[H]:(this._inputs[H]._linkedConnectionSource=this._inputs[u],this._inputs[H]._isMainLinkSource=!0),this._inputs[u]._linkedConnectionSource=this._inputs[H]}registerInput(H,u){let J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0;const w=new yu(H,this,0);return w.type=u,w.isOptional=J,w.defaultValue=O,w.value=O,w.valueMin=U,w.valueMax=h,this._inputs.push(w),this.onInputChangedObservable.notifyObservers(w),this}registerOutput(H,u,J){return(J=J??new yu(H,this,1)).type=u,this._outputs.push(J),this}_build(H){}_customBuildStep(H){}build(H){if(this._buildId===H.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((H=>H.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=H.buildId;for(const u of this._inputs){if(!u.connectedPoint){u.isOptional||H.notConnectedNonOptionalInputs.push(u);continue}const J=u.connectedPoint.ownerBlock;J&&J!==this&&!J.isSystem&&J.build(H)}return this._customBuildStep(H),H.verbose&&X.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(H),this.onBuildObservable.notifyObservers(this),!1}serialize(){const H={};H.customType="BABYLON."+this.getClassName(),H.id=this.uniqueId,H.name=this.name,H.visibleOnFrame=this.visibleOnFrame,H.inputs=[],H.outputs=[];for(const u of this.inputs)H.inputs.push(u.serialize());for(const u of this.outputs)H.outputs.push(u.serialize(!1));return H}_deserialize(H){this._name=H.name,this.comments=H.comments,this.visibleOnFrame=!!H.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(H)}_deserializePortDisplayNamesAndExposedOnFrame(H){const u=H.inputs,J=H.outputs;if(u)for(const O of u){const H=this.inputs.find((H=>H.name===O.name));if(!H)return;if(O.displayName&&(H.displayName=O.displayName),O.isExposedOnFrame&&(H.isExposedOnFrame=O.isExposedOnFrame,H.exposedPortPosition=O.exposedPortPosition),void 0!==O.value&&null!==O.value)if("number"===O.valueType)H.value=O.value;else{const u=(0,g.b)(O.valueType);u&&(H.value=u.Cu(O.value))}}if(J)for(let O=0;O<J.length;O++){const H=J[O];H.displayName&&(this.outputs[O].displayName=H.displayName),H.isExposedOnFrame&&(this.outputs[O].isExposedOnFrame=H.isExposedOnFrame,this.outputs[O].exposedPortPosition=H.exposedPortPosition)}}clone(){const H=this.serialize(),u=(0,g.b)(H.customType);if(u){const J=new u;return J._deserialize(H),J}return null}dispose(){this.nh.notifyObservers(this),this.nh.clear();for(const H of this.inputs)H.dispose();for(const H of this.outputs)H.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function zu(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",O=arguments.length>3?arguments[3]:void 0;return(U,h)=>{let w=U._propStore;w||(w=[],U._propStore=w),w.push({propertyName:h,displayName:H,type:u,groupName:J,options:O??{},className:U.getClassName()})}}(0,c.c)([(0,n.I)("comment")],xu.prototype,"comments",void 0),function(H){H[H.Boolean=0]="Boolean",H[H.Float=1]="Float",H[H.Int=2]="Int",H[H.Vector2=3]="Vector2",H[H.List=4]="List",H[H.Mg=5]="Mg",H[H.SamplingMode=6]="SamplingMode",H[H.TextureFormat=7]="TextureFormat",H[H.TextureType=8]="TextureType"}(iu||(iu={})),function(H){H[H.None=0]="None",H[H.Position=1]="Position",H[H.Direction=2]="Direction",H[H.Age=3]="Age",H[H.Lifetime=4]="Lifetime",H[H.Color=5]="Color",H[H.ScaledDirection=6]="ScaledDirection",H[H.Scale=7]="Scale",H[H.AgeGradient=8]="AgeGradient",H[H.Angle=9]="Angle",H[H.SpriteCellIndex=16]="SpriteCellIndex",H[H.SpriteCellStart=17]="SpriteCellStart",H[H.SpriteCellEnd=18]="SpriteCellEnd"}(Su||(Su={})),function(H){H[H.None=0]="None",H[H.Time=1]="Time",H[H.Delta=2]="Delta",H[H.Emitter=3]="Emitter"}(vu||(vu={}));class Ku{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let H="";for(const u of this.notConnectedNonOptionalInputs)H+=`input ${u.name} from block ${u.ownerBlock.name}[${u.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(H)throw"Build of Node Particle System Set failed:\n"+H}adapt(H,u){const J=H.getConnectedValue(this)||0;if(H.type===u)return J;switch(u){case Xu.Vector2:return new O.Vector2(J,J);case Xu.lu:return new O.lu(J,J,J);case Xu.Mg:return new w.Mg(J,J,J,J)}return null}getContextualValue(H){if(!this.particleContext||!this.systemContext)return null;switch(H){case Su.Position:return this.particleContext.position;case Su.Direction:return this.particleContext.direction;case Su.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Su.Color:return this.particleContext.color;case Su.Age:return this.particleContext.age;case Su.Lifetime:return this.particleContext.lifeTime;case Su.Angle:return this.particleContext.angle;case Su.Scale:return this.particleContext.scale;case Su.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Su.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Su.SpriteCellIndex:return this.particleContext.cellIndex;case Su.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Ou.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Ou.absolutePosition:this.systemContext.Ou:null}getSystemValue(H){if(!this.particleContext||!this.systemContext)return null;switch(H){case vu.Time:return this.systemContext._actualFrame;case vu.Delta:return this.systemContext._scaledUpdateSpeed;case vu.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Ou.absolutePosition}return this.systemContext.Ou}return null}}function Nu(H,u,J){const O=new Ku;O.pu=u;const U=H.createSystem(O);return U.canStart=()=>!0,U.Ou=J.clone(),U.disposeOnStop=!0,U.start(),U}class qu extends xu{constructor(H){super(H),this.blendMode=B.BLENDMODE_ONEONE,this.bJ=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Xu.Particle),this.registerInput("texture",Xu.Texture),this.registerInput("onStart",Xu.System,!0),this.registerInput("onEnd",Xu.System,!0),this.registerOutput("system",Xu.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(H){H.bJ=this.bJ,H.buildId=this._buildId++,this.build(H);const u=this.particle.getConnectedValue(H);return u.particleTexture=this.texture.getConnectedValue(H),u.emitRate=this.emitRate,u.blendMode=this.blendMode,u.name=this.name,u._nodeGenerated=!0,u._targetStopDuration=this.targetStopDuration,u.startDelay=this.startDelay,this.system._storedValue=this,u.canStart=()=>!this.doNoStart,u.onStartedObservable.add((J=>{const O=this.onStart.getConnectedValue(H);O&&J.onStartedObservable.addOnce((()=>{H.systemContext=u;const J=Nu(O,H.pu,H.emitterPosition);this.nh.addOnce((()=>{J.dispose()}))}));const U=this.onEnd.getConnectedValue(H);U&&J.onStoppedObservable.addOnce((()=>{H.systemContext=u;const J=Nu(U,H.pu,H.emitterPosition);this.nh.addOnce((()=>{J.dispose()}))}))})),this.nh.addOnce((()=>{u.dispose()})),u}serialize(){const H=super.serialize();return H.bJ=this.bJ,H.emitRate=this.emitRate,H.blendMode=this.blendMode,H.doNoStart=this.doNoStart,H.targetStopDuration=this.targetStopDuration,H.startDelay=this.startDelay,H}_deserialize(H){super._deserialize(H),this.bJ=H.bJ,this.emitRate=H.emitRate,this.doNoStart=!!H.doNoStart,void 0!==H.blendMode&&(this.blendMode=H.blendMode),void 0!==H.targetStopDuration&&(this.targetStopDuration=H.targetStopDuration),void 0!==H.startDelay&&(this.startDelay=H.startDelay)}}(0,c.c)([zu("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:B.BLENDMODE_ONEONE},{label:"Standard",value:B.BLENDMODE_STANDARD},{label:"Add",value:B.BLENDMODE_ADD},{label:"Multiply",value:B.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:B.BLENDMODE_MULTIPLYADD}]})],qu.prototype,"blendMode",void 0),(0,c.c)([zu("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],qu.prototype,"bJ",void 0),(0,c.c)([zu("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qu.prototype,"emitRate",void 0),(0,c.c)([zu("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qu.prototype,"targetStopDuration",void 0),(0,c.c)([zu("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qu.prototype,"startDelay",void 0),(0,c.c)([zu("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],qu.prototype,"doNoStart",void 0),(0,g.f)("BABYLON.SystemBlock",qu);class Eu extends xu{get type(){if(this._type===Xu.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Xu.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Xu.Vector2,this._type;case"lu":return this._type=Xu.lu,this._type;case"Mg":return this._type=Xu.Mg,this._type;case"Matrix":return this._type=Xu.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Su.None&&this._systemSource!==vu.None}get systemSource(){return this._systemSource}set systemSource(H){if(this._systemSource=H,H!==vu.None){switch(this._contextualSource=Su.None,this._type=Xu.Float,H){case vu.Time:case vu.Delta:this._type=Xu.Float;break;case vu.Emitter:this._type=Xu.lu}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Su.None}get contextualValue(){return this._contextualSource}set contextualValue(H){if(this._contextualSource=H,H!==Su.None){switch(this._systemSource=vu.None,H){case Su.Scale:this._type=Xu.Vector2;break;case Su.Position:case Su.Direction:case Su.ScaledDirection:this._type=Xu.lu;break;case Su.Color:this._type=Xu.Mg;break;case Su.Age:case Su.Lifetime:case Su.Angle:case Su.AgeGradient:this._type=Xu.Float;break;case Su.SpriteCellEnd:case Su.SpriteCellStart:case Su.SpriteCellIndex:this._type=Xu.Int}this.output&&(this.output.type=this._type)}}constructor(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xu.AutoDetect;super(H),this._type=Xu.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new N.b,this._systemSource=vu.None,this._contextualSource=Su.None,this._type=u,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",u)}get value(){return this._storedValue}set value(H){this.type===Xu.Float&&this.min!==this.max&&(H=Math.max(this.min,H),H=Math.min(this.max,H)),this._storedValue=H,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(H){this._valueCallback=H}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Xu.Int:case Xu.Float:this.value=0;break;case Xu.Vector2:this.value=O.Vector2.Zero();break;case Xu.lu:this.value=O.lu.Zero();break;case Xu.Mg:this.value=new w.Mg(1,1,1,1);break;case Xu.Matrix:this.value=O.Matrix.Identity()}}_build(H){super._build(H),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=H=>H.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=H=>H.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const H=super.serialize();return H.type=this.type,H.contextualValue=this.contextualValue,H.systemSource=this.systemSource,H.min=this.min,H.max=this.max,H.groupInInspector=this.groupInInspector,H.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Hg?(H.valueType="BABYLON."+this._storedValue.getClassName(),H.value=this._storedValue.Hg()):(H.valueType="number",H.value=this._storedValue)),H}_deserialize(H){if(super._deserialize(H),this._type=H.type,this.contextualValue=H.contextualValue,this.systemSource=H.systemSource||vu.None,this.min=H.min||0,this.max=H.max||0,this.groupInInspector=H.groupInInspector||"",void 0!==H.displayInInspector&&(this.displayInInspector=H.displayInInspector),H.valueType)if("number"===H.valueType)this._storedValue=H.value;else{const u=(0,g.b)(H.valueType);u&&(this._storedValue=u.Cu(H.value))}}}(0,g.f)("BABYLON.ParticleInputBlock",Eu);class Qu extends xu{get url(){return this._url}set url(H){this._url!==H&&(this._cachedData=null,this._url=H,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(H){this._textureDataUrl!==H&&(this._cachedData=null,this._textureDataUrl=H,this._url="",this._sourceTexture=null)}set sourceTexture(H){this._sourceTexture!==H&&(this._cachedData=null,this._sourceTexture=H,this._url="",this._textureDataUrl="")}constructor(H){super(H),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Xu.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const H=this.texture._storedValue;return await new Promise(((u,J)=>{if(!H.isReady())return void H.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),u(this._cachedData)}catch(H){J(H)}}));const O=H.getSize();cu.m.GetTextureDataAsync(H,O.width,O.height).then((J=>{this._cachedData={width:O.width,height:O.height,data:new Uint8ClampedArray(J)},H.dispose(),u(this._cachedData)})).catch(J)}))}_build(H){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new T.b(this._textureDataUrl,H.pu):this.texture._storedValue=new T.b(this._url,H.pu):this.texture._storedValue=null}serialize(){const H=super.serialize();return H.url=this.url,H.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(H.textureDataUrl=this.textureDataUrl),H}_deserialize(H){super._deserialize(H),this.url=H.url,this.serializedCachedData=!!H.serializedCachedData,H.textureDataUrl&&(this.textureDataUrl=H.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,g.f)("BABYLON.ParticleTextureSourceBlock",Qu);class HJ extends xu{constructor(H){super(H),this.registerInput("particle",Xu.Particle),this.registerInput("position",Xu.lu),this.registerOutput("output",Xu.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(H){const u=this.particle.getConnectedValue(H);if(this.output._storedValue=u,!this.position.isConnected)return;const J={process:J=>{H.particleContext=J,H.systemContext=u,J.position.O(this.position.getConnectedValue(H))},previousItem:null,nextItem:null};u._updateQueueStart?vH(J,u._updateQueueStart):u._updateQueueStart=J}}(0,g.f)("BABYLON.UpdatePositionBlock",HJ),function(H){H[H.Add=0]="Add",H[H.Subtract=1]="Subtract",H[H.Multiply=2]="Multiply",H[H.Divide=3]="Divide",H[H.Max=4]="Max",H[H.Min=5]="Min"}(Iu||(Iu={}));class uJ extends xu{constructor(H){super(H),this.operation=Iu.Add,this.registerInput("left",Xu.AutoDetect),this.registerInput("right",Xu.AutoDetect),this.registerOutput("output",Xu.BasedOnInput),this.output._typeConnectionSource=this.left;const u=[Xu.Matrix,Xu.Particle,Xu.Texture,Xu.System,Xu.FloatGradient,Xu.Color4Gradient,Xu.Vector2Gradient,Xu.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...u),this.right.excludedConnectionPointTypes.push(...u),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(H){let u;const J=this.left,U=this.right;if(!J.isConnected||!U.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const h=J.type===Xu.Float||J.type===Xu.Int,g=U.type===Xu.Float||U.type===Xu.Int,B=h&&g;switch(this.operation){case Iu.Add:u=B?H=>J.getConnectedValue(H)+U.getConnectedValue(H):h?H=>H.adapt(J,U.type).add(U.getConnectedValue(H)):H=>J.getConnectedValue(H).add(H.adapt(U,J.type));break;case Iu.Subtract:u=B?H=>J.getConnectedValue(H)-U.getConnectedValue(H):h?H=>H.adapt(J,U.type).ru(U.getConnectedValue(H)):H=>J.getConnectedValue(H).ru(H.adapt(U,J.type));break;case Iu.Multiply:u=B?H=>J.getConnectedValue(H)*U.getConnectedValue(H):h?H=>H.adapt(J,U.type).multiply(U.getConnectedValue(H)):H=>J.getConnectedValue(H).multiply(H.adapt(U,J.type));break;case Iu.Divide:u=B?H=>J.getConnectedValue(H)/U.getConnectedValue(H):h?H=>H.adapt(J,U.type).divide(U.getConnectedValue(H)):H=>J.getConnectedValue(H).divide(H.adapt(U,J.type));break;case Iu.Min:if(B)u=H=>Math.min(J.getConnectedValue(H),U.getConnectedValue(H));else{const[H,g]=h?[U,J]:[J,U];switch(H.type){case Xu.Vector2:u=u=>O.Vector2.Minimize(H.getConnectedValue(u),u.adapt(g,H.type));break;case Xu.lu:u=u=>O.lu.Minimize(H.getConnectedValue(u),u.adapt(g,H.type));break;case Xu.Mg:u=u=>{const J=H.getConnectedValue(u),{r:O,g:U,b:h,a:B}=u.adapt(g,H.type);return new w.Mg(Math.min(J.r,O),Math.min(J.g,U),Math.min(J.b,h),Math.min(J.a,B))}}}break;case Iu.Max:if(!B){const[H,g]=h?[U,J]:[J,U];switch(H.type){case Xu.Vector2:u=u=>O.Vector2.Maximize(H.getConnectedValue(u),u.adapt(g,H.type));break;case Xu.lu:u=u=>O.lu.Maximize(H.getConnectedValue(u),u.adapt(g,H.type));break;case Xu.Mg:u=u=>{const J=H.getConnectedValue(u),{r:O,g:U,b:h,a:B}=u.adapt(g,H.type);return new w.Mg(Math.max(J.r,O),Math.min(J.g,U),Math.min(J.b,h),Math.min(J.a,B))}}break}u=H=>Math.max(J.getConnectedValue(H),U.getConnectedValue(H))}this.output._storedFunction=H=>J.type===Xu.Int?0|u(H):u(H)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Xu.Int||this.left.type===Xu.Float&&this.right.type!==Xu.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[H,u]of[[this.left,this.right],[this.right,this.left]])H.acceptedConnectionPointTypes=[Xu.Int,Xu.Float],u.isConnected&&(H.acceptedConnectionPointTypes.push(u.type),u.type!==Xu.Int&&u.type!==Xu.Float||H.acceptedConnectionPointTypes.push(Xu.Vector2,Xu.lu,Xu.Mg))}dispose(){super.dispose();for(const H of this._connectionObservers)H.remove();this._connectionObservers.length=0}serialize(){const H=super.serialize();return H.operation=this.operation,H}_deserialize(H){super._deserialize(H),this.operation=H.operation}}(0,c.c)([zu("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Iu.Add},{label:"Subtract",value:Iu.Subtract},{label:"Multiply",value:Iu.Multiply},{label:"Divide",value:Iu.Divide},{label:"Max",value:Iu.Max},{label:"Min",value:Iu.Min}]})],uJ.prototype,"operation",void 0),(0,g.f)("BABYLON.ParticleMathBlock",uJ);class JJ extends xu{constructor(H){super(H),this.registerInput("particle",Xu.Particle),this.registerInput("direction1",Xu.lu,!0,new O.lu(0,1,0)),this.registerInput("direction2",Xu.lu,!0,new O.lu(0,1,0)),this.registerInput("minEmitBox",Xu.lu,!0,new O.lu(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Xu.lu,!0,new O.lu(.5,.5,.5)),this.registerOutput("output",Xu.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(H){const u=this.particle.getConnectedValue(H);u._directionCreation.process=J=>{H.particleContext=J,H.systemContext=u;const U=this.direction1.getConnectedValue(H),h=this.direction2.getConnectedValue(H),w=(0,b.RandomRange)(U.x,h.x),g=(0,b.RandomRange)(U.y,h.y),B=(0,b.RandomRange)(U.z,h.z);H.isEmitterTransformNode?O.lu.TransformNormalFromFloatsToRef(w,g,B,H.emitterWorldMatrix,J.direction):J.direction.kg(w,g,B)},u._positionCreation.process=J=>{H.particleContext=J,H.systemContext=u;const U=this.minEmitBox.getConnectedValue(H),h=this.maxEmitBox.getConnectedValue(H),w=(0,b.RandomRange)(U.x,h.x),g=(0,b.RandomRange)(U.y,h.y),B=(0,b.RandomRange)(U.z,h.z);H.isEmitterTransformNode?O.lu.TransformCoordinatesFromFloatsToRef(w,g,B,H.emitterWorldMatrix,J.position):(J.position.kg(w,g,B),J.position.addInPlace(H.emitterPosition))},this.output._storedValue=u}}(0,g.f)("BABYLON.BoxShapeBlock",JJ);class OJ extends xu{constructor(H){super(H),this.registerInput("emitPower",Xu.Float,!0,1),this.registerInput("lifeTime",Xu.Float,!0,1),this.registerInput("color",Xu.Mg,!0,new w.Mg(1,1,1,1)),this.registerInput("scale",Xu.Vector2,!0,new O.Vector2(1,1)),this.registerInput("angle",Xu.Float,!0,0),this.registerOutput("particle",Xu.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(H){const u=new gu(this.name,H.bJ,H.pu,null,!1,void 0,!0);u.particleEmitterType=new a,u._lifeTimeCreation.process=(u,J)=>{H.particleContext=u,u.lifeTime=this.lifeTime.getConnectedValue(H),J._emitPower=this.emitPower.getConnectedValue(H)},u._colorCreation.process=u=>{H.particleContext=u,u.color.O(this.color.getConnectedValue(H))},u._sizeCreation.process=u=>{H.particleContext=u,u.size=1,u.scale.O(this.scale.getConnectedValue(H))},u._angleCreation.process=u=>{H.particleContext=u,u.angle=this.angle.getConnectedValue(H)},this.particle._storedValue=u}}(0,g.f)("BABYLON.CreateParticleBlock",OJ);class UJ{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const H=[];for(const u of this.attachedBlocks)u.isInput&&H.push(u);return H}constructor(H){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new N.b,this.name=H}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(H){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(H)&&this.attachedBlocks.push(H);for(const J of H.inputs){const O=J.connectedPoint;if(O){const J=O.ownerBlock;J!==H&&this._initializeBlock(J,u)}}}async buildAsync(H){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((J=>{const O=new Zu;for(const H of this._systemBlocks)this._initializeBlock(H);for(const U of this.systemBlocks){const J=new Ku;J.buildId=this._buildId++,J.pu=H,J.verbose=u;const h=U.createSystem(J);J.emitErrors(),O.systems.push(h)}this.onBuildObservable.notifyObservers(this),J(O)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const H=new qu("Particle system"),u=new HJ("Update position");u.output.connectTo(H.particle);const J=new Eu("Position");J.contextualValue=Su.Position;const O=new Eu("Scaled direction");O.contextualValue=Su.ScaledDirection;const U=new uJ("Add");U.operation=Iu.Add,J.output.connectTo(U.left),O.output.connectTo(U.right),U.output.connectTo(u.position);const h=new OJ("Create particle"),w=new JJ("Box shape");h.particle.connectTo(w.particle),w.output.connectTo(u.particle);const g=new Qu("Texture");g.texture.connectTo(H.texture),g.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(H)}removeBlock(H){const u=this.attachedBlocks.indexOf(H);if(u>-1&&this.attachedBlocks.splice(u,1),H.isSystem){const u=this._systemBlocks.indexOf(H);u>-1&&this._systemBlocks.splice(u,1)}}parseSerializedObject(H){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u||this.clear();const J={};for(const O of H.TG){const H=(0,g.b)(O.customType);if(H){const u=new H;u._deserialize(O),J[O.id]=u,this.attachedBlocks.push(u),u.isSystem&&this._systemBlocks.push(u)}}for(const O of this.attachedBlocks)if(O.isTeleportOut){const H=O,u=H._tempEntryPointUniqueId;if(u){const O=J[u];O&&O.attachToEndpoint(H)}}for(let O=0;O<H.TG.length;O++){const U=H.TG[O],h=J[U.id];h&&(h.inputs.length&&U.inputs.some((H=>H.targetConnectionName))&&!u||this._restoreConnections(h,H,J))}if(H.locations||H.editorData&&H.editorData.locations){const O=H.locations||H.editorData.locations;for(const H of O)J[H.KJ]&&(H.KJ=J[H.KJ].uniqueId);u&&this.editorData&&this.editorData.locations&&O.concat(this.editorData.locations),H.locations?this.editorData={locations:O}:(this.editorData=H.editorData,this.editorData.locations=O);const U=[];for(const H in J)U[H]=J[H].uniqueId;this.editorData.map=U}this.comment=H.comment}_restoreConnections(H,u,J){for(const O of H.outputs)for(const U of u.TG){const h=J[U.id];if(h)for(const w of U.inputs)if(J[w.targetBlockId]!==H||w.targetConnectionName!==O.name);else{const H=h.getInputByName(w.inputName);if(!H||H.isConnected)continue;O.connectTo(H,!0),this._restoreConnections(h,u,J)}}}serialize(H){const u=H?{}:V.d.Serialize(this);u.editorData=JSON.parse(JSON.stringify(this.editorData));let J=[];H?J=H:u.customType="BABYLON.NodeParticleSystemSet",u.TG=[];for(const O of J)u.TG.push(O.serialize());if(!H)for(const O of this.attachedBlocks)-1===J.indexOf(O)&&u.TG.push(O.serialize());return u}dispose(){for(const H of this.attachedBlocks)H.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(H){const u=new UJ(H);return u.setToDefault(),u}static Parse(H){const u=V.d.Parse((()=>new UJ(H.name)),H,null);return u.parseSerializedObject(H),u}static ParseFromSnippetAsync(H,u){return"_BLANK"===H?Promise.resolve(UJ.CreateDefault("blank")):new Promise(((J,O)=>{const U=new Yu.d;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const w=JSON.parse(JSON.parse(U.responseText).jsonPayload),g=JSON.parse(w.nodeParticle);u||(u=V.d.Parse((()=>new UJ(H)),g,null)),u.parseSerializedObject(g),u.snippetId=H;try{J(u)}catch(h){O(h)}}else O("Unable to load the snippet "+H)})),U.open("GET",this.SnippetUrl+"/"+H.replace(/#/g,"/")),U.send()}))}}UJ.EditorURL=`${ju.Tools._DefaultCdnUrl}/v${zH.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,UJ.SnippetUrl="https://snippet.babylonjs.com",(0,c.c)([(0,n.I)()],UJ.prototype,"name",void 0),(0,c.c)([(0,n.I)("comment")],UJ.prototype,"comment",void 0),function(H){H[H.None=0]="None",H[H.PerParticle=1]="PerParticle",H[H.PerSystem=2]="PerSystem"}(Du||(Du={}));class hJ extends xu{constructor(H){super(H),this._currentLockId=-2,this.lockMode=Du.PerParticle,this.registerInput("min",Xu.AutoDetect,!0,0),this.registerInput("max",Xu.AutoDetect,!0,1),this.registerOutput("output",Xu.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Xu.Float|Xu.Int|Xu.Vector2|Xu.lu|Xu.Mg),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Xu.Float|Xu.Int|Xu.Vector2|Xu.lu|Xu.Mg),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Xu.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let H=null;switch(this._currentLockId=-2,this.min.type){case Xu.AutoDetect:case Xu.Int:case Xu.Float:H=H=>{const u=this.min.getConnectedValue(H)||0,J=this.max.getConnectedValue(H)||1;return u+Math.random()*(J-u)};break;case Xu.Vector2:H=H=>{const u=this.min.getConnectedValue(H)||O.Vector2.Zero(),J=this.max.getConnectedValue(H)||O.Vector2.One();return new O.Vector2(u.x+Math.random()*(J.x-u.x),u.y+Math.random()*(J.y-u.y))};break;case Xu.lu:H=H=>{const u=this.min.getConnectedValue(H)||O.lu.Zero(),J=this.max.getConnectedValue(H)||O.lu.One();return new O.lu(u.x+Math.random()*(J.x-u.x),u.y+Math.random()*(J.y-u.y),u.z+Math.random()*(J.z-u.z))};break;case Xu.Mg:H=H=>{const u=this.min.getConnectedValue(H)||new w.Mg(0,0,0,0),J=this.max.getConnectedValue(H)||new w.Mg(1,1,1,1);return new w.Mg(u.x+Math.random()*(J.x-u.x),u.y+Math.random()*(J.y-u.y),u.z+Math.random()*(J.z-u.z),u.w+Math.random()*(J.w-u.w))}}this.output._storedFunction=u=>{var J;let O=0;switch(this.lockMode){case Du.PerParticle:O=(null===(J=u.particleContext)||void 0===J?void 0:J.id)||-1;break;case Du.PerSystem:O=u.buildId||0}return this._currentLockId!==O&&(this.lockMode!==Du.None&&(this._currentLockId=O),this.output._storedValue=H(u)),this.output._storedValue}}serialize(){const H=super.serialize();return H.lockMode=this.lockMode,H}_deserialize(H){super._deserialize(H),this.lockMode=H.lockMode}}(0,c.c)([zu("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Du.None},{label:"Per particle",value:Du.PerParticle},{label:"Per system",value:Du.PerSystem}]})],hJ.prototype,"lockMode",void 0),(0,g.f)("BABYLON.ParticleRandomBlock",hJ);class wJ extends xu{constructor(H){super(H),this._currentLockId=-2,this.lockMode=Du.PerParticle,this.registerInput("min",Xu.AutoDetect),this.registerInput("max",Xu.AutoDetect),this.registerOutput("output",Xu.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const u=[Xu.Matrix,Xu.Particle,Xu.Texture,Xu.System,Xu.FloatGradient,Xu.Color4Gradient,Xu.Vector2Gradient,Xu.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...u),this.max.excludedConnectionPointTypes.push(...u)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let H=null;switch(this._currentLockId=-2,this.min.type){case Xu.Float:case Xu.Int:H=H=>{const u=this.min.getConnectedValue(H),J=this.max.getConnectedValue(H);return Math.random()*(J-u)+u};break;case Xu.Vector2:H=H=>{const u=this.min.getConnectedValue(H),J=this.max.getConnectedValue(H);return new O.Vector2(Math.random()*(J.x-u.x)+u.x,Math.random()*(J.y-u.y)+u.y)};break;case Xu.lu:H=H=>{const u=this.min.getConnectedValue(H),J=this.max.getConnectedValue(H);return new O.lu(Math.random()*(J.x-u.x)+u.x,Math.random()*(J.y-u.y)+u.y,Math.random()*(J.z-u.z)+u.z)};break;case Xu.Mg:H=H=>{const u=this.min.getConnectedValue(H),J=this.max.getConnectedValue(H);return new w.Mg(Math.random()*(J.r-u.r)+u.r,Math.random()*(J.g-u.g)+u.g,Math.random()*(J.b-u.b)+u.b,Math.random()*(J.a-u.a)+u.a)}}this.output._storedFunction=u=>{var J;let O=0;switch(this.lockMode){case Du.PerParticle:O=(null===(J=u.particleContext)||void 0===J?void 0:J.id)||-1;break;case Du.PerSystem:O=u.buildId||0}return this._currentLockId!==O&&(this.lockMode!==Du.None&&(this._currentLockId=O),this.output._storedValue=H(u)),this.output._storedValue}}serialize(){const H=super.serialize();return H.lockMode=this.lockMode,H}_deserialize(H){super._deserialize(H),void 0!==H.lockMode&&(this.lockMode=H.lockMode)}}(0,c.c)([zu("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Du.None},{label:"Per particle",value:Du.PerParticle},{label:"Per system",value:Du.PerSystem}]})],wJ.prototype,"lockMode",void 0),(0,g.f)("BABYLON.RandomRangeBlock",wJ);(0,g.f)("BABYLON.ParticleLerpBlock",class extends xu{constructor(H){super(H),this.registerInput("left",Xu.AutoDetect),this.registerInput("right",Xu.AutoDetect),this.registerInput("gradient",Xu.Float,!0,0,0,1),this.registerOutput("output",Xu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Xu.Float|Xu.Int|Xu.Vector2|Xu.lu|Xu.Mg)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const H=(H,u,J)=>(1-H)*u+H*J;this.output._storedFunction=u=>{const J=this.left.getConnectedValue(u),U=this.right.getConnectedValue(u),h=this.gradient.getConnectedValue(u);switch(this.left.type){case Xu.Int:case Xu.Float:return H(h,J,U);case Xu.Vector2:return new O.Vector2(H(h,J.x,U.x),H(h,J.y,U.y));case Xu.lu:return new O.lu(H(h,J.x,U.x),H(h,J.y,U.y),H(h,J.z,U.z));case Xu.Mg:return new w.Mg(H(h,J.r,U.r),H(h,J.g,U.g),H(h,J.b,U.b),H(h,J.a,U.a))}return 0}}});(0,g.f)("BABYLON.UpdateDirectionBlock",class extends xu{constructor(H){super(H),this.registerInput("particle",Xu.Particle),this.registerInput("direction",Xu.lu),this.registerOutput("output",Xu.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(H){const u=this.particle.getConnectedValue(H);if(this.output._storedValue=u,!this.direction.isConnected)return;const J={process:J=>{H.particleContext=J,H.systemContext=u,J.direction.O(this.direction.getConnectedValue(H))},previousItem:null,nextItem:null};u._updateQueueStart?vH(J,u._updateQueueStart):u._updateQueueStart=J}});(0,g.f)("BABYLON.UpdateColorBlock",class extends xu{constructor(H){super(H),this.registerInput("particle",Xu.Particle),this.registerInput("color",Xu.Mg),this.registerOutput("output",Xu.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(H){const u=this.particle.getConnectedValue(H);if(this.output._storedValue=u,!this.color.isConnected)return;const J={process:J=>{H.particleContext=J,H.systemContext=u,J.color.O(this.color.getConnectedValue(H))},previousItem:null,nextItem:null};u._updateQueueStart?vH(J,u._updateQueueStart):u._updateQueueStart=J}});(0,g.f)("BABYLON.UpdateScaleBlock",class extends xu{constructor(H){super(H),this.registerInput("particle",Xu.Particle),this.registerInput("scale",Xu.Vector2),this.registerOutput("output",Xu.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(H){const u=this.particle.getConnectedValue(H);if(this.output._storedValue=u,!this.scale.isConnected)return;const J={process:J=>{H.particleContext=J,H.systemContext=u,J.scale.O(this.scale.getConnectedValue(H))},previousItem:null,nextItem:null};u._updateQueueStart?vH(J,u._updateQueueStart):u._updateQueueStart=J}});(0,g.f)("BABYLON.UpdateAngleBlock",class extends xu{constructor(H){super(H),this.registerInput("particle",Xu.Particle),this.registerInput("angle",Xu.Float),this.registerOutput("output",Xu.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(H){const u=this.particle.getConnectedValue(H);if(this.output._storedValue=u,!this.angle.isConnected)return;const J={process:J=>{H.particleContext=J,H.systemContext=u,J.angle=this.angle.getConnectedValue(H)},previousItem:null,nextItem:null};u._updateQueueStart?vH(J,u._updateQueueStart):u._updateQueueStart=J}});(0,g.f)("BABYLON.BasicPositionUpdateBlock",class extends xu{constructor(H){super(H),this.registerInput("particle",Xu.Particle),this.registerOutput("output",Xu.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(H){const u=this.particle.getConnectedValue(H),J={process:J=>{H.particleContext=J,H.systemContext=u,J.direction.scaleToRef(u._directionScale,u._scaledDirection),J.position.addInPlace(u._scaledDirection)},previousItem:null,nextItem:null};u._updateQueueStart?vH(J,u._updateQueueStart):u._updateQueueStart=J,this.output._storedValue=u}});(0,g.f)("BABYLON.BasicSpriteUpdateBlock",class extends xu{constructor(H){super(H),this.registerInput("particle",Xu.Particle),this.registerOutput("output",Xu.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(H){const u=this.particle.getConnectedValue(H),J={process:J=>{H.particleContext=J,H.systemContext=u,J.updateCellIndex()},previousItem:null,nextItem:null};u._updateQueueStart?vH(J,u._updateQueueStart):u._updateQueueStart=J,this.output._storedValue=u}});(0,g.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends xu{constructor(H){super(H),this.registerInput("particle",Xu.Particle),this.registerInput("cellIndex",Xu.Int),this.registerOutput("output",Xu.Particle),this.cellIndex.acceptedConnectionPointTypes=[Xu.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(H){const u=this.particle.getConnectedValue(H);if(this.output._storedValue=u,!this.cellIndex.isConnected)return;const J={process:J=>{H.particleContext=J,H.systemContext=u,J.cellIndex=Math.floor(this.cellIndex.getConnectedValue(H))},previousItem:null,nextItem:null};u._updateQueueStart?vH(J,u._updateQueueStart):u._updateQueueStart=J}});class gJ extends xu{constructor(H){super(H),this.strength=1,this.registerInput("particle",Xu.Particle),this.registerInput("flowMap",Xu.Texture),this.registerOutput("output",Xu.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(H){var u;const J=this.particle.getConnectedValue(H),O=H.pu;let U;(null===(u=this.flowMap.connectedPoint)||void 0===u?void 0:u.ownerBlock).extractTextureContentAsync().then((H=>{H&&(U=new Ru(H.width,H.height,H.data))}));const h={process:H=>{const u=O.getTransformMatrix();U&&U._processParticle(H,this.strength*J._tempScaledUpdateSpeed,u)},previousItem:null,nextItem:null};J._updateQueueStart?vH(h,J._updateQueueStart):J._updateQueueStart=h,this.output._storedValue=J}serialize(){const H=super.serialize();return H.strength=this.strength,H}_deserialize(H){super._deserialize(H),this.strength=H.strength}}(0,c.c)([zu("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gJ.prototype,"strength",void 0),(0,g.f)("BABYLON.UpdateFlowMapBlock",gJ);(0,g.f)("BABYLON.SphereShapeBlock",class extends xu{constructor(H){super(H),this.registerInput("input",Xu.Particle),this.registerInput("radius",Xu.Float,!0,1),this.registerInput("radiusRange",Xu.Float,!0,1,0,1),this.registerInput("directionRandomizer",Xu.Float,!0,0,0,1),this.registerOutput("output",Xu.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(H){const u=this.input.getConnectedValue(H);u._directionCreation.process=J=>{H.particleContext=J,H.systemContext=u;const U=this.directionRandomizer.getConnectedValue(H),h=J.position.ru(H.emitterPosition).normalize(),w=(0,b.RandomRange)(0,U),g=(0,b.RandomRange)(0,U),B=(0,b.RandomRange)(0,U);h.x+=w,h.y+=g,h.z+=B,h.normalize(),H.isEmitterTransformNode?O.lu.TransformNormalFromFloatsToRef(w,g,B,H.emitterWorldMatrix,J.direction):J.direction.kg(w,g,B)},u._positionCreation.process=J=>{H.particleContext=J,H.systemContext=u;const U=this.radius.getConnectedValue(H),h=this.radiusRange.getConnectedValue(H),w=U-(0,b.RandomRange)(0,U*h),g=(0,b.RandomRange)(0,1),B=(0,b.RandomRange)(0,2*Math.PI),d=Math.acos(2*g-1),G=w*Math.cos(B)*Math.sin(d),P=w*Math.cos(d),mH=w*Math.sin(B)*Math.sin(d);H.isEmitterTransformNode?O.lu.TransformCoordinatesFromFloatsToRef(G,P,mH,H.emitterWorldMatrix,J.position):(J.position.kg(G,P,mH),J.position.addInPlace(H.emitterPosition))},this.output._storedValue=u}});(0,g.f)("BABYLON.PointShapeBlock",class extends xu{constructor(H){super(H),this.registerInput("particle",Xu.Particle),this.registerInput("direction1",Xu.lu,!0,new O.lu(0,1,0)),this.registerInput("direction2",Xu.lu,!0,new O.lu(0,1,0)),this.registerOutput("output",Xu.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(H){const u=this.particle.getConnectedValue(H);u._directionCreation.process=J=>{H.particleContext=J,H.systemContext=u;const U=this.direction1.getConnectedValue(H),h=this.direction2.getConnectedValue(H),w=(0,b.RandomRange)(U.x,h.x),g=(0,b.RandomRange)(U.y,h.y),B=(0,b.RandomRange)(U.z,h.z);H.isEmitterTransformNode?O.lu.TransformNormalFromFloatsToRef(w,g,B,H.emitterWorldMatrix,J.direction):J.direction.kg(w,g,B)},u._positionCreation.process=J=>{H.systemContext=u,H.isEmitterTransformNode?O.lu.TransformCoordinatesFromFloatsToRef(0,0,0,H.emitterWorldMatrix,J.position):J.position.O(H.emitterPosition)},this.output._storedValue=u}});(0,g.f)("BABYLON.CustomShapeBlock",class extends xu{constructor(H){super(H),this.registerInput("particle",Xu.Particle),this.registerInput("position",Xu.lu,!0,new O.lu(0,0,0)),this.registerInput("direction",Xu.lu,!0,new O.lu(0,1,0)),this.registerOutput("output",Xu.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(H){const u=this.particle.getConnectedValue(H);u._directionCreation.process=J=>{H.particleContext=J,H.systemContext=u;const U=this.direction.getConnectedValue(H);H.isEmitterTransformNode?O.lu.TransformNormalToRef(U,H.emitterWorldMatrix,J.direction):J.direction.O(U)},u._positionCreation.process=J=>{H.particleContext=J,H.systemContext=u;const U=this.position.getConnectedValue(H);H.isEmitterTransformNode?O.lu.TransformCoordinatesToRef(U,H.emitterWorldMatrix,J.position):(J.position.O(U),J.position.addInPlace(H.emitterPosition))},this.output._storedValue=u}});(0,g.f)("BABYLON.CylinderShapeBlock",class extends xu{constructor(H){super(H),this._tempVector=O.lu.Zero(),this.registerInput("particle",Xu.Particle),this.registerInput("radius",Xu.Float,!0,1),this.registerInput("height",Xu.Float,!0,1,0),this.registerInput("radiusRange",Xu.Float,!0,1,0,1),this.registerInput("directionRandomizer",Xu.Float,!0,0,0,1),this.registerOutput("output",Xu.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(H){const u=this.particle.getConnectedValue(H);u._directionCreation.process=J=>{H.particleContext=J,H.systemContext=u;const U=this.directionRandomizer.getConnectedValue(H);J.position.subtractToRef(H.emitterPosition,this._tempVector),this._tempVector.normalize(),H.isEmitterTransformNode&&O.lu.TransformNormalToRef(this._tempVector,H.emitterInverseWorldMatrix,this._tempVector);const h=(0,b.RandomRange)(-U/2,U/2);let w=Math.atan2(this._tempVector.x,this._tempVector.z);w+=(0,b.RandomRange)(-Math.PI/2,Math.PI/2)*U,this._tempVector.y=h,this._tempVector.x=Math.sin(w),this._tempVector.z=Math.cos(w),this._tempVector.normalize(),H.isEmitterTransformNode?O.lu.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,H.emitterWorldMatrix,J.direction):J.direction.O(this._tempVector)},u._positionCreation.process=J=>{H.particleContext=J,H.systemContext=u;const U=this.height.getConnectedValue(H),h=this.radiusRange.getConnectedValue(H),w=this.radius.getConnectedValue(H),g=(0,b.RandomRange)(-U/2,U/2),B=(0,b.RandomRange)(0,2*Math.PI),d=(0,b.RandomRange)((1-h)*(1-h),1),G=Math.sqrt(d)*w,P=G*Math.cos(B),mH=G*Math.sin(B);H.isEmitterTransformNode?O.lu.TransformCoordinatesFromFloatsToRef(P,g,mH,H.emitterWorldMatrix,J.position):(J.position.kg(P,g,mH),J.position.addInPlace(H.emitterPosition))},this.output._storedValue=u}});class BJ extends xu{constructor(H){super(H),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Xu.Particle),this.registerOutput("output",Xu.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(H){super._build(H);const u=this.particle.getConnectedValue(H);u._isAnimationSheetEnabled=!0,u.spriteCellWidth=this.width,u.spriteCellHeight=this.height,u.startSpriteCellID=this.start,u.endSpriteCellID=this.end,u.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=u}serialize(){const H=super.serialize();return H.width=this.width,H.height=this.height,H.start=this.start,H.end=this.end,H.randomStartCell=this.randomStartCell,H}_deserialize(H){super._deserialize(H),this.width=H.width,this.height=H.height,this.start=H.start,this.end=H.end,this.randomStartCell=H.randomStartCell}}(0,c.c)([zu("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BJ.prototype,"start",void 0),(0,c.c)([zu("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BJ.prototype,"end",void 0),(0,c.c)([zu("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BJ.prototype,"width",void 0),(0,c.c)([zu("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BJ.prototype,"height",void 0),(0,c.c)([zu("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],BJ.prototype,"loop",void 0),(0,c.c)([zu("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],BJ.prototype,"randomStartCell",void 0),(0,g.f)("BABYLON.SetupSpriteSheetBlock",BJ);class bJ extends xu{constructor(H){super(H),this.reference=0,this.registerInput("value",Xu.AutoDetect),this.registerOutput("output",Xu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=H=>{switch(H){case Xu.Float:return Xu.FloatGradient;case Xu.Vector2:return Xu.Vector2Gradient;case Xu.lu:return Xu.Vector3Gradient;case Xu.Mg:return Xu.Color4Gradient}return H},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Xu.Float|Xu.Vector2|Xu.lu|Xu.Mg)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=H=>null}serialize(){const H=super.serialize();return H.reference=this.reference,H}_deserialize(H){super._deserialize(H),this.reference=H.reference}}(0,c.c)([zu("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],bJ.prototype,"reference",void 0),(0,g.f)("BABYLON.ParticleGradientValueBlock",bJ);(0,g.f)("BABYLON.ParticleGradientBlock",class extends xu{constructor(H){super(H),this._entryCount=1,this.registerInput("gradient",Xu.Float,!0,1,0,1),this.registerInput("value0",Xu.AutoDetect),this.registerOutput("output",Xu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=H=>{switch(H){case Xu.FloatGradient:return Xu.Float;case Xu.Vector2Gradient:return Xu.Vector2;case Xu.Vector3Gradient:return Xu.lu;case Xu.Color4Gradient:return Xu.Mg}return H},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Xu.FloatGradient|Xu.Vector2Gradient|Xu.Vector3Gradient|Xu.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(H){this._inputs[H].onConnectionObservable.add((()=>{this._entryCount>H||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Xu.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const H=[];for(let J=1;J<this._inputs.length;J++){var u;if(this._inputs[J].isConnected)H.push(null===(u=this._inputs[J].connectedPoint)||void 0===u?void 0:u.ownerBlock)}H.sort(((H,u)=>H.reference-u.reference)),this.output._storedFunction=u=>{const J=this.gradient.getConnectedValue(u);if(1===H.length)return H[0].value.getConnectedValue(u);let U=null;for(let h=H.length-1;h>=0;h--){const g=H[h];if(g.reference<=J){const H=g.value.getConnectedValue(u);if(U){const h=U.value.getConnectedValue(u),B=U.reference,d=g.reference,G=Math.max(0,Math.min(1,(J-d)/(B-d)));switch(this.output.type){case Xu.Float:return(0,b.Lerp)(H,h,G);case Xu.Vector2:return O.Vector2.Lerp(H,h,G);case Xu.lu:return O.lu.Lerp(H,h,G);case Xu.Mg:return w.Mg.Lerp(H,h,G)}}return H}U=g}return 0}}});(0,g.f)("BABYLON.ParticleConverterBlock",class extends xu{constructor(H){super(H),this.registerInput("color ",Xu.Mg,!0),this.registerInput("xyz ",Xu.lu,!0),this.registerInput("xy ",Xu.Vector2,!0),this.registerInput("zw ",Xu.Vector2,!0),this.registerInput("x ",Xu.Float,!0),this.registerInput("y ",Xu.Float,!0),this.registerInput("z ",Xu.Float,!0),this.registerInput("w ",Xu.Float,!0),this.registerOutput("color",Xu.Mg),this.registerOutput("xyz",Xu.lu),this.registerOutput("xy",Xu.Vector2),this.registerOutput("zw",Xu.Vector2),this.registerOutput("x",Xu.Float),this.registerOutput("y",Xu.Float),this.registerOutput("z",Xu.Float),this.registerOutput("w",Xu.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(H){return"color "===H?"colorIn":"xyz "===H?"xyzIn":"xy "===H?"xyIn":"zw "===H?"zwIn":"x "===H?"xIn":"y "===H?"yIn":"z "===H?"zIn":"w "===H?"wIn":H}_outputRename(H){switch(H){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return H}}_build(H){super._build(H);const u=this.xIn,J=this.yIn,U=this.zIn,h=this.wIn,g=this.xyIn,B=this.zwIn,b=this.xyzIn,d=this.colorIn,G=this.colorOut,P=this.xyzOut,mH=this.xyOut,l=this.zwOut,r=this.xOut,p=this.yOut,a=this.zOut,k=this.wOut,C=H=>{if(d.isConnected)return d.getConnectedValue(H);let O=0,G=0,P=0,mH=0;if(u.isConnected&&(O=u.getConnectedValue(H)),J.isConnected&&(G=J.getConnectedValue(H)),U.isConnected&&(P=U.getConnectedValue(H)),h.isConnected&&(mH=h.getConnectedValue(H)),g.isConnected){const u=g.getConnectedValue(H);u&&(O=u.x,G=u.y)}if(B.isConnected){const u=B.getConnectedValue(H);u&&(P=u.x,mH=u.y)}if(b.isConnected){const u=b.getConnectedValue(H);u&&(O=u.x,G=u.y,P=u.z)}return new w.Mg(O,G,P,mH)};G._storedFunction=H=>C(H),P._storedFunction=H=>{const u=C(H);return new O.lu(u.r,u.g,u.b)},mH._storedFunction=H=>{const u=C(H);return new O.Vector2(u.r,u.g)},l._storedFunction=H=>{const u=C(H);return new O.Vector2(u.b,u.a)},r._storedFunction=H=>C(H).r,p._storedFunction=H=>C(H).g,a._storedFunction=H=>C(H).b,k._storedFunction=H=>C(H).a}}),function(H){H[H.Cos=0]="Cos",H[H.Sin=1]="Sin",H[H.Abs=2]="Abs",H[H.Exp=3]="Exp",H[H.Exp2=4]="Exp2",H[H.Round=5]="Round",H[H.Floor=6]="Floor",H[H.Ceiling=7]="Ceiling",H[H.Sqrt=8]="Sqrt",H[H.Log=9]="Log",H[H.Tan=10]="Tan",H[H.ArcTan=11]="ArcTan",H[H.ArcCos=12]="ArcCos",H[H.ArcSin=13]="ArcSin",H[H.Sign=14]="Sign",H[H.Negate=15]="Negate",H[H.OneMinus=16]="OneMinus",H[H.Reciprocal=17]="Reciprocal",H[H.ToDegrees=18]="ToDegrees",H[H.ToRadians=19]="ToRadians",H[H.Fract=20]="Fract"}(ou||(ou={}));class dJ extends xu{constructor(H){super(H),this.operation=ou.Cos,this.registerInput("input",Xu.AutoDetect),this.registerOutput("output",Xu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Xu.Float|Xu.Int|Xu.Vector2|Xu.lu|Xu.Mg)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(H){super._build(H);let u=null;switch(this.operation){case ou.Cos:u=H=>Math.cos(H);break;case ou.Sin:u=H=>Math.sin(H);break;case ou.Abs:u=H=>Math.abs(H);break;case ou.Exp:u=H=>Math.exp(H);break;case ou.Exp2:u=H=>Math.pow(2,H);break;case ou.Round:u=H=>Math.round(H);break;case ou.Floor:u=H=>Math.floor(H);break;case ou.Ceiling:u=H=>Math.ceil(H);break;case ou.Sqrt:u=H=>Math.sqrt(H);break;case ou.Log:u=H=>Math.log(H);break;case ou.Tan:u=H=>Math.tan(H);break;case ou.ArcTan:u=H=>Math.atan(H);break;case ou.ArcCos:u=H=>Math.acos(H);break;case ou.ArcSin:u=H=>Math.asin(H);break;case ou.Sign:u=H=>Math.sign(H);break;case ou.Negate:u=H=>-H;break;case ou.OneMinus:u=H=>1-H;break;case ou.Reciprocal:u=H=>1/H;break;case ou.ToRadians:u=H=>H*Math.PI/180;break;case ou.ToDegrees:u=H=>180*H/Math.PI;break;case ou.Fract:u=H=>H>=0?H-Math.floor(H):H-Math.ceil(H)}if(!u)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Xu.Int:case Xu.Float:this.output._storedFunction=H=>{const J=this.input.getConnectedValue(H);return u(J)};break;case Xu.Vector2:this.output._storedFunction=H=>{const J=this.input.getConnectedValue(H);return new O.Vector2(u(J.x),u(J.y))};break;case Xu.lu:this.output._storedFunction=H=>{const J=this.input.getConnectedValue(H);return new O.lu(u(J.x),u(J.y),u(J.z))};break;case Xu.Mg:this.output._storedFunction=H=>{const J=this.input.getConnectedValue(H);return new w.Mg(u(J.r),u(J.g),u(J.b),u(J.a))}}return this}serialize(){const H=super.serialize();return H.operation=this.operation,H}_deserialize(H){super._deserialize(H),this.operation=H.operation}}(0,c.c)([zu("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:ou.Cos},{label:"Sin",value:ou.Sin},{label:"Abs",value:ou.Abs},{label:"Exp",value:ou.Exp},{label:"Exp2",value:ou.Exp2},{label:"Round",value:ou.Round},{label:"Floor",value:ou.Floor},{label:"Ceiling",value:ou.Ceiling},{label:"Sqrt",value:ou.Sqrt},{label:"Log",value:ou.Log},{label:"Tan",value:ou.Tan},{label:"ArcTan",value:ou.ArcTan},{label:"ArcCos",value:ou.ArcCos},{label:"ArcSin",value:ou.ArcSin},{label:"Sign",value:ou.Sign},{label:"Negate",value:ou.Negate},{label:"OneMinus",value:ou.OneMinus},{label:"Reciprocal",value:ou.Reciprocal},{label:"ToDegrees",value:ou.ToDegrees},{label:"ToRadians",value:ou.ToRadians},{label:"Fract",value:ou.Fract}]})],dJ.prototype,"operation",void 0),(0,g.f)("BABYLON.ParticleTrigonometryBlock",dJ);var GJ,PJ=J(13720);class mO extends xu{constructor(H){super(H),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Xu.AutoDetect),this.registerOutput("output",Xu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Xu.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Xu.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Xu.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Xu.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Xu.System),this._inputs[0].excludedConnectionPointTypes.push(Xu.Particle),this._inputs[0].excludedConnectionPointTypes.push(Xu.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(H){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const u=H=>{const u=this.input.getConnectedValue(H);if(this.log.length>=this.stackSize)return u;if(null===u||void 0===u)return this.log.push(["null",""]),u;switch(this.input.type){case Xu.Vector2:this.log.push([(0,PJ.g)(u,4),u.toString()]);break;case Xu.lu:this.log.push([(0,PJ.i)(u,4),u.toString()]);break;case Xu.Mg:this.log.push([`{R: ${u.r.toFixed(4)} G: ${u.g.toFixed(4)} B: ${u.b.toFixed(4)} A: ${u.a.toFixed(4)}}`,u.toString()]);break;default:this.log.push([u.toString(),u.toString()])}return u};this.output.isConnected?this.output._storedFunction=u:this.output._storedValue=u(H)}serialize(){const H=super.serialize();return H.stackSize=this.stackSize,H}_deserialize(H){super._deserialize(H),this.stackSize=H.stackSize}}(0,c.c)([zu("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],mO.prototype,"stackSize",void 0),(0,g.f)("BABYLON.ParticleDebugBlock",mO);(0,g.f)("BABYLON.ParticleElbowBlock",class extends xu{constructor(H){super(H),this.registerInput("input",Xu.AutoDetect),this.registerOutput("output",Xu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(H){super._build(H);const u=this._outputs[0],J=this._inputs[0];u._storedFunction=H=>J.getConnectedValue(H)}});(0,g.f)("BABYLON.ParticleTeleportInBlock",class extends xu{get endpoints(){return this._endpoints}constructor(H){super(H),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Xu.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(H){if(this.getClassName()===H)return!0;for(const u of this.endpoints)if(u.isAnAncestorOfType(H))return!0;return!1}isAnAncestorOf(H){for(const u of this.endpoints){if(u===H)return!0;if(u.isAnAncestorOf(H))return!0}return!1}attachToEndpoint(H){H.detach(),this._endpoints.push(H),H._entryPoint=this,H._outputs[0]._typeConnectionSource=this._inputs[0],H._tempEntryPointUniqueId=null,H.name="> "+this.name}detachFromEndpoint(H){const u=this._endpoints.indexOf(H);-1!==u&&(this._endpoints.splice(u,1),H._outputs[0]._typeConnectionSource=null,H._entryPoint=null)}_build(){for(const H of this._endpoints)H.output._storedFunction=H=>this.input.getConnectedValue(H)}});(0,g.f)("BABYLON.ParticleTeleportOutBlock",class extends xu{constructor(H){super(H),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Xu.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(H){this.entryPoint&&this.entryPoint.build(H)}clone(){const H=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(H),H}serialize(){var H;const u=super.serialize();return u.entryPoint=(null===(H=this.entryPoint)||void 0===H?void 0:H.uniqueId)??"",u}_deserialize(H){super._deserialize(H),this._tempEntryPointUniqueId=H.entryPoint}}),function(H){H[H.Equal=0]="Equal",H[H.NotEqual=1]="NotEqual",H[H.LessThan=2]="LessThan",H[H.GreaterThan=3]="GreaterThan",H[H.LessOrEqual=4]="LessOrEqual",H[H.GreaterOrEqual=5]="GreaterOrEqual",H[H.Xor=6]="Xor",H[H.Or=7]="Or",H[H.And=8]="And"}(GJ||(GJ={}));class lJ extends xu{constructor(H){super(H),this.test=GJ.Equal,this.epsilon=0,this.registerInput("left",Xu.Float),this.registerInput("right",Xu.Float,!0,0),this.registerInput("ifTrue",Xu.AutoDetect,!0,1),this.registerInput("ifFalse",Xu.AutoDetect,!0,0),this.registerOutput("output",Xu.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Xu.Float,this._inputs[0].acceptedConnectionPointTypes.push(Xu.Int),this._inputs[1].acceptedConnectionPointTypes.push(Xu.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const H=H=>{const u=this.left.getConnectedValue(H),J=this.right.getConnectedValue(H);let O=!1;switch(this.test){case GJ.Equal:O=(0,b.WithinEpsilon)(u,J,this.epsilon);break;case GJ.NotEqual:O=!(0,b.WithinEpsilon)(u,J,this.epsilon);break;case GJ.LessThan:O=u<J+this.epsilon;break;case GJ.GreaterThan:O=u>J-this.epsilon;break;case GJ.LessOrEqual:O=u<=J+this.epsilon;break;case GJ.GreaterOrEqual:O=u>=J-this.epsilon;break;case GJ.Xor:O=!!u&&!J||!u&&!!J;break;case GJ.Or:O=!!u||!!J;break;case GJ.And:O=!!u&&!!J}return O};this.output._storedFunction=u=>H(u)?this.ifTrue.getConnectedValue(u):this.ifFalse.getConnectedValue(u)}serialize(){const H=super.serialize();return H.test=this.test,H.epsilon=this.epsilon,H}_deserialize(H){super._deserialize(H),this.test=H.test,void 0!==H.epsilon&&(this.epsilon=H.epsilon)}}(0,c.c)([zu("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:GJ.Equal},{label:"NotEqual",value:GJ.NotEqual},{label:"LessThan",value:GJ.LessThan},{label:"GreaterThan",value:GJ.GreaterThan},{label:"LessOrEqual",value:GJ.LessOrEqual},{label:"GreaterOrEqual",value:GJ.GreaterOrEqual},{label:"Xor",value:GJ.Xor},{label:"Or",value:GJ.Or},{label:"And",value:GJ.And}]})],lJ.prototype,"test",void 0),(0,c.c)([zu("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],lJ.prototype,"epsilon",void 0),(0,g.f)("BABYLON.ParticleConditionBlock",lJ);class rJ extends xu{constructor(H){super(H),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Xu.Particle),this.registerInput("condition",Xu.Float,!0,0),this.registerInput("system",Xu.System),this.registerOutput("output",Xu.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(H){this._triggerCount=0;const u=this.input.getConnectedValue(H),J={process:J=>{if(H.particleContext=J,H.systemContext=u,0!==this.condition.getConnectedValue(H)&&(0===this.limit||this._triggerCount<this.limit)){const O=(new Date).getTime();if(this._previousOne&&O-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=O;const U=this.system.getConnectedValue(H);if(U){const O=Nu(U,H.pu,J.position);O.nh.addOnce((()=>{this._triggerCount--})),u.nh.addOnce((()=>{O.dispose()}))}}},previousItem:null,nextItem:null};u._updateQueueStart?vH(J,u._updateQueueStart):u._updateQueueStart=J,this.output._storedValue=u}serialize(){const H=super.serialize();return H.limit=this.limit,H.delay=this.delay,H}_deserialize(H){super._deserialize(H),void 0!==H.limit&&(this.limit=H.limit),void 0!==H.delay&&(this.delay=H.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,c.c)([zu("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rJ.prototype,"limit",void 0),(0,c.c)([zu("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rJ.prototype,"delay",void 0),(0,g.f)("BABYLON.ParticleTriggerBlock",rJ);J(13725),J(13738),J(13751),J(13813)},13799:(H,u,J)=>{"use strict";var O=J(12259);const U="clipPlaneFragment",h="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13758:(H,u,J)=>{"use strict";var O=J(12259);const U="clipPlaneFragmentDeclaration",h="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13831:(H,u,J)=>{"use strict";var O=J(12259);const U="clipPlaneVertex",h="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13821:(H,u,J)=>{"use strict";var O=J(12259);const U="clipPlaneVertexDeclaration",h="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13810:(H,u,J)=>{"use strict";var O=J(12259);const U="fogFragment",h="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13790:(H,u,J)=>{"use strict";var O=J(12259);const U="fogFragmentDeclaration",h="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13833:(H,u,J)=>{"use strict";var O=J(12259);const U="fogVertex",h="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13828:(H,u,J)=>{"use strict";var O=J(12259);const U="fogVertexDeclaration",h="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13777:(H,u,J)=>{"use strict";var O=J(12259);const U="helperFunctions",h="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13765:(H,u,J)=>{"use strict";var O=J(12259);const U="imageProcessingDeclaration",h="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13784:(H,u,J)=>{"use strict";var O=J(12259);const U="imageProcessingFunctions",h="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13768:(H,u,J)=>{"use strict";var O=J(12259);const U="logDepthDeclaration",h="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13804:(H,u,J)=>{"use strict";var O=J(12259);const U="logDepthFragment",h="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13837:(H,u,J)=>{"use strict";var O=J(12259);const U="logDepthVertex",h="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";O.b.IncludesShadersStoreWGSL[U]||(O.b.IncludesShadersStoreWGSL[U]=h)},13751:(H,u,J)=>{"use strict";J.r(u),J.d(u,{particlesPixelShaderWGSL:()=>w});var O=J(12259);J(13758),J(13765),J(13768),J(13777),J(13784),J(13790),J(13799),J(13804),J(13810);const U="particlesPixelShader",h="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";O.b.ShadersStoreWGSL[U]||(O.b.ShadersStoreWGSL[U]=h);const w={name:U,shader:h}},13813:(H,u,J)=>{"use strict";J.r(u),J.d(u,{particlesVertexShaderWGSL:()=>w});var O=J(12259);J(13821),J(13828),J(13768),J(13831),J(13833),J(13837);const U="particlesVertexShader",h="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";O.b.ShadersStoreWGSL[U]||(O.b.ShadersStoreWGSL[U]=h);const w={name:U,shader:h}},13664:(H,u,J)=>{"use strict";var O=J(12259);const U="clipPlaneFragment",h="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13729:(H,u,J)=>{"use strict";var O=J(12259);const U="clipPlaneFragmentDeclaration",h="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13679:(H,u,J)=>{"use strict";var O=J(12259);const U="clipPlaneVertex",h="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13745:(H,u,J)=>{"use strict";var O=J(12259);const U="clipPlaneVertexDeclaration",h="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13672:(H,u,J)=>{"use strict";var O=J(12259);const U="fogFragment",h="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13655:(H,u,J)=>{"use strict";var O=J(12259);const U="fogFragmentDeclaration",h="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13683:(H,u,J)=>{"use strict";var O=J(12259);const U="fogVertex",h="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13675:(H,u,J)=>{"use strict";var O=J(12259);const U="fogVertexDeclaration",h="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13643:(H,u,J)=>{"use strict";var O=J(12259);const U="helperFunctions",h="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13626:(H,u,J)=>{"use strict";var O=J(12259);const U="imageProcessingDeclaration",h="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13650:(H,u,J)=>{"use strict";var O=J(12259);const U="imageProcessingFunctions",h="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13634:(H,u,J)=>{"use strict";var O=J(12259);const U="logDepthDeclaration",h="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13669:(H,u,J)=>{"use strict";var O=J(12259);const U="logDepthFragment",h="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13687:(H,u,J)=>{"use strict";var O=J(12259);const U="logDepthVertex",h="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";O.b.IncludesShadersStore[U]||(O.b.IncludesShadersStore[U]=h)},13725:(H,u,J)=>{"use strict";J.r(u),J.d(u,{particlesPixelShader:()=>w});var O=J(12259);J(13729),J(13626),J(13634),J(13643),J(13650),J(13655),J(13664),J(13669),J(13672);const U="particlesPixelShader",h="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";O.b.ShadersStore[U]||(O.b.ShadersStore[U]=h);const w={name:U,shader:h}},13738:(H,u,J)=>{"use strict";J.r(u),J.d(u,{particlesVertexShader:()=>w});var O=J(12259);J(13745),J(13675),J(13634),J(13679),J(13683),J(13687);const U="particlesVertexShader",h="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";O.b.ShadersStore[U]||(O.b.ShadersStore[U]=h);const w={name:U,shader:h}},14072:(H,u,J)=>{"use strict";J.r(u),J.d(u,{FlowGraphGLTFDataProvider:()=>h});var O=J(14041),U=J(14018);class h extends O.b{constructor(H){var u,J;super();const O=H.glTF,h=(null===(u=O.animations)||void 0===u?void 0:u.map((H=>H._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",U.d,h);const w=(null===(J=O.nodes)||void 0===J?void 0:J.map((H=>H._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",U.d,w)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13973:(H,u,J)=>{"use strict";J.d(u,{d:()=>p,g:()=>l,k:()=>mH,m:()=>r});var O=J(12338),U=J(12806),h=J(12379),w=J(13977);const g=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class B{constructor(H,u){this._gltf=H,this._infoTree=u}convert(H){let u,J=this._gltf,O=this._infoTree;if(!H.startsWith("/"))throw new Error("Path must start with a /");const U=H.split("/");if(U.shift(),U[U.length-1].includes(".length")){const H=U[U.length-1].split(".");U.pop(),U.push(...H)}let h=!1;for(const B of U){const U="length"===B;if(U&&!O.__array__)throw new Error(`Path ${H} is invalid`);if(O.__ignoreObjectTree__&&(h=!0),O.__array__&&!U)O=O.__array__;else if(O=O[B],!O)throw new Error(`Path ${H} is invalid`);if(!h)if(void 0===J){if(!g.find((u=>u.regex.test(H))))throw new Error(`Path ${H} is invalid`)}else if(!U){var w;J=null===(w=J)||void 0===w?void 0:w[B]}(O.__target__||U)&&(u=J)}return{object:u,info:O}}}function b(H,u,J,O){const U=d(H,u);return O?U[J][O]:U[J]}function d(H,u,J){var O,h;return null===(O=H._data)||void 0===O||null===(h=O[(null===J||void 0===J?void 0:J.fillMode)??U.b.MATERIAL_TriangleFillMode])||void 0===h?void 0:h.babylonMaterial}function G(H,u){return{offset:{componentsCount:2,type:"Vector2",get:(J,U,h)=>{const w=b(J,h,H,u);return new O.Vector2(null===w||void 0===w?void 0:w.uOffset,null===w||void 0===w?void 0:w.vOffset)},getTarget:d,set:(J,O,U,h)=>{const w=b(O,h,H,u);w.uOffset=J.x,w.vOffset=J.y},getPropertyName:[()=>`${H}${u?"."+u:""}.uOffset`,()=>`${H}${u?"."+u:""}.vOffset`]},rotation:{type:"number",get:(J,O,U)=>{var h;return null===(h=b(J,U,H,u))||void 0===h?void 0:h.wAng},getTarget:d,set:(J,O,U,h)=>b(O,h,H,u).wAng=J,getPropertyName:[()=>`${H}${u?"."+u:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(J,U,h)=>{const w=b(J,h,H,u);return new O.Vector2(null===w||void 0===w?void 0:w.uScale,null===w||void 0===w?void 0:w.vScale)},getTarget:d,set:(J,O,U,h)=>{const w=b(O,h,H,u);w.uScale=J.x,w.vScale=J.y},getPropertyName:[()=>`${H}${u?"."+u:""}.uScale`,()=>`${H}${u?"."+u:""}.vScale`]}}}const P={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:H=>{var u,J;return new O.Vector2((null===(u=H._babylonCamera)||void 0===u?void 0:u.orthoLeft)??0,(null===(J=H._babylonCamera)||void 0===J?void 0:J.orthoRight)??0)},set:(H,u)=>{u._babylonCamera&&(u._babylonCamera.orthoLeft=H.x,u._babylonCamera.orthoRight=H.y)},getTarget:H=>H,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:H=>{var u,J;return new O.Vector2((null===(u=H._babylonCamera)||void 0===u?void 0:u.orthoBottom)??0,(null===(J=H._babylonCamera)||void 0===J?void 0:J.orthoTop)??0)},set:(H,u)=>{u._babylonCamera&&(u._babylonCamera.orthoBottom=H.x,u._babylonCamera.orthoTop=H.y)},getTarget:H=>H,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:H=>{var u;return null===(u=H._babylonCamera)||void 0===u?void 0:u.maxZ},set:(H,u)=>{u._babylonCamera&&(u._babylonCamera.maxZ=H)},getTarget:H=>H,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:H=>{var u;return null===(u=H._babylonCamera)||void 0===u?void 0:u.Ug},set:(H,u)=>{u._babylonCamera&&(u._babylonCamera.Ug=H)},getTarget:H=>H,getPropertyName:[()=>"Ug"]}},perspective:{aspectRatio:{type:"number",get:H=>{var u;return null===(u=H._babylonCamera)||void 0===u?void 0:u.getEngine().getAspectRatio(H._babylonCamera)},getTarget:H=>H,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:H=>{var u;return null===(u=H._babylonCamera)||void 0===u?void 0:u.fov},set:(H,u)=>{u._babylonCamera&&(u._babylonCamera.fov=H)},getTarget:H=>H,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:H=>{var u;return null===(u=H._babylonCamera)||void 0===u?void 0:u.maxZ},set:(H,u)=>{u._babylonCamera&&(u._babylonCamera.maxZ=H)},getTarget:H=>H,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:H=>{var u;return null===(u=H._babylonCamera)||void 0===u?void 0:u.Ug},set:(H,u)=>{u._babylonCamera&&(u._babylonCamera.Ug=H)},getTarget:H=>H,getPropertyName:[()=>"Ug"]}}}},nodes:{length:{type:"number",get:H=>H.length,getTarget:H=>H.map((H=>H._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"lu",get:H=>{var u;return null===(u=H._babylonTransformNode)||void 0===u?void 0:u.position},set:(H,u)=>{var J;return null===(J=u._babylonTransformNode)||void 0===J?void 0:J.position.O(H)},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:H=>{var u;return null===(u=H._babylonTransformNode)||void 0===u?void 0:u.rotationQuaternion},set:(H,u)=>{var J,O;return null===(J=u._babylonTransformNode)||void 0===J||null===(O=J.rotationQuaternion)||void 0===O?void 0:O.O(H)},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"lu",get:H=>{var u;return null===(u=H._babylonTransformNode)||void 0===u?void 0:u.Cg},set:(H,u)=>{var J;return null===(J=u._babylonTransformNode)||void 0===J?void 0:J.Cg.O(H)},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"Cg"]},weights:{length:{type:"number",get:H=>H._numMorphTargets,getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(H,u)=>{var J,O;return void 0!==u?null===(J=H._primitiveBabylonMeshes)||void 0===J||null===(O=J[0].morphTargetManager)||void 0===O?void 0:O.getTarget(u).influence:void 0},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(H,u)=>[0],getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:H=>{var u,J,U;return O.Matrix.Compose(null===(u=H._babylonTransformNode)||void 0===u?void 0:u.Cg,null===(J=H._babylonTransformNode)||void 0===J?void 0:J.rotationQuaternion,null===(U=H._babylonTransformNode)||void 0===U?void 0:U.position)},getTarget:H=>H._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:H=>{var u,J,U,h;const w=O.Matrix.Identity();let g=H.parent;for(;g&&g.parent;)g=g.parent;const B=(null===(u=H._babylonTransformNode)||void 0===u?void 0:u.position._isDirty)||(null===(J=H._babylonTransformNode)||void 0===J||null===(U=J.rotationQuaternion)||void 0===U?void 0:U._isDirty)||(null===(h=H._babylonTransformNode)||void 0===h?void 0:h.Cg._isDirty);if(g){var b;const u=null===(b=g._babylonTransformNode)||void 0===b?void 0:b.dg(!0).invert();var d,G;if(u)null===(d=H._babylonTransformNode)||void 0===d||null===(G=d.dg(B))||void 0===G||G.multiplyToRef(u,w)}else H._babylonTransformNode&&w.O(H._babylonTransformNode.dg(B));return w},getTarget:H=>H._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:H=>{var u,J;return null===(u=H._babylonTransformNode)||void 0===u||null===(J=u.getChildren((H=>H instanceof w.b),!0)[0])||void 0===J?void 0:J.Yg},getTarget:H=>{var u;return null===(u=H._babylonTransformNode)||void 0===u?void 0:u.getChildren((H=>H instanceof w.b),!0)[0]},set:(H,u)=>{if(u._babylonTransformNode){const J=u._babylonTransformNode.getChildren((H=>H instanceof w.b),!0)[0];J&&(J.Yg=H)}}},color:{type:"ku",get:H=>{var u,J;return null===(u=H._babylonTransformNode)||void 0===u||null===(J=u.getChildren((H=>H instanceof w.b),!0)[0])||void 0===J?void 0:J.Fg},getTarget:H=>{var u;return null===(u=H._babylonTransformNode)||void 0===u?void 0:u.getChildren((H=>H instanceof w.b),!0)[0]},set:(H,u)=>{if(u._babylonTransformNode){const J=u._babylonTransformNode.getChildren((H=>H instanceof w.b),!0)[0];J&&(J.Fg=H)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"ku",get:(H,u,J)=>d(H,u,J).emissiveColor,set:(H,u,J,O)=>d(u,J,O).emissiveColor.O(H),getTarget:(H,u,J)=>d(H,u,J),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:G("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(H,u,J)=>{var O;return null===(O=b(H,J,"bumpTexture"))||void 0===O?void 0:O.level},set:(H,u,J,O)=>{const U=b(u,O,"bumpTexture");U&&(U.level=H)},getTarget:(H,u,J)=>d(H,u,J),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:G("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(H,u,J)=>d(H,u,J).ambientTextureStrength,set:(H,u,J,O)=>{const U=d(u,J,O);U&&(U.ambientTextureStrength=H)},getTarget:(H,u,J)=>d(H,u,J),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:G("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Mg",get:(H,u,J)=>{const O=d(H,u,J);return h.Mg.FromColor3(O.albedoColor,O.alpha)},set:(H,u,J,O)=>{const U=d(u,J,O);U.albedoColor.set(H.r,H.g,H.b),U.alpha=H.a},getTarget:(H,u,J)=>d(H,u,J),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:G("albedoTexture")}},metallicFactor:{type:"number",get:(H,u,J)=>d(H,u,J).metallic,set:(H,u,J,O)=>{const U=d(u,J,O);U&&(U.metallic=H)},getTarget:(H,u,J)=>d(H,u,J),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(H,u,J)=>d(H,u,J).roughness,set:(H,u,J,O)=>{const U=d(u,J,O);U&&(U.roughness=H)},getTarget:(H,u,J)=>d(H,u,J),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:G("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(H,u,J)=>d(H,u,J).anisotropy.Yg,set:(H,u,J,O)=>{d(u,J,O).anisotropy.Yg=H},getTarget:(H,u,J)=>d(H,u,J),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(H,u,J)=>d(H,u,J).anisotropy.angle,set:(H,u,J,O)=>{d(u,J,O).anisotropy.angle=H},getTarget:(H,u,J)=>d(H,u,J),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:G("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(H,u,J)=>d(H,u,J).clearCoat.Yg,set:(H,u,J,O)=>{d(u,J,O).clearCoat.Yg=H},getTarget:(H,u,J)=>d(H,u,J),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(H,u,J)=>d(H,u,J).clearCoat.roughness,set:(H,u,J,O)=>{d(u,J,O).clearCoat.roughness=H},getTarget:(H,u,J)=>d(H,u,J),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:G("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(H,u,J)=>{var O;return null===(O=d(H,u,J).clearCoat.bumpTexture)||void 0===O?void 0:O.level},getTarget:d,set:(H,u,J,O)=>d(u,J,O).clearCoat.bumpTexture.level=H},extensions:{KHR_texture_transform:G("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:G("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(H,u,J)=>d(H,u,J).subSurface.dispersion,getTarget:d,set:(H,u,J,O)=>d(u,J,O).subSurface.dispersion=H}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(H,u,J)=>d(H,u,J).emissiveIntensity,getTarget:d,set:(H,u,J,O)=>d(u,J,O).emissiveIntensity=H}},KHR_materials_ior:{ior:{type:"number",get:(H,u,J)=>d(H,u,J).indexOfRefraction,getTarget:d,set:(H,u,J,O)=>d(u,J,O).indexOfRefraction=H}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(H,u,J)=>d(H,u,J).iridescence.Yg,getTarget:d,set:(H,u,J,O)=>d(u,J,O).iridescence.Yg=H},iridescenceIor:{type:"number",get:(H,u,J)=>d(H,u,J).iridescence.indexOfRefraction,getTarget:d,set:(H,u,J,O)=>d(u,J,O).iridescence.indexOfRefraction=H},iridescenceTexture:{extensions:{KHR_texture_transform:G("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(H,u,J)=>d(H,u,J).iridescence.maximumThickness,getTarget:d,set:(H,u,J,O)=>d(u,J,O).iridescence.maximumThickness=H},iridescenceThicknessMinimum:{type:"number",get:(H,u,J)=>d(H,u,J).iridescence.minimumThickness,getTarget:d,set:(H,u,J,O)=>d(u,J,O).iridescence.minimumThickness=H},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:G("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"ku",get:(H,u,J)=>d(H,u,J).sheen.color,getTarget:d,set:(H,u,J,O)=>d(u,J,O).sheen.color.O(H)},sheenColorTexture:{extensions:{KHR_texture_transform:G("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(H,u,J)=>d(H,u,J).sheen.Yg,getTarget:d,set:(H,u,J,O)=>d(u,J,O).sheen.Yg=H},sheenRoughnessTexture:{extensions:{KHR_texture_transform:G("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(H,u,J)=>d(H,u,J).metallicF0Factor,getTarget:d,set:(H,u,J,O)=>d(u,J,O).metallicF0Factor=H,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"ku",get:(H,u,J)=>d(H,u,J).metallicReflectanceColor,getTarget:d,set:(H,u,J,O)=>d(u,J,O).metallicReflectanceColor.O(H),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:G("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:G("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(H,u,J)=>d(H,u,J).subSurface.refractionIntensity,getTarget:d,set:(H,u,J,O)=>d(u,J,O).subSurface.refractionIntensity=H,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:G("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(H,u,J)=>d(H,u,J).subSurface.translucencyIntensity,getTarget:d,set:(H,u,J,O)=>d(u,J,O).subSurface.translucencyIntensity=H},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:G("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"ku",get:(H,u,J)=>d(H,u,J).subSurface.translucencyColor,getTarget:d,set:(H,u,J,O)=>{var U;return H&&(null===(U=d(u,J,O).subSurface.translucencyColor)||void 0===U?void 0:U.O(H))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:G("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"ku",get:(H,u,J)=>d(H,u,J).subSurface.tintColor,getTarget:d,set:(H,u,J,O)=>d(u,J,O).subSurface.tintColor.O(H)},attenuationDistance:{type:"number",get:(H,u,J)=>d(H,u,J).subSurface.tintColorAtDistance,getTarget:d,set:(H,u,J,O)=>d(u,J,O).subSurface.tintColorAtDistance=H},thicknessFactor:{type:"number",get:(H,u,J)=>d(H,u,J).subSurface.maximumThickness,getTarget:d,set:(H,u,J,O)=>d(u,J,O).subSurface.maximumThickness=H},thicknessTexture:{extensions:{KHR_texture_transform:G("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:H=>H.length,getTarget:H=>H.map((H=>H._babylonLight)),getPropertyName:[H=>"length"]},__array__:{__target__:!0,color:{type:"ku",get:H=>{var u;return null===(u=H._babylonLight)||void 0===u?void 0:u.Fg},set:(H,u)=>{var J;return null===(J=u._babylonLight)||void 0===J?void 0:J.Fg.O(H)},getTarget:H=>H._babylonLight,getPropertyName:[H=>"diffuse"]},Yg:{type:"number",get:H=>{var u;return null===(u=H._babylonLight)||void 0===u?void 0:u.Yg},set:(H,u)=>u._babylonLight?u._babylonLight.Yg=H:void 0,getTarget:H=>H._babylonLight,getPropertyName:[H=>"intensity"]},range:{type:"number",get:H=>{var u;return null===(u=H._babylonLight)||void 0===u?void 0:u.range},set:(H,u)=>u._babylonLight?u._babylonLight.range=H:void 0,getTarget:H=>H._babylonLight,getPropertyName:[H=>"range"]},spot:{innerConeAngle:{type:"number",get:H=>{var u;return null===(u=H._babylonLight)||void 0===u?void 0:u.innerAngle},set:(H,u)=>u._babylonLight?u._babylonLight.innerAngle=H:void 0,getTarget:H=>H._babylonLight,getPropertyName:[H=>"innerConeAngle"]},outerConeAngle:{type:"number",get:H=>{var u;return null===(u=H._babylonLight)||void 0===u?void 0:u.angle},set:(H,u)=>u._babylonLight?u._babylonLight.angle=H:void 0,getTarget:H=>H._babylonLight,getPropertyName:[H=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:H=>H.length,getTarget:H=>H.map((H=>H._babylonLight)),getPropertyName:[H=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:H=>H.length,getTarget:H=>H.map((H=>H._babylonTexture)),getPropertyName:[H=>"length"]},__array__:{__target__:!0,Yg:{type:"number",get:H=>{var u;return null===(u=H._babylonTexture)||void 0===u?void 0:u.level},set:(H,u)=>{u._babylonTexture&&(u._babylonTexture.level=H)},getTarget:H=>H._babylonTexture},rotation:{type:"Quaternion",get:H=>{var u;return H._babylonTexture&&O.Quaternion.FromRotationMatrix(null===(u=H._babylonTexture)||void 0===u?void 0:u.getReflectionTextureMatrix())},set:(H,u)=>{var J;u._babylonTexture&&(null!==(J=u._babylonTexture.ZH())&&void 0!==J&&J.useRightHandedSystem||(H=O.Quaternion.Inverse(H)),O.Matrix.FromQuaternionToRef(H,u._babylonTexture.getReflectionTextureMatrix()))},getTarget:H=>H._babylonTexture}}}}},animations:{length:{type:"number",get:H=>H.length,getTarget:H=>H.map((H=>H._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:H=>H.length,getTarget:H=>H.map((H=>{var u;return null===(u=H.primitives[0]._instanceData)||void 0===u?void 0:u.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function mH(H){return new B(H,P)}function l(H){const u=H.split("/").map((H=>H.replace(/{}/g,"__array__")));let J=P;for(const O of u)O&&(J=J[O]);if(J&&J.type&&J.get)return J}function r(H,u){const J=H.split("/").map((H=>H.replace(/{}/g,"__array__")));let O=P;for(const U of J)U&&(O=O[U]);O&&O.type&&O.get&&(O.interpolation=u)}function p(H,u){const J=H.split("/").map((H=>H.replace(/{}/g,"__array__")));let O=P;for(const U of J)if(U){if(!O[U]){if("?"===U){O.__ignoreObjectTree__=!0;continue}O[U]={},"__array__"===U&&(O[U].__target__=!0)}O=O[U]}Object.assign(O,u)}},13979:(H,u,J)=>{"use strict";J.r(u),J.d(u,{AnimationPropertyInfo:()=>b,TransformNodeAnimationPropertyInfo:()=>d,WeightAnimationPropertyInfo:()=>G,getQuaternion:()=>g,getVector3:()=>w,getWeights:()=>B});var O=J(12852),U=J(12338),h=J(13973);function w(H,u,J,O){return U.lu.Cu(u,J).scaleInPlace(O)}function g(H,u,J,O){return U.Quaternion.Cu(u,J).scaleInPlace(O)}function B(H,u,J,O){const U=new Array(H._numMorphTargets);for(let h=0;h<U.length;h++)U[h]=u[J++]*O;return U}class b{constructor(H,u,J,O){this.type=H,this.name=u,this.getValue=J,this.getStride=O}_buildAnimation(H,u,J){const U=new O.e(H,this.name,u,this.type);return U.setKeys(J),U}}class d extends b{buildAnimations(H,u,J,O){const U=[];return U.push({babylonAnimatable:H._babylonTransformNode,babylonAnimation:this._buildAnimation(u,J,O)}),U}}class G extends b{buildAnimations(H,u,J,U){const h=[];if(H._numMorphTargets)for(let w=0;w<H._numMorphTargets;w++){const g=new O.e(`${u}_${w}`,this.name,J,this.type);if(g.setKeys(U.map((H=>({frame:H.frame,inTangent:H.inTangent?H.inTangent[w]:void 0,value:H.value[w],outTangent:H.outTangent?H.outTangent[w]:void 0,interpolation:H.interpolation})))),H._primitiveBabylonMeshes)for(const u of H._primitiveBabylonMeshes)if(u.morphTargetManager){const H=u.morphTargetManager.getTarget(w),J=g.clone();H.animations.push(J),h.push({babylonAnimatable:H,babylonAnimation:J})}}return h}}(0,h.m)("/nodes/{}/translation",[new d(O.e.ANIMATIONTYPE_VECTOR3,"position",w,(()=>3))]),(0,h.m)("/nodes/{}/rotation",[new d(O.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",g,(()=>4))]),(0,h.m)("/nodes/{}/scale",[new d(O.e.ANIMATIONTYPE_VECTOR3,"Cg",w,(()=>3))]),(0,h.m)("/nodes/{}/weights",[new G(O.e.ANIMATIONTYPE_FLOAT,"influence",B,(H=>H._numMorphTargets))])},13943:(H,u,J)=>{"use strict";class O{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((H,u)=>{this._resolve=H,this._reject=u}))}}var U=J(12338),h=J(12379),w=J(12171),g=J(12774),B=J(13946),b=J(13956),d=J(12175),G=J(12801),P=J(12852),mH=J(12859),l=J(12203),r=J(12185),p=J(12191);class a{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(H){this._useTextureToStoreBoneMatrices=H,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(H){this._animationPropertiesOverride=H}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(H,u,J){this.name=H,this.id=u,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=U.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new d.b,this.bones=[],this._scene=J||l.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const O=this._scene.getEngine().getCaps();this._canUseTextureForBones=O.textureFloat&&O.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((H=>!H.getParent()))}getTransformMatrices(H){if(this.needInitialSkinMatrix){if(!H)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return H._bonesTransformMatrices||this.prepare(!0),H._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(H){return this.needInitialSkinMatrix&&H._transformMatrixTexture?H._transformMatrixTexture:this._transformMatrixTexture}ZH(){return this._scene}toString(H){let u=`Name: ${this.name}, nBones: ${this.bones.length}`;if(u+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,H){u+=", Ranges: {";let H=!0;for(const J in this._ranges)H&&(u+=", ",H=!1),u+=J;u+="}"}return u}getBoneIndexByName(H){for(let u=0,J=this.bones.length;u<J;u++)if(this.bones[u].name===H)return u;return-1}createAnimationRange(H,u,J){if(!this._ranges[H]){this._ranges[H]=new mH.b(H,u,J);for(let O=0,U=this.bones.length;O<U;O++)this.bones[O].animations[0]&&this.bones[O].animations[0].createRange(H,u,J)}}deleteAnimationRange(H){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let J=0,O=this.bones.length;J<O;J++)this.bones[J].animations[0]&&this.bones[J].animations[0].deleteRange(H,u);this._ranges[H]=null}getAnimationRange(H){return this._ranges[H]||null}getAnimationRanges(){const H=[];let u;for(u in this._ranges)H.push(this._ranges[u]);return H}copyAnimationRange(H,u){let J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[u]||!H.getAnimationRange(u))return!1;let O=!0;const U=this._getHighestAnimationFrame()+1,h={},w=H.bones;let g,B;for(B=0,g=w.length;B<g;B++)h[w[B].name]=w[B];this.bones.length!==w.length&&(r.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${w.length}`),O=!1);const b=J&&this.dimensionsAtRest&&H.dimensionsAtRest?this.dimensionsAtRest.divide(H.dimensionsAtRest):null;for(B=0,g=this.bones.length;B<g;B++){const H=this.bones[B].name,w=h[H];w?O=O&&this.bones[B].copyAnimationRange(w,u,U,J,b):(r.b.Warn("copyAnimationRange: not same rig, missing source bone "+H),O=!1)}const d=H.getAnimationRange(u);return d&&(this._ranges[u]=new mH.b(u,d.from+U,d.to+U)),O}returnToRest(){for(const H of this.bones)-1!==H._index&&H.returnToRest()}_getHighestAnimationFrame(){let H=0;for(let u=0,J=this.bones.length;u<J;u++)if(this.bones[u].animations[0]){const J=this.bones[u].animations[0].getHighestFrame();H<J&&(H=J)}return H}beginAnimation(H,u,J,O){const U=this.getAnimationRange(H);return U?this._scene.beginAnimation(this,U.from,U.to,u,J,O):null}static MakeAnimationAdditive(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,J=arguments.length>2?arguments[2]:void 0;const O=H.getAnimationRange(J);if(!O)return null;const U=H._scene.getAllAnimatablesByTarget(H);let h=null;for(let g=0;g<U.length;g++){const H=U[g];if(H.fromFrame===(null===O||void 0===O?void 0:O.from)&&H.toFrame===(null===O||void 0===O?void 0:O.to)){h=H;break}}const w=H.getAnimatables();for(let g=0;g<w.length;g++){const H=w[g].animations;if(H)for(let O=0;O<H.length;O++)P.e.MakeAnimationAdditive(H[O],u,J)}return h&&(h.isAdditive=!0),H}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(H){this._meshesWithPoseMatrix.push(H)}_unregisterMeshWithPoseMatrix(H){const u=this._meshesWithPoseMatrix.indexOf(H);u>-1&&this._meshesWithPoseMatrix.splice(u,1)}_computeTransformMatrices(H,u){this.onBeforeComputeObservable.notifyObservers(this);for(let J=0;J<this.bones.length;J++){const O=this.bones[J];O._childUpdateId++;const U=O.getParent();if(U?O.getLocalMatrix().multiplyToRef(U.getFinalMatrix(),O.getFinalMatrix()):u?O.getLocalMatrix().multiplyToRef(u,O.getFinalMatrix()):O.getFinalMatrix().O(O.getLocalMatrix()),-1!==O._index){const u=null===O._index?J:O._index;O.getAbsoluteInverseBindMatrix().multiplyToArray(O.getFinalMatrix(),H,16*u)}}this._identity.copyToArray(H,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const H=this.ZH().getRenderId();if(this._currentRenderId===H)return;this._currentRenderId=H}if(this._numBonesWithLinkedTransformNode>0)for(const H of this.bones)if(H._linkedTransformNode){const u=H._linkedTransformNode;H.position=u.position,u.rotationQuaternion?H.rotationQuaternion=u.rotationQuaternion:H.rotation=u.rotation,H.Cg=u.Cg}if(this.needInitialSkinMatrix)for(const H of this._meshesWithPoseMatrix){const u=H.getPoseMatrix();let J=this._isDirty;if(H._bonesTransformMatrices&&H._bonesTransformMatrices.length===16*(this.bones.length+1)||(H._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),J=!0),J){if(this._synchronizedWithMesh!==H){this._synchronizedWithMesh=H;for(const H of this.bones)if(!H.getParent()){H.getBindMatrix().multiplyToRef(u,U.TmpVectors.Matrix[1]),H._updateAbsoluteBindMatrices(U.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const u=4*(this.bones.length+1);H._transformMatrixTexture&&H._transformMatrixTexture.getSize().width===u||(H._transformMatrixTexture&&H._transformMatrixTexture.dispose(),H._transformMatrixTexture=G.d.CreateRGBATexture(H._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(H._bonesTransformMatrices,u),this.isUsingTextureForMatrices&&H._transformMatrixTexture&&H._transformMatrixTexture.update(H._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=G.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let H=0;H<this.bones.length;H++)this._animatables.push(this.bones[H])}return this._animatables}clone(H,u){const J=new a(H,u||H,this._scene);J.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let O=0;O<this.bones.length;O++){const H=this.bones[O];let u=null;const U=H.getParent();if(U){const H=this.bones.indexOf(U);u=J.bones[H]}const h=new b.e(H.name,J,u,H.getBindMatrix().clone(),H.getRestMatrix().clone());h._index=H._index,H._linkedTransformNode&&h.linkTransformNode(H._linkedTransformNode),p.e.DeepCopy(H.animations,h.animations)}if(this._ranges){J._ranges={};for(const H in this._ranges){const u=this._ranges[H];u&&(J._ranges[H]=u.clone())}}return this._isDirty=!0,J.prepare(!0),J}enableBlending(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const u of this.bones)for(const J of u.animations)J.enableBlending=!0,J.blendingSpeed=H}dispose(){if(this._meshesWithPoseMatrix.length=0,this.ZH().stopAnimation(this),this.ZH().removeSkeleton(this),this._parentContainer){const H=this._parentContainer.skeletons.indexOf(this);H>-1&&this._parentContainer.skeletons.splice(H,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const H={};H.name=this.name,H.id=this.id,this.dimensionsAtRest&&(H.dimensionsAtRest=this.dimensionsAtRest.Hg()),H.bones=[],H.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let J=0;J<this.bones.length;J++){var u;const O=this.bones[J],U=O.getParent(),h={parentBoneIndex:U?this.bones.indexOf(U):-1,index:O.getIndex(),name:O.name,id:O.id,matrix:O.getBindMatrix().Hg(),rest:O.getRestMatrix().Hg(),linkedTransformNodeId:null===(u=O.getTransformNode())||void 0===u?void 0:u.id};H.bones.push(h),O.length&&(h.length=O.length),O.metadata&&(h.metadata=O.metadata),O.animations&&O.animations.length>0&&(h.animation=O.animations[0].serialize()),H.ranges=[];for(const u in this._ranges){const J=this._ranges[u];if(!J)continue;const O={};O.name=u,O.from=J.from,O.to=J.to,H.ranges.push(O)}}return H}static Parse(H,u){const J=new a(H.name,H.id,u);let O;for(H.dimensionsAtRest&&(J.dimensionsAtRest=U.lu.Cu(H.dimensionsAtRest)),J.needInitialSkinMatrix=H.needInitialSkinMatrix,O=0;O<H.bones.length;O++){const u=H.bones[O],h=H.bones[O].index;let w=null;u.parentBoneIndex>-1&&(w=J.bones[u.parentBoneIndex]);const g=u.rest?U.Matrix.Cu(u.rest):null,B=new b.e(u.name,J,w,U.Matrix.Cu(u.matrix),g,null,h);void 0!==u.id&&null!==u.id&&(B.id=u.id),u.length&&(B.length=u.length),u.metadata&&(B.metadata=u.metadata),u.animation&&B.animations.push(P.e.Parse(u.animation)),void 0!==u.linkedTransformNodeId&&null!==u.linkedTransformNodeId&&(J._hasWaitingData=!0,B._waitingTransformNodeId=u.linkedTransformNodeId)}if(H.ranges)for(O=0;O<H.ranges.length;O++){const u=H.ranges[O];J.createAnimationRange(u.name,u.from,u.to)}return J}computeAbsoluteMatrices(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||H)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(H)}getPoseMatrix(){let H=null;return this._meshesWithPoseMatrix.length>0&&(H=this._meshesWithPoseMatrix[0].getPoseMatrix()),H}sortBones(){const H=[],u=new Array(this.bones.length);for(let J=0;J<this.bones.length;J++)this._sortBones(J,H,u);this.bones=H}_sortBones(H,u,J){if(J[H])return;J[H]=!0;const O=this.bones[H];if(!O)return;void 0===O._index&&(O._index=H);const U=O.getParent();U&&this._sortBones(this.bones.indexOf(U),u,J),u.push(O)}setCurrentPoseAsRest(){for(const H of this.bones)H.setCurrentPoseAsRest()}}var k=J(12651),C=J(12818),j=J(12321),M=J(12724),L=J(12410),Z=J(12776),Y=J(12741),F=J(12770),s=J(12866),A=J(12432),t=J(13909);class e{set areUpdatesFrozen(H){H?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new A.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,H||(H=l.e.LastCreatedScene),this._scene=H,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const H=this._scene.getEngine().getCaps();this._canUseTextureForTargets=H.canUseGLVertexID&&H.textureFloat&&H.maxVertexTextureImageUnits>0&&H.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return e.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?e.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(H){this._numMaxInfluencers!==H&&(this._numMaxInfluencers=H,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(H){this._useTextureToStoreTargets!==H&&(this._useTextureToStoreTargets=H,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var H;return e.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(H=this._scene)&&void 0!==H&&H.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(H){return this._activeTargets.data[H]}getTarget(H){return this._targets[H]}getTargetByName(H){for(const u of this._targets)if(u.name===H)return u;return null}addTarget(H){this._targets.push(H),this._targetInfluenceChangedObservers.push(H.onInfluenceChanged.add((H=>{this.areUpdatesFrozen&&H&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(H)}))),this._targetDataLayoutChangedObservers.push(H._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(H){const u=this._targets.indexOf(H);u>=0&&(this._targets.splice(u,1),H.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(u,1)[0]),H._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(u,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(H)}_bind(H){H.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),H.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),H.setTexture("morphTargets",this._targetStoreTexture),H.setInt("morphTargetCount",this.numInfluencers)}clone(){const H=new e(this._scene);for(const u of this._targets)H.addTarget(u.clone());return H.enablePositionMorphing=this.enablePositionMorphing,H.enableNormalMorphing=this.enableNormalMorphing,H.enableTangentMorphing=this.enableTangentMorphing,H.enableUVMorphing=this.enableUVMorphing,H.enableUV2Morphing=this.enableUV2Morphing,H.enableColorMorphing=this.enableColorMorphing,H}serialize(){const H={};H.id=this.uniqueId,H.targets=[];for(const u of this._targets)H.targets.push(u.serialize());return H}_syncActiveTargets(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const u=!!this._targetStoreTexture,J=this.isUsingTextureForTargets;(this._mustSynchronize||u!==J)&&(this._mustSynchronize=!1,this.synchronize());let O=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let U=-1;for(const h of this._targets)if(U++,0!==h.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=e.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(h),this._morphTargetTextureIndices[O]=U,this._tempInfluences[O++]=h.influence}this._morphTargetTextureIndices.length!==O&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,O)),this._influences&&this._influences.length===O||(this._influences=new Float32Array(O));for(let h=0;h<O;h++)this._influences[h]=this._tempInfluences[h];if(H&&this._scene)for(const h of this._scene.meshes)h.morphTargetManager===this&&(J?h._markSubMeshesAsAttributesDirty():h._syncGeometryWithMorphTargetManager())}synchronize(){var H;if(!this._scene||this.areUpdatesFrozen)return;const u=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(H=this._targetStoreTexture)||void 0===H||H.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>u.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const J of this._targets){this._supportsPositions=this._supportsPositions&&J.hasPositions,this._supportsNormals=this._supportsNormals&&J.hasNormals,this._supportsTangents=this._supportsTangents&&J.hasTangents,this._supportsUVs=this._supportsUVs&&J.hasUVs,this._supportsUV2s=this._supportsUV2s&&J.hasUV2s,this._supportsColors=this._supportsColors&&J.hasColors;const H=J.vertexCount;if(0===this._vertexCount)this._vertexCount=H;else if(this._vertexCount!==H)return void r.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${J.name}": ${H}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const H=u.getCaps().maxTextureSize;this._textureWidth>H&&(this._textureHeight=Math.ceil(this._textureWidth/H),this._textureWidth=H);const J=this._targets.length,O=new Float32Array(J*this._textureWidth*this._textureHeight*4);let U=0;for(let u=0;u<J;u++){const H=this._targets[u],J=H.getPositions(),h=H.getNormals(),w=H.getUVs(),g=H.getTangents(),B=H.getUV2s(),b=H.getColors();U=u*this._textureWidth*this._textureHeight*4;for(let u=0;u<this._vertexCount;u++)this._supportsPositions&&J&&(O[U]=J[3*u],O[U+1]=J[3*u+1],O[U+2]=J[3*u+2],U+=4),this._supportsNormals&&h&&(O[U]=h[3*u],O[U+1]=h[3*u+1],O[U+2]=h[3*u+2],U+=4),this._supportsUVs&&w&&(O[U]=w[2*u],O[U+1]=w[2*u+1],U+=4),this._supportsTangents&&g&&(O[U]=g[3*u],O[U+1]=g[3*u+1],O[U+2]=g[3*u+2],U+=4),this._supportsUV2s&&B&&(O[U]=B[2*u],O[U+1]=B[2*u+1],U+=4),this._supportsColors&&b&&(O[U]=b[4*u],O[U+1]=b[4*u+1],O[U+2]=b[4*u+2],O[U+3]=b[4*u+3],U+=4)}this._targetStoreTexture=t.d.CreateRGBATexture(O,this._textureWidth,this._textureHeight,J,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const J of this._scene.meshes)J.morphTargetManager===this&&J._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const H=this._parentContainer.morphTargetManagers.indexOf(this);H>-1&&this._parentContainer.morphTargetManagers.splice(H,1),this._parentContainer=null}for(const H of this._targets)this._scene.stopAnimation(H)}}static Parse(H,u){const J=new e(u);for(const O of H.targets)J.addTarget(s.c.Parse(O,u));return J}}e.EnableTextureStorage=!0,e.MaxActiveMorphTargetsInVertexAttributeMode=8,e.ConstantTargetCountForTextureMode=0;var c=J(13959),n=J(12210),V=J(12659);const T=new Map,R=T;function X(H,u,J){W(H)&&r.b.Warn(`Extension with the name '${H}' already exists`),T.set(H,{isGLTFExtension:u,factory:J})}function W(H){return T.delete(H)}var f=J(13973),i=J(12920),S=J(12425);class v{static Get(H,u,J){if(!u||void 0==J||!u[J])throw new Error(`${H}: Failed to find index (${J})`);return u[J]}static TryGet(H,u){return H&&void 0!=u&&H[u]?H[u]:null}static Assign(H){if(H)for(let u=0;u<H.length;u++)H[u].index=u}}function I(H){if(H.min&&H.max){const u=H.min,J=H.max,O=U.TmpVectors.lu[0].kg(u[0],u[1],u[2]),h=U.TmpVectors.lu[1].kg(J[0],J[1],J[2]);if(H.normalized&&5126!==H.componentType){let u=1;switch(H.componentType){case 5120:u=127;break;case 5121:u=255;break;case 5122:u=32767;break;case 5123:u=65535}const J=1/u;O.scaleInPlace(J),h.scaleInPlace(J)}return new V.d(O,h)}return null}class D{static RegisterExtension(H,u){X(H,!1,u)}static UnregisterExtension(H){return W(H)}get xh(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(H){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=H}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((H=>H.dispose&&H.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(H,u,J,O,U,h){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=u,this._assetContainer=J,this._loadData(O);let h=null;if(H){const u={};if(this._gltf.nodes)for(const H of this._gltf.nodes)H.name&&(u[H.name]=H.index);h=(H instanceof Array?H:[H]).map((H=>{const J=u[H];if(void 0===J)throw new Error(`Failed to find node '${H}'`);return J}))}return await this._loadAsync(U,w,h,(()=>({meshes:this._getMeshes(),pm:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=H,this._loadData(u),await this._loadAsync(J,U,null,(()=>{}))}async _loadAsync(H,u,J,O){return await Promise.resolve().then((async()=>{this._rootUrl=H,this._uniqueRootUrl=!H.startsWith("file:")&&u?H:`${H}${Date.now()}/`,this._fileName=u,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const U=`${c.i[c.i.LOADING]} => ${c.i[c.i.READY]}`,h=`${c.i[c.i.LOADING]} => ${c.i[c.i.COMPLETE]}`;this._parent._startPerformanceCounter(U),this._parent._startPerformanceCounter(h),this._parent._setState(c.i.LOADING),this._extensionsOnLoading();const g=new Array;if(!this.parent.loadOnlyMaterials)if(J)g.push(this.loadSceneAsync("/nodes",{nodes:J,index:-1}));else if(void 0!=this._gltf.pu||this._gltf.scenes&&this._gltf.scenes[0]){const H=v.Get("/scene",this._gltf.scenes,this._gltf.pu||0);g.push(this.loadSceneAsync(`/scenes/${H.index}`,H))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let H=0;H<this._gltf.materials.length;++H){const u=this._gltf.materials[H],J="/materials/"+H,O=k.b.TriangleFillMode;g.push(this._loadMaterialAsync(J,u,null,O,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&g.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&g.push(this._compileShadowGeneratorsAsync());const B=Promise.all(g).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.og(!0);for(const H of this._babylonScene.materials){const u=H;void 0!==u.maxSimultaneousLights&&(u.maxSimultaneousLights=Math.max(u.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(c.i.READY),this._skipStartAnimationStep||this._startAnimations(),O()}));return await B.then((H=>(this._parent._endPerformanceCounter(U),w.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(h),this._parent._setState(c.i.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(H=>{this._parent.onErrorObservable.notifyObservers(H),this._parent.onErrorObservable.clear(),this.dispose()}))})),H)))})).catch((H=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(H),this._parent.onErrorObservable.clear(),this.dispose()),H}))}_loadData(H){if(this._gltf=H.json,this._setupData(),H.bin){const u=this._gltf.buffers;if(u&&u[0]&&!u[0].uri){const J=u[0];(J.byteLength<H.bin.byteLength-3||J.byteLength>H.bin.byteLength)&&r.b.Warn(`Binary buffer length (${J.byteLength}) from JSON does not match chunk length (${H.bin.byteLength})`),this._bin=H.bin}else r.b.Warn("Unexpected BIN chunk")}}_setupData(){if(v.Assign(this._gltf.accessors),v.Assign(this._gltf.animations),v.Assign(this._gltf.buffers),v.Assign(this._gltf.bufferViews),v.Assign(this._gltf.cameras),v.Assign(this._gltf.images),v.Assign(this._gltf.materials),v.Assign(this._gltf.meshes),v.Assign(this._gltf.nodes),v.Assign(this._gltf.samplers),v.Assign(this._gltf.scenes),v.Assign(this._gltf.skins),v.Assign(this._gltf.textures),this._gltf.nodes){const H={};for(const J of this._gltf.nodes)if(J.children)for(const u of J.children)H[u]=J.index;const u=this._createRootNode();for(const J of this._gltf.nodes){const O=H[J.index];J.parent=void 0===O?u:this._gltf.nodes[O]}}}async _loadExtensionsAsync(){const H=[];if(R.forEach(((u,J)=>{var O;!1===(null===(O=this.parent.extensionOptions[J])||void 0===O?void 0:O.enabled)?u.isGLTFExtension&&this.isExtensionUsed(J)&&r.b.Warn(`Extension ${J} is used but has been explicitly disabled.`):u.isGLTFExtension&&!this.isExtensionUsed(J)||H.push((async()=>{const H=await u.factory(this);return H.name!==J&&r.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${H.name} !== ${J}`),this._parent.onExtensionLoadedObservable.notifyObservers(H),H})())})),this._extensions.push(...await Promise.all(H)),this._extensions.sort(((H,u)=>(H.order||Number.MAX_VALUE)-(u.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const J of this._gltf.extensionsRequired){if(!this._extensions.some((H=>H.name===J&&H.enabled))){var u;if(!1===(null===(u=this.parent.extensionOptions[J])||void 0===u?void 0:u.enabled))throw new Error(`Required extension ${J} is disabled`);throw new Error(`Required extension ${J} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new F.c("__root__",this._babylonScene);this._rootBabylonMesh=H,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.og(!1);const u={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case c.g.AUTO:this._babylonScene.useRightHandedSystem||(u.rotation=[0,1,0,0],u.scale=[1,1,-1],D._LoadTransform(u,this._rootBabylonMesh));break;case c.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(H),u}loadSceneAsync(H,u){const J=this._extensionsLoadSceneAsync(H,u);if(J)return J;const O=new Array;if(this.logOpen(`${H} ${u.name||""}`),u.nodes)for(const U of u.nodes){const u=v.Get(`${H}/nodes/${U}`,this._gltf.nodes,U);O.push(this.loadNodeAsync(`/nodes/${u.index}`,u,(H=>{H.parent=this._rootBabylonMesh})))}for(const U of this._postSceneLoadActions)U();return O.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(O).then((()=>{}))}_forEachPrimitive(H,u){if(H._primitiveBabylonMeshes)for(const J of H._primitiveBabylonMeshes)u(J)}_getGeometries(){const H=[],u=this._gltf.nodes;if(u)for(const J of u)this._forEachPrimitive(J,(u=>{const J=u.Gg;J&&-1===H.indexOf(J)&&H.push(J)}));return H}_getMeshes(){const H=[];this._rootBabylonMesh instanceof Y.c&&H.push(this._rootBabylonMesh);const u=this._gltf.nodes;if(u)for(const J of u)this._forEachPrimitive(J,(u=>{H.push(u)}));return H}_getTransformNodes(){const H=[],u=this._gltf.nodes;if(u)for(const J of u)J._babylonTransformNode&&"xg"===J._babylonTransformNode.getClassName()&&H.push(J._babylonTransformNode),J._babylonTransformNodeForSkin&&H.push(J._babylonTransformNodeForSkin);return H}_getSkeletons(){const H=[],u=this._gltf.skins;if(u)for(const J of u)J._data&&H.push(J._data.babylonSkeleton);return H}_getAnimationGroups(){const H=[],u=this._gltf.animations;if(u)for(const J of u)J._babylonAnimationGroup&&H.push(J._babylonAnimationGroup);return H}_startAnimations(){switch(this._parent.animationStartMode){case c.f.NONE:break;case c.f.FIRST:{const H=this._getAnimationGroups();0!==H.length&&H[0].start(!0);break}case c.f.ALL:{const H=this._getAnimationGroups();for(const u of H)u.start(!0);break}default:return void r.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const O=this._extensionsLoadNodeAsync(H,u,J);if(O)return O;if(u._babylonTransformNode)throw new Error(`${H}: Invalid recursive node hierarchy`);const U=new Array;this.logOpen(`${H} ${u.name||""}`);const h=O=>{if(D.AddPointerMetadata(O,H),D._LoadTransform(u,O),void 0!=u.camera){const J=v.Get(`${H}/camera`,this._gltf.cameras,u.camera);U.push(this.loadCameraAsync(`/cameras/${J.index}`,J,(H=>{H.parent=O,this._babylonScene.useRightHandedSystem||(O.Cg.x=-1)})))}if(u.children)for(const J of u.children){const u=v.Get(`${H}/children/${J}`,this._gltf.nodes,J);U.push(this.loadNodeAsync(`/nodes/${u.index}`,u,(H=>{H.parent=O})))}J(O)},w=void 0!=u.mesh,g=this._parent.loadSkins&&void 0!=u.skin;if(!w||g){const H=u.name||`node${u.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const J=new M.c(H,this._babylonScene);J._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==u.mesh?u._babylonTransformNode=J:u._babylonTransformNodeForSkin=J,h(J)}if(w)if(g){const J=v.Get(`${H}/mesh`,this._gltf.meshes,u.mesh);U.push(this._loadMeshAsync(`/meshes/${J.index}`,u,J,(J=>{const O=u._babylonTransformNodeForSkin;J.metadata=(0,i.e)(O.metadata,J.metadata||{});const h=v.Get(`${H}/skin`,this._gltf.skins,u.skin);U.push(this._loadSkinAsync(`/skins/${h.index}`,u,h,(H=>{this._forEachPrimitive(u,(u=>{u.skeleton=H})),this._postSceneLoadActions.push((()=>{if(void 0!=h.skeleton){const H=v.Get(`/skins/${h.index}/skeleton`,this._gltf.nodes,h.skeleton).parent;u.index===H.index?J.parent=O.parent:J.parent=H._babylonTransformNode}else J.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:O,skinnedNode:J})}))})))})))}else{const J=v.Get(`${H}/mesh`,this._gltf.meshes,u.mesh);U.push(this._loadMeshAsync(`/meshes/${J.index}`,u,J,h))}return this.logClose(),Promise.all(U).then((()=>(this._forEachPrimitive(u,(H=>{const u=H;!u.isAnInstance&&u.Gg&&u.Gg.useBoundingInfoFromGeometry?H.VH():H.refreshBoundingInfo(!0,!0)})),u._babylonTransformNode)))}_loadMeshAsync(H,u,J,O){const U=J.primitives;if(!U||!U.length)throw new Error(`${H}: Primitives are missing`);void 0==U[0].index&&v.Assign(U);const h=new Array;this.logOpen(`${H} ${J.name||""}`);const w=u.name||`node${u.index}`;if(1===U.length){const O=J.primitives[0];h.push(this._loadMeshPrimitiveAsync(`${H}/primitives/${O.index}`,w,u,J,O,(H=>{u._babylonTransformNode=H,u._primitiveBabylonMeshes=[H]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,u._babylonTransformNode=new M.c(w,this._babylonScene),u._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u._primitiveBabylonMeshes=[];for(const O of U)h.push(this._loadMeshPrimitiveAsync(`${H}/primitives/${O.index}`,`${w}_primitive${O.index}`,u,J,O,(H=>{H.parent=u._babylonTransformNode,u._primitiveBabylonMeshes.push(H)})))}return O(u._babylonTransformNode),this.logClose(),Promise.all(h).then((()=>u._babylonTransformNode))}_loadMeshPrimitiveAsync(H,u,J,O,U,h){const w=this._extensionsLoadMeshPrimitiveAsync(H,u,J,O,U,h);if(w)return w;this.logOpen(`${H}`);const g=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==J.skin&&!O.primitives[0].targets;let B,b;if(g&&U._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,B=U._instanceData.babylonSourceMesh.createInstance(u),B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b=U._instanceData.promise;else{const h=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new F.c(u,this._babylonScene);w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w.sideOrientation=this._babylonScene.useRightHandedSystem?k.b.CounterClockWiseSideOrientation:k.b.ClockWiseSideOrientation,this._createMorphTargets(H,J,O,U,w),h.push(this._loadVertexDataAsync(H,U,w).then((async u=>await this._loadMorphTargetsAsync(H,U,w,u).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,u.cH(w),u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const d=D._GetDrawMode(H,U.mode);if(void 0==U.material){let H=this._defaultBabylonMaterialData[d];H||(H=this._createDefaultMaterial("__GLTFLoader._default",d),this._parent.onMaterialLoadedObservable.notifyObservers(H),this._defaultBabylonMaterialData[d]=H),w.material=H}else if(!this.parent.skipMaterials){const u=v.Get(`${H}/material`,this._gltf.materials,U.material);h.push(this._loadMaterialAsync(`/materials/${u.index}`,u,w,d,(H=>{w.material=H})))}b=Promise.all(h),g&&(U._instanceData={babylonSourceMesh:w,promise:b}),B=w}return D.AddPointerMetadata(B,H),this._parent.onMeshLoadedObservable.notifyObservers(B),h(B),this.logClose(),b.then((()=>B))}_loadVertexDataAsync(H,u,J){const O=this._extensionsLoadVertexDataAsync(H,u,J);if(O)return O;const U=u.attributes;if(!U)throw new Error(`${H}: Attributes are missing`);const h=new Array,w=new Z.b(J.name,this._babylonScene);if(void 0==u.indices)J.isUnIndexed=!0;else{const J=v.Get(`${H}/indices`,this._gltf.accessors,u.indices);h.push(this._loadIndicesAccessorAsync(`/accessors/${J.index}`,J).then((H=>{w.setIndices(H)})))}const g=(u,O,g)=>{if(void 0==U[u])return;J._delayInfo=J._delayInfo||[],-1===J._delayInfo.indexOf(O)&&J._delayInfo.push(O);const B=v.Get(`${H}/attributes/${u}`,this._gltf.accessors,U[u]);h.push(this._loadVertexAccessorAsync(`/accessors/${B.index}`,B,O).then((H=>{if(H.getKind()===L.d.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!J.skeleton){const H=I(B);H&&(w._boundingInfo=H,w.useBoundingInfoFromGeometry=!0)}w.setVerticesBuffer(H,B.count)}))),O==L.d.MatricesIndicesExtraKind&&(J.numBoneInfluencers=8),g&&g(B)};return g("POSITION",L.d.PositionKind),g("NORMAL",L.d.NormalKind),g("TANGENT",L.d.TangentKind),g("TEXCOORD_0",L.d.UVKind),g("TEXCOORD_1",L.d.UV2Kind),g("TEXCOORD_2",L.d.UV3Kind),g("TEXCOORD_3",L.d.UV4Kind),g("TEXCOORD_4",L.d.UV5Kind),g("TEXCOORD_5",L.d.UV6Kind),g("JOINTS_0",L.d.MatricesIndicesKind),g("WEIGHTS_0",L.d.MatricesWeightsKind),g("JOINTS_1",L.d.MatricesIndicesExtraKind),g("WEIGHTS_1",L.d.MatricesWeightsExtraKind),g("COLOR_0",L.d.ColorKind,(H=>{"VEC4"===H.type&&(J.hasVertexAlpha=!0)})),Promise.all(h).then((()=>w))}_createMorphTargets(H,u,J,O,U){if(!O.targets||!this._parent.loadMorphTargets)return;if(void 0==u._numMorphTargets)u._numMorphTargets=O.targets.length;else if(O.targets.length!==u._numMorphTargets)throw new Error(`${H}: Primitives do not have the same number of targets`);const h=J.extras?J.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,U.morphTargetManager=new e(this._babylonScene),U.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.morphTargetManager.areUpdatesFrozen=!0;for(let w=0;w<O.targets.length;w++){const H=u.weights?u.weights[w]:J.weights?J.weights[w]:0,O=h?h[w]:`morphTarget${w}`;U.morphTargetManager.addTarget(new s.c(O,H,U.ZH()))}}_loadMorphTargetsAsync(H,u,J,O){if(!u.targets||!this._parent.loadMorphTargets)return Promise.resolve();const U=new Array,h=J.morphTargetManager;for(let w=0;w<h.numTargets;w++){const J=h.getTarget(w);U.push(this._loadMorphTargetVertexDataAsync(`${H}/targets/${w}`,O,u.targets[w],J))}return Promise.all(U).then((()=>{h.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(H,u,J,O){const U=new Array,h=(O,h,w)=>{if(void 0==J[O])return;const g=u.getVertexBuffer(h);if(!g)return;const B=v.Get(`${H}/${O}`,this._gltf.accessors,J[O]);U.push(this._loadFloatAccessorAsync(`/accessors/${B.index}`,B).then((H=>{w(g,H)})))};return h("POSITION",L.d.PositionKind,((H,u)=>{const J=new Float32Array(u.length);H.forEach(u.length,((H,O)=>{J[O]=u[O]+H})),O.setPositions(J)})),h("NORMAL",L.d.NormalKind,((H,u)=>{const J=new Float32Array(u.length);H.forEach(J.length,((H,O)=>{J[O]=u[O]+H})),O.setNormals(J)})),h("TANGENT",L.d.TangentKind,((H,u)=>{const J=new Float32Array(u.length/3*4);let U=0;H.forEach(u.length/3*4,((H,O)=>{(O+1)%4!==0&&(J[U]=u[U]+H,U++)})),O.setTangents(J)})),h("TEXCOORD_0",L.d.UVKind,((H,u)=>{const J=new Float32Array(u.length);H.forEach(u.length,((H,O)=>{J[O]=u[O]+H})),O.setUVs(J)})),h("TEXCOORD_1",L.d.UV2Kind,((H,u)=>{const J=new Float32Array(u.length);H.forEach(u.length,((H,O)=>{J[O]=u[O]+H})),O.setUV2s(J)})),h("COLOR_0",L.d.ColorKind,((u,J)=>{let U=null;const h=u.getSize();if(3===h){U=new Float32Array(J.length/3*4),u.forEach(J.length,((H,u)=>{const O=Math.floor(u/3),h=u%3;U[4*O+h]=J[3*O+h]+H}));for(let H=0;H<J.length/3;++H)U[4*H+3]=1}else{if(4!==h)throw new Error(`${H}: Invalid number of components (${h}) for COLOR_0 attribute`);U=new Float32Array(J.length),u.forEach(J.length,((H,u)=>{U[u]=J[u]+H}))}O.setColors(U)})),await Promise.all(U).then((()=>{}))}static _LoadTransform(H,u){if(void 0!=H.skin)return;let J=U.lu.Zero(),O=U.Quaternion.Identity(),h=U.lu.One();if(H.matrix){U.Matrix.Cu(H.matrix).decompose(h,O,J)}else H.translation&&(J=U.lu.Cu(H.translation)),H.rotation&&(O=U.Quaternion.Cu(H.rotation)),H.scale&&(h=U.lu.Cu(H.scale));u.position=J,u.rotationQuaternion=O,u.Cg=h}_loadSkinAsync(H,u,J,O){if(!this._parent.loadSkins)return Promise.resolve();const U=this._extensionsLoadSkinAsync(H,u,J);if(U)return U;if(J._data)return O(J._data.babylonSkeleton),J._data.promise;const h=`skeleton${J.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new a(J.name||h,h,this._babylonScene);w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(H,J,w);const g=this._loadSkinInverseBindMatricesDataAsync(H,J).then((H=>{this._updateBoneMatrices(w,H)}));return J._data={babylonSkeleton:w,promise:g},O(w),g}_loadBones(H,u,J){if(void 0==u.skeleton||this._parent.alwaysComputeSkeletonRootNode){const J=this._findSkeletonRootNode(`${H}/joints`,u.joints);if(J)if(void 0===u.skeleton)u.skeleton=J.index;else{const O=(H,u)=>{for(;u.parent;u=u.parent)if(u.parent===H)return!0;return!1},U=v.Get(`${H}/skeleton`,this._gltf.nodes,u.skeleton);U===J||O(U,J)||(r.b.Warn(`${H}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),u.skeleton=J.index)}else r.b.Warn(`${H}: Failed to find common root`)}const O={};for(const U of u.joints){const h=v.Get(`${H}/joints/${U}`,this._gltf.nodes,U);this._loadBone(h,u,J,O)}}_findSkeletonRootNode(H,u){if(0===u.length)return null;const J={};for(const U of u){const u=[];let O=v.Get(`${H}/${U}`,this._gltf.nodes,U);for(;-1!==O.index;)u.unshift(O),O=O.parent;J[U]=u}let O=null;for(let U=0;;++U){let H=J[u[0]];if(U>=H.length)return O;const h=H[U];for(let w=1;w<u.length;++w)if(H=J[u[w]],U>=H.length||h!==H[U])return O;O=h}}_loadBone(H,u,J,O){H._isJoint=!0;let U=O[H.index];if(U)return U;let h=null;H.index!==u.skeleton&&(H.parent&&-1!==H.parent.index?h=this._loadBone(H.parent,u,J,O):void 0!==u.skeleton&&r.b.Warn(`/skins/${u.index}/skeleton: Skeleton node is not a common root`));const w=u.joints.indexOf(H.index);return U=new b.e(H.name||`joint${H.index}`,J,h,this._getNodeMatrix(H),null,null,w),O[H.index]=U,this._postSceneLoadActions.push((()=>{U.linkTransformNode(H._babylonTransformNode)})),U}_loadSkinInverseBindMatricesDataAsync(H,u){if(void 0==u.inverseBindMatrices)return Promise.resolve(null);const J=v.Get(`${H}/inverseBindMatrices`,this._gltf.accessors,u.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${J.index}`,J)}_updateBoneMatrices(H,u){for(const J of H.bones){const H=U.Matrix.Identity(),O=J._index;u&&-1!==O&&(U.Matrix.FromArrayToRef(u,16*O,H),H.invertToRef(H));const h=J.getParent();h&&H.multiplyToRef(h.getAbsoluteInverseBindMatrix(),H),J.wg(H,!1,!1),J._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(H){return H.matrix?U.Matrix.Cu(H.matrix):U.Matrix.Compose(H.scale?U.lu.Cu(H.scale):U.lu.One(),H.rotation?U.Quaternion.Cu(H.rotation):U.Quaternion.Identity(),H.translation?U.lu.Cu(H.translation):U.lu.Zero())}loadCameraAsync(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const O=this._extensionsLoadCameraAsync(H,u,J);if(O)return O;const h=new Array;this.logOpen(`${H} ${u.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new B.b(u.name||`camera${u.index}`,U.lu.Zero(),this._babylonScene,!1);switch(w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u._babylonCamera=w,w.setTarget(new U.lu(0,0,-1)),u.type){case"perspective":{const J=u.perspective;if(!J)throw new Error(`${H}: Camera perspective properties are missing`);w.fov=J.yfov,w.Ug=J.znear,w.maxZ=J.zfar||0;break}case"orthographic":if(!u.orthographic)throw new Error(`${H}: Camera orthographic properties are missing`);w.mode=g.c.ORTHOGRAPHIC_CAMERA,w.orthoLeft=-u.orthographic.xmag,w.orthoRight=u.orthographic.xmag,w.orthoBottom=-u.orthographic.ymag,w.orthoTop=u.orthographic.ymag,w.Ug=u.orthographic.znear,w.maxZ=u.orthographic.zfar;break;default:throw new Error(`${H}: Invalid camera type (${u.type})`)}return D.AddPointerMetadata(w,H),this._parent.onCameraLoadedObservable.notifyObservers(w),J(w),this.logClose(),Promise.all(h).then((()=>w))}_loadAnimationsAsync(){const H=this._gltf.animations;if(!H)return Promise.resolve();const u=new Array;for(let J=0;J<H.length;J++){const O=H[J];u.push(this.loadAnimationAsync(`/animations/${O.index}`,O).then((H=>{0===H.targetedAnimations.length&&H.dispose()})))}return Promise.all(u).then((()=>{}))}loadAnimationAsync(H,u){const O=this._extensionsLoadAnimationAsync(H,u);return O||J.e(78).then(J.bind(J,15449)).then((J=>{let{AnimationGroup:O}=J;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new O(u.name||`animation${u.index}`,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u._babylonAnimationGroup=U;const h=new Array;v.Assign(u.channels),v.Assign(u.samplers);for(const w of u.channels)h.push(this._loadAnimationChannelAsync(`${H}/channels/${w.index}`,H,u,w,((H,u)=>{H.animations=H.animations||[],H.animations.push(u),U.addTargetedAnimation(u,H)})));return Promise.all(h).then((()=>(U.normalize(0),U)))}))}async _loadAnimationChannelAsync(H,u,O,U,h){const w=this._extensionsLoadAnimationChannelAsync(H,u,O,U,h);if(w)return await w;if(void 0==U.target.node)return await Promise.resolve();const g=v.Get(`${H}/target/node`,this._gltf.nodes,U.target.node),B=U.target.path,b="weights"===B;if(b&&!g._numMorphTargets||!b&&!g._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!b&&!g._isJoint)return await Promise.resolve();let d;switch(await Promise.resolve().then(J.bind(J,13979)),B){case"translation":var G;d=null===(G=(0,f.g)("/nodes/{}/translation"))||void 0===G?void 0:G.interpolation;break;case"rotation":var P;d=null===(P=(0,f.g)("/nodes/{}/rotation"))||void 0===P?void 0:P.interpolation;break;case"scale":var mH;d=null===(mH=(0,f.g)("/nodes/{}/scale"))||void 0===mH?void 0:mH.interpolation;break;case"weights":var l;d=null===(l=(0,f.g)("/nodes/{}/weights"))||void 0===l?void 0:l.interpolation;break;default:throw new Error(`${H}/target/path: Invalid value (${U.target.path})`)}if(!d)throw new Error(`${H}/target/path: Could not find interpolation properties for target path (${U.target.path})`);const r={object:g,info:d};return await this._loadAnimationChannelFromTargetInfoAsync(H,u,O,U,r,h)}_loadAnimationChannelFromTargetInfoAsync(H,u,J,O,U,h){const w=this.parent.targetFps,g=1/w,B=v.Get(`${H}/sampler`,J.samplers,O.sampler);return this._loadAnimationSamplerAsync(`${u}/samplers/${O.sampler}`,B).then((H=>{let u=0;const B=U.object,b=U.info;for(const U of b){const b=U.getStride(B),d=H.input,G=H.output,P=new Array(d.length);let mH=0;switch(H.interpolation){case"STEP":for(let H=0;H<d.length;H++){const u=U.getValue(B,G,mH,1);mH+=b,P[H]={frame:d[H]*w,value:u,interpolation:1}}break;case"CUBICSPLINE":for(let H=0;H<d.length;H++){const u=U.getValue(B,G,mH,g);mH+=b;const J=U.getValue(B,G,mH,1);mH+=b;const O=U.getValue(B,G,mH,g);mH+=b,P[H]={frame:d[H]*w,inTangent:u,value:J,outTangent:O}}break;case"LINEAR":for(let H=0;H<d.length;H++){const u=U.getValue(B,G,mH,1);mH+=b,P[H]={frame:d[H]*w,value:u}}}if(mH>0){const H=`${J.name||`animation${J.index}`}_channel${O.index}_${u}`,g=U.buildAnimations(B,H,w,P);for(const J of g)u++,h(J.babylonAnimatable,J.babylonAnimation)}}}))}_loadAnimationSamplerAsync(H,u){if(u._data)return u._data;const J=u.interpolation||"LINEAR";switch(J){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${H}/interpolation: Invalid value (${u.interpolation})`)}const O=v.Get(`${H}/input`,this._gltf.accessors,u.input),U=v.Get(`${H}/output`,this._gltf.accessors,u.output);return u._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${O.index}`,O),this._loadFloatAccessorAsync(`/accessors/${U.index}`,U)]).then((H=>{let[u,O]=H;return{input:u,interpolation:J,output:O}})),u._data}loadBufferAsync(H,u,J,O){const U=this._extensionsLoadBufferAsync(H,u,J,O);if(U)return U;if(!u._data)if(u.uri)u._data=this.loadUriAsync(`${H}/uri`,u,u.uri);else{if(!this._bin)throw new Error(`${H}: Uri is missing or the binary glTF is missing its binary chunk`);u._data=this._bin.readAsync(0,u.byteLength)}return u._data.then((u=>{try{return new Uint8Array(u.buffer,u.byteOffset+J,O)}catch(U){throw new Error(`${H}: ${U.message}`)}}))}loadBufferViewAsync(H,u){const J=this._extensionsLoadBufferViewAsync(H,u);if(J)return J;if(u._data)return u._data;const O=v.Get(`${H}/buffer`,this._gltf.buffers,u.buffer);return u._data=this.loadBufferAsync(`/buffers/${O.index}`,O,u.byteOffset||0,u.byteLength),u._data}_loadAccessorAsync(H,u,J){if(u._data)return u._data;const O=D._GetNumComponents(H,u.type),U=O*L.d.GetTypeByteLength(u.componentType),h=O*u.count;if(void 0==u.bufferView)u._data=Promise.resolve(new J(h));else{const w=v.Get(`${H}/bufferView`,this._gltf.bufferViews,u.bufferView);u._data=this.loadBufferViewAsync(`/bufferViews/${w.index}`,w).then((g=>{if(5126!==u.componentType||u.normalized||w.byteStride&&w.byteStride!==U){const H=new J(h);return L.d.ForEach(g,u.byteOffset||0,w.byteStride||U,O,u.componentType,H.length,u.normalized||!1,((u,J)=>{H[J]=u})),H}return D._GetTypedArray(H,u.componentType,g,u.byteOffset,h)}))}if(u.sparse){const h=u.sparse;u._data=u._data.then((w=>{const g=w,B=v.Get(`${H}/sparse/indices/bufferView`,this._gltf.bufferViews,h.indices.bufferView),b=v.Get(`${H}/sparse/values/bufferView`,this._gltf.bufferViews,h.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${B.index}`,B),this.loadBufferViewAsync(`/bufferViews/${b.index}`,b)]).then((w=>{let[B,b]=w;const d=D._GetTypedArray(`${H}/sparse/indices`,h.indices.componentType,B,h.indices.byteOffset,h.count),G=O*h.count;let P;if(5126!==u.componentType||u.normalized){const w=D._GetTypedArray(`${H}/sparse/values`,u.componentType,b,h.values.byteOffset,G);P=new J(G),L.d.ForEach(w,0,U,O,u.componentType,P.length,u.normalized||!1,((H,u)=>{P[u]=H}))}else P=D._GetTypedArray(`${H}/sparse/values`,u.componentType,b,h.values.byteOffset,G);let mH=0;for(let H=0;H<d.length;H++){let u=d[H]*O;for(let H=0;H<O;H++)g[u++]=P[mH++]}return g}))}))}return u._data}_loadFloatAccessorAsync(H,u){return this._loadAccessorAsync(H,u,Float32Array)}_loadIndicesAccessorAsync(H,u){if("SCALAR"!==u.type)throw new Error(`${H}/type: Invalid value ${u.type}`);if(5121!==u.componentType&&5123!==u.componentType&&5125!==u.componentType)throw new Error(`${H}/componentType: Invalid value ${u.componentType}`);if(u._data)return u._data;if(u.sparse){const J=D._GetTypedArrayConstructor(`${H}/componentType`,u.componentType);u._data=this._loadAccessorAsync(H,u,J)}else{const J=v.Get(`${H}/bufferView`,this._gltf.bufferViews,u.bufferView);u._data=this.loadBufferViewAsync(`/bufferViews/${J.index}`,J).then((J=>D._GetTypedArray(H,u.componentType,J,u.byteOffset,u.count)))}return u._data}_loadVertexBufferViewAsync(H){if(H._babylonBuffer)return H._babylonBuffer;const u=this._babylonScene.getEngine();return H._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((H=>new L.b(u,H,!1))),H._babylonBuffer}_loadVertexAccessorAsync(H,u,J){var O;if(null!==(O=u._babylonVertexBuffer)&&void 0!==O&&O[J])return u._babylonVertexBuffer[J];u._babylonVertexBuffer||(u._babylonVertexBuffer={});const U=this._babylonScene.getEngine();if(u.sparse||void 0==u.bufferView)u._babylonVertexBuffer[J]=this._loadFloatAccessorAsync(H,u).then((H=>new L.d(U,H,J,!1)));else{const O=v.Get(`${H}/bufferView`,this._gltf.bufferViews,u.bufferView);u._babylonVertexBuffer[J]=this._loadVertexBufferViewAsync(O).then((h=>{const w=D._GetNumComponents(H,u.type);return new L.d(U,h,J,!1,void 0,O.byteStride,void 0,u.byteOffset,w,u.componentType,u.normalized,!0,void 0,!0)}))}return u._babylonVertexBuffer[J]}_loadMaterialMetallicRoughnessPropertiesAsync(H,u,J){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);const O=new Array;return u&&(u.baseColorFactor?(J.albedoColor=h.ku.Cu(u.baseColorFactor),J.alpha=u.baseColorFactor[3]):J.albedoColor=h.ku.White(),J.metallic=void 0==u.metallicFactor?1:u.metallicFactor,J.roughness=void 0==u.roughnessFactor?1:u.roughnessFactor,u.baseColorTexture&&O.push(this.loadTextureInfoAsync(`${H}/baseColorTexture`,u.baseColorTexture,(H=>{H.name=`${J.name} (Base Color)`,J.albedoTexture=H}))),u.metallicRoughnessTexture&&(u.metallicRoughnessTexture.nonColorData=!0,O.push(this.loadTextureInfoAsync(`${H}/metallicRoughnessTexture`,u.metallicRoughnessTexture,(H=>{H.name=`${J.name} (Metallic Roughness)`,J.metallicTexture=H}))),J.useMetallnessFromMetallicTextureBlue=!0,J.useRoughnessFromMetallicTextureGreen=!0,J.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(O).then((()=>{}))}_loadMaterialAsync(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const h=this._extensionsLoadMaterialAsync(H,u,J,O,U);if(h)return h;u._data=u._data||{};let w=u._data[O];if(!w){this.logOpen(`${H} ${u.name||""}`);const J=this.createMaterial(H,u,O);w={babylonMaterial:J,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(H,u,J)},u._data[O]=w,D.AddPointerMetadata(J,H),this._parent.onMaterialLoadedObservable.notifyObservers(J),this.logClose()}return J&&(w.babylonMeshes.push(J),J.nh.addOnce((()=>{const H=w.babylonMeshes.indexOf(J);-1!==H&&w.babylonMeshes.splice(H,1)}))),U(w.babylonMaterial),w.promise.then((()=>w.babylonMaterial))}_createDefaultMaterial(H,u){this._babylonScene._blockEntityCollection=!!this._assetContainer;const J=new C.b(H,this._babylonScene);return J._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J.fillMode=u,J.enableSpecularAntiAliasing=!0,J.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,J.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,J.transparencyMode=C.b.PBRMATERIAL_OPAQUE,J.metallic=1,J.roughness=1,J}createMaterial(H,u,J){const O=this._extensionsCreateMaterial(H,u,J);if(O)return O;const U=u.name||`material${u.index}`;return this._createDefaultMaterial(U,J)}loadMaterialPropertiesAsync(H,u,J){const O=this._extensionsLoadMaterialPropertiesAsync(H,u,J);if(O)return O;const U=new Array;return U.push(this.loadMaterialBasePropertiesAsync(H,u,J)),u.pbrMetallicRoughness&&U.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${H}/pbrMetallicRoughness`,u.pbrMetallicRoughness,J)),this.loadMaterialAlphaProperties(H,u,J),Promise.all(U).then((()=>{}))}loadMaterialBasePropertiesAsync(H,u,J){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);const O=new Array;return J.emissiveColor=u.emissiveFactor?h.ku.Cu(u.emissiveFactor):new h.ku(0,0,0),u.doubleSided&&(J.ag=!1,J.twoSidedLighting=!0),u.normalTexture&&(u.normalTexture.nonColorData=!0,O.push(this.loadTextureInfoAsync(`${H}/normalTexture`,u.normalTexture,(H=>{H.name=`${J.name} (Normal)`,J.bumpTexture=H}))),J.invertNormalMapX=!this._babylonScene.useRightHandedSystem,J.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=u.normalTexture.scale&&J.bumpTexture&&(J.bumpTexture.level=u.normalTexture.scale),J.forceIrradianceInFragment=!0),u.occlusionTexture&&(u.occlusionTexture.nonColorData=!0,O.push(this.loadTextureInfoAsync(`${H}/occlusionTexture`,u.occlusionTexture,(H=>{H.name=`${J.name} (Occlusion)`,J.ambientTexture=H}))),J.useAmbientInGrayScale=!0,void 0!=u.occlusionTexture.strength&&(J.ambientTextureStrength=u.occlusionTexture.strength)),u.emissiveTexture&&O.push(this.loadTextureInfoAsync(`${H}/emissiveTexture`,u.emissiveTexture,(H=>{H.name=`${J.name} (Emissive)`,J.emissiveTexture=H}))),Promise.all(O).then((()=>{}))}loadMaterialAlphaProperties(H,u,J){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);switch(u.alphaMode||"OPAQUE"){case"OPAQUE":J.transparencyMode=C.b.PBRMATERIAL_OPAQUE,J.alpha=1;break;case"MASK":J.transparencyMode=C.b.PBRMATERIAL_ALPHATEST,J.alphaCutOff=void 0==u.alphaCutoff?.5:u.alphaCutoff,J.albedoTexture&&(J.albedoTexture.Og=!0);break;case"BLEND":J.transparencyMode=C.b.PBRMATERIAL_ALPHABLEND,J.albedoTexture&&(J.albedoTexture.Og=!0,J.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${H}/alphaMode: Invalid value (${u.alphaMode})`)}}loadTextureInfoAsync(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const O=this._extensionsLoadTextureInfoAsync(H,u,J);if(O)return O;if(this.logOpen(`${H}`),u.texCoord>=6)throw new Error(`${H}/texCoord: Invalid value (${u.texCoord})`);const U=v.Get(`${H}/index`,this._gltf.textures,u.index);U._textureInfo=u;const h=this._loadTextureAsync(`/textures/${u.index}`,U,(O=>{O.coordinatesIndex=u.texCoord||0,D.AddPointerMetadata(O,H),this._parent.onTextureLoadedObservable.notifyObservers(O),J(O)}));return this.logClose(),h}_loadTextureAsync(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const O=this._extensionsLoadTextureAsync(H,u,J);if(O)return O;this.logOpen(`${H} ${u.name||""}`);const U=void 0==u.sampler?D.DefaultSampler:v.Get(`${H}/sampler`,this._gltf.samplers,u.sampler),h=v.Get(`${H}/source`,this._gltf.images,u.source),w=this._createTextureAsync(H,U,h,J,void 0,!u._textureInfo.nonColorData);return this.logClose(),w}_createTextureAsync(H,u,J){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},h=arguments.length>4?arguments[4]:void 0,w=arguments.length>5?arguments[5]:void 0;const g=this._loadSampler(`/samplers/${u.index}`,u),B=new Array,b=new O;this._babylonScene._blockEntityCollection=!!this._assetContainer;const d={noMipmap:g.noMipMaps,invertY:!1,samplingMode:g.samplingMode,K:()=>{this._disposed||b.resolve()},onError:(u,J)=>{this._disposed||b.reject(new Error(`${H}: ${J&&J.message?J.message:u||"Failed to load texture"}`))},mimeType:J.mimeType??(0,n.h)(J.uri??""),loaderOptions:h,useSRGBBuffer:!!w&&this._parent.useSRGBBuffers},G=new j.b(null,this._babylonScene,d);return G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.push(b.promise),B.push(this.loadImageAsync(`/images/${J.index}`,J).then((H=>{const u=J.uri||`${this._fileName}#image${J.index}`,O=`data:${this._uniqueRootUrl}${u}`;G.updateURL(O,H);const U=G.getInternalTexture();U&&(U.label=J.name)}))),G.wrapU=g.wrapU,G.wrapV=g.wrapV,U(G),this._parent.useGltfTextureNames&&(G.name=J.name||J.uri||`image${J.index}`),Promise.all(B).then((()=>G))}_loadSampler(H,u){return u._data||(u._data={noMipMaps:9728===u.minFilter||9729===u.minFilter,samplingMode:D._GetTextureSamplingMode(H,u),wrapU:D._GetTextureWrapMode(`${H}/wrapS`,u.wrapS),wrapV:D._GetTextureWrapMode(`${H}/wrapT`,u.wrapT)}),u._data}loadImageAsync(H,u){if(!u._data){if(this.logOpen(`${H} ${u.name||""}`),u.uri)u._data=this.loadUriAsync(`${H}/uri`,u,u.uri);else{const J=v.Get(`${H}/bufferView`,this._gltf.bufferViews,u.bufferView);u._data=this.loadBufferViewAsync(`/bufferViews/${J.index}`,J)}this.logClose()}return u._data}loadUriAsync(H,u,J){const O=this._extensionsLoadUriAsync(H,u,J);if(O)return O;if(!D._ValidateUri(J))throw new Error(`${H}: '${J}' is invalid`);if((0,n.j)(J)){const u=new Uint8Array((0,n.c)(J));return this.log(`${H}: Decoded ${J.substring(0,64)}... (${u.length} bytes)`),Promise.resolve(u)}return this.log(`${H}: Loading ${J}`),this._parent.preprocessUrlAsync(this._rootUrl+J).then((u=>new Promise(((O,U)=>{this._parent._loadFile(this._babylonScene,u,(u=>{this._disposed||(this.log(`${H}: Loaded ${J} (${u.byteLength} bytes)`),O(new Uint8Array(u)))}),!0,(u=>{U(new n.k(`${H}: Failed to load '${J}'${u?": "+u.status+" "+u.statusText:""}`,u))}))}))))}static AddPointerMetadata(H,u){H.metadata=H.metadata||{};const J=H._internalMetadata=H._internalMetadata||{},O=J.xh=J.xh||{};(O.pointers=O.pointers||[]).push(u)}static _GetTextureWrapMode(H,u){switch(u=void 0==u?10497:u){case 33071:return j.b.CLAMP_ADDRESSMODE;case 33648:return j.b.MIRROR_ADDRESSMODE;case 10497:return j.b.WRAP_ADDRESSMODE;default:return r.b.Warn(`${H}: Invalid value (${u})`),j.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(H,u){const J=void 0==u.magFilter?9729:u.magFilter,O=void 0==u.minFilter?9987:u.minFilter;if(9729===J)switch(O){case 9728:return j.b.LINEAR_NEAREST;case 9729:return j.b.LINEAR_LINEAR;case 9984:return j.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return j.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return j.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return j.b.LINEAR_LINEAR_MIPLINEAR;default:return r.b.Warn(`${H}/minFilter: Invalid value (${O})`),j.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==J&&r.b.Warn(`${H}/magFilter: Invalid value (${J})`),O){case 9728:return j.b.NEAREST_NEAREST;case 9729:return j.b.NEAREST_LINEAR;case 9984:return j.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return j.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return j.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return j.b.NEAREST_LINEAR_MIPLINEAR;default:return r.b.Warn(`${H}/minFilter: Invalid value (${O})`),j.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(H,u){try{return(0,S.r)(u)}catch(J){throw new Error(`${H}: ${J.message}`)}}static _GetTypedArray(H,u,J,O,U){const h=J.buffer;O=J.byteOffset+(O||0);const w=D._GetTypedArrayConstructor(`${H}/componentType`,u),g=L.d.GetTypeByteLength(u);return O%g!==0?(r.b.Warn(`${H}: Copying buffer as byte offset (${O}) is not a multiple of component type byte length (${g})`),new w(h.slice(O,O+U*g),0)):new w(h,O,U)}static _GetNumComponents(H,u){switch(u){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${H}: Invalid type (${u})`)}static _ValidateUri(H){return w.Tools.IsBase64(H)||-1===H.indexOf("..")}static _GetDrawMode(H,u){switch(void 0==u&&(u=4),u){case 0:return k.b.PointListDrawMode;case 1:return k.b.LineListDrawMode;case 2:return k.b.LineLoopDrawMode;case 3:return k.b.LineStripDrawMode;case 4:return k.b.TriangleFillMode;case 5:return k.b.TriangleStripDrawMode;case 6:return k.b.TriangleFanDrawMode}throw new Error(`${H}: Invalid mesh primitive mode (${u})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const H=new Array;if(this._gltf.materials)for(const u of this._gltf.materials)if(u._data)for(const J in u._data){const O=u._data[J];for(const u of O.babylonMeshes){u.dg(!0);const J=O.babylonMaterial;H.push(J.forceCompilationAsync(u)),H.push(J.forceCompilationAsync(u,{useInstances:!0})),this._parent.useClipPlane&&(H.push(J.forceCompilationAsync(u,{clipPlane:!0})),H.push(J.forceCompilationAsync(u,{clipPlane:!0,useInstances:!0})))}}return Promise.all(H).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const H=new Array,u=this._babylonScene.lights;for(const J of u){const u=J.getShadowGenerator();u&&H.push(u.forceCompilationAsync())}return Promise.all(H).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(H){for(const u of this._extensions)u.enabled&&H(u)}_applyExtensions(H,u,J){for(const O of this._extensions)if(O.enabled){const U=`${O.name}.${u}`,h=H;h._activeLoaderExtensionFunctions=h._activeLoaderExtensionFunctions||{};const w=h._activeLoaderExtensionFunctions;if(!w[U]){w[U]=!0;try{const H=J(O);if(H)return H}finally{delete w[U]}}}return null}_extensionsOnLoading(){this._forEachExtensions((H=>H.onLoading&&H.onLoading()))}_extensionsOnReady(){this._forEachExtensions((H=>H.onReady&&H.onReady()))}_extensionsLoadSceneAsync(H,u){return this._applyExtensions(u,"loadScene",(J=>J.loadSceneAsync&&J.loadSceneAsync(H,u)))}_extensionsLoadNodeAsync(H,u,J){return this._applyExtensions(u,"loadNode",(O=>O.loadNodeAsync&&O.loadNodeAsync(H,u,J)))}_extensionsLoadCameraAsync(H,u,J){return this._applyExtensions(u,"loadCamera",(O=>O.loadCameraAsync&&O.loadCameraAsync(H,u,J)))}_extensionsLoadVertexDataAsync(H,u,J){return this._applyExtensions(u,"loadVertexData",(O=>O._loadVertexDataAsync&&O._loadVertexDataAsync(H,u,J)))}_extensionsLoadMeshPrimitiveAsync(H,u,J,O,U,h){return this._applyExtensions(U,"loadMeshPrimitive",(w=>w._loadMeshPrimitiveAsync&&w._loadMeshPrimitiveAsync(H,u,J,O,U,h)))}_extensionsLoadMaterialAsync(H,u,J,O,U){return this._applyExtensions(u,"loadMaterial",(h=>h._loadMaterialAsync&&h._loadMaterialAsync(H,u,J,O,U)))}_extensionsCreateMaterial(H,u,J){return this._applyExtensions(u,"createMaterial",(O=>O.createMaterial&&O.createMaterial(H,u,J)))}_extensionsLoadMaterialPropertiesAsync(H,u,J){return this._applyExtensions(u,"loadMaterialProperties",(O=>O.loadMaterialPropertiesAsync&&O.loadMaterialPropertiesAsync(H,u,J)))}_extensionsLoadTextureInfoAsync(H,u,J){return this._applyExtensions(u,"loadTextureInfo",(O=>O.loadTextureInfoAsync&&O.loadTextureInfoAsync(H,u,J)))}_extensionsLoadTextureAsync(H,u,J){return this._applyExtensions(u,"loadTexture",(O=>O._loadTextureAsync&&O._loadTextureAsync(H,u,J)))}_extensionsLoadAnimationAsync(H,u){return this._applyExtensions(u,"loadAnimation",(J=>J.loadAnimationAsync&&J.loadAnimationAsync(H,u)))}_extensionsLoadAnimationChannelAsync(H,u,J,O,U){return this._applyExtensions(J,"loadAnimationChannel",(h=>h._loadAnimationChannelAsync&&h._loadAnimationChannelAsync(H,u,J,O,U)))}_extensionsLoadSkinAsync(H,u,J){return this._applyExtensions(J,"loadSkin",(O=>O._loadSkinAsync&&O._loadSkinAsync(H,u,J)))}_extensionsLoadUriAsync(H,u,J){return this._applyExtensions(u,"loadUri",(O=>O._loadUriAsync&&O._loadUriAsync(H,u,J)))}_extensionsLoadBufferViewAsync(H,u){return this._applyExtensions(u,"loadBufferView",(J=>J.loadBufferViewAsync&&J.loadBufferViewAsync(H,u)))}_extensionsLoadBufferAsync(H,u,J,O){return this._applyExtensions(u,"loadBuffer",(U=>U.loadBufferAsync&&U.loadBufferAsync(H,u,J,O)))}static LoadExtensionAsync(H,u,J,O){if(!u.extensions)return null;const U=u.extensions[J];return U?O(`${H}/extensions/${J}`,U):null}static LoadExtraAsync(H,u,J,O){if(!u.extras)return null;const U=u.extras[J];return U?O(`${H}/extras/${J}`,U):null}isExtensionUsed(H){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(H)}logOpen(H){this._parent._logOpen(H)}logClose(){this._parent._logClose()}log(H){this._parent._log(H)}startPerformanceCounter(H){this._parent._startPerformanceCounter(H)}endPerformanceCounter(H){this._parent._endPerformanceCounter(H)}}D.DefaultSampler={index:-1},c.e._CreateGLTF2Loader=H=>new D(H);var o=J(13979),y=J(12512),x=J(12365),z=J(13988),K=J(13992);class N extends K.e{constructor(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",H),this._texture=H.getEngine().createRawCubeTexture(u,J,O,U,h,w,g,B)}update(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,H,u,J,O,U)}updateRGBDAsync(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,z.j)(this._texture,H,u,J,O).then((()=>{}))}clone(){return x.d.Clone((()=>{const H=this.ZH(),u=this._texture,J=new N(H,u._bufferViewArray,u.width,u.format,u.type,u.generateMipMaps,u.invertY,u.samplingMode,u._compression);return 13===u.source&&J.updateRGBDAsync(u._bufferViewArrayArray,u._sphericalPolynomial,u._lodGenerationScale,u._lodGenerationOffset),J}),this)}}const q="EXT_lights_image_based";class E{constructor(H){this.name=q,this._loader=H,this.enabled=this._loader.isExtensionUsed(q)}dispose(){this._loader=null,delete this._lights}onLoading(){const H=this._loader.xh.extensions;if(H&&H[this.name]){const u=H[this.name];this._lights=u.lights}}loadSceneAsync(H,u){return D.LoadExtensionAsync(H,u,this.name,(async(J,O)=>{this._loader._allMaterialsDirtyRequired=!0;const U=new Array;U.push(this._loader.loadSceneAsync(H,u)),this._loader.logOpen(`${J}`);const h=v.Get(`${J}/light`,this._lights,O.Ph);return U.push(this._loadLightAsync(`/extensions/${this.name}/lights/${O.Ph}`,h).then((H=>{this._loader.babylonScene.environmentTexture=H}))),this._loader.logClose(),await Promise.all(U).then((()=>{}))}))}_loadLightAsync(H,u){if(!u._loaded){const J=new Array;this._loader.logOpen(`${H}`);const O=new Array(u.specularImages.length);for(let U=0;U<u.specularImages.length;U++){const h=u.specularImages[U];O[U]=new Array(h.length);for(let u=0;u<h.length;u++){const w=`${H}/specularImages/${U}/${u}`;this._loader.logOpen(`${w}`);const g=h[u],B=v.Get(w,this._loader.xh.images,g);J.push(this._loader.loadImageAsync(`/images/${g}`,B).then((H=>{O[U][u]=H}))),this._loader.logClose()}}this._loader.logClose(),u._loaded=Promise.all(J).then((async()=>{const J=new N(this._loader.babylonScene,null,u.specularImageSize);if(J.name=u.name||"environment",u._babylonTexture=J,void 0!=u.Yg&&(J.level=u.Yg),u.rotation){let H=U.Quaternion.Cu(u.rotation);this._loader.babylonScene.useRightHandedSystem||(H=U.Quaternion.Inverse(H)),U.Matrix.FromQuaternionToRef(H,J.getReflectionTextureMatrix())}if(!u.irradianceCoefficients)throw new Error(`${H}: Irradiance coefficients are missing`);const h=y.b.Cu(u.irradianceCoefficients);h.scaleInPlace(u.Yg),h.convertIrradianceToLambertianRadiance();const w=y.e.FromHarmonics(h),g=(O.length-1)/Math.log2(u.specularImageSize);return await J.updateRGBDAsync(O,w,g)}))}return u._loaded.then((()=>u._babylonTexture))}}W(q),X(q,!0,(H=>new E(H)));J(12889);const Q="EXT_mesh_gpu_instancing";class HH{constructor(H){this.name=Q,this._loader=H,this.enabled=this._loader.isExtensionUsed(Q)}dispose(){this._loader=null}loadNodeAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(H,O)=>{this._loader._disableInstancedMesh++;const h=this._loader.loadNodeAsync(`/nodes/${u.index}`,u,J);if(this._loader._disableInstancedMesh--,!u._primitiveBabylonMeshes)return await h;const w=new Array;let g=0;const B=u=>{if(void 0==O.attributes[u])return void w.push(Promise.resolve(null));const J=v.Get(`${H}/attributes/${u}`,this._loader.xh.accessors,O.attributes[u]);if(w.push(this._loader._loadFloatAccessorAsync(`/accessors/${J.bufferView}`,J)),0===g)g=J.count;else if(g!==J.count)throw new Error(`${H}/attributes: Instance buffer accessors do not have the same count.`)};return B("TRANSLATION"),B("ROTATION"),B("SCALE"),await h.then((async H=>{const[J,O,h]=await Promise.all(w),B=new Float32Array(16*g);U.TmpVectors.lu[0].kg(0,0,0),U.TmpVectors.Quaternion[0].kg(0,0,0,1),U.TmpVectors.lu[1].kg(1,1,1);for(let u=0;u<g;++u)J&&U.lu.FromArrayToRef(J,3*u,U.TmpVectors.lu[0]),O&&U.Quaternion.FromArrayToRef(O,4*u,U.TmpVectors.Quaternion[0]),h&&U.lu.FromArrayToRef(h,3*u,U.TmpVectors.lu[1]),U.Matrix.ComposeToRef(U.TmpVectors.lu[1],U.TmpVectors.Quaternion[0],U.TmpVectors.lu[0],U.TmpVectors.Matrix[0]),U.TmpVectors.Matrix[0].copyToArray(B,16*u);for(const U of u._primitiveBabylonMeshes)U.WP("matrix",B,16,!0);return H}))}))}}W(Q),X(Q,!0,(H=>new HH(H)));let uH=0,JH=null;class OH{static get Default(){return OH._Default||(OH._Default=new OH),OH._Default}constructor(){const H=OH.Configuration.decoder;this._decoderModulePromise=w.Tools.LoadBabylonScriptAsync(H.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(H,u,J,O,U){await this._decoderModulePromise,0===uH&&(MeshoptDecoder.useWorkers(1),uH=1);const h=await MeshoptDecoder.decodeGltfBufferAsync(u,J,H,O,U);return null!==JH&&clearTimeout(JH),JH=setTimeout((()=>{MeshoptDecoder.useWorkers(0),uH=0,JH=null}),1e3),h}}OH.Configuration={decoder:{url:`${w.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},OH._Default=null;const UH="EXT_meshopt_compression";class hH{constructor(H){this.name=UH,this.enabled=H.isExtensionUsed(UH),this._loader=H}dispose(){this._loader=null}loadBufferViewAsync(H,u){return D.LoadExtensionAsync(H,u,this.name,(async(J,O)=>{const U=u;if(U._meshOptData)return await U._meshOptData;const h=v.Get(`${H}/buffer`,this._loader.xh.buffers,O.buffer);return U._meshOptData=this._loader.loadBufferAsync(`/buffers/${h.index}`,h,O.byteOffset||0,O.byteLength).then((async H=>await OH.Default.decodeGltfBufferAsync(H,O.count,O.byteStride,O.mode,O.filter))),await U._meshOptData}))}}W(UH),X(UH,!0,(H=>new hH(H)));const wH="EXT_texture_webp";class gH{constructor(H){this.name=wH,this._loader=H,this.enabled=H.isExtensionUsed(wH)}dispose(){this._loader=null}_loadTextureAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=void 0==u.sampler?D.DefaultSampler:v.Get(`${H}/sampler`,this._loader.xh.samplers,u.sampler),w=v.Get(`${O}/source`,this._loader.xh.images,U.source);return await this._loader._createTextureAsync(H,h,w,(H=>{J(H)}),void 0,!u._textureInfo.nonColorData)}))}}W(wH),X(wH,!0,(H=>new gH(H)));const BH="EXT_texture_avif";class bH{constructor(H){this.name=BH,this._loader=H,this.enabled=H.isExtensionUsed(BH)}dispose(){this._loader=null}_loadTextureAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=void 0==u.sampler?D.DefaultSampler:v.Get(`${H}/sampler`,this._loader.xh.samplers,u.sampler),w=v.Get(`${O}/source`,this._loader.xh.images,U.source);return await this._loader._createTextureAsync(H,h,w,(H=>{J(H)}),void 0,!u._textureInfo.nonColorData)}))}}W(BH),X(BH,!0,(H=>new bH(H)));var dH=J(13977),GH=J(12872);const PH="EXT_lights_ies";class mu{constructor(H){this.name=PH,this._loader=H,this.enabled=this._loader.isExtensionUsed(PH)}dispose(){this._loader=null,delete this._lights}onLoading(){const H=this._loader.xh.extensions;if(H&&H[this.name]){const u=H[this.name];this._lights=u.lights,v.Assign(this._lights)}}loadNodeAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,w)=>{let g,B;this._loader._allMaterialsDirtyRequired=!0;const b=await this._loader.loadNodeAsync(H,u,(H=>{B=v.Get(O,this._lights,w.Ph);const u=B.name||H.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,g=new dH.b(u,U.lu.Zero(),U.lu.Backward(),0,1,this._loader.babylonScene),g.angle=Math.PI/2,g.innerAngle=0,g._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,B._babylonLight=g,g.falloffType=GH.d.FALLOFF_GLTF,g.Fg=w.color?h.ku.Cu(w.color):h.ku.White(),g.Yg=w.multiplier||1,g.range=Number.MAX_VALUE,g.parent=H,this._loader._babylonLights.push(g),D.AddPointerMetadata(g,O),J(H)}));let d;if(B.uri)d=await this._loader.loadUriAsync(H,B,B.uri);else{const u=v.Get(`${H}/bufferView`,this._loader.xh.bufferViews,B.bufferView);d=await this._loader.loadBufferViewAsync(`/bufferViews/${u.index}`,u)}return g.iesProfileTexture=new j.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,d,!0,void 0,void 0,void 0,void 0,".ies"),b}))}}W(PH),X(PH,!0,(H=>new mu(H)));var lH=J(14001);const rH="KHR_draco_mesh_compression";class pH{constructor(H){this.name=rH,this.useNormalizedFlagFromAccessor=!0,this._loader=H,this.enabled=lH.d.DefaultAvailable&&this._loader.isExtensionUsed(rH)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{if(void 0!=u.mode&&4!==u.mode&&5!==u.mode)throw new Error(`${H}: Unsupported mode ${u.mode}`);const h={},w={},g=(H,O)=>{const g=U.attributes[H];if(void 0!=g&&(J._delayInfo=J._delayInfo||[],-1===J._delayInfo.indexOf(O)&&J._delayInfo.push(O),h[O]=g,this.useNormalizedFlagFromAccessor)){const J=v.TryGet(this._loader.xh.accessors,u.attributes[H]);J&&(w[O]=J.normalized||!1)}};g("POSITION",L.d.PositionKind),g("NORMAL",L.d.NormalKind),g("TANGENT",L.d.TangentKind),g("TEXCOORD_0",L.d.UVKind),g("TEXCOORD_1",L.d.UV2Kind),g("TEXCOORD_2",L.d.UV3Kind),g("TEXCOORD_3",L.d.UV4Kind),g("TEXCOORD_4",L.d.UV5Kind),g("TEXCOORD_5",L.d.UV6Kind),g("JOINTS_0",L.d.MatricesIndicesKind),g("WEIGHTS_0",L.d.MatricesWeightsKind),g("COLOR_0",L.d.ColorKind);const B=v.Get(O,this._loader.xh.bufferViews,U.bufferView);return B._dracoBabylonGeometry||(B._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${B.index}`,B).then((async O=>{const U=this.dracoDecoder||lH.d.Default,g=v.TryGet(this._loader.xh.accessors,u.attributes.POSITION),B=this._loader.parent.alwaysComputeBoundingBox||J.skeleton||!g?null:I(g);return await U._decodeMeshToGeometryForGltfAsync(J.name,this._loader.babylonScene,O,h,w,B).catch((u=>{throw new Error(`${H}: ${u.message}`)}))}))),await B._dracoBabylonGeometry}))}}W(rH),X(rH,!0,(H=>new pH(H)));var aH=J(14004),kH=J(12324),CH=J(12329),jH=J(12732),MH=J(12926),LH=J(12304);jH.d.AddNodeConstructor("Light_Type_0",((H,u)=>()=>new ZH(H,U.lu.Zero(),u)));class ZH extends MH.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(H){this._shadowAngle=H,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(H){const u=this.needCube();if(this._direction=H,this.needCube()!==u&&this._shadowGenerators){const H=this._shadowGenerators.values();for(let u=H.next();!0!==u.done;u=H.next()){u.value.recreateShadowMap()}}}constructor(H,u,J){super(H,J),this._shadowAngle=Math.PI/2,this.position=u}getClassName(){return"PointLight"}getTypeID(){return GH.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(H){if(this.direction)return super.getShadowDirection(H);switch(H){case 0:return new U.lu(1,0,0);case 1:return new U.lu(-1,0,0);case 2:return new U.lu(0,-1,0);case 3:return new U.lu(0,1,0);case 4:return new U.lu(0,0,1);case 5:return new U.lu(0,0,-1)}return U.lu.Zero()}_setDefaultShadowProjectionMatrix(H,u,J){const O=this.ZH().activeCamera;if(!O)return;const h=void 0!==this.shadowMinZ?this.shadowMinZ:O.Ug,w=void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ,g=this.ZH().getEngine().rh;U.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,g?w:h,g?h:w,H,!0,this._scene.getEngine().isNDCHalfZRange,void 0,g)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(H,u){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,u):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,u),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,u),this}transferToNodeMaterialEffect(H,u){return this.computeTransformedInformation()?H.setFloat3(u,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):H.setFloat3(u,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(H,u){H["POINTLIGHT"+u]=!0}}(0,kH.c)([(0,CH.I)()],ZH.prototype,"shadowAngle",null),(0,LH.f)("BABYLON.PointLight",ZH);const YH="KHR_lights_punctual";class FH{constructor(H){this.name=YH,this._loader=H,this.enabled=this._loader.isExtensionUsed(YH)}dispose(){this._loader=null,delete this._lights}onLoading(){const H=this._loader.xh.extensions;if(H&&H[this.name]){const u=H[this.name];this._lights=u.lights,v.Assign(this._lights)}}loadNodeAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,w)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(H,u,(H=>{let u;const g=v.Get(O,this._lights,w.Ph),B=g.name||H.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,g.type){case"directional":{const H=new aH.b(B,U.lu.Backward(),this._loader.babylonScene);H.position.jg(0),u=H;break}case"point":u=new ZH(B,U.lu.Zero(),this._loader.babylonScene);break;case"spot":{const H=new dH.b(B,U.lu.Zero(),U.lu.Backward(),0,1,this._loader.babylonScene);H.angle=2*(g.spot&&g.spot.outerConeAngle||Math.PI/4),H.innerAngle=2*(g.spot&&g.spot.innerConeAngle||0),u=H;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${O}: Invalid light type (${g.type})`)}u._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,g._babylonLight=u,u.falloffType=GH.d.FALLOFF_GLTF,u.Fg=g.color?h.ku.Cu(g.color):h.ku.White(),u.Yg=void 0==g.Yg?1:g.Yg,u.range=void 0==g.range?Number.MAX_VALUE:g.range,u.parent=H,this._loader._babylonLights.push(u),D.AddPointerMetadata(u,O),J(H)})))))}}W(YH),X(YH,!0,(H=>new FH(H)));const sH="KHR_materials_pbrSpecularGlossiness";class AH{constructor(H){this.name=sH,this.order=200,this._loader=H,this.enabled=this._loader.isExtensionUsed(sH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=new Array;return h.push(this._loader.loadMaterialBasePropertiesAsync(H,u,J)),h.push(this._loadSpecularGlossinessPropertiesAsync(O,U,J)),this._loader.loadMaterialAlphaProperties(H,u,J),await Promise.all(h).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(H,u,J){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);const O=new Array;return J.metallic=null,J.roughness=null,u.diffuseFactor?(J.albedoColor=h.ku.Cu(u.diffuseFactor),J.alpha=u.diffuseFactor[3]):J.albedoColor=h.ku.White(),J.reflectivityColor=u.specularFactor?h.ku.Cu(u.specularFactor):h.ku.White(),J.microSurface=void 0==u.glossinessFactor?1:u.glossinessFactor,u.diffuseTexture&&O.push(this._loader.loadTextureInfoAsync(`${H}/diffuseTexture`,u.diffuseTexture,(H=>{H.name=`${J.name} (Diffuse)`,J.albedoTexture=H}))),u.specularGlossinessTexture&&(O.push(this._loader.loadTextureInfoAsync(`${H}/specularGlossinessTexture`,u.specularGlossinessTexture,(H=>{H.name=`${J.name} (Specular Glossiness)`,J.reflectivityTexture=H,J.reflectivityTexture.Og=!0}))),J.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(O).then((()=>{}))}}W(sH),X(sH,!0,(H=>new AH(H)));const tH="KHR_materials_unlit";class eH{constructor(H){this.name=tH,this.order=210,this._loader=H,this.enabled=this._loader.isExtensionUsed(tH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async()=>await this._loadUnlitPropertiesAsync(H,u,J)))}_loadUnlitPropertiesAsync(H,u,J){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);const O=new Array;J.unlit=!0;const U=u.pbrMetallicRoughness;return U&&(U.baseColorFactor?(J.albedoColor=h.ku.Cu(U.baseColorFactor),J.alpha=U.baseColorFactor[3]):J.albedoColor=h.ku.White(),U.baseColorTexture&&O.push(this._loader.loadTextureInfoAsync(`${H}/baseColorTexture`,U.baseColorTexture,(H=>{H.name=`${J.name} (Base Color)`,J.albedoTexture=H})))),u.doubleSided&&(J.ag=!1,J.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(H,u,J),Promise.all(O).then((()=>{}))}}W(tH),X(tH,!0,(H=>new eH(H)));const cH="KHR_materials_clearcoat";class nH{constructor(H){this.name=cH,this.order=190,this._loader=H,this.enabled=this._loader.isExtensionUsed(cH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=new Array;h.push(this._loader.loadMaterialPropertiesAsync(H,u,J)),h.push(this._loadClearCoatPropertiesAsync(O,U,J)),await Promise.all(h)}))}_loadClearCoatPropertiesAsync(H,u,J){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);const O=new Array;return J.clearCoat.isEnabled=!0,J.clearCoat.useRoughnessFromMainTexture=!1,J.clearCoat.remapF0OnInterfaceChange=!1,void 0!=u.clearcoatFactor?J.clearCoat.Yg=u.clearcoatFactor:J.clearCoat.Yg=0,u.clearcoatTexture&&O.push(this._loader.loadTextureInfoAsync(`${H}/clearcoatTexture`,u.clearcoatTexture,(H=>{H.name=`${J.name} (ClearCoat)`,J.clearCoat.texture=H}))),void 0!=u.clearcoatRoughnessFactor?J.clearCoat.roughness=u.clearcoatRoughnessFactor:J.clearCoat.roughness=0,u.clearcoatRoughnessTexture&&(u.clearcoatRoughnessTexture.nonColorData=!0,O.push(this._loader.loadTextureInfoAsync(`${H}/clearcoatRoughnessTexture`,u.clearcoatRoughnessTexture,(H=>{H.name=`${J.name} (ClearCoat Roughness)`,J.clearCoat.textureRoughness=H})))),u.clearcoatNormalTexture&&(u.clearcoatNormalTexture.nonColorData=!0,O.push(this._loader.loadTextureInfoAsync(`${H}/clearcoatNormalTexture`,u.clearcoatNormalTexture,(H=>{H.name=`${J.name} (ClearCoat Normal)`,J.clearCoat.bumpTexture=H}))),J.invertNormalMapX=!J.ZH().useRightHandedSystem,J.invertNormalMapY=J.ZH().useRightHandedSystem,void 0!=u.clearcoatNormalTexture.scale&&(J.clearCoat.bumpTexture.level=u.clearcoatNormalTexture.scale)),Promise.all(O).then((()=>{}))}}W(cH),X(cH,!0,(H=>new nH(H)));const VH="KHR_materials_iridescence";class TH{constructor(H){this.name=VH,this.order=195,this._loader=H,this.enabled=this._loader.isExtensionUsed(VH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(H,u,J)),h.push(this._loadIridescencePropertiesAsync(O,U,J)),await Promise.all(h).then((()=>{}))}))}_loadIridescencePropertiesAsync(H,u,J){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);const O=new Array;return J.iridescence.isEnabled=!0,J.iridescence.Yg=u.iridescenceFactor??0,J.iridescence.indexOfRefraction=u.iridescenceIor??u.iridescenceIOR??1.3,J.iridescence.minimumThickness=u.iridescenceThicknessMinimum??100,J.iridescence.maximumThickness=u.iridescenceThicknessMaximum??400,u.iridescenceTexture&&O.push(this._loader.loadTextureInfoAsync(`${H}/iridescenceTexture`,u.iridescenceTexture,(H=>{H.name=`${J.name} (Iridescence)`,J.iridescence.texture=H}))),u.iridescenceThicknessTexture&&O.push(this._loader.loadTextureInfoAsync(`${H}/iridescenceThicknessTexture`,u.iridescenceThicknessTexture,(H=>{H.name=`${J.name} (Iridescence Thickness)`,J.iridescence.thicknessTexture=H}))),Promise.all(O).then((()=>{}))}}W(VH),X(VH,!0,(H=>new TH(H)));const RH="KHR_materials_anisotropy";class XH{constructor(H){this.name=RH,this.order=195,this._loader=H,this.enabled=this._loader.isExtensionUsed(RH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=new Array;h.push(this._loader.loadMaterialPropertiesAsync(H,u,J)),h.push(this._loadIridescencePropertiesAsync(O,U,J)),await Promise.all(h)}))}async _loadIridescencePropertiesAsync(H,u,J){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);const O=new Array;J.anisotropy.isEnabled=!0,J.anisotropy.Yg=u.anisotropyStrength??0,J.anisotropy.angle=u.anisotropyRotation??0,u.anisotropyTexture&&(u.anisotropyTexture.nonColorData=!0,O.push(this._loader.loadTextureInfoAsync(`${H}/anisotropyTexture`,u.anisotropyTexture,(H=>{H.name=`${J.name} (Anisotropy Intensity)`,J.anisotropy.texture=H})))),await Promise.all(O)}}W(RH),X(RH,!0,(H=>new XH(H)));const WH="KHR_materials_emissive_strength";class fH{constructor(H){this.name=WH,this.order=170,this._loader=H,this.enabled=this._loader.isExtensionUsed(WH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>await this._loader.loadMaterialPropertiesAsync(H,u,J).then((()=>{this._loadEmissiveProperties(O,U,J)}))))}_loadEmissiveProperties(H,u,J){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);void 0!==u.emissiveStrength&&(J.emissiveIntensity=u.emissiveStrength)}}W(WH),X(WH,!0,(H=>new fH(H)));const iH="KHR_materials_sheen";class SH{constructor(H){this.name=iH,this.order=190,this._loader=H,this.enabled=this._loader.isExtensionUsed(iH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(H,u,J)),h.push(this._loadSheenPropertiesAsync(O,U,J)),await Promise.all(h).then((()=>{}))}))}_loadSheenPropertiesAsync(H,u,J){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);const O=new Array;return J.sheen.isEnabled=!0,J.sheen.Yg=1,void 0!=u.sheenColorFactor?J.sheen.color=h.ku.Cu(u.sheenColorFactor):J.sheen.color=h.ku.Black(),u.sheenColorTexture&&O.push(this._loader.loadTextureInfoAsync(`${H}/sheenColorTexture`,u.sheenColorTexture,(H=>{H.name=`${J.name} (Sheen Color)`,J.sheen.texture=H}))),void 0!==u.sheenRoughnessFactor?J.sheen.roughness=u.sheenRoughnessFactor:J.sheen.roughness=0,u.sheenRoughnessTexture&&(u.sheenRoughnessTexture.nonColorData=!0,O.push(this._loader.loadTextureInfoAsync(`${H}/sheenRoughnessTexture`,u.sheenRoughnessTexture,(H=>{H.name=`${J.name} (Sheen Roughness)`,J.sheen.textureRoughness=H})))),J.sheen.albedoScaling=!0,J.sheen.useRoughnessFromMainTexture=!1,Promise.all(O).then((()=>{}))}}W(iH),X(iH,!0,(H=>new SH(H)));var vH=J(12806);const IH="KHR_materials_specular";class DH{constructor(H){this.name=IH,this.order=190,this._loader=H,this.enabled=this._loader.isExtensionUsed(IH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=new Array;if(h.push(this._loader.loadMaterialPropertiesAsync(H,u,J)),h.push(this._loadSpecularPropertiesAsync(O,U,J)),U.extensions&&U.extensions.EXT_materials_specular_edge_color&&J instanceof C.b){U.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(J.brdf.dielectricSpecularModel=vH.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,J.brdf.conductorSpecularModel=vH.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(h).then((()=>{}))}))}_loadSpecularPropertiesAsync(H,u,J){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);const O=new Array;return void 0!==u.specularFactor&&(J.metallicF0Factor=u.specularFactor),void 0!==u.specularColorFactor&&(J.metallicReflectanceColor=h.ku.Cu(u.specularColorFactor)),u.specularTexture&&(u.specularTexture.nonColorData=!0,O.push(this._loader.loadTextureInfoAsync(`${H}/specularTexture`,u.specularTexture,(H=>{H.name=`${J.name} (Specular)`,J.metallicReflectanceTexture=H,J.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),u.specularColorTexture&&O.push(this._loader.loadTextureInfoAsync(`${H}/specularColorTexture`,u.specularColorTexture,(H=>{H.name=`${J.name} (Specular Color)`,J.reflectanceTexture=H}))),Promise.all(O).then((()=>{}))}}W(IH),X(IH,!0,(H=>new DH(H)));const oH="KHR_materials_ior";class yH{constructor(H){this.name=oH,this.order=180,this._loader=H,this.enabled=this._loader.isExtensionUsed(oH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(H,u,J)),h.push(this._loadIorPropertiesAsync(O,U,J)),await Promise.all(h).then((()=>{}))}))}_loadIorPropertiesAsync(H,u,J){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);return void 0!==u.ior?J.indexOfRefraction=u.ior:J.indexOfRefraction=yH._DEFAULT_IOR,Promise.resolve()}}yH._DEFAULT_IOR=1.5,W(oH),X(oH,!0,(H=>new yH(H)));const xH="KHR_materials_variants";class zH{constructor(H){this.name=xH,this._loader=H,this.enabled=this._loader.isExtensionUsed(xH)}dispose(){this._loader=null}static GetAvailableVariants(H){const u=this._GetExtensionMetadata(H);return u?Object.keys(u.variants):[]}getAvailableVariants(H){return zH.GetAvailableVariants(H)}static SelectVariant(H,u){const J=this._GetExtensionMetadata(H);if(!J)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${xH} extension`);const O=H=>{const u=J.variants[H];if(u)for(const J of u)J.mesh.material=J.material};if(u instanceof Array)for(const U of u)O(U);else O(u);J.lastSelected=u}selectVariant(H,u){zH.SelectVariant(H,u)}static Reset(H){const u=this._GetExtensionMetadata(H);if(!u)throw new Error(`Cannot reset on a glTF mesh that does not have the ${xH} extension`);for(const J of u.original)J.mesh.material=J.material;u.lastSelected=null}reset(H){zH.Reset(H)}static GetLastSelectedVariant(H){const u=this._GetExtensionMetadata(H);if(!u)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${xH} extension`);return u.lastSelected}getLastSelectedVariant(H){return zH.GetLastSelectedVariant(H)}static _GetExtensionMetadata(H){var u,J;return(null===H||void 0===H||null===(u=H._internalMetadata)||void 0===u||null===(J=u.xh)||void 0===J?void 0:J[xH])||null}onLoading(){const H=this._loader.xh.extensions;if(H&&H[this.name]){const u=H[this.name];this._variants=u.variants}}onReady(){const H=this._loader.rootBabylonMesh;if(H){var u;const J=this._loader.parent.extensionOptions[xH];null!==J&&void 0!==J&&J.defaultVariant&&zH.SelectVariant(H,J.defaultVariant),null===J||void 0===J||null===(u=J.onLoaded)||void 0===u||u.call(J,{get variants(){return zH.GetAvailableVariants(H)},get selectedVariant(){const u=zH.GetLastSelectedVariant(H);return u?Array.isArray(u)?u[0]:u:zH.GetAvailableVariants(H)[0]},set selectedVariant(u){zH.SelectVariant(H,u)}})}}_loadMeshPrimitiveAsync(H,u,J,O,U,h){return D.LoadExtensionAsync(H,U,this.name,(async(w,g)=>{const B=new Array;return B.push(this._loader._loadMeshPrimitiveAsync(H,u,J,O,U,(u=>{if(h(u),u instanceof F.c){const J=D._GetDrawMode(H,U.mode),O=this._loader.rootBabylonMesh,h=O?O._internalMetadata=O._internalMetadata||{}:{},b=h.xh=h.xh||{},d=b[xH]=b[xH]||{lastSelected:null,original:[],variants:{}};d.original.push({mesh:u,material:u.material});for(let H=0;H<g.mappings.length;++H){const U=g.mappings[H],h=v.Get(`${w}/mappings/${H}/material`,this._loader.xh.materials,U.material);B.push(this._loader._loadMaterialAsync(`#/materials/${U.material}`,h,u,J,(H=>{for(let J=0;J<U.variants.length;++J){const h=U.variants[J],w=v.Get(`/extensions/${xH}/variants/${h}`,this._variants,h);d.variants[w.name]=d.variants[w.name]||[],d.variants[w.name].push({mesh:u,material:H}),u.onClonedObservable.add((H=>{const J=H;let U=null,h=J;do{if(h=h.parent,!h)return;U=zH._GetExtensionMetadata(h)}while(null===U);if(O&&U===zH._GetExtensionMetadata(O)){h._internalMetadata={};for(const H in O._internalMetadata)h._internalMetadata[H]=O._internalMetadata[H];h._internalMetadata.xh=[];for(const H in O._internalMetadata.xh)h._internalMetadata.xh[H]=O._internalMetadata.xh[H];h._internalMetadata.xh[xH]={lastSelected:null,original:[],variants:{}};for(const H of U.original)h._internalMetadata.xh[xH].original.push({mesh:H.mesh,material:H.material});for(const H in U.variants)if(Object.prototype.hasOwnProperty.call(U.variants,H)){h._internalMetadata.xh[xH].variants[H]=[];for(const u of U.variants[H])h._internalMetadata.xh[xH].variants[H].push({mesh:u.mesh,material:u.material})}U=h._internalMetadata.xh[xH]}for(const O of U.original)O.mesh===u&&(O.mesh=J);for(const O of U.variants[w.name])O.mesh===u&&(O.mesh=J)}))}})))}}}))),await Promise.all(B).then((H=>{let[u]=H;return u}))}))}}W(xH),X(xH,!0,(H=>new zH(H)));var KH=J(12399);class NH{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:vH.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(H,u){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...NH._GetDefaultOptions(),...H},this._scene=u,this._scene._transmissionHelper=this,this.onErrorObservable=new d.b,this._scene.nh.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(H){if(!Object.keys(H).filter((u=>this._options[u]!==H[u])).length)return;const u={...this._options,...H},J=this._options;this._options=u,u.renderSize===J.renderSize&&u.renderTargetTextureType===J.renderTargetTextureType&&u.generateMipmaps===J.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=u.samples,this._opaqueRenderTarget.lodGenerationScale=u.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=u.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(H){return!!H&&!!(H instanceof C.b&&H.subSurface.isRefractionEnabled)}_addMesh(H){this._materialObservers[H.uniqueId]=H.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),w.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(H.material)?(H.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(H)&&this._transparentMeshesCache.push(H)):-1===this._opaqueMeshesCache.indexOf(H)&&this._opaqueMeshesCache.push(H)}))}_removeMesh(H){H.onMaterialChangedObservable.remove(this._materialObservers[H.uniqueId]),delete this._materialObservers[H.uniqueId];let u=this._transparentMeshesCache.indexOf(H);-1!==u&&this._transparentMeshesCache.splice(u,1),u=this._opaqueMeshesCache.indexOf(H),-1!==u&&this._opaqueMeshesCache.splice(u,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(H){const u=this._transparentMeshesCache.indexOf(H),J=this._opaqueMeshesCache.indexOf(H);this._shouldRenderAsTransmission(H.material)?(H.material instanceof C.b&&(H.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==J?(this._opaqueMeshesCache.splice(J,1),this._transparentMeshesCache.push(H)):-1===u&&this._transparentMeshesCache.push(H)):-1!==u?(this._transparentMeshesCache.splice(u,1),this._opaqueMeshesCache.push(H)):-1===J&&this._opaqueMeshesCache.push(H)}_isRenderTargetValid(){var H;return null!==(null===(H=this._opaqueRenderTarget)||void 0===H?void 0:H.getInternalTexture())}_setupRenderTargets(){var H;let u;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new KH.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(H=this._options.clearColor)||void 0===H?void 0:H.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((H=>{u=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?H.clearColor.O(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(H.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=u}));for(const J of this._transparentMeshesCache)this._shouldRenderAsTransmission(J.material)&&(J.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const qH="KHR_materials_transmission";class EH{constructor(H){this.name=qH,this.order=175,this._loader=H,this.enabled=this._loader.isExtensionUsed(qH),this.enabled&&(H.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(H,u,J)),h.push(this._loadTransparentPropertiesAsync(O,u,J,U)),await Promise.all(h).then((()=>{}))}))}_loadTransparentPropertiesAsync(H,u,J,O){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);const U=J;if(U.subSurface.isRefractionEnabled=!0,U.subSurface.volumeIndexOfRefraction=1,U.subSurface.useAlbedoToTintRefraction=!0,void 0===O.transmissionFactor)return U.subSurface.refractionIntensity=0,U.subSurface.isRefractionEnabled=!1,Promise.resolve();{var h;U.subSurface.refractionIntensity=O.transmissionFactor;const H=U.ZH();if(U.subSurface.refractionIntensity&&!H._transmissionHelper)new NH({},U.ZH());else if(U.subSurface.refractionIntensity&&(null===(h=H._transmissionHelper)||void 0===h||!h._isRenderTargetValid())){var w;null===(w=H._transmissionHelper)||void 0===w||w._setupRenderTargets()}}return U.subSurface.minimumThickness=0,U.subSurface.maximumThickness=0,O.transmissionTexture?(O.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${H}/transmissionTexture`,O.transmissionTexture,void 0).then((H=>{H.name=`${J.name} (Transmission)`,U.subSurface.refractionIntensityTexture=H,U.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}W(qH),X(qH,!0,(H=>new EH(H)));const QH="KHR_materials_diffuse_transmission";class Hu{constructor(H){this.name=QH,this.order=174,this._loader=H,this.enabled=this._loader.isExtensionUsed(QH),this.enabled&&(H.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(H,u,J)),h.push(this._loadTranslucentPropertiesAsync(O,u,J,U)),await Promise.all(h).then((()=>{}))}))}_loadTranslucentPropertiesAsync(H,u,J,O){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);const U=J;if(U.subSurface.isTranslucencyEnabled=!0,U.subSurface.volumeIndexOfRefraction=1,U.subSurface.minimumThickness=0,U.subSurface.maximumThickness=0,U.subSurface.useAlbedoToTintTranslucency=!1,void 0===O.diffuseTransmissionFactor)return U.subSurface.translucencyIntensity=0,U.subSurface.isTranslucencyEnabled=!1,Promise.resolve();U.subSurface.translucencyIntensity=O.diffuseTransmissionFactor;const w=new Array;return U.subSurface.useGltfStyleTextures=!0,O.diffuseTransmissionTexture&&(O.diffuseTransmissionTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${H}/diffuseTransmissionTexture`,O.diffuseTransmissionTexture).then((H=>{H.name=`${J.name} (Diffuse Transmission)`,U.subSurface.translucencyIntensityTexture=H})))),void 0!==O.diffuseTransmissionColorFactor?U.subSurface.translucencyColor=h.ku.Cu(O.diffuseTransmissionColorFactor):U.subSurface.translucencyColor=h.ku.White(),O.diffuseTransmissionColorTexture&&w.push(this._loader.loadTextureInfoAsync(`${H}/diffuseTransmissionColorTexture`,O.diffuseTransmissionColorTexture).then((H=>{H.name=`${J.name} (Diffuse Transmission Color)`,U.subSurface.translucencyColorTexture=H}))),Promise.all(w).then((()=>{}))}}W(QH),X(QH,!0,(H=>new Hu(H)));const uu="KHR_materials_volume";class Ju{constructor(H){this.name=uu,this.order=173,this._loader=H,this.enabled=this._loader.isExtensionUsed(uu),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(H,u,J)),h.push(this._loadVolumePropertiesAsync(O,u,J,U)),await Promise.all(h).then((()=>{}))}))}_loadVolumePropertiesAsync(H,u,J,O){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);if(!J.subSurface.isRefractionEnabled&&!J.subSurface.isTranslucencyEnabled||!O.thicknessFactor)return Promise.resolve();J.subSurface.volumeIndexOfRefraction=J.indexOfRefraction;const U=void 0!==O.attenuationDistance?O.attenuationDistance:Number.MAX_VALUE;return J.subSurface.tintColorAtDistance=U,void 0!==O.attenuationColor&&3==O.attenuationColor.length&&J.subSurface.tintColor.kg(O.attenuationColor[0],O.attenuationColor[1],O.attenuationColor[2]),J.subSurface.minimumThickness=0,J.subSurface.maximumThickness=O.thicknessFactor,J.subSurface.useThicknessAsDepth=!0,O.thicknessTexture?(O.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${H}/thicknessTexture`,O.thicknessTexture).then((H=>{H.name=`${J.name} (Thickness)`,J.subSurface.thicknessTexture=H,J.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}W(uu),X(uu,!0,(H=>new Ju(H)));const Ou="KHR_materials_dispersion";class Uu{constructor(H){this.name=Ou,this.order=174,this._loader=H,this.enabled=this._loader.isExtensionUsed(Ou)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(H,u,J)),h.push(this._loadDispersionPropertiesAsync(O,u,J,U)),await Promise.all(h).then((()=>{}))}))}_loadDispersionPropertiesAsync(H,u,J,O){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);return J.subSurface.isRefractionEnabled&&O.dispersion?(J.subSurface.isDispersionEnabled=!0,J.subSurface.dispersion=O.dispersion,Promise.resolve()):Promise.resolve()}}W(Ou),X(Ou,!0,(H=>new Uu(H)));const hu="EXT_materials_diffuse_roughness";class wu{constructor(H){this.name=hu,this.order=190,this._loader=H,this.enabled=this._loader.isExtensionUsed(hu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(H,u,J)),h.push(this._loadDiffuseRoughnessPropertiesAsync(O,U,J)),await Promise.all(h).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(H,u,J){if(!(J instanceof C.b))throw new Error(`${H}: Material type not supported`);const O=new Array;return J.brdf.baseDiffuseModel=vH.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=u.diffuseRoughnessFactor?J.baseDiffuseRoughness=u.diffuseRoughnessFactor:J.baseDiffuseRoughness=0,u.diffuseRoughnessTexture&&O.push(this._loader.loadTextureInfoAsync(`${H}/diffuseRoughnessTexture`,u.diffuseRoughnessTexture,(H=>{H.name=`${J.name} (Diffuse Roughness)`,J.baseDiffuseRoughnessTexture=H}))),Promise.all(O).then((()=>{}))}}W(hu),X(hu,!0,(H=>new wu(H)));const gu="KHR_mesh_quantization";class Bu{constructor(H){this.name=gu,this.enabled=H.isExtensionUsed(gu)}dispose(){}}W(gu),X(gu,!0,(H=>new Bu(H)));const bu="KHR_texture_basisu";class du{constructor(H){this.name=bu,this._loader=H,this.enabled=H.isExtensionUsed(bu)}dispose(){this._loader=null}_loadTextureAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>{const h=void 0==u.sampler?D.DefaultSampler:v.Get(`${H}/sampler`,this._loader.xh.samplers,u.sampler),w=v.Get(`${O}/source`,this._loader.xh.images,U.source);return await this._loader._createTextureAsync(H,h,w,(H=>{J(H)}),u._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!u._textureInfo.nonColorData)}))}}W(bu),X(bu,!0,(H=>new du(H)));const Gu="KHR_texture_transform";class Pu{constructor(H){this.name=Gu,this._loader=H,this.enabled=this._loader.isExtensionUsed(Gu)}dispose(){this._loader=null}loadTextureInfoAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(O,U)=>await this._loader.loadTextureInfoAsync(H,u,(H=>{if(!(H instanceof j.b))throw new Error(`${O}: Texture type not supported`);U.offset&&(H.uOffset=U.offset[0],H.vOffset=U.offset[1]),H.uRotationCenter=0,H.vRotationCenter=0,U.rotation&&(H.wAng=-U.rotation),U.scale&&(H.uScale=U.scale[0],H.vScale=U.scale[1]),void 0!=U.texCoord&&(H.coordinatesIndex=U.texCoord),J(H)}))))}}W(Gu),X(Gu,!0,(H=>new Pu(H)));const mJ="KHR_xmp_json_ld";class lu{constructor(H){this.name=mJ,this.order=100,this._loader=H,this.enabled=this._loader.isExtensionUsed(mJ)}dispose(){this._loader=null}onLoading(){var H,u,J;if(null===this._loader.rootBabylonMesh)return;const O=null===(H=this._loader.xh.extensions)||void 0===H?void 0:H.KHR_xmp_json_ld,U=null===(u=this._loader.xh.asset)||void 0===u||null===(J=u.extensions)||void 0===J?void 0:J.KHR_xmp_json_ld;if(O&&U){const H=+U.packet;O.packets&&H<O.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=O.packets[H])}}}function ru(H,u,J,O){return h.ku.Cu(u,J).scale(O)}function pu(H,u,J,O){return u[J]*O}function au(H,u,J,O){return-u[J]*O}function ku(H,u,J,O){return u[J+1]*O}function Cu(H,u,J,O){return u[J]*O*2}function ju(H){return{scale:[new Lu(P.e.ANIMATIONTYPE_FLOAT,`${H}.uScale`,pu,(()=>2)),new Lu(P.e.ANIMATIONTYPE_FLOAT,`${H}.vScale`,ku,(()=>2))],offset:[new Lu(P.e.ANIMATIONTYPE_FLOAT,`${H}.uOffset`,pu,(()=>2)),new Lu(P.e.ANIMATIONTYPE_FLOAT,`${H}.vOffset`,ku,(()=>2))],rotation:[new Lu(P.e.ANIMATIONTYPE_FLOAT,`${H}.wAng`,au,(()=>1))]}}W(mJ),X(mJ,!0,(H=>new lu(H)));class Mu extends o.AnimationPropertyInfo{buildAnimations(H,u,J,O){return[{babylonAnimatable:H._babylonCamera,babylonAnimation:this._buildAnimation(u,J,O)}]}}class Lu extends o.AnimationPropertyInfo{buildAnimations(H,u,J,O){const U=[];for(const h in H._data)U.push({babylonAnimatable:H._data[h].babylonMaterial,babylonAnimation:this._buildAnimation(u,J,O)});return U}}class Zu extends o.AnimationPropertyInfo{buildAnimations(H,u,J,O){return[{babylonAnimatable:H._babylonLight,babylonAnimation:this._buildAnimation(u,J,O)}]}}(0,f.m)("/cameras/{}/orthographic/xmag",[new Mu(P.e.ANIMATIONTYPE_FLOAT,"orthoLeft",au,(()=>1)),new Mu(P.e.ANIMATIONTYPE_FLOAT,"orthoRight",ku,(()=>1))]),(0,f.m)("/cameras/{}/orthographic/ymag",[new Mu(P.e.ANIMATIONTYPE_FLOAT,"orthoBottom",au,(()=>1)),new Mu(P.e.ANIMATIONTYPE_FLOAT,"orthoTop",ku,(()=>1))]),(0,f.m)("/cameras/{}/orthographic/zfar",[new Mu(P.e.ANIMATIONTYPE_FLOAT,"maxZ",pu,(()=>1))]),(0,f.m)("/cameras/{}/orthographic/znear",[new Mu(P.e.ANIMATIONTYPE_FLOAT,"Ug",pu,(()=>1))]),(0,f.m)("/cameras/{}/perspective/yfov",[new Mu(P.e.ANIMATIONTYPE_FLOAT,"fov",pu,(()=>1))]),(0,f.m)("/cameras/{}/perspective/zfar",[new Mu(P.e.ANIMATIONTYPE_FLOAT,"maxZ",pu,(()=>1))]),(0,f.m)("/cameras/{}/perspective/znear",[new Mu(P.e.ANIMATIONTYPE_FLOAT,"Ug",pu,(()=>1))]),(0,f.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Lu(P.e.ANIMATIONTYPE_COLOR3,"albedoColor",ru,(()=>4)),new Lu(P.e.ANIMATIONTYPE_FLOAT,"alpha",(function(H,u,J,O){return u[J+3]*O}),(()=>4))]),(0,f.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"metallic",pu,(()=>1))]),(0,f.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"roughness",pu,(()=>1))]);const Yu=ju("albedoTexture");(0,f.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Yu.scale),(0,f.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Yu.offset),(0,f.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Yu.rotation);const Fu=ju("metallicTexture");(0,f.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Fu.scale),(0,f.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Fu.offset),(0,f.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Fu.rotation),(0,f.m)("/materials/{}/emissiveFactor",[new Lu(P.e.ANIMATIONTYPE_COLOR3,"emissiveColor",ru,(()=>3))]);const su=ju("bumpTexture");(0,f.m)("/materials/{}/normalTexture/scale",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",pu,(()=>1))]),(0,f.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",su.scale),(0,f.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",su.offset),(0,f.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",su.rotation),(0,f.m)("/materials/{}/occlusionTexture/strength",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",pu,(()=>1))]);const Au=ju("ambientTexture");(0,f.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Au.scale),(0,f.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Au.offset),(0,f.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Au.rotation);const tu=ju("emissiveTexture");(0,f.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",tu.scale),(0,f.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",tu.offset),(0,f.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",tu.rotation),(0,f.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",pu,(()=>1))]),(0,f.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",pu,(()=>1))]);const eu=ju("anisotropy.texture");(0,f.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",eu.scale),(0,f.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",eu.offset),(0,f.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",eu.rotation),(0,f.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",pu,(()=>1))]),(0,f.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",pu,(()=>1))]);const cu=ju("clearCoat.texture");(0,f.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",cu.scale),(0,f.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",cu.offset),(0,f.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",cu.rotation);const nu=ju("clearCoat.bumpTexture");(0,f.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",pu,(()=>1))]),(0,f.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",nu.scale),(0,f.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",nu.offset),(0,f.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",nu.rotation);const Vu=ju("clearCoat.textureRoughness");(0,f.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Vu.scale),(0,f.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Vu.offset),(0,f.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Vu.rotation),(0,f.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",pu,(()=>1))]),(0,f.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",pu,(()=>1))]),(0,f.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",pu,(()=>1))]),(0,f.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",pu,(()=>1))]),(0,f.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",pu,(()=>1))]),(0,f.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",pu,(()=>1))]),(0,f.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",pu,(()=>1))]);const Tu=ju("iridescence.texture");(0,f.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Tu.scale),(0,f.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Tu.offset),(0,f.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Tu.rotation);const Ru=ju("iridescence.thicknessTexture");(0,f.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Ru.scale),(0,f.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Ru.offset),(0,f.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Ru.rotation),(0,f.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Lu(P.e.ANIMATIONTYPE_COLOR3,"sheen.color",ru,(()=>3))]),(0,f.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",pu,(()=>1))]);const Xu=ju("sheen.texture");(0,f.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Xu.scale),(0,f.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Xu.offset),(0,f.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Xu.rotation);const Wu=ju("sheen.textureRoughness");(0,f.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Wu.scale),(0,f.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Wu.offset),(0,f.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Wu.rotation),(0,f.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",pu,(()=>1))]),(0,f.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Lu(P.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",ru,(()=>3))]);const fu=ju("metallicReflectanceTexture");(0,f.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",fu.scale),(0,f.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",fu.offset),(0,f.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",fu.rotation);const iu=ju("reflectanceTexture");(0,f.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",iu.scale),(0,f.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",iu.offset),(0,f.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",iu.rotation),(0,f.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",pu,(()=>1))]);const Su=ju("subSurface.refractionIntensityTexture");(0,f.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Su.scale),(0,f.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Su.offset),(0,f.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Su.rotation),(0,f.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Lu(P.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",ru,(()=>3))]),(0,f.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",pu,(()=>1))]),(0,f.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",pu,(()=>1))]);const vu=ju("subSurface.thicknessTexture");(0,f.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",vu.scale),(0,f.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",vu.offset),(0,f.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",vu.rotation),(0,f.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Lu(P.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",pu,(()=>1))]);const Iu=ju("subSurface.translucencyIntensityTexture");(0,f.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Iu.scale),(0,f.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Iu.offset),(0,f.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Iu.rotation),(0,f.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Lu(P.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",ru,(()=>3))]);const Du=ju("subSurface.translucencyColorTexture");(0,f.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Du.scale),(0,f.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Du.offset),(0,f.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Du.rotation),(0,f.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new Zu(P.e.ANIMATIONTYPE_COLOR3,"diffuse",ru,(()=>3))]),(0,f.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Zu(P.e.ANIMATIONTYPE_FLOAT,"intensity",pu,(()=>1))]),(0,f.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new Zu(P.e.ANIMATIONTYPE_FLOAT,"range",pu,(()=>1))]),(0,f.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Zu(P.e.ANIMATIONTYPE_FLOAT,"innerAngle",Cu,(()=>1))]),(0,f.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Zu(P.e.ANIMATIONTYPE_FLOAT,"angle",Cu,(()=>1))]),(0,f.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new Zu(P.e.ANIMATIONTYPE_COLOR3,"diffuse",ru,(()=>3))]),(0,f.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Zu(P.e.ANIMATIONTYPE_FLOAT,"intensity",pu,(()=>1))]);const ou="KHR_animation_pointer";class yu{constructor(H){this.name=ou,this._loader=H,this._pathToObjectConverter=(0,f.k)(this._loader.xh)}get enabled(){return this._loader.isExtensionUsed(ou)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(H,u,J,O,U){var h;const w=null===(h=O.target.extensions)||void 0===h?void 0:h.KHR_animation_pointer;if(!w||!this._pathToObjectConverter)return null;"pointer"!==O.target.path&&r.b.Warn(`${H}/target/path: Value (${O.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=O.target.node&&r.b.Warn(`${H}/target/node: Value (${O.target.node}) must not be present when using the ${this.name} extension`);const g=`${H}/extensions/${this.name}`,B=w.pointer;if(!B)throw new Error(`${g}: Pointer is missing`);try{const h=this._pathToObjectConverter.convert(B);if(!h.info.interpolation)throw new Error(`${g}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(H,u,J,O,{object:h.object,info:h.info.interpolation},U)}catch(b){return r.b.Warn(`${g}/pointer: Invalid pointer (${B}) skipped`),null}}}W(ou),X(ou,!0,(H=>new yu(H)));class xu{constructor(H,u,J){this.frame=H,this.action=u,this.onlyOnce=J,this.isDone=!1}_clone(){return new xu(this.frame,this.action,this.onlyOnce)}}var zu=J(12199),Ku=J(12247),Nu=J(12240);class qu{get loop(){return this._loop}set loop(H){H!==this._loop&&(this._loop=H,this.updateOptions({loop:H}))}get currentTime(){var H;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(H=Ku.d.audioEngine)&&void 0!==H&&H.audioContext&&(this.isPlaying||this.isPaused)){const H=this.isPaused?0:Ku.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+H}return 0}get spatialSound(){return this._spatialSound}set spatialSound(H){if(H==this._spatialSound)return;const u=this.isPlaying;this.pause(),H?(this._spatialSound=H,this._updateSpatialParameters()):this._disableSpatialSound(),u&&this.play()}constructor(H,u,J){var O;let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new d.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=U.lu.Zero(),this._localDirection=new U.lu(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=H,J=J||l.e.LastCreatedScene)if(this._scene=J,qu._SceneComponentInitialization(J),this._readyToPlayCallback=h,this._customAttenuationFunction=(H,u,J,O,U)=>u<J?H*(1-u/J):0,g&&(this.autoplay=g.autoplay||!1,this._loop=g.loop||!1,void 0!==g.volume&&(this._volume=g.volume),this._spatialSound=g.spatialSound??!1,this.maxDistance=g.maxDistance??100,this.useCustomAttenuation=g.useCustomAttenuation??!1,this.rolloffFactor=g.rolloffFactor||1,this.refDistance=g.refDistance||1,this.distanceModel=g.distanceModel||"linear",this._playbackRate=g.playbackRate||1,this._streaming=g.streaming??!1,this._length=g.length,this._offset=g.offset),null!==(O=Ku.d.audioEngine)&&void 0!==O&&O.canUseWebAudio&&Ku.d.audioEngine.audioContext){this._soundGain=Ku.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let H=!0;if(u)try{"string"===typeof u?(this._urlType="String",this._url=u):u instanceof ArrayBuffer?this._urlType="ArrayBuffer":u instanceof HTMLMediaElement?this._urlType="MediaElement":u instanceof MediaStream?this._urlType="MediaStream":u instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(u)&&(this._urlType="Array");let J=[],O=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ku.d.audioEngine.audioContext.createMediaElementSource(u),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Ku.d.audioEngine.audioContext.createMediaStreamSource(u),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":u.byteLength>0&&(O=!0,this._soundLoaded(u));break;case"AudioBuffer":this._audioBufferLoaded(u);break;case"String":J.push(u);case"Array":0===J.length&&(J=u);for(let H=0;H<J.length;H++){const u=J[H];if(O=g&&g.skipCodecCheck||-1!==u.indexOf(".mp3",u.length-4)&&Ku.d.audioEngine.isMP3supported||-1!==u.indexOf(".ogg",u.length-4)&&Ku.d.audioEngine.isOGGsupported||-1!==u.indexOf(".wav",u.length-4)||-1!==u.indexOf(".m4a",u.length-4)||-1!==u.indexOf(".mp4",u.length-4)||-1!==u.indexOf("blob:"),O){this._streaming?(this._htmlAudioElement=new Audio(u),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,w.Tools.SetCorsBehavior(u,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(u,(H=>{this._soundLoaded(H)}),void 0,!0,!0,(H=>{H&&r.b.Error("XHR "+H.status+" error on: "+u+"."),r.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:H=!1}H?O||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):r.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(B){r.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Ku.d.audioEngine&&!Ku.d.audioEngine.WarnedWebAudioUnsupported&&(r.b.Error("Web Audio is not supported by your browser."),Ku.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var H;null!==(H=Ku.d.audioEngine)&&void 0!==H&&H.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(H){var u;null!==(u=Ku.d.audioEngine)&&void 0!==u&&u.audioContext&&(this._audioBuffer=H,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(H){var u;null!==(u=Ku.d.audioEngine)&&void 0!==u&&u.audioContext&&Ku.d.audioEngine.audioContext.decodeAudioData(H,(H=>{this._audioBufferLoaded(H)}),(H=>{r.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+H)}))}setAudioBuffer(H){var u;null!==(u=Ku.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&(this._audioBuffer=H,this._isReadyToPlay=!0)}updateOptions(H){H&&(this.loop=H.loop??this.loop,this.maxDistance=H.maxDistance??this.maxDistance,this.useCustomAttenuation=H.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=H.rolloffFactor??this.rolloffFactor,this.refDistance=H.refDistance??this.refDistance,this.distanceModel=H.distanceModel??this.distanceModel,this._playbackRate=H.playbackRate??this._playbackRate,this._length=H.length??void 0,this.spatialSound=H.spatialSound??this._spatialSound,this._setOffset(H.offset??void 0),this.setVolume(H.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var H;null!==(H=Ku.d.audioEngine)&&void 0!==H&&H.canUseWebAudio&&Ku.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Ku.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var H;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(H=this._soundPanner)||void 0===H||H.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var H;null!==(H=Ku.d.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(H){var u;null!==(u=Ku.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(H),this._isOutputConnected=!0)}setDirectionalCone(H,u,J){u<H?r.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=H,this._coneOuterAngle=u,this._coneOuterGain=J,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(H){if(H!=this._coneInnerAngle){var u;if(this._coneOuterAngle<H)return void r.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=H,null!==(u=Ku.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(H){if(H!=this._coneOuterAngle){var u;if(H<this._coneInnerAngle)return void r.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=H,null!==(u=Ku.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(H){var u;H.equals(this._position)||(this._position.O(H),null!==(u=Ku.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(H){var u;this._localDirection=H,null!==(u=Ku.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const H=this._connectedTransformNode.getWorldMatrix(),u=U.lu.TransformNormal(this._localDirection,H);u.normalize(),this._soundPanner.orientationX.value=u.x,this._soundPanner.orientationY.value=u.y,this._soundPanner.orientationZ.value=u.z}updateDistanceFromListener(){var H;if(null!==(H=Ku.d.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const H=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.ru(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,H,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(H){this._customAttenuationFunction=H}play(H,u,J){var O;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(O=Ku.d.audioEngine)&&void 0!==O&&O.audioContext)try{var U,h;this._clearTimeoutsAndObservers();let O=H?(null===(U=Ku.d.audioEngine)||void 0===U?void 0:U.audioContext.currentTime)+H:null===(h=Ku.d.audioEngine)||void 0===h?void 0:h.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Ku.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const H=()=>{var J;if(null!==(J=Ku.d.audioEngine)&&void 0!==J&&J.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=u??0;const J=this._htmlAudioElement.play();void 0!==J&&J.catch((()=>{var u,J;(null===(u=Ku.d.audioEngine)||void 0===u||u.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(J=Ku.d.audioEngine)||void 0===J?void 0:J.onAudioUnlockedObservable.addOnce((()=>{H()})))}))}else{var O;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(O=Ku.d.audioEngine)||void 0===O?void 0:O.onAudioUnlockedObservable.addOnce((()=>{H()}))}};H()}}else{var w;const U=()=>{var U;if(null!==(U=Ku.d.audioEngine)&&void 0!==U&&U.audioContext){var h;if(J=J||this._length,void 0!==u&&this._setOffset(u),this._soundSource){const H=this._soundSource;H.onended=()=>{H.disconnect()}}if(this._soundSource=null===(h=Ku.d.audioEngine)||void 0===h?void 0:h.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var w;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==u&&(this._soundSource.loopStart=u),void 0!==J&&(this._soundSource.loopEnd=(0|u)+J),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},O=H?(null===(w=Ku.d.audioEngine)||void 0===w?void 0:w.audioContext.currentTime)+H:Ku.d.audioEngine.audioContext.currentTime;const U=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(O,U,this.loop?void 0:J)}}};"suspended"===(null===(w=Ku.d.audioEngine)||void 0===w?void 0:w.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var H;"suspended"===(null===(H=Ku.d.audioEngine)||void 0===H?void 0:H.audioContext.state)?(Ku.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Ku.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{U()})))):U()}),500):U()}this._startTime=O,this.isPlaying=!0,this.isPaused=!1}catch(g){r.b.Error("Error while trying to play audio: "+this.name+", "+g.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(H){var u;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var J;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(J=this._streamingSource)||void 0===J||J.disconnect();this.isPlaying=!1}else if(null!==(u=Ku.d.audioEngine)&&void 0!==u&&u.audioContext&&this._soundSource){const u=H?Ku.d.audioEngine.audioContext.currentTime+H:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(u)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var H;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var u;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(u=this._streamingSource)||void 0===u||u.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(H=Ku.d.audioEngine)&&void 0!==H&&H.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Ku.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(H,u){var J;null!==(J=Ku.d.audioEngine)&&void 0!==J&&J.canUseWebAudio&&this._soundGain&&(u&&Ku.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Ku.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Ku.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(H,Ku.d.audioEngine.audioContext.currentTime+u)):this._soundGain.gain.value=H),this._volume=H}setPlaybackRate(H){this._playbackRate=H,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(H){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=H,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=H=>this._onRegisterAfterWorldMatrixUpdate(H),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(H){var u;if(H.getBoundingInfo){const u=H.getBoundingInfo();this.setPosition(u.boundingSphere.centerWorld)}else this.setPosition(H.absolutePosition);null!==(u=Ku.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const H=()=>{(0,Nu.c)((()=>this._isReadyToPlay),(()=>{J._audioBuffer=this.getAudioBuffer(),J._isReadyToPlay=!0,J.autoplay&&J.play(0,this._offset,this._length)}),void 0,300)},u={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},J=new qu(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,u);return this.useCustomAttenuation&&J.setAttenuationFunction(this._customAttenuationFunction),J.setPosition(this._position),J.setPlaybackRate(this._playbackRate),H(),J}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const H={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(H.connectedMeshId=this._connectedTransformNode.id),H.position=this._position.Hg(),H.refDistance=this.refDistance,H.distanceModel=this.distanceModel,H.isDirectional=this._isDirectional,H.localDirectionToMesh=this._localDirection.Hg(),H.coneInnerAngle=this._coneInnerAngle,H.coneOuterAngle=this._coneOuterAngle,H.coneOuterGain=this._coneOuterGain),H}static Parse(H,u,J,O){const h=H.name;let w;w=H.url?J+H.url:J+h;const g={autoplay:H.autoplay,loop:H.loop,volume:H.volume,spatialSound:H.spatialSound,maxDistance:H.maxDistance,rolloffFactor:H.rolloffFactor,refDistance:H.refDistance,distanceModel:H.distanceModel,playbackRate:H.playbackRate};let B;if(O){const H=()=>{(0,Nu.c)((()=>O._isReadyToPlay),(()=>{B._audioBuffer=O.getAudioBuffer(),B._isReadyToPlay=!0,B.autoplay&&B.play(0,B._offset,B._length)}),void 0,300)};B=new qu(h,new ArrayBuffer(0),u,null,g),H()}else B=new qu(h,w,u,(()=>{u.removePendingData(B)}),g),u.addPendingData(B);if(H.position){const u=U.lu.Cu(H.position);B.setPosition(u)}if(H.isDirectional&&(B.setDirectionalCone(H.coneInnerAngle||360,H.coneOuterAngle||360,H.coneOuterGain||0),H.localDirectionToMesh)){const u=U.lu.Cu(H.localDirectionToMesh);B.setLocalDirectionToMesh(u)}if(H.connectedMeshId){const J=u.getMeshById(H.connectedMeshId);J&&B.attachToMesh(J)}return H.metadata&&(B.metadata=H.metadata),B}_setOffset(H){this._offset!==H&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=H)}_clearTimeoutsAndObservers(){var H;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(H=Ku.d.audioEngine)||void 0===H||H.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}qu._SceneComponentInitialization=H=>{throw(0,zu.d)("AudioSceneComponent")},(0,LH.f)("BABYLON.Sound",qu);class Eu{constructor(H,u,J){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],u.length!==J.length)throw new Error("Sounds length does not equal weights length");this.loop=H,this._weights=J;let O=0;for(const h of J)O+=h;const U=O>0?1/O:0;for(let h=0;h<this._weights.length;h++)this._weights[h]*=U;this._sounds=u;for(const h of this._sounds)h.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(H){if(H!==this._coneInnerAngle){if(this._coneOuterAngle<H)return void r.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=H;for(const u of this._sounds)u.directionalConeInnerAngle=H}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(H){if(H!==this._coneOuterAngle){if(H<this._coneInnerAngle)return void r.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=H;for(const u of this._sounds)u.directionalConeOuterAngle=H}}get volume(){return this._volume}set volume(H){if(H!==this._volume)for(const u of this._sounds)u.setVolume(H)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(H){if(!this.isPaused){this.stop();const H=Math.random();let u=0;for(let J=0;J<this._weights.length;J++)if(u+=this._weights[J],H<=u){this._currentIndex=J;break}}const u=this._sounds[this._currentIndex??0];u.isReady()?u.play(0,this.isPaused?void 0:H):u.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Qu{constructor(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(H=H||l.e.LastCreatedScene)&&(this._scene=H,this.soundCollection=[],this._options=u,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var H;null!==(H=Ku.d.audioEngine)&&void 0!==H&&H.canUseWebAudio&&Ku.d.audioEngine.audioContext&&(this._outputAudioNode=Ku.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Ku.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Ku.d.audioEngine&&Ku.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(H){var u;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(u=Ku.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&H.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==H.soundTrackId&&(-1===H.soundTrackId?this._scene.mainSoundTrack.removeSound(H):this._scene.soundTracks&&this._scene.soundTracks[H.soundTrackId].removeSound(H)),this.soundCollection.push(H),H.soundTrackId=this.id}removeSound(H){const u=this.soundCollection.indexOf(H);-1!==u&&this.soundCollection.splice(u,1)}setVolume(H){var u;null!==(u=Ku.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=H)}switchPanningModelToHRTF(){var H;if(null!==(H=Ku.d.audioEngine)&&void 0!==H&&H.canUseWebAudio)for(let u=0;u<this.soundCollection.length;u++)this.soundCollection[u].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var H;if(null!==(H=Ku.d.audioEngine)&&void 0!==H&&H.canUseWebAudio)for(let u=0;u<this.soundCollection.length;u++)this.soundCollection[u].switchPanningModelToEqualPower()}connectToAnalyser(H){var u;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=H,null!==(u=Ku.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Ku.d.audioEngine.masterGain))}}var HJ=J(12606),uJ=J(12568),JJ=J(12178);Ku.d.AudioEngineFactory=(H,u,J)=>new OJ(H,u,J);class OJ{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new d.b,this.onAudioLockedObservable=new d.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,JJ.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const O=document.createElement("audio");this._hostElement=H,this._audioContext=u,this._audioDestination=J;try{O&&O.canPlayType&&(O.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||O.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(U){}try{O&&O.canPlayType&&O.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(U){}}lock(){this._triggerSuspendedState()}unlock(){var H,u;if("running"===(null===(H=this._audioContext)||void 0===H?void 0:H.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(u=this._audioContext)||void 0===u||u.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{r.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var H;null===(H=this._audioContext)||void 0===H||H.addEventListener("statechange",(()=>{var H;this.unlocked&&"running"!==(null===(H=this._audioContext)||void 0===H?void 0:H.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var H;return null!==(H=this._audioContext)&&void 0!==H&&H.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(H){this.canUseWebAudio=!1,r.b.Error("Web Audio: "+H.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(H){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const H=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",u=document.createElement("style");u.appendChild(document.createTextNode(H)),document.getElementsByTagName("head")[0].appendChild(u),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var H;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(H=this._audioContext)||void 0===H||H.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(H){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=H)}connectToAnalyser(H){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=H,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var UJ=J(12197);(0,J(13700).h)(HJ.d.NAME_AUDIO,((H,u,J,O)=>{let U,h=[];if(J.Qm=J.Qm||[],void 0!==H.Qm&&null!==H.Qm)for(let g=0,B=H.Qm.length;g<B;g++){var w;const B=H.Qm[g];null!==(w=Ku.d.audioEngine)&&void 0!==w&&w.canUseWebAudio?(B.url||(B.url=B.name),h[B.url]?J.Qm.push(qu.Parse(B,u,O,h[B.url])):(U=qu.Parse(B,u,O),h[B.url]=U,J.Qm.push(U))):J.Qm.push(new qu(B.name,null,u))}h=[]})),Object.defineProperty(uJ.d.prototype,"mainSoundTrack",{get:function(){let H=this._getComponent(HJ.d.NAME_AUDIO);return H||(H=new hJ(this),this.o(H)),this._mainSoundTrack||(this._mainSoundTrack=new Qu(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),uJ.d.prototype.getSoundByName=function(H){let u;for(u=0;u<this.mainSoundTrack.soundCollection.length;u++)if(this.mainSoundTrack.soundCollection[u].name===H)return this.mainSoundTrack.soundCollection[u];if(this.soundTracks)for(let J=0;J<this.soundTracks.length;J++)for(u=0;u<this.soundTracks[J].soundCollection.length;u++)if(this.soundTracks[J].soundCollection[u].name===H)return this.soundTracks[J].soundCollection[u];return null},Object.defineProperty(uJ.d.prototype,"audioEnabled",{get:function(){let H=this._getComponent(HJ.d.NAME_AUDIO);return H||(H=new hJ(this),this.o(H)),H.audioEnabled},set:function(H){let u=this._getComponent(HJ.d.NAME_AUDIO);u||(u=new hJ(this),this.o(u)),H?u.enableAudio():u.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(uJ.d.prototype,"headphone",{get:function(){let H=this._getComponent(HJ.d.NAME_AUDIO);return H||(H=new hJ(this),this.o(H)),H.headphone},set:function(H){let u=this._getComponent(HJ.d.NAME_AUDIO);u||(u=new hJ(this),this.o(u)),H?u.switchAudioModeForHeadphones():u.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(uJ.d.prototype,"audioListenerPositionProvider",{get:function(){let H=this._getComponent(HJ.d.NAME_AUDIO);return H||(H=new hJ(this),this.o(H)),H.audioListenerPositionProvider},set:function(H){let u=this._getComponent(HJ.d.NAME_AUDIO);if(u||(u=new hJ(this),this.o(u)),H&&"function"!==typeof H)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");u.audioListenerPositionProvider=H},enumerable:!0,configurable:!0}),Object.defineProperty(uJ.d.prototype,"audioListenerRotationProvider",{get:function(){let H=this._getComponent(HJ.d.NAME_AUDIO);return H||(H=new hJ(this),this.o(H)),H.audioListenerRotationProvider},set:function(H){let u=this._getComponent(HJ.d.NAME_AUDIO);if(u||(u=new hJ(this),this.o(u)),H&&"function"!==typeof H)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");u.audioListenerRotationProvider=H},enumerable:!0,configurable:!0}),Object.defineProperty(uJ.d.prototype,"audioPositioningRefreshRate",{get:function(){let H=this._getComponent(HJ.d.NAME_AUDIO);return H||(H=new hJ(this),this.o(H)),H.audioPositioningRefreshRate},set:function(H){let u=this._getComponent(HJ.d.NAME_AUDIO);u||(u=new hJ(this),this.o(u)),u.audioPositioningRefreshRate=H},enumerable:!0,configurable:!0});class hJ{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(H){this.name=HJ.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new U.lu,this._cachedCameraPosition=new U.lu,this._lastCheck=0,this._invertMatrixTemp=new U.Matrix,this._cameraDirectionTemp=new U.lu,(H=H||l.e.LastCreatedScene)&&(this.pu=H,H.soundTracks=[],H.Qm=[])}register(){this.pu._afterRenderStage.registerStep(HJ.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(H){if(H.Qm=[],this.pu.soundTracks)for(let u=0;u<this.pu.soundTracks.length;u++){const J=this.pu.soundTracks[u];for(let u=0;u<J.soundCollection.length;u++)H.Qm.push(J.soundCollection[u].serialize())}}addFromContainer(H){if(H.Qm)for(const u of H.Qm)u.play(),u.autoplay=!0,this.pu.mainSoundTrack.addSound(u)}removeFromContainer(H){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(H.Qm)for(const J of H.Qm)J.stop(),J.autoplay=!1,this.pu.mainSoundTrack.removeSound(J),u&&J.dispose()}dispose(){const H=this.pu;if(H._mainSoundTrack&&H.mainSoundTrack.dispose(),H.soundTracks)for(let u=0;u<H.soundTracks.length;u++)H.soundTracks[u].dispose()}disableAudio(){const H=this.pu;let u;for(this._audioEnabled=!1,Ku.d.audioEngine&&Ku.d.audioEngine.audioContext&&Ku.d.audioEngine.audioContext.suspend(),u=0;u<H.mainSoundTrack.soundCollection.length;u++)H.mainSoundTrack.soundCollection[u].pause();if(H.soundTracks)for(u=0;u<H.soundTracks.length;u++)for(let J=0;J<H.soundTracks[u].soundCollection.length;J++)H.soundTracks[u].soundCollection[J].pause()}enableAudio(){const H=this.pu;let u;for(this._audioEnabled=!0,Ku.d.audioEngine&&Ku.d.audioEngine.audioContext&&Ku.d.audioEngine.audioContext.resume(),u=0;u<H.mainSoundTrack.soundCollection.length;u++)H.mainSoundTrack.soundCollection[u].isPaused&&H.mainSoundTrack.soundCollection[u].play();if(H.soundTracks)for(u=0;u<H.soundTracks.length;u++)for(let J=0;J<H.soundTracks[u].soundCollection.length;J++)H.soundTracks[u].soundCollection[J].isPaused&&H.soundTracks[u].soundCollection[J].play()}switchAudioModeForHeadphones(){const H=this.pu;if(this._headphone=!0,H.mainSoundTrack.switchPanningModelToHRTF(),H.soundTracks)for(let u=0;u<H.soundTracks.length;u++)H.soundTracks[u].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const H=this.pu;if(this._headphone=!1,H.mainSoundTrack.switchPanningModelToEqualPower(),H.soundTracks)for(let u=0;u<H.soundTracks.length;u++)H.soundTracks[u].switchPanningModelToEqualPower()}_afterRender(){const H=UJ.e.Now;if(this._lastCheck&&H-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=H;const u=this.pu;if(!this._audioEnabled||!u._mainSoundTrack||!u.soundTracks||0===u._mainSoundTrack.soundCollection.length&&1===u.soundTracks.length)return;const J=Ku.d.audioEngine;if(J&&J.audioContext){let H,O=u.activeCamera;if(u.activeCameras&&u.activeCameras.length>0&&(O=u.activeCameras[0]),this.audioListenerPositionProvider){const H=this.audioListenerPositionProvider();J.audioContext.listener.setPosition(H.x||0,H.y||0,H.z||0)}else O?this._cachedCameraPosition.equals(O.globalPosition)||(this._cachedCameraPosition.O(O.globalPosition),J.audioContext.listener.setPosition(O.globalPosition.x,O.globalPosition.y,O.globalPosition.z)):J.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const H=this.audioListenerRotationProvider();J.audioContext.listener.setOrientation(H.x||0,H.y||0,H.z||0,0,1,0)}else O?(O.rigCameras&&O.rigCameras.length>0&&(O=O.rigCameras[0]),O.getViewMatrix().invertToRef(this._invertMatrixTemp),U.lu.TransformNormalToRef(hJ._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.O(this._cameraDirectionTemp),J.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):J.audioContext.listener.setOrientation(0,0,0,0,1,0);for(H=0;H<u.mainSoundTrack.soundCollection.length;H++){const J=u.mainSoundTrack.soundCollection[H];J.useCustomAttenuation&&J.updateDistanceFromListener()}if(u.soundTracks)for(H=0;H<u.soundTracks.length;H++)for(let J=0;J<u.soundTracks[H].soundCollection.length;J++){const O=u.soundTracks[H].soundCollection[J];O.useCustomAttenuation&&O.updateDistanceFromListener()}}}}hJ._CameraDirection=new U.lu(0,0,-1),qu._SceneComponentInitialization=H=>{let u=H._getComponent(HJ.d.NAME_AUDIO);u||(u=new hJ(H),H.o(u))};const wJ="MSFT_audio_emitter";class gJ{constructor(H){this.name=wJ,this._loader=H,this.enabled=this._loader.isExtensionUsed(wJ)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const H=this._loader.xh.extensions;if(H&&H[this.name]){const u=H[this.name];this._clips=u.clips,this._emitters=u.emitters,v.Assign(this._clips),v.Assign(this._emitters)}}loadSceneAsync(H,u){return D.LoadExtensionAsync(H,u,this.name,(async(J,O)=>{const U=new Array;U.push(this._loader.loadSceneAsync(H,u));for(const H of O.emitters){const u=v.Get(`${J}/emitters`,this._emitters,H);if(void 0!=u.refDistance||void 0!=u.maxDistance||void 0!=u.rolloffFactor||void 0!=u.distanceModel||void 0!=u.innerAngle||void 0!=u.outerAngle)throw new Error(`${J}: Direction or Distance properties are not allowed on emitters attached to a scene`);U.push(this._loadEmitterAsync(`${J}/emitters/${u.index}`,u))}await Promise.all(U)}))}loadNodeAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(H,O)=>{const h=new Array,g=await this._loader.loadNodeAsync(H,u,(u=>{for(const J of O.emitters){const O=v.Get(`${H}/emitters`,this._emitters,J);h.push(this._loadEmitterAsync(`${H}/emitters/${O.index}`,O).then((()=>{for(const H of O._babylonSounds)H.attachToMesh(u),void 0==O.innerAngle&&void 0==O.outerAngle||(H.setLocalDirectionToMesh(U.lu.Forward()),H.setDirectionalCone(2*w.Tools.ToDegrees(void 0==O.innerAngle?Math.PI:O.innerAngle),2*w.Tools.ToDegrees(void 0==O.outerAngle?Math.PI:O.outerAngle),0))})))}J(u)}));return await Promise.all(h),g}))}loadAnimationAsync(H,u){return D.LoadExtensionAsync(H,u,this.name,(async(J,O)=>{const U=await this._loader.loadAnimationAsync(H,u),h=new Array;v.Assign(O.events);for(const w of O.events)h.push(this._loadAnimationEventAsync(`${J}/events/${w.index}`,H,u,w,U));return await Promise.all(h),U}))}_loadClipAsync(H,u){if(u._objectURL)return u._objectURL;let J;if(u.uri)J=this._loader.loadUriAsync(H,u,u.uri);else{const O=v.Get(`${H}/bufferView`,this._loader.xh.bufferViews,u.bufferView);J=this._loader.loadBufferViewAsync(`/bufferViews/${O.index}`,O)}return u._objectURL=J.then((H=>URL.createObjectURL(new Blob([H],{type:u.mimeType})))),u._objectURL}_loadEmitterAsync(H,u){if(u._babylonSounds=u._babylonSounds||[],!u._babylonData){const H=new Array,J=u.name||`emitter${u.index}`,O={loop:!1,autoplay:!1,volume:void 0==u.volume?1:u.volume};for(let h=0;h<u.clips.length;h++){const U=`/extensions/${this.name}/clips`,w=v.Get(U,this._clips,u.clips[h].clip);H.push(this._loadClipAsync(`${U}/${u.clips[h].clip}`,w).then((H=>{const U=u._babylonSounds[h]=new qu(J,H,this._loader.babylonScene,null,O);U.refDistance=u.refDistance||1,U.maxDistance=u.maxDistance||256,U.rolloffFactor=u.rolloffFactor||1,U.distanceModel=u.distanceModel||"exponential"})))}const U=Promise.all(H).then((()=>{const H=u.clips.map((H=>H.weight||1)),J=new Eu(u.loop||!1,u._babylonSounds,H);u.innerAngle&&(J.directionalConeInnerAngle=2*w.Tools.ToDegrees(u.innerAngle)),u.outerAngle&&(J.directionalConeOuterAngle=2*w.Tools.ToDegrees(u.outerAngle)),u.volume&&(J.volume=u.volume),u._babylonData.sound=J}));u._babylonData={loaded:U}}return u._babylonData.loaded}_getEventAction(H,u,J,O,U){switch(J){case"play":return H=>{const J=(U||0)+(H-O);u.play(J)};case"stop":return()=>{u.stop()};case"pause":return()=>{u.pause()};default:throw new Error(`${H}: Unsupported action ${J}`)}}_loadAnimationEventAsync(H,u,J,O,U){if(0==U.targetedAnimations.length)return Promise.resolve();const h=U.targetedAnimations[0],w=O.Ou,g=v.Get(`/extensions/${this.name}/emitters`,this._emitters,w);return this._loadEmitterAsync(H,g).then((()=>{const u=g._babylonData.sound;if(u){const J=new xu(O.time,this._getEventAction(H,u,O.action,O.time,O.startOffset));h.animation.addEvent(J),U.onAnimationGroupEndObservable.add((()=>{u.stop()})),U.onAnimationGroupPauseObservable.add((()=>{u.pause()}))}}))}}W(wJ),X(wJ,!0,(H=>new gJ(H)));const BJ="MSFT_lod";class bJ{constructor(H){var u;this.name=BJ,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new d.b,this.onMaterialLODsLoadedObservable=new d.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=H,this.maxLODsToLoad=(null===(u=this._loader.parent.extensionOptions[BJ])||void 0===u?void 0:u.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(BJ)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let H=0;H<this._nodePromiseLODs.length;H++){const u=Promise.all(this._nodePromiseLODs[H]).then((()=>{0!==H&&(this._loader.endPerformanceCounter(`Node LOD ${H}`),this._loader.log(`Loaded node LOD ${H}`)),this.onNodeLODsLoadedObservable.notifyObservers(H),H!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${H+1}`),this._loadBufferLOD(this._nodeBufferLODs,H+1),this._nodeSignalLODs[H]&&this._nodeSignalLODs[H].resolve())}));this._loader._completePromises.push(u)}for(let H=0;H<this._materialPromiseLODs.length;H++){const u=Promise.all(this._materialPromiseLODs[H]).then((()=>{0!==H&&(this._loader.endPerformanceCounter(`Material LOD ${H}`),this._loader.log(`Loaded material LOD ${H}`)),this.onMaterialLODsLoadedObservable.notifyObservers(H),H!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${H+1}`),this._loadBufferLOD(this._materialBufferLODs,H+1),this._materialSignalLODs[H]&&this._materialSignalLODs[H].resolve())}));this._loader._completePromises.push(u)}}loadSceneAsync(H,u){const J=this._loader.loadSceneAsync(H,u);return this._loadBufferLOD(this._bufferLODs,0),J}loadNodeAsync(H,u,J){return D.LoadExtensionAsync(H,u,this.name,(async(H,U)=>{let h;const w=this._getLODs(H,u,this._loader.xh.nodes,U.ids);this._loader.logOpen(`${H}`);for(let u=0;u<w.length;u++){const H=w[u];0!==u&&(this._nodeIndexLOD=u,this._nodeSignalLODs[u]=this._nodeSignalLODs[u]||new O);const U=H=>{J(H),H.og(!1)},g=this._loader.loadNodeAsync(`/nodes/${H.index}`,H,U).then((H=>{if(0!==u){const H=w[u-1];H._babylonTransformNode&&(this._disposeTransformNode(H._babylonTransformNode),delete H._babylonTransformNode)}return H.og(!0),H}));this._nodePromiseLODs[u]=this._nodePromiseLODs[u]||[],0===u?h=g:(this._nodeIndexLOD=null,this._nodePromiseLODs[u].push(g))}return this._loader.logClose(),await h}))}_loadMaterialAsync(H,u,J,O,U){return this._nodeIndexLOD?null:D.LoadExtensionAsync(H,u,this.name,(async(H,h)=>{let w;const g=this._getLODs(H,u,this._loader.xh.materials,h.ids);this._loader.logOpen(`${H}`);for(let u=0;u<g.length;u++){const H=g[u];0!==u&&(this._materialIndexLOD=u);const h=this._loader._loadMaterialAsync(`/materials/${H.index}`,H,J,O,(H=>{0===u&&U(H)})).then((H=>{if(0!==u){U(H);const J=g[u-1]._data;J[O]&&(this._disposeMaterials([J[O].babylonMaterial]),delete J[O])}return H}));this._materialPromiseLODs[u]=this._materialPromiseLODs[u]||[],0===u?w=h:(this._materialIndexLOD=null,this._materialPromiseLODs[u].push(h))}return this._loader.logClose(),await w}))}_loadUriAsync(H,u,J){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const U=this._nodeIndexLOD-1;return this._nodeSignalLODs[U]=this._nodeSignalLODs[U]||new O,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(H,u,J)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const U=this._materialIndexLOD-1;return this._materialSignalLODs[U]=this._materialSignalLODs[U]||new O,this._materialSignalLODs[U].promise.then((async()=>await this._loader.loadUriAsync(H,u,J)))}return null}loadBufferAsync(H,u,J,U){if(this._loader.parent.useRangeRequests&&!u.uri){if(!this._loader.bin)throw new Error(`${H}: Uri is missing or the binary glTF is missing its binary chunk`);const u=async(H,u)=>{const h=J,w=h+U-1;let g=H[u];return g?(g.start=Math.min(g.start,h),g.end=Math.max(g.end,w)):(g={start:h,end:w,loaded:new O},H[u]=g),await g.loaded.promise.then((H=>new Uint8Array(H.buffer,H.byteOffset+J-g.start,U)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?u(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?u(this._materialBufferLODs,this._materialIndexLOD):u(this._bufferLODs,0)}return null}_loadBufferLOD(H,u){const J=H[u];J&&(this._loader.log(`Loading buffer range [${J.start}-${J.end}]`),this._loader.bin.readAsync(J.start,J.end-J.start+1).then((H=>{J.loaded.resolve(H)}),(H=>{J.loaded.reject(H)})))}_getLODs(H,u,J,O){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const U=[];for(let h=O.length-1;h>=0;h--)if(U.push(v.Get(`${H}/ids/${O[h]}`,J,O[h])),U.length===this.maxLODsToLoad)return U;return U.push(u),U}_disposeTransformNode(H){const u=[],J=H.material;J&&u.push(J);for(const U of H.getChildMeshes())U.material&&u.push(U.material);H.dispose();const O=u.filter((H=>this._loader.babylonScene.meshes.every((u=>u.material!=H))));this._disposeMaterials(O)}_disposeMaterials(H){const u={};for(const J of H){for(const H of J.getActiveTextures())u[H.uniqueId]=H;J.dispose()}for(const J in u)for(const H of this._loader.babylonScene.materials)H.hasTexture(u[J])&&delete u[J];for(const J in u)u[J].dispose()}}W(BJ),X(BJ,!0,(H=>new bJ(H)));const dJ="MSFT_minecraftMesh";class GJ{constructor(H){this.name=dJ,this._loader=H,this.enabled=this._loader.isExtensionUsed(dJ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtraAsync(H,u,this.name,(async(O,U)=>{if(U){if(!(J instanceof C.b))throw new Error(`${O}: Material type not supported`);const U=this._loader.loadMaterialPropertiesAsync(H,u,J);return J.needAlphaBlending()&&(J.forceDepthWrite=!0,J.separateCullingPass=!0),J.ag=J.forceDepthWrite,J.twoSidedLighting=!0,await U}}))}}W(dJ),X(dJ,!0,(H=>new GJ(H)));const PJ="MSFT_sRGBFactors";class mO{constructor(H){this.name=PJ,this._loader=H,this.enabled=this._loader.isExtensionUsed(PJ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,u,J){return D.LoadExtraAsync(H,u,this.name,(async(O,U)=>{if(U){if(!(J instanceof C.b))throw new Error(`${O}: Material type not supported`);const U=this._loader.loadMaterialPropertiesAsync(H,u,J),h=J.ZH().getEngine().useExactSrgbConversions;return J.albedoTexture||J.albedoColor.toLinearSpaceToRef(J.albedoColor,h),J.reflectivityTexture||J.reflectivityColor.toLinearSpaceToRef(J.reflectivityColor,h),await U}}))}}W(PJ),X(PJ,!0,(H=>new mO(H)));var lJ=J(14007);const rJ={};var pJ=J(14057),aJ=J(14038),kJ=J(14009),CJ=J(14018);function jJ(H,u){for(const J of H)for(const H of J.dataOutputs)if(H.uniqueId===u)return H;throw new Error("Could not find data out connection with unique id "+u)}function MJ(H,u){for(const J of H)if(J instanceof aJ.e)for(const H of J.signalInputs)if(H.uniqueId===u)return H;throw new Error("Could not find signal in connection with unique id "+u)}async function LJ(H,u){const O=await Promise.all(H.allBlocks.map((async H=>{const u=function(H){switch(H){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([J.e(78),J.e(79)]).then(J.bind(J,15451))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await J.e(80).then(J.bind(J,15456))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await J.e(81).then(J.bind(J,15461))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await J.e(82).then(J.bind(J,15467))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await J.e(83).then(J.bind(J,15475))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await J.e(84).then(J.bind(J,15484))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await J.e(85).then(J.bind(J,15486))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await J.e(86).then(J.bind(J,15495))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await J.e(87).then(J.bind(J,15497))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await J.e(89).then(J.bind(J,15524))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await J.e(89).then(J.bind(J,15524))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await J.e(89).then(J.bind(J,15524))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await J.e(89).then(J.bind(J,15524))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await J.e(89).then(J.bind(J,15524))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await J.e(89).then(J.bind(J,15524))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await J.e(90).then(J.bind(J,15531))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await J.e(90).then(J.bind(J,15531))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await J.e(90).then(J.bind(J,15531))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await J.e(90).then(J.bind(J,15531))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await J.e(95).then(J.bind(J,15539))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await J.e(96).then(J.bind(J,15543))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await J.e(97).then(J.bind(J,15550))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await J.e(98).then(J.bind(J,15556))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await J.e(99).then(J.bind(J,15559))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await J.e(100).then(J.bind(J,15565))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await J.e(101).then(J.bind(J,15574))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await J.e(102).then(J.bind(J,15582))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await J.e(103).then(J.bind(J,15589))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await J.e(104).then(J.bind(J,15592))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await J.e(105).then(J.bind(J,15601))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await J.e(106).then(J.bind(J,15608))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await J.e(107).then(J.bind(J,15616))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await J.e(108).then(J.bind(J,15624))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await J.e(109).then(J.bind(J,15629))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await J.e(110).then(J.bind(J,15632))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await J.e(111).then(J.bind(J,15634))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await J.e(112).then(J.bind(J,15640))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await J.e(113).then(J.bind(J,15648))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await J.e(92).then(J.bind(J,15655))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await J.e(114).then(J.bind(J,15662))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await J.e(115).then(J.bind(J,15668))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await J.e(116).then(J.bind(J,15676))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await J.e(93).then(J.bind(J,15680))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await J.e(88).then(J.bind(J,15501))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await J.e(94).then(J.bind(J,15682))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await J.e(94).then(J.bind(J,15682))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await J.e(94).then(J.bind(J,15682))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await J.e(94).then(J.bind(J,15682))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await J.e(94).then(J.bind(J,15682))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await J.e(94).then(J.bind(J,15682))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await J.e(94).then(J.bind(J,15682))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await J.e(94).then(J.bind(J,15682))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await J.e(89).then(J.bind(J,15524))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await J.e(89).then(J.bind(J,15524))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await J.e(89).then(J.bind(J,15524))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await J.e(89).then(J.bind(J,15524))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await J.e(89).then(J.bind(J,15524))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await J.e(89).then(J.bind(J,15524))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await J.e(89).then(J.bind(J,15524))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await J.e(90).then(J.bind(J,15531))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await J.e(90).then(J.bind(J,15531))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await J.e(91).then(J.bind(J,15684))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await J.e(91).then(J.bind(J,15684))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await J.e(91).then(J.bind(J,15684))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await J.e(91).then(J.bind(J,15684))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await J.e(91).then(J.bind(J,15684))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await J.e(91).then(J.bind(J,15684))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await J.e(117).then(J.bind(J,15688))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await J.e(118).then(J.bind(J,15690))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await J.e(119).then(J.bind(J,15696))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await J.e(120).then(J.bind(J,15703))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await J.e(121).then(J.bind(J,15712))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await J.e(122).then(J.bind(J,15718))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await J.e(123).then(J.bind(J,15724))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await J.e(124).then(J.bind(J,15726))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await J.e(125).then(J.bind(J,15735))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await J.e(126).then(J.bind(J,15737))).FlowGraphDataSwitchBlock;default:if(rJ[H])return rJ[H];throw new Error(`Unknown block name ${H}`)}}(H.className);return await u()})));return function(H,u,J){const O=u.coordinator.createGraph(),U=[],h=u.valueParseFunction??kJ.d;for(let w=0;w<H.allBlocks.length;w++){const g=YJ(H.allBlocks[w],{pu:u.coordinator.config.pu,pathConverter:u.pathConverter,assetsContainer:u.coordinator.config.pu,valueParseFunction:h},J[w]);U.push(g),g instanceof pJ.c&&O.addEventBlock(g)}for(const w of U){for(const H of w.dataInputs)for(const u of H.connectedPointIds){const J=jJ(U,u);H.connectTo(J)}if(w instanceof aJ.e)for(const H of w.signalOutputs)for(const u of H.connectedPointIds){const J=MJ(U,u);H.connectTo(J)}}for(const w of H.executionContexts)ZJ(w,{graph:O,valueParseFunction:h},H.rightHanded);return O}(H,u,O)}function ZJ(H,u,J){const O=u.graph.createContext();H.enableLogging&&(O.enableLogging=!0),O.treatDataAsRightHanded=J||!1;const U=u.valueParseFunction??kJ.d;O.uniqueId=H.uniqueId;const h=O.ZH();if(H._assetsContext){var w,g,B,b,d,G,P,mH,l,r;const u=H._assetsContext,J={meshes:null===(w=u.meshes)||void 0===w?void 0:w.map((H=>h.getMeshById(H))),lights:null===(g=u.lights)||void 0===g?void 0:g.map((H=>h.getLightByName(H))),cameras:null===(B=u.cameras)||void 0===B?void 0:B.map((H=>h.getCameraByName(H))),materials:null===(b=u.materials)||void 0===b?void 0:b.map((H=>h.getMaterialById(H))),textures:null===(d=u.textures)||void 0===d?void 0:d.map((H=>h.getTextureByName(H))),animations:null===(G=u.animations)||void 0===G?void 0:G.map((H=>h.animations.find((u=>u.name===H)))),skeletons:null===(P=u.skeletons)||void 0===P?void 0:P.map((H=>h.getSkeletonByName(H))),pm:null===(mH=u.pm)||void 0===mH?void 0:mH.map((H=>h.getParticleSystemById(H))),animationGroups:null===(l=u.animationGroups)||void 0===l?void 0:l.map((H=>h.getAnimationGroupByName(H))),transformNodes:null===(r=u.transformNodes)||void 0===r?void 0:r.map((H=>h.getTransformNodeById(H))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Qm:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};O.assetsContext=J}for(const p in H._userVariables){const u=U(p,H._userVariables,O.assetsContext,h);O.userVariables[p]=u}for(const p in H._connectionValues){const u=U(p,H._connectionValues,O.assetsContext,h);O._setConnectionValueByKey(p,u)}return O}function YJ(H,u,J){const O={},U=u.valueParseFunction??kJ.d;if(H.config)for(const w in H.config)O[w]=U(w,H.config,u.assetsContainer||u.pu,u.pu);if((0,kJ.g)(H.className)){if(!u.pathConverter)throw new Error("Path converter is required for this block");O.pathConverter=u.pathConverter}const h=new J(O);h.uniqueId=H.uniqueId;for(let w=0;w<H.dataInputs.length;w++){const u=h.getDataInput(H.dataInputs[w].name);if(!u)throw new Error("Could not find data input with name "+H.dataInputs[w].name+" in block "+H.className);u.deserialize(H.dataInputs[w])}for(let w=0;w<H.dataOutputs.length;w++){const u=h.getDataOutput(H.dataOutputs[w].name);if(!u)throw new Error("Could not find data output with name "+H.dataOutputs[w].name+" in block "+H.className);u.deserialize(H.dataOutputs[w])}return h.metadata=H.metadata,h.deserialize&&h.deserialize(H),h}function FJ(H){const[u,J]=H.split(":");return sJ({op:u,extension:J})}function sJ(H){var u;let J=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const O=H.extension?null===(u=tJ[H.extension])||void 0===u?void 0:u[H.op]:eJ[H.op];if(!O&&(r.b.Warn(`No mapping found for operation ${H.op} and extension ${H.extension||"KHR_interactivity"}`),J)){const u={},J={flows:{}};if(H.inputValueSockets){u.values={};for(const J in H.inputValueSockets)u.values[J]={name:J}}return H.outputValueSockets&&(J.values={},Object.keys(H.outputValueSockets).forEach((H=>{J.values[H]={name:H}}))),{TG:[],inputs:u,outputs:J}}return O}function AJ(H,u,J){tJ[u]||(tJ[u]={}),tJ[u][H]=J}const tJ={BABYLON:{"flow/log":{TG:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},eJ={"event/onStart":{TG:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{TG:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{TG:["FlowGraphSendCustomEventBlock"],extraProcessor(H,u,J,O,U){if("event/send"!==u.op||!H.configuration||1!==Object.keys(H.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const h=H.configuration.event.value[0];if("number"!==typeof h)throw new Error("Event id should be a number");const w=O.arrays.events[h],g=U[0];return g.config||(g.config={}),g.config.eventId=w.eventId,g.config.eventData=w.eventData,U}},"event/receive":{TG:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(H,u){var J;if(!H.configuration)return r.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const O=H.configuration.event;if(!O)return r.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const U=O.value[0];if("number"!==typeof U)return r.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(J=u.events)||void 0===J?void 0:J[U])?{valid:!0}:(r.b.Error(`Event with id ${U} not found`),{valid:!1,error:`Event with id ${U} not found`})},extraProcessor(H,u,J,O,U){if("event/receive"!==u.op||!H.configuration||1!==Object.keys(H.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const h=H.configuration.event.value[0];if("number"!==typeof h)throw new Error("Event id should be a number");const w=O.arrays.events[h],g=U[0];return g.config||(g.config={}),g.config.eventId=w.eventId,g.config.eventData=w.eventData,U}},"math/e":cJ("FlowGraphEBlock"),"math/pi":cJ("FlowGraphPIBlock"),"math/inf":cJ("FlowGraphInfBlock"),"math/nan":cJ("FlowGraphNaNBlock"),"math/abs":cJ("FlowGraphAbsBlock"),"math/sign":cJ("FlowGraphSignBlock"),"math/trunc":cJ("FlowGraphTruncBlock"),"math/floor":cJ("FlowGraphFloorBlock"),"math/ceil":cJ("FlowGraphCeilBlock"),"math/round":{TG:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,u,J,O,U){var h;return(h=U[0]).config||(h.config={}),U[0].config.roundHalfAwayFromZero=!0,U}},"math/fract":cJ("FlowGraphFractBlock"),"math/neg":cJ("FlowGraphNegationBlock"),"math/add":cJ("FlowGraphAddBlock",["a","b"],!0),"math/sub":cJ("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{TG:["FlowGraphMultiplyBlock"],extraProcessor(H,u,J,O,U){var h;(h=U[0]).config||(h.config={}),U[0].config.useMatrixPerComponent=!0,U[0].config.preventIntegerFloatArithmetic=!0;let w=-1;return Object.keys(H.values||{}).find((u=>{var J;return void 0!==(null===(J=H.values)||void 0===J?void 0:J[u].type)&&(w=H.values[u].type,!0)})),-1!==w&&(U[0].config.type=O.arrays.types[w].flowGraphType),U},validation:H=>H.values?nJ(H):{valid:!0}},"math/div":cJ("FlowGraphDivideBlock",["a","b"],!0),"math/rem":cJ("FlowGraphModuloBlock",["a","b"]),"math/min":cJ("FlowGraphMinBlock",["a","b"]),"math/max":cJ("FlowGraphMaxBlock",["a","b"]),"math/clamp":cJ("FlowGraphClampBlock",["a","b","c"]),"math/saturate":cJ("FlowGraphSaturateBlock"),"math/mix":cJ("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":cJ("FlowGraphEqualityBlock",["a","b"]),"math/lt":cJ("FlowGraphLessThanBlock",["a","b"]),"math/le":cJ("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":cJ("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":cJ("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":cJ("FlowGraphIsNaNBlock"),"math/isinf":cJ("FlowGraphIsInfBlock"),"math/select":{TG:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{TG:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":cJ("FlowGraphSinBlock"),"math/cos":cJ("FlowGraphCosBlock"),"math/tan":cJ("FlowGraphTanBlock"),"math/asin":cJ("FlowGraphASinBlock"),"math/acos":cJ("FlowGraphACosBlock"),"math/atan":cJ("FlowGraphATanBlock"),"math/atan2":cJ("FlowGraphATan2Block",["a","b"]),"math/sinh":cJ("FlowGraphSinhBlock"),"math/cosh":cJ("FlowGraphCoshBlock"),"math/tanh":cJ("FlowGraphTanhBlock"),"math/asinh":cJ("FlowGraphASinhBlock"),"math/acosh":cJ("FlowGraphACoshBlock"),"math/atanh":cJ("FlowGraphATanhBlock"),"math/exp":cJ("FlowGraphExponentialBlock"),"math/log":cJ("FlowGraphLogBlock"),"math/log2":cJ("FlowGraphLog2Block"),"math/log10":cJ("FlowGraphLog10Block"),"math/sqrt":cJ("FlowGraphSquareRootBlock"),"math/cbrt":cJ("FlowGraphCubeRootBlock"),"math/pow":cJ("FlowGraphPowerBlock",["a","b"]),"math/length":cJ("FlowGraphLengthBlock"),"math/normalize":cJ("FlowGraphNormalizeBlock"),"math/dot":cJ("FlowGraphDotBlock",["a","b"]),"math/cross":cJ("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":cJ("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":cJ("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{TG:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{TG:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{TG:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{TG:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{TG:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{TG:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{TG:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":cJ("FlowGraphTransposeBlock"),"math/determinant":cJ("FlowGraphDeterminantBlock"),"math/inverse":cJ("FlowGraphInvertMatrixBlock"),"math/matmul":cJ("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{TG:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Cg",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,u,J,O,U,h){const w=U[0].dataInputs.find((H=>"rotationQuaternion"===H.name));if(!w)throw new Error("Rotation quaternion input not found");return h._connectionValues[w.uniqueId]&&(h._connectionValues[w.uniqueId].type="Quaternion"),U}},"math/matDecompose":{TG:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Cg"}}}},"math/quatConjugate":cJ("FlowGraphConjugateBlock",["a"]),"math/quatMul":{TG:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,u,J,O,U){var h;return(h=U[0]).config||(h.config={}),U[0].config.type="Quaternion",U}},"math/quatAngleBetween":cJ("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{TG:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":cJ("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":cJ("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{TG:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,u,J,O,U){var h;return(h=U[0]).config||(h.config={}),U[0].config.inputIsColumnMajor=!0,U}},"math/extract2x2":{TG:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{TG:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,u,J,O,U){var h;return(h=U[0]).config||(h.config={}),U[0].config.inputIsColumnMajor=!0,U}},"math/extract3x3":{TG:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{TG:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,u,J,O,U){var h;return(h=U[0]).config||(h.config={}),U[0].config.inputIsColumnMajor=!0,U}},"math/extract4x4":{TG:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{TG:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,u,J,O,U,h){var w,g;(g=U[0]).config||(g.config={});const B=U[0].dataInputs[0];return U[0].config.valueType=(null===(w=h._connectionValues[B.uniqueId])||void 0===w?void 0:w.type)??"FlowGraphInteger",U}},"math/and":{TG:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,u,J,O,U,h){var w,g,B;(B=U[0]).config||(B.config={});const b=U[0].dataInputs[0],d=U[0].dataInputs[1];return U[0].config.valueType=(null===(w=h._connectionValues[b.uniqueId])||void 0===w?void 0:w.type)??(null===(g=h._connectionValues[d.uniqueId])||void 0===g?void 0:g.type)??"FlowGraphInteger",U}},"math/or":{TG:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,u,J,O,U,h){var w,g,B;(B=U[0]).config||(B.config={});const b=U[0].dataInputs[0],d=U[0].dataInputs[1];return U[0].config.valueType=(null===(w=h._connectionValues[b.uniqueId])||void 0===w?void 0:w.type)??(null===(g=h._connectionValues[d.uniqueId])||void 0===g?void 0:g.type)??"FlowGraphInteger",U}},"math/xor":{TG:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,u,J,O,U,h){var w,g,B;(B=U[0]).config||(B.config={});const b=U[0].dataInputs[0],d=U[0].dataInputs[1];return U[0].config.valueType=(null===(w=h._connectionValues[b.uniqueId])||void 0===w?void 0:w.type)??(null===(g=h._connectionValues[d.uniqueId])||void 0===g?void 0:g.type)??"FlowGraphInteger",U}},"math/asr":cJ("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":cJ("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":cJ("FlowGraphLeadingZerosBlock"),"math/ctz":cJ("FlowGraphTrailingZerosBlock"),"math/popcnt":cJ("FlowGraphOneBitsCounterBlock"),"math/rad":cJ("FlowGraphDegToRadBlock"),"math/deg":cJ("FlowGraphRadToDegBlock"),"type/boolToInt":cJ("FlowGraphBooleanToInt"),"type/boolToFloat":cJ("FlowGraphBooleanToFloat"),"type/intToBool":cJ("FlowGraphIntToBoolean"),"type/intToFloat":cJ("FlowGraphIntToFloat"),"type/floatToInt":cJ("FlowGraphFloatToInt"),"type/floatToBool":cJ("FlowGraphFloatToBoolean"),"flow/sequence":{TG:["FlowGraphSequenceBlock"],extraProcessor(H,u,J,O,U){const h=U[0];return h.config||(h.config={}),h.config.outputSignalCount=Object.keys(H.flows||[]).length,h.signalOutputs.forEach(((H,u)=>{H.name="out_"+u})),U}},"flow/branch":{TG:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{TG:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(H){if(H.configuration&&H.configuration.cases){const u=H.configuration.cases.value;if(!u.every((H=>"number"===typeof H&&/^-?\d+$/.test(H.toString()))))return r.b.Warn("Switch cases should be integers. Using empty array instead."),H.configuration.cases.value=[],{valid:!0};const J=new Set(u);H.configuration.cases.value=Array.from(J)}return{valid:!0}},extraProcessor(H,u,J,O,U){if("flow/switch"!==u.op||!H.flows||0===Object.keys(H.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return U[0].signalOutputs.forEach((H=>{"default"!==H.name&&(H.name="out_"+H.name)})),U}},"flow/while":{TG:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{TG:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(H,u,J,O,U){const h=U[0];return h.config||(h.config={}),h.config.incrementIndexWhenLoopDone=!0,U}},"flow/doN":{TG:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{TG:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(H,u,J,O,U){if("flow/multiGate"!==u.op||!H.flows||0===Object.keys(H.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const h=U[0];return h.config||(h.config={}),h.config.outputSignalCount=Object.keys(H.flows).length,h.signalOutputs.forEach(((H,u)=>{H.name="out_"+u})),U}},"flow/waitAll":{TG:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(H){var u,J;return"number"!==typeof(null===(u=H.configuration)||void 0===u||null===(J=u.inputFlows)||void 0===J?void 0:J.value[0])&&(H.configuration=H.configuration||{inputFlows:{value:[0]}},H.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{TG:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{TG:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{TG:["FlowGraphCancelDelayBlock"]},"variable/get":{TG:["FlowGraphGetVariableBlock"],validation(H){var u,J;return null!==(u=H.configuration)&&void 0!==u&&null!==(J=u.variable)&&void 0!==J&&J.value?{valid:!0}:(r.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(H,u)=>[u.getVariableName(H[0])]}}},"variable/set":{TG:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(H,u)=>[u.getVariableName(H[0])]}}},"variable/setMultiple":{TG:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(H,u)=>[H[0].map((H=>u.getVariableName(H)))]}},extraProcessor:(H,u,J,O,U)=>(U[0].dataInputs.forEach((H=>{H.name=O.getVariableName(+H.name)})),U)},"variable/interpolate":{TG:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(H,u)=>[u.getVariableName(H[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:H=>!0===H[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",pJ:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",pJ:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",pJ:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",pJ:"FlowGraphPlayAnimationBlock"},out:{name:"out",pJ:"FlowGraphPlayAnimationBlock"},done:{name:"done",pJ:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(H,u,J,O,U){var h,w,g;const B=U[0],b=null===(h=H.configuration)||void 0===h?void 0:h.variable.value[0];if("number"!==typeof b)throw r.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const d=O.arrays.staticVariables[b];"undefined"===typeof B.config.animationType.value&&(O.arrays.staticVariables,B.config.animationType.value=(0,CJ.S)(d.type));const G=U[4];return G.config||(G.config={}),(w=G.config).variable||(w.variable={}),G.config.variable.value=O.getVariableName(b),(g=U[3]).config||(g.config={}),U}},"pointer/get":{TG:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",pJ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",pJ:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(H,u,J,O,U)=>(U.forEach((H=>{"FlowGraphJsonPointerParserBlock"===H.className&&(H.config||(H.config={}),H.config.outputValue=!0)})),U)},"pointer/set":{TG:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",pJ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",pJ:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(H,u,J,O,U)=>(U.forEach((H=>{"FlowGraphJsonPointerParserBlock"===H.className&&(H.config||(H.config={}),H.config.outputValue=!0)})),U)},"pointer/interpolate":{TG:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",pJ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",pJ:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",pJ:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",pJ:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",pJ:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",pJ:"FlowGraphPlayAnimationBlock"},out:{name:"out",pJ:"FlowGraphPlayAnimationBlock"},done:{name:"done",pJ:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(H,u,J,O,U)=>(U.forEach((u=>{"FlowGraphJsonPointerParserBlock"===u.className?(u.config||(u.config={}),u.config.outputValue=!0):"FlowGraphInterpolationBlock"===u.className&&(u.config||(u.config={}),Object.keys(H.values||[]).forEach((J=>{var U;const h=null===(U=H.values)||void 0===U?void 0:U[J];if("value"===J&&h){const H=h.type;void 0!==H&&(u.config.animationType=O.arrays.types[H].flowGraphType)}})))})),U)},"animation/start":{TG:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",pJ:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(H,u)=>[H[0]*u._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(H,u)=>[H[0]*u._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(H,u,J,O,U,h,w){const g=U[U.length-1];return g.config||(g.config={}),g.config.glTF=w,U}},"animation/stop":{TG:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",pJ:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(H,u,J,O,U,h,w){const g=U[U.length-1];return g.config||(g.config={}),g.config.glTF=w,U}},"animation/stopAt":{TG:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",pJ:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(H,u)=>[H[0]*u._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(H,u,J,O,U,h,w){const g=U[U.length-1];return g.config||(g.config={}),g.config.glTF=w,U}},"math/switch":{TG:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(H){if(H.configuration&&H.configuration.cases){const u=H.configuration.cases.value;if(!u.every((H=>"number"===typeof H&&/^-?\d+$/.test(H.toString()))))return r.b.Warn("Switch cases should be integers. Using empty array instead."),H.configuration.cases.value=[],{valid:!0};const J=new Set(u);H.configuration.cases.value=Array.from(J)}return{valid:!0}},extraProcessor(H,u,J,O,U){const h=U[0];return h.dataInputs.forEach((H=>{"default"!==H.name&&"case"!==H.name&&(H.name="in_"+H.name)})),h.config||(h.config={}),h.config.treatCasesAsIntegers=!0,U}},"debug/log":{TG:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function cJ(H){let u=arguments.length>2?arguments[2]:void 0;return{TG:[H],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((H,u)=>(H[u]={name:u},H)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(H,J,O,U,h){var w;if(u){(w=h[0]).config||(w.config={}),h[0].config.preventIntegerFloatArithmetic=!0;let u=-1;Object.keys(H.values||{}).find((J=>{var O;return void 0!==(null===(O=H.values)||void 0===O?void 0:O[J].type)&&(u=H.values[J].type,!0)})),-1!==u&&(h[0].config.type=U.arrays.types[u].flowGraphType)}return h},validation:H=>u?nJ(H):{valid:!0}}}function nJ(H){if(H.values){const u=Object.keys(H.values).map((u=>H.values[u].type)).filter((H=>void 0!==H));if(!u.every((H=>H===u[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}eJ["math/compose"]=eJ["math/matCompose"],eJ["math/decompose"]=eJ["math/matDecompose"];var VJ=J(12306);const TJ={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"lu",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class RJ{constructor(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=H,this._gltf=u,this._animationTargetFps=J,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const H of this._interactivityGraph.types)this._types.push(TJ[H.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const H of this._interactivityGraph.declarations){const u=sJ(H);if(!u)throw r.b.Error(["No mapping found for declaration",H]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:u,fullOperationName:H.extension?H.op+":"+H.extension:H.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const H of this._interactivityGraph.variables){const u=this._parseVariable(H);this._staticVariables.push(u)}}_parseVariable(H,u){const J=this._types[H.type];if(!J)throw r.b.Error(["No type found for variable",H]),new Error("Error parsing variables");if(H.value&&H.value.length!==J.length)throw r.b.Error(["Invalid value length for variable",H,J]),new Error("Error parsing variables");const O=H.value||[];if(!O.length)switch(J.flowGraphType){case"boolean":O.push(!1);break;case"FlowGraphInteger":O.push(0);break;case"number":O.push(NaN);break;case"Vector2":O.push(NaN,NaN);break;case"lu":O.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":O.fill(NaN,0,4);break;case"Matrix":O.fill(NaN,0,16);break;case"Matrix3D":O.fill(NaN,0,9)}return"number"===J.elementType&&"string"===typeof O[0]&&(O[0]=parseFloat(O[0])),{type:J.flowGraphType,value:u?u(O,this):O}}_parseEvents(){if(this._interactivityGraph.events)for(const H of this._interactivityGraph.events){const u={eventId:H.id||"internalEvent_"+this._internalEventsCounter++};H.values&&(u.eventData=Object.keys(H.values).map((u=>{var J;const O=null===(J=H.values)||void 0===J?void 0:J[u];if(!O)throw r.b.Error(["No value found for event key",u]),new Error("Error parsing events");const U=this._types[O.type];if(!U)throw r.b.Error(["No type found for event value",O]),new Error("Error parsing events");const h="undefined"!==typeof O.value?this._parseVariable(O):void 0;return{id:u,type:U.flowGraphType,eventData:!0,value:h}}))),this._events.push(u)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const u of this._interactivityGraph.nodes){if("number"!==typeof u.declaration)throw r.b.Error(["No declaration found for node",u]),new Error("Error parsing nodes");const J=this._mappings[u.declaration];if(!J)throw r.b.Error(["No mapping found for node",u]),new Error("Error parsing nodes");if(J.flowGraphMapping.validation){const O=J.flowGraphMapping.validation(u,this._interactivityGraph,this._gltf);var H;if(!O.valid)throw new Error(`Error validating interactivity node ${null===(H=this._interactivityGraph.declarations)||void 0===H?void 0:H[u.declaration].op} - ${O.error}`)}const O=[];for(const H of J.flowGraphMapping.TG){const U=this._getEmptyBlock(H,J.fullOperationName);this._parseNodeConfiguration(u,U,J.flowGraphMapping,H),O.push(U)}this._nodes.push({TG:O,fullOperationName:J.fullOperationName})}}_getEmptyBlock(H,u){return{uniqueId:(0,VJ.c)(),className:H,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:u,metadata:{}}}_parseNodeConfiguration(H,u,J,O){const U=u.config;if(H.configuration){const u=Object.keys(H.configuration);for(const g of u){var h,w;const u=null===(h=H.configuration)||void 0===h?void 0:h[g];if(!u)throw r.b.Error(["No value found for node configuration",g]),new Error("Error parsing node configuration");const B=null===(w=J.configuration)||void 0===w?void 0:w[g];if(B&&B.pJ?B.pJ===O:0===J.TG.indexOf(O)){const H=(null===B||void 0===B?void 0:B.name)||g;u&&"undefined"!==typeof u.value||"undefined"===typeof(null===B||void 0===B?void 0:B.defaultValue)?u.value.length>=0?U[H]={value:1===u.value.length?u.value[0]:u.value}:r.b.Warn(["Invalid value for node configuration",u]):U[H]={value:B.defaultValue},B&&B.dataTransformer&&(U[H].value=B.dataTransformer([U[H].value],this)[0])}}}}_parseNodeConnections(H){for(let L=0;L<this._nodes.length;L++){var u;const Z=null===(u=this._interactivityGraph.nodes)||void 0===u?void 0:u[L];if(!Z)throw r.b.Error(["No node found for interactivity node",this._nodes[L]]),new Error("Error parsing node connections");const Y=this._nodes[L],F=this._mappings[Z.declaration];if(!F)throw r.b.Error(["No mapping found for node",Z]),new Error("Error parsing node connections");const s=Z.flows||{},A=Object.keys(s).sort();for(const H of A){var J,O,U,h;const u=s[H],b=null===(J=F.flowGraphMapping.outputs)||void 0===J||null===(O=J.flows)||void 0===O?void 0:O[H],d=(null===b||void 0===b?void 0:b.name)||H,G=this._createNewSocketConnection(d,!0);(b&&b.pJ&&Y.TG.find((H=>H.className===b.pJ))||Y.TG[0]).signalOutputs.push(G);const P=u.node,mH=this._nodes[P];if(!mH)throw r.b.Error(["No node found for input node id",P]),new Error("Error parsing node connections");const l=FJ(mH.fullOperationName);if(!l)throw r.b.Error(["No mapping found for input node",mH]),new Error("Error parsing node connections");let p=null===(U=l.inputs)||void 0===U||null===(h=U.flows)||void 0===h?void 0:h[u.socket||"in"],a=!1;if(!p)for(const H in null===(w=l.inputs)||void 0===w?void 0:w.flows){var w,g,B;if(H.startsWith("[")&&H.endsWith("]"))a=!0,p=null===(g=l.inputs)||void 0===g||null===(B=g.flows)||void 0===B?void 0:B[H]}const k=p?a?p.name.replace("$1",u.socket||""):p.name:u.socket||"in",C=p&&p.pJ&&mH.TG.find((H=>H.className===p.pJ))||mH.TG[0];let j=C.signalInputs.find((H=>H.name===k));j||(j=this._createNewSocketConnection(k),C.signalInputs.push(j)),j.connectedPointIds.push(G.uniqueId),G.connectedPointIds.push(j.uniqueId)}const t=Z.values||{},e=Object.keys(t);for(const u of e){var b,d;const J=t[u];let O=null===(b=F.flowGraphMapping.inputs)||void 0===b||null===(d=b.values)||void 0===d?void 0:d[u],U=!1;if(!O)for(const H in null===(G=F.flowGraphMapping.inputs)||void 0===G?void 0:G.values){var G,P,mH;if(H.startsWith("[")&&H.endsWith("]"))U=!0,O=null===(P=F.flowGraphMapping.inputs)||void 0===P||null===(mH=P.values)||void 0===mH?void 0:mH[H]}const h=O?U?O.name.replace("$1",u):O.name:u,w=this._createNewSocketConnection(h);if((O&&O.pJ&&Y.TG.find((H=>H.className===O.pJ))||Y.TG[0]).dataInputs.push(w),void 0!==J.value){const u=this._parseVariable(J,O&&O.dataTransformer);H._connectionValues[w.uniqueId]=u}else{if("undefined"===typeof J.node)throw r.b.Error(["Invalid value for value connection",J]),new Error("Error parsing node connections");{var l,p,a;const H=J.node,u=J.socket||"value",O=this._nodes[H];if(!O)throw r.b.Error(["No node found for output socket reference",J]),new Error("Error parsing node connections");const U=FJ(O.fullOperationName);if(!U)throw r.b.Error(["No mapping found for output socket reference",J]),new Error("Error parsing node connections");let h=null===(l=U.outputs)||void 0===l||null===(p=l.values)||void 0===p?void 0:p[u],g=!1;if(!h)for(const J in null===(k=U.outputs)||void 0===k?void 0:k.values){var k,C,j;if(J.startsWith("[")&&J.endsWith("]"))g=!0,h=null===(C=U.outputs)||void 0===C||null===(j=C.values)||void 0===j?void 0:j[J]}const B=h?g?h.name.replace("$1",u):null===(a=h)||void 0===a?void 0:a.name:u,b=h&&h.pJ&&O.TG.find((H=>H.className===h.pJ))||O.TG[0];let d=b.dataOutputs.find((H=>H.name===B));d||(d=this._createNewSocketConnection(B,!0),b.dataOutputs.push(d)),w.connectedPointIds.push(d.uniqueId),d.connectedPointIds.push(w.uniqueId)}}}if(F.flowGraphMapping.interBlockConnectors)for(const H of F.flowGraphMapping.interBlockConnectors){const u=H.input,J=H.output,O=H.isVariable;this._connectFlowGraphNodes(u,J,Y.TG[H.inputBlockIndex],Y.TG[H.outputBlockIndex],O)}if(F.flowGraphMapping.extraProcessor){var M;const u=null===(M=this._interactivityGraph.declarations)||void 0===M?void 0:M[Z.declaration];if(!u)throw r.b.Error(["No declaration found for extra processor",Z]),new Error("Error parsing node connections");Y.TG=F.flowGraphMapping.extraProcessor(Z,u,F.flowGraphMapping,this,Y.TG,H,this._gltf)}}}_createNewSocketConnection(H,u){return{uniqueId:(0,VJ.c)(),name:H,_connectionType:u?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(H,u,J,O,U){const h=U?J.dataInputs:J.signalInputs,w=U?O.dataOutputs:O.signalOutputs,g=h.find((u=>u.name===H))||this._createNewSocketConnection(H),B=w.find((H=>H.name===u))||this._createNewSocketConnection(u,!0);h.find((u=>u.name===H))||h.push(g),w.find((H=>H.name===u))||w.push(B),g.connectedPointIds.push(B.uniqueId),B.connectedPointIds.push(g.uniqueId)}getVariableName(H){return"staticVariable_"+H}serializeToFlowGraph(){const H={uniqueId:(0,VJ.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(H);for(let u=0;u<this._staticVariables.length;u++){const J=this._staticVariables[u];H._userVariables[this.getVariableName(u)]=J}return{rightHanded:!0,allBlocks:this._nodes.reduce(((H,u)=>H.concat(u.TG)),[]),executionContexts:[H]}}}const XJ="KHR_interactivity";class WJ{constructor(H){this._loader=H,this.name=XJ,this.enabled=this._loader.isExtensionUsed(XJ),this._pathConverter=(0,f.k)(this._loader.xh),H._skipStartAnimationStep=!0;const u=H.babylonScene;u&&function(H){(0,f.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!H.activeCamera)return new U.Quaternion(NaN,NaN,NaN,NaN);const u=U.Quaternion.FromRotationMatrix(H.activeCamera.getWorldMatrix()).normalize();return H.useRightHandedSystem||(u.w*=-1,u.x*=-1),u},type:"Quaternion",getTarget:()=>H.activeCamera}),(0,f.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!H.activeCamera)return new U.lu(NaN,NaN,NaN);const u=H.activeCamera.getWorldMatrix().getTranslation();return H.useRightHandedSystem||(u.x*=-1),u},type:"lu",getTarget:()=>H.activeCamera}),(0,f.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:H=>{var u;return(null===(u=H._babylonAnimationGroup)||void 0===u?void 0:u.isPlaying)??!1},type:"boolean",getTarget:H=>H._babylonAnimationGroup}),(0,f.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:H=>{var u;return((null===(u=H._babylonAnimationGroup)||void 0===u?void 0:u.from)??0)/60},type:"number",getTarget:H=>H._babylonAnimationGroup}),(0,f.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:H=>{var u;return((null===(u=H._babylonAnimationGroup)||void 0===u?void 0:u.to)??0)/60},type:"number",getTarget:H=>H._babylonAnimationGroup}),(0,f.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:H=>{var u;return((null===(u=H._babylonAnimationGroup)||void 0===u?void 0:u.getCurrentFrame())??0)/60},type:"number",getTarget:H=>H._babylonAnimationGroup}),(0,f.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:H=>{var u;return((null===(u=H._babylonAnimationGroup)||void 0===u?void 0:u.getCurrentFrame())??0)/60},type:"number",getTarget:H=>H._babylonAnimationGroup})}(u)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var H;if(!this._loader.babylonScene||!this._pathConverter)return;const u=this._loader.babylonScene,J=null===(H=this._loader.xh.extensions)||void 0===H?void 0:H.KHR_interactivity;if(!J)return;const O=new lJ.b({pu:u});O.dispatchEventsSynchronously=!1;const U=J.graphs.map((H=>new RJ(H,this._loader.xh,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(U.map((async H=>await LJ(H,{coordinator:O,pathConverter:this._pathConverter})))),O.start()}}var fJ;fJ=async()=>(await Promise.resolve().then(J.bind(J,14072))).FlowGraphGLTFDataProvider,rJ[`${XJ}/${"FlowGraphGLTFDataProvider"}`]=fJ,W(XJ),X(XJ,!0,(H=>new WJ(H)));const iJ="KHR_node_visibility";(0,f.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:H=>{const u=H._babylonTransformNode;return!u||void 0===u.isVisible||u.isVisible},set:(H,u)=>{var J,O;null===(J=u._primitiveBabylonMeshes)||void 0===J||J.forEach((H=>{H.inheritVisibility=!0})),u._babylonTransformNode&&(u._babylonTransformNode.isVisible=H),null===(O=u._primitiveBabylonMeshes)||void 0===O||O.forEach((u=>{u.isVisible=H}))},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class SJ{constructor(H){this.name=iJ,this._loader=H,this.enabled=H.isExtensionUsed(iJ)}async onReady(){var H;null===(H=this._loader.xh.nodes)||void 0===H||H.forEach((H=>{var u,J,O,U;(null===(u=H._primitiveBabylonMeshes)||void 0===u||u.forEach((H=>{H.inheritVisibility=!0})),null!==(J=H.extensions)&&void 0!==J&&J.KHR_node_visibility)&&(!1===(null===(O=H.extensions)||void 0===O?void 0:O.KHR_node_visibility.visible)&&(H._babylonTransformNode&&(H._babylonTransformNode.isVisible=!1),null===(U=H._primitiveBabylonMeshes)||void 0===U||U.forEach((H=>{H.isVisible=!1}))))}))}dispose(){this._loader=null}}W(iJ),X(iJ,!0,(H=>new SJ(H)));const vJ="KHR_node_selectability";AJ("event/onSelect",vJ,{TG:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",pJ:"FlowGraphGetVariableBlock",dataTransformer:H=>["pickedMesh_"+H[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",pJ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(H,u,J,O,U,h,w){var g,B,b,d,G,P;const mH=U[U.length-1];mH.config=mH.config||{},mH.config.glTF=w;const l=null===(g=H.configuration)||void 0===g||null===(B=g.nodeIndex)||void 0===B?void 0:B.value[0];if(void 0===l||"number"!==typeof l)throw new Error("nodeIndex not found in configuration");const r="pickedMesh_"+l;return U[1].config.variable=r,h._userVariables[r]={className:"Mesh",id:null===w||void 0===w||null===(b=w.nodes)||void 0===b||null===(d=b[l]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===w||void 0===w||null===(G=w.nodes)||void 0===G||null===(P=G[l]._babylonTransformNode)||void 0===P?void 0:P.uniqueId},U}}),(0,f.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:H=>{const u=H._babylonTransformNode;return!u||void 0===u.DB||u.DB},set:(H,u)=>{var J;null===(J=u._primitiveBabylonMeshes)||void 0===J||J.forEach((u=>{u.DB=H}))},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"DB"],type:"boolean"});class IJ{constructor(H){this.name=vJ,this._loader=H,this.enabled=H.isExtensionUsed(vJ)}async onReady(){var H;null===(H=this._loader.xh.nodes)||void 0===H||H.forEach((H=>{var u,J,O;null!==(u=H.extensions)&&void 0!==u&&u.KHR_node_selectability&&!1===(null===(J=H.extensions)||void 0===J?void 0:J.KHR_node_selectability.selectable)&&(null===(O=H._babylonTransformNode)||void 0===O||O.getChildMeshes().forEach((H=>{H.DB=!1})))}))}dispose(){this._loader=null}}W(vJ),X(vJ,!0,(H=>new IJ(H)));const DJ="KHR_node_hoverability",oJ="targetMeshPointerOver_";AJ("event/onHoverIn",DJ,{TG:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",pJ:"FlowGraphGetVariableBlock",dataTransformer:H=>[oJ+H[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",pJ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(H,u,J,O,U,h,w){var g,B,b,d,G,P;const mH=U[U.length-1];mH.config=mH.config||{},mH.config.glTF=w;const l=null===(g=H.configuration)||void 0===g||null===(B=g.nodeIndex)||void 0===B?void 0:B.value[0];if(void 0===l||"number"!==typeof l)throw new Error("nodeIndex not found in configuration");const r=oJ+l;return U[1].config.variable=r,h._userVariables[r]={className:"Mesh",id:null===w||void 0===w||null===(b=w.nodes)||void 0===b||null===(d=b[l]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===w||void 0===w||null===(G=w.nodes)||void 0===G||null===(P=G[l]._babylonTransformNode)||void 0===P?void 0:P.uniqueId},U}});const yJ="targetMeshPointerOut_";AJ("event/onHoverOut",DJ,{TG:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",pJ:"FlowGraphGetVariableBlock",dataTransformer:H=>[yJ+H[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",pJ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(H,u,J,O,U,h,w){var g,B,b,d,G,P;const mH=U[U.length-1];mH.config=mH.config||{},mH.config.glTF=w;const l=null===(g=H.configuration)||void 0===g||null===(B=g.nodeIndex)||void 0===B?void 0:B.value[0];if(void 0===l||"number"!==typeof l)throw new Error("nodeIndex not found in configuration");const r=yJ+l;return U[1].config.variable=r,h._userVariables[r]={className:"Mesh",id:null===w||void 0===w||null===(b=w.nodes)||void 0===b||null===(d=b[l]._babylonTransformNode)||void 0===d?void 0:d.id,uniqueId:null===w||void 0===w||null===(G=w.nodes)||void 0===G||null===(P=G[l]._babylonTransformNode)||void 0===P?void 0:P.uniqueId},U}}),(0,f.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:H=>{const u=H._babylonTransformNode;return!u||void 0===u.pointerOverDisableMeshTesting||u.pointerOverDisableMeshTesting},set:(H,u)=>{var J;null===(J=u._primitiveBabylonMeshes)||void 0===J||J.forEach((u=>{u.pointerOverDisableMeshTesting=!H}))},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class xJ{constructor(H){this.name=DJ,this._loader=H,this.enabled=H.isExtensionUsed(DJ)}async onReady(){var H;null===(H=this._loader.xh.nodes)||void 0===H||H.forEach((H=>{var u,J,O;null!==(u=H.extensions)&&void 0!==u&&u.KHR_node_hoverability&&!1===(null===(J=H.extensions)||void 0===J?void 0:J.KHR_node_hoverability.hoverable)&&(null===(O=H._babylonTransformNode)||void 0===O||O.getChildMeshes().forEach((H=>{H.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}W(DJ),X(DJ,!0,(H=>new xJ(H)));const zJ="ExtrasAsMetadata";class KJ{_assignExtras(H,u){if(u.extras&&Object.keys(u.extras).length>0){const J=H.metadata=H.metadata||{};(J.xh=J.xh||{}).extras=u.extras}}constructor(H){this.name=zJ,this.enabled=!0,this._loader=H}dispose(){this._loader=null}loadNodeAsync(H,u,J){return this._loader.loadNodeAsync(H,u,(H=>{this._assignExtras(H,u),J(H)}))}loadCameraAsync(H,u,J){return this._loader.loadCameraAsync(H,u,(H=>{this._assignExtras(H,u),J(H)}))}createMaterial(H,u,J){const O=this._loader.createMaterial(H,u,J);return this._assignExtras(O,u),O}}W(zJ),X(zJ,!1,(H=>new KJ(H)));J(14072)},13959:(H,u,J)=>{"use strict";J.d(u,{e:()=>n,f:()=>F,g:()=>Y,i:()=>s});var O=J(12175),U=J(12171),h=J(13599),w=J(12770),g=J(12724),B=J(12741),b=J(12185),d=J(12203),G=J(12763),P=J(12872),mH=J(12774),l=J(12374);class r{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.pm=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Qm=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(H){this._environmentTexture=H}getNodes(){let H=[];H=H.concat(this.meshes),H=H.concat(this.lights),H=H.concat(this.cameras),H=H.concat(this.transformNodes);for(const u of this.skeletons)H=H.concat(u.bones);return H}}class p extends r{}class a{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const H=this.rootNodes;for(const O of H)O.dispose();H.length=0;const u=this.skeletons;for(const O of u)O.dispose();u.length=0;const J=this.animationGroups;for(const O of J)O.dispose();J.length=0}}class k extends r{constructor(H){super(),this._wasAddedToScene=!1,(H=H||d.e.LastCreatedScene)&&(this.pu=H,this.proceduralTextures=[],H.nh.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=H.getEngine().onContextRestoredObservable.add((()=>{for(const H of this.geometries)H._rebuild();for(const H of this.meshes)H._rebuild();for(const H of this.pm)H.rebuild();for(const H of this.textures)H._rebuild()})))}_topologicalSort(H){const u=new Map;for(const w of H)u.set(w.uniqueId,w);const J={dependsOn:new Map,dependedBy:new Map};for(const w of H){const H=w.uniqueId;J.dependsOn.set(H,new Set),J.dependedBy.set(H,new Set)}for(const w of H){const H=w.uniqueId,O=J.dependsOn.get(H);if(w instanceof G.c){const U=w.sourceMesh;u.has(U.uniqueId)&&(O.add(U.uniqueId),J.dependedBy.get(U.uniqueId).add(H))}const U=J.dependedBy.get(H);for(const h of w.getDescendants()){const O=h.uniqueId;if(u.has(O)){U.add(O);J.dependsOn.get(O).add(H)}}}const O=[],U=[];for(const w of H){const H=w.uniqueId;0===J.dependsOn.get(H).size&&(U.push(w),u.delete(H))}const h=U;for(;h.length>0;){const H=h.shift();O.push(H);const U=J.dependedBy.get(H.uniqueId);for(const O of Array.from(U.values())){const U=J.dependsOn.get(O);U.delete(H.uniqueId),0===U.size&&u.get(O)&&(h.push(u.get(O)),u.delete(O))}}return u.size>0&&(b.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),u.forEach((H=>{b.b.Error(H.name)}))),O}_addNodeAndDescendantsToList(H,u,J,O){if(J&&(!O||O(J))&&!u.has(J.uniqueId)){H.push(J),u.add(J.uniqueId);for(const U of J.getDescendants(!0))this._addNodeAndDescendantsToList(H,u,U,O)}}_isNodeInContainer(H){return H instanceof B.c&&-1!==this.meshes.indexOf(H)||(H instanceof g.c&&-1!==this.transformNodes.indexOf(H)||(H instanceof P.d&&-1!==this.lights.indexOf(H)||H instanceof mH.c&&-1!==this.cameras.indexOf(H)))}_isValidHierarchy(){for(const H of this.meshes)if(H.parent&&!this._isNodeInContainer(H.parent))return b.b.Warn(`Node ${H.name} has a parent that is not in the container.`),!1;for(const H of this.transformNodes)if(H.parent&&!this._isNodeInContainer(H.parent))return b.b.Warn(`Node ${H.name} has a parent that is not in the container.`),!1;for(const H of this.lights)if(H.parent&&!this._isNodeInContainer(H.parent))return b.b.Warn(`Node ${H.name} has a parent that is not in the container.`),!1;for(const H of this.cameras)if(H.parent&&!this._isNodeInContainer(H.parent))return b.b.Warn(`Node ${H.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(H){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],J=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||U.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const O={},h={},g=new a,B=[],b=[],d={doNotInstantiate:!0,...J},G=[],P=new Set;for(const U of this.transformNodes)null===U.parent&&this._addNodeAndDescendantsToList(G,P,U,d.predicate);for(const U of this.meshes)null===U.parent&&this._addNodeAndDescendantsToList(G,P,U,d.predicate);const mH=this._topologicalSort(G),l=(J,U)=>{if(((u,J)=>{if(O[u.uniqueId]=J.uniqueId,h[J.uniqueId]=J,H&&(J.name=H(u.name)),J instanceof w.c){const H=J;if(H.morphTargetManager){const J=u.morphTargetManager;H.morphTargetManager=J.clone();for(let u=0;u<J.numTargets;u++){const U=J.getTarget(u),w=H.morphTargetManager.getTarget(u);O[U.uniqueId]=w.uniqueId,h[w.uniqueId]=w}}}})(J,U),J.parent){const H=O[J.parent.uniqueId],u=h[H];U.parent=u||J.parent}if(U.position&&J.position&&U.position.O(J.position),U.rotationQuaternion&&J.rotationQuaternion&&U.rotationQuaternion.O(J.rotationQuaternion),U.rotation&&J.rotation&&U.rotation.O(J.rotation),U.Cg&&J.Cg&&U.Cg.O(J.Cg),U.material){const w=U;if(w.material)if(u){const u=J.material;if(-1===b.indexOf(u)){let J=u.clone(H?H(u.name):"Clone of "+u.name);if(b.push(u),O[u.uniqueId]=J.uniqueId,h[J.uniqueId]=J,"MultiMaterial"===u.getClassName()){const U=u;for(const u of U.Lg)u&&(J=u.clone(H?H(u.name):"Clone of "+u.name),b.push(u),O[u.uniqueId]=J.uniqueId,h[J.uniqueId]=J);U.Lg=U.Lg.map((H=>H&&h[O[H.uniqueId]]))}}"InstancedMesh"!==w.getClassName()&&(w.material=h[O[u.uniqueId]])}else"MultiMaterial"===w.material.getClassName()?-1===this.pu.multiMaterials.indexOf(w.material)&&this.pu.addMultiMaterial(w.material):-1===this.pu.materials.indexOf(w.material)&&this.pu.addMaterial(w.material)}null===U.parent&&g.rootNodes.push(U)};for(const U of mH)if("InstancedMesh"===U.getClassName()){const H=U,u=H.sourceMesh,J=O[u.uniqueId];l(H,("number"===typeof J?h[J]:u).createInstance(H.name))}else{let H=!0;"xg"===U.getClassName()||"Node"===U.getClassName()||U.skeleton||!U.getTotalVertices||0===U.getTotalVertices()?H=!1:d.doNotInstantiate&&(H="function"===typeof d.doNotInstantiate?!d.doNotInstantiate(U):!d.doNotInstantiate);const u=H?U.createInstance(`instance of ${U.name}`):U.clone(`Clone of ${U.name}`,null,!0);if(!u)throw new Error(`Could not clone or instantiate node on Asset Container ${U.name}`);l(U,u)}for(const U of this.skeletons){if(d.predicate&&!d.predicate(U))continue;const u=U.clone(H?H(U.name):"Clone of "+U.name);for(const H of this.meshes)if(H.skeleton===U&&!H.isAnInstance){const J=h[O[H.uniqueId]];if(!J||J.isAnInstance)continue;if(J.skeleton=u,-1!==B.indexOf(u))continue;B.push(u);for(const H of u.bones)H._linkedTransformNode&&(H._linkedTransformNode=h[O[H._linkedTransformNode.uniqueId]])}g.skeletons.push(u)}for(const U of this.animationGroups){if(d.predicate&&!d.predicate(U))continue;const u=U.clone(H?H(U.name):"Clone of "+U.name,(H=>h[O[H.uniqueId]]||H));g.animationGroups.push(u)}return g}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||U.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.pu.environmentTexture=this.environmentTexture);for(const H of this.pu._serializableComponents)H.addFromContainer(this);this.pu.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const u=[];for(const J of this.cameras)H&&!H(J)||(this.pu.addCamera(J),u.push(J));for(const J of this.lights)H&&!H(J)||(this.pu.addLight(J),u.push(J));for(const J of this.meshes)H&&!H(J)||(this.pu.MG(J),u.push(J));for(const J of this.skeletons)H&&!H(J)||this.pu.addSkeleton(J);for(const J of this.animations)H&&!H(J)||this.pu.addAnimation(J);for(const J of this.animationGroups)H&&!H(J)||this.pu.addAnimationGroup(J);for(const J of this.multiMaterials)H&&!H(J)||this.pu.addMultiMaterial(J);for(const J of this.materials)H&&!H(J)||this.pu.addMaterial(J);for(const J of this.morphTargetManagers)H&&!H(J)||this.pu.addMorphTargetManager(J);for(const J of this.geometries)H&&!H(J)||this.pu.addGeometry(J);for(const J of this.transformNodes)H&&!H(J)||(this.pu.addTransformNode(J),u.push(J));for(const J of this.actionManagers)H&&!H(J)||this.pu.addActionManager(J);for(const J of this.textures)H&&!H(J)||this.pu.addTexture(J);for(const J of this.reflectionProbes)H&&!H(J)||this.pu.addReflectionProbe(J);for(const J of u)J.parent&&-1===this.pu.getNodes().indexOf(J.parent)&&(J.setParent?J.setParent(null):J.parent=null)}removeAllFromScene(){this._isValidHierarchy()||U.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.pu.environmentTexture&&(this.pu.environmentTexture=null);for(const H of this.pu._serializableComponents)H.removeFromContainer(this)}removeFromScene(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const u of this.cameras)H&&!H(u)||this.pu.removeCamera(u);for(const u of this.lights)H&&!H(u)||this.pu.removeLight(u);for(const u of this.meshes)H&&!H(u)||this.pu.jG(u,!0);for(const u of this.skeletons)H&&!H(u)||this.pu.removeSkeleton(u);for(const u of this.animations)H&&!H(u)||this.pu.removeAnimation(u);for(const u of this.animationGroups)H&&!H(u)||this.pu.removeAnimationGroup(u);for(const u of this.multiMaterials)H&&!H(u)||this.pu.removeMultiMaterial(u);for(const u of this.materials)H&&!H(u)||this.pu.removeMaterial(u);for(const u of this.morphTargetManagers)H&&!H(u)||this.pu.removeMorphTargetManager(u);for(const u of this.geometries)H&&!H(u)||this.pu.removeGeometry(u);for(const u of this.transformNodes)H&&!H(u)||this.pu.removeTransformNode(u);for(const u of this.actionManagers)H&&!H(u)||this.pu.removeActionManager(u);for(const u of this.textures)H&&!H(u)||this.pu.removeTexture(u);for(const u of this.reflectionProbes)H&&!H(u)||this.pu.removeReflectionProbe(u)}dispose(){const H=this.cameras.slice(0);for(const mH of H)mH.dispose();this.cameras.length=0;const u=this.lights.slice(0);for(const mH of u)mH.dispose();this.lights.length=0;const J=this.meshes.slice(0);for(const mH of J)mH.dispose();this.meshes.length=0;const O=this.skeletons.slice(0);for(const mH of O)mH.dispose();this.skeletons.length=0;const U=this.animationGroups.slice(0);for(const mH of U)mH.dispose();this.animationGroups.length=0;const h=this.multiMaterials.slice(0);for(const mH of h)mH.dispose();this.multiMaterials.length=0;const w=this.materials.slice(0);for(const mH of w)mH.dispose();this.materials.length=0;const g=this.geometries.slice(0);for(const mH of g)mH.dispose();this.geometries.length=0;const B=this.transformNodes.slice(0);for(const mH of B)mH.dispose();this.transformNodes.length=0;const b=this.actionManagers.slice(0);for(const mH of b)mH.dispose();this.actionManagers.length=0;const d=this.textures.slice(0);for(const mH of d)mH.dispose();this.textures.length=0;const G=this.reflectionProbes.slice(0);for(const mH of G)mH.dispose();this.reflectionProbes.length=0;const P=this.morphTargetManagers.slice(0);for(const mH of P)mH.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const mH of this.pu._serializableComponents)mH.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.pu.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(H,u,J){if(H&&u)for(const O of H){let H=!0;if(J)for(const u of J)if(O===u){H=!1;break}H&&(u.push(O),O._parentContainer=this)}}moveAllFromScene(H){this._wasAddedToScene=!1,void 0===H&&(H=new p);for(const u in this)Object.prototype.hasOwnProperty.call(this,u)&&(this[u]=this[u]||("_environmentTexture"===u?null:[]),this._moveAssets(this.pu[u],this[u],H[u]));this.environmentTexture=this.pu.environmentTexture,this.removeAllFromScene()}createRootMesh(){const H=new w.c("assetContainerRootMesh",this.pu);for(const u of this.meshes)u.parent||H.addChild(u);return this.meshes.unshift(H),H}mergeAnimationsTo(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.e.LastCreatedScene,u=arguments.length>1?arguments[1]:void 0,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!H)return b.b.Error("No scene available to merge animations to"),[];const O=J||(u=>{let J=null;const O=u.animations.length?u.animations[0].targetProperty:"",U=u.name.split(".").join("").split("_primitive")[0];switch(O){case"position":case"rotationQuaternion":J=H.getTransformNodeByName(u.name)||H.getTransformNodeByName(U);break;case"influence":J=H.getMorphTargetByName(u.name)||H.getMorphTargetByName(U);break;default:J=H.getNodeByName(u.name)||H.getNodeByName(U)}return J}),U=this.getNodes();for(const g of U){const H=O(g);if(null!==H){for(const u of g.animations){const J=H.animations.filter((H=>H.targetProperty===u.targetProperty));for(const u of J){const J=H.animations.indexOf(u,0);J>-1&&H.animations.splice(J,1)}}H.animations=H.animations.concat(g.animations)}}const h=[],w=this.animationGroups.slice();for(const g of w){h.push(g.clone(g.name,O));for(const H of g.animatables)H.stop()}for(const g of u){const u=O(g.target);u&&(H.beginAnimation(u,g.fromFrame,g.toFrame,g.loopAnimation,g.speedRatio,g.onAnimationEnd?g.onAnimationEnd:void 0,void 0,!0,void 0,g.onAnimationLoop?g.onAnimationLoop:void 0),H.stopAnimation(g.target))}return h}populateRootNodes(){this.rootNodes.length=0;for(const H of this.meshes)H.parent||-1!==this.rootNodes.indexOf(H)||this.rootNodes.push(H);for(const H of this.transformNodes)H.parent||-1!==this.rootNodes.indexOf(H)||this.rootNodes.push(H);for(const H of this.lights)H.parent||-1!==this.rootNodes.indexOf(H)||this.rootNodes.push(H);for(const H of this.cameras)H.parent||-1!==this.rootNodes.indexOf(H)||this.rootNodes.push(H)}addAllAssetsToContainer(H){if(!H)return;const u=[],J=new Set;for(u.push(H);u.length>0;){const H=u.pop();if(H instanceof w.c?(H.Gg&&-1===this.geometries.indexOf(H.Gg)&&this.geometries.push(H.Gg),this.meshes.push(H)):H instanceof G.c?this.meshes.push(H):H instanceof g.c?this.transformNodes.push(H):H instanceof P.d?this.lights.push(H):H instanceof mH.c&&this.cameras.push(H),H instanceof B.c){if(H.material&&-1===this.materials.indexOf(H.material)){this.materials.push(H.material);for(const u of H.material.getActiveTextures())-1===this.textures.indexOf(u)&&this.textures.push(u)}H.skeleton&&-1===this.skeletons.indexOf(H.skeleton)&&this.skeletons.push(H.skeleton),H.morphTargetManager&&-1===this.morphTargetManagers.indexOf(H.morphTargetManager)&&this.morphTargetManagers.push(H.morphTargetManager)}for(const O of H.getChildren())J.has(O)||u.push(O);J.add(H)}this.populateRootNodes()}_getByTags(H,u,J){if(void 0===u)return H;const O=[];for(const U in H){const h=H[U];l.d&&l.d.MatchesQuery(h,u)&&(!J||J(h))&&O.push(h)}return O}getMeshesByTags(H,u){return this._getByTags(this.meshes,H,u)}getCamerasByTags(H,u){return this._getByTags(this.cameras,H,u)}getLightsByTags(H,u){return this._getByTags(this.lights,H,u)}getMaterialsByTags(H,u){return this._getByTags(this.materials,H,u).concat(this._getByTags(this.multiMaterials,H,u))}getTransformNodesByTags(H,u){return this._getByTags(this.transformNodes,H,u)}}var C=J(12221);class j{constructor(H){this.byteOffset=0,this.buffer=H}async loadAsync(H){const u=await this.buffer.readAsync(this.byteOffset,H);this._dataView=new DataView(u.buffer,u.byteOffset,u.byteLength),this._dataByteOffset=0}readUint32(){const H=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,H}readUint8Array(H){const u=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,H);return this._dataByteOffset+=H,this.byteOffset+=H,u}readString(H){return(0,C.j)(this.readUint8Array(H))}skipBytes(H){this._dataByteOffset+=H,this.byteOffset+=H}}var M=J(13965);const L="Z2xURg",Z={name:"xh",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:H=>-1!==H.indexOf("asset")&&-1!==H.indexOf("version")||H.startsWith("data:base64,"+L)||H.startsWith("data:;base64,"+L)||H.startsWith("data:application/octet-stream;base64,"+L)||H.startsWith("data:model/gltf-binary;base64,"+L)};var Y,F,s,A=J(12210),t=J(12213);function e(H,u,J){try{return Promise.resolve(new Uint8Array(H,u,J))}catch(O){return Promise.reject(O)}}!function(H){H[H.AUTO=0]="AUTO",H[H.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(Y||(Y={})),function(H){H[H.NONE=0]="NONE",H[H.FIRST=1]="FIRST",H[H.ALL=2]="ALL"}(F||(F={})),function(H){H[H.LOADING=0]="LOADING",H[H.READY=1]="READY",H[H.COMPLETE=2]="COMPLETE"}(s||(s={}));class c{constructor(){this.coordinateSystemMode=Y.AUTO,this.animationStartMode=F.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=H=>Promise.resolve(H),this.extensionOptions={}}O(H){H&&(this.onParsed=H.onParsed,this.coordinateSystemMode=H.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=H.animationStartMode??this.animationStartMode,this.loadNodeAnimations=H.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=H.loadSkins??this.loadSkins,this.loadMorphTargets=H.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=H.compileMaterials??this.compileMaterials,this.useClipPlane=H.useClipPlane??this.useClipPlane,this.compileShadowGenerators=H.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=H.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=H.useRangeRequests??this.useRangeRequests,this.createInstances=H.createInstances??this.createInstances,this.alwaysComputeBoundingBox=H.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=H.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=H.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=H.skipMaterials??this.skipMaterials,this.useSRGBBuffers=H.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=H.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=H.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=H.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=H.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=H.customRootNode,this.onMeshLoaded=H.onMeshLoaded,this.onSkinLoaded=H.onSkinLoaded,this.onTextureLoaded=H.onTextureLoaded,this.onMaterialLoaded=H.onMaterialLoaded,this.onCameraLoaded=H.onCameraLoaded,this.extensionOptions=H.extensionOptions??this.extensionOptions)}}class n extends c{constructor(H){super(),this.onParsedObservable=new O.b,this.onMeshLoadedObservable=new O.b,this.onSkinLoadedObservable=new O.b,this.onTextureLoadedObservable=new O.b,this.onMaterialLoadedObservable=new O.b,this.onCameraLoadedObservable=new O.b,this.onCompleteObservable=new O.b,this.onErrorObservable=new O.b,this.nh=new O.b,this.onExtensionLoadedObservable=new O.b,this.validate=!1,this.onValidatedObservable=new O.b,this._loader=null,this._state=null,this._requests=new Array,this.name=Z.name,this.extensions=Z.extensions,this.onLoaderStateChangedObservable=new O.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.O(H)}set onParsed(H){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),H&&(this._onParsedObserver=this.onParsedObservable.add(H))}set onMeshLoaded(H){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),H&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(H))}set onSkinLoaded(H){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),H&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((u=>H(u.node,u.skinnedNode))))}set onTextureLoaded(H){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),H&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(H))}set onMaterialLoaded(H){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),H&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(H))}set onCameraLoaded(H){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),H&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(H))}set onComplete(H){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(H)}set onError(H){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(H)}set onDispose(H){this._onDisposeObserver&&this.nh.remove(this._onDisposeObserver),this._onDisposeObserver=this.nh.add(H)}set onExtensionLoaded(H){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(H)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(H){this._loggingEnabled!==H&&(this._loggingEnabled=H,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(H){this._capturePerformanceCounters!==H&&(this._capturePerformanceCounters=H,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(H){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(H)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const H of this._requests)H.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=H=>Promise.resolve(H),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.nh.notifyObservers(void 0),this.nh.clear()}loadFile(H,u,J,h,w,g,B,d){if(ArrayBuffer.isView(u))return this._loadBinary(H,u,J,h,B,d),null;this._progressCallback=w;const G=u.name||U.Tools.GetFilename(u);if(g){if(this.useRangeRequests){this.validate&&b.b.Warn("glTF validation is not supported when range requests are enabled");const J={abort:()=>{},onCompleteObservable:new O.b},U={readAsync:(J,O)=>new Promise(((U,h)=>{this._loadFile(H,u,(H=>{U(new Uint8Array(H))}),!0,(H=>{h(H)}),(H=>{H.setRequestHeader("Range",`bytes=${J}-${J+O-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new j(U)).then((H=>{J.onCompleteObservable.notifyObservers(J),h(H)}),B?H=>B(void 0,H):void 0),J}return this._loadFile(H,u,(u=>{this._validate(H,new Uint8Array(u,0,u.byteLength),J,G),this._unpackBinaryAsync(new j({readAsync:(H,J)=>e(u,H,J),byteLength:u.byteLength})).then((H=>{h(H)}),B?H=>B(void 0,H):void 0)}),!0,B)}return this._loadFile(H,u,(u=>{try{this._validate(H,u,J,G),h({json:this._parseJson(u)})}catch{B&&B()}}),!1,B)}_loadBinary(H,u,J,O,U,h){this._validate(H,new Uint8Array(u.buffer,u.byteOffset,u.byteLength),J,h),this._unpackBinaryAsync(new j({readAsync:(H,J)=>function(H,u,J){try{if(u<0||u>=H.byteLength)throw new RangeError("Offset is out of range.");if(u+J>H.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(H.buffer,H.byteOffset+u,J))}catch(O){return Promise.reject(O)}}(u,H,J),byteLength:u.byteLength})).then((H=>{O(H)}),U?H=>U(void 0,H):void 0)}importMeshAsync(H,u,J,O,U,h){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(J),this.onParsedObservable.clear(),this._log(`Loading ${h||""}`),this._loader=this._getLoader(J),this._loader.importMeshAsync(H,u,null,J,O,U,h))))}loadAsync(H,u,J,O,U){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(u),this.onParsedObservable.clear(),this._log(`Loading ${U||""}`),this._loader=this._getLoader(u),this._loader.loadAsync(H,u,J,O,U))))}loadAssetContainerAsync(H,u,J,O,U){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(u),this.onParsedObservable.clear(),this._log(`Loading ${U||""}`),this._loader=this._getLoader(u);const h=new k(H),w=[];this.onMaterialLoadedObservable.add((H=>{w.push(H)}));const g=[];this.onTextureLoadedObservable.add((H=>{g.push(H)}));const B=[];this.onCameraLoadedObservable.add((H=>{B.push(H)}));const b=[];return this.onMeshLoadedObservable.add((H=>{H.morphTargetManager&&b.push(H.morphTargetManager)})),this._loader.importMeshAsync(null,H,h,u,J,O,U).then((H=>(Array.prototype.push.apply(h.geometries,H.geometries),Array.prototype.push.apply(h.meshes,H.meshes),Array.prototype.push.apply(h.pm,H.pm),Array.prototype.push.apply(h.skeletons,H.skeletons),Array.prototype.push.apply(h.animationGroups,H.animationGroups),Array.prototype.push.apply(h.materials,w),Array.prototype.push.apply(h.textures,g),Array.prototype.push.apply(h.lights,H.lights),Array.prototype.push.apply(h.transformNodes,H.transformNodes),Array.prototype.push.apply(h.cameras,B),Array.prototype.push.apply(h.morphTargetManagers,b),h)))}))}canDirectLoad(H){return Z.canDirectLoad(H)}directLoad(H,u){if(u.startsWith("base64,"+L)||u.startsWith(";base64,"+L)||u.startsWith("application/octet-stream;base64,"+L)||u.startsWith("model/gltf-binary;base64,"+L)){const J=(0,A.c)(u);return this._validate(H,new Uint8Array(J,0,J.byteLength)),this._unpackBinaryAsync(new j({readAsync:(H,u)=>e(J,H,u),byteLength:J.byteLength}))}return this._validate(H,u),Promise.resolve({json:this._parseJson(u)})}createPlugin(H){return new n(H[Z.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((H,u)=>{this.onCompleteObservable.addOnce((()=>{H()})),this.onErrorObservable.addOnce((H=>{u(H)}))}))}_setState(H){this._state!==H&&(this._state=H,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(s[this._state]))}_loadFile(H,u,J,O,U,h){const w=H._loadFile(u,J,(H=>{this._onProgress(H,w)}),!0,O,U,h);return w.onCompleteObservable.add((()=>{w._lengthComputable=!0,w._total=w._loaded})),this._requests.push(w),w}_onProgress(H,u){if(!this._progressCallback)return;u._lengthComputable=H.lengthComputable,u._loaded=H.loaded,u._total=H.total;let J=!0,O=0,U=0;for(const h of this._requests){if(void 0===h._lengthComputable||void 0===h._loaded||void 0===h._total)return;J=J&&h._lengthComputable,O+=h._loaded,U+=h._total}this._progressCallback({lengthComputable:J,loaded:O,total:J?U:0})}_validate(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),M.d.ValidateAsync(u,J,O,(u=>this.preprocessUrlAsync(J+u).then((u=>H._loadFileAsync(u,void 0,!0,!0).then((H=>new Uint8Array(H,0,H.byteLength))))))).then((H=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(H),this.onValidatedObservable.clear()}),(H=>{this._endPerformanceCounter("Validate JSON"),U.Tools.Warn(`Failed to validate: ${H.message}`),this.onValidatedObservable.clear()})))}_getLoader(H){const u=H.json.asset||{};this._log(`Asset version: ${u.version}`),u.minVersion&&this._log(`Asset minimum version: ${u.minVersion}`),u.generator&&this._log(`Asset generator: ${u.generator}`);const J=n._parseVersion(u.version);if(!J)throw new Error("Invalid version: "+u.version);if(void 0!==u.minVersion){const H=n._parseVersion(u.minVersion);if(!H)throw new Error("Invalid minimum version: "+u.minVersion);if(n._compareVersion(H,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+u.minVersion)}const O={1:n._CreateGLTF1Loader,2:n._CreateGLTF2Loader}[J.major];if(!O)throw new Error("Unsupported version: "+u.version);return O(this)}_parseJson(H){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${H.length}`);const u=JSON.parse(H);return this._endPerformanceCounter("Parse JSON"),u}_unpackBinaryAsync(H){return this._startPerformanceCounter("Unpack Binary"),H.loadAsync(20).then((()=>{const u=H.readUint32();if(1179937895!==u)throw new t.k("Unexpected magic: "+u,t.g.GLTFLoaderUnexpectedMagicError);const J=H.readUint32();this.loggingEnabled&&this._log(`Binary version: ${J}`);const O=H.readUint32();let U;switch(this.useRangeRequests||O===H.buffer.byteLength||b.b.Warn(`Length in header does not match actual data length: ${O} != ${H.buffer.byteLength}`),J){case 1:U=this._unpackBinaryV1Async(H,O);break;case 2:U=this._unpackBinaryV2Async(H,O);break;default:throw new Error("Unsupported version: "+J)}return this._endPerformanceCounter("Unpack Binary"),U}))}_unpackBinaryV1Async(H,u){const J=H.readUint32(),O=H.readUint32();if(0!==O)throw new Error(`Unexpected content format: ${O}`);const U=u-H.byteOffset,h={json:this._parseJson(H.readString(J)),bin:null};if(0!==U){const u=H.byteOffset;h.bin={readAsync:(J,O)=>H.buffer.readAsync(u+J,O),byteLength:U}}return Promise.resolve(h)}_unpackBinaryV2Async(H,u){const J=1313821514,O=5130562,U=H.readUint32();if(H.readUint32()!==J)throw new Error("First chunk format is not JSON");return H.byteOffset+U===u?H.loadAsync(U).then((()=>({json:this._parseJson(H.readString(U)),bin:null}))):H.loadAsync(U+8).then((()=>{const h={json:this._parseJson(H.readString(U)),bin:null},w=()=>{const U=H.readUint32();switch(H.readUint32()){case J:throw new Error("Unexpected JSON chunk");case O:{const u=H.byteOffset;h.bin={readAsync:(J,O)=>H.buffer.readAsync(u+J,O),byteLength:U},H.skipBytes(U);break}default:H.skipBytes(U)}return H.byteOffset!==u?H.loadAsync(8).then(w):Promise.resolve(h)};return w()}))}static _parseVersion(H){if("1.0"===H||"1.0.1"===H)return{major:1,minor:0};const u=(H+"").match(/^(\d+)\.(\d+)/);return u?{major:parseInt(u[1]),minor:parseInt(u[2])}:null}static _compareVersion(H,u){return H.major>u.major?1:H.major<u.major?-1:H.minor>u.minor?1:H.minor<u.minor?-1:0}_logOpen(H){this._log(H),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(H){const u=n._logSpaces.substring(0,2*this._logIndentLevel);b.b.Log(`${u}${H}`)}_logDisabled(H){}_startPerformanceCounterEnabled(H){U.Tools.StartPerformanceCounter(H)}_startPerformanceCounterDisabled(H){}_endPerformanceCounterEnabled(H){U.Tools.EndPerformanceCounter(H)}_endPerformanceCounterDisabled(H){}}n.IncrementalLoading=!0,n.HomogeneousCoordinates=!1,n._logSpaces="                                ",(0,h.c)(new n)},13965:(H,u,J)=>{"use strict";J.d(u,{d:()=>w});var O=J(12171);function U(H,u,J,O){const U={externalResourceFunction:O};return J&&(U.uri="file:"===u?J:u+J),ArrayBuffer.isView(H)?GLTFValidator.validateBytes(H,U):GLTFValidator.validateString(H,U)}function h(){const H=[];onmessage=u=>{const J=u.data;switch(J.id){case"init":importScripts(J.url);break;case"validate":U(J.data,J.rootUrl,J.fileName,(u=>new Promise(((J,O)=>{const U=H.length;H.push({resolve:J,reject:O}),postMessage({id:"getExternalResource",index:U,uri:u})})))).then((H=>{postMessage({id:"validate.resolve",value:H})}),(H=>{postMessage({id:"validate.reject",reason:H})}));break;case"getExternalResource.resolve":H[J.index].resolve(J.value);break;case"getExternalResource.reject":H[J.index].reject(J.reason)}}}class w{static ValidateAsync(H,u,J,w){return"function"===typeof Worker?new Promise(((g,B)=>{const b=`${U}(${h})()`,d=URL.createObjectURL(new Blob([b],{type:"application/javascript"})),G=new Worker(d),P=H=>{G.removeEventListener("error",P),G.removeEventListener("message",mH),B(H)},mH=H=>{const u=H.data;switch(u.id){case"getExternalResource":w(u.uri).then((H=>{G.postMessage({id:"getExternalResource.resolve",index:u.index,value:H},[H.buffer])}),(H=>{G.postMessage({id:"getExternalResource.reject",index:u.index,reason:H})}));break;case"validate.resolve":G.removeEventListener("error",P),G.removeEventListener("message",mH),g(u.value),G.terminate();break;case"validate.reject":G.removeEventListener("error",P),G.removeEventListener("message",mH),B(u.reason),G.terminate()}};if(G.addEventListener("error",P),G.addEventListener("message",mH),G.postMessage({id:"init",url:O.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(H)){const O=H.slice();G.postMessage({id:"validate",data:O,rootUrl:u,fileName:J},[O.buffer])}else G.postMessage({id:"validate",data:H,rootUrl:u,fileName:J})})):(this._LoadScriptPromise||(this._LoadScriptPromise=O.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>U(H,u,J,w))))}}w.Configuration={url:`${O.Tools._DefaultCdnUrl}/gltf_validator.js`}},14499:(H,u,J)=>{"use strict";J.d(u,{c:()=>Z});var O=J(12324),U=J(12329),h=J(12365),w=J(12338),g=J(12691),B=J(12645),b=J(12410),d=J(12568),G=J(12304),P=J(12259);J(13729),J(13634),J(13655),J(13643),J(13664),J(13669),J(13672);const mH="imageProcessingCompatibility",l="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";P.b.IncludesShadersStore[mH]||(P.b.IncludesShadersStore[mH]=l);const r="skyPixelShader",p="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";P.b.ShadersStore[r]||(P.b.ShadersStore[r]=p);J(13745),J(13675),J(13679),J(13687),J(13683);const a="skyVertexShader",k="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";P.b.ShadersStore[a]||(P.b.ShadersStore[a]=k);var C=J(12641),j=J(12675),M=J(12673);class L extends g.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class Z extends B.c{constructor(H,u){super(H,u),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new w.lu(0,100,0),this.useSunPosition=!1,this.cameraOffset=w.lu.Zero(),this.up=w.lu.Up(),this.dithering=!1,this._cameraPosition=w.lu.Zero(),this._skyOrientation=new w.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(H,u){const J=u._drawWrapper;if(this.isFrozen&&J.effect&&J._wasPreviouslyReady)return!0;u.materialDefines||(u.materialDefines=new L);const O=u.materialDefines,U=this.ZH();if(this._isReadyForSubMesh(u))return!0;if((0,M.T)(H,U,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,O),(0,M.G)(H,O,!0,!1),O.IMAGEPROCESSINGPOSTPROCESS!==U.imageProcessingConfiguration.applyByPostProcess&&O.markAsMiscDirty(),O.DITHER!==this.dithering&&O.markAsMiscDirty(),O.isDirty){O.markAsProcessed(),U.resetCachedMaterial();const H=new C.e;O.FOG&&H.addFallback(1,"FOG"),O.IMAGEPROCESSINGPOSTPROCESS=U.imageProcessingConfiguration.applyByPostProcess,O.DITHER=this.dithering;const J=[b.d.PositionKind];O.VERTEXCOLOR&&J.push(b.d.ColorKind);const h="sky",w=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,j.e)(w);const g=O.toString();u.setEffect(U.getEngine().createEffect(h,J,w,[],g,H,this.onCompiled,this.onError),O,this._materialContext)}return!(!u.effect||!u.effect.isReady())&&(O._renderId=U.getRenderId(),J._wasPreviouslyReady=!0,!0)}bindForSubMesh(H,u,J){const O=this.ZH(),U=J.materialDefines;if(!U)return;const h=J.effect;if(!h)return;this._activeEffect=h,this.bindOnlyWorldMatrix(H),this._activeEffect.setMatrix("viewProjection",O.getTransformMatrix()),this._mustRebind(O,h,J)&&((0,j.f)(h,this,O),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,M.h)(U,h,O)),O.fogEnabled&&u.applyFog&&O.fogMode!==d.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",O.getViewMatrix()),(0,M.c)(O,u,this._activeEffect);const g=O.activeCamera;if(g){const H=g.getWorldMatrix();this._cameraPosition.x=H.m[12],this._cameraPosition.y=H.m[13],this._cameraPosition.z=H.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const H=Math.PI*(this.inclination-.5),u=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(u)*Math.cos(H),this.sunPosition.y=this.distance*Math.sin(-H),this.sunPosition.z=this.distance*Math.sin(u)*Math.cos(H),w.Quaternion.FromUnitVectorsToRef(w.lu.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(u,this._activeEffect,J)}getAnimatables(){return[]}dispose(H){super.dispose(H)}clone(H){return h.d.Clone((()=>new Z(H,this.ZH())),this)}serialize(){const H=super.serialize();return H.customType="BABYLON.SkyMaterial",H}getClassName(){return"SkyMaterial"}static Parse(H,u,J){return h.d.Parse((()=>new Z(H.name,u)),H,u,J)}}(0,O.c)([(0,U.I)()],Z.prototype,"luminance",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"turbidity",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"rayleigh",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"mieCoefficient",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"mieDirectionalG",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"distance",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"inclination",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"azimuth",void 0),(0,O.c)([(0,U.G)()],Z.prototype,"sunPosition",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"useSunPosition",void 0),(0,O.c)([(0,U.G)()],Z.prototype,"cameraOffset",void 0),(0,O.c)([(0,U.G)()],Z.prototype,"up",void 0),(0,O.c)([(0,U.I)()],Z.prototype,"dithering",void 0),(0,G.f)("BABYLON.SkyMaterial",Z)},13023:(H,u,J)=>{"use strict";function O(H,u){u.headers=H.headers||{},u.statusMessage=H.statusText,u.statusCode=H.status,u.data=H.response}function U(H,u,J){return new Promise((function(U,h){J=J||{};var w,g,B,b=new XMLHttpRequest,d=J.body,G=J.headers||{};for(w in J.timeout&&(b.timeout=J.timeout),b.ontimeout=b.onerror=function(H){H.timeout="timeout"==H.type,h(H)},b.open(H,u.href||u),b.onload=function(){for(B=b.getAllResponseHeaders().trim().split(/[\r\n]+/),O(b,b);g=B.shift();)g=g.split(": "),b.headers[g.shift().toLowerCase()]=g.join(": ");if((g=b.headers["content-type"])&&~g.indexOf("application/json"))try{b.data=JSON.parse(b.data,J.reviver)}catch(H){return O(b,H),h(H)}(b.status>=400?h:U)(b)},typeof FormData<"u"&&d instanceof FormData||d&&"object"==typeof d&&(G["content-type"]="application/json",d=JSON.stringify(d)),b.withCredentials=!!J.withCredentials,G)b.setRequestHeader(w,G[w]);b.send(d)}))}J.r(u),J.d(u,{del:()=>B,get:()=>h,patch:()=>g,post:()=>w,put:()=>b,send:()=>U});var h=U.bind(U,"GET"),w=U.bind(U,"POST"),g=U.bind(U,"PATCH"),B=U.bind(U,"DELETE"),b=U.bind(U,"PUT")},14602:(H,u,J)=>{"use strict";J.d(u,{b:()=>G});const O=.5*(Math.sqrt(3)-1),U=(3-Math.sqrt(3))/6,h=1/3,w=1/6,g=(Math.sqrt(5)-1)/4,B=(5-Math.sqrt(5))/20,b=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),d=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const G=class{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const u="function"==typeof H?H:function(H){let u=0,J=0,O=0,U=1;const h=function(){let H=4022871197;return function(u){u=u.toString();for(let J=0;J<u.length;J++){H+=u.charCodeAt(J);let O=.02519603282416938*H;H=O>>>0,O-=H,O*=H,H=O>>>0,O-=H,H+=4294967296*O}return 2.3283064365386963e-10*(H>>>0)}}();u=h(" "),J=h(" "),O=h(" "),u-=h(H),u<0&&(u+=1);J-=h(H),J<0&&(J+=1);O-=h(H),O<0&&(O+=1);return function(){const H=2091639*u+2.3283064365386963e-10*U;return u=J,J=O,O=H-(U=0|H)}}(H);this.p=function(H){const u=new Uint8Array(256);for(let J=0;J<256;J++)u[J]=J;for(let J=0;J<255;J++){const O=J+~~(H()*(256-J)),U=u[J];u[J]=u[O],u[O]=U}return u}(u),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let J=0;J<512;J++)this.perm[J]=this.p[255&J],this.permMod12[J]=this.perm[J]%12}noise2D(H,u){const J=this.permMod12,h=this.perm;let w=0,g=0,B=0;const d=(H+u)*O,G=Math.floor(H+d),P=Math.floor(u+d),mH=(G+P)*U,l=H-(G-mH),r=u-(P-mH);let p,a;l>r?(p=1,a=0):(p=0,a=1);const k=l-p+U,C=r-a+U,j=l-1+2*U,M=r-1+2*U,L=255&G,Z=255&P;let Y=.5-l*l-r*r;if(Y>=0){const H=3*J[L+h[Z]];Y*=Y,w=Y*Y*(b[H]*l+b[H+1]*r)}let F=.5-k*k-C*C;if(F>=0){const H=3*J[L+p+h[Z+a]];F*=F,g=F*F*(b[H]*k+b[H+1]*C)}let s=.5-j*j-M*M;if(s>=0){const H=3*J[L+1+h[Z+1]];s*=s,B=s*s*(b[H]*j+b[H+1]*M)}return 70*(w+g+B)}noise3D(H,u,J){const O=this.permMod12,U=this.perm;let g,B,d,G;const P=(H+u+J)*h,mH=Math.floor(H+P),l=Math.floor(u+P),r=Math.floor(J+P),p=(mH+l+r)*w,a=H-(mH-p),k=u-(l-p),C=J-(r-p);let j,M,L,Z,Y,F;a>=k?k>=C?(j=1,M=0,L=0,Z=1,Y=1,F=0):a>=C?(j=1,M=0,L=0,Z=1,Y=0,F=1):(j=0,M=0,L=1,Z=1,Y=0,F=1):k<C?(j=0,M=0,L=1,Z=0,Y=1,F=1):a<C?(j=0,M=1,L=0,Z=0,Y=1,F=1):(j=0,M=1,L=0,Z=1,Y=1,F=0);const s=a-j+w,A=k-M+w,t=C-L+w,e=a-Z+2*w,c=k-Y+2*w,n=C-F+2*w,V=a-1+.5,T=k-1+.5,R=C-1+.5,X=255&mH,W=255&l,f=255&r;let i=.6-a*a-k*k-C*C;if(i<0)g=0;else{const H=3*O[X+U[W+U[f]]];i*=i,g=i*i*(b[H]*a+b[H+1]*k+b[H+2]*C)}let S=.6-s*s-A*A-t*t;if(S<0)B=0;else{const H=3*O[X+j+U[W+M+U[f+L]]];S*=S,B=S*S*(b[H]*s+b[H+1]*A+b[H+2]*t)}let v=.6-e*e-c*c-n*n;if(v<0)d=0;else{const H=3*O[X+Z+U[W+Y+U[f+F]]];v*=v,d=v*v*(b[H]*e+b[H+1]*c+b[H+2]*n)}let I=.6-V*V-T*T-R*R;if(I<0)G=0;else{const H=3*O[X+1+U[W+1+U[f+1]]];I*=I,G=I*I*(b[H]*V+b[H+1]*T+b[H+2]*R)}return 32*(g+B+d+G)}noise4D(H,u,J,O){const U=this.perm;let h,w,b,G,P;const mH=(H+u+J+O)*g,l=Math.floor(H+mH),r=Math.floor(u+mH),p=Math.floor(J+mH),a=Math.floor(O+mH),k=(l+r+p+a)*B,C=H-(l-k),j=u-(r-k),M=J-(p-k),L=O-(a-k);let Z=0,Y=0,F=0,s=0;C>j?Z++:Y++,C>M?Z++:F++,C>L?Z++:s++,j>M?Y++:F++,j>L?Y++:s++,M>L?F++:s++;const A=Z>=3?1:0,t=Y>=3?1:0,e=F>=3?1:0,c=s>=3?1:0,n=Z>=2?1:0,V=Y>=2?1:0,T=F>=2?1:0,R=s>=2?1:0,X=Z>=1?1:0,W=Y>=1?1:0,f=F>=1?1:0,i=s>=1?1:0,S=C-A+B,v=j-t+B,I=M-e+B,D=L-c+B,o=C-n+2*B,y=j-V+2*B,x=M-T+2*B,z=L-R+2*B,K=C-X+3*B,N=j-W+3*B,q=M-f+3*B,E=L-i+3*B,Q=C-1+4*B,HH=j-1+4*B,uH=M-1+4*B,JH=L-1+4*B,OH=255&l,UH=255&r,hH=255&p,wH=255&a;let gH=.6-C*C-j*j-M*M-L*L;if(gH<0)h=0;else{const H=U[OH+U[UH+U[hH+U[wH]]]]%32*4;gH*=gH,h=gH*gH*(d[H]*C+d[H+1]*j+d[H+2]*M+d[H+3]*L)}let BH=.6-S*S-v*v-I*I-D*D;if(BH<0)w=0;else{const H=U[OH+A+U[UH+t+U[hH+e+U[wH+c]]]]%32*4;BH*=BH,w=BH*BH*(d[H]*S+d[H+1]*v+d[H+2]*I+d[H+3]*D)}let bH=.6-o*o-y*y-x*x-z*z;if(bH<0)b=0;else{const H=U[OH+n+U[UH+V+U[hH+T+U[wH+R]]]]%32*4;bH*=bH,b=bH*bH*(d[H]*o+d[H+1]*y+d[H+2]*x+d[H+3]*z)}let dH=.6-K*K-N*N-q*q-E*E;if(dH<0)G=0;else{const H=U[OH+X+U[UH+W+U[hH+f+U[wH+i]]]]%32*4;dH*=dH,G=dH*dH*(d[H]*K+d[H+1]*N+d[H+2]*q+d[H+3]*E)}let GH=.6-Q*Q-HH*HH-uH*uH-JH*JH;if(GH<0)P=0;else{const H=U[OH+1+U[UH+1+U[hH+1+U[wH+1]]]]%32*4;GH*=GH,P=GH*GH*(d[H]*Q+d[H+1]*HH+d[H+2]*uH+d[H+3]*JH)}return 27*(h+w+b+G+P)}}}}]);