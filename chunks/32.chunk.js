/*! For license information please see urj3w.32.f691450c.chunk.js.LICENSE.txt */
(self.fkqm0epoq5=self.fkqm0epoq5||[]).push([[32],{13664:(D,l,G)=>{"use strict";var V=G(13666),N=G(13668),M=G(13672);G.g.__TYPEDARRAY_POOL||(G.g.__TYPEDARRAY_POOL={UINT8:N([32,0]),UINT16:N([32,0]),UINT32:N([32,0]),INT8:N([32,0]),INT16:N([32,0]),INT32:N([32,0]),FLOAT:N([32,0]),DOUBLE:N([32,0]),DATA:N([32,0]),UINT8C:N([32,0]),BUFFER:N([32,0])});var b="undefined"!==typeof Uint8ClampedArray,X=G.g.__TYPEDARRAY_POOL;X.UINT8C||(X.UINT8C=N([32,0])),X.BUFFER||(X.BUFFER=N([32,0]));var t=X.DATA,R=X.BUFFER;function n(D){if(D){var l=D.length||D.byteLength,G=V.log2(l);t[G].push(D)}}function g(D){D=V.nextPow2(D);var l=V.log2(D),G=t[l];return G.length>0?G.pop():new ArrayBuffer(D)}function j(D){return new Uint8Array(g(D),0,D)}function e(D){return new Uint16Array(g(2*D),0,D)}function K(D){return new Uint32Array(g(4*D),0,D)}function F(D){return new Int8Array(g(D),0,D)}function d(D){return new Int16Array(g(2*D),0,D)}function H(D){return new Int32Array(g(4*D),0,D)}function h(D){return new Float32Array(g(4*D),0,D)}function x(D){return new Float64Array(g(8*D),0,D)}function r(D){return b?new Uint8ClampedArray(g(D),0,D):j(D)}function o(D){return new DataView(g(D),0,D)}l.free=function(D){if(M(D))R[V.log2(D.length)].push(D);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(D)&&(D=D.buffer),!D)return;var l=D.length||D.byteLength,G=0|V.log2(l);t[G].push(D)}},l.freeUint8=l.freeUint16=l.freeUint32=l.freeInt8=l.freeInt16=l.freeInt32=l.freeFloat32=l.freeFloat=l.freeFloat64=l.freeDouble=l.freeUint8Clamped=l.freeDataView=function(D){n(D.buffer)},l.freeArrayBuffer=n,l.freeBuffer=function(D){R[V.log2(D.length)].push(D)},l.malloc=function(D,l){if(void 0===l||"arraybuffer"===l)return g(D);switch(l){case"uint8":return j(D);case"uint16":return e(D);case"uint32":return K(D);case"int8":return F(D);case"int16":return d(D);case"int32":return H(D);case"float":case"float32":return h(D);case"double":case"float64":return x(D);case"uint8_clamped":return r(D);case"buffer":throw"Buffer not supported";case"data":case"dataview":return o(D);default:return null}return null},l.mallocArrayBuffer=g,l.mallocUint8=j,l.mallocUint16=e,l.mallocUint32=K,l.mallocInt8=F,l.mallocInt16=d,l.mallocInt32=H,l.mallocFloat32=l.mallocFloat=h,l.mallocFloat64=l.mallocDouble=x,l.mallocUint8Clamped=r,l.mallocDataView=o,l.clearCache=function(){for(var D=0;D<32;++D)X.UINT8[D].length=0,X.UINT16[D].length=0,X.UINT32[D].length=0,X.INT8[D].length=0,X.INT16[D].length=0,X.INT32[D].length=0,X.FLOAT[D].length=0,X.DOUBLE[D].length=0,X.UINT8C[D].length=0,t[D].length=0,R[D].length=0}},13749:(D,l,G)=>{D.exports=N;var V=G(12566);function N(D,l){if(!(this instanceof N))return new N(D,l);var G=V.create();V.add(G,D,l),this.base=V.min(V.create(),D,G),this.Xn=V.clone(l),this.max=V.max(V.create(),D,G),this.mag=V.length(this.Xn)}var M=N.prototype;M.width=function(){return this.Xn[0]},M.height=function(){return this.Xn[1]},M.depth=function(){return this.Xn[2]},M.x0=function(){return this.base[0]},M.y0=function(){return this.base[1]},M.z0=function(){return this.base[2]},M.x1=function(){return this.max[0]},M.y1=function(){return this.max[1]},M.z1=function(){return this.max[2]},M.translate=function(D){return V.add(this.max,this.max,D),V.add(this.base,this.base,D),this},M.setPosition=function(D){return V.add(this.max,D,this.Xn),V.k(this.base,D),this},M.expand=function(D){var l=V.create(),G=V.create();return V.max(l,D.max,this.max),V.min(G,D.base,this.base),V.Fl(l,l,G),new N(G,l)},M.intersects=function(D){return!(D.base[0]>this.max[0])&&(!(D.base[1]>this.max[1])&&(!(D.base[2]>this.max[2])&&(!(D.max[0]<this.base[0])&&(!(D.max[1]<this.base[1])&&!(D.max[2]<this.base[2])))))},M.touches=function(D){var l=this.union(D);return null!==l&&(0==l.width()||0==l.height()||0==l.depth())},M.union=function(D){if(!this.intersects(D))return null;var l=Math.max(D.base[0],this.base[0]),G=Math.max(D.base[1],this.base[1]),V=Math.max(D.base[2],this.base[2]);return new N([l,G,V],[Math.min(D.max[0],this.max[0])-l,Math.min(D.max[1],this.max[1])-G,Math.min(D.max[2],this.max[2])-V])}},13666:(D,l)=>{"use strict";function G(D){var l=32;return(D&=-D)&&l--,65535&D&&(l-=16),16711935&D&&(l-=8),252645135&D&&(l-=4),858993459&D&&(l-=2),1431655765&D&&(l-=1),l}l.INT_BITS=32,l.INT_MAX=2147483647,l.INT_MIN=-1<<31,l.sign=function(D){return(D>0)-(D<0)},l.abs=function(D){var l=D>>31;return(D^l)-l},l.min=function(D,l){return l^(D^l)&-(D<l)},l.max=function(D,l){return D^(D^l)&-(D<l)},l.isPow2=function(D){return!(D&D-1)&&!!D},l.log2=function(D){var l,G;return l=(D>65535)<<4,l|=G=((D>>>=l)>255)<<3,l|=G=((D>>>=G)>15)<<2,(l|=G=((D>>>=G)>3)<<1)|(D>>>=G)>>1},l.log10=function(D){return D>=1e9?9:D>=1e8?8:D>=1e7?7:D>=1e6?6:D>=1e5?5:D>=1e4?4:D>=1e3?3:D>=100?2:D>=10?1:0},l.popCount=function(D){return 16843009*((D=(858993459&(D-=D>>>1&1431655765))+(D>>>2&858993459))+(D>>>4)&252645135)>>>24},l.countTrailingZeros=G,l.nextPow2=function(D){return D+=0===D,--D,D|=D>>>1,D|=D>>>2,D|=D>>>4,D|=D>>>8,(D|=D>>>16)+1},l.prevPow2=function(D){return D|=D>>>1,D|=D>>>2,D|=D>>>4,D|=D>>>8,(D|=D>>>16)-(D>>>1)},l.parity=function(D){return D^=D>>>16,D^=D>>>8,D^=D>>>4,27030>>>(D&=15)&1};var V=new Array(256);!function(D){for(var l=0;l<256;++l){var G=l,V=l,N=7;for(G>>>=1;G;G>>>=1)V<<=1,V|=1&G,--N;D[l]=V<<N&255}}(V),l.reverse=function(D){return V[255&D]<<24|V[D>>>8&255]<<16|V[D>>>16&255]<<8|V[D>>>24&255]},l.interleave2=function(D,l){return(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D&=65535)|D<<8))|D<<4))|D<<2))|D<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l&=65535)|l<<8))|l<<4))|l<<2))|l<<1))<<1},l.deinterleave2=function(D,l){return(D=65535&((D=16711935&((D=252645135&((D=858993459&((D=D>>>l&1431655765)|D>>>1))|D>>>2))|D>>>4))|D>>>16))<<16>>16},l.interleave3=function(D,l,G){return D=1227133513&((D=3272356035&((D=251719695&((D=4278190335&((D&=1023)|D<<16))|D<<8))|D<<4))|D<<2),(D|=(l=1227133513&((l=3272356035&((l=251719695&((l=4278190335&((l&=1023)|l<<16))|l<<8))|l<<4))|l<<2))<<1)|(G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2))<<2},l.deinterleave3=function(D,l){return(D=1023&((D=4278190335&((D=251719695&((D=3272356035&((D=D>>>l&1227133513)|D>>>2))|D>>>4))|D>>>8))|D>>>16))<<22>>22},l.nextCombination=function(D){var l=D|D-1;return l+1|(~l&-~l)-1>>>G(D)+1}},13657:(D,l,G)=>{"use strict";D.exports=function(D,l,G){switch(arguments.length){case 1:return V=[],R(N=D,N,n,!0),V;case 2:return"function"===typeof l?R(D,D,l,!0):function(D,l){return V=[],R(D,l,n,!1),V}(D,l);case 3:return R(D,l,G,!1);default:throw new Error("box-intersect: Invalid arguments")}var N};var V,N=G(13664),M=G(13677),b=G(13690);function X(D,l){for(var G=0;G<D;++G)if(!(l[G]<=l[G+D]))return!0;return!1}function t(D,l,G,V){for(var N=0,M=0,b=0,t=D.length;b<t;++b){var R=D[b];if(!X(l,R)){for(var n=0;n<2*l;++n)G[N++]=R[n];V[M++]=b}}return M}function R(D,l,G,V){var X=D.length,R=l.length;if(!(X<=0||R<=0)){var n=D[0].length>>>1;if(!(n<=0)){var g,j=N.mallocDouble(2*n*X),e=N.mallocInt32(X);if((X=t(D,n,j,e))>0){if(1===n&&V)M.init(X),g=M.sweepComplete(n,G,0,X,j,e,0,X,j,e);else{var K=N.mallocDouble(2*n*R),F=N.mallocInt32(R);(R=t(l,n,K,F))>0&&(M.init(X+R),g=1===n?M.sweepBipartite(n,G,0,X,j,e,0,R,K,F):b(n,G,V,X,j,e,R,K,F),N.free(K),N.free(F))}N.free(j),N.free(e)}return g}}}function n(D,l){V.push([D,l])}},13695:(D,l)=>{"use strict";var G="d",V="ax",N="fp",M="es",b="rs",X="re",t="rb",R="bs",n="be",g="bb",j=[G,V,"vv",b,X,t,"ri",R,n,g,"bi"];function e(D){var l="bruteForce"+(D?"Full":"Partial"),V=[],b=j.slice();D||b.splice(3,0,N);var X=["function "+l+"("+b.join()+"){"];function t(l,N){var b=function(D,l,V){var N="bruteForce"+(D?"Red":"Blue")+(l?"Flip":"")+(V?"Full":""),b=["function ",N,"(",j.join(),"){","var ",M,"=2*",G,";"],X="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",t="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(V?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return D?b.push(X,"Q",":",t):b.push(t,"Q",":",X),V?b.push("if(y1<x0||x1<y0)continue;"):l?b.push("if(y0<=x0||x1<y0)continue;"):b.push("if(y0<x0||x1<y0)continue;"),b.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),l?b.push("yi,xi"):b.push("xi,yi"),b.push(");if(rv!==void 0)return rv;}}}"),{name:N,code:b.join("")}}(l,N,D);V.push(b.code),X.push("return "+b.name+"("+j.join()+");")}X.push("if(re-rs>be-bs){"),D?(t(!0,!1),X.push("}else{"),t(!1,!1)):(X.push("if(fp){"),t(!0,!0),X.push("}else{"),t(!0,!1),X.push("}}else{if(fp){"),t(!1,!0),X.push("}else{"),t(!1,!1),X.push("}")),X.push("}}return "+l);var R=V.join("")+X.join("");return new Function(R)()}l.partial=e(!1),l.full=e(!0)},13690:(D,l,G)=>{"use strict";D.exports=function(D,l,G,M,n,i,y,S,O){!function(D,l){var G=8*N.log2(l+1)*(D+1)|0,M=N.nextPow2(r*G);L.length<M&&(V.free(L),L=V.mallocInt32(M));var b=N.nextPow2(o*G);u.length<b&&(V.free(u),u=V.mallocDouble(b))}(D,M+y);var s,U=0,f=2*D;B(U++,0,0,M,0,y,G?16:0,-1/0,1/0),G||B(U++,0,0,y,0,M,1,-1/0,1/0);for(;U>0;){var q=(U-=1)*r,c=L[q],v=L[q+1],Z=L[q+2],J=L[q+3],Y=L[q+4],z=L[q+5],E=U*o,P=u[E],p=u[E+1],k=1&z,m=!!(16&z),T=n,C=i,w=S,A=O;if(k&&(T=S,C=O,w=n,A=i),!(2&z&&v>=(Z=d(D,c,v,Z,T,C,p)))&&!(4&z&&(v=H(D,c,v,Z,T,C,P))>=Z)){var a=Z-v,Q=Y-J;if(m){if(D*a*(a+Q)<e){if(void 0!==(s=t.scanComplete(D,c,l,v,Z,T,C,J,Y,w,A)))return s;continue}}else{if(D*Math.min(a,Q)<g){if(void 0!==(s=b(D,c,l,k,v,Z,T,C,J,Y,w,A)))return s;continue}if(D*a*Q<j){if(void 0!==(s=t.scanBipartite(D,c,l,k,v,Z,T,C,J,Y,w,A)))return s;continue}}var DD=K(D,c,v,Z,T,C,P,p);if(v<DD)if(D*(DD-v)<g){if(void 0!==(s=X(D,c+1,l,v,DD,T,C,J,Y,w,A)))return s}else if(c===D-2){if(void 0!==(s=k?t.sweepBipartite(D,l,J,Y,w,A,v,DD,T,C):t.sweepBipartite(D,l,v,DD,T,C,J,Y,w,A)))return s}else B(U++,c+1,v,DD,J,Y,k,-1/0,1/0),B(U++,c+1,J,Y,v,DD,1^k,-1/0,1/0);if(DD<Z){var lD=R(D,c,J,Y,w,A),GD=w[f*lD+c],VD=F(D,c,lD,Y,w,A,GD);if(VD<Y&&B(U++,c,DD,Z,VD,Y,(4|k)+(m?16:0),GD,p),J<lD&&B(U++,c,DD,Z,J,lD,(2|k)+(m?16:0),P,GD),lD+1===VD){if(void 0!==(s=m?W(D,c,l,DD,Z,T,C,lD,w,A[lD]):I(D,c,l,k,DD,Z,T,C,lD,w,A[lD])))return s}else if(lD<VD){var ND;if(m){if(DD<(ND=h(D,c,DD,Z,T,C,GD))){var MD=F(D,c,DD,ND,T,C,GD);if(c===D-2){if(DD<MD&&void 0!==(s=t.sweepComplete(D,l,DD,MD,T,C,lD,VD,w,A)))return s;if(MD<ND&&void 0!==(s=t.sweepBipartite(D,l,MD,ND,T,C,lD,VD,w,A)))return s}else DD<MD&&B(U++,c+1,DD,MD,lD,VD,16,-1/0,1/0),MD<ND&&(B(U++,c+1,MD,ND,lD,VD,0,-1/0,1/0),B(U++,c+1,lD,VD,MD,ND,1,-1/0,1/0))}}else DD<(ND=k?x(D,c,DD,Z,T,C,GD):h(D,c,DD,Z,T,C,GD))&&(c===D-2?s=k?t.sweepBipartite(D,l,lD,VD,w,A,DD,ND,T,C):t.sweepBipartite(D,l,DD,ND,T,C,lD,VD,w,A):(B(U++,c+1,DD,ND,lD,VD,k,-1/0,1/0),B(U++,c+1,lD,VD,DD,ND,1^k,-1/0,1/0)))}}}}};var V=G(13664),N=G(13666),M=G(13695),b=M.partial,X=M.full,t=G(13677),R=G(13701),n=G(13708),g=128,j=1<<22,e=1<<22,K=n("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),F=n("lo===p0",["p0"]),d=n("lo<p0",["p0"]),H=n("hi<=p0",["p0"]),h=n("lo<=p0&&p0<=hi",["p0"]),x=n("lo<p0&&p0<=hi",["p0"]),r=6,o=2,L=V.mallocInt32(1024),u=V.mallocDouble(1024);function B(D,l,G,V,N,M,b,X,t){var R=r*D;L[R]=l,L[R+1]=G,L[R+2]=V,L[R+3]=N,L[R+4]=M,L[R+5]=b;var n=o*D;u[n]=X,u[n+1]=t}function I(D,l,G,V,N,M,b,X,t,R,n){var g=2*D,j=t*g,e=R[j+l];D:for(var K=N,F=N*g;K<M;++K,F+=g){var d=b[F+l],H=b[F+l+D];if(!(e<d||H<e)&&(!V||e!==d)){for(var h,x=X[K],r=l+1;r<D;++r){d=b[F+r],H=b[F+r+D];var o=R[j+r],L=R[j+r+D];if(H<o||L<d)continue D}if(void 0!==(h=V?G(n,x):G(x,n)))return h}}}function W(D,l,G,V,N,M,b,X,t,R){var n=2*D,g=X*n,j=t[g+l];D:for(var e=V,K=V*n;e<N;++e,K+=n){var F=b[e];if(F!==R){var d=M[K+l],H=M[K+l+D];if(!(j<d||H<j)){for(var h=l+1;h<D;++h){d=M[K+h],H=M[K+h+D];var x=t[g+h],r=t[g+h+D];if(H<x||r<d)continue D}var o=G(F,R);if(void 0!==o)return o}}}}},13701:(D,l,G)=>{"use strict";D.exports=function(D,l,G,b,X,t){if(b<=G+1)return G;var R=G,n=b,g=b+G>>>1,j=2*D,e=g,K=X[j*g+l];for(;R<n;){if(n-R<N){M(D,l,R,n,X,t),K=X[j*g+l];break}var F=n-R,d=Math.random()*F+R|0,H=X[j*d+l],h=Math.random()*F+R|0,x=X[j*h+l],r=Math.random()*F+R|0,o=X[j*r+l];H<=x?o>=x?(e=h,K=x):H>=o?(e=d,K=H):(e=r,K=o):x>=o?(e=h,K=x):o>=H?(e=d,K=H):(e=r,K=o);for(var L=j*(n-1),u=j*e,B=0;B<j;++B,++L,++u){var I=X[L];X[L]=X[u],X[u]=I}var W=t[n-1];t[n-1]=t[e],t[e]=W;for(L=j*(n-1),u=j*(e=V(D,l,R,n-1,X,t,K)),B=0;B<j;++B,++L,++u){I=X[L];X[L]=X[u],X[u]=I}W=t[n-1];if(t[n-1]=t[e],t[e]=W,g<e){for(n=e-1;R<n&&X[j*(n-1)+l]===K;)n-=1;n+=1}else{if(!(e<g))break;for(R=e+1;R<n&&X[j*R+l]===K;)R+=1}}return V(D,l,G,g,X,t,X[j*g+l])};var V=G(13708)("lo<p0",["p0"]),N=8;function M(D,l,G,V,N,M){for(var b=2*D,X=b*(G+1)+l,t=G+1;t<V;++t,X+=b)for(var R=N[X],n=t,g=b*(t-1);n>G&&N[g+l]>R;--n,g-=b){for(var j=g,e=g+b,K=0;K<b;++K,++j,++e){var F=N[j];N[j]=N[e],N[e]=F}var d=M[n];M[n]=M[n-1],M[n-1]=d}}},13708:D=>{"use strict";D.exports=function(D,G){var V="abcdef".split("").concat(G),N=[];D.indexOf("lo")>=0&&N.push("lo=e[k+n]");D.indexOf("hi")>=0&&N.push("hi=e[k+o]");return V.push(l.replace("_",N.join()).replace("$",D)),Function.apply(void 0,V)};var l="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13682:D=>{"use strict";D.exports=function(D,V){V<=4*l?G(0,V-1,D):R(0,V-1,D)};var l=32;function G(D,l,G){for(var V=2*(D+1),N=D+1;N<=l;++N){for(var M=G[V++],b=G[V++],X=N,t=V-2;X-- >D;){var R=G[t-2],n=G[t-1];if(R<M)break;if(R===M&&n<b)break;G[t]=R,G[t+1]=n,t-=2}G[t]=M,G[t+1]=b}}function V(D,l,G){l*=2;var V=G[D*=2],N=G[D+1];G[D]=G[l],G[D+1]=G[l+1],G[l]=V,G[l+1]=N}function N(D,l,G){l*=2,G[D*=2]=G[l],G[D+1]=G[l+1]}function M(D,l,G,V){l*=2,G*=2;var N=V[D*=2],M=V[D+1];V[D]=V[l],V[D+1]=V[l+1],V[l]=V[G],V[l+1]=V[G+1],V[G]=N,V[G+1]=M}function b(D,l,G,V,N){l*=2,N[D*=2]=N[l],N[l]=G,N[D+1]=N[l+1],N[l+1]=V}function X(D,l,G){l*=2;var V=G[D*=2],N=G[l];return!(V<N)&&(V!==N||G[D+1]>G[l+1])}function t(D,l,G,V){var N=V[D*=2];return N<l||N===l&&V[D+1]<G}function R(D,n,g){var j=(n-D+1)/6|0,e=D+j,K=n-j,F=D+n>>1,d=F-j,H=F+j,h=e,x=d,r=F,o=H,L=K,u=D+1,B=n-1,I=0;X(h,x,g)&&(I=h,h=x,x=I),X(o,L,g)&&(I=o,o=L,L=I),X(h,r,g)&&(I=h,h=r,r=I),X(x,r,g)&&(I=x,x=r,r=I),X(h,o,g)&&(I=h,h=o,o=I),X(r,o,g)&&(I=r,r=o,o=I),X(x,L,g)&&(I=x,x=L,L=I),X(x,r,g)&&(I=x,x=r,r=I),X(o,L,g)&&(I=o,o=L,L=I);for(var W=g[2*x],i=g[2*x+1],y=g[2*o],S=g[2*o+1],O=2*h,s=2*r,U=2*L,f=2*e,q=2*F,c=2*K,v=0;v<2;++v){var Z=g[O+v],J=g[s+v],Y=g[U+v];g[f+v]=Z,g[q+v]=J,g[c+v]=Y}N(d,D,g),N(H,n,g);for(var z=u;z<=B;++z)if(t(z,W,i,g))z!==u&&V(z,u,g),++u;else if(!t(z,y,S,g))for(;;){if(t(B,y,S,g)){t(B,W,i,g)?(M(z,u,B,g),++u,--B):(V(z,B,g),--B);break}if(--B<z)break}b(D,u-1,W,i,g),b(n,B+1,y,S,g),u-2-D<=l?G(D,u-2,g):R(D,u-2,g),n-(B+2)<=l?G(B+2,n,g):R(B+2,n,g),B-u<=l?G(u,B,g):R(u,B,g)}},13677:(D,l,G)=>{"use strict";D.exports={init:function(D){var l=N.nextPow2(D);t.length<l&&(V.free(t),t=V.mallocInt32(l));R.length<l&&(V.free(R),R=V.mallocInt32(l));n.length<l&&(V.free(n),n=V.mallocInt32(l));g.length<l&&(V.free(g),g=V.mallocInt32(l));j.length<l&&(V.free(j),j=V.mallocInt32(l));e.length<l&&(V.free(e),e=V.mallocInt32(l));var G=8*l;K.length<G&&(V.free(K),K=V.mallocDouble(G))},sweepBipartite:function(D,l,G,V,N,X,j,e,H,h){for(var x=0,r=2*D,o=D-1,L=r-1,u=G;u<V;++u){var B=X[u],I=r*u;K[x++]=N[I+o],K[x++]=-(B+1),K[x++]=N[I+L],K[x++]=B}for(u=j;u<e;++u){B=h[u]+b;var W=r*u;K[x++]=H[W+o],K[x++]=-B,K[x++]=H[W+L],K[x++]=B}var i=x>>>1;M(K,i);var y=0,S=0;for(u=0;u<i;++u){var O=0|K[2*u+1];if(O>=b)F(n,g,S--,O=O-b|0);else if(O>=0)F(t,R,y--,O);else if(O<=-b){O=-O-b|0;for(var s=0;s<y;++s){if(void 0!==(U=l(t[s],O)))return U}d(n,g,S++,O)}else{O=-O-1|0;for(s=0;s<S;++s){var U;if(void 0!==(U=l(O,n[s])))return U}d(t,R,y++,O)}}},sweepComplete:function(D,l,G,V,N,b,X,H,h,x){for(var r=0,o=2*D,L=D-1,u=o-1,B=G;B<V;++B){var I=b[B]+1<<1,W=o*B;K[r++]=N[W+L],K[r++]=-I,K[r++]=N[W+u],K[r++]=I}for(B=X;B<H;++B){I=x[B]+1<<1;var i=o*B;K[r++]=h[i+L],K[r++]=1|-I,K[r++]=h[i+u],K[r++]=1|I}var y=r>>>1;M(K,y);var S=0,O=0,s=0;for(B=0;B<y;++B){var U=0|K[2*B+1],f=1&U;if(B<y-1&&U>>1===K[2*B+3]>>1&&(f=2,B+=1),U<0){for(var q=-(U>>1)-1,c=0;c<s;++c){if(void 0!==(v=l(j[c],q)))return v}if(0!==f)for(c=0;c<S;++c){if(void 0!==(v=l(t[c],q)))return v}if(1!==f)for(c=0;c<O;++c){var v;if(void 0!==(v=l(n[c],q)))return v}0===f?d(t,R,S++,q):1===f?d(n,g,O++,q):2===f&&d(j,e,s++,q)}else{q=(U>>1)-1;0===f?F(t,R,S--,q):1===f?F(n,g,O--,q):2===f&&F(j,e,s--,q)}}},scanBipartite:function(D,l,G,V,N,X,n,g,j,e,H,h){var x=0,r=2*D,o=l,L=l+D,u=1,B=1;V?B=b:u=b;for(var I=N;I<X;++I){var W=I+u,i=r*I;K[x++]=n[i+o],K[x++]=-W,K[x++]=n[i+L],K[x++]=W}for(I=j;I<e;++I){W=I+B;var y=r*I;K[x++]=H[y+o],K[x++]=-W}var S=x>>>1;M(K,S);var O=0;for(I=0;I<S;++I){var s=0|K[2*I+1];if(s<0){var U=!1;if((W=-s)>=b?(U=!V,W-=b):(U=!!V,W-=1),U)d(t,R,O++,W);else{var f=h[W],q=r*W,c=H[q+l+1],v=H[q+l+1+D];D:for(var Z=0;Z<O;++Z){var J=t[Z],Y=r*J;if(!(v<n[Y+l+1]||n[Y+l+1+D]<c)){for(var z=l+2;z<D;++z)if(H[q+z+D]<n[Y+z]||n[Y+z+D]<H[q+z])continue D;var E,P=g[J];if(void 0!==(E=V?G(f,P):G(P,f)))return E}}}}else F(t,R,O--,s-u)}},scanComplete:function(D,l,G,V,N,X,R,n,g,j,e){for(var F=0,d=2*D,H=l,h=l+D,x=V;x<N;++x){var r=x+b,o=d*x;K[F++]=X[o+H],K[F++]=-r,K[F++]=X[o+h],K[F++]=r}for(x=n;x<g;++x){r=x+1;var L=d*x;K[F++]=j[L+H],K[F++]=-r}var u=F>>>1;M(K,u);var B=0;for(x=0;x<u;++x){var I=0|K[2*x+1];if(I<0){if((r=-I)>=b)t[B++]=r-b;else{var W=e[r-=1],i=d*r,y=j[i+l+1],S=j[i+l+1+D];D:for(var O=0;O<B;++O){var s=t[O],U=R[s];if(U===W)break;var f=d*s;if(!(S<X[f+l+1]||X[f+l+1+D]<y)){for(var q=l+2;q<D;++q)if(j[i+q+D]<X[f+q]||X[f+q+D]<j[i+q])continue D;var c=G(U,W);if(void 0!==c)return c}}}}else{for(r=I-b,O=B-1;O>=0;--O)if(t[O]===r){for(q=O+1;q<B;++q)t[q-1]=t[q];break}--B}}}};var V=G(13664),N=G(13666),M=G(13682),b=1<<28,X=1024,t=V.mallocInt32(X),R=V.mallocInt32(X),n=V.mallocInt32(X),g=V.mallocInt32(X),j=V.mallocInt32(X),e=V.mallocInt32(X),K=V.mallocDouble(8192);function F(D,l,G,V){var N=l[V],M=D[G-1];D[N]=M,l[M]=N}function d(D,l,G,V){D[G]=V,l[V]=G}},13668:D=>{"use strict";function l(D,G,V){var N=0|D[V];if(N<=0)return[];var M,b=new Array(N);if(V===D.length-1)for(M=0;M<N;++M)b[M]=G;else for(M=0;M<N;++M)b[M]=l(D,G,V+1);return b}D.exports=function(D,G){switch("undefined"===typeof G&&(G=0),typeof D){case"number":if(D>0)return function(D,l){var G,V;for(G=new Array(D),V=0;V<D;++V)G[V]=l;return G}(0|D,G);break;case"object":if("number"===typeof D.length)return l(D,G,0)}return[]}},13635:(D,l,G)=>{D.exports=function(){var D=this;this.components={},this.comps=this.components;var l=this.components,G=1,N={},M=[],b=[],X={timeout:!1,removals:[],multiComps:[]};function t(D,G){var V=l[G],M=N[G],b=M.hash[D];b&&(M.remove(D),V.IV&&(V.multi?(b.forEach((l=>{l&&V.IV(D,l)})),b.length=0):V.IV(D,b)),X.removals.push(M),R())}function R(){X.timeout||(X.timeout=!0,setTimeout(n,1))}function n(){X.timeout=!1,g()}function g(){X.multiComps.length&&function(D){for(var l=0;l<D.length;l++){var{entID:G,data:V}=D[l],N=V.hash[G];if(N){for(var M=0;M<N.length;M++)N[M]||(N.splice(M,1),M--);0===N.length&&(V.remove(G),X.removals.push(V))}}D.length=0}(X.multiComps),X.removals.length&&function(D){for(var l=0;l<D.length;l++){D[l].flush()}D.length=0}(X.removals)}this.cg=N,this._systems=M,this._renderSystems=b,this.nn=function(l){var V=G++;return Array.isArray(l)&&l.forEach((l=>D.kt(V,l))),V},this.deleteEntity=function(l){return Object.keys(N).forEach((D=>{N[D].hash[l]&&t(l,D)})),D},this.Wn=function(D){if(!D)throw new Error("Missing component definition");var G=D.name;if(!G)throw new Error("Component definition must have a name property.");if("string"!==typeof G)throw new Error("Component name must be a string.");if(""===G)throw new Error("Component name must be a non-empty string.");if(N[G])throw new Error(`Component ${G} already exists.`);var X={};return X.name=G,X.multi=!!D.multi,X.order=isNaN(D.order)?99:D.order,X.stateConstructor=D.stateConstructor||null,X.state=D.state||{},X.EX=D.EX||null,X.IV=D.IV||null,X.system=D.system||null,X.CX=D.CX||null,l[G]=X,N[G]=new V,N[G]._pendingMultiCleanup=!1,N[G]._multiCleanupIDs=X.multi?[]:null,X.system&&(M.push(G),M.sort(((D,G)=>l[D].order-l[G].order))),X.CX&&(b.push(G),b.sort(((D,G)=>l[D].order-l[G].order))),G},this.overwriteComponent=function(D,G){var V=l[D];if(!V)throw new Error(`Unknown component: ${D}`);if(!G)throw new Error("Missing component definition");if(V.name!==G.name)throw new Error("Overwriting component must use the same name property.");var X={};X.name=D,X.multi=!!G.multi,X.order=isNaN(G.order)?99:G.order,X.state=G.state||{},X.EX=G.EX||null,X.IV=G.IV||null,X.system=G.system||null,X.CX=G.CX||null,l[D]=X,N[D]._pendingMultiCleanup=!1,N[D]._multiCleanupIDs=X.multi?[]:null;var t=M.indexOf(D);X.system&&t<0&&M.push(D),!X.system&&t>=0&&M.splice(t,1),M.sort(((D,G)=>l[D].order-l[G].order));var R=b.indexOf(D);X.CX&&R<0&&b.push(D),!X.CX&&R>=0&&b.splice(R,1),b.sort(((D,G)=>l[D].order-l[G].order));var n=X.state;return this.kR(D).forEach((D=>{for(var l in n)l in D||(D[l]=n[l]);X.EX&&X.EX(D.mX,D)})),D},this.deleteComponent=function(G){var V=N[G];if(!V)throw new Error(`Unknown component: ${G}`);V.flush(),V.list.forEach((D=>{D&&t(D.mX||D[0].mX,G)}));var X=M.indexOf(G),R=b.indexOf(G);return X>-1&&M.splice(X,1),R>-1&&b.splice(R,1),N[G].dispose(),delete N[G],delete l[G],D},this.kt=function(D,G,V){var M,b=l[G],X=N[G];if(!X)throw new Error(`Unknown component: ${G}.`);if(X.hash[D]&&!b.multi)throw new Error(`Entity ${D} already has component: ${G}.`);if(b.stateConstructor){if(!(M=new b.stateConstructor).hasOwnProperty("mX"))throw new Error(`Component ${b.name} stateConstructor type does not have property __id`)}else M=Object.assign({},{mX:D},b.state,V);if(M.mX=D,b.multi){var t=X.hash[D];t||(t=[],X.add(D,t)),t.push(M)}else X.add(D,M);return b.EX&&b.EX(D,M),this},this.NR=function(D,l){var G=N[l];if(!G)throw new Error(`Unknown component: ${l}.`);return!!G.hash[D]},this.At=function(l,G){if(!N[G])throw new Error(`Unknown component: ${G}.`);return t(l,G),D},this.getState=function(D,l){var G=N[l];if(!G)throw new Error(`Unknown component: ${l}.`);return G.hash[D]},this.kR=function(D){var l=N[D];if(!l)throw new Error(`Unknown component: ${D}.`);return g(),l.list},this.ce=function(D){if(!N[D])throw new Error(`Unknown component: ${D}.`);var l=N[D].hash;return D=>l[D]},this.ze=function(D){if(!N[D])throw new Error(`Unknown component: ${D}.`);var l=N[D].hash;return D=>!!l[D]},this.JX=function(G){g();for(var V=0;V<M.length;V++){var b=M[V],X=l[b],t=N[b];X.system(G,t.list),g()}return D},this.render=function(G){g();for(var V=0;V<b.length;V++){var M=b[V],X=l[M],t=N[M];X.CX(G,t.list),g()}return D},this.removeMultiComponent=function(G,V,M){var b=l[V],t=N[V];if(!t)throw new Error(`Unknown component: ${V}.`);if(!b.multi)throw new Error("removeMultiComponent called on non-multi component");return function(D,l,G,V){var N=G.hash[D];if(N){var M=N[V];M&&(N[V]=null,l.IV&&l.IV(D,M),X.multiComps.push({entID:D,data:G}),R())}}(G,b,t,M),D}};var V=G(13637)},13637:D=>{function l(D,l){var G=D._map[l];if(delete D.hash[l],delete D._map[l],G===D.list.length-1)D.list.pop();else{var V=D.list.pop();if(D.list[G]=V,null===V||null===V[0]){var N=D.list.length;for(var M in D._map)if(D._map[M]===N)return void(D._map[M]=G)}else{var b=V.mX||V[0].mX;D._map[b]=G}}}D.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(D,l){if("number"===typeof this._map[D]){var G=this._map[D];this.hash[D]=l,this.list[G]=l}else this._map[D]=this.list.length,this.hash[D]=l,this.list.push(l)}remove(D){var l=this._map[D];this.hash[D]=null,this.list[l]=null,this._pendingRemovals.push(D)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var D=0;D<this._pendingRemovals.length;D++){var G=this._pendingRemovals[D];null===this.hash[G]&&l(this,G)}this._pendingRemovals.length=0}}},13597:D=>{"use strict";var l,G="object"===typeof Reflect?Reflect:null,V=function(D,l,G){return Function.prototype.apply.call(D,l,G)};l=G&&"function"===typeof G.ownKeys?G.ownKeys:Object.getOwnPropertySymbols?function(D){return Object.getOwnPropertyNames(D).concat(Object.getOwnPropertySymbols(D))}:function(D){return Object.getOwnPropertyNames(D)};var N=Number.isNaN||function(D){return D!==D};function M(){M.init.call(this)}D.exports=M,D.exports.once=function(D,l){return new Promise((function(G,V){function N(G){D.removeListener(l,M),V(G)}function M(){"function"===typeof D.removeListener&&D.removeListener("error",N),G([].slice.call(arguments))}F(D,l,M,{once:!0}),"error"!==l&&function(D,l,G){"function"===typeof D.on&&F(D,"error",l,G)}(D,N,{once:!0})}))},M.EventEmitter=M,M.prototype._events=void 0,M.prototype._eventsCount=0,M.prototype._maxListeners=void 0;var b=10;function X(D){if("function"!==typeof D)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof D)}function t(D){return void 0===D._maxListeners?M.defaultMaxListeners:D._maxListeners}function R(D,l,G,V){var N,M,b,R;if(X(G),void 0===(M=D._events)?(M=D._events=Object.create(null),D._eventsCount=0):(void 0!==M.newListener&&(D.emit("newListener",l,G.listener?G.listener:G),M=D._events),b=M[l]),void 0===b)b=M[l]=G,++D._eventsCount;else if("function"===typeof b?b=M[l]=V?[G,b]:[b,G]:V?b.unshift(G):b.push(G),(N=t(D))>0&&b.length>N&&!b.warned){b.warned=!0;var n=new Error("Possible EventEmitter memory leak detected. "+b.length+" "+String(l)+" listeners added. Use emitter.setMaxListeners() to increase limit");n.name="MaxListenersExceededWarning",n.Vl=D,n.type=l,n.count=b.length,R=n,console&&console.warn&&console.warn(R)}return D}function n(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(D,l,G){var V={fired:!1,wrapFn:void 0,target:D,type:l,listener:G},N=n.bind(V);return N.listener=G,V.wrapFn=N,N}function j(D,l,G){var V=D._events;if(void 0===V)return[];var N=V[l];return void 0===N?[]:"function"===typeof N?G?[N.listener||N]:[N]:G?function(D){for(var l=new Array(D.length),G=0;G<l.length;++G)l[G]=D[G].listener||D[G];return l}(N):K(N,N.length)}function e(D){var l=this._events;if(void 0!==l){var G=l[D];if("function"===typeof G)return 1;if(void 0!==G)return G.length}return 0}function K(D,l){for(var G=new Array(l),V=0;V<l;++V)G[V]=D[V];return G}function F(D,l,G,V){if("function"===typeof D.on)V.once?D.once(l,G):D.on(l,G);else{if("function"!==typeof D.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof D);D.addEventListener(l,(function N(M){V.once&&D.removeEventListener(l,N),G(M)}))}}Object.defineProperty(M,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(D){if("number"!==typeof D||D<0||N(D))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+D+".");b=D}}),M.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},M.prototype.setMaxListeners=function(D){if("number"!==typeof D||D<0||N(D))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+D+".");return this._maxListeners=D,this},M.prototype.getMaxListeners=function(){return t(this)},M.prototype.emit=function(D){for(var l=[],G=1;G<arguments.length;G++)l.push(arguments[G]);var N="error"===D,M=this._events;if(void 0!==M)N=N&&void 0===M.error;else if(!N)return!1;if(N){var b;if(l.length>0&&(b=l[0]),b instanceof Error)throw b;var X=new Error("Unhandled error."+(b?" ("+b.message+")":""));throw X.context=b,X}var t=M[D];if(void 0===t)return!1;if("function"===typeof t)V(t,this,l);else{var R=t.length,n=K(t,R);for(G=0;G<R;++G)V(n[G],this,l)}return!0},M.prototype.addListener=function(D,l){return R(this,D,l,!1)},M.prototype.on=M.prototype.addListener,M.prototype.prependListener=function(D,l){return R(this,D,l,!0)},M.prototype.once=function(D,l){return X(l),this.on(D,g(this,D,l)),this},M.prototype.prependOnceListener=function(D,l){return X(l),this.prependListener(D,g(this,D,l)),this},M.prototype.removeListener=function(D,l){var G,V,N,M,b;if(X(l),void 0===(V=this._events))return this;if(void 0===(G=V[D]))return this;if(G===l||G.listener===l)0===--this._eventsCount?this._events=Object.create(null):(delete V[D],V.removeListener&&this.emit("removeListener",D,G.listener||l));else if("function"!==typeof G){for(N=-1,M=G.length-1;M>=0;M--)if(G[M]===l||G[M].listener===l){b=G[M].listener,N=M;break}if(N<0)return this;0===N?G.shift():function(D,l){for(;l+1<D.length;l++)D[l]=D[l+1];D.pop()}(G,N),1===G.length&&(V[D]=G[0]),void 0!==V.removeListener&&this.emit("removeListener",D,b||l)}return this},M.prototype.off=M.prototype.removeListener,M.prototype.Nl=function(D){var l,G,V;if(void 0===(G=this._events))return this;if(void 0===G.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==G[D]&&(0===--this._eventsCount?this._events=Object.create(null):delete G[D]),this;if(0===arguments.length){var N,M=Object.keys(G);for(V=0;V<M.length;++V)"removeListener"!==(N=M[V])&&this.Nl(N);return this.Nl("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(l=G[D]))this.removeListener(D,l);else if(void 0!==l)for(V=l.length-1;V>=0;V--)this.removeListener(D,l[V]);return this},M.prototype.listeners=function(D){return j(this,D,!0)},M.prototype.rawListeners=function(D){return j(this,D,!1)},M.listenerCount=function(D,l){return"function"===typeof D.listenerCount?D.listenerCount(l):e.call(D,l)},M.prototype.listenerCount=e,M.prototype.eventNames=function(){return this._eventsCount>0?l(this._events):[]}},13891:D=>{"use strict";D.exports=function(D,l,G,V,N,M){var b=+l[0],X=+l[1],t=+l[2],R=+G[0],n=+G[1],g=+G[2],j=Math.sqrt(R*R+n*n+g*g);if(0===j)throw new Error("Can't raycast along a zero vector");return function(D,l,G,V,N,M,b,X,t,R){for(var n=0,g=Math.floor,j=0|g(l),e=0|g(G),K=0|g(V),F=N>0?1:-1,d=M>0?1:-1,H=b>0?1:-1,h=Math.abs(1/N),x=Math.abs(1/M),r=Math.abs(1/b),o=h<1/0?h*(F>0?j+1-l:l-j):1/0,L=x<1/0?x*(d>0?e+1-G:G-e):1/0,u=r<1/0?r*(H>0?K+1-V:V-K):1/0,B=-1;n<=X;){var I=D(j,e,K);if(I)return t&&(t[0]=l+n*N,t[1]=G+n*M,t[2]=V+n*b),R&&(R[0]=R[1]=R[2]=0,0===B&&(R[0]=-F),1===B&&(R[1]=-d),2===B&&(R[2]=-H)),I;o<L?o<u?(j+=F,n=o,o+=h,B=0):(K+=H,n=u,u+=r,B=2):L<u?(e+=d,n=L,L+=x,B=1):(K+=H,n=u,u+=r,B=2)}return t&&(t[0]=l+n*N,t[1]=G+n*M,t[2]=V+n*b),R&&(R[0]=R[1]=R[2]=0),0}(D,b,X,t,R/=j,n/=j,g/=j,V="undefined"===typeof V?64:+V,N,M)}},13924:(D,l,G)=>{"use strict";G.d(l,{c:()=>M});var V=G(13597);function N(){this.Bj=!1,this.stopPropagation=!1,this.Ij=!1,this.disabled=!1}class M{constructor(D,l){this.version="0.7.0";var G=Object.assign({},new N,l||{});this.element=D||document,this.Bj=!!G.Bj,this.stopPropagation=!!G.stopPropagation,this.Ij=!!G.Ij,this.disabled=!!G.disabled,this.filterEvents=(D,l)=>!0,this.down=new V.EventEmitter,this.up=new V.EventEmitter,this.state={},this.JR={dx:0,dy:0,re:0,ZR:0,oe:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?X(this):document.addEventListener("DOMContentLoaded",(D=>{X(this)}),{once:!0})}bind(D){for(var l=arguments.length,G=new Array(l>1?l-1:0),V=1;V<l;V++)G[V-1]=arguments[V];G.forEach((l=>{var G=this._keyBindmap[l]||[];G.includes(D)||(G.push(D),this._keyBindmap[l]=G)})),this.state[D]=!!this.state[D],this.pressCount[D]=this.pressCount[D]||0,this.releaseCount[D]=this.releaseCount[D]||0}unbind(D){for(var l in this._keyBindmap){var G=this._keyBindmap[l],V=G.indexOf(D);V>-1&&G.splice(V,1)}}getBindings(){var D={};for(var l in this._keyBindmap){this._keyBindmap[l].forEach((G=>{D[G]=D[G]||[],D[G].push(l)}))}return D}JX(){b(this.JR),b(this.pressCount),b(this.releaseCount)}}function b(D){for(var l in D)D[l]=0}function X(D){window.addEventListener("keydown",K.bind(null,D,!0),!1),window.addEventListener("keyup",K.bind(null,D,!1),!1);var l={passive:!0};D.element.addEventListener("touchstart",g.bind(void 0,D),{passive:!1}),D.element.addEventListener("touchend",e.bind(void 0,D),l),D.element.addEventListener("mousedown",F.bind(null,D,!0),l),window.document.addEventListener("mouseup",F.bind(null,D,!1),l),D.element.addEventListener("touchmove",d.bind(null,D),l),D.element.addEventListener("mousemove",d.bind(null,D),l),window.PointerEvent,D.element.addEventListener("wheel",H.bind(null,D),l),D.element.addEventListener("contextmenu",h.bind(null,D),!1),window.addEventListener("blur",x.bind(null,D),!1)}var t=0,R=0,n=null;function g(D,l){l.preventDefault(),j(l)}function j(D){let l=!1;for(let G=0;G<D.touches.length;++G)if(D.touches[G].identifier===n){l=!0;break}if(!l){const l=D.changedTouches[0];t=l.clientX,R=l.clientY,n=l.identifier}}function e(D,l){for(var G=l.changedTouches,V=0;V<G.length;++V)G[V].identifier===n&&(n=null)}function K(D,l,G){r(G.code,l,D,G)}function F(D,l,G){if("pointerId"in G)if(l){if(null!==D._touches.currID)return;D._touches.currID=G.pointerId}else{if(D._touches.currID!==G.pointerId)return;D._touches.currID=null}return r("Mouse"+("button"in G?G.button+1:1),l,D,G),!1}function d(D,l){var G=l.movementX||l.mozMovementX||0,V=l.movementY||l.mozMovementY||0;if(l.touches&&0===(G|V)){var N=function(D){j(D);for(let l=0;l<D.changedTouches.length;++l)if(D.changedTouches[l].identifier==n){const G=D.changedTouches[l],V=[G.clientX-t,G.clientY-R];return t=G.clientX,R=G.clientY,V}return console.error(`Did not find touch id ${n}`),[0,0]}(l);G=N[0],V=N[1]}D.JR.dx+=G,D.JR.dy+=V}function H(D,l){var G=1;switch(l.deltaMode){case 0:G=1;break;case 1:G=12;break;case 2:G=D.element.clientHeight||window.innerHeight}D.JR.re+=(l.deltaX||0)*G,D.JR.ZR+=(l.deltaY||0)*G,D.JR.oe+=(l.deltaZ||0)*G}function h(D,l){if(!D.Ij)return l.preventDefault(),!1}function x(D){for(var l in D._keyStates)D._keyStates[l]&&(/^Mouse\d/.test(l)||r(l,!1,D,{code:l,note:"22s13hwj795",preventDefault:()=>{},stopPropagation:()=>{}}))}function r(D,l,G,V){var N=G._keyBindmap[D];N&&(o(G._keyStates[D],l)&&(G._keyStates[D]=l,N.forEach((D=>{(!G.filterEvents||G.filterEvents(V,D))&&function(D,l,G,V){var N=l?G.pressCount:G.releaseCount;N[D]=(N[D]||0)+1;var M=G._bindPressCount[D]||0;(M+=l?1:-1)<0&&(M=0);G._bindPressCount[D]=M;var b=G.state[D];if(o(b,M)){G.state[D]=M>0;var X=l?G.down:G.up;G.disabled||X.emit(D,V)}}(D,l,G,V)}))),"button"in V||(G.Bj&&!V.defaultPrevented&&V.preventDefault(),G.stopPropagation&&V.stopPropagation()))}function o(D,l){return D?!l:l}},12620:D=>{D.exports=function(D,l,G){return D[0]=l[0]+G[0],D[1]=l[1]+G[1],D[2]=l[2]+G[2],D}},12577:(D,l,G)=>{D.exports=function(D,l){var G=V(D[0],D[1],D[2]),b=V(l[0],l[1],l[2]);N(G,G),N(b,b);var X=M(G,b);return X>1?0:Math.acos(X)};var V=G(12583),N=G(12586),M=G(12589)},12671:D=>{D.exports=function(D,l){return D[0]=Math.ceil(l[0]),D[1]=Math.ceil(l[1]),D[2]=Math.ceil(l[2]),D}},12575:D=>{D.exports=function(D){var l=new Float32Array(3);return l[0]=D[0],l[1]=D[1],l[2]=D[2],l}},12593:D=>{D.exports=function(D,l){return D[0]=l[0],D[1]=l[1],D[2]=l[2],D}},12572:D=>{D.exports=function(){var D=new Float32Array(3);return D[0]=0,D[1]=0,D[2]=0,D}},12745:D=>{D.exports=function(D,l,G){var V=l[0],N=l[1],M=l[2],b=G[0],X=G[1],t=G[2];return D[0]=N*t-M*X,D[1]=M*b-V*t,D[2]=V*X-N*b,D}},12694:(D,l,G)=>{D.exports=G(12690)},12690:D=>{D.exports=function(D,l){var G=l[0]-D[0],V=l[1]-D[1],N=l[2]-D[2];return Math.sqrt(G*G+V*V+N*N)}},12648:(D,l,G)=>{D.exports=G(12640)},12640:D=>{D.exports=function(D,l,G){return D[0]=l[0]/G[0],D[1]=l[1]/G[1],D[2]=l[2]/G[2],D}},12589:D=>{D.exports=function(D,l){return D[0]*l[0]+D[1]*l[1]+D[2]*l[2]}},12569:D=>{D.exports=1e-6},12609:(D,l,G)=>{D.exports=function(D,l){var G=D[0],N=D[1],M=D[2],b=l[0],X=l[1],t=l[2];return Math.abs(G-b)<=V*Math.max(1,Math.abs(G),Math.abs(b))&&Math.abs(N-X)<=V*Math.max(1,Math.abs(N),Math.abs(X))&&Math.abs(M-t)<=V*Math.max(1,Math.abs(M),Math.abs(t))};var V=G(12569)},12613:D=>{D.exports=function(D,l){return D[0]===l[0]&&D[1]===l[1]&&D[2]===l[2]}},12663:D=>{D.exports=function(D,l){return D[0]=Math.floor(l[0]),D[1]=Math.floor(l[1]),D[2]=Math.floor(l[2]),D}},12782:(D,l,G)=>{D.exports=function(D,l,G,N,M,b){var X,t;l||(l=3);G||(G=0);t=N?Math.min(N*l+G,D.length):D.length;for(X=G;X<t;X+=l)V[0]=D[X],V[1]=D[X+1],V[2]=D[X+2],M(V,V,b),D[X]=V[0],D[X+1]=V[1],D[X+2]=V[2];return D};var V=G(12572)()},12583:D=>{D.exports=function(D,l,G){var V=new Float32Array(3);return V[0]=D,V[1]=l,V[2]=G,V}},12566:(D,l,G)=>{D.exports={EPSILON:G(12569),create:G(12572),clone:G(12575),angle:G(12577),SX:G(12583),k:G(12593),set:G(12601),equals:G(12609),exactEquals:G(12613),add:G(12620),Fl:G(12623),sub:G(12626),multiply:G(12630),mul:G(12633),divide:G(12640),div:G(12648),min:G(12654),max:G(12656),floor:G(12663),ceil:G(12671),round:G(12676),scale:G(12683),OX:G(12688),distance:G(12690),j:G(12694),squaredDistance:G(12703),sqrDist:G(12712),length:G(12715),len:G(12720),squaredLength:G(12722),sX:G(12725),negate:G(12730),inverse:G(12738),normalize:G(12586),dot:G(12589),cross:G(12745),WX:G(12751),random:G(12757),transformMat4:G(12760),transformMat3:G(12765),transformQuat:G(12770),UX:G(12772),fX:G(12774),qX:G(12778),forEach:G(12782)}},12738:D=>{D.exports=function(D,l){return D[0]=1/l[0],D[1]=1/l[1],D[2]=1/l[2],D}},12720:(D,l,G)=>{D.exports=G(12715)},12715:D=>{D.exports=function(D){var l=D[0],G=D[1],V=D[2];return Math.sqrt(l*l+G*G+V*V)}},12751:D=>{D.exports=function(D,l,G,V){var N=l[0],M=l[1],b=l[2];return D[0]=N+V*(G[0]-N),D[1]=M+V*(G[1]-M),D[2]=b+V*(G[2]-b),D}},12656:D=>{D.exports=function(D,l,G){return D[0]=Math.max(l[0],G[0]),D[1]=Math.max(l[1],G[1]),D[2]=Math.max(l[2],G[2]),D}},12654:D=>{D.exports=function(D,l,G){return D[0]=Math.min(l[0],G[0]),D[1]=Math.min(l[1],G[1]),D[2]=Math.min(l[2],G[2]),D}},12633:(D,l,G)=>{D.exports=G(12630)},12630:D=>{D.exports=function(D,l,G){return D[0]=l[0]*G[0],D[1]=l[1]*G[1],D[2]=l[2]*G[2],D}},12730:D=>{D.exports=function(D,l){return D[0]=-l[0],D[1]=-l[1],D[2]=-l[2],D}},12586:D=>{D.exports=function(D,l){var G=l[0],V=l[1],N=l[2],M=G*G+V*V+N*N;M>0&&(M=1/Math.sqrt(M),D[0]=l[0]*M,D[1]=l[1]*M,D[2]=l[2]*M);return D}},12757:D=>{D.exports=function(D,l){l=l||1;var G=2*Math.random()*Math.PI,V=2*Math.random()-1,N=Math.sqrt(1-V*V)*l;return D[0]=Math.cos(G)*N,D[1]=Math.sin(G)*N,D[2]=V*l,D}},12772:D=>{D.exports=function(D,l,G,V){var N=G[1],M=G[2],b=l[1]-N,X=l[2]-M,t=Math.sin(V),R=Math.cos(V);return D[0]=l[0],D[1]=N+b*R-X*t,D[2]=M+b*t+X*R,D}},12774:D=>{D.exports=function(D,l,G,V){var N=G[0],M=G[2],b=l[0]-N,X=l[2]-M,t=Math.sin(V),R=Math.cos(V);return D[0]=N+X*t+b*R,D[1]=l[1],D[2]=M+X*R-b*t,D}},12778:D=>{D.exports=function(D,l,G,V){var N=G[0],M=G[1],b=l[0]-N,X=l[1]-M,t=Math.sin(V),R=Math.cos(V);return D[0]=N+b*R-X*t,D[1]=M+b*t+X*R,D[2]=l[2],D}},12676:D=>{D.exports=function(D,l){return D[0]=Math.round(l[0]),D[1]=Math.round(l[1]),D[2]=Math.round(l[2]),D}},12683:D=>{D.exports=function(D,l,G){return D[0]=l[0]*G,D[1]=l[1]*G,D[2]=l[2]*G,D}},12688:D=>{D.exports=function(D,l,G,V){return D[0]=l[0]+G[0]*V,D[1]=l[1]+G[1]*V,D[2]=l[2]+G[2]*V,D}},12601:D=>{D.exports=function(D,l,G,V){return D[0]=l,D[1]=G,D[2]=V,D}},12712:(D,l,G)=>{D.exports=G(12703)},12725:(D,l,G)=>{D.exports=G(12722)},12703:D=>{D.exports=function(D,l){var G=l[0]-D[0],V=l[1]-D[1],N=l[2]-D[2];return G*G+V*V+N*N}},12722:D=>{D.exports=function(D){var l=D[0],G=D[1],V=D[2];return l*l+G*G+V*V}},12626:(D,l,G)=>{D.exports=G(12623)},12623:D=>{D.exports=function(D,l,G){return D[0]=l[0]-G[0],D[1]=l[1]-G[1],D[2]=l[2]-G[2],D}},12765:D=>{D.exports=function(D,l,G){var V=l[0],N=l[1],M=l[2];return D[0]=V*G[0]+N*G[3]+M*G[6],D[1]=V*G[1]+N*G[4]+M*G[7],D[2]=V*G[2]+N*G[5]+M*G[8],D}},12760:D=>{D.exports=function(D,l,G){var V=l[0],N=l[1],M=l[2],b=G[3]*V+G[7]*N+G[11]*M+G[15];return b=b||1,D[0]=(G[0]*V+G[4]*N+G[8]*M+G[12])/b,D[1]=(G[1]*V+G[5]*N+G[9]*M+G[13])/b,D[2]=(G[2]*V+G[6]*N+G[10]*M+G[14])/b,D}},12770:D=>{D.exports=function(D,l,G){var V=l[0],N=l[1],M=l[2],b=G[0],X=G[1],t=G[2],R=G[3],n=R*V+X*M-t*N,g=R*N+t*V-b*M,j=R*M+b*N-X*V,e=-b*V-X*N-t*M;return D[0]=n*R+e*-b+g*-t-j*-X,D[1]=g*R+e*-X+j*-b-n*-t,D[2]=j*R+e*-t+n*-X-g*-b,D}},13620:D=>{"use strict";D.exports=function(D){for(var l=new Array(D),G=0;G<D;++G)l[G]=G;return l}},13672:D=>{D.exports=function(D){return null!=D&&null!=D.constructor&&"function"===typeof D.constructor.isBuffer&&D.constructor.isBuffer(D)}},13894:(D,l,G)=>{"use strict";G.d(l,{e:()=>V});class V{constructor(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Cn=!1,this.wn=!1,this.mn=30,this.Tn=0,this.Ng=!1,this.fullscreen=!1,this.an=function(D){},this.Qn=function(){},this.Gg=function(){},this.DM=function(){},this.Dg=function(D){},this.onFullscreenChanged=function(D){},R((()=>{!function(D,l){D._nowObject=performance||Date,D._lastTick=0,D._renderAccum=0,D._rt=0,D._frameCB=X.bind(null,D),requestAnimationFrame(D._frameCB),l>0&&(D._intervalCB=b.bind(null,D),D._interval=setInterval(D._intervalCB,Math.max(l,1e3/D.mn/2)))}(this,l),function(D,l){if(!l)return;var G=!1,V=!1;document.addEventListener("pointerlockchange",(V=>{G=document.pointerLockElement===l,D.Dg(G)})),document.addEventListener("fullscreenchange",(G=>{V=document.fullscreenElement===l,D.onFullscreenChanged(V)})),Object.defineProperty(D,"Ng",{get:()=>G,set:D=>{D&&!G?t(l):G&&!D&&function(D){D.exitPointerLock&&D.exitPointerLock()}(document)}}),Object.defineProperty(D,"fullscreen",{get:()=>V,set:D=>{D&&!V?l.requestFullscreen():V&&!D&&document.exitFullscreen()}}),l.addEventListener("click",(N=>{D.Cn&&!G&&t(l),D.wn&&!V&&l.requestFullscreen()}));var N=()=>D.DM();if(window.ResizeObserver){new ResizeObserver(N).observe(l)}else window.addEventListener("resize",N)}(this,D),this.Gg()}))}}var N=3,M=20;function b(D){for(var l=1e3/D.mn,G=D._nowObject.now()+M,V=0;D._nowObject.now()>=D._lastTick+l&&D._nowObject.now()<G&&++V<=N;)D.an(l),D._lastTick+=l;var b=5*(l+5),X=D._nowObject.now();if(X-D._lastTick>b)for(;X>=D._lastTick+l;)D._lastTick+=l}function X(D){requestAnimationFrame(D._frameCB),b(D);var l=D._nowObject.now(),G=l-D._rt;if(D._rt=l,D.Tn>0){D._renderAccum+=G;var V=1e3/D.Tn;if(D._renderAccum<V)return;D._renderAccum=Math.min(D._renderAccum-V,V)}var N=1e3/D.mn,M=(l-D._lastTick)/N;D.Qn(G,M,N)}function t(D){D.requestPointerLock&&D.requestPointerLock()}var R=D=>{if("loading"===document.readyState){var l=()=>{document.removeEventListener("readystatechange",l),D()};document.addEventListener("readystatechange",l)}else setTimeout(D,1)}},13615:(D,l,G)=>{var V=G(13620),N=G(13625),M="undefined"!==typeof Float64Array;function b(D,l){return D[0]-l[0]}function X(){var D,l=this.stride,G=new Array(l.length);for(D=0;D<G.length;++D)G[D]=[Math.abs(l[D]),D];G.sort(b);var V=new Array(G.length);for(D=0;D<V.length;++D)V[D]=G[D][1];return V}function t(D,l){var G=["View",l,"d",D].join("");l<0&&(G="View_Nil"+D);var N="generic"===D;if(-1===l){var M="function "+G+"(a){this.data=a;};var proto="+G+".prototype;proto.dtype='"+D+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+G+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+G+"(a){return new "+G+"(a);}";return new Function(M)()}if(0===l){M="function "+G+"(a,d) {this.data = a;this.offset = d};var proto="+G+".prototype;proto.dtype='"+D+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+G+"_copy() {return new "+G+"(this.data,this.offset)};proto.pick=function "+G+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+G+"_get(){return "+(N?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+G+"_set(v){return "+(N?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+G+"(a,b,c,d){return new "+G+"(a,d)}";return new Function("TrivialArray",M)(R[D][0])}M=["'use strict'"];var b=V(l),t=b.map((function(D){return"i"+D})),n="this.offset+"+b.map((function(D){return"this.stride["+D+"]*i"+D})).join("+"),g=b.map((function(D){return"b"+D})).join(","),j=b.map((function(D){return"c"+D})).join(",");M.push("function "+G+"(a,"+g+","+j+",d){this.data=a","this.shape=["+g+"]","this.stride=["+j+"]","this.offset=d|0}","var proto="+G+".prototype","proto.dtype='"+D+"'","proto.dimension="+l),M.push("Object.defineProperty(proto,'size',{get:function "+G+"_size(){return "+b.map((function(D){return"this.shape["+D+"]"})).join("*"),"}})"),1===l?M.push("proto.order=[0]"):(M.push("Object.defineProperty(proto,'order',{get:"),l<4?(M.push("function "+G+"_order(){"),2===l?M.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===l&&M.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):M.push("ORDER})")),M.push("proto.set=function "+G+"_set("+t.join(",")+",v){"),N?M.push("return this.data.set("+n+",v)}"):M.push("return this.data["+n+"]=v}"),M.push("proto.get=function "+G+"_get("+t.join(",")+"){"),N?M.push("return this.data.get("+n+")}"):M.push("return this.data["+n+"]}"),M.push("proto.index=function "+G+"_index(",t.join(),"){return "+n+"}"),M.push("proto.hi=function "+G+"_hi("+t.join(",")+"){return new "+G+"(this.data,"+b.map((function(D){return["(typeof i",D,"!=='number'||i",D,"<0)?this.shape[",D,"]:i",D,"|0"].join("")})).join(",")+","+b.map((function(D){return"this.stride["+D+"]"})).join(",")+",this.offset)}");var e=b.map((function(D){return"a"+D+"=this.shape["+D+"]"})),K=b.map((function(D){return"c"+D+"=this.stride["+D+"]"}));M.push("proto.lo=function "+G+"_lo("+t.join(",")+"){var b=this.offset,d=0,"+e.join(",")+","+K.join(","));for(var F=0;F<l;++F)M.push("if(typeof i"+F+"==='number'&&i"+F+">=0){d=i"+F+"|0;b+=c"+F+"*d;a"+F+"-=d}");M.push("return new "+G+"(this.data,"+b.map((function(D){return"a"+D})).join(",")+","+b.map((function(D){return"c"+D})).join(",")+",b)}"),M.push("proto.step=function "+G+"_step("+t.join(",")+"){var "+b.map((function(D){return"a"+D+"=this.shape["+D+"]"})).join(",")+","+b.map((function(D){return"b"+D+"=this.stride["+D+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(F=0;F<l;++F)M.push("if(typeof i"+F+"==='number'){d=i"+F+"|0;if(d<0){c+=b"+F+"*(a"+F+"-1);a"+F+"=ceil(-a"+F+"/d)}else{a"+F+"=ceil(a"+F+"/d)}b"+F+"*=d}");M.push("return new "+G+"(this.data,"+b.map((function(D){return"a"+D})).join(",")+","+b.map((function(D){return"b"+D})).join(",")+",c)}");var d=new Array(l),H=new Array(l);for(F=0;F<l;++F)d[F]="a[i"+F+"]",H[F]="b[i"+F+"]";M.push("proto.transpose=function "+G+"_transpose("+t+"){"+t.map((function(D,l){return D+"=("+D+"===undefined?"+l+":"+D+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+G+"(this.data,"+d.join(",")+","+H.join(",")+",this.offset)}"),M.push("proto.pick=function "+G+"_pick("+t+"){var a=[],b=[],c=this.offset");for(F=0;F<l;++F)M.push("if(typeof i"+F+"==='number'&&i"+F+">=0){c=(c+this.stride["+F+"]*i"+F+")|0}else{a.push(this.shape["+F+"]);b.push(this.stride["+F+"])}");return M.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),M.push("return function construct_"+G+"(data,shape,stride,offset){return new "+G+"(data,"+b.map((function(D){return"shape["+D+"]"})).join(",")+","+b.map((function(D){return"stride["+D+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",M.join("\n"))(R[D],X)}var R={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};D.exports=function(D,l,G,V){if(void 0===D)return(0,R.array[0])([]);"number"===typeof D&&(D=[D]),void 0===l&&(l=[D.length]);var b=l.length;if(void 0===G){G=new Array(b);for(var X=b-1,n=1;X>=0;--X)G[X]=n,n*=l[X]}if(void 0===V){V=0;for(X=0;X<b;++X)G[X]<0&&(V-=(l[X]-1)*G[X])}for(var g=function(D){if(N(D))return"buffer";if(M)switch(Object.prototype.toString.call(D)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(D)?"array":"generic"}(D),j=R[g];j.length<=b+1;)j.push(t(g,j.length-1));return(0,j[b+1])(D,l,G,V)}},13625:D=>{function l(D){return!!D.constructor&&"function"===typeof D.constructor.isBuffer&&D.constructor.isBuffer(D)}D.exports=function(D){return null!=D&&(l(D)||function(D){return"function"===typeof D.readFloatLE&&"function"===typeof D.slice&&l(D.slice(0,0))}(D)||!!D._isBuffer)}},13754:D=>{"use strict";var l=[],G=[],V=[],N=[],M=[],b=[],X=[],t=[],R=[],n=[],g=[],j=[];D.exports=function(D,e,K,F,d,H){for(var h=X,x=R,r=n,o=j,L=0;L<3;L++)h[L]=+K[L],r[L]=+e.max[L],x[L]=+e.base[L];H||(H=1e-10);var u=function(D,X,R,n,j,e){var K=l,F=G,d=V,H=N,h=M,x=b,r=t,o=Math.floor,L=0,u=0,B=0,I=0,W=0;if(i(),0===B)return 0;for(I=O();u<=B;){if(y(I)&&S())return L;I=O()}for(L+=B,W=0;W<3;W++)n[W]+=R[W],j[W]+=R[W];return L;function i(){if(u=0,0!==(B=Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2])))for(var D=0;D<3;D++){var l=R[D]>=0;H[D]=l?1:-1;var G=l?j[D]:n[D];K[D]=l?n[D]:j[D],F[D]=s(G,H[D]),d[D]=U(K[D],H[D]),r[D]=R[D]/B,h[D]=Math.abs(1/r[D]);var V=l?F[D]+1-G:G-F[D];x[D]=h[D]<1/0?h[D]*V:1/0}}function y(l){for(var G=H[0],V=0===l?F[0]:d[0],N=F[0]+G,M=H[1],b=1===l?F[1]:d[1],X=F[1]+M,t=H[2],R=2===l?F[2]:d[2],n=F[2]+t,g=V;g!=N;g+=G)for(var j=b;j!=X;j+=M)for(var e=R;e!=n;e+=t)if(D(g,j,e))return!0;return!1}function S(){L+=u;var D=H[I],l=u/B,G=g;for(W=0;W<3;W++){var V=R[W]*l;n[W]+=V,j[W]+=V,G[W]=R[W]-V}if(D>0?j[I]=Math.round(j[I]):n[I]=Math.round(n[I]),X(L,I,D,G))return!0;for(W=0;W<3;W++)R[W]=G[W];return i(),0===B}function O(){var D=x[0]<x[1]?x[0]<x[2]?0:2:x[1]<x[2]?1:2,l=x[D]-u;for(u=x[D],F[D]+=H[D],x[D]+=h[D],W=0;W<3;W++)K[W]+=l*r[W],d[W]=U(K[W],H[W]);return D}function s(D,l){return o(D-l*e)}function U(D,l){return o(D+l*e)}}(D,F,h,x,r,H);if(!d){for(L=0;L<3;L++)o[L]=K[L]>0?r[L]-e.max[L]:x[L]-e.base[L];e.translate(o)}return u}},13929:(D,l,G)=>{"use strict";G.d(l,{b:()=>g});var V=G(13749),N=G(12566);class M{constructor(D,l,G,M,b,X,t){this.pR=new V(D.base,D.Xn),this.ON=l,this.friction=G,this.restitution=M,this.hX=b,this.Qe=X,this.xX=!!t,this.bn=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.YK=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.xR=N.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=N.create(),this._impulses=N.create(),this._sleepFrameCount=10}loadFromCopy(D){N.k(this.pR.base,D.pR.base),N.k(this.pR.Xn,D.pR.Xn),N.k(this.pR.max,D.pR.max),this.pR.mag=D.pR.mag,this.ON=D.ON,this.friction=D.friction,this.restitution=D.restitution,this.hX=D.hX,this.Qe=D.Qe,this.xX=D.xX,this.bn=D.bn,this.fluidDrag=D.fluidDrag,this.YK=D.YK,this.preventFallOffEdge=D.preventFallOffEdge,this.rolledBackLastTick=D.rolledBackLastTick,N.k(this.xR,D.xR),N.k(this.resting,D.resting),this.inFluid=D.inFluid,this._ratioInFluid=D._ratioInFluid,N.k(this._forces,D._forces),N.k(this._impulses,D._impulses),this._sleepFrameCount=D._sleepFrameCount}setPosition(D){b(D),N.Fl(D,D,this.pR.base),this.pR.translate(D),this.LR()}CM(){return N.clone(this.pR.base)}applyForce(D){b(D),N.add(this._forces,this._forces,D),this.LR()}applyImpulse(D){b(D),N.add(this._impulses,this._impulses,D),this.LR()}LR(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var b=D=>{};var X=G(13749),t=G(12566),R=G(13754);function n(){this.bn=.1,this.fluidDrag=.4,this.BX=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function g(D,l,G){D=Object.assign(new n,D),this.gravity=D.gravity||[0,-10,0],this.bn=D.bn||.1,this.BX=D.BX||2,this.fluidDrag=D.fluidDrag||.4,this.minBounceImpulse=D.minBounceImpulse,this.bodies=[],this.Xe=D.Xe,this.testSolid=l,this.testFluid=G}g.prototype.bK=function(D,l,G,V,N,b){D=D||new X([0,0,0],[1,1,1]),"undefined"==typeof l&&(l=1),"undefined"==typeof G&&(G=1),"undefined"==typeof V&&(V=0),"undefined"==typeof N&&(N=1);var t=new M(D,l,G,V,N,b);return this.bodies.push(t),t},g.prototype.XK=function(D){var l=this.bodies.indexOf(D);l<0||(this.bodies.splice(l,1),D.pR=D.Qe=null)};var j=t.create(),e=t.create(),K=t.create(),F=t.create(),d=t.create(),H=t.create(),h=t.create(),x=new X([0,0,0],[1,1,1]),r=new M(x,1,1,0,1,(()=>{}),!1);function o(D,l,G){return l=G,l*=1-(1-D.ratioInFluid)**2}g.prototype.JX=function(D){D/=1e3;var l=Z(0,t.squaredLength(this.gravity));this.bodies.forEach((G=>function(D,l,G,V){t.k(d,l.resting),D.Xe&&r.loadFromCopy(l);if(l.ON<=0)return t.set(l.xR,0,0,0),t.set(l._forces,0,0,0),void t.set(l._impulses,0,0,0);var N=V||0===l.hX;if(function(D,l,G,V){if(l._sleepFrameCount>0)return!1;if(V)return!0;var N=!1,M=.5*G*G*l.hX;return t.scale(v,D.gravity,M),R(D.testSolid,l.pR,v,(function(){return N=!0,!0}),!0),N}(D,l,G,N))return;l._sleepFrameCount--,function(D,l){var G=l.pR,V=Math.floor(G.base[0]),N=Math.floor(G.base[2]),M=Math.floor(G.base[1]),b=Math.floor(G.max[1]);if(!D.testFluid(V,M,N))return l.inFluid=!1,void(l.ratioInFluid=0);var X=1,R=M+1;for(;R<=b&&D.testFluid(V,R,N);)X++,R++;var n=(M+X-G.base[1])/G.Xn[1];n>1&&(n=1);var g=G.Xn[0]*G.Xn[1]*G.Xn[2]*n,j=u;t.scale(j,D.gravity,-D.BX*g*l.hX),l.applyForce(j),l.inFluid=!0,l.ratioInFluid=n}(D,l),Y(l._forces),Y(l._impulses),Y(l.xR),Y(l.resting),t.scale(j,l._forces,1/l.ON),t.OX(j,j,D.gravity,l.hX),t.scale(e,l._impulses,1/l.ON),t.OX(e,e,j,G),t.add(l.xR,l.xR,e),l.friction&&(B(D,0,l,e,G),B(D,1,l,e,G),B(D,2,l,e,G));var M=l.fluidDrag>=0?l.fluidDrag:D.fluidDrag,b=l.bn>=0?l.bn:D.bn,X=b,n=b;l.inFluid&&(X=o(l,X,l.fluidDragHoriz>=0?l.fluidDragHoriz:M),n=o(l,n,l.fluidDragVert>=0?l.fluidDragVert:M));X=Math.max(1-X*G/l.ON,0),n=Math.max(1-n*G/l.ON,0),t.set(L,X,n,X),t.multiply(l.xR,l.xR,L),t.scale(K,l.xR,G),t.set(l._forces,0,0,0),t.set(l._impulses,0,0,0),l.xX&&J(i,l.pR);t.k(H,K),t.set(h,0,0,0),l.preventFallOffEdge&&function(D,l,G,V){if(!l.resting[1]||G[1]>0)return;var N=f;J(N,l.pR);for(var M=0;M<3;M+=2){t.set(U,0,0,0),U[M]=G[M];var b=!0;(b=(b=(b=(b=b&&!c(D,N.base[0]+U[0]+1e-5,N.base[1],N.base[2]+U[2]+1e-5))&&!c(D,N.max[0]+U[0]-1e-5,N.base[1],N.base[2]+U[2]+1e-5))&&!c(D,N.base[0]+U[0]+1e-5,N.base[1],N.max[2]+U[2]-1e-5))&&!c(D,N.max[0]+U[0]-1e-5,N.base[1],N.max[2]+U[2]-1e-5))?(V[M]=G[M]>0?1:-1,G[M]=0):0===M&&(t.set(q,G[0],0,0),W(D,N,q,V,l.slideOnCollision))}}(D,l,K,h);W(D,l.pR,K,l.resting,l.slideOnCollision),l.xX&&function(D,l,G,V){if(l.resting[1]>=0&&!l.inFluid)return;var N=0!==l.resting[0],M=0!==l.resting[2];if(!N&&!M)return;var b=Math.abs(V[0]/V[2]),X=4;if(!N&&b>X)return;if(!M&&b<1/X)return;t.add(S,G.base,V);var n=D.testSolid;R(n,G,V,(function(D,l,G,V){if(1!==l)return!0;V[l]=0}));var g=G.base[1],j=l.inFluid?1.951:1.001,e=Math.floor(g+j)-g;t.set(O,0,e,0);var K=!1;if(R(n,G,O,(function(D,l,G,V){return K=!0,!0})),K)return;t.Fl(s,S,G.base),s[1]=0,W(D,G,s,y,!0);var F=Z(G.base[0],S[0]),d=Z(G.base[2],S[2]);if(N&&!F&&(!d||!M))return;if(M&&(!F||!N)&&!d)return;var H=!0;if(H=H&&!c(D,G.base[0]+1e-5,G.base[1],G.base[2]+1e-5),H=H&&!c(D,G.max[0]-1e-5,G.base[1],G.base[2]+1e-5),H=H&&!c(D,G.base[0]+1e-5,G.base[1],G.max[2]-1e-5),H=H&&!c(D,G.max[0]-1e-5,G.base[1],G.max[2]-1e-5),H)return;J(l.pR,G),l.resting[0]=y[0],l.resting[2]=y[2],l.YK&&l.YK()}(D,l,i,H);for(var g=0;g<3;++g)l.resting[g]=l.resting[g]||h[g],F[g]=0,l.resting[g]&&(d[g]||(F[g]=-l.xR[g]),l.xR[g]=0);var x=t.length(F);x>.001&&(t.scale(F,F,l.ON),l.Qe&&l.Qe(F),l.restitution>0&&x>D.minBounceImpulse&&(t.scale(F,F,l.restitution),l.applyImpulse(F)));var I=t.squaredLength(l.xR);I>1e-5&&l.LR();D.Xe&&D.Xe(l)?(l.loadFromCopy(r),l.rolledBackLastTick=!0):l.rolledBackLastTick=!1}(this,G,D,l)))};var L=t.create([0,0,0]);var u=t.create();function B(D,l,G,V,N){var M=G.resting[l],b=V[l];if(!G.alwaysApplyHorizFriction||1!==l){if(0===M)return;if(M*b<=0)return}t.k(I,G.xR),I[l]=0;var X=t.length(I);if(!Z(X,0)){var R=Math.abs(G.friction*D.gravity[l]*N),n=X>R?(X-R)/X:0;G.xR[(l+1)%3]*=n,G.xR[(l+2)%3]*=n}}var I=t.create();function W(D,l,G,V,N){return t.set(V,0,0,0),R(D.testSolid,l,G,(function(D,l,G,M){V[l]=G,M[l]=0,N||(M[0]=0,M[1]=0,M[2]=0)}))}var i=new X([],[]),y=t.create(),S=t.create(),O=t.create(),s=t.create();var U=t.create(),f=new X([],[]),q=t.create();function c(D,l,G,V){return D.testSolid(Math.floor(l),Math.floor(G-1),Math.floor(V))}var v=t.create();function Z(D,l){return Math.abs(D-l)<1e-5}function J(D,l){for(var G=0;G<3;G++)D.base[G]=l.base[G],D.max[G]=l.max[G],D.Xn[G]=l.Xn[G]}var Y=function(D){}},12420:function(D,l){!function(D){"use strict";var l=function(D,G){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,l){D.__proto__=l}||function(D,l){for(var G in l)Object.prototype.hasOwnProperty.call(l,G)&&(D[G]=l[G])},l(D,G)};function G(D,G){if("function"!==typeof G&&null!==G)throw new TypeError("Class extends value "+String(G)+" is not a constructor or null");function V(){this.constructor=D}l(D,G),D.prototype=null===G?Object.create(G):(V.prototype=G.prototype,new V)}function V(D,l,G,V){var N,M=arguments.length,b=M<3?l:null===V?V=Object.getOwnPropertyDescriptor(l,G):V;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)b=Reflect.decorate(D,l,G,V);else for(var X=D.length-1;X>=0;X--)(N=D[X])&&(b=(M<3?N(b):M>3?N(l,G,b):N(l,G))||b);return M>3&&b&&Object.defineProperty(l,G,b),b}function N(D,l,G){if(G||2===arguments.length)for(var V,N=0,M=l.length;N<M;N++)!V&&N in l||(V||(V=Array.prototype.slice.call(l,0,N)),V[N]=l[N]);return D.concat(V||Array.prototype.slice.call(l))}var M,b=255,X=213;D.OPERATION=void 0,(M=D.OPERATION||(D.OPERATION={}))[M.ADD=128]="ADD",M[M.REPLACE=0]="REPLACE",M[M.DELETE=64]="DELETE",M[M.DELETE_AND_ADD=192]="DELETE_AND_ADD",M[M.TOUCH=1]="TOUCH",M[M.CLEAR=10]="CLEAR";var t=function(){function l(D,l,G){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=D,this.setParent(l,G)}return l.prototype.setParent=function(D,l,G){var V=this;if(this.indexes||(this.indexes=this.ref instanceof sD?this.ref._definition.indexes:{}),this.parent=D,this.parentIndex=G,l)if(this.root=l,this.ref instanceof sD){var N=this.ref._definition;for(var M in N.schema){var b=this.ref[M];if(b&&b.$changes){var X=N.indexes[M];b.$changes.setParent(this.ref,l,X)}}}else"object"===typeof this.ref&&this.ref.forEach((function(D,l){if(D instanceof sD){var G=D.$changes,N=V.ref.$changes.indexes[l];G.setParent(V.ref,V.root,N)}}))},l.prototype.operation=function(D){this.changes.set(--this.currentCustomOperation,D)},l.prototype.change=function(l,G){void 0===G&&(G=D.OPERATION.ADD);var V="number"===typeof l?l:this.indexes[l];this.assertValidIndex(V,l);var N=this.changes.get(V);N&&N.op!==D.OPERATION.DELETE&&N.op!==D.OPERATION.TOUCH||this.changes.set(V,{op:N&&N.op===D.OPERATION.DELETE?D.OPERATION.DELETE_AND_ADD:G,index:V}),this.allChanges.add(V),this.changed=!0,this.touchParents()},l.prototype.touch=function(l){var G="number"===typeof l?l:this.indexes[l];this.assertValidIndex(G,l),this.changes.has(G)||this.changes.set(G,{op:D.OPERATION.TOUCH,index:G}),this.allChanges.add(G),this.touchParents()},l.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},l.prototype.getType=function(D){if(this.ref._definition)return(l=this.ref._definition).schema[l.fieldsByIndex[D]];var l,G=(l=this.parent._definition).schema[l.fieldsByIndex[this.parentIndex]];return Object.values(G)[0]},l.prototype.getChildrenFilter=function(){var D=this.parent._definition.childFilters;return D&&D[this.parentIndex]},l.prototype.getValue=function(D){return this.ref.getByIndex(D)},l.prototype.delete=function(l){var G="number"===typeof l?l:this.indexes[l];if(void 0!==G){var V=this.getValue(G);this.changes.set(G,{op:D.OPERATION.DELETE,index:G}),this.allChanges.delete(G),delete this.caches[G],V&&V.$changes&&(V.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(l," (").concat(G,")"))},l.prototype.discard=function(l,G){var V=this;void 0===l&&(l=!1),void 0===G&&(G=!1),this.ref instanceof sD||this.changes.forEach((function(l){if(l.op===D.OPERATION.DELETE){var G=V.ref.getIndex(l.index);delete V.indexes[G]}})),this.changes.clear(),this.changed=l,G&&this.allChanges.clear(),this.currentCustomOperation=0},l.prototype.discardAll=function(){var D=this;this.changes.forEach((function(l){var G=D.getValue(l.index);G&&G.$changes&&G.$changes.discardAll()})),this.discard()},l.prototype.cache=function(D,l){this.caches[D]=l},l.prototype.clone=function(){return new l(this.ref,this.parent,this.root)},l.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},l.prototype.assertValidIndex=function(D,l){if(void 0===D)throw new Error('ChangeTree: missing index for field "'.concat(l,'"'))},l}();function R(D,l,G,V){return D[l]||(D[l]=[]),D[l].push(G),null===V||void 0===V||V.forEach((function(D,l){return G(D,l)})),function(){return g(D[l],D[l].indexOf(G))}}function n(l){var G=this,V="string"!==typeof this.$changes.getType();this.$items.forEach((function(N,M){l.push({refId:G.$changes.refId,op:D.OPERATION.DELETE,field:M,value:void 0,previousValue:N}),V&&G.$changes.root.removeRef(N.$changes.refId)}))}function g(D,l){if(-1===l||l>=D.length)return!1;for(var G=D.length-1,V=l;V<G;V++)D[V]=D[V+1];return D.length=G,!0}var j=function(D,l){var G=D.toString(),V=l.toString();return G<V?-1:G>V?1:0};function e(D){return D.$proxy=!0,D=new Proxy(D,{get:function(D,l){return"symbol"===typeof l||isNaN(l)?D[l]:D.at(l)},set:function(D,l,G){if("symbol"===typeof l||isNaN(l))D[l]=G;else{var V=Array.from(D.$items.keys()),N=parseInt(V[l]||l);void 0===G||null===G?D.deleteAt(N):D.setAt(N,G)}return!0},deleteProperty:function(D,l){return"number"===typeof l?D.deleteAt(l):delete D[l],!0}})}var K=function(){function l(){for(var D=[],l=0;l<arguments.length;l++)D[l]=arguments[l];this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,D)}return l.prototype.EX=function(l,G){return void 0===G&&(G=!0),R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.ADD,l,G?this.$items:void 0)},l.prototype.IV=function(l){return R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,l)},l.prototype.onChange=function(l){return R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,l)},l.is=function(D){return Array.isArray(D)||void 0!==D.array},Object.defineProperty(l.prototype,"length",{get:function(){return this.$items.size},set:function(D){0===D?this.clear():this.splice(D,this.length-D)},enumerable:!1,configurable:!0}),l.prototype.push=function(){for(var D,l=this,G=[],V=0;V<arguments.length;V++)G[V]=arguments[V];return G.forEach((function(G){D=l.$refId++,l.setAt(D,G)})),D},l.prototype.pop=function(){var D=Array.from(this.$indexes.values()).pop();if(void 0!==D){this.$changes.delete(D),this.$indexes.delete(D);var l=this.$items.get(D);return this.$items.delete(D),l}},l.prototype.at=function(D){var l=Array.from(this.$items.keys())[D];return this.$items.get(l)},l.prototype.setAt=function(l,G){var V,N;if(void 0!==G&&null!==G){if(this.$items.get(l)!==G){void 0!==G.$changes&&G.$changes.setParent(this,this.$changes.root,l);var M=null!==(N=null===(V=this.$changes.indexes[l])||void 0===V?void 0:V.op)&&void 0!==N?N:D.OPERATION.ADD;this.$changes.indexes[l]=l,this.$indexes.set(l,l),this.$items.set(l,G),this.$changes.change(l,M)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},l.prototype.deleteAt=function(D){var l=Array.from(this.$items.keys())[D];return void 0!==l&&this.$deleteAt(l)},l.prototype.$deleteAt=function(D){return this.$changes.delete(D),this.$indexes.delete(D),this.$items.delete(D)},l.prototype.clear=function(l){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),l&&n.call(this,l),this.$items.clear(),this.$changes.operation({index:0,op:D.OPERATION.CLEAR}),this.$changes.touchParents()},l.prototype.concat=function(){for(var D,G=[],V=0;V<arguments.length;V++)G[V]=arguments[V];return new(l.bind.apply(l,N([void 0],(D=Array.from(this.$items.values())).concat.apply(D,G),!1)))},l.prototype.join=function(D){return Array.from(this.$items.values()).join(D)},l.prototype.reverse=function(){var D=this,l=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(G,V){D.setAt(l[V],G)})),this},l.prototype.shift=function(){var D=Array.from(this.$items.keys()).shift();if(void 0!==D){var l=this.$items.get(D);return this.$deleteAt(D),l}},l.prototype.slice=function(D,G){var V=new l;return V.push.apply(V,Array.from(this.$items.values()).slice(D,G)),V},l.prototype.sort=function(D){var l=this;void 0===D&&(D=j);var G=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(D).forEach((function(D,V){l.setAt(G[V],D)})),this},l.prototype.splice=function(D,l){void 0===l&&(l=this.length-D);for(var G=Array.from(this.$items.keys()),V=[],N=D;N<D+l;N++)V.push(this.$items.get(G[N])),this.$deleteAt(G[N]);return V},l.prototype.unshift=function(){for(var D=this,l=[],G=0;G<arguments.length;G++)l[G]=arguments[G];var V=this.length,N=l.length,M=Array.from(this.$items.values());return l.forEach((function(l,G){D.setAt(G,l)})),M.forEach((function(l,G){D.setAt(N+G,l)})),V+N},l.prototype.indexOf=function(D,l){return Array.from(this.$items.values()).indexOf(D,l)},l.prototype.lastIndexOf=function(D,l){return void 0===l&&(l=this.length-1),Array.from(this.$items.values()).lastIndexOf(D,l)},l.prototype.every=function(D,l){return Array.from(this.$items.values()).every(D,l)},l.prototype.some=function(D,l){return Array.from(this.$items.values()).some(D,l)},l.prototype.forEach=function(D,l){Array.from(this.$items.values()).forEach(D,l)},l.prototype.map=function(D,l){return Array.from(this.$items.values()).map(D,l)},l.prototype.filter=function(D,l){return Array.from(this.$items.values()).filter(D,l)},l.prototype.reduce=function(D,l){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},l.prototype.reduceRight=function(D,l){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},l.prototype.find=function(D,l){return Array.from(this.$items.values()).find(D,l)},l.prototype.findIndex=function(D,l){return Array.from(this.$items.values()).findIndex(D,l)},l.prototype.fill=function(D,l,G){throw new Error("ArraySchema#fill() not implemented")},l.prototype.copyWithin=function(D,l,G){throw new Error("ArraySchema#copyWithin() not implemented")},l.prototype.toString=function(){return this.$items.toString()},l.prototype.toLocaleString=function(){return this.$items.toLocaleString()},l.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(l,Symbol.species,{get:function(){return l},enumerable:!1,configurable:!0}),l.prototype.entries=function(){return this.$items.entries()},l.prototype.keys=function(){return this.$items.keys()},l.prototype.values=function(){return this.$items.values()},l.prototype.includes=function(D,l){return Array.from(this.$items.values()).includes(D,l)},l.prototype.flatMap=function(D,l){throw new Error("ArraySchema#flatMap() is not supported.")},l.prototype.flat=function(D){throw new Error("ArraySchema#flat() is not supported.")},l.prototype.findLast=function(){var D=Array.from(this.$items.values());return D.findLast.apply(D,arguments)},l.prototype.findLastIndex=function(){var D=Array.from(this.$items.values());return D.findLastIndex.apply(D,arguments)},l.prototype.setIndex=function(D,l){this.$indexes.set(D,l)},l.prototype.getIndex=function(D){return this.$indexes.get(D)},l.prototype.getByIndex=function(D){return this.$items.get(this.$indexes.get(D))},l.prototype.deleteByIndex=function(D){var l=this.$indexes.get(D);this.$items.delete(l),this.$indexes.delete(D)},l.prototype.toArray=function(){return Array.from(this.$items.values())},l.prototype.toJSON=function(){return this.toArray().map((function(D){return"function"===typeof D.toJSON?D.toJSON():D}))},l.prototype.clone=function(D){return D?new(l.bind.apply(l,N([void 0],Array.from(this.$items.values()),!1))):new(l.bind.apply(l,N([void 0],this.map((function(D){return D.$changes?D.clone():D})),!1)))},l}();function F(D){return D.$proxy=!0,D=new Proxy(D,{get:function(D,l){return"symbol"!==typeof l&&"undefined"===typeof D[l]?D.get(l):D[l]},set:function(D,l,G){return"symbol"!==typeof l&&-1===l.indexOf("$")&&"EX"!==l&&"IV"!==l&&"onChange"!==l?D.set(l,G):D[l]=G,!0},deleteProperty:function(D,l){return D.delete(l),!0}})}var d=function(){function l(D){var G=this;if(this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,D)if(D instanceof Map||D instanceof l)D.forEach((function(D,l){return G.set(l,D)}));else for(var V in D)this.set(V,D[V])}return l.prototype.EX=function(l,G){return void 0===G&&(G=!0),R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.ADD,l,G?this.$items:void 0)},l.prototype.IV=function(l){return R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,l)},l.prototype.onChange=function(l){return R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,l)},l.is=function(D){return void 0!==D.map},l.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(l.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(l,Symbol.species,{get:function(){return l},enumerable:!1,configurable:!0}),l.prototype.set=function(l,G){if(void 0===G||null===G)throw new Error("MapSchema#set('".concat(l,"', ").concat(G,"): trying to set ").concat(G," value on '").concat(l,"'."));l=l.toString();var V="undefined"!==typeof this.$changes.indexes[l],N=V?this.$changes.indexes[l]:this.$refId++,M=V?D.OPERATION.REPLACE:D.OPERATION.ADD,b=void 0!==G.$changes;if(b&&G.$changes.setParent(this,this.$changes.root,N),V){if(!b&&this.$items.get(l)===G)return;b&&this.$items.get(l)!==G&&(M=D.OPERATION.ADD)}else this.$changes.indexes[l]=N,this.$indexes.set(N,l);return this.$items.set(l,G),this.$changes.change(l,M),this},l.prototype.get=function(D){return this.$items.get(D)},l.prototype.delete=function(D){return this.$changes.delete(D),this.$items.delete(D)},l.prototype.clear=function(l){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),l&&n.call(this,l),this.$items.clear(),this.$changes.operation({index:0,op:D.OPERATION.CLEAR}),this.$changes.touchParents()},l.prototype.has=function(D){return this.$items.has(D)},l.prototype.forEach=function(D){this.$items.forEach(D)},l.prototype.entries=function(){return this.$items.entries()},l.prototype.keys=function(){return this.$items.keys()},l.prototype.values=function(){return this.$items.values()},Object.defineProperty(l.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),l.prototype.setIndex=function(D,l){this.$indexes.set(D,l)},l.prototype.getIndex=function(D){return this.$indexes.get(D)},l.prototype.getByIndex=function(D){return this.$items.get(this.$indexes.get(D))},l.prototype.deleteByIndex=function(D){var l=this.$indexes.get(D);this.$items.delete(l),this.$indexes.delete(D)},l.prototype.toJSON=function(){var D={};return this.forEach((function(l,G){D[G]="function"===typeof l.toJSON?l.toJSON():l})),D},l.prototype.clone=function(D){var G;return D?G=Object.assign(new l,this):(G=new l,this.forEach((function(D,l){D.$changes?G.set(l,D.clone()):G.set(l,D)}))),G},l}(),H={};function h(D,l){H[D]=l}function x(D){return H[D]}var r=function(){function D(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return D.create=function(l){var G=new D;return G.schema=Object.assign({},l&&l.schema||{}),G.indexes=Object.assign({},l&&l.indexes||{}),G.fieldsByIndex=Object.assign({},l&&l.fieldsByIndex||{}),G.descriptors=Object.assign({},l&&l.descriptors||{}),G.deprecated=Object.assign({},l&&l.deprecated||{}),G},D.prototype.addField=function(D,l){var G=this.getNextFieldIndex();this.fieldsByIndex[G]=D,this.indexes[D]=G,this.schema[D]=Array.isArray(l)?{array:l[0]}:l},D.prototype.hasField=function(D){return void 0!==this.indexes[D]},D.prototype.addFilter=function(D,l){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[D]]=l,this.indexesWithFilters.push(this.indexes[D]),!0},D.prototype.addChildrenFilter=function(D,l){var G=this.indexes[D],V=this.schema[D];if(x(Object.keys(V)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[G]=l,!0;console.warn("@filterChildren: field '".concat(D,"' can't have children. Ignoring filter."))},D.prototype.getChildrenFilter=function(D){return this.childFilters&&this.childFilters[this.indexes[D]]},D.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},D}();function o(D){return D._context&&D._context.useFilters}var L=function(){function D(){this.types={},this.schemas=new Map,this.useFilters=!1}return D.prototype.has=function(D){return this.schemas.has(D)},D.prototype.get=function(D){return this.types[D]},D.prototype.add=function(D,l){void 0===l&&(l=this.schemas.size),D._definition=r.create(D._definition),D._typeid=l,this.types[l]=D,this.schemas.set(D,l)},D.create=function(l){return void 0===l&&(l={}),function(G){return l.context||(l.context=new D),B(G,l)}},D}(),u=new L;function B(D,l){return void 0===l&&(l={}),function(G,V){var M=l.context||u,b=G.constructor;if(b._context=M,!D)throw new Error("".concat(b.name,': @type() reference provided for "').concat(V,"\" is undefined. Make sure you don't have any circular dependencies."));M.has(b)||M.add(b);var X=b._definition;if(X.addField(V,D),X.descriptors[V]){if(X.deprecated[V])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(V,"' definition on '").concat(b.name,"'.\nCheck @type() annotation"))}catch(H){var t=H.stack.split("\n")[4].trim();throw new Error("".concat(H.message," ").concat(t))}}var R=K.is(D),n=!R&&d.is(D);if("string"!==typeof D&&!sD.is(D)){var g=Object.values(D)[0];"string"===typeof g||M.has(g)||M.add(g)}if(l.manual)X.descriptors[V]={enumerable:!0,configurable:!0,writable:!0};else{var j="_".concat(V);X.descriptors[j]={enumerable:!1,configurable:!1,writable:!0},X.descriptors[V]={get:function(){return this[j]},set:function(D){D!==this[j]&&(void 0!==D&&null!==D?(!R||D instanceof K||(D=new(K.bind.apply(K,N([void 0],D,!1)))),!n||D instanceof d||(D=new d(D)),void 0===D.$proxy&&(n?D=F(D):R&&(D=e(D))),this.$changes.change(V),D.$changes&&D.$changes.setParent(this,this.$changes.root,this._definition.indexes[V])):this[j]&&this.$changes.delete(V),this[j]=D)},enumerable:!0,configurable:!0}}}}function I(D){return function(l,G){var V=l.constructor;V._definition.addFilter(G,D)&&(V._context.useFilters=!0)}}function W(D){return function(l,G){var V=l.constructor;V._definition.addChildrenFilter(G,D)&&(V._context.useFilters=!0)}}function i(D){return void 0===D&&(D=!0),function(l,G){var V=l.constructor._definition;V.deprecated[G]=!0,D&&(V.descriptors[G]={get:function(){throw new Error("".concat(G," is deprecated."))},set:function(D){},enumerable:!1,configurable:!0})}}function y(D,l,G){for(var V in void 0===G&&(G={}),G.context||(G.context=D._context||G.context||u),l)B(l[V],G)(D.prototype,V);return D}function S(D){for(var l=0,G=0,V=0,N=D.length;V<N;V++)(l=D.charCodeAt(V))<128?G+=1:l<2048?G+=2:l<55296||l>=57344?G+=3:(V++,G+=4);return G}function O(D,l,G){for(var V=0,N=0,M=G.length;N<M;N++)(V=G.charCodeAt(N))<128?D[l++]=V:V<2048?(D[l++]=192|V>>6,D[l++]=128|63&V):V<55296||V>=57344?(D[l++]=224|V>>12,D[l++]=128|V>>6&63,D[l++]=128|63&V):(N++,V=65536+((1023&V)<<10|1023&G.charCodeAt(N)),D[l++]=240|V>>18,D[l++]=128|V>>12&63,D[l++]=128|V>>6&63,D[l++]=128|63&V)}function s(D,l){D.push(255&l)}function U(D,l){D.push(255&l)}function f(D,l){D.push(255&l),D.push(l>>8&255)}function q(D,l){D.push(255&l),D.push(l>>8&255)}function c(D,l){D.push(255&l),D.push(l>>8&255),D.push(l>>16&255),D.push(l>>24&255)}function v(D,l){var G=l>>24,V=l>>16,N=l>>8,M=l;D.push(255&M),D.push(255&N),D.push(255&V),D.push(255&G)}function Z(D,l){var G=Math.floor(l/Math.pow(2,32));v(D,l>>>0),v(D,G)}function J(D,l){var G=l/Math.pow(2,32)|0;v(D,l>>>0),v(D,G)}function Y(D,l){k(D,l)}function z(D,l){m(D,l)}var E=new Int32Array(2),P=new Float32Array(E.buffer),p=new Float64Array(E.buffer);function k(D,l){P[0]=l,c(D,E[0])}function m(D,l){p[0]=l,c(D,E[0]),c(D,E[1])}function T(D,l){return U(D,l?1:0)}function C(D,l){l||(l="");var G=S(l),V=0;if(G<32)D.push(160|G),V=1;else if(G<256)D.push(217),U(D,G),V=2;else if(G<65536)D.push(218),q(D,G),V=3;else{if(!(G<4294967296))throw new Error("String too long");D.push(219),v(D,G),V=5}return O(D,D.length,l),V+G}function w(D,l){return isNaN(l)?w(D,0):isFinite(l)?l!==(0|l)?(D.push(203),m(D,l),9):l>=0?l<128?(U(D,l),1):l<256?(D.push(204),U(D,l),2):l<65536?(D.push(205),q(D,l),3):l<4294967296?(D.push(206),v(D,l),5):(D.push(207),J(D,l),9):l>=-32?(D.push(224|l+32),1):l>=-128?(D.push(208),s(D,l),2):l>=-32768?(D.push(209),f(D,l),3):l>=-2147483648?(D.push(210),c(D,l),5):(D.push(211),Z(D,l),9):w(D,l>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var A=Object.freeze({__proto__:null,utf8Write:O,int8:s,uint8:U,int16:f,uint16:q,int32:c,uint32:v,int64:Z,uint64:J,float32:Y,float64:z,writeFloat32:k,writeFloat64:m,boolean:T,string:C,number:w});function a(D,l,G){for(var V="",N=0,M=l,b=l+G;M<b;M++){var X=D[M];0!==(128&X)?192!==(224&X)?224!==(240&X)?240!==(248&X)?console.error("Invalid byte "+X.toString(16)):(N=(7&X)<<18|(63&D[++M])<<12|(63&D[++M])<<6|63&D[++M])>=65536?(N-=65536,V+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):V+=String.fromCharCode(N):V+=String.fromCharCode((15&X)<<12|(63&D[++M])<<6|63&D[++M]):V+=String.fromCharCode((31&X)<<6|63&D[++M]):V+=String.fromCharCode(X)}return V}function Q(D,l){return DD(D,l)<<24>>24}function DD(D,l){return D[l.offset++]}function lD(D,l){return GD(D,l)<<16>>16}function GD(D,l){return D[l.offset++]|D[l.offset++]<<8}function VD(D,l){return D[l.offset++]|D[l.offset++]<<8|D[l.offset++]<<16|D[l.offset++]<<24}function ND(D,l){return VD(D,l)>>>0}function MD(D,l){return jD(D,l)}function bD(D,l){return eD(D,l)}function XD(D,l){var G=ND(D,l);return VD(D,l)*Math.pow(2,32)+G}function tD(D,l){var G=ND(D,l);return ND(D,l)*Math.pow(2,32)+G}var RD=new Int32Array(2),nD=new Float32Array(RD.buffer),gD=new Float64Array(RD.buffer);function jD(D,l){return RD[0]=VD(D,l),nD[0]}function eD(D,l){return RD[0]=VD(D,l),RD[1]=VD(D,l),gD[0]}function KD(D,l){return DD(D,l)>0}function FD(D,l){var G,V=D[l.offset++];V<192?G=31&V:217===V?G=DD(D,l):218===V?G=GD(D,l):219===V&&(G=ND(D,l));var N=a(D,l.offset,G);return l.offset+=G,N}function dD(D,l){var G=D[l.offset];return G<192&&G>160||217===G||218===G||219===G}function HD(D,l){var G=D[l.offset++];return G<128?G:202===G?jD(D,l):203===G?eD(D,l):204===G?DD(D,l):205===G?GD(D,l):206===G?ND(D,l):207===G?tD(D,l):208===G?Q(D,l):209===G?lD(D,l):210===G?VD(D,l):211===G?XD(D,l):G>223?-1*(255-G+1):void 0}function hD(D,l){var G=D[l.offset];return G<128||G>=202&&G<=211}function xD(D,l){return D[l.offset]<160}function rD(D,l){return D[l.offset-1]===b&&(D[l.offset]<128||D[l.offset]>=202&&D[l.offset]<=211)}var oD=Object.freeze({__proto__:null,int8:Q,uint8:DD,int16:lD,uint16:GD,int32:VD,uint32:ND,float32:MD,float64:bD,int64:XD,uint64:tD,readFloat32:jD,readFloat64:eD,boolean:KD,string:FD,stringCheck:dD,number:HD,numberCheck:hD,arrayCheck:xD,switchStructureCheck:rD}),LD=function(){function l(D){var l=this;this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,D&&D.forEach((function(D){return l.add(D)}))}return l.prototype.EX=function(l,G){return void 0===G&&(G=!0),R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.ADD,l,G?this.$items:void 0)},l.prototype.IV=function(l){return R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,l)},l.prototype.onChange=function(l){return R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,l)},l.is=function(D){return void 0!==D.collection},l.prototype.add=function(D){var l=this.$refId++;return void 0!==D.$changes&&D.$changes.setParent(this,this.$changes.root,l),this.$changes.indexes[l]=l,this.$indexes.set(l,l),this.$items.set(l,D),this.$changes.change(l),l},l.prototype.at=function(D){var l=Array.from(this.$items.keys())[D];return this.$items.get(l)},l.prototype.entries=function(){return this.$items.entries()},l.prototype.delete=function(D){for(var l,G,V=this.$items.entries();(G=V.next())&&!G.done;)if(D===G.value[1]){l=G.value[0];break}return void 0!==l&&(this.$changes.delete(l),this.$indexes.delete(l),this.$items.delete(l))},l.prototype.clear=function(l){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),l&&n.call(this,l),this.$items.clear(),this.$changes.operation({index:0,op:D.OPERATION.CLEAR}),this.$changes.touchParents()},l.prototype.has=function(D){return Array.from(this.$items.values()).some((function(l){return l===D}))},l.prototype.forEach=function(D){var l=this;this.$items.forEach((function(G,V,N){return D(G,V,l)}))},l.prototype.values=function(){return this.$items.values()},Object.defineProperty(l.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),l.prototype.setIndex=function(D,l){this.$indexes.set(D,l)},l.prototype.getIndex=function(D){return this.$indexes.get(D)},l.prototype.getByIndex=function(D){return this.$items.get(this.$indexes.get(D))},l.prototype.deleteByIndex=function(D){var l=this.$indexes.get(D);this.$items.delete(l),this.$indexes.delete(D)},l.prototype.toArray=function(){return Array.from(this.$items.values())},l.prototype.toJSON=function(){var D=[];return this.forEach((function(l,G){D.push("function"===typeof l.toJSON?l.toJSON():l)})),D},l.prototype.clone=function(D){var G;return D?G=Object.assign(new l,this):(G=new l,this.forEach((function(D){D.$changes?G.add(D.clone()):G.add(D)}))),G},l}(),uD=function(){function l(D){var l=this;this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,D&&D.forEach((function(D){return l.add(D)}))}return l.prototype.EX=function(l,G){return void 0===G&&(G=!0),R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.ADD,l,G?this.$items:void 0)},l.prototype.IV=function(l){return R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,l)},l.prototype.onChange=function(l){return R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,l)},l.is=function(D){return void 0!==D.set},l.prototype.add=function(l){var G,V;if(this.has(l))return!1;var N=this.$refId++;void 0!==l.$changes&&l.$changes.setParent(this,this.$changes.root,N);var M=null!==(V=null===(G=this.$changes.indexes[N])||void 0===G?void 0:G.op)&&void 0!==V?V:D.OPERATION.ADD;return this.$changes.indexes[N]=N,this.$indexes.set(N,N),this.$items.set(N,l),this.$changes.change(N,M),N},l.prototype.entries=function(){return this.$items.entries()},l.prototype.delete=function(D){for(var l,G,V=this.$items.entries();(G=V.next())&&!G.done;)if(D===G.value[1]){l=G.value[0];break}return void 0!==l&&(this.$changes.delete(l),this.$indexes.delete(l),this.$items.delete(l))},l.prototype.clear=function(l){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),l&&n.call(this,l),this.$items.clear(),this.$changes.operation({index:0,op:D.OPERATION.CLEAR}),this.$changes.touchParents()},l.prototype.has=function(D){for(var l,G=this.$items.values(),V=!1;(l=G.next())&&!l.done;)if(D===l.value){V=!0;break}return V},l.prototype.forEach=function(D){var l=this;this.$items.forEach((function(G,V,N){return D(G,V,l)}))},l.prototype.values=function(){return this.$items.values()},Object.defineProperty(l.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),l.prototype.setIndex=function(D,l){this.$indexes.set(D,l)},l.prototype.getIndex=function(D){return this.$indexes.get(D)},l.prototype.getByIndex=function(D){return this.$items.get(this.$indexes.get(D))},l.prototype.deleteByIndex=function(D){var l=this.$indexes.get(D);this.$items.delete(l),this.$indexes.delete(D)},l.prototype.toArray=function(){return Array.from(this.$items.values())},l.prototype.toJSON=function(){var D=[];return this.forEach((function(l,G){D.push("function"===typeof l.toJSON?l.toJSON():l)})),D},l.prototype.clone=function(D){var G;return D?G=Object.assign(new l,this):(G=new l,this.forEach((function(D){D.$changes?G.add(D.clone()):G.add(D)}))),G},l}(),BD=function(){function D(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return D.prototype.addRefId=function(D){this.refIds.has(D)||(this.refIds.add(D),this.containerIndexes.set(D,new Set))},D.get=function(l){return void 0===l.$filterState&&(l.$filterState=new D),l.$filterState},D}(),ID=function(){function D(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return D.prototype.getNextUniqueId=function(){return this.nextUniqueId++},D.prototype.addRef=function(D,l,G){void 0===G&&(G=!0),this.refs.set(D,l),G&&(this.refCounts[D]=(this.refCounts[D]||0)+1)},D.prototype.removeRef=function(D){this.refCounts[D]=this.refCounts[D]-1,this.deletedRefs.add(D)},D.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},D.prototype.garbageCollectDeletedRefs=function(){var D=this;this.deletedRefs.forEach((function(l){if(!(D.refCounts[l]>0)){var G=D.refs.get(l);if(G instanceof sD)for(var V in G._definition.schema)"string"!==typeof G._definition.schema[V]&&G[V]&&G[V].$changes&&D.removeRef(G[V].$changes.refId);else{var N=G.$changes.parent._definition,M=N.schema[N.fieldsByIndex[G.$changes.parentIndex]];"function"===typeof Object.values(M)[0]&&Array.from(G.values()).forEach((function(l){return D.removeRef(l.$changes.refId)}))}D.refs.delete(l),delete D.refCounts[l]}})),this.deletedRefs.clear()},D}(),WD=function(D){function l(){return null!==D&&D.apply(this,arguments)||this}return G(l,D),l}(Error);function iD(D,l,G,V){var N,M=!1;switch(l){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":N="number",isNaN(D)&&console.log('trying to encode "NaN" in '.concat(G.constructor.name,"#").concat(V));break;case"string":N="string",M=!0;break;case"boolean":return}if(typeof D!==N&&(!M||M&&null!==D)){var b="'".concat(JSON.stringify(D),"'").concat(D&&D.constructor&&" (".concat(D.constructor.name,")")||"");throw new WD("a '".concat(N,"' was expected, but ").concat(b," was provided in ").concat(G.constructor.name,"#").concat(V))}}function yD(D,l,G,V){if(!(D instanceof l))throw new WD("a '".concat(l.name,"' was expected, but '").concat(D.constructor.name,"' was provided in ").concat(G.constructor.name,"#").concat(V))}function SD(D,l,G,V,N){iD(G,D,V,N);var M=A[D];if(!M)throw new WD("a '".concat(D,"' was expected, but ").concat(G," was provided in ").concat(V.constructor.name,"#").concat(N));M(l,G)}function OD(D,l,G){return oD[D](l,G)}var sD=function(){function l(){for(var D=[],l=0;l<arguments.length;l++)D[l]=arguments[l];Object.defineProperties(this,{$changes:{value:new t(this,void 0,new ID),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var G=this._definition.descriptors;G&&Object.defineProperties(this,G),D[0]&&this.assign(D[0])}return l.onError=function(D){console.error(D)},l.is=function(D){return D._definition&&void 0!==D._definition.schema},l.prototype.onChange=function(l){return R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,l)},l.prototype.IV=function(l){return R(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,l)},l.prototype.assign=function(D){return Object.assign(this,D),this},Object.defineProperty(l.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),l.prototype.setDirty=function(D,l){this.$changes.change(D,l)},l.prototype.listen=function(D,l,G){var V=this;return void 0===G&&(G=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[D]||(this.$callbacks[D]=[]),this.$callbacks[D].push(l),G&&void 0!==this[D]&&l(this[D],void 0),function(){return g(V.$callbacks[D],V.$callbacks[D].indexOf(l))}},l.prototype.decode=function(G,V,N){var M;void 0===V&&(V={offset:0}),void 0===N&&(N=this);var X=[],t=this.$changes.root,R=G.length,n=0;for(t.refs.set(n,this);V.offset<R;){var g=G[V.offset++];if(g!=b){var j=N.$changes,e=void 0!==N._definition,F=e?g>>6<<6:g;if(F!==D.OPERATION.CLEAR){var H=e?g%(F||255):HD(G,V),h=e?N._definition.fieldsByIndex[H]:"",r=j.getType(H),o=void 0,L=void 0,u=void 0;if(e?L=N["_".concat(h)]:(L=N.getByIndex(H),(F&D.OPERATION.ADD)===D.OPERATION.ADD?(u=N instanceof d?FD(G,V):H,N.setIndex(H,u)):u=N.getIndex(H)),(F&D.OPERATION.DELETE)===D.OPERATION.DELETE&&(F!==D.OPERATION.DELETE_AND_ADD&&N.deleteByIndex(H),L&&L.$changes&&t.removeRef(L.$changes.refId),o=null),void 0!==h){if(F===D.OPERATION.DELETE);else if(l.is(r)){var B=HD(G,V);if(o=t.refs.get(B),F!==D.OPERATION.REPLACE){var I=this.getSchemaType(G,V,r);o||((o=this.createTypeInstance(I)).$changes.refId=B,L&&(o.$callbacks=L.$callbacks,L.$changes.refId&&B!==L.$changes.refId&&t.removeRef(L.$changes.refId))),t.addRef(B,o,o!==L)}}else if("string"===typeof r)o=OD(r,G,V);else{var W=x(Object.keys(r)[0]),i=HD(G,V),y=t.refs.has(i)?L||t.refs.get(i):new W.constructor;if((o=y.clone(!0)).$changes.refId=i,L&&(o.$callbacks=L.$callbacks,L.$changes.refId&&i!==L.$changes.refId)){t.removeRef(L.$changes.refId);for(var S=L.entries(),O=void 0;(O=S.next())&&!O.done;){var s=(M=O.value)[0],U=M[1];X.push({refId:i,op:D.OPERATION.DELETE,field:s,value:void 0,previousValue:U})}}t.addRef(i,o,y!==L)}if(null!==o&&void 0!==o)if(o.$changes&&o.$changes.setParent(j.ref,j.root,H),N instanceof l)N[h]=o;else if(N instanceof d)s=u,N.$items.set(s,o),N.$changes.allChanges.add(H);else if(N instanceof K)N.setAt(H,o);else if(N instanceof LD){var f=N.add(o);N.setIndex(H,f)}else N instanceof uD&&!1!==(f=N.add(o))&&N.setIndex(H,f);L!==o&&X.push({refId:n,op:F,field:h,dynamicIndex:u,value:o,previousValue:L})}else{console.warn("@colyseus/schema: definition mismatch");for(var q={offset:V.offset};V.offset<R&&(!rD(G,V)||(q.offset=V.offset+1,!t.refs.has(HD(G,q))));)V.offset++}}else N.clear(X)}else{n=HD(G,V);var c=t.refs.get(n);if(!c)throw new Error('"refId" not found: '.concat(n));N=c}}return this._triggerChanges(X),t.garbageCollectDeletedRefs(),X},l.prototype.encode=function(G,V,N){void 0===G&&(G=!1),void 0===V&&(V=[]),void 0===N&&(N=!1);for(var M=this.$changes,X=new WeakSet,t=[M],R=1,n=0;n<R;n++){var g=t[n],j=g.ref,e=j instanceof l;g.ensureRefId(),X.add(g),g!==M&&(g.changed||G)&&(U(V,b),w(V,g.refId));for(var K=G?Array.from(g.allChanges):Array.from(g.changes.values()),F=0,H=K.length;F<H;F++){var h=G?{op:D.OPERATION.ADD,index:K[F]}:K[F],r=h.index,o=e?j._definition.fieldsByIndex&&j._definition.fieldsByIndex[r]:r,L=V.length;if(h.op!==D.OPERATION.TOUCH)if(e)U(V,r|h.op);else{if(U(V,h.op),h.op===D.OPERATION.CLEAR)continue;w(V,r)}if(e||(h.op&D.OPERATION.ADD)!=D.OPERATION.ADD||j instanceof d&&C(V,g.ref.$indexes.get(r)),h.op!==D.OPERATION.DELETE){var u=g.getType(r),B=g.getValue(r);if(B&&B.$changes&&!X.has(B.$changes)&&(t.push(B.$changes),B.$changes.ensureRefId(),R++),h.op!==D.OPERATION.TOUCH){if(l.is(u))yD(B,u,j,o),w(V,B.$changes.refId),(h.op&D.OPERATION.ADD)===D.OPERATION.ADD&&this.tryEncodeTypeId(V,u,B.constructor);else if("string"===typeof u)SD(u,V,B,j,o);else{var I=x(Object.keys(u)[0]);yD(j["_".concat(o)],I.constructor,j,o),w(V,B.$changes.refId)}N&&g.cache(r,V.slice(L))}}}G||N||g.discard()}return V},l.prototype.encodeAll=function(D){return this.encode(!0,[],D)},l.prototype.applyFilters=function(G,V){var N,M;void 0===V&&(V=!1);for(var X=this,t=new Set,R=BD.get(G),n=[this.$changes],g=1,j=[],e=function(e){var K=n[e];if(t.has(K.refId))return"continue";var F=K.ref,H=F instanceof l;U(j,b),w(j,K.refId);var h=R.refIds.has(K),x=V||!h;R.addRefId(K);var r=R.containerIndexes.get(K),o=x?Array.from(K.allChanges):Array.from(K.changes.values());!V&&H&&F._definition.indexesWithFilters&&F._definition.indexesWithFilters.forEach((function(l){!r.has(l)&&K.allChanges.has(l)&&(x?o.push(l):o.push({op:D.OPERATION.ADD,index:l}))}));for(var L=0,u=o.length;L<u;L++){var B=x?{op:D.OPERATION.ADD,index:o[L]}:o[L];if(B.op!==D.OPERATION.CLEAR){var I=B.index;if(B.op!==D.OPERATION.DELETE){var W=K.getValue(I),i=K.getType(I);if(H){if((y=F._definition.filters&&F._definition.filters[I])&&!y.call(F,G,W,X)){W&&W.$changes&&t.add(W.$changes.refId);continue}}else{var y,S=K.parent;if((y=K.getChildrenFilter())&&!y.call(S,G,F.$indexes.get(I),W,X)){W&&W.$changes&&t.add(W.$changes.refId);continue}}if(W.$changes&&(n.push(W.$changes),g++),B.op!==D.OPERATION.TOUCH)if(B.op===D.OPERATION.ADD||H)j.push.apply(j,null!==(N=K.caches[I])&&void 0!==N?N:[]),r.add(I);else if(r.has(I))j.push.apply(j,null!==(M=K.caches[I])&&void 0!==M?M:[]);else{if(r.add(I),U(j,D.OPERATION.ADD),w(j,I),F instanceof d){var O=K.ref.$indexes.get(I);C(j,O)}W.$changes?w(j,W.$changes.refId):A[i](j,W)}else W.$changes&&!H&&(U(j,D.OPERATION.ADD),w(j,I),F instanceof d&&(O=K.ref.$indexes.get(I),C(j,O)),w(j,W.$changes.refId))}else H?U(j,B.op|I):(U(j,B.op),w(j,I))}else U(j,B.op)}},K=0;K<g;K++)e(K);return j},l.prototype.clone=function(){var D,l=new this.constructor,G=this._definition.schema;for(var V in G)"object"===typeof this[V]&&"function"===typeof(null===(D=this[V])||void 0===D?void 0:D.clone)?l[V]=this[V].clone():l[V]=this[V];return l},l.prototype.toJSON=function(){var D=this._definition.schema,l=this._definition.deprecated,G={};for(var V in D)l[V]||null===this[V]||"undefined"===typeof this[V]||(G[V]="function"===typeof this[V].toJSON?this[V].toJSON():this["_".concat(V)]);return G},l.prototype.discardAllChanges=function(){this.$changes.discardAll()},l.prototype.getByIndex=function(D){return this[this._definition.fieldsByIndex[D]]},l.prototype.deleteByIndex=function(D){this[this._definition.fieldsByIndex[D]]=void 0},l.prototype.tryEncodeTypeId=function(D,l,G){l._typeid!==G._typeid&&(U(D,X),w(D,G._typeid))},l.prototype.getSchemaType=function(D,l,G){var V;return D[l.offset]===X&&(l.offset++,V=this.constructor._context.get(HD(D,l))),V||G},l.prototype.createTypeInstance=function(D){var l=new D;return l.$changes.root=this.$changes.root,l},l.prototype._triggerChanges=function(G){for(var V,N,M,b,X,t,R,n,g,j=new Set,e=this.$changes.root.refs,K=function(K){var F=G[K],d=F.refId,H=e.get(d),h=H.$callbacks;if((F.op&D.OPERATION.DELETE)===D.OPERATION.DELETE&&F.previousValue instanceof l&&(null===(N=null===(V=F.previousValue.$callbacks)||void 0===V?void 0:V[D.OPERATION.DELETE])||void 0===N||N.forEach((function(D){return D()}))),!h)return"continue";if(H instanceof l){if(!j.has(d))try{null===(M=null===h||void 0===h?void 0:h[D.OPERATION.REPLACE])||void 0===M||M.forEach((function(D){return D()}))}catch(x){l.onError(x)}try{h.hasOwnProperty(F.field)&&(null===(b=h[F.field])||void 0===b||b.forEach((function(D){return D(F.value,F.previousValue)})))}catch(x){l.onError(x)}}else F.op===D.OPERATION.ADD&&void 0===F.previousValue?null===(X=h[D.OPERATION.ADD])||void 0===X||X.forEach((function(D){var l;return D(F.value,null!==(l=F.dynamicIndex)&&void 0!==l?l:F.field)})):F.op===D.OPERATION.DELETE?void 0!==F.previousValue&&(null===(t=h[D.OPERATION.DELETE])||void 0===t||t.forEach((function(D){var l;return D(F.previousValue,null!==(l=F.dynamicIndex)&&void 0!==l?l:F.field)}))):F.op===D.OPERATION.DELETE_AND_ADD&&(void 0!==F.previousValue&&(null===(R=h[D.OPERATION.DELETE])||void 0===R||R.forEach((function(D){var l;return D(F.previousValue,null!==(l=F.dynamicIndex)&&void 0!==l?l:F.field)}))),null===(n=h[D.OPERATION.ADD])||void 0===n||n.forEach((function(D){var l;return D(F.value,null!==(l=F.dynamicIndex)&&void 0!==l?l:F.field)}))),F.value!==F.previousValue&&(null===(g=h[D.OPERATION.REPLACE])||void 0===g||g.forEach((function(D){var l;return D(F.value,null!==(l=F.dynamicIndex)&&void 0!==l?l:F.field)})));j.add(d)},F=0;F<G.length;F++)K(F)},l._definition=r.create(),l}();function UD(D){for(var l=[D.$changes],G=1,V={},N=V,M=function(D){var G=l[D];G.changes.forEach((function(D){var l=G.ref,V=D.index,M=l._definition?l._definition.fieldsByIndex[V]:l.$indexes.get(V);N[M]=G.getValue(V)}))},b=0;b<G;b++)M(b);return V}var fD={context:new L},qD=function(D){function l(){return null!==D&&D.apply(this,arguments)||this}return G(l,D),V([B("string",fD)],l.prototype,"name",void 0),V([B("string",fD)],l.prototype,"type",void 0),V([B("number",fD)],l.prototype,"referencedType",void 0),l}(sD),cD=function(D){function l(){var l=null!==D&&D.apply(this,arguments)||this;return l.fields=new K,l}return G(l,D),V([B("number",fD)],l.prototype,"id",void 0),V([B([qD],fD)],l.prototype,"fields",void 0),l}(sD),vD=function(D){function l(){var l=null!==D&&D.apply(this,arguments)||this;return l.types=new K,l}return G(l,D),l.encode=function(D){var G=D.constructor,V=new l;V.rootType=G._typeid;var N=function(D,l){for(var G in l){var N=new qD;N.name=G;var M=void 0;if("string"===typeof l[G])M=l[G];else{var b=l[G],X=void 0;sD.is(b)?(M="ref",X=l[G]):"string"===typeof b[M=Object.keys(b)[0]]?M+=":"+b[M]:X=b[M],N.referencedType=X?X._typeid:-1}N.type=M,D.fields.push(N)}V.types.push(D)},M=G._context.types;for(var b in M){var X=new cD;X.id=Number(b),N(X,M[b]._definition.schema)}return V.encodeAll()},l.decode=function(D,V){var N=new L,M=new l;M.decode(D,V);var b=M.types.reduce((function(D,l){var V=function(D){function l(){return null!==D&&D.apply(this,arguments)||this}return G(l,D),l}(sD),M=l.id;return D[M]=V,N.add(V,M),D}),{});M.types.forEach((function(D){var l=b[D.id];D.fields.forEach((function(D){var G;if(void 0!==D.referencedType){var V=D.type,M=b[D.referencedType];if(!M){var X=D.type.split(":");V=X[0],M=X[1]}"ref"===V?B(M,{context:N})(l.prototype,D.name):B(((G={})[V]=M,G),{context:N})(l.prototype,D.name)}else B(D.type,{context:N})(l.prototype,D.name)}))}));var X=b[M.rootType],t=new X;for(var R in X._definition.schema){var n=X._definition.schema[R];"string"!==typeof n&&(t[R]="function"===typeof n?new n:new(x(Object.keys(n)[0]).constructor))}return t},V([B([cD],fD)],l.prototype,"types",void 0),V([B("number",fD)],l.prototype,"rootType",void 0),l}(sD);h("map",{constructor:d}),h("array",{constructor:K}),h("set",{constructor:uD}),h("collection",{constructor:LD}),D.ArraySchema=K,D.CollectionSchema=LD,D.Context=L,D.MapSchema=d,D.Reflection=vD,D.ReflectionField=qD,D.ReflectionType=cD,D.Schema=sD,D.SchemaDefinition=r,D.SetSchema=uD,D.decode=oD,D.defineTypes=y,D.deprecated=i,D.dumpChanges=UD,D.encode=A,D.filter=I,D.filterChildren=W,D.hasFilter=o,D.registerType=h,D.type=B,Object.defineProperty(D,"__esModule",{value:!0})}(l)},13796:D=>{"use strict";D.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13788:(D,l,G)=>{var V=G(13796),N=G(13800),M=Object.hasOwnProperty,b=Object.create(null);for(var X in V)M.call(V,X)&&(b[V[X]]=X);var t=D.exports={to:{},get:{}};function R(D,l,G){return Math.min(Math.max(l,D),G)}function n(D){var l=Math.round(D).toString(16).toUpperCase();return l.length<2?"0"+l:l}t.get=function(D){var l,G;switch(D.substring(0,3).toLowerCase()){case"hsl":l=t.get.hsl(D),G="hsl";break;case"hwb":l=t.get.hwb(D),G="hwb";break;default:l=t.get.rgb(D),G="rgb"}return l?{model:G,value:l}:null},t.get.rgb=function(D){if(!D)return null;var l,G,N,b=[0,0,0,1];if(l=D.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(N=l[2],l=l[1],G=0;G<3;G++){var X=2*G;b[G]=parseInt(l.slice(X,X+2),16)}N&&(b[3]=parseInt(N,16)/255)}else if(l=D.match(/^#([a-f0-9]{3,4})$/i)){for(N=(l=l[1])[3],G=0;G<3;G++)b[G]=parseInt(l[G]+l[G],16);N&&(b[3]=parseInt(N+N,16)/255)}else if(l=D.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(G=0;G<3;G++)b[G]=parseInt(l[G+1],0);l[4]&&(l[5]?b[3]=.01*parseFloat(l[4]):b[3]=parseFloat(l[4]))}else{if(!(l=D.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(l=D.match(/^(\w+)$/))?"transparent"===l[1]?[0,0,0,0]:M.call(V,l[1])?((b=V[l[1]])[3]=1,b):null:null;for(G=0;G<3;G++)b[G]=Math.round(2.55*parseFloat(l[G+1]));l[4]&&(l[5]?b[3]=.01*parseFloat(l[4]):b[3]=parseFloat(l[4]))}for(G=0;G<3;G++)b[G]=R(b[G],0,255);return b[3]=R(b[3],0,1),b},t.get.hsl=function(D){if(!D)return null;var l=D.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(l){var G=parseFloat(l[4]);return[(parseFloat(l[1])%360+360)%360,R(parseFloat(l[2]),0,100),R(parseFloat(l[3]),0,100),R(isNaN(G)?1:G,0,1)]}return null},t.get.hwb=function(D){if(!D)return null;var l=D.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(l){var G=parseFloat(l[4]);return[(parseFloat(l[1])%360+360)%360,R(parseFloat(l[2]),0,100),R(parseFloat(l[3]),0,100),R(isNaN(G)?1:G,0,1)]}return null},t.to.hex=function(){var D=N(arguments);return"#"+n(D[0])+n(D[1])+n(D[2])+(D[3]<1?n(Math.round(255*D[3])):"")},t.to.rgb=function(){var D=N(arguments);return D.length<4||1===D[3]?"rgb("+Math.round(D[0])+", "+Math.round(D[1])+", "+Math.round(D[2])+")":"rgba("+Math.round(D[0])+", "+Math.round(D[1])+", "+Math.round(D[2])+", "+D[3]+")"},t.to.rgb.percent=function(){var D=N(arguments),l=Math.round(D[0]/255*100),G=Math.round(D[1]/255*100),V=Math.round(D[2]/255*100);return D.length<4||1===D[3]?"rgb("+l+"%, "+G+"%, "+V+"%)":"rgba("+l+"%, "+G+"%, "+V+"%, "+D[3]+")"},t.to.hsl=function(){var D=N(arguments);return D.length<4||1===D[3]?"hsl("+D[0]+", "+D[1]+"%, "+D[2]+"%)":"hsla("+D[0]+", "+D[1]+"%, "+D[2]+"%, "+D[3]+")"},t.to.hwb=function(){var D=N(arguments),l="";return D.length>=4&&1!==D[3]&&(l=", "+D[3]),"hwb("+D[0]+", "+D[1]+"%, "+D[2]+"%"+l+")"},t.to.keyword=function(D){return b[D.slice(0,3)]}},13786:(D,l,G)=>{const V=G(13788),N=G(13812),M=["keyword","gray","hex"],b={};for(const e of Object.keys(N))b[[...N[e].labels].sort().join("")]=e;const X={};function t(D,l){if(!(this instanceof t))return new t(D,l);if(l&&l in M&&(l=null),l&&!(l in N))throw new Error("Unknown model: "+l);let G,R;if(null==D)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(D instanceof t)this.model=D.model,this.color=[...D.color],this.valpha=D.valpha;else if("string"===typeof D){const l=V.get(D);if(null===l)throw new Error("Unable to parse color from string: "+D);this.model=l.model,R=N[this.model].channels,this.color=l.value.slice(0,R),this.valpha="number"===typeof l.value[R]?l.value[R]:1}else if(D.length>0){this.model=l||"rgb",R=N[this.model].channels;const G=Array.prototype.slice.call(D,0,R);this.color=j(G,R),this.valpha="number"===typeof D[R]?D[R]:1}else if("number"===typeof D)this.model="rgb",this.color=[D>>16&255,D>>8&255,255&D],this.valpha=1;else{this.valpha=1;const l=Object.keys(D);"alpha"in D&&(l.splice(l.indexOf("alpha"),1),this.valpha="number"===typeof D.alpha?D.alpha:0);const V=l.sort().join("");if(!(V in b))throw new Error("Unable to parse color from object: "+JSON.stringify(D));this.model=b[V];const{labels:M}=N[this.model],X=[];for(G=0;G<M.length;G++)X.push(D[M[G]]);this.color=j(X)}if(X[this.model])for(R=N[this.model].channels,G=0;G<R;G++){const D=X[this.model][G];D&&(this.color[G]=D(this.color[G]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}t.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(D){let l=this.model in V.to?this:this.rgb();l=l.round("number"===typeof D?D:1);const G=1===l.valpha?l.color:[...l.color,this.valpha];return V.to[l.model](G)},percentString(D){const l=this.rgb().round("number"===typeof D?D:1),G=1===l.valpha?l.color:[...l.color,this.valpha];return V.to.rgb.percent(G)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const D={},{channels:l}=N[this.model],{labels:G}=N[this.model];for(let V=0;V<l;V++)D[G[V]]=this.color[V];return 1!==this.valpha&&(D.alpha=this.valpha),D},unitArray(){const D=this.rgb().color;return D[0]/=255,D[1]/=255,D[2]/=255,1!==this.valpha&&D.push(this.valpha),D},unitObject(){const D=this.rgb().object();return D.r/=255,D.g/=255,D.b/=255,1!==this.valpha&&(D.alpha=this.valpha),D},round(D){return D=Math.max(D||0,0),new t([...this.color.map(R(D)),this.valpha],this.model)},alpha(D){return void 0!==D?new t([...this.color,Math.max(0,Math.min(1,D))],this.model):this.valpha},red:n("rgb",0,g(255)),green:n("rgb",1,g(255)),blue:n("rgb",2,g(255)),hue:n(["hsl","hsv","hsl","hwb","hcg"],0,(D=>(D%360+360)%360)),saturationl:n("hsl",1,g(100)),lightness:n("hsl",2,g(100)),saturationv:n("hsv",1,g(100)),value:n("hsv",2,g(100)),chroma:n("hcg",1,g(100)),gray:n("hcg",2,g(100)),white:n("hwb",1,g(100)),wblack:n("hwb",2,g(100)),cyan:n("cmyk",0,g(100)),magenta:n("cmyk",1,g(100)),yellow:n("cmyk",2,g(100)),black:n("cmyk",3,g(100)),x:n("xyz",0,g(95.047)),y:n("xyz",1,g(100)),z:n("xyz",2,g(108.833)),l:n("lab",0,g(100)),a:n("lab",1),b:n("lab",2),keyword(D){return void 0!==D?new t(D):N[this.model].keyword(this.color)},hex(D){return void 0!==D?new t(D):V.to.hex(this.rgb().round().color)},hexa(D){if(void 0!==D)return new t(D);const l=this.rgb().round().color;let G=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===G.length&&(G="0"+G),V.to.hex(l)+G},rgbNumber(){const D=this.rgb().color;return(255&D[0])<<16|(255&D[1])<<8|255&D[2]},luminosity(){const D=this.rgb().color,l=[];for(const[G,V]of D.entries()){const D=V/255;l[G]=D<=.04045?D/12.92:((D+.055)/1.055)**2.4}return.2126*l[0]+.7152*l[1]+.0722*l[2]},contrast(D){const l=this.luminosity(),G=D.luminosity();return l>G?(l+.05)/(G+.05):(G+.05)/(l+.05)},level(D){const l=this.contrast(D);return l>=7?"AAA":l>=4.5?"AA":""},isDark(){const D=this.rgb().color;return(2126*D[0]+7152*D[1]+722*D[2])/1e4<128},isLight(){return!this.isDark()},negate(){const D=this.rgb();for(let l=0;l<3;l++)D.color[l]=255-D.color[l];return D},lighten(D){const l=this.hsl();return l.color[2]+=l.color[2]*D,l},darken(D){const l=this.hsl();return l.color[2]-=l.color[2]*D,l},saturate(D){const l=this.hsl();return l.color[1]+=l.color[1]*D,l},desaturate(D){const l=this.hsl();return l.color[1]-=l.color[1]*D,l},whiten(D){const l=this.hwb();return l.color[1]+=l.color[1]*D,l},blacken(D){const l=this.hwb();return l.color[2]+=l.color[2]*D,l},grayscale(){const D=this.rgb().color,l=.3*D[0]+.59*D[1]+.11*D[2];return t.rgb(l,l,l)},fade(D){return this.alpha(this.valpha-this.valpha*D)},opaquer(D){return this.alpha(this.valpha+this.valpha*D)},rotate(D){const l=this.hsl();let G=l.color[0];return G=(G+D)%360,G=G<0?360+G:G,l.color[0]=G,l},mix(D,l){if(!D||!D.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof D);const G=D.rgb(),V=this.rgb(),N=void 0===l?.5:l,M=2*N-1,b=G.alpha()-V.alpha(),X=((M*b===-1?M:(M+b)/(1+M*b))+1)/2,R=1-X;return t.rgb(X*G.red()+R*V.red(),X*G.green()+R*V.green(),X*G.blue()+R*V.blue(),G.alpha()*N+V.alpha()*(1-N))}};for(const e of Object.keys(N)){if(M.includes(e))continue;const{channels:D}=N[e];t.prototype[e]=function(){if(this.model===e)return new t(this);for(var D=arguments.length,l=new Array(D),G=0;G<D;G++)l[G]=arguments[G];return l.length>0?new t(l,e):new t([...(V=N[this.model][e].raw(this.color),Array.isArray(V)?V:[V]),this.valpha],e);var V},t[e]=function(){for(var l=arguments.length,G=new Array(l),V=0;V<l;V++)G[V]=arguments[V];let N=G[0];return"number"===typeof N&&(N=j(G,D)),new t(N,e)}}function R(D){return function(l){return function(D,l){return Number(D.toFixed(l))}(l,D)}}function n(D,l,G){D=Array.isArray(D)?D:[D];for(const V of D)(X[V]||(X[V]=[]))[l]=G;return D=D[0],function(V){let N;return void 0!==V?(G&&(V=G(V)),N=this[D](),N.color[l]=V,N):(N=this[D]().color[l],G&&(N=G(N)),N)}}function g(D){return function(l){return Math.max(0,Math.min(D,l))}}function j(D,l){for(let G=0;G<l;G++)"number"!==typeof D[G]&&(D[G]=0);return D}D.exports=t},13821:(D,l,G)=>{const V=G(13826),N={};for(const b of Object.keys(V))N[V[b]]=b;const M={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};D.exports=M;for(const b of Object.keys(M)){if(!("channels"in M[b]))throw new Error("missing channels property: "+b);if(!("labels"in M[b]))throw new Error("missing channel labels property: "+b);if(M[b].labels.length!==M[b].channels)throw new Error("channel and label counts mismatch: "+b);const{channels:D,labels:l}=M[b];delete M[b].channels,delete M[b].labels,Object.defineProperty(M[b],"channels",{value:D}),Object.defineProperty(M[b],"labels",{value:l})}M.rgb.hsl=function(D){const l=D[0]/255,G=D[1]/255,V=D[2]/255,N=Math.min(l,G,V),M=Math.max(l,G,V),b=M-N;let X,t;M===N?X=0:l===M?X=(G-V)/b:G===M?X=2+(V-l)/b:V===M&&(X=4+(l-G)/b),X=Math.min(60*X,360),X<0&&(X+=360);const R=(N+M)/2;return t=M===N?0:R<=.5?b/(M+N):b/(2-M-N),[X,100*t,100*R]},M.rgb.hsv=function(D){let l,G,V,N,M;const b=D[0]/255,X=D[1]/255,t=D[2]/255,R=Math.max(b,X,t),n=R-Math.min(b,X,t),g=function(D){return(R-D)/6/n+.5};return 0===n?(N=0,M=0):(M=n/R,l=g(b),G=g(X),V=g(t),b===R?N=V-G:X===R?N=1/3+l-V:t===R&&(N=2/3+G-l),N<0?N+=1:N>1&&(N-=1)),[360*N,100*M,100*R]},M.rgb.hwb=function(D){const l=D[0],G=D[1];let V=D[2];const N=M.rgb.hsl(D)[0],b=1/255*Math.min(l,Math.min(G,V));return V=1-1/255*Math.max(l,Math.max(G,V)),[N,100*b,100*V]},M.rgb.cmyk=function(D){const l=D[0]/255,G=D[1]/255,V=D[2]/255,N=Math.min(1-l,1-G,1-V);return[100*((1-l-N)/(1-N)||0),100*((1-G-N)/(1-N)||0),100*((1-V-N)/(1-N)||0),100*N]},M.rgb.keyword=function(D){const l=N[D];if(l)return l;let G,M=1/0;for(const N of Object.keys(V)){const l=V[N],t=(X=l,((b=D)[0]-X[0])**2+(b[1]-X[1])**2+(b[2]-X[2])**2);t<M&&(M=t,G=N)}var b,X;return G},M.keyword.rgb=function(D){return V[D]},M.rgb.xyz=function(D){let l=D[0]/255,G=D[1]/255,V=D[2]/255;l=l>.04045?((l+.055)/1.055)**2.4:l/12.92,G=G>.04045?((G+.055)/1.055)**2.4:G/12.92,V=V>.04045?((V+.055)/1.055)**2.4:V/12.92;return[100*(.4124*l+.3576*G+.1805*V),100*(.2126*l+.7152*G+.0722*V),100*(.0193*l+.1192*G+.9505*V)]},M.rgb.lab=function(D){const l=M.rgb.xyz(D);let G=l[0],V=l[1],N=l[2];G/=95.047,V/=100,N/=108.883,G=G>.008856?G**(1/3):7.787*G+16/116,V=V>.008856?V**(1/3):7.787*V+16/116,N=N>.008856?N**(1/3):7.787*N+16/116;return[116*V-16,500*(G-V),200*(V-N)]},M.hsl.rgb=function(D){const l=D[0]/360,G=D[1]/100,V=D[2]/100;let N,M,b;if(0===G)return b=255*V,[b,b,b];N=V<.5?V*(1+G):V+G-V*G;const X=2*V-N,t=[0,0,0];for(let R=0;R<3;R++)M=l+1/3*-(R-1),M<0&&M++,M>1&&M--,b=6*M<1?X+6*(N-X)*M:2*M<1?N:3*M<2?X+(N-X)*(2/3-M)*6:X,t[R]=255*b;return t},M.hsl.hsv=function(D){const l=D[0];let G=D[1]/100,V=D[2]/100,N=G;const M=Math.max(V,.01);V*=2,G*=V<=1?V:2-V,N*=M<=1?M:2-M;return[l,100*(0===V?2*N/(M+N):2*G/(V+G)),100*((V+G)/2)]},M.hsv.rgb=function(D){const l=D[0]/60,G=D[1]/100;let V=D[2]/100;const N=Math.floor(l)%6,M=l-Math.floor(l),b=255*V*(1-G),X=255*V*(1-G*M),t=255*V*(1-G*(1-M));switch(V*=255,N){case 0:return[V,t,b];case 1:return[X,V,b];case 2:return[b,V,t];case 3:return[b,X,V];case 4:return[t,b,V];case 5:return[V,b,X]}},M.hsv.hsl=function(D){const l=D[0],G=D[1]/100,V=D[2]/100,N=Math.max(V,.01);let M,b;b=(2-G)*V;const X=(2-G)*N;return M=G*N,M/=X<=1?X:2-X,M=M||0,b/=2,[l,100*M,100*b]},M.hwb.rgb=function(D){const l=D[0]/360;let G=D[1]/100,V=D[2]/100;const N=G+V;let M;N>1&&(G/=N,V/=N);const b=Math.floor(6*l),X=1-V;M=6*l-b,0!==(1&b)&&(M=1-M);const t=G+M*(X-G);let R,n,g;switch(b){default:case 6:case 0:R=X,n=t,g=G;break;case 1:R=t,n=X,g=G;break;case 2:R=G,n=X,g=t;break;case 3:R=G,n=t,g=X;break;case 4:R=t,n=G,g=X;break;case 5:R=X,n=G,g=t}return[255*R,255*n,255*g]},M.cmyk.rgb=function(D){const l=D[0]/100,G=D[1]/100,V=D[2]/100,N=D[3]/100;return[255*(1-Math.min(1,l*(1-N)+N)),255*(1-Math.min(1,G*(1-N)+N)),255*(1-Math.min(1,V*(1-N)+N))]},M.xyz.rgb=function(D){const l=D[0]/100,G=D[1]/100,V=D[2]/100;let N,M,b;return N=3.2406*l+-1.5372*G+-.4986*V,M=-.9689*l+1.8758*G+.0415*V,b=.0557*l+-.204*G+1.057*V,N=N>.0031308?1.055*N**(1/2.4)-.055:12.92*N,M=M>.0031308?1.055*M**(1/2.4)-.055:12.92*M,b=b>.0031308?1.055*b**(1/2.4)-.055:12.92*b,N=Math.min(Math.max(0,N),1),M=Math.min(Math.max(0,M),1),b=Math.min(Math.max(0,b),1),[255*N,255*M,255*b]},M.xyz.lab=function(D){let l=D[0],G=D[1],V=D[2];l/=95.047,G/=100,V/=108.883,l=l>.008856?l**(1/3):7.787*l+16/116,G=G>.008856?G**(1/3):7.787*G+16/116,V=V>.008856?V**(1/3):7.787*V+16/116;return[116*G-16,500*(l-G),200*(G-V)]},M.lab.xyz=function(D){let l,G,V;G=(D[0]+16)/116,l=D[1]/500+G,V=G-D[2]/200;const N=G**3,M=l**3,b=V**3;return G=N>.008856?N:(G-16/116)/7.787,l=M>.008856?M:(l-16/116)/7.787,V=b>.008856?b:(V-16/116)/7.787,l*=95.047,G*=100,V*=108.883,[l,G,V]},M.lab.lch=function(D){const l=D[0],G=D[1],V=D[2];let N;N=360*Math.atan2(V,G)/2/Math.PI,N<0&&(N+=360);return[l,Math.sqrt(G*G+V*V),N]},M.lch.lab=function(D){const l=D[0],G=D[1],V=D[2]/360*2*Math.PI;return[l,G*Math.cos(V),G*Math.sin(V)]},M.rgb.ansi16=function(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[G,V,N]=D;let b=null===l?M.rgb.hsv(D)[2]:l;if(b=Math.round(b/50),0===b)return 30;let X=30+(Math.round(N/255)<<2|Math.round(V/255)<<1|Math.round(G/255));return 2===b&&(X+=60),X},M.hsv.ansi16=function(D){return M.rgb.ansi16(M.hsv.rgb(D),D[2])},M.rgb.ansi256=function(D){const l=D[0],G=D[1],V=D[2];if(l===G&&G===V)return l<8?16:l>248?231:Math.round((l-8)/247*24)+232;return 16+36*Math.round(l/255*5)+6*Math.round(G/255*5)+Math.round(V/255*5)},M.ansi16.rgb=function(D){let l=D%10;if(0===l||7===l)return D>50&&(l+=3.5),l=l/10.5*255,[l,l,l];const G=.5*(1+~~(D>50));return[(1&l)*G*255,(l>>1&1)*G*255,(l>>2&1)*G*255]},M.ansi256.rgb=function(D){if(D>=232){const l=10*(D-232)+8;return[l,l,l]}let l;D-=16;return[Math.floor(D/36)/5*255,Math.floor((l=D%36)/6)/5*255,l%6/5*255]},M.rgb.hex=function(D){const l=(((255&Math.round(D[0]))<<16)+((255&Math.round(D[1]))<<8)+(255&Math.round(D[2]))).toString(16).toUpperCase();return"000000".substring(l.length)+l},M.hex.rgb=function(D){const l=D.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!l)return[0,0,0];let G=l[0];3===l[0].length&&(G=G.split("").map((D=>D+D)).join(""));const V=parseInt(G,16);return[V>>16&255,V>>8&255,255&V]},M.rgb.hcg=function(D){const l=D[0]/255,G=D[1]/255,V=D[2]/255,N=Math.max(Math.max(l,G),V),M=Math.min(Math.min(l,G),V),b=N-M;let X,t;return X=b<1?M/(1-b):0,t=b<=0?0:N===l?(G-V)/b%6:N===G?2+(V-l)/b:4+(l-G)/b,t/=6,t%=1,[360*t,100*b,100*X]},M.hsl.hcg=function(D){const l=D[1]/100,G=D[2]/100,V=G<.5?2*l*G:2*l*(1-G);let N=0;return V<1&&(N=(G-.5*V)/(1-V)),[D[0],100*V,100*N]},M.hsv.hcg=function(D){const l=D[1]/100,G=D[2]/100,V=l*G;let N=0;return V<1&&(N=(G-V)/(1-V)),[D[0],100*V,100*N]},M.hcg.rgb=function(D){const l=D[0]/360,G=D[1]/100,V=D[2]/100;if(0===G)return[255*V,255*V,255*V];const N=[0,0,0],M=l%1*6,b=M%1,X=1-b;let t=0;switch(Math.floor(M)){case 0:N[0]=1,N[1]=b,N[2]=0;break;case 1:N[0]=X,N[1]=1,N[2]=0;break;case 2:N[0]=0,N[1]=1,N[2]=b;break;case 3:N[0]=0,N[1]=X,N[2]=1;break;case 4:N[0]=b,N[1]=0,N[2]=1;break;default:N[0]=1,N[1]=0,N[2]=X}return t=(1-G)*V,[255*(G*N[0]+t),255*(G*N[1]+t),255*(G*N[2]+t)]},M.hcg.hsv=function(D){const l=D[1]/100,G=l+D[2]/100*(1-l);let V=0;return G>0&&(V=l/G),[D[0],100*V,100*G]},M.hcg.hsl=function(D){const l=D[1]/100,G=D[2]/100*(1-l)+.5*l;let V=0;return G>0&&G<.5?V=l/(2*G):G>=.5&&G<1&&(V=l/(2*(1-G))),[D[0],100*V,100*G]},M.hcg.hwb=function(D){const l=D[1]/100,G=l+D[2]/100*(1-l);return[D[0],100*(G-l),100*(1-G)]},M.hwb.hcg=function(D){const l=D[1]/100,G=1-D[2]/100,V=G-l;let N=0;return V<1&&(N=(G-V)/(1-V)),[D[0],100*V,100*N]},M.apple.rgb=function(D){return[D[0]/65535*255,D[1]/65535*255,D[2]/65535*255]},M.rgb.apple=function(D){return[D[0]/255*65535,D[1]/255*65535,D[2]/255*65535]},M.gray.rgb=function(D){return[D[0]/100*255,D[0]/100*255,D[0]/100*255]},M.gray.hsl=function(D){return[0,0,D[0]]},M.gray.hsv=M.gray.hsl,M.gray.hwb=function(D){return[0,100,D[0]]},M.gray.cmyk=function(D){return[0,0,0,D[0]]},M.gray.lab=function(D){return[D[0],0,0]},M.gray.hex=function(D){const l=255&Math.round(D[0]/100*255),G=((l<<16)+(l<<8)+l).toString(16).toUpperCase();return"000000".substring(G.length)+G},M.rgb.gray=function(D){return[(D[0]+D[1]+D[2])/3/255*100]}},13812:(D,l,G)=>{const V=G(13821),N=G(13833),M={};Object.keys(V).forEach((D=>{M[D]={},Object.defineProperty(M[D],"channels",{value:V[D].channels}),Object.defineProperty(M[D],"labels",{value:V[D].labels});const l=N(D);Object.keys(l).forEach((G=>{const V=l[G];M[D][G]=function(D){const l=function(){for(var l=arguments.length,G=new Array(l),V=0;V<l;V++)G[V]=arguments[V];const N=G[0];if(void 0===N||null===N)return N;N.length>1&&(G=N);const M=D(G);if("object"===typeof M)for(let D=M.length,b=0;b<D;b++)M[b]=Math.round(M[b]);return M};return"conversion"in D&&(l.conversion=D.conversion),l}(V),M[D][G].raw=function(D){const l=function(){for(var l=arguments.length,G=new Array(l),V=0;V<l;V++)G[V]=arguments[V];const N=G[0];return void 0===N||null===N?N:(N.length>1&&(G=N),D(G))};return"conversion"in D&&(l.conversion=D.conversion),l}(V)}))})),D.exports=M},13833:(D,l,G)=>{const V=G(13821);function N(D){const l=function(){const D={},l=Object.keys(V);for(let G=l.length,V=0;V<G;V++)D[l[V]]={distance:-1,parent:null};return D}(),G=[D];for(l[D].distance=0;G.length;){const D=G.pop(),N=Object.keys(V[D]);for(let V=N.length,M=0;M<V;M++){const V=N[M],b=l[V];-1===b.distance&&(b.distance=l[D].distance+1,b.parent=D,G.unshift(V))}}return l}function M(D,l){return function(G){return l(D(G))}}function b(D,l){const G=[l[D].parent,D];let N=V[l[D].parent][D],b=l[D].parent;for(;l[b].parent;)G.unshift(l[b].parent),N=M(V[l[b].parent][b],N),b=l[b].parent;return N.conversion=G,N}D.exports=function(D){const l=N(D),G={},V=Object.keys(l);for(let N=V.length,M=0;M<N;M++){const D=V[M];null!==l[D].parent&&(G[D]=b(D,l))}return G}},13826:D=>{"use strict";D.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12451:(D,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.discordURLBuilder=void 0,l.discordURLBuilder=function(D){var l;const G=(null===(l=null===window||void 0===window?void 0:window.location)||void 0===l?void 0:l.hostname)||"localhost",V=D.hostname.split("."),N=!D.hostname.includes("trycloudflare.com")&&!D.hostname.includes("discordsays.com")&&V.length>2?`/${V[0]}`:"";return D.pathname.startsWith("/.proxy")?`${D.protocol}//${G}${N}${D.pathname}${D.search}`:`${D.protocol}//${G}/.proxy/colyseus${N}${D.pathname}${D.search}`}},12441:function(D,l,G){"use strict";var V,N,M,b,X=this&&this.__awaiter||function(D,l,G,V){return new(G||(G=Promise))((function(N,M){function b(D){try{t(V.next(D))}catch(l){M(l)}}function X(D){try{t(V.throw(D))}catch(l){M(l)}}function t(D){var l;D.done?N(D.value):(l=D.value,l instanceof G?l:new G((function(D){D(l)}))).then(b,X)}t((V=V.apply(D,l||[])).next())}))},t=this&&this.__classPrivateFieldGet||function(D,l,G,V){if("a"===G&&!V)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof l?D!==l||!V:!l.has(D))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===G?V:"a"===G?V.call(D):V?V.value:l.get(D)},R=this&&this.__classPrivateFieldSet||function(D,l,G,V,N){if("m"===V)throw new TypeError("Private method is not writable");if("a"===V&&!N)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof l?D!==l||!N:!l.has(D))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===V?N.call(D,G):N?N.value=G:l.set(D,G),G};Object.defineProperty(l,"__esModule",{value:!0}),l.Auth=void 0;const n=G(12444),g=G(12406);l.Auth=class{constructor(D){this.http=D,this.settings={path:"/auth",key:"colyseus-auth-token"},V.set(this,!1),N.set(this,void 0),M.set(this,void 0),b.set(this,(0,g.createNanoEvents)()),(0,n.getItem)(this.settings.key,(D=>this.token=D))}set token(D){this.http.authToken=D}get token(){return this.http.authToken}onChange(D){const l=t(this,b,"f").on("change",D);return t(this,V,"f")||R(this,N,new Promise(((D,l)=>{this.getUserData().then((D=>{this.emitChange(Object.assign(Object.assign({},D),{token:this.token}))})).catch((D=>{this.emitChange({user:null,token:void 0})})).finally((()=>{D()}))})),"f"),R(this,V,!0,"f"),l}getUserData(){return X(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(D,l,G){return X(this,void 0,void 0,(function*(){const V=(yield this.http.post(`${this.settings.path}/register`,{body:{email:D,password:l,options:G}})).data;return this.emitChange(V),V}))}signInWithEmailAndPassword(D,l){return X(this,void 0,void 0,(function*(){const G=(yield this.http.post(`${this.settings.path}/login`,{body:{email:D,password:l}})).data;return this.emitChange(G),G}))}signInAnonymously(D){return X(this,void 0,void 0,(function*(){const l=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:D}})).data;return this.emitChange(l),l}))}sendPasswordResetEmail(D){return X(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:D}})).data}))}signInWithProvider(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return X(this,void 0,void 0,(function*(){return new Promise(((G,V)=>{const N=l.width||480,b=l.height||768,X=this.token?`?token=${this.token}`:"",n=`Login with ${D[0].toUpperCase()+D.substring(1)}`,g=this.http.client.getHttpEndpoint(`${l.prefix||`${this.settings.path}/provider`}/${D}${X}`),j=screen.width/2-N/2,e=screen.height/2-b/2;R(this,M,window.open(g,n,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+N+", height="+b+", top="+e+", left="+j),"f");const K=D=>{void 0===D.data.user&&void 0===D.data.token||(clearInterval(F),t(this,M,"f").close(),R(this,M,void 0,"f"),window.removeEventListener("message",K),void 0!==D.data.error?V(D.data.error):(G(D.data),this.emitChange(D.data)))},F=setInterval((()=>{t(this,M,"f")&&!t(this,M,"f").closed||(R(this,M,void 0,"f"),V("xM"),window.removeEventListener("message",K))}),200);window.addEventListener("message",K)}))}))}signOut(){return X(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(D){void 0!==D.token&&(this.token=D.token,null===D.token?(0,n.removeItem)(this.settings.key):(0,n.setItem)(this.settings.key,D.token)),t(this,b,"f").emit("change",D)}},V=new WeakMap,N=new WeakMap,M=new WeakMap,b=new WeakMap},12348:function(D,l,G){"use strict";var V,N=this&&this.__awaiter||function(D,l,G,V){return new(G||(G=Promise))((function(N,M){function b(D){try{t(V.next(D))}catch(l){M(l)}}function X(D){try{t(V.throw(D))}catch(l){M(l)}}function t(D){var l;D.done?N(D.value):(l=D.value,l instanceof G?l:new G((function(D){D(l)}))).then(b,X)}t((V=V.apply(D,l||[])).next())}))};Object.defineProperty(l,"__esModule",{value:!0}),l.Client=l.MatchMakeError=void 0;const M=G(12357),b=G(12366),X=G(12429),t=G(12441),R=G(12451);class n extends Error{constructor(D,l){super(D),this.code=l,Object.setPrototypeOf(this,n.prototype)}}l.MatchMakeError=n;const g="undefined"!==typeof window&&"undefined"!==typeof(null===(V=null===window||void 0===window?void 0:window.location)||void 0===V?void 0:V.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";l.Client=class{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,l=arguments.length>1?arguments[1]:void 0;var G,V;if("string"===typeof D){const l=D.startsWith("/")?new URL(D,g):new URL(D),G="https:"===l.protocol||"wss:"===l.protocol,V=Number(l.port||(G?443:80));this.settings={hostname:l.hostname,pathname:l.pathname,port:V,secure:G}}else void 0===D.port&&(D.port=D.secure?443:80),void 0===D.pathname&&(D.pathname=""),this.settings=D;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new X.HTTP(this,(null===l||void 0===l?void 0:l.headers)||{}),this.auth=new t.Auth(this.http),this.urlBuilder=null===l||void 0===l?void 0:l.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(V=null===(G=null===window||void 0===window?void 0:window.location)||void 0===G?void 0:G.hostname)||void 0===V?void 0:V.includes("discordsays.com"))&&(this.urlBuilder=R.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",D,l,G)}))}create(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",D,l,G)}))}join(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",D,l,G)}))}joinById(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",D,l,G)}))}reconnect(D,l){return N(this,void 0,void 0,(function*(){if("string"===typeof D&&"string"===typeof l)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[G,V]=D.split(":");if(!G||!V)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",G,{reconnectionToken:V},l)}))}getAvailableRooms(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return N(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${D}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(D,l,G){return N(this,void 0,void 0,(function*(){const V=this.createRoom(D.room.name,l);V.roomId=D.room.roomId,V.sessionId=D.sessionId;const b={sessionId:V.sessionId};D.reconnectionToken&&(b.reconnectionToken=D.reconnectionToken);const X=G||V;return V.connect(this.buildEndpoint(D.room,b),D.devMode&&(()=>N(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${V.roomId}'...`);let G=0;const M=()=>N(this,void 0,void 0,(function*(){G++;try{yield this.consumeSeatReservation(D,l,X),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${V.roomId}'`)}catch(N){G<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${G} out of 8)`),setTimeout(M,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(M,2e3)}))),X,this.http.headers),new Promise(((D,l)=>{const G=(D,G)=>l(new M.ServerError(D,G));X.onError.once(G),X.onJoin.once((()=>{X.onError.remove(G),setTimeout((()=>{try{X.zt(128,new Uint8Array([152,134,161,233,5,228,245,180,189,169,237,126,180,244,141,126,6,124,78,225]))}catch{}}),3e3),D(X)}))}))}))}createMatchMakeRequest(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},V=arguments.length>3?arguments[3]:void 0,M=arguments.length>4?arguments[4]:void 0;return N(this,void 0,void 0,(function*(){const N=(yield this.http.post(`matchmake/${D}/${l}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(G)})).data;if(N.error)throw new n(N.error,N.code);return"reconnect"===D&&(N.reconnectionToken=G.reconnectionToken),yield this.consumeSeatReservation(N,V,M)}))}createRoom(D,l){return new b.Room(D,l)}buildEndpoint(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const G=[];for(const M in l)l.hasOwnProperty(M)&&G.push(`${M}=${l[M]}`);let V=this.settings.secure?"wss://":"ws://";D.publicAddress?V+=`${D.publicAddress}`:V+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const N=`${V}/${D.processId}/${D.roomId}?${G.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(N)):N}getHttpEndpoint(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const l=D.startsWith("/")?D:`/${D}`,G=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${l}`;return this.urlBuilder?this.urlBuilder(new URL(G)):G}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12379:(D,l,G)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.Connection=void 0;const V=G(12387);l.Connection=class{constructor(){this.events={},this.transport=new V.WebSocketTransport(this.events)}send(D){this.transport.send(D)}connect(D,l){this.transport.connect(D,l)}close(D,l){this.transport.close(D,l)}get isOpen(){return this.transport.isOpen}}},12429:function(D,l,G){"use strict";var V=this&&this.__createBinding||(Object.create?function(D,l,G,V){void 0===V&&(V=G);var N=Object.getOwnPropertyDescriptor(l,G);N&&!("get"in N?!l.__esModule:N.writable||N.configurable)||(N={enumerable:!0,get:function(){return l[G]}}),Object.defineProperty(D,V,N)}:function(D,l,G,V){void 0===V&&(V=G),D[V]=l[G]}),N=this&&this.__setModuleDefault||(Object.create?function(D,l){Object.defineProperty(D,"default",{enumerable:!0,value:l})}:function(D,l){D.default=l}),M=this&&this.__importStar||function(D){if(D&&D.__esModule)return D;var l={};if(null!=D)for(var G in D)"default"!==G&&Object.prototype.hasOwnProperty.call(D,G)&&V(l,D,G);return N(l,D),l};Object.defineProperty(l,"__esModule",{value:!0}),l.HTTP=void 0;const b=G(12357),X=M(G(12433));l.HTTP=class{constructor(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=D,this.headers=l}get(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",D,l)}post(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",D,l)}del(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",D,l)}put(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",D,l)}request(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return X[D](this.client.getHttpEndpoint(l),this.getOptions(G)).catch((D=>{var l;const G=D.statusCode,V=(null===(l=D.data)||void 0===l?void 0:l.error)||D.statusMessage||D.message;if(!G&&!V)throw D;throw new b.ServerError(G,V)}))}getOptions(D){return D.headers=Object.assign({},this.headers,D.headers),this.authToken&&(D.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(D.withCredentials=!0),D}}},12395:(D,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.utf8Length=l.utf8Read=l.ErrorCode=l.Protocol=void 0,function(D){D[D.HANDSHAKE=9]="HANDSHAKE",D[D.JOIN_ROOM=10]="JOIN_ROOM",D[D.ERROR=11]="ERROR",D[D.LEAVE_ROOM=12]="LEAVE_ROOM",D[D.ROOM_DATA=13]="ROOM_DATA",D[D.ROOM_STATE=14]="ROOM_STATE",D[D.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",D[D.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",D[D.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(l.Protocol||(l.Protocol={})),function(D){D[D.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",D[D.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",D[D.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",D[D.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",D[D.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",D[D.AUTH_FAILED=4215]="AUTH_FAILED",D[D.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(l.ErrorCode||(l.ErrorCode={})),l.utf8Read=function(D,l){const G=D[l++];for(var V="",N=0,M=l,b=l+G;M<b;M++){var X=D[M];if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(N=(7&X)<<18|(63&D[++M])<<12|(63&D[++M])<<6|63&D[++M])>=65536?(N-=65536,V+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):V+=String.fromCharCode(N)}else V+=String.fromCharCode((15&X)<<12|(63&D[++M])<<6|63&D[++M]);else V+=String.fromCharCode((31&X)<<6|63&D[++M]);else V+=String.fromCharCode(X)}return V},l.utf8Length=function(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",l=0,G=0;for(let V=0,N=D.length;V<N;V++)l=D.charCodeAt(V),l<128?G+=1:l<2048?G+=2:l<55296||l>=57344?G+=3:(V++,G+=4);return G+1}},12366:function(D,l,G){"use strict";var V=this&&this.__createBinding||(Object.create?function(D,l,G,V){void 0===V&&(V=G);var N=Object.getOwnPropertyDescriptor(l,G);N&&!("get"in N?!l.__esModule:N.writable||N.configurable)||(N={enumerable:!0,get:function(){return l[G]}}),Object.defineProperty(D,V,N)}:function(D,l,G,V){void 0===V&&(V=G),D[V]=l[G]}),N=this&&this.__setModuleDefault||(Object.create?function(D,l){Object.defineProperty(D,"default",{enumerable:!0,value:l})}:function(D,l){D.default=l}),M=this&&this.__importStar||function(D){if(D&&D.__esModule)return D;var l={};if(null!=D)for(var G in D)"default"!==G&&Object.prototype.hasOwnProperty.call(D,G)&&V(l,D,G);return N(l,D),l};Object.defineProperty(l,"__esModule",{value:!0}),l.Room=void 0;const b=M(G(12370)),X=G(12379),t=G(12395),R=G(12402),n=G(12406),g=G(12411),j=G(12420),e=G(12357);class K{constructor(D,l){this.onStateChange=(0,g.createSignal)(),this.onError=(0,g.createSignal)(),this.onLeave=(0,g.createSignal)(),this.onJoin=(0,g.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,n.createNanoEvents)(),this.roomId=null,this.name=D,l&&(this.serializer=new((0,R.getSerializer)("schema")),this.rootSchema=l,this.serializer.state=new l),this.onError(((D,l)=>{var G;return null===(G=console.warn)||void 0===G?void 0:G.call(console,`colyseus.js - onError => (${D}) ${l}`)})),this.onLeave((()=>this.Nl()))}get id(){return this.roomId}connect(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,V=arguments.length>3?arguments[3]:void 0;const N=new X.Connection;G.connection=N,N.events.onmessage=K.prototype.onMessageCallback.bind(G),N.events.onclose=function(D){var V;if(!G.hasJoined)return null===(V=console.warn)||void 0===V||V.call(console,`Room connection was closed unexpectedly (${D.code}): ${D.reason}`),void G.onError.invoke(D.code,D.reason);D.code===e.CloseCode.DEVMODE_RESTART&&l?l():(G.onLeave.invoke(D.code,D.reason),G.destroy())},N.events.onerror=function(D){var l;null===(l=console.warn)||void 0===l||l.call(console,`Room, onError (${D.code}): ${D.reason}`),G.onError.invoke(D.code,D.reason)},N.connect(D,V)}vX(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((l=>{this.onLeave((D=>l(D))),this.connection?D?this.connection.send([t.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(e.CloseCode.CONSENTED)}))}Ul(D,l){return this.onMessageHandlers.on(this.getMessageHandlerKey(D),l)}send(D,l){const G=[t.Protocol.ROOM_DATA];let V;if("string"===typeof D?j.encode.string(G,D):j.encode.number(G,D),void 0!==l){const D=b.encode(l);V=new Uint8Array(G.length+D.byteLength),V.set(new Uint8Array(G),0),V.set(new Uint8Array(D),G.length)}else V=new Uint8Array(G);this.connection.send(V.buffer)}zt(D,l){const G=[t.Protocol.ROOM_DATA_BYTES];let V;"string"===typeof D?j.encode.string(G,D):j.encode.number(G,D),V=new Uint8Array(G.length+(l.byteLength||l.length)),V.set(new Uint8Array(G),0),V.set(new Uint8Array(l),G.length),this.connection.send(V.buffer)}get state(){return this.serializer.getState()}Nl(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(D){const l=Array.from(new Uint8Array(D.data)),G=l[0];if(G===t.Protocol.JOIN_ROOM){let D=1;const G=(0,t.utf8Read)(l,D);if(D+=(0,t.utf8Length)(G),this.serializerId=(0,t.utf8Read)(l,D),D+=(0,t.utf8Length)(this.serializerId),!this.serializer){const D=(0,R.getSerializer)(this.serializerId);this.serializer=new D}l.length>D&&this.serializer.handshake&&this.serializer.handshake(l,{offset:D}),this.reconnectionToken=`${this.roomId}:${G}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([t.Protocol.JOIN_ROOM])}else if(G===t.Protocol.ERROR){const D={offset:1},G=j.decode.number(l,D),V=j.decode.string(l,D);this.onError.invoke(G,V)}else if(G===t.Protocol.LEAVE_ROOM)this.vX();else if(G===t.Protocol.ROOM_DATA_SCHEMA){const D={offset:1},G=this.serializer.getState().constructor._context.get(j.decode.number(l,D)),V=new G;V.decode(l,D),this.dispatchMessage(G,V)}else if(G===t.Protocol.ROOM_STATE)l.shift(),this.setState(l);else if(G===t.Protocol.ROOM_STATE_PATCH)l.shift(),this.patch(l);else if(G===t.Protocol.ROOM_DATA){const G={offset:1},V=j.decode.stringCheck(l,G)?j.decode.string(l,G):j.decode.number(l,G),N=l.length>G.offset?b.decode(D.data,G.offset):void 0;this.dispatchMessage(V,N)}else if(G===t.Protocol.ROOM_DATA_BYTES){const D={offset:1},G=j.decode.stringCheck(l,D)?j.decode.string(l,D):j.decode.number(l,D);this.dispatchMessage(G,new Uint8Array(l.slice(D.offset)))}}setState(D){this.serializer.setState(D),this.onStateChange.invoke(this.serializer.getState())}patch(D){this.serializer.patch(D),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(D,l){var G;const V=this.getMessageHandlerKey(D);this.onMessageHandlers.events[V]?this.onMessageHandlers.emit(V,l):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",D,l):null===(G=console.warn)||void 0===G||G.call(console,`colyseus.js: onMessage() not registered for type '${D}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(D){switch(typeof D){case"function":return`$${D._typeid}`;case"string":return D;case"number":return`i${D}`;default:throw new Error("invalid message type.")}}}l.Room=K},12444:(D,l)=>{"use strict";let G;function V(){if(!G)try{G="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(D){}return G||(G={cache:{},setItem:function(D,l){this.cache[D]=l},getItem:function(D){this.cache[D]},removeItem:function(D){delete this.cache[D]}}),G}Object.defineProperty(l,"__esModule",{value:!0}),l.getItem=l.removeItem=l.setItem=void 0,l.setItem=function(D,l){V().setItem(D,l)},l.removeItem=function(D){V().removeItem(D)},l.getItem=function(D,l){const G=V().getItem(D);"undefined"!==typeof Promise&&G instanceof Promise?G.then((D=>l(D))):l(G)}},12406:(D,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.createNanoEvents=void 0;l.createNanoEvents=()=>({emit(D){let l=this.events[D]||[];for(var G=arguments.length,V=new Array(G>1?G-1:0),N=1;N<G;N++)V[N-1]=arguments[N];for(let M=0,b=l.length;M<b;M++)l[M](...V)},events:{},on(D,l){var G;return(null===(G=this.events[D])||void 0===G?void 0:G.push(l))||(this.events[D]=[l]),()=>{var G;this.events[D]=null===(G=this.events[D])||void 0===G?void 0:G.filter((D=>l!==D))}}})},12411:(D,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.createSignal=l.EventEmitter=void 0;class G{constructor(){this.handlers=[]}register(D){return this.handlers.push(D),this}invoke(){for(var D=arguments.length,l=new Array(D),G=0;G<D;G++)l[G]=arguments[G];this.handlers.forEach((D=>D.apply(this,l)))}invokeAsync(){for(var D=arguments.length,l=new Array(D),G=0;G<D;G++)l[G]=arguments[G];return Promise.all(this.handlers.map((D=>D.apply(this,l))))}remove(D){const l=this.handlers.indexOf(D);this.handlers[l]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}l.EventEmitter=G,l.createSignal=function(){const D=new G;function l(l){return D.register(l,null===this)}return l.once=l=>{const G=function(){for(var V=arguments.length,N=new Array(V),M=0;M<V;M++)N[M]=arguments[M];l.apply(this,N),D.remove(G)};D.register(G)},l.remove=l=>D.remove(l),l.invoke=function(){return D.invoke(...arguments)},l.invokeAsync=function(){return D.invokeAsync(...arguments)},l.clear=()=>D.clear(),l}},12357:(D,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.ServerError=l.CloseCode=void 0,function(D){D[D.CONSENTED=4e3]="CONSENTED",D[D.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(l.CloseCode||(l.CloseCode={}));class G extends Error{constructor(D,l){super(l),this.name="ServerError",this.code=D}}l.ServerError=G},12335:(D,l,G)=>{"use strict";l.e=void 0,G(12340);var V=G(12348);Object.defineProperty(l,"e",{enumerable:!0,get:function(){return V.Client}});var N=G(12395);var M=G(12366);var b=G(12441);const X=G(12457);const t=G(12462),R=G(12402);(0,R.registerSerializer)("schema",X.SchemaSerializer),(0,R.registerSerializer)("none",t.NoneSerializer)},12340:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=D=>null!==D&&"object"===typeof D&&D.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12370:(D,l)=>{"use strict";function G(D,l){if(this._offset=l,D instanceof ArrayBuffer)this._buffer=D,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(D))throw new Error("Invalid argument");this._buffer=D.buffer,this._view=new DataView(this._buffer,D.byteOffset,D.byteLength)}}Object.defineProperty(l,"__esModule",{value:!0}),l.decode=l.encode=void 0,G.prototype._array=function(D){for(var l=new Array(D),G=0;G<D;G++)l[G]=this._parse();return l},G.prototype._map=function(D){for(var l={},G=0;G<D;G++)l[this._parse()]=this._parse();return l},G.prototype._str=function(D){var l=function(D,l,G){for(var V="",N=0,M=l,b=l+G;M<b;M++){var X=D.getUint8(M);if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(N=(7&X)<<18|(63&D.getUint8(++M))<<12|(63&D.getUint8(++M))<<6|63&D.getUint8(++M))>=65536?(N-=65536,V+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):V+=String.fromCharCode(N)}else V+=String.fromCharCode((15&X)<<12|(63&D.getUint8(++M))<<6|63&D.getUint8(++M));else V+=String.fromCharCode((31&X)<<6|63&D.getUint8(++M));else V+=String.fromCharCode(X)}return V}(this._view,this._offset,D);return this._offset+=D,l},G.prototype._bin=function(D){var l=this._buffer.slice(this._offset,this._offset+D);return this._offset+=D,l},G.prototype._parse=function(){var D,l=this._view.getUint8(this._offset++),G=0,V=0,N=0,M=0;if(l<192)return l<128?l:l<144?this._map(15&l):l<160?this._array(15&l):this._str(31&l);if(l>223)return-1*(255-l+1);switch(l){case 192:return null;case 194:return!1;case 195:return!0;case 196:return G=this._view.getUint8(this._offset),this._offset+=1,this._bin(G);case 197:return G=this._view.getUint16(this._offset),this._offset+=2,this._bin(G);case 198:return G=this._view.getUint32(this._offset),this._offset+=4,this._bin(G);case 199:if(G=this._view.getUint8(this._offset),V=this._view.getInt8(this._offset+1),this._offset+=2,-1===V){var b=this._view.getUint32(this._offset);return N=this._view.getInt32(this._offset+4),M=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*N+M)+b/1e6)}return[V,this._bin(G)];case 200:return G=this._view.getUint16(this._offset),V=this._view.getInt8(this._offset+2),this._offset+=3,[V,this._bin(G)];case 201:return G=this._view.getUint32(this._offset),V=this._view.getInt8(this._offset+4),this._offset+=5,[V,this._bin(G)];case 202:return D=this._view.getFloat32(this._offset),this._offset+=4,D;case 203:return D=this._view.getFloat64(this._offset),this._offset+=8,D;case 204:return D=this._view.getUint8(this._offset),this._offset+=1,D;case 205:return D=this._view.getUint16(this._offset),this._offset+=2,D;case 206:return D=this._view.getUint32(this._offset),this._offset+=4,D;case 207:return N=this._view.getUint32(this._offset)*Math.pow(2,32),M=this._view.getUint32(this._offset+4),this._offset+=8,N+M;case 208:return D=this._view.getInt8(this._offset),this._offset+=1,D;case 209:return D=this._view.getInt16(this._offset),this._offset+=2,D;case 210:return D=this._view.getInt32(this._offset),this._offset+=4,D;case 211:return N=this._view.getInt32(this._offset)*Math.pow(2,32),M=this._view.getUint32(this._offset+4),this._offset+=8,N+M;case 212:return V=this._view.getInt8(this._offset),this._offset+=1,0===V?void(this._offset+=1):[V,this._bin(1)];case 213:return V=this._view.getInt8(this._offset),this._offset+=1,[V,this._bin(2)];case 214:return V=this._view.getInt8(this._offset),this._offset+=1,-1===V?(D=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*D)):[V,this._bin(4)];case 215:return V=this._view.getInt8(this._offset),this._offset+=1,0===V?(N=this._view.getInt32(this._offset)*Math.pow(2,32),M=this._view.getUint32(this._offset+4),this._offset+=8,new Date(N+M)):-1===V?(N=this._view.getUint32(this._offset),M=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&N)+M)+(N>>>2)/1e6)):[V,this._bin(8)];case 216:return V=this._view.getInt8(this._offset),this._offset+=1,[V,this._bin(16)];case 217:return G=this._view.getUint8(this._offset),this._offset+=1,this._str(G);case 218:return G=this._view.getUint16(this._offset),this._offset+=2,this._str(G);case 219:return G=this._view.getUint32(this._offset),this._offset+=4,this._str(G);case 220:return G=this._view.getUint16(this._offset),this._offset+=2,this._array(G);case 221:return G=this._view.getUint32(this._offset),this._offset+=4,this._array(G);case 222:return G=this._view.getUint16(this._offset),this._offset+=2,this._map(G);case 223:return G=this._view.getUint32(this._offset),this._offset+=4,this._map(G)}throw new Error("Could not parse")},l.decode=function(D){var l=new G(D,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),V=l._parse();if(l._offset!==D.byteLength)throw new Error(D.byteLength-l._offset+" trailing bytes");return V};function V(D,l,G){for(var V=0,N=0,M=G.length;N<M;N++)(V=G.charCodeAt(N))<128?D.setUint8(l++,V):V<2048?(D.setUint8(l++,192|V>>6),D.setUint8(l++,128|63&V)):V<55296||V>=57344?(D.setUint8(l++,224|V>>12),D.setUint8(l++,128|V>>6&63),D.setUint8(l++,128|63&V)):(N++,V=65536+((1023&V)<<10|1023&G.charCodeAt(N)),D.setUint8(l++,240|V>>18),D.setUint8(l++,128|V>>12&63),D.setUint8(l++,128|V>>6&63),D.setUint8(l++,128|63&V))}function N(D,l,G){var V=typeof G,M=0,b=0,X=0,t=0,R=0,n=0;if("string"===V){if(R=function(D){for(var l=0,G=0,V=0,N=D.length;V<N;V++)(l=D.charCodeAt(V))<128?G+=1:l<2048?G+=2:l<55296||l>=57344?G+=3:(V++,G+=4);return G}(G),R<32)D.push(160|R),n=1;else if(R<256)D.push(217,R),n=2;else if(R<65536)D.push(218,R>>8,R),n=3;else{if(!(R<4294967296))throw new Error("String too long");D.push(219,R>>24,R>>16,R>>8,R),n=5}return l.push({_str:G,_length:R,_offset:D.length}),n+R}if("number"===V)return Math.floor(G)===G&&isFinite(G)?G>=0?G<128?(D.push(G),1):G<256?(D.push(204,G),2):G<65536?(D.push(205,G>>8,G),3):G<4294967296?(D.push(206,G>>24,G>>16,G>>8,G),5):(X=G/Math.pow(2,32)|0,t=G>>>0,D.push(207,X>>24,X>>16,X>>8,X,t>>24,t>>16,t>>8,t),9):G>=-32?(D.push(G),1):G>=-128?(D.push(208,G),2):G>=-32768?(D.push(209,G>>8,G),3):G>=-2147483648?(D.push(210,G>>24,G>>16,G>>8,G),5):(X=Math.floor(G/Math.pow(2,32)),t=G>>>0,D.push(211,X>>24,X>>16,X>>8,X,t>>24,t>>16,t>>8,t),9):(D.push(203),l.push({_float:G,_length:8,_offset:D.length}),9);if("object"===V){if(null===G)return D.push(192),1;if(Array.isArray(G)){if((R=G.length)<16)D.push(144|R),n=1;else if(R<65536)D.push(220,R>>8,R),n=3;else{if(!(R<4294967296))throw new Error("Array too large");D.push(221,R>>24,R>>16,R>>8,R),n=5}for(M=0;M<R;M++)n+=N(D,l,G[M]);return n}if(G instanceof Date){var g=G.getTime(),j=Math.floor(g/1e3),e=1e6*(g-1e3*j);return j>=0&&e>=0&&j<=17179869183?0===e&&j<=4294967295?(D.push(214,255,j>>24,j>>16,j>>8,j),6):(X=j/4294967296,t=4294967295&j,D.push(215,255,e>>22,e>>14,e>>6,X,t>>24,t>>16,t>>8,t),10):(X=Math.floor(j/4294967296),t=j>>>0,D.push(199,12,255,e>>24,e>>16,e>>8,e,X>>24,X>>16,X>>8,X,t>>24,t>>16,t>>8,t),15)}if(G instanceof ArrayBuffer){if((R=G.byteLength)<256)D.push(196,R),n=2;else if(R<65536)D.push(197,R>>8,R),n=3;else{if(!(R<4294967296))throw new Error("Buffer too large");D.push(198,R>>24,R>>16,R>>8,R),n=5}return l.push({_bin:G,_length:R,_offset:D.length}),n+R}if("function"===typeof G.toJSON)return N(D,l,G.toJSON());var K=[],F="",d=Object.keys(G);for(M=0,b=d.length;M<b;M++)void 0!==G[F=d[M]]&&"function"!==typeof G[F]&&K.push(F);if((R=K.length)<16)D.push(128|R),n=1;else if(R<65536)D.push(222,R>>8,R),n=3;else{if(!(R<4294967296))throw new Error("Object too large");D.push(223,R>>24,R>>16,R>>8,R),n=5}for(M=0;M<R;M++)n+=N(D,l,F=K[M]),n+=N(D,l,G[F]);return n}if("boolean"===V)return D.push(G?195:194),1;if("undefined"===V)return D.push(192),1;if("function"===typeof G.toJSON)return N(D,l,G.toJSON());throw new Error("Could not encode")}l.encode=function(D){var l=[],G=[],M=N(l,G,D),b=new ArrayBuffer(M),X=new DataView(b),t=0,R=0,n=-1;G.length>0&&(n=G[0]._offset);for(var g,j=0,e=0,K=0,F=l.length;K<F;K++)if(X.setUint8(R+K,l[K]),K+1===n){if(j=(g=G[t])._length,e=R+n,g._bin)for(var d=new Uint8Array(g._bin),H=0;H<j;H++)X.setUint8(e+H,d[H]);else g._str?V(X,e,g._str):void 0!==g._float&&X.setFloat64(e,g._float);R+=j,G[++t]&&(n=G[t]._offset)}return b}},12462:(D,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.NoneSerializer=void 0;l.NoneSerializer=class{setState(D){}getState(){return null}patch(D){}teardown(){}handshake(D){}}},12457:(D,l,G)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.SchemaSerializer=void 0;const V=G(12420);l.SchemaSerializer=class{setState(D){return this.state.decode(D)}getState(){return this.state}patch(D){return this.state.decode(D)}teardown(){var D,l;null===(l=null===(D=this.state)||void 0===D?void 0:D.$changes)||void 0===l||l.root.clearRefs()}handshake(D,l){if(this.state){(new V.Reflection).decode(D,l)}else this.state=V.Reflection.decode(D,l)}}},12402:(D,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.getSerializer=l.registerSerializer=void 0;const G={};l.registerSerializer=function(D,l){G[D]=l},l.getSerializer=function(D){const l=G[D];if(!l)throw new Error("missing serializer: "+D);return l}},12387:function(D,l,G){"use strict";var V=this&&this.__importDefault||function(D){return D&&D.__esModule?D:{default:D}};Object.defineProperty(l,"__esModule",{value:!0}),l.WebSocketTransport=void 0;const N=V(G(12393)),M=globalThis.WebSocket||N.default;l.WebSocketTransport=class{constructor(D){this.events=D}send(D){D instanceof ArrayBuffer?this.ws.send(D):Array.isArray(D)&&this.ws.send(new Uint8Array(D).buffer)}connect(D,l){try{this.ws=new M(D,{headers:l,protocols:this.protocols})}catch(G){this.ws=new M(D,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(D,l){this.ws.close(D,l)}get isOpen(){return this.ws.readyState===M.OPEN}}},12393:D=>{"use strict";D.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12823:D=>{"use strict";D.exports=function(D){for(var l=new Array(D),G=0;G<D;++G)l[G]=G;return l}},12825:D=>{function l(D){return!!D.constructor&&"function"===typeof D.constructor.isBuffer&&D.constructor.isBuffer(D)}D.exports=function(D){return null!=D&&(l(D)||function(D){return"function"===typeof D.readFloatLE&&"function"===typeof D.slice&&l(D.slice(0,0))}(D)||!!D._isBuffer)}},12815:(D,l,G)=>{var V=G(12823),N=G(12825),M="undefined"!==typeof Float64Array;function b(D,l){return D[0]-l[0]}function X(){var D,l=this.stride,G=new Array(l.length);for(D=0;D<G.length;++D)G[D]=[Math.abs(l[D]),D];G.sort(b);var V=new Array(G.length);for(D=0;D<V.length;++D)V[D]=G[D][1];return V}function t(D,l){var G=["View",l,"d",D].join("");l<0&&(G="View_Nil"+D);var N="generic"===D;if(-1===l){var M="function "+G+"(a){this.data=a;};var proto="+G+".prototype;proto.dtype='"+D+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+G+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+G+"(a){return new "+G+"(a);}";return new Function(M)()}if(0===l){M="function "+G+"(a,d) {this.data = a;this.offset = d};var proto="+G+".prototype;proto.dtype='"+D+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+G+"_copy() {return new "+G+"(this.data,this.offset)};proto.pick=function "+G+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+G+"_get(){return "+(N?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+G+"_set(v){return "+(N?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+G+"(a,b,c,d){return new "+G+"(a,d)}";return new Function("TrivialArray",M)(R[D][0])}M=["'use strict'"];var b=V(l),t=b.map((function(D){return"i"+D})),n="this.offset+"+b.map((function(D){return"this.stride["+D+"]*i"+D})).join("+"),g=b.map((function(D){return"b"+D})).join(","),j=b.map((function(D){return"c"+D})).join(",");M.push("function "+G+"(a,"+g+","+j+",d){this.data=a","this.shape=["+g+"]","this.stride=["+j+"]","this.offset=d|0}","var proto="+G+".prototype","proto.dtype='"+D+"'","proto.dimension="+l),M.push("Object.defineProperty(proto,'size',{get:function "+G+"_size(){return "+b.map((function(D){return"this.shape["+D+"]"})).join("*"),"}})"),1===l?M.push("proto.order=[0]"):(M.push("Object.defineProperty(proto,'order',{get:"),l<4?(M.push("function "+G+"_order(){"),2===l?M.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===l&&M.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):M.push("ORDER})")),M.push("proto.set=function "+G+"_set("+t.join(",")+",v){"),N?M.push("return this.data.set("+n+",v)}"):M.push("return this.data["+n+"]=v}"),M.push("proto.get=function "+G+"_get("+t.join(",")+"){"),N?M.push("return this.data.get("+n+")}"):M.push("return this.data["+n+"]}"),M.push("proto.index=function "+G+"_index(",t.join(),"){return "+n+"}"),M.push("proto.hi=function "+G+"_hi("+t.join(",")+"){return new "+G+"(this.data,"+b.map((function(D){return["(typeof i",D,"!=='number'||i",D,"<0)?this.shape[",D,"]:i",D,"|0"].join("")})).join(",")+","+b.map((function(D){return"this.stride["+D+"]"})).join(",")+",this.offset)}");var e=b.map((function(D){return"a"+D+"=this.shape["+D+"]"})),K=b.map((function(D){return"c"+D+"=this.stride["+D+"]"}));M.push("proto.lo=function "+G+"_lo("+t.join(",")+"){var b=this.offset,d=0,"+e.join(",")+","+K.join(","));for(var F=0;F<l;++F)M.push("if(typeof i"+F+"==='number'&&i"+F+">=0){d=i"+F+"|0;b+=c"+F+"*d;a"+F+"-=d}");M.push("return new "+G+"(this.data,"+b.map((function(D){return"a"+D})).join(",")+","+b.map((function(D){return"c"+D})).join(",")+",b)}"),M.push("proto.step=function "+G+"_step("+t.join(",")+"){var "+b.map((function(D){return"a"+D+"=this.shape["+D+"]"})).join(",")+","+b.map((function(D){return"b"+D+"=this.stride["+D+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(F=0;F<l;++F)M.push("if(typeof i"+F+"==='number'){d=i"+F+"|0;if(d<0){c+=b"+F+"*(a"+F+"-1);a"+F+"=ceil(-a"+F+"/d)}else{a"+F+"=ceil(a"+F+"/d)}b"+F+"*=d}");M.push("return new "+G+"(this.data,"+b.map((function(D){return"a"+D})).join(",")+","+b.map((function(D){return"b"+D})).join(",")+",c)}");var d=new Array(l),H=new Array(l);for(F=0;F<l;++F)d[F]="a[i"+F+"]",H[F]="b[i"+F+"]";M.push("proto.transpose=function "+G+"_transpose("+t+"){"+t.map((function(D,l){return D+"=("+D+"===undefined?"+l+":"+D+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+G+"(this.data,"+d.join(",")+","+H.join(",")+",this.offset)}"),M.push("proto.pick=function "+G+"_pick("+t+"){var a=[],b=[],c=this.offset");for(F=0;F<l;++F)M.push("if(typeof i"+F+"==='number'&&i"+F+">=0){c=(c+this.stride["+F+"]*i"+F+")|0}else{a.push(this.shape["+F+"]);b.push(this.stride["+F+"])}");return M.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),M.push("return function construct_"+G+"(data,shape,stride,offset){return new "+G+"(data,"+b.map((function(D){return"shape["+D+"]"})).join(",")+","+b.map((function(D){return"stride["+D+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",M.join("\n"))(R[D],X)}var R={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};D.exports=function(D,l,G,V){if(void 0===D)return(0,R.array[0])([]);"number"===typeof D&&(D=[D]),void 0===l&&(l=[D.length]);var b=l.length;if(void 0===G){G=new Array(b);for(var X=b-1,n=1;X>=0;--X)G[X]=n,n*=l[X]}if(void 0===V){V=0;for(X=0;X<b;++X)G[X]<0&&(V-=(l[X]-1)*G[X])}for(var g=function(D){if(N(D))return"buffer";if(M)switch(Object.prototype.toString.call(D)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(D)?"array":"generic"}(D),j=R[g];j.length<=b+1;)j.push(t(g,j.length-1));return(0,j[b+1])(D,l,G,V)}},13771:D=>{var l;self,l=()=>(()=>{"use strict";var D={d:(l,G)=>{for(var V in G)D.o(G,V)&&!D.o(l,V)&&Object.defineProperty(l,V,{enumerable:!0,get:G[V]})},o:(D,l)=>Object.prototype.hasOwnProperty.call(D,l)},l={};D.d(l,{default:()=>U});var G,V=function(D,l){var G=l.x-D.x,V=l.y-D.y;return Math.sqrt(G*G+V*V)},N=function(D){return D*(Math.PI/180)},M=new Map,b=function(D){M.has(D)&&clearTimeout(M.get(D)),M.set(D,setTimeout(D,100))},X=function(D,l,G){for(var V,N=l.split(/[ ,]+/g),M=0;M<N.length;M+=1)V=N[M],D.addEventListener?D.addEventListener(V,G,!1):D.attachEvent&&D.attachEvent(V,G)},t=function(D,l,G){for(var V,N=l.split(/[ ,]+/g),M=0;M<N.length;M+=1)V=N[M],D.removeEventListener?D.removeEventListener(V,G):D.detachEvent&&D.detachEvent(V,G)},R=function(D){return D.preventDefault(),D.type.match(/^touch/)?D.changedTouches:D},n=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},g=function(D,l){l.top||l.right||l.bottom||l.left?(D.style.top=l.top,D.style.right=l.right,D.style.bottom=l.bottom,D.style.left=l.left):(D.style.left=l.x+"px",D.style.top=l.y+"px")},j=function(D,l,G){var V=e(D);for(var N in V)if(V.hasOwnProperty(N))if("string"==typeof l)V[N]=l+" "+G;else{for(var M="",b=0,X=l.length;b<X;b+=1)M+=l[b]+" "+G+", ";V[N]=M.slice(0,-2)}return V},e=function(D){var l={};return l[D]="",["webkit","Moz","o"].forEach((function(G){l[G+D.charAt(0).toUpperCase()+D.slice(1)]=""})),l},K=function(D,l){for(var G in l)l.hasOwnProperty(G)&&(D[G]=l[G]);return D},F=function(D,l){if(D.length)for(var G=0,V=D.length;G<V;G+=1)l(D[G]);else l(D)},d="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,H=window.matchMedia("(any-hover: none)").matches,h=!!("ontouchstart"in window),x=!!window.PointerEvent,r=!!window.MSPointerEvent,o={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},L={start:"mousedown",move:"mousemove",end:"mouseup"},u={};function B(){}d&&!H?G=o:x?G={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:r?G={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:h?(G=o,u=L):G=L,B.prototype.on=function(D,l){var G,V=this,N=D.split(/[ ,]+/g);V._handlers_=V._handlers_||{};for(var M=0;M<N.length;M+=1)G=N[M],V._handlers_[G]=V._handlers_[G]||[],V._handlers_[G].push(l);return V},B.prototype.off=function(D,l){var G=this;return G._handlers_=G._handlers_||{},void 0===D?G._handlers_={}:void 0===l?G._handlers_[D]=null:G._handlers_[D]&&G._handlers_[D].indexOf(l)>=0&&G._handlers_[D].splice(G._handlers_[D].indexOf(l),1),G},B.prototype.trigger=function(D,l){var G,V=this,N=D.split(/[ ,]+/g);V._handlers_=V._handlers_||{};for(var M=0;M<N.length;M+=1)G=N[M],V._handlers_[G]&&V._handlers_[G].length&&V._handlers_[G].forEach((function(D){D.call(V,{type:G,target:V},l)}))},B.prototype.config=function(D){var l=this;l.options=l.defaults||{},D&&(l.options=function(D,l){var G={};for(var V in D)D.hasOwnProperty(V)&&l.hasOwnProperty(V)?G[V]=l[V]:D.hasOwnProperty(V)&&(G[V]=D[V]);return G}(l.options,D))},B.prototype.bindEvt=function(D,l){var V=this;return V._domHandlers_=V._domHandlers_||{},V._domHandlers_[l]=function(){"function"==typeof V["on"+l]?V["on"+l].apply(V,arguments):console.warn('[WARNING] : Missing "on'+l+'" handler.')},X(D,G[l],V._domHandlers_[l]),u[l]&&X(D,u[l],V._domHandlers_[l]),V},B.prototype.unbindEvt=function(D,l){var V=this;return V._domHandlers_=V._domHandlers_||{},t(D,G[l],V._domHandlers_[l]),u[l]&&t(D,u[l],V._domHandlers_[l]),delete V._domHandlers_[l],this};const I=B;function W(D,l){return this.identifier=l.identifier,this.position=l.position,this.frontPosition=l.frontPosition,this.collection=D,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(l),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=W.id,W.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}W.prototype=new I,W.constructor=W,W.id=0,W.prototype.buildEl=function(D){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},W.prototype.stylize=function(){if(this.options.dataOnly)return this;var D=this.options.fadeTime+"ms",l=function(){var D=e("borderRadius");for(var l in D)D.hasOwnProperty(l)&&(D[l]="50%");return D}(),G=j("transition","opacity",D),V={};return V.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},V.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},V.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},K(V.el,G),"circle"===this.options.shape&&K(V.back,l),K(V.front,l),this.applyStyles(V),this},W.prototype.applyStyles=function(D){for(var l in this.ui)if(this.ui.hasOwnProperty(l))for(var G in D[l])this.ui[l].style[G]=D[l][G];return this},W.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},W.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},W.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},W.prototype.show=function(D){var l=this;return l.options.dataOnly||(clearTimeout(l.removeTimeout),clearTimeout(l.showTimeout),clearTimeout(l.restTimeout),l.addToDom(),l.restCallback(),setTimeout((function(){l.ui.el.style.opacity=1}),0),l.showTimeout=setTimeout((function(){l.trigger("shown",l.instance),"function"==typeof D&&D.call(this)}),l.options.fadeTime)),l},W.prototype.hide=function(D){var l=this;if(l.options.dataOnly)return l;if(l.ui.el.style.opacity=l.options.restOpacity,clearTimeout(l.removeTimeout),clearTimeout(l.showTimeout),clearTimeout(l.restTimeout),l.removeTimeout=setTimeout((function(){var G="dynamic"===l.options.mode?"none":"block";l.ui.el.style.display=G,"function"==typeof D&&D.call(l),l.trigger("hidden",l.instance)}),l.options.fadeTime),l.options.restJoystick){var G=l.options.restJoystick,V={};V.x=!0===G||!1!==G.x?0:l.instance.frontPosition.x,V.y=!0===G||!1!==G.y?0:l.instance.frontPosition.y,l.setPosition(D,V)}return l},W.prototype.setPosition=function(D,l){var G=this;G.frontPosition={x:l.x,y:l.y};var V=G.options.fadeTime+"ms",N={};N.front=j("transition",["transform"],V);var M={front:{}};M.front={transform:"translate("+G.frontPosition.x+"px,"+G.frontPosition.y+"px)"},G.applyStyles(N),G.applyStyles(M),G.restTimeout=setTimeout((function(){"function"==typeof D&&D.call(G),G.restCallback()}),G.options.fadeTime)},W.prototype.restCallback=function(){var D=this,l={};l.front=j("transition","none",""),D.applyStyles(l),D.trigger("rested",D.instance)},W.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},W.prototype.computeDirection=function(D){var l,G,V,N=D.angle.radian,M=Math.PI/4,b=Math.PI/2;if(N>M&&N<3*M&&!D.lockX?l="up":N>-M&&N<=M&&!D.lockY?l="left":N>3*-M&&N<=-M&&!D.lockX?l="down":D.lockY||(l="right"),D.lockY||(G=N>-b&&N<b?"left":"right"),D.lockX||(V=N>0?"up":"down"),D.force>this.options.threshold){var X,t={};for(X in this.direction)this.direction.hasOwnProperty(X)&&(t[X]=this.direction[X]);var R={};for(X in this.direction={x:G,y:V,angle:l},D.direction=this.direction,t)t[X]===this.direction[X]&&(R[X]=!0);if(R.x&&R.y&&R.angle)return D;R.x&&R.y||this.trigger("plain",D),R.x||this.trigger("plain:"+G,D),R.y||this.trigger("plain:"+V,D),R.angle||this.trigger("dir dir:"+l,D)}else this.resetDirection();return D};const i=W;function y(D,l){var G=this;G.nipples=[],G.idles=[],G.actives=[],G.ids=[],G.pressureIntervals={},G.manager=D,G.id=y.id,y.id+=1,G.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},G.config(l),"static"!==G.options.mode&&"semi"!==G.options.mode||(G.options.multitouch=!1),G.options.multitouch||(G.options.maxNumberOfNipples=1);var V=getComputedStyle(G.options.zone.parentElement);return V&&"flex"===V.display&&(G.parentIsFlex=!0),G.updateBox(),G.prepareNipples(),G.Wj(),G.begin(),G.nipples}y.prototype=new I,y.constructor=y,y.id=0,y.prototype.prepareNipples=function(){var D=this,l=D.nipples;l.on=D.on.bind(D),l.off=D.off.bind(D),l.options=D.options,l.destroy=D.destroy.bind(D),l.ids=D.ids,l.id=D.id,l.processOnMove=D.processOnMove.bind(D),l.processOnEnd=D.processOnEnd.bind(D),l.get=function(D){if(void 0===D)return l[0];for(var G=0,V=l.length;G<V;G+=1)if(l[G].identifier===D)return l[G];return!1}},y.prototype.Wj=function(){var D=this;D.bindEvt(D.options.zone,"start"),D.options.zone.style.touchAction="none",D.options.zone.style.msTouchAction="none"},y.prototype.begin=function(){var D=this,l=D.options;if("static"===l.mode){var G=D.createNipple(l.position,D.manager.getIdentifier());G.add(),D.idles.push(G)}},y.prototype.createNipple=function(D,l){var G=this,V=G.manager.scroll,N={},M=G.options,b=G.parentIsFlex?V.x:V.x+G.box.left,X=G.parentIsFlex?V.y:V.y+G.box.top;if(D.x&&D.y)N={x:D.x-b,y:D.y-X};else if(D.top||D.right||D.bottom||D.left){var t=document.createElement("DIV");t.style.display="hidden",t.style.top=D.top,t.style.right=D.right,t.style.bottom=D.bottom,t.style.left=D.left,t.style.position="absolute",M.zone.appendChild(t);var R=t.getBoundingClientRect();M.zone.removeChild(t),N=D,D={x:R.left+V.x,y:R.top+V.y}}var n=new i(G,{color:M.color,size:M.size,threshold:M.threshold,fadeTime:M.fadeTime,dataOnly:M.dataOnly,restJoystick:M.restJoystick,restOpacity:M.restOpacity,mode:M.mode,identifier:l,position:D,zone:M.zone,frontPosition:{x:0,y:0},shape:M.shape});return M.dataOnly||(g(n.ui.el,N),g(n.ui.front,n.frontPosition)),G.nipples.push(n),G.trigger("added "+n.identifier+":added",n),G.manager.trigger("added "+n.identifier+":added",n),G.bindNipple(n),n},y.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},y.prototype.bindNipple=function(D){var l,G=this,V=function(D,V){l=D.type+" "+V.id+":"+D.type,G.trigger(l,V)};D.on("destroyed",G.onDestroyed.bind(G)),D.on("shown hidden rested dir plain",V),D.on("dir:up dir:right dir:down dir:left",V),D.on("plain:up plain:right plain:down plain:left",V)},y.prototype.pressureFn=function(D,l,G){var V=this,N=0;clearInterval(V.pressureIntervals[G]),V.pressureIntervals[G]=setInterval(function(){var G=D.force||D.pressure||D.webkitForce||0;G!==N&&(l.trigger("pressure",G),V.trigger("pressure "+l.identifier+":pressure",G),N=G)}.bind(V),100)},y.prototype.onstart=function(D){var l=this,G=l.options,V=D;return D=R(D),l.updateBox(),F(D,(function(N){l.actives.length<G.maxNumberOfNipples?l.processOnStart(N):V.type.match(/^touch/)&&(Object.keys(l.manager.ids).forEach((function(G){if(Object.values(V.touches).findIndex((function(D){return D.identifier===G}))<0){var N=[D[0]];N.identifier=G,l.processOnEnd(N)}})),l.actives.length<G.maxNumberOfNipples&&l.processOnStart(N))})),l.manager.bindDocument(),!1},y.prototype.processOnStart=function(D){var l,G=this,N=G.options,M=G.manager.getIdentifier(D),b=D.force||D.pressure||D.webkitForce||0,X={x:D.pageX,y:D.pageY},t=G.getOrCreate(M,X);t.identifier!==M&&G.manager.removeIdentifier(t.identifier),t.identifier=M;var R=function(l){l.trigger("start",l),G.trigger("start "+l.id+":start",l),l.show(),b>0&&G.pressureFn(D,l,l.identifier),G.processOnMove(D)};if((l=G.idles.indexOf(t))>=0&&G.idles.splice(l,1),G.actives.push(t),G.ids.push(t.identifier),"semi"!==N.mode)R(t);else{if(!(V(X,t.position)<=N.catchDistance))return t.destroy(),void G.processOnStart(D);R(t)}return t},y.prototype.getOrCreate=function(D,l){var G,V=this,N=V.options;return/(semi|static)/.test(N.mode)?(G=V.idles[0])?(V.idles.splice(0,1),G):"semi"===N.mode?V.createNipple(l,D):(console.warn("Coudln't find the needed nipple."),!1):G=V.createNipple(l,D)},y.prototype.processOnMove=function(D){var l=this,G=l.options,M=l.manager.getIdentifier(D),b=l.nipples.get(M),X=l.manager.scroll;if(function(D){return isNaN(D.buttons)?0!==D.pressure:0!==D.buttons}(D)){if(!b)return console.error("Found zombie joystick with ID "+M),void l.manager.removeIdentifier(M);if(G.dynamicPage){var t=b.el.getBoundingClientRect();b.position={x:X.x+t.left,y:X.y+t.top}}b.identifier=M;var R=b.options.size/2,n={x:D.pageX,y:D.pageY};G.lockX&&(n.y=b.position.y),G.lockY&&(n.x=b.position.x);var g,j,e,K,F,d,H,h,x,r,o=V(n,b.position),L=(g=n,e=(j=b.position).x-g.x,K=j.y-g.y,function(D){return D*(180/Math.PI)}(Math.atan2(K,e))),u=N(L),B=o/R,I={distance:o,position:n};if("circle"===b.options.shape?(F=Math.min(o,R),H=b.position,h=F,r={x:0,y:0},x=N(x=L),r.x=H.x-h*Math.cos(x),r.y=H.y-h*Math.sin(x),d=r):(d=function(D,l,G){return{x:Math.min(Math.max(D.x,l.x-G),l.x+G),y:Math.min(Math.max(D.y,l.y-G),l.y+G)}}(n,b.position,R),F=V(d,b.position)),G.follow){if(o>R){var W=n.x-d.x,i=n.y-d.y;b.position.x+=W,b.position.y+=i,b.el.style.top=b.position.y-(l.box.top+X.y)+"px",b.el.style.left=b.position.x-(l.box.left+X.x)+"px",o=V(n,b.position)}}else n=d,o=F;var y=n.x-b.position.x,S=n.y-b.position.y;b.frontPosition={x:y,y:S},G.dataOnly||(b.ui.front.style.transform="translate("+y+"px,"+S+"px)");var O={identifier:b.identifier,position:n,force:B,pressure:D.force||D.pressure||D.webkitForce||0,distance:o,angle:{radian:u,degree:L},vector:{x:y/R,y:-S/R},raw:I,instance:b,lockX:G.lockX,lockY:G.lockY};(O=b.computeDirection(O)).angle={radian:N(180-L),degree:180-L},b.trigger("move",O),l.trigger("move "+b.id+":move",O)}else this.processOnEnd(D)},y.prototype.processOnEnd=function(D){var l=this,G=l.options,V=l.manager.getIdentifier(D),N=l.nipples.get(V),M=l.manager.removeIdentifier(N.identifier);N&&(G.dataOnly||N.hide((function(){"dynamic"===G.mode&&(N.trigger("removed",N),l.trigger("removed "+N.id+":removed",N),l.manager.trigger("removed "+N.id+":removed",N),N.destroy())})),clearInterval(l.pressureIntervals[N.identifier]),N.resetDirection(),N.trigger("end",N),l.trigger("end "+N.id+":end",N),l.ids.indexOf(N.identifier)>=0&&l.ids.splice(l.ids.indexOf(N.identifier),1),l.actives.indexOf(N)>=0&&l.actives.splice(l.actives.indexOf(N),1),/(semi|static)/.test(G.mode)?l.idles.push(N):l.nipples.indexOf(N)>=0&&l.nipples.splice(l.nipples.indexOf(N),1),l.manager.unbindDocument(),/(semi|static)/.test(G.mode)&&(l.manager.ids[M.id]=M.identifier))},y.prototype.onDestroyed=function(D,l){var G=this;G.nipples.indexOf(l)>=0&&G.nipples.splice(G.nipples.indexOf(l),1),G.actives.indexOf(l)>=0&&G.actives.splice(G.actives.indexOf(l),1),G.idles.indexOf(l)>=0&&G.idles.splice(G.idles.indexOf(l),1),G.ids.indexOf(l.identifier)>=0&&G.ids.splice(G.ids.indexOf(l.identifier),1),G.manager.removeIdentifier(l.identifier),G.manager.unbindDocument()},y.prototype.destroy=function(){var D=this;for(var l in D.unbindEvt(D.options.zone,"start"),D.nipples.forEach((function(D){D.destroy()})),D.pressureIntervals)D.pressureIntervals.hasOwnProperty(l)&&clearInterval(D.pressureIntervals[l]);D.trigger("destroyed",D.nipples),D.manager.unbindDocument(),D.off()};const S=y;function O(D){var l=this;l.ids={},l.index=0,l.collections=[],l.scroll=n(),l.config(D),l.prepareCollections();var G=function(){var D;l.collections.forEach((function(G){G.forEach((function(G){D=G.el.getBoundingClientRect(),G.position={x:l.scroll.x+D.left,y:l.scroll.y+D.top}}))}))};X(window,"resize",(function(){b(G)}));var V=function(){l.scroll=n()};return X(window,"scroll",(function(){b(V)})),l.collections}O.prototype=new I,O.constructor=O,O.prototype.prepareCollections=function(){var D=this;D.collections.create=D.create.bind(D),D.collections.on=D.on.bind(D),D.collections.off=D.off.bind(D),D.collections.destroy=D.destroy.bind(D),D.collections.get=function(l){var G;return D.collections.every((function(D){return!(G=D.get(l))})),G}},O.prototype.create=function(D){return this.createCollection(D)},O.prototype.createCollection=function(D){var l=this,G=new S(l,D);return l.bindCollection(G),l.collections.push(G),G},O.prototype.bindCollection=function(D){var l,G=this,V=function(D,V){l=D.type+" "+V.id+":"+D.type,G.trigger(l,V)};D.on("destroyed",G.onDestroyed.bind(G)),D.on("shown hidden rested dir plain",V),D.on("dir:up dir:right dir:down dir:left",V),D.on("plain:up plain:right plain:down plain:left",V)},O.prototype.bindDocument=function(){var D=this;D.binded||(D.bindEvt(document,"move").bindEvt(document,"end"),D.binded=!0)},O.prototype.unbindDocument=function(D){var l=this;Object.keys(l.ids).length&&!0!==D||(l.unbindEvt(document,"move").unbindEvt(document,"end"),l.binded=!1)},O.prototype.getIdentifier=function(D){var l;return D?void 0===(l=void 0===D.identifier?D.pointerId:D.identifier)&&(l=this.latest||0):l=this.index,void 0===this.ids[l]&&(this.ids[l]=this.index,this.index+=1),this.latest=l,this.ids[l]},O.prototype.removeIdentifier=function(D){var l={};for(var G in this.ids)if(this.ids[G]===D){l.id=G,l.identifier=this.ids[G],delete this.ids[G];break}return l},O.prototype.onmove=function(D){return this.onAny("move",D),!1},O.prototype.onend=function(D){return this.onAny("end",D),!1},O.prototype.oncancel=function(D){return this.onAny("end",D),!1},O.prototype.onAny=function(D,l){var G,V=this,N="processOn"+D.charAt(0).toUpperCase()+D.slice(1);l=R(l);var M=function(D,l,G){G.ids.indexOf(l)>=0&&(G[N](D),D._found_=!0)};return F(l,(function(D){G=V.getIdentifier(D),F(V.collections,M.bind(null,D,G)),D._found_||V.removeIdentifier(G)})),!1},O.prototype.destroy=function(){var D=this;D.unbindDocument(!0),D.ids={},D.index=0,D.collections.forEach((function(D){D.destroy()})),D.off()},O.prototype.onDestroyed=function(D,l){var G=this;if(G.collections.indexOf(l)<0)return!1;G.collections.splice(G.collections.indexOf(l),1)};var s=new O;const U={create:function(D){return s.create(D)},factory:s};return l.default})(),D.exports=l()},12839:(D,l,G)=>{"use strict";const{Deflate:V,deflate:N,deflateRaw:M,gzip:b}=G(12846),{Inflate:X,inflate:t,inflateRaw:R,ungzip:n}=G(12903),g=G(12886);D.exports.Deflate=V,D.exports.deflate=N,D.exports.deflateRaw=M,D.exports.gzip=b,D.exports.Inflate=X,D.exports.inflate=t,D.exports.inflateRaw=R,D.exports.ungzip=n,D.exports.constants=g},12846:(D,l,G)=>{"use strict";const V=G(12855),N=G(12888),M=G(12890),b=G(12877),X=G(12899),t=Object.prototype.toString,{Z_NO_FLUSH:R,Z_SYNC_FLUSH:n,Z_FULL_FLUSH:g,Z_FINISH:j,Z_OK:e,Z_STREAM_END:K,Z_DEFAULT_COMPRESSION:F,Z_DEFAULT_STRATEGY:d,Z_DEFLATED:H}=G(12886);function h(D){this.options=N.assign({level:F,method:H,ZD:16384,windowBits:15,memLevel:8,strategy:d},D||{});let l=this.options;l.raw&&l.windowBits>0?l.windowBits=-l.windowBits:l.gzip&&l.windowBits>0&&l.windowBits<16&&(l.windowBits+=16),this.err=0,this.Rl="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let G=V.deflateInit2(this.strm,l.level,l.method,l.windowBits,l.memLevel,l.strategy);if(G!==e)throw new Error(b[G]);if(l.header&&V.deflateSetHeader(this.strm,l.header),l.dictionary){let D;if(D="string"===typeof l.dictionary?M.string2buf(l.dictionary):"[object ArrayBuffer]"===t.call(l.dictionary)?new Uint8Array(l.dictionary):l.dictionary,G=V.deflateSetDictionary(this.strm,D),G!==e)throw new Error(b[G]);this._dict_set=!0}}function x(D,l){const G=new h(l);if(G.push(D,!0),G.err)throw G.Rl||b[G.err];return G.result}h.prototype.push=function(D,l){const G=this.strm,N=this.options.ZD;let b,X;if(this.ended)return!1;for(X=l===~~l?l:!0===l?j:R,"string"===typeof D?G.input=M.string2buf(D):"[object ArrayBuffer]"===t.call(D)?G.input=new Uint8Array(D):G.input=D,G.next_in=0,G.avail_in=G.input.length;;)if(0===G.avail_out&&(G.output=new Uint8Array(N),G.next_out=0,G.avail_out=N),(X===n||X===g)&&G.avail_out<=6)this.onData(G.output.subarray(0,G.next_out)),G.avail_out=0;else{if(b=V.deflate(G,X),b===K)return G.next_out>0&&this.onData(G.output.subarray(0,G.next_out)),b=V.deflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===e;if(0!==G.avail_out){if(X>0&&G.next_out>0)this.onData(G.output.subarray(0,G.next_out)),G.avail_out=0;else if(0===G.avail_in)break}else this.onData(G.output)}return!0},h.prototype.onData=function(D){this.chunks.push(D)},h.prototype.onEnd=function(D){D===e&&(this.result=N.flattenChunks(this.chunks)),this.chunks=[],this.err=D,this.Rl=this.strm.Rl},D.exports.Deflate=h,D.exports.deflate=x,D.exports.deflateRaw=function(D,l){return(l=l||{}).raw=!0,x(D,l)},D.exports.gzip=function(D,l){return(l=l||{}).gzip=!0,x(D,l)},D.exports.constants=G(12886)},12903:(D,l,G)=>{"use strict";const V=G(12912),N=G(12888),M=G(12890),b=G(12877),X=G(12899),t=G(12929),R=Object.prototype.toString,{Z_NO_FLUSH:n,Z_FINISH:g,Z_OK:j,Z_STREAM_END:e,Z_NEED_DICT:K,Z_STREAM_ERROR:F,Z_DATA_ERROR:d,Z_MEM_ERROR:H}=G(12886);function h(D){this.options=N.assign({ZD:65536,windowBits:15,to:""},D||{});const l=this.options;l.raw&&l.windowBits>=0&&l.windowBits<16&&(l.windowBits=-l.windowBits,0===l.windowBits&&(l.windowBits=-15)),!(l.windowBits>=0&&l.windowBits<16)||D&&D.windowBits||(l.windowBits+=32),l.windowBits>15&&l.windowBits<48&&0===(15&l.windowBits)&&(l.windowBits|=15),this.err=0,this.Rl="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let G=V.inflateInit2(this.strm,l.windowBits);if(G!==j)throw new Error(b[G]);if(this.header=new t,V.inflateGetHeader(this.strm,this.header),l.dictionary&&("string"===typeof l.dictionary?l.dictionary=M.string2buf(l.dictionary):"[object ArrayBuffer]"===R.call(l.dictionary)&&(l.dictionary=new Uint8Array(l.dictionary)),l.raw&&(G=V.inflateSetDictionary(this.strm,l.dictionary),G!==j)))throw new Error(b[G])}function x(D,l){const G=new h(l);if(G.push(D),G.err)throw G.Rl||b[G.err];return G.result}h.prototype.push=function(D,l){const G=this.strm,N=this.options.ZD,b=this.options.dictionary;let X,t,h;if(this.ended)return!1;for(t=l===~~l?l:!0===l?g:n,"[object ArrayBuffer]"===R.call(D)?G.input=new Uint8Array(D):G.input=D,G.next_in=0,G.avail_in=G.input.length;;){for(0===G.avail_out&&(G.output=new Uint8Array(N),G.next_out=0,G.avail_out=N),X=V.inflate(G,t),X===K&&b&&(X=V.inflateSetDictionary(G,b),X===j?X=V.inflate(G,t):X===d&&(X=K));G.avail_in>0&&X===e&&G.state.wrap>0&&0!==D[G.next_in];)V.inflateReset(G),X=V.inflate(G,t);switch(X){case F:case d:case K:case H:return this.onEnd(X),this.ended=!0,!1}if(h=G.avail_out,G.next_out&&(0===G.avail_out||X===e))if("string"===this.options.to){let D=M.utf8border(G.output,G.next_out),l=G.next_out-D,V=M.buf2string(G.output,D);G.next_out=l,G.avail_out=N-l,l&&G.output.set(G.output.subarray(D,D+l),0),this.onData(V)}else this.onData(G.output.length===G.next_out?G.output:G.output.subarray(0,G.next_out));if(X!==j||0!==h){if(X===e)return X=V.inflateEnd(this.strm),this.onEnd(X),this.ended=!0,!0;if(0===G.avail_in)break}}return!0},h.prototype.onData=function(D){this.chunks.push(D)},h.prototype.onEnd=function(D){D===j&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=N.flattenChunks(this.chunks)),this.chunks=[],this.err=D,this.Rl=this.strm.Rl},D.exports.Inflate=h,D.exports.inflate=x,D.exports.inflateRaw=function(D,l){return(l=l||{}).raw=!0,x(D,l)},D.exports.ungzip=x,D.exports.constants=G(12886)},12888:D=>{"use strict";const l=(D,l)=>Object.prototype.hasOwnProperty.call(D,l);D.exports.assign=function(D){const G=Array.prototype.slice.call(arguments,1);for(;G.length;){const V=G.shift();if(V){if("object"!==typeof V)throw new TypeError(V+"must be non-object");for(const G in V)l(V,G)&&(D[G]=V[G])}}return D},D.exports.flattenChunks=D=>{let l=0;for(let V=0,N=D.length;V<N;V++)l+=D[V].length;const G=new Uint8Array(l);for(let V=0,N=0,M=D.length;V<M;V++){let l=D[V];G.set(l,N),N+=l.length}return G}},12890:D=>{"use strict";let l=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(V){l=!1}const G=new Uint8Array(256);for(let N=0;N<256;N++)G[N]=N>=252?6:N>=248?5:N>=240?4:N>=224?3:N>=192?2:1;G[254]=G[254]=1,D.exports.string2buf=D=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(D);let l,G,V,N,M,b=D.length,X=0;for(N=0;N<b;N++)G=D.charCodeAt(N),55296===(64512&G)&&N+1<b&&(V=D.charCodeAt(N+1),56320===(64512&V)&&(G=65536+(G-55296<<10)+(V-56320),N++)),X+=G<128?1:G<2048?2:G<65536?3:4;for(l=new Uint8Array(X),M=0,N=0;M<X;N++)G=D.charCodeAt(N),55296===(64512&G)&&N+1<b&&(V=D.charCodeAt(N+1),56320===(64512&V)&&(G=65536+(G-55296<<10)+(V-56320),N++)),G<128?l[M++]=G:G<2048?(l[M++]=192|G>>>6,l[M++]=128|63&G):G<65536?(l[M++]=224|G>>>12,l[M++]=128|G>>>6&63,l[M++]=128|63&G):(l[M++]=240|G>>>18,l[M++]=128|G>>>12&63,l[M++]=128|G>>>6&63,l[M++]=128|63&G);return l};D.exports.buf2string=(D,V)=>{const N=V||D.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(D.subarray(0,V));let M,b;const X=new Array(2*N);for(b=0,M=0;M<N;){let l=D[M++];if(l<128){X[b++]=l;continue}let V=G[l];if(V>4)X[b++]=65533,M+=V-1;else{for(l&=2===V?31:3===V?15:7;V>1&&M<N;)l=l<<6|63&D[M++],V--;V>1?X[b++]=65533:l<65536?X[b++]=l:(l-=65536,X[b++]=55296|l>>10&1023,X[b++]=56320|1023&l)}}return((D,G)=>{if(G<65534&&D.subarray&&l)return String.fromCharCode.apply(null,D.length===G?D:D.subarray(0,G));let V="";for(let l=0;l<G;l++)V+=String.fromCharCode(D[l]);return V})(X,b)},D.exports.utf8border=(D,l)=>{(l=l||D.length)>D.length&&(l=D.length);let V=l-1;for(;V>=0&&128===(192&D[V]);)V--;return V<0||0===V?l:V+G[D[V]]>l?V:l}},12864:D=>{"use strict";D.exports=(D,l,G,V)=>{let N=65535&D,M=D>>>16&65535,b=0;for(;0!==G;){b=G>2e3?2e3:G,G-=b;do{N=N+l[V++]|0,M=M+N|0}while(--b);N%=65521,M%=65521}return N|M<<16}},12886:D=>{"use strict";D.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12871:D=>{"use strict";const l=new Uint32Array((()=>{let D,l=[];for(var G=0;G<256;G++){D=G;for(var V=0;V<8;V++)D=1&D?3988292384^D>>>1:D>>>1;l[G]=D}return l})());D.exports=(D,G,V,N)=>{const M=l,b=N+V;D^=-1;for(let l=N;l<b;l++)D=D>>>8^M[255&(D^G[l])];return~D}},12855:(D,l,G)=>{"use strict";const{_tr_init:V,_tr_stored_block:N,_tr_flush_block:M,_tr_tally:b,_tr_align:X}=G(12858),t=G(12864),R=G(12871),n=G(12877),{Z_NO_FLUSH:g,Z_PARTIAL_FLUSH:j,Z_FULL_FLUSH:e,Z_FINISH:K,Z_BLOCK:F,Z_OK:d,Z_STREAM_END:H,Z_STREAM_ERROR:h,Z_DATA_ERROR:x,Z_BUF_ERROR:r,Z_DEFAULT_COMPRESSION:o,Z_FILTERED:L,Z_HUFFMAN_ONLY:u,Z_RLE:B,Z_FIXED:I,Z_DEFAULT_STRATEGY:W,Z_UNKNOWN:i,Z_DEFLATED:y}=G(12886),S=258,O=262,s=103,U=113,f=666,q=(D,l)=>(D.Rl=n[l],l),c=D=>(D<<1)-(D>4?9:0),v=D=>{let l=D.length;for(;--l>=0;)D[l]=0};let Z=(D,l,G)=>(l<<D.hash_shift^G)&D.hash_mask;const J=D=>{const l=D.state;let G=l.pending;G>D.avail_out&&(G=D.avail_out),0!==G&&(D.output.set(l.pending_buf.subarray(l.pending_out,l.pending_out+G),D.next_out),D.next_out+=G,l.pending_out+=G,D.total_out+=G,D.avail_out-=G,l.pending-=G,0===l.pending&&(l.pending_out=0))},Y=(D,l)=>{M(D,D.block_start>=0?D.block_start:-1,D.strstart-D.block_start,l),D.block_start=D.strstart,J(D.strm)},z=(D,l)=>{D.pending_buf[D.pending++]=l},E=(D,l)=>{D.pending_buf[D.pending++]=l>>>8&255,D.pending_buf[D.pending++]=255&l},P=(D,l,G,V)=>{let N=D.avail_in;return N>V&&(N=V),0===N?0:(D.avail_in-=N,l.set(D.input.subarray(D.next_in,D.next_in+N),G),1===D.state.wrap?D.adler=t(D.adler,l,N,G):2===D.state.wrap&&(D.adler=R(D.adler,l,N,G)),D.next_in+=N,D.total_in+=N,N)},p=(D,l)=>{let G,V,N=D.max_chain_length,M=D.strstart,b=D.prev_length,X=D.nice_match;const t=D.strstart>D.w_size-O?D.strstart-(D.w_size-O):0,R=D.window,n=D.w_mask,g=D.prev,j=D.strstart+S;let e=R[M+b-1],K=R[M+b];D.prev_length>=D.good_match&&(N>>=2),X>D.lookahead&&(X=D.lookahead);do{if(G=l,R[G+b]===K&&R[G+b-1]===e&&R[G]===R[M]&&R[++G]===R[M+1]){M+=2,G++;do{}while(R[++M]===R[++G]&&R[++M]===R[++G]&&R[++M]===R[++G]&&R[++M]===R[++G]&&R[++M]===R[++G]&&R[++M]===R[++G]&&R[++M]===R[++G]&&R[++M]===R[++G]&&M<j);if(V=S-(j-M),M=j-S,V>b){if(D.match_start=l,b=V,V>=X)break;e=R[M+b-1],K=R[M+b]}}}while((l=g[l&n])>t&&0!==--N);return b<=D.lookahead?b:D.lookahead},k=D=>{const l=D.w_size;let G,V,N,M,b;do{if(M=D.window_size-D.lookahead-D.strstart,D.strstart>=l+(l-O)){D.window.set(D.window.subarray(l,l+l),0),D.match_start-=l,D.strstart-=l,D.block_start-=l,V=D.hash_size,G=V;do{N=D.head[--G],D.head[G]=N>=l?N-l:0}while(--V);V=l,G=V;do{N=D.prev[--G],D.prev[G]=N>=l?N-l:0}while(--V);M+=l}if(0===D.strm.avail_in)break;if(V=P(D.strm,D.window,D.strstart+D.lookahead,M),D.lookahead+=V,D.lookahead+D.insert>=3)for(b=D.strstart-D.insert,D.ins_h=D.window[b],D.ins_h=Z(D,D.ins_h,D.window[b+1]);D.insert&&(D.ins_h=Z(D,D.ins_h,D.window[b+3-1]),D.prev[b&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=b,b++,D.insert--,!(D.lookahead+D.insert<3)););}while(D.lookahead<O&&0!==D.strm.avail_in)},m=(D,l)=>{let G,V;for(;;){if(D.lookahead<O){if(k(D),D.lookahead<O&&l===g)return 1;if(0===D.lookahead)break}if(G=0,D.lookahead>=3&&(D.ins_h=Z(D,D.ins_h,D.window[D.strstart+3-1]),G=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart),0!==G&&D.strstart-G<=D.w_size-O&&(D.match_length=p(D,G)),D.match_length>=3)if(V=b(D,D.strstart-D.match_start,D.match_length-3),D.lookahead-=D.match_length,D.match_length<=D.max_lazy_match&&D.lookahead>=3){D.match_length--;do{D.strstart++,D.ins_h=Z(D,D.ins_h,D.window[D.strstart+3-1]),G=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart}while(0!==--D.match_length);D.strstart++}else D.strstart+=D.match_length,D.match_length=0,D.ins_h=D.window[D.strstart],D.ins_h=Z(D,D.ins_h,D.window[D.strstart+1]);else V=b(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++;if(V&&(Y(D,!1),0===D.strm.avail_out))return 1}return D.insert=D.strstart<2?D.strstart:2,l===K?(Y(D,!0),0===D.strm.avail_out?3:4):D.last_lit&&(Y(D,!1),0===D.strm.avail_out)?1:2},T=(D,l)=>{let G,V,N;for(;;){if(D.lookahead<O){if(k(D),D.lookahead<O&&l===g)return 1;if(0===D.lookahead)break}if(G=0,D.lookahead>=3&&(D.ins_h=Z(D,D.ins_h,D.window[D.strstart+3-1]),G=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart),D.prev_length=D.match_length,D.prev_match=D.match_start,D.match_length=2,0!==G&&D.prev_length<D.max_lazy_match&&D.strstart-G<=D.w_size-O&&(D.match_length=p(D,G),D.match_length<=5&&(D.strategy===L||3===D.match_length&&D.strstart-D.match_start>4096)&&(D.match_length=2)),D.prev_length>=3&&D.match_length<=D.prev_length){N=D.strstart+D.lookahead-3,V=b(D,D.strstart-1-D.prev_match,D.prev_length-3),D.lookahead-=D.prev_length-1,D.prev_length-=2;do{++D.strstart<=N&&(D.ins_h=Z(D,D.ins_h,D.window[D.strstart+3-1]),G=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart)}while(0!==--D.prev_length);if(D.match_available=0,D.match_length=2,D.strstart++,V&&(Y(D,!1),0===D.strm.avail_out))return 1}else if(D.match_available){if(V=b(D,0,D.window[D.strstart-1]),V&&Y(D,!1),D.strstart++,D.lookahead--,0===D.strm.avail_out)return 1}else D.match_available=1,D.strstart++,D.lookahead--}return D.match_available&&(V=b(D,0,D.window[D.strstart-1]),D.match_available=0),D.insert=D.strstart<2?D.strstart:2,l===K?(Y(D,!0),0===D.strm.avail_out?3:4):D.last_lit&&(Y(D,!1),0===D.strm.avail_out)?1:2};function C(D,l,G,V,N){this.good_length=D,this.max_lazy=l,this.nice_length=G,this.max_chain=V,this.func=N}const w=[new C(0,0,0,0,((D,l)=>{let G=65535;for(G>D.pending_buf_size-5&&(G=D.pending_buf_size-5);;){if(D.lookahead<=1){if(k(D),0===D.lookahead&&l===g)return 1;if(0===D.lookahead)break}D.strstart+=D.lookahead,D.lookahead=0;const V=D.block_start+G;if((0===D.strstart||D.strstart>=V)&&(D.lookahead=D.strstart-V,D.strstart=V,Y(D,!1),0===D.strm.avail_out))return 1;if(D.strstart-D.block_start>=D.w_size-O&&(Y(D,!1),0===D.strm.avail_out))return 1}return D.insert=0,l===K?(Y(D,!0),0===D.strm.avail_out?3:4):(D.strstart>D.block_start&&(Y(D,!1),D.strm.avail_out),1)})),new C(4,4,8,4,m),new C(4,5,16,8,m),new C(4,6,32,32,m),new C(4,4,16,16,T),new C(8,16,32,32,T),new C(8,16,128,128,T),new C(8,32,128,256,T),new C(32,128,258,1024,T),new C(32,258,258,4096,T)];function A(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),v(this.dyn_ltree),v(this.dyn_dtree),v(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),v(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),v(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const a=D=>{if(!D||!D.state)return q(D,h);D.total_in=D.total_out=0,D.data_type=i;const l=D.state;return l.pending=0,l.pending_out=0,l.wrap<0&&(l.wrap=-l.wrap),l.status=l.wrap?42:U,D.adler=2===l.wrap?0:1,l.last_flush=g,V(l),d},Q=D=>{const l=a(D);var G;return l===d&&((G=D.state).window_size=2*G.w_size,v(G.head),G.max_lazy_match=w[G.level].max_lazy,G.good_match=w[G.level].good_length,G.nice_match=w[G.level].nice_length,G.max_chain_length=w[G.level].max_chain,G.strstart=0,G.block_start=0,G.lookahead=0,G.insert=0,G.match_length=G.prev_length=2,G.match_available=0,G.ins_h=0),l},DD=(D,l,G,V,N,M)=>{if(!D)return h;let b=1;if(l===o&&(l=6),V<0?(b=0,V=-V):V>15&&(b=2,V-=16),N<1||N>9||G!==y||V<8||V>15||l<0||l>9||M<0||M>I)return q(D,h);8===V&&(V=9);const X=new A;return D.state=X,X.strm=D,X.wrap=b,X.gzhead=null,X.w_bits=V,X.w_size=1<<X.w_bits,X.w_mask=X.w_size-1,X.hash_bits=N+7,X.hash_size=1<<X.hash_bits,X.hash_mask=X.hash_size-1,X.hash_shift=~~((X.hash_bits+3-1)/3),X.window=new Uint8Array(2*X.w_size),X.head=new Uint16Array(X.hash_size),X.prev=new Uint16Array(X.w_size),X.lit_bufsize=1<<N+6,X.pending_buf_size=4*X.lit_bufsize,X.pending_buf=new Uint8Array(X.pending_buf_size),X.d_buf=1*X.lit_bufsize,X.l_buf=3*X.lit_bufsize,X.level=l,X.strategy=M,X.method=G,Q(D)};D.exports.deflateInit=(D,l)=>DD(D,l,y,15,8,W),D.exports.deflateInit2=DD,D.exports.deflateReset=Q,D.exports.deflateResetKeep=a,D.exports.deflateSetHeader=(D,l)=>D&&D.state?2!==D.state.wrap?h:(D.state.gzhead=l,d):h,D.exports.deflate=(D,l)=>{let G,V;if(!D||!D.state||l>F||l<0)return D?q(D,h):h;const M=D.state;if(!D.output||!D.input&&0!==D.avail_in||M.status===f&&l!==K)return q(D,0===D.avail_out?r:h);M.strm=D;const t=M.last_flush;if(M.last_flush=l,42===M.status)if(2===M.wrap)D.adler=0,z(M,31),z(M,139),z(M,8),M.gzhead?(z(M,(M.gzhead.text?1:0)+(M.gzhead.hcrc?2:0)+(M.gzhead.extra?4:0)+(M.gzhead.name?8:0)+(M.gzhead.comment?16:0)),z(M,255&M.gzhead.time),z(M,M.gzhead.time>>8&255),z(M,M.gzhead.time>>16&255),z(M,M.gzhead.time>>24&255),z(M,9===M.level?2:M.strategy>=u||M.level<2?4:0),z(M,255&M.gzhead.os),M.gzhead.extra&&M.gzhead.extra.length&&(z(M,255&M.gzhead.extra.length),z(M,M.gzhead.extra.length>>8&255)),M.gzhead.hcrc&&(D.adler=R(D.adler,M.pending_buf,M.pending,0)),M.gzindex=0,M.status=69):(z(M,0),z(M,0),z(M,0),z(M,0),z(M,0),z(M,9===M.level?2:M.strategy>=u||M.level<2?4:0),z(M,3),M.status=U);else{let l=y+(M.w_bits-8<<4)<<8,G=-1;G=M.strategy>=u||M.level<2?0:M.level<6?1:6===M.level?2:3,l|=G<<6,0!==M.strstart&&(l|=32),l+=31-l%31,M.status=U,E(M,l),0!==M.strstart&&(E(M,D.adler>>>16),E(M,65535&D.adler)),D.adler=1}if(69===M.status)if(M.gzhead.extra){for(G=M.pending;M.gzindex<(65535&M.gzhead.extra.length)&&(M.pending!==M.pending_buf_size||(M.gzhead.hcrc&&M.pending>G&&(D.adler=R(D.adler,M.pending_buf,M.pending-G,G)),J(D),G=M.pending,M.pending!==M.pending_buf_size));)z(M,255&M.gzhead.extra[M.gzindex]),M.gzindex++;M.gzhead.hcrc&&M.pending>G&&(D.adler=R(D.adler,M.pending_buf,M.pending-G,G)),M.gzindex===M.gzhead.extra.length&&(M.gzindex=0,M.status=73)}else M.status=73;if(73===M.status)if(M.gzhead.name){G=M.pending;do{if(M.pending===M.pending_buf_size&&(M.gzhead.hcrc&&M.pending>G&&(D.adler=R(D.adler,M.pending_buf,M.pending-G,G)),J(D),G=M.pending,M.pending===M.pending_buf_size)){V=1;break}V=M.gzindex<M.gzhead.name.length?255&M.gzhead.name.charCodeAt(M.gzindex++):0,z(M,V)}while(0!==V);M.gzhead.hcrc&&M.pending>G&&(D.adler=R(D.adler,M.pending_buf,M.pending-G,G)),0===V&&(M.gzindex=0,M.status=91)}else M.status=91;if(91===M.status)if(M.gzhead.comment){G=M.pending;do{if(M.pending===M.pending_buf_size&&(M.gzhead.hcrc&&M.pending>G&&(D.adler=R(D.adler,M.pending_buf,M.pending-G,G)),J(D),G=M.pending,M.pending===M.pending_buf_size)){V=1;break}V=M.gzindex<M.gzhead.comment.length?255&M.gzhead.comment.charCodeAt(M.gzindex++):0,z(M,V)}while(0!==V);M.gzhead.hcrc&&M.pending>G&&(D.adler=R(D.adler,M.pending_buf,M.pending-G,G)),0===V&&(M.status=s)}else M.status=s;if(M.status===s&&(M.gzhead.hcrc?(M.pending+2>M.pending_buf_size&&J(D),M.pending+2<=M.pending_buf_size&&(z(M,255&D.adler),z(M,D.adler>>8&255),D.adler=0,M.status=U)):M.status=U),0!==M.pending){if(J(D),0===D.avail_out)return M.last_flush=-1,d}else if(0===D.avail_in&&c(l)<=c(t)&&l!==K)return q(D,r);if(M.status===f&&0!==D.avail_in)return q(D,r);if(0!==D.avail_in||0!==M.lookahead||l!==g&&M.status!==f){let G=M.strategy===u?((D,l)=>{let G;for(;;){if(0===D.lookahead&&(k(D),0===D.lookahead)){if(l===g)return 1;break}if(D.match_length=0,G=b(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,G&&(Y(D,!1),0===D.strm.avail_out))return 1}return D.insert=0,l===K?(Y(D,!0),0===D.strm.avail_out?3:4):D.last_lit&&(Y(D,!1),0===D.strm.avail_out)?1:2})(M,l):M.strategy===B?((D,l)=>{let G,V,N,M;const X=D.window;for(;;){if(D.lookahead<=S){if(k(D),D.lookahead<=S&&l===g)return 1;if(0===D.lookahead)break}if(D.match_length=0,D.lookahead>=3&&D.strstart>0&&(N=D.strstart-1,V=X[N],V===X[++N]&&V===X[++N]&&V===X[++N])){M=D.strstart+S;do{}while(V===X[++N]&&V===X[++N]&&V===X[++N]&&V===X[++N]&&V===X[++N]&&V===X[++N]&&V===X[++N]&&V===X[++N]&&N<M);D.match_length=S-(M-N),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=3?(G=b(D,1,D.match_length-3),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(G=b(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),G&&(Y(D,!1),0===D.strm.avail_out))return 1}return D.insert=0,l===K?(Y(D,!0),0===D.strm.avail_out?3:4):D.last_lit&&(Y(D,!1),0===D.strm.avail_out)?1:2})(M,l):w[M.level].func(M,l);if(3!==G&&4!==G||(M.status=f),1===G||3===G)return 0===D.avail_out&&(M.last_flush=-1),d;if(2===G&&(l===j?X(M):l!==F&&(N(M,0,0,!1),l===e&&(v(M.head),0===M.lookahead&&(M.strstart=0,M.block_start=0,M.insert=0))),J(D),0===D.avail_out))return M.last_flush=-1,d}return l!==K?d:M.wrap<=0?H:(2===M.wrap?(z(M,255&D.adler),z(M,D.adler>>8&255),z(M,D.adler>>16&255),z(M,D.adler>>24&255),z(M,255&D.total_in),z(M,D.total_in>>8&255),z(M,D.total_in>>16&255),z(M,D.total_in>>24&255)):(E(M,D.adler>>>16),E(M,65535&D.adler)),J(D),M.wrap>0&&(M.wrap=-M.wrap),0!==M.pending?d:H)},D.exports.deflateEnd=D=>{if(!D||!D.state)return h;const l=D.state.status;return 42!==l&&69!==l&&73!==l&&91!==l&&l!==s&&l!==U&&l!==f?q(D,h):(D.state=null,l===U?q(D,x):d)},D.exports.deflateSetDictionary=(D,l)=>{let G=l.length;if(!D||!D.state)return h;const V=D.state,N=V.wrap;if(2===N||1===N&&42!==V.status||V.lookahead)return h;if(1===N&&(D.adler=t(D.adler,l,G,0)),V.wrap=0,G>=V.w_size){0===N&&(v(V.head),V.strstart=0,V.block_start=0,V.insert=0);let D=new Uint8Array(V.w_size);D.set(l.subarray(G-V.w_size,G),0),l=D,G=V.w_size}const M=D.avail_in,b=D.next_in,X=D.input;for(D.avail_in=G,D.next_in=0,D.input=l,k(V);V.lookahead>=3;){let D=V.strstart,l=V.lookahead-2;do{V.ins_h=Z(V,V.ins_h,V.window[D+3-1]),V.prev[D&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=D,D++}while(--l);V.strstart=D,V.lookahead=2,k(V)}return V.strstart+=V.lookahead,V.block_start=V.strstart,V.insert=V.lookahead,V.lookahead=0,V.match_length=V.prev_length=2,V.match_available=0,D.next_in=b,D.input=X,D.avail_in=M,V.wrap=N,d},D.exports.deflateInfo="pako deflate (from Nodeca project)"},12929:D=>{"use strict";D.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12920:D=>{"use strict";D.exports=function(D,l){let G,V,N,M,b,X,t,R,n,g,j,e,K,F,d,H,h,x,r,o,L,u,B,I;const W=D.state;G=D.next_in,B=D.input,V=G+(D.avail_in-5),N=D.next_out,I=D.output,M=N-(l-D.avail_out),b=N+(D.avail_out-257),X=W.dmax,t=W.wsize,R=W.whave,n=W.wnext,g=W.window,j=W.hold,e=W.bits,K=W.lencode,F=W.distcode,d=(1<<W.lenbits)-1,H=(1<<W.distbits)-1;D:do{e<15&&(j+=B[G++]<<e,e+=8,j+=B[G++]<<e,e+=8),h=K[j&d];l:for(;;){if(x=h>>>24,j>>>=x,e-=x,x=h>>>16&255,0===x)I[N++]=65535&h;else{if(!(16&x)){if(0===(64&x)){h=K[(65535&h)+(j&(1<<x)-1)];continue l}if(32&x){W.mode=12;break D}D.Rl="invalid literal/length code",W.mode=30;break D}r=65535&h,x&=15,x&&(e<x&&(j+=B[G++]<<e,e+=8),r+=j&(1<<x)-1,j>>>=x,e-=x),e<15&&(j+=B[G++]<<e,e+=8,j+=B[G++]<<e,e+=8),h=F[j&H];G:for(;;){if(x=h>>>24,j>>>=x,e-=x,x=h>>>16&255,!(16&x)){if(0===(64&x)){h=F[(65535&h)+(j&(1<<x)-1)];continue G}D.Rl="invalid distance code",W.mode=30;break D}if(o=65535&h,x&=15,e<x&&(j+=B[G++]<<e,e+=8,e<x&&(j+=B[G++]<<e,e+=8)),o+=j&(1<<x)-1,o>X){D.Rl="invalid distance too far back",W.mode=30;break D}if(j>>>=x,e-=x,x=N-M,o>x){if(x=o-x,x>R&&W.sane){D.Rl="invalid distance too far back",W.mode=30;break D}if(L=0,u=g,0===n){if(L+=t-x,x<r){r-=x;do{I[N++]=g[L++]}while(--x);L=N-o,u=I}}else if(n<x){if(L+=t+n-x,x-=n,x<r){r-=x;do{I[N++]=g[L++]}while(--x);if(L=0,n<r){x=n,r-=x;do{I[N++]=g[L++]}while(--x);L=N-o,u=I}}}else if(L+=n-x,x<r){r-=x;do{I[N++]=g[L++]}while(--x);L=N-o,u=I}for(;r>2;)I[N++]=u[L++],I[N++]=u[L++],I[N++]=u[L++],r-=3;r&&(I[N++]=u[L++],r>1&&(I[N++]=u[L++]))}else{L=N-o;do{I[N++]=I[L++],I[N++]=I[L++],I[N++]=I[L++],r-=3}while(r>2);r&&(I[N++]=I[L++],r>1&&(I[N++]=I[L++]))}break}}break}}while(G<V&&N<b);r=e>>3,G-=r,e-=r<<3,j&=(1<<e)-1,D.next_in=G,D.next_out=N,D.avail_in=G<V?V-G+5:5-(G-V),D.avail_out=N<b?b-N+257:257-(N-b),W.hold=j,W.bits=e}},12912:(D,l,G)=>{"use strict";const V=G(12864),N=G(12871),M=G(12920),b=G(12923),{Z_FINISH:X,Z_BLOCK:t,Z_TREES:R,Z_OK:n,Z_STREAM_END:g,Z_NEED_DICT:j,Z_STREAM_ERROR:e,Z_DATA_ERROR:K,Z_MEM_ERROR:F,Z_BUF_ERROR:d,Z_DEFLATED:H}=G(12886),h=12,x=30,r=D=>(D>>>24&255)+(D>>>8&65280)+((65280&D)<<8)+((255&D)<<24);function o(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const L=D=>{if(!D||!D.state)return e;const l=D.state;return D.total_in=D.total_out=l.total=0,D.Rl="",l.wrap&&(D.adler=1&l.wrap),l.mode=1,l.last=0,l.havedict=0,l.dmax=32768,l.head=null,l.hold=0,l.bits=0,l.lencode=l.lendyn=new Int32Array(852),l.distcode=l.distdyn=new Int32Array(592),l.sane=1,l.back=-1,n},u=D=>{if(!D||!D.state)return e;const l=D.state;return l.wsize=0,l.whave=0,l.wnext=0,L(D)},B=(D,l)=>{let G;if(!D||!D.state)return e;const V=D.state;return l<0?(G=0,l=-l):(G=1+(l>>4),l<48&&(l&=15)),l&&(l<8||l>15)?e:(null!==V.window&&V.wbits!==l&&(V.window=null),V.wrap=G,V.wbits=l,u(D))},I=(D,l)=>{if(!D)return e;const G=new o;D.state=G,G.window=null;const V=B(D,l);return V!==n&&(D.state=null),V};let W,i,y=!0;const S=D=>{if(y){W=new Int32Array(512),i=new Int32Array(32);let l=0;for(;l<144;)D.lens[l++]=8;for(;l<256;)D.lens[l++]=9;for(;l<280;)D.lens[l++]=7;for(;l<288;)D.lens[l++]=8;for(b(1,D.lens,0,288,W,0,D.work,{bits:9}),l=0;l<32;)D.lens[l++]=5;b(2,D.lens,0,32,i,0,D.work,{bits:5}),y=!1}D.lencode=W,D.lenbits=9,D.distcode=i,D.distbits=5},O=(D,l,G,V)=>{let N;const M=D.state;return null===M.window&&(M.wsize=1<<M.wbits,M.wnext=0,M.whave=0,M.window=new Uint8Array(M.wsize)),V>=M.wsize?(M.window.set(l.subarray(G-M.wsize,G),0),M.wnext=0,M.whave=M.wsize):(N=M.wsize-M.wnext,N>V&&(N=V),M.window.set(l.subarray(G-V,G-V+N),M.wnext),(V-=N)?(M.window.set(l.subarray(G-V,G),0),M.wnext=V,M.whave=M.wsize):(M.wnext+=N,M.wnext===M.wsize&&(M.wnext=0),M.whave<M.wsize&&(M.whave+=N))),0};D.exports.inflateReset=u,D.exports.inflateReset2=B,D.exports.inflateResetKeep=L,D.exports.inflateInit=D=>I(D,15),D.exports.inflateInit2=I,D.exports.inflate=(D,l)=>{let G,o,L,u,B,I,W,i,y,s,U,f,q,c,v,Z,J,Y,z,E,P,p,k=0;const m=new Uint8Array(4);let T,C;const w=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!D||!D.state||!D.output||!D.input&&0!==D.avail_in)return e;G=D.state,G.mode===h&&(G.mode=13),B=D.next_out,L=D.output,W=D.avail_out,u=D.next_in,o=D.input,I=D.avail_in,i=G.hold,y=G.bits,s=I,U=W,p=n;D:for(;;)switch(G.mode){case 1:if(0===G.wrap){G.mode=13;break}for(;y<16;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}if(2&G.wrap&&35615===i){G.check=0,m[0]=255&i,m[1]=i>>>8&255,G.check=N(G.check,m,2,0),i=0,y=0,G.mode=2;break}if(G.flags=0,G.head&&(G.head.done=!1),!(1&G.wrap)||(((255&i)<<8)+(i>>8))%31){D.Rl="incorrect header check",G.mode=x;break}if((15&i)!==H){D.Rl="unknown compression method",G.mode=x;break}if(i>>>=4,y-=4,P=8+(15&i),0===G.wbits)G.wbits=P;else if(P>G.wbits){D.Rl="invalid window size",G.mode=x;break}G.dmax=1<<G.wbits,D.adler=G.check=1,G.mode=512&i?10:h,i=0,y=0;break;case 2:for(;y<16;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}if(G.flags=i,(255&G.flags)!==H){D.Rl="unknown compression method",G.mode=x;break}if(57344&G.flags){D.Rl="unknown header flags set",G.mode=x;break}G.head&&(G.head.text=i>>8&1),512&G.flags&&(m[0]=255&i,m[1]=i>>>8&255,G.check=N(G.check,m,2,0)),i=0,y=0,G.mode=3;case 3:for(;y<32;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}G.head&&(G.head.time=i),512&G.flags&&(m[0]=255&i,m[1]=i>>>8&255,m[2]=i>>>16&255,m[3]=i>>>24&255,G.check=N(G.check,m,4,0)),i=0,y=0,G.mode=4;case 4:for(;y<16;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}G.head&&(G.head.xflags=255&i,G.head.os=i>>8),512&G.flags&&(m[0]=255&i,m[1]=i>>>8&255,G.check=N(G.check,m,2,0)),i=0,y=0,G.mode=5;case 5:if(1024&G.flags){for(;y<16;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}G.length=i,G.head&&(G.head.extra_len=i),512&G.flags&&(m[0]=255&i,m[1]=i>>>8&255,G.check=N(G.check,m,2,0)),i=0,y=0}else G.head&&(G.head.extra=null);G.mode=6;case 6:if(1024&G.flags&&(f=G.length,f>I&&(f=I),f&&(G.head&&(P=G.head.extra_len-G.length,G.head.extra||(G.head.extra=new Uint8Array(G.head.extra_len)),G.head.extra.set(o.subarray(u,u+f),P)),512&G.flags&&(G.check=N(G.check,o,f,u)),I-=f,u+=f,G.length-=f),G.length))break D;G.length=0,G.mode=7;case 7:if(2048&G.flags){if(0===I)break D;f=0;do{P=o[u+f++],G.head&&P&&G.length<65536&&(G.head.name+=String.fromCharCode(P))}while(P&&f<I);if(512&G.flags&&(G.check=N(G.check,o,f,u)),I-=f,u+=f,P)break D}else G.head&&(G.head.name=null);G.length=0,G.mode=8;case 8:if(4096&G.flags){if(0===I)break D;f=0;do{P=o[u+f++],G.head&&P&&G.length<65536&&(G.head.comment+=String.fromCharCode(P))}while(P&&f<I);if(512&G.flags&&(G.check=N(G.check,o,f,u)),I-=f,u+=f,P)break D}else G.head&&(G.head.comment=null);G.mode=9;case 9:if(512&G.flags){for(;y<16;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}if(i!==(65535&G.check)){D.Rl="header crc mismatch",G.mode=x;break}i=0,y=0}G.head&&(G.head.hcrc=G.flags>>9&1,G.head.done=!0),D.adler=G.check=0,G.mode=h;break;case 10:for(;y<32;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}D.adler=G.check=r(i),i=0,y=0,G.mode=11;case 11:if(0===G.havedict)return D.next_out=B,D.avail_out=W,D.next_in=u,D.avail_in=I,G.hold=i,G.bits=y,j;D.adler=G.check=1,G.mode=h;case h:if(l===t||l===R)break D;case 13:if(G.last){i>>>=7&y,y-=7&y,G.mode=27;break}for(;y<3;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}switch(G.last=1&i,i>>>=1,y-=1,3&i){case 0:G.mode=14;break;case 1:if(S(G),G.mode=20,l===R){i>>>=2,y-=2;break D}break;case 2:G.mode=17;break;case 3:D.Rl="invalid block type",G.mode=x}i>>>=2,y-=2;break;case 14:for(i>>>=7&y,y-=7&y;y<32;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}if((65535&i)!==(i>>>16^65535)){D.Rl="invalid stored block lengths",G.mode=x;break}if(G.length=65535&i,i=0,y=0,G.mode=15,l===R)break D;case 15:G.mode=16;case 16:if(f=G.length,f){if(f>I&&(f=I),f>W&&(f=W),0===f)break D;L.set(o.subarray(u,u+f),B),I-=f,u+=f,W-=f,B+=f,G.length-=f;break}G.mode=h;break;case 17:for(;y<14;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}if(G.nlen=257+(31&i),i>>>=5,y-=5,G.ndist=1+(31&i),i>>>=5,y-=5,G.ncode=4+(15&i),i>>>=4,y-=4,G.nlen>286||G.ndist>30){D.Rl="too many length or distance symbols",G.mode=x;break}G.have=0,G.mode=18;case 18:for(;G.have<G.ncode;){for(;y<3;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}G.lens[w[G.have++]]=7&i,i>>>=3,y-=3}for(;G.have<19;)G.lens[w[G.have++]]=0;if(G.lencode=G.lendyn,G.lenbits=7,T={bits:G.lenbits},p=b(0,G.lens,0,19,G.lencode,0,G.work,T),G.lenbits=T.bits,p){D.Rl="invalid code lengths set",G.mode=x;break}G.have=0,G.mode=19;case 19:for(;G.have<G.nlen+G.ndist;){for(;k=G.lencode[i&(1<<G.lenbits)-1],v=k>>>24,Z=k>>>16&255,J=65535&k,!(v<=y);){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}if(J<16)i>>>=v,y-=v,G.lens[G.have++]=J;else{if(16===J){for(C=v+2;y<C;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}if(i>>>=v,y-=v,0===G.have){D.Rl="invalid bit length repeat",G.mode=x;break}P=G.lens[G.have-1],f=3+(3&i),i>>>=2,y-=2}else if(17===J){for(C=v+3;y<C;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}i>>>=v,y-=v,P=0,f=3+(7&i),i>>>=3,y-=3}else{for(C=v+7;y<C;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}i>>>=v,y-=v,P=0,f=11+(127&i),i>>>=7,y-=7}if(G.have+f>G.nlen+G.ndist){D.Rl="invalid bit length repeat",G.mode=x;break}for(;f--;)G.lens[G.have++]=P}}if(G.mode===x)break;if(0===G.lens[256]){D.Rl="invalid code -- missing end-of-block",G.mode=x;break}if(G.lenbits=9,T={bits:G.lenbits},p=b(1,G.lens,0,G.nlen,G.lencode,0,G.work,T),G.lenbits=T.bits,p){D.Rl="invalid literal/lengths set",G.mode=x;break}if(G.distbits=6,G.distcode=G.distdyn,T={bits:G.distbits},p=b(2,G.lens,G.nlen,G.ndist,G.distcode,0,G.work,T),G.distbits=T.bits,p){D.Rl="invalid distances set",G.mode=x;break}if(G.mode=20,l===R)break D;case 20:G.mode=21;case 21:if(I>=6&&W>=258){D.next_out=B,D.avail_out=W,D.next_in=u,D.avail_in=I,G.hold=i,G.bits=y,M(D,U),B=D.next_out,L=D.output,W=D.avail_out,u=D.next_in,o=D.input,I=D.avail_in,i=G.hold,y=G.bits,G.mode===h&&(G.back=-1);break}for(G.back=0;k=G.lencode[i&(1<<G.lenbits)-1],v=k>>>24,Z=k>>>16&255,J=65535&k,!(v<=y);){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}if(Z&&0===(240&Z)){for(Y=v,z=Z,E=J;k=G.lencode[E+((i&(1<<Y+z)-1)>>Y)],v=k>>>24,Z=k>>>16&255,J=65535&k,!(Y+v<=y);){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}i>>>=Y,y-=Y,G.back+=Y}if(i>>>=v,y-=v,G.back+=v,G.length=J,0===Z){G.mode=26;break}if(32&Z){G.back=-1,G.mode=h;break}if(64&Z){D.Rl="invalid literal/length code",G.mode=x;break}G.extra=15&Z,G.mode=22;case 22:if(G.extra){for(C=G.extra;y<C;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}G.length+=i&(1<<G.extra)-1,i>>>=G.extra,y-=G.extra,G.back+=G.extra}G.was=G.length,G.mode=23;case 23:for(;k=G.distcode[i&(1<<G.distbits)-1],v=k>>>24,Z=k>>>16&255,J=65535&k,!(v<=y);){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}if(0===(240&Z)){for(Y=v,z=Z,E=J;k=G.distcode[E+((i&(1<<Y+z)-1)>>Y)],v=k>>>24,Z=k>>>16&255,J=65535&k,!(Y+v<=y);){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}i>>>=Y,y-=Y,G.back+=Y}if(i>>>=v,y-=v,G.back+=v,64&Z){D.Rl="invalid distance code",G.mode=x;break}G.offset=J,G.extra=15&Z,G.mode=24;case 24:if(G.extra){for(C=G.extra;y<C;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}G.offset+=i&(1<<G.extra)-1,i>>>=G.extra,y-=G.extra,G.back+=G.extra}if(G.offset>G.dmax){D.Rl="invalid distance too far back",G.mode=x;break}G.mode=25;case 25:if(0===W)break D;if(f=U-W,G.offset>f){if(f=G.offset-f,f>G.whave&&G.sane){D.Rl="invalid distance too far back",G.mode=x;break}f>G.wnext?(f-=G.wnext,q=G.wsize-f):q=G.wnext-f,f>G.length&&(f=G.length),c=G.window}else c=L,q=B-G.offset,f=G.length;f>W&&(f=W),W-=f,G.length-=f;do{L[B++]=c[q++]}while(--f);0===G.length&&(G.mode=21);break;case 26:if(0===W)break D;L[B++]=G.length,W--,G.mode=21;break;case 27:if(G.wrap){for(;y<32;){if(0===I)break D;I--,i|=o[u++]<<y,y+=8}if(U-=W,D.total_out+=U,G.total+=U,U&&(D.adler=G.check=G.flags?N(G.check,L,U,B-U):V(G.check,L,U,B-U)),U=W,(G.flags?i:r(i))!==G.check){D.Rl="incorrect data check",G.mode=x;break}i=0,y=0}G.mode=28;case 28:if(G.wrap&&G.flags){for(;y<32;){if(0===I)break D;I--,i+=o[u++]<<y,y+=8}if(i!==(4294967295&G.total)){D.Rl="incorrect length check",G.mode=x;break}i=0,y=0}G.mode=29;case 29:p=g;break D;case x:p=K;break D;case 31:return F;default:return e}return D.next_out=B,D.avail_out=W,D.next_in=u,D.avail_in=I,G.hold=i,G.bits=y,(G.wsize||U!==D.avail_out&&G.mode<x&&(G.mode<27||l!==X))&&O(D,D.output,D.next_out,U-D.avail_out)?(G.mode=31,F):(s-=D.avail_in,U-=D.avail_out,D.total_in+=s,D.total_out+=U,G.total+=U,G.wrap&&U&&(D.adler=G.check=G.flags?N(G.check,L,U,D.next_out-U):V(G.check,L,U,D.next_out-U)),D.data_type=G.bits+(G.last?64:0)+(G.mode===h?128:0)+(20===G.mode||15===G.mode?256:0),(0===s&&0===U||l===X)&&p===n&&(p=d),p)},D.exports.inflateEnd=D=>{if(!D||!D.state)return e;let l=D.state;return l.window&&(l.window=null),D.state=null,n},D.exports.inflateGetHeader=(D,l)=>{if(!D||!D.state)return e;const G=D.state;return 0===(2&G.wrap)?e:(G.head=l,l.done=!1,n)},D.exports.inflateSetDictionary=(D,l)=>{const G=l.length;let N,M,b;return D&&D.state?(N=D.state,0!==N.wrap&&11!==N.mode?e:11===N.mode&&(M=1,M=V(M,l,G,0),M!==N.check)?K:(b=O(D,l,G,G),b?(N.mode=31,F):(N.havedict=1,n))):e},D.exports.inflateInfo="pako inflate (from Nodeca project)"},12923:D=>{"use strict";const l=15,G=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),V=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),N=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),M=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);D.exports=(D,b,X,t,R,n,g,j)=>{const e=j.bits;let K,F,d,H,h,x,r=0,o=0,L=0,u=0,B=0,I=0,W=0,i=0,y=0,S=0,O=null,s=0;const U=new Uint16Array(16),f=new Uint16Array(16);let q,c,v,Z=null,J=0;for(r=0;r<=l;r++)U[r]=0;for(o=0;o<t;o++)U[b[X+o]]++;for(B=e,u=l;u>=1&&0===U[u];u--);if(B>u&&(B=u),0===u)return R[n++]=20971520,R[n++]=20971520,j.bits=1,0;for(L=1;L<u&&0===U[L];L++);for(B<L&&(B=L),i=1,r=1;r<=l;r++)if(i<<=1,i-=U[r],i<0)return-1;if(i>0&&(0===D||1!==u))return-1;for(f[1]=0,r=1;r<l;r++)f[r+1]=f[r]+U[r];for(o=0;o<t;o++)0!==b[X+o]&&(g[f[b[X+o]]++]=o);if(0===D?(O=Z=g,x=19):1===D?(O=G,s-=257,Z=V,J-=257,x=256):(O=N,Z=M,x=-1),S=0,o=0,r=L,h=n,I=B,W=0,d=-1,y=1<<B,H=y-1,1===D&&y>852||2===D&&y>592)return 1;for(;;){q=r-W,g[o]<x?(c=0,v=g[o]):g[o]>x?(c=Z[J+g[o]],v=O[s+g[o]]):(c=96,v=0),K=1<<r-W,F=1<<I,L=F;do{F-=K,R[h+(S>>W)+F]=q<<24|c<<16|v}while(0!==F);for(K=1<<r-1;S&K;)K>>=1;if(0!==K?(S&=K-1,S+=K):S=0,o++,0===--U[r]){if(r===u)break;r=b[X+g[o]]}if(r>B&&(S&H)!==d){for(0===W&&(W=B),h+=L,I=r-W,i=1<<I;I+W<u&&(i-=U[I+W],!(i<=0));)I++,i<<=1;if(y+=1<<I,1===D&&y>852||2===D&&y>592)return 1;d=S&H,R[d]=B<<24|I<<16|h-n}}return 0!==S&&(R[h+S]=r-W<<24|64<<16),j.bits=B,0}},12877:D=>{"use strict";D.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12858:D=>{"use strict";function l(D){let l=D.length;for(;--l>=0;)D[l]=0}const G=256,V=286,N=30,M=15,b=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),X=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=new Array(576);l(n);const g=new Array(60);l(g);const j=new Array(512);l(j);const e=new Array(256);l(e);const K=new Array(29);l(K);const F=new Array(N);function d(D,l,G,V,N){this.static_tree=D,this.extra_bits=l,this.extra_base=G,this.elems=V,this.max_length=N,this.has_stree=D&&D.length}let H,h,x;function r(D,l){this.dyn_tree=D,this.max_code=0,this.stat_desc=l}l(F);const o=D=>D<256?j[D]:j[256+(D>>>7)],L=(D,l)=>{D.pending_buf[D.pending++]=255&l,D.pending_buf[D.pending++]=l>>>8&255},u=(D,l,G)=>{D.bi_valid>16-G?(D.bi_buf|=l<<D.bi_valid&65535,L(D,D.bi_buf),D.bi_buf=l>>16-D.bi_valid,D.bi_valid+=G-16):(D.bi_buf|=l<<D.bi_valid&65535,D.bi_valid+=G)},B=(D,l,G)=>{u(D,G[2*l],G[2*l+1])},I=(D,l)=>{let G=0;do{G|=1&D,D>>>=1,G<<=1}while(--l>0);return G>>>1},W=(D,l,G)=>{const V=new Array(16);let N,b,X=0;for(N=1;N<=M;N++)V[N]=X=X+G[N-1]<<1;for(b=0;b<=l;b++){let l=D[2*b+1];0!==l&&(D[2*b]=I(V[l]++,l))}},i=D=>{let l;for(l=0;l<V;l++)D.dyn_ltree[2*l]=0;for(l=0;l<N;l++)D.dyn_dtree[2*l]=0;for(l=0;l<19;l++)D.bl_tree[2*l]=0;D.dyn_ltree[512]=1,D.opt_len=D.static_len=0,D.last_lit=D.matches=0},y=D=>{D.bi_valid>8?L(D,D.bi_buf):D.bi_valid>0&&(D.pending_buf[D.pending++]=D.bi_buf),D.bi_buf=0,D.bi_valid=0},S=(D,l,G,V)=>{const N=2*l,M=2*G;return D[N]<D[M]||D[N]===D[M]&&V[l]<=V[G]},O=(D,l,G)=>{const V=D.heap[G];let N=G<<1;for(;N<=D.heap_len&&(N<D.heap_len&&S(l,D.heap[N+1],D.heap[N],D.depth)&&N++,!S(l,V,D.heap[N],D.depth));)D.heap[G]=D.heap[N],G=N,N<<=1;D.heap[G]=V},s=(D,l,V)=>{let N,M,t,R,n=0;if(0!==D.last_lit)do{N=D.pending_buf[D.d_buf+2*n]<<8|D.pending_buf[D.d_buf+2*n+1],M=D.pending_buf[D.l_buf+n],n++,0===N?B(D,M,l):(t=e[M],B(D,t+G+1,l),R=b[t],0!==R&&(M-=K[t],u(D,M,R)),N--,t=o(N),B(D,t,V),R=X[t],0!==R&&(N-=F[t],u(D,N,R)))}while(n<D.last_lit);B(D,256,l)},U=(D,l)=>{const G=l.dyn_tree,V=l.stat_desc.static_tree,N=l.stat_desc.has_stree,b=l.stat_desc.elems;let X,t,R,n=-1;for(D.heap_len=0,D.heap_max=573,X=0;X<b;X++)0!==G[2*X]?(D.heap[++D.heap_len]=n=X,D.depth[X]=0):G[2*X+1]=0;for(;D.heap_len<2;)R=D.heap[++D.heap_len]=n<2?++n:0,G[2*R]=1,D.depth[R]=0,D.opt_len--,N&&(D.static_len-=V[2*R+1]);for(l.max_code=n,X=D.heap_len>>1;X>=1;X--)O(D,G,X);R=b;do{X=D.heap[1],D.heap[1]=D.heap[D.heap_len--],O(D,G,1),t=D.heap[1],D.heap[--D.heap_max]=X,D.heap[--D.heap_max]=t,G[2*R]=G[2*X]+G[2*t],D.depth[R]=(D.depth[X]>=D.depth[t]?D.depth[X]:D.depth[t])+1,G[2*X+1]=G[2*t+1]=R,D.heap[1]=R++,O(D,G,1)}while(D.heap_len>=2);D.heap[--D.heap_max]=D.heap[1],((D,l)=>{const G=l.dyn_tree,V=l.max_code,N=l.stat_desc.static_tree,b=l.stat_desc.has_stree,X=l.stat_desc.extra_bits,t=l.stat_desc.extra_base,R=l.stat_desc.max_length;let n,g,j,e,K,F,d=0;for(e=0;e<=M;e++)D.bl_count[e]=0;for(G[2*D.heap[D.heap_max]+1]=0,n=D.heap_max+1;n<573;n++)g=D.heap[n],e=G[2*G[2*g+1]+1]+1,e>R&&(e=R,d++),G[2*g+1]=e,g>V||(D.bl_count[e]++,K=0,g>=t&&(K=X[g-t]),F=G[2*g],D.opt_len+=F*(e+K),b&&(D.static_len+=F*(N[2*g+1]+K)));if(0!==d){do{for(e=R-1;0===D.bl_count[e];)e--;D.bl_count[e]--,D.bl_count[e+1]+=2,D.bl_count[R]--,d-=2}while(d>0);for(e=R;0!==e;e--)for(g=D.bl_count[e];0!==g;)j=D.heap[--n],j>V||(G[2*j+1]!==e&&(D.opt_len+=(e-G[2*j+1])*G[2*j],G[2*j+1]=e),g--)}})(D,l),W(G,n,D.bl_count)},f=(D,l,G)=>{let V,N,M=-1,b=l[1],X=0,t=7,R=4;for(0===b&&(t=138,R=3),l[2*(G+1)+1]=65535,V=0;V<=G;V++)N=b,b=l[2*(V+1)+1],++X<t&&N===b||(X<R?D.bl_tree[2*N]+=X:0!==N?(N!==M&&D.bl_tree[2*N]++,D.bl_tree[32]++):X<=10?D.bl_tree[34]++:D.bl_tree[36]++,X=0,M=N,0===b?(t=138,R=3):N===b?(t=6,R=3):(t=7,R=4))},q=(D,l,G)=>{let V,N,M=-1,b=l[1],X=0,t=7,R=4;for(0===b&&(t=138,R=3),V=0;V<=G;V++)if(N=b,b=l[2*(V+1)+1],!(++X<t&&N===b)){if(X<R)do{B(D,N,D.bl_tree)}while(0!==--X);else 0!==N?(N!==M&&(B(D,N,D.bl_tree),X--),B(D,16,D.bl_tree),u(D,X-3,2)):X<=10?(B(D,17,D.bl_tree),u(D,X-3,3)):(B(D,18,D.bl_tree),u(D,X-11,7));X=0,M=N,0===b?(t=138,R=3):N===b?(t=6,R=3):(t=7,R=4)}};let c=!1;const v=(D,l,G,V)=>{u(D,0+(V?1:0),3),((D,l,G,V)=>{y(D),V&&(L(D,G),L(D,~G)),D.pending_buf.set(D.window.subarray(l,l+G),D.pending),D.pending+=G})(D,l,G,!0)};D.exports._tr_init=D=>{c||((()=>{let D,l,G,R,r;const o=new Array(16);for(G=0,R=0;R<28;R++)for(K[R]=G,D=0;D<1<<b[R];D++)e[G++]=R;for(e[G-1]=R,r=0,R=0;R<16;R++)for(F[R]=r,D=0;D<1<<X[R];D++)j[r++]=R;for(r>>=7;R<N;R++)for(F[R]=r<<7,D=0;D<1<<X[R]-7;D++)j[256+r++]=R;for(l=0;l<=M;l++)o[l]=0;for(D=0;D<=143;)n[2*D+1]=8,D++,o[8]++;for(;D<=255;)n[2*D+1]=9,D++,o[9]++;for(;D<=279;)n[2*D+1]=7,D++,o[7]++;for(;D<=287;)n[2*D+1]=8,D++,o[8]++;for(W(n,287,o),D=0;D<N;D++)g[2*D+1]=5,g[2*D]=I(D,5);H=new d(n,b,257,V,M),h=new d(g,X,0,N,M),x=new d(new Array(0),t,0,19,7)})(),c=!0),D.l_desc=new r(D.dyn_ltree,H),D.d_desc=new r(D.dyn_dtree,h),D.bl_desc=new r(D.bl_tree,x),D.bi_buf=0,D.bi_valid=0,i(D)},D.exports._tr_stored_block=v,D.exports._tr_flush_block=(D,l,V,N)=>{let M,b,X=0;D.level>0?(2===D.strm.data_type&&(D.strm.data_type=(D=>{let l,V=4093624447;for(l=0;l<=31;l++,V>>>=1)if(1&V&&0!==D.dyn_ltree[2*l])return 0;if(0!==D.dyn_ltree[18]||0!==D.dyn_ltree[20]||0!==D.dyn_ltree[26])return 1;for(l=32;l<G;l++)if(0!==D.dyn_ltree[2*l])return 1;return 0})(D)),U(D,D.l_desc),U(D,D.d_desc),X=(D=>{let l;for(f(D,D.dyn_ltree,D.l_desc.max_code),f(D,D.dyn_dtree,D.d_desc.max_code),U(D,D.bl_desc),l=18;l>=3&&0===D.bl_tree[2*R[l]+1];l--);return D.opt_len+=3*(l+1)+5+5+4,l})(D),M=D.opt_len+3+7>>>3,b=D.static_len+3+7>>>3,b<=M&&(M=b)):M=b=V+5,V+4<=M&&-1!==l?v(D,l,V,N):4===D.strategy||b===M?(u(D,2+(N?1:0),3),s(D,n,g)):(u(D,4+(N?1:0),3),((D,l,G,V)=>{let N;for(u(D,l-257,5),u(D,G-1,5),u(D,V-4,4),N=0;N<V;N++)u(D,D.bl_tree[2*R[N]+1],3);q(D,D.dyn_ltree,l-1),q(D,D.dyn_dtree,G-1)})(D,D.l_desc.max_code+1,D.d_desc.max_code+1,X+1),s(D,D.dyn_ltree,D.dyn_dtree)),i(D),N&&y(D)},D.exports._tr_tally=(D,l,V)=>(D.pending_buf[D.d_buf+2*D.last_lit]=l>>>8&255,D.pending_buf[D.d_buf+2*D.last_lit+1]=255&l,D.pending_buf[D.l_buf+D.last_lit]=255&V,D.last_lit++,0===l?D.dyn_ltree[2*V]++:(D.matches++,l--,D.dyn_ltree[2*(e[V]+G+1)]++,D.dyn_dtree[2*o(l)]++),D.last_lit===D.lit_bufsize-1),D.exports._tr_align=D=>{u(D,2,3),B(D,256,n),(D=>{16===D.bi_valid?(L(D,D.bi_buf),D.bi_buf=0,D.bi_valid=0):D.bi_valid>=8&&(D.pending_buf[D.pending++]=255&D.bi_buf,D.bi_buf>>=8,D.bi_valid-=8)})(D)}},12899:D=>{"use strict";D.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Rl="",this.state=null,this.data_type=2,this.adler=0}},12557:D=>{function l(D,l,G){for(var V=D.length,N=-1/0,M=1/0,b=0;b<V;b++){var X=(G[0][b]-D[b])/l[b],t=(G[1][b]-D[b])/l[b];if(X>t){var R=X;X=t,t=R}if(t<N||X>M)return 1/0;X>N&&(N=X),t<M&&(M=t)}return N>M?1/0:N}D.exports=function(D,G,V,N){var M=l(G,V,N);if(M===1/0)D=null;else{D=D||[];for(var b=0;b<G.length;b++)D[b]=G[b]+V[b]*M}return D},D.exports.distance=l},13856:(D,l,G)=>{"use strict";G.d(l,{e:()=>b});var V=G(36);const N=V.useLayoutEffect;const M=function(D){var l=(0,V.useRef)(D);return N((function(){l.current=D})),l};var b=function(D){var l=M(D);(0,V.bl)((function(){var D=function(D){var G;if(null!=l.current&&(G=l.current(D)),D.defaultPrevented&&(D.returnValue=""),"string"===typeof G)return D.returnValue=G,G};return window.addEventListener("beforeunload",D),function(){window.removeEventListener("beforeunload",D)}}),[])}},13800:(D,l,G)=>{"use strict";var V=G(13806),N=Array.prototype.concat,M=Array.prototype.slice,b=D.exports=function(D){for(var l=[],G=0,b=D.length;G<b;G++){var X=D[G];V(X)?l=N.call(l,M.call(X)):l.push(X)}return l};b.wrap=function(D){return function(){return D(b(arguments))}}},13806:D=>{D.exports=function(D){return!(!D||"string"===typeof D)&&(D instanceof Array||Array.isArray(D)||D.length>=0&&(D.splice instanceof Function||Object.getOwnPropertyDescriptor(D,D.length-1)&&"String"!==D.constructor.name))}},12803:(D,l,G)=>{var V=G(12810);function N(D){for(var l,G,N=0,M=D.length,b=0;b<D.length;){for(l=D[b],G=0;b<M&&D[b]===l;)++b,++G;N+=V.log2(G)/7|0,N+=V.log2(l>>>0)/7|0,N+=2}return N}l.size=N,l.encode=function(D,l){l||(l=new Uint8Array(N(D)));for(var G,V,M=0,b=l.length,X=0;X<D.length;){for(G=D[X],V=0;X<D.length&&D[X]===G;)++X,++V;for(;M<b&&V>=128;)l[M++]=128+(127&V),V>>>=7;if(M>=b)throw new Error("RLE buffer overflow");for(l[M++]=V,G>>>=0;M<b&&G>=128;)l[M++]=128+(127&G),G>>>=7;if(M>=b)throw new Error("RLE buffer overflow");l[M++]=G}return l},l.decode=function(D,l){for(var G,V,N,M,b=l.length,X=D.length,t=0,R=0;R<X;){for(G=0,V=0;R<X&&D[R]>=128;)G+=(127&D[R++])<<V,V+=7;if(G+=D[R++]<<V,R>=X)throw new Error("RLE buffer underrun");if(t+G>b)throw new Error("Chunk buffer overflow");for(N=0,V=0;R<X&&D[R]>=128;)N+=(127&D[R++])<<V,V+=7;if(R>=X)throw new Error("RLE buffer underrun");for(N+=D[R++]<<V,M=0;M<G;++M)l[t++]=N}return l}},12810:(D,l)=>{"use strict";function G(D){var l=32;return(D&=-D)&&l--,65535&D&&(l-=16),16711935&D&&(l-=8),252645135&D&&(l-=4),858993459&D&&(l-=2),1431655765&D&&(l-=1),l}l.INT_BITS=32,l.INT_MAX=2147483647,l.INT_MIN=-1<<31,l.sign=function(D){return(D>0)-(D<0)},l.abs=function(D){var l=D>>31;return(D^l)-l},l.min=function(D,l){return l^(D^l)&-(D<l)},l.max=function(D,l){return D^(D^l)&-(D<l)},l.isPow2=function(D){return!(D&D-1)&&!!D},l.log2=function(D){var l,G;return l=(D>65535)<<4,l|=G=((D>>>=l)>255)<<3,l|=G=((D>>>=G)>15)<<2,(l|=G=((D>>>=G)>3)<<1)|(D>>>=G)>>1},l.log10=function(D){return D>=1e9?9:D>=1e8?8:D>=1e7?7:D>=1e6?6:D>=1e5?5:D>=1e4?4:D>=1e3?3:D>=100?2:D>=10?1:0},l.popCount=function(D){return 16843009*((D=(858993459&(D-=D>>>1&1431655765))+(D>>>2&858993459))+(D>>>4)&252645135)>>>24},l.countTrailingZeros=G,l.nextPow2=function(D){return D+=0===D,--D,D|=D>>>1,D|=D>>>2,D|=D>>>4,D|=D>>>8,(D|=D>>>16)+1},l.prevPow2=function(D){return D|=D>>>1,D|=D>>>2,D|=D>>>4,D|=D>>>8,(D|=D>>>16)-(D>>>1)},l.parity=function(D){return D^=D>>>16,D^=D>>>8,D^=D>>>4,27030>>>(D&=15)&1};var V=new Array(256);!function(D){for(var l=0;l<256;++l){var G=l,V=l,N=7;for(G>>>=1;G;G>>>=1)V<<=1,V|=1&G,--N;D[l]=V<<N&255}}(V),l.reverse=function(D){return V[255&D]<<24|V[D>>>8&255]<<16|V[D>>>16&255]<<8|V[D>>>24&255]},l.interleave2=function(D,l){return(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D&=65535)|D<<8))|D<<4))|D<<2))|D<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l&=65535)|l<<8))|l<<4))|l<<2))|l<<1))<<1},l.deinterleave2=function(D,l){return(D=65535&((D=16711935&((D=252645135&((D=858993459&((D=D>>>l&1431655765)|D>>>1))|D>>>2))|D>>>4))|D>>>16))<<16>>16},l.interleave3=function(D,l,G){return D=1227133513&((D=3272356035&((D=251719695&((D=4278190335&((D&=1023)|D<<16))|D<<8))|D<<4))|D<<2),(D|=(l=1227133513&((l=3272356035&((l=251719695&((l=4278190335&((l&=1023)|l<<16))|l<<8))|l<<4))|l<<2))<<1)|(G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2))<<2},l.deinterleave3=function(D,l){return(D=1023&((D=4278190335&((D=251719695&((D=3272356035&((D=D>>>l&1227133513)|D>>>2))|D>>>4))|D>>>8))|D>>>16))<<22>>22},l.nextCombination=function(D){var l=D|D-1;return l+1|(~l&-~l)-1>>>G(D)+1}},12836:D=>{"use strict";D.exports=function(D,l,G,V){var N=self||window;try{try{var M;try{M=new N.Blob([D])}catch(R){(M=new(N.BlobBuilder||N.WebKitBlobBuilder||N.MozBlobBuilder||N.MSBlobBuilder)).append(D),M=M.getBlob()}var b=N.URL||N.webkitURL,X=b.createObjectURL(M),t=new N[l](X,G);return b.revokeObjectURL(X),t}catch(R){return new N[l]("data:application/javascript,".concat(encodeURIComponent(D)),G)}}catch(R){if(!V)throw Error("Inline worker is not supported");return new N[l](V,G)}}},12539:(D,l,G)=>{"use strict";function V(D,l,G,V,N){var M={};return Object.keys(V).forEach((function(D){M[D]=V[D]})),M.enumerable=!!M.enumerable,M.configurable=!!M.configurable,("value"in M||M.initializer)&&(M.writable=!0),M=G.slice().reverse().reduce((function(G,V){return V(D,l,G)||G}),M),N&&void 0!==M.initializer&&(M.value=M.initializer?M.initializer.call(N):void 0,M.initializer=void 0),void 0===M.initializer&&(Object.defineProperty(D,l,M),M=null),M}G.d(l,{c:()=>V})},12530:(D,l,G)=>{"use strict";function V(D,l,G,V){G&&Object.defineProperty(D,l,{enumerable:G.enumerable,configurable:G.configurable,writable:G.writable,value:G.initializer?G.initializer.call(V):void 0})}G.d(l,{b:()=>V})},13845:(D,l,G)=>{"use strict";G.d(l,{e:()=>b,h:()=>g,i:()=>X,k:()=>M,o:()=>t,r:()=>N,v:()=>R,x:()=>n});var V=G(11925);class N{constructor(){this._easingMode=N.EASINGMODE_EASEIN}setEasingMode(D){const l=Math.min(Math.max(D,0),2);this._easingMode=l}getEasingMode(){return this._easingMode}easeInCore(D){throw new Error("You must implement this method")}ease(D){switch(this._easingMode){case N.EASINGMODE_EASEIN:return this.easeInCore(D);case N.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-D)}return D>=.5?.5*(1-this.easeInCore(2*(1-D)))+.5:.5*this.easeInCore(2*D)}}N.EASINGMODE_EASEIN=0,N.EASINGMODE_EASEOUT=1,N.EASINGMODE_EASEINOUT=2;class M extends N{easeInCore(D){return D=Math.max(0,Math.min(1,D)),1-Math.sqrt(1-D*D)}}class b extends N{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=D}easeInCore(D){const l=Math.max(0,this.amplitude);return Math.pow(D,3)-D*l*Math.sin(3.141592653589793*D)}}class X extends N{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=D,this.bounciness=l}easeInCore(D){const l=Math.max(0,this.bounces);let G=this.bounciness;G<=1&&(G=1.001);const V=Math.pow(G,l),N=1-G,M=(1-V)/N+.5*V,b=D*M,X=Math.log(-b*(1-G)+1)/Math.log(G),t=Math.floor(X),R=t+1,n=(1-Math.pow(G,t))/(N*M),g=.5*(n+(1-Math.pow(G,R))/(N*M)),j=D-g,e=g-n;return-Math.pow(1/G,l-t)/(e*e)*(j-e)*(j+e)}}class t extends N{easeInCore(D){return D*D*D}}class R extends N{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=D,this.springiness=l}easeInCore(D){let l;const G=Math.max(0,this.oscillations),V=Math.max(0,this.springiness);return l=0==V?D:(Math.exp(V*D)-1)/(Math.exp(V)-1),l*Math.sin((6.283185307179586*G+1.5707963267948966)*D)}}class n extends N{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=D}easeInCore(D){return this.exponent<=0?D:(Math.exp(this.exponent*D)-1)/(Math.exp(this.exponent)-1)}}class g extends N{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=D,this.y1=l,this.x2=G,this.y2=V}easeInCore(D){return V.c.Interpolate(D,this.x1,this.y1,this.x2,this.y2)}}},13350:(D,l,G)=>{"use strict";G.d(l,{e:()=>b});var V=G(11710),N=G(11721),M=G(12144);class b extends M.e{get _matrix(){return this._compose(),this.Ej}set _matrix(D){(D.updateFlag!==this.Ej.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Ej.V(D),this._markAsDirtyAndDecompose())}constructor(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(D,l.uD(),!1),this.name=D,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=l,this.Ej=(null===N||void 0===N?void 0:N.clone())??V.Matrix.Identity(),this._restMatrix=M??this.Ej.clone(),this._bindMatrix=b??this.Ej.clone(),this._index=X,this._absoluteMatrix=new V.Matrix,this._absoluteBindMatrix=new V.Matrix,this._absoluteInverseBindMatrix=new V.Matrix,this._finalMatrix=new V.Matrix,l.bones.push(this),this.setParent(G,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(D){this.setParent(D)}setParent(D){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==D){if(this.parent){const D=this.parent.children.indexOf(this);-1!==D&&this.parent.children.splice(D,1)}this._parentNode=D,this.parent&&this.parent.children.push(this),l&&this._updateAbsoluteBindMatrices(),this.QR()}}getLocalMatrix(){return this._compose(),this.Ej}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(D){this._restMatrix.V(D)}setRestPose(D){this.setRestMatrix(D)}getBindPose(){return this.getBindMatrix()}setBindMatrix(D){this.Hb(D)}setBindPose(D){this.setBindMatrix(D)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const D=V.TmpVectors.Kl[0],l=V.TmpVectors.Quaternion[0],G=V.TmpVectors.Kl[1];this.getRestMatrix().decompose(D,l,G),this._linkedTransformNode.position.V(G),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??V.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.V(l),this._linkedTransformNode.ub.V(D)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(D){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=D,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.lt}set position(D){this._decompose(),this.lt.V(D),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(D){this.setRotation(D)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(D){this.setRotationQuaternion(D)}get ub(){return this.getScale()}set ub(D){this.setScale(D)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=V.Kl.Zero(),this._localRotation=V.Quaternion.Zero(),this.lt=V.Kl.Zero()),this.Ej.decompose(this._localScaling,this._localRotation,this.lt))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,V.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.lt,this.Ej)):this._needToCompose=!1)}Hb(D){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.V(D),l&&this._updateAbsoluteBindMatrices(),G?this._matrix=D:this.QR()}_updateAbsoluteBindMatrices(D){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(D||(D=this._bindMatrix),this.parent?D.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.V(D),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),l)for(let G=0;G<this.children.length;G++)this.children[G]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}QR(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.QR(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.QR(),this._needToDecompose=!0}_updatePosition(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const M=this.getLocalMatrix();if(0==l)N?(M.addAtIndex(12,D.x),M.addAtIndex(13,D.y),M.addAtIndex(14,D.z)):M.setTranslationFromFloats(D.x,D.y,D.z);else{let l=null;G&&(l=G.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const X=b._TmpMats[0],t=b._TmpVecs[0];this.parent?G&&l?(X.V(this.parent.getAbsoluteMatrix()),X.multiplyToRef(l,X)):X.V(this.parent.getAbsoluteMatrix()):V.Matrix.IdentityToRef(X),N&&X.setTranslationFromFloats(0,0,0),X.invert(),V.Kl.TransformCoordinatesToRef(D,X,t),N?(M.addAtIndex(12,t.x),M.addAtIndex(13,t.y),M.addAtIndex(14,t.z)):M.setTranslationFromFloats(t.x,t.y,t.z)}this._markAsDirtyAndDecompose()}translate(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;this._updatePosition(D,l,G,!0)}setPosition(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;this._updatePosition(D,l,G,!1)}setAbsolutePosition(D,l){this.setPosition(D,1,l)}scale(D,l,G){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const M=this.getLocalMatrix(),X=b._TmpMats[0];V.Matrix.ScalingToRef(D,l,G,X),X.multiplyToRef(M,M),X.invert();for(const V of this.children){const N=V.getLocalMatrix();N.multiplyToRef(X,N),N.multiplyAtIndex(12,D),N.multiplyAtIndex(13,l),N.multiplyAtIndex(14,G),V._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),N)for(const V of this.children)V.scale(D,l,G,N)}setScale(D){this._decompose(),this._localScaling.V(D),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(D){this._decompose(),D.V(this._localScaling)}setYawPitchRoll(D,l,G){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,M=arguments.length>4?arguments[4]:void 0;if(0===N){const X=b._TmpQuat;return V.Quaternion.RotationYawPitchRollToRef(D,l,G,X),void this.setRotationQuaternion(X,N,M)}const X=b._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,M))return;const t=b._TmpMats[1];V.Matrix.RotationYawPitchRollToRef(D,l,G,t),X.multiplyToRef(t,t),this._rotateWithMatrix(t,N,M)}rotate(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3?arguments[3]:void 0;const M=b._TmpMats[0];M.setTranslationFromFloats(0,0,0),V.Matrix.RotationAxisToRef(D,l,M),this._rotateWithMatrix(M,G,N)}setAxisAngle(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3?arguments[3]:void 0;if(0===G){const M=b._TmpQuat;return V.Quaternion.RotationAxisToRef(D,l,M),void this.setRotationQuaternion(M,G,N)}const M=b._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(M,N))return;const X=b._TmpMats[1];V.Matrix.RotationAxisToRef(D,l,X),M.multiplyToRef(X,X),this._rotateWithMatrix(X,G,N)}setRotation(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(D.y,D.x,D.z,l,G)}setRotationQuaternion(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;if(0===l)return this._decompose(),this._localRotation.V(D),void this._markAsDirtyAndCompose();const N=b._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,G))return;const M=b._TmpMats[1];V.Matrix.FromQuaternionToRef(D,M),N.multiplyToRef(M,M),this._rotateWithMatrix(M,l,G)}setRotationMatrix(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;if(0===l){const N=b._TmpQuat;return V.Quaternion.FromRotationMatrixToRef(D,N),void this.setRotationQuaternion(N,l,G)}const N=b._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,G))return;const M=b._TmpMats[1];M.V(D),N.multiplyToRef(D,M),this._rotateWithMatrix(M,l,G)}_rotateWithMatrix(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;const V=this.getLocalMatrix(),N=V.m[12],M=V.m[13],X=V.m[14],t=this.getParent(),R=b._TmpMats[3],n=b._TmpMats[4];t&&1==l?(G?(R.V(G.getWorldMatrix()),t.getAbsoluteMatrix().multiplyToRef(R,R)):R.V(t.getAbsoluteMatrix()),n.V(R),n.invert(),V.multiplyToRef(R,V),V.multiplyToRef(D,V),V.multiplyToRef(n,V)):1==l&&G?(R.V(G.getWorldMatrix()),n.V(R),n.invert(),V.multiplyToRef(R,V),V.multiplyToRef(D,V),V.multiplyToRef(n,V)):V.multiplyToRef(D,V),V.setTranslationFromFloats(N,M,X),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(D,l){const G=b._TmpMats[2];return D.V(this.getAbsoluteMatrix()),l?(D.multiplyToRef(l.getWorldMatrix(),D),V.Matrix.ScalingToRef(l.ub.x,l.ub.y,l.ub.z,G)):V.Matrix.IdentityToRef(G),D.invert(),!isNaN(D.m[0])&&(G.multiplyAtIndex(0,this._scalingDeterminant),D.multiplyToRef(G,D),!0)}CM(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=V.Kl.Zero();return this.getPositionToRef(D,l,G),G}getPositionToRef(){let D=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const D=this.getLocalMatrix();l.x=D.m[12],l.y=D.m[13],l.z=D.m[14]}else{let G=null;D&&(G=D.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let V=b._TmpMats[0];D&&G?(V.V(this.getAbsoluteMatrix()),V.multiplyToRef(G,V)):V=this.getAbsoluteMatrix(),l.x=V.m[12],l.y=V.m[13],l.z=V.m[14]}}getAbsolutePosition(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const l=V.Kl.Zero();return this.getPositionToRef(1,D,l),l}getAbsolutePositionToRef(D,l){this.getPositionToRef(1,D,l)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Ej.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.V(this.Ej);const D=this._skeleton.getPoseMatrix();D&&this._absoluteMatrix.multiplyToRef(D,this._absoluteMatrix)}const D=this.children,l=D.length;for(let G=0;G<l;G++)D[G].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}yt(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=V.Kl.Zero();return this.getDirectionToRef(D,l,G),G}getDirectionToRef(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2?arguments[2]:void 0,N=null;l&&(N=l.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const M=b._TmpMats[0];M.V(this.getAbsoluteMatrix()),l&&N&&M.multiplyToRef(N,M),V.Kl.TransformNormalToRef(D,M,G),G.normalize()}getRotation(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=V.Kl.Zero();return this.getRotationToRef(D,l,G),G}getRotationToRef(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2?arguments[2]:void 0;const V=b._TmpQuat;this.getRotationQuaternionToRef(D,l,V),V.toEulerAnglesToRef(G)}getRotationQuaternion(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=V.Quaternion.Identity();return this.getRotationQuaternionToRef(D,l,G),G}getRotationQuaternionToRef(){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),l.V(this._localRotation);else{const G=b._TmpMats[0],V=this.getAbsoluteMatrix();D?V.multiplyToRef(D.getWorldMatrix(),G):G.V(V),G.multiplyAtIndex(0,this._scalingDeterminant),G.multiplyAtIndex(1,this._scalingDeterminant),G.multiplyAtIndex(2,this._scalingDeterminant),G.decompose(void 0,l,void 0)}}getRotationMatrix(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1?arguments[1]:void 0;const G=V.Matrix.Identity();return this.getRotationMatrixToRef(D,l,G),G}getRotationMatrixToRef(){let D=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(l);else{const G=b._TmpMats[0],V=this.getAbsoluteMatrix();D?V.multiplyToRef(D.getWorldMatrix(),G):G.V(V),G.multiplyAtIndex(0,this._scalingDeterminant),G.multiplyAtIndex(1,this._scalingDeterminant),G.multiplyAtIndex(2,this._scalingDeterminant),G.getRotationMatrixToRef(l)}}getAbsolutePositionFromLocal(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=V.Kl.Zero();return this.getAbsolutePositionFromLocalToRef(D,l,G),G}getAbsolutePositionFromLocalToRef(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2?arguments[2]:void 0,N=null;l&&(N=l.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const M=b._TmpMats[0];M.V(this.getAbsoluteMatrix()),l&&N&&M.multiplyToRef(N,M),V.Kl.TransformCoordinatesToRef(D,M,G)}getLocalPositionFromAbsolute(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=V.Kl.Zero();return this.getLocalPositionFromAbsoluteToRef(D,l,G),G}getLocalPositionFromAbsoluteToRef(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2?arguments[2]:void 0,N=null;l&&(N=l.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const M=b._TmpMats[0];M.V(this.getAbsoluteMatrix()),l&&N&&M.multiplyToRef(N,M),M.invert(),V.Kl.TransformCoordinatesToRef(D,M,G)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const D=this._skeleton.bones.indexOf(this);if(-1!==D&&this._skeleton.bones.splice(D,1),this._parentNode&&this._parentNode.children){const D=this._parentNode.children,l=D.indexOf(this);-1!==l&&D.splice(l,1)}super.dispose()}}b._TmpVecs=(0,N.b)(2,V.Kl.Zero),b._TmpQuat=V.Quaternion.Identity(),b._TmpMats=(0,N.b)(5,V.Matrix.Identity)},13837:(D,l,G)=>{"use strict";G.d(l,{c:()=>U});var V=G(11695),N=G(11703),M=G(11532),b=G(11710),X=G(11728),t=G(12144),R=G(12173),n=G(12001),g=G(11554),j=G(11713);class e{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(D){this._zoomStopsAnimation=D}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(D){this._idleRotationSpeed=D}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(D){this._idleRotationWaitTime=D}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(D){this._idleRotationSpinupTime=D}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(D){this._attachedCamera=D;const l=this._attachedCamera.uD();this._onPrePointerObservableObserver=l.onPrePointerObservable.add((D=>{D.type!==n.b.POINTERDOWN?D.type===n.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=D.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const D=g.c.Now;let l=0;null!=this._lastFrameTime&&(l=D-this._lastFrameTime),this._lastFrameTime=D,this._applyUserInteraction();const G=D-this._lastInteractionTime-this._idleRotationWaitTime,V=Math.max(Math.min(G/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*V,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(l/1e3))}))}detach(){if(!this._attachedCamera)return;const D=this._attachedCamera.uD();this._onPrePointerObservableObserver&&D.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(D){this._lastInteractionTime=D??g.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<j.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let D=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(D=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?D:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=g.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var K=G(13845),F=G(12247);class d{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(D){if(this._autoTransitionRange===D)return;this._autoTransitionRange=D;const l=this._attachedCamera;l&&(D?this._onMeshTargetChangedObserver=l.onMeshTargetChangedObservable.add((D=>{if(D&&(D.hb(!0),D.getBoundingInfo)){const l=D.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*l,this.upperRadiusTransitionRange=.05*l}})):this._onMeshTargetChangedObserver&&l.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(D){this._attachedCamera=D,this._onAfterCheckInputsObserver=D.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(D){return!!this._attachedCamera&&(this._attachedCamera.radius===D&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(D){if(!this._attachedCamera)return;this._radiusBounceTransition||(d.EasingFunction.setEasingMode(d.EasingMode),this._radiusBounceTransition=F.b.CreateAnimation("radius",F.b.ANIMATIONTYPE_FLOAT,60,d.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const l=F.b.TransitionTo("radius",this._attachedCamera.radius+D,this._attachedCamera,this._attachedCamera.uD(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));l&&this._animatables.push(l)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}d.EasingFunction=new K.e(.3),d.EasingMode=K.r.EASINGMODE_EASEOUT;class H{constructor(){this.onTargetFramingAnimationEndObservable=new M.e,this._mode=H.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(D){this._mode=D}get mode(){return this._mode}set radiusScale(D){this._radiusScale=D}get radiusScale(){return this._radiusScale}set positionScale(D){this._positionScale=D}get positionScale(){return this._positionScale}set defaultElevation(D){this._defaultElevation=D}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(D){this._elevationReturnTime=D}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(D){this._elevationReturnWaitTime=D}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(D){this._zoomStopsAnimation=D}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(D){this._framingTime=D}get framingTime(){return this._framingTime}init(){}attach(D){this._attachedCamera=D;const l=this._attachedCamera.uD();H.EasingFunction.setEasingMode(H.EasingMode),this._onPrePointerObservableObserver=l.onPrePointerObservable.add((D=>{D.type!==n.b.POINTERDOWN?D.type===n.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=D.onMeshTargetChangedObservable.add((D=>{D&&D.getBoundingInfo&&this.zoomOnMesh(D,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=D.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const D=this._attachedCamera.uD();this._onPrePointerObservableObserver&&D.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;D.hb(!0);const V=D.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(V.minimumWorld,V.maximumWorld,l,G)}zoomOnMeshHierarchy(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;D.hb(!0);const V=D.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(V.min,V.max,l,G)}zoomOnMeshesHierarchy(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new b.Kl(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),N=new b.Kl(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let M=0;M<D.length;M++){const l=D[M].getHierarchyBoundingVectors(!0);b.Kl.CheckExtends(l.min,V,N),b.Kl.CheckExtends(l.max,V,N)}this.zoomOnBoundingInfo(V,N,l,G)}zoomOnBoundingInfo(D,l){let G,V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const M=D.y,X=M+(l.y-M)*this._positionScale,t=l.Fl(D).scale(.5);if(!isFinite(X))return!1;if(V)G=new b.Kl(0,X,0);else{const l=D.add(t);G=new b.Kl(l.x,X,l.z)}this._vectorTransition||(this._vectorTransition=F.b.CreateAnimation("target",F.b.ANIMATIONTYPE_VECTOR3,60,H.EasingFunction)),this._betaIsAnimating=!0;let R=F.b.TransitionTo("target",G,this._attachedCamera,this._attachedCamera.uD(),60,this._vectorTransition,this._framingTime);R&&this._animatables.push(R);let n=0;if(this._mode===H.FitFrustumSidesMode){const G=this._calculateLowerRadiusFromModelBoundingSphere(D,l);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=t.length()+this._attachedCamera.Kb),n=G}else this._mode===H.IgnoreBoundsSizeMode&&(n=this._calculateLowerRadiusFromModelBoundingSphere(D,l),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Kb));if(this.autoCorrectCameraLimitsAndSensibility){const G=l.Fl(D).length();this._attachedCamera.panningSensibility=5e3/G,this._attachedCamera.wheelPrecision=100/n}return this._radiusTransition||(this._radiusTransition=F.b.CreateAnimation("radius",F.b.ANIMATIONTYPE_FLOAT,60,H.EasingFunction)),R=F.b.TransitionTo("radius",n,this._attachedCamera,this._attachedCamera.uD(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),N&&N(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),R&&this._animatables.push(R),!0}_calculateLowerRadiusFromModelBoundingSphere(D,l){const G=this._attachedCamera;if(!G)return 0;let V=G._calculateLowerRadiusFromModelBoundingSphere(D,l,this._radiusScale);return G.lowerRadiusLimit&&this._mode===H.IgnoreBoundsSizeMode&&(V=V<G.lowerRadiusLimit?G.lowerRadiusLimit:V),G.upperRadiusLimit&&(V=V>G.upperRadiusLimit?G.upperRadiusLimit:V),V}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const D=g.c.Now-this._lastInteractionTime,l=.5*Math.PI-this._defaultElevation,G=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>G&&D>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=F.b.CreateAnimation("beta",F.b.ANIMATIONTYPE_FLOAT,60,H.EasingFunction));const D=F.b.TransitionTo("beta",l,this._attachedCamera,this._attachedCamera.uD(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));D&&this._animatables.push(D)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=g.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}H.EasingFunction=new K.x,H.EasingMode=K.r.EASINGMODE_EASEINOUT,H.IgnoreBoundsSizeMode=0,H.FitFrustumSidesMode=1;var h=G(12175),x=G(12213),r=G(13346),o=G(11530);class L{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(D){D=o.Tools.BackCompatCameraNoPreventDefault(arguments);const l=this.camera.getEngine(),G=l.getInputElement();let V=0,N=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=M=>{var b,X;const t=M.event,R="touch"===t.pointerType;if(M.type!==n.b.POINTERMOVE&&-1===this.buttons.indexOf(t.button))return;const g=t.target;if(this._altKey=t.altKey,this._ctrlKey=t.ctrlKey,this._metaKey=t.metaKey,this._shiftKey=t.shiftKey,this._buttonsPressed=t.buttons,l.isPointerLock){const D=t.movementX,l=t.movementY;this.onTouch(null,D,l),this._pointA=null,this._pointB=null}else{if(M.type!==n.b.POINTERDOWN&&M.type!==n.b.POINTERDOUBLETAP&&R&&(null===(b=this._pointA)||void 0===b?void 0:b.pointerId)!==t.pointerId&&(null===(X=this._pointB)||void 0===X?void 0:X.pointerId)!==t.pointerId)return;if(M.type!==n.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!R)if(M.type===n.b.POINTERDOUBLETAP)this.onDoubleTap(t.pointerType);else if(M.type!==n.b.POINTERUP||this._currentMousePointerIdDown!==t.pointerId&&!R){if(M.type===n.b.POINTERMOVE)if(D||t.preventDefault(),this._pointA&&null===this._pointB){const D=t.clientX-this._pointA.x,l=t.clientY-this._pointA.y;this._pointA.x=t.clientX,this._pointA.y=t.clientY,this.onTouch(this._pointA,D,l)}else if(this._pointA&&this._pointB){const D=this._pointA.pointerId===t.pointerId?this._pointA:this._pointB;D.x=t.clientX,D.y=t.clientY;const l=this._pointA.x-this._pointB.x,G=this._pointA.y-this._pointB.y,b=l*l+G*G,X={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:t.pointerId,type:M.type};this.onMultiTouch(this._pointA,this._pointB,V,b,N,X),N=X,V=b}}else{try{null===g||void 0===g||g.releasePointerCapture(t.pointerId)}catch(j){}R||(this._pointB=null),l._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==t.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==t.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==V||N)&&(this.onMultiTouch(this._pointA,this._pointB,V,0,N,null),V=0,N=null),this._currentMousePointerIdDown=-1,this.onButtonUp(t),D||t.preventDefault()}else{try{null===g||void 0===g||g.setPointerCapture(t.pointerId)}catch(j){}if(null===this._pointA)this._pointA={x:t.clientX,y:t.clientY,pointerId:t.pointerId,type:t.pointerType};else{if(null!==this._pointB)return;this._pointB={x:t.clientX,y:t.clientY,pointerId:t.pointerId,type:t.pointerType}}-1!==this._currentMousePointerIdDown||R||(this._currentMousePointerIdDown=t.pointerId),this.onButtonDown(t),D||(t.preventDefault(),G&&G.focus())}}},this._observer=this.camera.uD()._inputManager._addCameraPointerObserver(this._pointerInput,n.b.POINTERDOWN|n.b.POINTERUP|n.b.POINTERMOVE|n.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,V=0,N=null,this.onLostFocus()},this._contextMenuBind=D=>this.onContextMenu(D),G&&G.addEventListener("contextmenu",this._contextMenuBind,!1);const M=this.camera.uD().getEngine().getHostWindow();M&&o.Tools.RegisterTopRootEvents(M,[{name:"blur",handler:this._onLostFocus}])}Dj(){if(this._onLostFocus){const D=this.camera.uD().getEngine().getHostWindow();D&&o.Tools.UnregisterTopRootEvents(D,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.uD()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const D=this.camera.uD().getEngine().getInputElement();D&&D.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(D){}onTouch(D,l,G){}onMultiTouch(D,l,G,V,N,M){}onContextMenu(D){D.preventDefault()}onButtonDown(D){}onButtonUp(D){}onLostFocus(){}}(0,V.b)([(0,N.L)()],L.prototype,"buttons",void 0);class u extends L{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(D,l){if(0!==this.panningSensibility&&D&&l){const G=l.x-D.x,V=l.y-D.y;this.camera.inertialPanningX+=-G/this.panningSensibility,this.camera.inertialPanningY+=V/this.panningSensibility}}_computePinchZoom(D,l){const G=this.camera.radius||u.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=G*Math.sqrt(D)/Math.sqrt(l):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(l-D)*G*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(l-D)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(D,l,G){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-l/this.panningSensibility,this.camera.inertialPanningY+=G/this.panningSensibility):(this.camera.inertialAlphaOffset-=l/this.angularSensibilityX,this.camera.inertialBetaOffset-=G/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(D,l,G,V,N,M){0===G&&null===N||0===V&&null===M||(this.multiTouchPanAndZoom?(this._computePinchZoom(G,V),this._computeMultiTouchPanning(N,M)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(V)-Math.sqrt(G))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(G,V),this._isPinching=!0):this._computeMultiTouchPanning(N,M)):this.multiTouchPanning?this._computeMultiTouchPanning(N,M):this.pinchZoom&&this._computePinchZoom(G,V))}onButtonDown(D){this._isPanClick=D.button===this.camera._panningMouseButton}onButtonUp(D){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}u.MinimumRadiusForPinch=.001,(0,V.b)([(0,N.L)()],u.prototype,"buttons",void 0),(0,V.b)([(0,N.L)()],u.prototype,"angularSensibilityX",void 0),(0,V.b)([(0,N.L)()],u.prototype,"angularSensibilityY",void 0),(0,V.b)([(0,N.L)()],u.prototype,"pinchPrecision",void 0),(0,V.b)([(0,N.L)()],u.prototype,"pinchDeltaPercentage",void 0),(0,V.b)([(0,N.L)()],u.prototype,"useNaturalPinchZoom",void 0),(0,V.b)([(0,N.L)()],u.prototype,"pinchZoom",void 0),(0,V.b)([(0,N.L)()],u.prototype,"panningSensibility",void 0),(0,V.b)([(0,N.L)()],u.prototype,"multiTouchPanning",void 0),(0,V.b)([(0,N.L)()],u.prototype,"multiTouchPanAndZoom",void 0),r.b.ArcRotateCameraPointersInput=u;var B=G(12009);class I{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(D){D=o.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.uD(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((l=>{const G=l.event;if(!G.metaKey)if(l.type===B.c.KEYDOWN){if(this._ctrlPressed=G.ctrlKey,this._altPressed=G.altKey,-1!==this.keysUp.indexOf(G.keyCode)||-1!==this.keysDown.indexOf(G.keyCode)||-1!==this.keysLeft.indexOf(G.keyCode)||-1!==this.keysRight.indexOf(G.keyCode)||-1!==this.keysReset.indexOf(G.keyCode)){-1===this._keys.indexOf(G.keyCode)&&this._keys.push(G.keyCode),G.preventDefault&&(D||G.preventDefault())}}else if(-1!==this.keysUp.indexOf(G.keyCode)||-1!==this.keysDown.indexOf(G.keyCode)||-1!==this.keysLeft.indexOf(G.keyCode)||-1!==this.keysRight.indexOf(G.keyCode)||-1!==this.keysReset.indexOf(G.keyCode)){const l=this._keys.indexOf(G.keyCode);l>=0&&this._keys.splice(l,1),G.preventDefault&&(D||G.preventDefault())}})))}Dj(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const D=this.camera;for(let l=0;l<this._keys.length;l++){const G=this._keys[l];-1!==this.keysLeft.indexOf(G)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningX-=1/this.panningSensibility:D.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(G)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?D.inertialRadiusOffset+=1/this.zoomingSensibility:D.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(G)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningX+=1/this.panningSensibility:D.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(G)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?D.inertialRadiusOffset-=1/this.zoomingSensibility:D.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(G)&&D.useInputToRestoreState&&D.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,V.b)([(0,N.L)()],I.prototype,"keysUp",void 0),(0,V.b)([(0,N.L)()],I.prototype,"keysDown",void 0),(0,V.b)([(0,N.L)()],I.prototype,"keysLeft",void 0),(0,V.b)([(0,N.L)()],I.prototype,"keysRight",void 0),(0,V.b)([(0,N.L)()],I.prototype,"keysReset",void 0),(0,V.b)([(0,N.L)()],I.prototype,"panningSensibility",void 0),(0,V.b)([(0,N.L)()],I.prototype,"zoomingSensibility",void 0),(0,V.b)([(0,N.L)()],I.prototype,"useAltToZoom",void 0),(0,V.b)([(0,N.L)()],I.prototype,"angularSpeed",void 0),r.b.ArcRotateCameraKeyboardMoveInput=I;var W=G(11759),i=G(12012);class y{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new b.Kl(0,0,0),this._globalOffset=new b.Kl(0,0,0),this._inertialPanning=b.Kl.Zero()}_computeDeltaFromMouseWheelLegacyEvent(D,l){let G=0;const V=.01*D*this.wheelDeltaPercentage*l;return G=D>0?V/(1+this.wheelDeltaPercentage):V*(1+this.wheelDeltaPercentage),G}attachControl(D){D=o.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=l=>{if(l.type!==n.b.POINTERWHEEL)return;const G=l.event;let V=0;const N=G.deltaMode===i.b.DOM_DELTA_LINE?40:1,M=-G.deltaY*N;if(this.customComputeDeltaFromMouseWheel)V=this.customComputeDeltaFromMouseWheel(M,this,G);else if(this.wheelDeltaPercentage){if(V=this._computeDeltaFromMouseWheelLegacyEvent(M,this.camera.radius),V>0){let D=this.camera.radius,l=this.camera.inertialRadiusOffset+V;for(let G=0;G<20&&!(D<=l)&&!(Math.abs(l*this.camera.inertia)<.001);G++)D-=l,l*=this.camera.inertia;D=(0,X.Clamp)(D,0,Number.MAX_VALUE),V=this._computeDeltaFromMouseWheelLegacyEvent(M,D)}}else V=M/(40*this.wheelPrecision);V&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(V)):this.camera.inertialRadiusOffset+=V),G.preventDefault&&(D||G.preventDefault())},this._observer=this.camera.uD()._inputManager._addCameraPointerObserver(this._wheel,n.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Ib(0)}Dj(){this._observer&&(this.camera.uD()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const D=this.camera;0+D.inertialAlphaOffset+D.inertialBetaOffset+D.inertialRadiusOffset&&(this._updateHitPlane(),D.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(D.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const D=this.camera,l=D.target.Fl(D.position);this._hitPlane=W.d.FromPositionAndNormal(D.target,l)}_getPosition(){const D=this.camera,l=D.uD(),G=l.createPickingRay(l.pointerX,l.pointerY,b.Matrix.Identity(),D,!1);0===D.targetScreenOffset.x&&0===D.targetScreenOffset.y||(this._viewOffset.set(D.targetScreenOffset.x,D.targetScreenOffset.y,0),D.getViewMatrix().invertToRef(D._cameraTransformMatrix),this._globalOffset=b.Kl.TransformNormal(this._viewOffset,D._cameraTransformMatrix),G.origin.addInPlace(this._globalOffset));let V=0;return this._hitPlane&&(V=G.intersectsPlane(this._hitPlane)??0),G.origin.addInPlace(G.direction.scaleInPlace(V))}_zoomToMouse(D){const l=this.camera,G=1-l.inertia;if(l.lowerRadiusLimit){const V=l.lowerRadiusLimit??0;l.radius-(l.inertialRadiusOffset+D)/G<V&&(D=(l.radius-V)*G-l.inertialRadiusOffset)}if(l.upperRadiusLimit){const V=l.upperRadiusLimit??0;l.radius-(l.inertialRadiusOffset+D)/G>V&&(D=(l.radius-V)*G-l.inertialRadiusOffset)}const V=D/G/l.radius,N=this._getPosition(),M=b.TmpVectors.Kl[6];N.subtractToRef(l.target,M),M.scaleInPlace(V),M.scaleInPlace(G),this._inertialPanning.addInPlace(M),l.inertialRadiusOffset+=D}_zeroIfClose(D){Math.abs(D.x)<j.b&&(D.x=0),Math.abs(D.y)<j.b&&(D.y=0),Math.abs(D.z)<j.b&&(D.z=0)}}(0,V.b)([(0,N.L)()],y.prototype,"wheelPrecision",void 0),(0,V.b)([(0,N.L)()],y.prototype,"zoomToMouseLocation",void 0),(0,V.b)([(0,N.L)()],y.prototype,"wheelDeltaPercentage",void 0),r.b.ArcRotateCameraMouseWheelInput=y;class S extends r.d{constructor(D){super(D)}addMouseWheel(){return this.add(new y),this}addPointers(){return this.add(new u),this}addKeyboard(){return this.add(new I),this}}var O=G(11667);function s(D,l){return isNaN(D)?l:D}t.e.AddNodeConstructor("ArcRotateCamera",((D,l)=>()=>new U(D,0,0,1,b.Kl.Zero(),l)));class U extends x.e{get target(){return this._target}set target(D){this.setTarget(D)}get targetHost(){return this._targetHost}set targetHost(D){D&&this.setTarget(D)}getTarget(){return this.target}get position(){return this._position}set position(D){this.setPosition(D)}set upVector(D){this._upToYMatrix||(this._yToUpMatrix=new b.Matrix,this._upToYMatrix=new b.Matrix,this._upVector=b.Kl.Zero()),D.normalize(),this._upVector.V(D),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){b.Matrix.RotationAlignToRef(b.Kl.UpReadOnly,this._upVector,this._yToUpMatrix),b.Matrix.RotationAlignToRef(this._upVector,b.Kl.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const D=this.inputs.attached.pointers;return D?D.angularSensibilityX:0}set angularSensibilityX(D){const l=this.inputs.attached.pointers;l&&(l.angularSensibilityX=D)}get angularSensibilityY(){const D=this.inputs.attached.pointers;return D?D.angularSensibilityY:0}set angularSensibilityY(D){const l=this.inputs.attached.pointers;l&&(l.angularSensibilityY=D)}get pinchPrecision(){const D=this.inputs.attached.pointers;return D?D.pinchPrecision:0}set pinchPrecision(D){const l=this.inputs.attached.pointers;l&&(l.pinchPrecision=D)}get pinchDeltaPercentage(){const D=this.inputs.attached.pointers;return D?D.pinchDeltaPercentage:0}set pinchDeltaPercentage(D){const l=this.inputs.attached.pointers;l&&(l.pinchDeltaPercentage=D)}get useNaturalPinchZoom(){const D=this.inputs.attached.pointers;return!!D&&D.useNaturalPinchZoom}set useNaturalPinchZoom(D){const l=this.inputs.attached.pointers;l&&(l.useNaturalPinchZoom=D)}get panningSensibility(){const D=this.inputs.attached.pointers;return D?D.panningSensibility:0}set panningSensibility(D){const l=this.inputs.attached.pointers;l&&(l.panningSensibility=D)}get keysUp(){const D=this.inputs.attached.keyboard;return D?D.keysUp:[]}set keysUp(D){const l=this.inputs.attached.keyboard;l&&(l.keysUp=D)}get keysDown(){const D=this.inputs.attached.keyboard;return D?D.keysDown:[]}set keysDown(D){const l=this.inputs.attached.keyboard;l&&(l.keysDown=D)}get keysLeft(){const D=this.inputs.attached.keyboard;return D?D.keysLeft:[]}set keysLeft(D){const l=this.inputs.attached.keyboard;l&&(l.keysLeft=D)}get keysRight(){const D=this.inputs.attached.keyboard;return D?D.keysRight:[]}set keysRight(D){const l=this.inputs.attached.keyboard;l&&(l.keysRight=D)}get wheelPrecision(){const D=this.inputs.attached.mousewheel;return D?D.wheelPrecision:0}set wheelPrecision(D){const l=this.inputs.attached.mousewheel;l&&(l.wheelPrecision=D)}get zoomToMouseLocation(){const D=this.inputs.attached.mousewheel;return!!D&&D.zoomToMouseLocation}set zoomToMouseLocation(D){const l=this.inputs.attached.mousewheel;l&&(l.zoomToMouseLocation=D)}get wheelDeltaPercentage(){const D=this.inputs.attached.mousewheel;return D?D.wheelDeltaPercentage:0}set wheelDeltaPercentage(D){const l=this.inputs.attached.mousewheel;l&&(l.wheelDeltaPercentage=D)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(D){D!==this.useBouncingBehavior&&(D?(this._bouncingBehavior=new d,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(D){D!==this.useFramingBehavior&&(D?(this._framingBehavior=new H,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(D){D!==this.useAutoRotationBehavior&&(D?(this._autoRotationBehavior=new e,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(D,l,G,V,N,X){var t;let R=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(D,b.Kl.Zero(),X,R),t=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=b.Kl.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=b.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new b.Matrix,this.panningAxis=new b.Kl(1,1,0),this._transformedDirection=new b.Kl,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new M.e,this.checkCollisions=!1,this.collisionRadius=new b.Kl(.5,.5,.5),this._previousPosition=b.Kl.Zero(),this._collisionVelocity=b.Kl.Zero(),this._newPosition=b.Kl.Zero(),this._computationVector=b.Kl.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new b.Kl(NaN,NaN,NaN),this._goalTargetScreenOffset=new b.Vector2(NaN,NaN),this._onCollisionPositionChange=function(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;G?(t.setPosition(l),t.Qe&&t.Qe(G)):t._previousPosition.V(t._position);const V=Math.cos(t.alpha),N=Math.sin(t.alpha),M=Math.cos(t.beta);let b=Math.sin(t.beta);0===b&&(b=1e-4);const X=t._getTargetPosition();t._computationVector.Lb(t.radius*V*b,t.radius*M,t.radius*N*b),X.addToRef(t._computationVector,t._newPosition),t._position.V(t._newPosition);let R=t.upVector;t.allowUpsideDown&&t.beta<0&&(R=R.clone(),R=R.negate()),t._computeViewMatrix(t._position,X,R),t._viewMatrix.addAtIndex(12,t.targetScreenOffset.x),t._viewMatrix.addAtIndex(13,t.targetScreenOffset.y),t._collisionTriggered=!1},this._target=b.Kl.Zero(),N&&this.setTarget(N),this.alpha=l,this.beta=G,this.radius=V,this.getViewMatrix(),this.inputs=new S(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new b.Kl(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=b.Vector2.Zero()}_updateCache(D){D||super._updateCache(),this._cache._target.V(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.V(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const D=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?D.addToRef(this._targetBoundingCenter,this._target):this._target.V(D)}const D=this._getLockedTargetPosition();return D||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>j.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,M=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=M?this._currentInterpolationFactor=M:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=s(D,this._goalAlpha),this._goalBeta=s(l,this._goalBeta),this._goalRadius=s(G,this._goalRadius),this._goalTarget.set(s(V.x,this._goalTarget.x),s(V.y,this._goalTarget.y),s(V.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(s(N.x,this._goalTargetScreenOffset.x),s(N.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,X.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,X.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,X.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,X.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(D,l){let G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const N=arguments;l=o.Tools.BackCompatCameraNoPreventDefault(N),this._useCtrlForPanning=G,this._panningMouseButton=V,"boolean"===typeof N[0]&&(N.length>1&&(this._useCtrlForPanning=N[1]),N.length>2&&(this._panningMouseButton=N[2])),this.inputs.attachElement(l),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Dj(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let D=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){D=!0;const l=this.invertRotation?-1:1,G=this._calculateHandednessMultiplier();let V=this.inertialAlphaOffset*G;this.beta<0&&(V*=-1),this.alpha+=V*l,this.beta+=this.inertialBetaOffset*l,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<j.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<j.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*j.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){D=!0;const l=new b.Kl(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),l.multiplyInPlace(this.panningAxis),b.Kl.TransformNormalToRef(l,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const D=this.upVector,l=b.Kl.CrossToRef(this._transformedDirection,D,this._transformedDirection);b.Kl.CrossToRef(D,l,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);b.Kl.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.V(this._transformedDirection)}else{if(this.parent){const D=b.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(D),D.transposeToRef(D),b.Kl.TransformCoordinatesToRef(this._transformedDirection,D,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*j.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*j.b&&(this.inertialPanningY=0)}if(D)this.stopInterpolation();else if(this._isInterpolating){let D=!1;const l=this._scene.getEngine().getDeltaTime()/1e3,G=1-Math.pow(2,-l/this._currentInterpolationFactor),V=s(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const l=b.TmpVectors.Kl[0].set(s(this._goalTarget.x,this._target.x),s(this._goalTarget.y,this._target.y),s(this._goalTarget.z,this._target.z));b.Kl.LerpToRef(this.target,l,G,this._target),10*b.Kl.Distance(this.target,l)/V<j.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.V(l),this.setTarget(this.target,!1,!0,!0)):D=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const l=b.Quaternion.RotationAlphaBetaGammaToRef(s(this._goalAlpha,this.alpha),s(this._goalBeta,this.beta),0,b.TmpVectors.Quaternion[0]),V=b.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,b.TmpVectors.Quaternion[1]),N=b.Quaternion.SlerpToRef(V,l,G,b.TmpVectors.Quaternion[2]);N.normalize();const M=N.toAlphaBetaGammaToRef(b.TmpVectors.Kl[0]);if(this.alpha=M.x,this.beta=M.y,N.isApprox(l,j.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const D=l.toAlphaBetaGammaToRef(b.TmpVectors.Kl[0]);this.alpha=D.x,this.beta=D.y}else D=!0}if(isNaN(this._goalRadius)||(this.radius+=(V-this.radius)*G,Math.abs(V/this.radius-1)<j.b?(this._goalRadius=NaN,this.radius=V):D=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const l=b.TmpVectors.Vector2[0].set(s(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),s(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));b.Vector2.LerpToRef(this.targetScreenOffset,l,G,this.targetScreenOffset),b.Vector2.Distance(this.targetScreenOffset,l)<j.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.V(l)):D=!0}this._isInterpolating=D}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||b.Kl.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const D=this.alpha;var l,G;this.alpha=function(D){let l=Math.PI/2;return 0===D.x&&0===D.z||(l=Math.acos(D.x/Math.sqrt(Math.pow(D.x,2)+Math.pow(D.z,2)))),D.z<0&&(l=2*Math.PI-l),l}(this._computationVector),this.beta=(l=this._computationVector.y,G=this.radius,Math.acos(l/G));const V=Math.round((D-this.alpha)/(2*Math.PI));this.alpha+=2*V*Math.PI,this._checkLimits()}setPosition(D){this._position.equals(D)||(this._position.V(D),this.rebuildAnglesAndRadius())}setTarget(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(V=this.overrideCloneAlphaBetaRadius??V,D.hb)l&&D.getBoundingInfo?this._targetBoundingCenter=D.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,D.hb(),this._targetHost=D,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const l=D,V=this._getTargetPosition();if(V&&!G&&V.equals(l))return;this._targetHost=null,this._target=l,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}V||this.rebuildAnglesAndRadius()}_getViewMatrix(){const D=Math.cos(this.alpha),l=Math.sin(this.alpha),G=Math.cos(this.beta);let V=Math.sin(this.beta);0===V&&(V=1e-4),0===this.radius&&(this.radius=1e-4);const N=this._getTargetPosition();if(this._computationVector.Lb(this.radius*D*V,this.radius*G,this.radius*l*V),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||b.Kl.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),N.addToRef(this._computationVector,this._newPosition),this.uD().collisionsEnabled&&this.checkCollisions){const D=this.uD().collisionCoordinator;this._collider||(this._collider=D.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,D.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.V(this._newPosition);let D=this.upVector;this.allowUpsideDown&&V<0&&(D=D.negate()),this._computeViewMatrix(this._position,N,D),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.V(N),this._viewMatrix}zoomOn(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];D=D||this.uD().meshes;const G=R.b.MinMax(D);let V=this._calculateLowerRadiusFromModelBoundingSphere(G.min,G.max);if(V=Math.max(Math.min(V,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=V*this.zoomOnFactor,this.mode===h.e.ORTHOGRAPHIC_CAMERA){const D=this.uD().getEngine().getAspectRatio(this),l=V*this.zoomOnFactor/2;this.orthoLeft=-l*D,this.orthoRight=l*D,this.orthoBottom=-l,this.orthoTop=l}this.focusOn({min:G.min,max:G.max,distance:V},l)}focusOn(D){let l,G,V=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===D.min){const V=D||this.uD().meshes;l=R.b.MinMax(V),G=b.Kl.Distance(l.min,l.max)}else{l=D,G=D.distance}this._target=R.b.Center(l),V||(this.maxZ=2*G)}createRigCamera(D,l){let G=0;switch(this.cameraRigMode){case h.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case h.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case h.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case h.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case h.e.RIG_MODE_VR:G=this._cameraRigParams.stereoHalfAngle*(0===l?1:-1);break;case h.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:G=this._cameraRigParams.stereoHalfAngle*(0===l?-1:1)}const V=new U(D,this.alpha+G,this.beta,this.radius,this._target,this.uD());return V._cameraRigParams={},V.isRigCamera=!0,V.rigParent=this,V.upVector=this.upVector,V.mode=this.mode,V.orthoLeft=this.orthoLeft,V.orthoRight=this.orthoRight,V.orthoBottom=this.orthoBottom,V.orthoTop=this.orthoTop,V}_updateRigCameras(){const D=this._rigCameras[0],l=this._rigCameras[1];switch(D.beta=l.beta=this.beta,this.cameraRigMode){case h.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case h.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case h.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case h.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case h.e.RIG_MODE_VR:D.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,l.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case h.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:D.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,l.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const V=b.Kl.Distance(D,l),N=this.uD().getEngine().getAspectRatio(this),M=Math.tan(this.fov/2),X=M*N,t=.5*V*G,R=t*Math.sqrt(1+1/(X*X)),n=t*Math.sqrt(1+1/(M*M));return Math.max(R,n)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,V.b)([(0,N.L)()],U.prototype,"alpha",void 0),(0,V.b)([(0,N.L)()],U.prototype,"beta",void 0),(0,V.b)([(0,N.L)()],U.prototype,"radius",void 0),(0,V.b)([(0,N.L)()],U.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,V.b)([(0,N.I)("target")],U.prototype,"_target",void 0),(0,V.b)([(0,N.x)("targetHost")],U.prototype,"_targetHost",void 0),(0,V.b)([(0,N.L)()],U.prototype,"inertialAlphaOffset",void 0),(0,V.b)([(0,N.L)()],U.prototype,"inertialBetaOffset",void 0),(0,V.b)([(0,N.L)()],U.prototype,"inertialRadiusOffset",void 0),(0,V.b)([(0,N.L)()],U.prototype,"lowerAlphaLimit",void 0),(0,V.b)([(0,N.L)()],U.prototype,"upperAlphaLimit",void 0),(0,V.b)([(0,N.L)()],U.prototype,"lowerBetaLimit",void 0),(0,V.b)([(0,N.L)()],U.prototype,"upperBetaLimit",void 0),(0,V.b)([(0,N.L)()],U.prototype,"lowerRadiusLimit",void 0),(0,V.b)([(0,N.L)()],U.prototype,"upperRadiusLimit",void 0),(0,V.b)([(0,N.L)()],U.prototype,"lowerTargetYLimit",void 0),(0,V.b)([(0,N.L)()],U.prototype,"inertialPanningX",void 0),(0,V.b)([(0,N.L)()],U.prototype,"inertialPanningY",void 0),(0,V.b)([(0,N.L)()],U.prototype,"pinchToPanMaxDistance",void 0),(0,V.b)([(0,N.L)()],U.prototype,"panningDistanceLimit",void 0),(0,V.b)([(0,N.I)()],U.prototype,"panningOriginTarget",void 0),(0,V.b)([(0,N.L)()],U.prototype,"panningInertia",void 0),(0,V.b)([(0,N.L)()],U.prototype,"zoomToMouseLocation",null),(0,V.b)([(0,N.L)()],U.prototype,"zoomOnFactor",void 0),(0,V.b)([(0,N.E)()],U.prototype,"targetScreenOffset",void 0),(0,V.b)([(0,N.L)()],U.prototype,"allowUpsideDown",void 0),(0,V.b)([(0,N.L)()],U.prototype,"useInputToRestoreState",void 0),(0,V.b)([(0,N.L)()],U.prototype,"restoreStateInterpolationFactor",void 0),(0,O.c)("BABYLON.ArcRotateCamera",U)},13346:(D,l,G)=>{"use strict";G.d(l,{b:()=>b,d:()=>X});var V=G(11546),N=G(11739),M=G(12175),b={};class X{constructor(D){this.attachedToElement=!1,this.attached={},this.camera=D,this.checkInputs=()=>{}}add(D){const l=D.getSimpleName();this.attached[l]?V.d.Warn("camera input of type "+l+" already exists on camera"):(this.attached[l]=D,D.camera=this.camera,D.checkInputs&&(this.checkInputs=this._addCheckInputs(D.checkInputs.bind(D))),this.attachedToElement&&D.attachControl(this.noPreventDefault))}remove(D){for(const l in this.attached){const G=this.attached[l];if(G===D)return G.Dj(),G.camera=null,delete this.attached[l],void this.rebuildInputCheck()}}removeByType(D){for(const l in this.attached){const G=this.attached[l];G.getClassName()===D&&(G.Dj(),G.camera=null,delete this.attached[l],this.rebuildInputCheck())}}_addCheckInputs(D){const l=this.checkInputs;return()=>{l(),D()}}attachInput(D){this.attachedToElement&&D.attachControl(this.noPreventDefault)}attachElement(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){D=!M.e.ForceAttachControlToAlwaysPreventDefault&&D,this.attachedToElement=!0,this.noPreventDefault=D;for(const l in this.attached)this.attached[l].attachControl(D)}}detachElement(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const l in this.attached)this.attached[l].Dj(),D&&(this.attached[l].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const D in this.attached){const l=this.attached[D];l.checkInputs&&(this.checkInputs=this._addCheckInputs(l.checkInputs.bind(l)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(D){const l={};for(const G in this.attached){const D=this.attached[G],V=N.c.Serialize(D);l[D.getClassName()]=V}D.inputsmgr=l}parse(D){const l=D.inputsmgr;if(l){this.clear();for(const D in l){const G=b[D];if(G){const V=l[D],M=N.c.Parse((()=>new G),V,null);this.add(M)}}}else for(const G in this.attached){const l=b[this.attached[G].getClassName()];if(l){const V=N.c.Parse((()=>new l),D,null);this.remove(this.attached[G]),this.add(V)}}}}},13342:(D,l,G)=>{"use strict";G.d(l,{b:()=>L});var V=G(11695),N=G(11703),M=G(11710),b=G(12213),X=G(13346),t=G(12009),R=G(11530);class n{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(D){D=R.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.uD(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((l=>{const G=l.event;if(!G.metaKey)if(l.type===t.c.KEYDOWN){if(-1!==this.keysUp.indexOf(G.keyCode)||-1!==this.keysDown.indexOf(G.keyCode)||-1!==this.keysLeft.indexOf(G.keyCode)||-1!==this.keysRight.indexOf(G.keyCode)||-1!==this.keysUpward.indexOf(G.keyCode)||-1!==this.keysDownward.indexOf(G.keyCode)||-1!==this.keysRotateLeft.indexOf(G.keyCode)||-1!==this.keysRotateRight.indexOf(G.keyCode)||-1!==this.keysRotateUp.indexOf(G.keyCode)||-1!==this.keysRotateDown.indexOf(G.keyCode)){-1===this._keys.indexOf(G.keyCode)&&this._keys.push(G.keyCode),D||G.preventDefault()}}else if(-1!==this.keysUp.indexOf(G.keyCode)||-1!==this.keysDown.indexOf(G.keyCode)||-1!==this.keysLeft.indexOf(G.keyCode)||-1!==this.keysRight.indexOf(G.keyCode)||-1!==this.keysUpward.indexOf(G.keyCode)||-1!==this.keysDownward.indexOf(G.keyCode)||-1!==this.keysRotateLeft.indexOf(G.keyCode)||-1!==this.keysRotateRight.indexOf(G.keyCode)||-1!==this.keysRotateUp.indexOf(G.keyCode)||-1!==this.keysRotateDown.indexOf(G.keyCode)){const l=this._keys.indexOf(G.keyCode);l>=0&&this._keys.splice(l,1),D||G.preventDefault()}})))}Dj(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const D=this.camera;for(let l=0;l<this._keys.length;l++){const G=this._keys[l],V=D._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(G)?D._localDirection.Lb(-V,0,0):-1!==this.keysUp.indexOf(G)?D._localDirection.Lb(0,0,V):-1!==this.keysRight.indexOf(G)?D._localDirection.Lb(V,0,0):-1!==this.keysDown.indexOf(G)?D._localDirection.Lb(0,0,-V):-1!==this.keysUpward.indexOf(G)?D._localDirection.Lb(0,V,0):-1!==this.keysDownward.indexOf(G)?D._localDirection.Lb(0,-V,0):-1!==this.keysRotateLeft.indexOf(G)?(D._localDirection.Lb(0,0,0),D.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(G)?(D._localDirection.Lb(0,0,0),D.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(G)?(D._localDirection.Lb(0,0,0),D.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(G)&&(D._localDirection.Lb(0,0,0),D.cameraRotation.x+=this._getLocalRotation()),D.uD().useRightHandedSystem&&(D._localDirection.z*=-1),D.getViewMatrix().invertToRef(D._cameraTransformMatrix),M.Kl.TransformNormalToRef(D._localDirection,D._cameraTransformMatrix,D._transformedDirection),D.cameraDirection.addInPlace(D._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const D=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*D}}(0,V.b)([(0,N.L)()],n.prototype,"keysUp",void 0),(0,V.b)([(0,N.L)()],n.prototype,"keysUpward",void 0),(0,V.b)([(0,N.L)()],n.prototype,"keysDown",void 0),(0,V.b)([(0,N.L)()],n.prototype,"keysDownward",void 0),(0,V.b)([(0,N.L)()],n.prototype,"keysLeft",void 0),(0,V.b)([(0,N.L)()],n.prototype,"keysRight",void 0),(0,V.b)([(0,N.L)()],n.prototype,"rotationSpeed",void 0),(0,V.b)([(0,N.L)()],n.prototype,"keysRotateLeft",void 0),(0,V.b)([(0,N.L)()],n.prototype,"keysRotateRight",void 0),(0,V.b)([(0,N.L)()],n.prototype,"keysRotateUp",void 0),(0,V.b)([(0,N.L)()],n.prototype,"keysRotateDown",void 0),X.b.FreeCameraKeyboardMoveInput=n;var g=G(11532),j=G(12001);class e{constructor(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=D,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new g.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(D){D=R.Tools.BackCompatCameraNoPreventDefault(arguments);const l=this.camera.getEngine(),G=l.getInputElement();this._pointerInput||(this._pointerInput=V=>{const N=V.event,M="touch"===N.pointerType;if(!this.touchEnabled&&M)return;if(V.type!==j.b.POINTERMOVE&&-1===this.buttons.indexOf(N.button))return;const b=N.target;if(V.type===j.b.POINTERDOWN){if(M&&-1!==this._activePointerId||!M&&-1!==this._currentActiveButton)return;this._activePointerId=N.pointerId;try{null===b||void 0===b||b.setPointerCapture(N.pointerId)}catch(X){}-1===this._currentActiveButton&&(this._currentActiveButton=N.button),this._previousPosition={x:N.clientX,y:N.clientY},D||(N.preventDefault(),G&&G.focus()),l.isPointerLock&&this._onMouseMove&&this._onMouseMove(V.event)}else if(V.type===j.b.POINTERUP){if(M&&this._activePointerId!==N.pointerId||!M&&this._currentActiveButton!==N.button)return;try{null===b||void 0===b||b.releasePointerCapture(N.pointerId)}catch(X){}this._currentActiveButton=-1,this._previousPosition=null,D||N.preventDefault(),this._activePointerId=-1}else if(V.type===j.b.POINTERMOVE&&(this._activePointerId===N.pointerId||!M))if(l.isPointerLock&&this._onMouseMove)this._onMouseMove(V.event);else if(this._previousPosition){const l=this.camera._calculateHandednessMultiplier(),G=(N.clientX-this._previousPosition.x)*l,V=N.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=G/this.angularSensibility,this.camera.cameraRotation.x+=V/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:G,offsetY:V}),this._previousPosition={x:N.clientX,y:N.clientY},D||N.preventDefault()}}),this._onMouseMove=G=>{if(!l.isPointerLock)return;const V=this.camera._calculateHandednessMultiplier(),N=G.movementX*V;this.camera.cameraRotation.y+=N/this.angularSensibility;const M=G.movementY;this.camera.cameraRotation.x+=M/this.angularSensibility,this._previousPosition=null,D||G.preventDefault()},this._observer=this.camera.uD()._inputManager._addCameraPointerObserver(this._pointerInput,j.b.POINTERDOWN|j.b.POINTERUP|j.b.POINTERMOVE),G&&(this._contextMenuBind=D=>this.onContextMenu(D),G.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(D){D.preventDefault()}Dj(){if(this._observer){if(this.camera.uD()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const D=this.camera.getEngine().getInputElement();D&&D.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,V.b)([(0,N.L)()],e.prototype,"buttons",void 0),(0,V.b)([(0,N.L)()],e.prototype,"angularSensibility",void 0),X.b.FreeCameraMouseInput=e;var K,F=G(12012);class d{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new g.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(D){D=R.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=l=>{if(l.type!==j.b.POINTERWHEEL)return;const G=l.event,V=G.deltaMode===F.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*V*G.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*V*G.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*V*G.deltaZ/this._normalize,G.preventDefault&&(D||G.preventDefault())},this._observer=this.camera.uD()._inputManager._addCameraPointerObserver(this._wheel,j.b.POINTERWHEEL)}Dj(){this._observer&&(this.camera.uD()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,V.b)([(0,N.L)()],d.prototype,"wheelPrecisionX",void 0),(0,V.b)([(0,N.L)()],d.prototype,"wheelPrecisionY",void 0),(0,V.b)([(0,N.L)()],d.prototype,"wheelPrecisionZ",void 0),function(D){D[D.MoveRelative=0]="MoveRelative",D[D.RotateRelative=1]="RotateRelative",D[D.MoveScene=2]="MoveScene"}(K||(K={}));class H extends d{constructor(){super(...arguments),this._moveRelative=M.Kl.Zero(),this._rotateRelative=M.Kl.Zero(),this._moveScene=M.Kl.Zero(),this._wheelXAction=K.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=K.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(D){null===D&&this._wheelXAction!==K.MoveRelative||(this._wheelXAction=K.MoveRelative,this._wheelXActionCoordinate=D)}get wheelXMoveRelative(){return this._wheelXAction!==K.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(D){null===D&&this._wheelYAction!==K.MoveRelative||(this._wheelYAction=K.MoveRelative,this._wheelYActionCoordinate=D)}get wheelYMoveRelative(){return this._wheelYAction!==K.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(D){null===D&&this._wheelZAction!==K.MoveRelative||(this._wheelZAction=K.MoveRelative,this._wheelZActionCoordinate=D)}get wheelZMoveRelative(){return this._wheelZAction!==K.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(D){null===D&&this._wheelXAction!==K.RotateRelative||(this._wheelXAction=K.RotateRelative,this._wheelXActionCoordinate=D)}get wheelXRotateRelative(){return this._wheelXAction!==K.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(D){null===D&&this._wheelYAction!==K.RotateRelative||(this._wheelYAction=K.RotateRelative,this._wheelYActionCoordinate=D)}get wheelYRotateRelative(){return this._wheelYAction!==K.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(D){null===D&&this._wheelZAction!==K.RotateRelative||(this._wheelZAction=K.RotateRelative,this._wheelZActionCoordinate=D)}get wheelZRotateRelative(){return this._wheelZAction!==K.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(D){null===D&&this._wheelXAction!==K.MoveScene||(this._wheelXAction=K.MoveScene,this._wheelXActionCoordinate=D)}get wheelXMoveScene(){return this._wheelXAction!==K.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(D){null===D&&this._wheelYAction!==K.MoveScene||(this._wheelYAction=K.MoveScene,this._wheelYActionCoordinate=D)}get wheelYMoveScene(){return this._wheelYAction!==K.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(D){null===D&&this._wheelZAction!==K.MoveScene||(this._wheelZAction=K.MoveScene,this._wheelZActionCoordinate=D)}get wheelZMoveScene(){return this._wheelZAction!==K.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Ib(0),this._rotateRelative.Ib(0),this._moveScene.Ib(0),this._updateCamera(),this.camera.uD().useRightHandedSystem&&(this._moveRelative.z*=-1);const D=M.Matrix.Zero();this.camera.getViewMatrix().invertToRef(D);const l=M.Kl.Zero();M.Kl.TransformNormalToRef(this._moveRelative,D,l),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(l),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(D,l,G){if(0===D)return;if(null===l||null===G)return;let V=null;switch(l){case K.MoveRelative:V=this._moveRelative;break;case K.RotateRelative:V=this._rotateRelative;break;case K.MoveScene:V=this._moveScene}switch(G){case 0:V.set(D,0,0);break;case 1:V.set(0,D,0);break;case 2:V.set(0,0,D)}}}(0,V.b)([(0,N.L)()],H.prototype,"wheelXMoveRelative",null),(0,V.b)([(0,N.L)()],H.prototype,"wheelYMoveRelative",null),(0,V.b)([(0,N.L)()],H.prototype,"wheelZMoveRelative",null),(0,V.b)([(0,N.L)()],H.prototype,"wheelXRotateRelative",null),(0,V.b)([(0,N.L)()],H.prototype,"wheelYRotateRelative",null),(0,V.b)([(0,N.L)()],H.prototype,"wheelZRotateRelative",null),(0,V.b)([(0,N.L)()],H.prototype,"wheelXMoveScene",null),(0,V.b)([(0,N.L)()],H.prototype,"wheelYMoveScene",null),(0,V.b)([(0,N.L)()],H.prototype,"wheelZMoveScene",null),X.b.FreeCameraMouseWheelInput=H;class h{constructor(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=D,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=R.Tools.IsSafari()}attachControl(D){D=R.Tools.BackCompatCameraNoPreventDefault(arguments);let l=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=G=>{const V=G.event,N="mouse"===V.pointerType||this._isSafari&&"undefined"===typeof V.pointerType;if(this.allowMouse||!N)if(G.type===j.b.POINTERDOWN){if(D||V.preventDefault(),this._pointerPressed.push(V.pointerId),1!==this._pointerPressed.length)return;l={x:V.clientX,y:V.clientY}}else if(G.type===j.b.POINTERUP){D||V.preventDefault();const G=this._pointerPressed.indexOf(V.pointerId);if(-1===G)return;if(this._pointerPressed.splice(G,1),0!=G)return;l=null,this._offsetX=null,this._offsetY=null}else if(G.type===j.b.POINTERMOVE){if(D||V.preventDefault(),!l)return;if(0!=this._pointerPressed.indexOf(V.pointerId))return;this._offsetX=V.clientX-l.x,this._offsetY=-(V.clientY-l.y)}}),this._observer=this.camera.uD()._inputManager._addCameraPointerObserver(this._pointerInput,j.b.POINTERDOWN|j.b.POINTERUP|j.b.POINTERMOVE),this._onLostFocus){const D=this.camera.getEngine().getInputElement();D&&D.addEventListener("blur",this._onLostFocus)}}Dj(){if(this._pointerInput){if(this._observer&&(this.camera.uD()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const D=this.camera.getEngine().getInputElement();D&&D.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const D=this.camera,l=D._calculateHandednessMultiplier();D.cameraRotation.y=l*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)D.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const l=D._computeLocalCameraSpeed(),G=new M.Kl(0,0,0!==this.touchMoveSensibility?l*this._offsetY/this.touchMoveSensibility:0);M.Matrix.RotationYawPitchRollToRef(D.rotation.y,D.rotation.x,0,D._cameraRotationMatrix),D.cameraDirection.addInPlace(M.Kl.TransformCoordinates(G,D._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,V.b)([(0,N.L)()],h.prototype,"touchAngularSensibility",void 0),(0,V.b)([(0,N.L)()],h.prototype,"touchMoveSensibility",void 0),X.b.FreeCameraTouchInput=h;class x extends X.d{constructor(D){super(D),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new n),this}addMouse(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new e(D),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new H,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new h),this}clear(){super.clear(),this._mouseInput=null}}var r=G(11667),o=G(11613);class L extends b.e{get angularSensibility(){const D=this.inputs.attached.mouse;return D?D.angularSensibility:0}set angularSensibility(D){const l=this.inputs.attached.mouse;l&&(l.angularSensibility=D)}get keysUp(){const D=this.inputs.attached.keyboard;return D?D.keysUp:[]}set keysUp(D){const l=this.inputs.attached.keyboard;l&&(l.keysUp=D)}get keysUpward(){const D=this.inputs.attached.keyboard;return D?D.keysUpward:[]}set keysUpward(D){const l=this.inputs.attached.keyboard;l&&(l.keysUpward=D)}get keysDown(){const D=this.inputs.attached.keyboard;return D?D.keysDown:[]}set keysDown(D){const l=this.inputs.attached.keyboard;l&&(l.keysDown=D)}get keysDownward(){const D=this.inputs.attached.keyboard;return D?D.keysDownward:[]}set keysDownward(D){const l=this.inputs.attached.keyboard;l&&(l.keysDownward=D)}get keysLeft(){const D=this.inputs.attached.keyboard;return D?D.keysLeft:[]}set keysLeft(D){const l=this.inputs.attached.keyboard;l&&(l.keysLeft=D)}get keysRight(){const D=this.inputs.attached.keyboard;return D?D.keysRight:[]}set keysRight(D){const l=this.inputs.attached.keyboard;l&&(l.keysRight=D)}get keysRotateLeft(){const D=this.inputs.attached.keyboard;return D?D.keysRotateLeft:[]}set keysRotateLeft(D){const l=this.inputs.attached.keyboard;l&&(l.keysRotateLeft=D)}get keysRotateRight(){const D=this.inputs.attached.keyboard;return D?D.keysRotateRight:[]}set keysRotateRight(D){const l=this.inputs.attached.keyboard;l&&(l.keysRotateRight=D)}get keysRotateUp(){const D=this.inputs.attached.keyboard;return D?D.keysRotateUp:[]}set keysRotateUp(D){const l=this.inputs.attached.keyboard;l&&(l.keysRotateUp=D)}get keysRotateDown(){const D=this.inputs.attached.keyboard;return D?D.keysRotateDown:[]}set keysRotateDown(D){const l=this.inputs.attached.keyboard;l&&(l.keysRotateDown=D)}constructor(D,l,G){var V;super(D,l,G,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),V=this,this.ellipsoid=new M.Kl(.5,1,.5),this.ellipsoidOffset=new M.Kl(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=M.Kl.Zero(),this._diffPosition=M.Kl.Zero(),this._newPosition=M.Kl.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V._newPosition.V(l),V._newPosition.subtractToRef(V._oldPosition,V._diffPosition),V._diffPosition.length()>o.e.CollisionsEpsilon&&(V.position.addToRef(V._diffPosition,V._deferredPositionUpdate),V._deferOnly?V._deferredUpdated=!0:V.position.V(V._deferredPositionUpdate),V.Qe&&G&&V.Qe(G))},this.inputs=new x(this),this.inputs.addKeyboard().addMouse()}attachControl(D,l){l=R.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(l)}Dj(){this.inputs.detachElement(),this.cameraDirection=new M.Kl(0,0,0),this.cameraRotation=new M.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(D){this._collisionMask=isNaN(D)?-1:D}_collideWithWorld(D){let l;l=this.parent?M.Kl.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,l.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const G=this.uD().collisionCoordinator;this._collider||(this._collider=G.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let V=D;this.applyGravity&&(V=D.add(this.uD().gravity)),G.getNewPosition(this._oldPosition,V,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=M.Kl.Zero(),this._transformedDirection=M.Kl.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(D){this._needMoveForGravity=D}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.uD().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"cb"}}(0,V.b)([(0,N.I)()],L.prototype,"ellipsoid",void 0),(0,V.b)([(0,N.I)()],L.prototype,"ellipsoidOffset",void 0),(0,V.b)([(0,N.L)()],L.prototype,"checkCollisions",void 0),(0,V.b)([(0,N.L)()],L.prototype,"applyGravity",void 0),(0,r.c)("BABYLON.FreeCamera",L)},13896:(D,l,G)=>{"use strict";G.d(l,{b:()=>M});var V=G(11811),N=G(13904);class M{constructor(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=G,this.Rg=[],this._maxBlockCapacity=l||64,this._selectionContent=new V.c(1024),this._creationFunc=D}update(D,l,G){N.d._CreateBlocks(D,l,G,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}jn(D){for(let l=0;l<this.In.length;l++){this.In[l].addEntry(D)}}gn(D){for(let l=0;l<this.In.length;l++){this.In[l].removeEntry(D)}}select(D,l){this._selectionContent.reset();for(let G=0;G<this.In.length;G++){this.In[G].select(D,this._selectionContent,l)}return l?this._selectionContent.concat(this.Rg):this._selectionContent.concatWithNoDuplicate(this.Rg),this._selectionContent}intersects(D,l,G){this._selectionContent.reset();for(let V=0;V<this.In.length;V++){this.In[V].intersects(D,l,this._selectionContent,G)}return G?this._selectionContent.concat(this.Rg):this._selectionContent.concatWithNoDuplicate(this.Rg),this._selectionContent}intersectsRay(D){this._selectionContent.reset();for(let l=0;l<this.In.length;l++){this.In[l].intersectsRay(D,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Rg),this._selectionContent}}M.CreationFuncForMeshes=(D,l)=>{const G=D.getBoundingInfo();!D.isBlocked&&G.boundingBox.intersectsMinMax(l.Fg,l.xg)&&l.entries.push(D)},M.CreationFuncForSubMeshes=(D,l)=>{D.getBoundingInfo().boundingBox.intersectsMinMax(l.Fg,l.xg)&&l.entries.push(D)}},13904:(D,l,G)=>{"use strict";G.d(l,{d:()=>M});var V=G(11710),N=G(12079);class M{constructor(D,l,G,V,N,M){this.entries=[],this.rg=new Array,this._capacity=G,this._depth=V,this._maxDepth=N,this._creationFunc=M,this._minPoint=D,this._maxPoint=l,this.rg.push(D.clone()),this.rg.push(l.clone()),this.rg.push(D.clone()),this.rg[2].x=l.x,this.rg.push(D.clone()),this.rg[3].y=l.y,this.rg.push(D.clone()),this.rg[4].z=l.z,this.rg.push(l.clone()),this.rg[5].z=D.z,this.rg.push(l.clone()),this.rg[6].x=D.x,this.rg.push(l.clone()),this.rg[7].y=D.y}get nG(){return this._capacity}get Fg(){return this._minPoint}get xg(){return this._maxPoint}addEntry(D){if(this.In)for(let l=0;l<this.In.length;l++){this.In[l].addEntry(D)}else this._creationFunc(D,this),this.entries.length>this.nG&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(D){if(this.In){for(let l=0;l<this.In.length;l++){this.In[l].removeEntry(D)}return}const l=this.entries.indexOf(D);l>-1&&this.entries.splice(l,1)}addEntries(D){for(let l=0;l<D.length;l++){const G=D[l];this.addEntry(G)}}select(D,l,G){if(N.d.IsInFrustum(this.rg,D)){if(this.In){for(let V=0;V<this.In.length;V++){this.In[V].select(D,l,G)}return}G?l.concat(this.entries):l.concatWithNoDuplicate(this.entries)}}intersects(D,l,G,V){if(N.d.IntersectsSphere(this._minPoint,this._maxPoint,D,l)){if(this.In){for(let N=0;N<this.In.length;N++){this.In[N].intersects(D,l,G,V)}return}V?G.concat(this.entries):G.concatWithNoDuplicate(this.entries)}}intersectsRay(D,l){if(D.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.In){for(let G=0;G<this.In.length;G++){this.In[G].intersectsRay(D,l)}return}l.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){M._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(D,l,G,N,b,X,t,R){t.In=new Array;const n=new V.Kl((l.x-D.x)/2,(l.y-D.y)/2,(l.z-D.z)/2);for(let V=0;V<2;V++)for(let l=0;l<2;l++)for(let g=0;g<2;g++){const j=D.add(n.multiplyByFloats(V,l,g)),e=D.add(n.multiplyByFloats(V+1,l+1,g+1)),K=new M(j,e,N,b+1,X,R);K.addEntries(G),t.In.push(K)}}}},13911:(D,l,G)=>{"use strict";G.d(l,{d:()=>n});var V=G(11963),N=G(11710),M=G(12149),b=G(13117),X=G(11998),t=G(13896),R=G(11571);V.b.prototype.createOrUpdateSelectionOctree=function(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,G=this._getComponent(X.e.NAME_OCTREE);G||(G=new n(this),this.o(G)),this.Xg||(this.Xg=new t.b(t.b.CreationFuncForMeshes,D,l));const V=this.getWorldExtends();return this.Xg.update(V.min,V.max,this.meshes),this.Xg},Object.defineProperty(V.b.prototype,"selectionOctree",{get:function(){return this.Xg},enumerable:!0,configurable:!0}),M.d.prototype.createOrUpdateSubmeshesOctree=function(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const G=this.uD();let V=G._getComponent(X.e.NAME_OCTREE);V||(V=new n(G),G.o(V)),this._submeshesOctree||(this._submeshesOctree=new t.b(t.b.CreationFuncForSubMeshes,D,l)),this.hb(!0);const N=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(N.minimumWorld,N.maximumWorld,this.nb),this._submeshesOctree};class n{constructor(D){this.name=X.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new b.d(N.Kl.Zero(),new N.Kl(1,1,1)),(D=D||R.d.LastCreatedScene)&&(this.dl=D,this.dl.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.dl.getActiveSubMeshCandidates=D=>this.getActiveSubMeshCandidates(D),this.dl.getCollidingSubMeshCandidates=(D,l)=>this.getCollidingSubMeshCandidates(D,l),this.dl.getIntersectingSubMeshCandidates=(D,l)=>this.getIntersectingSubMeshCandidates(D,l))}register(){this.dl.onMeshRemovedObservable.add((D=>{const l=this.dl.selectionOctree;if(void 0!==l&&null!==l){const G=l.Rg.indexOf(D);-1!==G&&l.Rg.splice(G,1)}})),this.dl.onMeshImportedObservable.add((D=>{const l=this.dl.selectionOctree;void 0!==l&&null!==l&&l.jn(D)}))}getActiveMeshCandidates(){var D;return(null===(D=this.dl.Xg)||void 0===D?void 0:D.select(this.dl.frustumPlanes))||this.dl._getDefaultMeshCandidates()}getActiveSubMeshCandidates(D){if(D._submeshesOctree&&D.useOctreeForRenderingSelection){return D._submeshesOctree.select(this.dl.frustumPlanes)}return this.dl._getDefaultSubMeshCandidates(D)}getIntersectingSubMeshCandidates(D,l){if(D._submeshesOctree&&D.useOctreeForPicking){b.d.TransformToRef(l,D.getWorldMatrix(),this._tempRay);return D._submeshesOctree.intersectsRay(this._tempRay)}return this.dl._getDefaultSubMeshCandidates(D)}getCollidingSubMeshCandidates(D,l){if(D._submeshesOctree&&D.useOctreeForCollisions){const G=l._velocityWorldLength+Math.max(l._radius.x,l._radius.y,l._radius.z);return D._submeshesOctree.intersects(l._basePointWorld,G)}return this.dl._getDefaultSubMeshCandidates(D)}rebuild(){}dispose(){}}},13117:(D,l,G)=>{"use strict";G.d(l,{d:()=>e});var V=G(11963),N=G(12175),M=G(11713),b=G(11710),X=G(11721),t=G(12066),R=G(11993),n=G(11571),g=G(12018);const j={internalPickerForMesh:void 0};class e{constructor(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M.b;this.origin=D,this.direction=l,this.length=G,this.epsilon=V}clone(){return new e(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const V=e._TmpVector3[0].Lb(D.x-G,D.y-G,D.z-G),N=e._TmpVector3[1].Lb(l.x+G,l.y+G,l.z+G);let M,b,X,t,R=0,n=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<V.x||this.origin.x>N.x)return!1}else if(M=1/this.direction.x,b=(V.x-this.origin.x)*M,X=(N.x-this.origin.x)*M,X===-1/0&&(X=1/0),b>X&&(t=b,b=X,X=t),R=Math.max(b,R),n=Math.min(X,n),R>n)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<V.y||this.origin.y>N.y)return!1}else if(M=1/this.direction.y,b=(V.y-this.origin.y)*M,X=(N.y-this.origin.y)*M,X===-1/0&&(X=1/0),b>X&&(t=b,b=X,X=t),R=Math.max(b,R),n=Math.min(X,n),R>n)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<V.z||this.origin.z>N.z)return!1}else if(M=1/this.direction.z,b=(V.z-this.origin.z)*M,X=(N.z-this.origin.z)*M,X===-1/0&&(X=1/0),b>X&&(t=b,b=X,X=t),R=Math.max(b,R),n=Math.min(X,n),R>n)return!1;return!0}intersectsBox(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(D.minimum,D.maximum,l)}intersectsSphere(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const G=D.center.x-this.origin.x,V=D.center.y-this.origin.y,N=D.center.z-this.origin.z,M=G*G+V*V+N*N,b=D.radius+l,X=b*b;if(M<=X)return!0;const t=G*this.direction.x+V*this.direction.y+N*this.direction.z;if(t<0)return!1;return M-t*t<=X}intersectsTriangle(D,l,G){const V=e._TmpVector3[0],N=e._TmpVector3[1],M=e._TmpVector3[2],X=e._TmpVector3[3],R=e._TmpVector3[4];l.subtractToRef(D,V),G.subtractToRef(D,N),b.Kl.CrossToRef(this.direction,N,M);const n=b.Kl.Dot(V,M);if(0===n)return null;const g=1/n;this.origin.subtractToRef(D,X);const j=b.Kl.Dot(X,M)*g;if(j<-this.epsilon||j>1+this.epsilon)return null;b.Kl.CrossToRef(X,V,R);const K=b.Kl.Dot(this.direction,R)*g;if(K<-this.epsilon||j+K>1+this.epsilon)return null;const F=b.Kl.Dot(N,R)*g;return F>this.length?null:new t.e(1-j-K,j,F)}intersectsPlane(D){let l;const G=b.Kl.Dot(D.normal,this.direction);if(Math.abs(G)<9.99999997475243e-7)return null;{const V=b.Kl.Dot(D.normal,this.origin);return l=(-D.d-V)/G,l<0?l<-9.99999997475243e-7?null:0:l}}intersectsAxis(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(D){case"y":{const D=(this.origin.y-l)/this.direction.y;return D>0?null:new b.Kl(this.origin.x+this.direction.x*-D,l,this.origin.z+this.direction.z*-D)}case"x":{const D=(this.origin.x-l)/this.direction.x;return D>0?null:new b.Kl(l,this.origin.y+this.direction.y*-D,this.origin.z+this.direction.z*-D)}case"z":{const D=(this.origin.z-l)/this.direction.z;return D>0?null:new b.Kl(this.origin.x+this.direction.x*-D,this.origin.y+this.direction.y*-D,l)}default:return null}}intersectsMesh(D,l,G){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const X=b.TmpVectors.Matrix[0];return D.getWorldMatrix().invertToRef(X),this._tmpRay?e.TransformToRef(this,X,this._tmpRay):this._tmpRay=e.Transform(this,X),D.intersects(this._tmpRay,l,G,V,N,M)}intersectsMeshes(D,l,G){G?G.length=0:G=[];for(let V=0;V<D.length;V++){const N=this.intersectsMesh(D[V],l);N.hit&&G.push(N)}return G.sort(this._comparePickingInfo),G}_comparePickingInfo(D,l){return D.distance<l.distance?-1:D.distance>l.distance?1:0}intersectionSegment(D,l,G){const V=this.origin,N=b.TmpVectors.Kl[0],M=b.TmpVectors.Kl[1],X=b.TmpVectors.Kl[2],t=b.TmpVectors.Kl[3];l.subtractToRef(D,N),this.direction.scaleToRef(e._Rayl,X),V.addToRef(X,M),D.subtractToRef(V,t);const R=b.Kl.Dot(N,N),n=b.Kl.Dot(N,X),g=b.Kl.Dot(X,X),j=b.Kl.Dot(N,t),K=b.Kl.Dot(X,t),F=R*g-n*n;let d,H,h=F,x=F;F<e._Smallnum?(d=0,h=1,H=K,x=g):(d=n*K-g*j,H=R*K-n*j,d<0?(d=0,H=K,x=g):d>h&&(d=h,H=K+n,x=g)),H<0?(H=0,-j<0?d=0:-j>R?d=h:(d=-j,h=R)):H>x&&(H=x,-j+n<0?d=0:-j+n>R?d=h:(d=-j+n,h=R));const r=Math.abs(d)<e._Smallnum?0:d/h,o=Math.abs(H)<e._Smallnum?0:H/x,L=b.TmpVectors.Kl[4];X.scaleToRef(o,L);const u=b.TmpVectors.Kl[5];N.scaleToRef(r,u),u.addInPlace(t);const B=b.TmpVectors.Kl[6];u.subtractToRef(L,B);return o>0&&o<=this.length&&B.lengthSquared()<G*G?u.length():-1}update(D,l,G,V,N,M,X){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){e._RayDistant||(e._RayDistant=e.Zero()),e._RayDistant.unprojectRayToRef(D,l,G,V,b.Matrix.IdentityReadOnly,M,X);const t=b.TmpVectors.Matrix[0];N.invertToRef(t),e.TransformToRef(e._RayDistant,t,this)}else this.unprojectRayToRef(D,l,G,V,N,M,X);return this}static Zero(){return new e(b.Kl.Zero(),b.Kl.Zero())}static CreateNew(D,l,G,V,N,M,b){return e.Zero().update(D,l,G,V,N,M,b)}static CreateNewFromTo(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.Matrix.IdentityReadOnly;const V=new e(new b.Kl(0,0,0),new b.Kl(0,0,0));return e.CreateFromToToRef(D,l,V,G)}static CreateFromToToRef(D,l,G){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b.Matrix.IdentityReadOnly;G.origin.V(D);const N=l.subtractToRef(D,G.direction),M=Math.sqrt(N.x*N.x+N.y*N.y+N.z*N.z);return G.length=M,G.direction.normalize(),e.TransformToRef(G,V,G)}static Transform(D,l){const G=new e(new b.Kl(0,0,0),new b.Kl(0,0,0));return e.TransformToRef(D,l,G),G}static TransformToRef(D,l,G){b.Kl.TransformCoordinatesToRef(D.origin,l,G.origin),b.Kl.TransformNormalToRef(D.direction,l,G.direction),G.length=D.length,G.epsilon=D.epsilon;const V=G.direction,N=V.length();if(0!==N&&1!==N){const D=1/N;V.x*=D,V.y*=D,V.z*=D,G.length*=N}return G}unprojectRayToRef(D,l,G,V,N,M,X){const t=b.TmpVectors.Matrix[0];N.multiplyToRef(M,t),t.multiplyToRef(X,t),t.invert();const R=n.d.LastCreatedEngine,g=b.TmpVectors.Kl[0];g.x=D/G*2-1,g.y=-(l/V*2-1),g.z=null!==R&&void 0!==R&&R.useReverseDepthBuffer?1:null!==R&&void 0!==R&&R.isNDCHalfZRange?0:-1;const j=b.TmpVectors.Kl[1].Lb(g.x,g.y,1-1e-8),e=b.TmpVectors.Kl[2],K=b.TmpVectors.Kl[3];b.Kl._UnprojectFromInvertedMatrixToRef(g,t,e),b.Kl._UnprojectFromInvertedMatrixToRef(j,t,K),this.origin.V(e),K.subtractToRef(e,this.direction),this.direction.normalize()}}function K(D,l,G,V,N){let M=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const b=e.Zero();return F(D,l,G,V,b,N,M),b}function F(D,l,G,V,N,M){let X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const R=D.getEngine();if(!M&&!(M=D.activeCamera))return D;const n=M.viewport,g=R.getRenderHeight(),{x:j,y:e,width:K,height:F}=n.toGlobal(R.getRenderWidth(),g),d=1/R.getHardwareScalingLevel();return l=l*d-j,G=G*d-(g-e-F),N.update(l,G,K,F,V||b.Matrix.IdentityReadOnly,X?b.Matrix.IdentityReadOnly:M.getViewMatrix(),M.getProjectionMatrix(),t),D}function d(D,l,G,V,N){if(!R.c)return D;const M=D.getEngine();if(!N&&!(N=D.activeCamera))throw new Error("Active camera not set");const X=N.viewport,t=M.getRenderHeight(),{x:n,y:g,width:j,height:e}=X.toGlobal(M.getRenderWidth(),t),K=b.Matrix.Identity(),F=1/M.getHardwareScalingLevel();return l=l*F-n,G=G*F-(t-g-e),V.update(l,G,j,e,K,K,N.getProjectionMatrix()),D}function H(D,l,G,V,N,M,b,X){const t=l(V,G.enableDistantPicking),R=G.intersects(t,N,b,M,V,X);return R&&R.hit?!N&&null!=D&&R.distance>=D.distance?null:R:null}function h(D,l,G,V,N,M){let X=null;const t=!!(D.activeCameras&&D.activeCameras.length>1&&D.cameraToUseForPointers!==D.activeCamera),n=D.cameraToUseForPointers||D.activeCamera,g=j.internalPickerForMesh||H;for(let R=0;R<D.meshes.length;R++){const j=D.meshes[R];if(G){if(!G(j,-1))continue}else if(!j.isEnabled()||!j.isVisible||!j.Ct)continue;const e=t&&j.isWorldMatrixCameraDependent(),K=j.hb(e,n);if(j.hasThinInstances&&j.yR){const D=g(X,l,j,K,!0,!0,M);if(D){if(N)return D;const t=b.TmpVectors.Matrix[1],R=j.thinInstanceGetWorldMatrices();for(let D=0;D<R.length;D++){if(G&&!G(j,D))continue;R[D].multiplyToRef(K,t);const b=g(X,l,j,t,V,N,M,!0);if(b&&(X=b,X.thinInstanceIndex=D,V))return X}}}else{const D=g(X,l,j,K,V,N,M);if(D&&(X=D,V))return X}}return X||new R.c}function x(D,l,G,V){if(!R.c)return null;const N=[],M=!!(D.activeCameras&&D.activeCameras.length>1&&D.cameraToUseForPointers!==D.activeCamera),X=D.cameraToUseForPointers||D.activeCamera,t=j.internalPickerForMesh||H;for(let R=0;R<D.meshes.length;R++){const n=D.meshes[R];if(G){if(!G(n,-1))continue}else if(!n.isEnabled()||!n.isVisible||!n.Ct)continue;const g=M&&n.isWorldMatrixCameraDependent(),j=n.hb(g,X);if(n.hasThinInstances&&n.yR){if(t(null,l,n,j,!0,!0,V)){const D=b.TmpVectors.Matrix[1],M=n.thinInstanceGetWorldMatrices();for(let b=0;b<M.length;b++){if(G&&!G(n,b))continue;M[b].multiplyToRef(j,D);const X=t(null,l,n,D,!1,!1,V,!0);X&&(X.thinInstanceIndex=b,N.push(X))}}}else{const D=t(null,l,n,j,!1,!1,V);D&&N.push(D)}}return N}function r(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,V=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;V||(V=D.getWorldMatrix()),l.length=G,N?l.origin.V(N):l.origin.V(D.position);const M=b.TmpVectors.Kl[2];M.set(0,0,D._scene.useRightHandedSystem?-1:1);const X=b.TmpVectors.Kl[3];return b.Kl.TransformNormalToRef(M,V,X),b.Kl.NormalizeToRef(X,l.direction),l}var o,L;e._TmpVector3=(0,X.b)(6,b.Kl.Zero),e._RayDistant=e.Zero(),e._Smallnum=1e-8,e._Rayl=1e9,o=V.b,(L=N.e)&&(L.prototype.getForwardRay=function(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,l=arguments.length>1?arguments[1]:void 0,G=arguments.length>2?arguments[2]:void 0;return r(this,new e(b.Kl.Zero(),b.Kl.Zero(),D),D,l,G)},L.prototype.getForwardRayToRef=function(D){return r(this,D,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),o&&(g.d._IsPickingAvailable=!0,o.prototype.createPickingRay=function(D,l,G,V){return K(this,D,l,G,V,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),V.b.prototype.createPickingRayToRef=function(D,l,G,V,N){return F(this,D,l,G,V,N,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},V.b.prototype.createPickingRayInCameraSpace=function(D,l,G){return function(D,l,G,V){const N=e.Zero();return d(D,l,G,N,V),N}(this,D,l,G)},V.b.prototype.createPickingRayInCameraSpaceToRef=function(D,l,G,V){return d(this,D,l,G,V)},V.b.prototype.pickWithBoundingInfo=function(D,l,G,V,N){return function(D,l,G,V,N,M){if(!R.c)return null;const X=h(D,(V=>(D._tempPickingRay||(D._tempPickingRay=e.Zero()),F(D,l,G,V,D._tempPickingRay,M||null),D._tempPickingRay)),V,N,!0);return X&&(X.ray=K(D,l,G,b.Matrix.Identity(),M||null)),X}(this,D,l,G,V,N)},V.b.prototype.eG=function(D,l,G,V,N,M){return function(D,l,G,V,N,M,X){const t=h(D,((V,N)=>(D._tempPickingRay||(D._tempPickingRay=e.Zero()),F(D,l,G,V,D._tempPickingRay,M||null,!1,N),D._tempPickingRay)),V,N,!1,X);return t&&(t.ray=K(D,l,G,b.Matrix.Identity(),M||null)),t}(this,D,l,G,V,N,M)},V.b.prototype.pickWithRay=function(D,l,G,V){return function(D,l,G,V,N){const M=h(D,(G=>(D._pickWithRayInverseMatrix||(D._pickWithRayInverseMatrix=b.Matrix.Identity()),G.invertToRef(D._pickWithRayInverseMatrix),D._cachedRayForTransform||(D._cachedRayForTransform=e.Zero()),e.TransformToRef(l,D._pickWithRayInverseMatrix,D._cachedRayForTransform),D._cachedRayForTransform)),G,V,!1,N);return M&&(M.ray=l),M}(this,D,l,G,V)},V.b.prototype.multiPick=function(D,l,G,V,N){return function(D,l,G,V,N,M){return x(D,(V=>K(D,l,G,V,N||null)),V,M)}(this,D,l,G,V,N)},V.b.prototype.multiPickWithRay=function(D,l,G){return function(D,l,G,V){return x(D,(G=>(D._pickWithRayInverseMatrix||(D._pickWithRayInverseMatrix=b.Matrix.Identity()),G.invertToRef(D._pickWithRayInverseMatrix),D._cachedRayForTransform||(D._cachedRayForTransform=e.Zero()),e.TransformToRef(l,D._pickWithRayInverseMatrix,D._cachedRayForTransform),D._cachedRayForTransform)),G,V)}(this,D,l,G)}},13392:(D,l,G)=>{"use strict";var V=G(11644),N=G(11546),M=G(11573),b=G(11672),X=G(11613),t=G(11657);X.e.prototype._partialLoadFile=function(D,l,G,V){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(D,(D=>{G[l]=D,G._internalCount++,6===G._internalCount&&V(G)}),void 0,void 0,!0,((D,l)=>{N&&D&&N(D.status+" "+D.statusText,l)}))},X.e.prototype._cascadeLoadFiles=function(D,l,G){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=[];N._internalCount=0;for(let M=0;M<6;M++)this._partialLoadFile(G[M],M,N,l,V)},X.e.prototype._cascadeLoadImgs=function(D,l,G,V){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5?arguments[5]:void 0;const b=[];b._internalCount=0;for(let X=0;X<6;X++)this._partialLoadImg(V[X],X,b,D,l,G,N,M)},X.e.prototype._partialLoadImg=function(D,l,G,V,N,X){let t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7?arguments[7]:void 0;const n=(0,b.c)();(0,M.p)(D,(D=>{G[l]=D,G._internalCount++,V&&V.removePendingData(n),6===G._internalCount&&X&&X(N,G)}),((D,l)=>{V&&V.removePendingData(n),t&&t(D,l)}),V?V.offlineProvider:null,R),V&&V.addPendingData(n)},X.e.prototype.createCubeTextureBase=function(D,l,G,M){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6?arguments[6]:void 0,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]&&arguments[8],j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,K=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,d=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,H=arguments.length>14&&void 0!==arguments[14]&&arguments[14],h=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const x=K||new V.b(this,7);x.isCube=!0,x.url=D,x.generateMipMaps=!M,x._lodGenerationScale=j,x._lodGenerationOffset=e,x._useSRGBBuffer=!!H&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!M),x!==K&&(x.label=D.substring(0,60)),this._doNotHandleContextLost||(x._extension=n,x._files=G,x._buffer=h);const r=D;this._transformTextureUrl&&!K&&(D=this._transformTextureUrl(D));const o=n??function(D){const l=D.split("?")[0],G=l.lastIndexOf(".");return G>-1?l.substring(G).toLowerCase():""}(D),L=(0,t.c)(o),u=(D,l)=>{x.dispose(),X?X(D,l):D&&N.d.Warn(D)},B=(V,X)=>{D===r?V&&u(V.status+" "+V.statusText,X):(N.d.Warn(`Failed to load ${D}, falling back to the ${r}`),this.createCubeTextureBase(r,l,G,!!M,b,u,R,n,g,j,e,x,F,d,H,h))};if(L)L.then((V=>{const N=D=>{F&&F(x,D),V.loadCubeData(D,x,g,b,((D,l)=>{u(D,l)}))};h?N(h):G&&6===G.length?V.supportCascades?this._cascadeLoadFiles(l,(D=>N(D.map((D=>new Uint8Array(D))))),G,u):u("Textures type does not support cascades."):this._loadFile(D,(D=>N(new Uint8Array(D))),void 0,void 0,!0,B)}));else{if(!G||0===G.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(l,x,((D,l)=>{d&&d(D,l)}),G,u)}return this._internalTexturesCache.push(x),x}},13920:(D,l,G)=>{"use strict";G(11546);var V=G(11843);G(11644),G(11793),G(11637),G(11892),G(11856);V.e},13418:(D,l,G)=>{"use strict";G.d(l,{d:()=>N});var V=G(11667);class N{constructor(D){this.value=this._toInt(D)}_toInt(D){return 0|D}add(D){return new N(this.value+D.value)}Fl(D){return new N(this.value-D.value)}multiply(D){return new N(Math.imul(this.value,D.value))}divide(D){return new N(this.value/D.value)}getClassName(){return N.ClassName}equals(D){return this.value===D.value}static FromValue(D){return new N(D)}toString(){return this.value.toString()}}N.ClassName="FlowGraphInteger",(0,V.c)("FlowGraphInteger",N)},13426:(D,l,G)=>{"use strict";G.d(l,{d:()=>N,g:()=>M});var V=G(11710);class N{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Nb=D}get m(){return this.Nb}transformVector(D){return this.transformVectorToRef(D,new V.Vector2)}transformVectorToRef(D,l){return l.x=D.x*this.Nb[0]+D.y*this.Nb[1],l.y=D.x*this.Nb[2]+D.y*this.Nb[3],l}gb(){return this.toArray()}toArray(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let l=0;l<4;l++)D[l]=this.Nb[l];return D}KG(D){for(let l=0;l<4;l++)this.Nb[l]=D[l];return this}multiplyToRef(D,l){const G=D.Nb,V=this.Nb,N=l.Nb;return N[0]=G[0]*V[0]+G[1]*V[2],N[1]=G[0]*V[1]+G[1]*V[3],N[2]=G[2]*V[0]+G[3]*V[2],N[3]=G[2]*V[1]+G[3]*V[3],l}multiply(D){return this.multiplyToRef(D,new N)}divideToRef(D,l){const G=this.Nb,V=D.Nb,N=l.Nb;return N[0]=G[0]/V[0],N[1]=G[1]/V[1],N[2]=G[2]/V[2],N[3]=G[3]/V[3],l}divide(D){return this.divideToRef(D,new N)}addToRef(D,l){const G=this.Nb,V=D.m,N=l.m;return N[0]=G[0]+V[0],N[1]=G[1]+V[1],N[2]=G[2]+V[2],N[3]=G[3]+V[3],l}add(D){return this.addToRef(D,new N)}subtractToRef(D,l){const G=this.Nb,V=D.m,N=l.m;return N[0]=G[0]-V[0],N[1]=G[1]-V[1],N[2]=G[2]-V[2],N[3]=G[3]-V[3],l}Fl(D){return this.subtractToRef(D,new N)}transpose(){const D=this.Nb;return new N([D[0],D[2],D[1],D[3]])}determinant(){const D=this.Nb;return D[0]*D[3]-D[1]*D[2]}inverse(){const D=this.determinant();if(0===D)throw new Error("Matrix is not invertible");const l=this.Nb,G=1/D;return new N([l[3]*G,-l[1]*G,-l[2]*G,l[0]*G])}equals(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const G=this.Nb,V=D.m;return 0===l?G[0]===V[0]&&G[1]===V[1]&&G[2]===V[2]&&G[3]===V[3]:Math.abs(G[0]-V[0])<l&&Math.abs(G[1]-V[1])<l&&Math.abs(G[2]-V[2])<l&&Math.abs(G[3]-V[3])<l}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Nb.join(", ")})`}}class M{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Nb=D}get m(){return this.Nb}transformVector(D){return this.transformVectorToRef(D,new V.Kl)}transformVectorToRef(D,l){const G=this.Nb;return l.x=D.x*G[0]+D.y*G[1]+D.z*G[2],l.y=D.x*G[3]+D.y*G[4]+D.z*G[5],l.z=D.x*G[6]+D.y*G[7]+D.z*G[8],l}multiplyToRef(D,l){const G=D.Nb,V=this.Nb,N=l.m;return N[0]=G[0]*V[0]+G[1]*V[3]+G[2]*V[6],N[1]=G[0]*V[1]+G[1]*V[4]+G[2]*V[7],N[2]=G[0]*V[2]+G[1]*V[5]+G[2]*V[8],N[3]=G[3]*V[0]+G[4]*V[3]+G[5]*V[6],N[4]=G[3]*V[1]+G[4]*V[4]+G[5]*V[7],N[5]=G[3]*V[2]+G[4]*V[5]+G[5]*V[8],N[6]=G[6]*V[0]+G[7]*V[3]+G[8]*V[6],N[7]=G[6]*V[1]+G[7]*V[4]+G[8]*V[7],N[8]=G[6]*V[2]+G[7]*V[5]+G[8]*V[8],l}multiply(D){return this.multiplyToRef(D,new M)}divideToRef(D,l){const G=this.Nb,V=D.m,N=l.m;return N[0]=G[0]/V[0],N[1]=G[1]/V[1],N[2]=G[2]/V[2],N[3]=G[3]/V[3],N[4]=G[4]/V[4],N[5]=G[5]/V[5],N[6]=G[6]/V[6],N[7]=G[7]/V[7],N[8]=G[8]/V[8],l}divide(D){return this.divideToRef(D,new M)}addToRef(D,l){const G=this.Nb,V=D.m,N=l.m;return N[0]=G[0]+V[0],N[1]=G[1]+V[1],N[2]=G[2]+V[2],N[3]=G[3]+V[3],N[4]=G[4]+V[4],N[5]=G[5]+V[5],N[6]=G[6]+V[6],N[7]=G[7]+V[7],N[8]=G[8]+V[8],l}add(D){return this.addToRef(D,new M)}subtractToRef(D,l){const G=this.Nb,V=D.m,N=l.m;return N[0]=G[0]-V[0],N[1]=G[1]-V[1],N[2]=G[2]-V[2],N[3]=G[3]-V[3],N[4]=G[4]-V[4],N[5]=G[5]-V[5],N[6]=G[6]-V[6],N[7]=G[7]-V[7],N[8]=G[8]-V[8],l}Fl(D){return this.subtractToRef(D,new M)}toArray(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let l=0;l<9;l++)D[l]=this.Nb[l];return D}gb(){return this.toArray()}KG(D){for(let l=0;l<9;l++)this.Nb[l]=D[l];return this}transpose(){const D=this.Nb;return new M([D[0],D[3],D[6],D[1],D[4],D[7],D[2],D[5],D[8]])}determinant(){const D=this.Nb;return D[0]*(D[4]*D[8]-D[5]*D[7])-D[1]*(D[3]*D[8]-D[5]*D[6])+D[2]*(D[3]*D[7]-D[4]*D[6])}inverse(){const D=this.determinant();if(0===D)throw new Error("Matrix is not invertible");const l=this.Nb,G=1/D;return new M([(l[4]*l[8]-l[5]*l[7])*G,(l[2]*l[7]-l[1]*l[8])*G,(l[1]*l[5]-l[2]*l[4])*G,(l[5]*l[6]-l[3]*l[8])*G,(l[0]*l[8]-l[2]*l[6])*G,(l[2]*l[3]-l[0]*l[5])*G,(l[3]*l[7]-l[4]*l[6])*G,(l[1]*l[6]-l[0]*l[7])*G,(l[0]*l[4]-l[1]*l[3])*G])}equals(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const G=this.Nb,V=D.m;return 0===l?G[0]===V[0]&&G[1]===V[1]&&G[2]===V[2]&&G[3]===V[3]&&G[4]===V[4]&&G[5]===V[5]&&G[6]===V[6]&&G[7]===V[7]&&G[8]===V[8]:Math.abs(G[0]-V[0])<l&&Math.abs(G[1]-V[1])<l&&Math.abs(G[2]-V[2])<l&&Math.abs(G[3]-V[3])<l&&Math.abs(G[4]-V[4])<l&&Math.abs(G[5]-V[5])<l&&Math.abs(G[6]-V[6])<l&&Math.abs(G[7]-V[7])<l&&Math.abs(G[8]-V[8])<l}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Nb.join(", ")})`}}},13431:(D,l,G)=>{"use strict";var V;function N(D,l,G,V){switch(l){case"Animation":return V?D.animations.find((D=>D.uniqueId===G))??null:D.animations[G]??null;case"AnimationGroup":return V?D.animationGroups.find((D=>D.uniqueId===G))??null:D.animationGroups[G]??null;case"Mesh":return V?D.meshes.find((D=>D.uniqueId===G))??null:D.meshes[G]??null;case"Material":return V?D.materials.find((D=>D.uniqueId===G))??null:D.materials[G]??null;case"rn":return V?D.cameras.find((D=>D.uniqueId===G))??null:D.cameras[G]??null;case"Light":return V?D.lights.find((D=>D.uniqueId===G))??null:D.lights[G]??null;default:return null}}G.d(l,{b:()=>N}),function(D){D.Animation="Animation",D.AnimationGroup="AnimationGroup",D.Mesh="Mesh",D.Material="Material",D.rn="rn",D.Light="Light"}(V||(V={}))},13463:(D,l,G)=>{"use strict";G.d(l,{d:()=>N});var V=G(13470);class N extends V.b{constructor(D,l){if(super(D),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),l)for(const G of l)this._eventsSignalOutputs[G]=this._registerSignalOutput(G+"Event")}_executeOnTick(D){}_startPendingTasks(D){D._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(D),this._resetAfterCanceled(D)),this._preparePendingTasks(D),D._addPendingBlock(this),this.out._activateSignal(D),D._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(D){D._deleteExecutionVariable(this,"_initialized"),D._removePendingBlock(this)}}},13442:(D,l,G)=>{"use strict";G.d(l,{c:()=>R});var V=G(11672),N=G(11667),M=G(13446),b=G(11532),X=G(13411);class t extends M.c{constructor(D,l,G,V){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:V.defaultValue,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(D,l,G),this.richType=V,this._defaultValue=N,this._optional=M,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new b.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(D){this._isDisabled!==D&&(this._isDisabled=D,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(D,l){l._getConnectionValue(this)!==D&&(l._setConnectionValue(this,D),this.onValueChangedObservable.notifyObservers(D))}resetToDefaultValue(D){D._setConnectionValue(this,this._defaultValue)}connectTo(D){this._isDisabled||super.connectTo(D)}_getValueOrDefault(D){const l=D._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(l):l}getValue(D){if(1===this.connectionType){D._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(D);const l=this._getValueOrDefault(D);return this._lastValue=l,this.richType.typeTransformer?this.richType.typeTransformer(l):l}const l=this.isConnected()?this._connectedPoint[0].getValue(D):this._getValueOrDefault(D);return this._lastValue=l,this.richType.typeTransformer?this.richType.typeTransformer(l):l}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(D),D.richType={},this.richType.serialize(D.richType),D.optional=this._optional,(0,X.c)("defaultValue",this._defaultValue,D)}}(0,N.c)("FlowGraphDataConnection",t);class R{constructor(D){var l;this.config=D,this.uniqueId=(0,V.c)(),this.name=(null===(l=this.config)||void 0===l?void 0:l.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(D){}registerDataInput(D,l,G){const V=new t(D,0,this,l,G);return this.dataInputs.push(V),V}registerDataOutput(D,l,G){const V=new t(D,1,this,l,G);return this.dataOutputs.push(V),V}getDataInput(D){return this.dataInputs.find((l=>l.name===D))}getDataOutput(D){return this.dataOutputs.find((l=>l.name===D))}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.c;if(D.uniqueId=this.uniqueId,D.config={},this.config){const G=this.config,V=Object.keys(G);for(const N of V)l(N,G[N],D.config)}D.dataInputs=[],D.dataOutputs=[],D.className=this.getClassName();for(const G of this.dataInputs){const l={};G.serialize(l),D.dataInputs.push(l)}for(const G of this.dataOutputs){const l={};G.serialize(l),D.dataOutputs.push(l)}}deserialize(D){}_log(D,l,G){var V;null===(V=D.logger)||void 0===V||V.addLogItem({action:l,FG:G,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13446:(D,l,G)=>{"use strict";G.d(l,{c:()=>M});var V,N=G(11672);!function(D){D[D.Input=0]="Input",D[D.Output=1]="Output"}(V||(V={}));class M{constructor(D,l,G){this._ownerBlock=G,this._connectedPoint=[],this.uniqueId=(0,N.c)(),this.connectedPointIds=[],this.name=D,this._connectionType=l}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(D){if(this._connectionType===D._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||D._isSingularConnection()&&D._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(D),D._connectedPoint.push(this)}disconnectFrom(D){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const G=this._connectedPoint.indexOf(D),V=D._connectedPoint.indexOf(this);-1!==G&&-1!==V&&(l&&this._connectedPoint.splice(G,1),D._connectedPoint.splice(V,1))}disconnectFromAll(){for(const D of this._connectedPoint)this.disconnectFrom(D,!1);this._connectedPoint.length=0}dispose(){for(const D of this._connectedPoint)this.disconnectFrom(D)}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.uniqueId=this.uniqueId,D.name=this.name,D._connectionType=this._connectionType,D.connectedPointIds=[],D.className=this.getClassName();for(const l of this._connectedPoint)D.connectedPointIds.push(l.uniqueId)}getClassName(){return"FGConnection"}deserialize(D){this.uniqueId=D.uniqueId,this.name=D.name,this._connectionType=D._connectionType,this.connectedPointIds=D.connectedPointIds}}},13407:(D,l,G)=>{"use strict";G.d(l,{b:()=>x});var V,N=G(11532),M=G(11695),b=G(11703),X=G(11672),t=G(13411),R=G(13431),n=G(11546);!function(D){D.ExecuteBlock="ExecuteBlock",D.ExecuteEvent="ExecuteEvent",D.TriggerConnection="TriggerConnection",D.ContextVariableSet="ContextVariableSet",D.GlobalVariableSet="GlobalVariableSet",D.GlobalVariableDelete="GlobalVariableDelete",D.GlobalVariableGet="GlobalVariableGet",D.AddConnection="AddConnection",D.GetConnectionValue="GetConnectionValue",D.SetConnectionValue="SetConnectionValue",D.ActivateSignal="ActivateSignal",D.ContextVariableGet="ContextVariableGet"}(V||(V={}));class g{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(D){if(D.time||(D.time=Date.now()),this.log.push(D),this.logToConsole){var l;const G=null===(l=D.FG)||void 0===l?void 0:l.value;"object"===typeof G&&G.getClassName?n.d.Log(`[FGLog] ${D.className}:${D.uniqueId.split("-")[0]} ${D.action} - ${JSON.stringify(G.getClassName())}: ${G.toString()}`):n.d.Log(`[FGLog] ${D.className}:${D.uniqueId.split("-")[0]} ${D.action} - ${JSON.stringify(D.FG)}`)}}getItemsOfType(D){return this.log.filter((l=>l.action===D))}}class j{get enableLogging(){return this._enableLogging}set enableLogging(D){this._enableLogging!==D&&(this._enableLogging=D,this._enableLogging?(this.logger=new g,this.logger.logToConsole=!0):this.logger=null)}constructor(D){this.uniqueId=(0,X.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new N.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=D,this.assetsContext=D.assetsContext??D.dl}hasVariable(D){return D in this._userVariables}setVariable(D,l){var G;this._userVariables[D]=l,null===(G=this.logger)||void 0===G||G.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",FG:{name:D,value:l}})}getAsset(D,l){return(0,R.b)(this.assetsContext,D,l)}getVariable(D){var l;return null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",FG:{name:D,value:this._userVariables[D]}}),this._userVariables[D]}get userVariables(){return this._userVariables}uD(){return this._configuration.dl}_getUniqueIdPrefixedName(D,l){return`${D.uniqueId}_${l}`}_getGlobalContextVariable(D,l){var G;return null===(G=this.logger)||void 0===G||G.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",FG:{name:D,defaultValue:l,possibleValue:this._globalContextVariables[D]}}),this._hasGlobalContextVariable(D)?this._globalContextVariables[D]:l}_setGlobalContextVariable(D,l){var G;null===(G=this.logger)||void 0===G||G.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",FG:{name:D,value:l}}),this._globalContextVariables[D]=l}_deleteGlobalContextVariable(D){var l;null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",FG:{name:D}}),delete this._globalContextVariables[D]}_hasGlobalContextVariable(D){return D in this._globalContextVariables}_setExecutionVariable(D,l,G){this._executionVariables[this._getUniqueIdPrefixedName(D,l)]=G}_getExecutionVariable(D,l,G){return this._hasExecutionVariable(D,l)?this._executionVariables[this._getUniqueIdPrefixedName(D,l)]:G}_deleteExecutionVariable(D,l){delete this._executionVariables[this._getUniqueIdPrefixedName(D,l)]}_hasExecutionVariable(D,l){return this._getUniqueIdPrefixedName(D,l)in this._executionVariables}_hasConnectionValue(D){return D.uniqueId in this._connectionValues}_setConnectionValue(D,l){var G;this._connectionValues[D.uniqueId]=l,null===(G=this.logger)||void 0===G||G.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",FG:{connectionPointId:D.uniqueId,value:l}})}_setConnectionValueByKey(D,l){this._connectionValues[D]=l}_getConnectionValue(D){var l;return null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",FG:{connectionPointId:D.uniqueId,value:this._connectionValues[D.uniqueId]}}),this._connectionValues[D.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(D){this._pendingBlocks.includes(D)||(this._pendingBlocks.push(D),this._pendingBlocks.sort(((D,l)=>D.priority-l.priority)))}_removePendingBlock(D){const l=this._pendingBlocks.indexOf(D);-1!==l&&this._pendingBlocks.splice(l,1)}_clearPendingBlocks(){for(const D of this._pendingBlocks)D._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(D){var l;this.onNodeExecutedObservable.notifyObservers(D),null===(l=this.logger)||void 0===l||l.addLogItem({time:Date.now(),className:D.getClassName(),uniqueId:D.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(D){this._setGlobalContextVariable("timeSinceStart",D.timeSinceStart),this._setGlobalContextVariable("deltaTime",D.deltaTime);for(const G of this._pendingBlocks){var l;null===(l=G._executeOnTick)||void 0===l||l.call(G,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.c;D.uniqueId=this.uniqueId,D._userVariables={};for(const V in this._userVariables)l(V,this._userVariables[V],D._userVariables);D._connectionValues={};for(const V in this._connectionValues)l(V,this._connectionValues[V],D._connectionValues);var G;this.assetsContext!==this.uD()&&(D._assetsContext={meshes:this.assetsContext.meshes.map((D=>D.id)),materials:this.assetsContext.materials.map((D=>D.id)),textures:this.assetsContext.textures.map((D=>D.name)),animations:this.assetsContext.animations.map((D=>D.name)),lights:this.assetsContext.lights.map((D=>D.id)),cameras:this.assetsContext.cameras.map((D=>D.id)),le:null===(G=this.assetsContext.le)||void 0===G?void 0:G.map((D=>D.name)),skeletons:this.assetsContext.skeletons.map((D=>D.id)),xj:this.assetsContext.xj.map((D=>D.name)),geometries:this.assetsContext.geometries.map((D=>D.id)),multiMaterials:this.assetsContext.multiMaterials.map((D=>D.id)),transformNodes:this.assetsContext.transformNodes.map((D=>D.id))})}getClassName(){return"FlowGraphContext"}}(0,M.b)([(0,b.L)()],j.prototype,"uniqueId",void 0);var e=G(13436),K=G(12001);class F{constructor(D){this.onEventTriggeredObservable=new N.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=D,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Vb.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const D=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",FG:{timeSinceStart:this._startingTime,deltaTime:D}}),this._startingTime+=D})),this._meshPickedObserver=this._scene.onPointerObservable.add((D=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",FG:D})}),K.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((D=>{const l=D.pointerId,G=D.mesh,V=this._pointerUnderMeshState[l];!V&&G?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",FG:{pointerId:l,mesh:G}}):V&&!G?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",FG:{pointerId:l,mesh:V}}):V&&G&&V!==G&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",FG:{pointerId:l,mesh:V,over:G}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",FG:{pointerId:l,mesh:G,out:V}})),this._pointerUnderMeshState[l]=G}),K.b.POINTERMOVE)}dispose(){var D,l,G,V,N;null===(D=this._sceneDisposeObserver)||void 0===D||D.remove(),null===(l=this._sceneReadyObserver)||void 0===l||l.remove(),null===(G=this._sceneOnBeforeRenderObserver)||void 0===G||G.remove(),null===(V=this._meshPickedObserver)||void 0===V||V.remove(),null===(N=this._meshUnderPointerObserver)||void 0===N||N.remove(),this.onEventTriggeredObservable.clear()}}var d,H=G(13454);!function(D){D[D.Stopped=0]="Stopped",D[D.Started=1]="Started"}(d||(d={}));class h{get state(){return this._state}set state(D){this._state=D,this.onStateChangedObservable.notifyObservers(D)}constructor(D){this.onStateChangedObservable=new N.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=D.dl,this._sceneEventCoordinator=new F(this._scene),this._coordinator=D.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((D=>{for(const l of this._executionContexts){const G=this._getContextualOrder(D.type,l);for(const V of G)if(!V._executeEvent(l,D.FG))break}switch(D.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const l of this._executionContexts)l._notifyOnTick(D.FG);break;case"SceneDispose":this.dispose()}}))}createContext(){const D=new j({dl:this._scene,coordinator:this._coordinator});return this._executionContexts.push(D),D}getContext(D){return this._executionContexts[D]}addEventBlock(D){if("PointerOver"!==D.type&&"PointerOut"!==D.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==D.type&&this._eventBlocks[D.type].push(D),1===this.state)for(const l of this._executionContexts)D._startPendingTasks(l);else this.onStateChangedObservable.addOnce((l=>{if(1===l)for(const G of this._executionContexts)D._startPendingTasks(G)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((D=>{1===D&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const D of this._executionContexts)for(const l in this._eventBlocks){const G=this._getContextualOrder(l,D);for(const l of G)l._startPendingTasks(D)}}_getContextualOrder(D,l){const G=this._eventBlocks[D].sort(((D,l)=>l.initPriority-D.initPriority));if("MeshPick"===D){const D=[];for(const V of G){const N=V.asset.getValue(l);let M=0;for(;M<G.length;M++){const D=G[M].asset.getValue(l);if(N&&D&&(0,H.k)(N,D))break}D.splice(M,0,V)}return D}return G}dispose(){var D;if(0!==this.state){this.state=0;for(const D of this._executionContexts)D._clearPendingBlocks();this._executionContexts.length=0;for(const D in this._eventBlocks)this._eventBlocks[D].length=0;null===(D=this._eventObserver)||void 0===D||D.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(D){const l=[],G=new Set;for(const V in this._eventBlocks)for(const D of this._eventBlocks[V])l.push(D),G.add(D.uniqueId);for(;l.length>0;){const V=l.pop();D(V);for(const D of V.dataInputs)for(const V of D._connectedPoint)G.has(V._ownerBlock.uniqueId)||(l.push(V._ownerBlock),G.add(V._ownerBlock.uniqueId));if(V instanceof e.b)for(const D of V.signalOutputs)for(const V of D._connectedPoint)G.has(V._ownerBlock.uniqueId)||(l.push(V._ownerBlock),G.add(V._ownerBlock.uniqueId))}}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=arguments.length>1?arguments[1]:void 0;D.allBlocks=[],this.visitAllBlocks((l=>{const G={};l.serialize(G),D.allBlocks.push(G)})),D.executionContexts=[];for(const G of this._executionContexts){const V={};G.serialize(V,l),D.executionContexts.push(V)}}}class x{constructor(D){this.config=D,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.dl.Vb.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.dl.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const D=this._executeOnNextFrame.slice(0);if(D.length)for(const l of D){this.notifyCustomEvent(l.id,l.data,!1);const D=this._executeOnNextFrame.findIndex((D=>D.uniqueId===l.uniqueId));-1!==D&&this._executeOnNextFrame.splice(D,1)}}));(x.SceneCoordinators.get(this.config.dl)??[]).push(this)}createGraph(){const D=new h({dl:this.config.dl,coordinator:this});return this._flowGraphs.push(D),D}removeGraph(D){const l=this._flowGraphs.indexOf(D);-1!==l&&(D.dispose(),this._flowGraphs.splice(l,1))}start(){for(const D of this._flowGraphs)D.start()}dispose(){var D,l;for(const N of this._flowGraphs)N.dispose();this._flowGraphs.length=0,null===(D=this._disposeObserver)||void 0===D||D.remove(),null===(l=this._onBeforeRenderObserver)||void 0===l||l.remove();const G=x.SceneCoordinators.get(this.config.dl)??[],V=G.indexOf(this);-1!==V&&G.splice(V,1)}serialize(D,l){D._flowGraphs=[];for(const G of this._flowGraphs){const V={};G.serialize(V,l),D._flowGraphs.push(V)}D.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(D){let l=this._customEventsMap.get(D);return l||(l=new N.e,this._customEventsMap.set(D,l)),l}notifyCustomEvent(D,l){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:D,data:l,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(D)){const l=this._eventExecutionCounter.get(D);if(this._eventExecutionCounter.set(D,l+1),l>=x.MaxEventTypeExecutionPerFrame)return void(l===x.MaxEventTypeExecutionPerFrame&&n.d.Warn(`FlowGraphCoordinator: Too many executions of event "${D}".`))}else this._eventExecutionCounter.set(D,1);const G=this._customEventsMap.get(D);G&&G.notifyObservers(l)}}x.MaxEventsPerType=30,x.MaxEventTypeExecutionPerFrame=30,x.SceneCoordinators=new Map},13461:(D,l,G)=>{"use strict";G.d(l,{b:()=>N});var V=G(13463);class N extends V.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(D){D._notifyExecuteNode(this),this.done._activateSignal(D)}}},13436:(D,l,G)=>{"use strict";G.d(l,{b:()=>X});var V=G(13442),N=G(13446),M=G(11667);class b extends N.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(D){super.connectTo(D),this._connectedPoint.sort(((D,l)=>l.priority-D.priority))}_activateSignal(D){var l;if(null===(l=D.logger)||void 0===l||l.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,FG:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)D._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(D,this),D._increaseExecutionId();else for(const G of this._connectedPoint)G._activateSignal(D)}}(0,M.c)("FlowGraphSignalConnection",b);class X extends V.c{constructor(D){super(D),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(D){const l=new b(D,0,this);return this.signalInputs.push(l),l}_registerSignalOutput(D){const l=new b(D,1,this);return this.signalOutputs.push(l),l}_unregisterSignalInput(D){const l=this.signalInputs.findIndex((l=>l.name===D));-1!==l&&(this.signalInputs[l].dispose(),this.signalInputs.splice(l,1))}_unregisterSignalOutput(D){const l=this.signalOutputs.findIndex((l=>l.name===D));-1!==l&&(this.signalOutputs[l].dispose(),this.signalOutputs.splice(l,1))}_reportError(D,l){this.error.FG="string"===typeof l?new Error(l):l,this.error._activateSignal(D)}getSignalInput(D){return this.signalInputs.find((l=>l.name===D))}getSignalOutput(D){return this.signalOutputs.find((l=>l.name===D))}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(D),D.signalInputs=[],D.signalOutputs=[];for(const l of this.signalInputs){const G={};l.serialize(G),D.signalInputs.push(G)}for(const l of this.signalOutputs){const G={};l.serialize(G),D.signalOutputs.push(G)}}deserialize(D){for(let l=0;l<D.signalInputs.length;l++){const G=this.getSignalInput(D.signalInputs[l].name);if(!G)throw new Error("Could not find signal input with name "+D.signalInputs[l].name+" in block "+D.className);G.deserialize(D.signalInputs[l])}for(let l=0;l<D.signalOutputs.length;l++){const G=this.getSignalOutput(D.signalOutputs[l].name);if(!G)throw new Error("Could not find signal output with name "+D.signalOutputs[l].name+" in block "+D.className);G.deserialize(D.signalOutputs[l])}}getClassName(){return"FlowGraphExecutionBlock"}}},13470:(D,l,G)=>{"use strict";G.d(l,{b:()=>N});var V=G(13436);class N extends V.b{constructor(D){super(D),this.out=this._registerSignalOutput("out")}}},13423:(D,l,G)=>{"use strict";G.d(l,{A:()=>B,B:()=>u,d:()=>R,g:()=>j,i:()=>L,k:()=>d,l:()=>H,m:()=>h,o:()=>g,p:()=>o,r:()=>n,t:()=>e,v:()=>K,w:()=>F,x:()=>I,y:()=>W});var V,N=G(11710),M=G(11755),b=G(13418),X=G(13426);!function(D){D.Any="any",D.String="string",D.Number="number",D.Boolean="boolean",D.Object="object",D.Integer="FlowGraphInteger",D.Vector2="Vector2",D.Kl="Kl",D.Vector4="Vector4",D.Quaternion="Quaternion",D.Matrix="Matrix",D.Matrix2D="Matrix2D",D.Matrix3D="Matrix3D",D.hl="hl",D.Wb="Wb"}(V||(V={}));class t{constructor(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=D,this.defaultValue=l,this.animationType=G}serialize(D){D.typeName=this.typeName,D.defaultValue=this.defaultValue}}const R=new t("any",void 0),n=new t("string",""),g=new t("number",0,0),j=new t("boolean",!1),e=new t("Vector2",N.Vector2.Zero(),5),K=new t("Kl",N.Kl.Zero(),1),F=new t("Vector4",N.Vector4.Zero()),d=new t("Matrix",N.Matrix.Identity(),3),H=new t("Matrix2D",new X.d),h=new t("Matrix3D",new X.g),x=new t("hl",M.hl.Black(),4),r=new t("Wb",new M.Wb(0,0,0,0),7),o=new t("Quaternion",N.Quaternion.Identity(),2);o.typeTransformer=D=>{if(D.getClassName){if("Vector4"===D.getClassName())return N.Quaternion.xl(D.gb());if("Kl"===D.getClassName())return N.Quaternion.FromEulerVector(D);if("Matrix"===D.getClassName())return N.Quaternion.FromRotationMatrix(D)}return D};const L=new t("FlowGraphInteger",new b.d(0),0);function u(D){const l=D;switch(typeof D){case"string":return n;case"number":return g;case"boolean":return j;case"object":if(l.getClassName)switch(l.getClassName()){case"Vector2":return e;case"Kl":return K;case"Vector4":return F;case"Matrix":return d;case"hl":return x;case"Wb":return r;case"Quaternion":return o;case"FlowGraphInteger":return L;case"Matrix2D":return H;case"Matrix3D":return h}return R;default:return R}}function B(D){switch(D){case"string":return n;case"number":return g;case"boolean":return j;case"Vector2":return e;case"Kl":return K;case"Vector4":return F;case"Matrix":return d;case"hl":return x;case"Wb":return r;case"Quaternion":return o;case"FlowGraphInteger":return L;case"Matrix2D":return H;case"Matrix3D":return h;default:return R}}function I(D){switch(D){case"number":default:return 0;case"Vector2":return 5;case"Kl":return 1;case"Matrix":return 3;case"hl":return 4;case"Wb":return 7;case"Quaternion":return 2}}function W(D){switch(D){case 0:return g;case 5:return e;case 1:return K;case 3:return d;case 4:return x;case 7:return r;case 2:return o;default:return R}}},13411:(D,l,G)=>{"use strict";G.d(l,{b:()=>n,c:()=>R,e:()=>g});var V=G(11755),N=G(11710),M=G(13418),b=G(13423),X=G(13426);function t(D){return"Vector2"===D||"Kl"===D||"Vector4"===D||"Quaternion"===D||"hl"===D||"Wb"===D}function R(D,l,G){var V;const N=(null===l||void 0===l||null===(V=l.getClassName)||void 0===V?void 0:V.call(l))??"";if(t(N)||function(D){return"Matrix"===D||"Matrix2D"===D||"Matrix3D"===D}(N))G[D]={value:l.gb(),className:N};else if("FlowGraphInteger"===N)G[D]={value:l.value,className:N};else if(N&&(l.id||l.name))G[D]={id:l.id,name:l.name,className:N};else{if("object"===typeof l)throw new Error(`Could not serialize value ${l}`);G[D]=l}}function n(D,l,G,R){const g=l[D];let j;const e=(null===g||void 0===g?void 0:g.type)??(null===g||void 0===g?void 0:g.className);if(function(D){return"Mesh"===D||"AbstractMesh"===D||"GroundMesh"===D||"InstanceMesh"===D||"LinesMesh"===D||"GoldbergMesh"===D||"GreasedLineMesh"===D||"TrailMesh"===D}(e)){let D=R.meshes.filter((D=>g.id?D.id===g.id:D.name===g.name));0===D.length&&(D=R.transformNodes.filter((D=>g.id?D.id===g.id:D.name===g.name))),j=g.uniqueId?D.find((D=>D.uniqueId===g.uniqueId)):D[0]}else if(t(e))j=function(D,l){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===D)return N.Vector2.xl(l);if("Kl"===D)return G&&(l[2]*=-1),N.Kl.xl(l);if("Vector4"===D)return N.Vector4.xl(l);if("Quaternion"===D)return G&&(l[2]*=-1,l[3]*=-1),N.Quaternion.xl(l);if("hl"===D)return new V.hl(l[0],l[1],l[2]);if("Wb"===D)return new V.Wb(l[0],l[1],l[2],l[3]);throw new Error(`Unknown vector class name ${D}`)}(e,g.value);else if(function(D){return"AnimationGroup"===D}(e)){const D=R.animationGroups.filter((D=>D.name===g.name));j=1===D.length?D[0]:D.find((D=>D.uniqueId===g.uniqueId))}else j="Matrix"===e?N.Matrix.xl(g.value):"Matrix2D"===e?new X.d(g.value):"Matrix3D"===e?new X.g(g.value):"FlowGraphInteger"===e?M.d.FromValue(g.value):"number"===e||"string"===e||"boolean"===e?g.value[0]:g&&void 0!==g.value?g.value:Array.isArray(g)?g.reduce(((D,l)=>l.eventData?(D[l.id]={type:(0,b.A)(l.type)},"undefined"!==typeof l.value&&(D[l.id].value=n("value",l,G,R)),D):D),{}):g;return j}function g(D){return"FlowGraphJsonPointerParserBlock"===D}},13454:(D,l,G)=>{"use strict";function V(D,l){return!(!D.parent||D.parent!==l&&!V(D.parent,l))}function N(D){if(D.getClassName)return D.getClassName()}function M(D,l){return D===l&&("Vector2"===D||"Kl"===D||"Vector4"===D||"Quaternion"===D)}function b(D,l){return D===l&&("Matrix"===D||"Matrix2D"===D||"Matrix3D"===D)}function X(D,l){return"FlowGraphInteger"===D&&"FlowGraphInteger"===l}function t(D,l){const G="number"===typeof D||"number"===typeof(null===D||void 0===D?void 0:D.value);return G&&!l?!isNaN(R(D)):G}function R(D){return"number"===typeof D?D:D.value}G.d(l,{b:()=>X,e:()=>b,f:()=>M,g:()=>N,k:()=>V,o:()=>R,q:()=>t})},12828:(D,l,G)=>{"use strict";G.r(l),G.d(l,{SceneInstrumentation:()=>M});var V=G(11530),N=G(11934);class M{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(D){D!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=D,D?(this._onBeforeActiveMeshesEvaluationObserver=this.dl.onBeforeActiveMeshesEvaluationObservable.add((()=>{V.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.dl.onAfterActiveMeshesEvaluationObservable.add((()=>{V.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.dl.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.dl.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(D){D!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=D,D?(this._onBeforeRenderTargetsRenderObserver=this.dl.onBeforeRenderTargetsRenderObservable.add((()=>{V.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.dl.onAfterRenderTargetsRenderObservable.add((()=>{V.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.dl.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.dl.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(D){D!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=D,D?(this._onBeforeParticlesRenderingObserver=this.dl.onBeforeParticlesRenderingObservable.add((()=>{V.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.dl.onAfterParticlesRenderingObservable.add((()=>{V.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.dl.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.dl.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(D){D!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=D,this.dl.spriteManagers&&(D?(this._onBeforeSpritesRenderingObserver=this.dl.onBeforeSpritesRenderingObservable.add((()=>{V.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.dl.onAfterSpritesRenderingObservable.add((()=>{V.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.dl.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.dl.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(D){D!==this._capturePhysicsTime&&this.dl.onBeforePhysicsObservable&&(this._capturePhysicsTime=D,D?(this._onBeforePhysicsObserver=this.dl.onBeforePhysicsObservable.add((()=>{V.Tools.StartPerformanceCounter("Jb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.dl.onAfterPhysicsObservable.add((()=>{V.Tools.EndPerformanceCounter("Jb"),this._physicsTime.endMonitoring()}))):(this.dl.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.dl.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(D){D!==this._captureAnimationsTime&&(this._captureAnimationsTime=D,D?this._onAfterAnimationsObserver=this.dl.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.dl.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(D){this._captureFrameTime=D}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(D){this._captureInterFrameTime=D}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(D){D!==this._captureRenderTime&&(this._captureRenderTime=D,D?(this._onBeforeDrawPhaseObserver=this.dl.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),V.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.dl.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),V.Tools.EndPerformanceCounter("Main render")}))):(this.dl.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.dl.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(D){D!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=D,D?(this._onBeforeCameraRenderObserver=this.dl.onBeforeCameraRenderObservable.add((D=>{this._cameraRenderTime.beginMonitoring(),V.Tools.StartPerformanceCounter(`Rendering camera ${D.name}`)})),this._onAfterCameraRenderObserver=this.dl.onAfterCameraRenderObservable.add((D=>{this._cameraRenderTime.endMonitoring(!1),V.Tools.EndPerformanceCounter(`Rendering camera ${D.name}`)}))):(this.dl.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.dl.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.dl.getEngine()._drawCalls}constructor(D){this.dl=D,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new N.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new N.c,this._captureFrameTime=!1,this._frameTime=new N.c,this._captureRenderTime=!1,this._renderTime=new N.c,this._captureInterFrameTime=!1,this._interFrameTime=new N.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new N.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new N.c,this._capturePhysicsTime=!1,this._physicsTime=new N.c,this._captureAnimationsTime=!1,this._animationsTime=new N.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new N.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=D.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(V.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.dl.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=D.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(V.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Gb(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Gb(),this._captureParticlesRenderTime&&this._particlesRenderTime.Gb(),this._captureSpritesRenderTime&&this._spritesRenderTime.Gb(),this._captureRenderTime&&this._renderTime.Gb(),this._captureCameraRenderTime&&this._cameraRenderTime.Gb()}))}dispose(){this._disposed||(this.dl.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.dl.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.dl.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.dl.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.dl.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.dl.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.dl.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.dl.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.dl.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.dl.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.dl.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.dl.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.dl.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.dl.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.dl.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.dl.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.dl.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.dl=null,this._disposed=!0)}}},13399:(D,l,G)=>{"use strict";G.d(l,{e:()=>n});var V=G(11695),N=G(11703),M=G(11710),b=G(12144),X=G(12265),t=G(12325),R=G(11667);b.e.AddNodeConstructor("Light_Type_1",((D,l)=>()=>new n(D,M.Kl.Zero(),l)));class n extends t.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(D){this._shadowFrustumSize=D,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(D){this._shadowOrthoScale=D,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(D){this._orthoLeft=D}get orthoRight(){return this._orthoRight}set orthoRight(D){this._orthoRight=D}get orthoTop(){return this._orthoTop}set orthoTop(D){this._orthoTop=D}get orthoBottom(){return this._orthoBottom}set orthoBottom(D){this._orthoBottom=D}constructor(D,l,G){super(D,G),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=l.scale(-1),this.direction=l}getClassName(){return"zb"}getTypeID(){return X.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(D,l,G){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(D):this._setDefaultAutoExtendShadowProjectionMatrix(D,l,G)}_setDefaultFixedFrustumShadowProjectionMatrix(D){const l=this.uD().activeCamera;l&&M.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:l.Kb,void 0!==this.shadowMaxZ?this.shadowMaxZ:l.maxZ,D,this.uD().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(D,l,G){const V=this.uD().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const D=M.Kl.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let V=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(let b=0;b<G.length;b++){const X=G[b];if(!X)continue;const t=X.getBoundingInfo().boundingBox;for(let G=0;G<t.vectorsWorld.length;G++)M.Kl.TransformCoordinatesToRef(t.vectorsWorld[G],l,D),D.x<this._orthoLeft&&(this._orthoLeft=D.x),D.y<this._orthoBottom&&(this._orthoBottom=D.y),D.x>this._orthoRight&&(this._orthoRight=D.x),D.y>this._orthoTop&&(this._orthoTop=D.y),this.autoCalcShadowZBounds&&(D.z<V&&(V=D.z),D.z>N&&(N=D.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=V,this._shadowMaxZ=N)}const N=this._orthoRight-this._orthoLeft,b=this._orthoTop-this._orthoBottom,X=void 0!==this.shadowMinZ?this.shadowMinZ:(null===V||void 0===V?void 0:V.Kb)||0,t=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===V||void 0===V?void 0:V.maxZ)||1e4,R=this.uD().getEngine().useReverseDepthBuffer;M.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-N*this.shadowOrthoScale,this._orthoRight+N*this.shadowOrthoScale,this._orthoBottom-b*this.shadowOrthoScale,this._orthoTop+b*this.shadowOrthoScale,R?t:X,R?X:t,D,this.uD().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(D,l){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,l),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,l),this)}transferToNodeMaterialEffect(D,l){return this.computeTransformedInformation()?(D.setFloat3(l,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(D.setFloat3(l,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(D){const l=this._scene.getEngine();return!l.useReverseDepthBuffer&&l.isNDCHalfZRange?0:1}getDepthMaxZ(D){const l=this._scene.getEngine();return l.useReverseDepthBuffer&&l.isNDCHalfZRange?0:1}prepareLightSpecificDefines(D,l){D["DIRLIGHT"+l]=!0}}(0,V.b)([(0,N.L)()],n.prototype,"shadowFrustumSize",null),(0,V.b)([(0,N.L)()],n.prototype,"shadowOrthoScale",null),(0,V.b)([(0,N.L)()],n.prototype,"autoUpdateExtends",void 0),(0,V.b)([(0,N.L)()],n.prototype,"autoCalcShadowZBounds",void 0),(0,V.b)([(0,N.L)("orthoLeft")],n.prototype,"_orthoLeft",void 0),(0,V.b)([(0,N.L)("orthoRight")],n.prototype,"_orthoRight",void 0),(0,V.b)([(0,N.L)("orthoTop")],n.prototype,"_orthoTop",void 0),(0,V.b)([(0,N.L)("orthoBottom")],n.prototype,"_orthoBottom",void 0),(0,R.c)("BABYLON.DirectionalLight",n)},13853:(D,l,G)=>{"use strict";G.d(l,{b:()=>n});var V=G(11695),N=G(11703),M=G(11710),b=G(11755),X=G(12144),t=G(12265),R=G(11667);X.e.AddNodeConstructor("Light_Type_3",((D,l)=>()=>new n(D,M.Kl.Zero(),l)));class n extends t.c{constructor(D,l,G){super(D,G),this.groundColor=new b.hl(0,0,0),this.direction=l||M.Kl.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Eb"}setDirectionToTarget(D){return this.direction=M.Kl.Normalize(D.Fl(M.Kl.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(D,l){const G=M.Kl.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",G.x,G.y,G.z,0,l),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Sb),l),this}transferToNodeMaterialEffect(D,l){const G=M.Kl.Normalize(this.direction);return D.setFloat3(l,G.x,G.y,G.z),this}hb(){return this._worldMatrix||(this._worldMatrix=M.Matrix.Identity()),this._worldMatrix}getTypeID(){return t.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(D,l){D["HEMILIGHT"+l]=!0}}(0,V.b)([(0,N.l)()],n.prototype,"groundColor",void 0),(0,V.b)([(0,N.I)()],n.prototype,"direction",void 0),(0,R.c)("BABYLON.HemisphericLight",n)},13375:(D,l,G)=>{"use strict";G.d(l,{b:()=>g});var V=G(11695),N=G(11703),M=G(11710),b=G(12144),X=G(12265),t=G(12325),R=G(11686),n=G(11667);b.e.AddNodeConstructor("Light_Type_2",((D,l)=>()=>new g(D,M.Kl.Zero(),M.Kl.Zero(),0,0,l)));class g extends t.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(D){this._iesProfileTexture!==D&&(this._iesProfileTexture=D,this._iesProfileTexture&&g._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(D){this._angle=D,this._cosHalfAngle=Math.cos(.5*D),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(D){this._innerAngle=D,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(D){this._shadowAngleScale=D,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(D){this._projectionTextureLightNear=D,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(D){this._projectionTextureLightFar=D,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(D){this._projectionTextureUpDirection=D,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(D){this._projectionTexture!==D&&(this._projectionTexture=D,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(g._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):g._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(D){return void 0!==D.onGeneratedObservable}static _IsTexture(D){return void 0!==D.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(D){this._projectionTextureProjectionLightMatrix=D,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(D,l,G,V,N,b){super(D,b),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=M.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=M.Kl.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=M.Kl.Zero(),this._projectionTextureViewLightMatrix=M.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=M.Matrix.Zero(),this._projectionTextureScalingMatrix=M.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=l,this.direction=G,this.angle=V,this.exponent=N}getClassName(){return"SpotLight"}getTypeID(){return X.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(D){super._setDirection(D),this._projectionTextureViewLightDirty=!0}_setPosition(D){super._setPosition(D),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(D,l,G){const V=this.uD().activeCamera;if(!V)return;this._shadowAngleScale=this._shadowAngleScale||1;const N=this._shadowAngleScale*this._angle,b=void 0!==this.shadowMinZ?this.shadowMinZ:V.Kb,X=void 0!==this.shadowMaxZ?this.shadowMaxZ:V.maxZ,t=this.uD().getEngine().useReverseDepthBuffer;M.Matrix.PerspectiveFovLHToRef(N,1,t?X:b,t?b:X,D,!0,this._scene.getEngine().isNDCHalfZRange,void 0,t)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),M.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const D=this.projectionTextureLightFar,l=this.projectionTextureLightNear,G=D/(D-l),V=-G*l,N=1/Math.tan(this._angle/2);M.Matrix.FromValuesToRef(N/1,0,0,0,0,N,0,0,0,0,G,1,0,0,V,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof R.b){const D=this._projectionTexture.uScale/2,l=this._projectionTexture.vScale/2;M.Matrix.FromValuesToRef(D,0,0,0,0,l,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(D,l){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),D.setMatrix("textureProjectionMatrix"+l,this._projectionTextureMatrix),D.setTexture("projectionLightTexture"+l,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&D.setTexture("iesLightTexture"+l,this._iesProfileTexture),this}transferToEffect(D,l){let G;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,l),G=M.Kl.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,l),G=M.Kl.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",G.x,G.y,G.z,this._cosHalfAngle,l),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,l),this}transferToNodeMaterialEffect(D,l){let G;return G=this.computeTransformedInformation()?M.Kl.Normalize(this.transformedDirection):M.Kl.Normalize(this.direction),this.uD().useRightHandedSystem?D.setFloat3(l,-G.x,-G.y,-G.z):D.setFloat3(l,G.x,G.y,G.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(D){const l=this._scene.getEngine(),G=void 0!==this.shadowMinZ?this.shadowMinZ:(null===D||void 0===D?void 0:D.Kb)??0;return l.useReverseDepthBuffer&&l.isNDCHalfZRange?G:this._scene.getEngine().isNDCHalfZRange?0:G}getDepthMaxZ(D){const l=this._scene.getEngine(),G=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===D||void 0===D?void 0:D.maxZ)??1e4;return l.useReverseDepthBuffer&&l.isNDCHalfZRange?0:G}prepareLightSpecificDefines(D,l){D["SPOTLIGHT"+l]=!0,D["PROJECTEDLIGHTTEXTURE"+l]=!(!this.projectionTexture||!this.projectionTexture.isReady()),D["IESLIGHTTEXTURE"+l]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,V.b)([(0,N.L)()],g.prototype,"angle",null),(0,V.b)([(0,N.L)()],g.prototype,"innerAngle",null),(0,V.b)([(0,N.L)()],g.prototype,"shadowAngleScale",null),(0,V.b)([(0,N.L)()],g.prototype,"exponent",void 0),(0,V.b)([(0,N.L)()],g.prototype,"projectionTextureLightNear",null),(0,V.b)([(0,N.L)()],g.prototype,"projectionTextureLightFar",null),(0,V.b)([(0,N.L)()],g.prototype,"projectionTextureUpDirection",null),(0,V.b)([(0,N.B)("projectedLightTexture")],g.prototype,"_projectionTexture",void 0),(0,n.c)("BABYLON.SpotLight",g)},13105:(D,l,G)=>{"use strict";G.d(l,{e:()=>b,g:()=>M,j:()=>X});const V={},N={};function M(D,l){V[D]=l}function b(D,l){N[D]=l}function X(D){return N[D]?N[D]:null}},12994:(D,l,G)=>{"use strict";G.d(l,{e:()=>u,g:()=>q});var V,N=G(11530),M=G(11532),b=G(11963),X=G(11571),t=G(11546),R=G(12191),n=G(11573),g=G(11580),j=G(11672),e=G(11613),K=G(11565);!function(D){D[D.Clean=0]="Clean",D[D.Stop=1]="Stop",D[D.Sync=2]="Sync",D[D.NoSync=3]="NoSync"}(V||(V={}));const F=new M.e,d={};let H=!1;function h(){return d[".babylon"]}function x(D,l){const G=d[D];return G||(t.d.Warn("Unable to find a plugin to load "+D+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),l?h():void 0)}function r(D,l,G){let V="Unable to load from "+(D.rawData?"binary data":D.url);return l?V+=`: ${l}`:G&&(V+=`: ${G}`),V}async function o(D,l,G,V,N,M,b,X,t){var R;const g="data:"===(j=D.url).substring(0,5)?j.substring(5):null;var j;if(D.rawData&&!b)throw"When using ArrayBufferView to load data the file extension must be provided.";const H=g||b?"":function(D){const l=D.indexOf("?");-1!==l&&(D=D.substring(0,l));const G=D.lastIndexOf(".");return D.substring(G,D.length).toLowerCase()}(D.url);let r=b?x(b,!0):g?function(D){for(const l in d){const G=d[l].plugin;if(G.canDirectLoad&&G.canDirectLoad(D))return d[l]}return h()}(D.url):x(H,!1);if(!r&&H){if(D.url&&!D.url.startsWith("blob:")){const l=await async function(D,l){const G=l.method||"GET";return await new Promise(((V,N)=>{const M=new K.d;M.addEventListener("readystatechange",(()=>{if(4==M.readyState)if(200==M.status){const D={};if(l.responseHeaders)for(const G of l.responseHeaders)D[G]=M.getResponseHeader(G)||"";V({response:M.response,headerValues:D})}else N(`Unable to fetch data from ${D}. Error code: ${M.status}`)})),M.open(G,D),M.send()}))}(D.url,{method:"HEAD",responseHeaders:["Content-Type"]}),G=l.headerValues?l.headerValues["Content-Type"]:"";G&&(r=function(D){for(const l in d){const G=d[l];if(G.mimeType===D)return G}}(G))}r||(r=h())}if(!r)throw new Error(`No plugin or fallback for ${b??D.url}`);if(!1===(null===t||void 0===t||null===(R=t[r.plugin.name])||void 0===R?void 0:R.enabled))throw new Error(`The '${r.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(D.rawData&&!r.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(D=>{if(r.plugin.createPlugin){const l=r.plugin.createPlugin(t??{});return l instanceof Promise?(l.then(D).catch((D=>{N("Error instantiating plugin.",D)})),null):(D(l),l)}return D(r.plugin),r.plugin})((t=>{var R;if(!t)throw`The loader plugin corresponding to the '${b}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(F.notifyObservers(t),g&&(t.canDirectLoad&&t.canDirectLoad(D.url)||!(0,n.k)(D.url))){if(t.directLoad){const D=t.directLoad(l,g);D instanceof Promise?D.then((D=>{G(t,D)})).catch((D=>{N("Error in directLoad of _loadData: "+D,D)})):G(t,D)}else G(t,g);return}const j=r.isBinary,K=(D,V)=>{l.X?N("Scene has been disposed"):G(t,D,V)};let d=null,H=!1;null===(R=t.Vb)||void 0===R||R.add((()=>{H=!0,d&&(d.abort(),d=null),M()}));const h=()=>{if(H)return;const G=(D,l)=>{N(null===D||void 0===D?void 0:D.statusText,l)};if(!t.loadFile&&D.rawData)throw"Plugin does not support loading ArrayBufferView.";d=t.loadFile?t.loadFile(l,D.rawData||D.file||D.url,D.rootUrl,K,V,j,G,X):l._loadFile(D.file||D.url,K,V,!0,j,G)},x=l.getEngine();let o=x.enableOfflineSupport;if(o){let G=!1;for(const V of l.disableOfflineSupportExceptionRules)if(V.test(D.url)){G=!0;break}o=!G}o&&e.e.OfflineProviderFactory?l.offlineProvider=e.e.OfflineProviderFactory(D.url,h,x.disableManifestCheck):h()}))}function L(D,l){let G,V,M=null,b=null;if(l)if(l.name)G=`file:${l.name}`,V=l.name,M=l;else if(ArrayBuffer.isView(l))G="",V=(0,j.c)(),b=l;else if(l.startsWith("data:"))G=l,V="";else if(D){const M=l;if("/"===M.substring(0,1))return N.Tools.Error("Wrong sceneFilename parameter"),null;G=D+M,V=M}else G=l,V=N.Tools.GetFilename(l),D=N.Tools.GetFolderPath(l);else G=D,V=N.Tools.GetFilename(D),D=N.Tools.GetFolderPath(D);return{url:G,rootUrl:D,name:V,file:M,rawData:b}}function u(D){if("string"===typeof D.extensions){const l=D.extensions;d[l.toLowerCase()]={plugin:D,isBinary:!1}}else{const l=D.extensions,G=Object.keys(l);for(const V of G)d[V.toLowerCase()]={plugin:D,isBinary:l[V].isBinary,mimeType:l[V].mimeType}}}async function B(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:X.d.LastCreatedScene,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!V)return t.d.Error("No scene available to import mesh to"),null;const e=L(l,G);if(!e)return null;const K={};V.addPendingData(K);const F=()=>{V.removePendingData(K)},d=(D,l)=>{const G=r(e,D,l);b?b(V,G,new g.e(G,g.d.SceneLoaderError,l)):t.d.Error(G),F()},H=M?D=>{try{M(D)}catch(l){d("Error in onProgress callback: "+l,l)}}:void 0,h=(D,l,G,M,b,X,t,R)=>{if(V.importedMeshesFiles.push(e.url),N)try{N(D,l,G,M,b,X,t,R)}catch(n){d("Error in onSuccess callback: "+n,n)}V.removePendingData(K)};return await o(e,V,((l,G,N)=>{if(l.rewriteRootURL&&(e.rootUrl=l.rewriteRootURL(e.rootUrl,N)),l.importMesh){const N=[],M=[],b=[];if(!l.importMesh(D,V,G,e.rootUrl,N,M,b,d))return;V.loadingPluginName=l.name,h(N,M,b,[],[],[],[],[])}else{l.importMeshAsync(D,V,G,e.rootUrl,H,e.name).then((D=>{V.loadingPluginName=l.name,h(D.meshes,D.xj,D.skeletons,D.animationGroups,D.transformNodes,D.geometries,D.lights,D.spriteManagers)})).catch((D=>{d(D.message,D)}))}}),H,d,F,R,n,j)}async function I(D,l,G,V,N,M,b,X){return await new Promise(((t,R)=>{try{B(D,l,G,V,((D,l,G,V,N,M,b,X)=>{t({meshes:D,xj:l,skeletons:G,animationGroups:V,transformNodes:N,geometries:M,lights:b,spriteManagers:X})}),N,((D,l,G)=>{R(G||new Error(l))}),M,b,X).catch(R)}catch(g){R(g)}}))}async function W(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.d.LastCreatedEngine,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};G?await y(D,l,new b.b(G),V,M,t,R,n,g):N.Tools.Error("No engine available")}async function i(D,l,G,V,N,M,b){return await new Promise(((X,t)=>{W(D,l,G,(D=>{X(D)}),V,((D,l,G)=>{t(G||new Error(l))}),N,M,b)}))}async function y(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.d.LastCreatedScene,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!G)return t.d.Error("No scene available to append to"),null;const e=L(D,l);if(!e)return null;const K={};G.addPendingData(K);const F=()=>{G.removePendingData(K)};R.e.ShowLoadingScreen&&!H&&(H=!0,G.getEngine().displayLoadingUI(),G.executeWhenReady((()=>{G.getEngine().hideLoadingUI(),H=!1})));const d=(D,l)=>{const V=r(e,D,l);M?M(G,V,new g.e(V,g.d.SceneLoaderError,l)):t.d.Error(V),F()},h=N?D=>{try{N(D)}catch(l){d("Error in onProgress callback",l)}}:void 0,x=()=>{if(V)try{V(G)}catch(D){d("Error in onSuccess callback",D)}G.removePendingData(K)};return await o(e,G,((D,l)=>{if(D.load){if(!D.load(G,l,e.rootUrl,d))return;G.loadingPluginName=D.name,x()}else{D.loadAsync(G,l,e.rootUrl,h,e.name).then((()=>{G.loadingPluginName=D.name,x()})).catch((D=>{d(D.message,D)}))}}),h,d,F,b,n,j)}async function S(D,l,G,V,N,M,b){return await new Promise(((X,t)=>{try{y(D,l,G,(D=>{X(D)}),V,((D,l,G)=>{t(G||new Error(l))}),N,M,b).catch(t)}catch(g){t(g)}}))}async function O(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.d.LastCreatedScene,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!G)return t.d.Error("No scene available to load asset container to"),null;const j=L(D,l);if(!j)return null;const e={};G.addPendingData(e);const K=()=>{G.removePendingData(e)},F=(D,l)=>{const V=r(j,D,l);M?M(G,V,new g.e(V,g.d.SceneLoaderError,l)):t.d.Error(V),K()},d=N?D=>{try{N(D)}catch(l){F("Error in onProgress callback",l)}}:void 0,H=D=>{if(V)try{V(D)}catch(l){F("Error in onSuccess callback",l)}G.removePendingData(e)};return await o(j,G,((D,l)=>{if(D.loadAssetContainer){const V=D.loadAssetContainer(G,l,j.rootUrl,F);if(!V)return;V.populateRootNodes(),G.loadingPluginName=D.name,H(V)}else if(D.loadAssetContainerAsync){D.loadAssetContainerAsync(G,l,j.rootUrl,d,j.name).then((l=>{l.populateRootNodes(),G.loadingPluginName=D.name,H(l)})).catch((D=>{F(D.message,D)}))}else F("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),d,F,K,b,R,n)}async function s(D,l,G,V,N,M,b){return await new Promise(((X,t)=>{try{O(D,l,G,(D=>{X(D)}),V,((D,l,G)=>{t(G||new Error(l))}),N,M,b).catch(t)}catch(g){t(g)}}))}async function U(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.d.LastCreatedScene,V=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,j=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",e=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!G)return void t.d.Error("No scene available to load animations to");if(V){for(const V of G.animatables)V.reset();G.stopAllAnimations();const D=G.animationGroups.slice();for(const G of D)G.dispose();const l=G.getNodes();for(const G of l)G.animations&&(G.animations=[])}else switch(N){case 0:const D=G.animationGroups.slice();for(const l of D)l.dispose();break;case 1:for(const l of G.animationGroups)l.stop();break;case 2:for(const l of G.animationGroups)l.reset(),l.restart();break;case 3:break;default:return void t.d.Error("Unknown animation group loading mode value '"+N+"'")}const K=G.animatables.length;await O(D,l,G,(D=>{D.mergeAnimationsTo(G,G.animatables.slice(K),M),D.dispose(),G.onAnimationFileImportedObservable.notifyObservers(G),b&&b(G)}),R,n,g,j,e)}async function f(D,l,G,V,N,M,b,X,t,R){return await new Promise(((n,j)=>{try{U(D,l,G,V,N,M,(D=>{n(D)}),b,((D,l,G)=>{j(G||new Error(l))}),X,t,R).catch(j)}catch(g){j(g)}}))}class q{static get ForceFullSceneLoadingForIncremental(){return R.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(D){R.e.ForceFullSceneLoadingForIncremental=D}static get ShowLoadingScreen(){return R.e.ShowLoadingScreen}static set ShowLoadingScreen(D){R.e.ShowLoadingScreen=D}static get loggingLevel(){return R.e.loggingLevel}static set loggingLevel(D){R.e.loggingLevel=D}static get CleanBoneMatrixWeights(){return R.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(D){R.e.CleanBoneMatrixWeights=D}static GetDefaultPlugin(){return h()}static GetPluginForExtension(D){var l;return null===(l=x(D,!0))||void 0===l?void 0:l.plugin}static IsPluginForExtensionAvailable(D){return function(D){return!!d[D]}(D)}static RegisterPlugin(D){u(D)}static ImportMesh(D,l,G,V,N,M,b,t,R){B(D,l,G,V,N,M,b,t,R).catch((D=>null===b||void 0===b?void 0:b(X.d.LastCreatedScene,null===D||void 0===D?void 0:D.message,D)))}static async ImportMeshAsync(D,l,G,V,N,M,b){return await I(D,l,G,V,N,M,b)}static Load(D,l,G,V,N,M,b,t){W(D,l,G,V,N,M,b,t).catch((D=>null===M||void 0===M?void 0:M(X.d.LastCreatedScene,null===D||void 0===D?void 0:D.message,D)))}static async LoadAsync(D,l,G,V,N,M){return await i(D,l,G,V,N,M)}static Append(D,l,G,V,N,M,b,t){y(D,l,G,V,N,M,b,t).catch((D=>null===M||void 0===M?void 0:M(G??X.d.LastCreatedScene,null===D||void 0===D?void 0:D.message,D)))}static async AppendAsync(D,l,G,V,N,M){return await S(D,l,G,V,N,M)}static LoadAssetContainer(D,l,G,V,N,M,b,t){O(D,l,G,V,N,M,b,t).catch((D=>null===M||void 0===M?void 0:M(G??X.d.LastCreatedScene,null===D||void 0===D?void 0:D.message,D)))}static async LoadAssetContainerAsync(D,l,G,V,N,M){return await s(D,l,G,V,N,M)}static ImportAnimations(D,l,G,V,N,M,b,t,R,n,g){U(D,l,G,V,N,M,b,t,R,n,g).catch((D=>null===R||void 0===R?void 0:R(G??X.d.LastCreatedScene,null===D||void 0===D?void 0:D.message,D)))}static async ImportAnimationsAsync(D,l,G,V,N,M,b,X,t,R,n){return await f(D,l,G,V,N,M,X,R,n)}}q.NO_LOGGING=0,q.MINIMAL_LOGGING=1,q.SUMMARY_LOGGING=2,q.DETAILED_LOGGING=3,q.OnPluginActivatedObservable=F},13388:(D,l,G)=>{"use strict";G.d(l,{b:()=>j});var V=G(11695),N=G(11703),M=G(11530),b=G(11710),X=G(11732),t=G(11686),R=G(11667),n=G(11532),g=G(11739);G(13392);class j extends X.c{set boundingBoxSize(D){if(this._boundingBoxSize&&this._boundingBoxSize.equals(D))return;this._boundingBoxSize=D;const l=this.uD();l&&l.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(D){this._rotationY=D,this.setReflectionTextureMatrix(b.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(D,l,G){let V="";for(const N of D)V+=N;return new j(V,l,null,G,D)}static CreateFromPrefilteredData(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const N=l.useDelayedTextureLoading;l.useDelayedTextureLoading=!1;const M=new j(D,l,null,!1,null,null,null,void 0,!0,G,V);return l.useDelayedTextureLoading=N,M}constructor(D,l){var G;let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,j=arguments.length>8&&void 0!==arguments[8]&&arguments[8],e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,K=arguments.length>10&&void 0!==arguments[10]&&arguments[10],F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,H=arguments.length>13?arguments[13]:void 0,h=arguments.length>14?arguments[14]:void 0;super(l),this.onLoadObservable=new n.e,this.boundingBoxPosition=b.Kl.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new b.Matrix,this._buffer=null,this.name=D,this.url=D,this._noMipmap=N,this.eb=!1,this.isCube=!0,this._textureMatrix=b.Matrix.Identity(),this.coordinatesMode=t.b.CUBIC_MODE;let x=null,r=null;null===V||Array.isArray(V)?(this._noMipmap=N,this._format=g,this._createPolynomials=K,x=V,this._loaderOptions=H,this._useSRGBBuffer=h,this._lodScale=F,this._lodOffset=d):(x=V.extensions??null,this._noMipmap=V.noMipmap??!1,M=V.files??null,r=V.buffer??null,this._format=V.format??5,j=V.prefiltered??!1,e=V.forcedExtension??null,this._createPolynomials=V.createPolynomials??!1,this._lodScale=V.lodScale??.8,this._lodOffset=V.lodOffset??0,this._loaderOptions=V.loaderOptions,this._useSRGBBuffer=V.useSRGBBuffer,X=V.T??null,R=V.onError??null),(D||M)&&this.updateURL(D,e,X,j,R,x,null===(G=this.uD())||void 0===G?void 0:G.useDelayedTextureLoading,M,r)}getClassName(){return"CubeTexture"}updateURL(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=D),this.url=D,l&&(this._forcedExtension=l);const R=D.lastIndexOf("."),n=l||(R>-1?D.substring(R).toLowerCase():""),g=0===n.indexOf(".dds"),j=0===n.indexOf(".env"),e=0===n.indexOf(".basis");if(j?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=V,V&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),X)this._files=X;else if(e||j||g||M||(M=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,M){for(let l=0;l<M.length;l++)this._files.push(D+M[l]);this._extensions=M}this._buffer=t,b?(this.delayLoadState=4,this._delayedOnLoad=G,this._delayedOnError=N):this._loadTexture(G,N)}delayLoad(D){4===this.delayLoadState&&(D&&(this._forcedExtension=D),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(D){var l,G;if(D.updateFlag===this._textureMatrix.updateFlag)return;D.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(G=this.uD())||void 0===G||G.markAllMaterialsAsDirty(1,(D=>-1!==D.getActiveTextures().indexOf(this))));if(this._textureMatrix=D,null===(l=this.uD())||void 0===l||!l.useRightHandedSystem)return;const V=b.TmpVectors.Kl[0],N=b.TmpVectors.Quaternion[0],M=b.TmpVectors.Kl[1];this._textureMatrix.decompose(V,N,M),N.z*=-1,N.w*=-1,b.Matrix.ComposeToRef(V,N,M,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var D;return null!==(D=this.uD())&&void 0!==D&&D.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=this.uD(),V=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const N=()=>{var l;(this.onLoadObservable.notifyObservers(this),V)&&(V.dispose(),null===(l=this.uD())||void 0===l||l.markAllMaterialsAsDirty(1));D&&D()},b=(D,G)=>{this._loadingError=!0,this._errorObject={message:D,exception:G},l&&l(D,G),t.b.OnTextureLoadErrorObservable.notifyObservers(this)};var X;this._texture?this._texture.isReady?M.Tools.SetImmediate((()=>N())):this._texture.onLoadedObservable.add((()=>N())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,G,this._lodScale,this._lodOffset,D,b,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,G,this._files,this._noMipmap,D,b,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(X=this._texture)||void 0===X||X.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(D,l,G){const V=g.c.Parse((()=>{let V=!1;return D.prefiltered&&(V=D.prefiltered),new j(G+(D.url??D.name),l,D.extensions,!1,D.files||null,null,null,void 0,V,D.forcedExtension)}),D,l);if(D.boundingBoxPosition&&(V.boundingBoxPosition=b.Kl.xl(D.boundingBoxPosition)),D.boundingBoxSize&&(V.boundingBoxSize=b.Kl.xl(D.boundingBoxSize)),D.animations)for(let N=0;N<D.animations.length;N++){const l=D.animations[N],G=(0,R.b)("BABYLON.Animation");G&&V.animations.push(G.Parse(l))}return V}clone(){let D=0;const l=g.c.Clone((()=>{const l=new j(this.url,this.uD()||this._getEngine(),this._extensions,this._noMipmap,this._files);return D=l.uniqueId,l}),this);return l.uniqueId=D,l}}(0,V.b)([(0,N.L)()],j.prototype,"url",void 0),(0,V.b)([(0,N.I)()],j.prototype,"boundingBoxPosition",void 0),(0,V.b)([(0,N.I)()],j.prototype,"boundingBoxSize",null),(0,V.b)([(0,N.L)("rotationY")],j.prototype,"rotationY",null),(0,V.b)([(0,N.L)("files")],j.prototype,"_files",void 0),(0,V.b)([(0,N.L)("forcedExtension")],j.prototype,"_forcedExtension",void 0),(0,V.b)([(0,N.L)("extensions")],j.prototype,"_extensions",void 0),(0,V.b)([(0,N.u)("textureMatrix")],j.prototype,"_textureMatrix",void 0),(0,V.b)([(0,N.u)("textureMatrixRefraction")],j.prototype,"_textureMatrixRefraction",void 0),t.b._CubeTextureParser=j.Parse,(0,R.c)("BABYLON.CubeTexture",j)},13863:(D,l,G)=>{"use strict";G.d(l,{c:()=>t});var V=G(11546),N=G(11686),M=G(11675),b=G(11851),X=G(11644);b.ThinEngine.prototype.createDynamicTexture=function(D,l,G,V){const N=new X.b(this,4);return N.baseWidth=D,N.baseHeight=l,G&&(D=this.needPOTTextures?(0,M.e)(D,this._caps.maxTextureSize):D,l=this.needPOTTextures?(0,M.e)(l,this._caps.maxTextureSize):l),N.width=D,N.height=l,N.isReady=!1,N.generateMipMaps=G,N.samplingMode=V,this.updateTextureSamplingMode(V,N),this._internalTexturesCache.push(N),N},b.ThinEngine.prototype.updateDynamicTexture=function(D,l,G){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!D)return;const b=this._gl,X=b.TEXTURE_2D,t=this._bindTextureDirectly(X,D,!0,M);this._unpackFlipY(void 0===G?D.invertY:G),V&&b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const R=this._getWebGLTextureType(D.type),n=this._getInternalFormat(N||D.format),g=this._getRGBABufferInternalSizedFormat(D.type,n);b.texImage2D(X,0,g,n,R,l),D.generateMipMaps&&b.generateMipmap(X),t||this._bindTextureDirectly(X,null),V&&b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),N&&(D.format=N),D._dynamicTextureSource=l,D._premulAlpha=V,D.invertY=G||!1,D.isReady=!0};class t extends N.b{constructor(D,l,G){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,X=arguments.length>6?arguments[6]:void 0;const t=!G||G._isScene;super(null,t?G:null===G||void 0===G?void 0:G.dl,t?!V:G,X,M,void 0,void 0,void 0,void 0,b),this.name=D,this.wrapU=N.b.CLAMP_ADDRESSMODE,this.wrapV=N.b.CLAMP_ADDRESSMODE,this._generateMipMaps=V;const R=this._getEngine();if(!R)return;if(l.getContext)this._canvas=l,this._ownCanvas=!1,this._texture=R.createDynamicTexture(this._canvas.width,this._canvas.height,V,M);else{this._canvas=R.createCanvas(1,1),this._ownCanvas=!0;const D=l;D.width||0===D.width?this._texture=R.createDynamicTexture(D.width,D.height,V,M):this._texture=R.createDynamicTexture(l,l,V,M)}const n=this.getSize();this._canvas.width!==n.width&&(this._canvas.width=n.width),this._canvas.height!==n.height&&(this._canvas.height=n.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(D){this._canvas.width=D.width,this._canvas.height=D.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(D.width,D.height,this._generateMipMaps,this.samplingMode)}scale(D){const l=this.getSize();l.width*=D,l.height*=D,this._recreate(l)}scaleTo(D,l){const G=this.getSize();G.width=D,G.height=l,this._recreate(G)}getContext(){return this._context}clear(D){const l=this.getSize();D&&(this._context.fillStyle=D),this._context.clearRect(0,0,l.width,l.height)}update(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===D||D,l,this._format||void 0,void 0,G)}drawText(D,l,G,V,N,M,b){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const t=this.getSize();if(M&&(this._context.fillStyle=M,this._context.fillRect(0,0,t.width,t.height)),this._context.font=V,null===l||void 0===l){const G=this._context.measureText(D);l=(t.width-G.width)/2}if(null===G||void 0===G){const D=parseInt(V.replace(/\D/g,""));G=t.height/2+D/3.65}this._context.fillStyle=N||"",this._context.fillText(D,l,G),X&&this.update(b)}dispose(){var D,l;(super.dispose(),this._ownCanvas)&&(null===(D=this._canvas)||void 0===D||null===(l=D.remove)||void 0===l||l.call(D));this._canvas=null,this._context=null}clone(){const D=this.uD();if(!D)return this;const l=this.getSize(),G=new t(this.name,l,D,this._generateMipMaps);return G.eb=this.eb,G.level=this.level,G.wrapU=this.wrapU,G.wrapV=this.wrapV,G}serialize(){const D=this.uD();D&&!D.isReady()&&V.d.Warn("The scene must be ready before serializing the dynamic texture");const l=super.serialize();return t._IsCanvasElement(this._canvas)&&(l.base64String=this._canvas.toDataURL()),l.invertY=this._invertY,l.samplingMode=this.samplingMode,l}static _IsCanvasElement(D){return void 0!==D.toDataURL}_rebuild(){this.update()}}},13313:(D,l,G)=>{"use strict";G.d(l,{c:()=>N});var V=G(11686);class N extends V.b{get depth(){return this._depth}constructor(D,l,G,N,M,b){let X=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],t=arguments.length>7&&void 0!==arguments[7]&&arguments[7],R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:V.b.TRILINEAR_SAMPLINGMODE,n=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,g=arguments.length>10?arguments[10]:void 0;super(null,b,!X,t),this.format=M,this._texture=b.getEngine().createRawTexture2DArray(D,l,G,N,M,X,t,R,null,n,g),this._depth=N,this.is2DArray=!0}update(D){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,D,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(D,l,G,V,M){return new N(D,l,G,V,5,M,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13124:(D,l,G)=>{"use strict";G.d(l,{e:()=>X,f:()=>t,g:()=>M,i:()=>b});var V=G(11728),N=G(11710);function M(D,l){return`{X: ${D.x.toFixed(l)} Y: ${D.y.toFixed(l)}}`}function b(D,l){return`{X: ${D._x.toFixed(l)} Y: ${D._y.toFixed(l)} Z: ${D._z.toFixed(l)}}`}function X(D,l){return 2*Math.acos((0,V.Clamp)(N.Quaternion.Dot(D,l)))}function t(D,l){const G=new N.Quaternion;return function(D,l,G){const M=N.Kl.Cross(D,l),b=Math.acos((0,V.Clamp)(N.Kl.Dot(D,l),-1,1));N.Quaternion.RotationAxisToRef(M,b,G)}(D,l,G),G}},12952:(D,l,G)=>{"use strict";G.d(l,{b:()=>R});var V=G(11710),N=G(11755),M=G(12173),b=G(12155),X=G(11768);G(12960);function t(D){let l=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const G=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],M=[];let t=[];const R=D.width||D.size||1,n=D.height||D.size||1,g=D.depth||D.size||1,j=D.wrap||!1;let e=void 0===D.topBaseAt?1:D.topBaseAt,K=void 0===D.bottomBaseAt?0:D.bottomBaseAt;e=(e+4)%4,K=(K+4)%4;let F=[2,0,3,1][e],d=[2,0,1,3][K],H=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(j){l=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],H=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let D=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],G=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const V=[17,18,19,16],N=[22,23,20,21];for(;F>0;)D.unshift(D.pop()),V.unshift(V.pop()),F--;for(;d>0;)G.unshift(G.pop()),N.unshift(N.pop()),d--;D=D.flat(),G=G.flat(),H=H.concat(D).concat(G),l.push(V[0],V[2],V[3],V[0],V[1],V[2]),l.push(N[0],N[2],N[3],N[0],N[1],N[2])}const h=[R/2,n/2,g/2];t=H.reduce(((D,l,G)=>D.concat(l*h[G%3])),[]);const x=0===D.sideOrientation?0:D.sideOrientation||b.d.DEFAULTSIDE,r=D.faceUV||new Array(6),o=D.faceColors,L=[];for(let b=0;b<6;b++)void 0===r[b]&&(r[b]=new V.Vector4(0,0,1,1)),o&&void 0===o[b]&&(o[b]=new N.Wb(1,1,1,1));for(let V=0;V<6;V++)if(M.push(r[V].z,X.e?1-r[V].w:r[V].w),M.push(r[V].x,X.e?1-r[V].w:r[V].w),M.push(r[V].x,X.e?1-r[V].y:r[V].y),M.push(r[V].z,X.e?1-r[V].y:r[V].y),o)for(let D=0;D<4;D++)L.push(o[V].r,o[V].g,o[V].b,o[V].a);b.d._ComputeSides(x,t,l,G,M,D.frontUVs,D.backUVs);const u=new b.d;if(u.indices=l,u.ID=t,u.WD=G,u.yD=M,o){const D=x===b.d.DOUBLESIDE?L.concat(L):L;u.iD=D}return u}function R(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new M.b(D,G);l.sideOrientation=M.b._GetDefaultSideOrientation(l.sideOrientation),V._originalBuilderSideOrientation=l.sideOrientation;return t(l).OD(V,l.updatable),V}b.d.CreateBox=t,M.b.CreateBox=function(D,l){return R(D,{size:l,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13114:(D,l,G)=>{"use strict";G.d(l,{b:()=>X});var V=G(12173),N=G(12155),M=G(11768);function b(D){const l=[],G=[],V=[],b=[],X=D.radius||.5,t=D.tessellation||64,R=D.arc&&(D.arc<=0||D.arc>1)?1:D.arc||1,n=0===D.sideOrientation?0:D.sideOrientation||N.d.DEFAULTSIDE;l.push(0,0,0),b.push(.5,.5);const g=2*Math.PI*R,j=1===R?g/t:g/(t-1);let e=0;for(let N=0;N<t;N++){const D=Math.cos(e),G=Math.sin(e),V=(D+1)/2,N=(1-G)/2;l.push(X*D,X*G,0),b.push(V,M.e?1-N:N),e+=j}1===R&&(l.push(l[3],l[4],l[5]),b.push(b[2],M.e?1-b[3]:b[3]));const K=l.length/3;for(let N=1;N<K-1;N++)G.push(N+1,0,N);N.d.ComputeNormals(l,G,V),N.d._ComputeSides(n,l,G,V,b,D.frontUVs,D.backUVs);const F=new N.d;return F.indices=G,F.ID=l,F.WD=V,F.yD=b,F}function X(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new V.b(D,G);l.sideOrientation=V.b._GetDefaultSideOrientation(l.sideOrientation),N._originalBuilderSideOrientation=l.sideOrientation;return b(l).OD(N,l.updatable),N}N.d.CreateDisc=b,V.b.CreateDisc=function(D,l,G){return X(D,{radius:l,tessellation:G,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12960:(D,l,G)=>{"use strict";G.d(l,{e:()=>d,d:()=>h,h:()=>H});var V=G(11710),N=G(11755),M=G(12173),b=G(12155),X=G(11788);M.b._GroundMeshParser=(D,l)=>t.Parse(D,l);class t extends M.b{constructor(D,l){super(D,l),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=D,this._subdivisionsY=D,this.subdivide(D);const G=this;G.createOrUpdateSubmeshesOctree&&G.createOrUpdateSubmeshesOctree(l)}getHeightAtCoordinates(D,l){const G=this.getWorldMatrix(),N=V.TmpVectors.Matrix[5];G.invertToRef(N);const M=V.TmpVectors.Kl[8];if(V.Kl.TransformCoordinatesFromFloatsToRef(D,0,l,N,M),D=M.x,l=M.z,D<this._minX||D>=this._maxX||l<=this._minZ||l>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const b=this._getFacetAt(D,l),X=-(b.x*D+b.z*l+b.w)/b.y;return V.Kl.TransformCoordinatesFromFloatsToRef(0,X,0,G,M),M.y}getNormalAtCoordinates(D,l){const G=new V.Kl(0,1,0);return this.getNormalAtCoordinatesToRef(D,l,G),G}getNormalAtCoordinatesToRef(D,l,G){const N=this.getWorldMatrix(),M=V.TmpVectors.Matrix[5];N.invertToRef(M);const b=V.TmpVectors.Kl[8];if(V.Kl.TransformCoordinatesFromFloatsToRef(D,0,l,M,b),D=b.x,l=b.z,D<this._minX||D>this._maxX||l<this._minZ||l>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const X=this._getFacetAt(D,l);return V.Kl.TransformNormalFromFloatsToRef(X.x,X.y,X.z,N,G),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(D,l){const G=Math.floor((D+this._maxX)*this._subdivisionsX/this._width),V=Math.floor(-(l+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),N=this._heightQuads[V*this._subdivisionsX+G];let M;return M=l<N.slope.x*D+N.slope.y?N.facet1:N.facet2,M}_initHeightQuads(){const D=this._subdivisionsX,l=this._subdivisionsY;this._heightQuads=[];for(let G=0;G<l;G++)for(let l=0;l<D;l++){const N={slope:V.Vector2.Zero(),facet1:new V.Vector4(0,0,0,0),facet2:new V.Vector4(0,0,0,0)};this._heightQuads[G*D+l]=N}return this}_computeHeightQuads(){const D=this.getVerticesData(X.e.PositionKind);if(!D)return this;const l=V.TmpVectors.Kl[3],G=V.TmpVectors.Kl[2],N=V.TmpVectors.Kl[1],M=V.TmpVectors.Kl[0],b=V.TmpVectors.Kl[4],t=V.TmpVectors.Kl[5],R=V.TmpVectors.Kl[6],n=V.TmpVectors.Kl[7],g=V.TmpVectors.Kl[8];let j=0,e=0,K=0,F=0,d=0,H=0,h=0;const x=this._subdivisionsX,r=this._subdivisionsY;for(let X=0;X<r;X++)for(let r=0;r<x;r++){j=3*r,e=X*(x+1)*3,K=(X+1)*(x+1)*3,l.x=D[e+j],l.y=D[e+j+1],l.z=D[e+j+2],G.x=D[e+j+3],G.y=D[e+j+4],G.z=D[e+j+5],N.x=D[K+j],N.y=D[K+j+1],N.z=D[K+j+2],M.x=D[K+j+3],M.y=D[K+j+4],M.z=D[K+j+5],F=(M.z-l.z)/(M.x-l.x),d=l.z-F*l.x,G.subtractToRef(l,b),N.subtractToRef(l,t),M.subtractToRef(l,R),V.Kl.CrossToRef(R,t,n),V.Kl.CrossToRef(b,R,g),n.normalize(),g.normalize(),H=-(n.x*l.x+n.y*l.y+n.z*l.z),h=-(g.x*G.x+g.y*G.y+g.z*G.z);const o=this._heightQuads[X*x+r];o.slope.Lb(F,d),o.facet1.Lb(n.x,n.y,n.z,H),o.facet2.Lb(g.x,g.y,g.z,h)}return this}serialize(D){super.serialize(D),D.subdivisionsX=this._subdivisionsX,D.subdivisionsY=this._subdivisionsY,D.minX=this._minX,D.maxX=this._maxX,D.Kb=this._minZ,D.maxZ=this._maxZ,D.width=this._width,D.height=this._height}static Parse(D,l){const G=new t(D.name,l);return G._subdivisionsX=D.subdivisionsX||1,G._subdivisionsY=D.subdivisionsY||1,G._minX=D.minX,G._maxX=D.maxX,G._minZ=D.Kb,G._maxZ=D.maxZ,G._width=D.width,G._height=D.height,G}}var R=G(11530),n=G(11571),g=G(11713),j=G(11768);function e(D){const l=[],G=[],N=[],M=[];let X,t;const R=D.width||D.size||1,n=D.height||D.size||1,g=0|(D.subdivisionsX||D.subdivisions||1),e=0|(D.subdivisionsY||D.subdivisions||1);for(X=0;X<=e;X++)for(t=0;t<=g;t++){const D=new V.Kl(t*R/g-R/2,0,(e-X)*n/e-n/2),l=new V.Kl(0,1,0);G.push(D.x,D.y,D.z),N.push(l.x,l.y,l.z),M.push(t/g,j.e?X/e:1-X/e)}for(X=0;X<e;X++)for(t=0;t<g;t++)l.push(t+1+(X+1)*(g+1)),l.push(t+1+X*(g+1)),l.push(t+X*(g+1)),l.push(t+(X+1)*(g+1)),l.push(t+1+(X+1)*(g+1)),l.push(t+X*(g+1));const K=new b.d;return K.indices=l,K.ID=G,K.WD=N,K.yD=M,K}function K(D){const l=void 0!==D.xmin&&null!==D.xmin?D.xmin:-1,G=void 0!==D.zmin&&null!==D.zmin?D.zmin:-1,N=void 0!==D.xmax&&null!==D.xmax?D.xmax:1,M=void 0!==D.zmax&&null!==D.zmax?D.zmax:1,X=D.subdivisions||{w:1,h:1},t=D.precision||{w:1,h:1},R=[],n=[],g=[],j=[];let e,K,F,d;X.h=X.h<1?1:X.h,X.w=X.w<1?1:X.w,t.w=t.w<1?1:t.w,t.h=t.h<1?1:t.h;const H=(N-l)/X.w,h=(M-G)/X.h;function x(D,l,G,N){const M=n.length/3,b=t.w+1;for(e=0;e<t.h;e++)for(K=0;K<t.w;K++){const D=[M+K+e*b,M+(K+1)+e*b,M+(K+1)+(e+1)*b,M+K+(e+1)*b];R.push(D[1]),R.push(D[2]),R.push(D[3]),R.push(D[0]),R.push(D[1]),R.push(D[3])}const X=V.Kl.Zero(),F=new V.Kl(0,1,0);for(e=0;e<=t.h;e++)for(X.z=e*(N-l)/t.h+l,K=0;K<=t.w;K++)X.x=K*(G-D)/t.w+D,X.y=0,n.push(X.x,X.y,X.z),g.push(F.x,F.y,F.z),j.push(K/t.w,e/t.h)}for(F=0;F<X.h;F++)for(d=0;d<X.w;d++)x(l+d*H,G+F*h,l+(d+1)*H,G+(F+1)*h);const r=new b.d;return r.indices=R,r.ID=n,r.WD=g,r.yD=j,r}function F(D){const l=[],G=[],M=[],X=[];let t,R;const n=D.colorFilter||new N.hl(.3,.59,.11),j=D.alphaFilter||0;let e=!1;if(D.minHeight>D.maxHeight){e=!0;const l=D.maxHeight;D.maxHeight=D.minHeight,D.minHeight=l}for(t=0;t<=D.subdivisions;t++)for(R=0;R<=D.subdivisions;R++){const l=new V.Kl(R*D.width/D.subdivisions-D.width/2,0,(D.subdivisions-t)*D.height/D.subdivisions-D.height/2),N=4*(((l.x+D.width/2)/D.width*(D.bufferWidth-1)|0)+((1-(l.z+D.height/2)/D.height)*(D.bufferHeight-1)|0)*D.bufferWidth);let b=D.buffer[N]/255,K=D.buffer[N+1]/255,F=D.buffer[N+2]/255;const d=D.buffer[N+3]/255;e&&(b=1-b,K=1-K,F=1-F);const H=b*n.r+K*n.g+F*n.b;l.y=d>=j?D.minHeight+(D.maxHeight-D.minHeight)*H:D.minHeight-g.b,D.heightBuffer&&(D.heightBuffer[t*(D.subdivisions+1)+R]=l.y),G.push(l.x,l.y,l.z),M.push(0,0,0),X.push(R/D.subdivisions,1-t/D.subdivisions)}for(t=0;t<D.subdivisions;t++)for(R=0;R<D.subdivisions;R++){const V=R+1+(t+1)*(D.subdivisions+1),N=R+1+t*(D.subdivisions+1),M=R+t*(D.subdivisions+1),b=R+(t+1)*(D.subdivisions+1),X=G[3*V+1]>=D.minHeight,n=G[3*N+1]>=D.minHeight,g=G[3*M+1]>=D.minHeight;X&&n&&g&&(l.push(V),l.push(N),l.push(M));G[3*b+1]>=D.minHeight&&X&&g&&(l.push(b),l.push(V),l.push(M))}b.d.ComputeNormals(G,l,M);const K=new b.d;return K.indices=l,K.ID=G,K.WD=M,K.yD=X,K}function d(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const G=new t(D,arguments.length>2?arguments[2]:void 0);G._setReady(!1),G._subdivisionsX=l.subdivisionsX||l.subdivisions||1,G._subdivisionsY=l.subdivisionsY||l.subdivisions||1,G._width=l.width||1,G._height=l.height||1,G._maxX=G._width/2,G._maxZ=G._height/2,G._minX=-G._maxX,G._minZ=-G._maxZ;return e(l).OD(G,l.updatable),G._setReady(!0),G}function H(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new M.b(D,G);return K(l).OD(V,l.updatable),V}function h(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const M=G.width||10,b=G.height||10,X=G.subdivisions||1,g=G.minHeight||0,j=G.maxHeight||1,e=G.colorFilter||new N.hl(.3,.59,.11),K=G.alphaFilter||0,d=G.updatable,H=G.onReady;V=V||n.d.LastCreatedScene;const h=new t(D,V);let x;h._subdivisionsX=X,h._subdivisionsY=X,h._width=M,h._height=b,h._maxX=h._width/2,h._maxZ=h._height/2,h._minX=-h._maxX,h._minZ=-h._maxZ,h._setReady(!1),G.passHeightBufferInCallback&&(x=new Float32Array((X+1)*(X+1)));const r=(D,l,G)=>{F({width:M,height:b,subdivisions:X,minHeight:g,maxHeight:j,colorFilter:e,buffer:D,bufferWidth:l,bufferHeight:G,alphaFilter:K,heightBuffer:x}).OD(h,d),H&&H(h,x),h._setReady(!0)};if("string"===typeof l){const D=D=>{var l;const G=D.width,N=D.height;if(V.X)return;const M=null===(l=V)||void 0===l?void 0:l.getEngine().resizeImageBitmap(D,G,N);r(M,G,N)};R.Tools.LoadImage(l,D,G.onError?G.onError:()=>{},V.offlineProvider)}else r(l.data,l.width,l.height);return h}b.d.CreateGround=e,b.d.CreateTiledGround=K,b.d.CreateGroundFromHeightMap=F,M.b.CreateGround=(D,l,G,V,N,M)=>d(D,{width:l,height:G,subdivisions:V,updatable:M},N),M.b.CreateTiledGround=(D,l,G,V,N,M,b,X,t)=>H(D,{xmin:l,zmin:G,xmax:V,zmax:N,subdivisions:M,precision:b,updatable:t},X),M.b.CreateGroundFromHeightMap=(D,l,G,V,N,M,b,X,t,R,n)=>h(D,l,{width:G,height:V,subdivisions:N,minHeight:M,maxHeight:b,updatable:t,onReady:R,alphaFilter:n},X)},13577:(D,l,G)=>{"use strict";G.d(l,{e:()=>e,f:()=>g,g:()=>j});var V=G(11710),N=G(12173),M=G(12155),b=G(12267),X=G(11788),t=G(11546);function R(D){const l=[],G=[],V=D.lines,N=D.iD,b=[];let X=0;for(let M=0;M<V.length;M++){const D=V[M];for(let V=0;V<D.length;V++){const{x:t,y:R,z:n}=D[V];if(G.push(t,R,n),N){const D=N[M],{r:l,g:G,b:X,a:t}=D[V];b.push(l,G,X,t)}V>0&&(l.push(X-1),l.push(X)),X++}}const t=new M.d;return t.indices=l,t.ID=G,N&&(t.iD=b),t}function n(D){const l=D.dashSize||3,G=D.gapSize||1,N=D.dashNb||200,b=D.points,X=[],t=[],R=V.Kl.Zero();let n=0,g=0,j=0,e=0,K=0,F=0,d=0;for(d=0;d<b.length-1;d++)b[d+1].subtractToRef(b[d],R),n+=R.length();for(j=n/N,e=l*j/(l+G),d=0;d<b.length-1;d++){b[d+1].subtractToRef(b[d],R),g=Math.floor(R.length()/j),R.normalize();for(let D=0;D<g;D++)K=j*D,X.push(b[d].x+K*R.x,b[d].y+K*R.y,b[d].z+K*R.z),X.push(b[d].x+(K+e)*R.x,b[d].y+(K+e)*R.y,b[d].z+(K+e)*R.z),t.push(F,F+1),F+=2}const H=new M.d;return H.ID=X,H.indices=t,H}function g(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=l.instance,N=l.lines,M=l.iD;if(V){const D=V.getVerticesData(X.e.PositionKind);let l,G;M&&(l=V.getVerticesData(X.e.ColorKind));let b=0,t=0;for(let V=0;V<N.length;V++){const X=N[V];for(let N=0;N<X.length;N++)D[b]=X[N].x,D[b+1]=X[N].y,D[b+2]=X[N].z,M&&l&&(G=M[V],l[t]=G[N].r,l[t+1]=G[N].g,l[t+2]=G[N].b,l[t+3]=G[N].a,t+=4),b+=3}return V.updateVerticesData(X.e.PositionKind,D,!1,!1),M&&l&&V.updateVerticesData(X.e.ColorKind,l,!1,!1),V.refreshBoundingInfo(),V}const t=!!M,n=new b.d(D,G,null,void 0,void 0,t,l.useVertexAlpha,l.material);return R(l).OD(n,l.updatable),n}function j(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=l.iD?[l.iD]:null;return g(D,{lines:[l.points],updatable:l.updatable,instance:l.instance,iD:V,useVertexAlpha:l.useVertexAlpha,material:l.material},G)}function e(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=l.points,X=l.instance,R=l.gapSize||1,g=l.dashSize||3;if(X){const D=D=>{const l=V.Kl.Zero(),G=D.length/6;let N=0,b=0,t=0,R=0,n=0,g=0,j=0,e=0;for(j=0;j<M.length-1;j++)M[j+1].subtractToRef(M[j],l),N+=l.length();t=N/G;const K=X._creationDataStorage.dashSize;for(R=K*t/(K+X._creationDataStorage.gapSize),j=0;j<M.length-1;j++)for(M[j+1].subtractToRef(M[j],l),b=Math.floor(l.length()/t),l.normalize(),e=0;e<b&&g<D.length;)n=t*e,D[g]=M[j].x+n*l.x,D[g+1]=M[j].y+n*l.y,D[g+2]=M[j].z+n*l.z,D[g+3]=M[j].x+(n+R)*l.x,D[g+4]=M[j].y+(n+R)*l.y,D[g+5]=M[j].z+(n+R)*l.z,g+=6,e++;for(;g<D.length;)D[g]=M[j].x,D[g+1]=M[j].y,D[g+2]=M[j].z,g+=3};return(l.dashNb||l.dashSize||l.gapSize||l.useVertexAlpha||l.material)&&t.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),X.updateMeshPositions(D,!1),X}const j=new b.d(D,G,null,void 0,void 0,void 0,l.useVertexAlpha,l.material);return n(l).OD(j,l.updatable),j._creationDataStorage=new N.f,j._creationDataStorage.dashSize=g,j._creationDataStorage.gapSize=R,j}M.d.CreateLineSystem=R,M.d.CreateDashedLines=n,N.b.iR=function(D,l){return j(D,{points:l,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},N.b.CreateDashedLines=function(D,l,G,V,N){return e(D,{points:l,dashSize:G,gapSize:V,dashNb:N,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12999:(D,l,G)=>{"use strict";G.d(l,{d:()=>X,f:()=>t});var V=G(12173),N=G(12155),M=G(11768);function b(D){const l=[],G=[],V=[],b=[],X=void 0!==D.width?D.width:void 0!==D.size?D.size:1,t=void 0!==D.height?D.height:void 0!==D.size?D.size:1,R=0===D.sideOrientation?0:D.sideOrientation||N.d.DEFAULTSIDE,n=X/2,g=t/2;G.push(-n,-g,0),V.push(0,0,-1),b.push(0,M.e?1:0),G.push(n,-g,0),V.push(0,0,-1),b.push(1,M.e?1:0),G.push(n,g,0),V.push(0,0,-1),b.push(1,M.e?0:1),G.push(-n,g,0),V.push(0,0,-1),b.push(0,M.e?0:1),l.push(0),l.push(1),l.push(2),l.push(0),l.push(2),l.push(3),N.d._ComputeSides(R,G,l,V,b,D.frontUVs,D.backUVs);const j=new N.d;return j.indices=l,j.ID=G,j.WD=V,j.yD=b,j}function X(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new V.b(D,G);l.sideOrientation=V.b._GetDefaultSideOrientation(l.sideOrientation),N._originalBuilderSideOrientation=l.sideOrientation;return b(l).OD(N,l.updatable),l.sourcePlane&&(N.translate(l.sourcePlane.normal,-l.sourcePlane.d),N.setDirection(l.sourcePlane.normal.scale(-1))),N}const t={OR:X};N.d.OR=b,V.b.OR=(D,l,G,V,N)=>X(D,{size:l,width:l,height:l,sideOrientation:N,updatable:V},G)},13099:(D,l,G)=>{"use strict";G.d(l,{d:()=>t});var V=G(11710),N=G(12173),M=G(12155),b=G(11768);function X(D){const l=0|(D.segments||32),G=D.diameterX||D.diameter||1,N=D.diameterY||D.diameter||1,X=D.diameterZ||D.diameter||1,t=D.arc&&(D.arc<=0||D.arc>1)?1:D.arc||1,R=D.slice&&D.slice<=0?1:D.slice||1,n=0===D.sideOrientation?0:D.sideOrientation||M.d.DEFAULTSIDE,g=!!D.dedupTopBottomIndices,j=new V.Kl(G/2,N/2,X/2),e=2+l,K=2*e,F=[],d=[],H=[],h=[];for(let M=0;M<=e;M++){const D=M/e,l=D*Math.PI*R;for(let G=0;G<=K;G++){const N=G/K,M=N*Math.PI*2*t,X=V.Matrix.RotationZ(-l),R=V.Matrix.RotationY(M),n=V.Kl.TransformCoordinates(V.Kl.Up(),X),g=V.Kl.TransformCoordinates(n,R),e=g.multiply(j),F=g.divide(j).normalize();d.push(e.x,e.y,e.z),H.push(F.x,F.y,F.z),h.push(N,b.e?1-D:D)}if(M>0){const D=d.length/3;for(let l=D-2*(K+1);l+K+2<D;l++)g?(M>1&&(F.push(l),F.push(l+1),F.push(l+K+1)),(M<e||R<1)&&(F.push(l+K+1),F.push(l+1),F.push(l+K+2))):(F.push(l),F.push(l+1),F.push(l+K+1),F.push(l+K+1),F.push(l+1),F.push(l+K+2))}}M.d._ComputeSides(n,d,F,H,h,D.frontUVs,D.backUVs);const x=new M.d;return x.indices=F,x.ID=d,x.WD=H,x.yD=h,x}function t(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new N.b(D,G);l.sideOrientation=N.b._GetDefaultSideOrientation(l.sideOrientation),V._originalBuilderSideOrientation=l.sideOrientation;return X(l).OD(V,l.updatable),V}M.d.CreateSphere=X,N.b.CreateSphere=(D,l,G,V,N,M)=>t(D,{segments:l,diameterX:G,diameterY:G,diameterZ:G,sideOrientation:M,updatable:N},V)},13871:(D,l,G)=>{"use strict";G.d(l,{b:()=>X});var V=G(12294),N=G(13396),M=G(12313),b=G(12155);class X{static get Configuration(){return{get decoder(){return N.d.DefaultConfiguration},set decoder(D){N.d.DefaultConfiguration=D}}}static set Configuration(D){N.d.DefaultConfiguration=D.decoder}static get DecoderAvailable(){return(0,V.f)(N.d.DefaultConfiguration)}static get Default(){return X._Default??(X._Default=new X),X._Default}static ResetDefault(D){X._Default&&(D||X._Default.dispose(),X._Default=null)}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.DefaultNumWorkers;const l="number"===typeof D?{...N.d.DefaultConfiguration,numWorkers:D}:{...N.d.DefaultConfiguration,...D};this._decoder=new N.d(l)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(D,l,G){return this._decoder.decodeMeshToMeshDataAsync(D,l,G)}async decodeMeshToGeometryAsync(D,l,G,V){return await this._decoder.decodeMeshToGeometryAsync(D,l,G,V)}async _decodeMeshToGeometryForGltfAsync(D,l,G,V,N,M){return await this._decoder._decodeMeshToGeometryForGltfAsync(D,l,G,V,N,M)}async decodeMeshAsync(D,l){const G=await this._decoder.decodeMeshToMeshDataAsync(D,l),V=new b.d;G.indices&&(V.indices=G.indices);for(const N of G.attributes){const D=M.d.GetFloatData(N.data,N.size,M.d.GetDataType(N.data),N.byteOffset,N.byteStride,N.normalized,G.totalVertices);V.set(D,N.kind)}return V}}X.DefaultNumWorkers=(0,V.e)(),X._Default=null},13396:(D,l,G)=>{"use strict";G.d(l,{d:()=>R});var V=G(12294),N=G(11530),M=G(12183),b=G(12313),X=G(11546),t=G(12311);class R extends V.b{static get DefaultAvailable(){return(0,V.f)(R.DefaultConfiguration)}static get Default(){return R._Default??(R._Default=new R),R._Default}static ResetDefault(D){R._Default&&(D||R._Default.dispose(),R._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(D,l){return{module:await(l||DracoDecoderModule)({wasmBinary:D})}}_getWorkerContent(){return`${t.e}(${t.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.DefaultConfiguration)}decodeMeshToMeshDataAsync(D,l,G){const V=D instanceof ArrayBuffer?new Int8Array(D):new Int8Array(D.buffer,D.byteOffset,D.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async D=>await new Promise(((N,M)=>{D.push(((D,b)=>{let t=null;const R=[],n=l=>{D.removeEventListener("error",n),D.removeEventListener("message",g),M(l),b()},g=l=>{const V=l.data;switch(V.id){case"indices":t=V.data;break;case"attribute":R.push({kind:V.kind,data:V.data,size:V.size,byteOffset:V.byteOffset,byteStride:V.byteStride,normalized:(M=V.kind,j=V.normalized,G&&void 0!==G[M]?(j!==G[M]&&X.d.Warn(`Normalized flag from Draco data (${j}) does not match normalized flag from glTF accessor (${G[M]}). Using flag from glTF accessor.`),G[M]):j)});break;case"decodeMeshDone":D.removeEventListener("error",n),D.removeEventListener("message",g),N({indices:t,attributes:R,totalVertices:V.totalVertices}),b()}var M,j};D.addEventListener("error",n),D.addEventListener("message",g);const j=V.slice();D.postMessage({id:"decodeMesh",dataView:j,attributes:l},[j.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((D=>{let G=null;const N=[],M=(0,t.e)(D.module,V,l,(D=>{G=D}),((D,l,G,V,M,b)=>{N.push({kind:D,data:l,size:G,byteOffset:V,byteStride:M,normalized:b})}));return{indices:G,attributes:N,totalVertices:M}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(D,l,G,V){const N=await this.decodeMeshToMeshDataAsync(G,V),X=new M.c(D,l);N.indices&&X.setIndices(N.indices);for(const M of N.attributes)X.setVerticesBuffer(new b.d(l.getEngine(),M.data,M.kind,!1,void 0,M.byteStride,void 0,M.byteOffset,M.size,void 0,M.normalized,!0),N.totalVertices);return X}async _decodeMeshToGeometryForGltfAsync(D,l,G,V,N,X){const t=await this.decodeMeshToMeshDataAsync(G,V,N),R=new M.c(D,l);X&&(R._boundingInfo=X,R.useBoundingInfoFromGeometry=!0),t.indices&&R.setIndices(t.indices);for(const M of t.attributes)R.setVerticesBuffer(new b.d(l.getEngine(),M.data,M.kind,!1,void 0,M.byteStride,void 0,M.byteOffset,M.size,void 0,M.normalized,!0),t.totalVertices);return R}}R.DefaultConfiguration={wasmUrl:`${N.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${N.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${N.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},R._Default=null},13575:(D,l,G)=>{"use strict";G.d(l,{d:()=>XD});var V=G(11710),N=G(12173),M=G(11788),b=G(12155),X=G(11768);function t(D){let l=D.pathArray;const G=D.closeArray||!1,V=D.closePath||!1,N=D.invertUV||!1,t=Math.floor(l[0].length/2);let R=D.offset||t;R=R>t?t:Math.floor(R);const n=0===D.sideOrientation?0:D.sideOrientation||b.d.DEFAULTSIDE,g=D.yD,j=D.iD,e=[],K=[],F=[],d=[],H=[],h=[],x=[],r=[];let o;const L=[],u=[];let B,I,W;if(l.length<2){const D=[],G=[];for(I=0;I<l[0].length-R;I++)D.push(l[0][I]),G.push(l[0][I+R]);l=[D,G]}let i=0;const y=V?1:0,S=G?1:0;let O,s,U,f,q,c;for(o=l[0].length,B=0;B<l.length+S;B++){for(x[B]=0,H[B]=[0],O=B===l.length?l[0]:l[B],s=O.length,o=o<s?o:s,W=0;W<s;)e.push(O[W].x,O[W].y,O[W].z),W>0&&(U=O[W].Fl(O[W-1]).length(),f=U+x[B],H[B].push(f),x[B]=f),W++;V&&(W--,e.push(O[0].x,O[0].y,O[0].z),U=O[W].Fl(O[0]).length(),f=U+x[B],H[B].push(f),x[B]=f),L[B]=s+y,u[B]=i,i+=s+y}let v,Z,J=null,Y=null;for(I=0;I<o+y;I++)for(r[I]=0,h[I]=[0],B=0;B<l.length-1+S;B++)q=l[B],c=B===l.length-1?l[0]:l[B+1],I===o?(J=q[0],Y=c[0]):(J=q[I],Y=c[I]),U=Y.Fl(J).length(),f=U+r[I],h[I].push(f),r[I]=f;if(g)for(B=0;B<g.length;B++)d.push(g[B].x,X.e?1-g[B].y:g[B].y);else for(B=0;B<l.length+S;B++)for(I=0;I<o+y;I++)v=0!=x[B]?H[B][I]/x[B]:0,Z=0!=r[I]?h[I][B]/r[I]:0,N?d.push(Z,v):d.push(v,X.e?1-Z:Z);B=0;let z=0,E=L[B]-1,P=L[B+1]-1,p=E<P?E:P,k=u[1]-u[0];const m=L.length-1;for(;z<=p&&B<m;)K.push(z,z+k,z+1),K.push(z+k+1,z+1,z+k),z+=1,z===p&&(B++,k=u[B+1]-u[B],E=L[B]-1,P=L[B+1]-1,z=u[B],p=E<P?E+z:P+z);if(b.d.ComputeNormals(e,K,F),V){let D=0,G=0;for(B=0;B<l.length;B++){D=3*u[B],G=B+1<l.length?3*(u[B+1]-1):F.length-3,F[D]=.5*(F[D]+F[G]),F[D+1]=.5*(F[D+1]+F[G+1]),F[D+2]=.5*(F[D+2]+F[G+2]);const V=Math.sqrt(F[D]*F[D]+F[D+1]*F[D+1]+F[D+2]*F[D+2]);F[D]/=V,F[D+1]/=V,F[D+2]/=V,F[G]=F[D],F[G+1]=F[D+1],F[G+2]=F[D+2]}}if(G){let D=3*u[0],G=3*u[l.length];for(I=0;I<o+y;I++){F[D]=.5*(F[D]+F[G]),F[D+1]=.5*(F[D+1]+F[G+1]),F[D+2]=.5*(F[D+2]+F[G+2]);const l=Math.sqrt(F[D]*F[D]+F[D+1]*F[D+1]+F[D+2]*F[D+2]);F[D]/=l,F[D+1]/=l,F[D+2]/=l,F[G]=F[D],F[G+1]=F[D+1],F[G+2]=F[D+2],D+=3,G+=3}}b.d._ComputeSides(n,e,K,F,d,D.frontUVs,D.backUVs);let T=null;if(j){T=new Float32Array(4*j.length);for(let D=0;D<j.length;D++)T[4*D]=j[D].r,T[4*D+1]=j[D].g,T[4*D+2]=j[D].b,T[4*D+3]=j[D].a}const C=new b.d,w=new Float32Array(e),A=new Float32Array(F),a=new Float32Array(d);return C.indices=K,C.ID=w,C.WD=A,C.yD=a,T&&C.set(T,M.e.ColorKind),V&&(C._idx=u),C}function R(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=l.pathArray,n=l.closeArray,g=l.closePath,j=N.b._GetDefaultSideOrientation(l.sideOrientation),e=l.instance,K=l.updatable;if(e){const D=V.TmpVectors.Kl[0].Ib(Number.MAX_VALUE),G=V.TmpVectors.Kl[1].Ib(-Number.MAX_VALUE),t=l=>{let V=R[0].length;const M=e;let b=0;const X=M._originalBuilderSideOrientation===N.b.DOUBLESIDE?2:1;for(let N=1;N<=X;++N)for(let X=0;X<R.length;++X){const N=R[X],t=N.length;V=V<t?V:t;for(let M=0;M<V;++M){const V=N[M];l[b]=V.x,l[b+1]=V.y,l[b+2]=V.z,D.minimizeInPlaceFromFloats(V.x,V.y,V.z),G.maximizeInPlaceFromFloats(V.x,V.y,V.z),b+=3}if(M._creationDataStorage&&M._creationDataStorage.closePath){const D=N[0];l[b]=D.x,l[b+1]=D.y,l[b+2]=D.z,b+=3}}},n=e.getVerticesData(M.e.PositionKind);if(t(n),e.hasBoundingInfo?e.getBoundingInfo().reConstruct(D,G,e._worldMatrix):e.buildBoundingInfo(D,G,e._worldMatrix),e.updateVerticesData(M.e.PositionKind,n,!1,!1),l.iD){const D=e.getVerticesData(M.e.ColorKind);for(let G=0,V=0;G<l.iD.length;G++,V+=4){const N=l.iD[G];D[V]=N.r,D[V+1]=N.g,D[V+2]=N.b,D[V+3]=N.a}e.updateVerticesData(M.e.ColorKind,D,!1,!1)}if(l.yD){const D=e.getVerticesData(M.e.UVKind);for(let G=0;G<l.yD.length;G++)D[2*G]=l.yD[G].x,D[2*G+1]=X.e?1-l.yD[G].y:l.yD[G].y;e.updateVerticesData(M.e.UVKind,D,!1,!1)}if(!e.areNormalsFrozen||e.isFacetDataEnabled){const D=e.rb(),l=e.getVerticesData(M.e.NormalKind),G=e.isFacetDataEnabled?e.getFacetDataParameters():null;if(b.d.ComputeNormals(n,D,l,G),e._creationDataStorage&&e._creationDataStorage.closePath){let D=0,G=0;for(let V=0;V<R.length;V++)D=3*e._creationDataStorage.idx[V],G=V+1<R.length?3*(e._creationDataStorage.idx[V+1]-1):l.length-3,l[D]=.5*(l[D]+l[G]),l[D+1]=.5*(l[D+1]+l[G+1]),l[D+2]=.5*(l[D+2]+l[G+2]),l[G]=l[D],l[G+1]=l[D+1],l[G+2]=l[D+2]}e.areNormalsFrozen||e.updateVerticesData(M.e.NormalKind,l,!1,!1)}return e}{const V=new N.b(D,G);V._originalBuilderSideOrientation=j,V._creationDataStorage=new N.f;const M=t(l);return g&&(V._creationDataStorage.idx=M._idx),V._creationDataStorage.closePath=g,V._creationDataStorage.closeArray=n,M.OD(V,K),V}}b.d.CreateRibbon=t,N.b.CreateRibbon=function(D,l){return R(D,{pathArray:l,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var n=G(13114),g=G(12952),j=G(11755);function e(D){const l=D.pattern||N.b.NO_FLIP,G=D.tileWidth||D.tileSize||1,V=D.tileHeight||D.tileSize||1,M=D.alignHorizontal||0,X=D.alignVertical||0,t=D.width||D.size||1,R=Math.floor(t/G);let n=t-R*G;const g=D.height||D.size||1,j=Math.floor(g/V);let e=g-j*V;const K=G*R/2,F=V*j/2;let d=0,H=0,h=0,x=0,r=0,o=0;if(n>0||e>0){switch(h=-K,x=-F,r=K,o=F,M){case N.b.CENTER:n/=2,h-=n,r+=n;break;case N.b.LEFT:r+=n,d=-n/2;break;case N.b.RIGHT:h-=n,d=n/2}switch(X){case N.b.CENTER:e/=2,x-=e,o+=e;break;case N.b.BOTTOM:o+=e,H=-e/2;break;case N.b.TOP:x-=e,H=e/2}}const L=[],u=[],B=[];B[0]=[0,0,1,0,1,1,0,1],B[1]=[0,0,1,0,1,1,0,1],l!==N.b.ROTATE_TILE&&l!==N.b.ROTATE_ROW||(B[1]=[1,1,0,1,0,0,1,0]),l!==N.b.FLIP_TILE&&l!==N.b.FLIP_ROW||(B[1]=[1,0,0,0,0,1,1,1]),l!==N.b.FLIP_N_ROTATE_TILE&&l!==N.b.FLIP_N_ROTATE_ROW||(B[1]=[0,1,1,1,1,0,0,0]);let I=[];const W=[],i=[];let y=0;for(let b=0;b<j;b++)for(let D=0;D<R;D++)L.push(D*G-K+d,b*V-F+H,0),L.push((D+1)*G-K+d,b*V-F+H,0),L.push((D+1)*G-K+d,(b+1)*V-F+H,0),L.push(D*G-K+d,(b+1)*V-F+H,0),i.push(y,y+1,y+3,y+1,y+2,y+3),I=l===N.b.FLIP_TILE||l===N.b.ROTATE_TILE||l===N.b.FLIP_N_ROTATE_TILE?I.concat(B[(D%2+b%2)%2]):l===N.b.FLIP_ROW||l===N.b.ROTATE_ROW||l===N.b.FLIP_N_ROTATE_ROW?I.concat(B[b%2]):I.concat(B[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),y+=4;if(n>0||e>0){const D=e>0&&(X===N.b.CENTER||X===N.b.TOP),b=e>0&&(X===N.b.CENTER||X===N.b.BOTTOM),t=n>0&&(M===N.b.CENTER||M===N.b.RIGHT),g=n>0&&(M===N.b.CENTER||M===N.b.LEFT);let B,S,O,s,U=[];if(D&&t&&(L.push(h+d,x+H,0),L.push(-K+d,x+H,0),L.push(-K+d,x+e+H,0),L.push(h+d,x+e+H,0),i.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,B=1-n/G,S=1-e/V,O=1,s=1,U=[B,S,O,S,O,s,B,s],l===N.b.ROTATE_ROW&&(U=[1-B,1-S,1-O,1-S,1-O,1-s,1-B,1-s]),l===N.b.FLIP_ROW&&(U=[1-B,S,1-O,S,1-O,s,1-B,s]),l===N.b.FLIP_N_ROTATE_ROW&&(U=[B,1-S,O,1-S,O,1-s,B,1-s]),I=I.concat(U),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),D&&g&&(L.push(K+d,x+H,0),L.push(r+d,x+H,0),L.push(r+d,x+e+H,0),L.push(K+d,x+e+H,0),i.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,B=0,S=1-e/V,O=n/G,s=1,U=[B,S,O,S,O,s,B,s],(l===N.b.ROTATE_ROW||l===N.b.ROTATE_TILE&&R%2===0)&&(U=[1-B,1-S,1-O,1-S,1-O,1-s,1-B,1-s]),(l===N.b.FLIP_ROW||l===N.b.FLIP_TILE&&R%2===0)&&(U=[1-B,S,1-O,S,1-O,s,1-B,s]),(l===N.b.FLIP_N_ROTATE_ROW||l===N.b.FLIP_N_ROTATE_TILE&&R%2===0)&&(U=[B,1-S,O,1-S,O,1-s,B,1-s]),I=I.concat(U),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),b&&t&&(L.push(h+d,F+H,0),L.push(-K+d,F+H,0),L.push(-K+d,o+H,0),L.push(h+d,o+H,0),i.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,B=1-n/G,S=0,O=1,s=e/V,U=[B,S,O,S,O,s,B,s],(l===N.b.ROTATE_ROW&&j%2===1||l===N.b.ROTATE_TILE&&j%1===0)&&(U=[1-B,1-S,1-O,1-S,1-O,1-s,1-B,1-s]),(l===N.b.FLIP_ROW&&j%2===1||l===N.b.FLIP_TILE&&j%2===0)&&(U=[1-B,S,1-O,S,1-O,s,1-B,s]),(l===N.b.FLIP_N_ROTATE_ROW&&j%2===1||l===N.b.FLIP_N_ROTATE_TILE&&j%2===0)&&(U=[B,1-S,O,1-S,O,1-s,B,1-s]),I=I.concat(U),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),b&&g&&(L.push(K+d,F+H,0),L.push(r+d,F+H,0),L.push(r+d,o+H,0),L.push(K+d,o+H,0),i.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,B=0,S=0,O=n/G,s=e/V,U=[B,S,O,S,O,s,B,s],(l===N.b.ROTATE_ROW&&j%2===1||l===N.b.ROTATE_TILE&&(j+R)%2===1)&&(U=[1-B,1-S,1-O,1-S,1-O,1-s,1-B,1-s]),(l===N.b.FLIP_ROW&&j%2===1||l===N.b.FLIP_TILE&&(j+R)%2===1)&&(U=[1-B,S,1-O,S,1-O,s,1-B,s]),(l===N.b.FLIP_N_ROTATE_ROW&&j%2===1||l===N.b.FLIP_N_ROTATE_TILE&&(j+R)%2===1)&&(U=[B,1-S,O,1-S,O,1-s,B,1-s]),I=I.concat(U),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),D){const D=[];B=0,S=1-e/V,O=1,s=1,D[0]=[B,S,O,S,O,s,B,s],D[1]=[B,S,O,S,O,s,B,s],l!==N.b.ROTATE_TILE&&l!==N.b.ROTATE_ROW||(D[1]=[1-B,1-S,1-O,1-S,1-O,1-s,1-B,1-s]),l!==N.b.FLIP_TILE&&l!==N.b.FLIP_ROW||(D[1]=[1-B,S,1-O,S,1-O,s,1-B,s]),l!==N.b.FLIP_N_ROTATE_TILE&&l!==N.b.FLIP_N_ROTATE_ROW||(D[1]=[B,1-S,O,1-S,O,1-s,B,1-s]);for(let V=0;V<R;V++)L.push(V*G-K+d,x+H,0),L.push((V+1)*G-K+d,x+H,0),L.push((V+1)*G-K+d,x+e+H,0),L.push(V*G-K+d,x+e+H,0),i.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,I=l===N.b.FLIP_TILE||l===N.b.ROTATE_TILE||l===N.b.FLIP_N_ROTATE_TILE?I.concat(D[(V+1)%2]):l===N.b.FLIP_ROW||l===N.b.ROTATE_ROW||l===N.b.FLIP_N_ROTATE_ROW?I.concat(D[1]):I.concat(D[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(b){const D=[];B=0,S=0,O=1,s=e/V,D[0]=[B,S,O,S,O,s,B,s],D[1]=[B,S,O,S,O,s,B,s],l!==N.b.ROTATE_TILE&&l!==N.b.ROTATE_ROW||(D[1]=[1-B,1-S,1-O,1-S,1-O,1-s,1-B,1-s]),l!==N.b.FLIP_TILE&&l!==N.b.FLIP_ROW||(D[1]=[1-B,S,1-O,S,1-O,s,1-B,s]),l!==N.b.FLIP_N_ROTATE_TILE&&l!==N.b.FLIP_N_ROTATE_ROW||(D[1]=[B,1-S,O,1-S,O,1-s,B,1-s]);for(let V=0;V<R;V++)L.push(V*G-K+d,o-e+H,0),L.push((V+1)*G-K+d,o-e+H,0),L.push((V+1)*G-K+d,o+H,0),L.push(V*G-K+d,o+H,0),i.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,I=l===N.b.FLIP_TILE||l===N.b.ROTATE_TILE||l===N.b.FLIP_N_ROTATE_TILE?I.concat(D[(V+j)%2]):l===N.b.FLIP_ROW||l===N.b.ROTATE_ROW||l===N.b.FLIP_N_ROTATE_ROW?I.concat(D[j%2]):I.concat(D[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(t){const D=[];B=1-n/G,S=0,O=1,s=1,D[0]=[B,S,O,S,O,s,B,s],D[1]=[B,S,O,S,O,s,B,s],l!==N.b.ROTATE_TILE&&l!==N.b.ROTATE_ROW||(D[1]=[1-B,1-S,1-O,1-S,1-O,1-s,1-B,1-s]),l!==N.b.FLIP_TILE&&l!==N.b.FLIP_ROW||(D[1]=[1-B,S,1-O,S,1-O,s,1-B,s]),l!==N.b.FLIP_N_ROTATE_TILE&&l!==N.b.FLIP_N_ROTATE_ROW||(D[1]=[B,1-S,O,1-S,O,1-s,B,1-s]);for(let G=0;G<j;G++)L.push(h+d,G*V-F+H,0),L.push(h+n+d,G*V-F+H,0),L.push(h+n+d,(G+1)*V-F+H,0),L.push(h+d,(G+1)*V-F+H,0),i.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,I=l===N.b.FLIP_TILE||l===N.b.ROTATE_TILE||l===N.b.FLIP_N_ROTATE_TILE?I.concat(D[(G+1)%2]):l===N.b.FLIP_ROW||l===N.b.ROTATE_ROW||l===N.b.FLIP_N_ROTATE_ROW?I.concat(D[G%2]):I.concat(D[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(g){const D=[];B=0,S=0,O=n/V,s=1,D[0]=[B,S,O,S,O,s,B,s],D[1]=[B,S,O,S,O,s,B,s],l!==N.b.ROTATE_TILE&&l!==N.b.ROTATE_ROW||(D[1]=[1-B,1-S,1-O,1-S,1-O,1-s,1-B,1-s]),l!==N.b.FLIP_TILE&&l!==N.b.FLIP_ROW||(D[1]=[1-B,S,1-O,S,1-O,s,1-B,s]),l!==N.b.FLIP_N_ROTATE_TILE&&l!==N.b.FLIP_N_ROTATE_ROW||(D[1]=[B,1-S,O,1-S,O,1-s,B,1-s]);for(let G=0;G<j;G++)L.push(r-n+d,G*V-F+H,0),L.push(r+d,G*V-F+H,0),L.push(r+d,(G+1)*V-F+H,0),L.push(r-n+d,(G+1)*V-F+H,0),i.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,I=l===N.b.FLIP_TILE||l===N.b.ROTATE_TILE||l===N.b.FLIP_N_ROTATE_TILE?I.concat(D[(G+R)%2]):l===N.b.FLIP_ROW||l===N.b.ROTATE_ROW||l===N.b.FLIP_N_ROTATE_ROW?I.concat(D[G%2]):I.concat(D[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),u.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const S=0===D.sideOrientation?0:D.sideOrientation||b.d.DEFAULTSIDE;b.d._ComputeSides(S,L,i,u,I,D.frontUVs,D.backUVs);const O=new b.d;O.indices=i,O.ID=L,O.WD=u,O.yD=I;const s=S===b.d.DOUBLESIDE?W.concat(W):W;return O.iD=s,O}function K(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new N.b(D,G);l.sideOrientation=N.b._GetDefaultSideOrientation(l.sideOrientation),V._originalBuilderSideOrientation=l.sideOrientation;return e(l).OD(V,l.updatable),V}function F(D){const l=D.faceUV||new Array(6),G=D.faceColors,M=D.pattern||N.b.NO_FLIP,t=D.width||D.size||1,R=D.height||D.size||1,n=D.depth||D.size||1,g=D.tileWidth||D.tileSize||1,K=D.tileHeight||D.tileSize||1,F=D.alignHorizontal||0,d=D.alignVertical||0,H=0===D.sideOrientation?0:D.sideOrientation||b.d.DEFAULTSIDE;for(let N=0;N<6;N++)void 0===l[N]&&(l[N]=new V.Vector4(0,0,1,1)),G&&void 0===G[N]&&(G[N]=new j.Wb(1,1,1,1));const h=t/2,x=R/2,r=n/2,o=[];for(let V=0;V<2;V++)o[V]=e({pattern:M,tileWidth:g,tileHeight:K,width:t,height:R,alignVertical:d,alignHorizontal:F,sideOrientation:H});for(let V=2;V<4;V++)o[V]=e({pattern:M,tileWidth:g,tileHeight:K,width:n,height:R,alignVertical:d,alignHorizontal:F,sideOrientation:H});let L=d;d===N.b.BOTTOM?L=N.b.TOP:d===N.b.TOP&&(L=N.b.BOTTOM);for(let V=4;V<6;V++)o[V]=e({pattern:M,tileWidth:g,tileHeight:K,width:t,height:n,alignVertical:L,alignHorizontal:F,sideOrientation:H});let u=[],B=[],I=[],W=[];const i=[],y=[],S=[],O=[];let s=0,U=0;for(let N=0;N<6;N++){const D=o[N].ID.length;y[N]=[],S[N]=[];for(let l=0;l<D/3;l++)y[N].push(new V.Kl(o[N].ID[3*l],o[N].ID[3*l+1],o[N].ID[3*l+2])),S[N].push(new V.Kl(o[N].WD[3*l],o[N].WD[3*l+1],o[N].WD[3*l+2]));s=o[N].yD.length,O[N]=[];for(let G=0;G<s;G+=2)O[N][G]=l[N].x+(l[N].z-l[N].x)*o[N].yD[G],O[N][G+1]=l[N].y+(l[N].w-l[N].y)*o[N].yD[G+1],X.e&&(O[N][G+1]=1-O[N][G+1]);if(I=I.concat(O[N]),W=W.concat(o[N].indices.map((D=>D+U))),U+=y[N].length,G)for(let l=0;l<4;l++)i.push(G[N].r,G[N].g,G[N].b,G[N].a)}const f=new V.Kl(0,0,r),q=V.Matrix.RotationY(Math.PI);u=y[0].map((D=>V.Kl.TransformNormal(D,q).add(f))).map((D=>[D.x,D.y,D.z])).reduce(((D,l)=>D.concat(l)),[]),B=S[0].map((D=>V.Kl.TransformNormal(D,q))).map((D=>[D.x,D.y,D.z])).reduce(((D,l)=>D.concat(l)),[]),u=u.concat(y[1].map((D=>D.Fl(f))).map((D=>[D.x,D.y,D.z])).reduce(((D,l)=>D.concat(l)),[])),B=B.concat(S[1].map((D=>[D.x,D.y,D.z])).reduce(((D,l)=>D.concat(l)),[]));const c=new V.Kl(h,0,0),v=V.Matrix.RotationY(-Math.PI/2);u=u.concat(y[2].map((D=>V.Kl.TransformNormal(D,v).add(c))).map((D=>[D.x,D.y,D.z])).reduce(((D,l)=>D.concat(l)),[])),B=B.concat(S[2].map((D=>V.Kl.TransformNormal(D,v))).map((D=>[D.x,D.y,D.z])).reduce(((D,l)=>D.concat(l)),[]));const Z=V.Matrix.RotationY(Math.PI/2);u=u.concat(y[3].map((D=>V.Kl.TransformNormal(D,Z).Fl(c))).map((D=>[D.x,D.y,D.z])).reduce(((D,l)=>D.concat(l)),[])),B=B.concat(S[3].map((D=>V.Kl.TransformNormal(D,Z))).map((D=>[D.x,D.y,D.z])).reduce(((D,l)=>D.concat(l)),[]));const J=new V.Kl(0,x,0),Y=V.Matrix.RotationX(Math.PI/2);u=u.concat(y[4].map((D=>V.Kl.TransformNormal(D,Y).add(J))).map((D=>[D.x,D.y,D.z])).reduce(((D,l)=>D.concat(l)),[])),B=B.concat(S[4].map((D=>V.Kl.TransformNormal(D,Y))).map((D=>[D.x,D.y,D.z])).reduce(((D,l)=>D.concat(l)),[]));const z=V.Matrix.RotationX(-Math.PI/2);u=u.concat(y[5].map((D=>V.Kl.TransformNormal(D,z).Fl(J))).map((D=>[D.x,D.y,D.z])).reduce(((D,l)=>D.concat(l)),[])),B=B.concat(S[5].map((D=>V.Kl.TransformNormal(D,z))).map((D=>[D.x,D.y,D.z])).reduce(((D,l)=>D.concat(l)),[])),b.d._ComputeSides(H,u,W,B,I);const E=new b.d;if(E.indices=W,E.ID=u,E.WD=B,E.yD=I,G){const D=H===b.d.DOUBLESIDE?i.concat(i):i;E.iD=D}return E}function d(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new N.b(D,G);l.sideOrientation=N.b._GetDefaultSideOrientation(l.sideOrientation),V._originalBuilderSideOrientation=l.sideOrientation;return F(l).OD(V,l.updatable),V}b.d.CreateTiledPlane=e;b.d.CreateTiledBox=F;var H=G(13099),h=G(11963),x=G(11915);function r(D){const l=D.height||2;let G=0===D.diameterTop?0:D.diameterTop||D.diameter||1,M=0===D.diameterBottom?0:D.diameterBottom||D.diameter||1;G=G||1e-5,M=M||1e-5;const t=0|(D.tessellation||24),R=0|(D.subdivisions||1),n=!!D.hasRings,g=!!D.enclose,e=0===D.cap?0:D.cap||N.b.CAP_ALL,K=D.arc&&(D.arc<=0||D.arc>1)?1:D.arc||1,F=0===D.sideOrientation?0:D.sideOrientation||b.d.DEFAULTSIDE,d=D.faceUV||new Array(3),H=D.faceColors,h=2+(1+(1!==K&&g?2:0))*(n?R:1);let r;for(r=0;r<h;r++)H&&void 0===H[r]&&(H[r]=new j.Wb(1,1,1,1));for(r=0;r<h;r++)d&&void 0===d[r]&&(d[r]=new V.Vector4(0,0,1,1));const o=[],L=[],u=[],B=[],I=[],W=2*Math.PI*K/t;let i,y,S;const O=(M-G)/2/l,s=V.Kl.Zero(),U=V.Kl.Zero(),f=V.Kl.Zero(),q=V.Kl.Zero(),c=V.Kl.Zero(),v=x.b.Y;let Z,J,Y,z=1,E=1,P=0,p=0;for(Z=0;Z<=R;Z++)for(y=Z/R,S=(y*(G-M)+M)/2,z=n&&0!==Z&&Z!==R?2:1,Y=0;Y<z;Y++){for(n&&(E+=Y),g&&(E+=2*Y),J=0;J<=t;J++)i=J*W,s.x=Math.cos(-i)*S,s.y=-l/2+y*l,s.z=Math.sin(-i)*S,0===G&&Z===R?(U.x=u[u.length-3*(t+1)],U.y=u[u.length-3*(t+1)+1],U.z=u[u.length-3*(t+1)+2]):(U.x=s.x,U.z=s.z,U.y=Math.sqrt(U.x*U.x+U.z*U.z)*O,U.normalize()),0===J&&(f.V(s),q.V(U)),L.push(s.x,s.y,s.z),u.push(U.x,U.y,U.z),p=n?P!==E?d[E].y:d[E].w:d[E].y+(d[E].w-d[E].y)*y,B.push(d[E].x+(d[E].z-d[E].x)*J/t,X.e?1-p:p),H&&I.push(H[E].r,H[E].g,H[E].b,H[E].a);1!==K&&g&&(L.push(s.x,s.y,s.z),L.push(0,s.y,0),L.push(0,s.y,0),L.push(f.x,f.y,f.z),V.Kl.CrossToRef(v,U,c),c.normalize(),u.push(c.x,c.y,c.z,c.x,c.y,c.z),V.Kl.CrossToRef(q,v,c),c.normalize(),u.push(c.x,c.y,c.z,c.x,c.y,c.z),p=n?P!==E?d[E+1].y:d[E+1].w:d[E+1].y+(d[E+1].w-d[E+1].y)*y,B.push(d[E+1].x,X.e?1-p:p),B.push(d[E+1].z,X.e?1-p:p),p=n?P!==E?d[E+2].y:d[E+2].w:d[E+2].y+(d[E+2].w-d[E+2].y)*y,B.push(d[E+2].x,X.e?1-p:p),B.push(d[E+2].z,X.e?1-p:p),H&&(I.push(H[E+1].r,H[E+1].g,H[E+1].b,H[E+1].a),I.push(H[E+1].r,H[E+1].g,H[E+1].b,H[E+1].a),I.push(H[E+2].r,H[E+2].g,H[E+2].b,H[E+2].a),I.push(H[E+2].r,H[E+2].g,H[E+2].b,H[E+2].a))),P!==E&&(P=E)}const k=1!==K&&g?t+4:t;for(Z=0,E=0;E<R;E++){let D=0,l=0,G=0,V=0;for(J=0;J<t;J++)D=Z*(k+1)+J,l=(Z+1)*(k+1)+J,G=Z*(k+1)+(J+1),V=(Z+1)*(k+1)+(J+1),o.push(D,l,G),o.push(V,G,l);1!==K&&g&&(o.push(D+2,l+2,G+2),o.push(V+2,G+2,l+2),o.push(D+4,l+4,G+4),o.push(V+4,G+4,l+4)),Z=n?Z+2:Z+1}const m=D=>{const N=D?G/2:M/2;if(0===N)return;let b,R,n;const g=D?d[h-1]:d[0];let j=null;H&&(j=D?H[h-1]:H[0]);const e=L.length/3,F=D?l/2:-l/2,x=new V.Kl(0,F,0);L.push(x.x,x.y,x.z),u.push(0,D?1:-1,0);const r=g.y+.5*(g.w-g.y);B.push(g.x+.5*(g.z-g.x),X.e?1-r:r),j&&I.push(j.r,j.g,j.b,j.a);const W=new V.Vector2(.5,.5);for(n=0;n<=t;n++){b=2*Math.PI*n*K/t;const l=Math.cos(-b),G=Math.sin(-b);R=new V.Kl(l*N,F,G*N);const M=new V.Vector2(l*W.x+.5,G*W.y+.5);L.push(R.x,R.y,R.z),u.push(0,D?1:-1,0);const e=g.y+(g.w-g.y)*M.y;B.push(g.x+(g.z-g.x)*M.x,X.e?1-e:e),j&&I.push(j.r,j.g,j.b,j.a)}for(n=0;n<t;n++)D?(o.push(e),o.push(e+(n+2)),o.push(e+(n+1))):(o.push(e),o.push(e+(n+1)),o.push(e+(n+2)))};e!==N.b.CAP_START&&e!==N.b.CAP_ALL||m(!1),e!==N.b.CAP_END&&e!==N.b.CAP_ALL||m(!0),b.d._ComputeSides(F,L,o,u,B,D.frontUVs,D.backUVs);const T=new b.d;return T.indices=o,T.ID=L,T.WD=u,T.yD=B,H&&(T.iD=I),T}function o(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;const V=new N.b(D,G);l.sideOrientation=N.b._GetDefaultSideOrientation(l.sideOrientation),V._originalBuilderSideOrientation=l.sideOrientation;return r(l).OD(V,l.updatable),V}function L(D){const l=[],G=[],N=[],M=[],t=D.diameter||1,R=D.thickness||.5,n=0|(D.tessellation||16),g=0===D.sideOrientation?0:D.sideOrientation||b.d.DEFAULTSIDE,j=n+1;for(let b=0;b<=n;b++){const D=b/n,g=b*Math.PI*2/n-Math.PI/2,e=V.Matrix.Translation(t/2,0,0).multiply(V.Matrix.RotationY(g));for(let t=0;t<=n;t++){const g=1-t/n,K=t*Math.PI*2/n+Math.PI,F=Math.cos(K),d=Math.sin(K);let H=new V.Kl(F,d,0),h=H.scale(R/2);const x=new V.Vector2(D,g);h=V.Kl.TransformCoordinates(h,e),H=V.Kl.TransformNormal(H,e),G.push(h.x,h.y,h.z),N.push(H.x,H.y,H.z),M.push(x.x,X.e?1-x.y:x.y);const r=(b+1)%j,o=(t+1)%j;l.push(b*j+t),l.push(b*j+o),l.push(r*j+t),l.push(b*j+o),l.push(r*j+o),l.push(r*j+t)}}b.d._ComputeSides(g,G,l,N,M,D.frontUVs,D.backUVs);const e=new b.d;return e.indices=l,e.ID=G,e.WD=N,e.yD=M,e}function u(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;const V=new N.b(D,G);l.sideOrientation=N.b._GetDefaultSideOrientation(l.sideOrientation),V._originalBuilderSideOrientation=l.sideOrientation;return L(l).OD(V,l.updatable),V}b.d.CreateCylinder=r,N.b.CreateCylinder=(D,l,G,V,M,b,X,t,R)=>{void 0!==X&&X instanceof h.b||(void 0!==X&&(R=t||N.b.DEFAULTSIDE,t=X),X=b,b=1);return o(D,{height:l,diameterTop:G,diameterBottom:V,tessellation:M,subdivisions:b,sideOrientation:R,updatable:t},X)};function B(D){const l=[],G=[],N=[],M=[],t=D.radius||2,R=D.tube||.5,n=D.radialSegments||32,g=D.tubularSegments||32,j=D.p||2,e=D.q||3,K=0===D.sideOrientation?0:D.sideOrientation||b.d.DEFAULTSIDE,F=D=>{const l=Math.cos(D),G=Math.sin(D),N=e/j*D,M=Math.cos(N),b=t*(2+M)*.5*l,X=t*(2+M)*G*.5,R=t*Math.sin(N)*.5;return new V.Kl(b,X,R)};let d,H;for(d=0;d<=n;d++){const D=d%n/n*2*j*Math.PI,l=F(D),N=F(D+.01),b=N.Fl(l);let t=N.add(l);const e=V.Kl.Cross(b,t);for(t=V.Kl.Cross(e,b),e.normalize(),t.normalize(),H=0;H<g;H++){const D=H%g/g*2*Math.PI,V=-R*Math.cos(D),N=R*Math.sin(D);G.push(l.x+V*t.x+N*e.x),G.push(l.y+V*t.y+N*e.y),G.push(l.z+V*t.z+N*e.z),M.push(d/n),M.push(X.e?1-H/g:H/g)}}for(d=0;d<n;d++)for(H=0;H<g;H++){const D=(H+1)%g,G=d*g+H,V=(d+1)*g+H,N=(d+1)*g+D,M=d*g+D;l.push(M),l.push(V),l.push(G),l.push(M),l.push(N),l.push(V)}b.d.ComputeNormals(G,l,N),b.d._ComputeSides(K,G,l,N,M,D.frontUVs,D.backUVs);const h=new b.d;return h.indices=l,h.ID=G,h.WD=N,h.yD=M,h}function I(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2?arguments[2]:void 0;const V=new N.b(D,G);l.sideOrientation=N.b._GetDefaultSideOrientation(l.sideOrientation),V._originalBuilderSideOrientation=l.sideOrientation;return B(l).OD(V,l.updatable),V}b.d.CreateTorus=L,N.b.CreateTorus=(D,l,G,V,N,M,b)=>u(D,{diameter:l,thickness:G,tessellation:V,sideOrientation:b,updatable:M},N);b.d.CreateTorusKnot=B,N.b.CreateTorusKnot=(D,l,G,V,N,M,b,X,t,R)=>I(D,{radius:l,tube:G,radialSegments:V,tubularSegments:N,p:M,q:b,sideOrientation:R,updatable:t},X);var W=G(13577),i=G(12277),y=G(11925);function S(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=l.path,M=l.shape,b=l.scale||1,X=l.rotation||0,t=0===l.cap?0:l.cap||N.b.NO_CAP,R=l.updatable,n=N.b._GetDefaultSideOrientation(l.sideOrientation),g=l.instance||null,j=l.invertUV||!1,e=l.closeShape||!1,K=l.closePath||!1,F=l.capFunction||null;return s(D,M,V,b,X,null,null,K,e,t,!1,G,!!R,n,g,j,l.frontUVs||null,l.backUVs||null,l.firstNormal||null,!!l.adjustFrame,F)}function O(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=l.path,M=l.shape,b=l.scaleFunction||(()=>1),X=l.rotationFunction||(()=>0),t=l.closePath||l.ribbonCloseArray||!1,R=l.closeShape||l.ribbonClosePath||!1,n=0===l.cap?0:l.cap||N.b.NO_CAP,g=l.updatable,j=l.firstNormal||null,e=l.adjustFrame||!1,K=N.b._GetDefaultSideOrientation(l.sideOrientation),F=l.instance,d=l.invertUV||!1,H=l.capFunction||null;return s(D,M,V,null,null,b,X,t,R,n,!0,G,!!g,K,F||null,d,l.frontUVs||null,l.backUVs||null,j,e,H||null)}function s(D,l,G,M,b,X,t,n,g,j,e,K,F,d,H,h,x,r,o,L,u){const B=(D,l,G,M,b,X,t,R,n,g,j)=>{const e=G.getTangents(),K=G.getNormals(),F=G.getBinormals(),d=G.getDistances();if(j)for(let N=0;N<e.length;N++)if(0==e[N].x&&0==e[N].y&&0==e[N].z&&e[N].V(e[N-1]),0==K[N].x&&0==K[N].y&&0==K[N].z&&K[N].V(K[N-1]),0==F[N].x&&0==F[N].y&&0==F[N].z&&F[N].V(F[N-1]),N>0){let D=e[N-1];V.Kl.Dot(D,e[N])<0&&e[N].scaleInPlace(-1),D=K[N-1],V.Kl.Dot(D,K[N])<0&&K[N].scaleInPlace(-1),D=F[N-1],V.Kl.Dot(D,F[N])<0&&F[N].scaleInPlace(-1)}let H=0;const h=g&&R?R:()=>null!==X?X:0,x=g&&t?t:()=>null!==b?b:1;let r=n===N.b.NO_CAP||n===N.b.CAP_END?0:2;const o=V.TmpVectors.Matrix[0];for(let N=0;N<l.length;N++){const G=[],b=h(N,d[N]),X=x(N,d[N]);V.Matrix.RotationAxisToRef(e[N],H,o);for(let M=0;M<D.length;M++){const b=e[N].scale(D[M].z).add(K[N].scale(D[M].x)).add(F[N].scale(D[M].y)),t=V.Kl.Zero();V.Kl.TransformCoordinatesToRef(b,o,t),t.scaleInPlace(X).addInPlace(l[N]),G[M]=t}M[r]=G,H+=b,r++}const L=u||(D=>{const l=Array(),G=V.Kl.Zero();let N;for(N=0;N<D.length;N++)G.addInPlace(D[N]);for(G.scaleInPlace(1/D.length),N=0;N<D.length;N++)l.push(G);return l});switch(n){case N.b.NO_CAP:break;case N.b.CAP_START:M[0]=L(M[2]),M[1]=M[2];break;case N.b.CAP_END:M[r]=M[r-1],M[r+1]=L(M[r-1]);break;case N.b.CAP_ALL:M[0]=L(M[2]),M[1]=M[2],M[r]=M[r-1],M[r+1]=L(M[r-1])}return M};let I,W;if(H){const D=H._creationDataStorage;return I=o?D.path3D.update(G,o):D.path3D.update(G),W=B(l,G,D.path3D,D.pathArray,M,b,X,t,D.cap,e,L),H=R("",{pathArray:W,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:H},K||void 0)}I=o?new y.j(G,o):new y.j(G);W=B(l,G,I,new Array,M,b,X,t,j=j<0||j>3?0:j,e,L);const i=R(D,{pathArray:W,closeArray:n,closePath:g,updatable:F,sideOrientation:d,invertUV:h,frontUVs:x||void 0,backUVs:r||void 0},K);return i._creationDataStorage.pathArray=W,i._creationDataStorage.path3D=I,i._creationDataStorage.cap=j,i}function U(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=l.arc?l.arc<=0||l.arc>1?1:l.arc:1,b=void 0===l.closed||l.closed,X=l.shape,t=l.radius||1,n=l.tessellation||64,g=l.clip||0,j=l.updatable,e=N.b._GetDefaultSideOrientation(l.sideOrientation),K=l.cap||N.b.NO_CAP,F=2*Math.PI,d=[],H=l.invertUV||!1;let h=0,x=0;const r=F/n*M;let o,L;for(h=0;h<=n-g;h++){for(L=[],K!=N.b.CAP_START&&K!=N.b.CAP_ALL||(L.push(new V.Kl(0,X[0].y,0)),L.push(new V.Kl(Math.cos(h*r)*X[0].x*t,X[0].y,Math.sin(h*r)*X[0].x*t))),x=0;x<X.length;x++)o=new V.Kl(Math.cos(h*r)*X[x].x*t,X[x].y,Math.sin(h*r)*X[x].x*t),L.push(o);K!=N.b.CAP_END&&K!=N.b.CAP_ALL||(L.push(new V.Kl(Math.cos(h*r)*X[X.length-1].x*t,X[X.length-1].y,Math.sin(h*r)*X[X.length-1].x*t)),L.push(new V.Kl(0,X[X.length-1].y,0))),d.push(L)}return R(D,{pathArray:d,closeArray:b,sideOrientation:e,updatable:j,invertUV:H,frontUVs:l.frontUVs,backUVs:l.backUVs},G)}N.b.ExtrudeShape=function(D,l,G,V,M,b){let X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7?arguments[7]:void 0,R=arguments.length>8?arguments[8]:void 0,n=arguments.length>9?arguments[9]:void 0;return S(D,{shape:l,path:G,scale:V,rotation:M,cap:0===b?0:b||N.b.NO_CAP,sideOrientation:R,instance:n,updatable:t},X)},N.b.ExtrudeShapeCustom=(D,l,G,V,M,b,X,t,R,n,g,j)=>O(D,{shape:l,path:G,scaleFunction:V,rotationFunction:M,ribbonCloseArray:b,ribbonClosePath:X,cap:0===t?0:t||N.b.NO_CAP,sideOrientation:g,instance:j,updatable:n},R);N.b.CreateLathe=(D,l,G,V,N,M,b)=>U(D,{shape:l,radius:G,tessellation:V,sideOrientation:b,updatable:M},N);var f=G(12999),q=G(12960);function c(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=l.path;let b=l.instance,X=1;void 0!==l.radius?X=l.radius:b&&(X=b._creationDataStorage.radius);const t=l.tessellation||64,n=l.radiusFunction||null;let g=l.cap||N.b.NO_CAP;const j=l.invertUV||!1,e=l.updatable,K=N.b._GetDefaultSideOrientation(l.sideOrientation);l.arc=l.arc&&(l.arc<=0||l.arc>1)?1:l.arc||1;const F=(D,l,G,M,b,X,t,R)=>{const n=l.getTangents(),g=l.getNormals(),j=l.getDistances(),e=2*Math.PI/b*R,K=X||(()=>M);let F,d,H,h;const x=V.TmpVectors.Matrix[0];let r=t===N.b.NO_CAP||t===N.b.CAP_END?0:2;for(let N=0;N<D.length;N++){d=K(N,j[N]),F=Array(),H=g[N];for(let l=0;l<b;l++)V.Matrix.RotationAxisToRef(n[N],e*l,x),h=F[l]?F[l]:V.Kl.Zero(),V.Kl.TransformCoordinatesToRef(H,x,h),h.scaleInPlace(d).addInPlace(D[N]),F[l]=h;G[r]=F,r++}const o=(l,G)=>{const V=Array();for(let N=0;N<l;N++)V.push(D[G]);return V};switch(t){case N.b.NO_CAP:break;case N.b.CAP_START:G[0]=o(b,0),G[1]=G[2].slice(0);break;case N.b.CAP_END:G[r]=G[r-1].slice(0),G[r+1]=o(b,D.length-1);break;case N.b.CAP_ALL:G[0]=o(b,0),G[1]=G[2].slice(0),G[r]=G[r-1].slice(0),G[r+1]=o(b,D.length-1)}return G};let d,H;if(b){const D=b._creationDataStorage,G=l.arc||D.arc;return d=D.path3D.update(M),H=F(M,d,D.pathArray,X,D.tessellation,n,D.cap,G),b=R("",{pathArray:H,instance:b}),D.path3D=d,D.pathArray=H,D.arc=G,D.radius=X,b}d=new y.j(M);g=g<0||g>3?0:g,H=F(M,d,new Array,X,t,n,g,l.arc);const h=R(D,{pathArray:H,closePath:!0,closeArray:!1,updatable:e,sideOrientation:K,invertUV:j,frontUVs:l.frontUVs,backUVs:l.backUVs},G);return h._creationDataStorage.pathArray=H,h._creationDataStorage.path3D=d,h._creationDataStorage.tessellation=t,h._creationDataStorage.cap=g,h._creationDataStorage.arc=l.arc,h._creationDataStorage.radius=X,h}function v(D){const l=[];l[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},l[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},l[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},l[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},l[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},l[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},l[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},l[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},l[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},l[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},l[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},l[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},l[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},l[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},l[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const G=D.type&&(D.type<0||D.type>=l.length)?0:D.type||0,N=D.size,M=D.sizeX||N||1,t=D.sizeY||N||1,R=D.sizeZ||N||1,n=D.custom||l[G],g=n.face.length,e=D.faceUV||new Array(g),K=D.faceColors,F=void 0===D.flat||D.flat,d=0===D.sideOrientation?0:D.sideOrientation||b.d.DEFAULTSIDE,H=[],h=[],x=[],r=[],o=[];let L=0,u=0;const B=[];let I,W,i,y,S,O,s=0,U=0;if(F)for(U=0;U<g;U++)K&&void 0===K[U]&&(K[U]=new j.Wb(1,1,1,1)),e&&void 0===e[U]&&(e[U]=new V.Vector4(0,0,1,1));if(F)for(U=0;U<g;U++){const D=n.face[U].length;for(i=2*Math.PI/D,y=.5*Math.tan(i/2),S=.5,s=0;s<D;s++)H.push(n.vertex[n.face[U][s]][0]*M,n.vertex[n.face[U][s]][1]*t,n.vertex[n.face[U][s]][2]*R),B.push(L),L++,I=e[U].x+(e[U].z-e[U].x)*(.5+y),W=e[U].y+(e[U].w-e[U].y)*(S-.5),r.push(I,X.e?1-W:W),O=y*Math.cos(i)-S*Math.sin(i),S=y*Math.sin(i)+S*Math.cos(i),y=O,K&&o.push(K[U].r,K[U].g,K[U].b,K[U].a);for(s=0;s<D-2;s++)h.push(B[0+u],B[s+2+u],B[s+1+u]);u+=D}else{for(s=0;s<n.vertex.length;s++)H.push(n.vertex[s][0]*M,n.vertex[s][1]*t,n.vertex[s][2]*R),r.push(0,X.e?1:0);for(U=0;U<g;U++)for(s=0;s<n.face[U].length-2;s++)h.push(n.face[U][0],n.face[U][s+2],n.face[U][s+1])}b.d.ComputeNormals(H,h,x),b.d._ComputeSides(d,H,h,x,r,D.frontUVs,D.backUVs);const f=new b.d;return f.ID=H,f.indices=h,f.WD=x,f.yD=r,K&&F&&(f.iD=o),f}function Z(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new N.b(D,G);l.sideOrientation=N.b._GetDefaultSideOrientation(l.sideOrientation),V._originalBuilderSideOrientation=l.sideOrientation;return v(l).OD(V,l.updatable),V}N.b.CreateTube=(D,l,G,V,N,M,b,X,t,R)=>c(D,{path:l,radius:G,tessellation:V,radiusFunction:N,arc:1,cap:M,updatable:X,sideOrientation:t,instance:R},b);function J(D){const l=D.sideOrientation||b.d.DEFAULTSIDE,G=D.radius||1,N=void 0===D.flat||D.flat,M=0|(D.subdivisions||4),t=D.radiusX||G,R=D.radiusY||G,n=D.radiusZ||G,g=(1+Math.sqrt(5))/2,j=[-1,g,-0,1,g,0,-1,-g,0,1,-g,0,0,-1,-g,0,1,-g,0,-1,g,0,1,g,g,0,1,g,0,-1,-g,0,1,-g,0,-1],e=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],K=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],F=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],d=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],H=[],h=[],x=[],r=[];let o=0;const L=new Array(3),u=new Array(3);let B;for(B=0;B<3;B++)L[B]=V.Kl.Zero(),u[B]=V.Vector2.Zero();for(let b=0;b<20;b++){for(B=0;B<3;B++){const D=e[3*b+B];L[B].Lb(j[3*K[D]],j[3*K[D]+1],j[3*K[D]+2]),L[B].normalize(),u[B].Lb(.134765625*F[2*D]+.05859375+-.0390625*d[b],.2333984375*F[2*D+1]+.025390625+.01953125*d[b])}const D=(D,l,G,b)=>{const g=V.Kl.Lerp(L[0],L[2],l/M),j=V.Kl.Lerp(L[1],L[2],l/M),e=M===l?L[2]:V.Kl.Lerp(g,j,D/(M-l));let K;if(e.normalize(),N){const D=V.Kl.Lerp(L[0],L[2],b/M),l=V.Kl.Lerp(L[1],L[2],b/M);K=V.Kl.Lerp(D,l,G/(M-b))}else K=new V.Kl(e.x,e.y,e.z);K.x/=t,K.y/=R,K.z/=n,K.normalize();const F=V.Vector2.Lerp(u[0],u[2],l/M),d=V.Vector2.Lerp(u[1],u[2],l/M),B=M===l?u[2]:V.Vector2.Lerp(F,d,D/(M-l));h.push(e.x*t,e.y*R,e.z*n),x.push(K.x,K.y,K.z),r.push(B.x,X.e?1-B.y:B.y),H.push(o),o++};for(let l=0;l<M;l++)for(let G=0;G+l<M;G++)D(G,l,G+1/3,l+1/3),D(G+1,l,G+1/3,l+1/3),D(G,l+1,G+1/3,l+1/3),G+l+1<M&&(D(G+1,l,G+2/3,l+2/3),D(G+1,l+1,G+2/3,l+2/3),D(G,l+1,G+2/3,l+2/3))}b.d._ComputeSides(l,h,H,x,r,D.frontUVs,D.backUVs);const I=new b.d;return I.indices=H,I.ID=h,I.WD=x,I.yD=r,I}function Y(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new N.b(D,G);l.sideOrientation=N.b._GetDefaultSideOrientation(l.sideOrientation),V._originalBuilderSideOrientation=l.sideOrientation;return J(l).OD(V,l.updatable),V}b.d.CreatePolyhedron=v,N.b.CreatePolyhedron=(D,l,G)=>Z(D,l,G);b.d.CreateIcoSphere=J,N.b.CreateIcoSphere=(D,l,G)=>Y(D,l,G);var z=G(11728);const E=new V.Kl(1,0,0),P=new V.Kl(-1,0,0),p=new V.Kl(0,1,0),k=new V.Kl(0,-1,0),m=new V.Kl(0,0,1),T=new V.Kl(0,0,-1);class C{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.Kl.Zero(),l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V.Kl.Up(),G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V.Vector2.Zero(),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=D,this.normal=l,this.uv=G,this.vertexIdx=N,this.vertexIdxForBones=M,this.localPositionOverride=b,this.localNormalOverride=X,this.matrixIndicesOverride=t,this.matrixWeightsOverride=R}clone(){var D,l,G,V;return new C(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(D=this.localPositionOverride)||void 0===D?void 0:D.slice(),null===(l=this.localNormalOverride)||void 0===l?void 0:l.slice(),null===(G=this.matrixIndicesOverride)||void 0===G?void 0:G.slice(),null===(V=this.matrixWeightsOverride)||void 0===V?void 0:V.slice())}}function w(D,l,G){var t,R,n,g,j;const e=!!l.skeleton,K=!(null===(t=l.morphTargetManager)||void 0===t||!t.numTargets),F=G.localMode||e,d=l.rb(),H=e||K?l.pX(!0,!0):l.getVerticesData(M.e.PositionKind),h=e||K?l.getNormalsData(!0,!0):l.getVerticesData(M.e.NormalKind),x=F?e?l.getVerticesData(M.e.PositionKind):H:null,r=F?e?l.getVerticesData(M.e.NormalKind):h:null,o=l.getVerticesData(M.e.UVKind),L=e?l.getVerticesData(M.e.MatricesIndicesKind):null,u=e?l.getVerticesData(M.e.MatricesWeightsKind):null,B=e?l.getVerticesData(M.e.MatricesIndicesExtraKind):null,I=e?l.getVerticesData(M.e.MatricesWeightsExtraKind):null,W=G.position||V.Kl.Zero();let i=G.normal||V.Kl.Up();const y=G.size||V.Kl.One(),S=G.angle||0;if(!i){const D=new V.Kl(0,0,1),G=l.uD().activeCamera,N=V.Kl.TransformCoordinates(D,G.getWorldMatrix());i=G.globalPosition.Fl(N)}const O=-Math.atan2(i.z,i.x)-Math.PI/2,s=Math.sqrt(i.x*i.x+i.z*i.z),U=Math.atan2(i.y,s),f=new b.d;f.indices=[],f.ID=[],f.WD=[],f.yD=[],f.matricesIndices=e?[]:null,f.matricesWeights=e?[]:null,f.matricesIndicesExtra=B?[]:null,f.matricesWeightsExtra=I?[]:null;let q=0;const c=(D,l)=>{const N=new C;if(!d||!H||!h)return N;const M=d[D];if(N.vertexIdx=3*M,N.vertexIdxForBones=4*M,N.position=new V.Kl(H[3*M],H[3*M+1],H[3*M+2]),V.Kl.TransformCoordinatesToRef(N.position,l,N.position),N.normal=new V.Kl(h[3*M],h[3*M+1],h[3*M+2]),V.Kl.TransformNormalToRef(N.normal,l,N.normal),G.captureUVS&&o){const D=o[2*M+1];N.uv=new V.Vector2(o[2*M],X.e?1-D:D)}return N},v=[0,0,0,0],Z=(D,l)=>{if(0===D.length)return D;const G=.5*Math.abs(V.Kl.Dot(y,l)),N=(D,l,G,V)=>{for(let N=0;N<V;++N)if(D[G+N]===l)return G+N;return-1},M=(D,M)=>{const b=V.Kl.GetClipFactor(D.position,M.position,l,G);let X=v,t=v;if(L&&u){const l=D.matrixIndicesOverride?0:D.vertexIdxForBones,G=D.matrixIndicesOverride??L,V=D.matrixWeightsOverride??u,R=M.matrixIndicesOverride?0:M.vertexIdxForBones,n=M.matrixIndicesOverride??L,g=M.matrixWeightsOverride??u;X=[0,0,0,0],t=[0,0,0,0];let j=0;for(let D=0;D<4;++D)if(V[l+D]>0){const M=N(n,G[l+D],R,4);X[j]=G[l+D],t[j]=(0,z.Lerp)(V[l+D],M>=0?g[M]:0,b),j++}for(let D=0;D<4&&j<4;++D){const V=n[R+D];-1===N(G,V,l,4)&&(X[j]=V,t[j]=(0,z.Lerp)(0,g[R+D],b),j++)}const e=t[0]+t[1]+t[2]+t[3];t[0]/=e,t[1]/=e,t[2]/=e,t[3]/=e}const R=D.localPositionOverride?D.localPositionOverride[0]:(null===x||void 0===x?void 0:x[D.vertexIdx])??0,n=D.localPositionOverride?D.localPositionOverride[1]:(null===x||void 0===x?void 0:x[D.vertexIdx+1])??0,g=D.localPositionOverride?D.localPositionOverride[2]:(null===x||void 0===x?void 0:x[D.vertexIdx+2])??0,j=M.localPositionOverride?M.localPositionOverride[0]:(null===x||void 0===x?void 0:x[M.vertexIdx])??0,e=M.localPositionOverride?M.localPositionOverride[1]:(null===x||void 0===x?void 0:x[M.vertexIdx+1])??0,K=M.localPositionOverride?M.localPositionOverride[2]:(null===x||void 0===x?void 0:x[M.vertexIdx+2])??0,F=D.localNormalOverride?D.localNormalOverride[0]:(null===r||void 0===r?void 0:r[D.vertexIdx])??0,d=D.localNormalOverride?D.localNormalOverride[1]:(null===r||void 0===r?void 0:r[D.vertexIdx+1])??0,H=D.localNormalOverride?D.localNormalOverride[2]:(null===r||void 0===r?void 0:r[D.vertexIdx+2])??0,h=F+((M.localNormalOverride?M.localNormalOverride[0]:(null===r||void 0===r?void 0:r[M.vertexIdx])??0)-F)*b,o=d+((M.localNormalOverride?M.localNormalOverride[1]:(null===r||void 0===r?void 0:r[M.vertexIdx+1])??0)-d)*b,B=H+((M.localNormalOverride?M.localNormalOverride[2]:(null===r||void 0===r?void 0:r[M.vertexIdx+2])??0)-H)*b,I=Math.sqrt(h*h+o*o+B*B);return new C(V.Kl.Lerp(D.position,M.position,b),V.Kl.Lerp(D.normal,M.normal,b).normalize(),V.Vector2.Lerp(D.uv,M.uv,b),-1,-1,x?[R+(j-R)*b,n+(e-n)*b,g+(K-g)*b]:null,r?[h/I,o/I,B/I]:null,X,t)};let b=null;D.length>3&&(b=[]);for(let X=0;X<D.length;X+=3){let N=0,t=null,R=null,n=null,g=null;const j=V.Kl.Dot(D[X].position,l)-G>0,e=V.Kl.Dot(D[X+1].position,l)-G>0,K=V.Kl.Dot(D[X+2].position,l)-G>0;switch(N=(j?1:0)+(e?1:0)+(K?1:0),N){case 0:D.length>3?(b.push(D[X]),b.push(D[X+1]),b.push(D[X+2])):b=D;break;case 1:if(b=b??new Array,j&&(t=D[X+1],R=D[X+2],n=M(D[X],t),g=M(D[X],R)),e){t=D[X],R=D[X+2],n=M(D[X+1],t),g=M(D[X+1],R),b.push(n),b.push(R.clone()),b.push(t.clone()),b.push(R.clone()),b.push(n.clone()),b.push(g);break}K&&(t=D[X],R=D[X+1],n=M(D[X+2],t),g=M(D[X+2],R)),t&&R&&n&&g&&(b.push(t.clone()),b.push(R.clone()),b.push(n),b.push(g),b.push(n.clone()),b.push(R.clone()));break;case 2:b=b??new Array,j||(t=D[X].clone(),R=M(t,D[X+1]),n=M(t,D[X+2]),b.push(t),b.push(R),b.push(n)),e||(t=D[X+1].clone(),R=M(t,D[X+2]),n=M(t,D[X]),b.push(t),b.push(R),b.push(n)),K||(t=D[X+2].clone(),R=M(t,D[X]),n=M(t,D[X+1]),b.push(t),b.push(R),b.push(n))}}return b},J=l instanceof N.b?l:null,Y=null===J||void 0===J?void 0:J._thinInstanceDataStorage.matrixData,w=(null===J||void 0===J?void 0:J.yb)||1,A=V.TmpVectors.Matrix[0];A.V(V.Matrix.IdentityReadOnly);for(let N=0;N<w;++N){if(null!==J&&void 0!==J&&J.hasThinInstances&&Y){const D=16*N;A.setRowFromFloats(0,Y[D+0],Y[D+1],Y[D+2],Y[D+3]),A.setRowFromFloats(1,Y[D+4],Y[D+5],Y[D+6],Y[D+7]),A.setRowFromFloats(2,Y[D+8],Y[D+9],Y[D+10],Y[D+11]),A.setRowFromFloats(3,Y[D+12],Y[D+13],Y[D+14],Y[D+15])}const D=V.Matrix.RotationYawPitchRoll(O,U,S).multiply(V.Matrix.Translation(W.x,W.y,W.z)),M=V.Matrix.Invert(D),b=l.getWorldMatrix(),t=A.multiply(b).multiply(M),R=new Array(3);for(let l=0;l<d.length;l+=3){let D=R;if(D[0]=c(l,t),D[1]=c(l+1,t),D[2]=c(l+2,t),!(G.cullBackFaces&&-D[0].normal.z<=0&&-D[1].normal.z<=0&&-D[2].normal.z<=0)&&(D=Z(D,E),D&&(D=Z(D,P),D&&(D=Z(D,p),D&&(D=Z(D,k),D&&(D=Z(D,m),D&&(D=Z(D,T),D)))))))for(let l=0;l<D.length;l++){const V=D[l];if(f.indices.push(q),F?(V.localPositionOverride?(f.ID[3*q]=V.localPositionOverride[0],f.ID[3*q+1]=V.localPositionOverride[1],f.ID[3*q+2]=V.localPositionOverride[2]):x&&(f.ID[3*q]=x[V.vertexIdx],f.ID[3*q+1]=x[V.vertexIdx+1],f.ID[3*q+2]=x[V.vertexIdx+2]),V.localNormalOverride?(f.WD[3*q]=V.localNormalOverride[0],f.WD[3*q+1]=V.localNormalOverride[1],f.WD[3*q+2]=V.localNormalOverride[2]):r&&(f.WD[3*q]=r[V.vertexIdx],f.WD[3*q+1]=r[V.vertexIdx+1],f.WD[3*q+2]=r[V.vertexIdx+2])):(V.position.toArray(f.ID,3*q),V.normal.toArray(f.WD,3*q)),f.matricesIndices&&f.matricesWeights&&(V.matrixIndicesOverride?(f.matricesIndices[4*q]=V.matrixIndicesOverride[0],f.matricesIndices[4*q+1]=V.matrixIndicesOverride[1],f.matricesIndices[4*q+2]=V.matrixIndicesOverride[2],f.matricesIndices[4*q+3]=V.matrixIndicesOverride[3]):(L&&(f.matricesIndices[4*q]=L[V.vertexIdxForBones],f.matricesIndices[4*q+1]=L[V.vertexIdxForBones+1],f.matricesIndices[4*q+2]=L[V.vertexIdxForBones+2],f.matricesIndices[4*q+3]=L[V.vertexIdxForBones+3]),B&&f.matricesIndicesExtra&&(f.matricesIndicesExtra[4*q]=B[V.vertexIdxForBones],f.matricesIndicesExtra[4*q+1]=B[V.vertexIdxForBones+1],f.matricesIndicesExtra[4*q+2]=B[V.vertexIdxForBones+2],f.matricesIndicesExtra[4*q+3]=B[V.vertexIdxForBones+3])),V.matrixWeightsOverride?(f.matricesWeights[4*q]=V.matrixWeightsOverride[0],f.matricesWeights[4*q+1]=V.matrixWeightsOverride[1],f.matricesWeights[4*q+2]=V.matrixWeightsOverride[2],f.matricesWeights[4*q+3]=V.matrixWeightsOverride[3]):(u&&(f.matricesWeights[4*q]=u[V.vertexIdxForBones],f.matricesWeights[4*q+1]=u[V.vertexIdxForBones+1],f.matricesWeights[4*q+2]=u[V.vertexIdxForBones+2],f.matricesWeights[4*q+3]=u[V.vertexIdxForBones+3]),I&&f.matricesWeightsExtra&&(f.matricesWeightsExtra[4*q]=I[V.vertexIdxForBones],f.matricesWeightsExtra[4*q+1]=I[V.vertexIdxForBones+1],f.matricesWeightsExtra[4*q+2]=I[V.vertexIdxForBones+2],f.matricesWeightsExtra[4*q+3]=I[V.vertexIdxForBones+3]))),G.captureUVS)V.uv.toArray(f.yD,2*q);else{f.yD.push(.5+V.position.x/y.x);const D=.5+V.position.y/y.y;f.yD.push(X.e?1-D:D)}q++}}}0===f.indices.length&&(f.indices=null),0===f.ID.length&&(f.ID=null),0===f.WD.length&&(f.WD=null),0===f.yD.length&&(f.yD=null),0===(null===(R=f.matricesIndices)||void 0===R?void 0:R.length)&&(f.matricesIndices=null),0===(null===(n=f.matricesWeights)||void 0===n?void 0:n.length)&&(f.matricesWeights=null),0===(null===(g=f.matricesIndicesExtra)||void 0===g?void 0:g.length)&&(f.matricesIndicesExtra=null),0===(null===(j=f.matricesWeightsExtra)||void 0===j?void 0:j.length)&&(f.matricesWeightsExtra=null);const a=new N.b(D,l.uD());return f.OD(a),F?(a.skeleton=l.skeleton,a.parent=l):(a.position=W.clone(),a.rotation=new V.Kl(U,O,S)),a.hb(!0),a.refreshBoundingInfo(!0,!0),a}function A(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const l=0|Math.max(D.subdivisions?D.subdivisions:2,1),G=0|Math.max(D.tessellation?D.tessellation:16,3),N=Math.max(D.height?D.height:1,0),M=Math.max(D.radius?D.radius:.25,0),t=0|Math.max(D.capSubdivisions?D.capSubdivisions:6,1),R=G,n=l,g=Math.max(D.radiusTop?D.radiusTop:M,0),j=Math.max(D.radiusBottom?D.radiusBottom:M,0),e=N-(g+j),K=2*Math.PI,F=Math.max(D.topCapSubdivisions?D.topCapSubdivisions:t,1),d=Math.max(D.bottomCapSubdivisions?D.bottomCapSubdivisions:t,1),H=Math.acos((j-g)/N);let h=[];const x=[],r=[],o=[];let L=0;const u=[],B=.5*e,I=.5*Math.PI;let W,i;const y=V.Kl.Zero(),S=V.Kl.Zero(),O=Math.cos(H),s=Math.sin(H),U=new V.Vector2(g*s,B+g*O).Fl(new V.Vector2(j*s,j*O-B)).length(),f=g*H+U+j*(I-H);let q=0;for(i=0;i<=F;i++){const D=[],l=I-H*(i/F);q+=g*H/F;const G=Math.cos(l),V=Math.sin(l),N=G*g;for(W=0;W<=R;W++){const l=W/R,M=l*K+0,b=Math.sin(M),t=Math.cos(M);S.x=N*b,S.y=B+V*g,S.z=N*t,x.push(S.x,S.y,S.z),y.set(G*b,V,G*t),r.push(y.x,y.y,y.z),o.push(l,X.e?q/f:1-q/f),D.push(L),L++}u.push(D)}const c=N-g-j+O*g-O*j,v=s*(j-g)/c;for(i=1;i<=n;i++){const D=[];q+=U/n;const l=s*(i*(j-g)/n+g);for(W=0;W<=R;W++){const G=W/R,V=G*K+0,N=Math.sin(V),M=Math.cos(V);S.x=l*N,S.y=B+O*g-i*c/n,S.z=l*M,x.push(S.x,S.y,S.z),y.set(N,v,M).normalize(),r.push(y.x,y.y,y.z),o.push(G,X.e?q/f:1-q/f),D.push(L),L++}u.push(D)}for(i=1;i<=d;i++){const D=[],l=I-H-(Math.PI-H)*(i/d);q+=j*H/d;const G=Math.cos(l),V=Math.sin(l),N=G*j;for(W=0;W<=R;W++){const l=W/R,M=l*K+0,b=Math.sin(M),t=Math.cos(M);S.x=N*b,S.y=V*j-B,S.z=N*t,x.push(S.x,S.y,S.z),y.set(G*b,V,G*t),r.push(y.x,y.y,y.z),o.push(l,X.e?q/f:1-q/f),D.push(L),L++}u.push(D)}for(W=0;W<R;W++)for(i=0;i<F+n+d;i++){const D=u[i][W],l=u[i+1][W],G=u[i+1][W+1],V=u[i][W+1];h.push(D),h.push(l),h.push(V),h.push(l),h.push(G),h.push(V)}if(h=h.reverse(),D.orientation&&!D.orientation.equals(V.Kl.Up())){const l=new V.Matrix;D.orientation.clone().scale(.5*Math.PI).cross(V.Kl.Up()).toQuaternion().toRotationMatrix(l);const G=V.Kl.Zero();for(let D=0;D<x.length;D+=3)G.set(x[D],x[D+1],x[D+2]),V.Kl.TransformCoordinatesToRef(G.clone(),l,G),x[D]=G.x,x[D+1]=G.y,x[D+2]=G.z}const Z=new b.d;return Z.ID=x,Z.WD=r,Z.yD=o,Z.indices=h,Z}function a(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:V.Kl.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new N.b(D,G);return A(l).OD(M,l.updatable),M}N.b.CreateDecal=(D,l,G,V,N,M)=>w(D,l,{position:G,normal:V,size:N,angle:M});N.b.CreateCapsule=(D,l,G)=>a(D,l,G),b.d.CreateCapsule=A;var Q=G(11546),DD=G(11713);class lD{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=D,this.y=l,D!==Math.floor(D)&&(D=Math.floor(D),Q.d.Warn("x is not an integer, floor(x) used")),l!==Math.floor(l)&&(l=Math.floor(l),Q.d.Warn("y is not an integer, floor(y) used"))}clone(){return new lD(this.x,this.y)}rotate60About(D){const l=this.x;return this.x=D.x+D.y-this.y,this.y=l+this.y-D.x,this}rotateNeg60About(D){const l=this.x;return this.x=l+this.y-D.y,this.y=D.x+D.y-l,this}rotate120(D,l){D!==Math.floor(D)&&(D=Math.floor(D),Q.d.Warn("m not an integer only floor(m) used")),l!==Math.floor(l)&&(l=Math.floor(l),Q.d.Warn("n not an integer only floor(n) used"));const G=this.x;return this.x=D-G-this.y,this.y=l+G,this}rotateNeg120(D,l){D!==Math.floor(D)&&(D=Math.floor(D),Q.d.Warn("m is not an integer, floor(m) used")),l!==Math.floor(l)&&(l=Math.floor(l),Q.d.Warn("n is not an integer,   floor(n) used"));const G=this.x;return this.x=this.y-l,this.y=D+l-G-this.y,this}toCartesianOrigin(D,l){const G=V.Kl.Zero();return G.x=D.x+2*this.x*l+this.y*l,G.y=D.y+Math.sqrt(3)*this.y*l,G}static Zero(){return new lD(0,0)}}class GD{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new VD("icosahedron","Regular",[[0,DD.e,-1],[-DD.e,1,0],[-1,0,-DD.e],[1,0,-DD.e],[DD.e,1,0],[0,DD.e,1],[-1,0,DD.e],[-DD.e,-1,0],[0,-DD.e,-1],[DD.e,-1,0],[1,0,DD.e],[0,-DD.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let D=12;const l={},G=this.m,V=this.n;let N,M,b,X,t,R=G,n=1,g=0;0!==V&&(R=(0,z.HighestCommonFactor)(G,V)),n=G/R,g=V/R;const j=lD.Zero(),e=new lD(G,V),K=new lD(-V,G+V),F=lD.Zero(),d=lD.Zero(),H=lD.Zero();let h,x,r,o,L=[];const u=[],B=this.vertByDist,I=(G,V,N,M)=>{h=G+"|"+N,x=V+"|"+M,h in l||x in l?h in l&&!(x in l)?l[x]=l[h]:x in l&&!(h in l)&&(l[h]=l[x]):(l[h]=D,l[x]=D,D++),B[N][0]>2?u[l[h]]=[-B[N][0],B[N][1],l[h]]:u[l[h]]=[L[B[N][0]],B[N][1],l[h]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let W=0;W<20;W++){if(L=this.IDATA.face[W],b=L[2],X=L[1],t=L[0],r=j.x+"|"+j.y,h=W+"|"+r,h in l||(l[h]=b,u[b]=[L[B[r][0]],B[r][1]]),r=e.x+"|"+e.y,h=W+"|"+r,h in l||(l[h]=X,u[X]=[L[B[r][0]],B[r][1]]),r=K.x+"|"+K.y,h=W+"|"+r,h in l||(l[h]=t,u[t]=[L[B[r][0]],B[r][1]]),N=this.IDATA.edgematch[W][0],M=this.IDATA.edgematch[W][1],"B"===M)for(let D=1;D<R;D++)d.x=G-D*(n+g),d.y=V+D*n,H.x=-D*g,H.y=D*(n+g),r=d.x+"|"+d.y,o=H.x+"|"+H.y,I(W,N,r,o);if("O"===M)for(let D=1;D<R;D++)H.x=-D*g,H.y=D*(n+g),F.x=D*n,F.y=D*g,r=H.x+"|"+H.y,o=F.x+"|"+F.y,I(W,N,r,o);if(N=this.IDATA.edgematch[W][2],M=this.IDATA.edgematch[W][3],M&&"A"===M)for(let D=1;D<R;D++)F.x=D*n,F.y=D*g,d.x=G-(R-D)*(n+g),d.y=V+(R-D)*n,r=F.x+"|"+F.y,o=d.x+"|"+d.y,I(W,N,r,o);for(let G=0;G<this.vertices.length;G++)r=this.vertices[G].x+"|"+this.vertices[G].y,h=W+"|"+r,h in l||(l[h]=D++,B[r][0]>2?u[l[h]]=[-B[r][0],B[r][1],l[h]]:u[l[h]]=[L[B[r][0]],B[r][1],l[h]])}this.closestTo=u,this.vecToidx=l}calcCoeffs(){const D=this.m,l=this.n,G=Math.sqrt(3)/3,V=D*D+l*l+D*l;this.coau=(D+l)/V,this.cobu=-l/V,this.coav=-G*(D-l)/V,this.cobv=G*(2*D+l)/V}createInnerFacets(){const D=this.m,l=this.n;for(let G=0;G<l+D+1;G++)for(let D=this.min[G];D<this.max[G]+1;D++)D<this.max[G]&&D<this.max[G+1]+1&&this.innerFacets.push(["|"+D+"|"+G,"|"+D+"|"+(G+1),"|"+(D+1)+"|"+G]),G>0&&D<this.max[G-1]&&D+1<this.max[G]+1&&this.innerFacets.push(["|"+D+"|"+G,"|"+(D+1)+"|"+G,"|"+(D+1)+"|"+(G-1)])}edgeVecsABOB(){const D=this.m,l=this.n,G=new lD(-l,D+l);for(let V=1;V<D+l;V++){const D=new lD(this.min[V],V),l=new lD(this.min[V-1],V-1),N=new lD(this.min[V+1],V+1),M=D.clone(),b=l.clone(),X=N.clone();M.rotate60About(G),b.rotate60About(G),X.rotate60About(G);const t=new lD(this.max[M.y],M.y),R=new lD(this.max[M.y-1],M.y-1),n=new lD(this.max[M.y-1]-1,M.y-1);M.x===t.x&&M.y===t.y||(M.x!==R.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([D,R,n]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([D,n,t])):M.y===X.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([D,l,R]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([D,R,N])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([D,l,R]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([D,R,t])))}}mapABOBtoOBOA(){const D=new lD(0,0);for(let l=0;l<this.isoVecsABOB.length;l++){const G=[];for(let V=0;V<3;V++)D.x=this.isoVecsABOB[l][V].x,D.y=this.isoVecsABOB[l][V].y,0===this.vertexTypes[l][V]&&D.rotateNeg120(this.m,this.n),G.push(D.clone());this.isoVecsOBOA.push(G)}}mapABOBtoBAOA(){const D=new lD(0,0);for(let l=0;l<this.isoVecsABOB.length;l++){const G=[];for(let V=0;V<3;V++)D.x=this.isoVecsABOB[l][V].x,D.y=this.isoVecsABOB[l][V].y,1===this.vertexTypes[l][V]&&D.rotate120(this.m,this.n),G.push(D.clone());this.isoVecsBAOA.push(G)}}MapToFace(D,l){const G=this.IDATA.face[D],N=G[2],M=G[1],b=G[0],X=V.Kl.xl(this.IDATA.vertex[N]),t=V.Kl.xl(this.IDATA.vertex[M]),R=V.Kl.xl(this.IDATA.vertex[b]),n=t.Fl(X),g=R.Fl(X),j=n.scale(this.coau).add(g.scale(this.cobu)),e=n.scale(this.coav).add(g.scale(this.cobv)),K=[];let F,d=V.TmpVectors.Kl[0];for(let V=0;V<this.cartesian.length;V++)d=j.scale(this.cartesian[V].x).add(e.scale(this.cartesian[V].y)).add(X),K[V]=[d.x,d.y,d.z],F=D+"|"+this.vertices[V].x+"|"+this.vertices[V].y,l.vertex[this.vecToidx[F]]=[d.x,d.y,d.z]}build(D,l){const G=[],V=lD.Zero(),N=new lD(D,l),M=new lD(-l,D+l);G.push(V,N,M);for(let r=l;r<D+1;r++)for(let l=0;l<D+1-r;l++)G.push(new lD(l,r));if(l>0){const V=(0,z.HighestCommonFactor)(D,l),N=D/V,M=l/V;for(let X=1;X<V;X++)G.push(new lD(X*N,X*M)),G.push(new lD(-X*M,X*(N+M))),G.push(new lD(D-X*(N+M),l+X*N));const b=D/l;for(let X=1;X<l;X++)for(let V=0;V<X*b;V++)G.push(new lD(V,X)),G.push(new lD(V,X).rotate120(D,l)),G.push(new lD(V,X).rotateNeg120(D,l))}G.sort(((D,l)=>D.x-l.x)),G.sort(((D,l)=>D.y-l.y));const b=new Array(D+l+1),X=new Array(D+l+1);for(let r=0;r<b.length;r++)b[r]=1/0,X[r]=-1/0;let t=0,R=0;const n=G.length;for(let r=0;r<n;r++)R=G[r].x,t=G[r].y,b[t]=Math.min(R,b[t]),X[t]=Math.max(R,X[t]);const g=(G,V)=>{const N=G.clone();return"A"===V&&N.rotateNeg120(D,l),"B"===V&&N.rotate120(D,l),N.x<0?N.y:N.x+N.y},j=[],e=[],K=[],F=[],d={},H=[];let h=-1,x=-1;for(let r=0;r<n;r++)j[r]=G[r].toCartesianOrigin(new lD(0,0),.5),e[r]=g(G[r],"O"),K[r]=g(G[r],"A"),F[r]=g(G[r],"B"),e[r]===K[r]&&K[r]===F[r]?(h=3,x=e[r]):e[r]===K[r]?(h=4,x=e[r]):K[r]===F[r]?(h=5,x=K[r]):F[r]===e[r]&&(h=6,x=e[r]),e[r]<K[r]&&e[r]<F[r]&&(h=2,x=e[r]),K[r]<e[r]&&K[r]<F[r]&&(h=1,x=K[r]),F[r]<K[r]&&F[r]<e[r]&&(h=0,x=F[r]),H.push([h,x,G[r].x,G[r].y]);H.sort(((D,l)=>D[2]-l[2])),H.sort(((D,l)=>D[3]-l[3])),H.sort(((D,l)=>D[1]-l[1])),H.sort(((D,l)=>D[0]-l[0]));for(let r=0;r<H.length;r++)d[H[r][2]+"|"+H[r][3]]=[H[r][0],H[r][1],r];return this.m=D,this.n=l,this.vertices=G,this.vertByDist=d,this.cartesian=j,this.min=b,this.max=X,this}}class VD{constructor(D,l,G,V){this.name=D,this.category=l,this.vertex=G,this.face=V}}class ND extends VD{innerToData(D,l){for(let G=0;G<l.innerFacets.length;G++)this.face.push(l.innerFacets[G].map((G=>l.vecToidx[D+G])))}mapABOBtoDATA(D,l){const G=l.IDATA.edgematch[D][0];for(let V=0;V<l.isoVecsABOB.length;V++){const N=[];for(let M=0;M<3;M++)0===l.vertexTypes[V][M]?N.push(D+"|"+l.isoVecsABOB[V][M].x+"|"+l.isoVecsABOB[V][M].y):N.push(G+"|"+l.isoVecsABOB[V][M].x+"|"+l.isoVecsABOB[V][M].y);this.face.push([l.vecToidx[N[0]],l.vecToidx[N[1]],l.vecToidx[N[2]]])}}mapOBOAtoDATA(D,l){const G=l.IDATA.edgematch[D][0];for(let V=0;V<l.isoVecsOBOA.length;V++){const N=[];for(let M=0;M<3;M++)1===l.vertexTypes[V][M]?N.push(D+"|"+l.isoVecsOBOA[V][M].x+"|"+l.isoVecsOBOA[V][M].y):N.push(G+"|"+l.isoVecsOBOA[V][M].x+"|"+l.isoVecsOBOA[V][M].y);this.face.push([l.vecToidx[N[0]],l.vecToidx[N[1]],l.vecToidx[N[2]]])}}mapBAOAtoDATA(D,l){const G=l.IDATA.edgematch[D][2];for(let V=0;V<l.isoVecsBAOA.length;V++){const N=[];for(let M=0;M<3;M++)1===l.vertexTypes[V][M]?N.push(D+"|"+l.isoVecsBAOA[V][M].x+"|"+l.isoVecsBAOA[V][M].y):N.push(G+"|"+l.isoVecsBAOA[V][M].x+"|"+l.isoVecsBAOA[V][M].y);this.face.push([l.vecToidx[N[0]],l.vecToidx[N[1]],l.vecToidx[N[2]]])}}orderData(D){const l=[];for(let M=0;M<13;M++)l[M]=[];const G=D.closestTo;for(let M=0;M<G.length;M++)G[M][0]>-1?G[M][1]>0&&l[G[M][0]].push([M,G[M][1]]):l[12].push([M,G[M][0]]);const V=[];for(let M=0;M<12;M++)V[M]=M;let N=12;for(let M=0;M<12;M++){l[M].sort(((D,l)=>D[1]-l[1]));for(let D=0;D<l[M].length;D++)V[l[M][D][0]]=N++}for(let M=0;M<l[12].length;M++)V[l[12][M][0]]=N++;for(let M=0;M<this.vertex.length;M++)this.vertex[M].push(V[M]);this.vertex.sort(((D,l)=>D[3]-l[3]));for(let M=0;M<this.vertex.length;M++)this.vertex[M].pop();for(let M=0;M<this.face.length;M++)for(let D=0;D<this.face[M].length;D++)this.face[M][D]=V[this.face[M][D]];this.sharedNodes=l[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(D,l){const G=[],V=[];let N=l.pop();V.push(N);let M=this.face[N].indexOf(D);M=(M+2)%3;let b=this.face[N][M];G.push(b);let X=0;for(;l.length>0;)N=l[X],this.face[N].indexOf(b)>-1?(M=(this.face[N].indexOf(b)+1)%3,b=this.face[N][M],G.push(b),V.push(N),l.splice(X,1),X=0):X++;return this.adjacentFaces.push(G),V}toGoldbergPolyhedronData(){const D=new VD("GeoDual","Goldberg",[],[]);D.name="GD dual";const l=this.vertex.length,G=new Array(l);for(let t=0;t<l;t++)G[t]=[];for(let t=0;t<this.face.length;t++)for(let D=0;D<3;D++)G[this.face[t][D]].push(t);let V=0,N=0,M=0,b=[],X=[];this.adjacentFaces=[];for(let t=0;t<G.length;t++){D.face[t]=this.setOrder(t,G[t].concat([]));for(const l of G[t]){V=0,N=0,M=0,b=this.face[l];for(let D=0;D<3;D++)X=this.vertex[b[D]],V+=X[0],N+=X[1],M+=X[2];D.vertex[l]=[V/3,N/3,M/3]}}return D}static BuildGeodesicData(D){const l=new ND("Geodesic-m-n","Geodesic",[[0,DD.e,-1],[-DD.e,1,0],[-1,0,-DD.e],[1,0,-DD.e],[DD.e,1,0],[0,DD.e,1],[-1,0,DD.e],[-DD.e,-1,0],[0,-DD.e,-1],[DD.e,-1,0],[1,0,DD.e],[0,-DD.e,1]],[]);D.setIndices(),D.calcCoeffs(),D.createInnerFacets(),D.edgeVecsABOB(),D.mapABOBtoOBOA(),D.mapABOBtoBAOA();for(let G=0;G<D.IDATA.face.length;G++)D.MapToFace(G,l),l.innerToData(G,D),"B"===D.IDATA.edgematch[G][1]&&l.mapABOBtoDATA(G,D),"O"===D.IDATA.edgematch[G][1]&&l.mapOBOAtoDATA(G,D),"A"===D.IDATA.edgematch[G][3]&&l.mapBAOAtoDATA(G,D);l.orderData(D);return l.vertex=l.vertex.map((function(D){const l=D[0],G=D[1],V=D[2],N=Math.sqrt(l*l+G*G+V*V);return D[0]*=1/N,D[1]*=1/N,D[2]*=1/N,D})),l}}N.b._GoldbergMeshParser=(D,l)=>MD.Parse(D,l);class MD extends N.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(D,l){return void 0===l?(D>this.goldbergData.nbUnsharedFaces-1&&(Q.d.Warn("Maximum number of unshared faces used"),D=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+D):(D>11&&(Q.d.Warn("Last pole used"),D=11),l>this.goldbergData.nbFacesAtPole-1&&(Q.d.Warn("Maximum number of faces at a pole used"),l=this.goldbergData.nbFacesAtPole-1),12+D*this.goldbergData.nbFacesAtPole+l)}_changeGoldbergFaceColors(D){for(let G=0;G<D.length;G++){const l=D[G][0],V=D[G][1],N=D[G][2];for(let D=l;D<V+1;D++)this.goldbergData.faceColors[D]=N}const l=[];for(let G=0;G<12;G++)for(let D=0;D<5;D++)l.push(this.goldbergData.faceColors[G].r,this.goldbergData.faceColors[G].g,this.goldbergData.faceColors[G].b,this.goldbergData.faceColors[G].a);for(let G=12;G<this.goldbergData.faceColors.length;G++)for(let D=0;D<6;D++)l.push(this.goldbergData.faceColors[G].r,this.goldbergData.faceColors[G].g,this.goldbergData.faceColors[G].b,this.goldbergData.faceColors[G].a);return l}setGoldbergFaceColors(D){const l=this._changeGoldbergFaceColors(D);this.qD(M.e.ColorKind,l)}updateGoldbergFaceColors(D){const l=this._changeGoldbergFaceColors(D);this.updateVerticesData(M.e.ColorKind,l)}_changeGoldbergFaceUVs(D){const l=this.getVerticesData(M.e.UVKind);for(let G=0;G<D.length;G++){const V=D[G][0],N=D[G][1],M=D[G][2],b=D[G][3],X=D[G][4],t=[],R=[];let n,g;for(let D=0;D<5;D++)n=M.x+b*Math.cos(X+D*Math.PI/2.5),g=M.y+b*Math.sin(X+D*Math.PI/2.5),n<0&&(n=0),n>1&&(n=1),t.push(n,g);for(let D=0;D<6;D++)n=M.x+b*Math.cos(X+D*Math.PI/3),g=M.y+b*Math.sin(X+D*Math.PI/3),n<0&&(n=0),n>1&&(n=1),R.push(n,g);for(let D=V;D<Math.min(12,N+1);D++)for(let G=0;G<5;G++)l[10*D+2*G]=t[2*G],l[10*D+2*G+1]=t[2*G+1];for(let D=Math.max(12,V);D<N+1;D++)for(let G=0;G<6;G++)l[12*D-24+2*G]=R[2*G],l[12*D-23+2*G]=R[2*G+1]}return l}setGoldbergFaceUVs(D){const l=this._changeGoldbergFaceUVs(D);this.qD(M.e.UVKind,l)}updateGoldbergFaceUVs(D){const l=this._changeGoldbergFaceUVs(D);this.updateVerticesData(M.e.UVKind,l)}placeOnGoldbergFaceAt(D,l,G){const N=V.Kl.RotationFromAxis(this.goldbergData.faceXaxis[l],this.goldbergData.faceYaxis[l],this.goldbergData.faceZaxis[l]);D.rotation=N,D.position=this.goldbergData.faceCenters[l].add(this.goldbergData.faceXaxis[l].scale(G.x)).add(this.goldbergData.faceYaxis[l].scale(G.y)).add(this.goldbergData.faceZaxis[l].scale(G.z))}serialize(D){super.serialize(D),D.type="GoldbergMesh";const l={};if(l.adjacentFaces=this.goldbergData.adjacentFaces,l.nbSharedFaces=this.goldbergData.nbSharedFaces,l.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,l.nbFaces=this.goldbergData.nbFaces,l.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){l.faceColors=[];for(const D of this.goldbergData.faceColors)l.faceColors.push(D.gb())}if(this.goldbergData.faceCenters){l.faceCenters=[];for(const D of this.goldbergData.faceCenters)l.faceCenters.push(D.gb())}if(this.goldbergData.faceZaxis){l.faceZaxis=[];for(const D of this.goldbergData.faceZaxis)l.faceZaxis.push(D.gb())}if(this.goldbergData.faceYaxis){l.faceYaxis=[];for(const D of this.goldbergData.faceYaxis)l.faceYaxis.push(D.gb())}if(this.goldbergData.faceXaxis){l.faceXaxis=[];for(const D of this.goldbergData.faceXaxis)l.faceXaxis.push(D.gb())}D.goldbergData=l}static Parse(D,l){const G=D.goldbergData;G.faceColors=G.faceColors.map((D=>j.Wb.xl(D))),G.faceCenters=G.faceCenters.map((D=>V.Kl.xl(D))),G.faceZaxis=G.faceZaxis.map((D=>V.Kl.xl(D))),G.faceXaxis=G.faceXaxis.map((D=>V.Kl.xl(D))),G.faceYaxis=G.faceYaxis.map((D=>V.Kl.xl(D)));const N=new MD(D.name,l);return N.goldbergData=G,N}}var bD=G(12274);const XD={CreateBox:g.b,CreateTiledBox:d,CreateSphere:H.d,CreateDisc:n.b,CreateIcoSphere:Y,CreateRibbon:R,CreateCylinder:o,CreateTorus:u,CreateTorusKnot:I,CreateLineSystem:W.f,iR:W.g,CreateDashedLines:W.e,ExtrudeShape:S,ExtrudeShapeCustom:O,CreateLathe:U,CreateTiledPlane:K,OR:f.d,CreateGround:q.e,CreateTiledGround:q.h,CreateGroundFromHeightMap:q.d,CreatePolygon:i.b,ExtrudePolygon:i.d,CreateTube:c,CreatePolyhedron:Z,CreateGeodesic:function(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=l.m||1;V!==Math.floor(V)&&(V=Math.floor(V),Q.d.Warn("m not an integer only floor(m) used"));let N=l.n||0;if(N!==Math.floor(N)&&(N=Math.floor(N),Q.d.Warn("n not an integer only floor(n) used")),N>V){const D=N;N=V,V=D,Q.d.Warn("n > m therefore m and n swapped")}const M=new GD;return M.build(V,N),Z(D,{custom:ND.BuildGeodesicData(M),size:l.size,sizeX:l.sizeX,sizeY:l.sizeY,sizeZ:l.sizeZ,faceUV:l.faceUV,faceColors:l.faceColors,flat:l.flat,updatable:l.updatable,sideOrientation:l.sideOrientation,frontUVs:l.frontUVs,backUVs:l.backUVs},G)},CreateGoldberg:function(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=l.size,t=l.sizeX||M||1,R=l.sizeY||M||1,n=l.sizeZ||M||1;let g=l.m||1;g!==Math.floor(g)&&(g=Math.floor(g),Q.d.Warn("m not an integer only floor(m) used"));let e=l.n||0;if(e!==Math.floor(e)&&(e=Math.floor(e),Q.d.Warn("n not an integer only floor(n) used")),e>g){const D=e;e=g,g=D,Q.d.Warn("n > m therefore m and n swapped")}const K=new GD;K.build(g,e);const F=ND.BuildGeodesicData(K),d=F.toGoldbergPolyhedronData(),H=new MD(D,G);l.sideOrientation=N.b._GetDefaultSideOrientation(l.sideOrientation),H._originalBuilderSideOrientation=l.sideOrientation;(function(D,l){const G=D.size,N=D.sizeX||G||1,M=D.sizeY||G||1,t=D.sizeZ||G||1,R=0===D.sideOrientation?0:D.sideOrientation||b.d.DEFAULTSIDE,n=[],g=[],j=[],e=[];let K=1/0,F=-1/0,d=1/0,H=-1/0;for(let V=0;V<l.vertex.length;V++)K=Math.min(K,l.vertex[V][0]*N),F=Math.max(F,l.vertex[V][0]*N),d=Math.min(d,l.vertex[V][1]*M),H=Math.max(H,l.vertex[V][1]*M);let h=0;for(let b=0;b<l.face.length;b++){const D=l.face[b],G=V.Kl.xl(l.vertex[D[0]]),R=V.Kl.xl(l.vertex[D[2]]),x=V.Kl.xl(l.vertex[D[1]]),r=R.Fl(G),o=x.Fl(G),L=V.Kl.Cross(o,r).normalize();for(let V=0;V<D.length;V++){j.push(L.x,L.y,L.z);const G=l.vertex[D[V]];n.push(G[0]*N,G[1]*M,G[2]*t);const b=(G[1]*M-d)/(H-d);e.push((G[0]*N-K)/(F-K),X.e?1-b:b)}for(let l=0;l<D.length-2;l++)g.push(h,h+l+2,h+l+1);h+=D.length}b.d._ComputeSides(R,n,g,j,e);const x=new b.d;return x.ID=n,x.indices=g,x.WD=j,x.yD=e,x})(l,d).OD(H,l.updatable),H.goldbergData.nbSharedFaces=F.sharedNodes,H.goldbergData.nbUnsharedFaces=F.poleNodes,H.goldbergData.adjacentFaces=F.adjacentFaces,H.goldbergData.nbFaces=H.goldbergData.nbSharedFaces+H.goldbergData.nbUnsharedFaces,H.goldbergData.nbFacesAtPole=(H.goldbergData.nbUnsharedFaces-12)/12;for(let N=0;N<F.vertex.length;N++)H.goldbergData.faceCenters.push(V.Kl.xl(F.vertex[N])),H.goldbergData.faceCenters[N].x*=t,H.goldbergData.faceCenters[N].y*=R,H.goldbergData.faceCenters[N].z*=n,H.goldbergData.faceColors.push(new j.Wb(1,1,1,1));for(let N=0;N<d.face.length;N++){const D=d.face[N],l=V.Kl.xl(d.vertex[D[0]]),G=V.Kl.xl(d.vertex[D[2]]),M=V.Kl.xl(d.vertex[D[1]]),b=G.Fl(l),X=M.Fl(l),t=V.Kl.Cross(X,b).normalize(),R=V.Kl.Cross(X,t).normalize();H.goldbergData.faceXaxis.push(X.normalize()),H.goldbergData.faceYaxis.push(t),H.goldbergData.faceZaxis.push(R)}return H},CreateDecal:w,CreateCapsule:a,CreateText:bD.e}},13020:(D,l,G)=>{"use strict";G.d(l,{b:()=>Xl});var V=G(11710),N=G(12112);class M extends N.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var b=G(11755),X=(G(11881),G(11667));class t{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(D){this._targetStopDuration!==D&&(this._targetStopDuration=D)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(D){this._noiseTexture!==D&&(this._noiseTexture=D,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(D){this._animationSheetEnabled!==D&&(this._animationSheetEnabled=D)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(D){this._isAnimationSheetEnabled!=D&&(this._isAnimationSheetEnabled=D,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(D){this._useLogarithmicDepth=D&&this.uD().getEngine().getCaps().fragmentDepthSupported}uD(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(D){switch(D){case t.BLENDMODE_MULTIPLYADD:return;case t.BLENDMODE_ADD:D=1;break;case t.BLENDMODE_ONEONE:D=6;break;case t.BLENDMODE_STANDARD:D=2;break;case t.BLENDMODE_MULTIPLY:D=4;break;case t.BLENDMODE_SUBTRACT:D=3}this._engine.setAlphaMode(D)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:V.Kl.Zero()}set direction1(D){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=D)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:V.Kl.Zero()}set direction2(D){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=D)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:V.Kl.Zero()}set minEmitBox(D){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=D)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:V.Kl.Zero()}set maxEmitBox(D){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=D)}get billboardMode(){return this._billboardMode}set billboardMode(D){this._billboardMode!==D&&(this._billboardMode=D,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(D){this._isBillboardBased!==D&&(this._isBillboardBased=D,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(D){this._attachImageProcessingConfiguration(D)}_attachImageProcessingConfiguration(D){D!==this._imageProcessingConfiguration&&(!D&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=D)}_reset(){}_removeGradientAndTexture(D,l,G){if(!l)return this;let V=0;for(const N of l){if(N.gradient===D){l.splice(V,1);break}V++}return G&&G.dispose(),this}constructor(D){this.animations=[],this.renderingGroupId=0,this.Vl=V.Kl.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new V.Kl(10,10,10),this.onAnimationEnd=null,this.blendMode=t.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new V.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.BR=new V.Kl(0,0,0),this._useLogarithmicDepth=!1,this.gravity=V.Kl.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new b.Wb(1,1,1,1),this.color2=new b.Wb(1,1,1,1),this.colorDead=new b.Wb(0,0,0,1),this.textureMask=new b.Wb(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new M,this.id=D,this.name=D}createPointEmitter(D,l){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new V.Kl(0,1,0),arguments.length>2&&void 0!==arguments[2]||new V.Kl(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new V.Kl(0,1,0),arguments.length>4&&void 0!==arguments[4]||new V.Kl(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new V.Kl(0,1,0),arguments.length>3&&void 0!==arguments[3]||new V.Kl(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(D,l,G,V){throw new Error("Method not implemented.")}}t.BLENDMODE_ONEONE=0,t.BLENDMODE_STANDARD=1,t.BLENDMODE_ADD=2,t.BLENDMODE_MULTIPLY=3,t.BLENDMODE_MULTIPLYADD=4,t.BLENDMODE_SUBTRACT=-1,(0,X.c)("BABYLON.BaseParticleSystem",t);var R=G(11728),n=G(11551);class g{constructor(){this.direction1=new V.Kl(0,1,0),this.direction2=new V.Kl(0,1,0),this.minEmitBox=new V.Kl(-.5,-.5,-.5),this.maxEmitBox=new V.Kl(.5,.5,.5)}startDirectionFunction(D,l,G,N){const M=(0,R.RandomRange)(this.direction1.x,this.direction2.x),b=(0,R.RandomRange)(this.direction1.y,this.direction2.y),X=(0,R.RandomRange)(this.direction1.z,this.direction2.z);if(N)return l.x=M,l.y=b,void(l.z=X);V.Kl.TransformNormalFromFloatsToRef(M,b,X,D,l)}startPositionFunction(D,l,G,N){const M=(0,R.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),b=(0,R.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),X=(0,R.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(N)return l.x=M,l.y=b,void(l.z=X);V.Kl.TransformCoordinatesFromFloatsToRef(M,b,X,D,l)}clone(){const D=new g;return n.e.DeepCopy(this,D),D}applyToShader(D){D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2),D.setVector3("minEmitBox",this.minEmitBox),D.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(D){D.addUniform("direction1",3),D.addUniform("direction2",3),D.addUniform("minEmitBox",3),D.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.direction1=this.direction1.gb(),D.direction2=this.direction2.gb(),D.minEmitBox=this.minEmitBox.gb(),D.maxEmitBox=this.maxEmitBox.gb(),D}parse(D){V.Kl.FromArrayToRef(D.direction1,0,this.direction1),V.Kl.FromArrayToRef(D.direction2,0,this.direction2),V.Kl.FromArrayToRef(D.minEmitBox,0,this.minEmitBox),V.Kl.FromArrayToRef(D.maxEmitBox,0,this.maxEmitBox)}}class j{get radius(){return this._radius}set radius(D){this._radius=D,this._buildHeight()}get angle(){return this._angle}set angle(D){this._angle=D,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=G,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=l,this.radius=D}startDirectionFunction(D,l,G,N){N?V.TmpVectors.Kl[0].V(G.lt).normalize():G.position.subtractToRef(D.getTranslation(),V.TmpVectors.Kl[0]).normalize();const M=(0,R.RandomRange)(0,this.directionRandomizer),b=(0,R.RandomRange)(0,this.directionRandomizer),X=(0,R.RandomRange)(0,this.directionRandomizer);l.x=V.TmpVectors.Kl[0].x+M,l.y=V.TmpVectors.Kl[0].y+b,l.z=V.TmpVectors.Kl[0].z+X,l.normalize()}startPositionFunction(D,l,G,N){const M=(0,R.RandomRange)(0,2*Math.PI);let b;this.emitFromSpawnPointOnly?b=1e-4:(b=(0,R.RandomRange)(0,this.heightRange),b=1-b*b);let X=this._radius-(0,R.RandomRange)(0,this._radius*this.radiusRange);X*=b;const t=X*Math.sin(M),n=X*Math.cos(M),g=b*this._height;if(N)return l.x=t,l.y=g,void(l.z=n);V.Kl.TransformCoordinatesFromFloatsToRef(t,g,n,D,l)}clone(){const D=new j(this._radius,this._angle,this.directionRandomizer);return n.e.DeepCopy(this,D),D}applyToShader(D){D.setFloat2("radius",this._radius,this.radiusRange),D.setFloat("coneAngle",this._angle),D.setFloat2("height",this._height,this.heightRange),D.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(D){D.addUniform("radius",2),D.addUniform("coneAngle",1),D.addUniform("height",2),D.addUniform("directionRandomizer",1)}getEffectDefines(){let D="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(D+="\n#define CONEEMITTERSPAWNPOINT"),D}getClassName(){return"ConeParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.radius=this._radius,D.angle=this._angle,D.directionRandomizer=this.directionRandomizer,D.radiusRange=this.radiusRange,D.heightRange=this.heightRange,D.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,D}parse(D){this.radius=D.radius,this.angle=D.angle,this.directionRandomizer=D.directionRandomizer,this.radiusRange=void 0!==D.radiusRange?D.radiusRange:1,this.heightRange=void 0!==D.radiusRange?D.heightRange:1,this.emitFromSpawnPointOnly=void 0!==D.emitFromSpawnPointOnly&&D.emitFromSpawnPointOnly}}class e extends j{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Kl(0,1,0),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Kl(0,1,0);super(D,l),this.direction1=G,this.direction2=N}startDirectionFunction(D,l){const G=(0,R.RandomRange)(this.direction1.x,this.direction2.x),N=(0,R.RandomRange)(this.direction1.y,this.direction2.y),M=(0,R.RandomRange)(this.direction1.z,this.direction2.z);V.Kl.TransformNormalFromFloatsToRef(G,N,M,D,l)}clone(){const D=new e(this.radius,this.angle,this.direction1,this.direction2);return n.e.DeepCopy(this,D),D}applyToShader(D){D.setFloat("radius",this.radius),D.setFloat("radiusRange",this.radiusRange),D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("radius",1),D.addUniform("radiusRange",1),D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const D=super.serialize();return D.direction1=this.direction1.gb(),D.direction2=this.direction2.gb(),D}parse(D){super.parse(D),this.direction1.V(D.direction1),this.direction2.V(D.direction2)}}class K{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=D,this.height=l,this.radiusRange=G,this.directionRandomizer=N,this._tempVector=V.Kl.Zero()}startDirectionFunction(D,l,G,N,M){G.position.subtractToRef(D.getTranslation(),this._tempVector),this._tempVector.normalize(),V.Kl.TransformNormalToRef(this._tempVector,M,this._tempVector);const b=(0,R.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let X=Math.atan2(this._tempVector.x,this._tempVector.z);X+=(0,R.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=b,this._tempVector.x=Math.sin(X),this._tempVector.z=Math.cos(X),this._tempVector.normalize(),N?l.V(this._tempVector):V.Kl.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,D,l)}startPositionFunction(D,l,G,N){const M=(0,R.RandomRange)(-this.height/2,this.height/2),b=(0,R.RandomRange)(0,2*Math.PI),X=(0,R.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),t=Math.sqrt(X)*this.radius,n=t*Math.cos(b),g=t*Math.sin(b);N?l.Lb(n,M,g):V.Kl.TransformCoordinatesFromFloatsToRef(n,M,g,D,l)}clone(){const D=new K(this.radius,this.directionRandomizer);return n.e.DeepCopy(this,D),D}applyToShader(D){D.setFloat("radius",this.radius),D.setFloat("height",this.height),D.setFloat("radiusRange",this.radiusRange),D.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(D){D.addUniform("radius",1),D.addUniform("height",1),D.addUniform("radiusRange",1),D.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.radius=this.radius,D.height=this.height,D.radiusRange=this.radiusRange,D.directionRandomizer=this.directionRandomizer,D}parse(D){this.radius=D.radius,this.height=D.height,this.radiusRange=D.radiusRange,this.directionRandomizer=D.directionRandomizer}}class F extends K{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Kl(0,1,0),M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new V.Kl(0,1,0);super(D,l,G),this.direction1=N,this.direction2=M}startDirectionFunction(D,l,G,N){const M=(0,R.RandomRange)(this.direction1.x,this.direction2.x),b=(0,R.RandomRange)(this.direction1.y,this.direction2.y),X=(0,R.RandomRange)(this.direction1.z,this.direction2.z);N?l.Lb(M,b,X):V.Kl.TransformNormalFromFloatsToRef(M,b,X,D,l)}clone(){const D=new F(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return n.e.DeepCopy(this,D),D}applyToShader(D){D.setFloat("radius",this.radius),D.setFloat("height",this.height),D.setFloat("radiusRange",this.radiusRange),D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("radius",1),D.addUniform("height",1),D.addUniform("radiusRange",1),D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const D=super.serialize();return D.direction1=this.direction1.gb(),D.direction2=this.direction2.gb(),D}parse(D){super.parse(D),V.Kl.FromArrayToRef(D.direction1,0,this.direction1),V.Kl.FromArrayToRef(D.direction2,0,this.direction2)}}class d{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=D,this.radiusRange=l,this.directionRandomizer=G}startDirectionFunction(D,l,G,N){const M=G.position.Fl(D.getTranslation()).normalize(),b=(0,R.RandomRange)(0,this.directionRandomizer),X=(0,R.RandomRange)(0,this.directionRandomizer),t=(0,R.RandomRange)(0,this.directionRandomizer);M.x+=b,M.y+=X,M.z+=t,M.normalize(),N?l.V(M):V.Kl.TransformNormalFromFloatsToRef(M.x,M.y,M.z,D,l)}startPositionFunction(D,l,G,N){const M=this.radius-(0,R.RandomRange)(0,this.radius*this.radiusRange),b=(0,R.RandomRange)(0,1),X=(0,R.RandomRange)(0,2*Math.PI),t=Math.acos(2*b-1),n=M*Math.cos(X)*Math.sin(t),g=M*Math.cos(t),j=M*Math.sin(X)*Math.sin(t);N?l.Lb(n,Math.abs(g),j):V.Kl.TransformCoordinatesFromFloatsToRef(n,Math.abs(g),j,D,l)}clone(){const D=new d(this.radius,this.directionRandomizer);return n.e.DeepCopy(this,D),D}applyToShader(D){D.setFloat("radius",this.radius),D.setFloat("radiusRange",this.radiusRange),D.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(D){D.addUniform("radius",1),D.addUniform("radiusRange",1),D.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.radius=this.radius,D.radiusRange=this.radiusRange,D.directionRandomizer=this.directionRandomizer,D}parse(D){this.radius=D.radius,this.radiusRange=D.radiusRange,this.directionRandomizer=D.directionRandomizer}}class H{constructor(){this.direction1=new V.Kl(0,1,0),this.direction2=new V.Kl(0,1,0)}startDirectionFunction(D,l,G,N){const M=(0,R.RandomRange)(this.direction1.x,this.direction2.x),b=(0,R.RandomRange)(this.direction1.y,this.direction2.y),X=(0,R.RandomRange)(this.direction1.z,this.direction2.z);N?l.Lb(M,b,X):V.Kl.TransformNormalFromFloatsToRef(M,b,X,D,l)}startPositionFunction(D,l,G,N){N?l.Lb(0,0,0):V.Kl.TransformCoordinatesFromFloatsToRef(0,0,0,D,l)}clone(){const D=new H;return n.e.DeepCopy(this,D),D}applyToShader(D){D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.direction1=this.direction1.gb(),D.direction2=this.direction2.gb(),D}parse(D){V.Kl.FromArrayToRef(D.direction1,0,this.direction1),V.Kl.FromArrayToRef(D.direction2,0,this.direction2)}}class h{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=D,this.radiusRange=l,this.directionRandomizer=G}startDirectionFunction(D,l,G,N){const M=G.position.Fl(D.getTranslation()).normalize(),b=(0,R.RandomRange)(0,this.directionRandomizer),X=(0,R.RandomRange)(0,this.directionRandomizer),t=(0,R.RandomRange)(0,this.directionRandomizer);M.x+=b,M.y+=X,M.z+=t,M.normalize(),N?l.V(M):V.Kl.TransformNormalFromFloatsToRef(M.x,M.y,M.z,D,l)}startPositionFunction(D,l,G,N){const M=this.radius-(0,R.RandomRange)(0,this.radius*this.radiusRange),b=(0,R.RandomRange)(0,1),X=(0,R.RandomRange)(0,2*Math.PI),t=Math.acos(2*b-1),n=M*Math.cos(X)*Math.sin(t),g=M*Math.cos(t),j=M*Math.sin(X)*Math.sin(t);N?l.Lb(n,g,j):V.Kl.TransformCoordinatesFromFloatsToRef(n,g,j,D,l)}clone(){const D=new h(this.radius,this.directionRandomizer);return n.e.DeepCopy(this,D),D}applyToShader(D){D.setFloat("radius",this.radius),D.setFloat("radiusRange",this.radiusRange),D.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(D){D.addUniform("radius",1),D.addUniform("radiusRange",1),D.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.radius=this.radius,D.radiusRange=this.radiusRange,D.directionRandomizer=this.directionRandomizer,D}parse(D){this.radius=D.radius,this.radiusRange=D.radiusRange,this.directionRandomizer=D.directionRandomizer}}class x extends h{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V.Kl(0,1,0),G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Kl(0,1,0);super(D),this.direction1=l,this.direction2=G}startDirectionFunction(D,l){const G=(0,R.RandomRange)(this.direction1.x,this.direction2.x),N=(0,R.RandomRange)(this.direction1.y,this.direction2.y),M=(0,R.RandomRange)(this.direction1.z,this.direction2.z);V.Kl.TransformNormalFromFloatsToRef(G,N,M,D,l)}clone(){const D=new x(this.radius,this.direction1,this.direction2);return n.e.DeepCopy(this,D),D}applyToShader(D){D.setFloat("radius",this.radius),D.setFloat("radiusRange",this.radiusRange),D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("radius",1),D.addUniform("radiusRange",1),D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const D=super.serialize();return D.direction1=this.direction1.gb(),D.direction2=this.direction2.gb(),D}parse(D){super.parse(D),this.direction1.V(D.direction1),this.direction2.V(D.direction2)}}class r{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(D,l,G,N){const M=V.TmpVectors.Kl[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,G,M);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,G,M);const D=V.TmpVectors.Kl[1];M.subtractToRef(G.position,D),D.scaleToRef(1/G.lifeTime,M)}else M.set(0,0,0);N?l.V(M):V.Kl.TransformNormalToRef(M,D,l)}startPositionFunction(D,l,G,N){const M=V.TmpVectors.Kl[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,G,M):M.set(0,0,0),N?l.V(M):V.Kl.TransformCoordinatesToRef(M,D,l)}clone(){const D=new r;return n.e.DeepCopy(this,D),D}applyToShader(D){}buildUniformLayout(D){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.particlePositionGenerator=this.particlePositionGenerator,D.particleDestinationGenerator=this.particleDestinationGenerator,D}parse(D){D.particlePositionGenerator&&(this.particlePositionGenerator=D.particlePositionGenerator),D.particleDestinationGenerator&&(this.particleDestinationGenerator=D.particleDestinationGenerator)}}var o=G(11788);class L{get mesh(){return this._mesh}set mesh(D){this._mesh!==D&&(this._mesh=D,D?(this._indices=D.rb(),this._positions=D.getVerticesData(o.e.PositionKind),this._normals=D.getVerticesData(o.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=V.Kl.Zero(),this._mesh=null,this.direction1=new V.Kl(0,1,0),this.direction2=new V.Kl(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=D}startDirectionFunction(D,l,G,N){if(this.useMeshNormalsForDirection&&this._normals)return void V.Kl.TransformNormalToRef(this._storedNormal,D,l);const M=(0,R.RandomRange)(this.direction1.x,this.direction2.x),b=(0,R.RandomRange)(this.direction1.y,this.direction2.y),X=(0,R.RandomRange)(this.direction1.z,this.direction2.z);N?l.Lb(M,b,X):V.Kl.TransformNormalFromFloatsToRef(M,b,X,D,l)}startPositionFunction(D,l,G,N){if(!this._indices||!this._positions)return;const M=3*(Math.random()*(this._indices.length/3)|0),b=Math.random(),X=Math.random()*(1-b),t=1-b-X,R=this._indices[M],n=this._indices[M+1],g=this._indices[M+2],j=V.TmpVectors.Kl[0],e=V.TmpVectors.Kl[1],K=V.TmpVectors.Kl[2],F=V.TmpVectors.Kl[3];V.Kl.FromArrayToRef(this._positions,3*R,j),V.Kl.FromArrayToRef(this._positions,3*n,e),V.Kl.FromArrayToRef(this._positions,3*g,K),F.x=b*j.x+X*e.x+t*K.x,F.y=b*j.y+X*e.y+t*K.y,F.z=b*j.z+X*e.z+t*K.z,N?l.Lb(F.x,F.y,F.z):V.Kl.TransformCoordinatesFromFloatsToRef(F.x,F.y,F.z,D,l),this.useMeshNormalsForDirection&&this._normals&&(V.Kl.FromArrayToRef(this._normals,3*R,j),V.Kl.FromArrayToRef(this._normals,3*n,e),V.Kl.FromArrayToRef(this._normals,3*g,K),this._storedNormal.x=b*j.x+X*e.x+t*K.x,this._storedNormal.y=b*j.y+X*e.y+t*K.y,this._storedNormal.z=b*j.z+X*e.z+t*K.z)}clone(){const D=new L(this.mesh);return n.e.DeepCopy(this,D),D}applyToShader(D){D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var D;const l={};return l.type=this.getClassName(),l.direction1=this.direction1.gb(),l.direction2=this.direction2.gb(),l.meshId=null===(D=this.mesh)||void 0===D?void 0:D.id,l.useMeshNormalsForDirection=this.useMeshNormalsForDirection,l}parse(D,l){V.Kl.FromArrayToRef(D.direction1,0,this.direction1),V.Kl.FromArrayToRef(D.direction2,0,this.direction2),D.meshId&&l&&(this.mesh=l.getLastMeshById(D.meshId)),this.useMeshNormalsForDirection=D.useMeshNormalsForDirection}}class u{_isUbo(D){return void 0!==D.addUniform}constructor(D){this._isUbo(D)?(this.setMatrix3x3=D.updateMatrix3x3.bind(D),this.setMatrix2x2=D.updateMatrix2x2.bind(D),this.setFloat=D.updateFloat.bind(D),this.setFloat2=D.updateFloat2.bind(D),this.setFloat3=D.updateFloat3.bind(D),this.setFloat4=D.updateFloat4.bind(D),this.setFloatArray=D.updateFloatArray.bind(D),this.setArray=D.updateArray.bind(D),this.setIntArray=D.updateIntArray.bind(D),this.setMatrix=D.Hb.bind(D),this.setMatrices=D.updateMatrices.bind(D),this.setVector3=D.updateVector3.bind(D),this.setVector4=D.updateVector4.bind(D),this.setColor3=D.updateColor3.bind(D),this.setColor4=D.updateColor4.bind(D),this.setDirectColor4=D.updateDirectColor4.bind(D),this.setInt=D.updateInt.bind(D),this.setInt2=D.updateInt2.bind(D),this.setInt3=D.updateInt3.bind(D),this.setInt4=D.updateInt4.bind(D)):(this.setMatrix3x3=D.setMatrix3x3.bind(D),this.setMatrix2x2=D.setMatrix2x2.bind(D),this.setFloat=D.setFloat.bind(D),this.setFloat2=D.setFloat2.bind(D),this.setFloat3=D.setFloat3.bind(D),this.setFloat4=D.setFloat4.bind(D),this.setFloatArray=D.setFloatArray.bind(D),this.setArray=D.setArray.bind(D),this.setIntArray=D.setIntArray.bind(D),this.setMatrix=D.setMatrix.bind(D),this.setMatrices=D.setMatrices.bind(D),this.setVector3=D.setVector3.bind(D),this.setVector4=D.setVector4.bind(D),this.setColor3=D.setColor3.bind(D),this.setColor4=D.setColor4.bind(D),this.setDirectColor4=D.setDirectColor4.bind(D),this.setInt=D.setInt.bind(D),this.setInt2=D.setInt2.bind(D),this.setInt3=D.setInt3.bind(D),this.setInt4=D.setInt4.bind(D))}}var B=G(11621);const I="gpuUpdateParticlesPixelShader",W="#version 300 es\nvoid main() {discard;}\n";B.b.ShadersStore[I]||(B.b.ShadersStore[I]=W);const i="gpuUpdateParticlesVertexShader",y="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";B.b.ShadersStore[i]||(B.b.ShadersStore[i]=y);(0,X.c)("BABYLON.WebGL2ParticleSystem",class{constructor(D,l){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=D,this._engine=l,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var D;return(null===(D=this._updateEffect)||void 0===D?void 0:D.isReady())??!1}createUpdateBuffer(D){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof r&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=D,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new u(this._updateEffect)}createVertexBuffers(D,l){this._updateVAO.push(this._createUpdateVAO(D)),this._renderVAO.push(this._engine.recordVertexArrayObject(l,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=l}createParticleBuffer(D){return D}bindDrawBuffers(D,l,G){G?this._engine.bindBuffers(this._renderVertexBuffers,G,l):this._engine.bindVertexArrayObject(this._renderVAO[D],null)}preUpdateParticleBuffer(){const D=this._engine;if(this._engine.enableEffect(this._updateEffect),!D.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(D,l,G){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[D],null);const V=this._engine;V.bindTransformFeedbackBuffer(l.getBuffer()),V.setRasterizerState(!1),V.beginTransformFeedback(!0),V.drawArraysType(3,0,G),V.endTransformFeedback(),V.setRasterizerState(!0),V.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let D=0;D<this._updateVAO.length;D++)this._engine.releaseVertexArrayObject(this._updateVAO[D]);this._updateVAO.length=0;for(let D=0;D<this._renderVAO.length;D++)this._engine.releaseVertexArrayObject(this._renderVAO[D]);this._renderVAO.length=0}_createUpdateVAO(D){const l={};l.position=D.createVertexBuffer("position",0,3);let G=3;l.age=D.createVertexBuffer("age",G,1),G+=1,l.size=D.createVertexBuffer("size",G,3),G+=3,l.life=D.createVertexBuffer("life",G,1),G+=1,l.seed=D.createVertexBuffer("seed",G,4),G+=4,l.direction=D.createVertexBuffer("direction",G,3),G+=3,this._parent.particleEmitterType instanceof r&&(l.initialPosition=D.createVertexBuffer("initialPosition",G,3),G+=3),this._parent._colorGradientsTexture||(l.color=D.createVertexBuffer("color",G,4),G+=4),this._parent._isBillboardBased||(l.initialDirection=D.createVertexBuffer("initialDirection",G,3),G+=3),this._parent.noiseTexture&&(l.noiseCoordinates1=D.createVertexBuffer("noiseCoordinates1",G,3),G+=3,l.noiseCoordinates2=D.createVertexBuffer("noiseCoordinates2",G,3),G+=3),this._parent._angularSpeedGradientsTexture?(l.angle=D.createVertexBuffer("angle",G,1),G+=1):(l.angle=D.createVertexBuffer("angle",G,2),G+=2),this._parent._isAnimationSheetEnabled&&(l.cellIndex=D.createVertexBuffer("cellIndex",G,1),G+=1,this._parent.spriteRandomStartCell&&(l.cellStartOffset=D.createVertexBuffer("cellStartOffset",G,1),G+=1));const V=this._engine.recordVertexArrayObject(l,null,this._updateEffect);return this._engine.bindArrayBuffer(null),V}});class S{constructor(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,V=arguments.length>3?arguments[3]:void 0;this._engine=D,this._label=V,this._engine._storageBuffers.push(this),this._create(l,G)}_create(D,l){this._bufferSize=D,this._creationFlags=l,this._buffer=this._engine.createStorageBuffer(D,l,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(D,l,G){this._buffer&&this._engine.updateStorageBuffer(this._buffer,D,l,G)}async read(D,l,G,V){return await this._engine.readFromStorageBuffer(this._buffer,D,l,G,V)}dispose(){const D=this._engine._storageBuffers,l=D.indexOf(this);-1!==l&&(D[l]=D[D.length-1],D.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var O=G(11695),s=G(11703),U=G(11739),f=G(11686),q=G(12027),c=G(11546),v=G(11649),Z=G(11934);class J{constructor(){this._gpuTimeInFrameId=-1,this.counter=new Z.c}_addDuration(D,l){D<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==D?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(l,!1),this._gpuTimeInFrameId=D):this.counter.addCount(l,!1))}}var Y=G(11609);class z{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(D,l,G){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=D,this._engine=l,this.uniqueId=q.d.UniqueId,l.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new J),this._engine.getCaps().supportComputeShaders?V.bindingsMapping?(this._context=l.createComputeContext(),this._shaderPath=G,this._options={bindingsMapping:{},defines:[],...V}):c.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):c.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(D,l){let G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const V=this._bindings[D];this._bindings[D]={type:G?0:4,object:l,indexInGroupEntries:null===V||void 0===V?void 0:V.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!V||V.object!==l||V.type!==this._bindings[D].type)}setStorageTexture(D,l){const G=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!G||G.object!==l),this._bindings[D]={type:1,object:l,indexInGroupEntries:null===G||void 0===G?void 0:G.indexInGroupEntries}}setExternalTexture(D,l){const G=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!G||G.object!==l),this._bindings[D]={type:6,object:l,indexInGroupEntries:null===G||void 0===G?void 0:G.indexInGroupEntries}}setVideoTexture(D,l){return!!l.externalTexture&&(this.setExternalTexture(D,l.externalTexture),!0)}setUniformBuffer(D,l){const G=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!G||G.object!==l),this._bindings[D]={type:z._BufferIsDataBuffer(l)?7:2,object:l,indexInGroupEntries:null===G||void 0===G?void 0:G.indexInGroupEntries}}setStorageBuffer(D,l){const G=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!G||G.object!==l),this._bindings[D]={type:z._BufferIsDataBuffer(l)?7:3,object:l,indexInGroupEntries:null===G||void 0===G?void 0:G.indexInGroupEntries}}setTextureSampler(D,l){const G=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!G||!l.compareSampler(G.object)),this._bindings[D]={type:5,object:l,indexInGroupEntries:null===G||void 0===G?void 0:G.indexInGroupEntries}}isReady(){let D=this._effect;for(const N in this._bindings){const D=this._bindings[N],l=D.type,G=D.object;switch(l){case 0:case 4:case 1:if(!G.isReady())return!1;break;case 6:if(!G.isReady())return!1;break}}const l=[],G=this._shaderPath;if(this._options.defines)for(let N=0;N<this._options.defines.length;N++)l.push(this._options.defines[N]);const V=l.join("\n");return this._cachedDefines!==V&&(this._cachedDefines=V,D=this._engine.createComputeEffect(G,{defines:V,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=D),!!D.isReady()}dispatch(D,l,G){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,D,l,G,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const G=z._BufferIsDataBuffer(D)?D:D.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,G,l,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const l in this._bindings){const G=this._bindings[l];if(!this._options.bindingsMapping[l])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+l+"'");switch(G.type){case 0:{const V=this._samplers[l],N=G.object;var D;if(!V||!N._texture||!V.compareSampler(N._texture))this._samplers[l]=(new v.e).setParameters(N.wrapU,N.wrapV,N.wrapR,N.anisotropicFilteringLevel,N._texture.samplingMode,null===(D=N._texture)||void 0===D?void 0:D._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const D=G.object;D.getBuffer()!==G.buffer&&(G.buffer=D.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(D,l,G){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((N=>{(0,Y.g)((()=>this.dispatch(D,l,G)),N,void 0,V)}))}serialize(){const D=U.c.Serialize(this);D.options=this._options,D.shaderPath=this._shaderPath,D.Wj={},D.textures={};for(const l in this._bindings){const G=this._bindings[l],V=G.object;switch(G.type){case 0:case 4:case 1:{const N=V.serialize();N&&(D.textures[l]=N,D.Wj[l]={type:G.type});break}}}return D}static Parse(D,l,G){const V=U.c.Parse((()=>new z(D.name,l.getEngine(),D.shaderPath,D.options)),D,l,G);for(const N in D.textures){const M=D.Wj[N],b=f.b.Parse(D.textures[N],l,G);0===M.type?V.setTexture(N,b):4===M.type?V.setTexture(N,b,!1):V.setStorageTexture(N,b)}return V}static _BufferIsDataBuffer(D){return void 0!==D.underlyingResource}}(0,O.b)([(0,s.L)()],z.prototype,"name",void 0),(0,O.b)([(0,s.L)()],z.prototype,"fastMode",void 0),(0,X.c)("BABYLON.ComputeShader",z);var E=G(11989);const P="gpuUpdateParticlesComputeShader",p="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";B.b.ShadersStoreWGSL[P]||(B.b.ShadersStoreWGSL[P]=p);(0,X.c)("BABYLON.ComputeShaderParticleSystem",class{constructor(D,l){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=D,this._engine=l}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var D;return(null===(D=this._updateComputeShader)||void 0===D?void 0:D.isReady())??!1}createUpdateBuffer(D){var l;const G={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(G.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(G.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(G.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(G.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(G.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(G.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(G.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new z("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:G,defines:D.split("\n")}),null===(l=this._simParamsComputeShader)||void 0===l||l.dispose(),this._simParamsComputeShader=new E.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new u(this._simParamsComputeShader)}createVertexBuffers(D,l){this._renderVertexBuffers.push(l)}createParticleBuffer(D){const l=new S(this._engine,4*D.length,11,"ComputeShaderParticleSystemBuffer");return l.update(D),this._bufferComputeShader.push(l),l.getBuffer()}bindDrawBuffers(D,l,G){this._engine.bindBuffers(this._renderVertexBuffers[D],G,l)}preUpdateParticleBuffer(){}updateParticleBuffer(D,l,G){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[D]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^D]),this._updateComputeShader.dispatch(Math.ceil(G/64))}releaseBuffers(){var D;for(let l=0;l<this._bufferComputeShader.length;++l)this._bufferComputeShader[l].dispose();this._bufferComputeShader.length=0,null===(D=this._simParamsComputeShader)||void 0===D||D.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class k{constructor(D,l,G){this.gradient=D,this.color1=l,this.color2=G}getColorToRef(D){this.color2?b.Wb.LerpToRef(this.color1,this.color2,Math.random(),D):D.V(this.color1)}}class m{constructor(D,l){this.gradient=D,this.color=l}}class T{constructor(D,l,G){this.gradient=D,this.factor1=l,this.factor2=G}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class C{static GetCurrentGradient(D,l,G){if(l[0].gradient>D)return void G(l[0],l[0],1);for(let N=0;N<l.length-1;N++){const V=l[N],M=l[N+1];if(D>=V.gradient&&D<=M.gradient){return void G(V,M,(D-V.gradient)/(M.gradient-V.gradient))}}const V=l.length-1;G(l[V],l[V],1)}}var w=G(11532),A=G(12202),a=G(11571);class Q{constructor(D){this.particleSystem=D,this.position=V.Kl.Zero(),this.direction=V.Kl.Zero(),this.color=new b.Wb(0,0,0,0),this.colorStep=new b.Wb(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new V.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new b.Wb(0,0,0,0),this._currentColor2=new b.Wb(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=Q._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let D=this.age,l=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===l?(l=1,D=this._randomCellOffset):D+=this._randomCellOffset);const G=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let V;V=this._initialSpriteCellLoop?(0,R.Clamp)(D*l%this.lifeTime/this.lifeTime):(0,R.Clamp)(D*l/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+V*G|0}_inheritParticleInfoToSubEmitter(D){if(D.particleSystem.Vl.position){const l=D.particleSystem.Vl;if(l.position.V(this.position),D.inheritDirection){const D=V.TmpVectors.Kl[0];this.direction.normalizeToRef(D),l.setDirection(D,0,Math.PI/2)}}else{D.particleSystem.Vl.V(this.position)}this.direction.scaleToRef(D.inheritedVelocityAmount/2,V.TmpVectors.Kl[0]),D.particleSystem._inheritedVelocityOffset.V(V.TmpVectors.Kl[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const D of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(D)}_reset(){this.age=0,this.id=Q._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(D){D.position.V(this.position),this._initialDirection?D._initialDirection?D._initialDirection.V(this._initialDirection):D._initialDirection=this._initialDirection.clone():D._initialDirection=null,D.direction.V(this.direction),this.lt&&(D.lt?D.lt.V(this.lt):D.lt=this.lt.clone()),D.color.V(this.color),D.colorStep.V(this.colorStep),D.lifeTime=this.lifeTime,D.age=this.age,D._randomCellOffset=this._randomCellOffset,D.size=this.size,D.scale.V(this.scale),D.angle=this.angle,D.angularSpeed=this.angularSpeed,D.particleSystem=this.particleSystem,D.cellIndex=this.cellIndex,D.id=this.id,D._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(D._currentColorGradient=this._currentColorGradient,D._currentColor1.V(this._currentColor1),D._currentColor2.V(this._currentColor2)),this._currentSizeGradient&&(D._currentSizeGradient=this._currentSizeGradient,D._currentSize1=this._currentSize1,D._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(D._currentAngularSpeedGradient=this._currentAngularSpeedGradient,D._currentAngularSpeed1=this._currentAngularSpeed1,D._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(D._currentVelocityGradient=this._currentVelocityGradient,D._currentVelocity1=this._currentVelocity1,D._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(D._currentLimitVelocityGradient=this._currentLimitVelocityGradient,D._currentLimitVelocity1=this._currentLimitVelocity1,D._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(D._currentDragGradient=this._currentDragGradient,D._currentDrag1=this._currentDrag1,D._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(D._initialStartSpriteCellId=this._initialStartSpriteCellId,D._initialEndSpriteCellId=this._initialEndSpriteCellId,D._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(D.remapData&&this.remapData?D.remapData.V(this.remapData):D.remapData=new V.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(D._randomNoiseCoordinates1?(D._randomNoiseCoordinates1.V(this._randomNoiseCoordinates1),D._randomNoiseCoordinates2.V(this._randomNoiseCoordinates2)):(D._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),D._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}Q._Count=0;var DD=G(11833),lD=(G(11879),G(12100)),GD=G(12097),VD=G(11981);function ND(D,l){const G=(0,R.RandomRange)(0,1);b.Wb.LerpToRef(l.color1,l.color2,G,D.color),l.colorDead.subtractToRef(D.color,l._colorDiff),l._colorDiff.scaleToRef(1/D.lifeTime,D.colorStep)}function MD(D,l){D._currentColorGradient=l._colorGradients[0],D._currentColorGradient.getColorToRef(D.color),D._currentColor1.V(D.color),l._colorGradients.length>1?l._colorGradients[1].getColorToRef(D._currentColor2):D._currentColor2.V(D.color)}function bD(D,l){const G=l._colorGradients;C.GetCurrentGradient(l._ratio,G,((l,G,V)=>{l!==D._currentColorGradient&&(D._currentColor1.V(D._currentColor2),G.getColorToRef(D._currentColor2),D._currentColorGradient=l),b.Wb.LerpToRef(D._currentColor1,D._currentColor2,V,D.color)}))}function XD(D,l){D.colorStep.scaleToRef(l._scaledUpdateSpeed,l._scaledColorStep),D.color.addInPlace(l._scaledColorStep),D.color.a<0&&(D.color.a=0)}function tD(D,l){C.GetCurrentGradient(l._ratio,l._angularSpeedGradients,((l,G,V)=>{l!==D._currentAngularSpeedGradient&&(D._currentAngularSpeed1=D._currentAngularSpeed2,D._currentAngularSpeed2=G.getFactor(),D._currentAngularSpeedGradient=l),D.angularSpeed=(0,R.Lerp)(D._currentAngularSpeed1,D._currentAngularSpeed2,V)}))}function RD(D,l){D.angle+=D.angularSpeed*l._scaledUpdateSpeed}function nD(D,l){l.particleEmitterType.startDirectionFunction(l._emitterWorldMatrix,D.direction,D,l.isLocal,l._emitterInverseWorldMatrix)}function gD(D,l){l.startDirectionFunction(l._emitterWorldMatrix,D.direction,D,l.isLocal)}function jD(D,l){D._currentVelocityGradient=l._velocityGradients[0],D._currentVelocity1=D._currentVelocityGradient.getFactor(),l._velocityGradients.length>1?D._currentVelocity2=l._velocityGradients[1].getFactor():D._currentVelocity2=D._currentVelocity1}function eD(D,l){D._currentLimitVelocityGradient=l._limitVelocityGradients[0],D._currentLimitVelocity1=D._currentLimitVelocityGradient.getFactor(),l._limitVelocityGradients.length>1?D._currentLimitVelocity2=l._limitVelocityGradients[1].getFactor():D._currentLimitVelocity2=D._currentLimitVelocity1}function KD(D,l){C.GetCurrentGradient(l._ratio,l._velocityGradients,((G,V,N)=>{G!==D._currentVelocityGradient&&(D._currentVelocity1=D._currentVelocity2,D._currentVelocity2=V.getFactor(),D._currentVelocityGradient=G),l._directionScale*=(0,R.Lerp)(D._currentVelocity1,D._currentVelocity2,N)}))}function FD(D,l){C.GetCurrentGradient(l._ratio,l._limitVelocityGradients,((G,V,N)=>{G!==D._currentLimitVelocityGradient&&(D._currentLimitVelocity1=D._currentLimitVelocity2,D._currentLimitVelocity2=V.getFactor(),D._currentLimitVelocityGradient=G);const M=(0,R.Lerp)(D._currentLimitVelocity1,D._currentLimitVelocity2,N);D.direction.length()>M&&D.direction.scaleInPlace(l.limitVelocityDamping)}))}function dD(D,l){D.direction.scaleToRef(l._directionScale,l._scaledDirection)}function HD(D,l){l.particleEmitterType.startPositionFunction(l._emitterWorldMatrix,D.position,D,l.isLocal)}function hD(D,l){l.startPositionFunction(l._emitterWorldMatrix,D.position,D,l.isLocal)}function xD(D,l){D.lt?D.lt.V(D.position):D.lt=D.position.clone(),V.Kl.TransformCoordinatesToRef(D.lt,l._emitterWorldMatrix,D.position)}function rD(D,l){l.isLocal&&D.lt?(D.lt.addInPlace(l._scaledDirection),V.Kl.TransformCoordinatesToRef(D.lt,l._emitterWorldMatrix,D.position)):D.position.addInPlace(l._scaledDirection)}function oD(D,l){D._currentDragGradient=l._dragGradients[0],D._currentDrag1=D._currentDragGradient.getFactor(),l._dragGradients.length>1?D._currentDrag2=l._dragGradients[1].getFactor():D._currentDrag2=D._currentDrag1}function LD(D,l){C.GetCurrentGradient(l._ratio,l._dragGradients,((G,V,N)=>{G!==D._currentDragGradient&&(D._currentDrag1=D._currentDrag2,D._currentDrag2=V.getFactor(),D._currentDragGradient=G);const M=(0,R.Lerp)(D._currentDrag1,D._currentDrag2,N);l._scaledDirection.scaleInPlace(1-M)}))}function uD(D,l){D._randomNoiseCoordinates1?(D._randomNoiseCoordinates1.Lb(Math.random(),Math.random(),Math.random()),D._randomNoiseCoordinates2.Lb(Math.random(),Math.random(),Math.random())):(D._randomNoiseCoordinates1=new V.Kl(Math.random(),Math.random(),Math.random()),D._randomNoiseCoordinates2=new V.Kl(Math.random(),Math.random(),Math.random()))}function BD(D,l){const G=l._noiseTextureData,N=l._noiseTextureSize;if(G&&N&&D._randomNoiseCoordinates1){const M=l._fetchR(D._randomNoiseCoordinates1.x,D._randomNoiseCoordinates1.y,N.width,N.height,G),b=l._fetchR(D._randomNoiseCoordinates1.z,D._randomNoiseCoordinates2.x,N.width,N.height,G),X=l._fetchR(D._randomNoiseCoordinates2.y,D._randomNoiseCoordinates2.z,N.width,N.height,G),t=V.TmpVectors.Kl[0],R=V.TmpVectors.Kl[1];t.Lb((2*M-1)*l.noiseStrength.x,(2*b-1)*l.noiseStrength.y,(2*X-1)*l.noiseStrength.z),t.scaleToRef(l._tempScaledUpdateSpeed,R),D.direction.addInPlace(R)}}function ID(D,l){l.gravity.scaleToRef(l._tempScaledUpdateSpeed,l._scaledGravity),D.direction.addInPlace(l._scaledGravity)}function WD(D,l){D.size=(0,R.RandomRange)(l.minSize,l.maxSize),D.scale.Lb((0,R.RandomRange)(l.minScaleX,l.maxScaleX),(0,R.RandomRange)(l.minScaleY,l.maxScaleY))}function iD(D,l){D._currentSizeGradient=l._sizeGradients[0],D._currentSize1=D._currentSizeGradient.getFactor(),D.size=D._currentSize1,l._sizeGradients.length>1?D._currentSize2=l._sizeGradients[1].getFactor():D._currentSize2=D._currentSize1,D.scale.Lb((0,R.RandomRange)(l.minScaleX,l.maxScaleX),(0,R.RandomRange)(l.minScaleY,l.maxScaleY))}function yD(D,l){const G=l._actualFrame/l.targetStopDuration;C.GetCurrentGradient(G,l._startSizeGradients,((G,V,N)=>{G!==l._currentStartSizeGradient&&(l._currentStartSize1=l._currentStartSize2,l._currentStartSize2=V.getFactor(),l._currentStartSizeGradient=G);const M=(0,R.Lerp)(l._currentStartSize1,l._currentStartSize2,N);D.scale.scaleInPlace(M)}))}function SD(D,l){C.GetCurrentGradient(l._ratio,l._sizeGradients,((l,G,V)=>{l!==D._currentSizeGradient&&(D._currentSize1=D._currentSize2,D._currentSize2=G.getFactor(),D._currentSizeGradient=l),D.size=(0,R.Lerp)(D._currentSize1,D._currentSize2,V)}))}function OD(D,l){D.remapData=new V.Vector4(0,1,0,1)}function sD(D,l){l._colorRemapGradients&&l._colorRemapGradients.length>0&&C.GetCurrentGradient(l._ratio,l._colorRemapGradients,((l,G,V)=>{const N=(0,R.Lerp)(l.factor1,G.factor1,V),M=(0,R.Lerp)(l.factor2,G.factor2,V);D.remapData.x=N,D.remapData.y=M-N})),l._alphaRemapGradients&&l._alphaRemapGradients.length>0&&C.GetCurrentGradient(l._ratio,l._alphaRemapGradients,((l,G,V)=>{const N=(0,R.Lerp)(l.factor1,G.factor1,V),M=(0,R.Lerp)(l.factor2,G.factor2,V);D.remapData.z=N,D.remapData.w=M-N}))}function UD(D,l){const G=(0,R.Clamp)(l._actualFrame/l.targetStopDuration);C.GetCurrentGradient(G,l._lifeTimeGradients,((l,V)=>{const N=l,M=V,b=N.getFactor(),X=M.getFactor(),t=(G-N.gradient)/(M.gradient-N.gradient);D.lifeTime=(0,R.Lerp)(b,X,t)})),l._emitPower=(0,R.RandomRange)(l.minEmitPower,l.maxEmitPower)}function fD(D,l){D.lifeTime=(0,R.RandomRange)(l.minLifeTime,l.maxLifeTime),l._emitPower=(0,R.RandomRange)(l.minEmitPower,l.maxEmitPower)}function qD(D,l){0===l._emitPower?(D._initialDirection?D._initialDirection.V(D.direction):D._initialDirection=D.direction.clone(),D.direction.set(0,0,0)):(D._initialDirection=null,D.direction.scaleInPlace(l._emitPower)),D.direction.addInPlace(l._inheritedVelocityOffset)}function cD(D,l){D.angularSpeed=(0,R.RandomRange)(l.minAngularSpeed,l.maxAngularSpeed),D.angle=(0,R.RandomRange)(l.minInitialRotation,l.maxInitialRotation)}function vD(D,l){D._currentAngularSpeedGradient=l._angularSpeedGradients[0],D.angularSpeed=D._currentAngularSpeedGradient.getFactor(),D._currentAngularSpeed1=D.angularSpeed,l._angularSpeedGradients.length>1?D._currentAngularSpeed2=l._angularSpeedGradients[1].getFactor():D._currentAngularSpeed2=D._currentAngularSpeed1,D.angle=(0,R.RandomRange)(l.minInitialRotation,l.maxInitialRotation)}function ZD(D,l){D._initialStartSpriteCellId=l.startSpriteCellID,D._initialEndSpriteCellId=l.endSpriteCellID,D._initialSpriteCellLoop=l.spriteCellLoop}function JD(D,l){D.previousItem=l.previousItem,D.nextItem=l,l.previousItem&&(l.previousItem.nextItem=D),l.previousItem=D}function YD(D,l){D.previousItem=l,D.nextItem=l.nextItem,l.nextItem&&(l.nextItem.previousItem=D),l.nextItem=D}function zD(D,l){let G=l;for(;G.nextItem;)G=G.nextItem;D.previousItem=G,D.nextItem=G.nextItem,G.nextItem=D}function ED(D){D.previousItem&&(D.previousItem.nextItem=D.nextItem),D.nextItem&&(D.nextItem.previousItem=D.previousItem)}class PD extends t{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(D){this._startDirectionFunction!==D&&(this._startDirectionFunction=D,this._directionProcessing.process=D?gD:nD)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(D){this._startPositionFunction!==D&&(this._startPositionFunction=D,this._positionCreation.process=D?hD:HD)}set onDispose(D){this._onDisposeObserver&&this.Vb.remove(this._onDisposeObserver),this._onDisposeObserver=this.Vb.add(D)}get X(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(D){this._useRampGradients!==D&&(this._useRampGradients=D,this._resetEffect(),D?(this._rampCreation={process:OD,previousItem:null,nextItem:null},YD(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:sD,previousItem:null,nextItem:null},YD(this._remapGradientProcessing,this._gravityProcessing)):(ED(this._rampCreation),ED(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(D){this._isLocal!==D&&(this._isLocal=D,D?(this._isLocalCreation={process:xD,previousItem:null,nextItem:null},YD(this._isLocalCreation,this._positionCreation)):ED(this._isLocalCreation))}get particles(){return this.oj}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(D){this._animationSheetEnabled!==D&&(this._animationSheetEnabled=D,D?(this._sheetCreation={process:ZD,previousItem:null,nextItem:null},YD(this._sheetCreation,this._colorCreation)):ED(this._sheetCreation),this._reset())}getActiveCount(){return this.oj.length}getClassName(){return"sb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var D;let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(D=this._customWrappers[l])||void 0===D?void 0:D.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[D]??this._customWrappers[0]}setCustomEffect(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[l]=new DD.c(this._engine),this._customWrappers[l].effect=D,this._customWrappers[l].drawContext&&(this._customWrappers[l].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new w.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(D){if(this.noiseTexture!==D){if(this._noiseTexture=D,!D)return ED(this._noiseCreation),void ED(this._noiseProcessing);this._noiseCreation={process:uD,previousItem:null,nextItem:null},YD(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:BD,previousItem:null,nextItem:null},YD(this._noiseProcessing,this._positionProcessing)}}constructor(D,l,G){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]&&arguments[4],X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(D),this._emitterInverseWorldMatrix=V.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new V.Kl,this.Vb=new w.e,this.onStoppedObservable=new w.e,this.onStartedObservable=new w.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.oj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new b.Wb(0,0,0,0),this._colorDiff=new b.Wb(0,0,0,0),this._scaledDirection=V.Kl.Zero(),this._scaledGravity=V.Kl.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=D=>{},this.recycleParticle=D=>{const l=this.oj.pop();l!==D&&l.copyTo(D),this._stockParticles.push(l)},this._createParticle=()=>{let D;return 0!==this._stockParticles.length?(D=this._stockParticles.pop(),D._reset()):D=new Q(this),this._prepareParticle(D),D},this.paused=!1,this._shadersLoaded=!1,this._capacity=l,this._epsilon=X,G&&"Scene"!==G.getClassName()?(this._engine=G,this.defaultProjectionMatrix=V.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=G||a.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.xj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:fD,previousItem:null,nextItem:null},this._positionCreation={process:HD,previousItem:null,nextItem:null},YD(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:nD,previousItem:null,nextItem:null},YD(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:qD,previousItem:null,nextItem:null},YD(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:WD,previousItem:null,nextItem:null},YD(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:cD,previousItem:null,nextItem:null},YD(this._angleCreation,this._sizeCreation),this._colorCreation={process:ND,previousItem:null,nextItem:null},YD(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,t||(this._colorProcessing={process:XD,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:RD,previousItem:null,nextItem:null},YD(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:dD,previousItem:null,nextItem:null},YD(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:rD,previousItem:null,nextItem:null},YD(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:ID,previousItem:null,nextItem:null},YD(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=M,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new DD.c(this._engine)},this._customWrappers[0].effect=N,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new g,this.updateFunction=D=>{var l;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(l=this.noiseTexture.getContent())||void 0===l||l.then((D=>{this._noiseTextureData=D})));const G=D===this.oj;for(let V=0;V<D.length;V++){const l=D[V];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const N=l.age;if(l.age+=this._tempScaledUpdateSpeed,l.age>l.lifeTime){const D=l.age-N,G=l.lifeTime-N;this._tempScaledUpdateSpeed=G*this._tempScaledUpdateSpeed/D,l.age=l.lifeTime}this._ratio=l.age/l.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let M=this._updateQueueStart;for(;M;)M.process(l,this),M=M.nextItem;if(this._isAnimationSheetEnabled&&!t&&l.updateCellIndex(),l._inheritParticleInfoToSubEmitters(),l.age>=l.lifeTime){if(this._emitFromParticle(l),l._attachedSubEmitters){for(const D of l._attachedSubEmitters)D.particleSystem.disposeOnStop=!0,D.particleSystem.stop();l._attachedSubEmitters=null}this.recycleParticle(l),G&&V--}else;}}}serialize(D){throw new Error("Method not implemented.")}clone(D,l){throw new Error("Method not implemented.")}_addFactorGradient(D,l,G,V){const N=new T(l,G,V);D.push(N),D.sort(((D,l)=>D.gradient<l.gradient?-1:D.gradient>l.gradient?1:0))}_removeFactorGradient(D,l){if(!D)return;let G=0;for(const V of D){if(V.gradient===l){D.splice(G,1);break}G++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=UD:this._lifeTimeCreation.process=fD}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:yD,previousItem:null,nextItem:null},YD(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(ED(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(D){this.targetStopDuration!==D&&(this._targetStopDuration=D,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(D,l,G){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,D,l,G),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(D){return this._removeFactorGradient(this._lifeTimeGradients,D),this._syncLifeTimeCreation(),this}addSizeGradient(D,l,G){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=iD,this._sizeGradientProcessing={process:SD,previousItem:null,nextItem:null},JD(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,D,l,G),this}removeSizeGradient(D){var l;return this._removeFactorGradient(this._sizeGradients,D),0===(null===(l=this._sizeGradients)||void 0===l?void 0:l.length)&&(ED(this._sizeGradientProcessing),this._sizeCreation.process=WD),this}addColorRemapGradient(D,l,G){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,D,l,G),this}removeColorRemapGradient(D){return this._removeFactorGradient(this._colorRemapGradients,D),this}addAlphaRemapGradient(D,l,G){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,D,l,G),this}removeAlphaRemapGradient(D){return this._removeFactorGradient(this._alphaRemapGradients,D),this}addAngularSpeedGradient(D,l,G){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=vD,this._angularSpeedGradientProcessing={process:tD,previousItem:null,nextItem:null},JD(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,D,l,G),this}removeAngularSpeedGradient(D){var l;return this._removeFactorGradient(this._angularSpeedGradients,D),0===(null===(l=this._angularSpeedGradients)||void 0===l?void 0:l.length)&&(this._angleCreation.process=cD,ED(this._angularSpeedGradientProcessing)),this}addVelocityGradient(D,l,G){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:jD,previousItem:null,nextItem:null},YD(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:KD,previousItem:null,nextItem:null},JD(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,D,l,G),this}removeVelocityGradient(D){var l;return this._removeFactorGradient(this._velocityGradients,D),0===(null===(l=this._velocityGradients)||void 0===l?void 0:l.length)&&(ED(this._velocityCreation),ED(this._velocityGradientProcessing)),this}addLimitVelocityGradient(D,l,G){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:eD,previousItem:null,nextItem:null},YD(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:FD,previousItem:null,nextItem:null},YD(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,D,l,G),this}removeLimitVelocityGradient(D){var l;return this._removeFactorGradient(this._limitVelocityGradients,D),0===(null===(l=this._limitVelocityGradients)||void 0===l?void 0:l.length)&&(ED(this._limitVelocityCreation),ED(this._limitVelocityGradientProcessing)),this}addDragGradient(D,l,G){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:oD,previousItem:null,nextItem:null},JD(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:LD,previousItem:null,nextItem:null},JD(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,D,l,G),this}removeDragGradient(D){var l;return this._removeFactorGradient(this._dragGradients,D),0===(null===(l=this._dragGradients)||void 0===l?void 0:l.length)&&(ED(this._dragCreation),ED(this._dragGradientProcessing)),this}addEmitRateGradient(D,l,G){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,D,l,G),this}removeEmitRateGradient(D){return this._removeFactorGradient(this._emitRateGradients,D),this}addStartSizeGradient(D,l,G){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,D,l,G),this._syncStartSizeCreation(),this}removeStartSizeGradient(D){return this._removeFactorGradient(this._startSizeGradients,D),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const D=new Uint8Array(4*this._rawTextureWidth),l=b.TmpColors.hl[0];for(let G=0;G<this._rawTextureWidth;G++){const V=G/this._rawTextureWidth;C.GetCurrentGradient(V,this._rampGradients,((V,N,M)=>{b.hl.LerpToRef(V.color,N.color,M,l),D[4*G]=255*l.r,D[4*G+1]=255*l.g,D[4*G+2]=255*l.b,D[4*G+3]=255}))}this._rampGradientsTexture=A.e.CreateRGBATexture(D,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((D,l)=>D.gradient<l.gradient?-1:D.gradient>l.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(D,l){this._rampGradients||(this._rampGradients=[]);const G=new m(D,l);return this._rampGradients.push(G),this._syncRampGradientTexture(),this}removeRampGradient(D){return this._removeGradientAndTexture(D,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(D,l,G){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=MD,this._colorProcessing.process=bD);const V=new k(D,l,G);return this._colorGradients.push(V),this._colorGradients.sort(((D,l)=>D.gradient<l.gradient?-1:D.gradient>l.gradient?1:0)),this}removeColorGradient(D){if(!this._colorGradients)return this;let l=0;for(const G of this._colorGradients){if(G.gradient===D){this._colorGradients.splice(l,1);break}l++}return 0===this._colorGradients.length&&(this._colorCreation.process=ND,this._colorProcessing.process=XD),this}resetDrawCache(){if(this._drawWrappers){for(const D of this._drawWrappers)if(D)for(const l of D)null===l||void 0===l||l.dispose();this._drawWrappers=[]}}_fetchR(D,l,G,V,N){return N[4*(((D=.5*Math.abs(D)+.5)*G%G|0)+((l=.5*Math.abs(l)+.5)*V%V|0)*G)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const D=this._engine,l=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*l),this._vertexBuffer=new o.d(D,this._vertexData,!0,l);let G=0;const V=this._vertexBuffer.createVertexBuffer(o.e.PositionKind,G,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[o.e.PositionKind]=V,G+=3;const N=this._vertexBuffer.createVertexBuffer(o.e.ColorKind,G,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[o.e.ColorKind]=N,G+=4;const M=this._vertexBuffer.createVertexBuffer("angle",G,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=M,G+=1;const b=this._vertexBuffer.createVertexBuffer("size",G,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=b,G+=2,this._isAnimationSheetEnabled){const D=this._vertexBuffer.createVertexBuffer("cellIndex",G,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=D,G+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const D=this._vertexBuffer.createVertexBuffer("direction",G,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=D,G+=3}if(this._useRampGradients){const D=this._vertexBuffer.createVertexBuffer("remapData",G,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=D,G+=4}let X;if(this._useInstancing){const l=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new o.d(D,l,!1,2),X=this._spriteBuffer.createVertexBuffer("offset",0,2)}else X=this._vertexBuffer.createVertexBuffer("offset",G,2,this._vertexBufferSize,this._useInstancing),G+=2;this._vertexBuffers.offset=X,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const D=[],l=[];let G=0;for(let V=0;V<this._capacity;V++)D.push(G),D.push(G+1),D.push(G+2),D.push(G),D.push(G+2),D.push(G+3),l.push(G,G+1,G+1,G+2,G+2,G+3,G+3,G,G,G+3),G+=4;this._indexBuffer=this._engine.createIndexBuffer(D),this._linesIndexBuffer=this._engine.createIndexBuffer(l)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(D)setTimeout((()=>{this.start(0)}),D);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var l;-1!==(null===(l=this.Vl)||void 0===l?void 0:l.getClassName().indexOf("Mesh"))&&this.Vl.hb(!0);const D=this.noiseTexture;if(D&&D.onGeneratedObservable)D.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let l=0;l<this.preWarmCycles;l++)this.animate(!0),D.render()}))}));else for(let l=0;l<this.preWarmCycles;l++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(D))}_postStop(D){}reset(){this._stockParticles.length=0,this.oj.length=0}_appendParticleVertex(D,l,G,N){let M=D*this._vertexBufferSize;if(this._vertexData[M++]=l.position.x+this.BR.x,this._vertexData[M++]=l.position.y+this.BR.y,this._vertexData[M++]=l.position.z+this.BR.z,this._vertexData[M++]=l.color.r,this._vertexData[M++]=l.color.g,this._vertexData[M++]=l.color.b,this._vertexData[M++]=l.color.a,this._vertexData[M++]=l.angle,this._vertexData[M++]=l.scale.x*l.size,this._vertexData[M++]=l.scale.y*l.size,this._isAnimationSheetEnabled&&(this._vertexData[M++]=l.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[M++]=l.direction.x,this._vertexData[M++]=l.direction.y,this._vertexData[M++]=l.direction.z);else if(l._initialDirection){let D=l._initialDirection;this.isLocal&&(V.Kl.TransformNormalToRef(D,this._emitterWorldMatrix,V.TmpVectors.Kl[0]),D=V.TmpVectors.Kl[0]),0===D.x&&0===D.z&&(D.x=.001),this._vertexData[M++]=D.x,this._vertexData[M++]=D.y,this._vertexData[M++]=D.z}else{let D=l.direction;this.isLocal&&(V.Kl.TransformNormalToRef(D,this._emitterWorldMatrix,V.TmpVectors.Kl[0]),D=V.TmpVectors.Kl[0]),0===D.x&&0===D.z&&(D.x=.001),this._vertexData[M++]=D.x,this._vertexData[M++]=D.y,this._vertexData[M++]=D.z}this._useRampGradients&&l.remapData&&(this._vertexData[M++]=l.remapData.x,this._vertexData[M++]=l.remapData.y,this._vertexData[M++]=l.remapData.z,this._vertexData[M++]=l.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===G?G=this._epsilon:1===G&&(G=1-this._epsilon),0===N?N=this._epsilon:1===N&&(N=1-this._epsilon)),this._vertexData[M++]=G,this._vertexData[M++]=N)}_prepareParticle(D){}_createNewOnes(D){let l;for(let G=0;G<D&&this.oj.length!==this._capacity;G++){l=this._createParticle(),this.oj.push(l);let D=this._createQueueStart;for(;D;)D.process(l,this),D=D.nextItem;l._inheritParticleInfoToSubEmitters()}}_update(D){if(this._alive=this.oj.length>0,this.Vl.position){const D=this.Vl;this._emitterWorldMatrix=D.getWorldMatrix()}else{const D=this.Vl;this._emitterWorldMatrix=V.Matrix.Translation(D.x,D.y,D.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.oj),this._createNewOnes(D)}static _GetAttributeNamesOrOptions(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V=[o.e.PositionKind,o.e.ColorKind,"angle","offset","size"];return D&&V.push("cellIndex"),l||V.push("direction"),G&&V.push("remapData"),V}static _GetEffectCreationOptions(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,lD.d)(V),D&&V.push("particlesInfos"),l&&V.push("logarithmicDepthConstant"),G&&(V.push("vFogInfos"),V.push("vFogColor")),V}fillDefines(D,l){let G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,lD.k)(this,this._scene,D),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&D.push("#define FOG")),this._isAnimationSheetEnabled&&D.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&D.push("#define LOGARITHMICDEPTH"),l===t.BLENDMODE_MULTIPLY&&D.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&D.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(D.push("#define BILLBOARD"),this.billboardMode){case 2:D.push("#define BILLBOARDY");break;case 8:case 9:D.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&D.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:D.push("#define BILLBOARDMODE_ALL")}G&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),D.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(D,l,G){l.push(...PD._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),D.push(...PD._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),G.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,VD.g)(D,this._imageProcessingConfigurationDefines),(0,VD.d)(G,this._imageProcessingConfigurationDefines))}_getWrapper(D){const l=this._getCustomDrawWrapper(D);if(null!==l&&void 0!==l&&l.effect)return l;const G=[];this.fillDefines(G,D);const V=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let N=this._drawWrappers[V];N||(N=this._drawWrappers[V]=[]);let M=N[D];M||(M=new DD.c(this._engine),M.drawContext&&(M.drawContext.useInstancing=this._useInstancing),N[D]=M);const b=G.join("\n");if(M.defines!==b){const D=[],l=[],G=[];this.fillUniformsAttributesAndSamplerNames(l,D,G),M.setEffect(this._engine.createEffect("particles",D,l,G,b,void 0,void 0,void 0,void 0,this._shaderLanguage),b)}return M}animate(){var D;let l,G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!G&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(G?this.preWarmStepOffset:(null===(D=this._scene)||void 0===D?void 0:D.getAnimationRatio())||1),this.manualEmitCount>-1)l=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let D=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const l=this._actualFrame/this.targetStopDuration;C.GetCurrentGradient(l,this._emitRateGradients,((l,G,V)=>{l!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=G.getFactor(),this._currentEmitRateGradient=l),D=(0,R.Lerp)(this._currentEmitRate1,this._currentEmitRate2,V)}))}l=D*this._scaledUpdateSpeed|0,this._newPartsExcess+=D*this._scaledUpdateSpeed-l}if(this._newPartsExcess>1&&(l+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?l=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(l),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!G){let D=0;for(let l=0;l<this.oj.length;l++){const G=this.oj[l];this._appendParticleVertices(D,G),D+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.oj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(D,l){this._appendParticleVertex(D++,l,0,0),this._useInstancing||(this._appendParticleVertex(D++,l,1,0),this._appendParticleVertex(D++,l,1,1),this._appendParticleVertex(D++,l,0,1))}rebuild(){var D;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(D=this._spriteBuffer)||void 0===D||D._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!PD.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(G.bind(G,13218)),Promise.resolve().then(G.bind(G,13154))])):await Promise.all([Promise.resolve().then(G.bind(G,13139)),Promise.resolve().then(G.bind(G,13127))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Vl||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==t.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(t.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(t.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(D){const l=this._getWrapper(D),G=l.effect,N=this._engine;N.enableEffect(l);const M=this.defaultViewMatrix??this._scene.getViewMatrix();if(G.setTexture("diffuseSampler",this.particleTexture),G.setMatrix("view",M),G.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const D=this.particleTexture.getBaseSize();G.setFloat3("particlesInfos",this.spriteCellWidth/D.width,this.spriteCellHeight/D.height,this.spriteCellWidth/D.width)}if(G.setVector2("translationPivot",this.translationPivot),G.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const D=this._scene.activeCamera;G.setVector3("eyePosition",D.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),G.setTexture("rampSampler",this._rampGradientsTexture));const b=G.defines;var X,t,R,n,g,j;(this._scene&&((0,lD.f)(G,this,this._scene),this.applyFog&&(0,GD.g)(this._scene,void 0,G)),b.indexOf("#define BILLBOARDMODE_ALL")>=0&&(M.invertToRef(V.TmpVectors.Matrix[0]),G.setMatrix("invView",V.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?N.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,G):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,G)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?N.bindBuffers(this._vertexBuffers,null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?this._linesIndexBuffer:this._indexBuffer,G):N.bindBuffers(this._vertexBuffers,null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?this._linesIndexBufferUseInstancing:null,G);(this.useLogarithmicDepth&&this._scene&&(0,GD.j)(b,G,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(G),this._setEngineBasedOnBlendMode(D),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(G),this._useInstancing)?null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?N.drawElementsType(6,0,10,this.oj.length):N.drawArraysType(7,0,4,this.oj.length):null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?N.drawElementsType(1,0,10*this.oj.length):N.drawElementsType(0,0,6*this.oj.length);return this.oj.length}render(){if(!this.isReady()||!this.oj.length)return 0;const D=this._engine;D.setState&&(D.setState(!1),this.forceDepthWrite&&D.setDepthWrite(!0));let l=0;return l=this.blendMode===t.BLENDMODE_MULTIPLYADD?this._render(t.BLENDMODE_MULTIPLY)+this._render(t.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),l}_onDispose(){}dispose(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),D&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),D&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(l,G),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const D=this._scene.xj.indexOf(this);D>-1&&this._scene.xj.splice(D,1),this._scene._activeParticleSystems.dispose()}this.Vb.notifyObservers(this),this.Vb.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}PD.ForceGLSL=!1;var pD,kD=G(11563);!function(D){D[D.ATTACHED=0]="ATTACHED",D[D.END=1]="END"}(pD||(pD={}));class mD{constructor(D){if(this.particleSystem=D,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!D.Vl||!D.Vl.dispose){const l=(0,X.b)("BABYLON.AbstractMesh");D.Vl=new l("SubemitterSystemEmitter",D.uD()),D._disposeEmitterOnDispose=!0}}clone(){let D=this.particleSystem.Vl;if(D){if(D instanceof V.Kl)D=D.clone();else if(-1!==D.getClassName().indexOf("Mesh")){D=new((0,X.b)("BABYLON.Mesh"))("",D.uD()),D.isVisible=!1}}else D=new V.Kl;const l=new mD(this.particleSystem.clone(this.particleSystem.name,D));return l.particleSystem.name+="Clone",l.type=this.type,l.inheritDirection=this.inheritDirection,l.inheritedVelocityAmount=this.inheritedVelocityAmount,l.particleSystem._disposeEmitterOnDispose=!0,l.particleSystem.disposeOnStop=!0,l}serialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const l={};return l.type=this.type,l.inheritDirection=this.inheritDirection,l.inheritedVelocityAmount=this.inheritedVelocityAmount,l.particleSystem=this.particleSystem.serialize(D),l}static _ParseParticleSystem(D,l,G){throw(0,kD.d)("ParseParticle")}static Parse(D,l,G){const V=D.particleSystem,N=new mD(mD._ParseParticleSystem(V,l,G,!0));return N.type=D.type,N.inheritDirection=D.inheritDirection,N.inheritedVelocityAmount=D.inheritedVelocityAmount,N.particleSystem._isSubEmitter=!0,N}dispose(){this.particleSystem.dispose()}}var TD=G(11613);function CD(D,l){const G=new H;return G.direction1=D,G.direction2=l,G}function wD(){return new d(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function AD(){return new h(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function aD(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V.Kl(0,1,0),G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Kl(0,1,0);return new x(D,l,G)}function QD(){return new K(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Dl(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Kl(0,1,0),M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new V.Kl(0,1,0);return new F(D,l,G,N,M)}function ll(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new j(D,l)}function Gl(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Kl(0,1,0),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Kl(0,1,0);return new e(D,l,G,N)}const Vl=V.Kl.Zero(),Nl=V.Kl.Zero(),Ml=V.Kl.Zero();class bl{constructor(){this.strength=0,this.position=V.Kl.Zero()}_processParticle(D,l){this.position.subtractToRef(D.position,Vl);const G=Vl.lengthSquared()+1;Vl.normalize().scaleToRef(this.strength/G,Nl),Nl.scaleToRef(l._tempScaledUpdateSpeed,Ml),D.direction.addInPlace(Ml)}serialize(){return{position:this.position.gb(),strength:this.strength}}}class Xl extends PD{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=D=>{if(!this._subEmitters||0===this._subEmitters.length)return;const l=Math.floor(Math.random()*this._subEmitters.length);for(const G of this._subEmitters[l])if(1===G.type){const l=G.clone();D._inheritParticleInfoToSubEmitter(l),l.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(l.particleSystem),l.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(D,l){const G=CD(D,l);return this.particleEmitterType=G,G}get flowMap(){return this._flowMap}set flowMap(D){this._flowMap!==D&&(this._flowMap=D,this._flowMapUpdate&&(ED(this._flowMapUpdate),this._flowMapUpdate=null),D&&(this._flowMapUpdate={process:D=>{var l;const G=null===(l=this.uD())||void 0===l?void 0:l.getTransformMatrix();this._flowMap._processParticle(D,this.flowMapStrength*this._tempScaledUpdateSpeed,G)},previousItem:null,nextItem:null},YD(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(D){this._attractors.push(D),1===this._attractors.length&&(this._attractorUpdate={process:D=>{for(const l of this._attractors)l._processParticle(D,this)},previousItem:null,nextItem:null},YD(this._attractorUpdate,this._directionProcessing))}removeAttractor(D){const l=this._attractors.indexOf(D);-1!==l&&this._attractors.splice(l,1),0===this._attractors.length&&ED(this._attractorUpdate)}start(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(D)}createHemisphericEmitter(){const D=wD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=D,D}createSphereEmitter(){const D=AD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=D,D}createDirectedSphereEmitter(){const D=aD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V.Kl(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Kl(0,1,0));return this.particleEmitterType=D,D}createCylinderEmitter(){const D=QD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=D,D}createDirectedCylinderEmitter(){const D=Dl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Kl(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new V.Kl(0,1,0));return this.particleEmitterType=D,D}createConeEmitter(){const D=ll(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=D,D}createDirectedConeEmitter(){const D=Gl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Kl(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Kl(0,1,0));return this.particleEmitterType=D,D}createBoxEmitter(D,l,G,V){const N=new g;return this.particleEmitterType=N,this.direction1=D,this.direction2=l,this.minEmitBox=G,this.maxEmitBox=V,N}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const D of this.subEmitters)D instanceof Xl?this._subEmitters.push([new mD(D)]):D instanceof mD?this._subEmitters.push([D]):D instanceof Array&&this._subEmitters.push(D)}_stopSubEmitters(){if(this.activeSubSystems){for(const D of this.activeSubSystems)D.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const D=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==D&&this._rootParticleSystem.activeSubSystems.splice(D,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(D){D&&this._stopSubEmitters()}_prepareParticle(D){if(this._subEmitters&&this._subEmitters.length>0){const l=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];D._attachedSubEmitters=[];for(const G of l)if(0===G.type){const l=G.clone();D._attachedSubEmitters.push(l),l.particleSystem.start()}}}_onDispose(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),D&&this.particles)for(const G of this.particles)if(G._attachedSubEmitters)for(let D=G._attachedSubEmitters.length-1;D>=0;D-=1)G._attachedSubEmitters[D].dispose();if(l&&this.activeSubSystems)for(let G=this.activeSubSystems.length-1;G>=0;G-=1)this.activeSubSystems[G].dispose();if(this._subEmitters&&this._subEmitters.length){for(let D=0;D<this._subEmitters.length;D++)for(const l of this._subEmitters[D])l.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Vl&&this.Vl.dispose&&this.Vl.dispose(!0)}static _Parse(D,l,G,N){let M;M=G instanceof TD.e?null:G;const t=(0,X.b)("BABYLON.Texture");if(t&&M&&(D.texture?l.particleTexture=t.Parse(D.texture,M,N):D.textureName&&(l.particleTexture=new t(N+D.textureName,M,!1,void 0===D.invertY||D.invertY),l.particleTexture.name=D.textureName)),D.emitterId||0===D.emitterId||void 0!==D.Vl?D.emitterId&&M?l.Vl=M.getLastMeshById(D.emitterId):l.Vl=V.Kl.xl(D.Vl):l.Vl=V.Kl.Zero(),l.isLocal=!!D.isLocal,void 0!==D.renderingGroupId&&(l.renderingGroupId=D.renderingGroupId),void 0!==D.isBillboardBased&&(l.isBillboardBased=D.isBillboardBased),void 0!==D.billboardMode&&(l.billboardMode=D.billboardMode),void 0!==D.useLogarithmicDepth&&(l.useLogarithmicDepth=D.useLogarithmicDepth),D.animations){for(let G=0;G<D.animations.length;G++){const V=D.animations[G],N=(0,X.b)("BABYLON.Animation");N&&l.animations.push(N.Parse(V))}l.beginAnimationOnStart=D.beginAnimationOnStart,l.beginAnimationFrom=D.beginAnimationFrom,l.beginAnimationTo=D.beginAnimationTo,l.beginAnimationLoop=D.beginAnimationLoop}if(D.autoAnimate&&M&&M.beginAnimation(l,D.autoAnimateFrom,D.autoAnimateTo,D.autoAnimateLoop,D.autoAnimateSpeed||1),l.startDelay=0|D.startDelay,l.minAngularSpeed=D.minAngularSpeed,l.maxAngularSpeed=D.maxAngularSpeed,l.minSize=D.minSize,l.maxSize=D.maxSize,D.minScaleX&&(l.minScaleX=D.minScaleX,l.maxScaleX=D.maxScaleX,l.minScaleY=D.minScaleY,l.maxScaleY=D.maxScaleY),void 0!==D.preWarmCycles&&(l.preWarmCycles=D.preWarmCycles,l.preWarmStepOffset=D.preWarmStepOffset),void 0!==D.minInitialRotation&&(l.minInitialRotation=D.minInitialRotation,l.maxInitialRotation=D.maxInitialRotation),l.minLifeTime=D.minLifeTime,l.maxLifeTime=D.maxLifeTime,l.minEmitPower=D.minEmitPower,l.maxEmitPower=D.maxEmitPower,l.emitRate=D.emitRate,l.gravity=V.Kl.xl(D.gravity),D.noiseStrength&&(l.noiseStrength=V.Kl.xl(D.noiseStrength)),l.color1=b.Wb.xl(D.color1),l.color2=b.Wb.xl(D.color2),l.colorDead=b.Wb.xl(D.colorDead),l.updateSpeed=D.updateSpeed,l.targetStopDuration=D.targetStopDuration,l.blendMode=D.blendMode,D.colorGradients)for(const V of D.colorGradients)l.addColorGradient(V.gradient,b.Wb.xl(V.color1),V.color2?b.Wb.xl(V.color2):void 0);if(D.rampGradients){for(const G of D.rampGradients)l.addRampGradient(G.gradient,b.hl.xl(G.color));l.useRampGradients=D.useRampGradients}if(D.colorRemapGradients)for(const V of D.colorRemapGradients)l.addColorRemapGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(D.alphaRemapGradients)for(const V of D.alphaRemapGradients)l.addAlphaRemapGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(D.sizeGradients)for(const V of D.sizeGradients)l.addSizeGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(D.angularSpeedGradients)for(const V of D.angularSpeedGradients)l.addAngularSpeedGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(D.velocityGradients)for(const V of D.velocityGradients)l.addVelocityGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(D.dragGradients)for(const V of D.dragGradients)l.addDragGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(D.emitRateGradients)for(const V of D.emitRateGradients)l.addEmitRateGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(D.startSizeGradients)for(const V of D.startSizeGradients)l.addStartSizeGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(D.lifeTimeGradients)for(const V of D.lifeTimeGradients)l.addLifeTimeGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2);if(D.limitVelocityGradients){for(const G of D.limitVelocityGradients)l.addLimitVelocityGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);l.limitVelocityDamping=D.limitVelocityDamping}if(D.noiseTexture&&M){const G=(0,X.b)("BABYLON.ProceduralTexture");l.noiseTexture=G.Parse(D.noiseTexture,M,N)}let R;if(D.particleEmitterType){switch(D.particleEmitterType.type){case"SphereParticleEmitter":R=new h;break;case"SphereDirectedParticleEmitter":R=new x;break;case"ConeEmitter":case"ConeParticleEmitter":R=new j;break;case"ConeDirectedParticleEmitter":R=new e;break;case"CylinderParticleEmitter":R=new K;break;case"CylinderDirectedParticleEmitter":R=new F;break;case"HemisphericParticleEmitter":R=new d;break;case"PointParticleEmitter":R=new H;break;case"MeshParticleEmitter":R=new L;break;case"CustomParticleEmitter":R=new r;break;default:R=new g}R.parse(D.particleEmitterType,M)}else R=new g,R.parse(D,M);l.particleEmitterType=R,l.startSpriteCellID=D.startSpriteCellID,l.endSpriteCellID=D.endSpriteCellID,l.spriteCellLoop=D.spriteCellLoop??!0,l.spriteCellWidth=D.spriteCellWidth,l.spriteCellHeight=D.spriteCellHeight,l.spriteCellChangeSpeed=D.spriteCellChangeSpeed,l.spriteRandomStartCell=D.spriteRandomStartCell,l.disposeOnStop=D.disposeOnStop??!1,l.manualEmitCount=D.manualEmitCount??-1}static Parse(D,l,G){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4?arguments[4]:void 0;const X=D.name;let t,R,n=null,g=null;if(l instanceof TD.e?t=l:(R=l,t=R.getEngine()),D.customShader&&t.createEffectForParticles){g=D.customShader;const l=g.shaderOptions.defines.length>0?g.shaderOptions.defines.join("\n"):"";n=t.createEffectForParticles(g.shaderPath.fragmentElement,g.shaderOptions.uniforms,g.shaderOptions.samplers,l)}const j=new Xl(X,M||D.nG,l,n,D.isAnimationSheetEnabled);if(j.customShader=g,j._rootUrl=G,D.id&&(j.id=D.id),D.subEmitters){j.subEmitters=[];for(const V of D.subEmitters){const D=[];for(const N of V)D.push(mD.Parse(N,l,G));j.subEmitters.push(D)}}if(D.attractors)for(const b of D.attractors){const D=new bl;D.position=V.Kl.xl(b.position),D.strength=b.strength,j.addAttractor(D)}return Xl._Parse(D,j,l,G),D.textureMask&&(j.textureMask=b.Wb.xl(D.textureMask)),D.BR&&(j.BR=V.Kl.xl(D.BR)),D.preventAutoStart&&(j.preventAutoStart=D.preventAutoStart),N||j.preventAutoStart||j.start(),j}serialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const l={};if(Xl._Serialize(l,this,D),l.textureMask=this.textureMask.gb(),l.customShader=this.customShader,l.preventAutoStart=this.preventAutoStart,l.BR=this.BR.gb(),this.subEmitters){l.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const G of this._subEmitters){const V=[];for(const l of G)V.push(l.serialize(D));l.subEmitters.push(V)}}if(this._attractors&&this._attractors.length){l.attractors=[];for(const D of this._attractors)l.attractors.push(D.serialize())}return l}static _Serialize(D,l,G){if(D.name=l.name,D.id=l.id,D.nG=l.getCapacity(),D.disposeOnStop=l.disposeOnStop,D.manualEmitCount=l.manualEmitCount,l.Vl.position){const G=l.Vl;D.emitterId=G.id}else{const G=l.Vl;D.Vl=G.gb()}l.particleEmitterType&&(D.particleEmitterType=l.particleEmitterType.serialize()),l.particleTexture&&(G?D.texture=l.particleTexture.serialize():(D.textureName=l.particleTexture.name,D.invertY=!!l.particleTexture._invertY)),D.isLocal=l.isLocal,U.c.AppendSerializedAnimations(l,D),D.beginAnimationOnStart=l.beginAnimationOnStart,D.beginAnimationFrom=l.beginAnimationFrom,D.beginAnimationTo=l.beginAnimationTo,D.beginAnimationLoop=l.beginAnimationLoop,D.startDelay=l.startDelay,D.renderingGroupId=l.renderingGroupId,D.isBillboardBased=l.isBillboardBased,D.billboardMode=l.billboardMode,D.minAngularSpeed=l.minAngularSpeed,D.maxAngularSpeed=l.maxAngularSpeed,D.minSize=l.minSize,D.maxSize=l.maxSize,D.minScaleX=l.minScaleX,D.maxScaleX=l.maxScaleX,D.minScaleY=l.minScaleY,D.maxScaleY=l.maxScaleY,D.minEmitPower=l.minEmitPower,D.maxEmitPower=l.maxEmitPower,D.minLifeTime=l.minLifeTime,D.maxLifeTime=l.maxLifeTime,D.emitRate=l.emitRate,D.gravity=l.gravity.gb(),D.noiseStrength=l.noiseStrength.gb(),D.color1=l.color1.gb(),D.color2=l.color2.gb(),D.colorDead=l.colorDead.gb(),D.updateSpeed=l.updateSpeed,D.targetStopDuration=l.targetStopDuration,D.blendMode=l.blendMode,D.preWarmCycles=l.preWarmCycles,D.preWarmStepOffset=l.preWarmStepOffset,D.minInitialRotation=l.minInitialRotation,D.maxInitialRotation=l.maxInitialRotation,D.startSpriteCellID=l.startSpriteCellID,D.spriteCellLoop=l.spriteCellLoop,D.endSpriteCellID=l.endSpriteCellID,D.spriteCellChangeSpeed=l.spriteCellChangeSpeed,D.spriteCellWidth=l.spriteCellWidth,D.spriteCellHeight=l.spriteCellHeight,D.spriteRandomStartCell=l.spriteRandomStartCell,D.isAnimationSheetEnabled=l.isAnimationSheetEnabled,D.useLogarithmicDepth=l.useLogarithmicDepth;const V=l.getColorGradients();if(V){D.colorGradients=[];for(const l of V){const G={gradient:l.gradient,color1:l.color1.gb()};l.color2?G.color2=l.color2.gb():G.color2=l.color1.gb(),D.colorGradients.push(G)}}const N=l.getRampGradients();if(N){D.rampGradients=[];for(const l of N){const G={gradient:l.gradient,color:l.color.gb()};D.rampGradients.push(G)}D.useRampGradients=l.useRampGradients}const M=l.getColorRemapGradients();if(M){D.colorRemapGradients=[];for(const l of M){const G={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?G.factor2=l.factor2:G.factor2=l.factor1,D.colorRemapGradients.push(G)}}const b=l.getAlphaRemapGradients();if(b){D.alphaRemapGradients=[];for(const l of b){const G={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?G.factor2=l.factor2:G.factor2=l.factor1,D.alphaRemapGradients.push(G)}}const X=l.getSizeGradients();if(X){D.sizeGradients=[];for(const l of X){const G={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?G.factor2=l.factor2:G.factor2=l.factor1,D.sizeGradients.push(G)}}const t=l.getAngularSpeedGradients();if(t){D.angularSpeedGradients=[];for(const l of t){const G={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?G.factor2=l.factor2:G.factor2=l.factor1,D.angularSpeedGradients.push(G)}}const R=l.getVelocityGradients();if(R){D.velocityGradients=[];for(const l of R){const G={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?G.factor2=l.factor2:G.factor2=l.factor1,D.velocityGradients.push(G)}}const n=l.getDragGradients();if(n){D.dragGradients=[];for(const l of n){const G={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?G.factor2=l.factor2:G.factor2=l.factor1,D.dragGradients.push(G)}}const g=l.getEmitRateGradients();if(g){D.emitRateGradients=[];for(const l of g){const G={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?G.factor2=l.factor2:G.factor2=l.factor1,D.emitRateGradients.push(G)}}const j=l.getStartSizeGradients();if(j){D.startSizeGradients=[];for(const l of j){const G={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?G.factor2=l.factor2:G.factor2=l.factor1,D.startSizeGradients.push(G)}}const e=l.getLifeTimeGradients();if(e){D.lifeTimeGradients=[];for(const l of e){const G={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?G.factor2=l.factor2:G.factor2=l.factor1,D.lifeTimeGradients.push(G)}}const K=l.getLimitVelocityGradients();if(K){D.limitVelocityGradients=[];for(const l of K){const G={gradient:l.gradient,factor1:l.factor1};void 0!==l.factor2?G.factor2=l.factor2:G.factor2=l.factor1,D.limitVelocityGradients.push(G)}D.limitVelocityDamping=l.limitVelocityDamping}l.noiseTexture&&(D.noiseTexture=l.noiseTexture.serialize())}clone(D,l){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V={...this._customWrappers};let N=null;const M=this._engine;if(M.createEffectForParticles&&null!=this.customShader){N=this.customShader;const D=N.shaderOptions.defines.length>0?N.shaderOptions.defines.join("\n"):"",l=M.createEffectForParticles(N.shaderPath.fragmentElement,N.shaderOptions.uniforms,N.shaderOptions.samplers,D);V[0]?V[0].effect=l:this.setCustomEffect(l,0)}const b=this.serialize(G),X=Xl.Parse(b,this._scene||this._engine,this._rootUrl);return X.name=D,X.customShader=N,X._customWrappers=V,void 0===l&&(l=this.Vl),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.Vl=l,this.preventAutoStart||X.start(),X}}Xl.BILLBOARDMODE_Y=2,Xl.BILLBOARDMODE_ALL=7,Xl.BILLBOARDMODE_STRETCHED=8,Xl.BILLBOARDMODE_STRETCHED_LOCAL=9,mD._ParseParticleSystem=Xl.Parse;var tl=G(11970),Rl=G(11963),nl=G(11843);nl.e.prototype.createTransformFeedback=function(){const D=this._gl.createTransformFeedback();if(!D)throw new Error("Unable to create Transform Feedback");return D},nl.e.prototype.deleteTransformFeedback=function(D){this._gl.deleteTransformFeedback(D)},nl.e.prototype.bindTransformFeedback=function(D){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,D)},nl.e.prototype.beginTransformFeedback=function(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(D?this._gl.POINTS:this._gl.TRIANGLES)},nl.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},nl.e.prototype.setTranformFeedbackVaryings=function(D,l){this._gl.transformFeedbackVaryings(D,l,this._gl.INTERLEAVED_ATTRIBS)},nl.e.prototype.bindTransformFeedbackBuffer=function(D){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,D?D.underlyingResource:null)},nl.e.prototype.readTransformFeedbackBuffer=function(D){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,D)};const gl="clipPlaneFragmentDeclaration2",jl="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";B.b.IncludesShadersStore[gl]||(B.b.IncludesShadersStore[gl]=jl);G(13026),G(13033),G(13037),G(13044),G(13053),G(13061),G(13063),G(13068);const el="gpuRenderParticlesPixelShader",Kl="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";B.b.ShadersStore[el]||(B.b.ShadersStore[el]=Kl);const Fl="clipPlaneVertexDeclaration2",dl="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";B.b.IncludesShadersStore[Fl]||(B.b.IncludesShadersStore[Fl]=dl);G(13073),G(13082),G(13084),G(13093);const Hl="gpuRenderParticlesVertexShader",hl="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";B.b.ShadersStore[Hl]||(B.b.ShadersStore[Hl]=hl);class xl extends t{static get IsSupported(){if(!a.d.LastCreatedEngine)return!1;const D=a.d.LastCreatedEngine.getCaps();return D.supportTransformFeedbacks||D.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(D){this._maxActiveParticleCount=Math.min(D,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(D){this.maxActiveParticleCount=D}createPointEmitter(D,l){const G=CD(D,l);return this.particleEmitterType=G,G}createHemisphericEmitter(){const D=wD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=D,D}createSphereEmitter(){const D=AD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=D,D}createDirectedSphereEmitter(){const D=aD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new V.Kl(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Kl(0,1,0));return this.particleEmitterType=D,D}createCylinderEmitter(){const D=QD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=D,D}createDirectedCylinderEmitter(){const D=Dl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Kl(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new V.Kl(0,1,0));return this.particleEmitterType=D,D}createConeEmitter(){const D=ll(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=D,D}createDirectedConeEmitter(){const D=Gl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new V.Kl(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new V.Kl(0,1,0));return this.particleEmitterType=D,D}createBoxEmitter(D,l,G,V){const N=new g;return this.particleEmitterType=N,this.direction1=D,this.direction2=l,this.minEmitBox=G,this.maxEmitBox=V,N}get flowMap(){return this._flowMap}set flowMap(D){this._flowMap!==D&&(this._flowMap=D)}isReady(){if(!this.Vl||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Xl.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Xl.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Xl.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";D?setTimeout((()=>{this.start(0)}),D):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var D;let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(D=this._customWrappers[l])||void 0===D?void 0:D.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[D]??this._customWrappers[0]}setCustomEffect(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[l]=new DD.c(this._engine),this._customWrappers[l].effect=D}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new w.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(D,l,G){return super._removeGradientAndTexture(D,l,G),this._releaseBuffers(),this}addColorGradient(D,l){this._colorGradients||(this._colorGradients=[]);const G=new k(D,l);return this._colorGradients.push(G),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(D&&this._colorGradients.sort(((D,l)=>D.gradient<l.gradient?-1:D.gradient>l.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(D){return this._removeGradientAndTexture(D,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const l in this._drawWrappers){var D;null===(D=this._drawWrappers[l].drawContext)||void 0===D||D.reset()}}_addFactorGradient(D,l,G){const V=new T(l,G);D.push(V),this._releaseBuffers()}addSizeGradient(D,l){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,D,l),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(D){return this._removeGradientAndTexture(D,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(D,l){if(!D)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&D.sort(((D,l)=>D.gradient<l.gradient?-1:D.gradient>l.gradient?1:0));const G=this;G[l]&&(G[l].dispose(),G[l]=null)}addAngularSpeedGradient(D,l){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,D,l),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(D){return this._removeGradientAndTexture(D,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(D,l){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,D,l),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(D){return this._removeGradientAndTexture(D,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(D,l){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,D,l),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(D){return this._removeGradientAndTexture(D,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(D,l){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,D,l),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(D){return this._removeGradientAndTexture(D,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(D){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(D,l,G){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(D),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Vb=new w.e,this.onStoppedObservable=new w.e,this.onStartedObservable=new w.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,G&&"Scene"!==G.getClassName()?(this._engine=G,this.defaultProjectionMatrix=V.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=G||a.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.xj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,X.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,X.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new DD.c(this._engine)},this._customWrappers[0].effect=N,this._drawWrappers={0:new DD.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(l=l??{}).randomTextureSize||delete l.randomTextureSize;const b={nG:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...l},t=l;isFinite(t)&&(b.nG=t),this._capacity=b.nG,this._maxActiveParticleCount=b.nG,this._currentActiveCount=0,this._isAnimationSheetEnabled=M,this.particleEmitterType=new g;const R=Math.min(this._engine.getCaps().maxTextureSize,b.randomTextureSize);let n=[];for(let V=0;V<R;++V)n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random());this._randomTexture=new A.e(new Float32Array(n),R,1,5,G,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,n=[];for(let V=0;V<R;++V)n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random());this._randomTexture2=new A.e(new Float32Array(n),R,1,5,G,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=R}_reset(){this._releaseBuffers()}_createVertexBuffers(D,l,G){const V={};V.position=l.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let N=3;V.age=l.createVertexBuffer("age",N,1,this._attributesStrideSize,!0),N+=1,V.size=l.createVertexBuffer("size",N,3,this._attributesStrideSize,!0),N+=3,V.life=l.createVertexBuffer("life",N,1,this._attributesStrideSize,!0),N+=1,N+=4,this.billboardMode===Xl.BILLBOARDMODE_STRETCHED&&(V.direction=l.createVertexBuffer("direction",N,3,this._attributesStrideSize,!0)),N+=3,this._platform.alignDataInBuffer&&(N+=1),this.particleEmitterType instanceof r&&(N+=3,this._platform.alignDataInBuffer&&(N+=1)),this._colorGradientsTexture||(V.color=l.createVertexBuffer("color",N,4,this._attributesStrideSize,!0),N+=4),this._isBillboardBased||(V.initialDirection=l.createVertexBuffer("initialDirection",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1)),this.noiseTexture&&(V.noiseCoordinates1=l.createVertexBuffer("noiseCoordinates1",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1),V.noiseCoordinates2=l.createVertexBuffer("noiseCoordinates2",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1)),V.angle=l.createVertexBuffer("angle",N,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?N++:N+=2,this._isAnimationSheetEnabled&&(V.cellIndex=l.createVertexBuffer("cellIndex",N,1,this._attributesStrideSize,!0),N+=1,this.spriteRandomStartCell&&(V.cellStartOffset=l.createVertexBuffer("cellStartOffset",N,1,this._attributesStrideSize,!0),N+=1)),V.offset=G.createVertexBuffer("offset",0,2),V.uv=G.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(V),this._platform.createVertexBuffers(D,V),this.resetDrawCache()}_initialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!D)return;const l=this._engine,G=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof r&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const N=this.particleEmitterType instanceof r,M=V.TmpVectors.Kl[0];let b=0;for(let V=0;V<this._capacity;V++)if(G.push(0),G.push(0),G.push(0),G.push(0),G.push(0),G.push(0),G.push(0),G.push(0),G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),N?(this.particleEmitterType.particleDestinationGenerator(V,null,M),G.push(M.x),G.push(M.y),G.push(M.z)):(G.push(0),G.push(0),G.push(0)),this._platform.alignDataInBuffer&&G.push(0),b+=16,N&&(this.particleEmitterType.particlePositionGenerator(V,null,M),G.push(M.x),G.push(M.y),G.push(M.z),this._platform.alignDataInBuffer&&G.push(0),b+=4),this._colorGradientsTexture||(G.push(0),G.push(0),G.push(0),G.push(0),b+=4),this.isBillboardBased||(G.push(0),G.push(0),G.push(0),this._platform.alignDataInBuffer&&G.push(0),b+=4),this.noiseTexture&&(G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),this._platform.alignDataInBuffer&&G.push(0),G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),this._platform.alignDataInBuffer&&G.push(0),b+=8),G.push(0),b+=1,this._angularSpeedGradientsTexture||(G.push(0),b+=1),this._isAnimationSheetEnabled&&(G.push(0),b+=1,this.spriteRandomStartCell&&(G.push(0),b+=1)),this._platform.alignDataInBuffer){let D=3-(b+3&3);for(b+=D;D-- >0;)G.push(0)}const X=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),t=this._platform.createParticleBuffer(G),R=this._platform.createParticleBuffer(G);this._buffer0=new o.d(l,t,!1,this._attributesStrideSize),this._buffer1=new o.d(l,R,!1,this._attributesStrideSize),this._spriteBuffer=new o.d(l,X,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let D=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(D+="\n#define BILLBOARD"),this._colorGradientsTexture&&(D+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(D+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(D+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(D+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(D+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(D+="\n#define DRAGGRADIENTS"),this._flowMap&&(D+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(D+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(D+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(D+="\n#define NOISE"),this.isLocal&&(D+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===D||(this._cachedUpdateDefines=D,this._updateBuffer=this._platform.createUpdateBuffer(D)),this._platform.isUpdateBufferReady()}_getWrapper(D){const l=this._getCustomDrawWrapper(D);if(null!==l&&void 0!==l&&l.effect)return l;const G=[];this.fillDefines(G,D);let V=this._drawWrappers[D];V||(V=new DD.c(this._engine),V.drawContext&&(V.drawContext.useInstancing=!0),this._drawWrappers[D]=V);const N=G.join("\n");if(V.defines!==N){const D=[],l=[],G=[];this.fillUniformsAttributesAndSamplerNames(l,D,G),V.setEffect(this._engine.createEffect("gpuRenderParticles",D,l,G,N),N)}return V}static _GetAttributeNamesOrOptions(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=[o.e.PositionKind,"age","life","size","angle"];return D||N.push(o.e.ColorKind),l&&N.push("cellIndex"),G||N.push("initialDirection"),V&&N.push("direction"),N.push("offset",o.e.UVKind),N}static _GetEffectCreationOptions(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V=["emitterWM","BR","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,lD.d)(V),D&&V.push("sheetInfos"),l&&V.push("logarithmicDepthConstant"),G&&(V.push("vFogInfos"),V.push("vFogColor")),V}fillDefines(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,lD.k)(this,this._scene,D),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Rl.b.FOGMODE_NONE&&D.push("#define FOG")),l===Xl.BLENDMODE_MULTIPLY&&D.push("#define BLENDMULTIPLYMODE"),this.isLocal&&D.push("#define LOCAL"),this.useLogarithmicDepth&&D.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(D.push("#define BILLBOARD"),this.billboardMode){case Xl.BILLBOARDMODE_Y:D.push("#define BILLBOARDY");break;case Xl.BILLBOARDMODE_STRETCHED:D.push("#define BILLBOARDSTRETCHED");break;case Xl.BILLBOARDMODE_ALL:D.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&D.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&D.push("#define ANIMATESHEET"),G&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),D.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(D,l,G){l.push(...xl._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Xl.BILLBOARDMODE_STRETCHED)),D.push(...xl._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),G.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(tl.b.PrepareUniforms(D,this._imageProcessingConfigurationDefines),tl.b.PrepareSamplers(G,this._imageProcessingConfigurationDefines))}animate(){var D;let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(l?this.preWarmStepOffset:(null===(D=this._scene)||void 0===D?void 0:D.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(D,l){const G=this[l];if(!D||!D.length||G)return;const V=new Float32Array(this._rawTextureWidth);for(let N=0;N<this._rawTextureWidth;N++){const l=N/this._rawTextureWidth;C.GetCurrentGradient(l,D,((D,l,G)=>{V[N]=(0,R.Lerp)(D.factor1,l.factor1,G)}))}this[l]=A.e.CreateRTexture(V,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[l].name=l.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const D=new Uint8Array(4*this._rawTextureWidth),l=b.TmpColors.Wb[0];for(let G=0;G<this._rawTextureWidth;G++){const V=G/this._rawTextureWidth;C.GetCurrentGradient(V,this._colorGradients,((V,N,M)=>{b.Wb.LerpToRef(V.color1,N.color1,M,l),D[4*G]=255*l.r,D[4*G+1]=255*l.g,D[4*G+2]=255*l.b,D[4*G+3]=255*l.a}))}this._colorGradientsTexture=A.e.CreateRGBATexture(D,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(D,l){var G,N,M,b;const X=this._getWrapper(D),t=X.effect;this._engine.enableEffect(X);const R=(null===(G=this._scene)||void 0===G?void 0:G.getViewMatrix())||V.Matrix.IdentityReadOnly;if(t.setMatrix("view",R),t.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),t.setTexture("diffuseSampler",this.particleTexture),t.setVector2("translationPivot",this.translationPivot),t.setVector3("BR",this.BR),this.isLocal&&t.setMatrix("emitterWM",l),this._colorGradientsTexture?t.setTexture("colorGradientSampler",this._colorGradientsTexture):t.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const D=this.particleTexture.getBaseSize();t.setFloat3("sheetInfos",this.spriteCellWidth/D.width,this.spriteCellHeight/D.height,D.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const D=this._scene.activeCamera;t.setVector3("eyePosition",D.globalPosition)}const n=t.defines;if(this._scene&&((0,lD.f)(t,this,this._scene),this.applyFog&&(0,GD.g)(this._scene,void 0,t)),n.indexOf("#define BILLBOARDMODE_ALL")>=0){const D=R.clone();D.invert(),t.setMatrix("invView",D)}return this.useLogarithmicDepth&&this._scene&&(0,GD.j)(n,t,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(t),this._setEngineBasedOnBlendMode(D),this._platform.bindDrawBuffers(this._targetIndex,t,null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(t),null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(b=this._scene)&&void 0!==b&&b.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(D){if(!this.Vl||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!D)if(this.Vl.position){D=this.Vl.getWorldMatrix()}else{const l=this.Vl;D=V.TmpVectors.Matrix[0],V.Matrix.TranslationToRef(l.x,l.y,l.z,D)}const l=this._engine,G=l.getDepthWrite();if(l.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const D=this.uD();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",D.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",D),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const N=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=N,l.setDepthWrite(G)}render(){let D,l=arguments.length>0&&void 0!==arguments[0]&&arguments[0],G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!l&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let D=0;D<this.preWarmCycles;D++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const D=0|this._accumulatedCount;this._accumulatedCount-=D,this._currentActiveCount+=D}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Vl.position){D=this.Vl.getWorldMatrix()}else{const l=this.Vl;D=V.TmpVectors.Matrix[0],V.Matrix.TranslationToRef(l.x,l.y,l.z,D)}const N=this._engine;this.updateInAnimate||this._update(D);let M=0;return l||G||(N.setState(!1),this.forceDepthWrite&&N.setDepthWrite(!0),M=this.blendMode===Xl.BLENDMODE_MULTIPLYADD?this._render(Xl.BLENDMODE_MULTIPLY,D)+this._render(Xl.BLENDMODE_ADD,D):this._render(this.blendMode,D),this._engine.setAlphaMode(0)),M}rebuild(){const D=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(D,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,D()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const l in this._drawWrappers){this._drawWrappers[l].dispose()}if(this._drawWrappers={},this._scene){const D=this._scene.xj.indexOf(this);D>-1&&this._scene.xj.splice(D,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let l=0;l<this._renderVertexBuffers.length;++l){const D=this._renderVertexBuffers[l];for(const l in D)D[l].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),D&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),D&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Vb.notifyObservers(this),this.Vb.clear()}clone(D,l){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const V={...this._customWrappers};let N=null;const M=this._engine;if(M.createEffectForParticles&&null!=this.customShader){N=this.customShader;const D=N.shaderOptions.defines.length>0?N.shaderOptions.defines.join("\n"):"";V[0]=M.createEffectForParticles(N.shaderPath.fragmentElement,N.shaderOptions.uniforms,N.shaderOptions.samplers,D,void 0,void 0,void 0,this)}const b=this.serialize(G),X=xl.Parse(b,this._scene||this._engine,this._rootUrl);return X.name=D,X.customShader=N,X._customWrappers=V,void 0===l&&(l=this.Vl),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.Vl=l,X}serialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const l={};return Xl._Serialize(l,this,D),l.activeParticleCount=this.activeParticleCount,l.randomTextureSize=this._randomTextureSize,l.customShader=this.customShader,l}static Parse(D,l,G){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0;const M=D.name;let b,X;l instanceof TD.e?b=l:(X=l,b=X.getEngine());const t=new xl(M,{nG:N||D.nG,randomTextureSize:D.randomTextureSize},l,null,D.isAnimationSheetEnabled);if(t._rootUrl=G,D.customShader&&b.createEffectForParticles){const l=D.customShader,G=l.shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"",V=b.createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,G,void 0,void 0,void 0,t);t.setCustomEffect(V,0),t.customShader=l}return D.id&&(t.id=D.id),D.activeParticleCount&&(t.activeParticleCount=D.activeParticleCount),Xl._Parse(D,t,l,G),D.preventAutoStart&&(t.preventAutoStart=D.preventAutoStart),V||t.preventAutoStart||t.start(),t}}var rl=G(11530),ol=G(13099),Ll=G(12102);class ul{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(D){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const l of this.systems)l.Vl=D;this._emitterNode=D}setEmitterAsSphere(D,l,G){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:D,renderingGroupId:l};const V=(0,ol.d)("emitterSphere",{diameter:D.diameter,segments:D.segments},G);V.renderingGroupId=l;const N=new Ll.Hl("emitterSphereMaterial",G);N.emissiveColor=D.color,V.material=N;for(const M of this.systems)M.Vl=V;this._emitterNode=V}start(D){for(const l of this.systems)D&&(l.Vl=D),l.start()}dispose(){for(const D of this.systems)D.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const l={systems:[]};for(const G of this.systems)l.systems.push(G.serialize(D));return this._emitterNode&&(l.Vl=this._emitterCreationOptions),l}static Parse(D,l){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3?arguments[3]:void 0;const N=new ul,M=this.BaseAssetsUrl+"/textures/";l=l||a.d.LastCreatedScene;for(const b of D.systems)N.systems.push(G?xl.Parse(b,l,M,!0,V):Xl.Parse(b,l,M,!0,V));if(D.Vl){const G=D.Vl.options;if("Sphere"===D.Vl.kind)N.setEmitterAsSphere({diameter:G.diameter,segments:G.segments,color:b.hl.xl(G.color)},D.Vl.renderingGroupId,l)}return N}}ul.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Bl=G(11565);class Il{static CreateDefault(D){let l,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,V=arguments.length>2?arguments[2]:void 0;l=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new xl("default system",{nG:G},V):new Xl("default system",G,V),l.Vl=D;const N=rl.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return l.particleTexture=new f.b(N,l.uD()),l.createConeEmitter(.1,Math.PI/4),l.color1=new b.Wb(1,1,1,1),l.color2=new b.Wb(1,1,1,1),l.colorDead=new b.Wb(1,1,1,0),l.minSize=.1,l.maxSize=.1,l.minEmitPower=2,l.maxEmitPower=2,l.updateSpeed=1/60,l.emitRate=30,l}static CreateAsync(D,l){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3?arguments[3]:void 0;l||(l=a.d.LastCreatedScene);const N={};return l.addPendingData(N),new Promise(((M,b)=>{if(G&&!xl.IsSupported)return l.removePendingData(N),b("Particle system with GPU is not supported.");rl.Tools.LoadFile(`${Il.BaseAssetsUrl}/systems/${D}.json`,(D=>{l.removePendingData(N);const b=JSON.parse(D.toString());return M(ul.Parse(b,l,G,V))}),void 0,void 0,void 0,(()=>(l.removePendingData(N),b(`An error occurred with the creation of your particle system. Check if your type '${D}' exists.`))))}))}static ExportSet(D){const l=new ul;for(const G of D)l.systems.push(G);return l}static ParseFromFileAsync(D,l,G){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",M=arguments.length>5?arguments[5]:void 0;return new Promise(((b,X)=>{const t=new Bl.d;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const l=JSON.parse(t.responseText);let X;X=V?xl.Parse(l,G,N,!1,M):Xl.Parse(l,G,N,!1,M),D&&(X.name=D),b(X)}else X("Unable to load the particle system")})),t.open("GET",l),t.send()}))}static ParseFromSnippetAsync(D,l){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",N=arguments.length>4?arguments[4]:void 0;if("_BLANK"===D){const D=this.CreateDefault(null);return D.start(),Promise.resolve(D)}return new Promise(((M,b)=>{const X=new Bl.d;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const b=JSON.parse(JSON.parse(X.responseText).jsonPayload),t=JSON.parse(b.particleSystem);let R;R=G?xl.Parse(t,l,V,!1,N):Xl.Parse(t,l,V,!1,N),R.snippetId=D,M(R)}else b("Unable to load the snippet "+D)})),X.open("GET",this.SnippetUrl+"/"+D.replace(/#/g,"/")),X.send()}))}}Il.BaseAssetsUrl=ul.BaseAssetsUrl,Il.SnippetUrl="https://snippet.babylonjs.com",Il.CreateFromSnippetAsync=Il.ParseFromSnippetAsync;var Wl=G(12173),il=G(11998),yl=G(13105);(0,yl.g)(il.e.NAME_PARTICLESYSTEM,((D,l,G,V)=>{const N=(0,yl.j)(il.e.NAME_PARTICLESYSTEM);if(N&&void 0!==D.xj&&null!==D.xj)for(let M=0,b=D.xj.length;M<b;M++){const b=D.xj[M];G.xj.push(N(b,l,V))}})),(0,yl.e)(il.e.NAME_PARTICLESYSTEM,((D,l,G)=>{if(D.activeParticleCount){return xl.Parse(D,l,G)}return Xl.Parse(D,l,G)})),TD.e.prototype.createEffectForParticles=function(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",M=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0,X=arguments.length>6?arguments[6]:void 0,t=arguments.length>7?arguments[7]:void 0,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,n=arguments.length>9?arguments[9]:void 0,g=[],j=[];const e=[];return t?t.fillUniformsAttributesAndSamplerNames(j,g,e):(g=Xl._GetAttributeNamesOrOptions(),j=Xl._GetEffectCreationOptions()),-1===N.indexOf(" BILLBOARD")&&(N+="\n#define BILLBOARD\n"),null!==t&&void 0!==t&&t.isAnimationSheetEnabled&&-1===N.indexOf(" ANIMATESHEET")&&(N+="\n#define ANIMATESHEET\n"),-1===V.indexOf("diffuseSampler")&&V.push("diffuseSampler"),this.createEffect({vertex:n??(null===t||void 0===t?void 0:t.vertexShaderName)??"particles",fragmentElement:D},g,j.concat(l),e.concat(V),N,M,b,X,void 0,R,(async()=>{0===R?await Promise.resolve().then(G.bind(G,13139)):await Promise.resolve().then(G.bind(G,13218))}))},Wl.b.prototype.getEmittedParticleSystems=function(){const D=[];for(let l=0;l<this.uD().xj.length;l++){const G=this.uD().xj[l];G.Vl===this&&D.push(G)}return D},Wl.b.prototype.getHierarchyEmittedParticleSystems=function(){const D=[],l=this.getDescendants();l.push(this);for(let G=0;G<this.uD().xj.length;G++){const V=this.uD().xj[G],N=V.Vl;N.position&&-1!==l.indexOf(N)&&D.push(V)}return D};G(12073),G(12084),G(12149);G(12155),G(13114),G(11915),G(12059),G(12196);G(11906);var Sl;G(13117),G(11732);!function(D){D[D.Color=2]="Color",D[D.UV=1]="UV",D[D.Random=0]="Random",D[D.Stated=3]="Stated"}(Sl||(Sl={}));var Ol=G(11948);const sl=new V.Kl(0,0,0),Ul=new V.Kl(0,0,0),fl=new V.Kl(0,0,0);class ql{constructor(D,l,G){this.width=D,this.height=l,this.data=G}processFlowable(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2?arguments[2]:void 0;if(!G)return;G instanceof V.Matrix?V.Kl.TransformCoordinatesToRef(D.position,G,fl):(fl.x=G.x,fl.y=G.y,fl.z=G.z);const N=.5*fl.x+.5,M=1-(.5*fl.y+.5),b=Math.floor(N*this.width),X=Math.floor(M*this.height);if(b<0||b>=this.width||X<0||X>=this.height)return;const t=4*(X*this.width+b),R=this.data[t]/255*2-1,n=this.data[t+1]/255*2-1,g=this.data[t+2]/255*2-1,j=this.data[t+3]/255;sl.set(R,n,g),sl.scaleToRef(l*j,Ul),D.direction.addInPlace(Ul)}_processParticle(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,G=arguments.length>2?arguments[2]:void 0;this.processFlowable(D,l,G)}static async FromUrlAsync(D){return await new Promise(((l,G)=>{const V=document.createElement("canvas"),N=V.getContext("2d");let M=null;const b=new Image;b.crossOrigin="anonymous",b.src=D,b.onerror=l=>{G(new Error(`Failed to load image: ${D} : ${l}`))},b.onload=()=>{V.width=b.width,V.height=b.height,N.drawImage(b,0,0),M=N.getImageData(0,0,V.width,V.height),l(new ql(V.width,V.height,M.data))}}))}static async ExtractFromTextureAsync(D){return await new Promise(((l,G)=>{if(!D.isReady())return void D.onLoadObservable.addOnce((async()=>{try{const G=await this.ExtractFromTextureAsync(D);l(G)}catch(V){G(V)}}));const V=D.getSize();Ol.i.GetTextureDataAsync(D,V.width,V.height).then((D=>{l(new ql(V.width,V.height,new Uint8ClampedArray(D)))})).catch(G)}))}}var cl,vl,Zl,Jl,Yl,zl,El,Pl,pl;!function(D){D[D.Int=1]="Int",D[D.Float=2]="Float",D[D.Vector2=4]="Vector2",D[D.Kl=8]="Kl",D[D.Matrix=16]="Matrix",D[D.Particle=32]="Particle",D[D.Texture=64]="Texture",D[D.Wb=128]="Wb",D[D.FloatGradient=256]="FloatGradient",D[D.Vector2Gradient=512]="Vector2Gradient",D[D.Vector3Gradient=1024]="Vector3Gradient",D[D.Color4Gradient=2048]="Color4Gradient",D[D.System=4096]="System",D[D.AutoDetect=8192]="AutoDetect",D[D.BasedOnInput=16384]="BasedOnInput",D[D.Undefined=32768]="Undefined",D[D.All=65535]="All"}(cl||(cl={})),function(D){D[D.Compatible=0]="Compatible",D[D.TypeIncompatible=1]="TypeIncompatible",D[D.HierarchyIssue=2]="HierarchyIssue"}(vl||(vl={})),function(D){D[D.Input=0]="Input",D[D.Output=1]="Output"}(Zl||(Zl={}));class kl{get direction(){return this._direction}get type(){if(this._type===cl.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===cl.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(D){this._type=D}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((D=>D.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(D,l,G){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=cl.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new w.e,this.onDisconnectionObservable=new w.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=l,this.name=D,this._direction=G}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(D){var l;return this.isConnected?null!==(l=this._connectedPoint)&&void 0!==l&&l._storedFunction?this._connectedPoint._storedFunction(D):this._connectedPoint._storedValue:this.value}canConnectTo(D){return 0===this.checkCompatibilityState(D)}checkCompatibilityState(D){const l=this._ownerBlock,G=D.ownerBlock;if(this.type!==D.type&&D.innerType!==cl.AutoDetect)return D.acceptedConnectionPointTypes&&-1!==D.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(D.excludedConnectionPointTypes&&-1!==D.excludedConnectionPointTypes.indexOf(this.type))return 1;let V=G,N=l;return 0===this.direction&&(V=l,N=G),V.isAnAncestorOf(N)?2:0}connectTo(D){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(D))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${D.ownerBlock.name}".${D.name}`;return this._endpoints.push(D),D._connectedPoint=this,this.onConnectionObservable.notifyObservers(D),D.onConnectionObservable.notifyObservers(this),this}disconnectFrom(D){const l=this._endpoints.indexOf(D);return-1===l||(this._endpoints.splice(l,1),D._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(D),D.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(D){let l=1;for(;l<cl.All;)D&l||this.excludedConnectionPointTypes.push(l),l<<=1}serialize(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const l={};return l.name=this.name,l.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.gb?(l.valueType="BABYLON."+this.value.getClassName(),l.value=this.value.gb()):(l.valueType="number",l.value=this.value)),D&&this.connectedPoint&&(l.inputName=this.name,l.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,l.targetConnectionName=this.connectedPoint.name,l.isExposedOnFrame=!0,l.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(l.isExposedOnFrame=!0,l.exposedPortPosition=this.exposedPortPosition),l}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class ml{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(D){this._name=D}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(D){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new w.e,this.Vb=new w.e,this.onInputChangedObservable=new w.e,this.visibleOnFrame=!1,this._name=D,this.uniqueId=q.d.UniqueId}_inputRename(D){return D}_outputRename(D){return D}isAnAncestorOf(D){for(const l of this._outputs)if(l.hasEndpoints)for(const G of l.endpoints){if(G.ownerBlock===D)return!0;if(G.ownerBlock.isAnAncestorOf(D))return!0}return!1}isAnAncestorOfType(D){if(this.getClassName()===D)return!0;for(const l of this._outputs)if(l.hasEndpoints)for(const G of l.endpoints)if(G.ownerBlock.isAnAncestorOfType(D))return!0;return!1}getInputByName(D){const l=this._inputs.filter((l=>l.name===D));return l.length?l[0]:null}_linkConnectionTypes(D,l){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[l]._acceptedConnectionPointType=this._inputs[D]:(this._inputs[D]._linkedConnectionSource=this._inputs[l],this._inputs[D]._isMainLinkSource=!0),this._inputs[l]._linkedConnectionSource=this._inputs[D]}registerInput(D,l){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,M=arguments.length>5?arguments[5]:void 0;const b=new kl(D,this,0);return b.type=l,b.isOptional=G,b.defaultValue=V,b.value=V,b.valueMin=N,b.valueMax=M,this._inputs.push(b),this.onInputChangedObservable.notifyObservers(b),this}registerOutput(D,l,G){return(G=G??new kl(D,this,1)).type=l,this._outputs.push(G),this}_build(D){}_customBuildStep(D){}build(D){if(this._buildId===D.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((D=>D.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=D.buildId;for(const l of this._inputs){if(!l.connectedPoint){l.isOptional||D.notConnectedNonOptionalInputs.push(l);continue}const G=l.connectedPoint.ownerBlock;G&&G!==this&&!G.isSystem&&G.build(D)}return this._customBuildStep(D),D.verbose&&c.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(D),this.onBuildObservable.notifyObservers(this),!1}serialize(){const D={};D.customType="BABYLON."+this.getClassName(),D.id=this.uniqueId,D.name=this.name,D.visibleOnFrame=this.visibleOnFrame,D.inputs=[],D.outputs=[];for(const l of this.inputs)D.inputs.push(l.serialize());for(const l of this.outputs)D.outputs.push(l.serialize(!1));return D}_deserialize(D){this._name=D.name,this.comments=D.comments,this.visibleOnFrame=!!D.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(D)}_deserializePortDisplayNamesAndExposedOnFrame(D){const l=D.inputs,G=D.outputs;if(l)for(const V of l){const D=this.inputs.find((D=>D.name===V.name));if(!D)return;if(V.displayName&&(D.displayName=V.displayName),V.isExposedOnFrame&&(D.isExposedOnFrame=V.isExposedOnFrame,D.exposedPortPosition=V.exposedPortPosition),void 0!==V.value&&null!==V.value)if("number"===V.valueType)D.value=V.value;else{const l=(0,X.b)(V.valueType);l&&(D.value=l.xl(V.value))}}if(G)for(let V=0;V<G.length;V++){const D=G[V];D.displayName&&(this.outputs[V].displayName=D.displayName),D.isExposedOnFrame&&(this.outputs[V].isExposedOnFrame=D.isExposedOnFrame,this.outputs[V].exposedPortPosition=D.exposedPortPosition)}}clone(){const D=this.serialize(),l=(0,X.b)(D.customType);if(l){const G=new l;return G._deserialize(D),G}return null}dispose(){this.Vb.notifyObservers(this),this.Vb.clear();for(const D of this.inputs)D.dispose();for(const D of this.outputs)D.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Tl(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",V=arguments.length>3?arguments[3]:void 0;return(N,M)=>{let b=N._propStore;b||(b=[],N._propStore=b),b.push({propertyName:M,displayName:D,type:l,groupName:G,options:V??{},className:N.getClassName()})}}(0,O.b)([(0,s.L)("comment")],ml.prototype,"comments",void 0),function(D){D[D.Boolean=0]="Boolean",D[D.Float=1]="Float",D[D.Int=2]="Int",D[D.Vector2=3]="Vector2",D[D.List=4]="List",D[D.Wb=5]="Wb",D[D.SamplingMode=6]="SamplingMode",D[D.TextureFormat=7]="TextureFormat",D[D.TextureType=8]="TextureType"}(Jl||(Jl={})),function(D){D[D.None=0]="None",D[D.Position=1]="Position",D[D.Direction=2]="Direction",D[D.Age=3]="Age",D[D.Lifetime=4]="Lifetime",D[D.Color=5]="Color",D[D.ScaledDirection=6]="ScaledDirection",D[D.Scale=7]="Scale",D[D.AgeGradient=8]="AgeGradient",D[D.Angle=9]="Angle",D[D.SpriteCellIndex=16]="SpriteCellIndex",D[D.SpriteCellStart=17]="SpriteCellStart",D[D.SpriteCellEnd=18]="SpriteCellEnd"}(Yl||(Yl={})),function(D){D[D.None=0]="None",D[D.Time=1]="Time",D[D.Delta=2]="Delta",D[D.Emitter=3]="Emitter"}(zl||(zl={}));class Cl{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let D="";for(const l of this.notConnectedNonOptionalInputs)D+=`input ${l.name} from block ${l.ownerBlock.name}[${l.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(D)throw"Build of Node Particle System Set failed:\n"+D}adapt(D,l){const G=D.getConnectedValue(this)||0;if(D.type===l)return G;switch(l){case cl.Vector2:return new V.Vector2(G,G);case cl.Kl:return new V.Kl(G,G,G);case cl.Wb:return new b.Wb(G,G,G,G)}return null}getContextualValue(D){if(!this.particleContext||!this.systemContext)return null;switch(D){case Yl.Position:return this.particleContext.position;case Yl.Direction:return this.particleContext.direction;case Yl.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Yl.Color:return this.particleContext.color;case Yl.Age:return this.particleContext.age;case Yl.Lifetime:return this.particleContext.lifeTime;case Yl.Angle:return this.particleContext.angle;case Yl.Scale:return this.particleContext.scale;case Yl.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Yl.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Yl.SpriteCellIndex:return this.particleContext.cellIndex;case Yl.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Vl.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Vl.absolutePosition:this.systemContext.Vl:null}getSystemValue(D){if(!this.particleContext||!this.systemContext)return null;switch(D){case zl.Time:return this.systemContext._actualFrame;case zl.Delta:return this.systemContext._scaledUpdateSpeed;case zl.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Vl.absolutePosition}return this.systemContext.Vl}return null}}function wl(D,l,G){const V=new Cl;V.dl=l;const N=D.createSystem(V);return N.canStart=()=>!0,N.Vl=G.clone(),N.disposeOnStop=!0,N.start(),N}class Al extends ml{constructor(D){super(D),this.blendMode=t.BLENDMODE_ONEONE,this.nG=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",cl.Particle),this.registerInput("texture",cl.Texture),this.registerInput("onStart",cl.System,!0),this.registerInput("onEnd",cl.System,!0),this.registerOutput("system",cl.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(D){D.nG=this.nG,D.buildId=this._buildId++,this.build(D);const l=this.particle.getConnectedValue(D);return l.particleTexture=this.texture.getConnectedValue(D),l.emitRate=this.emitRate,l.blendMode=this.blendMode,l.name=this.name,l._nodeGenerated=!0,l._targetStopDuration=this.targetStopDuration,l.startDelay=this.startDelay,this.system._storedValue=this,l.canStart=()=>!this.doNoStart,l.onStartedObservable.add((G=>{const V=this.onStart.getConnectedValue(D);V&&G.onStartedObservable.addOnce((()=>{D.systemContext=l;const G=wl(V,D.dl,D.emitterPosition);this.Vb.addOnce((()=>{G.dispose()}))}));const N=this.onEnd.getConnectedValue(D);N&&G.onStoppedObservable.addOnce((()=>{D.systemContext=l;const G=wl(N,D.dl,D.emitterPosition);this.Vb.addOnce((()=>{G.dispose()}))}))})),this.Vb.addOnce((()=>{l.dispose()})),l}serialize(){const D=super.serialize();return D.nG=this.nG,D.emitRate=this.emitRate,D.blendMode=this.blendMode,D.doNoStart=this.doNoStart,D.targetStopDuration=this.targetStopDuration,D.startDelay=this.startDelay,D}_deserialize(D){super._deserialize(D),this.nG=D.nG,this.emitRate=D.emitRate,this.doNoStart=!!D.doNoStart,void 0!==D.blendMode&&(this.blendMode=D.blendMode),void 0!==D.targetStopDuration&&(this.targetStopDuration=D.targetStopDuration),void 0!==D.startDelay&&(this.startDelay=D.startDelay)}}(0,O.b)([Tl("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:t.BLENDMODE_ONEONE},{label:"Standard",value:t.BLENDMODE_STANDARD},{label:"Add",value:t.BLENDMODE_ADD},{label:"Multiply",value:t.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:t.BLENDMODE_MULTIPLYADD}]})],Al.prototype,"blendMode",void 0),(0,O.b)([Tl("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Al.prototype,"nG",void 0),(0,O.b)([Tl("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Al.prototype,"emitRate",void 0),(0,O.b)([Tl("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Al.prototype,"targetStopDuration",void 0),(0,O.b)([Tl("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Al.prototype,"startDelay",void 0),(0,O.b)([Tl("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Al.prototype,"doNoStart",void 0),(0,X.c)("BABYLON.SystemBlock",Al);class al extends ml{get type(){if(this._type===cl.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=cl.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=cl.Vector2,this._type;case"Kl":return this._type=cl.Kl,this._type;case"Wb":return this._type=cl.Wb,this._type;case"Matrix":return this._type=cl.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Yl.None&&this._systemSource!==zl.None}get systemSource(){return this._systemSource}set systemSource(D){if(this._systemSource=D,D!==zl.None){switch(this._contextualSource=Yl.None,this._type=cl.Float,D){case zl.Time:case zl.Delta:this._type=cl.Float;break;case zl.Emitter:this._type=cl.Kl}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Yl.None}get contextualValue(){return this._contextualSource}set contextualValue(D){if(this._contextualSource=D,D!==Yl.None){switch(this._systemSource=zl.None,D){case Yl.Scale:this._type=cl.Vector2;break;case Yl.Position:case Yl.Direction:case Yl.ScaledDirection:this._type=cl.Kl;break;case Yl.Color:this._type=cl.Wb;break;case Yl.Age:case Yl.Lifetime:case Yl.Angle:case Yl.AgeGradient:this._type=cl.Float;break;case Yl.SpriteCellEnd:case Yl.SpriteCellStart:case Yl.SpriteCellIndex:this._type=cl.Int}this.output&&(this.output.type=this._type)}}constructor(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cl.AutoDetect;super(D),this._type=cl.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new w.e,this._systemSource=zl.None,this._contextualSource=Yl.None,this._type=l,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",l)}get value(){return this._storedValue}set value(D){this.type===cl.Float&&this.min!==this.max&&(D=Math.max(this.min,D),D=Math.min(this.max,D)),this._storedValue=D,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(D){this._valueCallback=D}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case cl.Int:case cl.Float:this.value=0;break;case cl.Vector2:this.value=V.Vector2.Zero();break;case cl.Kl:this.value=V.Kl.Zero();break;case cl.Wb:this.value=new b.Wb(1,1,1,1);break;case cl.Matrix:this.value=V.Matrix.Identity()}}_build(D){super._build(D),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=D=>D.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=D=>D.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const D=super.serialize();return D.type=this.type,D.contextualValue=this.contextualValue,D.systemSource=this.systemSource,D.min=this.min,D.max=this.max,D.groupInInspector=this.groupInInspector,D.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.gb?(D.valueType="BABYLON."+this._storedValue.getClassName(),D.value=this._storedValue.gb()):(D.valueType="number",D.value=this._storedValue)),D}_deserialize(D){if(super._deserialize(D),this._type=D.type,this.contextualValue=D.contextualValue,this.systemSource=D.systemSource||zl.None,this.min=D.min||0,this.max=D.max||0,this.groupInInspector=D.groupInInspector||"",void 0!==D.displayInInspector&&(this.displayInInspector=D.displayInInspector),D.valueType)if("number"===D.valueType)this._storedValue=D.value;else{const l=(0,X.b)(D.valueType);l&&(this._storedValue=l.xl(D.value))}}}(0,X.c)("BABYLON.ParticleInputBlock",al);class Ql extends ml{get url(){return this._url}set url(D){this._url!==D&&(this._cachedData=null,this._url=D,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(D){this._textureDataUrl!==D&&(this._cachedData=null,this._textureDataUrl=D,this._url="",this._sourceTexture=null)}set sourceTexture(D){this._sourceTexture!==D&&(this._cachedData=null,this._sourceTexture=D,this._url="",this._textureDataUrl="")}constructor(D){super(D),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",cl.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const D=this.texture._storedValue;return await new Promise(((l,G)=>{if(!D.isReady())return void D.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),l(this._cachedData)}catch(D){G(D)}}));const V=D.getSize();Ol.i.GetTextureDataAsync(D,V.width,V.height).then((G=>{this._cachedData={width:V.width,height:V.height,data:new Uint8ClampedArray(G)},D.dispose(),l(this._cachedData)})).catch(G)}))}_build(D){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new f.b(this._textureDataUrl,D.dl):this.texture._storedValue=new f.b(this._url,D.dl):this.texture._storedValue=null}serialize(){const D=super.serialize();return D.url=this.url,D.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(D.textureDataUrl=this.textureDataUrl),D}_deserialize(D){super._deserialize(D),this.url=D.url,this.serializedCachedData=!!D.serializedCachedData,D.textureDataUrl&&(this.textureDataUrl=D.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,X.c)("BABYLON.ParticleTextureSourceBlock",Ql);class DG extends ml{constructor(D){super(D),this.registerInput("particle",cl.Particle),this.registerInput("position",cl.Kl),this.registerOutput("output",cl.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(D){const l=this.particle.getConnectedValue(D);if(this.output._storedValue=l,!this.position.isConnected)return;const G={process:G=>{D.particleContext=G,D.systemContext=l,G.position.V(this.position.getConnectedValue(D))},previousItem:null,nextItem:null};l._updateQueueStart?zD(G,l._updateQueueStart):l._updateQueueStart=G}}(0,X.c)("BABYLON.UpdatePositionBlock",DG),function(D){D[D.Add=0]="Add",D[D.Subtract=1]="Subtract",D[D.Multiply=2]="Multiply",D[D.Divide=3]="Divide",D[D.Max=4]="Max",D[D.Min=5]="Min"}(El||(El={}));class lG extends ml{constructor(D){super(D),this.operation=El.Add,this.registerInput("left",cl.AutoDetect),this.registerInput("right",cl.AutoDetect),this.registerOutput("output",cl.BasedOnInput),this.output._typeConnectionSource=this.left;const l=[cl.Matrix,cl.Particle,cl.Texture,cl.System,cl.FloatGradient,cl.Color4Gradient,cl.Vector2Gradient,cl.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...l),this.right.excludedConnectionPointTypes.push(...l),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(D){let l;const G=this.left,N=this.right;if(!G.isConnected||!N.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const M=G.type===cl.Float||G.type===cl.Int,X=N.type===cl.Float||N.type===cl.Int,t=M&&X;switch(this.operation){case El.Add:l=t?D=>G.getConnectedValue(D)+N.getConnectedValue(D):M?D=>D.adapt(G,N.type).add(N.getConnectedValue(D)):D=>G.getConnectedValue(D).add(D.adapt(N,G.type));break;case El.Subtract:l=t?D=>G.getConnectedValue(D)-N.getConnectedValue(D):M?D=>D.adapt(G,N.type).Fl(N.getConnectedValue(D)):D=>G.getConnectedValue(D).Fl(D.adapt(N,G.type));break;case El.Multiply:l=t?D=>G.getConnectedValue(D)*N.getConnectedValue(D):M?D=>D.adapt(G,N.type).multiply(N.getConnectedValue(D)):D=>G.getConnectedValue(D).multiply(D.adapt(N,G.type));break;case El.Divide:l=t?D=>G.getConnectedValue(D)/N.getConnectedValue(D):M?D=>D.adapt(G,N.type).divide(N.getConnectedValue(D)):D=>G.getConnectedValue(D).divide(D.adapt(N,G.type));break;case El.Min:if(t)l=D=>Math.min(G.getConnectedValue(D),N.getConnectedValue(D));else{const[D,X]=M?[N,G]:[G,N];switch(D.type){case cl.Vector2:l=l=>V.Vector2.Minimize(D.getConnectedValue(l),l.adapt(X,D.type));break;case cl.Kl:l=l=>V.Kl.Minimize(D.getConnectedValue(l),l.adapt(X,D.type));break;case cl.Wb:l=l=>{const G=D.getConnectedValue(l),{r:V,g:N,b:M,a:t}=l.adapt(X,D.type);return new b.Wb(Math.min(G.r,V),Math.min(G.g,N),Math.min(G.b,M),Math.min(G.a,t))}}}break;case El.Max:if(!t){const[D,X]=M?[N,G]:[G,N];switch(D.type){case cl.Vector2:l=l=>V.Vector2.Maximize(D.getConnectedValue(l),l.adapt(X,D.type));break;case cl.Kl:l=l=>V.Kl.Maximize(D.getConnectedValue(l),l.adapt(X,D.type));break;case cl.Wb:l=l=>{const G=D.getConnectedValue(l),{r:V,g:N,b:M,a:t}=l.adapt(X,D.type);return new b.Wb(Math.max(G.r,V),Math.min(G.g,N),Math.min(G.b,M),Math.min(G.a,t))}}break}l=D=>Math.max(G.getConnectedValue(D),N.getConnectedValue(D))}this.output._storedFunction=D=>G.type===cl.Int?0|l(D):l(D)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===cl.Int||this.left.type===cl.Float&&this.right.type!==cl.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[D,l]of[[this.left,this.right],[this.right,this.left]])D.acceptedConnectionPointTypes=[cl.Int,cl.Float],l.isConnected&&(D.acceptedConnectionPointTypes.push(l.type),l.type!==cl.Int&&l.type!==cl.Float||D.acceptedConnectionPointTypes.push(cl.Vector2,cl.Kl,cl.Wb))}dispose(){super.dispose();for(const D of this._connectionObservers)D.remove();this._connectionObservers.length=0}serialize(){const D=super.serialize();return D.operation=this.operation,D}_deserialize(D){super._deserialize(D),this.operation=D.operation}}(0,O.b)([Tl("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:El.Add},{label:"Subtract",value:El.Subtract},{label:"Multiply",value:El.Multiply},{label:"Divide",value:El.Divide},{label:"Max",value:El.Max},{label:"Min",value:El.Min}]})],lG.prototype,"operation",void 0),(0,X.c)("BABYLON.ParticleMathBlock",lG);class GG extends ml{constructor(D){super(D),this.registerInput("particle",cl.Particle),this.registerInput("direction1",cl.Kl,!0,new V.Kl(0,1,0)),this.registerInput("direction2",cl.Kl,!0,new V.Kl(0,1,0)),this.registerInput("minEmitBox",cl.Kl,!0,new V.Kl(-.5,-.5,-.5)),this.registerInput("maxEmitBox",cl.Kl,!0,new V.Kl(.5,.5,.5)),this.registerOutput("output",cl.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(D){const l=this.particle.getConnectedValue(D);l._directionCreation.process=G=>{D.particleContext=G,D.systemContext=l;const N=this.direction1.getConnectedValue(D),M=this.direction2.getConnectedValue(D),b=(0,R.RandomRange)(N.x,M.x),X=(0,R.RandomRange)(N.y,M.y),t=(0,R.RandomRange)(N.z,M.z);D.isEmitterTransformNode?V.Kl.TransformNormalFromFloatsToRef(b,X,t,D.emitterWorldMatrix,G.direction):G.direction.Lb(b,X,t)},l._positionCreation.process=G=>{D.particleContext=G,D.systemContext=l;const N=this.minEmitBox.getConnectedValue(D),M=this.maxEmitBox.getConnectedValue(D),b=(0,R.RandomRange)(N.x,M.x),X=(0,R.RandomRange)(N.y,M.y),t=(0,R.RandomRange)(N.z,M.z);D.isEmitterTransformNode?V.Kl.TransformCoordinatesFromFloatsToRef(b,X,t,D.emitterWorldMatrix,G.position):(G.position.Lb(b,X,t),G.position.addInPlace(D.emitterPosition))},this.output._storedValue=l}}(0,X.c)("BABYLON.BoxShapeBlock",GG);class VG extends ml{constructor(D){super(D),this.registerInput("emitPower",cl.Float,!0,1),this.registerInput("lifeTime",cl.Float,!0,1),this.registerInput("color",cl.Wb,!0,new b.Wb(1,1,1,1)),this.registerInput("scale",cl.Vector2,!0,new V.Vector2(1,1)),this.registerInput("angle",cl.Float,!0,0),this.registerOutput("particle",cl.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(D){const l=new Xl(this.name,D.nG,D.dl,null,!1,void 0,!0);l.particleEmitterType=new H,l._lifeTimeCreation.process=(l,G)=>{D.particleContext=l,l.lifeTime=this.lifeTime.getConnectedValue(D),G._emitPower=this.emitPower.getConnectedValue(D)},l._colorCreation.process=l=>{D.particleContext=l,l.color.V(this.color.getConnectedValue(D))},l._sizeCreation.process=l=>{D.particleContext=l,l.size=1,l.scale.V(this.scale.getConnectedValue(D))},l._angleCreation.process=l=>{D.particleContext=l,l.angle=this.angle.getConnectedValue(D)},this.particle._storedValue=l}}(0,X.c)("BABYLON.CreateParticleBlock",VG);class NG{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const D=[];for(const l of this.attachedBlocks)l.isInput&&D.push(l);return D}constructor(D){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new w.e,this.name=D}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(D){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(D)&&this.attachedBlocks.push(D);for(const G of D.inputs){const V=G.connectedPoint;if(V){const G=V.ownerBlock;G!==D&&this._initializeBlock(G,l)}}}async buildAsync(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((G=>{const V=new ul;for(const D of this._systemBlocks)this._initializeBlock(D);for(const N of this.systemBlocks){const G=new Cl;G.buildId=this._buildId++,G.dl=D,G.verbose=l;const M=N.createSystem(G);G.emitErrors(),V.systems.push(M)}this.onBuildObservable.notifyObservers(this),G(V)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const D=new Al("Particle system"),l=new DG("Update position");l.output.connectTo(D.particle);const G=new al("Position");G.contextualValue=Yl.Position;const V=new al("Scaled direction");V.contextualValue=Yl.ScaledDirection;const N=new lG("Add");N.operation=El.Add,G.output.connectTo(N.left),V.output.connectTo(N.right),N.output.connectTo(l.position);const M=new VG("Create particle"),b=new GG("Box shape");M.particle.connectTo(b.particle),b.output.connectTo(l.particle);const X=new Ql("Texture");X.texture.connectTo(D.texture),X.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(D)}removeBlock(D){const l=this.attachedBlocks.indexOf(D);if(l>-1&&this.attachedBlocks.splice(l,1),D.isSystem){const l=this._systemBlocks.indexOf(D);l>-1&&this._systemBlocks.splice(l,1)}}parseSerializedObject(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l||this.clear();const G={};for(const V of D.In){const D=(0,X.b)(V.customType);if(D){const l=new D;l._deserialize(V),G[V.id]=l,this.attachedBlocks.push(l),l.isSystem&&this._systemBlocks.push(l)}}for(const V of this.attachedBlocks)if(V.isTeleportOut){const D=V,l=D._tempEntryPointUniqueId;if(l){const V=G[l];V&&V.attachToEndpoint(D)}}for(let V=0;V<D.In.length;V++){const N=D.In[V],M=G[N.id];M&&(M.inputs.length&&N.inputs.some((D=>D.targetConnectionName))&&!l||this._restoreConnections(M,D,G))}if(D.locations||D.editorData&&D.editorData.locations){const V=D.locations||D.editorData.locations;for(const D of V)G[D.uV]&&(D.uV=G[D.uV].uniqueId);l&&this.editorData&&this.editorData.locations&&V.concat(this.editorData.locations),D.locations?this.editorData={locations:V}:(this.editorData=D.editorData,this.editorData.locations=V);const N=[];for(const D in G)N[D]=G[D].uniqueId;this.editorData.map=N}this.comment=D.comment}_restoreConnections(D,l,G){for(const V of D.outputs)for(const N of l.In){const M=G[N.id];if(M)for(const b of N.inputs)if(G[b.targetBlockId]!==D||b.targetConnectionName!==V.name);else{const D=M.getInputByName(b.inputName);if(!D||D.isConnected)continue;V.connectTo(D,!0),this._restoreConnections(M,l,G)}}}serialize(D){const l=D?{}:U.c.Serialize(this);l.editorData=JSON.parse(JSON.stringify(this.editorData));let G=[];D?G=D:l.customType="BABYLON.NodeParticleSystemSet",l.In=[];for(const V of G)l.In.push(V.serialize());if(!D)for(const V of this.attachedBlocks)-1===G.indexOf(V)&&l.In.push(V.serialize());return l}dispose(){for(const D of this.attachedBlocks)D.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(D){const l=new NG(D);return l.setToDefault(),l}static Parse(D){const l=U.c.Parse((()=>new NG(D.name)),D,null);return l.parseSerializedObject(D),l}static ParseFromSnippetAsync(D,l){return"_BLANK"===D?Promise.resolve(NG.CreateDefault("blank")):new Promise(((G,V)=>{const N=new Bl.d;N.addEventListener("readystatechange",(()=>{if(4==N.readyState)if(200==N.status){const b=JSON.parse(JSON.parse(N.responseText).jsonPayload),X=JSON.parse(b.nodeParticle);l||(l=U.c.Parse((()=>new NG(D)),X,null)),l.parseSerializedObject(X),l.snippetId=D;try{G(l)}catch(M){V(M)}}else V("Unable to load the snippet "+D)})),N.open("GET",this.SnippetUrl+"/"+D.replace(/#/g,"/")),N.send()}))}}NG.EditorURL=`${rl.Tools._DefaultCdnUrl}/v${TD.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,NG.SnippetUrl="https://snippet.babylonjs.com",(0,O.b)([(0,s.L)()],NG.prototype,"name",void 0),(0,O.b)([(0,s.L)("comment")],NG.prototype,"comment",void 0),function(D){D[D.None=0]="None",D[D.PerParticle=1]="PerParticle",D[D.PerSystem=2]="PerSystem"}(Pl||(Pl={}));class MG extends ml{constructor(D){super(D),this._currentLockId=-2,this.lockMode=Pl.PerParticle,this.registerInput("min",cl.AutoDetect,!0,0),this.registerInput("max",cl.AutoDetect,!0,1),this.registerOutput("output",cl.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(cl.Float|cl.Int|cl.Vector2|cl.Kl|cl.Wb),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(cl.Float|cl.Int|cl.Vector2|cl.Kl|cl.Wb),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=cl.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let D=null;switch(this._currentLockId=-2,this.min.type){case cl.AutoDetect:case cl.Int:case cl.Float:D=D=>{const l=this.min.getConnectedValue(D)||0,G=this.max.getConnectedValue(D)||1;return l+Math.random()*(G-l)};break;case cl.Vector2:D=D=>{const l=this.min.getConnectedValue(D)||V.Vector2.Zero(),G=this.max.getConnectedValue(D)||V.Vector2.One();return new V.Vector2(l.x+Math.random()*(G.x-l.x),l.y+Math.random()*(G.y-l.y))};break;case cl.Kl:D=D=>{const l=this.min.getConnectedValue(D)||V.Kl.Zero(),G=this.max.getConnectedValue(D)||V.Kl.One();return new V.Kl(l.x+Math.random()*(G.x-l.x),l.y+Math.random()*(G.y-l.y),l.z+Math.random()*(G.z-l.z))};break;case cl.Wb:D=D=>{const l=this.min.getConnectedValue(D)||new b.Wb(0,0,0,0),G=this.max.getConnectedValue(D)||new b.Wb(1,1,1,1);return new b.Wb(l.x+Math.random()*(G.x-l.x),l.y+Math.random()*(G.y-l.y),l.z+Math.random()*(G.z-l.z),l.w+Math.random()*(G.w-l.w))}}this.output._storedFunction=l=>{var G;let V=0;switch(this.lockMode){case Pl.PerParticle:V=(null===(G=l.particleContext)||void 0===G?void 0:G.id)||-1;break;case Pl.PerSystem:V=l.buildId||0}return this._currentLockId!==V&&(this.lockMode!==Pl.None&&(this._currentLockId=V),this.output._storedValue=D(l)),this.output._storedValue}}serialize(){const D=super.serialize();return D.lockMode=this.lockMode,D}_deserialize(D){super._deserialize(D),this.lockMode=D.lockMode}}(0,O.b)([Tl("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Pl.None},{label:"Per particle",value:Pl.PerParticle},{label:"Per system",value:Pl.PerSystem}]})],MG.prototype,"lockMode",void 0),(0,X.c)("BABYLON.ParticleRandomBlock",MG);class bG extends ml{constructor(D){super(D),this._currentLockId=-2,this.lockMode=Pl.PerParticle,this.registerInput("min",cl.AutoDetect),this.registerInput("max",cl.AutoDetect),this.registerOutput("output",cl.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const l=[cl.Matrix,cl.Particle,cl.Texture,cl.System,cl.FloatGradient,cl.Color4Gradient,cl.Vector2Gradient,cl.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...l),this.max.excludedConnectionPointTypes.push(...l)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let D=null;switch(this._currentLockId=-2,this.min.type){case cl.Float:case cl.Int:D=D=>{const l=this.min.getConnectedValue(D),G=this.max.getConnectedValue(D);return Math.random()*(G-l)+l};break;case cl.Vector2:D=D=>{const l=this.min.getConnectedValue(D),G=this.max.getConnectedValue(D);return new V.Vector2(Math.random()*(G.x-l.x)+l.x,Math.random()*(G.y-l.y)+l.y)};break;case cl.Kl:D=D=>{const l=this.min.getConnectedValue(D),G=this.max.getConnectedValue(D);return new V.Kl(Math.random()*(G.x-l.x)+l.x,Math.random()*(G.y-l.y)+l.y,Math.random()*(G.z-l.z)+l.z)};break;case cl.Wb:D=D=>{const l=this.min.getConnectedValue(D),G=this.max.getConnectedValue(D);return new b.Wb(Math.random()*(G.r-l.r)+l.r,Math.random()*(G.g-l.g)+l.g,Math.random()*(G.b-l.b)+l.b,Math.random()*(G.a-l.a)+l.a)}}this.output._storedFunction=l=>{var G;let V=0;switch(this.lockMode){case Pl.PerParticle:V=(null===(G=l.particleContext)||void 0===G?void 0:G.id)||-1;break;case Pl.PerSystem:V=l.buildId||0}return this._currentLockId!==V&&(this.lockMode!==Pl.None&&(this._currentLockId=V),this.output._storedValue=D(l)),this.output._storedValue}}serialize(){const D=super.serialize();return D.lockMode=this.lockMode,D}_deserialize(D){super._deserialize(D),void 0!==D.lockMode&&(this.lockMode=D.lockMode)}}(0,O.b)([Tl("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Pl.None},{label:"Per particle",value:Pl.PerParticle},{label:"Per system",value:Pl.PerSystem}]})],bG.prototype,"lockMode",void 0),(0,X.c)("BABYLON.RandomRangeBlock",bG);(0,X.c)("BABYLON.ParticleLerpBlock",class extends ml{constructor(D){super(D),this.registerInput("left",cl.AutoDetect),this.registerInput("right",cl.AutoDetect),this.registerInput("gradient",cl.Float,!0,0,0,1),this.registerOutput("output",cl.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(cl.Float|cl.Int|cl.Vector2|cl.Kl|cl.Wb)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const D=(D,l,G)=>(1-D)*l+D*G;this.output._storedFunction=l=>{const G=this.left.getConnectedValue(l),N=this.right.getConnectedValue(l),M=this.gradient.getConnectedValue(l);switch(this.left.type){case cl.Int:case cl.Float:return D(M,G,N);case cl.Vector2:return new V.Vector2(D(M,G.x,N.x),D(M,G.y,N.y));case cl.Kl:return new V.Kl(D(M,G.x,N.x),D(M,G.y,N.y),D(M,G.z,N.z));case cl.Wb:return new b.Wb(D(M,G.r,N.r),D(M,G.g,N.g),D(M,G.b,N.b),D(M,G.a,N.a))}return 0}}});(0,X.c)("BABYLON.UpdateDirectionBlock",class extends ml{constructor(D){super(D),this.registerInput("particle",cl.Particle),this.registerInput("direction",cl.Kl),this.registerOutput("output",cl.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(D){const l=this.particle.getConnectedValue(D);if(this.output._storedValue=l,!this.direction.isConnected)return;const G={process:G=>{D.particleContext=G,D.systemContext=l,G.direction.V(this.direction.getConnectedValue(D))},previousItem:null,nextItem:null};l._updateQueueStart?zD(G,l._updateQueueStart):l._updateQueueStart=G}});(0,X.c)("BABYLON.UpdateColorBlock",class extends ml{constructor(D){super(D),this.registerInput("particle",cl.Particle),this.registerInput("color",cl.Wb),this.registerOutput("output",cl.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(D){const l=this.particle.getConnectedValue(D);if(this.output._storedValue=l,!this.color.isConnected)return;const G={process:G=>{D.particleContext=G,D.systemContext=l,G.color.V(this.color.getConnectedValue(D))},previousItem:null,nextItem:null};l._updateQueueStart?zD(G,l._updateQueueStart):l._updateQueueStart=G}});(0,X.c)("BABYLON.UpdateScaleBlock",class extends ml{constructor(D){super(D),this.registerInput("particle",cl.Particle),this.registerInput("scale",cl.Vector2),this.registerOutput("output",cl.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(D){const l=this.particle.getConnectedValue(D);if(this.output._storedValue=l,!this.scale.isConnected)return;const G={process:G=>{D.particleContext=G,D.systemContext=l,G.scale.V(this.scale.getConnectedValue(D))},previousItem:null,nextItem:null};l._updateQueueStart?zD(G,l._updateQueueStart):l._updateQueueStart=G}});(0,X.c)("BABYLON.UpdateAngleBlock",class extends ml{constructor(D){super(D),this.registerInput("particle",cl.Particle),this.registerInput("angle",cl.Float),this.registerOutput("output",cl.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(D){const l=this.particle.getConnectedValue(D);if(this.output._storedValue=l,!this.angle.isConnected)return;const G={process:G=>{D.particleContext=G,D.systemContext=l,G.angle=this.angle.getConnectedValue(D)},previousItem:null,nextItem:null};l._updateQueueStart?zD(G,l._updateQueueStart):l._updateQueueStart=G}});(0,X.c)("BABYLON.BasicPositionUpdateBlock",class extends ml{constructor(D){super(D),this.registerInput("particle",cl.Particle),this.registerOutput("output",cl.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(D){const l=this.particle.getConnectedValue(D),G={process:G=>{D.particleContext=G,D.systemContext=l,G.direction.scaleToRef(l._directionScale,l._scaledDirection),G.position.addInPlace(l._scaledDirection)},previousItem:null,nextItem:null};l._updateQueueStart?zD(G,l._updateQueueStart):l._updateQueueStart=G,this.output._storedValue=l}});(0,X.c)("BABYLON.BasicSpriteUpdateBlock",class extends ml{constructor(D){super(D),this.registerInput("particle",cl.Particle),this.registerOutput("output",cl.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(D){const l=this.particle.getConnectedValue(D),G={process:G=>{D.particleContext=G,D.systemContext=l,G.updateCellIndex()},previousItem:null,nextItem:null};l._updateQueueStart?zD(G,l._updateQueueStart):l._updateQueueStart=G,this.output._storedValue=l}});(0,X.c)("BABYLON.UpdateSpriteCellIndexBlock",class extends ml{constructor(D){super(D),this.registerInput("particle",cl.Particle),this.registerInput("cellIndex",cl.Int),this.registerOutput("output",cl.Particle),this.cellIndex.acceptedConnectionPointTypes=[cl.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(D){const l=this.particle.getConnectedValue(D);if(this.output._storedValue=l,!this.cellIndex.isConnected)return;const G={process:G=>{D.particleContext=G,D.systemContext=l,G.cellIndex=Math.floor(this.cellIndex.getConnectedValue(D))},previousItem:null,nextItem:null};l._updateQueueStart?zD(G,l._updateQueueStart):l._updateQueueStart=G}});class XG extends ml{constructor(D){super(D),this.strength=1,this.registerInput("particle",cl.Particle),this.registerInput("flowMap",cl.Texture),this.registerOutput("output",cl.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(D){var l;const G=this.particle.getConnectedValue(D),V=D.dl;let N;(null===(l=this.flowMap.connectedPoint)||void 0===l?void 0:l.ownerBlock).extractTextureContentAsync().then((D=>{D&&(N=new ql(D.width,D.height,D.data))}));const M={process:D=>{const l=V.getTransformMatrix();N&&N._processParticle(D,this.strength*G._tempScaledUpdateSpeed,l)},previousItem:null,nextItem:null};G._updateQueueStart?zD(M,G._updateQueueStart):G._updateQueueStart=M,this.output._storedValue=G}serialize(){const D=super.serialize();return D.strength=this.strength,D}_deserialize(D){super._deserialize(D),this.strength=D.strength}}(0,O.b)([Tl("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XG.prototype,"strength",void 0),(0,X.c)("BABYLON.UpdateFlowMapBlock",XG);(0,X.c)("BABYLON.SphereShapeBlock",class extends ml{constructor(D){super(D),this.registerInput("input",cl.Particle),this.registerInput("radius",cl.Float,!0,1),this.registerInput("radiusRange",cl.Float,!0,1,0,1),this.registerInput("directionRandomizer",cl.Float,!0,0,0,1),this.registerOutput("output",cl.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(D){const l=this.input.getConnectedValue(D);l._directionCreation.process=G=>{D.particleContext=G,D.systemContext=l;const N=this.directionRandomizer.getConnectedValue(D),M=G.position.Fl(D.emitterPosition).normalize(),b=(0,R.RandomRange)(0,N),X=(0,R.RandomRange)(0,N),t=(0,R.RandomRange)(0,N);M.x+=b,M.y+=X,M.z+=t,M.normalize(),D.isEmitterTransformNode?V.Kl.TransformNormalFromFloatsToRef(b,X,t,D.emitterWorldMatrix,G.direction):G.direction.Lb(b,X,t)},l._positionCreation.process=G=>{D.particleContext=G,D.systemContext=l;const N=this.radius.getConnectedValue(D),M=this.radiusRange.getConnectedValue(D),b=N-(0,R.RandomRange)(0,N*M),X=(0,R.RandomRange)(0,1),t=(0,R.RandomRange)(0,2*Math.PI),n=Math.acos(2*X-1),g=b*Math.cos(t)*Math.sin(n),j=b*Math.cos(n),e=b*Math.sin(t)*Math.sin(n);D.isEmitterTransformNode?V.Kl.TransformCoordinatesFromFloatsToRef(g,j,e,D.emitterWorldMatrix,G.position):(G.position.Lb(g,j,e),G.position.addInPlace(D.emitterPosition))},this.output._storedValue=l}});(0,X.c)("BABYLON.PointShapeBlock",class extends ml{constructor(D){super(D),this.registerInput("particle",cl.Particle),this.registerInput("direction1",cl.Kl,!0,new V.Kl(0,1,0)),this.registerInput("direction2",cl.Kl,!0,new V.Kl(0,1,0)),this.registerOutput("output",cl.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(D){const l=this.particle.getConnectedValue(D);l._directionCreation.process=G=>{D.particleContext=G,D.systemContext=l;const N=this.direction1.getConnectedValue(D),M=this.direction2.getConnectedValue(D),b=(0,R.RandomRange)(N.x,M.x),X=(0,R.RandomRange)(N.y,M.y),t=(0,R.RandomRange)(N.z,M.z);D.isEmitterTransformNode?V.Kl.TransformNormalFromFloatsToRef(b,X,t,D.emitterWorldMatrix,G.direction):G.direction.Lb(b,X,t)},l._positionCreation.process=G=>{D.systemContext=l,D.isEmitterTransformNode?V.Kl.TransformCoordinatesFromFloatsToRef(0,0,0,D.emitterWorldMatrix,G.position):G.position.V(D.emitterPosition)},this.output._storedValue=l}});(0,X.c)("BABYLON.CustomShapeBlock",class extends ml{constructor(D){super(D),this.registerInput("particle",cl.Particle),this.registerInput("position",cl.Kl,!0,new V.Kl(0,0,0)),this.registerInput("direction",cl.Kl,!0,new V.Kl(0,1,0)),this.registerOutput("output",cl.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(D){const l=this.particle.getConnectedValue(D);l._directionCreation.process=G=>{D.particleContext=G,D.systemContext=l;const N=this.direction.getConnectedValue(D);D.isEmitterTransformNode?V.Kl.TransformNormalToRef(N,D.emitterWorldMatrix,G.direction):G.direction.V(N)},l._positionCreation.process=G=>{D.particleContext=G,D.systemContext=l;const N=this.position.getConnectedValue(D);D.isEmitterTransformNode?V.Kl.TransformCoordinatesToRef(N,D.emitterWorldMatrix,G.position):(G.position.V(N),G.position.addInPlace(D.emitterPosition))},this.output._storedValue=l}});(0,X.c)("BABYLON.CylinderShapeBlock",class extends ml{constructor(D){super(D),this._tempVector=V.Kl.Zero(),this.registerInput("particle",cl.Particle),this.registerInput("radius",cl.Float,!0,1),this.registerInput("height",cl.Float,!0,1,0),this.registerInput("radiusRange",cl.Float,!0,1,0,1),this.registerInput("directionRandomizer",cl.Float,!0,0,0,1),this.registerOutput("output",cl.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(D){const l=this.particle.getConnectedValue(D);l._directionCreation.process=G=>{D.particleContext=G,D.systemContext=l;const N=this.directionRandomizer.getConnectedValue(D);G.position.subtractToRef(D.emitterPosition,this._tempVector),this._tempVector.normalize(),D.isEmitterTransformNode&&V.Kl.TransformNormalToRef(this._tempVector,D.emitterInverseWorldMatrix,this._tempVector);const M=(0,R.RandomRange)(-N/2,N/2);let b=Math.atan2(this._tempVector.x,this._tempVector.z);b+=(0,R.RandomRange)(-Math.PI/2,Math.PI/2)*N,this._tempVector.y=M,this._tempVector.x=Math.sin(b),this._tempVector.z=Math.cos(b),this._tempVector.normalize(),D.isEmitterTransformNode?V.Kl.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,D.emitterWorldMatrix,G.direction):G.direction.V(this._tempVector)},l._positionCreation.process=G=>{D.particleContext=G,D.systemContext=l;const N=this.height.getConnectedValue(D),M=this.radiusRange.getConnectedValue(D),b=this.radius.getConnectedValue(D),X=(0,R.RandomRange)(-N/2,N/2),t=(0,R.RandomRange)(0,2*Math.PI),n=(0,R.RandomRange)((1-M)*(1-M),1),g=Math.sqrt(n)*b,j=g*Math.cos(t),e=g*Math.sin(t);D.isEmitterTransformNode?V.Kl.TransformCoordinatesFromFloatsToRef(j,X,e,D.emitterWorldMatrix,G.position):(G.position.Lb(j,X,e),G.position.addInPlace(D.emitterPosition))},this.output._storedValue=l}});class tG extends ml{constructor(D){super(D),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",cl.Particle),this.registerOutput("output",cl.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(D){super._build(D);const l=this.particle.getConnectedValue(D);l._isAnimationSheetEnabled=!0,l.spriteCellWidth=this.width,l.spriteCellHeight=this.height,l.startSpriteCellID=this.start,l.endSpriteCellID=this.end,l.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=l}serialize(){const D=super.serialize();return D.width=this.width,D.height=this.height,D.start=this.start,D.end=this.end,D.randomStartCell=this.randomStartCell,D}_deserialize(D){super._deserialize(D),this.width=D.width,this.height=D.height,this.start=D.start,this.end=D.end,this.randomStartCell=D.randomStartCell}}(0,O.b)([Tl("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tG.prototype,"start",void 0),(0,O.b)([Tl("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tG.prototype,"end",void 0),(0,O.b)([Tl("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tG.prototype,"width",void 0),(0,O.b)([Tl("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tG.prototype,"height",void 0),(0,O.b)([Tl("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],tG.prototype,"loop",void 0),(0,O.b)([Tl("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],tG.prototype,"randomStartCell",void 0),(0,X.c)("BABYLON.SetupSpriteSheetBlock",tG);class RG extends ml{constructor(D){super(D),this.reference=0,this.registerInput("value",cl.AutoDetect),this.registerOutput("output",cl.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=D=>{switch(D){case cl.Float:return cl.FloatGradient;case cl.Vector2:return cl.Vector2Gradient;case cl.Kl:return cl.Vector3Gradient;case cl.Wb:return cl.Color4Gradient}return D},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(cl.Float|cl.Vector2|cl.Kl|cl.Wb)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=D=>null}serialize(){const D=super.serialize();return D.reference=this.reference,D}_deserialize(D){super._deserialize(D),this.reference=D.reference}}(0,O.b)([Tl("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],RG.prototype,"reference",void 0),(0,X.c)("BABYLON.ParticleGradientValueBlock",RG);(0,X.c)("BABYLON.ParticleGradientBlock",class extends ml{constructor(D){super(D),this._entryCount=1,this.registerInput("gradient",cl.Float,!0,1,0,1),this.registerInput("value0",cl.AutoDetect),this.registerOutput("output",cl.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=D=>{switch(D){case cl.FloatGradient:return cl.Float;case cl.Vector2Gradient:return cl.Vector2;case cl.Vector3Gradient:return cl.Kl;case cl.Color4Gradient:return cl.Wb}return D},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(cl.FloatGradient|cl.Vector2Gradient|cl.Vector3Gradient|cl.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(D){this._inputs[D].onConnectionObservable.add((()=>{this._entryCount>D||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),cl.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const D=[];for(let G=1;G<this._inputs.length;G++){var l;if(this._inputs[G].isConnected)D.push(null===(l=this._inputs[G].connectedPoint)||void 0===l?void 0:l.ownerBlock)}D.sort(((D,l)=>D.reference-l.reference)),this.output._storedFunction=l=>{const G=this.gradient.getConnectedValue(l);if(1===D.length)return D[0].value.getConnectedValue(l);let N=null;for(let M=D.length-1;M>=0;M--){const X=D[M];if(X.reference<=G){const D=X.value.getConnectedValue(l);if(N){const M=N.value.getConnectedValue(l),t=N.reference,n=X.reference,g=Math.max(0,Math.min(1,(G-n)/(t-n)));switch(this.output.type){case cl.Float:return(0,R.Lerp)(D,M,g);case cl.Vector2:return V.Vector2.Lerp(D,M,g);case cl.Kl:return V.Kl.Lerp(D,M,g);case cl.Wb:return b.Wb.Lerp(D,M,g)}}return D}N=X}return 0}}});(0,X.c)("BABYLON.ParticleConverterBlock",class extends ml{constructor(D){super(D),this.registerInput("color ",cl.Wb,!0),this.registerInput("xyz ",cl.Kl,!0),this.registerInput("xy ",cl.Vector2,!0),this.registerInput("zw ",cl.Vector2,!0),this.registerInput("x ",cl.Float,!0),this.registerInput("y ",cl.Float,!0),this.registerInput("z ",cl.Float,!0),this.registerInput("w ",cl.Float,!0),this.registerOutput("color",cl.Wb),this.registerOutput("xyz",cl.Kl),this.registerOutput("xy",cl.Vector2),this.registerOutput("zw",cl.Vector2),this.registerOutput("x",cl.Float),this.registerOutput("y",cl.Float),this.registerOutput("z",cl.Float),this.registerOutput("w",cl.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(D){return"color "===D?"colorIn":"xyz "===D?"xyzIn":"xy "===D?"xyIn":"zw "===D?"zwIn":"x "===D?"xIn":"y "===D?"yIn":"z "===D?"zIn":"w "===D?"wIn":D}_outputRename(D){switch(D){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return D}}_build(D){super._build(D);const l=this.xIn,G=this.yIn,N=this.zIn,M=this.wIn,X=this.xyIn,t=this.zwIn,R=this.xyzIn,n=this.colorIn,g=this.colorOut,j=this.xyzOut,e=this.xyOut,K=this.zwOut,F=this.xOut,d=this.yOut,H=this.zOut,h=this.wOut,x=D=>{if(n.isConnected)return n.getConnectedValue(D);let V=0,g=0,j=0,e=0;if(l.isConnected&&(V=l.getConnectedValue(D)),G.isConnected&&(g=G.getConnectedValue(D)),N.isConnected&&(j=N.getConnectedValue(D)),M.isConnected&&(e=M.getConnectedValue(D)),X.isConnected){const l=X.getConnectedValue(D);l&&(V=l.x,g=l.y)}if(t.isConnected){const l=t.getConnectedValue(D);l&&(j=l.x,e=l.y)}if(R.isConnected){const l=R.getConnectedValue(D);l&&(V=l.x,g=l.y,j=l.z)}return new b.Wb(V,g,j,e)};g._storedFunction=D=>x(D),j._storedFunction=D=>{const l=x(D);return new V.Kl(l.r,l.g,l.b)},e._storedFunction=D=>{const l=x(D);return new V.Vector2(l.r,l.g)},K._storedFunction=D=>{const l=x(D);return new V.Vector2(l.b,l.a)},F._storedFunction=D=>x(D).r,d._storedFunction=D=>x(D).g,H._storedFunction=D=>x(D).b,h._storedFunction=D=>x(D).a}}),function(D){D[D.Cos=0]="Cos",D[D.Sin=1]="Sin",D[D.Abs=2]="Abs",D[D.Exp=3]="Exp",D[D.Exp2=4]="Exp2",D[D.Round=5]="Round",D[D.Floor=6]="Floor",D[D.Ceiling=7]="Ceiling",D[D.Sqrt=8]="Sqrt",D[D.Log=9]="Log",D[D.Tan=10]="Tan",D[D.ArcTan=11]="ArcTan",D[D.ArcCos=12]="ArcCos",D[D.ArcSin=13]="ArcSin",D[D.Sign=14]="Sign",D[D.Negate=15]="Negate",D[D.OneMinus=16]="OneMinus",D[D.Reciprocal=17]="Reciprocal",D[D.ToDegrees=18]="ToDegrees",D[D.ToRadians=19]="ToRadians",D[D.Fract=20]="Fract"}(pl||(pl={}));class nG extends ml{constructor(D){super(D),this.operation=pl.Cos,this.registerInput("input",cl.AutoDetect),this.registerOutput("output",cl.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(cl.Float|cl.Int|cl.Vector2|cl.Kl|cl.Wb)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(D){super._build(D);let l=null;switch(this.operation){case pl.Cos:l=D=>Math.cos(D);break;case pl.Sin:l=D=>Math.sin(D);break;case pl.Abs:l=D=>Math.abs(D);break;case pl.Exp:l=D=>Math.exp(D);break;case pl.Exp2:l=D=>Math.pow(2,D);break;case pl.Round:l=D=>Math.round(D);break;case pl.Floor:l=D=>Math.floor(D);break;case pl.Ceiling:l=D=>Math.ceil(D);break;case pl.Sqrt:l=D=>Math.sqrt(D);break;case pl.Log:l=D=>Math.log(D);break;case pl.Tan:l=D=>Math.tan(D);break;case pl.ArcTan:l=D=>Math.atan(D);break;case pl.ArcCos:l=D=>Math.acos(D);break;case pl.ArcSin:l=D=>Math.asin(D);break;case pl.Sign:l=D=>Math.sign(D);break;case pl.Negate:l=D=>-D;break;case pl.OneMinus:l=D=>1-D;break;case pl.Reciprocal:l=D=>1/D;break;case pl.ToRadians:l=D=>D*Math.PI/180;break;case pl.ToDegrees:l=D=>180*D/Math.PI;break;case pl.Fract:l=D=>D>=0?D-Math.floor(D):D-Math.ceil(D)}if(!l)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case cl.Int:case cl.Float:this.output._storedFunction=D=>{const G=this.input.getConnectedValue(D);return l(G)};break;case cl.Vector2:this.output._storedFunction=D=>{const G=this.input.getConnectedValue(D);return new V.Vector2(l(G.x),l(G.y))};break;case cl.Kl:this.output._storedFunction=D=>{const G=this.input.getConnectedValue(D);return new V.Kl(l(G.x),l(G.y),l(G.z))};break;case cl.Wb:this.output._storedFunction=D=>{const G=this.input.getConnectedValue(D);return new b.Wb(l(G.r),l(G.g),l(G.b),l(G.a))}}return this}serialize(){const D=super.serialize();return D.operation=this.operation,D}_deserialize(D){super._deserialize(D),this.operation=D.operation}}(0,O.b)([Tl("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:pl.Cos},{label:"Sin",value:pl.Sin},{label:"Abs",value:pl.Abs},{label:"Exp",value:pl.Exp},{label:"Exp2",value:pl.Exp2},{label:"Round",value:pl.Round},{label:"Floor",value:pl.Floor},{label:"Ceiling",value:pl.Ceiling},{label:"Sqrt",value:pl.Sqrt},{label:"Log",value:pl.Log},{label:"Tan",value:pl.Tan},{label:"ArcTan",value:pl.ArcTan},{label:"ArcCos",value:pl.ArcCos},{label:"ArcSin",value:pl.ArcSin},{label:"Sign",value:pl.Sign},{label:"Negate",value:pl.Negate},{label:"OneMinus",value:pl.OneMinus},{label:"Reciprocal",value:pl.Reciprocal},{label:"ToDegrees",value:pl.ToDegrees},{label:"ToRadians",value:pl.ToRadians},{label:"Fract",value:pl.Fract}]})],nG.prototype,"operation",void 0),(0,X.c)("BABYLON.ParticleTrigonometryBlock",nG);var gG,jG=G(13124);class eG extends ml{constructor(D){super(D),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",cl.AutoDetect),this.registerOutput("output",cl.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(cl.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(cl.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(cl.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(cl.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(cl.System),this._inputs[0].excludedConnectionPointTypes.push(cl.Particle),this._inputs[0].excludedConnectionPointTypes.push(cl.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(D){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const l=D=>{const l=this.input.getConnectedValue(D);if(this.log.length>=this.stackSize)return l;if(null===l||void 0===l)return this.log.push(["null",""]),l;switch(this.input.type){case cl.Vector2:this.log.push([(0,jG.g)(l,4),l.toString()]);break;case cl.Kl:this.log.push([(0,jG.i)(l,4),l.toString()]);break;case cl.Wb:this.log.push([`{R: ${l.r.toFixed(4)} G: ${l.g.toFixed(4)} B: ${l.b.toFixed(4)} A: ${l.a.toFixed(4)}}`,l.toString()]);break;default:this.log.push([l.toString(),l.toString()])}return l};this.output.isConnected?this.output._storedFunction=l:this.output._storedValue=l(D)}serialize(){const D=super.serialize();return D.stackSize=this.stackSize,D}_deserialize(D){super._deserialize(D),this.stackSize=D.stackSize}}(0,O.b)([Tl("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],eG.prototype,"stackSize",void 0),(0,X.c)("BABYLON.ParticleDebugBlock",eG);(0,X.c)("BABYLON.ParticleElbowBlock",class extends ml{constructor(D){super(D),this.registerInput("input",cl.AutoDetect),this.registerOutput("output",cl.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(D){super._build(D);const l=this._outputs[0],G=this._inputs[0];l._storedFunction=D=>G.getConnectedValue(D)}});(0,X.c)("BABYLON.ParticleTeleportInBlock",class extends ml{get endpoints(){return this._endpoints}constructor(D){super(D),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",cl.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(D){if(this.getClassName()===D)return!0;for(const l of this.endpoints)if(l.isAnAncestorOfType(D))return!0;return!1}isAnAncestorOf(D){for(const l of this.endpoints){if(l===D)return!0;if(l.isAnAncestorOf(D))return!0}return!1}attachToEndpoint(D){D.detach(),this._endpoints.push(D),D._entryPoint=this,D._outputs[0]._typeConnectionSource=this._inputs[0],D._tempEntryPointUniqueId=null,D.name="> "+this.name}detachFromEndpoint(D){const l=this._endpoints.indexOf(D);-1!==l&&(this._endpoints.splice(l,1),D._outputs[0]._typeConnectionSource=null,D._entryPoint=null)}_build(){for(const D of this._endpoints)D.output._storedFunction=D=>this.input.getConnectedValue(D)}});(0,X.c)("BABYLON.ParticleTeleportOutBlock",class extends ml{constructor(D){super(D),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",cl.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(D){this.entryPoint&&this.entryPoint.build(D)}clone(){const D=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(D),D}serialize(){var D;const l=super.serialize();return l.entryPoint=(null===(D=this.entryPoint)||void 0===D?void 0:D.uniqueId)??"",l}_deserialize(D){super._deserialize(D),this._tempEntryPointUniqueId=D.entryPoint}}),function(D){D[D.Equal=0]="Equal",D[D.NotEqual=1]="NotEqual",D[D.LessThan=2]="LessThan",D[D.GreaterThan=3]="GreaterThan",D[D.LessOrEqual=4]="LessOrEqual",D[D.GreaterOrEqual=5]="GreaterOrEqual",D[D.Xor=6]="Xor",D[D.Or=7]="Or",D[D.And=8]="And"}(gG||(gG={}));class KG extends ml{constructor(D){super(D),this.test=gG.Equal,this.epsilon=0,this.registerInput("left",cl.Float),this.registerInput("right",cl.Float,!0,0),this.registerInput("ifTrue",cl.AutoDetect,!0,1),this.registerInput("ifFalse",cl.AutoDetect,!0,0),this.registerOutput("output",cl.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=cl.Float,this._inputs[0].acceptedConnectionPointTypes.push(cl.Int),this._inputs[1].acceptedConnectionPointTypes.push(cl.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const D=D=>{const l=this.left.getConnectedValue(D),G=this.right.getConnectedValue(D);let V=!1;switch(this.test){case gG.Equal:V=(0,R.WithinEpsilon)(l,G,this.epsilon);break;case gG.NotEqual:V=!(0,R.WithinEpsilon)(l,G,this.epsilon);break;case gG.LessThan:V=l<G+this.epsilon;break;case gG.GreaterThan:V=l>G-this.epsilon;break;case gG.LessOrEqual:V=l<=G+this.epsilon;break;case gG.GreaterOrEqual:V=l>=G-this.epsilon;break;case gG.Xor:V=!!l&&!G||!l&&!!G;break;case gG.Or:V=!!l||!!G;break;case gG.And:V=!!l&&!!G}return V};this.output._storedFunction=l=>D(l)?this.ifTrue.getConnectedValue(l):this.ifFalse.getConnectedValue(l)}serialize(){const D=super.serialize();return D.test=this.test,D.epsilon=this.epsilon,D}_deserialize(D){super._deserialize(D),this.test=D.test,void 0!==D.epsilon&&(this.epsilon=D.epsilon)}}(0,O.b)([Tl("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:gG.Equal},{label:"NotEqual",value:gG.NotEqual},{label:"LessThan",value:gG.LessThan},{label:"GreaterThan",value:gG.GreaterThan},{label:"LessOrEqual",value:gG.LessOrEqual},{label:"GreaterOrEqual",value:gG.GreaterOrEqual},{label:"Xor",value:gG.Xor},{label:"Or",value:gG.Or},{label:"And",value:gG.And}]})],KG.prototype,"test",void 0),(0,O.b)([Tl("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],KG.prototype,"epsilon",void 0),(0,X.c)("BABYLON.ParticleConditionBlock",KG);class FG extends ml{constructor(D){super(D),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",cl.Particle),this.registerInput("condition",cl.Float,!0,0),this.registerInput("system",cl.System),this.registerOutput("output",cl.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(D){this._triggerCount=0;const l=this.input.getConnectedValue(D),G={process:G=>{if(D.particleContext=G,D.systemContext=l,0!==this.condition.getConnectedValue(D)&&(0===this.limit||this._triggerCount<this.limit)){const V=(new Date).getTime();if(this._previousOne&&V-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=V;const N=this.system.getConnectedValue(D);if(N){const V=wl(N,D.dl,G.position);V.Vb.addOnce((()=>{this._triggerCount--})),l.Vb.addOnce((()=>{V.dispose()}))}}},previousItem:null,nextItem:null};l._updateQueueStart?zD(G,l._updateQueueStart):l._updateQueueStart=G,this.output._storedValue=l}serialize(){const D=super.serialize();return D.limit=this.limit,D.delay=this.delay,D}_deserialize(D){super._deserialize(D),void 0!==D.limit&&(this.limit=D.limit),void 0!==D.delay&&(this.delay=D.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,O.b)([Tl("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FG.prototype,"limit",void 0),(0,O.b)([Tl("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],FG.prototype,"delay",void 0),(0,X.c)("BABYLON.ParticleTriggerBlock",FG);G(13127),G(13139),G(13154),G(13218)},13202:(D,l,G)=>{"use strict";var V=G(11621);const N="clipPlaneFragment",M="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13162:(D,l,G)=>{"use strict";var V=G(11621);const N="clipPlaneFragmentDeclaration",M="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13229:(D,l,G)=>{"use strict";var V=G(11621);const N="clipPlaneVertex",M="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13221:(D,l,G)=>{"use strict";var V=G(11621);const N="clipPlaneVertexDeclaration",M="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13210:(D,l,G)=>{"use strict";var V=G(11621);const N="fogFragment",M="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13198:(D,l,G)=>{"use strict";var V=G(11621);const N="fogFragmentDeclaration",M="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13233:(D,l,G)=>{"use strict";var V=G(11621);const N="fogVertex",M="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13223:(D,l,G)=>{"use strict";var V=G(11621);const N="fogVertexDeclaration",M="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13185:(D,l,G)=>{"use strict";var V=G(11621);const N="helperFunctions",M="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13170:(D,l,G)=>{"use strict";var V=G(11621);const N="imageProcessingDeclaration",M="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13190:(D,l,G)=>{"use strict";var V=G(11621);const N="imageProcessingFunctions",M="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13176:(D,l,G)=>{"use strict";var V=G(11621);const N="logDepthDeclaration",M="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13206:(D,l,G)=>{"use strict";var V=G(11621);const N="logDepthFragment",M="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13235:(D,l,G)=>{"use strict";var V=G(11621);const N="logDepthVertex",M="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";V.b.IncludesShadersStoreWGSL[N]||(V.b.IncludesShadersStoreWGSL[N]=M)},13154:(D,l,G)=>{"use strict";G.r(l),G.d(l,{particlesPixelShaderWGSL:()=>b});var V=G(11621);G(13162),G(13170),G(13176),G(13185),G(13190),G(13198),G(13202),G(13206),G(13210);const N="particlesPixelShader",M="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";V.b.ShadersStoreWGSL[N]||(V.b.ShadersStoreWGSL[N]=M);const b={name:N,shader:M}},13218:(D,l,G)=>{"use strict";G.r(l),G.d(l,{particlesVertexShaderWGSL:()=>b});var V=G(11621);G(13221),G(13223),G(13176),G(13229),G(13233),G(13235);const N="particlesVertexShader",M="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";V.b.ShadersStoreWGSL[N]||(V.b.ShadersStoreWGSL[N]=M);const b={name:N,shader:M}},13061:(D,l,G)=>{"use strict";var V=G(11621);const N="clipPlaneFragment",M="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13134:(D,l,G)=>{"use strict";var V=G(11621);const N="clipPlaneFragmentDeclaration",M="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13082:(D,l,G)=>{"use strict";var V=G(11621);const N="clipPlaneVertex",M="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13148:(D,l,G)=>{"use strict";var V=G(11621);const N="clipPlaneVertexDeclaration",M="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13068:(D,l,G)=>{"use strict";var V=G(11621);const N="fogFragment",M="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13053:(D,l,G)=>{"use strict";var V=G(11621);const N="fogFragmentDeclaration",M="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13084:(D,l,G)=>{"use strict";var V=G(11621);const N="fogVertex",M="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13073:(D,l,G)=>{"use strict";var V=G(11621);const N="fogVertexDeclaration",M="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13037:(D,l,G)=>{"use strict";var V=G(11621);const N="helperFunctions",M="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13026:(D,l,G)=>{"use strict";var V=G(11621);const N="imageProcessingDeclaration",M="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13044:(D,l,G)=>{"use strict";var V=G(11621);const N="imageProcessingFunctions",M="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13033:(D,l,G)=>{"use strict";var V=G(11621);const N="logDepthDeclaration",M="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13063:(D,l,G)=>{"use strict";var V=G(11621);const N="logDepthFragment",M="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13093:(D,l,G)=>{"use strict";var V=G(11621);const N="logDepthVertex",M="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";V.b.IncludesShadersStore[N]||(V.b.IncludesShadersStore[N]=M)},13127:(D,l,G)=>{"use strict";G.r(l),G.d(l,{particlesPixelShader:()=>b});var V=G(11621);G(13134),G(13026),G(13033),G(13037),G(13044),G(13053),G(13061),G(13063),G(13068);const N="particlesPixelShader",M="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";V.b.ShadersStore[N]||(V.b.ShadersStore[N]=M);const b={name:N,shader:M}},13139:(D,l,G)=>{"use strict";G.r(l),G.d(l,{particlesVertexShader:()=>b});var V=G(11621);G(13148),G(13073),G(13033),G(13082),G(13084),G(13093);const N="particlesVertexShader",M="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";V.b.ShadersStore[N]||(V.b.ShadersStore[N]=M);const b={name:N,shader:M}},13472:(D,l,G)=>{"use strict";G.r(l),G.d(l,{FlowGraphGLTFDataProvider:()=>M});var V=G(13442),N=G(13423);class M extends V.c{constructor(D){var l,G;super();const V=D.glTF,M=(null===(l=V.animations)||void 0===l?void 0:l.map((D=>D._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",N.d,M);const b=(null===(G=V.nodes)||void 0===G?void 0:G.map((D=>D._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",N.d,b)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13367:(D,l,G)=>{"use strict";G.d(l,{e:()=>d,h:()=>K,l:()=>e,o:()=>F});var V=G(11710),N=G(12208),M=G(11755),b=G(13375);const X=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class t{constructor(D,l){this._gltf=D,this._infoTree=l}convert(D){let l,G=this._gltf,V=this._infoTree;if(!D.startsWith("/"))throw new Error("Path must start with a /");const N=D.split("/");if(N.shift(),N[N.length-1].includes(".length")){const D=N[N.length-1].split(".");N.pop(),N.push(...D)}let M=!1;for(const t of N){const N="length"===t;if(N&&!V.__array__)throw new Error(`Path ${D} is invalid`);if(V.__ignoreObjectTree__&&(M=!0),V.__array__&&!N)V=V.__array__;else if(V=V[t],!V)throw new Error(`Path ${D} is invalid`);if(!M)if(void 0===G){if(!X.find((l=>l.regex.test(D))))throw new Error(`Path ${D} is invalid`)}else if(!N){var b;G=null===(b=G)||void 0===b?void 0:b[t]}(V.__target__||N)&&(l=G)}return{object:l,info:V}}}function R(D,l,G,V){const N=n(D,l);return V?N[G][V]:N[G]}function n(D,l,G){var V,M;return null===(V=D._data)||void 0===V||null===(M=V[(null===G||void 0===G?void 0:G.fillMode)??N.e.MATERIAL_TriangleFillMode])||void 0===M?void 0:M.babylonMaterial}function g(D,l){return{offset:{componentsCount:2,type:"Vector2",get:(G,N,M)=>{const b=R(G,M,D,l);return new V.Vector2(null===b||void 0===b?void 0:b.uOffset,null===b||void 0===b?void 0:b.vOffset)},getTarget:n,set:(G,V,N,M)=>{const b=R(V,M,D,l);b.uOffset=G.x,b.vOffset=G.y},getPropertyName:[()=>`${D}${l?"."+l:""}.uOffset`,()=>`${D}${l?"."+l:""}.vOffset`]},rotation:{type:"number",get:(G,V,N)=>{var M;return null===(M=R(G,N,D,l))||void 0===M?void 0:M.wAng},getTarget:n,set:(G,V,N,M)=>R(V,M,D,l).wAng=G,getPropertyName:[()=>`${D}${l?"."+l:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(G,N,M)=>{const b=R(G,M,D,l);return new V.Vector2(null===b||void 0===b?void 0:b.uScale,null===b||void 0===b?void 0:b.vScale)},getTarget:n,set:(G,V,N,M)=>{const b=R(V,M,D,l);b.uScale=G.x,b.vScale=G.y},getPropertyName:[()=>`${D}${l?"."+l:""}.uScale`,()=>`${D}${l?"."+l:""}.vScale`]}}}const j={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:D=>{var l,G;return new V.Vector2((null===(l=D._babylonCamera)||void 0===l?void 0:l.orthoLeft)??0,(null===(G=D._babylonCamera)||void 0===G?void 0:G.orthoRight)??0)},set:(D,l)=>{l._babylonCamera&&(l._babylonCamera.orthoLeft=D.x,l._babylonCamera.orthoRight=D.y)},getTarget:D=>D,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:D=>{var l,G;return new V.Vector2((null===(l=D._babylonCamera)||void 0===l?void 0:l.orthoBottom)??0,(null===(G=D._babylonCamera)||void 0===G?void 0:G.orthoTop)??0)},set:(D,l)=>{l._babylonCamera&&(l._babylonCamera.orthoBottom=D.x,l._babylonCamera.orthoTop=D.y)},getTarget:D=>D,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:D=>{var l;return null===(l=D._babylonCamera)||void 0===l?void 0:l.maxZ},set:(D,l)=>{l._babylonCamera&&(l._babylonCamera.maxZ=D)},getTarget:D=>D,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:D=>{var l;return null===(l=D._babylonCamera)||void 0===l?void 0:l.Kb},set:(D,l)=>{l._babylonCamera&&(l._babylonCamera.Kb=D)},getTarget:D=>D,getPropertyName:[()=>"Kb"]}},perspective:{aspectRatio:{type:"number",get:D=>{var l;return null===(l=D._babylonCamera)||void 0===l?void 0:l.getEngine().getAspectRatio(D._babylonCamera)},getTarget:D=>D,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:D=>{var l;return null===(l=D._babylonCamera)||void 0===l?void 0:l.fov},set:(D,l)=>{l._babylonCamera&&(l._babylonCamera.fov=D)},getTarget:D=>D,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:D=>{var l;return null===(l=D._babylonCamera)||void 0===l?void 0:l.maxZ},set:(D,l)=>{l._babylonCamera&&(l._babylonCamera.maxZ=D)},getTarget:D=>D,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:D=>{var l;return null===(l=D._babylonCamera)||void 0===l?void 0:l.Kb},set:(D,l)=>{l._babylonCamera&&(l._babylonCamera.Kb=D)},getTarget:D=>D,getPropertyName:[()=>"Kb"]}}}},nodes:{length:{type:"number",get:D=>D.length,getTarget:D=>D.map((D=>D._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Kl",get:D=>{var l;return null===(l=D._babylonTransformNode)||void 0===l?void 0:l.position},set:(D,l)=>{var G;return null===(G=l._babylonTransformNode)||void 0===G?void 0:G.position.V(D)},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:D=>{var l;return null===(l=D._babylonTransformNode)||void 0===l?void 0:l.rotationQuaternion},set:(D,l)=>{var G,V;return null===(G=l._babylonTransformNode)||void 0===G||null===(V=G.rotationQuaternion)||void 0===V?void 0:V.V(D)},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Kl",get:D=>{var l;return null===(l=D._babylonTransformNode)||void 0===l?void 0:l.ub},set:(D,l)=>{var G;return null===(G=l._babylonTransformNode)||void 0===G?void 0:G.ub.V(D)},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"ub"]},weights:{length:{type:"number",get:D=>D._numMorphTargets,getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(D,l)=>{var G,V;return void 0!==l?null===(G=D._primitiveBabylonMeshes)||void 0===G||null===(V=G[0].morphTargetManager)||void 0===V?void 0:V.getTarget(l).influence:void 0},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(D,l)=>[0],getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:D=>{var l,G,N;return V.Matrix.Compose(null===(l=D._babylonTransformNode)||void 0===l?void 0:l.ub,null===(G=D._babylonTransformNode)||void 0===G?void 0:G.rotationQuaternion,null===(N=D._babylonTransformNode)||void 0===N?void 0:N.position)},getTarget:D=>D._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:D=>{var l,G,N,M;const b=V.Matrix.Identity();let X=D.parent;for(;X&&X.parent;)X=X.parent;const t=(null===(l=D._babylonTransformNode)||void 0===l?void 0:l.position._isDirty)||(null===(G=D._babylonTransformNode)||void 0===G||null===(N=G.rotationQuaternion)||void 0===N?void 0:N._isDirty)||(null===(M=D._babylonTransformNode)||void 0===M?void 0:M.ub._isDirty);if(X){var R;const l=null===(R=X._babylonTransformNode)||void 0===R?void 0:R.hb(!0).invert();var n,g;if(l)null===(n=D._babylonTransformNode)||void 0===n||null===(g=n.hb(t))||void 0===g||g.multiplyToRef(l,b)}else D._babylonTransformNode&&b.V(D._babylonTransformNode.hb(t));return b},getTarget:D=>D._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:D=>{var l,G;return null===(l=D._babylonTransformNode)||void 0===l||null===(G=l.getChildren((D=>D instanceof b.b),!0)[0])||void 0===G?void 0:G.Sb},getTarget:D=>{var l;return null===(l=D._babylonTransformNode)||void 0===l?void 0:l.getChildren((D=>D instanceof b.b),!0)[0]},set:(D,l)=>{if(l._babylonTransformNode){const G=l._babylonTransformNode.getChildren((D=>D instanceof b.b),!0)[0];G&&(G.Sb=D)}}},color:{type:"hl",get:D=>{var l,G;return null===(l=D._babylonTransformNode)||void 0===l||null===(G=l.getChildren((D=>D instanceof b.b),!0)[0])||void 0===G?void 0:G.Ob},getTarget:D=>{var l;return null===(l=D._babylonTransformNode)||void 0===l?void 0:l.getChildren((D=>D instanceof b.b),!0)[0]},set:(D,l)=>{if(l._babylonTransformNode){const G=l._babylonTransformNode.getChildren((D=>D instanceof b.b),!0)[0];G&&(G.Ob=D)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"hl",get:(D,l,G)=>n(D,l,G).emissiveColor,set:(D,l,G,V)=>n(l,G,V).emissiveColor.V(D),getTarget:(D,l,G)=>n(D,l,G),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:g("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(D,l,G)=>{var V;return null===(V=R(D,G,"bumpTexture"))||void 0===V?void 0:V.level},set:(D,l,G,V)=>{const N=R(l,V,"bumpTexture");N&&(N.level=D)},getTarget:(D,l,G)=>n(D,l,G),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:g("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(D,l,G)=>n(D,l,G).ambientTextureStrength,set:(D,l,G,V)=>{const N=n(l,G,V);N&&(N.ambientTextureStrength=D)},getTarget:(D,l,G)=>n(D,l,G),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:g("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Wb",get:(D,l,G)=>{const V=n(D,l,G);return M.Wb.FromColor3(V.albedoColor,V.alpha)},set:(D,l,G,V)=>{const N=n(l,G,V);N.albedoColor.set(D.r,D.g,D.b),N.alpha=D.a},getTarget:(D,l,G)=>n(D,l,G),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:g("albedoTexture")}},metallicFactor:{type:"number",get:(D,l,G)=>n(D,l,G).metallic,set:(D,l,G,V)=>{const N=n(l,G,V);N&&(N.metallic=D)},getTarget:(D,l,G)=>n(D,l,G),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(D,l,G)=>n(D,l,G).roughness,set:(D,l,G,V)=>{const N=n(l,G,V);N&&(N.roughness=D)},getTarget:(D,l,G)=>n(D,l,G),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:g("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(D,l,G)=>n(D,l,G).anisotropy.Sb,set:(D,l,G,V)=>{n(l,G,V).anisotropy.Sb=D},getTarget:(D,l,G)=>n(D,l,G),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(D,l,G)=>n(D,l,G).anisotropy.angle,set:(D,l,G,V)=>{n(l,G,V).anisotropy.angle=D},getTarget:(D,l,G)=>n(D,l,G),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:g("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(D,l,G)=>n(D,l,G).clearCoat.Sb,set:(D,l,G,V)=>{n(l,G,V).clearCoat.Sb=D},getTarget:(D,l,G)=>n(D,l,G),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(D,l,G)=>n(D,l,G).clearCoat.roughness,set:(D,l,G,V)=>{n(l,G,V).clearCoat.roughness=D},getTarget:(D,l,G)=>n(D,l,G),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:g("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(D,l,G)=>{var V;return null===(V=n(D,l,G).clearCoat.bumpTexture)||void 0===V?void 0:V.level},getTarget:n,set:(D,l,G,V)=>n(l,G,V).clearCoat.bumpTexture.level=D},extensions:{KHR_texture_transform:g("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:g("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(D,l,G)=>n(D,l,G).subSurface.dispersion,getTarget:n,set:(D,l,G,V)=>n(l,G,V).subSurface.dispersion=D}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(D,l,G)=>n(D,l,G).emissiveIntensity,getTarget:n,set:(D,l,G,V)=>n(l,G,V).emissiveIntensity=D}},KHR_materials_ior:{ior:{type:"number",get:(D,l,G)=>n(D,l,G).indexOfRefraction,getTarget:n,set:(D,l,G,V)=>n(l,G,V).indexOfRefraction=D}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(D,l,G)=>n(D,l,G).iridescence.Sb,getTarget:n,set:(D,l,G,V)=>n(l,G,V).iridescence.Sb=D},iridescenceIor:{type:"number",get:(D,l,G)=>n(D,l,G).iridescence.indexOfRefraction,getTarget:n,set:(D,l,G,V)=>n(l,G,V).iridescence.indexOfRefraction=D},iridescenceTexture:{extensions:{KHR_texture_transform:g("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(D,l,G)=>n(D,l,G).iridescence.maximumThickness,getTarget:n,set:(D,l,G,V)=>n(l,G,V).iridescence.maximumThickness=D},iridescenceThicknessMinimum:{type:"number",get:(D,l,G)=>n(D,l,G).iridescence.minimumThickness,getTarget:n,set:(D,l,G,V)=>n(l,G,V).iridescence.minimumThickness=D},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:g("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"hl",get:(D,l,G)=>n(D,l,G).sheen.color,getTarget:n,set:(D,l,G,V)=>n(l,G,V).sheen.color.V(D)},sheenColorTexture:{extensions:{KHR_texture_transform:g("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(D,l,G)=>n(D,l,G).sheen.Sb,getTarget:n,set:(D,l,G,V)=>n(l,G,V).sheen.Sb=D},sheenRoughnessTexture:{extensions:{KHR_texture_transform:g("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(D,l,G)=>n(D,l,G).metallicF0Factor,getTarget:n,set:(D,l,G,V)=>n(l,G,V).metallicF0Factor=D,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"hl",get:(D,l,G)=>n(D,l,G).metallicReflectanceColor,getTarget:n,set:(D,l,G,V)=>n(l,G,V).metallicReflectanceColor.V(D),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:g("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:g("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(D,l,G)=>n(D,l,G).subSurface.refractionIntensity,getTarget:n,set:(D,l,G,V)=>n(l,G,V).subSurface.refractionIntensity=D,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:g("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(D,l,G)=>n(D,l,G).subSurface.translucencyIntensity,getTarget:n,set:(D,l,G,V)=>n(l,G,V).subSurface.translucencyIntensity=D},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:g("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"hl",get:(D,l,G)=>n(D,l,G).subSurface.translucencyColor,getTarget:n,set:(D,l,G,V)=>{var N;return D&&(null===(N=n(l,G,V).subSurface.translucencyColor)||void 0===N?void 0:N.V(D))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:g("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"hl",get:(D,l,G)=>n(D,l,G).subSurface.tintColor,getTarget:n,set:(D,l,G,V)=>n(l,G,V).subSurface.tintColor.V(D)},attenuationDistance:{type:"number",get:(D,l,G)=>n(D,l,G).subSurface.tintColorAtDistance,getTarget:n,set:(D,l,G,V)=>n(l,G,V).subSurface.tintColorAtDistance=D},thicknessFactor:{type:"number",get:(D,l,G)=>n(D,l,G).subSurface.maximumThickness,getTarget:n,set:(D,l,G,V)=>n(l,G,V).subSurface.maximumThickness=D},thicknessTexture:{extensions:{KHR_texture_transform:g("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:D=>D.length,getTarget:D=>D.map((D=>D._babylonLight)),getPropertyName:[D=>"length"]},__array__:{__target__:!0,color:{type:"hl",get:D=>{var l;return null===(l=D._babylonLight)||void 0===l?void 0:l.Ob},set:(D,l)=>{var G;return null===(G=l._babylonLight)||void 0===G?void 0:G.Ob.V(D)},getTarget:D=>D._babylonLight,getPropertyName:[D=>"diffuse"]},Sb:{type:"number",get:D=>{var l;return null===(l=D._babylonLight)||void 0===l?void 0:l.Sb},set:(D,l)=>l._babylonLight?l._babylonLight.Sb=D:void 0,getTarget:D=>D._babylonLight,getPropertyName:[D=>"intensity"]},range:{type:"number",get:D=>{var l;return null===(l=D._babylonLight)||void 0===l?void 0:l.range},set:(D,l)=>l._babylonLight?l._babylonLight.range=D:void 0,getTarget:D=>D._babylonLight,getPropertyName:[D=>"range"]},spot:{innerConeAngle:{type:"number",get:D=>{var l;return null===(l=D._babylonLight)||void 0===l?void 0:l.innerAngle},set:(D,l)=>l._babylonLight?l._babylonLight.innerAngle=D:void 0,getTarget:D=>D._babylonLight,getPropertyName:[D=>"innerConeAngle"]},outerConeAngle:{type:"number",get:D=>{var l;return null===(l=D._babylonLight)||void 0===l?void 0:l.angle},set:(D,l)=>l._babylonLight?l._babylonLight.angle=D:void 0,getTarget:D=>D._babylonLight,getPropertyName:[D=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:D=>D.length,getTarget:D=>D.map((D=>D._babylonLight)),getPropertyName:[D=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:D=>D.length,getTarget:D=>D.map((D=>D._babylonTexture)),getPropertyName:[D=>"length"]},__array__:{__target__:!0,Sb:{type:"number",get:D=>{var l;return null===(l=D._babylonTexture)||void 0===l?void 0:l.level},set:(D,l)=>{l._babylonTexture&&(l._babylonTexture.level=D)},getTarget:D=>D._babylonTexture},rotation:{type:"Quaternion",get:D=>{var l;return D._babylonTexture&&V.Quaternion.FromRotationMatrix(null===(l=D._babylonTexture)||void 0===l?void 0:l.getReflectionTextureMatrix())},set:(D,l)=>{var G;l._babylonTexture&&(null!==(G=l._babylonTexture.uD())&&void 0!==G&&G.useRightHandedSystem||(D=V.Quaternion.Inverse(D)),V.Matrix.FromQuaternionToRef(D,l._babylonTexture.getReflectionTextureMatrix()))},getTarget:D=>D._babylonTexture}}}}},animations:{length:{type:"number",get:D=>D.length,getTarget:D=>D.map((D=>D._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:D=>D.length,getTarget:D=>D.map((D=>{var l;return null===(l=D.primitives[0]._instanceData)||void 0===l?void 0:l.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function e(D){return new t(D,j)}function K(D){const l=D.split("/").map((D=>D.replace(/{}/g,"__array__")));let G=j;for(const V of l)V&&(G=G[V]);if(G&&G.type&&G.get)return G}function F(D,l){const G=D.split("/").map((D=>D.replace(/{}/g,"__array__")));let V=j;for(const N of G)N&&(V=V[N]);V&&V.type&&V.get&&(V.interpolation=l)}function d(D,l){const G=D.split("/").map((D=>D.replace(/{}/g,"__array__")));let V=j;for(const N of G)if(N){if(!V[N]){if("?"===N){V.__ignoreObjectTree__=!0;continue}V[N]={},"__array__"===N&&(V[N].__target__=!0)}V=V[N]}Object.assign(V,l)}},13381:(D,l,G)=>{"use strict";G.r(l),G.d(l,{AnimationPropertyInfo:()=>R,TransformNodeAnimationPropertyInfo:()=>n,WeightAnimationPropertyInfo:()=>g,getQuaternion:()=>X,getVector3:()=>b,getWeights:()=>t});var V=G(12247),N=G(11710),M=G(13367);function b(D,l,G,V){return N.Kl.xl(l,G).scaleInPlace(V)}function X(D,l,G,V){return N.Quaternion.xl(l,G).scaleInPlace(V)}function t(D,l,G,V){const N=new Array(D._numMorphTargets);for(let M=0;M<N.length;M++)N[M]=l[G++]*V;return N}class R{constructor(D,l,G,V){this.type=D,this.name=l,this.getValue=G,this.getStride=V}_buildAnimation(D,l,G){const N=new V.b(D,this.name,l,this.type);return N.setKeys(G),N}}class n extends R{buildAnimations(D,l,G,V){const N=[];return N.push({babylonAnimatable:D._babylonTransformNode,babylonAnimation:this._buildAnimation(l,G,V)}),N}}class g extends R{buildAnimations(D,l,G,N){const M=[];if(D._numMorphTargets)for(let b=0;b<D._numMorphTargets;b++){const X=new V.b(`${l}_${b}`,this.name,G,this.type);if(X.setKeys(N.map((D=>({frame:D.frame,inTangent:D.inTangent?D.inTangent[b]:void 0,value:D.value[b],outTangent:D.outTangent?D.outTangent[b]:void 0,interpolation:D.interpolation})))),D._primitiveBabylonMeshes)for(const l of D._primitiveBabylonMeshes)if(l.morphTargetManager){const D=l.morphTargetManager.getTarget(b),G=X.clone();D.animations.push(G),M.push({babylonAnimatable:D,babylonAnimation:G})}}return M}}(0,M.o)("/nodes/{}/translation",[new n(V.b.ANIMATIONTYPE_VECTOR3,"position",b,(()=>3))]),(0,M.o)("/nodes/{}/rotation",[new n(V.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",X,(()=>4))]),(0,M.o)("/nodes/{}/scale",[new n(V.b.ANIMATIONTYPE_VECTOR3,"ub",b,(()=>3))]),(0,M.o)("/nodes/{}/weights",[new g(V.b.ANIMATIONTYPE_FLOAT,"influence",t,(D=>D._numMorphTargets))])},13338:(D,l,G)=>{"use strict";class V{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((D,l)=>{this._resolve=D,this._reject=l}))}}var N=G(11710),M=G(11755),b=G(11530),X=G(12175),t=G(13342),R=G(13350),n=G(11532),g=G(12202),j=G(12247),e=G(12250),K=G(11571),F=G(11546),d=G(11551);class H{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(D){this._useTextureToStoreBoneMatrices=D,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(D){this._animationPropertiesOverride=D}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(D,l,G){this.name=D,this.id=l,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=N.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new n.e,this.bones=[],this._scene=G||K.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const V=this._scene.getEngine().getCaps();this._canUseTextureForBones=V.textureFloat&&V.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((D=>!D.getParent()))}getTransformMatrices(D){if(this.needInitialSkinMatrix){if(!D)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return D._bonesTransformMatrices||this.prepare(!0),D._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(D){return this.needInitialSkinMatrix&&D._transformMatrixTexture?D._transformMatrixTexture:this._transformMatrixTexture}uD(){return this._scene}toString(D){let l=`Name: ${this.name}, nBones: ${this.bones.length}`;if(l+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,D){l+=", Ranges: {";let D=!0;for(const G in this._ranges)D&&(l+=", ",D=!1),l+=G;l+="}"}return l}getBoneIndexByName(D){for(let l=0,G=this.bones.length;l<G;l++)if(this.bones[l].name===D)return l;return-1}createAnimationRange(D,l,G){if(!this._ranges[D]){this._ranges[D]=new e.e(D,l,G);for(let V=0,N=this.bones.length;V<N;V++)this.bones[V].animations[0]&&this.bones[V].animations[0].createRange(D,l,G)}}deleteAnimationRange(D){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let G=0,V=this.bones.length;G<V;G++)this.bones[G].animations[0]&&this.bones[G].animations[0].deleteRange(D,l);this._ranges[D]=null}getAnimationRange(D){return this._ranges[D]||null}getAnimationRanges(){const D=[];let l;for(l in this._ranges)D.push(this._ranges[l]);return D}copyAnimationRange(D,l){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[l]||!D.getAnimationRange(l))return!1;let V=!0;const N=this._getHighestAnimationFrame()+1,M={},b=D.bones;let X,t;for(t=0,X=b.length;t<X;t++)M[b[t].name]=b[t];this.bones.length!==b.length&&(F.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${b.length}`),V=!1);const R=G&&this.dimensionsAtRest&&D.dimensionsAtRest?this.dimensionsAtRest.divide(D.dimensionsAtRest):null;for(t=0,X=this.bones.length;t<X;t++){const D=this.bones[t].name,b=M[D];b?V=V&&this.bones[t].copyAnimationRange(b,l,N,G,R):(F.d.Warn("copyAnimationRange: not same rig, missing source bone "+D),V=!1)}const n=D.getAnimationRange(l);return n&&(this._ranges[l]=new e.e(l,n.from+N,n.to+N)),V}returnToRest(){for(const D of this.bones)-1!==D._index&&D.returnToRest()}_getHighestAnimationFrame(){let D=0;for(let l=0,G=this.bones.length;l<G;l++)if(this.bones[l].animations[0]){const G=this.bones[l].animations[0].getHighestFrame();D<G&&(D=G)}return D}beginAnimation(D,l,G,V){const N=this.getAnimationRange(D);return N?this._scene.beginAnimation(this,N.from,N.to,l,G,V):null}static MakeAnimationAdditive(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,G=arguments.length>2?arguments[2]:void 0;const V=D.getAnimationRange(G);if(!V)return null;const N=D._scene.getAllAnimatablesByTarget(D);let M=null;for(let X=0;X<N.length;X++){const D=N[X];if(D.fromFrame===(null===V||void 0===V?void 0:V.from)&&D.toFrame===(null===V||void 0===V?void 0:V.to)){M=D;break}}const b=D.getAnimatables();for(let X=0;X<b.length;X++){const D=b[X].animations;if(D)for(let V=0;V<D.length;V++)j.b.MakeAnimationAdditive(D[V],l,G)}return M&&(M.isAdditive=!0),D}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(D){this._meshesWithPoseMatrix.push(D)}_unregisterMeshWithPoseMatrix(D){const l=this._meshesWithPoseMatrix.indexOf(D);l>-1&&this._meshesWithPoseMatrix.splice(l,1)}_computeTransformMatrices(D,l){this.onBeforeComputeObservable.notifyObservers(this);for(let G=0;G<this.bones.length;G++){const V=this.bones[G];V._childUpdateId++;const N=V.getParent();if(N?V.getLocalMatrix().multiplyToRef(N.getFinalMatrix(),V.getFinalMatrix()):l?V.getLocalMatrix().multiplyToRef(l,V.getFinalMatrix()):V.getFinalMatrix().V(V.getLocalMatrix()),-1!==V._index){const l=null===V._index?G:V._index;V.getAbsoluteInverseBindMatrix().multiplyToArray(V.getFinalMatrix(),D,16*l)}}this._identity.copyToArray(D,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const D=this.uD().getRenderId();if(this._currentRenderId===D)return;this._currentRenderId=D}if(this._numBonesWithLinkedTransformNode>0)for(const D of this.bones)if(D._linkedTransformNode){const l=D._linkedTransformNode;D.position=l.position,l.rotationQuaternion?D.rotationQuaternion=l.rotationQuaternion:D.rotation=l.rotation,D.ub=l.ub}if(this.needInitialSkinMatrix)for(const D of this._meshesWithPoseMatrix){const l=D.getPoseMatrix();let G=this._isDirty;if(D._bonesTransformMatrices&&D._bonesTransformMatrices.length===16*(this.bones.length+1)||(D._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),G=!0),G){if(this._synchronizedWithMesh!==D){this._synchronizedWithMesh=D;for(const D of this.bones)if(!D.getParent()){D.getBindMatrix().multiplyToRef(l,N.TmpVectors.Matrix[1]),D._updateAbsoluteBindMatrices(N.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const l=4*(this.bones.length+1);D._transformMatrixTexture&&D._transformMatrixTexture.getSize().width===l||(D._transformMatrixTexture&&D._transformMatrixTexture.dispose(),D._transformMatrixTexture=g.e.CreateRGBATexture(D._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(D._bonesTransformMatrices,l),this.isUsingTextureForMatrices&&D._transformMatrixTexture&&D._transformMatrixTexture.update(D._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=g.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let D=0;D<this.bones.length;D++)this._animatables.push(this.bones[D])}return this._animatables}clone(D,l){const G=new H(D,l||D,this._scene);G.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let V=0;V<this.bones.length;V++){const D=this.bones[V];let l=null;const N=D.getParent();if(N){const D=this.bones.indexOf(N);l=G.bones[D]}const M=new R.e(D.name,G,l,D.getBindMatrix().clone(),D.getRestMatrix().clone());M._index=D._index,D._linkedTransformNode&&M.linkTransformNode(D._linkedTransformNode),d.e.DeepCopy(D.animations,M.animations)}if(this._ranges){G._ranges={};for(const D in this._ranges){const l=this._ranges[D];l&&(G._ranges[D]=l.clone())}}return this._isDirty=!0,G.prepare(!0),G}enableBlending(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const l of this.bones)for(const G of l.animations)G.enableBlending=!0,G.blendingSpeed=D}dispose(){if(this._meshesWithPoseMatrix.length=0,this.uD().stopAnimation(this),this.uD().removeSkeleton(this),this._parentContainer){const D=this._parentContainer.skeletons.indexOf(this);D>-1&&this._parentContainer.skeletons.splice(D,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const D={};D.name=this.name,D.id=this.id,this.dimensionsAtRest&&(D.dimensionsAtRest=this.dimensionsAtRest.gb()),D.bones=[],D.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let G=0;G<this.bones.length;G++){var l;const V=this.bones[G],N=V.getParent(),M={parentBoneIndex:N?this.bones.indexOf(N):-1,index:V.getIndex(),name:V.name,id:V.id,matrix:V.getBindMatrix().gb(),rest:V.getRestMatrix().gb(),linkedTransformNodeId:null===(l=V.getTransformNode())||void 0===l?void 0:l.id};D.bones.push(M),V.length&&(M.length=V.length),V.metadata&&(M.metadata=V.metadata),V.animations&&V.animations.length>0&&(M.animation=V.animations[0].serialize()),D.ranges=[];for(const l in this._ranges){const G=this._ranges[l];if(!G)continue;const V={};V.name=l,V.from=G.from,V.to=G.to,D.ranges.push(V)}}return D}static Parse(D,l){const G=new H(D.name,D.id,l);let V;for(D.dimensionsAtRest&&(G.dimensionsAtRest=N.Kl.xl(D.dimensionsAtRest)),G.needInitialSkinMatrix=D.needInitialSkinMatrix,V=0;V<D.bones.length;V++){const l=D.bones[V],M=D.bones[V].index;let b=null;l.parentBoneIndex>-1&&(b=G.bones[l.parentBoneIndex]);const X=l.rest?N.Matrix.xl(l.rest):null,t=new R.e(l.name,G,b,N.Matrix.xl(l.matrix),X,null,M);void 0!==l.id&&null!==l.id&&(t.id=l.id),l.length&&(t.length=l.length),l.metadata&&(t.metadata=l.metadata),l.animation&&t.animations.push(j.b.Parse(l.animation)),void 0!==l.linkedTransformNodeId&&null!==l.linkedTransformNodeId&&(G._hasWaitingData=!0,t._waitingTransformNodeId=l.linkedTransformNodeId)}if(D.ranges)for(V=0;V<D.ranges.length;V++){const l=D.ranges[V];G.createAnimationRange(l.name,l.from,l.to)}return G}computeAbsoluteMatrices(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||D)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(D)}getPoseMatrix(){let D=null;return this._meshesWithPoseMatrix.length>0&&(D=this._meshesWithPoseMatrix[0].getPoseMatrix()),D}sortBones(){const D=[],l=new Array(this.bones.length);for(let G=0;G<this.bones.length;G++)this._sortBones(G,D,l);this.bones=D}_sortBones(D,l,G){if(G[D])return;G[D]=!0;const V=this.bones[D];if(!V)return;void 0===V._index&&(V._index=D);const N=V.getParent();N&&this._sortBones(this.bones.indexOf(N),l,G),l.push(V)}setCurrentPoseAsRest(){for(const D of this.bones)D.setCurrentPoseAsRest()}}var h=G(12052),x=G(12217),r=G(11686),o=G(12141),L=G(11788),u=G(12183),B=G(12149),I=G(12173),W=G(12258),i=G(11811),y=G(13313);class S{set areUpdatesFrozen(D){D?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new i.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,D||(D=K.d.LastCreatedScene),this._scene=D,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const D=this._scene.getEngine().getCaps();this._canUseTextureForTargets=D.canUseGLVertexID&&D.textureFloat&&D.maxVertexTextureImageUnits>0&&D.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return S.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?S.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(D){this._numMaxInfluencers!==D&&(this._numMaxInfluencers=D,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(D){this._useTextureToStoreTargets!==D&&(this._useTextureToStoreTargets=D,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var D;return S.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(D=this._scene)&&void 0!==D&&D.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(D){return this._activeTargets.data[D]}getTarget(D){return this._targets[D]}getTargetByName(D){for(const l of this._targets)if(l.name===D)return l;return null}addTarget(D){this._targets.push(D),this._targetInfluenceChangedObservers.push(D.onInfluenceChanged.add((D=>{this.areUpdatesFrozen&&D&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(D)}))),this._targetDataLayoutChangedObservers.push(D._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(D){const l=this._targets.indexOf(D);l>=0&&(this._targets.splice(l,1),D.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(l,1)[0]),D._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(l,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(D)}_bind(D){D.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),D.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),D.setTexture("morphTargets",this._targetStoreTexture),D.setInt("morphTargetCount",this.numInfluencers)}clone(){const D=new S(this._scene);for(const l of this._targets)D.addTarget(l.clone());return D.enablePositionMorphing=this.enablePositionMorphing,D.enableNormalMorphing=this.enableNormalMorphing,D.enableTangentMorphing=this.enableTangentMorphing,D.enableUVMorphing=this.enableUVMorphing,D.enableUV2Morphing=this.enableUV2Morphing,D.enableColorMorphing=this.enableColorMorphing,D}serialize(){const D={};D.id=this.uniqueId,D.targets=[];for(const l of this._targets)D.targets.push(l.serialize());return D}_syncActiveTargets(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const l=!!this._targetStoreTexture,G=this.isUsingTextureForTargets;(this._mustSynchronize||l!==G)&&(this._mustSynchronize=!1,this.synchronize());let V=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let N=-1;for(const M of this._targets)if(N++,0!==M.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=S.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(M),this._morphTargetTextureIndices[V]=N,this._tempInfluences[V++]=M.influence}this._morphTargetTextureIndices.length!==V&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,V)),this._influences&&this._influences.length===V||(this._influences=new Float32Array(V));for(let M=0;M<V;M++)this._influences[M]=this._tempInfluences[M];if(D&&this._scene)for(const M of this._scene.meshes)M.morphTargetManager===this&&(G?M._markSubMeshesAsAttributesDirty():M._syncGeometryWithMorphTargetManager())}synchronize(){var D;if(!this._scene||this.areUpdatesFrozen)return;const l=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(D=this._targetStoreTexture)||void 0===D||D.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>l.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const G of this._targets){this._supportsPositions=this._supportsPositions&&G.hasPositions,this._supportsNormals=this._supportsNormals&&G.hasNormals,this._supportsTangents=this._supportsTangents&&G.hasTangents,this._supportsUVs=this._supportsUVs&&G.hasUVs,this._supportsUV2s=this._supportsUV2s&&G.hasUV2s,this._supportsColors=this._supportsColors&&G.hasColors;const D=G.vertexCount;if(0===this._vertexCount)this._vertexCount=D;else if(this._vertexCount!==D)return void F.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${G.name}": ${D}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const D=l.getCaps().maxTextureSize;this._textureWidth>D&&(this._textureHeight=Math.ceil(this._textureWidth/D),this._textureWidth=D);const G=this._targets.length,V=new Float32Array(G*this._textureWidth*this._textureHeight*4);let N=0;for(let l=0;l<G;l++){const D=this._targets[l],G=D.getPositions(),M=D.getNormals(),b=D.getUVs(),X=D.getTangents(),t=D.getUV2s(),R=D.getColors();N=l*this._textureWidth*this._textureHeight*4;for(let l=0;l<this._vertexCount;l++)this._supportsPositions&&G&&(V[N]=G[3*l],V[N+1]=G[3*l+1],V[N+2]=G[3*l+2],N+=4),this._supportsNormals&&M&&(V[N]=M[3*l],V[N+1]=M[3*l+1],V[N+2]=M[3*l+2],N+=4),this._supportsUVs&&b&&(V[N]=b[2*l],V[N+1]=b[2*l+1],N+=4),this._supportsTangents&&X&&(V[N]=X[3*l],V[N+1]=X[3*l+1],V[N+2]=X[3*l+2],N+=4),this._supportsUV2s&&t&&(V[N]=t[2*l],V[N+1]=t[2*l+1],N+=4),this._supportsColors&&R&&(V[N]=R[4*l],V[N+1]=R[4*l+1],V[N+2]=R[4*l+2],V[N+3]=R[4*l+3],N+=4)}this._targetStoreTexture=y.c.CreateRGBATexture(V,this._textureWidth,this._textureHeight,G,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const G of this._scene.meshes)G.morphTargetManager===this&&G._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const D=this._parentContainer.morphTargetManagers.indexOf(this);D>-1&&this._parentContainer.morphTargetManagers.splice(D,1),this._parentContainer=null}for(const D of this._targets)this._scene.stopAnimation(D)}}static Parse(D,l){const G=new S(l);for(const V of D.targets)G.addTarget(W.e.Parse(V,l));return G}}S.EnableTextureStorage=!0,S.MaxActiveMorphTargetsInVertexAttributeMode=8,S.ConstantTargetCountForTextureMode=0;var O=G(13355),s=G(11573),U=G(12073);const f=new Map,q=f;function c(D,l,G){v(D)&&F.d.Warn(`Extension with the name '${D}' already exists`),f.set(D,{isGLTFExtension:l,factory:G})}function v(D){return f.delete(D)}var Z=G(13367),J=G(12322),Y=G(11798);class z{static Get(D,l,G){if(!l||void 0==G||!l[G])throw new Error(`${D}: Failed to find index (${G})`);return l[G]}static TryGet(D,l){return D&&void 0!=l&&D[l]?D[l]:null}static Assign(D){if(D)for(let l=0;l<D.length;l++)D[l].index=l}}function E(D){if(D.min&&D.max){const l=D.min,G=D.max,V=N.TmpVectors.Kl[0].Lb(l[0],l[1],l[2]),M=N.TmpVectors.Kl[1].Lb(G[0],G[1],G[2]);if(D.normalized&&5126!==D.componentType){let l=1;switch(D.componentType){case 5120:l=127;break;case 5121:l=255;break;case 5122:l=32767;break;case 5123:l=65535}const G=1/l;V.scaleInPlace(G),M.scaleInPlace(G)}return new U.d(V,M)}return null}class P{static RegisterExtension(D,l){c(D,!1,l)}static UnregisterExtension(D){return v(D)}get bb(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(D){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=D}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((D=>D.dispose&&D.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(D,l,G,V,N,M){let b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=l,this._assetContainer=G,this._loadData(V);let M=null;if(D){const l={};if(this._gltf.nodes)for(const D of this._gltf.nodes)D.name&&(l[D.name]=D.index);M=(D instanceof Array?D:[D]).map((D=>{const G=l[D];if(void 0===G)throw new Error(`Failed to find node '${D}'`);return G}))}return await this._loadAsync(N,b,M,(()=>({meshes:this._getMeshes(),xj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(D,l,G,V){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=D,this._loadData(l),await this._loadAsync(G,N,null,(()=>{}))}async _loadAsync(D,l,G,V){return await Promise.resolve().then((async()=>{this._rootUrl=D,this._uniqueRootUrl=!D.startsWith("file:")&&l?D:`${D}${Date.now()}/`,this._fileName=l,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const N=`${O.m[O.m.LOADING]} => ${O.m[O.m.READY]}`,M=`${O.m[O.m.LOADING]} => ${O.m[O.m.COMPLETE]}`;this._parent._startPerformanceCounter(N),this._parent._startPerformanceCounter(M),this._parent._setState(O.m.LOADING),this._extensionsOnLoading();const X=new Array;if(!this.parent.loadOnlyMaterials)if(G)X.push(this.loadSceneAsync("/nodes",{nodes:G,index:-1}));else if(void 0!=this._gltf.dl||this._gltf.scenes&&this._gltf.scenes[0]){const D=z.Get("/scene",this._gltf.scenes,this._gltf.dl||0);X.push(this.loadSceneAsync(`/scenes/${D.index}`,D))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let D=0;D<this._gltf.materials.length;++D){const l=this._gltf.materials[D],G="/materials/"+D,V=h.c.TriangleFillMode;X.push(this._loadMaterialAsync(G,l,null,V,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&X.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&X.push(this._compileShadowGeneratorsAsync());const t=Promise.all(X).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.QX(!0);for(const D of this._babylonScene.materials){const l=D;void 0!==l.maxSimultaneousLights&&(l.maxSimultaneousLights=Math.max(l.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(O.m.READY),this._skipStartAnimationStep||this._startAnimations(),V()}));return await t.then((D=>(this._parent._endPerformanceCounter(N),b.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(M),this._parent._setState(O.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(D=>{this._parent.onErrorObservable.notifyObservers(D),this._parent.onErrorObservable.clear(),this.dispose()}))})),D)))})).catch((D=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(D),this._parent.onErrorObservable.clear(),this.dispose()),D}))}_loadData(D){if(this._gltf=D.json,this._setupData(),D.bin){const l=this._gltf.buffers;if(l&&l[0]&&!l[0].uri){const G=l[0];(G.byteLength<D.bin.byteLength-3||G.byteLength>D.bin.byteLength)&&F.d.Warn(`Binary buffer length (${G.byteLength}) from JSON does not match chunk length (${D.bin.byteLength})`),this._bin=D.bin}else F.d.Warn("Unexpected BIN chunk")}}_setupData(){if(z.Assign(this._gltf.accessors),z.Assign(this._gltf.animations),z.Assign(this._gltf.buffers),z.Assign(this._gltf.bufferViews),z.Assign(this._gltf.cameras),z.Assign(this._gltf.images),z.Assign(this._gltf.materials),z.Assign(this._gltf.meshes),z.Assign(this._gltf.nodes),z.Assign(this._gltf.samplers),z.Assign(this._gltf.scenes),z.Assign(this._gltf.skins),z.Assign(this._gltf.textures),this._gltf.nodes){const D={};for(const G of this._gltf.nodes)if(G.children)for(const l of G.children)D[l]=G.index;const l=this._createRootNode();for(const G of this._gltf.nodes){const V=D[G.index];G.parent=void 0===V?l:this._gltf.nodes[V]}}}async _loadExtensionsAsync(){const D=[];if(q.forEach(((l,G)=>{var V;!1===(null===(V=this.parent.extensionOptions[G])||void 0===V?void 0:V.enabled)?l.isGLTFExtension&&this.isExtensionUsed(G)&&F.d.Warn(`Extension ${G} is used but has been explicitly disabled.`):l.isGLTFExtension&&!this.isExtensionUsed(G)||D.push((async()=>{const D=await l.factory(this);return D.name!==G&&F.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${D.name} !== ${G}`),this._parent.onExtensionLoadedObservable.notifyObservers(D),D})())})),this._extensions.push(...await Promise.all(D)),this._extensions.sort(((D,l)=>(D.order||Number.MAX_VALUE)-(l.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const G of this._gltf.extensionsRequired){if(!this._extensions.some((D=>D.name===G&&D.enabled))){var l;if(!1===(null===(l=this.parent.extensionOptions[G])||void 0===l?void 0:l.enabled))throw new Error(`Required extension ${G} is disabled`);throw new Error(`Required extension ${G} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const D=new I.b("__root__",this._babylonScene);this._rootBabylonMesh=D,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.QX(!1);const l={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case O.k.AUTO:this._babylonScene.useRightHandedSystem||(l.rotation=[0,1,0,0],l.scale=[1,1,-1],P._LoadTransform(l,this._rootBabylonMesh));break;case O.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(D),l}loadSceneAsync(D,l){const G=this._extensionsLoadSceneAsync(D,l);if(G)return G;const V=new Array;if(this.logOpen(`${D} ${l.name||""}`),l.nodes)for(const N of l.nodes){const l=z.Get(`${D}/nodes/${N}`,this._gltf.nodes,N);V.push(this.loadNodeAsync(`/nodes/${l.index}`,l,(D=>{D.parent=this._rootBabylonMesh})))}for(const N of this._postSceneLoadActions)N();return V.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(V).then((()=>{}))}_forEachPrimitive(D,l){if(D._primitiveBabylonMeshes)for(const G of D._primitiveBabylonMeshes)l(G)}_getGeometries(){const D=[],l=this._gltf.nodes;if(l)for(const G of l)this._forEachPrimitive(G,(l=>{const G=l.xb;G&&-1===D.indexOf(G)&&D.push(G)}));return D}_getMeshes(){const D=[];this._rootBabylonMesh instanceof B.d&&D.push(this._rootBabylonMesh);const l=this._gltf.nodes;if(l)for(const G of l)this._forEachPrimitive(G,(l=>{D.push(l)}));return D}_getTransformNodes(){const D=[],l=this._gltf.nodes;if(l)for(const G of l)G._babylonTransformNode&&"qb"===G._babylonTransformNode.getClassName()&&D.push(G._babylonTransformNode),G._babylonTransformNodeForSkin&&D.push(G._babylonTransformNodeForSkin);return D}_getSkeletons(){const D=[],l=this._gltf.skins;if(l)for(const G of l)G._data&&D.push(G._data.babylonSkeleton);return D}_getAnimationGroups(){const D=[],l=this._gltf.animations;if(l)for(const G of l)G._babylonAnimationGroup&&D.push(G._babylonAnimationGroup);return D}_startAnimations(){switch(this._parent.animationStartMode){case O.h.NONE:break;case O.h.FIRST:{const D=this._getAnimationGroups();0!==D.length&&D[0].start(!0);break}case O.h.ALL:{const D=this._getAnimationGroups();for(const l of D)l.start(!0);break}default:return void F.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const V=this._extensionsLoadNodeAsync(D,l,G);if(V)return V;if(l._babylonTransformNode)throw new Error(`${D}: Invalid recursive node hierarchy`);const N=new Array;this.logOpen(`${D} ${l.name||""}`);const M=V=>{if(P.AddPointerMetadata(V,D),P._LoadTransform(l,V),void 0!=l.camera){const G=z.Get(`${D}/camera`,this._gltf.cameras,l.camera);N.push(this.loadCameraAsync(`/cameras/${G.index}`,G,(D=>{D.parent=V,this._babylonScene.useRightHandedSystem||(V.ub.x=-1)})))}if(l.children)for(const G of l.children){const l=z.Get(`${D}/children/${G}`,this._gltf.nodes,G);N.push(this.loadNodeAsync(`/nodes/${l.index}`,l,(D=>{D.parent=V})))}G(V)},b=void 0!=l.mesh,X=this._parent.loadSkins&&void 0!=l.skin;if(!b||X){const D=l.name||`node${l.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new o.d(D,this._babylonScene);G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==l.mesh?l._babylonTransformNode=G:l._babylonTransformNodeForSkin=G,M(G)}if(b)if(X){const G=z.Get(`${D}/mesh`,this._gltf.meshes,l.mesh);N.push(this._loadMeshAsync(`/meshes/${G.index}`,l,G,(G=>{const V=l._babylonTransformNodeForSkin;G.metadata=(0,J.c)(V.metadata,G.metadata||{});const M=z.Get(`${D}/skin`,this._gltf.skins,l.skin);N.push(this._loadSkinAsync(`/skins/${M.index}`,l,M,(D=>{this._forEachPrimitive(l,(l=>{l.skeleton=D})),this._postSceneLoadActions.push((()=>{if(void 0!=M.skeleton){const D=z.Get(`/skins/${M.index}/skeleton`,this._gltf.nodes,M.skeleton).parent;l.index===D.index?G.parent=V.parent:G.parent=D._babylonTransformNode}else G.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:V,skinnedNode:G})}))})))})))}else{const G=z.Get(`${D}/mesh`,this._gltf.meshes,l.mesh);N.push(this._loadMeshAsync(`/meshes/${G.index}`,l,G,M))}return this.logClose(),Promise.all(N).then((()=>(this._forEachPrimitive(l,(D=>{const l=D;!l.isAnInstance&&l.xb&&l.xb.useBoundingInfoFromGeometry?D.UD():D.refreshBoundingInfo(!0,!0)})),l._babylonTransformNode)))}_loadMeshAsync(D,l,G,V){const N=G.primitives;if(!N||!N.length)throw new Error(`${D}: Primitives are missing`);void 0==N[0].index&&z.Assign(N);const M=new Array;this.logOpen(`${D} ${G.name||""}`);const b=l.name||`node${l.index}`;if(1===N.length){const V=G.primitives[0];M.push(this._loadMeshPrimitiveAsync(`${D}/primitives/${V.index}`,b,l,G,V,(D=>{l._babylonTransformNode=D,l._primitiveBabylonMeshes=[D]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,l._babylonTransformNode=new o.d(b,this._babylonScene),l._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l._primitiveBabylonMeshes=[];for(const V of N)M.push(this._loadMeshPrimitiveAsync(`${D}/primitives/${V.index}`,`${b}_primitive${V.index}`,l,G,V,(D=>{D.parent=l._babylonTransformNode,l._primitiveBabylonMeshes.push(D)})))}return V(l._babylonTransformNode),this.logClose(),Promise.all(M).then((()=>l._babylonTransformNode))}_loadMeshPrimitiveAsync(D,l,G,V,N,M){const b=this._extensionsLoadMeshPrimitiveAsync(D,l,G,V,N,M);if(b)return b;this.logOpen(`${D}`);const X=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==G.skin&&!V.primitives[0].targets;let t,R;if(X&&N._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,t=N._instanceData.babylonSourceMesh.createInstance(l),t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R=N._instanceData.promise;else{const M=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new I.b(l,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.sideOrientation=this._babylonScene.useRightHandedSystem?h.c.CounterClockWiseSideOrientation:h.c.ClockWiseSideOrientation,this._createMorphTargets(D,G,V,N,b),M.push(this._loadVertexDataAsync(D,N,b).then((async l=>await this._loadMorphTargetsAsync(D,N,b,l).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,l.OD(b),l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const n=P._GetDrawMode(D,N.mode);if(void 0==N.material){let D=this._defaultBabylonMaterialData[n];D||(D=this._createDefaultMaterial("__GLTFLoader._default",n),this._parent.onMaterialLoadedObservable.notifyObservers(D),this._defaultBabylonMaterialData[n]=D),b.material=D}else if(!this.parent.skipMaterials){const l=z.Get(`${D}/material`,this._gltf.materials,N.material);M.push(this._loadMaterialAsync(`/materials/${l.index}`,l,b,n,(D=>{b.material=D})))}R=Promise.all(M),X&&(N._instanceData={babylonSourceMesh:b,promise:R}),t=b}return P.AddPointerMetadata(t,D),this._parent.onMeshLoadedObservable.notifyObservers(t),M(t),this.logClose(),R.then((()=>t))}_loadVertexDataAsync(D,l,G){const V=this._extensionsLoadVertexDataAsync(D,l,G);if(V)return V;const N=l.attributes;if(!N)throw new Error(`${D}: Attributes are missing`);const M=new Array,b=new u.c(G.name,this._babylonScene);if(void 0==l.indices)G.isUnIndexed=!0;else{const G=z.Get(`${D}/indices`,this._gltf.accessors,l.indices);M.push(this._loadIndicesAccessorAsync(`/accessors/${G.index}`,G).then((D=>{b.setIndices(D)})))}const X=(l,V,X)=>{if(void 0==N[l])return;G._delayInfo=G._delayInfo||[],-1===G._delayInfo.indexOf(V)&&G._delayInfo.push(V);const t=z.Get(`${D}/attributes/${l}`,this._gltf.accessors,N[l]);M.push(this._loadVertexAccessorAsync(`/accessors/${t.index}`,t,V).then((D=>{if(D.getKind()===L.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!G.skeleton){const D=E(t);D&&(b._boundingInfo=D,b.useBoundingInfoFromGeometry=!0)}b.setVerticesBuffer(D,t.count)}))),V==L.e.MatricesIndicesExtraKind&&(G.numBoneInfluencers=8),X&&X(t)};return X("POSITION",L.e.PositionKind),X("NORMAL",L.e.NormalKind),X("TANGENT",L.e.TangentKind),X("TEXCOORD_0",L.e.UVKind),X("TEXCOORD_1",L.e.UV2Kind),X("TEXCOORD_2",L.e.UV3Kind),X("TEXCOORD_3",L.e.UV4Kind),X("TEXCOORD_4",L.e.UV5Kind),X("TEXCOORD_5",L.e.UV6Kind),X("JOINTS_0",L.e.MatricesIndicesKind),X("WEIGHTS_0",L.e.MatricesWeightsKind),X("JOINTS_1",L.e.MatricesIndicesExtraKind),X("WEIGHTS_1",L.e.MatricesWeightsExtraKind),X("COLOR_0",L.e.ColorKind,(D=>{"VEC4"===D.type&&(G.hasVertexAlpha=!0)})),Promise.all(M).then((()=>b))}_createMorphTargets(D,l,G,V,N){if(!V.targets||!this._parent.loadMorphTargets)return;if(void 0==l._numMorphTargets)l._numMorphTargets=V.targets.length;else if(V.targets.length!==l._numMorphTargets)throw new Error(`${D}: Primitives do not have the same number of targets`);const M=G.extras?G.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,N.morphTargetManager=new S(this._babylonScene),N.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,N.morphTargetManager.areUpdatesFrozen=!0;for(let b=0;b<V.targets.length;b++){const D=l.weights?l.weights[b]:G.weights?G.weights[b]:0,V=M?M[b]:`morphTarget${b}`;N.morphTargetManager.addTarget(new W.e(V,D,N.uD()))}}_loadMorphTargetsAsync(D,l,G,V){if(!l.targets||!this._parent.loadMorphTargets)return Promise.resolve();const N=new Array,M=G.morphTargetManager;for(let b=0;b<M.numTargets;b++){const G=M.getTarget(b);N.push(this._loadMorphTargetVertexDataAsync(`${D}/targets/${b}`,V,l.targets[b],G))}return Promise.all(N).then((()=>{M.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(D,l,G,V){const N=new Array,M=(V,M,b)=>{if(void 0==G[V])return;const X=l.getVertexBuffer(M);if(!X)return;const t=z.Get(`${D}/${V}`,this._gltf.accessors,G[V]);N.push(this._loadFloatAccessorAsync(`/accessors/${t.index}`,t).then((D=>{b(X,D)})))};return M("POSITION",L.e.PositionKind,((D,l)=>{const G=new Float32Array(l.length);D.forEach(l.length,((D,V)=>{G[V]=l[V]+D})),V.setPositions(G)})),M("NORMAL",L.e.NormalKind,((D,l)=>{const G=new Float32Array(l.length);D.forEach(G.length,((D,V)=>{G[V]=l[V]+D})),V.setNormals(G)})),M("TANGENT",L.e.TangentKind,((D,l)=>{const G=new Float32Array(l.length/3*4);let N=0;D.forEach(l.length/3*4,((D,V)=>{(V+1)%4!==0&&(G[N]=l[N]+D,N++)})),V.setTangents(G)})),M("TEXCOORD_0",L.e.UVKind,((D,l)=>{const G=new Float32Array(l.length);D.forEach(l.length,((D,V)=>{G[V]=l[V]+D})),V.setUVs(G)})),M("TEXCOORD_1",L.e.UV2Kind,((D,l)=>{const G=new Float32Array(l.length);D.forEach(l.length,((D,V)=>{G[V]=l[V]+D})),V.setUV2s(G)})),M("COLOR_0",L.e.ColorKind,((l,G)=>{let N=null;const M=l.getSize();if(3===M){N=new Float32Array(G.length/3*4),l.forEach(G.length,((D,l)=>{const V=Math.floor(l/3),M=l%3;N[4*V+M]=G[3*V+M]+D}));for(let D=0;D<G.length/3;++D)N[4*D+3]=1}else{if(4!==M)throw new Error(`${D}: Invalid number of components (${M}) for COLOR_0 attribute`);N=new Float32Array(G.length),l.forEach(G.length,((D,l)=>{N[l]=G[l]+D}))}V.setColors(N)})),await Promise.all(N).then((()=>{}))}static _LoadTransform(D,l){if(void 0!=D.skin)return;let G=N.Kl.Zero(),V=N.Quaternion.Identity(),M=N.Kl.One();if(D.matrix){N.Matrix.xl(D.matrix).decompose(M,V,G)}else D.translation&&(G=N.Kl.xl(D.translation)),D.rotation&&(V=N.Quaternion.xl(D.rotation)),D.scale&&(M=N.Kl.xl(D.scale));l.position=G,l.rotationQuaternion=V,l.ub=M}_loadSkinAsync(D,l,G,V){if(!this._parent.loadSkins)return Promise.resolve();const N=this._extensionsLoadSkinAsync(D,l,G);if(N)return N;if(G._data)return V(G._data.babylonSkeleton),G._data.promise;const M=`skeleton${G.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new H(G.name||M,M,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(D,G,b);const X=this._loadSkinInverseBindMatricesDataAsync(D,G).then((D=>{this._updateBoneMatrices(b,D)}));return G._data={babylonSkeleton:b,promise:X},V(b),X}_loadBones(D,l,G){if(void 0==l.skeleton||this._parent.alwaysComputeSkeletonRootNode){const G=this._findSkeletonRootNode(`${D}/joints`,l.joints);if(G)if(void 0===l.skeleton)l.skeleton=G.index;else{const V=(D,l)=>{for(;l.parent;l=l.parent)if(l.parent===D)return!0;return!1},N=z.Get(`${D}/skeleton`,this._gltf.nodes,l.skeleton);N===G||V(N,G)||(F.d.Warn(`${D}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),l.skeleton=G.index)}else F.d.Warn(`${D}: Failed to find common root`)}const V={};for(const N of l.joints){const M=z.Get(`${D}/joints/${N}`,this._gltf.nodes,N);this._loadBone(M,l,G,V)}}_findSkeletonRootNode(D,l){if(0===l.length)return null;const G={};for(const N of l){const l=[];let V=z.Get(`${D}/${N}`,this._gltf.nodes,N);for(;-1!==V.index;)l.unshift(V),V=V.parent;G[N]=l}let V=null;for(let N=0;;++N){let D=G[l[0]];if(N>=D.length)return V;const M=D[N];for(let b=1;b<l.length;++b)if(D=G[l[b]],N>=D.length||M!==D[N])return V;V=M}}_loadBone(D,l,G,V){D._isJoint=!0;let N=V[D.index];if(N)return N;let M=null;D.index!==l.skeleton&&(D.parent&&-1!==D.parent.index?M=this._loadBone(D.parent,l,G,V):void 0!==l.skeleton&&F.d.Warn(`/skins/${l.index}/skeleton: Skeleton node is not a common root`));const b=l.joints.indexOf(D.index);return N=new R.e(D.name||`joint${D.index}`,G,M,this._getNodeMatrix(D),null,null,b),V[D.index]=N,this._postSceneLoadActions.push((()=>{N.linkTransformNode(D._babylonTransformNode)})),N}_loadSkinInverseBindMatricesDataAsync(D,l){if(void 0==l.inverseBindMatrices)return Promise.resolve(null);const G=z.Get(`${D}/inverseBindMatrices`,this._gltf.accessors,l.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${G.index}`,G)}_updateBoneMatrices(D,l){for(const G of D.bones){const D=N.Matrix.Identity(),V=G._index;l&&-1!==V&&(N.Matrix.FromArrayToRef(l,16*V,D),D.invertToRef(D));const M=G.getParent();M&&D.multiplyToRef(M.getAbsoluteInverseBindMatrix(),D),G.Hb(D,!1,!1),G._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(D){return D.matrix?N.Matrix.xl(D.matrix):N.Matrix.Compose(D.scale?N.Kl.xl(D.scale):N.Kl.One(),D.rotation?N.Quaternion.xl(D.rotation):N.Quaternion.Identity(),D.translation?N.Kl.xl(D.translation):N.Kl.Zero())}loadCameraAsync(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const V=this._extensionsLoadCameraAsync(D,l,G);if(V)return V;const M=new Array;this.logOpen(`${D} ${l.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new t.b(l.name||`camera${l.index}`,N.Kl.Zero(),this._babylonScene,!1);switch(b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l._babylonCamera=b,b.setTarget(new N.Kl(0,0,-1)),l.type){case"perspective":{const G=l.perspective;if(!G)throw new Error(`${D}: Camera perspective properties are missing`);b.fov=G.yfov,b.Kb=G.znear,b.maxZ=G.zfar||0;break}case"orthographic":if(!l.orthographic)throw new Error(`${D}: Camera orthographic properties are missing`);b.mode=X.e.ORTHOGRAPHIC_CAMERA,b.orthoLeft=-l.orthographic.xmag,b.orthoRight=l.orthographic.xmag,b.orthoBottom=-l.orthographic.ymag,b.orthoTop=l.orthographic.ymag,b.Kb=l.orthographic.znear,b.maxZ=l.orthographic.zfar;break;default:throw new Error(`${D}: Invalid camera type (${l.type})`)}return P.AddPointerMetadata(b,D),this._parent.onCameraLoadedObservable.notifyObservers(b),G(b),this.logClose(),Promise.all(M).then((()=>b))}_loadAnimationsAsync(){const D=this._gltf.animations;if(!D)return Promise.resolve();const l=new Array;for(let G=0;G<D.length;G++){const V=D[G];l.push(this.loadAnimationAsync(`/animations/${V.index}`,V).then((D=>{0===D.targetedAnimations.length&&D.dispose()})))}return Promise.all(l).then((()=>{}))}loadAnimationAsync(D,l){const V=this._extensionsLoadAnimationAsync(D,l);return V||G.e(78).then(G.bind(G,14806)).then((G=>{let{AnimationGroup:V}=G;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new V(l.name||`animation${l.index}`,this._babylonScene);N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l._babylonAnimationGroup=N;const M=new Array;z.Assign(l.channels),z.Assign(l.samplers);for(const b of l.channels)M.push(this._loadAnimationChannelAsync(`${D}/channels/${b.index}`,D,l,b,((D,l)=>{D.animations=D.animations||[],D.animations.push(l),N.addTargetedAnimation(l,D)})));return Promise.all(M).then((()=>(N.normalize(0),N)))}))}async _loadAnimationChannelAsync(D,l,V,N,M){const b=this._extensionsLoadAnimationChannelAsync(D,l,V,N,M);if(b)return await b;if(void 0==N.target.node)return await Promise.resolve();const X=z.Get(`${D}/target/node`,this._gltf.nodes,N.target.node),t=N.target.path,R="weights"===t;if(R&&!X._numMorphTargets||!R&&!X._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!R&&!X._isJoint)return await Promise.resolve();let n;switch(await Promise.resolve().then(G.bind(G,13381)),t){case"translation":var g;n=null===(g=(0,Z.h)("/nodes/{}/translation"))||void 0===g?void 0:g.interpolation;break;case"rotation":var j;n=null===(j=(0,Z.h)("/nodes/{}/rotation"))||void 0===j?void 0:j.interpolation;break;case"scale":var e;n=null===(e=(0,Z.h)("/nodes/{}/scale"))||void 0===e?void 0:e.interpolation;break;case"weights":var K;n=null===(K=(0,Z.h)("/nodes/{}/weights"))||void 0===K?void 0:K.interpolation;break;default:throw new Error(`${D}/target/path: Invalid value (${N.target.path})`)}if(!n)throw new Error(`${D}/target/path: Could not find interpolation properties for target path (${N.target.path})`);const F={object:X,info:n};return await this._loadAnimationChannelFromTargetInfoAsync(D,l,V,N,F,M)}_loadAnimationChannelFromTargetInfoAsync(D,l,G,V,N,M){const b=this.parent.targetFps,X=1/b,t=z.Get(`${D}/sampler`,G.samplers,V.sampler);return this._loadAnimationSamplerAsync(`${l}/samplers/${V.sampler}`,t).then((D=>{let l=0;const t=N.object,R=N.info;for(const N of R){const R=N.getStride(t),n=D.input,g=D.output,j=new Array(n.length);let e=0;switch(D.interpolation){case"STEP":for(let D=0;D<n.length;D++){const l=N.getValue(t,g,e,1);e+=R,j[D]={frame:n[D]*b,value:l,interpolation:1}}break;case"CUBICSPLINE":for(let D=0;D<n.length;D++){const l=N.getValue(t,g,e,X);e+=R;const G=N.getValue(t,g,e,1);e+=R;const V=N.getValue(t,g,e,X);e+=R,j[D]={frame:n[D]*b,inTangent:l,value:G,outTangent:V}}break;case"LINEAR":for(let D=0;D<n.length;D++){const l=N.getValue(t,g,e,1);e+=R,j[D]={frame:n[D]*b,value:l}}}if(e>0){const D=`${G.name||`animation${G.index}`}_channel${V.index}_${l}`,X=N.buildAnimations(t,D,b,j);for(const G of X)l++,M(G.babylonAnimatable,G.babylonAnimation)}}}))}_loadAnimationSamplerAsync(D,l){if(l._data)return l._data;const G=l.interpolation||"LINEAR";switch(G){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${D}/interpolation: Invalid value (${l.interpolation})`)}const V=z.Get(`${D}/input`,this._gltf.accessors,l.input),N=z.Get(`${D}/output`,this._gltf.accessors,l.output);return l._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${V.index}`,V),this._loadFloatAccessorAsync(`/accessors/${N.index}`,N)]).then((D=>{let[l,V]=D;return{input:l,interpolation:G,output:V}})),l._data}loadBufferAsync(D,l,G,V){const N=this._extensionsLoadBufferAsync(D,l,G,V);if(N)return N;if(!l._data)if(l.uri)l._data=this.loadUriAsync(`${D}/uri`,l,l.uri);else{if(!this._bin)throw new Error(`${D}: Uri is missing or the binary glTF is missing its binary chunk`);l._data=this._bin.readAsync(0,l.byteLength)}return l._data.then((l=>{try{return new Uint8Array(l.buffer,l.byteOffset+G,V)}catch(N){throw new Error(`${D}: ${N.message}`)}}))}loadBufferViewAsync(D,l){const G=this._extensionsLoadBufferViewAsync(D,l);if(G)return G;if(l._data)return l._data;const V=z.Get(`${D}/buffer`,this._gltf.buffers,l.buffer);return l._data=this.loadBufferAsync(`/buffers/${V.index}`,V,l.byteOffset||0,l.byteLength),l._data}_loadAccessorAsync(D,l,G){if(l._data)return l._data;const V=P._GetNumComponents(D,l.type),N=V*L.e.GetTypeByteLength(l.componentType),M=V*l.count;if(void 0==l.bufferView)l._data=Promise.resolve(new G(M));else{const b=z.Get(`${D}/bufferView`,this._gltf.bufferViews,l.bufferView);l._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((X=>{if(5126!==l.componentType||l.normalized||b.byteStride&&b.byteStride!==N){const D=new G(M);return L.e.ForEach(X,l.byteOffset||0,b.byteStride||N,V,l.componentType,D.length,l.normalized||!1,((l,G)=>{D[G]=l})),D}return P._GetTypedArray(D,l.componentType,X,l.byteOffset,M)}))}if(l.sparse){const M=l.sparse;l._data=l._data.then((b=>{const X=b,t=z.Get(`${D}/sparse/indices/bufferView`,this._gltf.bufferViews,M.indices.bufferView),R=z.Get(`${D}/sparse/values/bufferView`,this._gltf.bufferViews,M.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${t.index}`,t),this.loadBufferViewAsync(`/bufferViews/${R.index}`,R)]).then((b=>{let[t,R]=b;const n=P._GetTypedArray(`${D}/sparse/indices`,M.indices.componentType,t,M.indices.byteOffset,M.count),g=V*M.count;let j;if(5126!==l.componentType||l.normalized){const b=P._GetTypedArray(`${D}/sparse/values`,l.componentType,R,M.values.byteOffset,g);j=new G(g),L.e.ForEach(b,0,N,V,l.componentType,j.length,l.normalized||!1,((D,l)=>{j[l]=D}))}else j=P._GetTypedArray(`${D}/sparse/values`,l.componentType,R,M.values.byteOffset,g);let e=0;for(let D=0;D<n.length;D++){let l=n[D]*V;for(let D=0;D<V;D++)X[l++]=j[e++]}return X}))}))}return l._data}_loadFloatAccessorAsync(D,l){return this._loadAccessorAsync(D,l,Float32Array)}_loadIndicesAccessorAsync(D,l){if("SCALAR"!==l.type)throw new Error(`${D}/type: Invalid value ${l.type}`);if(5121!==l.componentType&&5123!==l.componentType&&5125!==l.componentType)throw new Error(`${D}/componentType: Invalid value ${l.componentType}`);if(l._data)return l._data;if(l.sparse){const G=P._GetTypedArrayConstructor(`${D}/componentType`,l.componentType);l._data=this._loadAccessorAsync(D,l,G)}else{const G=z.Get(`${D}/bufferView`,this._gltf.bufferViews,l.bufferView);l._data=this.loadBufferViewAsync(`/bufferViews/${G.index}`,G).then((G=>P._GetTypedArray(D,l.componentType,G,l.byteOffset,l.count)))}return l._data}_loadVertexBufferViewAsync(D){if(D._babylonBuffer)return D._babylonBuffer;const l=this._babylonScene.getEngine();return D._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${D.index}`,D).then((D=>new L.d(l,D,!1))),D._babylonBuffer}_loadVertexAccessorAsync(D,l,G){var V;if(null!==(V=l._babylonVertexBuffer)&&void 0!==V&&V[G])return l._babylonVertexBuffer[G];l._babylonVertexBuffer||(l._babylonVertexBuffer={});const N=this._babylonScene.getEngine();if(l.sparse||void 0==l.bufferView)l._babylonVertexBuffer[G]=this._loadFloatAccessorAsync(D,l).then((D=>new L.e(N,D,G,!1)));else{const V=z.Get(`${D}/bufferView`,this._gltf.bufferViews,l.bufferView);l._babylonVertexBuffer[G]=this._loadVertexBufferViewAsync(V).then((M=>{const b=P._GetNumComponents(D,l.type);return new L.e(N,M,G,!1,void 0,V.byteStride,void 0,l.byteOffset,b,l.componentType,l.normalized,!0,void 0,!0)}))}return l._babylonVertexBuffer[G]}_loadMaterialMetallicRoughnessPropertiesAsync(D,l,G){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);const V=new Array;return l&&(l.baseColorFactor?(G.albedoColor=M.hl.xl(l.baseColorFactor),G.alpha=l.baseColorFactor[3]):G.albedoColor=M.hl.White(),G.metallic=void 0==l.metallicFactor?1:l.metallicFactor,G.roughness=void 0==l.roughnessFactor?1:l.roughnessFactor,l.baseColorTexture&&V.push(this.loadTextureInfoAsync(`${D}/baseColorTexture`,l.baseColorTexture,(D=>{D.name=`${G.name} (Base Color)`,G.albedoTexture=D}))),l.metallicRoughnessTexture&&(l.metallicRoughnessTexture.nonColorData=!0,V.push(this.loadTextureInfoAsync(`${D}/metallicRoughnessTexture`,l.metallicRoughnessTexture,(D=>{D.name=`${G.name} (Metallic Roughness)`,G.metallicTexture=D}))),G.useMetallnessFromMetallicTextureBlue=!0,G.useRoughnessFromMetallicTextureGreen=!0,G.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(V).then((()=>{}))}_loadMaterialAsync(D,l,G,V){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const M=this._extensionsLoadMaterialAsync(D,l,G,V,N);if(M)return M;l._data=l._data||{};let b=l._data[V];if(!b){this.logOpen(`${D} ${l.name||""}`);const G=this.createMaterial(D,l,V);b={babylonMaterial:G,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(D,l,G)},l._data[V]=b,P.AddPointerMetadata(G,D),this._parent.onMaterialLoadedObservable.notifyObservers(G),this.logClose()}return G&&(b.babylonMeshes.push(G),G.Vb.addOnce((()=>{const D=b.babylonMeshes.indexOf(G);-1!==D&&b.babylonMeshes.splice(D,1)}))),N(b.babylonMaterial),b.promise.then((()=>b.babylonMaterial))}_createDefaultMaterial(D,l){this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new x.c(D,this._babylonScene);return G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G.fillMode=l,G.enableSpecularAntiAliasing=!0,G.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,G.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,G.transparencyMode=x.c.PBRMATERIAL_OPAQUE,G.metallic=1,G.roughness=1,G}createMaterial(D,l,G){const V=this._extensionsCreateMaterial(D,l,G);if(V)return V;const N=l.name||`material${l.index}`;return this._createDefaultMaterial(N,G)}loadMaterialPropertiesAsync(D,l,G){const V=this._extensionsLoadMaterialPropertiesAsync(D,l,G);if(V)return V;const N=new Array;return N.push(this.loadMaterialBasePropertiesAsync(D,l,G)),l.pbrMetallicRoughness&&N.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${D}/pbrMetallicRoughness`,l.pbrMetallicRoughness,G)),this.loadMaterialAlphaProperties(D,l,G),Promise.all(N).then((()=>{}))}loadMaterialBasePropertiesAsync(D,l,G){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);const V=new Array;return G.emissiveColor=l.emissiveFactor?M.hl.xl(l.emissiveFactor):new M.hl(0,0,0),l.doubleSided&&(G.ob=!1,G.twoSidedLighting=!0),l.normalTexture&&(l.normalTexture.nonColorData=!0,V.push(this.loadTextureInfoAsync(`${D}/normalTexture`,l.normalTexture,(D=>{D.name=`${G.name} (Normal)`,G.bumpTexture=D}))),G.invertNormalMapX=!this._babylonScene.useRightHandedSystem,G.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=l.normalTexture.scale&&G.bumpTexture&&(G.bumpTexture.level=l.normalTexture.scale),G.forceIrradianceInFragment=!0),l.occlusionTexture&&(l.occlusionTexture.nonColorData=!0,V.push(this.loadTextureInfoAsync(`${D}/occlusionTexture`,l.occlusionTexture,(D=>{D.name=`${G.name} (Occlusion)`,G.ambientTexture=D}))),G.useAmbientInGrayScale=!0,void 0!=l.occlusionTexture.strength&&(G.ambientTextureStrength=l.occlusionTexture.strength)),l.emissiveTexture&&V.push(this.loadTextureInfoAsync(`${D}/emissiveTexture`,l.emissiveTexture,(D=>{D.name=`${G.name} (Emissive)`,G.emissiveTexture=D}))),Promise.all(V).then((()=>{}))}loadMaterialAlphaProperties(D,l,G){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);switch(l.alphaMode||"OPAQUE"){case"OPAQUE":G.transparencyMode=x.c.PBRMATERIAL_OPAQUE,G.alpha=1;break;case"MASK":G.transparencyMode=x.c.PBRMATERIAL_ALPHATEST,G.alphaCutOff=void 0==l.alphaCutoff?.5:l.alphaCutoff,G.albedoTexture&&(G.albedoTexture.eb=!0);break;case"BLEND":G.transparencyMode=x.c.PBRMATERIAL_ALPHABLEND,G.albedoTexture&&(G.albedoTexture.eb=!0,G.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${D}/alphaMode: Invalid value (${l.alphaMode})`)}}loadTextureInfoAsync(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const V=this._extensionsLoadTextureInfoAsync(D,l,G);if(V)return V;if(this.logOpen(`${D}`),l.texCoord>=6)throw new Error(`${D}/texCoord: Invalid value (${l.texCoord})`);const N=z.Get(`${D}/index`,this._gltf.textures,l.index);N._textureInfo=l;const M=this._loadTextureAsync(`/textures/${l.index}`,N,(V=>{V.coordinatesIndex=l.texCoord||0,P.AddPointerMetadata(V,D),this._parent.onTextureLoadedObservable.notifyObservers(V),G(V)}));return this.logClose(),M}_loadTextureAsync(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const V=this._extensionsLoadTextureAsync(D,l,G);if(V)return V;this.logOpen(`${D} ${l.name||""}`);const N=void 0==l.sampler?P.DefaultSampler:z.Get(`${D}/sampler`,this._gltf.samplers,l.sampler),M=z.Get(`${D}/source`,this._gltf.images,l.source),b=this._createTextureAsync(D,N,M,G,void 0,!l._textureInfo.nonColorData);return this.logClose(),b}_createTextureAsync(D,l,G){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},M=arguments.length>4?arguments[4]:void 0,b=arguments.length>5?arguments[5]:void 0;const X=this._loadSampler(`/samplers/${l.index}`,l),t=new Array,R=new V;this._babylonScene._blockEntityCollection=!!this._assetContainer;const n={noMipmap:X.noMipMaps,invertY:!1,samplingMode:X.samplingMode,T:()=>{this._disposed||R.resolve()},onError:(l,G)=>{this._disposed||R.reject(new Error(`${D}: ${G&&G.message?G.message:l||"Failed to load texture"}`))},mimeType:G.mimeType??(0,s.h)(G.uri??""),loaderOptions:M,useSRGBBuffer:!!b&&this._parent.useSRGBBuffers},g=new r.b(null,this._babylonScene,n);return g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.push(R.promise),t.push(this.loadImageAsync(`/images/${G.index}`,G).then((D=>{const l=G.uri||`${this._fileName}#image${G.index}`,V=`data:${this._uniqueRootUrl}${l}`;g.updateURL(V,D);const N=g.getInternalTexture();N&&(N.label=G.name)}))),g.wrapU=X.wrapU,g.wrapV=X.wrapV,N(g),this._parent.useGltfTextureNames&&(g.name=G.name||G.uri||`image${G.index}`),Promise.all(t).then((()=>g))}_loadSampler(D,l){return l._data||(l._data={noMipMaps:9728===l.minFilter||9729===l.minFilter,samplingMode:P._GetTextureSamplingMode(D,l),wrapU:P._GetTextureWrapMode(`${D}/wrapS`,l.wrapS),wrapV:P._GetTextureWrapMode(`${D}/wrapT`,l.wrapT)}),l._data}loadImageAsync(D,l){if(!l._data){if(this.logOpen(`${D} ${l.name||""}`),l.uri)l._data=this.loadUriAsync(`${D}/uri`,l,l.uri);else{const G=z.Get(`${D}/bufferView`,this._gltf.bufferViews,l.bufferView);l._data=this.loadBufferViewAsync(`/bufferViews/${G.index}`,G)}this.logClose()}return l._data}loadUriAsync(D,l,G){const V=this._extensionsLoadUriAsync(D,l,G);if(V)return V;if(!P._ValidateUri(G))throw new Error(`${D}: '${G}' is invalid`);if((0,s.k)(G)){const l=new Uint8Array((0,s.b)(G));return this.log(`${D}: Decoded ${G.substring(0,64)}... (${l.length} bytes)`),Promise.resolve(l)}return this.log(`${D}: Loading ${G}`),this._parent.preprocessUrlAsync(this._rootUrl+G).then((l=>new Promise(((V,N)=>{this._parent._loadFile(this._babylonScene,l,(l=>{this._disposed||(this.log(`${D}: Loaded ${G} (${l.byteLength} bytes)`),V(new Uint8Array(l)))}),!0,(l=>{N(new s.n(`${D}: Failed to load '${G}'${l?": "+l.status+" "+l.statusText:""}`,l))}))}))))}static AddPointerMetadata(D,l){D.metadata=D.metadata||{};const G=D._internalMetadata=D._internalMetadata||{},V=G.bb=G.bb||{};(V.pointers=V.pointers||[]).push(l)}static _GetTextureWrapMode(D,l){switch(l=void 0==l?10497:l){case 33071:return r.b.CLAMP_ADDRESSMODE;case 33648:return r.b.MIRROR_ADDRESSMODE;case 10497:return r.b.WRAP_ADDRESSMODE;default:return F.d.Warn(`${D}: Invalid value (${l})`),r.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(D,l){const G=void 0==l.magFilter?9729:l.magFilter,V=void 0==l.minFilter?9987:l.minFilter;if(9729===G)switch(V){case 9728:return r.b.LINEAR_NEAREST;case 9729:return r.b.LINEAR_LINEAR;case 9984:return r.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return r.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return r.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return r.b.LINEAR_LINEAR_MIPLINEAR;default:return F.d.Warn(`${D}/minFilter: Invalid value (${V})`),r.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==G&&F.d.Warn(`${D}/magFilter: Invalid value (${G})`),V){case 9728:return r.b.NEAREST_NEAREST;case 9729:return r.b.NEAREST_LINEAR;case 9984:return r.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return r.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return r.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return r.b.NEAREST_LINEAR_MIPLINEAR;default:return F.d.Warn(`${D}/minFilter: Invalid value (${V})`),r.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(D,l){try{return(0,Y.n)(l)}catch(G){throw new Error(`${D}: ${G.message}`)}}static _GetTypedArray(D,l,G,V,N){const M=G.buffer;V=G.byteOffset+(V||0);const b=P._GetTypedArrayConstructor(`${D}/componentType`,l),X=L.e.GetTypeByteLength(l);return V%X!==0?(F.d.Warn(`${D}: Copying buffer as byte offset (${V}) is not a multiple of component type byte length (${X})`),new b(M.slice(V,V+N*X),0)):new b(M,V,N)}static _GetNumComponents(D,l){switch(l){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${D}: Invalid type (${l})`)}static _ValidateUri(D){return b.Tools.IsBase64(D)||-1===D.indexOf("..")}static _GetDrawMode(D,l){switch(void 0==l&&(l=4),l){case 0:return h.c.PointListDrawMode;case 1:return h.c.LineListDrawMode;case 2:return h.c.LineLoopDrawMode;case 3:return h.c.LineStripDrawMode;case 4:return h.c.TriangleFillMode;case 5:return h.c.TriangleStripDrawMode;case 6:return h.c.TriangleFanDrawMode}throw new Error(`${D}: Invalid mesh primitive mode (${l})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const D=new Array;if(this._gltf.materials)for(const l of this._gltf.materials)if(l._data)for(const G in l._data){const V=l._data[G];for(const l of V.babylonMeshes){l.hb(!0);const G=V.babylonMaterial;D.push(G.forceCompilationAsync(l)),D.push(G.forceCompilationAsync(l,{useInstances:!0})),this._parent.useClipPlane&&(D.push(G.forceCompilationAsync(l,{clipPlane:!0})),D.push(G.forceCompilationAsync(l,{clipPlane:!0,useInstances:!0})))}}return Promise.all(D).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const D=new Array,l=this._babylonScene.lights;for(const G of l){const l=G.getShadowGenerator();l&&D.push(l.forceCompilationAsync())}return Promise.all(D).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(D){for(const l of this._extensions)l.enabled&&D(l)}_applyExtensions(D,l,G){for(const V of this._extensions)if(V.enabled){const N=`${V.name}.${l}`,M=D;M._activeLoaderExtensionFunctions=M._activeLoaderExtensionFunctions||{};const b=M._activeLoaderExtensionFunctions;if(!b[N]){b[N]=!0;try{const D=G(V);if(D)return D}finally{delete b[N]}}}return null}_extensionsOnLoading(){this._forEachExtensions((D=>D.onLoading&&D.onLoading()))}_extensionsOnReady(){this._forEachExtensions((D=>D.onReady&&D.onReady()))}_extensionsLoadSceneAsync(D,l){return this._applyExtensions(l,"loadScene",(G=>G.loadSceneAsync&&G.loadSceneAsync(D,l)))}_extensionsLoadNodeAsync(D,l,G){return this._applyExtensions(l,"loadNode",(V=>V.loadNodeAsync&&V.loadNodeAsync(D,l,G)))}_extensionsLoadCameraAsync(D,l,G){return this._applyExtensions(l,"loadCamera",(V=>V.loadCameraAsync&&V.loadCameraAsync(D,l,G)))}_extensionsLoadVertexDataAsync(D,l,G){return this._applyExtensions(l,"loadVertexData",(V=>V._loadVertexDataAsync&&V._loadVertexDataAsync(D,l,G)))}_extensionsLoadMeshPrimitiveAsync(D,l,G,V,N,M){return this._applyExtensions(N,"loadMeshPrimitive",(b=>b._loadMeshPrimitiveAsync&&b._loadMeshPrimitiveAsync(D,l,G,V,N,M)))}_extensionsLoadMaterialAsync(D,l,G,V,N){return this._applyExtensions(l,"loadMaterial",(M=>M._loadMaterialAsync&&M._loadMaterialAsync(D,l,G,V,N)))}_extensionsCreateMaterial(D,l,G){return this._applyExtensions(l,"createMaterial",(V=>V.createMaterial&&V.createMaterial(D,l,G)))}_extensionsLoadMaterialPropertiesAsync(D,l,G){return this._applyExtensions(l,"loadMaterialProperties",(V=>V.loadMaterialPropertiesAsync&&V.loadMaterialPropertiesAsync(D,l,G)))}_extensionsLoadTextureInfoAsync(D,l,G){return this._applyExtensions(l,"loadTextureInfo",(V=>V.loadTextureInfoAsync&&V.loadTextureInfoAsync(D,l,G)))}_extensionsLoadTextureAsync(D,l,G){return this._applyExtensions(l,"loadTexture",(V=>V._loadTextureAsync&&V._loadTextureAsync(D,l,G)))}_extensionsLoadAnimationAsync(D,l){return this._applyExtensions(l,"loadAnimation",(G=>G.loadAnimationAsync&&G.loadAnimationAsync(D,l)))}_extensionsLoadAnimationChannelAsync(D,l,G,V,N){return this._applyExtensions(G,"loadAnimationChannel",(M=>M._loadAnimationChannelAsync&&M._loadAnimationChannelAsync(D,l,G,V,N)))}_extensionsLoadSkinAsync(D,l,G){return this._applyExtensions(G,"loadSkin",(V=>V._loadSkinAsync&&V._loadSkinAsync(D,l,G)))}_extensionsLoadUriAsync(D,l,G){return this._applyExtensions(l,"loadUri",(V=>V._loadUriAsync&&V._loadUriAsync(D,l,G)))}_extensionsLoadBufferViewAsync(D,l){return this._applyExtensions(l,"loadBufferView",(G=>G.loadBufferViewAsync&&G.loadBufferViewAsync(D,l)))}_extensionsLoadBufferAsync(D,l,G,V){return this._applyExtensions(l,"loadBuffer",(N=>N.loadBufferAsync&&N.loadBufferAsync(D,l,G,V)))}static LoadExtensionAsync(D,l,G,V){if(!l.extensions)return null;const N=l.extensions[G];return N?V(`${D}/extensions/${G}`,N):null}static LoadExtraAsync(D,l,G,V){if(!l.extras)return null;const N=l.extras[G];return N?V(`${D}/extras/${G}`,N):null}isExtensionUsed(D){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(D)}logOpen(D){this._parent._logOpen(D)}logClose(){this._parent._logClose()}log(D){this._parent._log(D)}startPerformanceCounter(D){this._parent._startPerformanceCounter(D)}endPerformanceCounter(D){this._parent._endPerformanceCounter(D)}}P.DefaultSampler={index:-1},O.d._CreateGLTF2Loader=D=>new P(D);var p=G(13381),k=G(11904),m=G(11739),T=G(13386),C=G(13388);class w extends C.b{constructor(D,l,G){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",D),this._texture=D.getEngine().createRawCubeTexture(l,G,V,N,M,b,X,t)}update(D,l,G,V){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,D,l,G,V,N)}updateRGBDAsync(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,T.j)(this._texture,D,l,G,V).then((()=>{}))}clone(){return m.c.Clone((()=>{const D=this.uD(),l=this._texture,G=new w(D,l._bufferViewArray,l.width,l.format,l.type,l.generateMipMaps,l.invertY,l.samplingMode,l._compression);return 13===l.source&&G.updateRGBDAsync(l._bufferViewArrayArray,l._sphericalPolynomial,l._lodGenerationScale,l._lodGenerationOffset),G}),this)}}const A="EXT_lights_image_based";class a{constructor(D){this.name=A,this._loader=D,this.enabled=this._loader.isExtensionUsed(A)}dispose(){this._loader=null,delete this._lights}onLoading(){const D=this._loader.bb.extensions;if(D&&D[this.name]){const l=D[this.name];this._lights=l.lights}}loadSceneAsync(D,l){return P.LoadExtensionAsync(D,l,this.name,(async(G,V)=>{this._loader._allMaterialsDirtyRequired=!0;const N=new Array;N.push(this._loader.loadSceneAsync(D,l)),this._loader.logOpen(`${G}`);const M=z.Get(`${G}/light`,this._lights,V.Db);return N.push(this._loadLightAsync(`/extensions/${this.name}/lights/${V.Db}`,M).then((D=>{this._loader.babylonScene.environmentTexture=D}))),this._loader.logClose(),await Promise.all(N).then((()=>{}))}))}_loadLightAsync(D,l){if(!l._loaded){const G=new Array;this._loader.logOpen(`${D}`);const V=new Array(l.specularImages.length);for(let N=0;N<l.specularImages.length;N++){const M=l.specularImages[N];V[N]=new Array(M.length);for(let l=0;l<M.length;l++){const b=`${D}/specularImages/${N}/${l}`;this._loader.logOpen(`${b}`);const X=M[l],t=z.Get(b,this._loader.bb.images,X);G.push(this._loader.loadImageAsync(`/images/${X}`,t).then((D=>{V[N][l]=D}))),this._loader.logClose()}}this._loader.logClose(),l._loaded=Promise.all(G).then((async()=>{const G=new w(this._loader.babylonScene,null,l.specularImageSize);if(G.name=l.name||"environment",l._babylonTexture=G,void 0!=l.Sb&&(G.level=l.Sb),l.rotation){let D=N.Quaternion.xl(l.rotation);this._loader.babylonScene.useRightHandedSystem||(D=N.Quaternion.Inverse(D)),N.Matrix.FromQuaternionToRef(D,G.getReflectionTextureMatrix())}if(!l.irradianceCoefficients)throw new Error(`${D}: Irradiance coefficients are missing`);const M=k.e.xl(l.irradianceCoefficients);M.scaleInPlace(l.Sb),M.convertIrradianceToLambertianRadiance();const b=k.h.FromHarmonics(M),X=(V.length-1)/Math.log2(l.specularImageSize);return await G.updateRGBDAsync(V,b,X)}))}return l._loaded.then((()=>l._babylonTexture))}}v(A),c(A,!0,(D=>new a(D)));G(12285);const Q="EXT_mesh_gpu_instancing";class DD{constructor(D){this.name=Q,this._loader=D,this.enabled=this._loader.isExtensionUsed(Q)}dispose(){this._loader=null}loadNodeAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(D,V)=>{this._loader._disableInstancedMesh++;const M=this._loader.loadNodeAsync(`/nodes/${l.index}`,l,G);if(this._loader._disableInstancedMesh--,!l._primitiveBabylonMeshes)return await M;const b=new Array;let X=0;const t=l=>{if(void 0==V.attributes[l])return void b.push(Promise.resolve(null));const G=z.Get(`${D}/attributes/${l}`,this._loader.bb.accessors,V.attributes[l]);if(b.push(this._loader._loadFloatAccessorAsync(`/accessors/${G.bufferView}`,G)),0===X)X=G.count;else if(X!==G.count)throw new Error(`${D}/attributes: Instance buffer accessors do not have the same count.`)};return t("TRANSLATION"),t("ROTATION"),t("SCALE"),await M.then((async D=>{const[G,V,M]=await Promise.all(b),t=new Float32Array(16*X);N.TmpVectors.Kl[0].Lb(0,0,0),N.TmpVectors.Quaternion[0].Lb(0,0,0,1),N.TmpVectors.Kl[1].Lb(1,1,1);for(let l=0;l<X;++l)G&&N.Kl.FromArrayToRef(G,3*l,N.TmpVectors.Kl[0]),V&&N.Quaternion.FromArrayToRef(V,4*l,N.TmpVectors.Quaternion[0]),M&&N.Kl.FromArrayToRef(M,3*l,N.TmpVectors.Kl[1]),N.Matrix.ComposeToRef(N.TmpVectors.Kl[1],N.TmpVectors.Quaternion[0],N.TmpVectors.Kl[0],N.TmpVectors.Matrix[0]),N.TmpVectors.Matrix[0].copyToArray(t,16*l);for(const N of l._primitiveBabylonMeshes)N.Yg("matrix",t,16,!0);return D}))}))}}v(Q),c(Q,!0,(D=>new DD(D)));let lD=0,GD=null;class VD{static get Default(){return VD._Default||(VD._Default=new VD),VD._Default}constructor(){const D=VD.Configuration.decoder;this._decoderModulePromise=b.Tools.LoadBabylonScriptAsync(D.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(D,l,G,V,N){await this._decoderModulePromise,0===lD&&(MeshoptDecoder.useWorkers(1),lD=1);const M=await MeshoptDecoder.decodeGltfBufferAsync(l,G,D,V,N);return null!==GD&&clearTimeout(GD),GD=setTimeout((()=>{MeshoptDecoder.useWorkers(0),lD=0,GD=null}),1e3),M}}VD.Configuration={decoder:{url:`${b.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},VD._Default=null;const ND="EXT_meshopt_compression";class MD{constructor(D){this.name=ND,this.enabled=D.isExtensionUsed(ND),this._loader=D}dispose(){this._loader=null}loadBufferViewAsync(D,l){return P.LoadExtensionAsync(D,l,this.name,(async(G,V)=>{const N=l;if(N._meshOptData)return await N._meshOptData;const M=z.Get(`${D}/buffer`,this._loader.bb.buffers,V.buffer);return N._meshOptData=this._loader.loadBufferAsync(`/buffers/${M.index}`,M,V.byteOffset||0,V.byteLength).then((async D=>await VD.Default.decodeGltfBufferAsync(D,V.count,V.byteStride,V.mode,V.filter))),await N._meshOptData}))}}v(ND),c(ND,!0,(D=>new MD(D)));const bD="EXT_texture_webp";class XD{constructor(D){this.name=bD,this._loader=D,this.enabled=D.isExtensionUsed(bD)}dispose(){this._loader=null}_loadTextureAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=void 0==l.sampler?P.DefaultSampler:z.Get(`${D}/sampler`,this._loader.bb.samplers,l.sampler),b=z.Get(`${V}/source`,this._loader.bb.images,N.source);return await this._loader._createTextureAsync(D,M,b,(D=>{G(D)}),void 0,!l._textureInfo.nonColorData)}))}}v(bD),c(bD,!0,(D=>new XD(D)));const tD="EXT_texture_avif";class RD{constructor(D){this.name=tD,this._loader=D,this.enabled=D.isExtensionUsed(tD)}dispose(){this._loader=null}_loadTextureAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=void 0==l.sampler?P.DefaultSampler:z.Get(`${D}/sampler`,this._loader.bb.samplers,l.sampler),b=z.Get(`${V}/source`,this._loader.bb.images,N.source);return await this._loader._createTextureAsync(D,M,b,(D=>{G(D)}),void 0,!l._textureInfo.nonColorData)}))}}v(tD),c(tD,!0,(D=>new RD(D)));var nD=G(13375),gD=G(12265);const jD="EXT_lights_ies";class eD{constructor(D){this.name=jD,this._loader=D,this.enabled=this._loader.isExtensionUsed(jD)}dispose(){this._loader=null,delete this._lights}onLoading(){const D=this._loader.bb.extensions;if(D&&D[this.name]){const l=D[this.name];this._lights=l.lights,z.Assign(this._lights)}}loadNodeAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,b)=>{let X,t;this._loader._allMaterialsDirtyRequired=!0;const R=await this._loader.loadNodeAsync(D,l,(D=>{t=z.Get(V,this._lights,b.Db);const l=t.name||D.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,X=new nD.b(l,N.Kl.Zero(),N.Kl.Backward(),0,1,this._loader.babylonScene),X.angle=Math.PI/2,X.innerAngle=0,X._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,t._babylonLight=X,X.falloffType=gD.c.FALLOFF_GLTF,X.Ob=b.color?M.hl.xl(b.color):M.hl.White(),X.Sb=b.multiplier||1,X.range=Number.MAX_VALUE,X.parent=D,this._loader._babylonLights.push(X),P.AddPointerMetadata(X,V),G(D)}));let n;if(t.uri)n=await this._loader.loadUriAsync(D,t,t.uri);else{const l=z.Get(`${D}/bufferView`,this._loader.bb.bufferViews,t.bufferView);n=await this._loader.loadBufferViewAsync(`/bufferViews/${l.index}`,l)}return X.iesProfileTexture=new r.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,n,!0,void 0,void 0,void 0,void 0,".ies"),R}))}}v(jD),c(jD,!0,(D=>new eD(D)));var KD=G(13396);const FD="KHR_draco_mesh_compression";class dD{constructor(D){this.name=FD,this.useNormalizedFlagFromAccessor=!0,this._loader=D,this.enabled=KD.d.DefaultAvailable&&this._loader.isExtensionUsed(FD)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{if(void 0!=l.mode&&4!==l.mode&&5!==l.mode)throw new Error(`${D}: Unsupported mode ${l.mode}`);const M={},b={},X=(D,V)=>{const X=N.attributes[D];if(void 0!=X&&(G._delayInfo=G._delayInfo||[],-1===G._delayInfo.indexOf(V)&&G._delayInfo.push(V),M[V]=X,this.useNormalizedFlagFromAccessor)){const G=z.TryGet(this._loader.bb.accessors,l.attributes[D]);G&&(b[V]=G.normalized||!1)}};X("POSITION",L.e.PositionKind),X("NORMAL",L.e.NormalKind),X("TANGENT",L.e.TangentKind),X("TEXCOORD_0",L.e.UVKind),X("TEXCOORD_1",L.e.UV2Kind),X("TEXCOORD_2",L.e.UV3Kind),X("TEXCOORD_3",L.e.UV4Kind),X("TEXCOORD_4",L.e.UV5Kind),X("TEXCOORD_5",L.e.UV6Kind),X("JOINTS_0",L.e.MatricesIndicesKind),X("WEIGHTS_0",L.e.MatricesWeightsKind),X("COLOR_0",L.e.ColorKind);const t=z.Get(V,this._loader.bb.bufferViews,N.bufferView);return t._dracoBabylonGeometry||(t._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${t.index}`,t).then((async V=>{const N=this.dracoDecoder||KD.d.Default,X=z.TryGet(this._loader.bb.accessors,l.attributes.POSITION),t=this._loader.parent.alwaysComputeBoundingBox||G.skeleton||!X?null:E(X);return await N._decodeMeshToGeometryForGltfAsync(G.name,this._loader.babylonScene,V,M,b,t).catch((l=>{throw new Error(`${D}: ${l.message}`)}))}))),await t._dracoBabylonGeometry}))}}v(FD),c(FD,!0,(D=>new dD(D)));var HD=G(13399),hD=G(11695),xD=G(11703),rD=G(12144),oD=G(12325),LD=G(11667);rD.e.AddNodeConstructor("Light_Type_0",((D,l)=>()=>new uD(D,N.Kl.Zero(),l)));class uD extends oD.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(D){this._shadowAngle=D,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(D){const l=this.needCube();if(this._direction=D,this.needCube()!==l&&this._shadowGenerators){const D=this._shadowGenerators.values();for(let l=D.next();!0!==l.done;l=D.next()){l.value.recreateShadowMap()}}}constructor(D,l,G){super(D,G),this._shadowAngle=Math.PI/2,this.position=l}getClassName(){return"PointLight"}getTypeID(){return gD.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(D){if(this.direction)return super.getShadowDirection(D);switch(D){case 0:return new N.Kl(1,0,0);case 1:return new N.Kl(-1,0,0);case 2:return new N.Kl(0,-1,0);case 3:return new N.Kl(0,1,0);case 4:return new N.Kl(0,0,1);case 5:return new N.Kl(0,0,-1)}return N.Kl.Zero()}_setDefaultShadowProjectionMatrix(D,l,G){const V=this.uD().activeCamera;if(!V)return;const M=void 0!==this.shadowMinZ?this.shadowMinZ:V.Kb,b=void 0!==this.shadowMaxZ?this.shadowMaxZ:V.maxZ,X=this.uD().getEngine().useReverseDepthBuffer;N.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,X?b:M,X?M:b,D,!0,this._scene.getEngine().isNDCHalfZRange,void 0,X)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(D,l){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,l):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,l),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,l),this}transferToNodeMaterialEffect(D,l){return this.computeTransformedInformation()?D.setFloat3(l,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):D.setFloat3(l,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(D,l){D["POINTLIGHT"+l]=!0}}(0,hD.b)([(0,xD.L)()],uD.prototype,"shadowAngle",null),(0,LD.c)("BABYLON.PointLight",uD);const BD="KHR_lights_punctual";class ID{constructor(D){this.name=BD,this._loader=D,this.enabled=this._loader.isExtensionUsed(BD)}dispose(){this._loader=null,delete this._lights}onLoading(){const D=this._loader.bb.extensions;if(D&&D[this.name]){const l=D[this.name];this._lights=l.lights,z.Assign(this._lights)}}loadNodeAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,b)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(D,l,(D=>{let l;const X=z.Get(V,this._lights,b.Db),t=X.name||D.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,X.type){case"directional":{const D=new HD.e(t,N.Kl.Backward(),this._loader.babylonScene);D.position.Ib(0),l=D;break}case"point":l=new uD(t,N.Kl.Zero(),this._loader.babylonScene);break;case"spot":{const D=new nD.b(t,N.Kl.Zero(),N.Kl.Backward(),0,1,this._loader.babylonScene);D.angle=2*(X.spot&&X.spot.outerConeAngle||Math.PI/4),D.innerAngle=2*(X.spot&&X.spot.innerConeAngle||0),l=D;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${V}: Invalid light type (${X.type})`)}l._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,X._babylonLight=l,l.falloffType=gD.c.FALLOFF_GLTF,l.Ob=X.color?M.hl.xl(X.color):M.hl.White(),l.Sb=void 0==X.Sb?1:X.Sb,l.range=void 0==X.range?Number.MAX_VALUE:X.range,l.parent=D,this._loader._babylonLights.push(l),P.AddPointerMetadata(l,V),G(D)})))))}}v(BD),c(BD,!0,(D=>new ID(D)));const WD="KHR_materials_pbrSpecularGlossiness";class iD{constructor(D){this.name=WD,this.order=200,this._loader=D,this.enabled=this._loader.isExtensionUsed(WD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=new Array;return M.push(this._loader.loadMaterialBasePropertiesAsync(D,l,G)),M.push(this._loadSpecularGlossinessPropertiesAsync(V,N,G)),this._loader.loadMaterialAlphaProperties(D,l,G),await Promise.all(M).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(D,l,G){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);const V=new Array;return G.metallic=null,G.roughness=null,l.diffuseFactor?(G.albedoColor=M.hl.xl(l.diffuseFactor),G.alpha=l.diffuseFactor[3]):G.albedoColor=M.hl.White(),G.reflectivityColor=l.specularFactor?M.hl.xl(l.specularFactor):M.hl.White(),G.microSurface=void 0==l.glossinessFactor?1:l.glossinessFactor,l.diffuseTexture&&V.push(this._loader.loadTextureInfoAsync(`${D}/diffuseTexture`,l.diffuseTexture,(D=>{D.name=`${G.name} (Diffuse)`,G.albedoTexture=D}))),l.specularGlossinessTexture&&(V.push(this._loader.loadTextureInfoAsync(`${D}/specularGlossinessTexture`,l.specularGlossinessTexture,(D=>{D.name=`${G.name} (Specular Glossiness)`,G.reflectivityTexture=D,G.reflectivityTexture.eb=!0}))),G.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(V).then((()=>{}))}}v(WD),c(WD,!0,(D=>new iD(D)));const yD="KHR_materials_unlit";class SD{constructor(D){this.name=yD,this.order=210,this._loader=D,this.enabled=this._loader.isExtensionUsed(yD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async()=>await this._loadUnlitPropertiesAsync(D,l,G)))}_loadUnlitPropertiesAsync(D,l,G){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);const V=new Array;G.unlit=!0;const N=l.pbrMetallicRoughness;return N&&(N.baseColorFactor?(G.albedoColor=M.hl.xl(N.baseColorFactor),G.alpha=N.baseColorFactor[3]):G.albedoColor=M.hl.White(),N.baseColorTexture&&V.push(this._loader.loadTextureInfoAsync(`${D}/baseColorTexture`,N.baseColorTexture,(D=>{D.name=`${G.name} (Base Color)`,G.albedoTexture=D})))),l.doubleSided&&(G.ob=!1,G.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(D,l,G),Promise.all(V).then((()=>{}))}}v(yD),c(yD,!0,(D=>new SD(D)));const OD="KHR_materials_clearcoat";class sD{constructor(D){this.name=OD,this.order=190,this._loader=D,this.enabled=this._loader.isExtensionUsed(OD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=new Array;M.push(this._loader.loadMaterialPropertiesAsync(D,l,G)),M.push(this._loadClearCoatPropertiesAsync(V,N,G)),await Promise.all(M)}))}_loadClearCoatPropertiesAsync(D,l,G){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);const V=new Array;return G.clearCoat.isEnabled=!0,G.clearCoat.useRoughnessFromMainTexture=!1,G.clearCoat.remapF0OnInterfaceChange=!1,void 0!=l.clearcoatFactor?G.clearCoat.Sb=l.clearcoatFactor:G.clearCoat.Sb=0,l.clearcoatTexture&&V.push(this._loader.loadTextureInfoAsync(`${D}/clearcoatTexture`,l.clearcoatTexture,(D=>{D.name=`${G.name} (ClearCoat)`,G.clearCoat.texture=D}))),void 0!=l.clearcoatRoughnessFactor?G.clearCoat.roughness=l.clearcoatRoughnessFactor:G.clearCoat.roughness=0,l.clearcoatRoughnessTexture&&(l.clearcoatRoughnessTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${D}/clearcoatRoughnessTexture`,l.clearcoatRoughnessTexture,(D=>{D.name=`${G.name} (ClearCoat Roughness)`,G.clearCoat.textureRoughness=D})))),l.clearcoatNormalTexture&&(l.clearcoatNormalTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${D}/clearcoatNormalTexture`,l.clearcoatNormalTexture,(D=>{D.name=`${G.name} (ClearCoat Normal)`,G.clearCoat.bumpTexture=D}))),G.invertNormalMapX=!G.uD().useRightHandedSystem,G.invertNormalMapY=G.uD().useRightHandedSystem,void 0!=l.clearcoatNormalTexture.scale&&(G.clearCoat.bumpTexture.level=l.clearcoatNormalTexture.scale)),Promise.all(V).then((()=>{}))}}v(OD),c(OD,!0,(D=>new sD(D)));const UD="KHR_materials_iridescence";class fD{constructor(D){this.name=UD,this.order=195,this._loader=D,this.enabled=this._loader.isExtensionUsed(UD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(D,l,G)),M.push(this._loadIridescencePropertiesAsync(V,N,G)),await Promise.all(M).then((()=>{}))}))}_loadIridescencePropertiesAsync(D,l,G){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);const V=new Array;return G.iridescence.isEnabled=!0,G.iridescence.Sb=l.iridescenceFactor??0,G.iridescence.indexOfRefraction=l.iridescenceIor??l.iridescenceIOR??1.3,G.iridescence.minimumThickness=l.iridescenceThicknessMinimum??100,G.iridescence.maximumThickness=l.iridescenceThicknessMaximum??400,l.iridescenceTexture&&V.push(this._loader.loadTextureInfoAsync(`${D}/iridescenceTexture`,l.iridescenceTexture,(D=>{D.name=`${G.name} (Iridescence)`,G.iridescence.texture=D}))),l.iridescenceThicknessTexture&&V.push(this._loader.loadTextureInfoAsync(`${D}/iridescenceThicknessTexture`,l.iridescenceThicknessTexture,(D=>{D.name=`${G.name} (Iridescence Thickness)`,G.iridescence.thicknessTexture=D}))),Promise.all(V).then((()=>{}))}}v(UD),c(UD,!0,(D=>new fD(D)));const qD="KHR_materials_anisotropy";class cD{constructor(D){this.name=qD,this.order=195,this._loader=D,this.enabled=this._loader.isExtensionUsed(qD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=new Array;M.push(this._loader.loadMaterialPropertiesAsync(D,l,G)),M.push(this._loadIridescencePropertiesAsync(V,N,G)),await Promise.all(M)}))}async _loadIridescencePropertiesAsync(D,l,G){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);const V=new Array;G.anisotropy.isEnabled=!0,G.anisotropy.Sb=l.anisotropyStrength??0,G.anisotropy.angle=l.anisotropyRotation??0,l.anisotropyTexture&&(l.anisotropyTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${D}/anisotropyTexture`,l.anisotropyTexture,(D=>{D.name=`${G.name} (Anisotropy Intensity)`,G.anisotropy.texture=D})))),await Promise.all(V)}}v(qD),c(qD,!0,(D=>new cD(D)));const vD="KHR_materials_emissive_strength";class ZD{constructor(D){this.name=vD,this.order=170,this._loader=D,this.enabled=this._loader.isExtensionUsed(vD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>await this._loader.loadMaterialPropertiesAsync(D,l,G).then((()=>{this._loadEmissiveProperties(V,N,G)}))))}_loadEmissiveProperties(D,l,G){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);void 0!==l.emissiveStrength&&(G.emissiveIntensity=l.emissiveStrength)}}v(vD),c(vD,!0,(D=>new ZD(D)));const JD="KHR_materials_sheen";class YD{constructor(D){this.name=JD,this.order=190,this._loader=D,this.enabled=this._loader.isExtensionUsed(JD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(D,l,G)),M.push(this._loadSheenPropertiesAsync(V,N,G)),await Promise.all(M).then((()=>{}))}))}_loadSheenPropertiesAsync(D,l,G){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);const V=new Array;return G.sheen.isEnabled=!0,G.sheen.Sb=1,void 0!=l.sheenColorFactor?G.sheen.color=M.hl.xl(l.sheenColorFactor):G.sheen.color=M.hl.Black(),l.sheenColorTexture&&V.push(this._loader.loadTextureInfoAsync(`${D}/sheenColorTexture`,l.sheenColorTexture,(D=>{D.name=`${G.name} (Sheen Color)`,G.sheen.texture=D}))),void 0!==l.sheenRoughnessFactor?G.sheen.roughness=l.sheenRoughnessFactor:G.sheen.roughness=0,l.sheenRoughnessTexture&&(l.sheenRoughnessTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${D}/sheenRoughnessTexture`,l.sheenRoughnessTexture,(D=>{D.name=`${G.name} (Sheen Roughness)`,G.sheen.textureRoughness=D})))),G.sheen.albedoScaling=!0,G.sheen.useRoughnessFromMainTexture=!1,Promise.all(V).then((()=>{}))}}v(JD),c(JD,!0,(D=>new YD(D)));var zD=G(12208);const ED="KHR_materials_specular";class PD{constructor(D){this.name=ED,this.order=190,this._loader=D,this.enabled=this._loader.isExtensionUsed(ED)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=new Array;if(M.push(this._loader.loadMaterialPropertiesAsync(D,l,G)),M.push(this._loadSpecularPropertiesAsync(V,N,G)),N.extensions&&N.extensions.EXT_materials_specular_edge_color&&G instanceof x.c){N.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(G.brdf.dielectricSpecularModel=zD.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,G.brdf.conductorSpecularModel=zD.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(M).then((()=>{}))}))}_loadSpecularPropertiesAsync(D,l,G){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);const V=new Array;return void 0!==l.specularFactor&&(G.metallicF0Factor=l.specularFactor),void 0!==l.specularColorFactor&&(G.metallicReflectanceColor=M.hl.xl(l.specularColorFactor)),l.specularTexture&&(l.specularTexture.nonColorData=!0,V.push(this._loader.loadTextureInfoAsync(`${D}/specularTexture`,l.specularTexture,(D=>{D.name=`${G.name} (Specular)`,G.metallicReflectanceTexture=D,G.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),l.specularColorTexture&&V.push(this._loader.loadTextureInfoAsync(`${D}/specularColorTexture`,l.specularColorTexture,(D=>{D.name=`${G.name} (Specular Color)`,G.reflectanceTexture=D}))),Promise.all(V).then((()=>{}))}}v(ED),c(ED,!0,(D=>new PD(D)));const pD="KHR_materials_ior";class kD{constructor(D){this.name=pD,this.order=180,this._loader=D,this.enabled=this._loader.isExtensionUsed(pD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(D,l,G)),M.push(this._loadIorPropertiesAsync(V,N,G)),await Promise.all(M).then((()=>{}))}))}_loadIorPropertiesAsync(D,l,G){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);return void 0!==l.ior?G.indexOfRefraction=l.ior:G.indexOfRefraction=kD._DEFAULT_IOR,Promise.resolve()}}kD._DEFAULT_IOR=1.5,v(pD),c(pD,!0,(D=>new kD(D)));const mD="KHR_materials_variants";class TD{constructor(D){this.name=mD,this._loader=D,this.enabled=this._loader.isExtensionUsed(mD)}dispose(){this._loader=null}static GetAvailableVariants(D){const l=this._GetExtensionMetadata(D);return l?Object.keys(l.variants):[]}getAvailableVariants(D){return TD.GetAvailableVariants(D)}static SelectVariant(D,l){const G=this._GetExtensionMetadata(D);if(!G)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${mD} extension`);const V=D=>{const l=G.variants[D];if(l)for(const G of l)G.mesh.material=G.material};if(l instanceof Array)for(const N of l)V(N);else V(l);G.lastSelected=l}selectVariant(D,l){TD.SelectVariant(D,l)}static Reset(D){const l=this._GetExtensionMetadata(D);if(!l)throw new Error(`Cannot reset on a glTF mesh that does not have the ${mD} extension`);for(const G of l.original)G.mesh.material=G.material;l.lastSelected=null}reset(D){TD.Reset(D)}static GetLastSelectedVariant(D){const l=this._GetExtensionMetadata(D);if(!l)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${mD} extension`);return l.lastSelected}getLastSelectedVariant(D){return TD.GetLastSelectedVariant(D)}static _GetExtensionMetadata(D){var l,G;return(null===D||void 0===D||null===(l=D._internalMetadata)||void 0===l||null===(G=l.bb)||void 0===G?void 0:G[mD])||null}onLoading(){const D=this._loader.bb.extensions;if(D&&D[this.name]){const l=D[this.name];this._variants=l.variants}}onReady(){const D=this._loader.rootBabylonMesh;if(D){var l;const G=this._loader.parent.extensionOptions[mD];null!==G&&void 0!==G&&G.defaultVariant&&TD.SelectVariant(D,G.defaultVariant),null===G||void 0===G||null===(l=G.onLoaded)||void 0===l||l.call(G,{get variants(){return TD.GetAvailableVariants(D)},get selectedVariant(){const l=TD.GetLastSelectedVariant(D);return l?Array.isArray(l)?l[0]:l:TD.GetAvailableVariants(D)[0]},set selectedVariant(l){TD.SelectVariant(D,l)}})}}_loadMeshPrimitiveAsync(D,l,G,V,N,M){return P.LoadExtensionAsync(D,N,this.name,(async(b,X)=>{const t=new Array;return t.push(this._loader._loadMeshPrimitiveAsync(D,l,G,V,N,(l=>{if(M(l),l instanceof I.b){const G=P._GetDrawMode(D,N.mode),V=this._loader.rootBabylonMesh,M=V?V._internalMetadata=V._internalMetadata||{}:{},R=M.bb=M.bb||{},n=R[mD]=R[mD]||{lastSelected:null,original:[],variants:{}};n.original.push({mesh:l,material:l.material});for(let D=0;D<X.mappings.length;++D){const N=X.mappings[D],M=z.Get(`${b}/mappings/${D}/material`,this._loader.bb.materials,N.material);t.push(this._loader._loadMaterialAsync(`#/materials/${N.material}`,M,l,G,(D=>{for(let G=0;G<N.variants.length;++G){const M=N.variants[G],b=z.Get(`/extensions/${mD}/variants/${M}`,this._variants,M);n.variants[b.name]=n.variants[b.name]||[],n.variants[b.name].push({mesh:l,material:D}),l.onClonedObservable.add((D=>{const G=D;let N=null,M=G;do{if(M=M.parent,!M)return;N=TD._GetExtensionMetadata(M)}while(null===N);if(V&&N===TD._GetExtensionMetadata(V)){M._internalMetadata={};for(const D in V._internalMetadata)M._internalMetadata[D]=V._internalMetadata[D];M._internalMetadata.bb=[];for(const D in V._internalMetadata.bb)M._internalMetadata.bb[D]=V._internalMetadata.bb[D];M._internalMetadata.bb[mD]={lastSelected:null,original:[],variants:{}};for(const D of N.original)M._internalMetadata.bb[mD].original.push({mesh:D.mesh,material:D.material});for(const D in N.variants)if(Object.prototype.hasOwnProperty.call(N.variants,D)){M._internalMetadata.bb[mD].variants[D]=[];for(const l of N.variants[D])M._internalMetadata.bb[mD].variants[D].push({mesh:l.mesh,material:l.material})}N=M._internalMetadata.bb[mD]}for(const V of N.original)V.mesh===l&&(V.mesh=G);for(const V of N.variants[b.name])V.mesh===l&&(V.mesh=G)}))}})))}}}))),await Promise.all(t).then((D=>{let[l]=D;return l}))}))}}v(mD),c(mD,!0,(D=>new TD(D)));var CD=G(11776);class wD{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:zD.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(D,l){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...wD._GetDefaultOptions(),...D},this._scene=l,this._scene._transmissionHelper=this,this.onErrorObservable=new n.e,this._scene.Vb.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(D){if(!Object.keys(D).filter((l=>this._options[l]!==D[l])).length)return;const l={...this._options,...D},G=this._options;this._options=l,l.renderSize===G.renderSize&&l.renderTargetTextureType===G.renderTargetTextureType&&l.generateMipmaps===G.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=l.samples,this._opaqueRenderTarget.lodGenerationScale=l.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=l.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(D){return!!D&&!!(D instanceof x.c&&D.subSurface.isRefractionEnabled)}_addMesh(D){this._materialObservers[D.uniqueId]=D.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),b.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(D.material)?(D.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(D)&&this._transparentMeshesCache.push(D)):-1===this._opaqueMeshesCache.indexOf(D)&&this._opaqueMeshesCache.push(D)}))}_removeMesh(D){D.onMaterialChangedObservable.remove(this._materialObservers[D.uniqueId]),delete this._materialObservers[D.uniqueId];let l=this._transparentMeshesCache.indexOf(D);-1!==l&&this._transparentMeshesCache.splice(l,1),l=this._opaqueMeshesCache.indexOf(D),-1!==l&&this._opaqueMeshesCache.splice(l,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(D){const l=this._transparentMeshesCache.indexOf(D),G=this._opaqueMeshesCache.indexOf(D);this._shouldRenderAsTransmission(D.material)?(D.material instanceof x.c&&(D.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==G?(this._opaqueMeshesCache.splice(G,1),this._transparentMeshesCache.push(D)):-1===l&&this._transparentMeshesCache.push(D)):-1!==l?(this._transparentMeshesCache.splice(l,1),this._opaqueMeshesCache.push(D)):-1===G&&this._opaqueMeshesCache.push(D)}_isRenderTargetValid(){var D;return null!==(null===(D=this._opaqueRenderTarget)||void 0===D?void 0:D.getInternalTexture())}_setupRenderTargets(){var D;let l;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new CD.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(D=this._options.clearColor)||void 0===D?void 0:D.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((D=>{l=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?D.clearColor.V(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(D.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=l}));for(const G of this._transparentMeshesCache)this._shouldRenderAsTransmission(G.material)&&(G.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const AD="KHR_materials_transmission";class aD{constructor(D){this.name=AD,this.order=175,this._loader=D,this.enabled=this._loader.isExtensionUsed(AD),this.enabled&&(D.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(D,l,G)),M.push(this._loadTransparentPropertiesAsync(V,l,G,N)),await Promise.all(M).then((()=>{}))}))}_loadTransparentPropertiesAsync(D,l,G,V){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);const N=G;if(N.subSurface.isRefractionEnabled=!0,N.subSurface.volumeIndexOfRefraction=1,N.subSurface.useAlbedoToTintRefraction=!0,void 0===V.transmissionFactor)return N.subSurface.refractionIntensity=0,N.subSurface.isRefractionEnabled=!1,Promise.resolve();{var M;N.subSurface.refractionIntensity=V.transmissionFactor;const D=N.uD();if(N.subSurface.refractionIntensity&&!D._transmissionHelper)new wD({},N.uD());else if(N.subSurface.refractionIntensity&&(null===(M=D._transmissionHelper)||void 0===M||!M._isRenderTargetValid())){var b;null===(b=D._transmissionHelper)||void 0===b||b._setupRenderTargets()}}return N.subSurface.minimumThickness=0,N.subSurface.maximumThickness=0,V.transmissionTexture?(V.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${D}/transmissionTexture`,V.transmissionTexture,void 0).then((D=>{D.name=`${G.name} (Transmission)`,N.subSurface.refractionIntensityTexture=D,N.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}v(AD),c(AD,!0,(D=>new aD(D)));const QD="KHR_materials_diffuse_transmission";class Dl{constructor(D){this.name=QD,this.order=174,this._loader=D,this.enabled=this._loader.isExtensionUsed(QD),this.enabled&&(D.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(D,l,G)),M.push(this._loadTranslucentPropertiesAsync(V,l,G,N)),await Promise.all(M).then((()=>{}))}))}_loadTranslucentPropertiesAsync(D,l,G,V){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);const N=G;if(N.subSurface.isTranslucencyEnabled=!0,N.subSurface.volumeIndexOfRefraction=1,N.subSurface.minimumThickness=0,N.subSurface.maximumThickness=0,N.subSurface.useAlbedoToTintTranslucency=!1,void 0===V.diffuseTransmissionFactor)return N.subSurface.translucencyIntensity=0,N.subSurface.isTranslucencyEnabled=!1,Promise.resolve();N.subSurface.translucencyIntensity=V.diffuseTransmissionFactor;const b=new Array;return N.subSurface.useGltfStyleTextures=!0,V.diffuseTransmissionTexture&&(V.diffuseTransmissionTexture.nonColorData=!0,b.push(this._loader.loadTextureInfoAsync(`${D}/diffuseTransmissionTexture`,V.diffuseTransmissionTexture).then((D=>{D.name=`${G.name} (Diffuse Transmission)`,N.subSurface.translucencyIntensityTexture=D})))),void 0!==V.diffuseTransmissionColorFactor?N.subSurface.translucencyColor=M.hl.xl(V.diffuseTransmissionColorFactor):N.subSurface.translucencyColor=M.hl.White(),V.diffuseTransmissionColorTexture&&b.push(this._loader.loadTextureInfoAsync(`${D}/diffuseTransmissionColorTexture`,V.diffuseTransmissionColorTexture).then((D=>{D.name=`${G.name} (Diffuse Transmission Color)`,N.subSurface.translucencyColorTexture=D}))),Promise.all(b).then((()=>{}))}}v(QD),c(QD,!0,(D=>new Dl(D)));const ll="KHR_materials_volume";class Gl{constructor(D){this.name=ll,this.order=173,this._loader=D,this.enabled=this._loader.isExtensionUsed(ll),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(D,l,G)),M.push(this._loadVolumePropertiesAsync(V,l,G,N)),await Promise.all(M).then((()=>{}))}))}_loadVolumePropertiesAsync(D,l,G,V){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);if(!G.subSurface.isRefractionEnabled&&!G.subSurface.isTranslucencyEnabled||!V.thicknessFactor)return Promise.resolve();G.subSurface.volumeIndexOfRefraction=G.indexOfRefraction;const N=void 0!==V.attenuationDistance?V.attenuationDistance:Number.MAX_VALUE;return G.subSurface.tintColorAtDistance=N,void 0!==V.attenuationColor&&3==V.attenuationColor.length&&G.subSurface.tintColor.Lb(V.attenuationColor[0],V.attenuationColor[1],V.attenuationColor[2]),G.subSurface.minimumThickness=0,G.subSurface.maximumThickness=V.thicknessFactor,G.subSurface.useThicknessAsDepth=!0,V.thicknessTexture?(V.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${D}/thicknessTexture`,V.thicknessTexture).then((D=>{D.name=`${G.name} (Thickness)`,G.subSurface.thicknessTexture=D,G.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}v(ll),c(ll,!0,(D=>new Gl(D)));const Vl="KHR_materials_dispersion";class Nl{constructor(D){this.name=Vl,this.order=174,this._loader=D,this.enabled=this._loader.isExtensionUsed(Vl)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(D,l,G)),M.push(this._loadDispersionPropertiesAsync(V,l,G,N)),await Promise.all(M).then((()=>{}))}))}_loadDispersionPropertiesAsync(D,l,G,V){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);return G.subSurface.isRefractionEnabled&&V.dispersion?(G.subSurface.isDispersionEnabled=!0,G.subSurface.dispersion=V.dispersion,Promise.resolve()):Promise.resolve()}}v(Vl),c(Vl,!0,(D=>new Nl(D)));const Ml="EXT_materials_diffuse_roughness";class bl{constructor(D){this.name=Ml,this.order=190,this._loader=D,this.enabled=this._loader.isExtensionUsed(Ml)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(D,l,G)),M.push(this._loadDiffuseRoughnessPropertiesAsync(V,N,G)),await Promise.all(M).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(D,l,G){if(!(G instanceof x.c))throw new Error(`${D}: Material type not supported`);const V=new Array;return G.brdf.baseDiffuseModel=zD.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=l.diffuseRoughnessFactor?G.baseDiffuseRoughness=l.diffuseRoughnessFactor:G.baseDiffuseRoughness=0,l.diffuseRoughnessTexture&&V.push(this._loader.loadTextureInfoAsync(`${D}/diffuseRoughnessTexture`,l.diffuseRoughnessTexture,(D=>{D.name=`${G.name} (Diffuse Roughness)`,G.baseDiffuseRoughnessTexture=D}))),Promise.all(V).then((()=>{}))}}v(Ml),c(Ml,!0,(D=>new bl(D)));const Xl="KHR_mesh_quantization";class tl{constructor(D){this.name=Xl,this.enabled=D.isExtensionUsed(Xl)}dispose(){}}v(Xl),c(Xl,!0,(D=>new tl(D)));const Rl="KHR_texture_basisu";class nl{constructor(D){this.name=Rl,this._loader=D,this.enabled=D.isExtensionUsed(Rl)}dispose(){this._loader=null}_loadTextureAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>{const M=void 0==l.sampler?P.DefaultSampler:z.Get(`${D}/sampler`,this._loader.bb.samplers,l.sampler),b=z.Get(`${V}/source`,this._loader.bb.images,N.source);return await this._loader._createTextureAsync(D,M,b,(D=>{G(D)}),l._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!l._textureInfo.nonColorData)}))}}v(Rl),c(Rl,!0,(D=>new nl(D)));const gl="KHR_texture_transform";class jl{constructor(D){this.name=gl,this._loader=D,this.enabled=this._loader.isExtensionUsed(gl)}dispose(){this._loader=null}loadTextureInfoAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(V,N)=>await this._loader.loadTextureInfoAsync(D,l,(D=>{if(!(D instanceof r.b))throw new Error(`${V}: Texture type not supported`);N.offset&&(D.uOffset=N.offset[0],D.vOffset=N.offset[1]),D.uRotationCenter=0,D.vRotationCenter=0,N.rotation&&(D.wAng=-N.rotation),N.scale&&(D.uScale=N.scale[0],D.vScale=N.scale[1]),void 0!=N.texCoord&&(D.coordinatesIndex=N.texCoord),G(D)}))))}}v(gl),c(gl,!0,(D=>new jl(D)));const el="KHR_xmp_json_ld";class Kl{constructor(D){this.name=el,this.order=100,this._loader=D,this.enabled=this._loader.isExtensionUsed(el)}dispose(){this._loader=null}onLoading(){var D,l,G;if(null===this._loader.rootBabylonMesh)return;const V=null===(D=this._loader.bb.extensions)||void 0===D?void 0:D.KHR_xmp_json_ld,N=null===(l=this._loader.bb.asset)||void 0===l||null===(G=l.extensions)||void 0===G?void 0:G.KHR_xmp_json_ld;if(V&&N){const D=+N.packet;V.packets&&D<V.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=V.packets[D])}}}function Fl(D,l,G,V){return M.hl.xl(l,G).scale(V)}function dl(D,l,G,V){return l[G]*V}function Hl(D,l,G,V){return-l[G]*V}function hl(D,l,G,V){return l[G+1]*V}function xl(D,l,G,V){return l[G]*V*2}function rl(D){return{scale:[new Ll(j.b.ANIMATIONTYPE_FLOAT,`${D}.uScale`,dl,(()=>2)),new Ll(j.b.ANIMATIONTYPE_FLOAT,`${D}.vScale`,hl,(()=>2))],offset:[new Ll(j.b.ANIMATIONTYPE_FLOAT,`${D}.uOffset`,dl,(()=>2)),new Ll(j.b.ANIMATIONTYPE_FLOAT,`${D}.vOffset`,hl,(()=>2))],rotation:[new Ll(j.b.ANIMATIONTYPE_FLOAT,`${D}.wAng`,Hl,(()=>1))]}}v(el),c(el,!0,(D=>new Kl(D)));class ol extends p.AnimationPropertyInfo{buildAnimations(D,l,G,V){return[{babylonAnimatable:D._babylonCamera,babylonAnimation:this._buildAnimation(l,G,V)}]}}class Ll extends p.AnimationPropertyInfo{buildAnimations(D,l,G,V){const N=[];for(const M in D._data)N.push({babylonAnimatable:D._data[M].babylonMaterial,babylonAnimation:this._buildAnimation(l,G,V)});return N}}class ul extends p.AnimationPropertyInfo{buildAnimations(D,l,G,V){return[{babylonAnimatable:D._babylonLight,babylonAnimation:this._buildAnimation(l,G,V)}]}}(0,Z.o)("/cameras/{}/orthographic/xmag",[new ol(j.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Hl,(()=>1)),new ol(j.b.ANIMATIONTYPE_FLOAT,"orthoRight",hl,(()=>1))]),(0,Z.o)("/cameras/{}/orthographic/ymag",[new ol(j.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Hl,(()=>1)),new ol(j.b.ANIMATIONTYPE_FLOAT,"orthoTop",hl,(()=>1))]),(0,Z.o)("/cameras/{}/orthographic/zfar",[new ol(j.b.ANIMATIONTYPE_FLOAT,"maxZ",dl,(()=>1))]),(0,Z.o)("/cameras/{}/orthographic/znear",[new ol(j.b.ANIMATIONTYPE_FLOAT,"Kb",dl,(()=>1))]),(0,Z.o)("/cameras/{}/perspective/yfov",[new ol(j.b.ANIMATIONTYPE_FLOAT,"fov",dl,(()=>1))]),(0,Z.o)("/cameras/{}/perspective/zfar",[new ol(j.b.ANIMATIONTYPE_FLOAT,"maxZ",dl,(()=>1))]),(0,Z.o)("/cameras/{}/perspective/znear",[new ol(j.b.ANIMATIONTYPE_FLOAT,"Kb",dl,(()=>1))]),(0,Z.o)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Ll(j.b.ANIMATIONTYPE_COLOR3,"albedoColor",Fl,(()=>4)),new Ll(j.b.ANIMATIONTYPE_FLOAT,"alpha",(function(D,l,G,V){return l[G+3]*V}),(()=>4))]),(0,Z.o)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"metallic",dl,(()=>1))]),(0,Z.o)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"roughness",dl,(()=>1))]);const Bl=rl("albedoTexture");(0,Z.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Bl.scale),(0,Z.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Bl.offset),(0,Z.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Bl.rotation);const Il=rl("metallicTexture");(0,Z.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Il.scale),(0,Z.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Il.offset),(0,Z.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Il.rotation),(0,Z.o)("/materials/{}/emissiveFactor",[new Ll(j.b.ANIMATIONTYPE_COLOR3,"emissiveColor",Fl,(()=>3))]);const Wl=rl("bumpTexture");(0,Z.o)("/materials/{}/normalTexture/scale",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",dl,(()=>1))]),(0,Z.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Wl.scale),(0,Z.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Wl.offset),(0,Z.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Wl.rotation),(0,Z.o)("/materials/{}/occlusionTexture/strength",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",dl,(()=>1))]);const il=rl("ambientTexture");(0,Z.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",il.scale),(0,Z.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",il.offset),(0,Z.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",il.rotation);const yl=rl("emissiveTexture");(0,Z.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",yl.scale),(0,Z.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",yl.offset),(0,Z.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",yl.rotation),(0,Z.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",dl,(()=>1))]),(0,Z.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",dl,(()=>1))]);const Sl=rl("anisotropy.texture");(0,Z.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Sl.scale),(0,Z.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Sl.offset),(0,Z.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Sl.rotation),(0,Z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",dl,(()=>1))]),(0,Z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",dl,(()=>1))]);const Ol=rl("clearCoat.texture");(0,Z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Ol.scale),(0,Z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Ol.offset),(0,Z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Ol.rotation);const sl=rl("clearCoat.bumpTexture");(0,Z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",dl,(()=>1))]),(0,Z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",sl.scale),(0,Z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",sl.offset),(0,Z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",sl.rotation);const Ul=rl("clearCoat.textureRoughness");(0,Z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Ul.scale),(0,Z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Ul.offset),(0,Z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Ul.rotation),(0,Z.o)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",dl,(()=>1))]),(0,Z.o)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",dl,(()=>1))]),(0,Z.o)("/materials/{}/extensions/KHR_materials_ior/ior",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",dl,(()=>1))]),(0,Z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",dl,(()=>1))]),(0,Z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",dl,(()=>1))]),(0,Z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",dl,(()=>1))]),(0,Z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",dl,(()=>1))]);const fl=rl("iridescence.texture");(0,Z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",fl.scale),(0,Z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",fl.offset),(0,Z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",fl.rotation);const ql=rl("iridescence.thicknessTexture");(0,Z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",ql.scale),(0,Z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",ql.offset),(0,Z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",ql.rotation),(0,Z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Ll(j.b.ANIMATIONTYPE_COLOR3,"sheen.color",Fl,(()=>3))]),(0,Z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",dl,(()=>1))]);const cl=rl("sheen.texture");(0,Z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",cl.scale),(0,Z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",cl.offset),(0,Z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",cl.rotation);const vl=rl("sheen.textureRoughness");(0,Z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",vl.scale),(0,Z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",vl.offset),(0,Z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",vl.rotation),(0,Z.o)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",dl,(()=>1))]),(0,Z.o)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Ll(j.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Fl,(()=>3))]);const Zl=rl("metallicReflectanceTexture");(0,Z.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Zl.scale),(0,Z.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Zl.offset),(0,Z.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Zl.rotation);const Jl=rl("reflectanceTexture");(0,Z.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Jl.scale),(0,Z.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Jl.offset),(0,Z.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Jl.rotation),(0,Z.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",dl,(()=>1))]);const Yl=rl("subSurface.refractionIntensityTexture");(0,Z.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Yl.scale),(0,Z.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Yl.offset),(0,Z.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Yl.rotation),(0,Z.o)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Ll(j.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Fl,(()=>3))]),(0,Z.o)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",dl,(()=>1))]),(0,Z.o)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",dl,(()=>1))]);const zl=rl("subSurface.thicknessTexture");(0,Z.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",zl.scale),(0,Z.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",zl.offset),(0,Z.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",zl.rotation),(0,Z.o)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Ll(j.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",dl,(()=>1))]);const El=rl("subSurface.translucencyIntensityTexture");(0,Z.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",El.scale),(0,Z.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",El.offset),(0,Z.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",El.rotation),(0,Z.o)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Ll(j.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Fl,(()=>3))]);const Pl=rl("subSurface.translucencyColorTexture");(0,Z.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Pl.scale),(0,Z.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Pl.offset),(0,Z.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Pl.rotation),(0,Z.o)("/extensions/KHR_lights_punctual/lights/{}/color",[new ul(j.b.ANIMATIONTYPE_COLOR3,"diffuse",Fl,(()=>3))]),(0,Z.o)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new ul(j.b.ANIMATIONTYPE_FLOAT,"intensity",dl,(()=>1))]),(0,Z.o)("/extensions/KHR_lights_punctual/lights/{}/range",[new ul(j.b.ANIMATIONTYPE_FLOAT,"range",dl,(()=>1))]),(0,Z.o)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new ul(j.b.ANIMATIONTYPE_FLOAT,"innerAngle",xl,(()=>1))]),(0,Z.o)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new ul(j.b.ANIMATIONTYPE_FLOAT,"angle",xl,(()=>1))]),(0,Z.o)("/nodes/{}/extensions/EXT_lights_ies/color",[new ul(j.b.ANIMATIONTYPE_COLOR3,"diffuse",Fl,(()=>3))]),(0,Z.o)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new ul(j.b.ANIMATIONTYPE_FLOAT,"intensity",dl,(()=>1))]);const pl="KHR_animation_pointer";class kl{constructor(D){this.name=pl,this._loader=D,this._pathToObjectConverter=(0,Z.l)(this._loader.bb)}get enabled(){return this._loader.isExtensionUsed(pl)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(D,l,G,V,N){var M;const b=null===(M=V.target.extensions)||void 0===M?void 0:M.KHR_animation_pointer;if(!b||!this._pathToObjectConverter)return null;"pointer"!==V.target.path&&F.d.Warn(`${D}/target/path: Value (${V.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=V.target.node&&F.d.Warn(`${D}/target/node: Value (${V.target.node}) must not be present when using the ${this.name} extension`);const X=`${D}/extensions/${this.name}`,t=b.pointer;if(!t)throw new Error(`${X}: Pointer is missing`);try{const M=this._pathToObjectConverter.convert(t);if(!M.info.interpolation)throw new Error(`${X}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(D,l,G,V,{object:M.object,info:M.info.interpolation},N)}catch(R){return F.d.Warn(`${X}/pointer: Invalid pointer (${t}) skipped`),null}}}v(pl),c(pl,!0,(D=>new kl(D)));class ml{constructor(D,l,G){this.frame=D,this.action=l,this.onlyOnce=G,this.isDone=!1}_clone(){return new ml(this.frame,this.action,this.onlyOnce)}}var Tl=G(11563),Cl=G(11613),wl=G(11609);class Al{get loop(){return this._loop}set loop(D){D!==this._loop&&(this._loop=D,this.updateOptions({loop:D}))}get currentTime(){var D;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(D=Cl.e.audioEngine)&&void 0!==D&&D.audioContext&&(this.isPlaying||this.isPaused)){const D=this.isPaused?0:Cl.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+D}return 0}get spatialSound(){return this._spatialSound}set spatialSound(D){if(D==this._spatialSound)return;const l=this.isPlaying;this.pause(),D?(this._spatialSound=D,this._updateSpatialParameters()):this._disableSpatialSound(),l&&this.play()}constructor(D,l,G){var V;let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new n.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=N.Kl.Zero(),this._localDirection=new N.Kl(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=D,G=G||K.d.LastCreatedScene)if(this._scene=G,Al._SceneComponentInitialization(G),this._readyToPlayCallback=M,this._customAttenuationFunction=(D,l,G,V,N)=>l<G?D*(1-l/G):0,X&&(this.autoplay=X.autoplay||!1,this._loop=X.loop||!1,void 0!==X.volume&&(this._volume=X.volume),this._spatialSound=X.spatialSound??!1,this.maxDistance=X.maxDistance??100,this.useCustomAttenuation=X.useCustomAttenuation??!1,this.rolloffFactor=X.rolloffFactor||1,this.refDistance=X.refDistance||1,this.distanceModel=X.distanceModel||"linear",this._playbackRate=X.playbackRate||1,this._streaming=X.streaming??!1,this._length=X.length,this._offset=X.offset),null!==(V=Cl.e.audioEngine)&&void 0!==V&&V.canUseWebAudio&&Cl.e.audioEngine.audioContext){this._soundGain=Cl.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let D=!0;if(l)try{"string"===typeof l?(this._urlType="String",this._url=l):l instanceof ArrayBuffer?this._urlType="ArrayBuffer":l instanceof HTMLMediaElement?this._urlType="MediaElement":l instanceof MediaStream?this._urlType="MediaStream":l instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(l)&&(this._urlType="Array");let G=[],V=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Cl.e.audioEngine.audioContext.createMediaElementSource(l),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Cl.e.audioEngine.audioContext.createMediaStreamSource(l),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":l.byteLength>0&&(V=!0,this._soundLoaded(l));break;case"AudioBuffer":this._audioBufferLoaded(l);break;case"String":G.push(l);case"Array":0===G.length&&(G=l);for(let D=0;D<G.length;D++){const l=G[D];if(V=X&&X.skipCodecCheck||-1!==l.indexOf(".mp3",l.length-4)&&Cl.e.audioEngine.isMP3supported||-1!==l.indexOf(".ogg",l.length-4)&&Cl.e.audioEngine.isOGGsupported||-1!==l.indexOf(".wav",l.length-4)||-1!==l.indexOf(".m4a",l.length-4)||-1!==l.indexOf(".mp4",l.length-4)||-1!==l.indexOf("blob:"),V){this._streaming?(this._htmlAudioElement=new Audio(l),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,b.Tools.SetCorsBehavior(l,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(l,(D=>{this._soundLoaded(D)}),void 0,!0,!0,(D=>{D&&F.d.Error("XHR "+D.status+" error on: "+l+"."),F.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:D=!1}D?V||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):F.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(t){F.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Cl.e.audioEngine&&!Cl.e.audioEngine.WarnedWebAudioUnsupported&&(F.d.Error("Web Audio is not supported by your browser."),Cl.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var D;null!==(D=Cl.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(D){var l;null!==(l=Cl.e.audioEngine)&&void 0!==l&&l.audioContext&&(this._audioBuffer=D,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(D){var l;null!==(l=Cl.e.audioEngine)&&void 0!==l&&l.audioContext&&Cl.e.audioEngine.audioContext.decodeAudioData(D,(D=>{this._audioBufferLoaded(D)}),(D=>{F.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+D)}))}setAudioBuffer(D){var l;null!==(l=Cl.e.audioEngine)&&void 0!==l&&l.canUseWebAudio&&(this._audioBuffer=D,this._isReadyToPlay=!0)}updateOptions(D){D&&(this.loop=D.loop??this.loop,this.maxDistance=D.maxDistance??this.maxDistance,this.useCustomAttenuation=D.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=D.rolloffFactor??this.rolloffFactor,this.refDistance=D.refDistance??this.refDistance,this.distanceModel=D.distanceModel??this.distanceModel,this._playbackRate=D.playbackRate??this._playbackRate,this._length=D.length??void 0,this.spatialSound=D.spatialSound??this._spatialSound,this._setOffset(D.offset??void 0),this.setVolume(D.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var D;null!==(D=Cl.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&Cl.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Cl.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var D;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(D=this._soundPanner)||void 0===D||D.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var D;null!==(D=Cl.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(D){var l;null!==(l=Cl.e.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(D),this._isOutputConnected=!0)}setDirectionalCone(D,l,G){l<D?F.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=D,this._coneOuterAngle=l,this._coneOuterGain=G,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(D){if(D!=this._coneInnerAngle){var l;if(this._coneOuterAngle<D)return void F.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=D,null!==(l=Cl.e.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(D){if(D!=this._coneOuterAngle){var l;if(D<this._coneInnerAngle)return void F.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=D,null!==(l=Cl.e.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(D){var l;D.equals(this._position)||(this._position.V(D),null!==(l=Cl.e.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(D){var l;this._localDirection=D,null!==(l=Cl.e.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const D=this._connectedTransformNode.getWorldMatrix(),l=N.Kl.TransformNormal(this._localDirection,D);l.normalize(),this._soundPanner.orientationX.value=l.x,this._soundPanner.orientationY.value=l.y,this._soundPanner.orientationZ.value=l.z}updateDistanceFromListener(){var D;if(null!==(D=Cl.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const D=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Fl(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,D,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(D){this._customAttenuationFunction=D}play(D,l,G){var V;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(V=Cl.e.audioEngine)&&void 0!==V&&V.audioContext)try{var N,M;this._clearTimeoutsAndObservers();let V=D?(null===(N=Cl.e.audioEngine)||void 0===N?void 0:N.audioContext.currentTime)+D:null===(M=Cl.e.audioEngine)||void 0===M?void 0:M.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Cl.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const D=()=>{var G;if(null!==(G=Cl.e.audioEngine)&&void 0!==G&&G.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=l??0;const G=this._htmlAudioElement.play();void 0!==G&&G.catch((()=>{var l,G;(null===(l=Cl.e.audioEngine)||void 0===l||l.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(G=Cl.e.audioEngine)||void 0===G?void 0:G.onAudioUnlockedObservable.addOnce((()=>{D()})))}))}else{var V;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(V=Cl.e.audioEngine)||void 0===V?void 0:V.onAudioUnlockedObservable.addOnce((()=>{D()}))}};D()}}else{var b;const N=()=>{var N;if(null!==(N=Cl.e.audioEngine)&&void 0!==N&&N.audioContext){var M;if(G=G||this._length,void 0!==l&&this._setOffset(l),this._soundSource){const D=this._soundSource;D.onended=()=>{D.disconnect()}}if(this._soundSource=null===(M=Cl.e.audioEngine)||void 0===M?void 0:M.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var b;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==l&&(this._soundSource.loopStart=l),void 0!==G&&(this._soundSource.loopEnd=(0|l)+G),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},V=D?(null===(b=Cl.e.audioEngine)||void 0===b?void 0:b.audioContext.currentTime)+D:Cl.e.audioEngine.audioContext.currentTime;const N=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(V,N,this.loop?void 0:G)}}};"suspended"===(null===(b=Cl.e.audioEngine)||void 0===b?void 0:b.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var D;"suspended"===(null===(D=Cl.e.audioEngine)||void 0===D?void 0:D.audioContext.state)?(Cl.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Cl.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{N()})))):N()}),500):N()}this._startTime=V,this.isPlaying=!0,this.isPaused=!1}catch(X){F.d.Error("Error while trying to play audio: "+this.name+", "+X.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(D){var l;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var G;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(G=this._streamingSource)||void 0===G||G.disconnect();this.isPlaying=!1}else if(null!==(l=Cl.e.audioEngine)&&void 0!==l&&l.audioContext&&this._soundSource){const l=D?Cl.e.audioEngine.audioContext.currentTime+D:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(l)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var D;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var l;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(l=this._streamingSource)||void 0===l||l.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(D=Cl.e.audioEngine)&&void 0!==D&&D.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Cl.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(D,l){var G;null!==(G=Cl.e.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._soundGain&&(l&&Cl.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Cl.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Cl.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(D,Cl.e.audioEngine.audioContext.currentTime+l)):this._soundGain.gain.value=D),this._volume=D}setPlaybackRate(D){this._playbackRate=D,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(D){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=D,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=D=>this._onRegisterAfterWorldMatrixUpdate(D),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(D){var l;if(D.getBoundingInfo){const l=D.getBoundingInfo();this.setPosition(l.boundingSphere.centerWorld)}else this.setPosition(D.absolutePosition);null!==(l=Cl.e.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const D=()=>{(0,wl.g)((()=>this._isReadyToPlay),(()=>{G._audioBuffer=this.getAudioBuffer(),G._isReadyToPlay=!0,G.autoplay&&G.play(0,this._offset,this._length)}),void 0,300)},l={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},G=new Al(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,l);return this.useCustomAttenuation&&G.setAttenuationFunction(this._customAttenuationFunction),G.setPosition(this._position),G.setPlaybackRate(this._playbackRate),D(),G}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const D={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(D.connectedMeshId=this._connectedTransformNode.id),D.position=this._position.gb(),D.refDistance=this.refDistance,D.distanceModel=this.distanceModel,D.isDirectional=this._isDirectional,D.localDirectionToMesh=this._localDirection.gb(),D.coneInnerAngle=this._coneInnerAngle,D.coneOuterAngle=this._coneOuterAngle,D.coneOuterGain=this._coneOuterGain),D}static Parse(D,l,G,V){const M=D.name;let b;b=D.url?G+D.url:G+M;const X={autoplay:D.autoplay,loop:D.loop,volume:D.volume,spatialSound:D.spatialSound,maxDistance:D.maxDistance,rolloffFactor:D.rolloffFactor,refDistance:D.refDistance,distanceModel:D.distanceModel,playbackRate:D.playbackRate};let t;if(V){const D=()=>{(0,wl.g)((()=>V._isReadyToPlay),(()=>{t._audioBuffer=V.getAudioBuffer(),t._isReadyToPlay=!0,t.autoplay&&t.play(0,t._offset,t._length)}),void 0,300)};t=new Al(M,new ArrayBuffer(0),l,null,X),D()}else t=new Al(M,b,l,(()=>{l.removePendingData(t)}),X),l.addPendingData(t);if(D.position){const l=N.Kl.xl(D.position);t.setPosition(l)}if(D.isDirectional&&(t.setDirectionalCone(D.coneInnerAngle||360,D.coneOuterAngle||360,D.coneOuterGain||0),D.localDirectionToMesh)){const l=N.Kl.xl(D.localDirectionToMesh);t.setLocalDirectionToMesh(l)}if(D.connectedMeshId){const G=l.getMeshById(D.connectedMeshId);G&&t.attachToMesh(G)}return D.metadata&&(t.metadata=D.metadata),t}_setOffset(D){this._offset!==D&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=D)}_clearTimeoutsAndObservers(){var D;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(D=Cl.e.audioEngine)||void 0===D||D.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Al._SceneComponentInitialization=D=>{throw(0,Tl.d)("AudioSceneComponent")},(0,LD.c)("BABYLON.Sound",Al);class al{constructor(D,l,G){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],l.length!==G.length)throw new Error("Sounds length does not equal weights length");this.loop=D,this._weights=G;let V=0;for(const M of G)V+=M;const N=V>0?1/V:0;for(let M=0;M<this._weights.length;M++)this._weights[M]*=N;this._sounds=l;for(const M of this._sounds)M.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(D){if(D!==this._coneInnerAngle){if(this._coneOuterAngle<D)return void F.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=D;for(const l of this._sounds)l.directionalConeInnerAngle=D}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(D){if(D!==this._coneOuterAngle){if(D<this._coneInnerAngle)return void F.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=D;for(const l of this._sounds)l.directionalConeOuterAngle=D}}get volume(){return this._volume}set volume(D){if(D!==this._volume)for(const l of this._sounds)l.setVolume(D)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(D){if(!this.isPaused){this.stop();const D=Math.random();let l=0;for(let G=0;G<this._weights.length;G++)if(l+=this._weights[G],D<=l){this._currentIndex=G;break}}const l=this._sounds[this._currentIndex??0];l.isReady()?l.play(0,this.isPaused?void 0:D):l.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Ql{constructor(D){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(D=D||K.d.LastCreatedScene)&&(this._scene=D,this.soundCollection=[],this._options=l,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var D;null!==(D=Cl.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&Cl.e.audioEngine.audioContext&&(this._outputAudioNode=Cl.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Cl.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Cl.e.audioEngine&&Cl.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(D){var l;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(l=Cl.e.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._outputAudioNode&&D.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==D.soundTrackId&&(-1===D.soundTrackId?this._scene.mainSoundTrack.removeSound(D):this._scene.soundTracks&&this._scene.soundTracks[D.soundTrackId].removeSound(D)),this.soundCollection.push(D),D.soundTrackId=this.id}removeSound(D){const l=this.soundCollection.indexOf(D);-1!==l&&this.soundCollection.splice(l,1)}setVolume(D){var l;null!==(l=Cl.e.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=D)}switchPanningModelToHRTF(){var D;if(null!==(D=Cl.e.audioEngine)&&void 0!==D&&D.canUseWebAudio)for(let l=0;l<this.soundCollection.length;l++)this.soundCollection[l].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var D;if(null!==(D=Cl.e.audioEngine)&&void 0!==D&&D.canUseWebAudio)for(let l=0;l<this.soundCollection.length;l++)this.soundCollection[l].switchPanningModelToEqualPower()}connectToAnalyser(D){var l;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=D,null!==(l=Cl.e.audioEngine)&&void 0!==l&&l.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Cl.e.audioEngine.masterGain))}}var DG=G(11998),lG=G(11963),GG=G(11538);Cl.e.AudioEngineFactory=(D,l,G)=>new VG(D,l,G);class VG{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new n.e,this.onAudioLockedObservable=new n.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,GG.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const V=document.createElement("audio");this._hostElement=D,this._audioContext=l,this._audioDestination=G;try{V&&V.canPlayType&&(V.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||V.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(N){}try{V&&V.canPlayType&&V.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(N){}}lock(){this._triggerSuspendedState()}unlock(){var D,l;if("running"===(null===(D=this._audioContext)||void 0===D?void 0:D.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(l=this._audioContext)||void 0===l||l.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{F.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var D;null===(D=this._audioContext)||void 0===D||D.addEventListener("statechange",(()=>{var D;this.unlocked&&"running"!==(null===(D=this._audioContext)||void 0===D?void 0:D.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var D;return null!==(D=this._audioContext)&&void 0!==D&&D.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(D){this.canUseWebAudio=!1,F.d.Error("Web Audio: "+D.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(D){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const D=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",l=document.createElement("style");l.appendChild(document.createTextNode(D)),document.getElementsByTagName("head")[0].appendChild(l),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var D;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(D=this._audioContext)||void 0===D||D.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(D){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=D)}connectToAnalyser(D){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=D,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var NG=G(11554);(0,G(13105).g)(DG.e.NAME_AUDIO,((D,l,G,V)=>{let N,M=[];if(G.le=G.le||[],void 0!==D.le&&null!==D.le)for(let X=0,t=D.le.length;X<t;X++){var b;const t=D.le[X];null!==(b=Cl.e.audioEngine)&&void 0!==b&&b.canUseWebAudio?(t.url||(t.url=t.name),M[t.url]?G.le.push(Al.Parse(t,l,V,M[t.url])):(N=Al.Parse(t,l,V),M[t.url]=N,G.le.push(N))):G.le.push(new Al(t.name,null,l))}M=[]})),Object.defineProperty(lG.b.prototype,"mainSoundTrack",{get:function(){let D=this._getComponent(DG.e.NAME_AUDIO);return D||(D=new MG(this),this.o(D)),this._mainSoundTrack||(this._mainSoundTrack=new Ql(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),lG.b.prototype.getSoundByName=function(D){let l;for(l=0;l<this.mainSoundTrack.soundCollection.length;l++)if(this.mainSoundTrack.soundCollection[l].name===D)return this.mainSoundTrack.soundCollection[l];if(this.soundTracks)for(let G=0;G<this.soundTracks.length;G++)for(l=0;l<this.soundTracks[G].soundCollection.length;l++)if(this.soundTracks[G].soundCollection[l].name===D)return this.soundTracks[G].soundCollection[l];return null},Object.defineProperty(lG.b.prototype,"audioEnabled",{get:function(){let D=this._getComponent(DG.e.NAME_AUDIO);return D||(D=new MG(this),this.o(D)),D.audioEnabled},set:function(D){let l=this._getComponent(DG.e.NAME_AUDIO);l||(l=new MG(this),this.o(l)),D?l.enableAudio():l.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(lG.b.prototype,"headphone",{get:function(){let D=this._getComponent(DG.e.NAME_AUDIO);return D||(D=new MG(this),this.o(D)),D.headphone},set:function(D){let l=this._getComponent(DG.e.NAME_AUDIO);l||(l=new MG(this),this.o(l)),D?l.switchAudioModeForHeadphones():l.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(lG.b.prototype,"audioListenerPositionProvider",{get:function(){let D=this._getComponent(DG.e.NAME_AUDIO);return D||(D=new MG(this),this.o(D)),D.audioListenerPositionProvider},set:function(D){let l=this._getComponent(DG.e.NAME_AUDIO);if(l||(l=new MG(this),this.o(l)),D&&"function"!==typeof D)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");l.audioListenerPositionProvider=D},enumerable:!0,configurable:!0}),Object.defineProperty(lG.b.prototype,"audioListenerRotationProvider",{get:function(){let D=this._getComponent(DG.e.NAME_AUDIO);return D||(D=new MG(this),this.o(D)),D.audioListenerRotationProvider},set:function(D){let l=this._getComponent(DG.e.NAME_AUDIO);if(l||(l=new MG(this),this.o(l)),D&&"function"!==typeof D)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");l.audioListenerRotationProvider=D},enumerable:!0,configurable:!0}),Object.defineProperty(lG.b.prototype,"audioPositioningRefreshRate",{get:function(){let D=this._getComponent(DG.e.NAME_AUDIO);return D||(D=new MG(this),this.o(D)),D.audioPositioningRefreshRate},set:function(D){let l=this._getComponent(DG.e.NAME_AUDIO);l||(l=new MG(this),this.o(l)),l.audioPositioningRefreshRate=D},enumerable:!0,configurable:!0});class MG{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(D){this.name=DG.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new N.Kl,this._cachedCameraPosition=new N.Kl,this._lastCheck=0,this._invertMatrixTemp=new N.Matrix,this._cameraDirectionTemp=new N.Kl,(D=D||K.d.LastCreatedScene)&&(this.dl=D,D.soundTracks=[],D.le=[])}register(){this.dl._afterRenderStage.registerStep(DG.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(D){if(D.le=[],this.dl.soundTracks)for(let l=0;l<this.dl.soundTracks.length;l++){const G=this.dl.soundTracks[l];for(let l=0;l<G.soundCollection.length;l++)D.le.push(G.soundCollection[l].serialize())}}addFromContainer(D){if(D.le)for(const l of D.le)l.play(),l.autoplay=!0,this.dl.mainSoundTrack.addSound(l)}removeFromContainer(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(D.le)for(const G of D.le)G.stop(),G.autoplay=!1,this.dl.mainSoundTrack.removeSound(G),l&&G.dispose()}dispose(){const D=this.dl;if(D._mainSoundTrack&&D.mainSoundTrack.dispose(),D.soundTracks)for(let l=0;l<D.soundTracks.length;l++)D.soundTracks[l].dispose()}disableAudio(){const D=this.dl;let l;for(this._audioEnabled=!1,Cl.e.audioEngine&&Cl.e.audioEngine.audioContext&&Cl.e.audioEngine.audioContext.suspend(),l=0;l<D.mainSoundTrack.soundCollection.length;l++)D.mainSoundTrack.soundCollection[l].pause();if(D.soundTracks)for(l=0;l<D.soundTracks.length;l++)for(let G=0;G<D.soundTracks[l].soundCollection.length;G++)D.soundTracks[l].soundCollection[G].pause()}enableAudio(){const D=this.dl;let l;for(this._audioEnabled=!0,Cl.e.audioEngine&&Cl.e.audioEngine.audioContext&&Cl.e.audioEngine.audioContext.resume(),l=0;l<D.mainSoundTrack.soundCollection.length;l++)D.mainSoundTrack.soundCollection[l].isPaused&&D.mainSoundTrack.soundCollection[l].play();if(D.soundTracks)for(l=0;l<D.soundTracks.length;l++)for(let G=0;G<D.soundTracks[l].soundCollection.length;G++)D.soundTracks[l].soundCollection[G].isPaused&&D.soundTracks[l].soundCollection[G].play()}switchAudioModeForHeadphones(){const D=this.dl;if(this._headphone=!0,D.mainSoundTrack.switchPanningModelToHRTF(),D.soundTracks)for(let l=0;l<D.soundTracks.length;l++)D.soundTracks[l].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const D=this.dl;if(this._headphone=!1,D.mainSoundTrack.switchPanningModelToEqualPower(),D.soundTracks)for(let l=0;l<D.soundTracks.length;l++)D.soundTracks[l].switchPanningModelToEqualPower()}_afterRender(){const D=NG.c.Now;if(this._lastCheck&&D-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=D;const l=this.dl;if(!this._audioEnabled||!l._mainSoundTrack||!l.soundTracks||0===l._mainSoundTrack.soundCollection.length&&1===l.soundTracks.length)return;const G=Cl.e.audioEngine;if(G&&G.audioContext){let D,V=l.activeCamera;if(l.activeCameras&&l.activeCameras.length>0&&(V=l.activeCameras[0]),this.audioListenerPositionProvider){const D=this.audioListenerPositionProvider();G.audioContext.listener.setPosition(D.x||0,D.y||0,D.z||0)}else V?this._cachedCameraPosition.equals(V.globalPosition)||(this._cachedCameraPosition.V(V.globalPosition),G.audioContext.listener.setPosition(V.globalPosition.x,V.globalPosition.y,V.globalPosition.z)):G.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const D=this.audioListenerRotationProvider();G.audioContext.listener.setOrientation(D.x||0,D.y||0,D.z||0,0,1,0)}else V?(V.rigCameras&&V.rigCameras.length>0&&(V=V.rigCameras[0]),V.getViewMatrix().invertToRef(this._invertMatrixTemp),N.Kl.TransformNormalToRef(MG._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.V(this._cameraDirectionTemp),G.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):G.audioContext.listener.setOrientation(0,0,0,0,1,0);for(D=0;D<l.mainSoundTrack.soundCollection.length;D++){const G=l.mainSoundTrack.soundCollection[D];G.useCustomAttenuation&&G.updateDistanceFromListener()}if(l.soundTracks)for(D=0;D<l.soundTracks.length;D++)for(let G=0;G<l.soundTracks[D].soundCollection.length;G++){const V=l.soundTracks[D].soundCollection[G];V.useCustomAttenuation&&V.updateDistanceFromListener()}}}}MG._CameraDirection=new N.Kl(0,0,-1),Al._SceneComponentInitialization=D=>{let l=D._getComponent(DG.e.NAME_AUDIO);l||(l=new MG(D),D.o(l))};const bG="MSFT_audio_emitter";class XG{constructor(D){this.name=bG,this._loader=D,this.enabled=this._loader.isExtensionUsed(bG)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const D=this._loader.bb.extensions;if(D&&D[this.name]){const l=D[this.name];this._clips=l.clips,this._emitters=l.emitters,z.Assign(this._clips),z.Assign(this._emitters)}}loadSceneAsync(D,l){return P.LoadExtensionAsync(D,l,this.name,(async(G,V)=>{const N=new Array;N.push(this._loader.loadSceneAsync(D,l));for(const D of V.emitters){const l=z.Get(`${G}/emitters`,this._emitters,D);if(void 0!=l.refDistance||void 0!=l.maxDistance||void 0!=l.rolloffFactor||void 0!=l.distanceModel||void 0!=l.innerAngle||void 0!=l.outerAngle)throw new Error(`${G}: Direction or Distance properties are not allowed on emitters attached to a scene`);N.push(this._loadEmitterAsync(`${G}/emitters/${l.index}`,l))}await Promise.all(N)}))}loadNodeAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(D,V)=>{const M=new Array,X=await this._loader.loadNodeAsync(D,l,(l=>{for(const G of V.emitters){const V=z.Get(`${D}/emitters`,this._emitters,G);M.push(this._loadEmitterAsync(`${D}/emitters/${V.index}`,V).then((()=>{for(const D of V._babylonSounds)D.attachToMesh(l),void 0==V.innerAngle&&void 0==V.outerAngle||(D.setLocalDirectionToMesh(N.Kl.Forward()),D.setDirectionalCone(2*b.Tools.ToDegrees(void 0==V.innerAngle?Math.PI:V.innerAngle),2*b.Tools.ToDegrees(void 0==V.outerAngle?Math.PI:V.outerAngle),0))})))}G(l)}));return await Promise.all(M),X}))}loadAnimationAsync(D,l){return P.LoadExtensionAsync(D,l,this.name,(async(G,V)=>{const N=await this._loader.loadAnimationAsync(D,l),M=new Array;z.Assign(V.events);for(const b of V.events)M.push(this._loadAnimationEventAsync(`${G}/events/${b.index}`,D,l,b,N));return await Promise.all(M),N}))}_loadClipAsync(D,l){if(l._objectURL)return l._objectURL;let G;if(l.uri)G=this._loader.loadUriAsync(D,l,l.uri);else{const V=z.Get(`${D}/bufferView`,this._loader.bb.bufferViews,l.bufferView);G=this._loader.loadBufferViewAsync(`/bufferViews/${V.index}`,V)}return l._objectURL=G.then((D=>URL.createObjectURL(new Blob([D],{type:l.mimeType})))),l._objectURL}_loadEmitterAsync(D,l){if(l._babylonSounds=l._babylonSounds||[],!l._babylonData){const D=new Array,G=l.name||`emitter${l.index}`,V={loop:!1,autoplay:!1,volume:void 0==l.volume?1:l.volume};for(let M=0;M<l.clips.length;M++){const N=`/extensions/${this.name}/clips`,b=z.Get(N,this._clips,l.clips[M].clip);D.push(this._loadClipAsync(`${N}/${l.clips[M].clip}`,b).then((D=>{const N=l._babylonSounds[M]=new Al(G,D,this._loader.babylonScene,null,V);N.refDistance=l.refDistance||1,N.maxDistance=l.maxDistance||256,N.rolloffFactor=l.rolloffFactor||1,N.distanceModel=l.distanceModel||"exponential"})))}const N=Promise.all(D).then((()=>{const D=l.clips.map((D=>D.weight||1)),G=new al(l.loop||!1,l._babylonSounds,D);l.innerAngle&&(G.directionalConeInnerAngle=2*b.Tools.ToDegrees(l.innerAngle)),l.outerAngle&&(G.directionalConeOuterAngle=2*b.Tools.ToDegrees(l.outerAngle)),l.volume&&(G.volume=l.volume),l._babylonData.sound=G}));l._babylonData={loaded:N}}return l._babylonData.loaded}_getEventAction(D,l,G,V,N){switch(G){case"play":return D=>{const G=(N||0)+(D-V);l.play(G)};case"stop":return()=>{l.stop()};case"pause":return()=>{l.pause()};default:throw new Error(`${D}: Unsupported action ${G}`)}}_loadAnimationEventAsync(D,l,G,V,N){if(0==N.targetedAnimations.length)return Promise.resolve();const M=N.targetedAnimations[0],b=V.Vl,X=z.Get(`/extensions/${this.name}/emitters`,this._emitters,b);return this._loadEmitterAsync(D,X).then((()=>{const l=X._babylonData.sound;if(l){const G=new ml(V.time,this._getEventAction(D,l,V.action,V.time,V.startOffset));M.animation.addEvent(G),N.onAnimationGroupEndObservable.add((()=>{l.stop()})),N.onAnimationGroupPauseObservable.add((()=>{l.pause()}))}}))}}v(bG),c(bG,!0,(D=>new XG(D)));const tG="MSFT_lod";class RG{constructor(D){var l;this.name=tG,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new n.e,this.onMaterialLODsLoadedObservable=new n.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=D,this.maxLODsToLoad=(null===(l=this._loader.parent.extensionOptions[tG])||void 0===l?void 0:l.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(tG)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let D=0;D<this._nodePromiseLODs.length;D++){const l=Promise.all(this._nodePromiseLODs[D]).then((()=>{0!==D&&(this._loader.endPerformanceCounter(`Node LOD ${D}`),this._loader.log(`Loaded node LOD ${D}`)),this.onNodeLODsLoadedObservable.notifyObservers(D),D!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${D+1}`),this._loadBufferLOD(this._nodeBufferLODs,D+1),this._nodeSignalLODs[D]&&this._nodeSignalLODs[D].resolve())}));this._loader._completePromises.push(l)}for(let D=0;D<this._materialPromiseLODs.length;D++){const l=Promise.all(this._materialPromiseLODs[D]).then((()=>{0!==D&&(this._loader.endPerformanceCounter(`Material LOD ${D}`),this._loader.log(`Loaded material LOD ${D}`)),this.onMaterialLODsLoadedObservable.notifyObservers(D),D!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${D+1}`),this._loadBufferLOD(this._materialBufferLODs,D+1),this._materialSignalLODs[D]&&this._materialSignalLODs[D].resolve())}));this._loader._completePromises.push(l)}}loadSceneAsync(D,l){const G=this._loader.loadSceneAsync(D,l);return this._loadBufferLOD(this._bufferLODs,0),G}loadNodeAsync(D,l,G){return P.LoadExtensionAsync(D,l,this.name,(async(D,N)=>{let M;const b=this._getLODs(D,l,this._loader.bb.nodes,N.ids);this._loader.logOpen(`${D}`);for(let l=0;l<b.length;l++){const D=b[l];0!==l&&(this._nodeIndexLOD=l,this._nodeSignalLODs[l]=this._nodeSignalLODs[l]||new V);const N=D=>{G(D),D.QX(!1)},X=this._loader.loadNodeAsync(`/nodes/${D.index}`,D,N).then((D=>{if(0!==l){const D=b[l-1];D._babylonTransformNode&&(this._disposeTransformNode(D._babylonTransformNode),delete D._babylonTransformNode)}return D.QX(!0),D}));this._nodePromiseLODs[l]=this._nodePromiseLODs[l]||[],0===l?M=X:(this._nodeIndexLOD=null,this._nodePromiseLODs[l].push(X))}return this._loader.logClose(),await M}))}_loadMaterialAsync(D,l,G,V,N){return this._nodeIndexLOD?null:P.LoadExtensionAsync(D,l,this.name,(async(D,M)=>{let b;const X=this._getLODs(D,l,this._loader.bb.materials,M.ids);this._loader.logOpen(`${D}`);for(let l=0;l<X.length;l++){const D=X[l];0!==l&&(this._materialIndexLOD=l);const M=this._loader._loadMaterialAsync(`/materials/${D.index}`,D,G,V,(D=>{0===l&&N(D)})).then((D=>{if(0!==l){N(D);const G=X[l-1]._data;G[V]&&(this._disposeMaterials([G[V].babylonMaterial]),delete G[V])}return D}));this._materialPromiseLODs[l]=this._materialPromiseLODs[l]||[],0===l?b=M:(this._materialIndexLOD=null,this._materialPromiseLODs[l].push(M))}return this._loader.logClose(),await b}))}_loadUriAsync(D,l,G){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const N=this._nodeIndexLOD-1;return this._nodeSignalLODs[N]=this._nodeSignalLODs[N]||new V,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(D,l,G)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const N=this._materialIndexLOD-1;return this._materialSignalLODs[N]=this._materialSignalLODs[N]||new V,this._materialSignalLODs[N].promise.then((async()=>await this._loader.loadUriAsync(D,l,G)))}return null}loadBufferAsync(D,l,G,N){if(this._loader.parent.useRangeRequests&&!l.uri){if(!this._loader.bin)throw new Error(`${D}: Uri is missing or the binary glTF is missing its binary chunk`);const l=async(D,l)=>{const M=G,b=M+N-1;let X=D[l];return X?(X.start=Math.min(X.start,M),X.end=Math.max(X.end,b)):(X={start:M,end:b,loaded:new V},D[l]=X),await X.loaded.promise.then((D=>new Uint8Array(D.buffer,D.byteOffset+G-X.start,N)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?l(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?l(this._materialBufferLODs,this._materialIndexLOD):l(this._bufferLODs,0)}return null}_loadBufferLOD(D,l){const G=D[l];G&&(this._loader.log(`Loading buffer range [${G.start}-${G.end}]`),this._loader.bin.readAsync(G.start,G.end-G.start+1).then((D=>{G.loaded.resolve(D)}),(D=>{G.loaded.reject(D)})))}_getLODs(D,l,G,V){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const N=[];for(let M=V.length-1;M>=0;M--)if(N.push(z.Get(`${D}/ids/${V[M]}`,G,V[M])),N.length===this.maxLODsToLoad)return N;return N.push(l),N}_disposeTransformNode(D){const l=[],G=D.material;G&&l.push(G);for(const N of D.getChildMeshes())N.material&&l.push(N.material);D.dispose();const V=l.filter((D=>this._loader.babylonScene.meshes.every((l=>l.material!=D))));this._disposeMaterials(V)}_disposeMaterials(D){const l={};for(const G of D){for(const D of G.getActiveTextures())l[D.uniqueId]=D;G.dispose()}for(const G in l)for(const D of this._loader.babylonScene.materials)D.hasTexture(l[G])&&delete l[G];for(const G in l)l[G].dispose()}}v(tG),c(tG,!0,(D=>new RG(D)));const nG="MSFT_minecraftMesh";class gG{constructor(D){this.name=nG,this._loader=D,this.enabled=this._loader.isExtensionUsed(nG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtraAsync(D,l,this.name,(async(V,N)=>{if(N){if(!(G instanceof x.c))throw new Error(`${V}: Material type not supported`);const N=this._loader.loadMaterialPropertiesAsync(D,l,G);return G.needAlphaBlending()&&(G.forceDepthWrite=!0,G.separateCullingPass=!0),G.ob=G.forceDepthWrite,G.twoSidedLighting=!0,await N}}))}}v(nG),c(nG,!0,(D=>new gG(D)));const jG="MSFT_sRGBFactors";class eG{constructor(D){this.name=jG,this._loader=D,this.enabled=this._loader.isExtensionUsed(jG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,l,G){return P.LoadExtraAsync(D,l,this.name,(async(V,N)=>{if(N){if(!(G instanceof x.c))throw new Error(`${V}: Material type not supported`);const N=this._loader.loadMaterialPropertiesAsync(D,l,G),M=G.uD().getEngine().useExactSrgbConversions;return G.albedoTexture||G.albedoColor.toLinearSpaceToRef(G.albedoColor,M),G.reflectivityTexture||G.reflectivityColor.toLinearSpaceToRef(G.reflectivityColor,M),await N}}))}}v(jG),c(jG,!0,(D=>new eG(D)));var KG=G(13407);const FG={};var dG=G(13461),HG=G(13436),hG=G(13411),xG=G(13423);function rG(D,l){for(const G of D)for(const D of G.dataOutputs)if(D.uniqueId===l)return D;throw new Error("Could not find data out connection with unique id "+l)}function oG(D,l){for(const G of D)if(G instanceof HG.b)for(const D of G.signalInputs)if(D.uniqueId===l)return D;throw new Error("Could not find signal in connection with unique id "+l)}async function LG(D,l){const V=await Promise.all(D.allBlocks.map((async D=>{const l=function(D){switch(D){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([G.e(78),G.e(79)]).then(G.bind(G,14812))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await G.e(80).then(G.bind(G,14816))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await G.e(81).then(G.bind(G,14822))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await G.e(82).then(G.bind(G,14828))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await G.e(83).then(G.bind(G,14832))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await G.e(84).then(G.bind(G,14840))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await G.e(85).then(G.bind(G,14844))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await G.e(86).then(G.bind(G,14853))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await G.e(87).then(G.bind(G,14856))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await G.e(89).then(G.bind(G,14876))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await G.e(89).then(G.bind(G,14876))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await G.e(89).then(G.bind(G,14876))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await G.e(89).then(G.bind(G,14876))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await G.e(89).then(G.bind(G,14876))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await G.e(89).then(G.bind(G,14876))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await G.e(90).then(G.bind(G,14879))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await G.e(90).then(G.bind(G,14879))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await G.e(90).then(G.bind(G,14879))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await G.e(90).then(G.bind(G,14879))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await G.e(95).then(G.bind(G,14886))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await G.e(96).then(G.bind(G,14891))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await G.e(97).then(G.bind(G,14893))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await G.e(98).then(G.bind(G,14898))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await G.e(99).then(G.bind(G,14900))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await G.e(100).then(G.bind(G,14907))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await G.e(101).then(G.bind(G,14909))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await G.e(102).then(G.bind(G,14914))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await G.e(103).then(G.bind(G,14921))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await G.e(104).then(G.bind(G,14924))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await G.e(105).then(G.bind(G,14930))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await G.e(106).then(G.bind(G,14933))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await G.e(107).then(G.bind(G,14941))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await G.e(108).then(G.bind(G,14947))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await G.e(109).then(G.bind(G,14952))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await G.e(110).then(G.bind(G,14961))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await G.e(111).then(G.bind(G,14963))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await G.e(112).then(G.bind(G,14968))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await G.e(113).then(G.bind(G,14972))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await G.e(92).then(G.bind(G,14981))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await G.e(114).then(G.bind(G,14983))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await G.e(115).then(G.bind(G,14990))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await G.e(116).then(G.bind(G,14993))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await G.e(93).then(G.bind(G,14995))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await G.e(88).then(G.bind(G,14863))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await G.e(94).then(G.bind(G,15003))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await G.e(94).then(G.bind(G,15003))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await G.e(94).then(G.bind(G,15003))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await G.e(94).then(G.bind(G,15003))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await G.e(94).then(G.bind(G,15003))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await G.e(94).then(G.bind(G,15003))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await G.e(94).then(G.bind(G,15003))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await G.e(94).then(G.bind(G,15003))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await G.e(89).then(G.bind(G,14876))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await G.e(89).then(G.bind(G,14876))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await G.e(89).then(G.bind(G,14876))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await G.e(89).then(G.bind(G,14876))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await G.e(89).then(G.bind(G,14876))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await G.e(89).then(G.bind(G,14876))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await G.e(89).then(G.bind(G,14876))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await G.e(90).then(G.bind(G,14879))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await G.e(90).then(G.bind(G,14879))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await G.e(91).then(G.bind(G,15006))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await G.e(91).then(G.bind(G,15006))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await G.e(91).then(G.bind(G,15006))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await G.e(91).then(G.bind(G,15006))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await G.e(91).then(G.bind(G,15006))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await G.e(91).then(G.bind(G,15006))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await G.e(117).then(G.bind(G,15008))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await G.e(118).then(G.bind(G,15017))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await G.e(119).then(G.bind(G,15024))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await G.e(120).then(G.bind(G,15031))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await G.e(121).then(G.bind(G,15040))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await G.e(122).then(G.bind(G,15046))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await G.e(123).then(G.bind(G,15052))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await G.e(124).then(G.bind(G,15060))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await G.e(125).then(G.bind(G,15067))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await G.e(126).then(G.bind(G,15069))).FlowGraphDataSwitchBlock;default:if(FG[D])return FG[D];throw new Error(`Unknown block name ${D}`)}}(D.className);return await l()})));return function(D,l,G){const V=l.coordinator.createGraph(),N=[],M=l.valueParseFunction??hG.b;for(let b=0;b<D.allBlocks.length;b++){const X=BG(D.allBlocks[b],{dl:l.coordinator.config.dl,pathConverter:l.pathConverter,assetsContainer:l.coordinator.config.dl,valueParseFunction:M},G[b]);N.push(X),X instanceof dG.b&&V.addEventBlock(X)}for(const b of N){for(const D of b.dataInputs)for(const l of D.connectedPointIds){const G=rG(N,l);D.connectTo(G)}if(b instanceof HG.b)for(const D of b.signalOutputs)for(const l of D.connectedPointIds){const G=oG(N,l);D.connectTo(G)}}for(const b of D.executionContexts)uG(b,{graph:V,valueParseFunction:M},D.rightHanded);return V}(D,l,V)}function uG(D,l,G){const V=l.graph.createContext();D.enableLogging&&(V.enableLogging=!0),V.treatDataAsRightHanded=G||!1;const N=l.valueParseFunction??hG.b;V.uniqueId=D.uniqueId;const M=V.uD();if(D._assetsContext){var b,X,t,R,n,g,j,e,K,F;const l=D._assetsContext,G={meshes:null===(b=l.meshes)||void 0===b?void 0:b.map((D=>M.getMeshById(D))),lights:null===(X=l.lights)||void 0===X?void 0:X.map((D=>M.getLightByName(D))),cameras:null===(t=l.cameras)||void 0===t?void 0:t.map((D=>M.getCameraByName(D))),materials:null===(R=l.materials)||void 0===R?void 0:R.map((D=>M.getMaterialById(D))),textures:null===(n=l.textures)||void 0===n?void 0:n.map((D=>M.getTextureByName(D))),animations:null===(g=l.animations)||void 0===g?void 0:g.map((D=>M.animations.find((l=>l.name===D)))),skeletons:null===(j=l.skeletons)||void 0===j?void 0:j.map((D=>M.getSkeletonByName(D))),xj:null===(e=l.xj)||void 0===e?void 0:e.map((D=>M.getParticleSystemById(D))),animationGroups:null===(K=l.animationGroups)||void 0===K?void 0:K.map((D=>M.getAnimationGroupByName(D))),transformNodes:null===(F=l.transformNodes)||void 0===F?void 0:F.map((D=>M.getTransformNodeById(D))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],le:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};V.assetsContext=G}for(const d in D._userVariables){const l=N(d,D._userVariables,V.assetsContext,M);V.userVariables[d]=l}for(const d in D._connectionValues){const l=N(d,D._connectionValues,V.assetsContext,M);V._setConnectionValueByKey(d,l)}return V}function BG(D,l,G){const V={},N=l.valueParseFunction??hG.b;if(D.config)for(const b in D.config)V[b]=N(b,D.config,l.assetsContainer||l.dl,l.dl);if((0,hG.e)(D.className)){if(!l.pathConverter)throw new Error("Path converter is required for this block");V.pathConverter=l.pathConverter}const M=new G(V);M.uniqueId=D.uniqueId;for(let b=0;b<D.dataInputs.length;b++){const l=M.getDataInput(D.dataInputs[b].name);if(!l)throw new Error("Could not find data input with name "+D.dataInputs[b].name+" in block "+D.className);l.deserialize(D.dataInputs[b])}for(let b=0;b<D.dataOutputs.length;b++){const l=M.getDataOutput(D.dataOutputs[b].name);if(!l)throw new Error("Could not find data output with name "+D.dataOutputs[b].name+" in block "+D.className);l.deserialize(D.dataOutputs[b])}return M.metadata=D.metadata,M.deserialize&&M.deserialize(D),M}function IG(D){const[l,G]=D.split(":");return WG({op:l,extension:G})}function WG(D){var l;let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const V=D.extension?null===(l=yG[D.extension])||void 0===l?void 0:l[D.op]:SG[D.op];if(!V&&(F.d.Warn(`No mapping found for operation ${D.op} and extension ${D.extension||"KHR_interactivity"}`),G)){const l={},G={flows:{}};if(D.inputValueSockets){l.values={};for(const G in D.inputValueSockets)l.values[G]={name:G}}return D.outputValueSockets&&(G.values={},Object.keys(D.outputValueSockets).forEach((D=>{G.values[D]={name:D}}))),{In:[],inputs:l,outputs:G}}return V}function iG(D,l,G){yG[l]||(yG[l]={}),yG[l][D]=G}const yG={BABYLON:{"flow/log":{In:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},SG={"event/onStart":{In:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{In:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{In:["FlowGraphSendCustomEventBlock"],extraProcessor(D,l,G,V,N){if("event/send"!==l.op||!D.configuration||1!==Object.keys(D.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const M=D.configuration.event.value[0];if("number"!==typeof M)throw new Error("Event id should be a number");const b=V.arrays.events[M],X=N[0];return X.config||(X.config={}),X.config.eventId=b.eventId,X.config.eventData=b.eventData,N}},"event/receive":{In:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(D,l){var G;if(!D.configuration)return F.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const V=D.configuration.event;if(!V)return F.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const N=V.value[0];if("number"!==typeof N)return F.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(G=l.events)||void 0===G?void 0:G[N])?{valid:!0}:(F.d.Error(`Event with id ${N} not found`),{valid:!1,error:`Event with id ${N} not found`})},extraProcessor(D,l,G,V,N){if("event/receive"!==l.op||!D.configuration||1!==Object.keys(D.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const M=D.configuration.event.value[0];if("number"!==typeof M)throw new Error("Event id should be a number");const b=V.arrays.events[M],X=N[0];return X.config||(X.config={}),X.config.eventId=b.eventId,X.config.eventData=b.eventData,N}},"math/e":OG("FlowGraphEBlock"),"math/pi":OG("FlowGraphPIBlock"),"math/inf":OG("FlowGraphInfBlock"),"math/nan":OG("FlowGraphNaNBlock"),"math/abs":OG("FlowGraphAbsBlock"),"math/sign":OG("FlowGraphSignBlock"),"math/trunc":OG("FlowGraphTruncBlock"),"math/floor":OG("FlowGraphFloorBlock"),"math/ceil":OG("FlowGraphCeilBlock"),"math/round":{In:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,l,G,V,N){var M;return(M=N[0]).config||(M.config={}),N[0].config.roundHalfAwayFromZero=!0,N}},"math/fract":OG("FlowGraphFractBlock"),"math/neg":OG("FlowGraphNegationBlock"),"math/add":OG("FlowGraphAddBlock",["a","b"],!0),"math/sub":OG("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{In:["FlowGraphMultiplyBlock"],extraProcessor(D,l,G,V,N){var M;(M=N[0]).config||(M.config={}),N[0].config.useMatrixPerComponent=!0,N[0].config.preventIntegerFloatArithmetic=!0;let b=-1;return Object.keys(D.values||{}).find((l=>{var G;return void 0!==(null===(G=D.values)||void 0===G?void 0:G[l].type)&&(b=D.values[l].type,!0)})),-1!==b&&(N[0].config.type=V.arrays.types[b].flowGraphType),N},validation:D=>D.values?sG(D):{valid:!0}},"math/div":OG("FlowGraphDivideBlock",["a","b"],!0),"math/rem":OG("FlowGraphModuloBlock",["a","b"]),"math/min":OG("FlowGraphMinBlock",["a","b"]),"math/max":OG("FlowGraphMaxBlock",["a","b"]),"math/clamp":OG("FlowGraphClampBlock",["a","b","c"]),"math/saturate":OG("FlowGraphSaturateBlock"),"math/mix":OG("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":OG("FlowGraphEqualityBlock",["a","b"]),"math/lt":OG("FlowGraphLessThanBlock",["a","b"]),"math/le":OG("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":OG("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":OG("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":OG("FlowGraphIsNaNBlock"),"math/isinf":OG("FlowGraphIsInfBlock"),"math/select":{In:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{In:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":OG("FlowGraphSinBlock"),"math/cos":OG("FlowGraphCosBlock"),"math/tan":OG("FlowGraphTanBlock"),"math/asin":OG("FlowGraphASinBlock"),"math/acos":OG("FlowGraphACosBlock"),"math/atan":OG("FlowGraphATanBlock"),"math/atan2":OG("FlowGraphATan2Block",["a","b"]),"math/sinh":OG("FlowGraphSinhBlock"),"math/cosh":OG("FlowGraphCoshBlock"),"math/tanh":OG("FlowGraphTanhBlock"),"math/asinh":OG("FlowGraphASinhBlock"),"math/acosh":OG("FlowGraphACoshBlock"),"math/atanh":OG("FlowGraphATanhBlock"),"math/exp":OG("FlowGraphExponentialBlock"),"math/log":OG("FlowGraphLogBlock"),"math/log2":OG("FlowGraphLog2Block"),"math/log10":OG("FlowGraphLog10Block"),"math/sqrt":OG("FlowGraphSquareRootBlock"),"math/cbrt":OG("FlowGraphCubeRootBlock"),"math/pow":OG("FlowGraphPowerBlock",["a","b"]),"math/length":OG("FlowGraphLengthBlock"),"math/normalize":OG("FlowGraphNormalizeBlock"),"math/dot":OG("FlowGraphDotBlock",["a","b"]),"math/cross":OG("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":OG("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":OG("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{In:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{In:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{In:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{In:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{In:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{In:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{In:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":OG("FlowGraphTransposeBlock"),"math/determinant":OG("FlowGraphDeterminantBlock"),"math/inverse":OG("FlowGraphInvertMatrixBlock"),"math/matmul":OG("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{In:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"ub",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,l,G,V,N,M){const b=N[0].dataInputs.find((D=>"rotationQuaternion"===D.name));if(!b)throw new Error("Rotation quaternion input not found");return M._connectionValues[b.uniqueId]&&(M._connectionValues[b.uniqueId].type="Quaternion"),N}},"math/matDecompose":{In:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"ub"}}}},"math/quatConjugate":OG("FlowGraphConjugateBlock",["a"]),"math/quatMul":{In:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,l,G,V,N){var M;return(M=N[0]).config||(M.config={}),N[0].config.type="Quaternion",N}},"math/quatAngleBetween":OG("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{In:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":OG("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":OG("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{In:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,l,G,V,N){var M;return(M=N[0]).config||(M.config={}),N[0].config.inputIsColumnMajor=!0,N}},"math/extract2x2":{In:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{In:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,l,G,V,N){var M;return(M=N[0]).config||(M.config={}),N[0].config.inputIsColumnMajor=!0,N}},"math/extract3x3":{In:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{In:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,l,G,V,N){var M;return(M=N[0]).config||(M.config={}),N[0].config.inputIsColumnMajor=!0,N}},"math/extract4x4":{In:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{In:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,l,G,V,N,M){var b,X;(X=N[0]).config||(X.config={});const t=N[0].dataInputs[0];return N[0].config.valueType=(null===(b=M._connectionValues[t.uniqueId])||void 0===b?void 0:b.type)??"FlowGraphInteger",N}},"math/and":{In:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,l,G,V,N,M){var b,X,t;(t=N[0]).config||(t.config={});const R=N[0].dataInputs[0],n=N[0].dataInputs[1];return N[0].config.valueType=(null===(b=M._connectionValues[R.uniqueId])||void 0===b?void 0:b.type)??(null===(X=M._connectionValues[n.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",N}},"math/or":{In:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,l,G,V,N,M){var b,X,t;(t=N[0]).config||(t.config={});const R=N[0].dataInputs[0],n=N[0].dataInputs[1];return N[0].config.valueType=(null===(b=M._connectionValues[R.uniqueId])||void 0===b?void 0:b.type)??(null===(X=M._connectionValues[n.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",N}},"math/xor":{In:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,l,G,V,N,M){var b,X,t;(t=N[0]).config||(t.config={});const R=N[0].dataInputs[0],n=N[0].dataInputs[1];return N[0].config.valueType=(null===(b=M._connectionValues[R.uniqueId])||void 0===b?void 0:b.type)??(null===(X=M._connectionValues[n.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",N}},"math/asr":OG("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":OG("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":OG("FlowGraphLeadingZerosBlock"),"math/ctz":OG("FlowGraphTrailingZerosBlock"),"math/popcnt":OG("FlowGraphOneBitsCounterBlock"),"math/rad":OG("FlowGraphDegToRadBlock"),"math/deg":OG("FlowGraphRadToDegBlock"),"type/boolToInt":OG("FlowGraphBooleanToInt"),"type/boolToFloat":OG("FlowGraphBooleanToFloat"),"type/intToBool":OG("FlowGraphIntToBoolean"),"type/intToFloat":OG("FlowGraphIntToFloat"),"type/floatToInt":OG("FlowGraphFloatToInt"),"type/floatToBool":OG("FlowGraphFloatToBoolean"),"flow/sequence":{In:["FlowGraphSequenceBlock"],extraProcessor(D,l,G,V,N){const M=N[0];return M.config||(M.config={}),M.config.outputSignalCount=Object.keys(D.flows||[]).length,M.signalOutputs.forEach(((D,l)=>{D.name="out_"+l})),N}},"flow/branch":{In:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{In:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(D){if(D.configuration&&D.configuration.cases){const l=D.configuration.cases.value;if(!l.every((D=>"number"===typeof D&&/^-?\d+$/.test(D.toString()))))return F.d.Warn("Switch cases should be integers. Using empty array instead."),D.configuration.cases.value=[],{valid:!0};const G=new Set(l);D.configuration.cases.value=Array.from(G)}return{valid:!0}},extraProcessor(D,l,G,V,N){if("flow/switch"!==l.op||!D.flows||0===Object.keys(D.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return N[0].signalOutputs.forEach((D=>{"default"!==D.name&&(D.name="out_"+D.name)})),N}},"flow/while":{In:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{In:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(D,l,G,V,N){const M=N[0];return M.config||(M.config={}),M.config.incrementIndexWhenLoopDone=!0,N}},"flow/doN":{In:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{In:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(D,l,G,V,N){if("flow/multiGate"!==l.op||!D.flows||0===Object.keys(D.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const M=N[0];return M.config||(M.config={}),M.config.outputSignalCount=Object.keys(D.flows).length,M.signalOutputs.forEach(((D,l)=>{D.name="out_"+l})),N}},"flow/waitAll":{In:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(D){var l,G;return"number"!==typeof(null===(l=D.configuration)||void 0===l||null===(G=l.inputFlows)||void 0===G?void 0:G.value[0])&&(D.configuration=D.configuration||{inputFlows:{value:[0]}},D.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{In:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{In:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{In:["FlowGraphCancelDelayBlock"]},"variable/get":{In:["FlowGraphGetVariableBlock"],validation(D){var l,G;return null!==(l=D.configuration)&&void 0!==l&&null!==(G=l.variable)&&void 0!==G&&G.value?{valid:!0}:(F.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(D,l)=>[l.getVariableName(D[0])]}}},"variable/set":{In:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(D,l)=>[l.getVariableName(D[0])]}}},"variable/setMultiple":{In:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(D,l)=>[D[0].map((D=>l.getVariableName(D)))]}},extraProcessor:(D,l,G,V,N)=>(N[0].dataInputs.forEach((D=>{D.name=V.getVariableName(+D.name)})),N)},"variable/interpolate":{In:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(D,l)=>[l.getVariableName(D[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:D=>!0===D[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",hG:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",hG:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",hG:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",hG:"FlowGraphPlayAnimationBlock"},out:{name:"out",hG:"FlowGraphPlayAnimationBlock"},done:{name:"done",hG:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(D,l,G,V,N){var M,b,X;const t=N[0],R=null===(M=D.configuration)||void 0===M?void 0:M.variable.value[0];if("number"!==typeof R)throw F.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const n=V.arrays.staticVariables[R];"undefined"===typeof t.config.animationType.value&&(V.arrays.staticVariables,t.config.animationType.value=(0,xG.x)(n.type));const g=N[4];return g.config||(g.config={}),(b=g.config).variable||(b.variable={}),g.config.variable.value=V.getVariableName(R),(X=N[3]).config||(X.config={}),N}},"pointer/get":{In:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",hG:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",hG:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(D,l,G,V,N)=>(N.forEach((D=>{"FlowGraphJsonPointerParserBlock"===D.className&&(D.config||(D.config={}),D.config.outputValue=!0)})),N)},"pointer/set":{In:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",hG:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",hG:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(D,l,G,V,N)=>(N.forEach((D=>{"FlowGraphJsonPointerParserBlock"===D.className&&(D.config||(D.config={}),D.config.outputValue=!0)})),N)},"pointer/interpolate":{In:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",hG:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",hG:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",hG:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",hG:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",hG:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",hG:"FlowGraphPlayAnimationBlock"},out:{name:"out",hG:"FlowGraphPlayAnimationBlock"},done:{name:"done",hG:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(D,l,G,V,N)=>(N.forEach((l=>{"FlowGraphJsonPointerParserBlock"===l.className?(l.config||(l.config={}),l.config.outputValue=!0):"FlowGraphInterpolationBlock"===l.className&&(l.config||(l.config={}),Object.keys(D.values||[]).forEach((G=>{var N;const M=null===(N=D.values)||void 0===N?void 0:N[G];if("value"===G&&M){const D=M.type;void 0!==D&&(l.config.animationType=V.arrays.types[D].flowGraphType)}})))})),N)},"animation/start":{In:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",hG:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(D,l)=>[D[0]*l._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(D,l)=>[D[0]*l._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(D,l,G,V,N,M,b){const X=N[N.length-1];return X.config||(X.config={}),X.config.glTF=b,N}},"animation/stop":{In:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",hG:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(D,l,G,V,N,M,b){const X=N[N.length-1];return X.config||(X.config={}),X.config.glTF=b,N}},"animation/stopAt":{In:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",hG:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(D,l)=>[D[0]*l._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(D,l,G,V,N,M,b){const X=N[N.length-1];return X.config||(X.config={}),X.config.glTF=b,N}},"math/switch":{In:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(D){if(D.configuration&&D.configuration.cases){const l=D.configuration.cases.value;if(!l.every((D=>"number"===typeof D&&/^-?\d+$/.test(D.toString()))))return F.d.Warn("Switch cases should be integers. Using empty array instead."),D.configuration.cases.value=[],{valid:!0};const G=new Set(l);D.configuration.cases.value=Array.from(G)}return{valid:!0}},extraProcessor(D,l,G,V,N){const M=N[0];return M.dataInputs.forEach((D=>{"default"!==D.name&&"case"!==D.name&&(D.name="in_"+D.name)})),M.config||(M.config={}),M.config.treatCasesAsIntegers=!0,N}},"debug/log":{In:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function OG(D){let l=arguments.length>2?arguments[2]:void 0;return{In:[D],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((D,l)=>(D[l]={name:l},D)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(D,G,V,N,M){var b;if(l){(b=M[0]).config||(b.config={}),M[0].config.preventIntegerFloatArithmetic=!0;let l=-1;Object.keys(D.values||{}).find((G=>{var V;return void 0!==(null===(V=D.values)||void 0===V?void 0:V[G].type)&&(l=D.values[G].type,!0)})),-1!==l&&(M[0].config.type=N.arrays.types[l].flowGraphType)}return M},validation:D=>l?sG(D):{valid:!0}}}function sG(D){if(D.values){const l=Object.keys(D.values).map((l=>D.values[l].type)).filter((D=>void 0!==D));if(!l.every((D=>D===l[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}SG["math/compose"]=SG["math/matCompose"],SG["math/decompose"]=SG["math/matDecompose"];var UG=G(11672);const fG={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Kl",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class qG{constructor(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=D,this._gltf=l,this._animationTargetFps=G,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const D of this._interactivityGraph.types)this._types.push(fG[D.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const D of this._interactivityGraph.declarations){const l=WG(D);if(!l)throw F.d.Error(["No mapping found for declaration",D]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:l,fullOperationName:D.extension?D.op+":"+D.extension:D.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const D of this._interactivityGraph.variables){const l=this._parseVariable(D);this._staticVariables.push(l)}}_parseVariable(D,l){const G=this._types[D.type];if(!G)throw F.d.Error(["No type found for variable",D]),new Error("Error parsing variables");if(D.value&&D.value.length!==G.length)throw F.d.Error(["Invalid value length for variable",D,G]),new Error("Error parsing variables");const V=D.value||[];if(!V.length)switch(G.flowGraphType){case"boolean":V.push(!1);break;case"FlowGraphInteger":V.push(0);break;case"number":V.push(NaN);break;case"Vector2":V.push(NaN,NaN);break;case"Kl":V.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":V.fill(NaN,0,4);break;case"Matrix":V.fill(NaN,0,16);break;case"Matrix3D":V.fill(NaN,0,9)}return"number"===G.elementType&&"string"===typeof V[0]&&(V[0]=parseFloat(V[0])),{type:G.flowGraphType,value:l?l(V,this):V}}_parseEvents(){if(this._interactivityGraph.events)for(const D of this._interactivityGraph.events){const l={eventId:D.id||"internalEvent_"+this._internalEventsCounter++};D.values&&(l.eventData=Object.keys(D.values).map((l=>{var G;const V=null===(G=D.values)||void 0===G?void 0:G[l];if(!V)throw F.d.Error(["No value found for event key",l]),new Error("Error parsing events");const N=this._types[V.type];if(!N)throw F.d.Error(["No type found for event value",V]),new Error("Error parsing events");const M="undefined"!==typeof V.value?this._parseVariable(V):void 0;return{id:l,type:N.flowGraphType,eventData:!0,value:M}}))),this._events.push(l)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const l of this._interactivityGraph.nodes){if("number"!==typeof l.declaration)throw F.d.Error(["No declaration found for node",l]),new Error("Error parsing nodes");const G=this._mappings[l.declaration];if(!G)throw F.d.Error(["No mapping found for node",l]),new Error("Error parsing nodes");if(G.flowGraphMapping.validation){const V=G.flowGraphMapping.validation(l,this._interactivityGraph,this._gltf);var D;if(!V.valid)throw new Error(`Error validating interactivity node ${null===(D=this._interactivityGraph.declarations)||void 0===D?void 0:D[l.declaration].op} - ${V.error}`)}const V=[];for(const D of G.flowGraphMapping.In){const N=this._getEmptyBlock(D,G.fullOperationName);this._parseNodeConfiguration(l,N,G.flowGraphMapping,D),V.push(N)}this._nodes.push({In:V,fullOperationName:G.fullOperationName})}}_getEmptyBlock(D,l){return{uniqueId:(0,UG.c)(),className:D,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:l,metadata:{}}}_parseNodeConfiguration(D,l,G,V){const N=l.config;if(D.configuration){const l=Object.keys(D.configuration);for(const X of l){var M,b;const l=null===(M=D.configuration)||void 0===M?void 0:M[X];if(!l)throw F.d.Error(["No value found for node configuration",X]),new Error("Error parsing node configuration");const t=null===(b=G.configuration)||void 0===b?void 0:b[X];if(t&&t.hG?t.hG===V:0===G.In.indexOf(V)){const D=(null===t||void 0===t?void 0:t.name)||X;l&&"undefined"!==typeof l.value||"undefined"===typeof(null===t||void 0===t?void 0:t.defaultValue)?l.value.length>=0?N[D]={value:1===l.value.length?l.value[0]:l.value}:F.d.Warn(["Invalid value for node configuration",l]):N[D]={value:t.defaultValue},t&&t.dataTransformer&&(N[D].value=t.dataTransformer([N[D].value],this)[0])}}}}_parseNodeConnections(D){for(let L=0;L<this._nodes.length;L++){var l;const u=null===(l=this._interactivityGraph.nodes)||void 0===l?void 0:l[L];if(!u)throw F.d.Error(["No node found for interactivity node",this._nodes[L]]),new Error("Error parsing node connections");const B=this._nodes[L],I=this._mappings[u.declaration];if(!I)throw F.d.Error(["No mapping found for node",u]),new Error("Error parsing node connections");const W=u.flows||{},i=Object.keys(W).sort();for(const D of i){var G,V,N,M;const l=W[D],R=null===(G=I.flowGraphMapping.outputs)||void 0===G||null===(V=G.flows)||void 0===V?void 0:V[D],n=(null===R||void 0===R?void 0:R.name)||D,g=this._createNewSocketConnection(n,!0);(R&&R.hG&&B.In.find((D=>D.className===R.hG))||B.In[0]).signalOutputs.push(g);const j=l.node,e=this._nodes[j];if(!e)throw F.d.Error(["No node found for input node id",j]),new Error("Error parsing node connections");const K=IG(e.fullOperationName);if(!K)throw F.d.Error(["No mapping found for input node",e]),new Error("Error parsing node connections");let d=null===(N=K.inputs)||void 0===N||null===(M=N.flows)||void 0===M?void 0:M[l.socket||"in"],H=!1;if(!d)for(const D in null===(b=K.inputs)||void 0===b?void 0:b.flows){var b,X,t;if(D.startsWith("[")&&D.endsWith("]"))H=!0,d=null===(X=K.inputs)||void 0===X||null===(t=X.flows)||void 0===t?void 0:t[D]}const h=d?H?d.name.replace("$1",l.socket||""):d.name:l.socket||"in",x=d&&d.hG&&e.In.find((D=>D.className===d.hG))||e.In[0];let r=x.signalInputs.find((D=>D.name===h));r||(r=this._createNewSocketConnection(h),x.signalInputs.push(r)),r.connectedPointIds.push(g.uniqueId),g.connectedPointIds.push(r.uniqueId)}const y=u.values||{},S=Object.keys(y);for(const l of S){var R,n;const G=y[l];let V=null===(R=I.flowGraphMapping.inputs)||void 0===R||null===(n=R.values)||void 0===n?void 0:n[l],N=!1;if(!V)for(const D in null===(g=I.flowGraphMapping.inputs)||void 0===g?void 0:g.values){var g,j,e;if(D.startsWith("[")&&D.endsWith("]"))N=!0,V=null===(j=I.flowGraphMapping.inputs)||void 0===j||null===(e=j.values)||void 0===e?void 0:e[D]}const M=V?N?V.name.replace("$1",l):V.name:l,b=this._createNewSocketConnection(M);if((V&&V.hG&&B.In.find((D=>D.className===V.hG))||B.In[0]).dataInputs.push(b),void 0!==G.value){const l=this._parseVariable(G,V&&V.dataTransformer);D._connectionValues[b.uniqueId]=l}else{if("undefined"===typeof G.node)throw F.d.Error(["Invalid value for value connection",G]),new Error("Error parsing node connections");{var K,d,H;const D=G.node,l=G.socket||"value",V=this._nodes[D];if(!V)throw F.d.Error(["No node found for output socket reference",G]),new Error("Error parsing node connections");const N=IG(V.fullOperationName);if(!N)throw F.d.Error(["No mapping found for output socket reference",G]),new Error("Error parsing node connections");let M=null===(K=N.outputs)||void 0===K||null===(d=K.values)||void 0===d?void 0:d[l],X=!1;if(!M)for(const G in null===(h=N.outputs)||void 0===h?void 0:h.values){var h,x,r;if(G.startsWith("[")&&G.endsWith("]"))X=!0,M=null===(x=N.outputs)||void 0===x||null===(r=x.values)||void 0===r?void 0:r[G]}const t=M?X?M.name.replace("$1",l):null===(H=M)||void 0===H?void 0:H.name:l,R=M&&M.hG&&V.In.find((D=>D.className===M.hG))||V.In[0];let n=R.dataOutputs.find((D=>D.name===t));n||(n=this._createNewSocketConnection(t,!0),R.dataOutputs.push(n)),b.connectedPointIds.push(n.uniqueId),n.connectedPointIds.push(b.uniqueId)}}}if(I.flowGraphMapping.interBlockConnectors)for(const D of I.flowGraphMapping.interBlockConnectors){const l=D.input,G=D.output,V=D.isVariable;this._connectFlowGraphNodes(l,G,B.In[D.inputBlockIndex],B.In[D.outputBlockIndex],V)}if(I.flowGraphMapping.extraProcessor){var o;const l=null===(o=this._interactivityGraph.declarations)||void 0===o?void 0:o[u.declaration];if(!l)throw F.d.Error(["No declaration found for extra processor",u]),new Error("Error parsing node connections");B.In=I.flowGraphMapping.extraProcessor(u,l,I.flowGraphMapping,this,B.In,D,this._gltf)}}}_createNewSocketConnection(D,l){return{uniqueId:(0,UG.c)(),name:D,_connectionType:l?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(D,l,G,V,N){const M=N?G.dataInputs:G.signalInputs,b=N?V.dataOutputs:V.signalOutputs,X=M.find((l=>l.name===D))||this._createNewSocketConnection(D),t=b.find((D=>D.name===l))||this._createNewSocketConnection(l,!0);M.find((l=>l.name===D))||M.push(X),b.find((D=>D.name===l))||b.push(t),X.connectedPointIds.push(t.uniqueId),t.connectedPointIds.push(X.uniqueId)}getVariableName(D){return"staticVariable_"+D}serializeToFlowGraph(){const D={uniqueId:(0,UG.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(D);for(let l=0;l<this._staticVariables.length;l++){const G=this._staticVariables[l];D._userVariables[this.getVariableName(l)]=G}return{rightHanded:!0,allBlocks:this._nodes.reduce(((D,l)=>D.concat(l.In)),[]),executionContexts:[D]}}}const cG="KHR_interactivity";class vG{constructor(D){this._loader=D,this.name=cG,this.enabled=this._loader.isExtensionUsed(cG),this._pathConverter=(0,Z.l)(this._loader.bb),D._skipStartAnimationStep=!0;const l=D.babylonScene;l&&function(D){(0,Z.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!D.activeCamera)return new N.Quaternion(NaN,NaN,NaN,NaN);const l=N.Quaternion.FromRotationMatrix(D.activeCamera.getWorldMatrix()).normalize();return D.useRightHandedSystem||(l.w*=-1,l.x*=-1),l},type:"Quaternion",getTarget:()=>D.activeCamera}),(0,Z.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!D.activeCamera)return new N.Kl(NaN,NaN,NaN);const l=D.activeCamera.getWorldMatrix().getTranslation();return D.useRightHandedSystem||(l.x*=-1),l},type:"Kl",getTarget:()=>D.activeCamera}),(0,Z.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:D=>{var l;return(null===(l=D._babylonAnimationGroup)||void 0===l?void 0:l.isPlaying)??!1},type:"boolean",getTarget:D=>D._babylonAnimationGroup}),(0,Z.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:D=>{var l;return((null===(l=D._babylonAnimationGroup)||void 0===l?void 0:l.from)??0)/60},type:"number",getTarget:D=>D._babylonAnimationGroup}),(0,Z.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:D=>{var l;return((null===(l=D._babylonAnimationGroup)||void 0===l?void 0:l.to)??0)/60},type:"number",getTarget:D=>D._babylonAnimationGroup}),(0,Z.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:D=>{var l;return((null===(l=D._babylonAnimationGroup)||void 0===l?void 0:l.getCurrentFrame())??0)/60},type:"number",getTarget:D=>D._babylonAnimationGroup}),(0,Z.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:D=>{var l;return((null===(l=D._babylonAnimationGroup)||void 0===l?void 0:l.getCurrentFrame())??0)/60},type:"number",getTarget:D=>D._babylonAnimationGroup})}(l)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var D;if(!this._loader.babylonScene||!this._pathConverter)return;const l=this._loader.babylonScene,G=null===(D=this._loader.bb.extensions)||void 0===D?void 0:D.KHR_interactivity;if(!G)return;const V=new KG.b({dl:l});V.dispatchEventsSynchronously=!1;const N=G.graphs.map((D=>new qG(D,this._loader.bb,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(N.map((async D=>await LG(D,{coordinator:V,pathConverter:this._pathConverter})))),V.start()}}var ZG;ZG=async()=>(await Promise.resolve().then(G.bind(G,13472))).FlowGraphGLTFDataProvider,FG[`${cG}/${"FlowGraphGLTFDataProvider"}`]=ZG,v(cG),c(cG,!0,(D=>new vG(D)));const JG="KHR_node_visibility";(0,Z.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:D=>{const l=D._babylonTransformNode;return!l||void 0===l.isVisible||l.isVisible},set:(D,l)=>{var G,V;null===(G=l._primitiveBabylonMeshes)||void 0===G||G.forEach((D=>{D.inheritVisibility=!0})),l._babylonTransformNode&&(l._babylonTransformNode.isVisible=D),null===(V=l._primitiveBabylonMeshes)||void 0===V||V.forEach((l=>{l.isVisible=D}))},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class YG{constructor(D){this.name=JG,this._loader=D,this.enabled=D.isExtensionUsed(JG)}async onReady(){var D;null===(D=this._loader.bb.nodes)||void 0===D||D.forEach((D=>{var l,G,V,N;(null===(l=D._primitiveBabylonMeshes)||void 0===l||l.forEach((D=>{D.inheritVisibility=!0})),null!==(G=D.extensions)&&void 0!==G&&G.KHR_node_visibility)&&(!1===(null===(V=D.extensions)||void 0===V?void 0:V.KHR_node_visibility.visible)&&(D._babylonTransformNode&&(D._babylonTransformNode.isVisible=!1),null===(N=D._primitiveBabylonMeshes)||void 0===N||N.forEach((D=>{D.isVisible=!1}))))}))}dispose(){this._loader=null}}v(JG),c(JG,!0,(D=>new YG(D)));const zG="KHR_node_selectability";iG("event/onSelect",zG,{In:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",hG:"FlowGraphGetVariableBlock",dataTransformer:D=>["pickedMesh_"+D[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",hG:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(D,l,G,V,N,M,b){var X,t,R,n,g,j;const e=N[N.length-1];e.config=e.config||{},e.config.glTF=b;const K=null===(X=D.configuration)||void 0===X||null===(t=X.nodeIndex)||void 0===t?void 0:t.value[0];if(void 0===K||"number"!==typeof K)throw new Error("nodeIndex not found in configuration");const F="pickedMesh_"+K;return N[1].config.variable=F,M._userVariables[F]={className:"Mesh",id:null===b||void 0===b||null===(R=b.nodes)||void 0===R||null===(n=R[K]._babylonTransformNode)||void 0===n?void 0:n.id,uniqueId:null===b||void 0===b||null===(g=b.nodes)||void 0===g||null===(j=g[K]._babylonTransformNode)||void 0===j?void 0:j.uniqueId},N}}),(0,Z.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:D=>{const l=D._babylonTransformNode;return!l||void 0===l.Ct||l.Ct},set:(D,l)=>{var G;null===(G=l._primitiveBabylonMeshes)||void 0===G||G.forEach((l=>{l.Ct=D}))},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"Ct"],type:"boolean"});class EG{constructor(D){this.name=zG,this._loader=D,this.enabled=D.isExtensionUsed(zG)}async onReady(){var D;null===(D=this._loader.bb.nodes)||void 0===D||D.forEach((D=>{var l,G,V;null!==(l=D.extensions)&&void 0!==l&&l.KHR_node_selectability&&!1===(null===(G=D.extensions)||void 0===G?void 0:G.KHR_node_selectability.selectable)&&(null===(V=D._babylonTransformNode)||void 0===V||V.getChildMeshes().forEach((D=>{D.Ct=!1})))}))}dispose(){this._loader=null}}v(zG),c(zG,!0,(D=>new EG(D)));const PG="KHR_node_hoverability",pG="targetMeshPointerOver_";iG("event/onHoverIn",PG,{In:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",hG:"FlowGraphGetVariableBlock",dataTransformer:D=>[pG+D[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",hG:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(D,l,G,V,N,M,b){var X,t,R,n,g,j;const e=N[N.length-1];e.config=e.config||{},e.config.glTF=b;const K=null===(X=D.configuration)||void 0===X||null===(t=X.nodeIndex)||void 0===t?void 0:t.value[0];if(void 0===K||"number"!==typeof K)throw new Error("nodeIndex not found in configuration");const F=pG+K;return N[1].config.variable=F,M._userVariables[F]={className:"Mesh",id:null===b||void 0===b||null===(R=b.nodes)||void 0===R||null===(n=R[K]._babylonTransformNode)||void 0===n?void 0:n.id,uniqueId:null===b||void 0===b||null===(g=b.nodes)||void 0===g||null===(j=g[K]._babylonTransformNode)||void 0===j?void 0:j.uniqueId},N}});const kG="targetMeshPointerOut_";iG("event/onHoverOut",PG,{In:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",hG:"FlowGraphGetVariableBlock",dataTransformer:D=>[kG+D[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",hG:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(D,l,G,V,N,M,b){var X,t,R,n,g,j;const e=N[N.length-1];e.config=e.config||{},e.config.glTF=b;const K=null===(X=D.configuration)||void 0===X||null===(t=X.nodeIndex)||void 0===t?void 0:t.value[0];if(void 0===K||"number"!==typeof K)throw new Error("nodeIndex not found in configuration");const F=kG+K;return N[1].config.variable=F,M._userVariables[F]={className:"Mesh",id:null===b||void 0===b||null===(R=b.nodes)||void 0===R||null===(n=R[K]._babylonTransformNode)||void 0===n?void 0:n.id,uniqueId:null===b||void 0===b||null===(g=b.nodes)||void 0===g||null===(j=g[K]._babylonTransformNode)||void 0===j?void 0:j.uniqueId},N}}),(0,Z.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:D=>{const l=D._babylonTransformNode;return!l||void 0===l.pointerOverDisableMeshTesting||l.pointerOverDisableMeshTesting},set:(D,l)=>{var G;null===(G=l._primitiveBabylonMeshes)||void 0===G||G.forEach((l=>{l.pointerOverDisableMeshTesting=!D}))},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class mG{constructor(D){this.name=PG,this._loader=D,this.enabled=D.isExtensionUsed(PG)}async onReady(){var D;null===(D=this._loader.bb.nodes)||void 0===D||D.forEach((D=>{var l,G,V;null!==(l=D.extensions)&&void 0!==l&&l.KHR_node_hoverability&&!1===(null===(G=D.extensions)||void 0===G?void 0:G.KHR_node_hoverability.hoverable)&&(null===(V=D._babylonTransformNode)||void 0===V||V.getChildMeshes().forEach((D=>{D.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}v(PG),c(PG,!0,(D=>new mG(D)));const TG="ExtrasAsMetadata";class CG{_assignExtras(D,l){if(l.extras&&Object.keys(l.extras).length>0){const G=D.metadata=D.metadata||{};(G.bb=G.bb||{}).extras=l.extras}}constructor(D){this.name=TG,this.enabled=!0,this._loader=D}dispose(){this._loader=null}loadNodeAsync(D,l,G){return this._loader.loadNodeAsync(D,l,(D=>{this._assignExtras(D,l),G(D)}))}loadCameraAsync(D,l,G){return this._loader.loadCameraAsync(D,l,(D=>{this._assignExtras(D,l),G(D)}))}createMaterial(D,l,G){const V=this._loader.createMaterial(D,l,G);return this._assignExtras(V,l),V}}v(TG),c(TG,!1,(D=>new CG(D)));G(13472)},13355:(D,l,G)=>{"use strict";G.d(l,{d:()=>s,h:()=>I,k:()=>B,m:()=>W});var V=G(11532),N=G(11530),M=G(12994),b=G(12173),X=G(12141),t=G(12149),R=G(11546),n=G(11571),g=G(12171),j=G(12265),e=G(12175),K=G(11746);class F{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.xj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.le=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(D){this._environmentTexture=D}getNodes(){let D=[];D=D.concat(this.meshes),D=D.concat(this.lights),D=D.concat(this.cameras),D=D.concat(this.transformNodes);for(const l of this.skeletons)D=D.concat(l.bones);return D}}class d extends F{}class H{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const D=this.rootNodes;for(const V of D)V.dispose();D.length=0;const l=this.skeletons;for(const V of l)V.dispose();l.length=0;const G=this.animationGroups;for(const V of G)V.dispose();G.length=0}}class h extends F{constructor(D){super(),this._wasAddedToScene=!1,(D=D||n.d.LastCreatedScene)&&(this.dl=D,this.proceduralTextures=[],D.Vb.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=D.getEngine().onContextRestoredObservable.add((()=>{for(const D of this.geometries)D._rebuild();for(const D of this.meshes)D._rebuild();for(const D of this.xj)D.rebuild();for(const D of this.textures)D._rebuild()})))}_topologicalSort(D){const l=new Map;for(const b of D)l.set(b.uniqueId,b);const G={dependsOn:new Map,dependedBy:new Map};for(const b of D){const D=b.uniqueId;G.dependsOn.set(D,new Set),G.dependedBy.set(D,new Set)}for(const b of D){const D=b.uniqueId,V=G.dependsOn.get(D);if(b instanceof g.e){const N=b.sourceMesh;l.has(N.uniqueId)&&(V.add(N.uniqueId),G.dependedBy.get(N.uniqueId).add(D))}const N=G.dependedBy.get(D);for(const M of b.getDescendants()){const V=M.uniqueId;if(l.has(V)){N.add(V);G.dependsOn.get(V).add(D)}}}const V=[],N=[];for(const b of D){const D=b.uniqueId;0===G.dependsOn.get(D).size&&(N.push(b),l.delete(D))}const M=N;for(;M.length>0;){const D=M.shift();V.push(D);const N=G.dependedBy.get(D.uniqueId);for(const V of Array.from(N.values())){const N=G.dependsOn.get(V);N.delete(D.uniqueId),0===N.size&&l.get(V)&&(M.push(l.get(V)),l.delete(V))}}return l.size>0&&(R.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),l.forEach((D=>{R.d.Error(D.name)}))),V}_addNodeAndDescendantsToList(D,l,G,V){if(G&&(!V||V(G))&&!l.has(G.uniqueId)){D.push(G),l.add(G.uniqueId);for(const N of G.getDescendants(!0))this._addNodeAndDescendantsToList(D,l,N,V)}}_isNodeInContainer(D){return D instanceof t.d&&-1!==this.meshes.indexOf(D)||(D instanceof X.d&&-1!==this.transformNodes.indexOf(D)||(D instanceof j.c&&-1!==this.lights.indexOf(D)||D instanceof e.e&&-1!==this.cameras.indexOf(D)))}_isValidHierarchy(){for(const D of this.meshes)if(D.parent&&!this._isNodeInContainer(D.parent))return R.d.Warn(`Node ${D.name} has a parent that is not in the container.`),!1;for(const D of this.transformNodes)if(D.parent&&!this._isNodeInContainer(D.parent))return R.d.Warn(`Node ${D.name} has a parent that is not in the container.`),!1;for(const D of this.lights)if(D.parent&&!this._isNodeInContainer(D.parent))return R.d.Warn(`Node ${D.name} has a parent that is not in the container.`),!1;for(const D of this.cameras)if(D.parent&&!this._isNodeInContainer(D.parent))return R.d.Warn(`Node ${D.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(D){let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],G=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||N.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const V={},M={},X=new H,t=[],R=[],n={doNotInstantiate:!0,...G},g=[],j=new Set;for(const N of this.transformNodes)null===N.parent&&this._addNodeAndDescendantsToList(g,j,N,n.predicate);for(const N of this.meshes)null===N.parent&&this._addNodeAndDescendantsToList(g,j,N,n.predicate);const e=this._topologicalSort(g),K=(G,N)=>{if(((l,G)=>{if(V[l.uniqueId]=G.uniqueId,M[G.uniqueId]=G,D&&(G.name=D(l.name)),G instanceof b.b){const D=G;if(D.morphTargetManager){const G=l.morphTargetManager;D.morphTargetManager=G.clone();for(let l=0;l<G.numTargets;l++){const N=G.getTarget(l),b=D.morphTargetManager.getTarget(l);V[N.uniqueId]=b.uniqueId,M[b.uniqueId]=b}}}})(G,N),G.parent){const D=V[G.parent.uniqueId],l=M[D];N.parent=l||G.parent}if(N.position&&G.position&&N.position.V(G.position),N.rotationQuaternion&&G.rotationQuaternion&&N.rotationQuaternion.V(G.rotationQuaternion),N.rotation&&G.rotation&&N.rotation.V(G.rotation),N.ub&&G.ub&&N.ub.V(G.ub),N.material){const b=N;if(b.material)if(l){const l=G.material;if(-1===R.indexOf(l)){let G=l.clone(D?D(l.name):"Clone of "+l.name);if(R.push(l),V[l.uniqueId]=G.uniqueId,M[G.uniqueId]=G,"MultiMaterial"===l.getClassName()){const N=l;for(const l of N.ib)l&&(G=l.clone(D?D(l.name):"Clone of "+l.name),R.push(l),V[l.uniqueId]=G.uniqueId,M[G.uniqueId]=G);N.ib=N.ib.map((D=>D&&M[V[D.uniqueId]]))}}"InstancedMesh"!==b.getClassName()&&(b.material=M[V[l.uniqueId]])}else"MultiMaterial"===b.material.getClassName()?-1===this.dl.multiMaterials.indexOf(b.material)&&this.dl.addMultiMaterial(b.material):-1===this.dl.materials.indexOf(b.material)&&this.dl.addMaterial(b.material)}null===N.parent&&X.rootNodes.push(N)};for(const N of e)if("InstancedMesh"===N.getClassName()){const D=N,l=D.sourceMesh,G=V[l.uniqueId];K(D,("number"===typeof G?M[G]:l).createInstance(D.name))}else{let D=!0;"qb"===N.getClassName()||"Node"===N.getClassName()||N.skeleton||!N.getTotalVertices||0===N.getTotalVertices()?D=!1:n.doNotInstantiate&&(D="function"===typeof n.doNotInstantiate?!n.doNotInstantiate(N):!n.doNotInstantiate);const l=D?N.createInstance(`instance of ${N.name}`):N.clone(`Clone of ${N.name}`,null,!0);if(!l)throw new Error(`Could not clone or instantiate node on Asset Container ${N.name}`);K(N,l)}for(const N of this.skeletons){if(n.predicate&&!n.predicate(N))continue;const l=N.clone(D?D(N.name):"Clone of "+N.name);for(const D of this.meshes)if(D.skeleton===N&&!D.isAnInstance){const G=M[V[D.uniqueId]];if(!G||G.isAnInstance)continue;if(G.skeleton=l,-1!==t.indexOf(l))continue;t.push(l);for(const D of l.bones)D._linkedTransformNode&&(D._linkedTransformNode=M[V[D._linkedTransformNode.uniqueId]])}X.skeletons.push(l)}for(const N of this.animationGroups){if(n.predicate&&!n.predicate(N))continue;const l=N.clone(D?D(N.name):"Clone of "+N.name,(D=>M[V[D.uniqueId]]||D));X.animationGroups.push(l)}return X}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||N.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.dl.environmentTexture=this.environmentTexture);for(const D of this.dl._serializableComponents)D.addFromContainer(this);this.dl.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const l=[];for(const G of this.cameras)D&&!D(G)||(this.dl.addCamera(G),l.push(G));for(const G of this.lights)D&&!D(G)||(this.dl.addLight(G),l.push(G));for(const G of this.meshes)D&&!D(G)||(this.dl.jn(G),l.push(G));for(const G of this.skeletons)D&&!D(G)||this.dl.addSkeleton(G);for(const G of this.animations)D&&!D(G)||this.dl.addAnimation(G);for(const G of this.animationGroups)D&&!D(G)||this.dl.addAnimationGroup(G);for(const G of this.multiMaterials)D&&!D(G)||this.dl.addMultiMaterial(G);for(const G of this.materials)D&&!D(G)||this.dl.addMaterial(G);for(const G of this.morphTargetManagers)D&&!D(G)||this.dl.addMorphTargetManager(G);for(const G of this.geometries)D&&!D(G)||this.dl.addGeometry(G);for(const G of this.transformNodes)D&&!D(G)||(this.dl.addTransformNode(G),l.push(G));for(const G of this.actionManagers)D&&!D(G)||this.dl.addActionManager(G);for(const G of this.textures)D&&!D(G)||this.dl.addTexture(G);for(const G of this.reflectionProbes)D&&!D(G)||this.dl.addReflectionProbe(G);for(const G of l)G.parent&&-1===this.dl.getNodes().indexOf(G.parent)&&(G.setParent?G.setParent(null):G.parent=null)}removeAllFromScene(){this._isValidHierarchy()||N.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.dl.environmentTexture&&(this.dl.environmentTexture=null);for(const D of this.dl._serializableComponents)D.removeFromContainer(this)}removeFromScene(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const l of this.cameras)D&&!D(l)||this.dl.removeCamera(l);for(const l of this.lights)D&&!D(l)||this.dl.removeLight(l);for(const l of this.meshes)D&&!D(l)||this.dl.gn(l,!0);for(const l of this.skeletons)D&&!D(l)||this.dl.removeSkeleton(l);for(const l of this.animations)D&&!D(l)||this.dl.removeAnimation(l);for(const l of this.animationGroups)D&&!D(l)||this.dl.removeAnimationGroup(l);for(const l of this.multiMaterials)D&&!D(l)||this.dl.removeMultiMaterial(l);for(const l of this.materials)D&&!D(l)||this.dl.removeMaterial(l);for(const l of this.morphTargetManagers)D&&!D(l)||this.dl.removeMorphTargetManager(l);for(const l of this.geometries)D&&!D(l)||this.dl.removeGeometry(l);for(const l of this.transformNodes)D&&!D(l)||this.dl.removeTransformNode(l);for(const l of this.actionManagers)D&&!D(l)||this.dl.removeActionManager(l);for(const l of this.textures)D&&!D(l)||this.dl.removeTexture(l);for(const l of this.reflectionProbes)D&&!D(l)||this.dl.removeReflectionProbe(l)}dispose(){const D=this.cameras.slice(0);for(const e of D)e.dispose();this.cameras.length=0;const l=this.lights.slice(0);for(const e of l)e.dispose();this.lights.length=0;const G=this.meshes.slice(0);for(const e of G)e.dispose();this.meshes.length=0;const V=this.skeletons.slice(0);for(const e of V)e.dispose();this.skeletons.length=0;const N=this.animationGroups.slice(0);for(const e of N)e.dispose();this.animationGroups.length=0;const M=this.multiMaterials.slice(0);for(const e of M)e.dispose();this.multiMaterials.length=0;const b=this.materials.slice(0);for(const e of b)e.dispose();this.materials.length=0;const X=this.geometries.slice(0);for(const e of X)e.dispose();this.geometries.length=0;const t=this.transformNodes.slice(0);for(const e of t)e.dispose();this.transformNodes.length=0;const R=this.actionManagers.slice(0);for(const e of R)e.dispose();this.actionManagers.length=0;const n=this.textures.slice(0);for(const e of n)e.dispose();this.textures.length=0;const g=this.reflectionProbes.slice(0);for(const e of g)e.dispose();this.reflectionProbes.length=0;const j=this.morphTargetManagers.slice(0);for(const e of j)e.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const e of this.dl._serializableComponents)e.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.dl.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(D,l,G){if(D&&l)for(const V of D){let D=!0;if(G)for(const l of G)if(V===l){D=!1;break}D&&(l.push(V),V._parentContainer=this)}}moveAllFromScene(D){this._wasAddedToScene=!1,void 0===D&&(D=new d);for(const l in this)Object.prototype.hasOwnProperty.call(this,l)&&(this[l]=this[l]||("_environmentTexture"===l?null:[]),this._moveAssets(this.dl[l],this[l],D[l]));this.environmentTexture=this.dl.environmentTexture,this.removeAllFromScene()}createRootMesh(){const D=new b.b("assetContainerRootMesh",this.dl);for(const l of this.meshes)l.parent||D.addChild(l);return this.meshes.unshift(D),D}mergeAnimationsTo(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.d.LastCreatedScene,l=arguments.length>1?arguments[1]:void 0,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!D)return R.d.Error("No scene available to merge animations to"),[];const V=G||(l=>{let G=null;const V=l.animations.length?l.animations[0].targetProperty:"",N=l.name.split(".").join("").split("_primitive")[0];switch(V){case"position":case"rotationQuaternion":G=D.getTransformNodeByName(l.name)||D.getTransformNodeByName(N);break;case"influence":G=D.getMorphTargetByName(l.name)||D.getMorphTargetByName(N);break;default:G=D.getNodeByName(l.name)||D.getNodeByName(N)}return G}),N=this.getNodes();for(const X of N){const D=V(X);if(null!==D){for(const l of X.animations){const G=D.animations.filter((D=>D.targetProperty===l.targetProperty));for(const l of G){const G=D.animations.indexOf(l,0);G>-1&&D.animations.splice(G,1)}}D.animations=D.animations.concat(X.animations)}}const M=[],b=this.animationGroups.slice();for(const X of b){M.push(X.clone(X.name,V));for(const D of X.animatables)D.stop()}for(const X of l){const l=V(X.target);l&&(D.beginAnimation(l,X.fromFrame,X.toFrame,X.loopAnimation,X.speedRatio,X.onAnimationEnd?X.onAnimationEnd:void 0,void 0,!0,void 0,X.onAnimationLoop?X.onAnimationLoop:void 0),D.stopAnimation(X.target))}return M}populateRootNodes(){this.rootNodes.length=0;for(const D of this.meshes)D.parent||-1!==this.rootNodes.indexOf(D)||this.rootNodes.push(D);for(const D of this.transformNodes)D.parent||-1!==this.rootNodes.indexOf(D)||this.rootNodes.push(D);for(const D of this.lights)D.parent||-1!==this.rootNodes.indexOf(D)||this.rootNodes.push(D);for(const D of this.cameras)D.parent||-1!==this.rootNodes.indexOf(D)||this.rootNodes.push(D)}addAllAssetsToContainer(D){if(!D)return;const l=[],G=new Set;for(l.push(D);l.length>0;){const D=l.pop();if(D instanceof b.b?(D.xb&&-1===this.geometries.indexOf(D.xb)&&this.geometries.push(D.xb),this.meshes.push(D)):D instanceof g.e?this.meshes.push(D):D instanceof X.d?this.transformNodes.push(D):D instanceof j.c?this.lights.push(D):D instanceof e.e&&this.cameras.push(D),D instanceof t.d){if(D.material&&-1===this.materials.indexOf(D.material)){this.materials.push(D.material);for(const l of D.material.getActiveTextures())-1===this.textures.indexOf(l)&&this.textures.push(l)}D.skeleton&&-1===this.skeletons.indexOf(D.skeleton)&&this.skeletons.push(D.skeleton),D.morphTargetManager&&-1===this.morphTargetManagers.indexOf(D.morphTargetManager)&&this.morphTargetManagers.push(D.morphTargetManager)}for(const V of D.getChildren())G.has(V)||l.push(V);G.add(D)}this.populateRootNodes()}_getByTags(D,l,G){if(void 0===l)return D;const V=[];for(const N in D){const M=D[N];K.e&&K.e.MatchesQuery(M,l)&&(!G||G(M))&&V.push(M)}return V}getMeshesByTags(D,l){return this._getByTags(this.meshes,D,l)}getCamerasByTags(D,l){return this._getByTags(this.cameras,D,l)}getLightsByTags(D,l){return this._getByTags(this.lights,D,l)}getMaterialsByTags(D,l){return this._getByTags(this.materials,D,l).concat(this._getByTags(this.multiMaterials,D,l))}getTransformNodesByTags(D,l){return this._getByTags(this.transformNodes,D,l)}}var x=G(11587);class r{constructor(D){this.byteOffset=0,this.buffer=D}async loadAsync(D){const l=await this.buffer.readAsync(this.byteOffset,D);this._dataView=new DataView(l.buffer,l.byteOffset,l.byteLength),this._dataByteOffset=0}readUint32(){const D=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,D}readUint8Array(D){const l=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,D);return this._dataByteOffset+=D,this.byteOffset+=D,l}readString(D){return(0,x.i)(this.readUint8Array(D))}skipBytes(D){this._dataByteOffset+=D,this.byteOffset+=D}}var o=G(13361);const L="Z2xURg",u={name:"bb",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:D=>-1!==D.indexOf("asset")&&-1!==D.indexOf("version")||D.startsWith("data:base64,"+L)||D.startsWith("data:;base64,"+L)||D.startsWith("data:application/octet-stream;base64,"+L)||D.startsWith("data:model/gltf-binary;base64,"+L)};var B,I,W,i=G(11573),y=G(11580);function S(D,l,G){try{return Promise.resolve(new Uint8Array(D,l,G))}catch(V){return Promise.reject(V)}}!function(D){D[D.AUTO=0]="AUTO",D[D.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(B||(B={})),function(D){D[D.NONE=0]="NONE",D[D.FIRST=1]="FIRST",D[D.ALL=2]="ALL"}(I||(I={})),function(D){D[D.LOADING=0]="LOADING",D[D.READY=1]="READY",D[D.COMPLETE=2]="COMPLETE"}(W||(W={}));class O{constructor(){this.coordinateSystemMode=B.AUTO,this.animationStartMode=I.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=D=>Promise.resolve(D),this.extensionOptions={}}V(D){D&&(this.onParsed=D.onParsed,this.coordinateSystemMode=D.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=D.animationStartMode??this.animationStartMode,this.loadNodeAnimations=D.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=D.loadSkins??this.loadSkins,this.loadMorphTargets=D.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=D.compileMaterials??this.compileMaterials,this.useClipPlane=D.useClipPlane??this.useClipPlane,this.compileShadowGenerators=D.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=D.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=D.useRangeRequests??this.useRangeRequests,this.createInstances=D.createInstances??this.createInstances,this.alwaysComputeBoundingBox=D.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=D.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=D.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=D.skipMaterials??this.skipMaterials,this.useSRGBBuffers=D.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=D.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=D.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=D.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=D.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=D.customRootNode,this.onMeshLoaded=D.onMeshLoaded,this.onSkinLoaded=D.onSkinLoaded,this.onTextureLoaded=D.onTextureLoaded,this.onMaterialLoaded=D.onMaterialLoaded,this.onCameraLoaded=D.onCameraLoaded,this.extensionOptions=D.extensionOptions??this.extensionOptions)}}class s extends O{constructor(D){super(),this.onParsedObservable=new V.e,this.onMeshLoadedObservable=new V.e,this.onSkinLoadedObservable=new V.e,this.onTextureLoadedObservable=new V.e,this.onMaterialLoadedObservable=new V.e,this.onCameraLoadedObservable=new V.e,this.onCompleteObservable=new V.e,this.onErrorObservable=new V.e,this.Vb=new V.e,this.onExtensionLoadedObservable=new V.e,this.validate=!1,this.onValidatedObservable=new V.e,this._loader=null,this._state=null,this._requests=new Array,this.name=u.name,this.extensions=u.extensions,this.onLoaderStateChangedObservable=new V.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.V(D)}set onParsed(D){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),D&&(this._onParsedObserver=this.onParsedObservable.add(D))}set onMeshLoaded(D){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),D&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(D))}set onSkinLoaded(D){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),D&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((l=>D(l.node,l.skinnedNode))))}set onTextureLoaded(D){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),D&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(D))}set onMaterialLoaded(D){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),D&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(D))}set onCameraLoaded(D){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),D&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(D))}set onComplete(D){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(D)}set onError(D){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(D)}set onDispose(D){this._onDisposeObserver&&this.Vb.remove(this._onDisposeObserver),this._onDisposeObserver=this.Vb.add(D)}set onExtensionLoaded(D){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(D)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(D){this._loggingEnabled!==D&&(this._loggingEnabled=D,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(D){this._capturePerformanceCounters!==D&&(this._capturePerformanceCounters=D,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(D){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(D)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const D of this._requests)D.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=D=>Promise.resolve(D),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Vb.notifyObservers(void 0),this.Vb.clear()}loadFile(D,l,G,M,b,X,t,n){if(ArrayBuffer.isView(l))return this._loadBinary(D,l,G,M,t,n),null;this._progressCallback=b;const g=l.name||N.Tools.GetFilename(l);if(X){if(this.useRangeRequests){this.validate&&R.d.Warn("glTF validation is not supported when range requests are enabled");const G={abort:()=>{},onCompleteObservable:new V.e},N={readAsync:(G,V)=>new Promise(((N,M)=>{this._loadFile(D,l,(D=>{N(new Uint8Array(D))}),!0,(D=>{M(D)}),(D=>{D.setRequestHeader("Range",`bytes=${G}-${G+V-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new r(N)).then((D=>{G.onCompleteObservable.notifyObservers(G),M(D)}),t?D=>t(void 0,D):void 0),G}return this._loadFile(D,l,(l=>{this._validate(D,new Uint8Array(l,0,l.byteLength),G,g),this._unpackBinaryAsync(new r({readAsync:(D,G)=>S(l,D,G),byteLength:l.byteLength})).then((D=>{M(D)}),t?D=>t(void 0,D):void 0)}),!0,t)}return this._loadFile(D,l,(l=>{try{this._validate(D,l,G,g),M({json:this._parseJson(l)})}catch{t&&t()}}),!1,t)}_loadBinary(D,l,G,V,N,M){this._validate(D,new Uint8Array(l.buffer,l.byteOffset,l.byteLength),G,M),this._unpackBinaryAsync(new r({readAsync:(D,G)=>function(D,l,G){try{if(l<0||l>=D.byteLength)throw new RangeError("Offset is out of range.");if(l+G>D.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(D.buffer,D.byteOffset+l,G))}catch(V){return Promise.reject(V)}}(l,D,G),byteLength:l.byteLength})).then((D=>{V(D)}),N?D=>N(void 0,D):void 0)}importMeshAsync(D,l,G,V,N,M){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(G),this.onParsedObservable.clear(),this._log(`Loading ${M||""}`),this._loader=this._getLoader(G),this._loader.importMeshAsync(D,l,null,G,V,N,M))))}loadAsync(D,l,G,V,N){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(l),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(l),this._loader.loadAsync(D,l,G,V,N))))}loadAssetContainerAsync(D,l,G,V,N){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(l),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(l);const M=new h(D),b=[];this.onMaterialLoadedObservable.add((D=>{b.push(D)}));const X=[];this.onTextureLoadedObservable.add((D=>{X.push(D)}));const t=[];this.onCameraLoadedObservable.add((D=>{t.push(D)}));const R=[];return this.onMeshLoadedObservable.add((D=>{D.morphTargetManager&&R.push(D.morphTargetManager)})),this._loader.importMeshAsync(null,D,M,l,G,V,N).then((D=>(Array.prototype.push.apply(M.geometries,D.geometries),Array.prototype.push.apply(M.meshes,D.meshes),Array.prototype.push.apply(M.xj,D.xj),Array.prototype.push.apply(M.skeletons,D.skeletons),Array.prototype.push.apply(M.animationGroups,D.animationGroups),Array.prototype.push.apply(M.materials,b),Array.prototype.push.apply(M.textures,X),Array.prototype.push.apply(M.lights,D.lights),Array.prototype.push.apply(M.transformNodes,D.transformNodes),Array.prototype.push.apply(M.cameras,t),Array.prototype.push.apply(M.morphTargetManagers,R),M)))}))}canDirectLoad(D){return u.canDirectLoad(D)}directLoad(D,l){if(l.startsWith("base64,"+L)||l.startsWith(";base64,"+L)||l.startsWith("application/octet-stream;base64,"+L)||l.startsWith("model/gltf-binary;base64,"+L)){const G=(0,i.b)(l);return this._validate(D,new Uint8Array(G,0,G.byteLength)),this._unpackBinaryAsync(new r({readAsync:(D,l)=>S(G,D,l),byteLength:G.byteLength}))}return this._validate(D,l),Promise.resolve({json:this._parseJson(l)})}createPlugin(D){return new s(D[u.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((D,l)=>{this.onCompleteObservable.addOnce((()=>{D()})),this.onErrorObservable.addOnce((D=>{l(D)}))}))}_setState(D){this._state!==D&&(this._state=D,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(W[this._state]))}_loadFile(D,l,G,V,N,M){const b=D._loadFile(l,G,(D=>{this._onProgress(D,b)}),!0,V,N,M);return b.onCompleteObservable.add((()=>{b._lengthComputable=!0,b._total=b._loaded})),this._requests.push(b),b}_onProgress(D,l){if(!this._progressCallback)return;l._lengthComputable=D.lengthComputable,l._loaded=D.loaded,l._total=D.total;let G=!0,V=0,N=0;for(const M of this._requests){if(void 0===M._lengthComputable||void 0===M._loaded||void 0===M._total)return;G=G&&M._lengthComputable,V+=M._loaded,N+=M._total}this._progressCallback({lengthComputable:G,loaded:V,total:G?N:0})}_validate(D,l){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),o.e.ValidateAsync(l,G,V,(l=>this.preprocessUrlAsync(G+l).then((l=>D._loadFileAsync(l,void 0,!0,!0).then((D=>new Uint8Array(D,0,D.byteLength))))))).then((D=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(D),this.onValidatedObservable.clear()}),(D=>{this._endPerformanceCounter("Validate JSON"),N.Tools.Warn(`Failed to validate: ${D.message}`),this.onValidatedObservable.clear()})))}_getLoader(D){const l=D.json.asset||{};this._log(`Asset version: ${l.version}`),l.minVersion&&this._log(`Asset minimum version: ${l.minVersion}`),l.generator&&this._log(`Asset generator: ${l.generator}`);const G=s._parseVersion(l.version);if(!G)throw new Error("Invalid version: "+l.version);if(void 0!==l.minVersion){const D=s._parseVersion(l.minVersion);if(!D)throw new Error("Invalid minimum version: "+l.minVersion);if(s._compareVersion(D,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+l.minVersion)}const V={1:s._CreateGLTF1Loader,2:s._CreateGLTF2Loader}[G.major];if(!V)throw new Error("Unsupported version: "+l.version);return V(this)}_parseJson(D){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${D.length}`);const l=JSON.parse(D);return this._endPerformanceCounter("Parse JSON"),l}_unpackBinaryAsync(D){return this._startPerformanceCounter("Unpack Binary"),D.loadAsync(20).then((()=>{const l=D.readUint32();if(1179937895!==l)throw new y.e("Unexpected magic: "+l,y.d.GLTFLoaderUnexpectedMagicError);const G=D.readUint32();this.loggingEnabled&&this._log(`Binary version: ${G}`);const V=D.readUint32();let N;switch(this.useRangeRequests||V===D.buffer.byteLength||R.d.Warn(`Length in header does not match actual data length: ${V} != ${D.buffer.byteLength}`),G){case 1:N=this._unpackBinaryV1Async(D,V);break;case 2:N=this._unpackBinaryV2Async(D,V);break;default:throw new Error("Unsupported version: "+G)}return this._endPerformanceCounter("Unpack Binary"),N}))}_unpackBinaryV1Async(D,l){const G=D.readUint32(),V=D.readUint32();if(0!==V)throw new Error(`Unexpected content format: ${V}`);const N=l-D.byteOffset,M={json:this._parseJson(D.readString(G)),bin:null};if(0!==N){const l=D.byteOffset;M.bin={readAsync:(G,V)=>D.buffer.readAsync(l+G,V),byteLength:N}}return Promise.resolve(M)}_unpackBinaryV2Async(D,l){const G=1313821514,V=5130562,N=D.readUint32();if(D.readUint32()!==G)throw new Error("First chunk format is not JSON");return D.byteOffset+N===l?D.loadAsync(N).then((()=>({json:this._parseJson(D.readString(N)),bin:null}))):D.loadAsync(N+8).then((()=>{const M={json:this._parseJson(D.readString(N)),bin:null},b=()=>{const N=D.readUint32();switch(D.readUint32()){case G:throw new Error("Unexpected JSON chunk");case V:{const l=D.byteOffset;M.bin={readAsync:(G,V)=>D.buffer.readAsync(l+G,V),byteLength:N},D.skipBytes(N);break}default:D.skipBytes(N)}return D.byteOffset!==l?D.loadAsync(8).then(b):Promise.resolve(M)};return b()}))}static _parseVersion(D){if("1.0"===D||"1.0.1"===D)return{major:1,minor:0};const l=(D+"").match(/^(\d+)\.(\d+)/);return l?{major:parseInt(l[1]),minor:parseInt(l[2])}:null}static _compareVersion(D,l){return D.major>l.major?1:D.major<l.major?-1:D.minor>l.minor?1:D.minor<l.minor?-1:0}_logOpen(D){this._log(D),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(D){const l=s._logSpaces.substring(0,2*this._logIndentLevel);R.d.Log(`${l}${D}`)}_logDisabled(D){}_startPerformanceCounterEnabled(D){N.Tools.StartPerformanceCounter(D)}_startPerformanceCounterDisabled(D){}_endPerformanceCounterEnabled(D){N.Tools.EndPerformanceCounter(D)}_endPerformanceCounterDisabled(D){}}s.IncrementalLoading=!0,s.HomogeneousCoordinates=!1,s._logSpaces="                                ",(0,M.e)(new s)},13361:(D,l,G)=>{"use strict";G.d(l,{e:()=>b});var V=G(11530);function N(D,l,G,V){const N={externalResourceFunction:V};return G&&(N.uri="file:"===l?G:l+G),ArrayBuffer.isView(D)?GLTFValidator.validateBytes(D,N):GLTFValidator.validateString(D,N)}function M(){const D=[];onmessage=l=>{const G=l.data;switch(G.id){case"init":importScripts(G.url);break;case"validate":N(G.data,G.rootUrl,G.fileName,(l=>new Promise(((G,V)=>{const N=D.length;D.push({resolve:G,reject:V}),postMessage({id:"getExternalResource",index:N,uri:l})})))).then((D=>{postMessage({id:"validate.resolve",value:D})}),(D=>{postMessage({id:"validate.reject",reason:D})}));break;case"getExternalResource.resolve":D[G.index].resolve(G.value);break;case"getExternalResource.reject":D[G.index].reject(G.reason)}}}class b{static ValidateAsync(D,l,G,b){return"function"===typeof Worker?new Promise(((X,t)=>{const R=`${N}(${M})()`,n=URL.createObjectURL(new Blob([R],{type:"application/javascript"})),g=new Worker(n),j=D=>{g.removeEventListener("error",j),g.removeEventListener("message",e),t(D)},e=D=>{const l=D.data;switch(l.id){case"getExternalResource":b(l.uri).then((D=>{g.postMessage({id:"getExternalResource.resolve",index:l.index,value:D},[D.buffer])}),(D=>{g.postMessage({id:"getExternalResource.reject",index:l.index,reason:D})}));break;case"validate.resolve":g.removeEventListener("error",j),g.removeEventListener("message",e),X(l.value),g.terminate();break;case"validate.reject":g.removeEventListener("error",j),g.removeEventListener("message",e),t(l.reason),g.terminate()}};if(g.addEventListener("error",j),g.addEventListener("message",e),g.postMessage({id:"init",url:V.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(D)){const V=D.slice();g.postMessage({id:"validate",data:V,rootUrl:l,fileName:G},[V.buffer])}else g.postMessage({id:"validate",data:D,rootUrl:l,fileName:G})})):(this._LoadScriptPromise||(this._LoadScriptPromise=V.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>N(D,l,G,b))))}}b.Configuration={url:`${V.Tools._DefaultCdnUrl}/gltf_validator.js`}},13869:(D,l,G)=>{"use strict";G.d(l,{b:()=>u});var V=G(11695),N=G(11703),M=G(11739),b=G(11710),X=G(12112),t=G(12045),R=G(11788),n=G(11963),g=G(11667),j=G(11621);G(13134),G(13033),G(13053),G(13037),G(13061),G(13063),G(13068);const e="imageProcessingCompatibility",K="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";j.b.IncludesShadersStore[e]||(j.b.IncludesShadersStore[e]=K);const F="skyPixelShader",d="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";j.b.ShadersStore[F]||(j.b.ShadersStore[F]=d);G(13148),G(13073),G(13082),G(13093),G(13084);const H="skyVertexShader",h="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";j.b.ShadersStore[H]||(j.b.ShadersStore[H]=h);var x=G(12038),r=G(12100),o=G(12097);class L extends X.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class u extends t.e{constructor(D,l){super(D,l),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new b.Kl(0,100,0),this.useSunPosition=!1,this.cameraOffset=b.Kl.Zero(),this.up=b.Kl.Up(),this.dithering=!1,this._cameraPosition=b.Kl.Zero(),this._skyOrientation=new b.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(D,l){const G=l._drawWrapper;if(this.isFrozen&&G.effect&&G._wasPreviouslyReady)return!0;l.materialDefines||(l.materialDefines=new L);const V=l.materialDefines,N=this.uD();if(this._isReadyForSubMesh(l))return!0;if((0,o.R)(D,N,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,V),(0,o.G)(D,V,!0,!1),V.IMAGEPROCESSINGPOSTPROCESS!==N.imageProcessingConfiguration.applyByPostProcess&&V.markAsMiscDirty(),V.DITHER!==this.dithering&&V.markAsMiscDirty(),V.isDirty){V.markAsProcessed(),N.resetCachedMaterial();const D=new x.d;V.FOG&&D.addFallback(1,"FOG"),V.IMAGEPROCESSINGPOSTPROCESS=N.imageProcessingConfiguration.applyByPostProcess,V.DITHER=this.dithering;const G=[R.e.PositionKind];V.VERTEXCOLOR&&G.push(R.e.ColorKind);const M="sky",b=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,r.d)(b);const X=V.toString();l.setEffect(N.getEngine().createEffect(M,G,b,[],X,D,this.onCompiled,this.onError),V,this._materialContext)}return!(!l.effect||!l.effect.isReady())&&(V._renderId=N.getRenderId(),G._wasPreviouslyReady=!0,!0)}bindForSubMesh(D,l,G){const V=this.uD(),N=G.materialDefines;if(!N)return;const M=G.effect;if(!M)return;this._activeEffect=M,this.bindOnlyWorldMatrix(D),this._activeEffect.setMatrix("viewProjection",V.getTransformMatrix()),this._mustRebind(V,M,G)&&((0,r.f)(M,this,V),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,o.j)(N,M,V)),V.fogEnabled&&l.applyFog&&V.fogMode!==n.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",V.getViewMatrix()),(0,o.g)(V,l,this._activeEffect);const X=V.activeCamera;if(X){const D=X.getWorldMatrix();this._cameraPosition.x=D.m[12],this._cameraPosition.y=D.m[13],this._cameraPosition.z=D.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const D=Math.PI*(this.inclination-.5),l=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(l)*Math.cos(D),this.sunPosition.y=this.distance*Math.sin(-D),this.sunPosition.z=this.distance*Math.sin(l)*Math.cos(D),b.Quaternion.FromUnitVectorsToRef(b.Kl.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(l,this._activeEffect,G)}getAnimatables(){return[]}dispose(D){super.dispose(D)}clone(D){return M.c.Clone((()=>new u(D,this.uD())),this)}serialize(){const D=super.serialize();return D.customType="BABYLON.SkyMaterial",D}getClassName(){return"SkyMaterial"}static Parse(D,l,G){return M.c.Parse((()=>new u(D.name,l)),D,l,G)}}(0,V.b)([(0,N.L)()],u.prototype,"luminance",void 0),(0,V.b)([(0,N.L)()],u.prototype,"turbidity",void 0),(0,V.b)([(0,N.L)()],u.prototype,"rayleigh",void 0),(0,V.b)([(0,N.L)()],u.prototype,"mieCoefficient",void 0),(0,V.b)([(0,N.L)()],u.prototype,"mieDirectionalG",void 0),(0,V.b)([(0,N.L)()],u.prototype,"distance",void 0),(0,V.b)([(0,N.L)()],u.prototype,"inclination",void 0),(0,V.b)([(0,N.L)()],u.prototype,"azimuth",void 0),(0,V.b)([(0,N.I)()],u.prototype,"sunPosition",void 0),(0,V.b)([(0,N.L)()],u.prototype,"useSunPosition",void 0),(0,V.b)([(0,N.I)()],u.prototype,"cameraOffset",void 0),(0,V.b)([(0,N.I)()],u.prototype,"up",void 0),(0,V.b)([(0,N.L)()],u.prototype,"dithering",void 0),(0,g.c)("BABYLON.SkyMaterial",u)},12433:(D,l,G)=>{"use strict";function V(D,l){l.headers=D.headers||{},l.statusMessage=D.statusText,l.statusCode=D.status,l.data=D.response}function N(D,l,G){return new Promise((function(N,M){G=G||{};var b,X,t,R=new XMLHttpRequest,n=G.body,g=G.headers||{};for(b in G.timeout&&(R.timeout=G.timeout),R.ontimeout=R.onerror=function(D){D.timeout="timeout"==D.type,M(D)},R.open(D,l.href||l),R.onload=function(){for(t=R.getAllResponseHeaders().trim().split(/[\r\n]+/),V(R,R);X=t.shift();)X=X.split(": "),R.headers[X.shift().toLowerCase()]=X.join(": ");if((X=R.headers["content-type"])&&~X.indexOf("application/json"))try{R.data=JSON.parse(R.data,G.reviver)}catch(D){return V(R,D),M(D)}(R.status>=400?M:N)(R)},typeof FormData<"u"&&n instanceof FormData||n&&"object"==typeof n&&(g["content-type"]="application/json",n=JSON.stringify(n)),R.withCredentials=!!G.withCredentials,g)R.setRequestHeader(b,g[b]);R.send(n)}))}G.r(l),G.d(l,{del:()=>t,get:()=>M,patch:()=>X,post:()=>b,put:()=>R,send:()=>N});var M=N.bind(N,"GET"),b=N.bind(N,"POST"),X=N.bind(N,"PATCH"),t=N.bind(N,"DELETE"),R=N.bind(N,"PUT")},13974:(D,l,G)=>{"use strict";G.d(l,{e:()=>g});const V=.5*(Math.sqrt(3)-1),N=(3-Math.sqrt(3))/6,M=1/3,b=1/6,X=(Math.sqrt(5)-1)/4,t=(5-Math.sqrt(5))/20,R=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),n=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const g=class{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const l="function"==typeof D?D:function(D){let l=0,G=0,V=0,N=1;const M=function(){let D=4022871197;return function(l){l=l.toString();for(let G=0;G<l.length;G++){D+=l.charCodeAt(G);let V=.02519603282416938*D;D=V>>>0,V-=D,V*=D,D=V>>>0,V-=D,D+=4294967296*V}return 2.3283064365386963e-10*(D>>>0)}}();l=M(" "),G=M(" "),V=M(" "),l-=M(D),l<0&&(l+=1);G-=M(D),G<0&&(G+=1);V-=M(D),V<0&&(V+=1);return function(){const D=2091639*l+2.3283064365386963e-10*N;return l=G,G=V,V=D-(N=0|D)}}(D);this.p=function(D){const l=new Uint8Array(256);for(let G=0;G<256;G++)l[G]=G;for(let G=0;G<255;G++){const V=G+~~(D()*(256-G)),N=l[G];l[G]=l[V],l[V]=N}return l}(l),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let G=0;G<512;G++)this.perm[G]=this.p[255&G],this.permMod12[G]=this.perm[G]%12}noise2D(D,l){const G=this.permMod12,M=this.perm;let b=0,X=0,t=0;const n=(D+l)*V,g=Math.floor(D+n),j=Math.floor(l+n),e=(g+j)*N,K=D-(g-e),F=l-(j-e);let d,H;K>F?(d=1,H=0):(d=0,H=1);const h=K-d+N,x=F-H+N,r=K-1+2*N,o=F-1+2*N,L=255&g,u=255&j;let B=.5-K*K-F*F;if(B>=0){const D=3*G[L+M[u]];B*=B,b=B*B*(R[D]*K+R[D+1]*F)}let I=.5-h*h-x*x;if(I>=0){const D=3*G[L+d+M[u+H]];I*=I,X=I*I*(R[D]*h+R[D+1]*x)}let W=.5-r*r-o*o;if(W>=0){const D=3*G[L+1+M[u+1]];W*=W,t=W*W*(R[D]*r+R[D+1]*o)}return 70*(b+X+t)}noise3D(D,l,G){const V=this.permMod12,N=this.perm;let X,t,n,g;const j=(D+l+G)*M,e=Math.floor(D+j),K=Math.floor(l+j),F=Math.floor(G+j),d=(e+K+F)*b,H=D-(e-d),h=l-(K-d),x=G-(F-d);let r,o,L,u,B,I;H>=h?h>=x?(r=1,o=0,L=0,u=1,B=1,I=0):H>=x?(r=1,o=0,L=0,u=1,B=0,I=1):(r=0,o=0,L=1,u=1,B=0,I=1):h<x?(r=0,o=0,L=1,u=0,B=1,I=1):H<x?(r=0,o=1,L=0,u=0,B=1,I=1):(r=0,o=1,L=0,u=1,B=1,I=0);const W=H-r+b,i=h-o+b,y=x-L+b,S=H-u+2*b,O=h-B+2*b,s=x-I+2*b,U=H-1+.5,f=h-1+.5,q=x-1+.5,c=255&e,v=255&K,Z=255&F;let J=.6-H*H-h*h-x*x;if(J<0)X=0;else{const D=3*V[c+N[v+N[Z]]];J*=J,X=J*J*(R[D]*H+R[D+1]*h+R[D+2]*x)}let Y=.6-W*W-i*i-y*y;if(Y<0)t=0;else{const D=3*V[c+r+N[v+o+N[Z+L]]];Y*=Y,t=Y*Y*(R[D]*W+R[D+1]*i+R[D+2]*y)}let z=.6-S*S-O*O-s*s;if(z<0)n=0;else{const D=3*V[c+u+N[v+B+N[Z+I]]];z*=z,n=z*z*(R[D]*S+R[D+1]*O+R[D+2]*s)}let E=.6-U*U-f*f-q*q;if(E<0)g=0;else{const D=3*V[c+1+N[v+1+N[Z+1]]];E*=E,g=E*E*(R[D]*U+R[D+1]*f+R[D+2]*q)}return 32*(X+t+n+g)}noise4D(D,l,G,V){const N=this.perm;let M,b,R,g,j;const e=(D+l+G+V)*X,K=Math.floor(D+e),F=Math.floor(l+e),d=Math.floor(G+e),H=Math.floor(V+e),h=(K+F+d+H)*t,x=D-(K-h),r=l-(F-h),o=G-(d-h),L=V-(H-h);let u=0,B=0,I=0,W=0;x>r?u++:B++,x>o?u++:I++,x>L?u++:W++,r>o?B++:I++,r>L?B++:W++,o>L?I++:W++;const i=u>=3?1:0,y=B>=3?1:0,S=I>=3?1:0,O=W>=3?1:0,s=u>=2?1:0,U=B>=2?1:0,f=I>=2?1:0,q=W>=2?1:0,c=u>=1?1:0,v=B>=1?1:0,Z=I>=1?1:0,J=W>=1?1:0,Y=x-i+t,z=r-y+t,E=o-S+t,P=L-O+t,p=x-s+2*t,k=r-U+2*t,m=o-f+2*t,T=L-q+2*t,C=x-c+3*t,w=r-v+3*t,A=o-Z+3*t,a=L-J+3*t,Q=x-1+4*t,DD=r-1+4*t,lD=o-1+4*t,GD=L-1+4*t,VD=255&K,ND=255&F,MD=255&d,bD=255&H;let XD=.6-x*x-r*r-o*o-L*L;if(XD<0)M=0;else{const D=N[VD+N[ND+N[MD+N[bD]]]]%32*4;XD*=XD,M=XD*XD*(n[D]*x+n[D+1]*r+n[D+2]*o+n[D+3]*L)}let tD=.6-Y*Y-z*z-E*E-P*P;if(tD<0)b=0;else{const D=N[VD+i+N[ND+y+N[MD+S+N[bD+O]]]]%32*4;tD*=tD,b=tD*tD*(n[D]*Y+n[D+1]*z+n[D+2]*E+n[D+3]*P)}let RD=.6-p*p-k*k-m*m-T*T;if(RD<0)R=0;else{const D=N[VD+s+N[ND+U+N[MD+f+N[bD+q]]]]%32*4;RD*=RD,R=RD*RD*(n[D]*p+n[D+1]*k+n[D+2]*m+n[D+3]*T)}let nD=.6-C*C-w*w-A*A-a*a;if(nD<0)g=0;else{const D=N[VD+c+N[ND+v+N[MD+Z+N[bD+J]]]]%32*4;nD*=nD,g=nD*nD*(n[D]*C+n[D+1]*w+n[D+2]*A+n[D+3]*a)}let gD=.6-Q*Q-DD*DD-lD*lD-GD*GD;if(gD<0)j=0;else{const D=N[VD+1+N[ND+1+N[MD+1+N[bD+1]]]]%32*4;gD*=gD,j=gD*gD*(n[D]*Q+n[D+1]*DD+n[D+2]*lD+n[D+3]*GD)}return 27*(M+b+R+g+j)}}}}]);