/*! For license information please see 2tp4u5.32.91866ca6.chunk.js.LICENSE.txt */
(self.uw9p3pwwsje=self.uw9p3pwwsje||[]).push([[32],{14570:(D,h,o)=>{"use strict";var H=o(14579),g=o(14587),j=o(14594);o.g.__TYPEDARRAY_POOL||(o.g.__TYPEDARRAY_POOL={UINT8:g([32,0]),UINT16:g([32,0]),UINT32:g([32,0]),INT8:g([32,0]),INT16:g([32,0]),INT32:g([32,0]),FLOAT:g([32,0]),DOUBLE:g([32,0]),DATA:g([32,0]),UINT8C:g([32,0]),BUFFER:g([32,0])});var M="undefined"!==typeof Uint8ClampedArray,R=o.g.__TYPEDARRAY_POOL;R.UINT8C||(R.UINT8C=g([32,0])),R.BUFFER||(R.BUFFER=g([32,0]));var t=R.DATA,S=R.BUFFER;function k(D){if(D){var h=D.length||D.byteLength,o=H.log2(h);t[o].push(D)}}function K(D){D=H.nextPow2(D);var h=H.log2(D),o=t[h];return o.length>0?o.pop():new ArrayBuffer(D)}function Q(D){return new Uint8Array(K(D),0,D)}function v(D){return new Uint16Array(K(2*D),0,D)}function r(D){return new Uint32Array(K(4*D),0,D)}function B(D){return new Int8Array(K(D),0,D)}function s(D){return new Int16Array(K(2*D),0,D)}function U(D){return new Int32Array(K(4*D),0,D)}function q(D){return new Float32Array(K(4*D),0,D)}function c(D){return new Float64Array(K(8*D),0,D)}function y(D){return M?new Uint8ClampedArray(K(D),0,D):Q(D)}function b(D){return new DataView(K(D),0,D)}h.free=function(D){if(j(D))S[H.log2(D.length)].push(D);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(D)&&(D=D.buffer),!D)return;var h=D.length||D.byteLength,o=0|H.log2(h);t[o].push(D)}},h.freeUint8=h.freeUint16=h.freeUint32=h.freeInt8=h.freeInt16=h.freeInt32=h.freeFloat32=h.freeFloat=h.freeFloat64=h.freeDouble=h.freeUint8Clamped=h.freeDataView=function(D){k(D.buffer)},h.freeArrayBuffer=k,h.freeBuffer=function(D){S[H.log2(D.length)].push(D)},h.malloc=function(D,h){if(void 0===h||"arraybuffer"===h)return K(D);switch(h){case"uint8":return Q(D);case"uint16":return v(D);case"uint32":return r(D);case"int8":return B(D);case"int16":return s(D);case"int32":return U(D);case"float":case"float32":return q(D);case"double":case"float64":return c(D);case"uint8_clamped":return y(D);case"buffer":throw"Buffer not supported";case"data":case"dataview":return b(D);default:return null}return null},h.mallocArrayBuffer=K,h.mallocUint8=Q,h.mallocUint16=v,h.mallocUint32=r,h.mallocInt8=B,h.mallocInt16=s,h.mallocInt32=U,h.mallocFloat32=h.mallocFloat=q,h.mallocFloat64=h.mallocDouble=c,h.mallocUint8Clamped=y,h.mallocDataView=b,h.clearCache=function(){for(var D=0;D<32;++D)R.UINT8[D].length=0,R.UINT16[D].length=0,R.UINT32[D].length=0,R.INT8[D].length=0,R.INT16[D].length=0,R.INT32[D].length=0,R.FLOAT[D].length=0,R.DOUBLE[D].length=0,R.UINT8C[D].length=0,t[D].length=0,S[D].length=0}},14663:(D,h,o)=>{D.exports=g;var H=o(13638);function g(D,h){if(!(this instanceof g))return new g(D,h);var o=H.create();H.add(o,D,h),this.base=H.min(H.create(),D,o),this.Yk=H.clone(h),this.max=H.max(H.create(),D,o),this.mag=H.length(this.Yk)}var j=g.prototype;j.width=function(){return this.Yk[0]},j.height=function(){return this.Yk[1]},j.depth=function(){return this.Yk[2]},j.x0=function(){return this.base[0]},j.y0=function(){return this.base[1]},j.z0=function(){return this.base[2]},j.x1=function(){return this.max[0]},j.y1=function(){return this.max[1]},j.z1=function(){return this.max[2]},j.translate=function(D){return H.add(this.max,this.max,D),H.add(this.base,this.base,D),this},j.setPosition=function(D){return H.add(this.max,D,this.Yk),H.i(this.base,D),this},j.expand=function(D){var h=H.create(),o=H.create();return H.max(h,D.max,this.max),H.min(o,D.base,this.base),H.Nh(h,h,o),new g(o,h)},j.intersects=function(D){return!(D.base[0]>this.max[0])&&(!(D.base[1]>this.max[1])&&(!(D.base[2]>this.max[2])&&(!(D.max[0]<this.base[0])&&(!(D.max[1]<this.base[1])&&!(D.max[2]<this.base[2])))))},j.touches=function(D){var h=this.union(D);return null!==h&&(0==h.width()||0==h.height()||0==h.depth())},j.union=function(D){if(!this.intersects(D))return null;var h=Math.max(D.base[0],this.base[0]),o=Math.max(D.base[1],this.base[1]),H=Math.max(D.base[2],this.base[2]);return new g([h,o,H],[Math.min(D.max[0],this.max[0])-h,Math.min(D.max[1],this.max[1])-o,Math.min(D.max[2],this.max[2])-H])}},14579:(D,h)=>{"use strict";function o(D){var h=32;return(D&=-D)&&h--,65535&D&&(h-=16),16711935&D&&(h-=8),252645135&D&&(h-=4),858993459&D&&(h-=2),1431655765&D&&(h-=1),h}h.INT_BITS=32,h.INT_MAX=2147483647,h.INT_MIN=-1<<31,h.sign=function(D){return(D>0)-(D<0)},h.abs=function(D){var h=D>>31;return(D^h)-h},h.min=function(D,h){return h^(D^h)&-(D<h)},h.max=function(D,h){return D^(D^h)&-(D<h)},h.isPow2=function(D){return!(D&D-1)&&!!D},h.log2=function(D){var h,o;return h=(D>65535)<<4,h|=o=((D>>>=h)>255)<<3,h|=o=((D>>>=o)>15)<<2,(h|=o=((D>>>=o)>3)<<1)|(D>>>=o)>>1},h.log10=function(D){return D>=1e9?9:D>=1e8?8:D>=1e7?7:D>=1e6?6:D>=1e5?5:D>=1e4?4:D>=1e3?3:D>=100?2:D>=10?1:0},h.popCount=function(D){return 16843009*((D=(858993459&(D-=D>>>1&1431655765))+(D>>>2&858993459))+(D>>>4)&252645135)>>>24},h.countTrailingZeros=o,h.nextPow2=function(D){return D+=0===D,--D,D|=D>>>1,D|=D>>>2,D|=D>>>4,D|=D>>>8,(D|=D>>>16)+1},h.prevPow2=function(D){return D|=D>>>1,D|=D>>>2,D|=D>>>4,D|=D>>>8,(D|=D>>>16)-(D>>>1)},h.parity=function(D){return D^=D>>>16,D^=D>>>8,D^=D>>>4,27030>>>(D&=15)&1};var H=new Array(256);!function(D){for(var h=0;h<256;++h){var o=h,H=h,g=7;for(o>>>=1;o;o>>>=1)H<<=1,H|=1&o,--g;D[h]=H<<g&255}}(H),h.reverse=function(D){return H[255&D]<<24|H[D>>>8&255]<<16|H[D>>>16&255]<<8|H[D>>>24&255]},h.interleave2=function(D,h){return(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D&=65535)|D<<8))|D<<4))|D<<2))|D<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))<<1},h.deinterleave2=function(D,h){return(D=65535&((D=16711935&((D=252645135&((D=858993459&((D=D>>>h&1431655765)|D>>>1))|D>>>2))|D>>>4))|D>>>16))<<16>>16},h.interleave3=function(D,h,o){return D=1227133513&((D=3272356035&((D=251719695&((D=4278190335&((D&=1023)|D<<16))|D<<8))|D<<4))|D<<2),(D|=(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<1)|(o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2))<<2},h.deinterleave3=function(D,h){return(D=1023&((D=4278190335&((D=251719695&((D=3272356035&((D=D>>>h&1227133513)|D>>>2))|D>>>4))|D>>>8))|D>>>16))<<22>>22},h.nextCombination=function(D){var h=D|D-1;return h+1|(~h&-~h)-1>>>o(D)+1}},14565:(D,h,o)=>{"use strict";D.exports=function(D,h,o){switch(arguments.length){case 1:return H=[],S(g=D,g,k,!0),H;case 2:return"function"===typeof h?S(D,D,h,!0):function(D,h){return H=[],S(D,h,k,!1),H}(D,h);case 3:return S(D,h,o,!1);default:throw new Error("box-intersect: Invalid arguments")}var g};var H,g=o(14570),j=o(14600),M=o(14610);function R(D,h){for(var o=0;o<D;++o)if(!(h[o]<=h[o+D]))return!0;return!1}function t(D,h,o,H){for(var g=0,j=0,M=0,t=D.length;M<t;++M){var S=D[M];if(!R(h,S)){for(var k=0;k<2*h;++k)o[g++]=S[k];H[j++]=M}}return j}function S(D,h,o,H){var R=D.length,S=h.length;if(!(R<=0||S<=0)){var k=D[0].length>>>1;if(!(k<=0)){var K,Q=g.mallocDouble(2*k*R),v=g.mallocInt32(R);if((R=t(D,k,Q,v))>0){if(1===k&&H)j.init(R),K=j.sweepComplete(k,o,0,R,Q,v,0,R,Q,v);else{var r=g.mallocDouble(2*k*S),B=g.mallocInt32(S);(S=t(h,k,r,B))>0&&(j.init(R+S),K=1===k?j.sweepBipartite(k,o,0,R,Q,v,0,S,r,B):M(k,o,H,R,Q,v,S,r,B),g.free(r),g.free(B))}g.free(Q),g.free(v)}return K}}}function k(D,h){H.push([D,h])}},14614:(D,h)=>{"use strict";var o="d",H="ax",g="fp",j="es",M="rs",R="re",t="rb",S="bs",k="be",K="bb",Q=[o,H,"vv",M,R,t,"ri",S,k,K,"bi"];function v(D){var h="bruteForce"+(D?"Full":"Partial"),H=[],M=Q.slice();D||M.splice(3,0,g);var R=["function "+h+"("+M.join()+"){"];function t(h,g){var M=function(D,h,H){var g="bruteForce"+(D?"Red":"Blue")+(h?"Flip":"")+(H?"Full":""),M=["function ",g,"(",Q.join(),"){","var ",j,"=2*",o,";"],R="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",t="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(H?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return D?M.push(R,"Q",":",t):M.push(t,"Q",":",R),H?M.push("if(y1<x0||x1<y0)continue;"):h?M.push("if(y0<=x0||x1<y0)continue;"):M.push("if(y0<x0||x1<y0)continue;"),M.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),h?M.push("yi,xi"):M.push("xi,yi"),M.push(");if(rv!==void 0)return rv;}}}"),{name:g,code:M.join("")}}(h,g,D);H.push(M.code),R.push("return "+M.name+"("+Q.join()+");")}R.push("if(re-rs>be-bs){"),D?(t(!0,!1),R.push("}else{"),t(!1,!1)):(R.push("if(fp){"),t(!0,!0),R.push("}else{"),t(!0,!1),R.push("}}else{if(fp){"),t(!1,!0),R.push("}else{"),t(!1,!1),R.push("}")),R.push("}}return "+h);var S=H.join("")+R.join("");return new Function(S)()}h.partial=v(!1),h.full=v(!0)},14610:(D,h,o)=>{"use strict";D.exports=function(D,h,o,j,k,E,L,T,Z){!function(D,h){var o=8*g.log2(h+1)*(D+1)|0,j=g.nextPow2(y*o);i.length<j&&(H.free(i),i=H.mallocInt32(j));var M=g.nextPow2(b*o);G.length<M&&(H.free(G),G=H.mallocDouble(M))}(D,j+L);var e,p=0,mD=2*D;N(p++,0,0,j,0,L,o?16:0,-1/0,1/0),o||N(p++,0,0,L,0,j,1,-1/0,1/0);for(;p>0;){var a=(p-=1)*y,u=i[a],I=i[a+1],P=i[a+2],n=i[a+3],F=i[a+4],w=i[a+5],Y=p*b,l=G[Y],C=G[Y+1],z=1&w,f=!!(16&w),V=k,d=E,X=T,A=Z;if(z&&(V=T,d=Z,X=k,A=E),!(2&w&&I>=(P=s(D,u,I,P,V,d,C)))&&!(4&w&&(I=U(D,u,I,P,V,d,l))>=P)){var W=P-I,x=F-n;if(f){if(D*W*(W+x)<v){if(void 0!==(e=t.scanComplete(D,u,h,I,P,V,d,n,F,X,A)))return e;continue}}else{if(D*Math.min(W,x)<K){if(void 0!==(e=M(D,u,h,z,I,P,V,d,n,F,X,A)))return e;continue}if(D*W*x<Q){if(void 0!==(e=t.scanBipartite(D,u,h,z,I,P,V,d,n,F,X,A)))return e;continue}}var DD=r(D,u,I,P,V,d,l,C);if(I<DD)if(D*(DD-I)<K){if(void 0!==(e=R(D,u+1,h,I,DD,V,d,n,F,X,A)))return e}else if(u===D-2){if(void 0!==(e=z?t.sweepBipartite(D,h,n,F,X,A,I,DD,V,d):t.sweepBipartite(D,h,I,DD,V,d,n,F,X,A)))return e}else N(p++,u+1,I,DD,n,F,z,-1/0,1/0),N(p++,u+1,n,F,I,DD,1^z,-1/0,1/0);if(DD<P){var hD=S(D,u,n,F,X,A),oD=X[mD*hD+u],HD=B(D,u,hD,F,X,A,oD);if(HD<F&&N(p++,u,DD,P,HD,F,(4|z)+(f?16:0),oD,C),n<hD&&N(p++,u,DD,P,n,hD,(2|z)+(f?16:0),l,oD),hD+1===HD){if(void 0!==(e=f?O(D,u,h,DD,P,V,d,hD,X,A[hD]):J(D,u,h,z,DD,P,V,d,hD,X,A[hD])))return e}else if(hD<HD){var gD;if(f){if(DD<(gD=q(D,u,DD,P,V,d,oD))){var jD=B(D,u,DD,gD,V,d,oD);if(u===D-2){if(DD<jD&&void 0!==(e=t.sweepComplete(D,h,DD,jD,V,d,hD,HD,X,A)))return e;if(jD<gD&&void 0!==(e=t.sweepBipartite(D,h,jD,gD,V,d,hD,HD,X,A)))return e}else DD<jD&&N(p++,u+1,DD,jD,hD,HD,16,-1/0,1/0),jD<gD&&(N(p++,u+1,jD,gD,hD,HD,0,-1/0,1/0),N(p++,u+1,hD,HD,jD,gD,1,-1/0,1/0))}}else DD<(gD=z?c(D,u,DD,P,V,d,oD):q(D,u,DD,P,V,d,oD))&&(u===D-2?e=z?t.sweepBipartite(D,h,hD,HD,X,A,DD,gD,V,d):t.sweepBipartite(D,h,DD,gD,V,d,hD,HD,X,A):(N(p++,u+1,DD,gD,hD,HD,z,-1/0,1/0),N(p++,u+1,hD,HD,DD,gD,1^z,-1/0,1/0)))}}}}};var H=o(14570),g=o(14579),j=o(14614),M=j.partial,R=j.full,t=o(14600),S=o(14623),k=o(14625),K=128,Q=1<<22,v=1<<22,r=k("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),B=k("lo===p0",["p0"]),s=k("lo<p0",["p0"]),U=k("hi<=p0",["p0"]),q=k("lo<=p0&&p0<=hi",["p0"]),c=k("lo<p0&&p0<=hi",["p0"]),y=6,b=2,i=H.mallocInt32(1024),G=H.mallocDouble(1024);function N(D,h,o,H,g,j,M,R,t){var S=y*D;i[S]=h,i[S+1]=o,i[S+2]=H,i[S+3]=g,i[S+4]=j,i[S+5]=M;var k=b*D;G[k]=R,G[k+1]=t}function J(D,h,o,H,g,j,M,R,t,S,k){var K=2*D,Q=t*K,v=S[Q+h];D:for(var r=g,B=g*K;r<j;++r,B+=K){var s=M[B+h],U=M[B+h+D];if(!(v<s||U<v)&&(!H||v!==s)){for(var q,c=R[r],y=h+1;y<D;++y){s=M[B+y],U=M[B+y+D];var b=S[Q+y],i=S[Q+y+D];if(U<b||i<s)continue D}if(void 0!==(q=H?o(k,c):o(c,k)))return q}}}function O(D,h,o,H,g,j,M,R,t,S){var k=2*D,K=R*k,Q=t[K+h];D:for(var v=H,r=H*k;v<g;++v,r+=k){var B=M[v];if(B!==S){var s=j[r+h],U=j[r+h+D];if(!(Q<s||U<Q)){for(var q=h+1;q<D;++q){s=j[r+q],U=j[r+q+D];var c=t[K+q],y=t[K+q+D];if(U<c||y<s)continue D}var b=o(B,S);if(void 0!==b)return b}}}}},14623:(D,h,o)=>{"use strict";D.exports=function(D,h,o,M,R,t){if(M<=o+1)return o;var S=o,k=M,K=M+o>>>1,Q=2*D,v=K,r=R[Q*K+h];for(;S<k;){if(k-S<g){j(D,h,S,k,R,t),r=R[Q*K+h];break}var B=k-S,s=Math.random()*B+S|0,U=R[Q*s+h],q=Math.random()*B+S|0,c=R[Q*q+h],y=Math.random()*B+S|0,b=R[Q*y+h];U<=c?b>=c?(v=q,r=c):U>=b?(v=s,r=U):(v=y,r=b):c>=b?(v=q,r=c):b>=U?(v=s,r=U):(v=y,r=b);for(var i=Q*(k-1),G=Q*v,N=0;N<Q;++N,++i,++G){var J=R[i];R[i]=R[G],R[G]=J}var O=t[k-1];t[k-1]=t[v],t[v]=O;for(i=Q*(k-1),G=Q*(v=H(D,h,S,k-1,R,t,r)),N=0;N<Q;++N,++i,++G){J=R[i];R[i]=R[G],R[G]=J}O=t[k-1];if(t[k-1]=t[v],t[v]=O,K<v){for(k=v-1;S<k&&R[Q*(k-1)+h]===r;)k-=1;k+=1}else{if(!(v<K))break;for(S=v+1;S<k&&R[Q*S+h]===r;)S+=1}}return H(D,h,o,K,R,t,R[Q*K+h])};var H=o(14625)("lo<p0",["p0"]),g=8;function j(D,h,o,H,g,j){for(var M=2*D,R=M*(o+1)+h,t=o+1;t<H;++t,R+=M)for(var S=g[R],k=t,K=M*(t-1);k>o&&g[K+h]>S;--k,K-=M){for(var Q=K,v=K+M,r=0;r<M;++r,++Q,++v){var B=g[Q];g[Q]=g[v],g[v]=B}var s=j[k];j[k]=j[k-1],j[k-1]=s}}},14625:D=>{"use strict";D.exports=function(D,o){var H="abcdef".split("").concat(o),g=[];D.indexOf("lo")>=0&&g.push("lo=e[k+n]");D.indexOf("hi")>=0&&g.push("hi=e[k+o]");return H.push(h.replace("_",g.join()).replace("$",D)),Function.apply(void 0,H)};var h="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14604:D=>{"use strict";D.exports=function(D,H){H<=4*h?o(0,H-1,D):S(0,H-1,D)};var h=32;function o(D,h,o){for(var H=2*(D+1),g=D+1;g<=h;++g){for(var j=o[H++],M=o[H++],R=g,t=H-2;R-- >D;){var S=o[t-2],k=o[t-1];if(S<j)break;if(S===j&&k<M)break;o[t]=S,o[t+1]=k,t-=2}o[t]=j,o[t+1]=M}}function H(D,h,o){h*=2;var H=o[D*=2],g=o[D+1];o[D]=o[h],o[D+1]=o[h+1],o[h]=H,o[h+1]=g}function g(D,h,o){h*=2,o[D*=2]=o[h],o[D+1]=o[h+1]}function j(D,h,o,H){h*=2,o*=2;var g=H[D*=2],j=H[D+1];H[D]=H[h],H[D+1]=H[h+1],H[h]=H[o],H[h+1]=H[o+1],H[o]=g,H[o+1]=j}function M(D,h,o,H,g){h*=2,g[D*=2]=g[h],g[h]=o,g[D+1]=g[h+1],g[h+1]=H}function R(D,h,o){h*=2;var H=o[D*=2],g=o[h];return!(H<g)&&(H!==g||o[D+1]>o[h+1])}function t(D,h,o,H){var g=H[D*=2];return g<h||g===h&&H[D+1]<o}function S(D,k,K){var Q=(k-D+1)/6|0,v=D+Q,r=k-Q,B=D+k>>1,s=B-Q,U=B+Q,q=v,c=s,y=B,b=U,i=r,G=D+1,N=k-1,J=0;R(q,c,K)&&(J=q,q=c,c=J),R(b,i,K)&&(J=b,b=i,i=J),R(q,y,K)&&(J=q,q=y,y=J),R(c,y,K)&&(J=c,c=y,y=J),R(q,b,K)&&(J=q,q=b,b=J),R(y,b,K)&&(J=y,y=b,b=J),R(c,i,K)&&(J=c,c=i,i=J),R(c,y,K)&&(J=c,c=y,y=J),R(b,i,K)&&(J=b,b=i,i=J);for(var O=K[2*c],E=K[2*c+1],L=K[2*b],T=K[2*b+1],Z=2*q,e=2*y,p=2*i,mD=2*v,a=2*B,u=2*r,I=0;I<2;++I){var P=K[Z+I],n=K[e+I],F=K[p+I];K[mD+I]=P,K[a+I]=n,K[u+I]=F}g(s,D,K),g(U,k,K);for(var w=G;w<=N;++w)if(t(w,O,E,K))w!==G&&H(w,G,K),++G;else if(!t(w,L,T,K))for(;;){if(t(N,L,T,K)){t(N,O,E,K)?(j(w,G,N,K),++G,--N):(H(w,N,K),--N);break}if(--N<w)break}M(D,G-1,O,E,K),M(k,N+1,L,T,K),G-2-D<=h?o(D,G-2,K):S(D,G-2,K),k-(N+2)<=h?o(N+2,k,K):S(N+2,k,K),N-G<=h?o(G,N,K):S(G,N,K)}},14600:(D,h,o)=>{"use strict";D.exports={init:function(D){var h=g.nextPow2(D);t.length<h&&(H.free(t),t=H.mallocInt32(h));S.length<h&&(H.free(S),S=H.mallocInt32(h));k.length<h&&(H.free(k),k=H.mallocInt32(h));K.length<h&&(H.free(K),K=H.mallocInt32(h));Q.length<h&&(H.free(Q),Q=H.mallocInt32(h));v.length<h&&(H.free(v),v=H.mallocInt32(h));var o=8*h;r.length<o&&(H.free(r),r=H.mallocDouble(o))},sweepBipartite:function(D,h,o,H,g,R,Q,v,U,q){for(var c=0,y=2*D,b=D-1,i=y-1,G=o;G<H;++G){var N=R[G],J=y*G;r[c++]=g[J+b],r[c++]=-(N+1),r[c++]=g[J+i],r[c++]=N}for(G=Q;G<v;++G){N=q[G]+M;var O=y*G;r[c++]=U[O+b],r[c++]=-N,r[c++]=U[O+i],r[c++]=N}var E=c>>>1;j(r,E);var L=0,T=0;for(G=0;G<E;++G){var Z=0|r[2*G+1];if(Z>=M)B(k,K,T--,Z=Z-M|0);else if(Z>=0)B(t,S,L--,Z);else if(Z<=-M){Z=-Z-M|0;for(var e=0;e<L;++e){if(void 0!==(p=h(t[e],Z)))return p}s(k,K,T++,Z)}else{Z=-Z-1|0;for(e=0;e<T;++e){var p;if(void 0!==(p=h(Z,k[e])))return p}s(t,S,L++,Z)}}},sweepComplete:function(D,h,o,H,g,M,R,U,q,c){for(var y=0,b=2*D,i=D-1,G=b-1,N=o;N<H;++N){var J=M[N]+1<<1,O=b*N;r[y++]=g[O+i],r[y++]=-J,r[y++]=g[O+G],r[y++]=J}for(N=R;N<U;++N){J=c[N]+1<<1;var E=b*N;r[y++]=q[E+i],r[y++]=1|-J,r[y++]=q[E+G],r[y++]=1|J}var L=y>>>1;j(r,L);var T=0,Z=0,e=0;for(N=0;N<L;++N){var p=0|r[2*N+1],mD=1&p;if(N<L-1&&p>>1===r[2*N+3]>>1&&(mD=2,N+=1),p<0){for(var a=-(p>>1)-1,u=0;u<e;++u){if(void 0!==(I=h(Q[u],a)))return I}if(0!==mD)for(u=0;u<T;++u){if(void 0!==(I=h(t[u],a)))return I}if(1!==mD)for(u=0;u<Z;++u){var I;if(void 0!==(I=h(k[u],a)))return I}0===mD?s(t,S,T++,a):1===mD?s(k,K,Z++,a):2===mD&&s(Q,v,e++,a)}else{a=(p>>1)-1;0===mD?B(t,S,T--,a):1===mD?B(k,K,Z--,a):2===mD&&B(Q,v,e--,a)}}},scanBipartite:function(D,h,o,H,g,R,k,K,Q,v,U,q){var c=0,y=2*D,b=h,i=h+D,G=1,N=1;H?N=M:G=M;for(var J=g;J<R;++J){var O=J+G,E=y*J;r[c++]=k[E+b],r[c++]=-O,r[c++]=k[E+i],r[c++]=O}for(J=Q;J<v;++J){O=J+N;var L=y*J;r[c++]=U[L+b],r[c++]=-O}var T=c>>>1;j(r,T);var Z=0;for(J=0;J<T;++J){var e=0|r[2*J+1];if(e<0){var p=!1;if((O=-e)>=M?(p=!H,O-=M):(p=!!H,O-=1),p)s(t,S,Z++,O);else{var mD=q[O],a=y*O,u=U[a+h+1],I=U[a+h+1+D];D:for(var P=0;P<Z;++P){var n=t[P],F=y*n;if(!(I<k[F+h+1]||k[F+h+1+D]<u)){for(var w=h+2;w<D;++w)if(U[a+w+D]<k[F+w]||k[F+w+D]<U[a+w])continue D;var Y,l=K[n];if(void 0!==(Y=H?o(mD,l):o(l,mD)))return Y}}}}else B(t,S,Z--,e-G)}},scanComplete:function(D,h,o,H,g,R,S,k,K,Q,v){for(var B=0,s=2*D,U=h,q=h+D,c=H;c<g;++c){var y=c+M,b=s*c;r[B++]=R[b+U],r[B++]=-y,r[B++]=R[b+q],r[B++]=y}for(c=k;c<K;++c){y=c+1;var i=s*c;r[B++]=Q[i+U],r[B++]=-y}var G=B>>>1;j(r,G);var N=0;for(c=0;c<G;++c){var J=0|r[2*c+1];if(J<0){if((y=-J)>=M)t[N++]=y-M;else{var O=v[y-=1],E=s*y,L=Q[E+h+1],T=Q[E+h+1+D];D:for(var Z=0;Z<N;++Z){var e=t[Z],p=S[e];if(p===O)break;var mD=s*e;if(!(T<R[mD+h+1]||R[mD+h+1+D]<L)){for(var a=h+2;a<D;++a)if(Q[E+a+D]<R[mD+a]||R[mD+a+D]<Q[E+a])continue D;var u=o(p,O);if(void 0!==u)return u}}}}else{for(y=J-M,Z=N-1;Z>=0;--Z)if(t[Z]===y){for(a=Z+1;a<N;++a)t[a-1]=t[a];break}--N}}}};var H=o(14570),g=o(14579),j=o(14604),M=1<<28,R=1024,t=H.mallocInt32(R),S=H.mallocInt32(R),k=H.mallocInt32(R),K=H.mallocInt32(R),Q=H.mallocInt32(R),v=H.mallocInt32(R),r=H.mallocDouble(8192);function B(D,h,o,H){var g=h[H],j=D[o-1];D[g]=j,h[j]=g}function s(D,h,o,H){D[o]=H,h[H]=o}},14587:D=>{"use strict";function h(D,o,H){var g=0|D[H];if(g<=0)return[];var j,M=new Array(g);if(H===D.length-1)for(j=0;j<g;++j)M[j]=o;else for(j=0;j<g;++j)M[j]=h(D,o,H+1);return M}D.exports=function(D,o){switch("undefined"===typeof o&&(o=0),typeof D){case"number":if(D>0)return function(D,h){var o,H;for(o=new Array(D),H=0;H<D;++H)o[H]=h;return o}(0|D,o);break;case"object":if("number"===typeof D.length)return h(D,o,0)}return[]}},14541:(D,h,o)=>{D.exports=function(){var D=this;this.components={},this.comps=this.components;var h=this.components,o=1,g={},j=[],M=[],R={timeout:!1,removals:[],multiComps:[]};function t(D,o){var H=h[o],j=g[o],M=j.hash[D];M&&(j.remove(D),H.Rh&&(H.multi?(M.forEach((h=>{h&&H.Rh(D,h)})),M.length=0):H.Rh(D,M)),R.removals.push(j),S())}function S(){R.timeout||(R.timeout=!0,setTimeout(k,1))}function k(){R.timeout=!1,K()}function K(){R.multiComps.length&&function(D){for(var h=0;h<D.length;h++){var{entID:o,data:H}=D[h],g=H.hash[o];if(g){for(var j=0;j<g.length;j++)g[j]||(g.splice(j,1),j--);0===g.length&&(H.remove(o),R.removals.push(H))}}D.length=0}(R.multiComps),R.removals.length&&function(D){for(var h=0;h<D.length;h++){D[h].flush()}D.length=0}(R.removals)}this.gQ=g,this._systems=j,this._renderSystems=M,this.uS=function(h){var H=o++;return Array.isArray(h)&&h.forEach((h=>D.ES(H,h))),H},this.deleteEntity=function(h){return Object.keys(g).forEach((D=>{g[D].hash[h]&&t(h,D)})),D},this.RK=function(D){if(!D)throw new Error("Missing component definition");var o=D.name;if(!o)throw new Error("Component definition must have a name property.");if("string"!==typeof o)throw new Error("Component name must be a string.");if(""===o)throw new Error("Component name must be a non-empty string.");if(g[o])throw new Error(`Component ${o} already exists.`);var R={};return R.name=o,R.multi=!!D.multi,R.order=isNaN(D.order)?99:D.order,R.stateConstructor=D.stateConstructor||null,R.state=D.state||{},R.gt=D.gt||null,R.Rh=D.Rh||null,R.system=D.system||null,R.Zt=D.Zt||null,h[o]=R,g[o]=new H,g[o]._pendingMultiCleanup=!1,g[o]._multiCleanupIDs=R.multi?[]:null,R.system&&(j.push(o),j.sort(((D,o)=>h[D].order-h[o].order))),R.Zt&&(M.push(o),M.sort(((D,o)=>h[D].order-h[o].order))),o},this.overwriteComponent=function(D,o){var H=h[D];if(!H)throw new Error(`Unknown component: ${D}`);if(!o)throw new Error("Missing component definition");if(H.name!==o.name)throw new Error("Overwriting component must use the same name property.");var R={};R.name=D,R.multi=!!o.multi,R.order=isNaN(o.order)?99:o.order,R.state=o.state||{},R.gt=o.gt||null,R.Rh=o.Rh||null,R.system=o.system||null,R.Zt=o.Zt||null,h[D]=R,g[D]._pendingMultiCleanup=!1,g[D]._multiCleanupIDs=R.multi?[]:null;var t=j.indexOf(D);R.system&&t<0&&j.push(D),!R.system&&t>=0&&j.splice(t,1),j.sort(((D,o)=>h[D].order-h[o].order));var S=M.indexOf(D);R.Zt&&S<0&&M.push(D),!R.Zt&&S>=0&&M.splice(S,1),M.sort(((D,o)=>h[D].order-h[o].order));var k=R.state;return this.Ok(D).forEach((D=>{for(var h in k)h in D||(D[h]=k[h]);R.gt&&R.gt(D.Lt,D)})),D},this.deleteComponent=function(o){var H=g[o];if(!H)throw new Error(`Unknown component: ${o}`);H.flush(),H.list.forEach((D=>{D&&t(D.Lt||D[0].Lt,o)}));var R=j.indexOf(o),S=M.indexOf(o);return R>-1&&j.splice(R,1),S>-1&&M.splice(S,1),g[o].dispose(),delete g[o],delete h[o],D},this.ES=function(D,o,H){var j,M=h[o],R=g[o];if(!R)throw new Error(`Unknown component: ${o}.`);if(R.hash[D]&&!M.multi)throw new Error(`Entity ${D} already has component: ${o}.`);if(M.stateConstructor){if(!(j=new M.stateConstructor).hasOwnProperty("Lt"))throw new Error(`Component ${M.name} stateConstructor type does not have property __id`)}else j=Object.assign({},{Lt:D},M.state,H);if(j.Lt=D,M.multi){var t=R.hash[D];t||(t=[],R.add(D,t)),t.push(j)}else R.add(D,j);return M.gt&&M.gt(D,j),this},this.nS=function(D,h){var o=g[h];if(!o)throw new Error(`Unknown component: ${h}.`);return!!o.hash[D]},this.eS=function(h,o){if(!g[o])throw new Error(`Unknown component: ${o}.`);return t(h,o),D},this.getState=function(D,h){var o=g[h];if(!o)throw new Error(`Unknown component: ${h}.`);return o.hash[D]},this.Ok=function(D){var h=g[D];if(!h)throw new Error(`Unknown component: ${D}.`);return K(),h.list},this.zv=function(D){if(!g[D])throw new Error(`Unknown component: ${D}.`);var h=g[D].hash;return D=>h[D]},this.dv=function(D){if(!g[D])throw new Error(`Unknown component: ${D}.`);var h=g[D].hash;return D=>!!h[D]},this.Nt=function(o){K();for(var H=0;H<j.length;H++){var M=j[H],R=h[M],t=g[M];R.system(o,t.list),K()}return D},this.render=function(o){K();for(var H=0;H<M.length;H++){var j=M[H],R=h[j],t=g[j];R.Zt(o,t.list),K()}return D},this.removeMultiComponent=function(o,H,j){var M=h[H],t=g[H];if(!t)throw new Error(`Unknown component: ${H}.`);if(!M.multi)throw new Error("removeMultiComponent called on non-multi component");return function(D,h,o,H){var g=o.hash[D];if(g){var j=g[H];j&&(g[H]=null,h.Rh&&h.Rh(D,j),R.multiComps.push({entID:D,data:o}),S())}}(o,M,t,j),D}};var H=o(14547)},14547:D=>{function h(D,h){var o=D._map[h];if(delete D.hash[h],delete D._map[h],o===D.list.length-1)D.list.pop();else{var H=D.list.pop();if(D.list[o]=H,null===H||null===H[0]){var g=D.list.length;for(var j in D._map)if(D._map[j]===g)return void(D._map[j]=o)}else{var M=H.Lt||H[0].Lt;D._map[M]=o}}}D.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(D,h){if("number"===typeof this._map[D]){var o=this._map[D];this.hash[D]=h,this.list[o]=h}else this._map[D]=this.list.length,this.hash[D]=h,this.list.push(h)}remove(D){var h=this._map[D];this.hash[D]=null,this.list[h]=null,this._pendingRemovals.push(D)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var D=0;D<this._pendingRemovals.length;D++){var o=this._pendingRemovals[D];null===this.hash[o]&&h(this,o)}this._pendingRemovals.length=0}}},14503:D=>{"use strict";var h,o="object"===typeof Reflect?Reflect:null,H=function(D,h,o){return Function.prototype.apply.call(D,h,o)};h=o&&"function"===typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(D){return Object.getOwnPropertyNames(D).concat(Object.getOwnPropertySymbols(D))}:function(D){return Object.getOwnPropertyNames(D)};var g=Number.isNaN||function(D){return D!==D};function j(){j.init.call(this)}D.exports=j,D.exports.once=function(D,h){return new Promise((function(o,H){function g(o){D.removeListener(h,j),H(o)}function j(){"function"===typeof D.removeListener&&D.removeListener("error",g),o([].slice.call(arguments))}B(D,h,j,{once:!0}),"error"!==h&&function(D,h,o){"function"===typeof D.on&&B(D,"error",h,o)}(D,g,{once:!0})}))},j.EventEmitter=j,j.prototype._events=void 0,j.prototype._eventsCount=0,j.prototype._maxListeners=void 0;var M=10;function R(D){if("function"!==typeof D)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof D)}function t(D){return void 0===D._maxListeners?j.defaultMaxListeners:D._maxListeners}function S(D,h,o,H){var g,j,M,S;if(R(o),void 0===(j=D._events)?(j=D._events=Object.create(null),D._eventsCount=0):(void 0!==j.newListener&&(D.emit("newListener",h,o.listener?o.listener:o),j=D._events),M=j[h]),void 0===M)M=j[h]=o,++D._eventsCount;else if("function"===typeof M?M=j[h]=H?[o,M]:[M,o]:H?M.unshift(o):M.push(o),(g=t(D))>0&&M.length>g&&!M.warned){M.warned=!0;var k=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(h)+" listeners added. Use emitter.setMaxListeners() to increase limit");k.name="MaxListenersExceededWarning",k.Hh=D,k.type=h,k.count=M.length,S=k,console&&console.warn&&console.warn(S)}return D}function k(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function K(D,h,o){var H={fired:!1,wrapFn:void 0,target:D,type:h,listener:o},g=k.bind(H);return g.listener=o,H.wrapFn=g,g}function Q(D,h,o){var H=D._events;if(void 0===H)return[];var g=H[h];return void 0===g?[]:"function"===typeof g?o?[g.listener||g]:[g]:o?function(D){for(var h=new Array(D.length),o=0;o<h.length;++o)h[o]=D[o].listener||D[o];return h}(g):r(g,g.length)}function v(D){var h=this._events;if(void 0!==h){var o=h[D];if("function"===typeof o)return 1;if(void 0!==o)return o.length}return 0}function r(D,h){for(var o=new Array(h),H=0;H<h;++H)o[H]=D[H];return o}function B(D,h,o,H){if("function"===typeof D.on)H.once?D.once(h,o):D.on(h,o);else{if("function"!==typeof D.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof D);D.addEventListener(h,(function g(j){H.once&&D.removeEventListener(h,g),o(j)}))}}Object.defineProperty(j,"defaultMaxListeners",{enumerable:!0,get:function(){return M},set:function(D){if("number"!==typeof D||D<0||g(D))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+D+".");M=D}}),j.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},j.prototype.setMaxListeners=function(D){if("number"!==typeof D||D<0||g(D))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+D+".");return this._maxListeners=D,this},j.prototype.getMaxListeners=function(){return t(this)},j.prototype.emit=function(D){for(var h=[],o=1;o<arguments.length;o++)h.push(arguments[o]);var g="error"===D,j=this._events;if(void 0!==j)g=g&&void 0===j.error;else if(!g)return!1;if(g){var M;if(h.length>0&&(M=h[0]),M instanceof Error)throw M;var R=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw R.context=M,R}var t=j[D];if(void 0===t)return!1;if("function"===typeof t)H(t,this,h);else{var S=t.length,k=r(t,S);for(o=0;o<S;++o)H(k[o],this,h)}return!0},j.prototype.addListener=function(D,h){return S(this,D,h,!1)},j.prototype.on=j.prototype.addListener,j.prototype.prependListener=function(D,h){return S(this,D,h,!0)},j.prototype.once=function(D,h){return R(h),this.on(D,K(this,D,h)),this},j.prototype.prependOnceListener=function(D,h){return R(h),this.prependListener(D,K(this,D,h)),this},j.prototype.removeListener=function(D,h){var o,H,g,j,M;if(R(h),void 0===(H=this._events))return this;if(void 0===(o=H[D]))return this;if(o===h||o.listener===h)0===--this._eventsCount?this._events=Object.create(null):(delete H[D],H.removeListener&&this.emit("removeListener",D,o.listener||h));else if("function"!==typeof o){for(g=-1,j=o.length-1;j>=0;j--)if(o[j]===h||o[j].listener===h){M=o[j].listener,g=j;break}if(g<0)return this;0===g?o.shift():function(D,h){for(;h+1<D.length;h++)D[h]=D[h+1];D.pop()}(o,g),1===o.length&&(H[D]=o[0]),void 0!==H.removeListener&&this.emit("removeListener",D,M||h)}return this},j.prototype.off=j.prototype.removeListener,j.prototype.gh=function(D){var h,o,H;if(void 0===(o=this._events))return this;if(void 0===o.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==o[D]&&(0===--this._eventsCount?this._events=Object.create(null):delete o[D]),this;if(0===arguments.length){var g,j=Object.keys(o);for(H=0;H<j.length;++H)"removeListener"!==(g=j[H])&&this.gh(g);return this.gh("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(h=o[D]))this.removeListener(D,h);else if(void 0!==h)for(H=h.length-1;H>=0;H--)this.removeListener(D,h[H]);return this},j.prototype.listeners=function(D){return Q(this,D,!0)},j.prototype.rawListeners=function(D){return Q(this,D,!1)},j.listenerCount=function(D,h){return"function"===typeof D.listenerCount?D.listenerCount(h):v.call(D,h)},j.prototype.listenerCount=v,j.prototype.eventNames=function(){return this._eventsCount>0?h(this._events):[]}},14926:D=>{"use strict";D.exports=function(D,h,o,H,g,j){var M=+h[0],R=+h[1],t=+h[2],S=+o[0],k=+o[1],K=+o[2],Q=Math.sqrt(S*S+k*k+K*K);if(0===Q)throw new Error("Can't raycast along a zero vector");return function(D,h,o,H,g,j,M,R,t,S){for(var k=0,K=Math.floor,Q=0|K(h),v=0|K(o),r=0|K(H),B=g>0?1:-1,s=j>0?1:-1,U=M>0?1:-1,q=Math.abs(1/g),c=Math.abs(1/j),y=Math.abs(1/M),b=q<1/0?q*(B>0?Q+1-h:h-Q):1/0,i=c<1/0?c*(s>0?v+1-o:o-v):1/0,G=y<1/0?y*(U>0?r+1-H:H-r):1/0,N=-1;k<=R;){var J=D(Q,v,r);if(J)return t&&(t[0]=h+k*g,t[1]=o+k*j,t[2]=H+k*M),S&&(S[0]=S[1]=S[2]=0,0===N&&(S[0]=-B),1===N&&(S[1]=-s),2===N&&(S[2]=-U)),J;b<i?b<G?(Q+=B,k=b,b+=q,N=0):(r+=U,k=G,G+=y,N=2):i<G?(v+=s,k=i,i+=c,N=1):(r+=U,k=G,G+=y,N=2)}return t&&(t[0]=h+k*g,t[1]=o+k*j,t[2]=H+k*M),S&&(S[0]=S[1]=S[2]=0),0}(D,M,R,t,S/=Q,k/=Q,K/=Q,H="undefined"===typeof H?64:+H,g,j)}},14966:(D,h,o)=>{"use strict";o.d(h,{c:()=>j});var H=o(14503);function g(){this.VQ=!1,this.stopPropagation=!1,this.dQ=!1,this.disabled=!1}class j{constructor(D,h){this.version="0.7.0";var o=Object.assign({},new g,h||{});this.element=D||document,this.VQ=!!o.VQ,this.stopPropagation=!!o.stopPropagation,this.dQ=!!o.dQ,this.disabled=!!o.disabled,this.filterEvents=(D,h)=>!0,this.down=new H.EventEmitter,this.up=new H.EventEmitter,this.state={},this.bk={dx:0,dy:0,Iv:0,yk:0,Pv:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?R(this):document.addEventListener("DOMContentLoaded",(D=>{R(this)}),{once:!0})}bind(D){for(var h=arguments.length,o=new Array(h>1?h-1:0),H=1;H<h;H++)o[H-1]=arguments[H];o.forEach((h=>{var o=this._keyBindmap[h]||[];o.includes(D)||(o.push(D),this._keyBindmap[h]=o)})),this.state[D]=!!this.state[D],this.pressCount[D]=this.pressCount[D]||0,this.releaseCount[D]=this.releaseCount[D]||0}unbind(D){for(var h in this._keyBindmap){var o=this._keyBindmap[h],H=o.indexOf(D);H>-1&&o.splice(H,1)}}getBindings(){var D={};for(var h in this._keyBindmap){this._keyBindmap[h].forEach((o=>{D[o]=D[o]||[],D[o].push(h)}))}return D}Nt(){M(this.bk),M(this.pressCount),M(this.releaseCount)}}function M(D){for(var h in D)D[h]=0}function R(D){window.addEventListener("keydown",r.bind(null,D,!0),!1),window.addEventListener("keyup",r.bind(null,D,!1),!1);var h={passive:!0};D.element.addEventListener("touchstart",K.bind(void 0,D),{passive:!1}),D.element.addEventListener("touchend",v.bind(void 0,D),h),D.element.addEventListener("mousedown",B.bind(null,D,!0),h),window.document.addEventListener("mouseup",B.bind(null,D,!1),h),D.element.addEventListener("touchmove",s.bind(null,D),h),D.element.addEventListener("mousemove",s.bind(null,D),h),window.PointerEvent,D.element.addEventListener("wheel",U.bind(null,D),h),D.element.addEventListener("contextmenu",q.bind(null,D),!1),window.addEventListener("blur",c.bind(null,D),!1)}var t=0,S=0,k=null;function K(D,h){h.preventDefault(),Q(h)}function Q(D){let h=!1;for(let o=0;o<D.touches.length;++o)if(D.touches[o].identifier===k){h=!0;break}if(!h){const h=D.changedTouches[0];t=h.clientX,S=h.clientY,k=h.identifier}}function v(D,h){for(var o=h.changedTouches,H=0;H<o.length;++H)o[H].identifier===k&&(k=null)}function r(D,h,o){y(o.code,h,D,o)}function B(D,h,o){if("pointerId"in o)if(h){if(null!==D._touches.currID)return;D._touches.currID=o.pointerId}else{if(D._touches.currID!==o.pointerId)return;D._touches.currID=null}return y("Mouse"+("button"in o?o.button+1:1),h,D,o),!1}function s(D,h){var o=h.movementX||h.mozMovementX||0,H=h.movementY||h.mozMovementY||0;if(h.touches&&0===(o|H)){var g=function(D){Q(D);for(let h=0;h<D.changedTouches.length;++h)if(D.changedTouches[h].identifier==k){const o=D.changedTouches[h],H=[o.clientX-t,o.clientY-S];return t=o.clientX,S=o.clientY,H}return console.error(`Did not find touch id ${k}`),[0,0]}(h);o=g[0],H=g[1]}D.bk.dx+=o,D.bk.dy+=H}function U(D,h){var o=1;switch(h.deltaMode){case 0:o=1;break;case 1:o=12;break;case 2:o=D.element.clientHeight||window.innerHeight}D.bk.Iv+=(h.deltaX||0)*o,D.bk.yk+=(h.deltaY||0)*o,D.bk.Pv+=(h.deltaZ||0)*o}function q(D,h){if(!D.dQ)return h.preventDefault(),!1}function c(D){for(var h in D._keyStates)D._keyStates[h]&&(/^Mouse\d/.test(h)||y(h,!1,D,{code:h,note:"mis6egamfa",preventDefault:()=>{},stopPropagation:()=>{}}))}function y(D,h,o,H){var g=o._keyBindmap[D];g&&(b(o._keyStates[D],h)&&(o._keyStates[D]=h,g.forEach((D=>{(!o.filterEvents||o.filterEvents(H,D))&&function(D,h,o,H){var g=h?o.pressCount:o.releaseCount;g[D]=(g[D]||0)+1;var j=o._bindPressCount[D]||0;(j+=h?1:-1)<0&&(j=0);o._bindPressCount[D]=j;var M=o.state[D];if(b(M,j)){o.state[D]=j>0;var R=h?o.down:o.up;o.disabled||R.emit(D,H)}}(D,h,o,H)}))),"button"in H||(o.VQ&&!H.defaultPrevented&&H.preventDefault(),o.stopPropagation&&H.stopPropagation()))}function b(D,h){return D?!h:h}},13710:D=>{D.exports=function(D,h,o){return D[0]=h[0]+o[0],D[1]=h[1]+o[1],D[2]=h[2]+o[2],D}},13664:(D,h,o)=>{D.exports=function(D,h){var o=H(D[0],D[1],D[2]),M=H(h[0],h[1],h[2]);g(o,o),g(M,M);var R=j(o,M);return R>1?0:Math.acos(R)};var H=o(13667),g=o(13676),j=o(13685)},13757:D=>{D.exports=function(D,h){return D[0]=Math.ceil(h[0]),D[1]=Math.ceil(h[1]),D[2]=Math.ceil(h[2]),D}},13657:D=>{D.exports=function(D){var h=new Float32Array(3);return h[0]=D[0],h[1]=D[1],h[2]=D[2],h}},13689:D=>{D.exports=function(D,h){return D[0]=h[0],D[1]=h[1],D[2]=h[2],D}},13650:D=>{D.exports=function(){var D=new Float32Array(3);return D[0]=0,D[1]=0,D[2]=0,D}},13825:D=>{D.exports=function(D,h,o){var H=h[0],g=h[1],j=h[2],M=o[0],R=o[1],t=o[2];return D[0]=g*t-j*R,D[1]=j*M-H*t,D[2]=H*R-g*M,D}},13780:(D,h,o)=>{D.exports=o(13772)},13772:D=>{D.exports=function(D,h){var o=h[0]-D[0],H=h[1]-D[1],g=h[2]-D[2];return Math.sqrt(o*o+H*H+g*g)}},13739:(D,h,o)=>{D.exports=o(13736)},13736:D=>{D.exports=function(D,h,o){return D[0]=h[0]/o[0],D[1]=h[1]/o[1],D[2]=h[2]/o[2],D}},13685:D=>{D.exports=function(D,h){return D[0]*h[0]+D[1]*h[1]+D[2]*h[2]}},13645:D=>{D.exports=1e-6},13696:(D,h,o)=>{D.exports=function(D,h){var o=D[0],g=D[1],j=D[2],M=h[0],R=h[1],t=h[2];return Math.abs(o-M)<=H*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(g-R)<=H*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(j-t)<=H*Math.max(1,Math.abs(j),Math.abs(t))};var H=o(13645)},13702:D=>{D.exports=function(D,h){return D[0]===h[0]&&D[1]===h[1]&&D[2]===h[2]}},13755:D=>{D.exports=function(D,h){return D[0]=Math.floor(h[0]),D[1]=Math.floor(h[1]),D[2]=Math.floor(h[2]),D}},13883:(D,h,o)=>{D.exports=function(D,h,o,g,j,M){var R,t;h||(h=3);o||(o=0);t=g?Math.min(g*h+o,D.length):D.length;for(R=o;R<t;R+=h)H[0]=D[R],H[1]=D[R+1],H[2]=D[R+2],j(H,H,M),D[R]=H[0],D[R+1]=H[1],D[R+2]=H[2];return D};var H=o(13650)()},13667:D=>{D.exports=function(D,h,o){var H=new Float32Array(3);return H[0]=D,H[1]=h,H[2]=o,H}},13638:(D,h,o)=>{D.exports={EPSILON:o(13645),create:o(13650),clone:o(13657),angle:o(13664),Bt:o(13667),i:o(13689),set:o(13692),equals:o(13696),exactEquals:o(13702),add:o(13710),Nh:o(13716),sub:o(13724),multiply:o(13726),mul:o(13730),divide:o(13736),div:o(13739),min:o(13742),max:o(13746),floor:o(13755),ceil:o(13757),round:o(13761),scale:o(13766),st:o(13770),distance:o(13772),j:o(13780),squaredDistance:o(13782),sqrDist:o(13791),length:o(13793),len:o(13801),squaredLength:o(13804),Ut:o(13809),negate:o(13817),inverse:o(13821),normalize:o(13676),dot:o(13685),cross:o(13825),ht:o(13833),random:o(13837),transformMat4:o(13845),transformMat3:o(13854),transformQuat:o(13858),qt:o(13866),ct:o(13875),yt:o(13881),forEach:o(13883)}},13821:D=>{D.exports=function(D,h){return D[0]=1/h[0],D[1]=1/h[1],D[2]=1/h[2],D}},13801:(D,h,o)=>{D.exports=o(13793)},13793:D=>{D.exports=function(D){var h=D[0],o=D[1],H=D[2];return Math.sqrt(h*h+o*o+H*H)}},13833:D=>{D.exports=function(D,h,o,H){var g=h[0],j=h[1],M=h[2];return D[0]=g+H*(o[0]-g),D[1]=j+H*(o[1]-j),D[2]=M+H*(o[2]-M),D}},13746:D=>{D.exports=function(D,h,o){return D[0]=Math.max(h[0],o[0]),D[1]=Math.max(h[1],o[1]),D[2]=Math.max(h[2],o[2]),D}},13742:D=>{D.exports=function(D,h,o){return D[0]=Math.min(h[0],o[0]),D[1]=Math.min(h[1],o[1]),D[2]=Math.min(h[2],o[2]),D}},13730:(D,h,o)=>{D.exports=o(13726)},13726:D=>{D.exports=function(D,h,o){return D[0]=h[0]*o[0],D[1]=h[1]*o[1],D[2]=h[2]*o[2],D}},13817:D=>{D.exports=function(D,h){return D[0]=-h[0],D[1]=-h[1],D[2]=-h[2],D}},13676:D=>{D.exports=function(D,h){var o=h[0],H=h[1],g=h[2],j=o*o+H*H+g*g;j>0&&(j=1/Math.sqrt(j),D[0]=h[0]*j,D[1]=h[1]*j,D[2]=h[2]*j);return D}},13837:D=>{D.exports=function(D,h){h=h||1;var o=2*Math.random()*Math.PI,H=2*Math.random()-1,g=Math.sqrt(1-H*H)*h;return D[0]=Math.cos(o)*g,D[1]=Math.sin(o)*g,D[2]=H*h,D}},13866:D=>{D.exports=function(D,h,o,H){var g=o[1],j=o[2],M=h[1]-g,R=h[2]-j,t=Math.sin(H),S=Math.cos(H);return D[0]=h[0],D[1]=g+M*S-R*t,D[2]=j+M*t+R*S,D}},13875:D=>{D.exports=function(D,h,o,H){var g=o[0],j=o[2],M=h[0]-g,R=h[2]-j,t=Math.sin(H),S=Math.cos(H);return D[0]=g+R*t+M*S,D[1]=h[1],D[2]=j+R*S-M*t,D}},13881:D=>{D.exports=function(D,h,o,H){var g=o[0],j=o[1],M=h[0]-g,R=h[1]-j,t=Math.sin(H),S=Math.cos(H);return D[0]=g+M*S-R*t,D[1]=j+M*t+R*S,D[2]=h[2],D}},13761:D=>{D.exports=function(D,h){return D[0]=Math.round(h[0]),D[1]=Math.round(h[1]),D[2]=Math.round(h[2]),D}},13766:D=>{D.exports=function(D,h,o){return D[0]=h[0]*o,D[1]=h[1]*o,D[2]=h[2]*o,D}},13770:D=>{D.exports=function(D,h,o,H){return D[0]=h[0]+o[0]*H,D[1]=h[1]+o[1]*H,D[2]=h[2]+o[2]*H,D}},13692:D=>{D.exports=function(D,h,o,H){return D[0]=h,D[1]=o,D[2]=H,D}},13791:(D,h,o)=>{D.exports=o(13782)},13809:(D,h,o)=>{D.exports=o(13804)},13782:D=>{D.exports=function(D,h){var o=h[0]-D[0],H=h[1]-D[1],g=h[2]-D[2];return o*o+H*H+g*g}},13804:D=>{D.exports=function(D){var h=D[0],o=D[1],H=D[2];return h*h+o*o+H*H}},13724:(D,h,o)=>{D.exports=o(13716)},13716:D=>{D.exports=function(D,h,o){return D[0]=h[0]-o[0],D[1]=h[1]-o[1],D[2]=h[2]-o[2],D}},13854:D=>{D.exports=function(D,h,o){var H=h[0],g=h[1],j=h[2];return D[0]=H*o[0]+g*o[3]+j*o[6],D[1]=H*o[1]+g*o[4]+j*o[7],D[2]=H*o[2]+g*o[5]+j*o[8],D}},13845:D=>{D.exports=function(D,h,o){var H=h[0],g=h[1],j=h[2],M=o[3]*H+o[7]*g+o[11]*j+o[15];return M=M||1,D[0]=(o[0]*H+o[4]*g+o[8]*j+o[12])/M,D[1]=(o[1]*H+o[5]*g+o[9]*j+o[13])/M,D[2]=(o[2]*H+o[6]*g+o[10]*j+o[14])/M,D}},13858:D=>{D.exports=function(D,h,o){var H=h[0],g=h[1],j=h[2],M=o[0],R=o[1],t=o[2],S=o[3],k=S*H+R*j-t*g,K=S*g+t*H-M*j,Q=S*j+M*g-R*H,v=-M*H-R*g-t*j;return D[0]=k*S+v*-M+K*-t-Q*-R,D[1]=K*S+v*-R+Q*-M-k*-t,D[2]=Q*S+v*-t+k*-R-K*-M,D}},14528:D=>{"use strict";D.exports=function(D){for(var h=new Array(D),o=0;o<D;++o)h[o]=o;return h}},14594:D=>{D.exports=function(D){return null!=D&&null!=D.constructor&&"function"===typeof D.constructor.isBuffer&&D.constructor.isBuffer(D)}},14933:(D,h,o)=>{"use strict";o.d(h,{d:()=>H});class H{constructor(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.LK=!1,this.TK=!1,this.JK=30,this.EK=0,this.PK=!1,this.fullscreen=!1,this.eK=function(D){},this.pK=function(){},this.uK=function(){},this.th=function(){},this.mQ=function(D){},this.onFullscreenChanged=function(D){},S((()=>{!function(D,h){D._nowObject=performance||Date,D._lastTick=0,D._renderAccum=0,D._rt=0,D._frameCB=R.bind(null,D),requestAnimationFrame(D._frameCB),h>0&&(D._intervalCB=M.bind(null,D),D._interval=setInterval(D._intervalCB,Math.max(h,1e3/D.JK/2)))}(this,h),function(D,h){if(!h)return;var o=!1,H=!1;document.addEventListener("pointerlockchange",(H=>{o=document.pointerLockElement===h,D.mQ(o)})),document.addEventListener("fullscreenchange",(o=>{H=document.fullscreenElement===h,D.onFullscreenChanged(H)})),Object.defineProperty(D,"PK",{get:()=>o,set:D=>{D&&!o?t(h):o&&!D&&function(D){D.exitPointerLock&&D.exitPointerLock()}(document)}}),Object.defineProperty(D,"fullscreen",{get:()=>H,set:D=>{D&&!H?h.requestFullscreen():H&&!D&&document.exitFullscreen()}}),h.addEventListener("click",(g=>{D.LK&&!o&&t(h),D.TK&&!H&&h.requestFullscreen()}));var g=()=>D.th();if(window.ResizeObserver){new ResizeObserver(g).observe(h)}else window.addEventListener("resize",g)}(this,D),this.uK()}))}}var g=3,j=20;function M(D){for(var h=1e3/D.JK,o=D._nowObject.now()+j,H=0;D._nowObject.now()>=D._lastTick+h&&D._nowObject.now()<o&&++H<=g;)D.eK(h),D._lastTick+=h;var M=5*(h+5),R=D._nowObject.now();if(R-D._lastTick>M)for(;R>=D._lastTick+h;)D._lastTick+=h}function R(D){requestAnimationFrame(D._frameCB),M(D);var h=D._nowObject.now(),o=h-D._rt;if(D._rt=h,D.EK>0){D._renderAccum+=o;var H=1e3/D.EK;if(D._renderAccum<H)return;D._renderAccum=Math.min(D._renderAccum-H,H)}var g=1e3/D.JK,j=(h-D._lastTick)/g;D.pK(o,j,g)}function t(D){D.requestPointerLock&&D.requestPointerLock()}var S=D=>{if("loading"===document.readyState){var h=()=>{document.removeEventListener("readystatechange",h),D()};document.addEventListener("readystatechange",h)}else setTimeout(D,1)}},14519:(D,h,o)=>{var H=o(14528),g=o(14533),j="undefined"!==typeof Float64Array;function M(D,h){return D[0]-h[0]}function R(){var D,h=this.stride,o=new Array(h.length);for(D=0;D<o.length;++D)o[D]=[Math.abs(h[D]),D];o.sort(M);var H=new Array(o.length);for(D=0;D<H.length;++D)H[D]=o[D][1];return H}function t(D,h){var o=["View",h,"d",D].join("");h<0&&(o="View_Nil"+D);var g="generic"===D;if(-1===h){var j="function "+o+"(a){this.data=a;};var proto="+o+".prototype;proto.dtype='"+D+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+o+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+o+"(a){return new "+o+"(a);}";return new Function(j)()}if(0===h){j="function "+o+"(a,d) {this.data = a;this.offset = d};var proto="+o+".prototype;proto.dtype='"+D+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+o+"_copy() {return new "+o+"(this.data,this.offset)};proto.pick=function "+o+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+o+"_get(){return "+(g?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+o+"_set(v){return "+(g?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+o+"(a,b,c,d){return new "+o+"(a,d)}";return new Function("TrivialArray",j)(S[D][0])}j=["'use strict'"];var M=H(h),t=M.map((function(D){return"i"+D})),k="this.offset+"+M.map((function(D){return"this.stride["+D+"]*i"+D})).join("+"),K=M.map((function(D){return"b"+D})).join(","),Q=M.map((function(D){return"c"+D})).join(",");j.push("function "+o+"(a,"+K+","+Q+",d){this.data=a","this.shape=["+K+"]","this.stride=["+Q+"]","this.offset=d|0}","var proto="+o+".prototype","proto.dtype='"+D+"'","proto.dimension="+h),j.push("Object.defineProperty(proto,'size',{get:function "+o+"_size(){return "+M.map((function(D){return"this.shape["+D+"]"})).join("*"),"}})"),1===h?j.push("proto.order=[0]"):(j.push("Object.defineProperty(proto,'order',{get:"),h<4?(j.push("function "+o+"_order(){"),2===h?j.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===h&&j.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):j.push("ORDER})")),j.push("proto.set=function "+o+"_set("+t.join(",")+",v){"),g?j.push("return this.data.set("+k+",v)}"):j.push("return this.data["+k+"]=v}"),j.push("proto.get=function "+o+"_get("+t.join(",")+"){"),g?j.push("return this.data.get("+k+")}"):j.push("return this.data["+k+"]}"),j.push("proto.index=function "+o+"_index(",t.join(),"){return "+k+"}"),j.push("proto.hi=function "+o+"_hi("+t.join(",")+"){return new "+o+"(this.data,"+M.map((function(D){return["(typeof i",D,"!=='number'||i",D,"<0)?this.shape[",D,"]:i",D,"|0"].join("")})).join(",")+","+M.map((function(D){return"this.stride["+D+"]"})).join(",")+",this.offset)}");var v=M.map((function(D){return"a"+D+"=this.shape["+D+"]"})),r=M.map((function(D){return"c"+D+"=this.stride["+D+"]"}));j.push("proto.lo=function "+o+"_lo("+t.join(",")+"){var b=this.offset,d=0,"+v.join(",")+","+r.join(","));for(var B=0;B<h;++B)j.push("if(typeof i"+B+"==='number'&&i"+B+">=0){d=i"+B+"|0;b+=c"+B+"*d;a"+B+"-=d}");j.push("return new "+o+"(this.data,"+M.map((function(D){return"a"+D})).join(",")+","+M.map((function(D){return"c"+D})).join(",")+",b)}"),j.push("proto.step=function "+o+"_step("+t.join(",")+"){var "+M.map((function(D){return"a"+D+"=this.shape["+D+"]"})).join(",")+","+M.map((function(D){return"b"+D+"=this.stride["+D+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(B=0;B<h;++B)j.push("if(typeof i"+B+"==='number'){d=i"+B+"|0;if(d<0){c+=b"+B+"*(a"+B+"-1);a"+B+"=ceil(-a"+B+"/d)}else{a"+B+"=ceil(a"+B+"/d)}b"+B+"*=d}");j.push("return new "+o+"(this.data,"+M.map((function(D){return"a"+D})).join(",")+","+M.map((function(D){return"b"+D})).join(",")+",c)}");var s=new Array(h),U=new Array(h);for(B=0;B<h;++B)s[B]="a[i"+B+"]",U[B]="b[i"+B+"]";j.push("proto.transpose=function "+o+"_transpose("+t+"){"+t.map((function(D,h){return D+"=("+D+"===undefined?"+h+":"+D+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+o+"(this.data,"+s.join(",")+","+U.join(",")+",this.offset)}"),j.push("proto.pick=function "+o+"_pick("+t+"){var a=[],b=[],c=this.offset");for(B=0;B<h;++B)j.push("if(typeof i"+B+"==='number'&&i"+B+">=0){c=(c+this.stride["+B+"]*i"+B+")|0}else{a.push(this.shape["+B+"]);b.push(this.stride["+B+"])}");return j.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),j.push("return function construct_"+o+"(data,shape,stride,offset){return new "+o+"(data,"+M.map((function(D){return"shape["+D+"]"})).join(",")+","+M.map((function(D){return"stride["+D+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",j.join("\n"))(S[D],R)}var S={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};D.exports=function(D,h,o,H){if(void 0===D)return(0,S.array[0])([]);"number"===typeof D&&(D=[D]),void 0===h&&(h=[D.length]);var M=h.length;if(void 0===o){o=new Array(M);for(var R=M-1,k=1;R>=0;--R)o[R]=k,k*=h[R]}if(void 0===H){H=0;for(R=0;R<M;++R)o[R]<0&&(H-=(h[R]-1)*o[R])}for(var K=function(D){if(g(D))return"buffer";if(j)switch(Object.prototype.toString.call(D)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(D)?"array":"generic"}(D),Q=S[K];Q.length<=M+1;)Q.push(t(K,Q.length-1));return(0,Q[M+1])(D,h,o,H)}},14533:D=>{function h(D){return!!D.constructor&&"function"===typeof D.constructor.isBuffer&&D.constructor.isBuffer(D)}D.exports=function(D){return null!=D&&(h(D)||function(D){return"function"===typeof D.readFloatLE&&"function"===typeof D.slice&&h(D.slice(0,0))}(D)||!!D._isBuffer)}},14670:D=>{"use strict";var h=[],o=[],H=[],g=[],j=[],M=[],R=[],t=[],S=[],k=[],K=[],Q=[];D.exports=function(D,v,r,B,s,U){for(var q=R,c=S,y=k,b=Q,i=0;i<3;i++)q[i]=+r[i],y[i]=+v.max[i],c[i]=+v.base[i];U||(U=1e-10);var G=function(D,R,S,k,Q,v){var r=h,B=o,s=H,U=g,q=j,c=M,y=t,b=Math.floor,i=0,G=0,N=0,J=0,O=0;if(E(),0===N)return 0;for(J=Z();G<=N;){if(L(J)&&T())return i;J=Z()}for(i+=N,O=0;O<3;O++)k[O]+=S[O],Q[O]+=S[O];return i;function E(){if(G=0,0!==(N=Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2])))for(var D=0;D<3;D++){var h=S[D]>=0;U[D]=h?1:-1;var o=h?Q[D]:k[D];r[D]=h?k[D]:Q[D],B[D]=e(o,U[D]),s[D]=p(r[D],U[D]),y[D]=S[D]/N,q[D]=Math.abs(1/y[D]);var H=h?B[D]+1-o:o-B[D];c[D]=q[D]<1/0?q[D]*H:1/0}}function L(h){for(var o=U[0],H=0===h?B[0]:s[0],g=B[0]+o,j=U[1],M=1===h?B[1]:s[1],R=B[1]+j,t=U[2],S=2===h?B[2]:s[2],k=B[2]+t,K=H;K!=g;K+=o)for(var Q=M;Q!=R;Q+=j)for(var v=S;v!=k;v+=t)if(D(K,Q,v))return!0;return!1}function T(){i+=G;var D=U[J],h=G/N,o=K;for(O=0;O<3;O++){var H=S[O]*h;k[O]+=H,Q[O]+=H,o[O]=S[O]-H}if(D>0?Q[J]=Math.round(Q[J]):k[J]=Math.round(k[J]),R(i,J,D,o))return!0;for(O=0;O<3;O++)S[O]=o[O];return E(),0===N}function Z(){var D=c[0]<c[1]?c[0]<c[2]?0:2:c[1]<c[2]?1:2,h=c[D]-G;for(G=c[D],B[D]+=U[D],c[D]+=q[D],O=0;O<3;O++)r[O]+=h*y[O],s[O]=p(r[O],U[O]);return D}function e(D,h){return b(D-h*v)}function p(D,h){return b(D+h*v)}}(D,B,q,c,y,U);if(!s){for(i=0;i<3;i++)b[i]=r[i]>0?y[i]-v.max[i]:c[i]-v.base[i];v.translate(b)}return G}},14970:(D,h,o)=>{"use strict";o.d(h,{d:()=>K});var H=o(14663),g=o(13638);class j{constructor(D,h,o,j,M,R,t){this.Jk=new H(D.base,D.Yk),this.Bg=h,this.friction=o,this.restitution=j,this.VR=M,this.gr=R,this.dR=!!t,this.wk=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.lr=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.lS=g.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=g.create(),this._impulses=g.create(),this._sleepFrameCount=10}loadFromCopy(D){g.i(this.Jk.base,D.Jk.base),g.i(this.Jk.Yk,D.Jk.Yk),g.i(this.Jk.max,D.Jk.max),this.Jk.mag=D.Jk.mag,this.Bg=D.Bg,this.friction=D.friction,this.restitution=D.restitution,this.VR=D.VR,this.gr=D.gr,this.dR=D.dR,this.wk=D.wk,this.fluidDrag=D.fluidDrag,this.lr=D.lr,this.preventFallOffEdge=D.preventFallOffEdge,this.rolledBackLastTick=D.rolledBackLastTick,g.i(this.lS,D.lS),g.i(this.resting,D.resting),this.inFluid=D.inFluid,this._ratioInFluid=D._ratioInFluid,g.i(this._forces,D._forces),g.i(this._impulses,D._impulses),this._sleepFrameCount=D._sleepFrameCount}setPosition(D){M(D),g.Nh(D,D,this.Jk.base),this.Jk.translate(D),this.CS()}Sh(){return g.clone(this.Jk.base)}applyForce(D){M(D),g.add(this._forces,this._forces,D),this.CS()}applyImpulse(D){M(D),g.add(this._impulses,this._impulses,D),this.CS()}CS(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var M=D=>{};var R=o(14663),t=o(13638),S=o(14670);function k(){this.wk=.1,this.fluidDrag=.4,this.Dt=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function K(D,h,o){D=Object.assign(new k,D),this.gravity=D.gravity||[0,-10,0],this.wk=D.wk||.1,this.Dt=D.Dt||2,this.fluidDrag=D.fluidDrag||.4,this.minBounceImpulse=D.minBounceImpulse,this.bodies=[],this.Ov=D.Ov,this.testSolid=h,this.testFluid=o}K.prototype.Kr=function(D,h,o,H,g,M){D=D||new R([0,0,0],[1,1,1]),"undefined"==typeof h&&(h=1),"undefined"==typeof o&&(o=1),"undefined"==typeof H&&(H=0),"undefined"==typeof g&&(g=1);var t=new j(D,h,o,H,g,M);return this.bodies.push(t),t},K.prototype.Qr=function(D){var h=this.bodies.indexOf(D);h<0||(this.bodies.splice(h,1),D.Jk=D.gr=null)};var Q=t.create(),v=t.create(),r=t.create(),B=t.create(),s=t.create(),U=t.create(),q=t.create(),c=new R([0,0,0],[1,1,1]),y=new j(c,1,1,0,1,(()=>{}),!1);function b(D,h,o){return h=o,h*=1-(1-D.ratioInFluid)**2}K.prototype.Nt=function(D){D/=1e3;var h=P(0,t.squaredLength(this.gravity));this.bodies.forEach((o=>function(D,h,o,H){t.i(s,h.resting),D.Ov&&y.loadFromCopy(h);if(h.Bg<=0)return t.set(h.lS,0,0,0),t.set(h._forces,0,0,0),void t.set(h._impulses,0,0,0);var g=H||0===h.VR;if(function(D,h,o,H){if(h._sleepFrameCount>0)return!1;if(H)return!0;var g=!1,j=.5*o*o*h.VR;return t.scale(I,D.gravity,j),S(D.testSolid,h.Jk,I,(function(){return g=!0,!0}),!0),g}(D,h,o,g))return;h._sleepFrameCount--,function(D,h){var o=h.Jk,H=Math.floor(o.base[0]),g=Math.floor(o.base[2]),j=Math.floor(o.base[1]),M=Math.floor(o.max[1]);if(!D.testFluid(H,j,g))return h.inFluid=!1,void(h.ratioInFluid=0);var R=1,S=j+1;for(;S<=M&&D.testFluid(H,S,g);)R++,S++;var k=(j+R-o.base[1])/o.Yk[1];k>1&&(k=1);var K=o.Yk[0]*o.Yk[1]*o.Yk[2]*k,Q=G;t.scale(Q,D.gravity,-D.Dt*K*h.VR),h.applyForce(Q),h.inFluid=!0,h.ratioInFluid=k}(D,h),F(h._forces),F(h._impulses),F(h.lS),F(h.resting),t.scale(Q,h._forces,1/h.Bg),t.st(Q,Q,D.gravity,h.VR),t.scale(v,h._impulses,1/h.Bg),t.st(v,v,Q,o),t.add(h.lS,h.lS,v),h.friction&&(N(D,0,h,v,o),N(D,1,h,v,o),N(D,2,h,v,o));var j=h.fluidDrag>=0?h.fluidDrag:D.fluidDrag,M=h.wk>=0?h.wk:D.wk,R=M,k=M;h.inFluid&&(R=b(h,R,h.fluidDragHoriz>=0?h.fluidDragHoriz:j),k=b(h,k,h.fluidDragVert>=0?h.fluidDragVert:j));R=Math.max(1-R*o/h.Bg,0),k=Math.max(1-k*o/h.Bg,0),t.set(i,R,k,R),t.multiply(h.lS,h.lS,i),t.scale(r,h.lS,o),t.set(h._forces,0,0,0),t.set(h._impulses,0,0,0),h.dR&&n(E,h.Jk);t.i(U,r),t.set(q,0,0,0),h.preventFallOffEdge&&function(D,h,o,H){if(!h.resting[1]||o[1]>0)return;var g=mD;n(g,h.Jk);for(var j=0;j<3;j+=2){t.set(p,0,0,0),p[j]=o[j];var M=!0;(M=(M=(M=(M=M&&!u(D,g.base[0]+p[0]+1e-5,g.base[1],g.base[2]+p[2]+1e-5))&&!u(D,g.max[0]+p[0]-1e-5,g.base[1],g.base[2]+p[2]+1e-5))&&!u(D,g.base[0]+p[0]+1e-5,g.base[1],g.max[2]+p[2]-1e-5))&&!u(D,g.max[0]+p[0]-1e-5,g.base[1],g.max[2]+p[2]-1e-5))?(H[j]=o[j]>0?1:-1,o[j]=0):0===j&&(t.set(a,o[0],0,0),O(D,g,a,H,h.slideOnCollision))}}(D,h,r,q);O(D,h.Jk,r,h.resting,h.slideOnCollision),h.dR&&function(D,h,o,H){if(h.resting[1]>=0&&!h.inFluid)return;var g=0!==h.resting[0],j=0!==h.resting[2];if(!g&&!j)return;var M=Math.abs(H[0]/H[2]),R=4;if(!g&&M>R)return;if(!j&&M<1/R)return;t.add(T,o.base,H);var k=D.testSolid;S(k,o,H,(function(D,h,o,H){if(1!==h)return!0;H[h]=0}));var K=o.base[1],Q=h.inFluid?1.951:1.001,v=Math.floor(K+Q)-K;t.set(Z,0,v,0);var r=!1;if(S(k,o,Z,(function(D,h,o,H){return r=!0,!0})),r)return;t.Nh(e,T,o.base),e[1]=0,O(D,o,e,L,!0);var B=P(o.base[0],T[0]),s=P(o.base[2],T[2]);if(g&&!B&&(!s||!j))return;if(j&&(!B||!g)&&!s)return;var U=!0;if(U=U&&!u(D,o.base[0]+1e-5,o.base[1],o.base[2]+1e-5),U=U&&!u(D,o.max[0]-1e-5,o.base[1],o.base[2]+1e-5),U=U&&!u(D,o.base[0]+1e-5,o.base[1],o.max[2]-1e-5),U=U&&!u(D,o.max[0]-1e-5,o.base[1],o.max[2]-1e-5),U)return;n(h.Jk,o),h.resting[0]=L[0],h.resting[2]=L[2],h.lr&&h.lr()}(D,h,E,U);for(var K=0;K<3;++K)h.resting[K]=h.resting[K]||q[K],B[K]=0,h.resting[K]&&(s[K]||(B[K]=-h.lS[K]),h.lS[K]=0);var c=t.length(B);c>.001&&(t.scale(B,B,h.Bg),h.gr&&h.gr(B),h.restitution>0&&c>D.minBounceImpulse&&(t.scale(B,B,h.restitution),h.applyImpulse(B)));var J=t.squaredLength(h.lS);J>1e-5&&h.CS();D.Ov&&D.Ov(h)?(h.loadFromCopy(y),h.rolledBackLastTick=!0):h.rolledBackLastTick=!1}(this,o,D,h)))};var i=t.create([0,0,0]);var G=t.create();function N(D,h,o,H,g){var j=o.resting[h],M=H[h];if(!o.alwaysApplyHorizFriction||1!==h){if(0===j)return;if(j*M<=0)return}t.i(J,o.lS),J[h]=0;var R=t.length(J);if(!P(R,0)){var S=Math.abs(o.friction*D.gravity[h]*g),k=R>S?(R-S)/R:0;o.lS[(h+1)%3]*=k,o.lS[(h+2)%3]*=k}}var J=t.create();function O(D,h,o,H,g){return t.set(H,0,0,0),S(D.testSolid,h,o,(function(D,h,o,j){H[h]=o,j[h]=0,g||(j[0]=0,j[1]=0,j[2]=0)}))}var E=new R([],[]),L=t.create(),T=t.create(),Z=t.create(),e=t.create();var p=t.create(),mD=new R([],[]),a=t.create();function u(D,h,o,H){return D.testSolid(Math.floor(h),Math.floor(o-1),Math.floor(H))}var I=t.create();function P(D,h){return Math.abs(D-h)<1e-5}function n(D,h){for(var o=0;o<3;o++)D.base[o]=h.base[o],D.max[o]=h.max[o],D.Yk[o]=h.Yk[o]}var F=function(D){}},13520:function(D,h){!function(D){"use strict";var h=function(D,o){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,h){D.__proto__=h}||function(D,h){for(var o in h)Object.prototype.hasOwnProperty.call(h,o)&&(D[o]=h[o])},h(D,o)};function o(D,o){if("function"!==typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function H(){this.constructor=D}h(D,o),D.prototype=null===o?Object.create(o):(H.prototype=o.prototype,new H)}function H(D,h,o,H){var g,j=arguments.length,M=j<3?h:null===H?H=Object.getOwnPropertyDescriptor(h,o):H;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)M=Reflect.decorate(D,h,o,H);else for(var R=D.length-1;R>=0;R--)(g=D[R])&&(M=(j<3?g(M):j>3?g(h,o,M):g(h,o))||M);return j>3&&M&&Object.defineProperty(h,o,M),M}function g(D,h,o){if(o||2===arguments.length)for(var H,g=0,j=h.length;g<j;g++)!H&&g in h||(H||(H=Array.prototype.slice.call(h,0,g)),H[g]=h[g]);return D.concat(H||Array.prototype.slice.call(h))}var j,M=255,R=213;D.OPERATION=void 0,(j=D.OPERATION||(D.OPERATION={}))[j.ADD=128]="ADD",j[j.REPLACE=0]="REPLACE",j[j.DELETE=64]="DELETE",j[j.DELETE_AND_ADD=192]="DELETE_AND_ADD",j[j.TOUCH=1]="TOUCH",j[j.CLEAR=10]="CLEAR";var t=function(){function h(D,h,o){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=D,this.setParent(h,o)}return h.prototype.setParent=function(D,h,o){var H=this;if(this.indexes||(this.indexes=this.ref instanceof eD?this.ref._definition.indexes:{}),this.parent=D,this.parentIndex=o,h)if(this.root=h,this.ref instanceof eD){var g=this.ref._definition;for(var j in g.schema){var M=this.ref[j];if(M&&M.$changes){var R=g.indexes[j];M.$changes.setParent(this.ref,h,R)}}}else"object"===typeof this.ref&&this.ref.forEach((function(D,h){if(D instanceof eD){var o=D.$changes,g=H.ref.$changes.indexes[h];o.setParent(H.ref,H.root,g)}}))},h.prototype.operation=function(D){this.changes.set(--this.currentCustomOperation,D)},h.prototype.change=function(h,o){void 0===o&&(o=D.OPERATION.ADD);var H="number"===typeof h?h:this.indexes[h];this.assertValidIndex(H,h);var g=this.changes.get(H);g&&g.op!==D.OPERATION.DELETE&&g.op!==D.OPERATION.TOUCH||this.changes.set(H,{op:g&&g.op===D.OPERATION.DELETE?D.OPERATION.DELETE_AND_ADD:o,index:H}),this.allChanges.add(H),this.changed=!0,this.touchParents()},h.prototype.touch=function(h){var o="number"===typeof h?h:this.indexes[h];this.assertValidIndex(o,h),this.changes.has(o)||this.changes.set(o,{op:D.OPERATION.TOUCH,index:o}),this.allChanges.add(o),this.touchParents()},h.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},h.prototype.getType=function(D){if(this.ref._definition)return(h=this.ref._definition).schema[h.fieldsByIndex[D]];var h,o=(h=this.parent._definition).schema[h.fieldsByIndex[this.parentIndex]];return Object.values(o)[0]},h.prototype.getChildrenFilter=function(){var D=this.parent._definition.childFilters;return D&&D[this.parentIndex]},h.prototype.getValue=function(D){return this.ref.getByIndex(D)},h.prototype.delete=function(h){var o="number"===typeof h?h:this.indexes[h];if(void 0!==o){var H=this.getValue(o);this.changes.set(o,{op:D.OPERATION.DELETE,index:o}),this.allChanges.delete(o),delete this.caches[o],H&&H.$changes&&(H.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(h," (").concat(o,")"))},h.prototype.discard=function(h,o){var H=this;void 0===h&&(h=!1),void 0===o&&(o=!1),this.ref instanceof eD||this.changes.forEach((function(h){if(h.op===D.OPERATION.DELETE){var o=H.ref.getIndex(h.index);delete H.indexes[o]}})),this.changes.clear(),this.changed=h,o&&this.allChanges.clear(),this.currentCustomOperation=0},h.prototype.discardAll=function(){var D=this;this.changes.forEach((function(h){var o=D.getValue(h.index);o&&o.$changes&&o.$changes.discardAll()})),this.discard()},h.prototype.cache=function(D,h){this.caches[D]=h},h.prototype.clone=function(){return new h(this.ref,this.parent,this.root)},h.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},h.prototype.assertValidIndex=function(D,h){if(void 0===D)throw new Error('ChangeTree: missing index for field "'.concat(h,'"'))},h}();function S(D,h,o,H){return D[h]||(D[h]=[]),D[h].push(o),null===H||void 0===H||H.forEach((function(D,h){return o(D,h)})),function(){return K(D[h],D[h].indexOf(o))}}function k(h){var o=this,H="string"!==typeof this.$changes.getType();this.$items.forEach((function(g,j){h.push({refId:o.$changes.refId,op:D.OPERATION.DELETE,field:j,value:void 0,previousValue:g}),H&&o.$changes.root.removeRef(g.$changes.refId)}))}function K(D,h){if(-1===h||h>=D.length)return!1;for(var o=D.length-1,H=h;H<o;H++)D[H]=D[H+1];return D.length=o,!0}var Q=function(D,h){var o=D.toString(),H=h.toString();return o<H?-1:o>H?1:0};function v(D){return D.$proxy=!0,D=new Proxy(D,{get:function(D,h){return"symbol"===typeof h||isNaN(h)?D[h]:D.at(h)},set:function(D,h,o){if("symbol"===typeof h||isNaN(h))D[h]=o;else{var H=Array.from(D.$items.keys()),g=parseInt(H[h]||h);void 0===o||null===o?D.deleteAt(g):D.setAt(g,o)}return!0},deleteProperty:function(D,h){return"number"===typeof h?D.deleteAt(h):delete D[h],!0}})}var r=function(){function h(){for(var D=[],h=0;h<arguments.length;h++)D[h]=arguments[h];this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,D)}return h.prototype.gt=function(h,o){return void 0===o&&(o=!0),S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.ADD,h,o?this.$items:void 0)},h.prototype.Rh=function(h){return S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,h)},h.is=function(D){return Array.isArray(D)||void 0!==D.array},Object.defineProperty(h.prototype,"length",{get:function(){return this.$items.size},set:function(D){0===D?this.clear():this.splice(D,this.length-D)},enumerable:!1,configurable:!0}),h.prototype.push=function(){for(var D,h=this,o=[],H=0;H<arguments.length;H++)o[H]=arguments[H];return o.forEach((function(o){D=h.$refId++,h.setAt(D,o)})),D},h.prototype.pop=function(){var D=Array.from(this.$indexes.values()).pop();if(void 0!==D){this.$changes.delete(D),this.$indexes.delete(D);var h=this.$items.get(D);return this.$items.delete(D),h}},h.prototype.at=function(D){var h=Array.from(this.$items.keys())[D];return this.$items.get(h)},h.prototype.setAt=function(h,o){var H,g;if(void 0!==o&&null!==o){if(this.$items.get(h)!==o){void 0!==o.$changes&&o.$changes.setParent(this,this.$changes.root,h);var j=null!==(g=null===(H=this.$changes.indexes[h])||void 0===H?void 0:H.op)&&void 0!==g?g:D.OPERATION.ADD;this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,o),this.$changes.change(h,j)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},h.prototype.deleteAt=function(D){var h=Array.from(this.$items.keys())[D];return void 0!==h&&this.$deleteAt(h)},h.prototype.$deleteAt=function(D){return this.$changes.delete(D),this.$indexes.delete(D),this.$items.delete(D)},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&k.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:D.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.concat=function(){for(var D,o=[],H=0;H<arguments.length;H++)o[H]=arguments[H];return new(h.bind.apply(h,g([void 0],(D=Array.from(this.$items.values())).concat.apply(D,o),!1)))},h.prototype.join=function(D){return Array.from(this.$items.values()).join(D)},h.prototype.reverse=function(){var D=this,h=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(o,H){D.setAt(h[H],o)})),this},h.prototype.shift=function(){var D=Array.from(this.$items.keys()).shift();if(void 0!==D){var h=this.$items.get(D);return this.$deleteAt(D),h}},h.prototype.slice=function(D,o){var H=new h;return H.push.apply(H,Array.from(this.$items.values()).slice(D,o)),H},h.prototype.sort=function(D){var h=this;void 0===D&&(D=Q);var o=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(D).forEach((function(D,H){h.setAt(o[H],D)})),this},h.prototype.splice=function(D,h){void 0===h&&(h=this.length-D);for(var o=Array.from(this.$items.keys()),H=[],g=D;g<D+h;g++)H.push(this.$items.get(o[g])),this.$deleteAt(o[g]);return H},h.prototype.unshift=function(){for(var D=this,h=[],o=0;o<arguments.length;o++)h[o]=arguments[o];var H=this.length,g=h.length,j=Array.from(this.$items.values());return h.forEach((function(h,o){D.setAt(o,h)})),j.forEach((function(h,o){D.setAt(g+o,h)})),H+g},h.prototype.indexOf=function(D,h){return Array.from(this.$items.values()).indexOf(D,h)},h.prototype.lastIndexOf=function(D,h){return void 0===h&&(h=this.length-1),Array.from(this.$items.values()).lastIndexOf(D,h)},h.prototype.every=function(D,h){return Array.from(this.$items.values()).every(D,h)},h.prototype.some=function(D,h){return Array.from(this.$items.values()).some(D,h)},h.prototype.forEach=function(D,h){Array.from(this.$items.values()).forEach(D,h)},h.prototype.map=function(D,h){return Array.from(this.$items.values()).map(D,h)},h.prototype.filter=function(D,h){return Array.from(this.$items.values()).filter(D,h)},h.prototype.reduce=function(D,h){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},h.prototype.reduceRight=function(D,h){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},h.prototype.find=function(D,h){return Array.from(this.$items.values()).find(D,h)},h.prototype.findIndex=function(D,h){return Array.from(this.$items.values()).findIndex(D,h)},h.prototype.fill=function(D,h,o){throw new Error("ArraySchema#fill() not implemented")},h.prototype.copyWithin=function(D,h,o){throw new Error("ArraySchema#copyWithin() not implemented")},h.prototype.toString=function(){return this.$items.toString()},h.prototype.toLocaleString=function(){return this.$items.toLocaleString()},h.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(h,Symbol.species,{get:function(){return h},enumerable:!1,configurable:!0}),h.prototype.entries=function(){return this.$items.entries()},h.prototype.keys=function(){return this.$items.keys()},h.prototype.values=function(){return this.$items.values()},h.prototype.includes=function(D,h){return Array.from(this.$items.values()).includes(D,h)},h.prototype.flatMap=function(D,h){throw new Error("ArraySchema#flatMap() is not supported.")},h.prototype.flat=function(D){throw new Error("ArraySchema#flat() is not supported.")},h.prototype.findLast=function(){var D=Array.from(this.$items.values());return D.findLast.apply(D,arguments)},h.prototype.findLastIndex=function(){var D=Array.from(this.$items.values());return D.findLastIndex.apply(D,arguments)},h.prototype.setIndex=function(D,h){this.$indexes.set(D,h)},h.prototype.getIndex=function(D){return this.$indexes.get(D)},h.prototype.getByIndex=function(D){return this.$items.get(this.$indexes.get(D))},h.prototype.deleteByIndex=function(D){var h=this.$indexes.get(D);this.$items.delete(h),this.$indexes.delete(D)},h.prototype.toArray=function(){return Array.from(this.$items.values())},h.prototype.toJSON=function(){return this.toArray().map((function(D){return"function"===typeof D.toJSON?D.toJSON():D}))},h.prototype.clone=function(D){return D?new(h.bind.apply(h,g([void 0],Array.from(this.$items.values()),!1))):new(h.bind.apply(h,g([void 0],this.map((function(D){return D.$changes?D.clone():D})),!1)))},h}();function B(D){return D.$proxy=!0,D=new Proxy(D,{get:function(D,h){return"symbol"!==typeof h&&"undefined"===typeof D[h]?D.get(h):D[h]},set:function(D,h,o){return"symbol"!==typeof h&&-1===h.indexOf("$")&&"gt"!==h&&"Rh"!==h&&"onChange"!==h?D.set(h,o):D[h]=o,!0},deleteProperty:function(D,h){return D.delete(h),!0}})}var s=function(){function h(D){var o=this;if(this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,D)if(D instanceof Map||D instanceof h)D.forEach((function(D,h){return o.set(h,D)}));else for(var H in D)this.set(H,D[H])}return h.prototype.gt=function(h,o){return void 0===o&&(o=!0),S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.ADD,h,o?this.$items:void 0)},h.prototype.Rh=function(h){return S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,h)},h.is=function(D){return void 0!==D.map},h.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(h.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(h,Symbol.species,{get:function(){return h},enumerable:!1,configurable:!0}),h.prototype.set=function(h,o){if(void 0===o||null===o)throw new Error("MapSchema#set('".concat(h,"', ").concat(o,"): trying to set ").concat(o," value on '").concat(h,"'."));h=h.toString();var H="undefined"!==typeof this.$changes.indexes[h],g=H?this.$changes.indexes[h]:this.$refId++,j=H?D.OPERATION.REPLACE:D.OPERATION.ADD,M=void 0!==o.$changes;if(M&&o.$changes.setParent(this,this.$changes.root,g),H){if(!M&&this.$items.get(h)===o)return;M&&this.$items.get(h)!==o&&(j=D.OPERATION.ADD)}else this.$changes.indexes[h]=g,this.$indexes.set(g,h);return this.$items.set(h,o),this.$changes.change(h,j),this},h.prototype.get=function(D){return this.$items.get(D)},h.prototype.delete=function(D){return this.$changes.delete(D),this.$items.delete(D)},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&k.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:D.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.has=function(D){return this.$items.has(D)},h.prototype.forEach=function(D){this.$items.forEach(D)},h.prototype.entries=function(){return this.$items.entries()},h.prototype.keys=function(){return this.$items.keys()},h.prototype.values=function(){return this.$items.values()},Object.defineProperty(h.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),h.prototype.setIndex=function(D,h){this.$indexes.set(D,h)},h.prototype.getIndex=function(D){return this.$indexes.get(D)},h.prototype.getByIndex=function(D){return this.$items.get(this.$indexes.get(D))},h.prototype.deleteByIndex=function(D){var h=this.$indexes.get(D);this.$items.delete(h),this.$indexes.delete(D)},h.prototype.toJSON=function(){var D={};return this.forEach((function(h,o){D[o]="function"===typeof h.toJSON?h.toJSON():h})),D},h.prototype.clone=function(D){var o;return D?o=Object.assign(new h,this):(o=new h,this.forEach((function(D,h){D.$changes?o.set(h,D.clone()):o.set(h,D)}))),o},h}(),U={};function q(D,h){U[D]=h}function c(D){return U[D]}var y=function(){function D(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return D.create=function(h){var o=new D;return o.schema=Object.assign({},h&&h.schema||{}),o.indexes=Object.assign({},h&&h.indexes||{}),o.fieldsByIndex=Object.assign({},h&&h.fieldsByIndex||{}),o.descriptors=Object.assign({},h&&h.descriptors||{}),o.deprecated=Object.assign({},h&&h.deprecated||{}),o},D.prototype.addField=function(D,h){var o=this.getNextFieldIndex();this.fieldsByIndex[o]=D,this.indexes[D]=o,this.schema[D]=Array.isArray(h)?{array:h[0]}:h},D.prototype.hasField=function(D){return void 0!==this.indexes[D]},D.prototype.addFilter=function(D,h){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[D]]=h,this.indexesWithFilters.push(this.indexes[D]),!0},D.prototype.addChildrenFilter=function(D,h){var o=this.indexes[D],H=this.schema[D];if(c(Object.keys(H)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[o]=h,!0;console.warn("@filterChildren: field '".concat(D,"' can't have children. Ignoring filter."))},D.prototype.getChildrenFilter=function(D){return this.childFilters&&this.childFilters[this.indexes[D]]},D.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},D}();function b(D){return D._context&&D._context.useFilters}var i=function(){function D(){this.types={},this.schemas=new Map,this.useFilters=!1}return D.prototype.has=function(D){return this.schemas.has(D)},D.prototype.get=function(D){return this.types[D]},D.prototype.add=function(D,h){void 0===h&&(h=this.schemas.size),D._definition=y.create(D._definition),D._typeid=h,this.types[h]=D,this.schemas.set(D,h)},D.create=function(h){return void 0===h&&(h={}),function(o){return h.context||(h.context=new D),N(o,h)}},D}(),G=new i;function N(D,h){return void 0===h&&(h={}),function(o,H){var j=h.context||G,M=o.constructor;if(M._context=j,!D)throw new Error("".concat(M.name,': @type() reference provided for "').concat(H,"\" is undefined. Make sure you don't have any circular dependencies."));j.has(M)||j.add(M);var R=M._definition;if(R.addField(H,D),R.descriptors[H]){if(R.deprecated[H])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(H,"' definition on '").concat(M.name,"'.\nCheck @type() annotation"))}catch(U){var t=U.stack.split("\n")[4].trim();throw new Error("".concat(U.message," ").concat(t))}}var S=r.is(D),k=!S&&s.is(D);if("string"!==typeof D&&!eD.is(D)){var K=Object.values(D)[0];"string"===typeof K||j.has(K)||j.add(K)}if(h.manual)R.descriptors[H]={enumerable:!0,configurable:!0,writable:!0};else{var Q="_".concat(H);R.descriptors[Q]={enumerable:!1,configurable:!1,writable:!0},R.descriptors[H]={get:function(){return this[Q]},set:function(D){D!==this[Q]&&(void 0!==D&&null!==D?(!S||D instanceof r||(D=new(r.bind.apply(r,g([void 0],D,!1)))),!k||D instanceof s||(D=new s(D)),void 0===D.$proxy&&(k?D=B(D):S&&(D=v(D))),this.$changes.change(H),D.$changes&&D.$changes.setParent(this,this.$changes.root,this._definition.indexes[H])):this[Q]&&this.$changes.delete(H),this[Q]=D)},enumerable:!0,configurable:!0}}}}function J(D){return function(h,o){var H=h.constructor;H._definition.addFilter(o,D)&&(H._context.useFilters=!0)}}function O(D){return function(h,o){var H=h.constructor;H._definition.addChildrenFilter(o,D)&&(H._context.useFilters=!0)}}function E(D){return void 0===D&&(D=!0),function(h,o){var H=h.constructor._definition;H.deprecated[o]=!0,D&&(H.descriptors[o]={get:function(){throw new Error("".concat(o," is deprecated."))},set:function(D){},enumerable:!1,configurable:!0})}}function L(D,h,o){for(var H in void 0===o&&(o={}),o.context||(o.context=D._context||o.context||G),h)N(h[H],o)(D.prototype,H);return D}function T(D){for(var h=0,o=0,H=0,g=D.length;H<g;H++)(h=D.charCodeAt(H))<128?o+=1:h<2048?o+=2:h<55296||h>=57344?o+=3:(H++,o+=4);return o}function Z(D,h,o){for(var H=0,g=0,j=o.length;g<j;g++)(H=o.charCodeAt(g))<128?D[h++]=H:H<2048?(D[h++]=192|H>>6,D[h++]=128|63&H):H<55296||H>=57344?(D[h++]=224|H>>12,D[h++]=128|H>>6&63,D[h++]=128|63&H):(g++,H=65536+((1023&H)<<10|1023&o.charCodeAt(g)),D[h++]=240|H>>18,D[h++]=128|H>>12&63,D[h++]=128|H>>6&63,D[h++]=128|63&H)}function e(D,h){D.push(255&h)}function p(D,h){D.push(255&h)}function mD(D,h){D.push(255&h),D.push(h>>8&255)}function a(D,h){D.push(255&h),D.push(h>>8&255)}function u(D,h){D.push(255&h),D.push(h>>8&255),D.push(h>>16&255),D.push(h>>24&255)}function I(D,h){var o=h>>24,H=h>>16,g=h>>8,j=h;D.push(255&j),D.push(255&g),D.push(255&H),D.push(255&o)}function P(D,h){var o=Math.floor(h/Math.pow(2,32));I(D,h>>>0),I(D,o)}function n(D,h){var o=h/Math.pow(2,32)|0;I(D,h>>>0),I(D,o)}function F(D,h){z(D,h)}function w(D,h){f(D,h)}var Y=new Int32Array(2),l=new Float32Array(Y.buffer),C=new Float64Array(Y.buffer);function z(D,h){l[0]=h,u(D,Y[0])}function f(D,h){C[0]=h,u(D,Y[0]),u(D,Y[1])}function V(D,h){return p(D,h?1:0)}function d(D,h){h||(h="");var o=T(h),H=0;if(o<32)D.push(160|o),H=1;else if(o<256)D.push(217),p(D,o),H=2;else if(o<65536)D.push(218),a(D,o),H=3;else{if(!(o<4294967296))throw new Error("String too long");D.push(219),I(D,o),H=5}return Z(D,D.length,h),H+o}function X(D,h){return isNaN(h)?X(D,0):isFinite(h)?h!==(0|h)?(D.push(203),f(D,h),9):h>=0?h<128?(p(D,h),1):h<256?(D.push(204),p(D,h),2):h<65536?(D.push(205),a(D,h),3):h<4294967296?(D.push(206),I(D,h),5):(D.push(207),n(D,h),9):h>=-32?(D.push(224|h+32),1):h>=-128?(D.push(208),e(D,h),2):h>=-32768?(D.push(209),mD(D,h),3):h>=-2147483648?(D.push(210),u(D,h),5):(D.push(211),P(D,h),9):X(D,h>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var A=Object.freeze({__proto__:null,utf8Write:Z,int8:e,uint8:p,int16:mD,uint16:a,int32:u,uint32:I,int64:P,uint64:n,float32:F,float64:w,writeFloat32:z,writeFloat64:f,boolean:V,string:d,number:X});function W(D,h,o){for(var H="",g=0,j=h,M=h+o;j<M;j++){var R=D[j];0!==(128&R)?192!==(224&R)?224!==(240&R)?240!==(248&R)?console.error("Invalid byte "+R.toString(16)):(g=(7&R)<<18|(63&D[++j])<<12|(63&D[++j])<<6|63&D[++j])>=65536?(g-=65536,H+=String.fromCharCode(55296+(g>>>10),56320+(1023&g))):H+=String.fromCharCode(g):H+=String.fromCharCode((15&R)<<12|(63&D[++j])<<6|63&D[++j]):H+=String.fromCharCode((31&R)<<6|63&D[++j]):H+=String.fromCharCode(R)}return H}function x(D,h){return DD(D,h)<<24>>24}function DD(D,h){return D[h.offset++]}function hD(D,h){return oD(D,h)<<16>>16}function oD(D,h){return D[h.offset++]|D[h.offset++]<<8}function HD(D,h){return D[h.offset++]|D[h.offset++]<<8|D[h.offset++]<<16|D[h.offset++]<<24}function gD(D,h){return HD(D,h)>>>0}function jD(D,h){return QD(D,h)}function MD(D,h){return vD(D,h)}function RD(D,h){var o=gD(D,h);return HD(D,h)*Math.pow(2,32)+o}function tD(D,h){var o=gD(D,h);return gD(D,h)*Math.pow(2,32)+o}var SD=new Int32Array(2),kD=new Float32Array(SD.buffer),KD=new Float64Array(SD.buffer);function QD(D,h){return SD[0]=HD(D,h),kD[0]}function vD(D,h){return SD[0]=HD(D,h),SD[1]=HD(D,h),KD[0]}function rD(D,h){return DD(D,h)>0}function BD(D,h){var o,H=D[h.offset++];H<192?o=31&H:217===H?o=DD(D,h):218===H?o=oD(D,h):219===H&&(o=gD(D,h));var g=W(D,h.offset,o);return h.offset+=o,g}function sD(D,h){var o=D[h.offset];return o<192&&o>160||217===o||218===o||219===o}function UD(D,h){var o=D[h.offset++];return o<128?o:202===o?QD(D,h):203===o?vD(D,h):204===o?DD(D,h):205===o?oD(D,h):206===o?gD(D,h):207===o?tD(D,h):208===o?x(D,h):209===o?hD(D,h):210===o?HD(D,h):211===o?RD(D,h):o>223?-1*(255-o+1):void 0}function qD(D,h){var o=D[h.offset];return o<128||o>=202&&o<=211}function cD(D,h){return D[h.offset]<160}function yD(D,h){return D[h.offset-1]===M&&(D[h.offset]<128||D[h.offset]>=202&&D[h.offset]<=211)}var bD=Object.freeze({__proto__:null,int8:x,uint8:DD,int16:hD,uint16:oD,int32:HD,uint32:gD,float32:jD,float64:MD,int64:RD,uint64:tD,readFloat32:QD,readFloat64:vD,boolean:rD,string:BD,stringCheck:sD,number:UD,numberCheck:qD,arrayCheck:cD,switchStructureCheck:yD}),iD=function(){function h(D){var h=this;this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,D&&D.forEach((function(D){return h.add(D)}))}return h.prototype.gt=function(h,o){return void 0===o&&(o=!0),S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.ADD,h,o?this.$items:void 0)},h.prototype.Rh=function(h){return S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,h)},h.is=function(D){return void 0!==D.collection},h.prototype.add=function(D){var h=this.$refId++;return void 0!==D.$changes&&D.$changes.setParent(this,this.$changes.root,h),this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,D),this.$changes.change(h),h},h.prototype.at=function(D){var h=Array.from(this.$items.keys())[D];return this.$items.get(h)},h.prototype.entries=function(){return this.$items.entries()},h.prototype.delete=function(D){for(var h,o,H=this.$items.entries();(o=H.next())&&!o.done;)if(D===o.value[1]){h=o.value[0];break}return void 0!==h&&(this.$changes.delete(h),this.$indexes.delete(h),this.$items.delete(h))},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&k.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:D.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.has=function(D){return Array.from(this.$items.values()).some((function(h){return h===D}))},h.prototype.forEach=function(D){var h=this;this.$items.forEach((function(o,H,g){return D(o,H,h)}))},h.prototype.values=function(){return this.$items.values()},Object.defineProperty(h.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),h.prototype.setIndex=function(D,h){this.$indexes.set(D,h)},h.prototype.getIndex=function(D){return this.$indexes.get(D)},h.prototype.getByIndex=function(D){return this.$items.get(this.$indexes.get(D))},h.prototype.deleteByIndex=function(D){var h=this.$indexes.get(D);this.$items.delete(h),this.$indexes.delete(D)},h.prototype.toArray=function(){return Array.from(this.$items.values())},h.prototype.toJSON=function(){var D=[];return this.forEach((function(h,o){D.push("function"===typeof h.toJSON?h.toJSON():h)})),D},h.prototype.clone=function(D){var o;return D?o=Object.assign(new h,this):(o=new h,this.forEach((function(D){D.$changes?o.add(D.clone()):o.add(D)}))),o},h}(),GD=function(){function h(D){var h=this;this.$changes=new t(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,D&&D.forEach((function(D){return h.add(D)}))}return h.prototype.gt=function(h,o){return void 0===o&&(o=!0),S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.ADD,h,o?this.$items:void 0)},h.prototype.Rh=function(h){return S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,h)},h.is=function(D){return void 0!==D.set},h.prototype.add=function(h){var o,H;if(this.has(h))return!1;var g=this.$refId++;void 0!==h.$changes&&h.$changes.setParent(this,this.$changes.root,g);var j=null!==(H=null===(o=this.$changes.indexes[g])||void 0===o?void 0:o.op)&&void 0!==H?H:D.OPERATION.ADD;return this.$changes.indexes[g]=g,this.$indexes.set(g,g),this.$items.set(g,h),this.$changes.change(g,j),g},h.prototype.entries=function(){return this.$items.entries()},h.prototype.delete=function(D){for(var h,o,H=this.$items.entries();(o=H.next())&&!o.done;)if(D===o.value[1]){h=o.value[0];break}return void 0!==h&&(this.$changes.delete(h),this.$indexes.delete(h),this.$items.delete(h))},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&k.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:D.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.has=function(D){for(var h,o=this.$items.values(),H=!1;(h=o.next())&&!h.done;)if(D===h.value){H=!0;break}return H},h.prototype.forEach=function(D){var h=this;this.$items.forEach((function(o,H,g){return D(o,H,h)}))},h.prototype.values=function(){return this.$items.values()},Object.defineProperty(h.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),h.prototype.setIndex=function(D,h){this.$indexes.set(D,h)},h.prototype.getIndex=function(D){return this.$indexes.get(D)},h.prototype.getByIndex=function(D){return this.$items.get(this.$indexes.get(D))},h.prototype.deleteByIndex=function(D){var h=this.$indexes.get(D);this.$items.delete(h),this.$indexes.delete(D)},h.prototype.toArray=function(){return Array.from(this.$items.values())},h.prototype.toJSON=function(){var D=[];return this.forEach((function(h,o){D.push("function"===typeof h.toJSON?h.toJSON():h)})),D},h.prototype.clone=function(D){var o;return D?o=Object.assign(new h,this):(o=new h,this.forEach((function(D){D.$changes?o.add(D.clone()):o.add(D)}))),o},h}(),ND=function(){function D(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return D.prototype.addRefId=function(D){this.refIds.has(D)||(this.refIds.add(D),this.containerIndexes.set(D,new Set))},D.get=function(h){return void 0===h.$filterState&&(h.$filterState=new D),h.$filterState},D}(),JD=function(){function D(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return D.prototype.getNextUniqueId=function(){return this.nextUniqueId++},D.prototype.addRef=function(D,h,o){void 0===o&&(o=!0),this.refs.set(D,h),o&&(this.refCounts[D]=(this.refCounts[D]||0)+1)},D.prototype.removeRef=function(D){this.refCounts[D]=this.refCounts[D]-1,this.deletedRefs.add(D)},D.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},D.prototype.garbageCollectDeletedRefs=function(){var D=this;this.deletedRefs.forEach((function(h){if(!(D.refCounts[h]>0)){var o=D.refs.get(h);if(o instanceof eD)for(var H in o._definition.schema)"string"!==typeof o._definition.schema[H]&&o[H]&&o[H].$changes&&D.removeRef(o[H].$changes.refId);else{var g=o.$changes.parent._definition,j=g.schema[g.fieldsByIndex[o.$changes.parentIndex]];"function"===typeof Object.values(j)[0]&&Array.from(o.values()).forEach((function(h){return D.removeRef(h.$changes.refId)}))}D.refs.delete(h),delete D.refCounts[h]}})),this.deletedRefs.clear()},D}(),OD=function(D){function h(){return null!==D&&D.apply(this,arguments)||this}return o(h,D),h}(Error);function ED(D,h,o,H){var g,j=!1;switch(h){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":g="number",isNaN(D)&&console.log('trying to encode "NaN" in '.concat(o.constructor.name,"#").concat(H));break;case"string":g="string",j=!0;break;case"boolean":return}if(typeof D!==g&&(!j||j&&null!==D)){var M="'".concat(JSON.stringify(D),"'").concat(D&&D.constructor&&" (".concat(D.constructor.name,")")||"");throw new OD("a '".concat(g,"' was expected, but ").concat(M," was provided in ").concat(o.constructor.name,"#").concat(H))}}function LD(D,h,o,H){if(!(D instanceof h))throw new OD("a '".concat(h.name,"' was expected, but '").concat(D.constructor.name,"' was provided in ").concat(o.constructor.name,"#").concat(H))}function TD(D,h,o,H,g){ED(o,D,H,g);var j=A[D];if(!j)throw new OD("a '".concat(D,"' was expected, but ").concat(o," was provided in ").concat(H.constructor.name,"#").concat(g));j(h,o)}function ZD(D,h,o){return bD[D](h,o)}var eD=function(){function h(){for(var D=[],h=0;h<arguments.length;h++)D[h]=arguments[h];Object.defineProperties(this,{$changes:{value:new t(this,void 0,new JD),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var o=this._definition.descriptors;o&&Object.defineProperties(this,o),D[0]&&this.assign(D[0])}return h.onError=function(D){console.error(D)},h.is=function(D){return D._definition&&void 0!==D._definition.schema},h.prototype.onChange=function(h){return S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.REPLACE,h)},h.prototype.Rh=function(h){return S(this.$callbacks||(this.$callbacks=[]),D.OPERATION.DELETE,h)},h.prototype.assign=function(D){return Object.assign(this,D),this},Object.defineProperty(h.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),h.prototype.setDirty=function(D,h){this.$changes.change(D,h)},h.prototype.listen=function(D,h,o){var H=this;return void 0===o&&(o=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[D]||(this.$callbacks[D]=[]),this.$callbacks[D].push(h),o&&void 0!==this[D]&&h(this[D],void 0),function(){return K(H.$callbacks[D],H.$callbacks[D].indexOf(h))}},h.prototype.decode=function(o,H,g){var j;void 0===H&&(H={offset:0}),void 0===g&&(g=this);var R=[],t=this.$changes.root,S=o.length,k=0;for(t.refs.set(k,this);H.offset<S;){var K=o[H.offset++];if(K!=M){var Q=g.$changes,v=void 0!==g._definition,B=v?K>>6<<6:K;if(B!==D.OPERATION.CLEAR){var U=v?K%(B||255):UD(o,H),q=v?g._definition.fieldsByIndex[U]:"",y=Q.getType(U),b=void 0,i=void 0,G=void 0;if(v?i=g["_".concat(q)]:(i=g.getByIndex(U),(B&D.OPERATION.ADD)===D.OPERATION.ADD?(G=g instanceof s?BD(o,H):U,g.setIndex(U,G)):G=g.getIndex(U)),(B&D.OPERATION.DELETE)===D.OPERATION.DELETE&&(B!==D.OPERATION.DELETE_AND_ADD&&g.deleteByIndex(U),i&&i.$changes&&t.removeRef(i.$changes.refId),b=null),void 0!==q){if(B===D.OPERATION.DELETE);else if(h.is(y)){var N=UD(o,H);if(b=t.refs.get(N),B!==D.OPERATION.REPLACE){var J=this.getSchemaType(o,H,y);b||((b=this.createTypeInstance(J)).$changes.refId=N,i&&(b.$callbacks=i.$callbacks,i.$changes.refId&&N!==i.$changes.refId&&t.removeRef(i.$changes.refId))),t.addRef(N,b,b!==i)}}else if("string"===typeof y)b=ZD(y,o,H);else{var O=c(Object.keys(y)[0]),E=UD(o,H),L=t.refs.has(E)?i||t.refs.get(E):new O.constructor;if((b=L.clone(!0)).$changes.refId=E,i&&(b.$callbacks=i.$callbacks,i.$changes.refId&&E!==i.$changes.refId)){t.removeRef(i.$changes.refId);for(var T=i.entries(),Z=void 0;(Z=T.next())&&!Z.done;){var e=(j=Z.value)[0],p=j[1];R.push({refId:E,op:D.OPERATION.DELETE,field:e,value:void 0,previousValue:p})}}t.addRef(E,b,L!==i)}if(null!==b&&void 0!==b)if(b.$changes&&b.$changes.setParent(Q.ref,Q.root,U),g instanceof h)g[q]=b;else if(g instanceof s)e=G,g.$items.set(e,b),g.$changes.allChanges.add(U);else if(g instanceof r)g.setAt(U,b);else if(g instanceof iD){var mD=g.add(b);g.setIndex(U,mD)}else g instanceof GD&&!1!==(mD=g.add(b))&&g.setIndex(U,mD);i!==b&&R.push({refId:k,op:B,field:q,dynamicIndex:G,value:b,previousValue:i})}else{console.warn("@colyseus/schema: definition mismatch");for(var a={offset:H.offset};H.offset<S&&(!yD(o,H)||(a.offset=H.offset+1,!t.refs.has(UD(o,a))));)H.offset++}}else g.clear(R)}else{k=UD(o,H);var u=t.refs.get(k);if(!u)throw new Error('"refId" not found: '.concat(k));g=u}}return this._triggerChanges(R),t.garbageCollectDeletedRefs(),R},h.prototype.encode=function(o,H,g){void 0===o&&(o=!1),void 0===H&&(H=[]),void 0===g&&(g=!1);for(var j=this.$changes,R=new WeakSet,t=[j],S=1,k=0;k<S;k++){var K=t[k],Q=K.ref,v=Q instanceof h;K.ensureRefId(),R.add(K),K!==j&&(K.changed||o)&&(p(H,M),X(H,K.refId));for(var r=o?Array.from(K.allChanges):Array.from(K.changes.values()),B=0,U=r.length;B<U;B++){var q=o?{op:D.OPERATION.ADD,index:r[B]}:r[B],y=q.index,b=v?Q._definition.fieldsByIndex&&Q._definition.fieldsByIndex[y]:y,i=H.length;if(q.op!==D.OPERATION.TOUCH)if(v)p(H,y|q.op);else{if(p(H,q.op),q.op===D.OPERATION.CLEAR)continue;X(H,y)}if(v||(q.op&D.OPERATION.ADD)!=D.OPERATION.ADD||Q instanceof s&&d(H,K.ref.$indexes.get(y)),q.op!==D.OPERATION.DELETE){var G=K.getType(y),N=K.getValue(y);if(N&&N.$changes&&!R.has(N.$changes)&&(t.push(N.$changes),N.$changes.ensureRefId(),S++),q.op!==D.OPERATION.TOUCH){if(h.is(G))LD(N,G,Q,b),X(H,N.$changes.refId),(q.op&D.OPERATION.ADD)===D.OPERATION.ADD&&this.tryEncodeTypeId(H,G,N.constructor);else if("string"===typeof G)TD(G,H,N,Q,b);else{var J=c(Object.keys(G)[0]);LD(Q["_".concat(b)],J.constructor,Q,b),X(H,N.$changes.refId)}g&&K.cache(y,H.slice(i))}}}o||g||K.discard()}return H},h.prototype.encodeAll=function(D){return this.encode(!0,[],D)},h.prototype.applyFilters=function(o,H){var g,j;void 0===H&&(H=!1);for(var R=this,t=new Set,S=ND.get(o),k=[this.$changes],K=1,Q=[],v=function(v){var r=k[v];if(t.has(r.refId))return"continue";var B=r.ref,U=B instanceof h;p(Q,M),X(Q,r.refId);var q=S.refIds.has(r),c=H||!q;S.addRefId(r);var y=S.containerIndexes.get(r),b=c?Array.from(r.allChanges):Array.from(r.changes.values());!H&&U&&B._definition.indexesWithFilters&&B._definition.indexesWithFilters.forEach((function(h){!y.has(h)&&r.allChanges.has(h)&&(c?b.push(h):b.push({op:D.OPERATION.ADD,index:h}))}));for(var i=0,G=b.length;i<G;i++){var N=c?{op:D.OPERATION.ADD,index:b[i]}:b[i];if(N.op!==D.OPERATION.CLEAR){var J=N.index;if(N.op!==D.OPERATION.DELETE){var O=r.getValue(J),E=r.getType(J);if(U){if((L=B._definition.filters&&B._definition.filters[J])&&!L.call(B,o,O,R)){O&&O.$changes&&t.add(O.$changes.refId);continue}}else{var L,T=r.parent;if((L=r.getChildrenFilter())&&!L.call(T,o,B.$indexes.get(J),O,R)){O&&O.$changes&&t.add(O.$changes.refId);continue}}if(O.$changes&&(k.push(O.$changes),K++),N.op!==D.OPERATION.TOUCH)if(N.op===D.OPERATION.ADD||U)Q.push.apply(Q,null!==(g=r.caches[J])&&void 0!==g?g:[]),y.add(J);else if(y.has(J))Q.push.apply(Q,null!==(j=r.caches[J])&&void 0!==j?j:[]);else{if(y.add(J),p(Q,D.OPERATION.ADD),X(Q,J),B instanceof s){var Z=r.ref.$indexes.get(J);d(Q,Z)}O.$changes?X(Q,O.$changes.refId):A[E](Q,O)}else O.$changes&&!U&&(p(Q,D.OPERATION.ADD),X(Q,J),B instanceof s&&(Z=r.ref.$indexes.get(J),d(Q,Z)),X(Q,O.$changes.refId))}else U?p(Q,N.op|J):(p(Q,N.op),X(Q,J))}else p(Q,N.op)}},r=0;r<K;r++)v(r);return Q},h.prototype.clone=function(){var D,h=new this.constructor,o=this._definition.schema;for(var H in o)"object"===typeof this[H]&&"function"===typeof(null===(D=this[H])||void 0===D?void 0:D.clone)?h[H]=this[H].clone():h[H]=this[H];return h},h.prototype.toJSON=function(){var D=this._definition.schema,h=this._definition.deprecated,o={};for(var H in D)h[H]||null===this[H]||"undefined"===typeof this[H]||(o[H]="function"===typeof this[H].toJSON?this[H].toJSON():this["_".concat(H)]);return o},h.prototype.discardAllChanges=function(){this.$changes.discardAll()},h.prototype.getByIndex=function(D){return this[this._definition.fieldsByIndex[D]]},h.prototype.deleteByIndex=function(D){this[this._definition.fieldsByIndex[D]]=void 0},h.prototype.tryEncodeTypeId=function(D,h,o){h._typeid!==o._typeid&&(p(D,R),X(D,o._typeid))},h.prototype.getSchemaType=function(D,h,o){var H;return D[h.offset]===R&&(h.offset++,H=this.constructor._context.get(UD(D,h))),H||o},h.prototype.createTypeInstance=function(D){var h=new D;return h.$changes.root=this.$changes.root,h},h.prototype._triggerChanges=function(o){for(var H,g,j,M,R,t,S,k,K,Q=new Set,v=this.$changes.root.refs,r=function(r){var B=o[r],s=B.refId,U=v.get(s),q=U.$callbacks;if((B.op&D.OPERATION.DELETE)===D.OPERATION.DELETE&&B.previousValue instanceof h&&(null===(g=null===(H=B.previousValue.$callbacks)||void 0===H?void 0:H[D.OPERATION.DELETE])||void 0===g||g.forEach((function(D){return D()}))),!q)return"continue";if(U instanceof h){if(!Q.has(s))try{null===(j=null===q||void 0===q?void 0:q[D.OPERATION.REPLACE])||void 0===j||j.forEach((function(D){return D()}))}catch(c){h.onError(c)}try{q.hasOwnProperty(B.field)&&(null===(M=q[B.field])||void 0===M||M.forEach((function(D){return D(B.value,B.previousValue)})))}catch(c){h.onError(c)}}else B.op===D.OPERATION.ADD&&void 0===B.previousValue?null===(R=q[D.OPERATION.ADD])||void 0===R||R.forEach((function(D){var h;return D(B.value,null!==(h=B.dynamicIndex)&&void 0!==h?h:B.field)})):B.op===D.OPERATION.DELETE?void 0!==B.previousValue&&(null===(t=q[D.OPERATION.DELETE])||void 0===t||t.forEach((function(D){var h;return D(B.previousValue,null!==(h=B.dynamicIndex)&&void 0!==h?h:B.field)}))):B.op===D.OPERATION.DELETE_AND_ADD&&(void 0!==B.previousValue&&(null===(S=q[D.OPERATION.DELETE])||void 0===S||S.forEach((function(D){var h;return D(B.previousValue,null!==(h=B.dynamicIndex)&&void 0!==h?h:B.field)}))),null===(k=q[D.OPERATION.ADD])||void 0===k||k.forEach((function(D){var h;return D(B.value,null!==(h=B.dynamicIndex)&&void 0!==h?h:B.field)}))),B.value!==B.previousValue&&(null===(K=q[D.OPERATION.REPLACE])||void 0===K||K.forEach((function(D){var h;return D(B.value,null!==(h=B.dynamicIndex)&&void 0!==h?h:B.field)})));Q.add(s)},B=0;B<o.length;B++)r(B)},h._definition=y.create(),h}();function pD(D){for(var h=[D.$changes],o=1,H={},g=H,j=function(D){var o=h[D];o.changes.forEach((function(D){var h=o.ref,H=D.index,j=h._definition?h._definition.fieldsByIndex[H]:h.$indexes.get(H);g[j]=o.getValue(H)}))},M=0;M<o;M++)j(M);return H}var mh={context:new i},aD=function(D){function h(){return null!==D&&D.apply(this,arguments)||this}return o(h,D),H([N("string",mh)],h.prototype,"name",void 0),H([N("string",mh)],h.prototype,"type",void 0),H([N("number",mh)],h.prototype,"referencedType",void 0),h}(eD),uD=function(D){function h(){var h=null!==D&&D.apply(this,arguments)||this;return h.fields=new r,h}return o(h,D),H([N("number",mh)],h.prototype,"id",void 0),H([N([aD],mh)],h.prototype,"fields",void 0),h}(eD),ID=function(D){function h(){var h=null!==D&&D.apply(this,arguments)||this;return h.types=new r,h}return o(h,D),h.encode=function(D){var o=D.constructor,H=new h;H.rootType=o._typeid;var g=function(D,h){for(var o in h){var g=new aD;g.name=o;var j=void 0;if("string"===typeof h[o])j=h[o];else{var M=h[o],R=void 0;eD.is(M)?(j="ref",R=h[o]):"string"===typeof M[j=Object.keys(M)[0]]?j+=":"+M[j]:R=M[j],g.referencedType=R?R._typeid:-1}g.type=j,D.fields.push(g)}H.types.push(D)},j=o._context.types;for(var M in j){var R=new uD;R.id=Number(M),g(R,j[M]._definition.schema)}return H.encodeAll()},h.decode=function(D,H){var g=new i,j=new h;j.decode(D,H);var M=j.types.reduce((function(D,h){var H=function(D){function h(){return null!==D&&D.apply(this,arguments)||this}return o(h,D),h}(eD),j=h.id;return D[j]=H,g.add(H,j),D}),{});j.types.forEach((function(D){var h=M[D.id];D.fields.forEach((function(D){var o;if(void 0!==D.referencedType){var H=D.type,j=M[D.referencedType];if(!j){var R=D.type.split(":");H=R[0],j=R[1]}"ref"===H?N(j,{context:g})(h.prototype,D.name):N(((o={})[H]=j,o),{context:g})(h.prototype,D.name)}else N(D.type,{context:g})(h.prototype,D.name)}))}));var R=M[j.rootType],t=new R;for(var S in R._definition.schema){var k=R._definition.schema[S];"string"!==typeof k&&(t[S]="function"===typeof k?new k:new(c(Object.keys(k)[0]).constructor))}return t},H([N([uD],mh)],h.prototype,"types",void 0),H([N("number",mh)],h.prototype,"rootType",void 0),h}(eD);q("map",{constructor:s}),q("array",{constructor:r}),q("set",{constructor:GD}),q("collection",{constructor:iD}),D.ArraySchema=r,D.CollectionSchema=iD,D.Context=i,D.MapSchema=s,D.Reflection=ID,D.ReflectionField=aD,D.ReflectionType=uD,D.Schema=eD,D.SchemaDefinition=y,D.SetSchema=GD,D.decode=bD,D.defineTypes=L,D.deprecated=E,D.dumpChanges=pD,D.encode=A,D.filter=J,D.filterChildren=O,D.hasFilter=b,D.registerType=q,D.type=N,Object.defineProperty(D,"__esModule",{value:!0})}(h)},14821:D=>{"use strict";D.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14819:(D,h,o)=>{var H=o(14821),g=o(14826),j=Object.hasOwnProperty,M=Object.create(null);for(var R in H)j.call(H,R)&&(M[H[R]]=R);var t=D.exports={to:{},get:{}};function S(D,h,o){return Math.min(Math.max(h,D),o)}function k(D){var h=Math.round(D).toString(16).toUpperCase();return h.length<2?"0"+h:h}t.get=function(D){var h,o;switch(D.substring(0,3).toLowerCase()){case"hsl":h=t.get.hsl(D),o="hsl";break;case"hwb":h=t.get.hwb(D),o="hwb";break;default:h=t.get.rgb(D),o="rgb"}return h?{model:o,value:h}:null},t.get.rgb=function(D){if(!D)return null;var h,o,g,M=[0,0,0,1];if(h=D.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(g=h[2],h=h[1],o=0;o<3;o++){var R=2*o;M[o]=parseInt(h.slice(R,R+2),16)}g&&(M[3]=parseInt(g,16)/255)}else if(h=D.match(/^#([a-f0-9]{3,4})$/i)){for(g=(h=h[1])[3],o=0;o<3;o++)M[o]=parseInt(h[o]+h[o],16);g&&(M[3]=parseInt(g+g,16)/255)}else if(h=D.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(o=0;o<3;o++)M[o]=parseInt(h[o+1],0);h[4]&&(h[5]?M[3]=.01*parseFloat(h[4]):M[3]=parseFloat(h[4]))}else{if(!(h=D.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(h=D.match(/^(\w+)$/))?"transparent"===h[1]?[0,0,0,0]:j.call(H,h[1])?((M=H[h[1]])[3]=1,M):null:null;for(o=0;o<3;o++)M[o]=Math.round(2.55*parseFloat(h[o+1]));h[4]&&(h[5]?M[3]=.01*parseFloat(h[4]):M[3]=parseFloat(h[4]))}for(o=0;o<3;o++)M[o]=S(M[o],0,255);return M[3]=S(M[3],0,1),M},t.get.hsl=function(D){if(!D)return null;var h=D.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(h){var o=parseFloat(h[4]);return[(parseFloat(h[1])%360+360)%360,S(parseFloat(h[2]),0,100),S(parseFloat(h[3]),0,100),S(isNaN(o)?1:o,0,1)]}return null},t.get.hwb=function(D){if(!D)return null;var h=D.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(h){var o=parseFloat(h[4]);return[(parseFloat(h[1])%360+360)%360,S(parseFloat(h[2]),0,100),S(parseFloat(h[3]),0,100),S(isNaN(o)?1:o,0,1)]}return null},t.to.hex=function(){var D=g(arguments);return"#"+k(D[0])+k(D[1])+k(D[2])+(D[3]<1?k(Math.round(255*D[3])):"")},t.to.rgb=function(){var D=g(arguments);return D.length<4||1===D[3]?"rgb("+Math.round(D[0])+", "+Math.round(D[1])+", "+Math.round(D[2])+")":"rgba("+Math.round(D[0])+", "+Math.round(D[1])+", "+Math.round(D[2])+", "+D[3]+")"},t.to.rgb.percent=function(){var D=g(arguments),h=Math.round(D[0]/255*100),o=Math.round(D[1]/255*100),H=Math.round(D[2]/255*100);return D.length<4||1===D[3]?"rgb("+h+"%, "+o+"%, "+H+"%)":"rgba("+h+"%, "+o+"%, "+H+"%, "+D[3]+")"},t.to.hsl=function(){var D=g(arguments);return D.length<4||1===D[3]?"hsl("+D[0]+", "+D[1]+"%, "+D[2]+"%)":"hsla("+D[0]+", "+D[1]+"%, "+D[2]+"%, "+D[3]+")"},t.to.hwb=function(){var D=g(arguments),h="";return D.length>=4&&1!==D[3]&&(h=", "+D[3]),"hwb("+D[0]+", "+D[1]+"%, "+D[2]+"%"+h+")"},t.to.keyword=function(D){return M[D.slice(0,3)]}},14817:(D,h,o)=>{const H=o(14819),g=o(14842),j=["keyword","gray","hex"],M={};for(const v of Object.keys(g))M[[...g[v].labels].sort().join("")]=v;const R={};function t(D,h){if(!(this instanceof t))return new t(D,h);if(h&&h in j&&(h=null),h&&!(h in g))throw new Error("Unknown model: "+h);let o,S;if(null==D)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(D instanceof t)this.model=D.model,this.color=[...D.color],this.valpha=D.valpha;else if("string"===typeof D){const h=H.get(D);if(null===h)throw new Error("Unable to parse color from string: "+D);this.model=h.model,S=g[this.model].channels,this.color=h.value.slice(0,S),this.valpha="number"===typeof h.value[S]?h.value[S]:1}else if(D.length>0){this.model=h||"rgb",S=g[this.model].channels;const o=Array.prototype.slice.call(D,0,S);this.color=Q(o,S),this.valpha="number"===typeof D[S]?D[S]:1}else if("number"===typeof D)this.model="rgb",this.color=[D>>16&255,D>>8&255,255&D],this.valpha=1;else{this.valpha=1;const h=Object.keys(D);"alpha"in D&&(h.splice(h.indexOf("alpha"),1),this.valpha="number"===typeof D.alpha?D.alpha:0);const H=h.sort().join("");if(!(H in M))throw new Error("Unable to parse color from object: "+JSON.stringify(D));this.model=M[H];const{labels:j}=g[this.model],R=[];for(o=0;o<j.length;o++)R.push(D[j[o]]);this.color=Q(R)}if(R[this.model])for(S=g[this.model].channels,o=0;o<S;o++){const D=R[this.model][o];D&&(this.color[o]=D(this.color[o]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}t.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(D){let h=this.model in H.to?this:this.rgb();h=h.round("number"===typeof D?D:1);const o=1===h.valpha?h.color:[...h.color,this.valpha];return H.to[h.model](o)},percentString(D){const h=this.rgb().round("number"===typeof D?D:1),o=1===h.valpha?h.color:[...h.color,this.valpha];return H.to.rgb.percent(o)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const D={},{channels:h}=g[this.model],{labels:o}=g[this.model];for(let H=0;H<h;H++)D[o[H]]=this.color[H];return 1!==this.valpha&&(D.alpha=this.valpha),D},unitArray(){const D=this.rgb().color;return D[0]/=255,D[1]/=255,D[2]/=255,1!==this.valpha&&D.push(this.valpha),D},unitObject(){const D=this.rgb().object();return D.r/=255,D.g/=255,D.b/=255,1!==this.valpha&&(D.alpha=this.valpha),D},round(D){return D=Math.max(D||0,0),new t([...this.color.map(S(D)),this.valpha],this.model)},alpha(D){return void 0!==D?new t([...this.color,Math.max(0,Math.min(1,D))],this.model):this.valpha},red:k("rgb",0,K(255)),green:k("rgb",1,K(255)),blue:k("rgb",2,K(255)),hue:k(["hsl","hsv","hsl","hwb","hcg"],0,(D=>(D%360+360)%360)),saturationl:k("hsl",1,K(100)),lightness:k("hsl",2,K(100)),saturationv:k("hsv",1,K(100)),value:k("hsv",2,K(100)),chroma:k("hcg",1,K(100)),gray:k("hcg",2,K(100)),white:k("hwb",1,K(100)),wblack:k("hwb",2,K(100)),cyan:k("cmyk",0,K(100)),magenta:k("cmyk",1,K(100)),yellow:k("cmyk",2,K(100)),black:k("cmyk",3,K(100)),x:k("xyz",0,K(95.047)),y:k("xyz",1,K(100)),z:k("xyz",2,K(108.833)),l:k("lab",0,K(100)),a:k("lab",1),b:k("lab",2),keyword(D){return void 0!==D?new t(D):g[this.model].keyword(this.color)},hex(D){return void 0!==D?new t(D):H.to.hex(this.rgb().round().color)},hexa(D){if(void 0!==D)return new t(D);const h=this.rgb().round().color;let o=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===o.length&&(o="0"+o),H.to.hex(h)+o},rgbNumber(){const D=this.rgb().color;return(255&D[0])<<16|(255&D[1])<<8|255&D[2]},luminosity(){const D=this.rgb().color,h=[];for(const[o,H]of D.entries()){const D=H/255;h[o]=D<=.04045?D/12.92:((D+.055)/1.055)**2.4}return.2126*h[0]+.7152*h[1]+.0722*h[2]},contrast(D){const h=this.luminosity(),o=D.luminosity();return h>o?(h+.05)/(o+.05):(o+.05)/(h+.05)},level(D){const h=this.contrast(D);return h>=7?"AAA":h>=4.5?"AA":""},isDark(){const D=this.rgb().color;return(2126*D[0]+7152*D[1]+722*D[2])/1e4<128},isLight(){return!this.isDark()},negate(){const D=this.rgb();for(let h=0;h<3;h++)D.color[h]=255-D.color[h];return D},lighten(D){const h=this.hsl();return h.color[2]+=h.color[2]*D,h},darken(D){const h=this.hsl();return h.color[2]-=h.color[2]*D,h},saturate(D){const h=this.hsl();return h.color[1]+=h.color[1]*D,h},desaturate(D){const h=this.hsl();return h.color[1]-=h.color[1]*D,h},whiten(D){const h=this.hwb();return h.color[1]+=h.color[1]*D,h},blacken(D){const h=this.hwb();return h.color[2]+=h.color[2]*D,h},grayscale(){const D=this.rgb().color,h=.3*D[0]+.59*D[1]+.11*D[2];return t.rgb(h,h,h)},fade(D){return this.alpha(this.valpha-this.valpha*D)},opaquer(D){return this.alpha(this.valpha+this.valpha*D)},rotate(D){const h=this.hsl();let o=h.color[0];return o=(o+D)%360,o=o<0?360+o:o,h.color[0]=o,h},mix(D,h){if(!D||!D.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof D);const o=D.rgb(),H=this.rgb(),g=void 0===h?.5:h,j=2*g-1,M=o.alpha()-H.alpha(),R=((j*M===-1?j:(j+M)/(1+j*M))+1)/2,S=1-R;return t.rgb(R*o.red()+S*H.red(),R*o.green()+S*H.green(),R*o.blue()+S*H.blue(),o.alpha()*g+H.alpha()*(1-g))}};for(const v of Object.keys(g)){if(j.includes(v))continue;const{channels:D}=g[v];t.prototype[v]=function(){if(this.model===v)return new t(this);for(var D=arguments.length,h=new Array(D),o=0;o<D;o++)h[o]=arguments[o];return h.length>0?new t(h,v):new t([...(H=g[this.model][v].raw(this.color),Array.isArray(H)?H:[H]),this.valpha],v);var H},t[v]=function(){for(var h=arguments.length,o=new Array(h),H=0;H<h;H++)o[H]=arguments[H];let g=o[0];return"number"===typeof g&&(g=Q(o,D)),new t(g,v)}}function S(D){return function(h){return function(D,h){return Number(D.toFixed(h))}(h,D)}}function k(D,h,o){D=Array.isArray(D)?D:[D];for(const H of D)(R[H]||(R[H]=[]))[h]=o;return D=D[0],function(H){let g;return void 0!==H?(o&&(H=o(H)),g=this[D](),g.color[h]=H,g):(g=this[D]().color[h],o&&(g=o(g)),g)}}function K(D){return function(h){return Math.max(0,Math.min(D,h))}}function Q(D,h){for(let o=0;o<h;o++)"number"!==typeof D[o]&&(D[o]=0);return D}D.exports=t},14845:(D,h,o)=>{const H=o(14852),g={};for(const M of Object.keys(H))g[H[M]]=M;const j={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};D.exports=j;for(const M of Object.keys(j)){if(!("channels"in j[M]))throw new Error("missing channels property: "+M);if(!("labels"in j[M]))throw new Error("missing channel labels property: "+M);if(j[M].labels.length!==j[M].channels)throw new Error("channel and label counts mismatch: "+M);const{channels:D,labels:h}=j[M];delete j[M].channels,delete j[M].labels,Object.defineProperty(j[M],"channels",{value:D}),Object.defineProperty(j[M],"labels",{value:h})}j.rgb.hsl=function(D){const h=D[0]/255,o=D[1]/255,H=D[2]/255,g=Math.min(h,o,H),j=Math.max(h,o,H),M=j-g;let R,t;j===g?R=0:h===j?R=(o-H)/M:o===j?R=2+(H-h)/M:H===j&&(R=4+(h-o)/M),R=Math.min(60*R,360),R<0&&(R+=360);const S=(g+j)/2;return t=j===g?0:S<=.5?M/(j+g):M/(2-j-g),[R,100*t,100*S]},j.rgb.hsv=function(D){let h,o,H,g,j;const M=D[0]/255,R=D[1]/255,t=D[2]/255,S=Math.max(M,R,t),k=S-Math.min(M,R,t),K=function(D){return(S-D)/6/k+.5};return 0===k?(g=0,j=0):(j=k/S,h=K(M),o=K(R),H=K(t),M===S?g=H-o:R===S?g=1/3+h-H:t===S&&(g=2/3+o-h),g<0?g+=1:g>1&&(g-=1)),[360*g,100*j,100*S]},j.rgb.hwb=function(D){const h=D[0],o=D[1];let H=D[2];const g=j.rgb.hsl(D)[0],M=1/255*Math.min(h,Math.min(o,H));return H=1-1/255*Math.max(h,Math.max(o,H)),[g,100*M,100*H]},j.rgb.cmyk=function(D){const h=D[0]/255,o=D[1]/255,H=D[2]/255,g=Math.min(1-h,1-o,1-H);return[100*((1-h-g)/(1-g)||0),100*((1-o-g)/(1-g)||0),100*((1-H-g)/(1-g)||0),100*g]},j.rgb.keyword=function(D){const h=g[D];if(h)return h;let o,j=1/0;for(const g of Object.keys(H)){const h=H[g],t=(R=h,((M=D)[0]-R[0])**2+(M[1]-R[1])**2+(M[2]-R[2])**2);t<j&&(j=t,o=g)}var M,R;return o},j.keyword.rgb=function(D){return H[D]},j.rgb.xyz=function(D){let h=D[0]/255,o=D[1]/255,H=D[2]/255;h=h>.04045?((h+.055)/1.055)**2.4:h/12.92,o=o>.04045?((o+.055)/1.055)**2.4:o/12.92,H=H>.04045?((H+.055)/1.055)**2.4:H/12.92;return[100*(.4124*h+.3576*o+.1805*H),100*(.2126*h+.7152*o+.0722*H),100*(.0193*h+.1192*o+.9505*H)]},j.rgb.lab=function(D){const h=j.rgb.xyz(D);let o=h[0],H=h[1],g=h[2];o/=95.047,H/=100,g/=108.883,o=o>.008856?o**(1/3):7.787*o+16/116,H=H>.008856?H**(1/3):7.787*H+16/116,g=g>.008856?g**(1/3):7.787*g+16/116;return[116*H-16,500*(o-H),200*(H-g)]},j.hsl.rgb=function(D){const h=D[0]/360,o=D[1]/100,H=D[2]/100;let g,j,M;if(0===o)return M=255*H,[M,M,M];g=H<.5?H*(1+o):H+o-H*o;const R=2*H-g,t=[0,0,0];for(let S=0;S<3;S++)j=h+1/3*-(S-1),j<0&&j++,j>1&&j--,M=6*j<1?R+6*(g-R)*j:2*j<1?g:3*j<2?R+(g-R)*(2/3-j)*6:R,t[S]=255*M;return t},j.hsl.hsv=function(D){const h=D[0];let o=D[1]/100,H=D[2]/100,g=o;const j=Math.max(H,.01);H*=2,o*=H<=1?H:2-H,g*=j<=1?j:2-j;return[h,100*(0===H?2*g/(j+g):2*o/(H+o)),100*((H+o)/2)]},j.hsv.rgb=function(D){const h=D[0]/60,o=D[1]/100;let H=D[2]/100;const g=Math.floor(h)%6,j=h-Math.floor(h),M=255*H*(1-o),R=255*H*(1-o*j),t=255*H*(1-o*(1-j));switch(H*=255,g){case 0:return[H,t,M];case 1:return[R,H,M];case 2:return[M,H,t];case 3:return[M,R,H];case 4:return[t,M,H];case 5:return[H,M,R]}},j.hsv.hsl=function(D){const h=D[0],o=D[1]/100,H=D[2]/100,g=Math.max(H,.01);let j,M;M=(2-o)*H;const R=(2-o)*g;return j=o*g,j/=R<=1?R:2-R,j=j||0,M/=2,[h,100*j,100*M]},j.hwb.rgb=function(D){const h=D[0]/360;let o=D[1]/100,H=D[2]/100;const g=o+H;let j;g>1&&(o/=g,H/=g);const M=Math.floor(6*h),R=1-H;j=6*h-M,0!==(1&M)&&(j=1-j);const t=o+j*(R-o);let S,k,K;switch(M){default:case 6:case 0:S=R,k=t,K=o;break;case 1:S=t,k=R,K=o;break;case 2:S=o,k=R,K=t;break;case 3:S=o,k=t,K=R;break;case 4:S=t,k=o,K=R;break;case 5:S=R,k=o,K=t}return[255*S,255*k,255*K]},j.cmyk.rgb=function(D){const h=D[0]/100,o=D[1]/100,H=D[2]/100,g=D[3]/100;return[255*(1-Math.min(1,h*(1-g)+g)),255*(1-Math.min(1,o*(1-g)+g)),255*(1-Math.min(1,H*(1-g)+g))]},j.xyz.rgb=function(D){const h=D[0]/100,o=D[1]/100,H=D[2]/100;let g,j,M;return g=3.2406*h+-1.5372*o+-.4986*H,j=-.9689*h+1.8758*o+.0415*H,M=.0557*h+-.204*o+1.057*H,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,j=j>.0031308?1.055*j**(1/2.4)-.055:12.92*j,M=M>.0031308?1.055*M**(1/2.4)-.055:12.92*M,g=Math.min(Math.max(0,g),1),j=Math.min(Math.max(0,j),1),M=Math.min(Math.max(0,M),1),[255*g,255*j,255*M]},j.xyz.lab=function(D){let h=D[0],o=D[1],H=D[2];h/=95.047,o/=100,H/=108.883,h=h>.008856?h**(1/3):7.787*h+16/116,o=o>.008856?o**(1/3):7.787*o+16/116,H=H>.008856?H**(1/3):7.787*H+16/116;return[116*o-16,500*(h-o),200*(o-H)]},j.lab.xyz=function(D){let h,o,H;o=(D[0]+16)/116,h=D[1]/500+o,H=o-D[2]/200;const g=o**3,j=h**3,M=H**3;return o=g>.008856?g:(o-16/116)/7.787,h=j>.008856?j:(h-16/116)/7.787,H=M>.008856?M:(H-16/116)/7.787,h*=95.047,o*=100,H*=108.883,[h,o,H]},j.lab.lch=function(D){const h=D[0],o=D[1],H=D[2];let g;g=360*Math.atan2(H,o)/2/Math.PI,g<0&&(g+=360);return[h,Math.sqrt(o*o+H*H),g]},j.lch.lab=function(D){const h=D[0],o=D[1],H=D[2]/360*2*Math.PI;return[h,o*Math.cos(H),o*Math.sin(H)]},j.rgb.ansi16=function(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[o,H,g]=D;let M=null===h?j.rgb.hsv(D)[2]:h;if(M=Math.round(M/50),0===M)return 30;let R=30+(Math.round(g/255)<<2|Math.round(H/255)<<1|Math.round(o/255));return 2===M&&(R+=60),R},j.hsv.ansi16=function(D){return j.rgb.ansi16(j.hsv.rgb(D),D[2])},j.rgb.ansi256=function(D){const h=D[0],o=D[1],H=D[2];if(h===o&&o===H)return h<8?16:h>248?231:Math.round((h-8)/247*24)+232;return 16+36*Math.round(h/255*5)+6*Math.round(o/255*5)+Math.round(H/255*5)},j.ansi16.rgb=function(D){let h=D%10;if(0===h||7===h)return D>50&&(h+=3.5),h=h/10.5*255,[h,h,h];const o=.5*(1+~~(D>50));return[(1&h)*o*255,(h>>1&1)*o*255,(h>>2&1)*o*255]},j.ansi256.rgb=function(D){if(D>=232){const h=10*(D-232)+8;return[h,h,h]}let h;D-=16;return[Math.floor(D/36)/5*255,Math.floor((h=D%36)/6)/5*255,h%6/5*255]},j.rgb.hex=function(D){const h=(((255&Math.round(D[0]))<<16)+((255&Math.round(D[1]))<<8)+(255&Math.round(D[2]))).toString(16).toUpperCase();return"000000".substring(h.length)+h},j.hex.rgb=function(D){const h=D.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!h)return[0,0,0];let o=h[0];3===h[0].length&&(o=o.split("").map((D=>D+D)).join(""));const H=parseInt(o,16);return[H>>16&255,H>>8&255,255&H]},j.rgb.hcg=function(D){const h=D[0]/255,o=D[1]/255,H=D[2]/255,g=Math.max(Math.max(h,o),H),j=Math.min(Math.min(h,o),H),M=g-j;let R,t;return R=M<1?j/(1-M):0,t=M<=0?0:g===h?(o-H)/M%6:g===o?2+(H-h)/M:4+(h-o)/M,t/=6,t%=1,[360*t,100*M,100*R]},j.hsl.hcg=function(D){const h=D[1]/100,o=D[2]/100,H=o<.5?2*h*o:2*h*(1-o);let g=0;return H<1&&(g=(o-.5*H)/(1-H)),[D[0],100*H,100*g]},j.hsv.hcg=function(D){const h=D[1]/100,o=D[2]/100,H=h*o;let g=0;return H<1&&(g=(o-H)/(1-H)),[D[0],100*H,100*g]},j.hcg.rgb=function(D){const h=D[0]/360,o=D[1]/100,H=D[2]/100;if(0===o)return[255*H,255*H,255*H];const g=[0,0,0],j=h%1*6,M=j%1,R=1-M;let t=0;switch(Math.floor(j)){case 0:g[0]=1,g[1]=M,g[2]=0;break;case 1:g[0]=R,g[1]=1,g[2]=0;break;case 2:g[0]=0,g[1]=1,g[2]=M;break;case 3:g[0]=0,g[1]=R,g[2]=1;break;case 4:g[0]=M,g[1]=0,g[2]=1;break;default:g[0]=1,g[1]=0,g[2]=R}return t=(1-o)*H,[255*(o*g[0]+t),255*(o*g[1]+t),255*(o*g[2]+t)]},j.hcg.hsv=function(D){const h=D[1]/100,o=h+D[2]/100*(1-h);let H=0;return o>0&&(H=h/o),[D[0],100*H,100*o]},j.hcg.hsl=function(D){const h=D[1]/100,o=D[2]/100*(1-h)+.5*h;let H=0;return o>0&&o<.5?H=h/(2*o):o>=.5&&o<1&&(H=h/(2*(1-o))),[D[0],100*H,100*o]},j.hcg.hwb=function(D){const h=D[1]/100,o=h+D[2]/100*(1-h);return[D[0],100*(o-h),100*(1-o)]},j.hwb.hcg=function(D){const h=D[1]/100,o=1-D[2]/100,H=o-h;let g=0;return H<1&&(g=(o-H)/(1-H)),[D[0],100*H,100*g]},j.apple.rgb=function(D){return[D[0]/65535*255,D[1]/65535*255,D[2]/65535*255]},j.rgb.apple=function(D){return[D[0]/255*65535,D[1]/255*65535,D[2]/255*65535]},j.gray.rgb=function(D){return[D[0]/100*255,D[0]/100*255,D[0]/100*255]},j.gray.hsl=function(D){return[0,0,D[0]]},j.gray.hsv=j.gray.hsl,j.gray.hwb=function(D){return[0,100,D[0]]},j.gray.cmyk=function(D){return[0,0,0,D[0]]},j.gray.lab=function(D){return[D[0],0,0]},j.gray.hex=function(D){const h=255&Math.round(D[0]/100*255),o=((h<<16)+(h<<8)+h).toString(16).toUpperCase();return"000000".substring(o.length)+o},j.rgb.gray=function(D){return[(D[0]+D[1]+D[2])/3/255*100]}},14842:(D,h,o)=>{const H=o(14845),g=o(14855),j={};Object.keys(H).forEach((D=>{j[D]={},Object.defineProperty(j[D],"channels",{value:H[D].channels}),Object.defineProperty(j[D],"labels",{value:H[D].labels});const h=g(D);Object.keys(h).forEach((o=>{const H=h[o];j[D][o]=function(D){const h=function(){for(var h=arguments.length,o=new Array(h),H=0;H<h;H++)o[H]=arguments[H];const g=o[0];if(void 0===g||null===g)return g;g.length>1&&(o=g);const j=D(o);if("object"===typeof j)for(let D=j.length,M=0;M<D;M++)j[M]=Math.round(j[M]);return j};return"conversion"in D&&(h.conversion=D.conversion),h}(H),j[D][o].raw=function(D){const h=function(){for(var h=arguments.length,o=new Array(h),H=0;H<h;H++)o[H]=arguments[H];const g=o[0];return void 0===g||null===g?g:(g.length>1&&(o=g),D(o))};return"conversion"in D&&(h.conversion=D.conversion),h}(H)}))})),D.exports=j},14855:(D,h,o)=>{const H=o(14845);function g(D){const h=function(){const D={},h=Object.keys(H);for(let o=h.length,H=0;H<o;H++)D[h[H]]={distance:-1,parent:null};return D}(),o=[D];for(h[D].distance=0;o.length;){const D=o.pop(),g=Object.keys(H[D]);for(let H=g.length,j=0;j<H;j++){const H=g[j],M=h[H];-1===M.distance&&(M.distance=h[D].distance+1,M.parent=D,o.unshift(H))}}return h}function j(D,h){return function(o){return h(D(o))}}function M(D,h){const o=[h[D].parent,D];let g=H[h[D].parent][D],M=h[D].parent;for(;h[M].parent;)o.unshift(h[M].parent),g=j(H[h[M].parent][M],g),M=h[M].parent;return g.conversion=o,g}D.exports=function(D){const h=g(D),o={},H=Object.keys(h);for(let g=H.length,j=0;j<g;j++){const D=H[j];null!==h[D].parent&&(o[D]=M(D,h))}return o}},14852:D=>{"use strict";D.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13549:(D,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.discordURLBuilder=void 0,h.discordURLBuilder=function(D){var h;const o=(null===(h=null===window||void 0===window?void 0:window.location)||void 0===h?void 0:h.hostname)||"localhost",H=D.hostname.split("."),g=!D.hostname.includes("trycloudflare.com")&&!D.hostname.includes("discordsays.com")&&H.length>2?`/${H[0]}`:"";return D.pathname.startsWith("/.proxy")?`${D.protocol}//${o}${g}${D.pathname}${D.search}`:`${D.protocol}//${o}/.proxy/colyseus${g}${D.pathname}${D.search}`}},13542:function(D,h,o){"use strict";var H,g,j,M,R=this&&this.__awaiter||function(D,h,o,H){return new(o||(o=Promise))((function(g,j){function M(D){try{t(H.next(D))}catch(h){j(h)}}function R(D){try{t(H.throw(D))}catch(h){j(h)}}function t(D){var h;D.done?g(D.value):(h=D.value,h instanceof o?h:new o((function(D){D(h)}))).then(M,R)}t((H=H.apply(D,h||[])).next())}))},t=this&&this.__classPrivateFieldGet||function(D,h,o,H){if("a"===o&&!H)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof h?D!==h||!H:!h.has(D))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?H:"a"===o?H.call(D):H?H.value:h.get(D)},S=this&&this.__classPrivateFieldSet||function(D,h,o,H,g){if("m"===H)throw new TypeError("Private method is not writable");if("a"===H&&!g)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof h?D!==h||!g:!h.has(D))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===H?g.call(D,o):g?g.value=o:h.set(D,o),o};Object.defineProperty(h,"__esModule",{value:!0}),h.Auth=void 0;const k=o(13547),K=o(13508);h.Auth=class{constructor(D){this.http=D,this.settings={path:"/auth",key:"colyseus-auth-token"},H.set(this,!1),g.set(this,void 0),j.set(this,void 0),M.set(this,(0,K.createNanoEvents)()),(0,k.getItem)(this.settings.key,(D=>this.token=D))}set token(D){this.http.authToken=D}get token(){return this.http.authToken}onChange(D){const h=t(this,M,"f").on("change",D);return t(this,H,"f")||S(this,g,new Promise(((D,h)=>{this.getUserData().then((D=>{this.emitChange(Object.assign(Object.assign({},D),{token:this.token}))})).catch((D=>{this.emitChange({user:null,token:void 0})})).finally((()=>{D()}))})),"f"),S(this,H,!0,"f"),h}getUserData(){return R(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(D,h,o){return R(this,void 0,void 0,(function*(){const H=(yield this.http.post(`${this.settings.path}/register`,{body:{email:D,password:h,options:o}})).data;return this.emitChange(H),H}))}signInWithEmailAndPassword(D,h){return R(this,void 0,void 0,(function*(){const o=(yield this.http.post(`${this.settings.path}/login`,{body:{email:D,password:h}})).data;return this.emitChange(o),o}))}signInAnonymously(D){return R(this,void 0,void 0,(function*(){const h=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:D}})).data;return this.emitChange(h),h}))}sendPasswordResetEmail(D){return R(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:D}})).data}))}signInWithProvider(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return R(this,void 0,void 0,(function*(){return new Promise(((o,H)=>{const g=h.width||480,M=h.height||768,R=this.token?`?token=${this.token}`:"",k=`Login with ${D[0].toUpperCase()+D.substring(1)}`,K=this.http.client.getHttpEndpoint(`${h.prefix||`${this.settings.path}/provider`}/${D}${R}`),Q=screen.width/2-g/2,v=screen.height/2-M/2;S(this,j,window.open(K,k,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+g+", height="+M+", top="+v+", left="+Q),"f");const r=D=>{void 0===D.data.user&&void 0===D.data.token||(clearInterval(B),t(this,j,"f").close(),S(this,j,void 0,"f"),window.removeEventListener("message",r),void 0!==D.data.error?H(D.data.error):(o(D.data),this.emitChange(D.data)))},B=setInterval((()=>{t(this,j,"f")&&!t(this,j,"f").closed||(S(this,j,void 0,"f"),H("QM"),window.removeEventListener("message",r))}),200);window.addEventListener("message",r)}))}))}signOut(){return R(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(D){void 0!==D.token&&(this.token=D.token,null===D.token?(0,k.removeItem)(this.settings.key):(0,k.setItem)(this.settings.key,D.token)),t(this,M,"f").emit("change",D)}},H=new WeakMap,g=new WeakMap,j=new WeakMap,M=new WeakMap},13459:function(D,h,o){"use strict";var H,g=this&&this.__awaiter||function(D,h,o,H){return new(o||(o=Promise))((function(g,j){function M(D){try{t(H.next(D))}catch(h){j(h)}}function R(D){try{t(H.throw(D))}catch(h){j(h)}}function t(D){var h;D.done?g(D.value):(h=D.value,h instanceof o?h:new o((function(D){D(h)}))).then(M,R)}t((H=H.apply(D,h||[])).next())}))};Object.defineProperty(h,"__esModule",{value:!0}),h.Client=h.MatchMakeError=void 0;const j=o(13462),M=o(13466),R=o(13529),t=o(13542),S=o(13549);class k extends Error{constructor(D,h){super(D),this.code=h,Object.setPrototypeOf(this,k.prototype)}}h.MatchMakeError=k;const K="undefined"!==typeof window&&"undefined"!==typeof(null===(H=null===window||void 0===window?void 0:window.location)||void 0===H?void 0:H.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";h.Client=class{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,h=arguments.length>1?arguments[1]:void 0;var o,H;if("string"===typeof D){const h=D.startsWith("/")?new URL(D,K):new URL(D),o="https:"===h.protocol||"wss:"===h.protocol,H=Number(h.port||(o?443:80));this.settings={hostname:h.hostname,pathname:h.pathname,port:H,secure:o}}else void 0===D.port&&(D.port=D.secure?443:80),void 0===D.pathname&&(D.pathname=""),this.settings=D;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new R.HTTP(this,(null===h||void 0===h?void 0:h.headers)||{}),this.auth=new t.Auth(this.http),this.urlBuilder=null===h||void 0===h?void 0:h.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(H=null===(o=null===window||void 0===window?void 0:window.location)||void 0===o?void 0:o.hostname)||void 0===H?void 0:H.includes("discordsays.com"))&&(this.urlBuilder=S.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",D,h,o)}))}create(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",D,h,o)}))}join(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",D,h,o)}))}joinById(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return g(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",D,h,o)}))}reconnect(D,h){return g(this,void 0,void 0,(function*(){if("string"===typeof D&&"string"===typeof h)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[o,H]=D.split(":");if(!o||!H)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",o,{reconnectionToken:H},h)}))}getAvailableRooms(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return g(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${D}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(D,h,o){return g(this,void 0,void 0,(function*(){const H=this.createRoom(D.room.name,h);H.roomId=D.room.roomId,H.sessionId=D.sessionId;const M={sessionId:H.sessionId};D.reconnectionToken&&(M.reconnectionToken=D.reconnectionToken);const R=o||H;return H.connect(this.buildEndpoint(D.room,M),D.devMode&&(()=>g(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${H.roomId}'...`);let o=0;const j=()=>g(this,void 0,void 0,(function*(){o++;try{yield this.consumeSeatReservation(D,h,R),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${H.roomId}'`)}catch(g){o<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${o} out of 8)`),setTimeout(j,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(j,2e3)}))),R,this.http.headers),new Promise(((D,h)=>{const o=(D,o)=>h(new j.ServerError(D,o));R.onError.once(o),R.onJoin.once((()=>{R.onError.remove(o),setTimeout((()=>{try{R.NS(128,new Uint8Array([27,193,53,33,152,97,237,66,201,2,76,138,144,13,219,70,42,58,132,162]))}catch{}}),3e3),D(R)}))}))}))}createMatchMakeRequest(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},H=arguments.length>3?arguments[3]:void 0,j=arguments.length>4?arguments[4]:void 0;return g(this,void 0,void 0,(function*(){const g=(yield this.http.post(`matchmake/${D}/${h}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(o)})).data;if(g.error)throw new k(g.error,g.code);return"reconnect"===D&&(g.reconnectionToken=o.reconnectionToken),yield this.consumeSeatReservation(g,H,j)}))}createRoom(D,h){return new M.Room(D,h)}buildEndpoint(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=[];for(const j in h)h.hasOwnProperty(j)&&o.push(`${j}=${h[j]}`);let H=this.settings.secure?"wss://":"ws://";D.publicAddress?H+=`${D.publicAddress}`:H+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const g=`${H}/${D.processId}/${D.roomId}?${o.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(g)):g}getHttpEndpoint(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const h=D.startsWith("/")?D:`/${D}`,o=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${h}`;return this.urlBuilder?this.urlBuilder(new URL(o)):o}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13479:(D,h,o)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Connection=void 0;const H=o(13487);h.Connection=class{constructor(){this.events={},this.transport=new H.WebSocketTransport(this.events)}send(D){this.transport.send(D)}connect(D,h){this.transport.connect(D,h)}close(D,h){this.transport.close(D,h)}get isOpen(){return this.transport.isOpen}}},13529:function(D,h,o){"use strict";var H=this&&this.__createBinding||(Object.create?function(D,h,o,H){void 0===H&&(H=o);var g=Object.getOwnPropertyDescriptor(h,o);g&&!("get"in g?!h.__esModule:g.writable||g.configurable)||(g={enumerable:!0,get:function(){return h[o]}}),Object.defineProperty(D,H,g)}:function(D,h,o,H){void 0===H&&(H=o),D[H]=h[o]}),g=this&&this.__setModuleDefault||(Object.create?function(D,h){Object.defineProperty(D,"default",{enumerable:!0,value:h})}:function(D,h){D.default=h}),j=this&&this.__importStar||function(D){if(D&&D.__esModule)return D;var h={};if(null!=D)for(var o in D)"default"!==o&&Object.prototype.hasOwnProperty.call(D,o)&&H(h,D,o);return g(h,D),h};Object.defineProperty(h,"__esModule",{value:!0}),h.HTTP=void 0;const M=o(13462),R=j(o(13537));h.HTTP=class{constructor(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=D,this.headers=h}get(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",D,h)}post(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",D,h)}del(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",D,h)}put(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",D,h)}request(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return R[D](this.client.getHttpEndpoint(h),this.getOptions(o)).catch((D=>{var h;const o=D.statusCode,H=(null===(h=D.data)||void 0===h?void 0:h.error)||D.statusMessage||D.message;if(!o&&!H)throw D;throw new M.ServerError(o,H)}))}getOptions(D){return D.headers=Object.assign({},this.headers,D.headers),this.authToken&&(D.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(D.withCredentials=!0),D}}},13500:(D,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.utf8Length=h.utf8Read=h.ErrorCode=h.Protocol=void 0,function(D){D[D.HANDSHAKE=9]="HANDSHAKE",D[D.JOIN_ROOM=10]="JOIN_ROOM",D[D.ERROR=11]="ERROR",D[D.LEAVE_ROOM=12]="LEAVE_ROOM",D[D.ROOM_DATA=13]="ROOM_DATA",D[D.ROOM_STATE=14]="ROOM_STATE",D[D.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",D[D.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",D[D.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(h.Protocol||(h.Protocol={})),function(D){D[D.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",D[D.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",D[D.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",D[D.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",D[D.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",D[D.AUTH_FAILED=4215]="AUTH_FAILED",D[D.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(h.ErrorCode||(h.ErrorCode={})),h.utf8Read=function(D,h){const o=D[h++];for(var H="",g=0,j=h,M=h+o;j<M;j++){var R=D[j];if(0!==(128&R))if(192!==(224&R))if(224!==(240&R)){if(240!==(248&R))throw new Error("Invalid byte "+R.toString(16));(g=(7&R)<<18|(63&D[++j])<<12|(63&D[++j])<<6|63&D[++j])>=65536?(g-=65536,H+=String.fromCharCode(55296+(g>>>10),56320+(1023&g))):H+=String.fromCharCode(g)}else H+=String.fromCharCode((15&R)<<12|(63&D[++j])<<6|63&D[++j]);else H+=String.fromCharCode((31&R)<<6|63&D[++j]);else H+=String.fromCharCode(R)}return H},h.utf8Length=function(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",h=0,o=0;for(let H=0,g=D.length;H<g;H++)h=D.charCodeAt(H),h<128?o+=1:h<2048?o+=2:h<55296||h>=57344?o+=3:(H++,o+=4);return o+1}},13466:function(D,h,o){"use strict";var H=this&&this.__createBinding||(Object.create?function(D,h,o,H){void 0===H&&(H=o);var g=Object.getOwnPropertyDescriptor(h,o);g&&!("get"in g?!h.__esModule:g.writable||g.configurable)||(g={enumerable:!0,get:function(){return h[o]}}),Object.defineProperty(D,H,g)}:function(D,h,o,H){void 0===H&&(H=o),D[H]=h[o]}),g=this&&this.__setModuleDefault||(Object.create?function(D,h){Object.defineProperty(D,"default",{enumerable:!0,value:h})}:function(D,h){D.default=h}),j=this&&this.__importStar||function(D){if(D&&D.__esModule)return D;var h={};if(null!=D)for(var o in D)"default"!==o&&Object.prototype.hasOwnProperty.call(D,o)&&H(h,D,o);return g(h,D),h};Object.defineProperty(h,"__esModule",{value:!0}),h.Room=void 0;const M=j(o(13472)),R=o(13479),t=o(13500),S=o(13503),k=o(13508),K=o(13513),Q=o(13520),v=o(13462);class r{constructor(D,h){this.onStateChange=(0,K.createSignal)(),this.onError=(0,K.createSignal)(),this.onLeave=(0,K.createSignal)(),this.onJoin=(0,K.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,k.createNanoEvents)(),this.roomId=null,this.name=D,h&&(this.serializer=new((0,S.getSerializer)("schema")),this.rootSchema=h,this.serializer.state=new h),this.onError(((D,h)=>{var o;return null===(o=console.warn)||void 0===o?void 0:o.call(console,`colyseus.js - onError => (${D}) ${h}`)})),this.onLeave((()=>this.gh()))}get id(){return this.roomId}connect(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,H=arguments.length>3?arguments[3]:void 0;const g=new R.Connection;o.connection=g,g.events.onmessage=r.prototype.onMessageCallback.bind(o),g.events.onclose=function(D){var H;if(!o.hasJoined)return null===(H=console.warn)||void 0===H||H.call(console,`Room connection was closed unexpectedly (${D.code}): ${D.reason}`),void o.onError.invoke(D.code,D.reason);D.code===v.CloseCode.DEVMODE_RESTART&&h?h():(o.onLeave.invoke(D.code,D.reason),o.destroy())},g.events.onerror=function(D){var h;null===(h=console.warn)||void 0===h||h.call(console,`Room, onError (${D.code}): ${D.reason}`),o.onError.invoke(D.code,D.reason)},g.connect(D,H)}it(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((h=>{this.onLeave((D=>h(D))),this.connection?D?this.connection.send([t.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(v.CloseCode.CONSENTED)}))}Ro(D,h){return this.onMessageHandlers.on(this.getMessageHandlerKey(D),h)}send(D,h){const o=[t.Protocol.ROOM_DATA];let H;if("string"===typeof D?Q.encode.string(o,D):Q.encode.number(o,D),void 0!==h){const D=M.encode(h);H=new Uint8Array(o.length+D.byteLength),H.set(new Uint8Array(o),0),H.set(new Uint8Array(D),o.length)}else H=new Uint8Array(o);this.connection.send(H.buffer)}NS(D,h){const o=[t.Protocol.ROOM_DATA_BYTES];let H;"string"===typeof D?Q.encode.string(o,D):Q.encode.number(o,D),H=new Uint8Array(o.length+(h.byteLength||h.length)),H.set(new Uint8Array(o),0),H.set(new Uint8Array(h),o.length),this.connection.send(H.buffer)}get state(){return this.serializer.getState()}gh(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(D){const h=Array.from(new Uint8Array(D.data)),o=h[0];if(o===t.Protocol.JOIN_ROOM){let D=1;const o=(0,t.utf8Read)(h,D);if(D+=(0,t.utf8Length)(o),this.serializerId=(0,t.utf8Read)(h,D),D+=(0,t.utf8Length)(this.serializerId),!this.serializer){const D=(0,S.getSerializer)(this.serializerId);this.serializer=new D}h.length>D&&this.serializer.handshake&&this.serializer.handshake(h,{offset:D}),this.reconnectionToken=`${this.roomId}:${o}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([t.Protocol.JOIN_ROOM])}else if(o===t.Protocol.ERROR){const D={offset:1},o=Q.decode.number(h,D),H=Q.decode.string(h,D);this.onError.invoke(o,H)}else if(o===t.Protocol.LEAVE_ROOM)this.it();else if(o===t.Protocol.ROOM_DATA_SCHEMA){const D={offset:1},o=this.serializer.getState().constructor._context.get(Q.decode.number(h,D)),H=new o;H.decode(h,D),this.dispatchMessage(o,H)}else if(o===t.Protocol.ROOM_STATE)h.shift(),this.setState(h);else if(o===t.Protocol.ROOM_STATE_PATCH)h.shift(),this.patch(h);else if(o===t.Protocol.ROOM_DATA){const o={offset:1},H=Q.decode.stringCheck(h,o)?Q.decode.string(h,o):Q.decode.number(h,o),g=h.length>o.offset?M.decode(D.data,o.offset):void 0;this.dispatchMessage(H,g)}else if(o===t.Protocol.ROOM_DATA_BYTES){const D={offset:1},o=Q.decode.stringCheck(h,D)?Q.decode.string(h,D):Q.decode.number(h,D);this.dispatchMessage(o,new Uint8Array(h.slice(D.offset)))}}setState(D){this.serializer.setState(D),this.onStateChange.invoke(this.serializer.getState())}patch(D){this.serializer.patch(D),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(D,h){var o;const H=this.getMessageHandlerKey(D);this.onMessageHandlers.events[H]?this.onMessageHandlers.emit(H,h):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",D,h):null===(o=console.warn)||void 0===o||o.call(console,`colyseus.js: onMessage() not registered for type '${D}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(D){switch(typeof D){case"function":return`$${D._typeid}`;case"string":return D;case"number":return`i${D}`;default:throw new Error("invalid message type.")}}}h.Room=r},13547:(D,h)=>{"use strict";let o;function H(){if(!o)try{o="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(D){}return o||(o={cache:{},setItem:function(D,h){this.cache[D]=h},getItem:function(D){this.cache[D]},removeItem:function(D){delete this.cache[D]}}),o}Object.defineProperty(h,"__esModule",{value:!0}),h.getItem=h.removeItem=h.setItem=void 0,h.setItem=function(D,h){H().setItem(D,h)},h.removeItem=function(D){H().removeItem(D)},h.getItem=function(D,h){const o=H().getItem(D);"undefined"!==typeof Promise&&o instanceof Promise?o.then((D=>h(D))):h(o)}},13508:(D,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.createNanoEvents=void 0;h.createNanoEvents=()=>({emit(D){let h=this.events[D]||[];for(var o=arguments.length,H=new Array(o>1?o-1:0),g=1;g<o;g++)H[g-1]=arguments[g];for(let j=0,M=h.length;j<M;j++)h[j](...H)},events:{},on(D,h){var o;return(null===(o=this.events[D])||void 0===o?void 0:o.push(h))||(this.events[D]=[h]),()=>{var o;this.events[D]=null===(o=this.events[D])||void 0===o?void 0:o.filter((D=>h!==D))}}})},13513:(D,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.createSignal=h.EventEmitter=void 0;class o{constructor(){this.handlers=[]}register(D){return this.handlers.push(D),this}invoke(){for(var D=arguments.length,h=new Array(D),o=0;o<D;o++)h[o]=arguments[o];this.handlers.forEach((D=>D.apply(this,h)))}invokeAsync(){for(var D=arguments.length,h=new Array(D),o=0;o<D;o++)h[o]=arguments[o];return Promise.all(this.handlers.map((D=>D.apply(this,h))))}remove(D){const h=this.handlers.indexOf(D);this.handlers[h]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}h.EventEmitter=o,h.createSignal=function(){const D=new o;function h(h){return D.register(h,null===this)}return h.once=h=>{const o=function(){for(var H=arguments.length,g=new Array(H),j=0;j<H;j++)g[j]=arguments[j];h.apply(this,g),D.remove(o)};D.register(o)},h.remove=h=>D.remove(h),h.invoke=function(){return D.invoke(...arguments)},h.invokeAsync=function(){return D.invokeAsync(...arguments)},h.clear=()=>D.clear(),h}},13462:(D,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.ServerError=h.CloseCode=void 0,function(D){D[D.CONSENTED=4e3]="CONSENTED",D[D.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(h.CloseCode||(h.CloseCode={}));class o extends Error{constructor(D,h){super(h),this.name="ServerError",this.code=D}}h.ServerError=o},13447:(D,h,o)=>{"use strict";h.b=void 0,o(13451);var H=o(13459);Object.defineProperty(h,"b",{enumerable:!0,get:function(){return H.Client}});var g=o(13500);var j=o(13466);var M=o(13542);const R=o(13552);const t=o(13558),S=o(13503);(0,S.registerSerializer)("schema",R.SchemaSerializer),(0,S.registerSerializer)("none",t.NoneSerializer)},13451:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=D=>null!==D&&"object"===typeof D&&D.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13472:(D,h)=>{"use strict";function o(D,h){if(this._offset=h,D instanceof ArrayBuffer)this._buffer=D,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(D))throw new Error("Invalid argument");this._buffer=D.buffer,this._view=new DataView(this._buffer,D.byteOffset,D.byteLength)}}Object.defineProperty(h,"__esModule",{value:!0}),h.decode=h.encode=void 0,o.prototype._array=function(D){for(var h=new Array(D),o=0;o<D;o++)h[o]=this._parse();return h},o.prototype._map=function(D){for(var h={},o=0;o<D;o++)h[this._parse()]=this._parse();return h},o.prototype._str=function(D){var h=function(D,h,o){for(var H="",g=0,j=h,M=h+o;j<M;j++){var R=D.getUint8(j);if(0!==(128&R))if(192!==(224&R))if(224!==(240&R)){if(240!==(248&R))throw new Error("Invalid byte "+R.toString(16));(g=(7&R)<<18|(63&D.getUint8(++j))<<12|(63&D.getUint8(++j))<<6|63&D.getUint8(++j))>=65536?(g-=65536,H+=String.fromCharCode(55296+(g>>>10),56320+(1023&g))):H+=String.fromCharCode(g)}else H+=String.fromCharCode((15&R)<<12|(63&D.getUint8(++j))<<6|63&D.getUint8(++j));else H+=String.fromCharCode((31&R)<<6|63&D.getUint8(++j));else H+=String.fromCharCode(R)}return H}(this._view,this._offset,D);return this._offset+=D,h},o.prototype._bin=function(D){var h=this._buffer.slice(this._offset,this._offset+D);return this._offset+=D,h},o.prototype._parse=function(){var D,h=this._view.getUint8(this._offset++),o=0,H=0,g=0,j=0;if(h<192)return h<128?h:h<144?this._map(15&h):h<160?this._array(15&h):this._str(31&h);if(h>223)return-1*(255-h+1);switch(h){case 192:return null;case 194:return!1;case 195:return!0;case 196:return o=this._view.getUint8(this._offset),this._offset+=1,this._bin(o);case 197:return o=this._view.getUint16(this._offset),this._offset+=2,this._bin(o);case 198:return o=this._view.getUint32(this._offset),this._offset+=4,this._bin(o);case 199:if(o=this._view.getUint8(this._offset),H=this._view.getInt8(this._offset+1),this._offset+=2,-1===H){var M=this._view.getUint32(this._offset);return g=this._view.getInt32(this._offset+4),j=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*g+j)+M/1e6)}return[H,this._bin(o)];case 200:return o=this._view.getUint16(this._offset),H=this._view.getInt8(this._offset+2),this._offset+=3,[H,this._bin(o)];case 201:return o=this._view.getUint32(this._offset),H=this._view.getInt8(this._offset+4),this._offset+=5,[H,this._bin(o)];case 202:return D=this._view.getFloat32(this._offset),this._offset+=4,D;case 203:return D=this._view.getFloat64(this._offset),this._offset+=8,D;case 204:return D=this._view.getUint8(this._offset),this._offset+=1,D;case 205:return D=this._view.getUint16(this._offset),this._offset+=2,D;case 206:return D=this._view.getUint32(this._offset),this._offset+=4,D;case 207:return g=this._view.getUint32(this._offset)*Math.pow(2,32),j=this._view.getUint32(this._offset+4),this._offset+=8,g+j;case 208:return D=this._view.getInt8(this._offset),this._offset+=1,D;case 209:return D=this._view.getInt16(this._offset),this._offset+=2,D;case 210:return D=this._view.getInt32(this._offset),this._offset+=4,D;case 211:return g=this._view.getInt32(this._offset)*Math.pow(2,32),j=this._view.getUint32(this._offset+4),this._offset+=8,g+j;case 212:return H=this._view.getInt8(this._offset),this._offset+=1,0===H?void(this._offset+=1):[H,this._bin(1)];case 213:return H=this._view.getInt8(this._offset),this._offset+=1,[H,this._bin(2)];case 214:return H=this._view.getInt8(this._offset),this._offset+=1,-1===H?(D=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*D)):[H,this._bin(4)];case 215:return H=this._view.getInt8(this._offset),this._offset+=1,0===H?(g=this._view.getInt32(this._offset)*Math.pow(2,32),j=this._view.getUint32(this._offset+4),this._offset+=8,new Date(g+j)):-1===H?(g=this._view.getUint32(this._offset),j=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&g)+j)+(g>>>2)/1e6)):[H,this._bin(8)];case 216:return H=this._view.getInt8(this._offset),this._offset+=1,[H,this._bin(16)];case 217:return o=this._view.getUint8(this._offset),this._offset+=1,this._str(o);case 218:return o=this._view.getUint16(this._offset),this._offset+=2,this._str(o);case 219:return o=this._view.getUint32(this._offset),this._offset+=4,this._str(o);case 220:return o=this._view.getUint16(this._offset),this._offset+=2,this._array(o);case 221:return o=this._view.getUint32(this._offset),this._offset+=4,this._array(o);case 222:return o=this._view.getUint16(this._offset),this._offset+=2,this._map(o);case 223:return o=this._view.getUint32(this._offset),this._offset+=4,this._map(o)}throw new Error("Could not parse")},h.decode=function(D){var h=new o(D,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),H=h._parse();if(h._offset!==D.byteLength)throw new Error(D.byteLength-h._offset+" trailing bytes");return H};function H(D,h,o){for(var H=0,g=0,j=o.length;g<j;g++)(H=o.charCodeAt(g))<128?D.setUint8(h++,H):H<2048?(D.setUint8(h++,192|H>>6),D.setUint8(h++,128|63&H)):H<55296||H>=57344?(D.setUint8(h++,224|H>>12),D.setUint8(h++,128|H>>6&63),D.setUint8(h++,128|63&H)):(g++,H=65536+((1023&H)<<10|1023&o.charCodeAt(g)),D.setUint8(h++,240|H>>18),D.setUint8(h++,128|H>>12&63),D.setUint8(h++,128|H>>6&63),D.setUint8(h++,128|63&H))}function g(D,h,o){var H=typeof o,j=0,M=0,R=0,t=0,S=0,k=0;if("string"===H){if(S=function(D){for(var h=0,o=0,H=0,g=D.length;H<g;H++)(h=D.charCodeAt(H))<128?o+=1:h<2048?o+=2:h<55296||h>=57344?o+=3:(H++,o+=4);return o}(o),S<32)D.push(160|S),k=1;else if(S<256)D.push(217,S),k=2;else if(S<65536)D.push(218,S>>8,S),k=3;else{if(!(S<4294967296))throw new Error("String too long");D.push(219,S>>24,S>>16,S>>8,S),k=5}return h.push({_str:o,_length:S,_offset:D.length}),k+S}if("number"===H)return Math.floor(o)===o&&isFinite(o)?o>=0?o<128?(D.push(o),1):o<256?(D.push(204,o),2):o<65536?(D.push(205,o>>8,o),3):o<4294967296?(D.push(206,o>>24,o>>16,o>>8,o),5):(R=o/Math.pow(2,32)|0,t=o>>>0,D.push(207,R>>24,R>>16,R>>8,R,t>>24,t>>16,t>>8,t),9):o>=-32?(D.push(o),1):o>=-128?(D.push(208,o),2):o>=-32768?(D.push(209,o>>8,o),3):o>=-2147483648?(D.push(210,o>>24,o>>16,o>>8,o),5):(R=Math.floor(o/Math.pow(2,32)),t=o>>>0,D.push(211,R>>24,R>>16,R>>8,R,t>>24,t>>16,t>>8,t),9):(D.push(203),h.push({_float:o,_length:8,_offset:D.length}),9);if("object"===H){if(null===o)return D.push(192),1;if(Array.isArray(o)){if((S=o.length)<16)D.push(144|S),k=1;else if(S<65536)D.push(220,S>>8,S),k=3;else{if(!(S<4294967296))throw new Error("Array too large");D.push(221,S>>24,S>>16,S>>8,S),k=5}for(j=0;j<S;j++)k+=g(D,h,o[j]);return k}if(o instanceof Date){var K=o.getTime(),Q=Math.floor(K/1e3),v=1e6*(K-1e3*Q);return Q>=0&&v>=0&&Q<=17179869183?0===v&&Q<=4294967295?(D.push(214,255,Q>>24,Q>>16,Q>>8,Q),6):(R=Q/4294967296,t=4294967295&Q,D.push(215,255,v>>22,v>>14,v>>6,R,t>>24,t>>16,t>>8,t),10):(R=Math.floor(Q/4294967296),t=Q>>>0,D.push(199,12,255,v>>24,v>>16,v>>8,v,R>>24,R>>16,R>>8,R,t>>24,t>>16,t>>8,t),15)}if(o instanceof ArrayBuffer){if((S=o.byteLength)<256)D.push(196,S),k=2;else if(S<65536)D.push(197,S>>8,S),k=3;else{if(!(S<4294967296))throw new Error("Buffer too large");D.push(198,S>>24,S>>16,S>>8,S),k=5}return h.push({_bin:o,_length:S,_offset:D.length}),k+S}if("function"===typeof o.toJSON)return g(D,h,o.toJSON());var r=[],B="",s=Object.keys(o);for(j=0,M=s.length;j<M;j++)void 0!==o[B=s[j]]&&"function"!==typeof o[B]&&r.push(B);if((S=r.length)<16)D.push(128|S),k=1;else if(S<65536)D.push(222,S>>8,S),k=3;else{if(!(S<4294967296))throw new Error("Object too large");D.push(223,S>>24,S>>16,S>>8,S),k=5}for(j=0;j<S;j++)k+=g(D,h,B=r[j]),k+=g(D,h,o[B]);return k}if("boolean"===H)return D.push(o?195:194),1;if("undefined"===H)return D.push(192),1;if("function"===typeof o.toJSON)return g(D,h,o.toJSON());throw new Error("Could not encode")}h.encode=function(D){var h=[],o=[],j=g(h,o,D),M=new ArrayBuffer(j),R=new DataView(M),t=0,S=0,k=-1;o.length>0&&(k=o[0]._offset);for(var K,Q=0,v=0,r=0,B=h.length;r<B;r++)if(R.setUint8(S+r,h[r]),r+1===k){if(Q=(K=o[t])._length,v=S+k,K._bin)for(var s=new Uint8Array(K._bin),U=0;U<Q;U++)R.setUint8(v+U,s[U]);else K._str?H(R,v,K._str):void 0!==K._float&&R.setFloat64(v,K._float);S+=Q,o[++t]&&(k=o[t]._offset)}return M}},13558:(D,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.NoneSerializer=void 0;h.NoneSerializer=class{setState(D){}getState(){return null}patch(D){}teardown(){}handshake(D){}}},13552:(D,h,o)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.SchemaSerializer=void 0;const H=o(13520);h.SchemaSerializer=class{setState(D){return this.state.decode(D)}getState(){return this.state}patch(D){return this.state.decode(D)}teardown(){var D,h;null===(h=null===(D=this.state)||void 0===D?void 0:D.$changes)||void 0===h||h.root.clearRefs()}handshake(D,h){if(this.state){(new H.Reflection).decode(D,h)}else this.state=H.Reflection.decode(D,h)}}},13503:(D,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.getSerializer=h.registerSerializer=void 0;const o={};h.registerSerializer=function(D,h){o[D]=h},h.getSerializer=function(D){const h=o[D];if(!h)throw new Error("missing serializer: "+D);return h}},13487:function(D,h,o){"use strict";var H=this&&this.__importDefault||function(D){return D&&D.__esModule?D:{default:D}};Object.defineProperty(h,"__esModule",{value:!0}),h.WebSocketTransport=void 0;const g=H(o(13493)),j=globalThis.WebSocket||g.default;h.WebSocketTransport=class{constructor(D){this.events=D}send(D){D instanceof ArrayBuffer?this.ws.send(D):Array.isArray(D)&&this.ws.send(new Uint8Array(D).buffer)}connect(D,h){try{this.ws=new j(D,{headers:h,protocols:this.protocols})}catch(o){this.ws=new j(D,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(D,h){this.ws.close(D,h)}get isOpen(){return this.ws.readyState===j.OPEN}}},13493:D=>{"use strict";D.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14713:D=>{"use strict";D.exports=function(D){for(var h=new Array(D),o=0;o<D;++o)h[o]=o;return h}},14716:D=>{function h(D){return!!D.constructor&&"function"===typeof D.constructor.isBuffer&&D.constructor.isBuffer(D)}D.exports=function(D){return null!=D&&(h(D)||function(D){return"function"===typeof D.readFloatLE&&"function"===typeof D.slice&&h(D.slice(0,0))}(D)||!!D._isBuffer)}},14710:(D,h,o)=>{var H=o(14713),g=o(14716),j="undefined"!==typeof Float64Array;function M(D,h){return D[0]-h[0]}function R(){var D,h=this.stride,o=new Array(h.length);for(D=0;D<o.length;++D)o[D]=[Math.abs(h[D]),D];o.sort(M);var H=new Array(o.length);for(D=0;D<H.length;++D)H[D]=o[D][1];return H}function t(D,h){var o=["View",h,"d",D].join("");h<0&&(o="View_Nil"+D);var g="generic"===D;if(-1===h){var j="function "+o+"(a){this.data=a;};var proto="+o+".prototype;proto.dtype='"+D+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+o+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+o+"(a){return new "+o+"(a);}";return new Function(j)()}if(0===h){j="function "+o+"(a,d) {this.data = a;this.offset = d};var proto="+o+".prototype;proto.dtype='"+D+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+o+"_copy() {return new "+o+"(this.data,this.offset)};proto.pick=function "+o+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+o+"_get(){return "+(g?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+o+"_set(v){return "+(g?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+o+"(a,b,c,d){return new "+o+"(a,d)}";return new Function("TrivialArray",j)(S[D][0])}j=["'use strict'"];var M=H(h),t=M.map((function(D){return"i"+D})),k="this.offset+"+M.map((function(D){return"this.stride["+D+"]*i"+D})).join("+"),K=M.map((function(D){return"b"+D})).join(","),Q=M.map((function(D){return"c"+D})).join(",");j.push("function "+o+"(a,"+K+","+Q+",d){this.data=a","this.shape=["+K+"]","this.stride=["+Q+"]","this.offset=d|0}","var proto="+o+".prototype","proto.dtype='"+D+"'","proto.dimension="+h),j.push("Object.defineProperty(proto,'size',{get:function "+o+"_size(){return "+M.map((function(D){return"this.shape["+D+"]"})).join("*"),"}})"),1===h?j.push("proto.order=[0]"):(j.push("Object.defineProperty(proto,'order',{get:"),h<4?(j.push("function "+o+"_order(){"),2===h?j.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===h&&j.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):j.push("ORDER})")),j.push("proto.set=function "+o+"_set("+t.join(",")+",v){"),g?j.push("return this.data.set("+k+",v)}"):j.push("return this.data["+k+"]=v}"),j.push("proto.get=function "+o+"_get("+t.join(",")+"){"),g?j.push("return this.data.get("+k+")}"):j.push("return this.data["+k+"]}"),j.push("proto.index=function "+o+"_index(",t.join(),"){return "+k+"}"),j.push("proto.hi=function "+o+"_hi("+t.join(",")+"){return new "+o+"(this.data,"+M.map((function(D){return["(typeof i",D,"!=='number'||i",D,"<0)?this.shape[",D,"]:i",D,"|0"].join("")})).join(",")+","+M.map((function(D){return"this.stride["+D+"]"})).join(",")+",this.offset)}");var v=M.map((function(D){return"a"+D+"=this.shape["+D+"]"})),r=M.map((function(D){return"c"+D+"=this.stride["+D+"]"}));j.push("proto.lo=function "+o+"_lo("+t.join(",")+"){var b=this.offset,d=0,"+v.join(",")+","+r.join(","));for(var B=0;B<h;++B)j.push("if(typeof i"+B+"==='number'&&i"+B+">=0){d=i"+B+"|0;b+=c"+B+"*d;a"+B+"-=d}");j.push("return new "+o+"(this.data,"+M.map((function(D){return"a"+D})).join(",")+","+M.map((function(D){return"c"+D})).join(",")+",b)}"),j.push("proto.step=function "+o+"_step("+t.join(",")+"){var "+M.map((function(D){return"a"+D+"=this.shape["+D+"]"})).join(",")+","+M.map((function(D){return"b"+D+"=this.stride["+D+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(B=0;B<h;++B)j.push("if(typeof i"+B+"==='number'){d=i"+B+"|0;if(d<0){c+=b"+B+"*(a"+B+"-1);a"+B+"=ceil(-a"+B+"/d)}else{a"+B+"=ceil(a"+B+"/d)}b"+B+"*=d}");j.push("return new "+o+"(this.data,"+M.map((function(D){return"a"+D})).join(",")+","+M.map((function(D){return"b"+D})).join(",")+",c)}");var s=new Array(h),U=new Array(h);for(B=0;B<h;++B)s[B]="a[i"+B+"]",U[B]="b[i"+B+"]";j.push("proto.transpose=function "+o+"_transpose("+t+"){"+t.map((function(D,h){return D+"=("+D+"===undefined?"+h+":"+D+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+o+"(this.data,"+s.join(",")+","+U.join(",")+",this.offset)}"),j.push("proto.pick=function "+o+"_pick("+t+"){var a=[],b=[],c=this.offset");for(B=0;B<h;++B)j.push("if(typeof i"+B+"==='number'&&i"+B+">=0){c=(c+this.stride["+B+"]*i"+B+")|0}else{a.push(this.shape["+B+"]);b.push(this.stride["+B+"])}");return j.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),j.push("return function construct_"+o+"(data,shape,stride,offset){return new "+o+"(data,"+M.map((function(D){return"shape["+D+"]"})).join(",")+","+M.map((function(D){return"stride["+D+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",j.join("\n"))(S[D],R)}var S={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};D.exports=function(D,h,o,H){if(void 0===D)return(0,S.array[0])([]);"number"===typeof D&&(D=[D]),void 0===h&&(h=[D.length]);var M=h.length;if(void 0===o){o=new Array(M);for(var R=M-1,k=1;R>=0;--R)o[R]=k,k*=h[R]}if(void 0===H){H=0;for(R=0;R<M;++R)o[R]<0&&(H-=(h[R]-1)*o[R])}for(var K=function(D){if(g(D))return"buffer";if(j)switch(Object.prototype.toString.call(D)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(D)?"array":"generic"}(D),Q=S[K];Q.length<=M+1;)Q.push(t(K,Q.length-1));return(0,Q[M+1])(D,h,o,H)}},14683:D=>{var h;self,h=()=>(()=>{"use strict";var D={d:(h,o)=>{for(var H in o)D.o(o,H)&&!D.o(h,H)&&Object.defineProperty(h,H,{enumerable:!0,get:o[H]})},o:(D,h)=>Object.prototype.hasOwnProperty.call(D,h)},h={};D.d(h,{default:()=>p});var o,H=function(D,h){var o=h.x-D.x,H=h.y-D.y;return Math.sqrt(o*o+H*H)},g=function(D){return D*(Math.PI/180)},j=new Map,M=function(D){j.has(D)&&clearTimeout(j.get(D)),j.set(D,setTimeout(D,100))},R=function(D,h,o){for(var H,g=h.split(/[ ,]+/g),j=0;j<g.length;j+=1)H=g[j],D.addEventListener?D.addEventListener(H,o,!1):D.attachEvent&&D.attachEvent(H,o)},t=function(D,h,o){for(var H,g=h.split(/[ ,]+/g),j=0;j<g.length;j+=1)H=g[j],D.removeEventListener?D.removeEventListener(H,o):D.detachEvent&&D.detachEvent(H,o)},S=function(D){return D.preventDefault(),D.type.match(/^touch/)?D.changedTouches:D},k=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},K=function(D,h){h.top||h.right||h.bottom||h.left?(D.style.top=h.top,D.style.right=h.right,D.style.bottom=h.bottom,D.style.left=h.left):(D.style.left=h.x+"px",D.style.top=h.y+"px")},Q=function(D,h,o){var H=v(D);for(var g in H)if(H.hasOwnProperty(g))if("string"==typeof h)H[g]=h+" "+o;else{for(var j="",M=0,R=h.length;M<R;M+=1)j+=h[M]+" "+o+", ";H[g]=j.slice(0,-2)}return H},v=function(D){var h={};return h[D]="",["webkit","Moz","o"].forEach((function(o){h[o+D.charAt(0).toUpperCase()+D.slice(1)]=""})),h},r=function(D,h){for(var o in h)h.hasOwnProperty(o)&&(D[o]=h[o]);return D},B=function(D,h){if(D.length)for(var o=0,H=D.length;o<H;o+=1)h(D[o]);else h(D)},s="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,U=window.matchMedia("(any-hover: none)").matches,q=!!("ontouchstart"in window),c=!!window.PointerEvent,y=!!window.MSPointerEvent,b={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},i={start:"mousedown",move:"mousemove",end:"mouseup"},G={};function N(){}s&&!U?o=b:c?o={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:y?o={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:q?(o=b,G=i):o=i,N.prototype.on=function(D,h){var o,H=this,g=D.split(/[ ,]+/g);H._handlers_=H._handlers_||{};for(var j=0;j<g.length;j+=1)o=g[j],H._handlers_[o]=H._handlers_[o]||[],H._handlers_[o].push(h);return H},N.prototype.off=function(D,h){var o=this;return o._handlers_=o._handlers_||{},void 0===D?o._handlers_={}:void 0===h?o._handlers_[D]=null:o._handlers_[D]&&o._handlers_[D].indexOf(h)>=0&&o._handlers_[D].splice(o._handlers_[D].indexOf(h),1),o},N.prototype.trigger=function(D,h){var o,H=this,g=D.split(/[ ,]+/g);H._handlers_=H._handlers_||{};for(var j=0;j<g.length;j+=1)o=g[j],H._handlers_[o]&&H._handlers_[o].length&&H._handlers_[o].forEach((function(D){D.call(H,{type:o,target:H},h)}))},N.prototype.config=function(D){var h=this;h.options=h.defaults||{},D&&(h.options=function(D,h){var o={};for(var H in D)D.hasOwnProperty(H)&&h.hasOwnProperty(H)?o[H]=h[H]:D.hasOwnProperty(H)&&(o[H]=D[H]);return o}(h.options,D))},N.prototype.bindEvt=function(D,h){var H=this;return H._domHandlers_=H._domHandlers_||{},H._domHandlers_[h]=function(){"function"==typeof H["on"+h]?H["on"+h].apply(H,arguments):console.warn('[WARNING] : Missing "on'+h+'" handler.')},R(D,o[h],H._domHandlers_[h]),G[h]&&R(D,G[h],H._domHandlers_[h]),H},N.prototype.unbindEvt=function(D,h){var H=this;return H._domHandlers_=H._domHandlers_||{},t(D,o[h],H._domHandlers_[h]),G[h]&&t(D,G[h],H._domHandlers_[h]),delete H._domHandlers_[h],this};const J=N;function O(D,h){return this.identifier=h.identifier,this.position=h.position,this.frontPosition=h.frontPosition,this.collection=D,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(h),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=O.id,O.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}O.prototype=new J,O.constructor=O,O.id=0,O.prototype.buildEl=function(D){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},O.prototype.stylize=function(){if(this.options.dataOnly)return this;var D=this.options.fadeTime+"ms",h=function(){var D=v("borderRadius");for(var h in D)D.hasOwnProperty(h)&&(D[h]="50%");return D}(),o=Q("transition","opacity",D),H={};return H.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},H.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},H.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},r(H.el,o),"circle"===this.options.shape&&r(H.back,h),r(H.front,h),this.applyStyles(H),this},O.prototype.applyStyles=function(D){for(var h in this.ui)if(this.ui.hasOwnProperty(h))for(var o in D[h])this.ui[h].style[o]=D[h][o];return this},O.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},O.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},O.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},O.prototype.show=function(D){var h=this;return h.options.dataOnly||(clearTimeout(h.removeTimeout),clearTimeout(h.showTimeout),clearTimeout(h.restTimeout),h.addToDom(),h.restCallback(),setTimeout((function(){h.ui.el.style.opacity=1}),0),h.showTimeout=setTimeout((function(){h.trigger("shown",h.instance),"function"==typeof D&&D.call(this)}),h.options.fadeTime)),h},O.prototype.hide=function(D){var h=this;if(h.options.dataOnly)return h;if(h.ui.el.style.opacity=h.options.restOpacity,clearTimeout(h.removeTimeout),clearTimeout(h.showTimeout),clearTimeout(h.restTimeout),h.removeTimeout=setTimeout((function(){var o="dynamic"===h.options.mode?"none":"block";h.ui.el.style.display=o,"function"==typeof D&&D.call(h),h.trigger("hidden",h.instance)}),h.options.fadeTime),h.options.restJoystick){var o=h.options.restJoystick,H={};H.x=!0===o||!1!==o.x?0:h.instance.frontPosition.x,H.y=!0===o||!1!==o.y?0:h.instance.frontPosition.y,h.setPosition(D,H)}return h},O.prototype.setPosition=function(D,h){var o=this;o.frontPosition={x:h.x,y:h.y};var H=o.options.fadeTime+"ms",g={};g.front=Q("transition",["transform"],H);var j={front:{}};j.front={transform:"translate("+o.frontPosition.x+"px,"+o.frontPosition.y+"px)"},o.applyStyles(g),o.applyStyles(j),o.restTimeout=setTimeout((function(){"function"==typeof D&&D.call(o),o.restCallback()}),o.options.fadeTime)},O.prototype.restCallback=function(){var D=this,h={};h.front=Q("transition","none",""),D.applyStyles(h),D.trigger("rested",D.instance)},O.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},O.prototype.computeDirection=function(D){var h,o,H,g=D.angle.radian,j=Math.PI/4,M=Math.PI/2;if(g>j&&g<3*j&&!D.lockX?h="up":g>-j&&g<=j&&!D.lockY?h="left":g>3*-j&&g<=-j&&!D.lockX?h="down":D.lockY||(h="right"),D.lockY||(o=g>-M&&g<M?"left":"right"),D.lockX||(H=g>0?"up":"down"),D.force>this.options.threshold){var R,t={};for(R in this.direction)this.direction.hasOwnProperty(R)&&(t[R]=this.direction[R]);var S={};for(R in this.direction={x:o,y:H,angle:h},D.direction=this.direction,t)t[R]===this.direction[R]&&(S[R]=!0);if(S.x&&S.y&&S.angle)return D;S.x&&S.y||this.trigger("plain",D),S.x||this.trigger("plain:"+o,D),S.y||this.trigger("plain:"+H,D),S.angle||this.trigger("dir dir:"+h,D)}else this.resetDirection();return D};const E=O;function L(D,h){var o=this;o.nipples=[],o.idles=[],o.actives=[],o.ids=[],o.pressureIntervals={},o.manager=D,o.id=L.id,L.id+=1,o.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},o.config(h),"static"!==o.options.mode&&"semi"!==o.options.mode||(o.options.multitouch=!1),o.options.multitouch||(o.options.maxNumberOfNipples=1);var H=getComputedStyle(o.options.zone.parentElement);return H&&"flex"===H.display&&(o.parentIsFlex=!0),o.updateBox(),o.prepareNipples(),o.XQ(),o.begin(),o.nipples}L.prototype=new J,L.constructor=L,L.id=0,L.prototype.prepareNipples=function(){var D=this,h=D.nipples;h.on=D.on.bind(D),h.off=D.off.bind(D),h.options=D.options,h.destroy=D.destroy.bind(D),h.ids=D.ids,h.id=D.id,h.processOnMove=D.processOnMove.bind(D),h.processOnEnd=D.processOnEnd.bind(D),h.get=function(D){if(void 0===D)return h[0];for(var o=0,H=h.length;o<H;o+=1)if(h[o].identifier===D)return h[o];return!1}},L.prototype.XQ=function(){var D=this;D.bindEvt(D.options.zone,"start"),D.options.zone.style.touchAction="none",D.options.zone.style.msTouchAction="none"},L.prototype.begin=function(){var D=this,h=D.options;if("static"===h.mode){var o=D.createNipple(h.position,D.manager.getIdentifier());o.add(),D.idles.push(o)}},L.prototype.createNipple=function(D,h){var o=this,H=o.manager.scroll,g={},j=o.options,M=o.parentIsFlex?H.x:H.x+o.box.left,R=o.parentIsFlex?H.y:H.y+o.box.top;if(D.x&&D.y)g={x:D.x-M,y:D.y-R};else if(D.top||D.right||D.bottom||D.left){var t=document.createElement("DIV");t.style.display="hidden",t.style.top=D.top,t.style.right=D.right,t.style.bottom=D.bottom,t.style.left=D.left,t.style.position="absolute",j.zone.appendChild(t);var S=t.getBoundingClientRect();j.zone.removeChild(t),g=D,D={x:S.left+H.x,y:S.top+H.y}}var k=new E(o,{color:j.color,size:j.size,threshold:j.threshold,fadeTime:j.fadeTime,dataOnly:j.dataOnly,restJoystick:j.restJoystick,restOpacity:j.restOpacity,mode:j.mode,identifier:h,position:D,zone:j.zone,frontPosition:{x:0,y:0},shape:j.shape});return j.dataOnly||(K(k.ui.el,g),K(k.ui.front,k.frontPosition)),o.nipples.push(k),o.trigger("added "+k.identifier+":added",k),o.manager.trigger("added "+k.identifier+":added",k),o.bindNipple(k),k},L.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},L.prototype.bindNipple=function(D){var h,o=this,H=function(D,H){h=D.type+" "+H.id+":"+D.type,o.trigger(h,H)};D.on("destroyed",o.onDestroyed.bind(o)),D.on("shown hidden rested dir plain",H),D.on("dir:up dir:right dir:down dir:left",H),D.on("plain:up plain:right plain:down plain:left",H)},L.prototype.pressureFn=function(D,h,o){var H=this,g=0;clearInterval(H.pressureIntervals[o]),H.pressureIntervals[o]=setInterval(function(){var o=D.force||D.pressure||D.webkitForce||0;o!==g&&(h.trigger("pressure",o),H.trigger("pressure "+h.identifier+":pressure",o),g=o)}.bind(H),100)},L.prototype.onstart=function(D){var h=this,o=h.options,H=D;return D=S(D),h.updateBox(),B(D,(function(g){h.actives.length<o.maxNumberOfNipples?h.processOnStart(g):H.type.match(/^touch/)&&(Object.keys(h.manager.ids).forEach((function(o){if(Object.values(H.touches).findIndex((function(D){return D.identifier===o}))<0){var g=[D[0]];g.identifier=o,h.processOnEnd(g)}})),h.actives.length<o.maxNumberOfNipples&&h.processOnStart(g))})),h.manager.bindDocument(),!1},L.prototype.processOnStart=function(D){var h,o=this,g=o.options,j=o.manager.getIdentifier(D),M=D.force||D.pressure||D.webkitForce||0,R={x:D.pageX,y:D.pageY},t=o.getOrCreate(j,R);t.identifier!==j&&o.manager.removeIdentifier(t.identifier),t.identifier=j;var S=function(h){h.trigger("start",h),o.trigger("start "+h.id+":start",h),h.show(),M>0&&o.pressureFn(D,h,h.identifier),o.processOnMove(D)};if((h=o.idles.indexOf(t))>=0&&o.idles.splice(h,1),o.actives.push(t),o.ids.push(t.identifier),"semi"!==g.mode)S(t);else{if(!(H(R,t.position)<=g.catchDistance))return t.destroy(),void o.processOnStart(D);S(t)}return t},L.prototype.getOrCreate=function(D,h){var o,H=this,g=H.options;return/(semi|static)/.test(g.mode)?(o=H.idles[0])?(H.idles.splice(0,1),o):"semi"===g.mode?H.createNipple(h,D):(console.warn("Coudln't find the needed nipple."),!1):o=H.createNipple(h,D)},L.prototype.processOnMove=function(D){var h=this,o=h.options,j=h.manager.getIdentifier(D),M=h.nipples.get(j),R=h.manager.scroll;if(function(D){return isNaN(D.buttons)?0!==D.pressure:0!==D.buttons}(D)){if(!M)return console.error("Found zombie joystick with ID "+j),void h.manager.removeIdentifier(j);if(o.dynamicPage){var t=M.el.getBoundingClientRect();M.position={x:R.x+t.left,y:R.y+t.top}}M.identifier=j;var S=M.options.size/2,k={x:D.pageX,y:D.pageY};o.lockX&&(k.y=M.position.y),o.lockY&&(k.x=M.position.x);var K,Q,v,r,B,s,U,q,c,y,b=H(k,M.position),i=(K=k,v=(Q=M.position).x-K.x,r=Q.y-K.y,function(D){return D*(180/Math.PI)}(Math.atan2(r,v))),G=g(i),N=b/S,J={distance:b,position:k};if("circle"===M.options.shape?(B=Math.min(b,S),U=M.position,q=B,y={x:0,y:0},c=g(c=i),y.x=U.x-q*Math.cos(c),y.y=U.y-q*Math.sin(c),s=y):(s=function(D,h,o){return{x:Math.min(Math.max(D.x,h.x-o),h.x+o),y:Math.min(Math.max(D.y,h.y-o),h.y+o)}}(k,M.position,S),B=H(s,M.position)),o.follow){if(b>S){var O=k.x-s.x,E=k.y-s.y;M.position.x+=O,M.position.y+=E,M.el.style.top=M.position.y-(h.box.top+R.y)+"px",M.el.style.left=M.position.x-(h.box.left+R.x)+"px",b=H(k,M.position)}}else k=s,b=B;var L=k.x-M.position.x,T=k.y-M.position.y;M.frontPosition={x:L,y:T},o.dataOnly||(M.ui.front.style.transform="translate("+L+"px,"+T+"px)");var Z={identifier:M.identifier,position:k,force:N,pressure:D.force||D.pressure||D.webkitForce||0,distance:b,angle:{radian:G,degree:i},vector:{x:L/S,y:-T/S},raw:J,instance:M,lockX:o.lockX,lockY:o.lockY};(Z=M.computeDirection(Z)).angle={radian:g(180-i),degree:180-i},M.trigger("move",Z),h.trigger("move "+M.id+":move",Z)}else this.processOnEnd(D)},L.prototype.processOnEnd=function(D){var h=this,o=h.options,H=h.manager.getIdentifier(D),g=h.nipples.get(H),j=h.manager.removeIdentifier(g.identifier);g&&(o.dataOnly||g.hide((function(){"dynamic"===o.mode&&(g.trigger("removed",g),h.trigger("removed "+g.id+":removed",g),h.manager.trigger("removed "+g.id+":removed",g),g.destroy())})),clearInterval(h.pressureIntervals[g.identifier]),g.resetDirection(),g.trigger("end",g),h.trigger("end "+g.id+":end",g),h.ids.indexOf(g.identifier)>=0&&h.ids.splice(h.ids.indexOf(g.identifier),1),h.actives.indexOf(g)>=0&&h.actives.splice(h.actives.indexOf(g),1),/(semi|static)/.test(o.mode)?h.idles.push(g):h.nipples.indexOf(g)>=0&&h.nipples.splice(h.nipples.indexOf(g),1),h.manager.unbindDocument(),/(semi|static)/.test(o.mode)&&(h.manager.ids[j.id]=j.identifier))},L.prototype.onDestroyed=function(D,h){var o=this;o.nipples.indexOf(h)>=0&&o.nipples.splice(o.nipples.indexOf(h),1),o.actives.indexOf(h)>=0&&o.actives.splice(o.actives.indexOf(h),1),o.idles.indexOf(h)>=0&&o.idles.splice(o.idles.indexOf(h),1),o.ids.indexOf(h.identifier)>=0&&o.ids.splice(o.ids.indexOf(h.identifier),1),o.manager.removeIdentifier(h.identifier),o.manager.unbindDocument()},L.prototype.destroy=function(){var D=this;for(var h in D.unbindEvt(D.options.zone,"start"),D.nipples.forEach((function(D){D.destroy()})),D.pressureIntervals)D.pressureIntervals.hasOwnProperty(h)&&clearInterval(D.pressureIntervals[h]);D.trigger("destroyed",D.nipples),D.manager.unbindDocument(),D.off()};const T=L;function Z(D){var h=this;h.ids={},h.index=0,h.collections=[],h.scroll=k(),h.config(D),h.prepareCollections();var o=function(){var D;h.collections.forEach((function(o){o.forEach((function(o){D=o.el.getBoundingClientRect(),o.position={x:h.scroll.x+D.left,y:h.scroll.y+D.top}}))}))};R(window,"resize",(function(){M(o)}));var H=function(){h.scroll=k()};return R(window,"scroll",(function(){M(H)})),h.collections}Z.prototype=new J,Z.constructor=Z,Z.prototype.prepareCollections=function(){var D=this;D.collections.create=D.create.bind(D),D.collections.on=D.on.bind(D),D.collections.off=D.off.bind(D),D.collections.destroy=D.destroy.bind(D),D.collections.get=function(h){var o;return D.collections.every((function(D){return!(o=D.get(h))})),o}},Z.prototype.create=function(D){return this.createCollection(D)},Z.prototype.createCollection=function(D){var h=this,o=new T(h,D);return h.bindCollection(o),h.collections.push(o),o},Z.prototype.bindCollection=function(D){var h,o=this,H=function(D,H){h=D.type+" "+H.id+":"+D.type,o.trigger(h,H)};D.on("destroyed",o.onDestroyed.bind(o)),D.on("shown hidden rested dir plain",H),D.on("dir:up dir:right dir:down dir:left",H),D.on("plain:up plain:right plain:down plain:left",H)},Z.prototype.bindDocument=function(){var D=this;D.binded||(D.bindEvt(document,"move").bindEvt(document,"end"),D.binded=!0)},Z.prototype.unbindDocument=function(D){var h=this;Object.keys(h.ids).length&&!0!==D||(h.unbindEvt(document,"move").unbindEvt(document,"end"),h.binded=!1)},Z.prototype.getIdentifier=function(D){var h;return D?void 0===(h=void 0===D.identifier?D.pointerId:D.identifier)&&(h=this.latest||0):h=this.index,void 0===this.ids[h]&&(this.ids[h]=this.index,this.index+=1),this.latest=h,this.ids[h]},Z.prototype.removeIdentifier=function(D){var h={};for(var o in this.ids)if(this.ids[o]===D){h.id=o,h.identifier=this.ids[o],delete this.ids[o];break}return h},Z.prototype.onmove=function(D){return this.onAny("move",D),!1},Z.prototype.onend=function(D){return this.onAny("end",D),!1},Z.prototype.oncancel=function(D){return this.onAny("end",D),!1},Z.prototype.onAny=function(D,h){var o,H=this,g="processOn"+D.charAt(0).toUpperCase()+D.slice(1);h=S(h);var j=function(D,h,o){o.ids.indexOf(h)>=0&&(o[g](D),D._found_=!0)};return B(h,(function(D){o=H.getIdentifier(D),B(H.collections,j.bind(null,D,o)),D._found_||H.removeIdentifier(o)})),!1},Z.prototype.destroy=function(){var D=this;D.unbindDocument(!0),D.ids={},D.index=0,D.collections.forEach((function(D){D.destroy()})),D.off()},Z.prototype.onDestroyed=function(D,h){var o=this;if(o.collections.indexOf(h)<0)return!1;o.collections.splice(o.collections.indexOf(h),1)};var e=new Z;const p={create:function(D){return e.create(D)},factory:e};return h.default})(),D.exports=h()},14734:(D,h,o)=>{"use strict";const{Deflate:H,deflate:g,deflateRaw:j,gzip:M}=o(14739),{Inflate:R,inflate:t,inflateRaw:S,ungzip:k}=o(14784),K=o(14764);D.exports.Deflate=H,D.exports.deflate=g,D.exports.deflateRaw=j,D.exports.gzip=M,D.exports.Inflate=R,D.exports.inflate=t,D.exports.inflateRaw=S,D.exports.ungzip=k,D.exports.constants=K},14739:(D,h,o)=>{"use strict";const H=o(14742),g=o(14770),j=o(14774),M=o(14759),R=o(14778),t=Object.prototype.toString,{Z_NO_FLUSH:S,Z_SYNC_FLUSH:k,Z_FULL_FLUSH:K,Z_FINISH:Q,Z_OK:v,Z_STREAM_END:r,Z_DEFAULT_COMPRESSION:B,Z_DEFAULT_STRATEGY:s,Z_DEFLATED:U}=o(14764);function q(D){this.options=g.assign({level:B,method:U,PD:16384,windowBits:15,memLevel:8,strategy:s},D||{});let h=this.options;h.raw&&h.windowBits>0?h.windowBits=-h.windowBits:h.gzip&&h.windowBits>0&&h.windowBits<16&&(h.windowBits+=16),this.err=0,this.rh="",this.ended=!1,this.chunks=[],this.strm=new R,this.strm.avail_out=0;let o=H.deflateInit2(this.strm,h.level,h.method,h.windowBits,h.memLevel,h.strategy);if(o!==v)throw new Error(M[o]);if(h.header&&H.deflateSetHeader(this.strm,h.header),h.dictionary){let D;if(D="string"===typeof h.dictionary?j.string2buf(h.dictionary):"[object ArrayBuffer]"===t.call(h.dictionary)?new Uint8Array(h.dictionary):h.dictionary,o=H.deflateSetDictionary(this.strm,D),o!==v)throw new Error(M[o]);this._dict_set=!0}}function c(D,h){const o=new q(h);if(o.push(D,!0),o.err)throw o.rh||M[o.err];return o.result}q.prototype.push=function(D,h){const o=this.strm,g=this.options.PD;let M,R;if(this.ended)return!1;for(R=h===~~h?h:!0===h?Q:S,"string"===typeof D?o.input=j.string2buf(D):"[object ArrayBuffer]"===t.call(D)?o.input=new Uint8Array(D):o.input=D,o.next_in=0,o.avail_in=o.input.length;;)if(0===o.avail_out&&(o.output=new Uint8Array(g),o.next_out=0,o.avail_out=g),(R===k||R===K)&&o.avail_out<=6)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else{if(M=H.deflate(o,R),M===r)return o.next_out>0&&this.onData(o.output.subarray(0,o.next_out)),M=H.deflateEnd(this.strm),this.onEnd(M),this.ended=!0,M===v;if(0!==o.avail_out){if(R>0&&o.next_out>0)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else if(0===o.avail_in)break}else this.onData(o.output)}return!0},q.prototype.onData=function(D){this.chunks.push(D)},q.prototype.onEnd=function(D){D===v&&(this.result=g.flattenChunks(this.chunks)),this.chunks=[],this.err=D,this.rh=this.strm.rh},D.exports.Deflate=q,D.exports.deflate=c,D.exports.deflateRaw=function(D,h){return(h=h||{}).raw=!0,c(D,h)},D.exports.gzip=function(D,h){return(h=h||{}).gzip=!0,c(D,h)},D.exports.constants=o(14764)},14784:(D,h,o)=>{"use strict";const H=o(14793),g=o(14770),j=o(14774),M=o(14759),R=o(14778),t=o(14808),S=Object.prototype.toString,{Z_NO_FLUSH:k,Z_FINISH:K,Z_OK:Q,Z_STREAM_END:v,Z_NEED_DICT:r,Z_STREAM_ERROR:B,Z_DATA_ERROR:s,Z_MEM_ERROR:U}=o(14764);function q(D){this.options=g.assign({PD:65536,windowBits:15,to:""},D||{});const h=this.options;h.raw&&h.windowBits>=0&&h.windowBits<16&&(h.windowBits=-h.windowBits,0===h.windowBits&&(h.windowBits=-15)),!(h.windowBits>=0&&h.windowBits<16)||D&&D.windowBits||(h.windowBits+=32),h.windowBits>15&&h.windowBits<48&&0===(15&h.windowBits)&&(h.windowBits|=15),this.err=0,this.rh="",this.ended=!1,this.chunks=[],this.strm=new R,this.strm.avail_out=0;let o=H.inflateInit2(this.strm,h.windowBits);if(o!==Q)throw new Error(M[o]);if(this.header=new t,H.inflateGetHeader(this.strm,this.header),h.dictionary&&("string"===typeof h.dictionary?h.dictionary=j.string2buf(h.dictionary):"[object ArrayBuffer]"===S.call(h.dictionary)&&(h.dictionary=new Uint8Array(h.dictionary)),h.raw&&(o=H.inflateSetDictionary(this.strm,h.dictionary),o!==Q)))throw new Error(M[o])}function c(D,h){const o=new q(h);if(o.push(D),o.err)throw o.rh||M[o.err];return o.result}q.prototype.push=function(D,h){const o=this.strm,g=this.options.PD,M=this.options.dictionary;let R,t,q;if(this.ended)return!1;for(t=h===~~h?h:!0===h?K:k,"[object ArrayBuffer]"===S.call(D)?o.input=new Uint8Array(D):o.input=D,o.next_in=0,o.avail_in=o.input.length;;){for(0===o.avail_out&&(o.output=new Uint8Array(g),o.next_out=0,o.avail_out=g),R=H.inflate(o,t),R===r&&M&&(R=H.inflateSetDictionary(o,M),R===Q?R=H.inflate(o,t):R===s&&(R=r));o.avail_in>0&&R===v&&o.state.wrap>0&&0!==D[o.next_in];)H.inflateReset(o),R=H.inflate(o,t);switch(R){case B:case s:case r:case U:return this.onEnd(R),this.ended=!0,!1}if(q=o.avail_out,o.next_out&&(0===o.avail_out||R===v))if("string"===this.options.to){let D=j.utf8border(o.output,o.next_out),h=o.next_out-D,H=j.buf2string(o.output,D);o.next_out=h,o.avail_out=g-h,h&&o.output.set(o.output.subarray(D,D+h),0),this.onData(H)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out));if(R!==Q||0!==q){if(R===v)return R=H.inflateEnd(this.strm),this.onEnd(R),this.ended=!0,!0;if(0===o.avail_in)break}}return!0},q.prototype.onData=function(D){this.chunks.push(D)},q.prototype.onEnd=function(D){D===Q&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=g.flattenChunks(this.chunks)),this.chunks=[],this.err=D,this.rh=this.strm.rh},D.exports.Inflate=q,D.exports.inflate=c,D.exports.inflateRaw=function(D,h){return(h=h||{}).raw=!0,c(D,h)},D.exports.ungzip=c,D.exports.constants=o(14764)},14770:D=>{"use strict";const h=(D,h)=>Object.prototype.hasOwnProperty.call(D,h);D.exports.assign=function(D){const o=Array.prototype.slice.call(arguments,1);for(;o.length;){const H=o.shift();if(H){if("object"!==typeof H)throw new TypeError(H+"must be non-object");for(const o in H)h(H,o)&&(D[o]=H[o])}}return D},D.exports.flattenChunks=D=>{let h=0;for(let H=0,g=D.length;H<g;H++)h+=D[H].length;const o=new Uint8Array(h);for(let H=0,g=0,j=D.length;H<j;H++){let h=D[H];o.set(h,g),g+=h.length}return o}},14774:D=>{"use strict";let h=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(H){h=!1}const o=new Uint8Array(256);for(let g=0;g<256;g++)o[g]=g>=252?6:g>=248?5:g>=240?4:g>=224?3:g>=192?2:1;o[254]=o[254]=1,D.exports.string2buf=D=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(D);let h,o,H,g,j,M=D.length,R=0;for(g=0;g<M;g++)o=D.charCodeAt(g),55296===(64512&o)&&g+1<M&&(H=D.charCodeAt(g+1),56320===(64512&H)&&(o=65536+(o-55296<<10)+(H-56320),g++)),R+=o<128?1:o<2048?2:o<65536?3:4;for(h=new Uint8Array(R),j=0,g=0;j<R;g++)o=D.charCodeAt(g),55296===(64512&o)&&g+1<M&&(H=D.charCodeAt(g+1),56320===(64512&H)&&(o=65536+(o-55296<<10)+(H-56320),g++)),o<128?h[j++]=o:o<2048?(h[j++]=192|o>>>6,h[j++]=128|63&o):o<65536?(h[j++]=224|o>>>12,h[j++]=128|o>>>6&63,h[j++]=128|63&o):(h[j++]=240|o>>>18,h[j++]=128|o>>>12&63,h[j++]=128|o>>>6&63,h[j++]=128|63&o);return h};D.exports.buf2string=(D,H)=>{const g=H||D.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(D.subarray(0,H));let j,M;const R=new Array(2*g);for(M=0,j=0;j<g;){let h=D[j++];if(h<128){R[M++]=h;continue}let H=o[h];if(H>4)R[M++]=65533,j+=H-1;else{for(h&=2===H?31:3===H?15:7;H>1&&j<g;)h=h<<6|63&D[j++],H--;H>1?R[M++]=65533:h<65536?R[M++]=h:(h-=65536,R[M++]=55296|h>>10&1023,R[M++]=56320|1023&h)}}return((D,o)=>{if(o<65534&&D.subarray&&h)return String.fromCharCode.apply(null,D.length===o?D:D.subarray(0,o));let H="";for(let h=0;h<o;h++)H+=String.fromCharCode(D[h]);return H})(R,M)},D.exports.utf8border=(D,h)=>{(h=h||D.length)>D.length&&(h=D.length);let H=h-1;for(;H>=0&&128===(192&D[H]);)H--;return H<0||0===H?h:H+o[D[H]]>h?H:h}},14749:D=>{"use strict";D.exports=(D,h,o,H)=>{let g=65535&D,j=D>>>16&65535,M=0;for(;0!==o;){M=o>2e3?2e3:o,o-=M;do{g=g+h[H++]|0,j=j+g|0}while(--M);g%=65521,j%=65521}return g|j<<16}},14764:D=>{"use strict";D.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},14751:D=>{"use strict";const h=new Uint32Array((()=>{let D,h=[];for(var o=0;o<256;o++){D=o;for(var H=0;H<8;H++)D=1&D?3988292384^D>>>1:D>>>1;h[o]=D}return h})());D.exports=(D,o,H,g)=>{const j=h,M=g+H;D^=-1;for(let h=g;h<M;h++)D=D>>>8^j[255&(D^o[h])];return~D}},14742:(D,h,o)=>{"use strict";const{_tr_init:H,_tr_stored_block:g,_tr_flush_block:j,_tr_tally:M,_tr_align:R}=o(14746),t=o(14749),S=o(14751),k=o(14759),{Z_NO_FLUSH:K,Z_PARTIAL_FLUSH:Q,Z_FULL_FLUSH:v,Z_FINISH:r,Z_BLOCK:B,Z_OK:s,Z_STREAM_END:U,Z_STREAM_ERROR:q,Z_DATA_ERROR:c,Z_BUF_ERROR:y,Z_DEFAULT_COMPRESSION:b,Z_FILTERED:i,Z_HUFFMAN_ONLY:G,Z_RLE:N,Z_FIXED:J,Z_DEFAULT_STRATEGY:O,Z_UNKNOWN:E,Z_DEFLATED:L}=o(14764),T=258,Z=262,e=103,p=113,mD=666,a=(D,h)=>(D.rh=k[h],h),u=D=>(D<<1)-(D>4?9:0),I=D=>{let h=D.length;for(;--h>=0;)D[h]=0};let P=(D,h,o)=>(h<<D.hash_shift^o)&D.hash_mask;const n=D=>{const h=D.state;let o=h.pending;o>D.avail_out&&(o=D.avail_out),0!==o&&(D.output.set(h.pending_buf.subarray(h.pending_out,h.pending_out+o),D.next_out),D.next_out+=o,h.pending_out+=o,D.total_out+=o,D.avail_out-=o,h.pending-=o,0===h.pending&&(h.pending_out=0))},F=(D,h)=>{j(D,D.block_start>=0?D.block_start:-1,D.strstart-D.block_start,h),D.block_start=D.strstart,n(D.strm)},w=(D,h)=>{D.pending_buf[D.pending++]=h},Y=(D,h)=>{D.pending_buf[D.pending++]=h>>>8&255,D.pending_buf[D.pending++]=255&h},l=(D,h,o,H)=>{let g=D.avail_in;return g>H&&(g=H),0===g?0:(D.avail_in-=g,h.set(D.input.subarray(D.next_in,D.next_in+g),o),1===D.state.wrap?D.adler=t(D.adler,h,g,o):2===D.state.wrap&&(D.adler=S(D.adler,h,g,o)),D.next_in+=g,D.total_in+=g,g)},C=(D,h)=>{let o,H,g=D.max_chain_length,j=D.strstart,M=D.prev_length,R=D.nice_match;const t=D.strstart>D.w_size-Z?D.strstart-(D.w_size-Z):0,S=D.window,k=D.w_mask,K=D.prev,Q=D.strstart+T;let v=S[j+M-1],r=S[j+M];D.prev_length>=D.good_match&&(g>>=2),R>D.lookahead&&(R=D.lookahead);do{if(o=h,S[o+M]===r&&S[o+M-1]===v&&S[o]===S[j]&&S[++o]===S[j+1]){j+=2,o++;do{}while(S[++j]===S[++o]&&S[++j]===S[++o]&&S[++j]===S[++o]&&S[++j]===S[++o]&&S[++j]===S[++o]&&S[++j]===S[++o]&&S[++j]===S[++o]&&S[++j]===S[++o]&&j<Q);if(H=T-(Q-j),j=Q-T,H>M){if(D.match_start=h,M=H,H>=R)break;v=S[j+M-1],r=S[j+M]}}}while((h=K[h&k])>t&&0!==--g);return M<=D.lookahead?M:D.lookahead},z=D=>{const h=D.w_size;let o,H,g,j,M;do{if(j=D.window_size-D.lookahead-D.strstart,D.strstart>=h+(h-Z)){D.window.set(D.window.subarray(h,h+h),0),D.match_start-=h,D.strstart-=h,D.block_start-=h,H=D.hash_size,o=H;do{g=D.head[--o],D.head[o]=g>=h?g-h:0}while(--H);H=h,o=H;do{g=D.prev[--o],D.prev[o]=g>=h?g-h:0}while(--H);j+=h}if(0===D.strm.avail_in)break;if(H=l(D.strm,D.window,D.strstart+D.lookahead,j),D.lookahead+=H,D.lookahead+D.insert>=3)for(M=D.strstart-D.insert,D.ins_h=D.window[M],D.ins_h=P(D,D.ins_h,D.window[M+1]);D.insert&&(D.ins_h=P(D,D.ins_h,D.window[M+3-1]),D.prev[M&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=M,M++,D.insert--,!(D.lookahead+D.insert<3)););}while(D.lookahead<Z&&0!==D.strm.avail_in)},f=(D,h)=>{let o,H;for(;;){if(D.lookahead<Z){if(z(D),D.lookahead<Z&&h===K)return 1;if(0===D.lookahead)break}if(o=0,D.lookahead>=3&&(D.ins_h=P(D,D.ins_h,D.window[D.strstart+3-1]),o=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart),0!==o&&D.strstart-o<=D.w_size-Z&&(D.match_length=C(D,o)),D.match_length>=3)if(H=M(D,D.strstart-D.match_start,D.match_length-3),D.lookahead-=D.match_length,D.match_length<=D.max_lazy_match&&D.lookahead>=3){D.match_length--;do{D.strstart++,D.ins_h=P(D,D.ins_h,D.window[D.strstart+3-1]),o=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart}while(0!==--D.match_length);D.strstart++}else D.strstart+=D.match_length,D.match_length=0,D.ins_h=D.window[D.strstart],D.ins_h=P(D,D.ins_h,D.window[D.strstart+1]);else H=M(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++;if(H&&(F(D,!1),0===D.strm.avail_out))return 1}return D.insert=D.strstart<2?D.strstart:2,h===r?(F(D,!0),0===D.strm.avail_out?3:4):D.last_lit&&(F(D,!1),0===D.strm.avail_out)?1:2},V=(D,h)=>{let o,H,g;for(;;){if(D.lookahead<Z){if(z(D),D.lookahead<Z&&h===K)return 1;if(0===D.lookahead)break}if(o=0,D.lookahead>=3&&(D.ins_h=P(D,D.ins_h,D.window[D.strstart+3-1]),o=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart),D.prev_length=D.match_length,D.prev_match=D.match_start,D.match_length=2,0!==o&&D.prev_length<D.max_lazy_match&&D.strstart-o<=D.w_size-Z&&(D.match_length=C(D,o),D.match_length<=5&&(D.strategy===i||3===D.match_length&&D.strstart-D.match_start>4096)&&(D.match_length=2)),D.prev_length>=3&&D.match_length<=D.prev_length){g=D.strstart+D.lookahead-3,H=M(D,D.strstart-1-D.prev_match,D.prev_length-3),D.lookahead-=D.prev_length-1,D.prev_length-=2;do{++D.strstart<=g&&(D.ins_h=P(D,D.ins_h,D.window[D.strstart+3-1]),o=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart)}while(0!==--D.prev_length);if(D.match_available=0,D.match_length=2,D.strstart++,H&&(F(D,!1),0===D.strm.avail_out))return 1}else if(D.match_available){if(H=M(D,0,D.window[D.strstart-1]),H&&F(D,!1),D.strstart++,D.lookahead--,0===D.strm.avail_out)return 1}else D.match_available=1,D.strstart++,D.lookahead--}return D.match_available&&(H=M(D,0,D.window[D.strstart-1]),D.match_available=0),D.insert=D.strstart<2?D.strstart:2,h===r?(F(D,!0),0===D.strm.avail_out?3:4):D.last_lit&&(F(D,!1),0===D.strm.avail_out)?1:2};function d(D,h,o,H,g){this.good_length=D,this.max_lazy=h,this.nice_length=o,this.max_chain=H,this.func=g}const X=[new d(0,0,0,0,((D,h)=>{let o=65535;for(o>D.pending_buf_size-5&&(o=D.pending_buf_size-5);;){if(D.lookahead<=1){if(z(D),0===D.lookahead&&h===K)return 1;if(0===D.lookahead)break}D.strstart+=D.lookahead,D.lookahead=0;const H=D.block_start+o;if((0===D.strstart||D.strstart>=H)&&(D.lookahead=D.strstart-H,D.strstart=H,F(D,!1),0===D.strm.avail_out))return 1;if(D.strstart-D.block_start>=D.w_size-Z&&(F(D,!1),0===D.strm.avail_out))return 1}return D.insert=0,h===r?(F(D,!0),0===D.strm.avail_out?3:4):(D.strstart>D.block_start&&(F(D,!1),D.strm.avail_out),1)})),new d(4,4,8,4,f),new d(4,5,16,8,f),new d(4,6,32,32,f),new d(4,4,16,16,V),new d(8,16,32,32,V),new d(8,16,128,128,V),new d(8,32,128,256,V),new d(32,128,258,1024,V),new d(32,258,258,4096,V)];function A(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=L,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),I(this.dyn_ltree),I(this.dyn_dtree),I(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),I(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),I(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const W=D=>{if(!D||!D.state)return a(D,q);D.total_in=D.total_out=0,D.data_type=E;const h=D.state;return h.pending=0,h.pending_out=0,h.wrap<0&&(h.wrap=-h.wrap),h.status=h.wrap?42:p,D.adler=2===h.wrap?0:1,h.last_flush=K,H(h),s},x=D=>{const h=W(D);var o;return h===s&&((o=D.state).window_size=2*o.w_size,I(o.head),o.max_lazy_match=X[o.level].max_lazy,o.good_match=X[o.level].good_length,o.nice_match=X[o.level].nice_length,o.max_chain_length=X[o.level].max_chain,o.strstart=0,o.block_start=0,o.lookahead=0,o.insert=0,o.match_length=o.prev_length=2,o.match_available=0,o.ins_h=0),h},DD=(D,h,o,H,g,j)=>{if(!D)return q;let M=1;if(h===b&&(h=6),H<0?(M=0,H=-H):H>15&&(M=2,H-=16),g<1||g>9||o!==L||H<8||H>15||h<0||h>9||j<0||j>J)return a(D,q);8===H&&(H=9);const R=new A;return D.state=R,R.strm=D,R.wrap=M,R.gzhead=null,R.w_bits=H,R.w_size=1<<R.w_bits,R.w_mask=R.w_size-1,R.hash_bits=g+7,R.hash_size=1<<R.hash_bits,R.hash_mask=R.hash_size-1,R.hash_shift=~~((R.hash_bits+3-1)/3),R.window=new Uint8Array(2*R.w_size),R.head=new Uint16Array(R.hash_size),R.prev=new Uint16Array(R.w_size),R.lit_bufsize=1<<g+6,R.pending_buf_size=4*R.lit_bufsize,R.pending_buf=new Uint8Array(R.pending_buf_size),R.d_buf=1*R.lit_bufsize,R.l_buf=3*R.lit_bufsize,R.level=h,R.strategy=j,R.method=o,x(D)};D.exports.deflateInit=(D,h)=>DD(D,h,L,15,8,O),D.exports.deflateInit2=DD,D.exports.deflateReset=x,D.exports.deflateResetKeep=W,D.exports.deflateSetHeader=(D,h)=>D&&D.state?2!==D.state.wrap?q:(D.state.gzhead=h,s):q,D.exports.deflate=(D,h)=>{let o,H;if(!D||!D.state||h>B||h<0)return D?a(D,q):q;const j=D.state;if(!D.output||!D.input&&0!==D.avail_in||j.status===mD&&h!==r)return a(D,0===D.avail_out?y:q);j.strm=D;const t=j.last_flush;if(j.last_flush=h,42===j.status)if(2===j.wrap)D.adler=0,w(j,31),w(j,139),w(j,8),j.gzhead?(w(j,(j.gzhead.text?1:0)+(j.gzhead.hcrc?2:0)+(j.gzhead.extra?4:0)+(j.gzhead.name?8:0)+(j.gzhead.comment?16:0)),w(j,255&j.gzhead.time),w(j,j.gzhead.time>>8&255),w(j,j.gzhead.time>>16&255),w(j,j.gzhead.time>>24&255),w(j,9===j.level?2:j.strategy>=G||j.level<2?4:0),w(j,255&j.gzhead.os),j.gzhead.extra&&j.gzhead.extra.length&&(w(j,255&j.gzhead.extra.length),w(j,j.gzhead.extra.length>>8&255)),j.gzhead.hcrc&&(D.adler=S(D.adler,j.pending_buf,j.pending,0)),j.gzindex=0,j.status=69):(w(j,0),w(j,0),w(j,0),w(j,0),w(j,0),w(j,9===j.level?2:j.strategy>=G||j.level<2?4:0),w(j,3),j.status=p);else{let h=L+(j.w_bits-8<<4)<<8,o=-1;o=j.strategy>=G||j.level<2?0:j.level<6?1:6===j.level?2:3,h|=o<<6,0!==j.strstart&&(h|=32),h+=31-h%31,j.status=p,Y(j,h),0!==j.strstart&&(Y(j,D.adler>>>16),Y(j,65535&D.adler)),D.adler=1}if(69===j.status)if(j.gzhead.extra){for(o=j.pending;j.gzindex<(65535&j.gzhead.extra.length)&&(j.pending!==j.pending_buf_size||(j.gzhead.hcrc&&j.pending>o&&(D.adler=S(D.adler,j.pending_buf,j.pending-o,o)),n(D),o=j.pending,j.pending!==j.pending_buf_size));)w(j,255&j.gzhead.extra[j.gzindex]),j.gzindex++;j.gzhead.hcrc&&j.pending>o&&(D.adler=S(D.adler,j.pending_buf,j.pending-o,o)),j.gzindex===j.gzhead.extra.length&&(j.gzindex=0,j.status=73)}else j.status=73;if(73===j.status)if(j.gzhead.name){o=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>o&&(D.adler=S(D.adler,j.pending_buf,j.pending-o,o)),n(D),o=j.pending,j.pending===j.pending_buf_size)){H=1;break}H=j.gzindex<j.gzhead.name.length?255&j.gzhead.name.charCodeAt(j.gzindex++):0,w(j,H)}while(0!==H);j.gzhead.hcrc&&j.pending>o&&(D.adler=S(D.adler,j.pending_buf,j.pending-o,o)),0===H&&(j.gzindex=0,j.status=91)}else j.status=91;if(91===j.status)if(j.gzhead.comment){o=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>o&&(D.adler=S(D.adler,j.pending_buf,j.pending-o,o)),n(D),o=j.pending,j.pending===j.pending_buf_size)){H=1;break}H=j.gzindex<j.gzhead.comment.length?255&j.gzhead.comment.charCodeAt(j.gzindex++):0,w(j,H)}while(0!==H);j.gzhead.hcrc&&j.pending>o&&(D.adler=S(D.adler,j.pending_buf,j.pending-o,o)),0===H&&(j.status=e)}else j.status=e;if(j.status===e&&(j.gzhead.hcrc?(j.pending+2>j.pending_buf_size&&n(D),j.pending+2<=j.pending_buf_size&&(w(j,255&D.adler),w(j,D.adler>>8&255),D.adler=0,j.status=p)):j.status=p),0!==j.pending){if(n(D),0===D.avail_out)return j.last_flush=-1,s}else if(0===D.avail_in&&u(h)<=u(t)&&h!==r)return a(D,y);if(j.status===mD&&0!==D.avail_in)return a(D,y);if(0!==D.avail_in||0!==j.lookahead||h!==K&&j.status!==mD){let o=j.strategy===G?((D,h)=>{let o;for(;;){if(0===D.lookahead&&(z(D),0===D.lookahead)){if(h===K)return 1;break}if(D.match_length=0,o=M(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,o&&(F(D,!1),0===D.strm.avail_out))return 1}return D.insert=0,h===r?(F(D,!0),0===D.strm.avail_out?3:4):D.last_lit&&(F(D,!1),0===D.strm.avail_out)?1:2})(j,h):j.strategy===N?((D,h)=>{let o,H,g,j;const R=D.window;for(;;){if(D.lookahead<=T){if(z(D),D.lookahead<=T&&h===K)return 1;if(0===D.lookahead)break}if(D.match_length=0,D.lookahead>=3&&D.strstart>0&&(g=D.strstart-1,H=R[g],H===R[++g]&&H===R[++g]&&H===R[++g])){j=D.strstart+T;do{}while(H===R[++g]&&H===R[++g]&&H===R[++g]&&H===R[++g]&&H===R[++g]&&H===R[++g]&&H===R[++g]&&H===R[++g]&&g<j);D.match_length=T-(j-g),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=3?(o=M(D,1,D.match_length-3),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(o=M(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),o&&(F(D,!1),0===D.strm.avail_out))return 1}return D.insert=0,h===r?(F(D,!0),0===D.strm.avail_out?3:4):D.last_lit&&(F(D,!1),0===D.strm.avail_out)?1:2})(j,h):X[j.level].func(j,h);if(3!==o&&4!==o||(j.status=mD),1===o||3===o)return 0===D.avail_out&&(j.last_flush=-1),s;if(2===o&&(h===Q?R(j):h!==B&&(g(j,0,0,!1),h===v&&(I(j.head),0===j.lookahead&&(j.strstart=0,j.block_start=0,j.insert=0))),n(D),0===D.avail_out))return j.last_flush=-1,s}return h!==r?s:j.wrap<=0?U:(2===j.wrap?(w(j,255&D.adler),w(j,D.adler>>8&255),w(j,D.adler>>16&255),w(j,D.adler>>24&255),w(j,255&D.total_in),w(j,D.total_in>>8&255),w(j,D.total_in>>16&255),w(j,D.total_in>>24&255)):(Y(j,D.adler>>>16),Y(j,65535&D.adler)),n(D),j.wrap>0&&(j.wrap=-j.wrap),0!==j.pending?s:U)},D.exports.deflateEnd=D=>{if(!D||!D.state)return q;const h=D.state.status;return 42!==h&&69!==h&&73!==h&&91!==h&&h!==e&&h!==p&&h!==mD?a(D,q):(D.state=null,h===p?a(D,c):s)},D.exports.deflateSetDictionary=(D,h)=>{let o=h.length;if(!D||!D.state)return q;const H=D.state,g=H.wrap;if(2===g||1===g&&42!==H.status||H.lookahead)return q;if(1===g&&(D.adler=t(D.adler,h,o,0)),H.wrap=0,o>=H.w_size){0===g&&(I(H.head),H.strstart=0,H.block_start=0,H.insert=0);let D=new Uint8Array(H.w_size);D.set(h.subarray(o-H.w_size,o),0),h=D,o=H.w_size}const j=D.avail_in,M=D.next_in,R=D.input;for(D.avail_in=o,D.next_in=0,D.input=h,z(H);H.lookahead>=3;){let D=H.strstart,h=H.lookahead-2;do{H.ins_h=P(H,H.ins_h,H.window[D+3-1]),H.prev[D&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=D,D++}while(--h);H.strstart=D,H.lookahead=2,z(H)}return H.strstart+=H.lookahead,H.block_start=H.strstart,H.insert=H.lookahead,H.lookahead=0,H.match_length=H.prev_length=2,H.match_available=0,D.next_in=M,D.input=R,D.avail_in=j,H.wrap=g,s},D.exports.deflateInfo="pako deflate (from Nodeca project)"},14808:D=>{"use strict";D.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},14796:D=>{"use strict";D.exports=function(D,h){let o,H,g,j,M,R,t,S,k,K,Q,v,r,B,s,U,q,c,y,b,i,G,N,J;const O=D.state;o=D.next_in,N=D.input,H=o+(D.avail_in-5),g=D.next_out,J=D.output,j=g-(h-D.avail_out),M=g+(D.avail_out-257),R=O.dmax,t=O.wsize,S=O.whave,k=O.wnext,K=O.window,Q=O.hold,v=O.bits,r=O.lencode,B=O.distcode,s=(1<<O.lenbits)-1,U=(1<<O.distbits)-1;D:do{v<15&&(Q+=N[o++]<<v,v+=8,Q+=N[o++]<<v,v+=8),q=r[Q&s];h:for(;;){if(c=q>>>24,Q>>>=c,v-=c,c=q>>>16&255,0===c)J[g++]=65535&q;else{if(!(16&c)){if(0===(64&c)){q=r[(65535&q)+(Q&(1<<c)-1)];continue h}if(32&c){O.mode=12;break D}D.rh="invalid literal/length code",O.mode=30;break D}y=65535&q,c&=15,c&&(v<c&&(Q+=N[o++]<<v,v+=8),y+=Q&(1<<c)-1,Q>>>=c,v-=c),v<15&&(Q+=N[o++]<<v,v+=8,Q+=N[o++]<<v,v+=8),q=B[Q&U];o:for(;;){if(c=q>>>24,Q>>>=c,v-=c,c=q>>>16&255,!(16&c)){if(0===(64&c)){q=B[(65535&q)+(Q&(1<<c)-1)];continue o}D.rh="invalid distance code",O.mode=30;break D}if(b=65535&q,c&=15,v<c&&(Q+=N[o++]<<v,v+=8,v<c&&(Q+=N[o++]<<v,v+=8)),b+=Q&(1<<c)-1,b>R){D.rh="invalid distance too far back",O.mode=30;break D}if(Q>>>=c,v-=c,c=g-j,b>c){if(c=b-c,c>S&&O.sane){D.rh="invalid distance too far back",O.mode=30;break D}if(i=0,G=K,0===k){if(i+=t-c,c<y){y-=c;do{J[g++]=K[i++]}while(--c);i=g-b,G=J}}else if(k<c){if(i+=t+k-c,c-=k,c<y){y-=c;do{J[g++]=K[i++]}while(--c);if(i=0,k<y){c=k,y-=c;do{J[g++]=K[i++]}while(--c);i=g-b,G=J}}}else if(i+=k-c,c<y){y-=c;do{J[g++]=K[i++]}while(--c);i=g-b,G=J}for(;y>2;)J[g++]=G[i++],J[g++]=G[i++],J[g++]=G[i++],y-=3;y&&(J[g++]=G[i++],y>1&&(J[g++]=G[i++]))}else{i=g-b;do{J[g++]=J[i++],J[g++]=J[i++],J[g++]=J[i++],y-=3}while(y>2);y&&(J[g++]=J[i++],y>1&&(J[g++]=J[i++]))}break}}break}}while(o<H&&g<M);y=v>>3,o-=y,v-=y<<3,Q&=(1<<v)-1,D.next_in=o,D.next_out=g,D.avail_in=o<H?H-o+5:5-(o-H),D.avail_out=g<M?M-g+257:257-(g-M),O.hold=Q,O.bits=v}},14793:(D,h,o)=>{"use strict";const H=o(14749),g=o(14751),j=o(14796),M=o(14804),{Z_FINISH:R,Z_BLOCK:t,Z_TREES:S,Z_OK:k,Z_STREAM_END:K,Z_NEED_DICT:Q,Z_STREAM_ERROR:v,Z_DATA_ERROR:r,Z_MEM_ERROR:B,Z_BUF_ERROR:s,Z_DEFLATED:U}=o(14764),q=12,c=30,y=D=>(D>>>24&255)+(D>>>8&65280)+((65280&D)<<8)+((255&D)<<24);function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const i=D=>{if(!D||!D.state)return v;const h=D.state;return D.total_in=D.total_out=h.total=0,D.rh="",h.wrap&&(D.adler=1&h.wrap),h.mode=1,h.last=0,h.havedict=0,h.dmax=32768,h.head=null,h.hold=0,h.bits=0,h.lencode=h.lendyn=new Int32Array(852),h.distcode=h.distdyn=new Int32Array(592),h.sane=1,h.back=-1,k},G=D=>{if(!D||!D.state)return v;const h=D.state;return h.wsize=0,h.whave=0,h.wnext=0,i(D)},N=(D,h)=>{let o;if(!D||!D.state)return v;const H=D.state;return h<0?(o=0,h=-h):(o=1+(h>>4),h<48&&(h&=15)),h&&(h<8||h>15)?v:(null!==H.window&&H.wbits!==h&&(H.window=null),H.wrap=o,H.wbits=h,G(D))},J=(D,h)=>{if(!D)return v;const o=new b;D.state=o,o.window=null;const H=N(D,h);return H!==k&&(D.state=null),H};let O,E,L=!0;const T=D=>{if(L){O=new Int32Array(512),E=new Int32Array(32);let h=0;for(;h<144;)D.lens[h++]=8;for(;h<256;)D.lens[h++]=9;for(;h<280;)D.lens[h++]=7;for(;h<288;)D.lens[h++]=8;for(M(1,D.lens,0,288,O,0,D.work,{bits:9}),h=0;h<32;)D.lens[h++]=5;M(2,D.lens,0,32,E,0,D.work,{bits:5}),L=!1}D.lencode=O,D.lenbits=9,D.distcode=E,D.distbits=5},Z=(D,h,o,H)=>{let g;const j=D.state;return null===j.window&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new Uint8Array(j.wsize)),H>=j.wsize?(j.window.set(h.subarray(o-j.wsize,o),0),j.wnext=0,j.whave=j.wsize):(g=j.wsize-j.wnext,g>H&&(g=H),j.window.set(h.subarray(o-H,o-H+g),j.wnext),(H-=g)?(j.window.set(h.subarray(o-H,o),0),j.wnext=H,j.whave=j.wsize):(j.wnext+=g,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=g))),0};D.exports.inflateReset=G,D.exports.inflateReset2=N,D.exports.inflateResetKeep=i,D.exports.inflateInit=D=>J(D,15),D.exports.inflateInit2=J,D.exports.inflate=(D,h)=>{let o,b,i,G,N,J,O,E,L,e,p,mD,a,u,I,P,n,F,w,Y,l,C,z=0;const f=new Uint8Array(4);let V,d;const X=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!D||!D.state||!D.output||!D.input&&0!==D.avail_in)return v;o=D.state,o.mode===q&&(o.mode=13),N=D.next_out,i=D.output,O=D.avail_out,G=D.next_in,b=D.input,J=D.avail_in,E=o.hold,L=o.bits,e=J,p=O,C=k;D:for(;;)switch(o.mode){case 1:if(0===o.wrap){o.mode=13;break}for(;L<16;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}if(2&o.wrap&&35615===E){o.check=0,f[0]=255&E,f[1]=E>>>8&255,o.check=g(o.check,f,2,0),E=0,L=0,o.mode=2;break}if(o.flags=0,o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&E)<<8)+(E>>8))%31){D.rh="incorrect header check",o.mode=c;break}if((15&E)!==U){D.rh="unknown compression method",o.mode=c;break}if(E>>>=4,L-=4,l=8+(15&E),0===o.wbits)o.wbits=l;else if(l>o.wbits){D.rh="invalid window size",o.mode=c;break}o.dmax=1<<o.wbits,D.adler=o.check=1,o.mode=512&E?10:q,E=0,L=0;break;case 2:for(;L<16;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}if(o.flags=E,(255&o.flags)!==U){D.rh="unknown compression method",o.mode=c;break}if(57344&o.flags){D.rh="unknown header flags set",o.mode=c;break}o.head&&(o.head.text=E>>8&1),512&o.flags&&(f[0]=255&E,f[1]=E>>>8&255,o.check=g(o.check,f,2,0)),E=0,L=0,o.mode=3;case 3:for(;L<32;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}o.head&&(o.head.time=E),512&o.flags&&(f[0]=255&E,f[1]=E>>>8&255,f[2]=E>>>16&255,f[3]=E>>>24&255,o.check=g(o.check,f,4,0)),E=0,L=0,o.mode=4;case 4:for(;L<16;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}o.head&&(o.head.xflags=255&E,o.head.os=E>>8),512&o.flags&&(f[0]=255&E,f[1]=E>>>8&255,o.check=g(o.check,f,2,0)),E=0,L=0,o.mode=5;case 5:if(1024&o.flags){for(;L<16;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}o.length=E,o.head&&(o.head.extra_len=E),512&o.flags&&(f[0]=255&E,f[1]=E>>>8&255,o.check=g(o.check,f,2,0)),E=0,L=0}else o.head&&(o.head.extra=null);o.mode=6;case 6:if(1024&o.flags&&(mD=o.length,mD>J&&(mD=J),mD&&(o.head&&(l=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(b.subarray(G,G+mD),l)),512&o.flags&&(o.check=g(o.check,b,mD,G)),J-=mD,G+=mD,o.length-=mD),o.length))break D;o.length=0,o.mode=7;case 7:if(2048&o.flags){if(0===J)break D;mD=0;do{l=b[G+mD++],o.head&&l&&o.length<65536&&(o.head.name+=String.fromCharCode(l))}while(l&&mD<J);if(512&o.flags&&(o.check=g(o.check,b,mD,G)),J-=mD,G+=mD,l)break D}else o.head&&(o.head.name=null);o.length=0,o.mode=8;case 8:if(4096&o.flags){if(0===J)break D;mD=0;do{l=b[G+mD++],o.head&&l&&o.length<65536&&(o.head.comment+=String.fromCharCode(l))}while(l&&mD<J);if(512&o.flags&&(o.check=g(o.check,b,mD,G)),J-=mD,G+=mD,l)break D}else o.head&&(o.head.comment=null);o.mode=9;case 9:if(512&o.flags){for(;L<16;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}if(E!==(65535&o.check)){D.rh="header crc mismatch",o.mode=c;break}E=0,L=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),D.adler=o.check=0,o.mode=q;break;case 10:for(;L<32;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}D.adler=o.check=y(E),E=0,L=0,o.mode=11;case 11:if(0===o.havedict)return D.next_out=N,D.avail_out=O,D.next_in=G,D.avail_in=J,o.hold=E,o.bits=L,Q;D.adler=o.check=1,o.mode=q;case q:if(h===t||h===S)break D;case 13:if(o.last){E>>>=7&L,L-=7&L,o.mode=27;break}for(;L<3;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}switch(o.last=1&E,E>>>=1,L-=1,3&E){case 0:o.mode=14;break;case 1:if(T(o),o.mode=20,h===S){E>>>=2,L-=2;break D}break;case 2:o.mode=17;break;case 3:D.rh="invalid block type",o.mode=c}E>>>=2,L-=2;break;case 14:for(E>>>=7&L,L-=7&L;L<32;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}if((65535&E)!==(E>>>16^65535)){D.rh="invalid stored block lengths",o.mode=c;break}if(o.length=65535&E,E=0,L=0,o.mode=15,h===S)break D;case 15:o.mode=16;case 16:if(mD=o.length,mD){if(mD>J&&(mD=J),mD>O&&(mD=O),0===mD)break D;i.set(b.subarray(G,G+mD),N),J-=mD,G+=mD,O-=mD,N+=mD,o.length-=mD;break}o.mode=q;break;case 17:for(;L<14;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}if(o.nlen=257+(31&E),E>>>=5,L-=5,o.ndist=1+(31&E),E>>>=5,L-=5,o.ncode=4+(15&E),E>>>=4,L-=4,o.nlen>286||o.ndist>30){D.rh="too many length or distance symbols",o.mode=c;break}o.have=0,o.mode=18;case 18:for(;o.have<o.ncode;){for(;L<3;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}o.lens[X[o.have++]]=7&E,E>>>=3,L-=3}for(;o.have<19;)o.lens[X[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,V={bits:o.lenbits},C=M(0,o.lens,0,19,o.lencode,0,o.work,V),o.lenbits=V.bits,C){D.rh="invalid code lengths set",o.mode=c;break}o.have=0,o.mode=19;case 19:for(;o.have<o.nlen+o.ndist;){for(;z=o.lencode[E&(1<<o.lenbits)-1],I=z>>>24,P=z>>>16&255,n=65535&z,!(I<=L);){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}if(n<16)E>>>=I,L-=I,o.lens[o.have++]=n;else{if(16===n){for(d=I+2;L<d;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}if(E>>>=I,L-=I,0===o.have){D.rh="invalid bit length repeat",o.mode=c;break}l=o.lens[o.have-1],mD=3+(3&E),E>>>=2,L-=2}else if(17===n){for(d=I+3;L<d;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}E>>>=I,L-=I,l=0,mD=3+(7&E),E>>>=3,L-=3}else{for(d=I+7;L<d;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}E>>>=I,L-=I,l=0,mD=11+(127&E),E>>>=7,L-=7}if(o.have+mD>o.nlen+o.ndist){D.rh="invalid bit length repeat",o.mode=c;break}for(;mD--;)o.lens[o.have++]=l}}if(o.mode===c)break;if(0===o.lens[256]){D.rh="invalid code -- missing end-of-block",o.mode=c;break}if(o.lenbits=9,V={bits:o.lenbits},C=M(1,o.lens,0,o.nlen,o.lencode,0,o.work,V),o.lenbits=V.bits,C){D.rh="invalid literal/lengths set",o.mode=c;break}if(o.distbits=6,o.distcode=o.distdyn,V={bits:o.distbits},C=M(2,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,V),o.distbits=V.bits,C){D.rh="invalid distances set",o.mode=c;break}if(o.mode=20,h===S)break D;case 20:o.mode=21;case 21:if(J>=6&&O>=258){D.next_out=N,D.avail_out=O,D.next_in=G,D.avail_in=J,o.hold=E,o.bits=L,j(D,p),N=D.next_out,i=D.output,O=D.avail_out,G=D.next_in,b=D.input,J=D.avail_in,E=o.hold,L=o.bits,o.mode===q&&(o.back=-1);break}for(o.back=0;z=o.lencode[E&(1<<o.lenbits)-1],I=z>>>24,P=z>>>16&255,n=65535&z,!(I<=L);){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}if(P&&0===(240&P)){for(F=I,w=P,Y=n;z=o.lencode[Y+((E&(1<<F+w)-1)>>F)],I=z>>>24,P=z>>>16&255,n=65535&z,!(F+I<=L);){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}E>>>=F,L-=F,o.back+=F}if(E>>>=I,L-=I,o.back+=I,o.length=n,0===P){o.mode=26;break}if(32&P){o.back=-1,o.mode=q;break}if(64&P){D.rh="invalid literal/length code",o.mode=c;break}o.extra=15&P,o.mode=22;case 22:if(o.extra){for(d=o.extra;L<d;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}o.length+=E&(1<<o.extra)-1,E>>>=o.extra,L-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=23;case 23:for(;z=o.distcode[E&(1<<o.distbits)-1],I=z>>>24,P=z>>>16&255,n=65535&z,!(I<=L);){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}if(0===(240&P)){for(F=I,w=P,Y=n;z=o.distcode[Y+((E&(1<<F+w)-1)>>F)],I=z>>>24,P=z>>>16&255,n=65535&z,!(F+I<=L);){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}E>>>=F,L-=F,o.back+=F}if(E>>>=I,L-=I,o.back+=I,64&P){D.rh="invalid distance code",o.mode=c;break}o.offset=n,o.extra=15&P,o.mode=24;case 24:if(o.extra){for(d=o.extra;L<d;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}o.offset+=E&(1<<o.extra)-1,E>>>=o.extra,L-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){D.rh="invalid distance too far back",o.mode=c;break}o.mode=25;case 25:if(0===O)break D;if(mD=p-O,o.offset>mD){if(mD=o.offset-mD,mD>o.whave&&o.sane){D.rh="invalid distance too far back",o.mode=c;break}mD>o.wnext?(mD-=o.wnext,a=o.wsize-mD):a=o.wnext-mD,mD>o.length&&(mD=o.length),u=o.window}else u=i,a=N-o.offset,mD=o.length;mD>O&&(mD=O),O-=mD,o.length-=mD;do{i[N++]=u[a++]}while(--mD);0===o.length&&(o.mode=21);break;case 26:if(0===O)break D;i[N++]=o.length,O--,o.mode=21;break;case 27:if(o.wrap){for(;L<32;){if(0===J)break D;J--,E|=b[G++]<<L,L+=8}if(p-=O,D.total_out+=p,o.total+=p,p&&(D.adler=o.check=o.flags?g(o.check,i,p,N-p):H(o.check,i,p,N-p)),p=O,(o.flags?E:y(E))!==o.check){D.rh="incorrect data check",o.mode=c;break}E=0,L=0}o.mode=28;case 28:if(o.wrap&&o.flags){for(;L<32;){if(0===J)break D;J--,E+=b[G++]<<L,L+=8}if(E!==(4294967295&o.total)){D.rh="incorrect length check",o.mode=c;break}E=0,L=0}o.mode=29;case 29:C=K;break D;case c:C=r;break D;case 31:return B;default:return v}return D.next_out=N,D.avail_out=O,D.next_in=G,D.avail_in=J,o.hold=E,o.bits=L,(o.wsize||p!==D.avail_out&&o.mode<c&&(o.mode<27||h!==R))&&Z(D,D.output,D.next_out,p-D.avail_out)?(o.mode=31,B):(e-=D.avail_in,p-=D.avail_out,D.total_in+=e,D.total_out+=p,o.total+=p,o.wrap&&p&&(D.adler=o.check=o.flags?g(o.check,i,p,D.next_out-p):H(o.check,i,p,D.next_out-p)),D.data_type=o.bits+(o.last?64:0)+(o.mode===q?128:0)+(20===o.mode||15===o.mode?256:0),(0===e&&0===p||h===R)&&C===k&&(C=s),C)},D.exports.inflateEnd=D=>{if(!D||!D.state)return v;let h=D.state;return h.window&&(h.window=null),D.state=null,k},D.exports.inflateGetHeader=(D,h)=>{if(!D||!D.state)return v;const o=D.state;return 0===(2&o.wrap)?v:(o.head=h,h.done=!1,k)},D.exports.inflateSetDictionary=(D,h)=>{const o=h.length;let g,j,M;return D&&D.state?(g=D.state,0!==g.wrap&&11!==g.mode?v:11===g.mode&&(j=1,j=H(j,h,o,0),j!==g.check)?r:(M=Z(D,h,o,o),M?(g.mode=31,B):(g.havedict=1,k))):v},D.exports.inflateInfo="pako inflate (from Nodeca project)"},14804:D=>{"use strict";const h=15,o=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),H=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),g=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),j=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);D.exports=(D,M,R,t,S,k,K,Q)=>{const v=Q.bits;let r,B,s,U,q,c,y=0,b=0,i=0,G=0,N=0,J=0,O=0,E=0,L=0,T=0,Z=null,e=0;const p=new Uint16Array(16),mD=new Uint16Array(16);let a,u,I,P=null,n=0;for(y=0;y<=h;y++)p[y]=0;for(b=0;b<t;b++)p[M[R+b]]++;for(N=v,G=h;G>=1&&0===p[G];G--);if(N>G&&(N=G),0===G)return S[k++]=20971520,S[k++]=20971520,Q.bits=1,0;for(i=1;i<G&&0===p[i];i++);for(N<i&&(N=i),E=1,y=1;y<=h;y++)if(E<<=1,E-=p[y],E<0)return-1;if(E>0&&(0===D||1!==G))return-1;for(mD[1]=0,y=1;y<h;y++)mD[y+1]=mD[y]+p[y];for(b=0;b<t;b++)0!==M[R+b]&&(K[mD[M[R+b]]++]=b);if(0===D?(Z=P=K,c=19):1===D?(Z=o,e-=257,P=H,n-=257,c=256):(Z=g,P=j,c=-1),T=0,b=0,y=i,q=k,J=N,O=0,s=-1,L=1<<N,U=L-1,1===D&&L>852||2===D&&L>592)return 1;for(;;){a=y-O,K[b]<c?(u=0,I=K[b]):K[b]>c?(u=P[n+K[b]],I=Z[e+K[b]]):(u=96,I=0),r=1<<y-O,B=1<<J,i=B;do{B-=r,S[q+(T>>O)+B]=a<<24|u<<16|I}while(0!==B);for(r=1<<y-1;T&r;)r>>=1;if(0!==r?(T&=r-1,T+=r):T=0,b++,0===--p[y]){if(y===G)break;y=M[R+K[b]]}if(y>N&&(T&U)!==s){for(0===O&&(O=N),q+=i,J=y-O,E=1<<J;J+O<G&&(E-=p[J+O],!(E<=0));)J++,E<<=1;if(L+=1<<J,1===D&&L>852||2===D&&L>592)return 1;s=T&U,S[s]=N<<24|J<<16|q-k}}return 0!==T&&(S[q+T]=y-O<<24|64<<16),Q.bits=N,0}},14759:D=>{"use strict";D.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},14746:D=>{"use strict";function h(D){let h=D.length;for(;--h>=0;)D[h]=0}const o=256,H=286,g=30,j=15,M=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),R=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),k=new Array(576);h(k);const K=new Array(60);h(K);const Q=new Array(512);h(Q);const v=new Array(256);h(v);const r=new Array(29);h(r);const B=new Array(g);function s(D,h,o,H,g){this.static_tree=D,this.extra_bits=h,this.extra_base=o,this.elems=H,this.max_length=g,this.has_stree=D&&D.length}let U,q,c;function y(D,h){this.dyn_tree=D,this.max_code=0,this.stat_desc=h}h(B);const b=D=>D<256?Q[D]:Q[256+(D>>>7)],i=(D,h)=>{D.pending_buf[D.pending++]=255&h,D.pending_buf[D.pending++]=h>>>8&255},G=(D,h,o)=>{D.bi_valid>16-o?(D.bi_buf|=h<<D.bi_valid&65535,i(D,D.bi_buf),D.bi_buf=h>>16-D.bi_valid,D.bi_valid+=o-16):(D.bi_buf|=h<<D.bi_valid&65535,D.bi_valid+=o)},N=(D,h,o)=>{G(D,o[2*h],o[2*h+1])},J=(D,h)=>{let o=0;do{o|=1&D,D>>>=1,o<<=1}while(--h>0);return o>>>1},O=(D,h,o)=>{const H=new Array(16);let g,M,R=0;for(g=1;g<=j;g++)H[g]=R=R+o[g-1]<<1;for(M=0;M<=h;M++){let h=D[2*M+1];0!==h&&(D[2*M]=J(H[h]++,h))}},E=D=>{let h;for(h=0;h<H;h++)D.dyn_ltree[2*h]=0;for(h=0;h<g;h++)D.dyn_dtree[2*h]=0;for(h=0;h<19;h++)D.bl_tree[2*h]=0;D.dyn_ltree[512]=1,D.opt_len=D.static_len=0,D.last_lit=D.matches=0},L=D=>{D.bi_valid>8?i(D,D.bi_buf):D.bi_valid>0&&(D.pending_buf[D.pending++]=D.bi_buf),D.bi_buf=0,D.bi_valid=0},T=(D,h,o,H)=>{const g=2*h,j=2*o;return D[g]<D[j]||D[g]===D[j]&&H[h]<=H[o]},Z=(D,h,o)=>{const H=D.heap[o];let g=o<<1;for(;g<=D.heap_len&&(g<D.heap_len&&T(h,D.heap[g+1],D.heap[g],D.depth)&&g++,!T(h,H,D.heap[g],D.depth));)D.heap[o]=D.heap[g],o=g,g<<=1;D.heap[o]=H},e=(D,h,H)=>{let g,j,t,S,k=0;if(0!==D.last_lit)do{g=D.pending_buf[D.d_buf+2*k]<<8|D.pending_buf[D.d_buf+2*k+1],j=D.pending_buf[D.l_buf+k],k++,0===g?N(D,j,h):(t=v[j],N(D,t+o+1,h),S=M[t],0!==S&&(j-=r[t],G(D,j,S)),g--,t=b(g),N(D,t,H),S=R[t],0!==S&&(g-=B[t],G(D,g,S)))}while(k<D.last_lit);N(D,256,h)},p=(D,h)=>{const o=h.dyn_tree,H=h.stat_desc.static_tree,g=h.stat_desc.has_stree,M=h.stat_desc.elems;let R,t,S,k=-1;for(D.heap_len=0,D.heap_max=573,R=0;R<M;R++)0!==o[2*R]?(D.heap[++D.heap_len]=k=R,D.depth[R]=0):o[2*R+1]=0;for(;D.heap_len<2;)S=D.heap[++D.heap_len]=k<2?++k:0,o[2*S]=1,D.depth[S]=0,D.opt_len--,g&&(D.static_len-=H[2*S+1]);for(h.max_code=k,R=D.heap_len>>1;R>=1;R--)Z(D,o,R);S=M;do{R=D.heap[1],D.heap[1]=D.heap[D.heap_len--],Z(D,o,1),t=D.heap[1],D.heap[--D.heap_max]=R,D.heap[--D.heap_max]=t,o[2*S]=o[2*R]+o[2*t],D.depth[S]=(D.depth[R]>=D.depth[t]?D.depth[R]:D.depth[t])+1,o[2*R+1]=o[2*t+1]=S,D.heap[1]=S++,Z(D,o,1)}while(D.heap_len>=2);D.heap[--D.heap_max]=D.heap[1],((D,h)=>{const o=h.dyn_tree,H=h.max_code,g=h.stat_desc.static_tree,M=h.stat_desc.has_stree,R=h.stat_desc.extra_bits,t=h.stat_desc.extra_base,S=h.stat_desc.max_length;let k,K,Q,v,r,B,s=0;for(v=0;v<=j;v++)D.bl_count[v]=0;for(o[2*D.heap[D.heap_max]+1]=0,k=D.heap_max+1;k<573;k++)K=D.heap[k],v=o[2*o[2*K+1]+1]+1,v>S&&(v=S,s++),o[2*K+1]=v,K>H||(D.bl_count[v]++,r=0,K>=t&&(r=R[K-t]),B=o[2*K],D.opt_len+=B*(v+r),M&&(D.static_len+=B*(g[2*K+1]+r)));if(0!==s){do{for(v=S-1;0===D.bl_count[v];)v--;D.bl_count[v]--,D.bl_count[v+1]+=2,D.bl_count[S]--,s-=2}while(s>0);for(v=S;0!==v;v--)for(K=D.bl_count[v];0!==K;)Q=D.heap[--k],Q>H||(o[2*Q+1]!==v&&(D.opt_len+=(v-o[2*Q+1])*o[2*Q],o[2*Q+1]=v),K--)}})(D,h),O(o,k,D.bl_count)},mD=(D,h,o)=>{let H,g,j=-1,M=h[1],R=0,t=7,S=4;for(0===M&&(t=138,S=3),h[2*(o+1)+1]=65535,H=0;H<=o;H++)g=M,M=h[2*(H+1)+1],++R<t&&g===M||(R<S?D.bl_tree[2*g]+=R:0!==g?(g!==j&&D.bl_tree[2*g]++,D.bl_tree[32]++):R<=10?D.bl_tree[34]++:D.bl_tree[36]++,R=0,j=g,0===M?(t=138,S=3):g===M?(t=6,S=3):(t=7,S=4))},a=(D,h,o)=>{let H,g,j=-1,M=h[1],R=0,t=7,S=4;for(0===M&&(t=138,S=3),H=0;H<=o;H++)if(g=M,M=h[2*(H+1)+1],!(++R<t&&g===M)){if(R<S)do{N(D,g,D.bl_tree)}while(0!==--R);else 0!==g?(g!==j&&(N(D,g,D.bl_tree),R--),N(D,16,D.bl_tree),G(D,R-3,2)):R<=10?(N(D,17,D.bl_tree),G(D,R-3,3)):(N(D,18,D.bl_tree),G(D,R-11,7));R=0,j=g,0===M?(t=138,S=3):g===M?(t=6,S=3):(t=7,S=4)}};let u=!1;const I=(D,h,o,H)=>{G(D,0+(H?1:0),3),((D,h,o,H)=>{L(D),H&&(i(D,o),i(D,~o)),D.pending_buf.set(D.window.subarray(h,h+o),D.pending),D.pending+=o})(D,h,o,!0)};D.exports._tr_init=D=>{u||((()=>{let D,h,o,S,y;const b=new Array(16);for(o=0,S=0;S<28;S++)for(r[S]=o,D=0;D<1<<M[S];D++)v[o++]=S;for(v[o-1]=S,y=0,S=0;S<16;S++)for(B[S]=y,D=0;D<1<<R[S];D++)Q[y++]=S;for(y>>=7;S<g;S++)for(B[S]=y<<7,D=0;D<1<<R[S]-7;D++)Q[256+y++]=S;for(h=0;h<=j;h++)b[h]=0;for(D=0;D<=143;)k[2*D+1]=8,D++,b[8]++;for(;D<=255;)k[2*D+1]=9,D++,b[9]++;for(;D<=279;)k[2*D+1]=7,D++,b[7]++;for(;D<=287;)k[2*D+1]=8,D++,b[8]++;for(O(k,287,b),D=0;D<g;D++)K[2*D+1]=5,K[2*D]=J(D,5);U=new s(k,M,257,H,j),q=new s(K,R,0,g,j),c=new s(new Array(0),t,0,19,7)})(),u=!0),D.l_desc=new y(D.dyn_ltree,U),D.d_desc=new y(D.dyn_dtree,q),D.bl_desc=new y(D.bl_tree,c),D.bi_buf=0,D.bi_valid=0,E(D)},D.exports._tr_stored_block=I,D.exports._tr_flush_block=(D,h,H,g)=>{let j,M,R=0;D.level>0?(2===D.strm.data_type&&(D.strm.data_type=(D=>{let h,H=4093624447;for(h=0;h<=31;h++,H>>>=1)if(1&H&&0!==D.dyn_ltree[2*h])return 0;if(0!==D.dyn_ltree[18]||0!==D.dyn_ltree[20]||0!==D.dyn_ltree[26])return 1;for(h=32;h<o;h++)if(0!==D.dyn_ltree[2*h])return 1;return 0})(D)),p(D,D.l_desc),p(D,D.d_desc),R=(D=>{let h;for(mD(D,D.dyn_ltree,D.l_desc.max_code),mD(D,D.dyn_dtree,D.d_desc.max_code),p(D,D.bl_desc),h=18;h>=3&&0===D.bl_tree[2*S[h]+1];h--);return D.opt_len+=3*(h+1)+5+5+4,h})(D),j=D.opt_len+3+7>>>3,M=D.static_len+3+7>>>3,M<=j&&(j=M)):j=M=H+5,H+4<=j&&-1!==h?I(D,h,H,g):4===D.strategy||M===j?(G(D,2+(g?1:0),3),e(D,k,K)):(G(D,4+(g?1:0),3),((D,h,o,H)=>{let g;for(G(D,h-257,5),G(D,o-1,5),G(D,H-4,4),g=0;g<H;g++)G(D,D.bl_tree[2*S[g]+1],3);a(D,D.dyn_ltree,h-1),a(D,D.dyn_dtree,o-1)})(D,D.l_desc.max_code+1,D.d_desc.max_code+1,R+1),e(D,D.dyn_ltree,D.dyn_dtree)),E(D),g&&L(D)},D.exports._tr_tally=(D,h,H)=>(D.pending_buf[D.d_buf+2*D.last_lit]=h>>>8&255,D.pending_buf[D.d_buf+2*D.last_lit+1]=255&h,D.pending_buf[D.l_buf+D.last_lit]=255&H,D.last_lit++,0===h?D.dyn_ltree[2*H]++:(D.matches++,h--,D.dyn_ltree[2*(v[H]+o+1)]++,D.dyn_dtree[2*b(h)]++),D.last_lit===D.lit_bufsize-1),D.exports._tr_align=D=>{G(D,2,3),N(D,256,k),(D=>{16===D.bi_valid?(i(D,D.bi_buf),D.bi_buf=0,D.bi_valid=0):D.bi_valid>=8&&(D.pending_buf[D.pending++]=255&D.bi_buf,D.bi_buf>>=8,D.bi_valid-=8)})(D)}},14778:D=>{"use strict";D.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.rh="",this.state=null,this.data_type=2,this.adler=0}},13631:D=>{function h(D,h,o){for(var H=D.length,g=-1/0,j=1/0,M=0;M<H;M++){var R=(o[0][M]-D[M])/h[M],t=(o[1][M]-D[M])/h[M];if(R>t){var S=R;R=t,t=S}if(t<g||R>j)return 1/0;R>g&&(g=R),t<j&&(j=t)}return g>j?1/0:g}D.exports=function(D,o,H,g){var j=h(o,H,g);if(j===1/0)D=null;else{D=D||[];for(var M=0;M<o.length;M++)D[M]=o[M]+H[M]*j}return D},D.exports.distance=h},14863:(D,h,o)=>{"use strict";o.d(h,{d:()=>M});var H=o(27);const g=H.useLayoutEffect;const j=function(D){var h=(0,H.useRef)(D);return g((function(){h.current=D})),h};var M=function(D){var h=j(D);(0,H.Mh)((function(){var D=function(D){var o;if(null!=h.current&&(o=h.current(D)),D.defaultPrevented&&(D.returnValue=""),"string"===typeof o)return D.returnValue=o,o};return window.addEventListener("beforeunload",D),function(){window.removeEventListener("beforeunload",D)}}),[])}},14826:(D,h,o)=>{"use strict";var H=o(14835),g=Array.prototype.concat,j=Array.prototype.slice,M=D.exports=function(D){for(var h=[],o=0,M=D.length;o<M;o++){var R=D[o];H(R)?h=g.call(h,j.call(R)):h.push(R)}return h};M.wrap=function(D){return function(){return D(M(arguments))}}},14835:D=>{D.exports=function(D){return!(!D||"string"===typeof D)&&(D instanceof Array||Array.isArray(D)||D.length>=0&&(D.splice instanceof Function||Object.getOwnPropertyDescriptor(D,D.length-1)&&"String"!==D.constructor.name))}},14703:(D,h,o)=>{var H=o(14708);function g(D){for(var h,o,g=0,j=D.length,M=0;M<D.length;){for(h=D[M],o=0;M<j&&D[M]===h;)++M,++o;g+=H.log2(o)/7|0,g+=H.log2(h>>>0)/7|0,g+=2}return g}h.size=g,h.encode=function(D,h){h||(h=new Uint8Array(g(D)));for(var o,H,j=0,M=h.length,R=0;R<D.length;){for(o=D[R],H=0;R<D.length&&D[R]===o;)++R,++H;for(;j<M&&H>=128;)h[j++]=128+(127&H),H>>>=7;if(j>=M)throw new Error("RLE buffer overflow");for(h[j++]=H,o>>>=0;j<M&&o>=128;)h[j++]=128+(127&o),o>>>=7;if(j>=M)throw new Error("RLE buffer overflow");h[j++]=o}return h},h.decode=function(D,h){for(var o,H,g,j,M=h.length,R=D.length,t=0,S=0;S<R;){for(o=0,H=0;S<R&&D[S]>=128;)o+=(127&D[S++])<<H,H+=7;if(o+=D[S++]<<H,S>=R)throw new Error("RLE buffer underrun");if(t+o>M)throw new Error("Chunk buffer overflow");for(g=0,H=0;S<R&&D[S]>=128;)g+=(127&D[S++])<<H,H+=7;if(S>=R)throw new Error("RLE buffer underrun");for(g+=D[S++]<<H,j=0;j<o;++j)h[t++]=g}return h}},14708:(D,h)=>{"use strict";function o(D){var h=32;return(D&=-D)&&h--,65535&D&&(h-=16),16711935&D&&(h-=8),252645135&D&&(h-=4),858993459&D&&(h-=2),1431655765&D&&(h-=1),h}h.INT_BITS=32,h.INT_MAX=2147483647,h.INT_MIN=-1<<31,h.sign=function(D){return(D>0)-(D<0)},h.abs=function(D){var h=D>>31;return(D^h)-h},h.min=function(D,h){return h^(D^h)&-(D<h)},h.max=function(D,h){return D^(D^h)&-(D<h)},h.isPow2=function(D){return!(D&D-1)&&!!D},h.log2=function(D){var h,o;return h=(D>65535)<<4,h|=o=((D>>>=h)>255)<<3,h|=o=((D>>>=o)>15)<<2,(h|=o=((D>>>=o)>3)<<1)|(D>>>=o)>>1},h.log10=function(D){return D>=1e9?9:D>=1e8?8:D>=1e7?7:D>=1e6?6:D>=1e5?5:D>=1e4?4:D>=1e3?3:D>=100?2:D>=10?1:0},h.popCount=function(D){return 16843009*((D=(858993459&(D-=D>>>1&1431655765))+(D>>>2&858993459))+(D>>>4)&252645135)>>>24},h.countTrailingZeros=o,h.nextPow2=function(D){return D+=0===D,--D,D|=D>>>1,D|=D>>>2,D|=D>>>4,D|=D>>>8,(D|=D>>>16)+1},h.prevPow2=function(D){return D|=D>>>1,D|=D>>>2,D|=D>>>4,D|=D>>>8,(D|=D>>>16)-(D>>>1)},h.parity=function(D){return D^=D>>>16,D^=D>>>8,D^=D>>>4,27030>>>(D&=15)&1};var H=new Array(256);!function(D){for(var h=0;h<256;++h){var o=h,H=h,g=7;for(o>>>=1;o;o>>>=1)H<<=1,H|=1&o,--g;D[h]=H<<g&255}}(H),h.reverse=function(D){return H[255&D]<<24|H[D>>>8&255]<<16|H[D>>>16&255]<<8|H[D>>>24&255]},h.interleave2=function(D,h){return(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D&=65535)|D<<8))|D<<4))|D<<2))|D<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))<<1},h.deinterleave2=function(D,h){return(D=65535&((D=16711935&((D=252645135&((D=858993459&((D=D>>>h&1431655765)|D>>>1))|D>>>2))|D>>>4))|D>>>16))<<16>>16},h.interleave3=function(D,h,o){return D=1227133513&((D=3272356035&((D=251719695&((D=4278190335&((D&=1023)|D<<16))|D<<8))|D<<4))|D<<2),(D|=(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<1)|(o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2))<<2},h.deinterleave3=function(D,h){return(D=1023&((D=4278190335&((D=251719695&((D=3272356035&((D=D>>>h&1227133513)|D>>>2))|D>>>4))|D>>>8))|D>>>16))<<22>>22},h.nextCombination=function(D){var h=D|D-1;return h+1|(~h&-~h)-1>>>o(D)+1}},14732:D=>{"use strict";D.exports=function(D,h,o,H){var g=self||window;try{try{var j;try{j=new g.Blob([D])}catch(S){(j=new(g.BlobBuilder||g.WebKitBlobBuilder||g.MozBlobBuilder||g.MSBlobBuilder)).append(D),j=j.getBlob()}var M=g.URL||g.webkitURL,R=M.createObjectURL(j),t=new g[h](R,o);return M.revokeObjectURL(R),t}catch(S){return new g[h]("data:application/javascript,".concat(encodeURIComponent(D)),o)}}catch(S){if(!H)throw Error("Inline worker is not supported");return new g[h](H,o)}}},13617:(D,h,o)=>{"use strict";function H(D,h,o,H,g){var j={};return Object.keys(H).forEach((function(D){j[D]=H[D]})),j.enumerable=!!j.enumerable,j.configurable=!!j.configurable,("value"in j||j.initializer)&&(j.writable=!0),j=o.slice().reverse().reduce((function(o,H){return H(D,h,o)||o}),j),g&&void 0!==j.initializer&&(j.value=j.initializer?j.initializer.call(g):void 0,j.initializer=void 0),void 0===j.initializer&&(Object.defineProperty(D,h,j),j=null),j}o.d(h,{d:()=>H})},13615:(D,h,o)=>{"use strict";function H(D,h,o,H){o&&Object.defineProperty(D,h,{enumerable:o.enumerable,configurable:o.configurable,writable:o.writable,value:o.initializer?o.initializer.call(H):void 0})}o.d(h,{e:()=>H})},14876:(D,h,o)=>{"use strict";o.d(h,{d:()=>M,e:()=>K,h:()=>R,l:()=>j,m:()=>t,n:()=>g,r:()=>S,v:()=>k});var H=o(13038);class g{constructor(){this._easingMode=g.EASINGMODE_EASEIN}setEasingMode(D){const h=Math.min(Math.max(D,0),2);this._easingMode=h}getEasingMode(){return this._easingMode}easeInCore(D){throw new Error("You must implement this method")}ease(D){switch(this._easingMode){case g.EASINGMODE_EASEIN:return this.easeInCore(D);case g.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-D)}return D>=.5?.5*(1-this.easeInCore(2*(1-D)))+.5:.5*this.easeInCore(2*D)}}g.EASINGMODE_EASEIN=0,g.EASINGMODE_EASEOUT=1,g.EASINGMODE_EASEINOUT=2;class j extends g{easeInCore(D){return D=Math.max(0,Math.min(1,D)),1-Math.sqrt(1-D*D)}}class M extends g{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=D}easeInCore(D){const h=Math.max(0,this.amplitude);return Math.pow(D,3)-D*h*Math.sin(3.141592653589793*D)}}class R extends g{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=D,this.bounciness=h}easeInCore(D){const h=Math.max(0,this.bounces);let o=this.bounciness;o<=1&&(o=1.001);const H=Math.pow(o,h),g=1-o,j=(1-H)/g+.5*H,M=D*j,R=Math.log(-M*(1-o)+1)/Math.log(o),t=Math.floor(R),S=t+1,k=(1-Math.pow(o,t))/(g*j),K=.5*(k+(1-Math.pow(o,S))/(g*j)),Q=D-K,v=K-k;return-Math.pow(1/o,h-t)/(v*v)*(Q-v)*(Q+v)}}class t extends g{easeInCore(D){return D*D*D}}class S extends g{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=D,this.springiness=h}easeInCore(D){let h;const o=Math.max(0,this.oscillations),H=Math.max(0,this.springiness);return h=0==H?D:(Math.exp(H*D)-1)/(Math.exp(H)-1),h*Math.sin((6.283185307179586*o+1.5707963267948966)*D)}}class k extends g{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=D}easeInCore(D){return this.exponent<=0?D:(Math.exp(this.exponent*D)-1)/(Math.exp(this.exponent)-1)}}class K extends g{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=D,this.y1=h,this.x2=o,this.y2=H}easeInCore(D){return H.c.Interpolate(D,this.x1,this.y1,this.x2,this.y2)}}},14292:(D,h,o)=>{"use strict";o.d(h,{d:()=>M});var H=o(12831),g=o(12836),j=o(13258);class M extends j.c{get _matrix(){return this._compose(),this.Kv}set _matrix(D){(D.updateFlag!==this.Kv.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Kv.M(D),this._markAsDirtyAndDecompose())}constructor(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(D,h.GD(),!1),this.name=D,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=h,this.Kv=(null===g||void 0===g?void 0:g.clone())??H.Matrix.Identity(),this._restMatrix=j??this.Kv.clone(),this._bindMatrix=M??this.Kv.clone(),this._index=R,this._absoluteMatrix=new H.Matrix,this._absoluteBindMatrix=new H.Matrix,this._absoluteInverseBindMatrix=new H.Matrix,this._finalMatrix=new H.Matrix,h.bones.push(this),this.setParent(o,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(D){this.setParent(D)}setParent(D){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==D){if(this.parent){const D=this.parent.children.indexOf(this);-1!==D&&this.parent.children.splice(D,1)}this._parentNode=D,this.parent&&this.parent.children.push(this),h&&this._updateAbsoluteBindMatrices(),this.mK()}}getLocalMatrix(){return this._compose(),this.Kv}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(D){this._restMatrix.M(D)}setRestPose(D){this.setRestMatrix(D)}getBindPose(){return this.getBindMatrix()}setBindMatrix(D){this.Wh(D)}setBindPose(D){this.setBindMatrix(D)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const D=H.TmpVectors.Gh[0],h=H.TmpVectors.Quaternion[0],o=H.TmpVectors.Gh[1];this.getRestMatrix().decompose(D,h,o),this._linkedTransformNode.position.M(o),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??H.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.M(h),this._linkedTransformNode.Ug.M(D)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(D){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=D,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.nt}set position(D){this._decompose(),this.nt.M(D),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(D){this.setRotation(D)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(D){this.setRotationQuaternion(D)}get Ug(){return this.getScale()}set Ug(D){this.setScale(D)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=H.Gh.Zero(),this._localRotation=H.Quaternion.Zero(),this.nt=H.Gh.Zero()),this.Kv.decompose(this._localScaling,this._localRotation,this.nt))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,H.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.nt,this.Kv)):this._needToCompose=!1)}Wh(D){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.M(D),h&&this._updateAbsoluteBindMatrices(),o?this._matrix=D:this.mK()}_updateAbsoluteBindMatrices(D){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(D||(D=this._bindMatrix),this.parent?D.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.M(D),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),h)for(let o=0;o<this.children.length;o++)this.children[o]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}mK(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.mK(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.mK(),this._needToDecompose=!0}_updatePosition(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0,g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const j=this.getLocalMatrix();if(0==h)g?(j.addAtIndex(12,D.x),j.addAtIndex(13,D.y),j.addAtIndex(14,D.z)):j.setTranslationFromFloats(D.x,D.y,D.z);else{let h=null;o&&(h=o.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const R=M._TmpMats[0],t=M._TmpVecs[0];this.parent?o&&h?(R.M(this.parent.getAbsoluteMatrix()),R.multiplyToRef(h,R)):R.M(this.parent.getAbsoluteMatrix()):H.Matrix.IdentityToRef(R),g&&R.setTranslationFromFloats(0,0,0),R.invert(),H.Gh.TransformCoordinatesToRef(D,R,t),g?(j.addAtIndex(12,t.x),j.addAtIndex(13,t.y),j.addAtIndex(14,t.z)):j.setTranslationFromFloats(t.x,t.y,t.z)}this._markAsDirtyAndDecompose()}translate(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;this._updatePosition(D,h,o,!0)}setPosition(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;this._updatePosition(D,h,o,!1)}setAbsolutePosition(D,h){this.setPosition(D,1,h)}scale(D,h,o){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const j=this.getLocalMatrix(),R=M._TmpMats[0];H.Matrix.ScalingToRef(D,h,o,R),R.multiplyToRef(j,j),R.invert();for(const H of this.children){const g=H.getLocalMatrix();g.multiplyToRef(R,g),g.multiplyAtIndex(12,D),g.multiplyAtIndex(13,h),g.multiplyAtIndex(14,o),H._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),g)for(const H of this.children)H.scale(D,h,o,g)}setScale(D){this._decompose(),this._localScaling.M(D),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(D){this._decompose(),D.M(this._localScaling)}setYawPitchRoll(D,h,o){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=arguments.length>4?arguments[4]:void 0;if(0===g){const R=M._TmpQuat;return H.Quaternion.RotationYawPitchRollToRef(D,h,o,R),void this.setRotationQuaternion(R,g,j)}const R=M._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(R,j))return;const t=M._TmpMats[1];H.Matrix.RotationYawPitchRollToRef(D,h,o,t),R.multiplyToRef(t,t),this._rotateWithMatrix(t,g,j)}rotate(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3?arguments[3]:void 0;const j=M._TmpMats[0];j.setTranslationFromFloats(0,0,0),H.Matrix.RotationAxisToRef(D,h,j),this._rotateWithMatrix(j,o,g)}setAxisAngle(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3?arguments[3]:void 0;if(0===o){const j=M._TmpQuat;return H.Quaternion.RotationAxisToRef(D,h,j),void this.setRotationQuaternion(j,o,g)}const j=M._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(j,g))return;const R=M._TmpMats[1];H.Matrix.RotationAxisToRef(D,h,R),j.multiplyToRef(R,R),this._rotateWithMatrix(R,o,g)}setRotation(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(D.y,D.x,D.z,h,o)}setRotationQuaternion(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(0===h)return this._decompose(),this._localRotation.M(D),void this._markAsDirtyAndCompose();const g=M._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(g,o))return;const j=M._TmpMats[1];H.Matrix.FromQuaternionToRef(D,j),g.multiplyToRef(j,j),this._rotateWithMatrix(j,h,o)}setRotationMatrix(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(0===h){const g=M._TmpQuat;return H.Quaternion.FromRotationMatrixToRef(D,g),void this.setRotationQuaternion(g,h,o)}const g=M._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(g,o))return;const j=M._TmpMats[1];j.M(D),g.multiplyToRef(D,j),this._rotateWithMatrix(j,h,o)}_rotateWithMatrix(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;const H=this.getLocalMatrix(),g=H.m[12],j=H.m[13],R=H.m[14],t=this.getParent(),S=M._TmpMats[3],k=M._TmpMats[4];t&&1==h?(o?(S.M(o.getWorldMatrix()),t.getAbsoluteMatrix().multiplyToRef(S,S)):S.M(t.getAbsoluteMatrix()),k.M(S),k.invert(),H.multiplyToRef(S,H),H.multiplyToRef(D,H),H.multiplyToRef(k,H)):1==h&&o?(S.M(o.getWorldMatrix()),k.M(S),k.invert(),H.multiplyToRef(S,H),H.multiplyToRef(D,H),H.multiplyToRef(k,H)):H.multiplyToRef(D,H),H.setTranslationFromFloats(g,j,R),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(D,h){const o=M._TmpMats[2];return D.M(this.getAbsoluteMatrix()),h?(D.multiplyToRef(h.getWorldMatrix(),D),H.Matrix.ScalingToRef(h.Ug.x,h.Ug.y,h.Ug.z,o)):H.Matrix.IdentityToRef(o),D.invert(),!isNaN(D.m[0])&&(o.multiplyAtIndex(0,this._scalingDeterminant),D.multiplyToRef(o,D),!0)}Sh(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=H.Gh.Zero();return this.getPositionToRef(D,h,o),o}getPositionToRef(){let D=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const D=this.getLocalMatrix();h.x=D.m[12],h.y=D.m[13],h.z=D.m[14]}else{let o=null;D&&(o=D.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let H=M._TmpMats[0];D&&o?(H.M(this.getAbsoluteMatrix()),H.multiplyToRef(o,H)):H=this.getAbsoluteMatrix(),h.x=H.m[12],h.y=H.m[13],h.z=H.m[14]}}getAbsolutePosition(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const h=H.Gh.Zero();return this.getPositionToRef(1,D,h),h}getAbsolutePositionToRef(D,h){this.getPositionToRef(1,D,h)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Kv.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.M(this.Kv);const D=this._skeleton.getPoseMatrix();D&&this._absoluteMatrix.multiplyToRef(D,this._absoluteMatrix)}const D=this.children,h=D.length;for(let o=0;o<h;o++)D[o].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}QS(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=H.Gh.Zero();return this.getDirectionToRef(D,h,o),o}getDirectionToRef(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,g=null;h&&(g=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const j=M._TmpMats[0];j.M(this.getAbsoluteMatrix()),h&&g&&j.multiplyToRef(g,j),H.Gh.TransformNormalToRef(D,j,o),o.normalize()}getRotation(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=H.Gh.Zero();return this.getRotationToRef(D,h,o),o}getRotationToRef(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0;const H=M._TmpQuat;this.getRotationQuaternionToRef(D,h,H),H.toEulerAnglesToRef(o)}getRotationQuaternion(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=H.Quaternion.Identity();return this.getRotationQuaternionToRef(D,h,o),o}getRotationQuaternionToRef(){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),h.M(this._localRotation);else{const o=M._TmpMats[0],H=this.getAbsoluteMatrix();D?H.multiplyToRef(D.getWorldMatrix(),o):o.M(H),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.decompose(void 0,h,void 0)}}getRotationMatrix(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1?arguments[1]:void 0;const o=H.Matrix.Identity();return this.getRotationMatrixToRef(D,h,o),o}getRotationMatrixToRef(){let D=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(h);else{const o=M._TmpMats[0],H=this.getAbsoluteMatrix();D?H.multiplyToRef(D.getWorldMatrix(),o):o.M(H),o.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyAtIndex(1,this._scalingDeterminant),o.multiplyAtIndex(2,this._scalingDeterminant),o.getRotationMatrixToRef(h)}}getAbsolutePositionFromLocal(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=H.Gh.Zero();return this.getAbsolutePositionFromLocalToRef(D,h,o),o}getAbsolutePositionFromLocalToRef(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,g=null;h&&(g=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const j=M._TmpMats[0];j.M(this.getAbsoluteMatrix()),h&&g&&j.multiplyToRef(g,j),H.Gh.TransformCoordinatesToRef(D,j,o)}getLocalPositionFromAbsolute(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=H.Gh.Zero();return this.getLocalPositionFromAbsoluteToRef(D,h,o),o}getLocalPositionFromAbsoluteToRef(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2?arguments[2]:void 0,g=null;h&&(g=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const j=M._TmpMats[0];j.M(this.getAbsoluteMatrix()),h&&g&&j.multiplyToRef(g,j),j.invert(),H.Gh.TransformCoordinatesToRef(D,j,o)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const D=this._skeleton.bones.indexOf(this);if(-1!==D&&this._skeleton.bones.splice(D,1),this._parentNode&&this._parentNode.children){const D=this._parentNode.children,h=D.indexOf(this);-1!==h&&D.splice(h,1)}super.dispose()}}M._TmpVecs=(0,g.b)(2,H.Gh.Zero),M._TmpQuat=H.Quaternion.Identity(),M._TmpMats=(0,g.b)(5,H.Matrix.Identity)},14872:(D,h,o)=>{"use strict";o.d(h,{b:()=>p});var H=o(12812),g=o(12815),j=o(12648),M=o(12831),R=o(12842),t=o(13258),S=o(13288),k=o(13102),K=o(12667),Q=o(12833);class v{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(D){this._zoomStopsAnimation=D}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(D){this._idleRotationSpeed=D}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(D){this._idleRotationWaitTime=D}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(D){this._idleRotationSpinupTime=D}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(D){this._attachedCamera=D;const h=this._attachedCamera.GD();this._onPrePointerObservableObserver=h.onPrePointerObservable.add((D=>{D.type!==k.b.POINTERDOWN?D.type===k.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=D.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const D=K.b.Now;let h=0;null!=this._lastFrameTime&&(h=D-this._lastFrameTime),this._lastFrameTime=D,this._applyUserInteraction();const o=D-this._lastInteractionTime-this._idleRotationWaitTime,H=Math.max(Math.min(o/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*H,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(h/1e3))}))}detach(){if(!this._attachedCamera)return;const D=this._attachedCamera.GD();this._onPrePointerObservableObserver&&D.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(D){this._lastInteractionTime=D??K.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<Q.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let D=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(D=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?D:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=K.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var r=o(14876),B=o(13377);class s{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(D){if(this._autoTransitionRange===D)return;this._autoTransitionRange=D;const h=this._attachedCamera;h&&(D?this._onMeshTargetChangedObserver=h.onMeshTargetChangedObservable.add((D=>{if(D&&(D.xh(!0),D.getBoundingInfo)){const h=D.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*h,this.upperRadiusTransitionRange=.05*h}})):this._onMeshTargetChangedObserver&&h.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(D){this._attachedCamera=D,this._onAfterCheckInputsObserver=D.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(D){return!!this._attachedCamera&&(this._attachedCamera.radius===D&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(D){if(!this._attachedCamera)return;this._radiusBounceTransition||(s.EasingFunction.setEasingMode(s.EasingMode),this._radiusBounceTransition=B.e.CreateAnimation("radius",B.e.ANIMATIONTYPE_FLOAT,60,s.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const h=B.e.TransitionTo("radius",this._attachedCamera.radius+D,this._attachedCamera,this._attachedCamera.GD(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));h&&this._animatables.push(h)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}s.EasingFunction=new r.d(.3),s.EasingMode=r.n.EASINGMODE_EASEOUT;class U{constructor(){this.onTargetFramingAnimationEndObservable=new j.c,this._mode=U.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(D){this._mode=D}get mode(){return this._mode}set radiusScale(D){this._radiusScale=D}get radiusScale(){return this._radiusScale}set positionScale(D){this._positionScale=D}get positionScale(){return this._positionScale}set defaultElevation(D){this._defaultElevation=D}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(D){this._elevationReturnTime=D}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(D){this._elevationReturnWaitTime=D}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(D){this._zoomStopsAnimation=D}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(D){this._framingTime=D}get framingTime(){return this._framingTime}init(){}attach(D){this._attachedCamera=D;const h=this._attachedCamera.GD();U.EasingFunction.setEasingMode(U.EasingMode),this._onPrePointerObservableObserver=h.onPrePointerObservable.add((D=>{D.type!==k.b.POINTERDOWN?D.type===k.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=D.onMeshTargetChangedObservable.add((D=>{D&&D.getBoundingInfo&&this.zoomOnMesh(D,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=D.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const D=this._attachedCamera.GD();this._onPrePointerObservableObserver&&D.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(D){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;D.xh(!0);const H=D.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(H.minimumWorld,H.maximumWorld,h,o)}zoomOnMeshHierarchy(D){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;D.xh(!0);const H=D.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(H.min,H.max,h,o)}zoomOnMeshesHierarchy(D){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new M.Gh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),g=new M.Gh(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let j=0;j<D.length;j++){const h=D[j].getHierarchyBoundingVectors(!0);M.Gh.CheckExtends(h.min,H,g),M.Gh.CheckExtends(h.max,H,g)}this.zoomOnBoundingInfo(H,g,h,o)}zoomOnBoundingInfo(D,h){let o,H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const j=D.y,R=j+(h.y-j)*this._positionScale,t=h.Nh(D).scale(.5);if(!isFinite(R))return!1;if(H)o=new M.Gh(0,R,0);else{const h=D.add(t);o=new M.Gh(h.x,R,h.z)}this._vectorTransition||(this._vectorTransition=B.e.CreateAnimation("target",B.e.ANIMATIONTYPE_VECTOR3,60,U.EasingFunction)),this._betaIsAnimating=!0;let S=B.e.TransitionTo("target",o,this._attachedCamera,this._attachedCamera.GD(),60,this._vectorTransition,this._framingTime);S&&this._animatables.push(S);let k=0;if(this._mode===U.FitFrustumSidesMode){const o=this._calculateLowerRadiusFromModelBoundingSphere(D,h);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=t.length()+this._attachedCamera.Xh),k=o}else this._mode===U.IgnoreBoundsSizeMode&&(k=this._calculateLowerRadiusFromModelBoundingSphere(D,h),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Xh));if(this.autoCorrectCameraLimitsAndSensibility){const o=h.Nh(D).length();this._attachedCamera.panningSensibility=5e3/o,this._attachedCamera.wheelPrecision=100/k}return this._radiusTransition||(this._radiusTransition=B.e.CreateAnimation("radius",B.e.ANIMATIONTYPE_FLOAT,60,U.EasingFunction)),S=B.e.TransitionTo("radius",k,this._attachedCamera,this._attachedCamera.GD(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),g&&g(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),S&&this._animatables.push(S),!0}_calculateLowerRadiusFromModelBoundingSphere(D,h){const o=this._attachedCamera;if(!o)return 0;let H=o._calculateLowerRadiusFromModelBoundingSphere(D,h,this._radiusScale);return o.lowerRadiusLimit&&this._mode===U.IgnoreBoundsSizeMode&&(H=H<o.lowerRadiusLimit?o.lowerRadiusLimit:H),o.upperRadiusLimit&&(H=H>o.upperRadiusLimit?o.upperRadiusLimit:H),H}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const D=K.b.Now-this._lastInteractionTime,h=.5*Math.PI-this._defaultElevation,o=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>o&&D>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=B.e.CreateAnimation("beta",B.e.ANIMATIONTYPE_FLOAT,60,U.EasingFunction));const D=B.e.TransitionTo("beta",h,this._attachedCamera,this._attachedCamera.GD(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));D&&this._animatables.push(D)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=K.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}U.EasingFunction=new r.v,U.EasingMode=r.n.EASINGMODE_EASEINOUT,U.IgnoreBoundsSizeMode=0,U.FitFrustumSidesMode=1;var q=o(13296),c=o(13332),y=o(14286),b=o(12642);class i{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(D){D=b.Tools.BackCompatCameraNoPreventDefault(arguments);const h=this.camera.getEngine(),o=h.getInputElement();let H=0,g=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=j=>{var M,R;const t=j.event,S="touch"===t.pointerType;if(j.type!==k.b.POINTERMOVE&&-1===this.buttons.indexOf(t.button))return;const K=t.target;if(this._altKey=t.altKey,this._ctrlKey=t.ctrlKey,this._metaKey=t.metaKey,this._shiftKey=t.shiftKey,this._buttonsPressed=t.buttons,h.isPointerLock){const D=t.movementX,h=t.movementY;this.onTouch(null,D,h),this._pointA=null,this._pointB=null}else{if(j.type!==k.b.POINTERDOWN&&j.type!==k.b.POINTERDOUBLETAP&&S&&(null===(M=this._pointA)||void 0===M?void 0:M.pointerId)!==t.pointerId&&(null===(R=this._pointB)||void 0===R?void 0:R.pointerId)!==t.pointerId)return;if(j.type!==k.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!S)if(j.type===k.b.POINTERDOUBLETAP)this.onDoubleTap(t.pointerType);else if(j.type!==k.b.POINTERUP||this._currentMousePointerIdDown!==t.pointerId&&!S){if(j.type===k.b.POINTERMOVE)if(D||t.preventDefault(),this._pointA&&null===this._pointB){const D=t.clientX-this._pointA.x,h=t.clientY-this._pointA.y;this._pointA.x=t.clientX,this._pointA.y=t.clientY,this.onTouch(this._pointA,D,h)}else if(this._pointA&&this._pointB){const D=this._pointA.pointerId===t.pointerId?this._pointA:this._pointB;D.x=t.clientX,D.y=t.clientY;const h=this._pointA.x-this._pointB.x,o=this._pointA.y-this._pointB.y,M=h*h+o*o,R={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:t.pointerId,type:j.type};this.onMultiTouch(this._pointA,this._pointB,H,M,g,R),g=R,H=M}}else{try{null===K||void 0===K||K.releasePointerCapture(t.pointerId)}catch(Q){}S||(this._pointB=null),h._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==t.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==t.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==H||g)&&(this.onMultiTouch(this._pointA,this._pointB,H,0,g,null),H=0,g=null),this._currentMousePointerIdDown=-1,this.onButtonUp(t),D||t.preventDefault()}else{try{null===K||void 0===K||K.setPointerCapture(t.pointerId)}catch(Q){}if(null===this._pointA)this._pointA={x:t.clientX,y:t.clientY,pointerId:t.pointerId,type:t.pointerType};else{if(null!==this._pointB)return;this._pointB={x:t.clientX,y:t.clientY,pointerId:t.pointerId,type:t.pointerType}}-1!==this._currentMousePointerIdDown||S||(this._currentMousePointerIdDown=t.pointerId),this.onButtonDown(t),D||(t.preventDefault(),o&&o.focus())}}},this._observer=this.camera.GD()._inputManager._addCameraPointerObserver(this._pointerInput,k.b.POINTERDOWN|k.b.POINTERUP|k.b.POINTERMOVE|k.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,H=0,g=null,this.onLostFocus()},this._contextMenuBind=D=>this.onContextMenu(D),o&&o.addEventListener("contextmenu",this._contextMenuBind,!1);const j=this.camera.GD().getEngine().getHostWindow();j&&b.Tools.RegisterTopRootEvents(j,[{name:"blur",handler:this._onLostFocus}])}bQ(){if(this._onLostFocus){const D=this.camera.GD().getEngine().getHostWindow();D&&b.Tools.UnregisterTopRootEvents(D,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.GD()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const D=this.camera.GD().getEngine().getInputElement();D&&D.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(D){}onTouch(D,h,o){}onMultiTouch(D,h,o,H,g,j){}onContextMenu(D){D.preventDefault()}onButtonDown(D){}onButtonUp(D){}onLostFocus(){}}(0,H.c)([(0,g.I)()],i.prototype,"buttons",void 0);class G extends i{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(D,h){if(0!==this.panningSensibility&&D&&h){const o=h.x-D.x,H=h.y-D.y;this.camera.inertialPanningX+=-o/this.panningSensibility,this.camera.inertialPanningY+=H/this.panningSensibility}}_computePinchZoom(D,h){const o=this.camera.radius||G.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=o*Math.sqrt(D)/Math.sqrt(h):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(h-D)*o*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(h-D)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(D,h,o){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-h/this.panningSensibility,this.camera.inertialPanningY+=o/this.panningSensibility):(this.camera.inertialAlphaOffset-=h/this.angularSensibilityX,this.camera.inertialBetaOffset-=o/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(D,h,o,H,g,j){0===o&&null===g||0===H&&null===j||(this.multiTouchPanAndZoom?(this._computePinchZoom(o,H),this._computeMultiTouchPanning(g,j)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(H)-Math.sqrt(o))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(o,H),this._isPinching=!0):this._computeMultiTouchPanning(g,j)):this.multiTouchPanning?this._computeMultiTouchPanning(g,j):this.pinchZoom&&this._computePinchZoom(o,H))}onButtonDown(D){this._isPanClick=D.button===this.camera._panningMouseButton}onButtonUp(D){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}G.MinimumRadiusForPinch=.001,(0,H.c)([(0,g.I)()],G.prototype,"buttons",void 0),(0,H.c)([(0,g.I)()],G.prototype,"angularSensibilityX",void 0),(0,H.c)([(0,g.I)()],G.prototype,"angularSensibilityY",void 0),(0,H.c)([(0,g.I)()],G.prototype,"pinchPrecision",void 0),(0,H.c)([(0,g.I)()],G.prototype,"pinchDeltaPercentage",void 0),(0,H.c)([(0,g.I)()],G.prototype,"useNaturalPinchZoom",void 0),(0,H.c)([(0,g.I)()],G.prototype,"pinchZoom",void 0),(0,H.c)([(0,g.I)()],G.prototype,"panningSensibility",void 0),(0,H.c)([(0,g.I)()],G.prototype,"multiTouchPanning",void 0),(0,H.c)([(0,g.I)()],G.prototype,"multiTouchPanAndZoom",void 0),y.e.ArcRotateCameraPointersInput=G;var N=o(13107);class J{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(D){D=b.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.GD(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((h=>{const o=h.event;if(!o.metaKey)if(h.type===N.d.KEYDOWN){if(this._ctrlPressed=o.ctrlKey,this._altPressed=o.altKey,-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysReset.indexOf(o.keyCode)){-1===this._keys.indexOf(o.keyCode)&&this._keys.push(o.keyCode),o.preventDefault&&(D||o.preventDefault())}}else if(-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysReset.indexOf(o.keyCode)){const h=this._keys.indexOf(o.keyCode);h>=0&&this._keys.splice(h,1),o.preventDefault&&(D||o.preventDefault())}})))}bQ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const D=this.camera;for(let h=0;h<this._keys.length;h++){const o=this._keys[h];-1!==this.keysLeft.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningX-=1/this.panningSensibility:D.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?D.inertialRadiusOffset+=1/this.zoomingSensibility:D.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningX+=1/this.panningSensibility:D.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(o)?this._ctrlPressed&&this.camera._useCtrlForPanning?D.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?D.inertialRadiusOffset-=1/this.zoomingSensibility:D.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(o)&&D.useInputToRestoreState&&D.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,H.c)([(0,g.I)()],J.prototype,"keysUp",void 0),(0,H.c)([(0,g.I)()],J.prototype,"keysDown",void 0),(0,H.c)([(0,g.I)()],J.prototype,"keysLeft",void 0),(0,H.c)([(0,g.I)()],J.prototype,"keysRight",void 0),(0,H.c)([(0,g.I)()],J.prototype,"keysReset",void 0),(0,H.c)([(0,g.I)()],J.prototype,"panningSensibility",void 0),(0,H.c)([(0,g.I)()],J.prototype,"zoomingSensibility",void 0),(0,H.c)([(0,g.I)()],J.prototype,"useAltToZoom",void 0),(0,H.c)([(0,g.I)()],J.prototype,"angularSpeed",void 0),y.e.ArcRotateCameraKeyboardMoveInput=J;var O=o(12875),E=o(13110);class L{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new M.Gh(0,0,0),this._globalOffset=new M.Gh(0,0,0),this._inertialPanning=M.Gh.Zero()}_computeDeltaFromMouseWheelLegacyEvent(D,h){let o=0;const H=.01*D*this.wheelDeltaPercentage*h;return o=D>0?H/(1+this.wheelDeltaPercentage):H*(1+this.wheelDeltaPercentage),o}attachControl(D){D=b.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=h=>{if(h.type!==k.b.POINTERWHEEL)return;const o=h.event;let H=0;const g=o.deltaMode===E.b.DOM_DELTA_LINE?40:1,j=-o.deltaY*g;if(this.customComputeDeltaFromMouseWheel)H=this.customComputeDeltaFromMouseWheel(j,this,o);else if(this.wheelDeltaPercentage){if(H=this._computeDeltaFromMouseWheelLegacyEvent(j,this.camera.radius),H>0){let D=this.camera.radius,h=this.camera.inertialRadiusOffset+H;for(let o=0;o<20&&!(D<=h)&&!(Math.abs(h*this.camera.inertia)<.001);o++)D-=h,h*=this.camera.inertia;D=(0,R.Clamp)(D,0,Number.MAX_VALUE),H=this._computeDeltaFromMouseWheelLegacyEvent(j,D)}}else H=j/(40*this.wheelPrecision);H&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(H)):this.camera.inertialRadiusOffset+=H),o.preventDefault&&(D||o.preventDefault())},this._observer=this.camera.GD()._inputManager._addCameraPointerObserver(this._wheel,k.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.qg(0)}bQ(){this._observer&&(this.camera.GD()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const D=this.camera;0+D.inertialAlphaOffset+D.inertialBetaOffset+D.inertialRadiusOffset&&(this._updateHitPlane(),D.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(D.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const D=this.camera,h=D.target.Nh(D.position);this._hitPlane=O.b.FromPositionAndNormal(D.target,h)}_getPosition(){const D=this.camera,h=D.GD(),o=h.createPickingRay(h.pointerX,h.pointerY,M.Matrix.Identity(),D,!1);0===D.targetScreenOffset.x&&0===D.targetScreenOffset.y||(this._viewOffset.set(D.targetScreenOffset.x,D.targetScreenOffset.y,0),D.getViewMatrix().invertToRef(D._cameraTransformMatrix),this._globalOffset=M.Gh.TransformNormal(this._viewOffset,D._cameraTransformMatrix),o.origin.addInPlace(this._globalOffset));let H=0;return this._hitPlane&&(H=o.intersectsPlane(this._hitPlane)??0),o.origin.addInPlace(o.direction.scaleInPlace(H))}_zoomToMouse(D){const h=this.camera,o=1-h.inertia;if(h.lowerRadiusLimit){const H=h.lowerRadiusLimit??0;h.radius-(h.inertialRadiusOffset+D)/o<H&&(D=(h.radius-H)*o-h.inertialRadiusOffset)}if(h.upperRadiusLimit){const H=h.upperRadiusLimit??0;h.radius-(h.inertialRadiusOffset+D)/o>H&&(D=(h.radius-H)*o-h.inertialRadiusOffset)}const H=D/o/h.radius,g=this._getPosition(),j=M.TmpVectors.Gh[6];g.subtractToRef(h.target,j),j.scaleInPlace(H),j.scaleInPlace(o),this._inertialPanning.addInPlace(j),h.inertialRadiusOffset+=D}_zeroIfClose(D){Math.abs(D.x)<Q.d&&(D.x=0),Math.abs(D.y)<Q.d&&(D.y=0),Math.abs(D.z)<Q.d&&(D.z=0)}}(0,H.c)([(0,g.I)()],L.prototype,"wheelPrecision",void 0),(0,H.c)([(0,g.I)()],L.prototype,"zoomToMouseLocation",void 0),(0,H.c)([(0,g.I)()],L.prototype,"wheelDeltaPercentage",void 0),y.e.ArcRotateCameraMouseWheelInput=L;class T extends y.f{constructor(D){super(D)}addMouseWheel(){return this.add(new L),this}addPointers(){return this.add(new G),this}addKeyboard(){return this.add(new J),this}}var Z=o(12793);function e(D,h){return isNaN(D)?h:D}t.c.AddNodeConstructor("ArcRotateCamera",((D,h)=>()=>new p(D,0,0,1,M.Gh.Zero(),h)));class p extends c.b{get target(){return this._target}set target(D){this.setTarget(D)}get targetHost(){return this._targetHost}set targetHost(D){D&&this.setTarget(D)}getTarget(){return this.target}get position(){return this._position}set position(D){this.setPosition(D)}set upVector(D){this._upToYMatrix||(this._yToUpMatrix=new M.Matrix,this._upToYMatrix=new M.Matrix,this._upVector=M.Gh.Zero()),D.normalize(),this._upVector.M(D),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){M.Matrix.RotationAlignToRef(M.Gh.UpReadOnly,this._upVector,this._yToUpMatrix),M.Matrix.RotationAlignToRef(this._upVector,M.Gh.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const D=this.inputs.attached.pointers;return D?D.angularSensibilityX:0}set angularSensibilityX(D){const h=this.inputs.attached.pointers;h&&(h.angularSensibilityX=D)}get angularSensibilityY(){const D=this.inputs.attached.pointers;return D?D.angularSensibilityY:0}set angularSensibilityY(D){const h=this.inputs.attached.pointers;h&&(h.angularSensibilityY=D)}get pinchPrecision(){const D=this.inputs.attached.pointers;return D?D.pinchPrecision:0}set pinchPrecision(D){const h=this.inputs.attached.pointers;h&&(h.pinchPrecision=D)}get pinchDeltaPercentage(){const D=this.inputs.attached.pointers;return D?D.pinchDeltaPercentage:0}set pinchDeltaPercentage(D){const h=this.inputs.attached.pointers;h&&(h.pinchDeltaPercentage=D)}get useNaturalPinchZoom(){const D=this.inputs.attached.pointers;return!!D&&D.useNaturalPinchZoom}set useNaturalPinchZoom(D){const h=this.inputs.attached.pointers;h&&(h.useNaturalPinchZoom=D)}get panningSensibility(){const D=this.inputs.attached.pointers;return D?D.panningSensibility:0}set panningSensibility(D){const h=this.inputs.attached.pointers;h&&(h.panningSensibility=D)}get keysUp(){const D=this.inputs.attached.keyboard;return D?D.keysUp:[]}set keysUp(D){const h=this.inputs.attached.keyboard;h&&(h.keysUp=D)}get keysDown(){const D=this.inputs.attached.keyboard;return D?D.keysDown:[]}set keysDown(D){const h=this.inputs.attached.keyboard;h&&(h.keysDown=D)}get keysLeft(){const D=this.inputs.attached.keyboard;return D?D.keysLeft:[]}set keysLeft(D){const h=this.inputs.attached.keyboard;h&&(h.keysLeft=D)}get keysRight(){const D=this.inputs.attached.keyboard;return D?D.keysRight:[]}set keysRight(D){const h=this.inputs.attached.keyboard;h&&(h.keysRight=D)}get wheelPrecision(){const D=this.inputs.attached.mousewheel;return D?D.wheelPrecision:0}set wheelPrecision(D){const h=this.inputs.attached.mousewheel;h&&(h.wheelPrecision=D)}get zoomToMouseLocation(){const D=this.inputs.attached.mousewheel;return!!D&&D.zoomToMouseLocation}set zoomToMouseLocation(D){const h=this.inputs.attached.mousewheel;h&&(h.zoomToMouseLocation=D)}get wheelDeltaPercentage(){const D=this.inputs.attached.mousewheel;return D?D.wheelDeltaPercentage:0}set wheelDeltaPercentage(D){const h=this.inputs.attached.mousewheel;h&&(h.wheelDeltaPercentage=D)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(D){D!==this.useBouncingBehavior&&(D?(this._bouncingBehavior=new s,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(D){D!==this.useFramingBehavior&&(D?(this._framingBehavior=new U,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(D){D!==this.useAutoRotationBehavior&&(D?(this._autoRotationBehavior=new v,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(D,h,o,H,g,R){var t;let S=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(D,M.Gh.Zero(),R,S),t=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=M.Gh.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=M.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new M.Matrix,this.panningAxis=new M.Gh(1,1,0),this._transformedDirection=new M.Gh,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new j.c,this.checkCollisions=!1,this.collisionRadius=new M.Gh(.5,.5,.5),this._previousPosition=M.Gh.Zero(),this._collisionVelocity=M.Gh.Zero(),this._newPosition=M.Gh.Zero(),this._computationVector=M.Gh.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new M.Gh(NaN,NaN,NaN),this._goalTargetScreenOffset=new M.Vector2(NaN,NaN),this._onCollisionPositionChange=function(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o?(t.setPosition(h),t.gr&&t.gr(o)):t._previousPosition.M(t._position);const H=Math.cos(t.alpha),g=Math.sin(t.alpha),j=Math.cos(t.beta);let M=Math.sin(t.beta);0===M&&(M=1e-4);const R=t._getTargetPosition();t._computationVector.Qg(t.radius*H*M,t.radius*j,t.radius*g*M),R.addToRef(t._computationVector,t._newPosition),t._position.M(t._newPosition);let S=t.upVector;t.allowUpsideDown&&t.beta<0&&(S=S.clone(),S=S.negate()),t._computeViewMatrix(t._position,R,S),t._viewMatrix.addAtIndex(12,t.targetScreenOffset.x),t._viewMatrix.addAtIndex(13,t.targetScreenOffset.y),t._collisionTriggered=!1},this._target=M.Gh.Zero(),g&&this.setTarget(g),this.alpha=h,this.beta=o,this.radius=H,this.getViewMatrix(),this.inputs=new T(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new M.Gh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=M.Vector2.Zero()}_updateCache(D){D||super._updateCache(),this._cache._target.M(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.M(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const D=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?D.addToRef(this._targetBoundingCenter,this._target):this._target.M(D)}const D=this._getLockedTargetPosition();return D||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>Q.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,j=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=j?this._currentInterpolationFactor=j:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=e(D,this._goalAlpha),this._goalBeta=e(h,this._goalBeta),this._goalRadius=e(o,this._goalRadius),this._goalTarget.set(e(H.x,this._goalTarget.x),e(H.y,this._goalTarget.y),e(H.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(e(g.x,this._goalTargetScreenOffset.x),e(g.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,R.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,R.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,R.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,R.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(D,h){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const g=arguments;h=b.Tools.BackCompatCameraNoPreventDefault(g),this._useCtrlForPanning=o,this._panningMouseButton=H,"boolean"===typeof g[0]&&(g.length>1&&(this._useCtrlForPanning=g[1]),g.length>2&&(this._panningMouseButton=g[2])),this.inputs.attachElement(h),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}bQ(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let D=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){D=!0;const h=this.invertRotation?-1:1,o=this._calculateHandednessMultiplier();let H=this.inertialAlphaOffset*o;this.beta<0&&(H*=-1),this.alpha+=H*h,this.beta+=this.inertialBetaOffset*h,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Q.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Q.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Q.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){D=!0;const h=new M.Gh(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),h.multiplyInPlace(this.panningAxis),M.Gh.TransformNormalToRef(h,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const D=this.upVector,h=M.Gh.CrossToRef(this._transformedDirection,D,this._transformedDirection);M.Gh.CrossToRef(D,h,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);M.Gh.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.M(this._transformedDirection)}else{if(this.parent){const D=M.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(D),D.transposeToRef(D),M.Gh.TransformCoordinatesToRef(this._transformedDirection,D,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Q.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Q.d&&(this.inertialPanningY=0)}if(D)this.stopInterpolation();else if(this._isInterpolating){let D=!1;const h=this._scene.getEngine().getDeltaTime()/1e3,o=1-Math.pow(2,-h/this._currentInterpolationFactor),H=e(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const h=M.TmpVectors.Gh[0].set(e(this._goalTarget.x,this._target.x),e(this._goalTarget.y,this._target.y),e(this._goalTarget.z,this._target.z));M.Gh.LerpToRef(this.target,h,o,this._target),10*M.Gh.Distance(this.target,h)/H<Q.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.M(h),this.setTarget(this.target,!1,!0,!0)):D=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const h=M.Quaternion.RotationAlphaBetaGammaToRef(e(this._goalAlpha,this.alpha),e(this._goalBeta,this.beta),0,M.TmpVectors.Quaternion[0]),H=M.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,M.TmpVectors.Quaternion[1]),g=M.Quaternion.SlerpToRef(H,h,o,M.TmpVectors.Quaternion[2]);g.normalize();const j=g.toAlphaBetaGammaToRef(M.TmpVectors.Gh[0]);if(this.alpha=j.x,this.beta=j.y,g.isApprox(h,Q.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const D=h.toAlphaBetaGammaToRef(M.TmpVectors.Gh[0]);this.alpha=D.x,this.beta=D.y}else D=!0}if(isNaN(this._goalRadius)||(this.radius+=(H-this.radius)*o,Math.abs(H/this.radius-1)<Q.d?(this._goalRadius=NaN,this.radius=H):D=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const h=M.TmpVectors.Vector2[0].set(e(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),e(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));M.Vector2.LerpToRef(this.targetScreenOffset,h,o,this.targetScreenOffset),M.Vector2.Distance(this.targetScreenOffset,h)<Q.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.M(h)):D=!0}this._isInterpolating=D}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||M.Gh.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const D=this.alpha;var h,o;this.alpha=function(D){let h=Math.PI/2;return 0===D.x&&0===D.z||(h=Math.acos(D.x/Math.sqrt(Math.pow(D.x,2)+Math.pow(D.z,2)))),D.z<0&&(h=2*Math.PI-h),h}(this._computationVector),this.beta=(h=this._computationVector.y,o=this.radius,Math.acos(h/o));const H=Math.round((D-this.alpha)/(2*Math.PI));this.alpha+=2*H*Math.PI,this._checkLimits()}setPosition(D){this._position.equals(D)||(this._position.M(D),this.rebuildAnglesAndRadius())}setTarget(D){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(H=this.overrideCloneAlphaBetaRadius??H,D.xh)h&&D.getBoundingInfo?this._targetBoundingCenter=D.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,D.xh(),this._targetHost=D,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const h=D,H=this._getTargetPosition();if(H&&!o&&H.equals(h))return;this._targetHost=null,this._target=h,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}H||this.rebuildAnglesAndRadius()}_getViewMatrix(){const D=Math.cos(this.alpha),h=Math.sin(this.alpha),o=Math.cos(this.beta);let H=Math.sin(this.beta);0===H&&(H=1e-4),0===this.radius&&(this.radius=1e-4);const g=this._getTargetPosition();if(this._computationVector.Qg(this.radius*D*H,this.radius*o,this.radius*h*H),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||M.Gh.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),g.addToRef(this._computationVector,this._newPosition),this.GD().collisionsEnabled&&this.checkCollisions){const D=this.GD().collisionCoordinator;this._collider||(this._collider=D.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,D.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.M(this._newPosition);let D=this.upVector;this.allowUpsideDown&&H<0&&(D=D.negate()),this._computeViewMatrix(this._position,g,D),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.M(g),this._viewMatrix}zoomOn(D){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];D=D||this.GD().meshes;const o=S.d.MinMax(D);let H=this._calculateLowerRadiusFromModelBoundingSphere(o.min,o.max);if(H=Math.max(Math.min(H,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=H*this.zoomOnFactor,this.mode===q.b.ORTHOGRAPHIC_CAMERA){const D=this.GD().getEngine().getAspectRatio(this),h=H*this.zoomOnFactor/2;this.orthoLeft=-h*D,this.orthoRight=h*D,this.orthoBottom=-h,this.orthoTop=h}this.focusOn({min:o.min,max:o.max,distance:H},h)}focusOn(D){let h,o,H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===D.min){const H=D||this.GD().meshes;h=S.d.MinMax(H),o=M.Gh.Distance(h.min,h.max)}else{h=D,o=D.distance}this._target=S.d.Center(h),H||(this.maxZ=2*o)}createRigCamera(D,h){let o=0;switch(this.cameraRigMode){case q.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case q.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case q.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case q.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case q.b.RIG_MODE_VR:o=this._cameraRigParams.stereoHalfAngle*(0===h?1:-1);break;case q.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:o=this._cameraRigParams.stereoHalfAngle*(0===h?-1:1)}const H=new p(D,this.alpha+o,this.beta,this.radius,this._target,this.GD());return H._cameraRigParams={},H.isRigCamera=!0,H.rigParent=this,H.upVector=this.upVector,H.mode=this.mode,H.orthoLeft=this.orthoLeft,H.orthoRight=this.orthoRight,H.orthoBottom=this.orthoBottom,H.orthoTop=this.orthoTop,H}_updateRigCameras(){const D=this._rigCameras[0],h=this._rigCameras[1];switch(D.beta=h.beta=this.beta,this.cameraRigMode){case q.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case q.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case q.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case q.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case q.b.RIG_MODE_VR:D.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,h.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case q.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:D.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,h.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const H=M.Gh.Distance(D,h),g=this.GD().getEngine().getAspectRatio(this),j=Math.tan(this.fov/2),R=j*g,t=.5*H*o,S=t*Math.sqrt(1+1/(R*R)),k=t*Math.sqrt(1+1/(j*j));return Math.max(S,k)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,H.c)([(0,g.I)()],p.prototype,"alpha",void 0),(0,H.c)([(0,g.I)()],p.prototype,"beta",void 0),(0,H.c)([(0,g.I)()],p.prototype,"radius",void 0),(0,H.c)([(0,g.I)()],p.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,H.c)([(0,g.H)("target")],p.prototype,"_target",void 0),(0,H.c)([(0,g.w)("targetHost")],p.prototype,"_targetHost",void 0),(0,H.c)([(0,g.I)()],p.prototype,"inertialAlphaOffset",void 0),(0,H.c)([(0,g.I)()],p.prototype,"inertialBetaOffset",void 0),(0,H.c)([(0,g.I)()],p.prototype,"inertialRadiusOffset",void 0),(0,H.c)([(0,g.I)()],p.prototype,"lowerAlphaLimit",void 0),(0,H.c)([(0,g.I)()],p.prototype,"upperAlphaLimit",void 0),(0,H.c)([(0,g.I)()],p.prototype,"lowerBetaLimit",void 0),(0,H.c)([(0,g.I)()],p.prototype,"upperBetaLimit",void 0),(0,H.c)([(0,g.I)()],p.prototype,"lowerRadiusLimit",void 0),(0,H.c)([(0,g.I)()],p.prototype,"upperRadiusLimit",void 0),(0,H.c)([(0,g.I)()],p.prototype,"lowerTargetYLimit",void 0),(0,H.c)([(0,g.I)()],p.prototype,"inertialPanningX",void 0),(0,H.c)([(0,g.I)()],p.prototype,"inertialPanningY",void 0),(0,H.c)([(0,g.I)()],p.prototype,"pinchToPanMaxDistance",void 0),(0,H.c)([(0,g.I)()],p.prototype,"panningDistanceLimit",void 0),(0,H.c)([(0,g.H)()],p.prototype,"panningOriginTarget",void 0),(0,H.c)([(0,g.I)()],p.prototype,"panningInertia",void 0),(0,H.c)([(0,g.I)()],p.prototype,"zoomToMouseLocation",null),(0,H.c)([(0,g.I)()],p.prototype,"zoomOnFactor",void 0),(0,H.c)([(0,g.F)()],p.prototype,"targetScreenOffset",void 0),(0,H.c)([(0,g.I)()],p.prototype,"allowUpsideDown",void 0),(0,H.c)([(0,g.I)()],p.prototype,"useInputToRestoreState",void 0),(0,H.c)([(0,g.I)()],p.prototype,"restoreStateInterpolationFactor",void 0),(0,Z.g)("BABYLON.ArcRotateCamera",p)},14286:(D,h,o)=>{"use strict";o.d(h,{e:()=>M,f:()=>R});var H=o(12658),g=o(12860),j=o(13296),M={};class R{constructor(D){this.attachedToElement=!1,this.attached={},this.camera=D,this.checkInputs=()=>{}}add(D){const h=D.getSimpleName();this.attached[h]?H.d.Warn("camera input of type "+h+" already exists on camera"):(this.attached[h]=D,D.camera=this.camera,D.checkInputs&&(this.checkInputs=this._addCheckInputs(D.checkInputs.bind(D))),this.attachedToElement&&D.attachControl(this.noPreventDefault))}remove(D){for(const h in this.attached){const o=this.attached[h];if(o===D)return o.bQ(),o.camera=null,delete this.attached[h],void this.rebuildInputCheck()}}removeByType(D){for(const h in this.attached){const o=this.attached[h];o.getClassName()===D&&(o.bQ(),o.camera=null,delete this.attached[h],this.rebuildInputCheck())}}_addCheckInputs(D){const h=this.checkInputs;return()=>{h(),D()}}attachInput(D){this.attachedToElement&&D.attachControl(this.noPreventDefault)}attachElement(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){D=!j.b.ForceAttachControlToAlwaysPreventDefault&&D,this.attachedToElement=!0,this.noPreventDefault=D;for(const h in this.attached)this.attached[h].attachControl(D)}}detachElement(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const h in this.attached)this.attached[h].bQ(),D&&(this.attached[h].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const D in this.attached){const h=this.attached[D];h.checkInputs&&(this.checkInputs=this._addCheckInputs(h.checkInputs.bind(h)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(D){const h={};for(const o in this.attached){const D=this.attached[o],H=g.d.Serialize(D);h[D.getClassName()]=H}D.inputsmgr=h}parse(D){const h=D.inputsmgr;if(h){this.clear();for(const D in h){const o=M[D];if(o){const H=h[D],j=g.d.Parse((()=>new o),H,null);this.add(j)}}}else for(const o in this.attached){const h=M[this.attached[o].getClassName()];if(h){const H=g.d.Parse((()=>new h),D,null);this.remove(this.attached[o]),this.add(H)}}}}},14284:(D,h,o)=>{"use strict";o.d(h,{d:()=>i});var H=o(12812),g=o(12815),j=o(12831),M=o(13332),R=o(14286),t=o(13107),S=o(12642);class k{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(D){D=S.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.GD(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((h=>{const o=h.event;if(!o.metaKey)if(h.type===t.d.KEYDOWN){if(-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysUpward.indexOf(o.keyCode)||-1!==this.keysDownward.indexOf(o.keyCode)||-1!==this.keysRotateLeft.indexOf(o.keyCode)||-1!==this.keysRotateRight.indexOf(o.keyCode)||-1!==this.keysRotateUp.indexOf(o.keyCode)||-1!==this.keysRotateDown.indexOf(o.keyCode)){-1===this._keys.indexOf(o.keyCode)&&this._keys.push(o.keyCode),D||o.preventDefault()}}else if(-1!==this.keysUp.indexOf(o.keyCode)||-1!==this.keysDown.indexOf(o.keyCode)||-1!==this.keysLeft.indexOf(o.keyCode)||-1!==this.keysRight.indexOf(o.keyCode)||-1!==this.keysUpward.indexOf(o.keyCode)||-1!==this.keysDownward.indexOf(o.keyCode)||-1!==this.keysRotateLeft.indexOf(o.keyCode)||-1!==this.keysRotateRight.indexOf(o.keyCode)||-1!==this.keysRotateUp.indexOf(o.keyCode)||-1!==this.keysRotateDown.indexOf(o.keyCode)){const h=this._keys.indexOf(o.keyCode);h>=0&&this._keys.splice(h,1),D||o.preventDefault()}})))}bQ(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const D=this.camera;for(let h=0;h<this._keys.length;h++){const o=this._keys[h],H=D._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(o)?D._localDirection.Qg(-H,0,0):-1!==this.keysUp.indexOf(o)?D._localDirection.Qg(0,0,H):-1!==this.keysRight.indexOf(o)?D._localDirection.Qg(H,0,0):-1!==this.keysDown.indexOf(o)?D._localDirection.Qg(0,0,-H):-1!==this.keysUpward.indexOf(o)?D._localDirection.Qg(0,H,0):-1!==this.keysDownward.indexOf(o)?D._localDirection.Qg(0,-H,0):-1!==this.keysRotateLeft.indexOf(o)?(D._localDirection.Qg(0,0,0),D.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(o)?(D._localDirection.Qg(0,0,0),D.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(o)?(D._localDirection.Qg(0,0,0),D.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(o)&&(D._localDirection.Qg(0,0,0),D.cameraRotation.x+=this._getLocalRotation()),D.GD().useRightHandedSystem&&(D._localDirection.z*=-1),D.getViewMatrix().invertToRef(D._cameraTransformMatrix),j.Gh.TransformNormalToRef(D._localDirection,D._cameraTransformMatrix,D._transformedDirection),D.cameraDirection.addInPlace(D._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const D=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*D}}(0,H.c)([(0,g.I)()],k.prototype,"keysUp",void 0),(0,H.c)([(0,g.I)()],k.prototype,"keysUpward",void 0),(0,H.c)([(0,g.I)()],k.prototype,"keysDown",void 0),(0,H.c)([(0,g.I)()],k.prototype,"keysDownward",void 0),(0,H.c)([(0,g.I)()],k.prototype,"keysLeft",void 0),(0,H.c)([(0,g.I)()],k.prototype,"keysRight",void 0),(0,H.c)([(0,g.I)()],k.prototype,"rotationSpeed",void 0),(0,H.c)([(0,g.I)()],k.prototype,"keysRotateLeft",void 0),(0,H.c)([(0,g.I)()],k.prototype,"keysRotateRight",void 0),(0,H.c)([(0,g.I)()],k.prototype,"keysRotateUp",void 0),(0,H.c)([(0,g.I)()],k.prototype,"keysRotateDown",void 0),R.e.FreeCameraKeyboardMoveInput=k;var K=o(12648),Q=o(13102);class v{constructor(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=D,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new K.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(D){D=S.Tools.BackCompatCameraNoPreventDefault(arguments);const h=this.camera.getEngine(),o=h.getInputElement();this._pointerInput||(this._pointerInput=H=>{const g=H.event,j="touch"===g.pointerType;if(!this.touchEnabled&&j)return;if(H.type!==Q.b.POINTERMOVE&&-1===this.buttons.indexOf(g.button))return;const M=g.target;if(H.type===Q.b.POINTERDOWN){if(j&&-1!==this._activePointerId||!j&&-1!==this._currentActiveButton)return;this._activePointerId=g.pointerId;try{null===M||void 0===M||M.setPointerCapture(g.pointerId)}catch(R){}-1===this._currentActiveButton&&(this._currentActiveButton=g.button),this._previousPosition={x:g.clientX,y:g.clientY},D||(g.preventDefault(),o&&o.focus()),h.isPointerLock&&this._onMouseMove&&this._onMouseMove(H.event)}else if(H.type===Q.b.POINTERUP){if(j&&this._activePointerId!==g.pointerId||!j&&this._currentActiveButton!==g.button)return;try{null===M||void 0===M||M.releasePointerCapture(g.pointerId)}catch(R){}this._currentActiveButton=-1,this._previousPosition=null,D||g.preventDefault(),this._activePointerId=-1}else if(H.type===Q.b.POINTERMOVE&&(this._activePointerId===g.pointerId||!j))if(h.isPointerLock&&this._onMouseMove)this._onMouseMove(H.event);else if(this._previousPosition){const h=this.camera._calculateHandednessMultiplier(),o=(g.clientX-this._previousPosition.x)*h,H=g.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=o/this.angularSensibility,this.camera.cameraRotation.x+=H/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:o,offsetY:H}),this._previousPosition={x:g.clientX,y:g.clientY},D||g.preventDefault()}}),this._onMouseMove=o=>{if(!h.isPointerLock)return;const H=this.camera._calculateHandednessMultiplier(),g=o.movementX*H;this.camera.cameraRotation.y+=g/this.angularSensibility;const j=o.movementY;this.camera.cameraRotation.x+=j/this.angularSensibility,this._previousPosition=null,D||o.preventDefault()},this._observer=this.camera.GD()._inputManager._addCameraPointerObserver(this._pointerInput,Q.b.POINTERDOWN|Q.b.POINTERUP|Q.b.POINTERMOVE),o&&(this._contextMenuBind=D=>this.onContextMenu(D),o.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(D){D.preventDefault()}bQ(){if(this._observer){if(this.camera.GD()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const D=this.camera.getEngine().getInputElement();D&&D.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,H.c)([(0,g.I)()],v.prototype,"buttons",void 0),(0,H.c)([(0,g.I)()],v.prototype,"angularSensibility",void 0),R.e.FreeCameraMouseInput=v;var r,B=o(13110);class s{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new K.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(D){D=S.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=h=>{if(h.type!==Q.b.POINTERWHEEL)return;const o=h.event,H=o.deltaMode===B.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*H*o.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*H*o.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*H*o.deltaZ/this._normalize,o.preventDefault&&(D||o.preventDefault())},this._observer=this.camera.GD()._inputManager._addCameraPointerObserver(this._wheel,Q.b.POINTERWHEEL)}bQ(){this._observer&&(this.camera.GD()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,H.c)([(0,g.I)()],s.prototype,"wheelPrecisionX",void 0),(0,H.c)([(0,g.I)()],s.prototype,"wheelPrecisionY",void 0),(0,H.c)([(0,g.I)()],s.prototype,"wheelPrecisionZ",void 0),function(D){D[D.MoveRelative=0]="MoveRelative",D[D.RotateRelative=1]="RotateRelative",D[D.MoveScene=2]="MoveScene"}(r||(r={}));class U extends s{constructor(){super(...arguments),this._moveRelative=j.Gh.Zero(),this._rotateRelative=j.Gh.Zero(),this._moveScene=j.Gh.Zero(),this._wheelXAction=r.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=r.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(D){null===D&&this._wheelXAction!==r.MoveRelative||(this._wheelXAction=r.MoveRelative,this._wheelXActionCoordinate=D)}get wheelXMoveRelative(){return this._wheelXAction!==r.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(D){null===D&&this._wheelYAction!==r.MoveRelative||(this._wheelYAction=r.MoveRelative,this._wheelYActionCoordinate=D)}get wheelYMoveRelative(){return this._wheelYAction!==r.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(D){null===D&&this._wheelZAction!==r.MoveRelative||(this._wheelZAction=r.MoveRelative,this._wheelZActionCoordinate=D)}get wheelZMoveRelative(){return this._wheelZAction!==r.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(D){null===D&&this._wheelXAction!==r.RotateRelative||(this._wheelXAction=r.RotateRelative,this._wheelXActionCoordinate=D)}get wheelXRotateRelative(){return this._wheelXAction!==r.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(D){null===D&&this._wheelYAction!==r.RotateRelative||(this._wheelYAction=r.RotateRelative,this._wheelYActionCoordinate=D)}get wheelYRotateRelative(){return this._wheelYAction!==r.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(D){null===D&&this._wheelZAction!==r.RotateRelative||(this._wheelZAction=r.RotateRelative,this._wheelZActionCoordinate=D)}get wheelZRotateRelative(){return this._wheelZAction!==r.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(D){null===D&&this._wheelXAction!==r.MoveScene||(this._wheelXAction=r.MoveScene,this._wheelXActionCoordinate=D)}get wheelXMoveScene(){return this._wheelXAction!==r.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(D){null===D&&this._wheelYAction!==r.MoveScene||(this._wheelYAction=r.MoveScene,this._wheelYActionCoordinate=D)}get wheelYMoveScene(){return this._wheelYAction!==r.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(D){null===D&&this._wheelZAction!==r.MoveScene||(this._wheelZAction=r.MoveScene,this._wheelZActionCoordinate=D)}get wheelZMoveScene(){return this._wheelZAction!==r.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.qg(0),this._rotateRelative.qg(0),this._moveScene.qg(0),this._updateCamera(),this.camera.GD().useRightHandedSystem&&(this._moveRelative.z*=-1);const D=j.Matrix.Zero();this.camera.getViewMatrix().invertToRef(D);const h=j.Gh.Zero();j.Gh.TransformNormalToRef(this._moveRelative,D,h),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(h),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(D,h,o){if(0===D)return;if(null===h||null===o)return;let H=null;switch(h){case r.MoveRelative:H=this._moveRelative;break;case r.RotateRelative:H=this._rotateRelative;break;case r.MoveScene:H=this._moveScene}switch(o){case 0:H.set(D,0,0);break;case 1:H.set(0,D,0);break;case 2:H.set(0,0,D)}}}(0,H.c)([(0,g.I)()],U.prototype,"wheelXMoveRelative",null),(0,H.c)([(0,g.I)()],U.prototype,"wheelYMoveRelative",null),(0,H.c)([(0,g.I)()],U.prototype,"wheelZMoveRelative",null),(0,H.c)([(0,g.I)()],U.prototype,"wheelXRotateRelative",null),(0,H.c)([(0,g.I)()],U.prototype,"wheelYRotateRelative",null),(0,H.c)([(0,g.I)()],U.prototype,"wheelZRotateRelative",null),(0,H.c)([(0,g.I)()],U.prototype,"wheelXMoveScene",null),(0,H.c)([(0,g.I)()],U.prototype,"wheelYMoveScene",null),(0,H.c)([(0,g.I)()],U.prototype,"wheelZMoveScene",null),R.e.FreeCameraMouseWheelInput=U;class q{constructor(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=D,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=S.Tools.IsSafari()}attachControl(D){D=S.Tools.BackCompatCameraNoPreventDefault(arguments);let h=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=o=>{const H=o.event,g="mouse"===H.pointerType||this._isSafari&&"undefined"===typeof H.pointerType;if(this.allowMouse||!g)if(o.type===Q.b.POINTERDOWN){if(D||H.preventDefault(),this._pointerPressed.push(H.pointerId),1!==this._pointerPressed.length)return;h={x:H.clientX,y:H.clientY}}else if(o.type===Q.b.POINTERUP){D||H.preventDefault();const o=this._pointerPressed.indexOf(H.pointerId);if(-1===o)return;if(this._pointerPressed.splice(o,1),0!=o)return;h=null,this._offsetX=null,this._offsetY=null}else if(o.type===Q.b.POINTERMOVE){if(D||H.preventDefault(),!h)return;if(0!=this._pointerPressed.indexOf(H.pointerId))return;this._offsetX=H.clientX-h.x,this._offsetY=-(H.clientY-h.y)}}),this._observer=this.camera.GD()._inputManager._addCameraPointerObserver(this._pointerInput,Q.b.POINTERDOWN|Q.b.POINTERUP|Q.b.POINTERMOVE),this._onLostFocus){const D=this.camera.getEngine().getInputElement();D&&D.addEventListener("blur",this._onLostFocus)}}bQ(){if(this._pointerInput){if(this._observer&&(this.camera.GD()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const D=this.camera.getEngine().getInputElement();D&&D.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const D=this.camera,h=D._calculateHandednessMultiplier();D.cameraRotation.y=h*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)D.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const h=D._computeLocalCameraSpeed(),o=new j.Gh(0,0,0!==this.touchMoveSensibility?h*this._offsetY/this.touchMoveSensibility:0);j.Matrix.RotationYawPitchRollToRef(D.rotation.y,D.rotation.x,0,D._cameraRotationMatrix),D.cameraDirection.addInPlace(j.Gh.TransformCoordinates(o,D._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,H.c)([(0,g.I)()],q.prototype,"touchAngularSensibility",void 0),(0,H.c)([(0,g.I)()],q.prototype,"touchMoveSensibility",void 0),R.e.FreeCameraTouchInput=q;class c extends R.f{constructor(D){super(D),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new k),this}addMouse(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new v(D),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new U,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new q),this}clear(){super.clear(),this._mouseInput=null}}var y=o(12793),b=o(12731);class i extends M.b{get angularSensibility(){const D=this.inputs.attached.mouse;return D?D.angularSensibility:0}set angularSensibility(D){const h=this.inputs.attached.mouse;h&&(h.angularSensibility=D)}get keysUp(){const D=this.inputs.attached.keyboard;return D?D.keysUp:[]}set keysUp(D){const h=this.inputs.attached.keyboard;h&&(h.keysUp=D)}get keysUpward(){const D=this.inputs.attached.keyboard;return D?D.keysUpward:[]}set keysUpward(D){const h=this.inputs.attached.keyboard;h&&(h.keysUpward=D)}get keysDown(){const D=this.inputs.attached.keyboard;return D?D.keysDown:[]}set keysDown(D){const h=this.inputs.attached.keyboard;h&&(h.keysDown=D)}get keysDownward(){const D=this.inputs.attached.keyboard;return D?D.keysDownward:[]}set keysDownward(D){const h=this.inputs.attached.keyboard;h&&(h.keysDownward=D)}get keysLeft(){const D=this.inputs.attached.keyboard;return D?D.keysLeft:[]}set keysLeft(D){const h=this.inputs.attached.keyboard;h&&(h.keysLeft=D)}get keysRight(){const D=this.inputs.attached.keyboard;return D?D.keysRight:[]}set keysRight(D){const h=this.inputs.attached.keyboard;h&&(h.keysRight=D)}get keysRotateLeft(){const D=this.inputs.attached.keyboard;return D?D.keysRotateLeft:[]}set keysRotateLeft(D){const h=this.inputs.attached.keyboard;h&&(h.keysRotateLeft=D)}get keysRotateRight(){const D=this.inputs.attached.keyboard;return D?D.keysRotateRight:[]}set keysRotateRight(D){const h=this.inputs.attached.keyboard;h&&(h.keysRotateRight=D)}get keysRotateUp(){const D=this.inputs.attached.keyboard;return D?D.keysRotateUp:[]}set keysRotateUp(D){const h=this.inputs.attached.keyboard;h&&(h.keysRotateUp=D)}get keysRotateDown(){const D=this.inputs.attached.keyboard;return D?D.keysRotateDown:[]}set keysRotateDown(D){const h=this.inputs.attached.keyboard;h&&(h.keysRotateDown=D)}constructor(D,h,o){var H;super(D,h,o,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),H=this,this.ellipsoid=new j.Gh(.5,1,.5),this.ellipsoidOffset=new j.Gh(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=j.Gh.Zero(),this._diffPosition=j.Gh.Zero(),this._newPosition=j.Gh.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H._newPosition.M(h),H._newPosition.subtractToRef(H._oldPosition,H._diffPosition),H._diffPosition.length()>b.e.CollisionsEpsilon&&(H.position.addToRef(H._diffPosition,H._deferredPositionUpdate),H._deferOnly?H._deferredUpdated=!0:H.position.M(H._deferredPositionUpdate),H.gr&&o&&H.gr(o))},this.inputs=new c(this),this.inputs.addKeyboard().addMouse()}attachControl(D,h){h=S.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(h)}bQ(){this.inputs.detachElement(),this.cameraDirection=new j.Gh(0,0,0),this.cameraRotation=new j.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(D){this._collisionMask=isNaN(D)?-1:D}_collideWithWorld(D){let h;h=this.parent?j.Gh.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,h.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const o=this.GD().collisionCoordinator;this._collider||(this._collider=o.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let H=D;this.applyGravity&&(H=D.add(this.GD().gravity)),o.getNewPosition(this._oldPosition,H,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=j.Gh.Zero(),this._transformedDirection=j.Gh.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(D){this._needMoveForGravity=D}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.GD().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Ig"}}(0,H.c)([(0,g.H)()],i.prototype,"ellipsoid",void 0),(0,H.c)([(0,g.H)()],i.prototype,"ellipsoidOffset",void 0),(0,H.c)([(0,g.I)()],i.prototype,"checkCollisions",void 0),(0,H.c)([(0,g.I)()],i.prototype,"applyGravity",void 0),(0,y.g)("BABYLON.FreeCamera",i)},14941:(D,h,o)=>{"use strict";o.d(h,{c:()=>j});var H=o(12915),g=o(14945);class j{constructor(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=o,this.wK=[],this._maxBlockCapacity=h||64,this._selectionContent=new H.b(1024),this._creationFunc=D}update(D,h,o){g.c._CreateBlocks(D,h,o,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}dk(D){for(let h=0;h<this.HK.length;h++){this.HK[h].addEntry(D)}}Vk(D){for(let h=0;h<this.HK.length;h++){this.HK[h].removeEntry(D)}}select(D,h){this._selectionContent.reset();for(let o=0;o<this.HK.length;o++){this.HK[o].select(D,this._selectionContent,h)}return h?this._selectionContent.concat(this.wK):this._selectionContent.concatWithNoDuplicate(this.wK),this._selectionContent}intersects(D,h,o){this._selectionContent.reset();for(let H=0;H<this.HK.length;H++){this.HK[H].intersects(D,h,this._selectionContent,o)}return o?this._selectionContent.concat(this.wK):this._selectionContent.concatWithNoDuplicate(this.wK),this._selectionContent}intersectsRay(D){this._selectionContent.reset();for(let h=0;h<this.HK.length;h++){this.HK[h].intersectsRay(D,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.wK),this._selectionContent}}j.CreationFuncForMeshes=(D,h)=>{const o=D.getBoundingInfo();!D.isBlocked&&o.boundingBox.intersectsMinMax(h.fK,h.VK)&&h.entries.push(D)},j.CreationFuncForSubMeshes=(D,h)=>{D.getBoundingInfo().boundingBox.intersectsMinMax(h.fK,h.VK)&&h.entries.push(D)}},14945:(D,h,o)=>{"use strict";o.d(h,{c:()=>j});var H=o(12831),g=o(13171);class j{constructor(D,h,o,H,g,j){this.entries=[],this.dK=new Array,this._capacity=o,this._depth=H,this._maxDepth=g,this._creationFunc=j,this._minPoint=D,this._maxPoint=h,this.dK.push(D.clone()),this.dK.push(h.clone()),this.dK.push(D.clone()),this.dK[2].x=h.x,this.dK.push(D.clone()),this.dK[3].y=h.y,this.dK.push(D.clone()),this.dK[4].z=h.z,this.dK.push(h.clone()),this.dK[5].z=D.z,this.dK.push(h.clone()),this.dK[6].x=D.x,this.dK.push(h.clone()),this.dK[7].y=D.y}get Ko(){return this._capacity}get fK(){return this._minPoint}get VK(){return this._maxPoint}addEntry(D){if(this.HK)for(let h=0;h<this.HK.length;h++){this.HK[h].addEntry(D)}else this._creationFunc(D,this),this.entries.length>this.Ko&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(D){if(this.HK){for(let h=0;h<this.HK.length;h++){this.HK[h].removeEntry(D)}return}const h=this.entries.indexOf(D);h>-1&&this.entries.splice(h,1)}addEntries(D){for(let h=0;h<D.length;h++){const o=D[h];this.addEntry(o)}}select(D,h,o){if(g.b.IsInFrustum(this.dK,D)){if(this.HK){for(let H=0;H<this.HK.length;H++){this.HK[H].select(D,h,o)}return}o?h.concat(this.entries):h.concatWithNoDuplicate(this.entries)}}intersects(D,h,o,H){if(g.b.IntersectsSphere(this._minPoint,this._maxPoint,D,h)){if(this.HK){for(let g=0;g<this.HK.length;g++){this.HK[g].intersects(D,h,o,H)}return}H?o.concat(this.entries):o.concatWithNoDuplicate(this.entries)}}intersectsRay(D,h){if(D.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.HK){for(let o=0;o<this.HK.length;o++){this.HK[o].intersectsRay(D,h)}return}h.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){j._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(D,h,o,g,M,R,t,S){t.HK=new Array;const k=new H.Gh((h.x-D.x)/2,(h.y-D.y)/2,(h.z-D.z)/2);for(let H=0;H<2;H++)for(let h=0;h<2;h++)for(let K=0;K<2;K++){const Q=D.add(k.multiplyByFloats(H,h,K)),v=D.add(k.multiplyByFloats(H+1,h+1,K+1)),r=new j(Q,v,g,M+1,R,S);r.addEntries(o),t.HK.push(r)}}}},14951:(D,h,o)=>{"use strict";o.d(h,{b:()=>k});var H=o(13065),g=o(12831),j=o(13266),M=o(14058),R=o(13094),t=o(14941),S=o(12683);H.b.prototype.createOrUpdateSelectionOctree=function(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,o=this._getComponent(R.e.NAME_OCTREE);o||(o=new k(this),this.o(o)),this.nK||(this.nK=new t.c(t.c.CreationFuncForMeshes,D,h));const H=this.getWorldExtends();return this.nK.update(H.min,H.max,this.meshes),this.nK},Object.defineProperty(H.b.prototype,"selectionOctree",{get:function(){return this.nK},enumerable:!0,configurable:!0}),j.e.prototype.createOrUpdateSubmeshesOctree=function(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const o=this.GD();let H=o._getComponent(R.e.NAME_OCTREE);H||(H=new k(o),o.o(H)),this._submeshesOctree||(this._submeshesOctree=new t.c(t.c.CreationFuncForSubMeshes,D,h)),this.xh(!0);const g=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(g.minimumWorld,g.maximumWorld,this.nh),this._submeshesOctree};class k{constructor(D){this.name=R.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new M.b(g.Gh.Zero(),new g.Gh(1,1,1)),(D=D||S.d.LastCreatedScene)&&(this.Th=D,this.Th.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Th.getActiveSubMeshCandidates=D=>this.getActiveSubMeshCandidates(D),this.Th.getCollidingSubMeshCandidates=(D,h)=>this.getCollidingSubMeshCandidates(D,h),this.Th.getIntersectingSubMeshCandidates=(D,h)=>this.getIntersectingSubMeshCandidates(D,h))}register(){this.Th.onMeshRemovedObservable.add((D=>{const h=this.Th.selectionOctree;if(void 0!==h&&null!==h){const o=h.wK.indexOf(D);-1!==o&&h.wK.splice(o,1)}})),this.Th.onMeshImportedObservable.add((D=>{const h=this.Th.selectionOctree;void 0!==h&&null!==h&&h.dk(D)}))}getActiveMeshCandidates(){var D;return(null===(D=this.Th.nK)||void 0===D?void 0:D.select(this.Th.frustumPlanes))||this.Th._getDefaultMeshCandidates()}getActiveSubMeshCandidates(D){if(D._submeshesOctree&&D.useOctreeForRenderingSelection){return D._submeshesOctree.select(this.Th.frustumPlanes)}return this.Th._getDefaultSubMeshCandidates(D)}getIntersectingSubMeshCandidates(D,h){if(D._submeshesOctree&&D.useOctreeForPicking){M.b.TransformToRef(h,D.getWorldMatrix(),this._tempRay);return D._submeshesOctree.intersectsRay(this._tempRay)}return this.Th._getDefaultSubMeshCandidates(D)}getCollidingSubMeshCandidates(D,h){if(D._submeshesOctree&&D.useOctreeForCollisions){const o=h._velocityWorldLength+Math.max(h._radius.x,h._radius.y,h._radius.z);return D._submeshesOctree.intersects(h._basePointWorld,o)}return this.Th._getDefaultSubMeshCandidates(D)}rebuild(){}dispose(){}}},14058:(D,h,o)=>{"use strict";o.d(h,{b:()=>v});var H=o(13065),g=o(13296),j=o(12833),M=o(12831),R=o(12836),t=o(13162),S=o(13087),k=o(12683),K=o(13119);const Q={internalPickerForMesh:void 0};class v{constructor(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:j.d;this.origin=D,this.direction=h,this.length=o,this.epsilon=H}clone(){return new v(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const H=v._TmpVector3[0].Qg(D.x-o,D.y-o,D.z-o),g=v._TmpVector3[1].Qg(h.x+o,h.y+o,h.z+o);let j,M,R,t,S=0,k=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<H.x||this.origin.x>g.x)return!1}else if(j=1/this.direction.x,M=(H.x-this.origin.x)*j,R=(g.x-this.origin.x)*j,R===-1/0&&(R=1/0),M>R&&(t=M,M=R,R=t),S=Math.max(M,S),k=Math.min(R,k),S>k)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<H.y||this.origin.y>g.y)return!1}else if(j=1/this.direction.y,M=(H.y-this.origin.y)*j,R=(g.y-this.origin.y)*j,R===-1/0&&(R=1/0),M>R&&(t=M,M=R,R=t),S=Math.max(M,S),k=Math.min(R,k),S>k)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<H.z||this.origin.z>g.z)return!1}else if(j=1/this.direction.z,M=(H.z-this.origin.z)*j,R=(g.z-this.origin.z)*j,R===-1/0&&(R=1/0),M>R&&(t=M,M=R,R=t),S=Math.max(M,S),k=Math.min(R,k),S>k)return!1;return!0}intersectsBox(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(D.minimum,D.maximum,h)}intersectsSphere(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=D.center.x-this.origin.x,H=D.center.y-this.origin.y,g=D.center.z-this.origin.z,j=o*o+H*H+g*g,M=D.radius+h,R=M*M;if(j<=R)return!0;const t=o*this.direction.x+H*this.direction.y+g*this.direction.z;if(t<0)return!1;return j-t*t<=R}intersectsTriangle(D,h,o){const H=v._TmpVector3[0],g=v._TmpVector3[1],j=v._TmpVector3[2],R=v._TmpVector3[3],S=v._TmpVector3[4];h.subtractToRef(D,H),o.subtractToRef(D,g),M.Gh.CrossToRef(this.direction,g,j);const k=M.Gh.Dot(H,j);if(0===k)return null;const K=1/k;this.origin.subtractToRef(D,R);const Q=M.Gh.Dot(R,j)*K;if(Q<-this.epsilon||Q>1+this.epsilon)return null;M.Gh.CrossToRef(R,H,S);const r=M.Gh.Dot(this.direction,S)*K;if(r<-this.epsilon||Q+r>1+this.epsilon)return null;const B=M.Gh.Dot(g,S)*K;return B>this.length?null:new t.d(1-Q-r,Q,B)}intersectsPlane(D){let h;const o=M.Gh.Dot(D.normal,this.direction);if(Math.abs(o)<9.99999997475243e-7)return null;{const H=M.Gh.Dot(D.normal,this.origin);return h=(-D.d-H)/o,h<0?h<-9.99999997475243e-7?null:0:h}}intersectsAxis(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(D){case"y":{const D=(this.origin.y-h)/this.direction.y;return D>0?null:new M.Gh(this.origin.x+this.direction.x*-D,h,this.origin.z+this.direction.z*-D)}case"x":{const D=(this.origin.x-h)/this.direction.x;return D>0?null:new M.Gh(h,this.origin.y+this.direction.y*-D,this.origin.z+this.direction.z*-D)}case"z":{const D=(this.origin.z-h)/this.direction.z;return D>0?null:new M.Gh(this.origin.x+this.direction.x*-D,this.origin.y+this.direction.y*-D,h)}default:return null}}intersectsMesh(D,h,o){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4?arguments[4]:void 0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const R=M.TmpVectors.Matrix[0];return D.getWorldMatrix().invertToRef(R),this._tmpRay?v.TransformToRef(this,R,this._tmpRay):this._tmpRay=v.Transform(this,R),D.intersects(this._tmpRay,h,o,H,g,j)}intersectsMeshes(D,h,o){o?o.length=0:o=[];for(let H=0;H<D.length;H++){const g=this.intersectsMesh(D[H],h);g.hit&&o.push(g)}return o.sort(this._comparePickingInfo),o}_comparePickingInfo(D,h){return D.distance<h.distance?-1:D.distance>h.distance?1:0}intersectionSegment(D,h,o){const H=this.origin,g=M.TmpVectors.Gh[0],j=M.TmpVectors.Gh[1],R=M.TmpVectors.Gh[2],t=M.TmpVectors.Gh[3];h.subtractToRef(D,g),this.direction.scaleToRef(v._Rayl,R),H.addToRef(R,j),D.subtractToRef(H,t);const S=M.Gh.Dot(g,g),k=M.Gh.Dot(g,R),K=M.Gh.Dot(R,R),Q=M.Gh.Dot(g,t),r=M.Gh.Dot(R,t),B=S*K-k*k;let s,U,q=B,c=B;B<v._Smallnum?(s=0,q=1,U=r,c=K):(s=k*r-K*Q,U=S*r-k*Q,s<0?(s=0,U=r,c=K):s>q&&(s=q,U=r+k,c=K)),U<0?(U=0,-Q<0?s=0:-Q>S?s=q:(s=-Q,q=S)):U>c&&(U=c,-Q+k<0?s=0:-Q+k>S?s=q:(s=-Q+k,q=S));const y=Math.abs(s)<v._Smallnum?0:s/q,b=Math.abs(U)<v._Smallnum?0:U/c,i=M.TmpVectors.Gh[4];R.scaleToRef(b,i);const G=M.TmpVectors.Gh[5];g.scaleToRef(y,G),G.addInPlace(t);const N=M.TmpVectors.Gh[6];G.subtractToRef(i,N);return b>0&&b<=this.length&&N.lengthSquared()<o*o?G.length():-1}update(D,h,o,H,g,j,R){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){v._RayDistant||(v._RayDistant=v.Zero()),v._RayDistant.unprojectRayToRef(D,h,o,H,M.Matrix.IdentityReadOnly,j,R);const t=M.TmpVectors.Matrix[0];g.invertToRef(t),v.TransformToRef(v._RayDistant,t,this)}else this.unprojectRayToRef(D,h,o,H,g,j,R);return this}static Zero(){return new v(M.Gh.Zero(),M.Gh.Zero())}static CreateNew(D,h,o,H,g,j,M){return v.Zero().update(D,h,o,H,g,j,M)}static CreateNewFromTo(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M.Matrix.IdentityReadOnly;const H=new v(new M.Gh(0,0,0),new M.Gh(0,0,0));return v.CreateFromToToRef(D,h,H,o)}static CreateFromToToRef(D,h,o){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M.Matrix.IdentityReadOnly;o.origin.M(D);const g=h.subtractToRef(D,o.direction),j=Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z);return o.length=j,o.direction.normalize(),v.TransformToRef(o,H,o)}static Transform(D,h){const o=new v(new M.Gh(0,0,0),new M.Gh(0,0,0));return v.TransformToRef(D,h,o),o}static TransformToRef(D,h,o){M.Gh.TransformCoordinatesToRef(D.origin,h,o.origin),M.Gh.TransformNormalToRef(D.direction,h,o.direction),o.length=D.length,o.epsilon=D.epsilon;const H=o.direction,g=H.length();if(0!==g&&1!==g){const D=1/g;H.x*=D,H.y*=D,H.z*=D,o.length*=g}return o}unprojectRayToRef(D,h,o,H,g,j,R){const t=M.TmpVectors.Matrix[0];g.multiplyToRef(j,t),t.multiplyToRef(R,t),t.invert();const S=k.d.LastCreatedEngine,K=M.TmpVectors.Gh[0];K.x=D/o*2-1,K.y=-(h/H*2-1),K.z=null!==S&&void 0!==S&&S.Bh?1:null!==S&&void 0!==S&&S.isNDCHalfZRange?0:-1;const Q=M.TmpVectors.Gh[1].Qg(K.x,K.y,1-1e-8),v=M.TmpVectors.Gh[2],r=M.TmpVectors.Gh[3];M.Gh._UnprojectFromInvertedMatrixToRef(K,t,v),M.Gh._UnprojectFromInvertedMatrixToRef(Q,t,r),this.origin.M(v),r.subtractToRef(v,this.direction),this.direction.normalize()}}function r(D,h,o,H,g){let j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const M=v.Zero();return B(D,h,o,H,M,g,j),M}function B(D,h,o,H,g,j){let R=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const S=D.getEngine();if(!j&&!(j=D.activeCamera))return D;const k=j.viewport,K=S.getRenderHeight(),{x:Q,y:v,width:r,height:B}=k.toGlobal(S.getRenderWidth(),K),s=1/S.getHardwareScalingLevel();return h=h*s-Q,o=o*s-(K-v-B),g.update(h,o,r,B,H||M.Matrix.IdentityReadOnly,R?M.Matrix.IdentityReadOnly:j.getViewMatrix(),j.getProjectionMatrix(),t),D}function s(D,h,o,H,g){if(!S.c)return D;const j=D.getEngine();if(!g&&!(g=D.activeCamera))throw new Error("Active camera not set");const R=g.viewport,t=j.getRenderHeight(),{x:k,y:K,width:Q,height:v}=R.toGlobal(j.getRenderWidth(),t),r=M.Matrix.Identity(),B=1/j.getHardwareScalingLevel();return h=h*B-k,o=o*B-(t-K-v),H.update(h,o,Q,v,r,r,g.getProjectionMatrix()),D}function U(D,h,o,H,g,j,M,R){const t=h(H,o.enableDistantPicking),S=o.intersects(t,g,M,j,H,R);return S&&S.hit?!g&&null!=D&&S.distance>=D.distance?null:S:null}function q(D,h,o,H,g,j){let R=null;const t=!!(D.activeCameras&&D.activeCameras.length>1&&D.cameraToUseForPointers!==D.activeCamera),k=D.cameraToUseForPointers||D.activeCamera,K=Q.internalPickerForMesh||U;for(let S=0;S<D.meshes.length;S++){const Q=D.meshes[S];if(o){if(!o(Q,-1))continue}else if(!Q.isEnabled()||!Q.isVisible||!Q.TS)continue;const v=t&&Q.isWorldMatrixCameraDependent(),r=Q.xh(v,k);if(Q.hasThinInstances&&Q.Kk){const D=K(R,h,Q,r,!0,!0,j);if(D){if(g)return D;const t=M.TmpVectors.Matrix[1],S=Q.thinInstanceGetWorldMatrices();for(let D=0;D<S.length;D++){if(o&&!o(Q,D))continue;S[D].multiplyToRef(r,t);const M=K(R,h,Q,t,H,g,j,!0);if(M&&(R=M,R.thinInstanceIndex=D,H))return R}}}else{const D=K(R,h,Q,r,H,g,j);if(D&&(R=D,H))return R}}return R||new S.c}function c(D,h,o,H){if(!S.c)return null;const g=[],j=!!(D.activeCameras&&D.activeCameras.length>1&&D.cameraToUseForPointers!==D.activeCamera),R=D.cameraToUseForPointers||D.activeCamera,t=Q.internalPickerForMesh||U;for(let S=0;S<D.meshes.length;S++){const k=D.meshes[S];if(o){if(!o(k,-1))continue}else if(!k.isEnabled()||!k.isVisible||!k.TS)continue;const K=j&&k.isWorldMatrixCameraDependent(),Q=k.xh(K,R);if(k.hasThinInstances&&k.Kk){if(t(null,h,k,Q,!0,!0,H)){const D=M.TmpVectors.Matrix[1],j=k.thinInstanceGetWorldMatrices();for(let M=0;M<j.length;M++){if(o&&!o(k,M))continue;j[M].multiplyToRef(Q,D);const R=t(null,h,k,D,!1,!1,H,!0);R&&(R.thinInstanceIndex=M,g.push(R))}}}else{const D=t(null,h,k,Q,!1,!1,H);D&&g.push(D)}}return g}function y(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,H=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;H||(H=D.getWorldMatrix()),h.length=o,g?h.origin.M(g):h.origin.M(D.position);const j=M.TmpVectors.Gh[2];j.set(0,0,D._scene.useRightHandedSystem?-1:1);const R=M.TmpVectors.Gh[3];return M.Gh.TransformNormalToRef(j,H,R),M.Gh.NormalizeToRef(R,h.direction),h}var b,i;v._TmpVector3=(0,R.b)(6,M.Gh.Zero),v._RayDistant=v.Zero(),v._Smallnum=1e-8,v._Rayl=1e9,b=H.b,(i=g.b)&&(i.prototype.getForwardRay=function(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,h=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;return y(this,new v(M.Gh.Zero(),M.Gh.Zero(),D),D,h,o)},i.prototype.getForwardRayToRef=function(D){return y(this,D,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),b&&(K.d._IsPickingAvailable=!0,b.prototype.createPickingRay=function(D,h,o,H){return r(this,D,h,o,H,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),H.b.prototype.createPickingRayToRef=function(D,h,o,H,g){return B(this,D,h,o,H,g,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},H.b.prototype.createPickingRayInCameraSpace=function(D,h,o){return function(D,h,o,H){const g=v.Zero();return s(D,h,o,g,H),g}(this,D,h,o)},H.b.prototype.createPickingRayInCameraSpaceToRef=function(D,h,o,H){return s(this,D,h,o,H)},H.b.prototype.pickWithBoundingInfo=function(D,h,o,H,g){return function(D,h,o,H,g,j){if(!S.c)return null;const R=q(D,(H=>(D._tempPickingRay||(D._tempPickingRay=v.Zero()),B(D,h,o,H,D._tempPickingRay,j||null),D._tempPickingRay)),H,g,!0);return R&&(R.ray=r(D,h,o,M.Matrix.Identity(),j||null)),R}(this,D,h,o,H,g)},H.b.prototype.Yo=function(D,h,o,H,g,j){return function(D,h,o,H,g,j,R){const t=q(D,((H,g)=>(D._tempPickingRay||(D._tempPickingRay=v.Zero()),B(D,h,o,H,D._tempPickingRay,j||null,!1,g),D._tempPickingRay)),H,g,!1,R);return t&&(t.ray=r(D,h,o,M.Matrix.Identity(),j||null)),t}(this,D,h,o,H,g,j)},H.b.prototype.pickWithRay=function(D,h,o,H){return function(D,h,o,H,g){const j=q(D,(o=>(D._pickWithRayInverseMatrix||(D._pickWithRayInverseMatrix=M.Matrix.Identity()),o.invertToRef(D._pickWithRayInverseMatrix),D._cachedRayForTransform||(D._cachedRayForTransform=v.Zero()),v.TransformToRef(h,D._pickWithRayInverseMatrix,D._cachedRayForTransform),D._cachedRayForTransform)),o,H,!1,g);return j&&(j.ray=h),j}(this,D,h,o,H)},H.b.prototype.multiPick=function(D,h,o,H,g){return function(D,h,o,H,g,j){return c(D,(H=>r(D,h,o,H,g||null)),H,j)}(this,D,h,o,H,g)},H.b.prototype.multiPickWithRay=function(D,h,o){return function(D,h,o,H){return c(D,(o=>(D._pickWithRayInverseMatrix||(D._pickWithRayInverseMatrix=M.Matrix.Identity()),o.invertToRef(D._pickWithRayInverseMatrix),D._cachedRayForTransform||(D._cachedRayForTransform=v.Zero()),v.TransformToRef(h,D._pickWithRayInverseMatrix,D._cachedRayForTransform),D._cachedRayForTransform)),o,H)}(this,D,h,o)}},14334:(D,h,o)=>{"use strict";var H=o(12771),g=o(12658),j=o(12691),M=o(12798),R=o(12731),t=o(12784);R.e.prototype._partialLoadFile=function(D,h,o,H){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(D,(D=>{o[h]=D,o._internalCount++,6===o._internalCount&&H(o)}),void 0,void 0,!0,((D,h)=>{g&&D&&g(D.status+" "+D.statusText,h)}))},R.e.prototype._cascadeLoadFiles=function(D,h,o){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const g=[];g._internalCount=0;for(let j=0;j<6;j++)this._partialLoadFile(o[j],j,g,h,H)},R.e.prototype._cascadeLoadImgs=function(D,h,o,H){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5?arguments[5]:void 0;const M=[];M._internalCount=0;for(let R=0;R<6;R++)this._partialLoadImg(H[R],R,M,D,h,o,g,j)},R.e.prototype._partialLoadImg=function(D,h,o,H,g,R){let t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7?arguments[7]:void 0;const k=(0,M.d)();(0,j.s)(D,(D=>{o[h]=D,o._internalCount++,H&&H.removePendingData(k),6===o._internalCount&&R&&R(g,o)}),((D,h)=>{H&&H.removePendingData(k),t&&t(D,h)}),H?H.offlineProvider:null,S),H&&H.addPendingData(k)},R.e.prototype.createCubeTextureBase=function(D,h,o,j){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6?arguments[6]:void 0,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,v=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,r=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,B=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,s=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,U=arguments.length>14&&void 0!==arguments[14]&&arguments[14],q=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const c=r||new H.c(this,7);c.isCube=!0,c.url=D,c.generateMipMaps=!j,c._lodGenerationScale=Q,c._lodGenerationOffset=v,c._useSRGBBuffer=!!U&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!j),c!==r&&(c.label=D.substring(0,60)),this._doNotHandleContextLost||(c._extension=k,c._files=o,c._buffer=q);const y=D;this._transformTextureUrl&&!r&&(D=this._transformTextureUrl(D));const b=k??function(D){const h=D.split("?")[0],o=h.lastIndexOf(".");return o>-1?h.substring(o).toLowerCase():""}(D),i=(0,t.d)(b),G=(D,h)=>{c.dispose(),R?R(D,h):D&&g.d.Warn(D)},N=(H,R)=>{D===y?H&&G(H.status+" "+H.statusText,R):(g.d.Warn(`Failed to load ${D}, falling back to the ${y}`),this.createCubeTextureBase(y,h,o,!!j,M,G,S,k,K,Q,v,c,B,s,U,q))};if(i)i.then((H=>{const g=D=>{B&&B(c,D),H.loadCubeData(D,c,K,M,((D,h)=>{G(D,h)}))};q?g(q):o&&6===o.length?H.supportCascades?this._cascadeLoadFiles(h,(D=>g(D.map((D=>new Uint8Array(D))))),o,G):G("Textures type does not support cascades."):this._loadFile(D,(D=>g(new Uint8Array(D))),void 0,void 0,!0,N)}));else{if(!o||0===o.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(h,c,((D,h)=>{s&&s(D,h)}),o,G)}return this._internalTexturesCache.push(c),c}},14957:(D,h,o)=>{"use strict";o(12658);var H=o(12954);o(12771),o(12898),o(12762),o(13002),o(12964);H.d},14360:(D,h,o)=>{"use strict";o.d(h,{b:()=>g});var H=o(12793);class g{constructor(D){this.value=this._toInt(D)}_toInt(D){return 0|D}add(D){return new g(this.value+D.value)}Nh(D){return new g(this.value-D.value)}multiply(D){return new g(Math.imul(this.value,D.value))}divide(D){return new g(this.value/D.value)}getClassName(){return g.ClassName}equals(D){return this.value===D.value}static FromValue(D){return new g(D)}toString(){return this.value.toString()}}g.ClassName="FlowGraphInteger",(0,H.g)("FlowGraphInteger",g)},14366:(D,h,o)=>{"use strict";o.d(h,{e:()=>g,h:()=>j});var H=o(12831);class g{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Eh=D}get m(){return this.Eh}transformVector(D){return this.transformVectorToRef(D,new H.Vector2)}transformVectorToRef(D,h){return h.x=D.x*this.Eh[0]+D.y*this.Eh[1],h.y=D.x*this.Eh[2]+D.y*this.Eh[3],h}Fh(){return this.toArray()}toArray(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let h=0;h<4;h++)D[h]=this.Eh[h];return D}lo(D){for(let h=0;h<4;h++)this.Eh[h]=D[h];return this}multiplyToRef(D,h){const o=D.Eh,H=this.Eh,g=h.Eh;return g[0]=o[0]*H[0]+o[1]*H[2],g[1]=o[0]*H[1]+o[1]*H[3],g[2]=o[2]*H[0]+o[3]*H[2],g[3]=o[2]*H[1]+o[3]*H[3],h}multiply(D){return this.multiplyToRef(D,new g)}divideToRef(D,h){const o=this.Eh,H=D.Eh,g=h.Eh;return g[0]=o[0]/H[0],g[1]=o[1]/H[1],g[2]=o[2]/H[2],g[3]=o[3]/H[3],h}divide(D){return this.divideToRef(D,new g)}addToRef(D,h){const o=this.Eh,H=D.m,g=h.m;return g[0]=o[0]+H[0],g[1]=o[1]+H[1],g[2]=o[2]+H[2],g[3]=o[3]+H[3],h}add(D){return this.addToRef(D,new g)}subtractToRef(D,h){const o=this.Eh,H=D.m,g=h.m;return g[0]=o[0]-H[0],g[1]=o[1]-H[1],g[2]=o[2]-H[2],g[3]=o[3]-H[3],h}Nh(D){return this.subtractToRef(D,new g)}transpose(){const D=this.Eh;return new g([D[0],D[2],D[1],D[3]])}determinant(){const D=this.Eh;return D[0]*D[3]-D[1]*D[2]}inverse(){const D=this.determinant();if(0===D)throw new Error("Matrix is not invertible");const h=this.Eh,o=1/D;return new g([h[3]*o,-h[1]*o,-h[2]*o,h[0]*o])}equals(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=this.Eh,H=D.m;return 0===h?o[0]===H[0]&&o[1]===H[1]&&o[2]===H[2]&&o[3]===H[3]:Math.abs(o[0]-H[0])<h&&Math.abs(o[1]-H[1])<h&&Math.abs(o[2]-H[2])<h&&Math.abs(o[3]-H[3])<h}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Eh.join(", ")})`}}class j{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Eh=D}get m(){return this.Eh}transformVector(D){return this.transformVectorToRef(D,new H.Gh)}transformVectorToRef(D,h){const o=this.Eh;return h.x=D.x*o[0]+D.y*o[1]+D.z*o[2],h.y=D.x*o[3]+D.y*o[4]+D.z*o[5],h.z=D.x*o[6]+D.y*o[7]+D.z*o[8],h}multiplyToRef(D,h){const o=D.Eh,H=this.Eh,g=h.m;return g[0]=o[0]*H[0]+o[1]*H[3]+o[2]*H[6],g[1]=o[0]*H[1]+o[1]*H[4]+o[2]*H[7],g[2]=o[0]*H[2]+o[1]*H[5]+o[2]*H[8],g[3]=o[3]*H[0]+o[4]*H[3]+o[5]*H[6],g[4]=o[3]*H[1]+o[4]*H[4]+o[5]*H[7],g[5]=o[3]*H[2]+o[4]*H[5]+o[5]*H[8],g[6]=o[6]*H[0]+o[7]*H[3]+o[8]*H[6],g[7]=o[6]*H[1]+o[7]*H[4]+o[8]*H[7],g[8]=o[6]*H[2]+o[7]*H[5]+o[8]*H[8],h}multiply(D){return this.multiplyToRef(D,new j)}divideToRef(D,h){const o=this.Eh,H=D.m,g=h.m;return g[0]=o[0]/H[0],g[1]=o[1]/H[1],g[2]=o[2]/H[2],g[3]=o[3]/H[3],g[4]=o[4]/H[4],g[5]=o[5]/H[5],g[6]=o[6]/H[6],g[7]=o[7]/H[7],g[8]=o[8]/H[8],h}divide(D){return this.divideToRef(D,new j)}addToRef(D,h){const o=this.Eh,H=D.m,g=h.m;return g[0]=o[0]+H[0],g[1]=o[1]+H[1],g[2]=o[2]+H[2],g[3]=o[3]+H[3],g[4]=o[4]+H[4],g[5]=o[5]+H[5],g[6]=o[6]+H[6],g[7]=o[7]+H[7],g[8]=o[8]+H[8],h}add(D){return this.addToRef(D,new j)}subtractToRef(D,h){const o=this.Eh,H=D.m,g=h.m;return g[0]=o[0]-H[0],g[1]=o[1]-H[1],g[2]=o[2]-H[2],g[3]=o[3]-H[3],g[4]=o[4]-H[4],g[5]=o[5]-H[5],g[6]=o[6]-H[6],g[7]=o[7]-H[7],g[8]=o[8]-H[8],h}Nh(D){return this.subtractToRef(D,new j)}toArray(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let h=0;h<9;h++)D[h]=this.Eh[h];return D}Fh(){return this.toArray()}lo(D){for(let h=0;h<9;h++)this.Eh[h]=D[h];return this}transpose(){const D=this.Eh;return new j([D[0],D[3],D[6],D[1],D[4],D[7],D[2],D[5],D[8]])}determinant(){const D=this.Eh;return D[0]*(D[4]*D[8]-D[5]*D[7])-D[1]*(D[3]*D[8]-D[5]*D[6])+D[2]*(D[3]*D[7]-D[4]*D[6])}inverse(){const D=this.determinant();if(0===D)throw new Error("Matrix is not invertible");const h=this.Eh,o=1/D;return new j([(h[4]*h[8]-h[5]*h[7])*o,(h[2]*h[7]-h[1]*h[8])*o,(h[1]*h[5]-h[2]*h[4])*o,(h[5]*h[6]-h[3]*h[8])*o,(h[0]*h[8]-h[2]*h[6])*o,(h[2]*h[3]-h[0]*h[5])*o,(h[3]*h[7]-h[4]*h[6])*o,(h[1]*h[6]-h[0]*h[7])*o,(h[0]*h[4]-h[1]*h[3])*o])}equals(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=this.Eh,H=D.m;return 0===h?o[0]===H[0]&&o[1]===H[1]&&o[2]===H[2]&&o[3]===H[3]&&o[4]===H[4]&&o[5]===H[5]&&o[6]===H[6]&&o[7]===H[7]&&o[8]===H[8]:Math.abs(o[0]-H[0])<h&&Math.abs(o[1]-H[1])<h&&Math.abs(o[2]-H[2])<h&&Math.abs(o[3]-H[3])<h&&Math.abs(o[4]-H[4])<h&&Math.abs(o[5]-H[5])<h&&Math.abs(o[6]-H[6])<h&&Math.abs(o[7]-H[7])<h&&Math.abs(o[8]-H[8])<h}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Eh.join(", ")})`}}},14375:(D,h,o)=>{"use strict";var H;function g(D,h,o,H){switch(h){case"Animation":return H?D.animations.find((D=>D.uniqueId===o))??null:D.animations[o]??null;case"AnimationGroup":return H?D.animationGroups.find((D=>D.uniqueId===o))??null:D.animationGroups[o]??null;case"Mesh":return H?D.meshes.find((D=>D.uniqueId===o))??null:D.meshes[o]??null;case"Material":return H?D.materials.find((D=>D.uniqueId===o))??null:D.materials[o]??null;case"jK":return H?D.cameras.find((D=>D.uniqueId===o))??null:D.cameras[o]??null;case"Light":return H?D.lights.find((D=>D.uniqueId===o))??null:D.lights[o]??null;default:return null}}o.d(h,{b:()=>g}),function(D){D.Animation="Animation",D.AnimationGroup="AnimationGroup",D.Mesh="Mesh",D.Material="Material",D.jK="jK",D.Light="Light"}(H||(H={}))},14410:(D,h,o)=>{"use strict";o.d(h,{c:()=>g});var H=o(14415);class g extends H.d{constructor(D,h){if(super(D),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),h)for(const o of h)this._eventsSignalOutputs[o]=this._registerSignalOutput(o+"Event")}_executeOnTick(D){}_startPendingTasks(D){D._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(D),this._resetAfterCanceled(D)),this._preparePendingTasks(D),D._addPendingBlock(this),this.out._activateSignal(D),D._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(D){D._deleteExecutionVariable(this,"_initialized"),D._removePendingBlock(this)}}},14386:(D,h,o)=>{"use strict";o.d(h,{e:()=>S});var H=o(12798),g=o(12793),j=o(14393),M=o(12648),R=o(14354);class t extends j.b{constructor(D,h,o,H){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:H.defaultValue,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(D,h,o),this.richType=H,this._defaultValue=g,this._optional=j,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new M.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(D){this._isDisabled!==D&&(this._isDisabled=D,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(D,h){h._getConnectionValue(this)!==D&&(h._setConnectionValue(this,D),this.onValueChangedObservable.notifyObservers(D))}resetToDefaultValue(D){D._setConnectionValue(this,this._defaultValue)}connectTo(D){this._isDisabled||super.connectTo(D)}_getValueOrDefault(D){const h=D._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(h):h}getValue(D){if(1===this.connectionType){D._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(D);const h=this._getValueOrDefault(D);return this._lastValue=h,this.richType.typeTransformer?this.richType.typeTransformer(h):h}const h=this.isConnected()?this._connectedPoint[0].getValue(D):this._getValueOrDefault(D);return this._lastValue=h,this.richType.typeTransformer?this.richType.typeTransformer(h):h}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(D),D.richType={},this.richType.serialize(D.richType),D.optional=this._optional,(0,R.e)("defaultValue",this._defaultValue,D)}}(0,g.g)("FlowGraphDataConnection",t);class S{constructor(D){var h;this.config=D,this.uniqueId=(0,H.d)(),this.name=(null===(h=this.config)||void 0===h?void 0:h.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(D){}registerDataInput(D,h,o){const H=new t(D,0,this,h,o);return this.dataInputs.push(H),H}registerDataOutput(D,h,o){const H=new t(D,1,this,h,o);return this.dataOutputs.push(H),H}getDataInput(D){return this.dataInputs.find((h=>h.name===D))}getDataOutput(D){return this.dataOutputs.find((h=>h.name===D))}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.e;if(D.uniqueId=this.uniqueId,D.config={},this.config){const o=this.config,H=Object.keys(o);for(const g of H)h(g,o[g],D.config)}D.dataInputs=[],D.dataOutputs=[],D.className=this.getClassName();for(const o of this.dataInputs){const h={};o.serialize(h),D.dataInputs.push(h)}for(const o of this.dataOutputs){const h={};o.serialize(h),D.dataOutputs.push(h)}}deserialize(D){}_log(D,h,o){var H;null===(H=D.logger)||void 0===H||H.addLogItem({action:h,Co:o,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14393:(D,h,o)=>{"use strict";o.d(h,{b:()=>j});var H,g=o(12798);!function(D){D[D.Input=0]="Input",D[D.Output=1]="Output"}(H||(H={}));class j{constructor(D,h,o){this._ownerBlock=o,this._connectedPoint=[],this.uniqueId=(0,g.d)(),this.connectedPointIds=[],this.name=D,this._connectionType=h}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(D){if(this._connectionType===D._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||D._isSingularConnection()&&D._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(D),D._connectedPoint.push(this)}disconnectFrom(D){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=this._connectedPoint.indexOf(D),H=D._connectedPoint.indexOf(this);-1!==o&&-1!==H&&(h&&this._connectedPoint.splice(o,1),D._connectedPoint.splice(H,1))}disconnectFromAll(){for(const D of this._connectedPoint)this.disconnectFrom(D,!1);this._connectedPoint.length=0}dispose(){for(const D of this._connectedPoint)this.disconnectFrom(D)}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.uniqueId=this.uniqueId,D.name=this.name,D._connectionType=this._connectionType,D.connectedPointIds=[],D.className=this.getClassName();for(const h of this._connectedPoint)D.connectedPointIds.push(h.uniqueId)}getClassName(){return"FGConnection"}deserialize(D){this.uniqueId=D.uniqueId,this.name=D.name,this._connectionType=D._connectionType,this.connectedPointIds=D.connectedPointIds}}},14347:(D,h,o)=>{"use strict";o.d(h,{c:()=>c});var H,g=o(12648),j=o(12812),M=o(12815),R=o(12798),t=o(14354),S=o(14375),k=o(12658);!function(D){D.ExecuteBlock="ExecuteBlock",D.ExecuteEvent="ExecuteEvent",D.TriggerConnection="TriggerConnection",D.ContextVariableSet="ContextVariableSet",D.GlobalVariableSet="GlobalVariableSet",D.GlobalVariableDelete="GlobalVariableDelete",D.GlobalVariableGet="GlobalVariableGet",D.AddConnection="AddConnection",D.GetConnectionValue="GetConnectionValue",D.SetConnectionValue="SetConnectionValue",D.ActivateSignal="ActivateSignal",D.ContextVariableGet="ContextVariableGet"}(H||(H={}));class K{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(D){if(D.time||(D.time=Date.now()),this.log.push(D),this.logToConsole){var h;const o=null===(h=D.Co)||void 0===h?void 0:h.value;"object"===typeof o&&o.getClassName?k.d.Log(`[FGLog] ${D.className}:${D.uniqueId.split("-")[0]} ${D.action} - ${JSON.stringify(o.getClassName())}: ${o.toString()}`):k.d.Log(`[FGLog] ${D.className}:${D.uniqueId.split("-")[0]} ${D.action} - ${JSON.stringify(D.Co)}`)}}getItemsOfType(D){return this.log.filter((h=>h.action===D))}}class Q{get enableLogging(){return this._enableLogging}set enableLogging(D){this._enableLogging!==D&&(this._enableLogging=D,this._enableLogging?(this.logger=new K,this.logger.logToConsole=!0):this.logger=null)}constructor(D){this.uniqueId=(0,R.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new g.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=D,this.assetsContext=D.assetsContext??D.Th}hasVariable(D){return D in this._userVariables}setVariable(D,h){var o;this._userVariables[D]=h,null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Co:{name:D,value:h}})}getAsset(D,h){return(0,S.b)(this.assetsContext,D,h)}getVariable(D){var h;return null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Co:{name:D,value:this._userVariables[D]}}),this._userVariables[D]}get userVariables(){return this._userVariables}GD(){return this._configuration.Th}_getUniqueIdPrefixedName(D,h){return`${D.uniqueId}_${h}`}_getGlobalContextVariable(D,h){var o;return null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Co:{name:D,defaultValue:h,possibleValue:this._globalContextVariables[D]}}),this._hasGlobalContextVariable(D)?this._globalContextVariables[D]:h}_setGlobalContextVariable(D,h){var o;null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Co:{name:D,value:h}}),this._globalContextVariables[D]=h}_deleteGlobalContextVariable(D){var h;null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Co:{name:D}}),delete this._globalContextVariables[D]}_hasGlobalContextVariable(D){return D in this._globalContextVariables}_setExecutionVariable(D,h,o){this._executionVariables[this._getUniqueIdPrefixedName(D,h)]=o}_getExecutionVariable(D,h,o){return this._hasExecutionVariable(D,h)?this._executionVariables[this._getUniqueIdPrefixedName(D,h)]:o}_deleteExecutionVariable(D,h){delete this._executionVariables[this._getUniqueIdPrefixedName(D,h)]}_hasExecutionVariable(D,h){return this._getUniqueIdPrefixedName(D,h)in this._executionVariables}_hasConnectionValue(D){return D.uniqueId in this._connectionValues}_setConnectionValue(D,h){var o;this._connectionValues[D.uniqueId]=h,null===(o=this.logger)||void 0===o||o.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Co:{connectionPointId:D.uniqueId,value:h}})}_setConnectionValueByKey(D,h){this._connectionValues[D]=h}_getConnectionValue(D){var h;return null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Co:{connectionPointId:D.uniqueId,value:this._connectionValues[D.uniqueId]}}),this._connectionValues[D.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(D){this._pendingBlocks.includes(D)||(this._pendingBlocks.push(D),this._pendingBlocks.sort(((D,h)=>D.priority-h.priority)))}_removePendingBlock(D){const h=this._pendingBlocks.indexOf(D);-1!==h&&this._pendingBlocks.splice(h,1)}_clearPendingBlocks(){for(const D of this._pendingBlocks)D._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(D){var h;this.onNodeExecutedObservable.notifyObservers(D),null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:D.getClassName(),uniqueId:D.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(D){this._setGlobalContextVariable("timeSinceStart",D.timeSinceStart),this._setGlobalContextVariable("deltaTime",D.deltaTime);for(const o of this._pendingBlocks){var h;null===(h=o._executeOnTick)||void 0===h||h.call(o,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.e;D.uniqueId=this.uniqueId,D._userVariables={};for(const H in this._userVariables)h(H,this._userVariables[H],D._userVariables);D._connectionValues={};for(const H in this._connectionValues)h(H,this._connectionValues[H],D._connectionValues);var o;this.assetsContext!==this.GD()&&(D._assetsContext={meshes:this.assetsContext.meshes.map((D=>D.id)),materials:this.assetsContext.materials.map((D=>D.id)),textures:this.assetsContext.textures.map((D=>D.name)),animations:this.assetsContext.animations.map((D=>D.name)),lights:this.assetsContext.lights.map((D=>D.id)),cameras:this.assetsContext.cameras.map((D=>D.id)),iv:null===(o=this.assetsContext.iv)||void 0===o?void 0:o.map((D=>D.name)),skeletons:this.assetsContext.skeletons.map((D=>D.id)),YQ:this.assetsContext.YQ.map((D=>D.name)),geometries:this.assetsContext.geometries.map((D=>D.id)),multiMaterials:this.assetsContext.multiMaterials.map((D=>D.id)),transformNodes:this.assetsContext.transformNodes.map((D=>D.id))})}getClassName(){return"FlowGraphContext"}}(0,j.c)([(0,M.I)()],Q.prototype,"uniqueId",void 0);var v=o(14377),r=o(13102);class B{constructor(D){this.onEventTriggeredObservable=new g.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=D,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Jh.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const D=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Co:{timeSinceStart:this._startingTime,deltaTime:D}}),this._startingTime+=D})),this._meshPickedObserver=this._scene.onPointerObservable.add((D=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Co:D})}),r.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((D=>{const h=D.pointerId,o=D.mesh,H=this._pointerUnderMeshState[h];!H&&o?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Co:{pointerId:h,mesh:o}}):H&&!o?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Co:{pointerId:h,mesh:H}}):H&&o&&H!==o&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Co:{pointerId:h,mesh:H,over:o}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Co:{pointerId:h,mesh:o,out:H}})),this._pointerUnderMeshState[h]=o}),r.b.POINTERMOVE)}dispose(){var D,h,o,H,g;null===(D=this._sceneDisposeObserver)||void 0===D||D.remove(),null===(h=this._sceneReadyObserver)||void 0===h||h.remove(),null===(o=this._sceneOnBeforeRenderObserver)||void 0===o||o.remove(),null===(H=this._meshPickedObserver)||void 0===H||H.remove(),null===(g=this._meshUnderPointerObserver)||void 0===g||g.remove(),this.onEventTriggeredObservable.clear()}}var s,U=o(14402);!function(D){D[D.Stopped=0]="Stopped",D[D.Started=1]="Started"}(s||(s={}));class q{get state(){return this._state}set state(D){this._state=D,this.onStateChangedObservable.notifyObservers(D)}constructor(D){this.onStateChangedObservable=new g.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=D.Th,this._sceneEventCoordinator=new B(this._scene),this._coordinator=D.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((D=>{for(const h of this._executionContexts){const o=this._getContextualOrder(D.type,h);for(const H of o)if(!H._executeEvent(h,D.Co))break}switch(D.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const h of this._executionContexts)h._notifyOnTick(D.Co);break;case"SceneDispose":this.dispose()}}))}createContext(){const D=new Q({Th:this._scene,coordinator:this._coordinator});return this._executionContexts.push(D),D}getContext(D){return this._executionContexts[D]}addEventBlock(D){if("PointerOver"!==D.type&&"PointerOut"!==D.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==D.type&&this._eventBlocks[D.type].push(D),1===this.state)for(const h of this._executionContexts)D._startPendingTasks(h);else this.onStateChangedObservable.addOnce((h=>{if(1===h)for(const o of this._executionContexts)D._startPendingTasks(o)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((D=>{1===D&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const D of this._executionContexts)for(const h in this._eventBlocks){const o=this._getContextualOrder(h,D);for(const h of o)h._startPendingTasks(D)}}_getContextualOrder(D,h){const o=this._eventBlocks[D].sort(((D,h)=>h.initPriority-D.initPriority));if("MeshPick"===D){const D=[];for(const H of o){const g=H.asset.getValue(h);let j=0;for(;j<o.length;j++){const D=o[j].asset.getValue(h);if(g&&D&&(0,U.p)(g,D))break}D.splice(j,0,H)}return D}return o}dispose(){var D;if(0!==this.state){this.state=0;for(const D of this._executionContexts)D._clearPendingBlocks();this._executionContexts.length=0;for(const D in this._eventBlocks)this._eventBlocks[D].length=0;null===(D=this._eventObserver)||void 0===D||D.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(D){const h=[],o=new Set;for(const H in this._eventBlocks)for(const D of this._eventBlocks[H])h.push(D),o.add(D.uniqueId);for(;h.length>0;){const H=h.pop();D(H);for(const D of H.dataInputs)for(const H of D._connectedPoint)o.has(H._ownerBlock.uniqueId)||(h.push(H._ownerBlock),o.add(H._ownerBlock.uniqueId));if(H instanceof v.e)for(const D of H.signalOutputs)for(const H of D._connectedPoint)o.has(H._ownerBlock.uniqueId)||(h.push(H._ownerBlock),o.add(H._ownerBlock.uniqueId))}}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=arguments.length>1?arguments[1]:void 0;D.allBlocks=[],this.visitAllBlocks((h=>{const o={};h.serialize(o),D.allBlocks.push(o)})),D.executionContexts=[];for(const o of this._executionContexts){const H={};o.serialize(H,h),D.executionContexts.push(H)}}}class c{constructor(D){this.config=D,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Th.Jh.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Th.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const D=this._executeOnNextFrame.slice(0);if(D.length)for(const h of D){this.notifyCustomEvent(h.id,h.data,!1);const D=this._executeOnNextFrame.findIndex((D=>D.uniqueId===h.uniqueId));-1!==D&&this._executeOnNextFrame.splice(D,1)}}));(c.SceneCoordinators.get(this.config.Th)??[]).push(this)}createGraph(){const D=new q({Th:this.config.Th,coordinator:this});return this._flowGraphs.push(D),D}removeGraph(D){const h=this._flowGraphs.indexOf(D);-1!==h&&(D.dispose(),this._flowGraphs.splice(h,1))}start(){for(const D of this._flowGraphs)D.start()}dispose(){var D,h;for(const g of this._flowGraphs)g.dispose();this._flowGraphs.length=0,null===(D=this._disposeObserver)||void 0===D||D.remove(),null===(h=this._onBeforeRenderObserver)||void 0===h||h.remove();const o=c.SceneCoordinators.get(this.config.Th)??[],H=o.indexOf(this);-1!==H&&o.splice(H,1)}serialize(D,h){D._flowGraphs=[];for(const o of this._flowGraphs){const H={};o.serialize(H,h),D._flowGraphs.push(H)}D.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(D){let h=this._customEventsMap.get(D);return h||(h=new g.c,this._customEventsMap.set(D,h)),h}notifyCustomEvent(D,h){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:D,data:h,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(D)){const h=this._eventExecutionCounter.get(D);if(this._eventExecutionCounter.set(D,h+1),h>=c.MaxEventTypeExecutionPerFrame)return void(h===c.MaxEventTypeExecutionPerFrame&&k.d.Warn(`FlowGraphCoordinator: Too many executions of event "${D}".`))}else this._eventExecutionCounter.set(D,1);const o=this._customEventsMap.get(D);o&&o.notifyObservers(h)}}c.MaxEventsPerType=30,c.MaxEventTypeExecutionPerFrame=30,c.SceneCoordinators=new Map},14408:(D,h,o)=>{"use strict";o.d(h,{b:()=>g});var H=o(14410);class g extends H.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(D){D._notifyExecuteNode(this),this.done._activateSignal(D)}}},14377:(D,h,o)=>{"use strict";o.d(h,{e:()=>R});var H=o(14386),g=o(14393),j=o(12793);class M extends g.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(D){super.connectTo(D),this._connectedPoint.sort(((D,h)=>h.priority-D.priority))}_activateSignal(D){var h;if(null===(h=D.logger)||void 0===h||h.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Co:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)D._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(D,this),D._increaseExecutionId();else for(const o of this._connectedPoint)o._activateSignal(D)}}(0,j.g)("FlowGraphSignalConnection",M);class R extends H.e{constructor(D){super(D),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(D){const h=new M(D,0,this);return this.signalInputs.push(h),h}_registerSignalOutput(D){const h=new M(D,1,this);return this.signalOutputs.push(h),h}_unregisterSignalInput(D){const h=this.signalInputs.findIndex((h=>h.name===D));-1!==h&&(this.signalInputs[h].dispose(),this.signalInputs.splice(h,1))}_unregisterSignalOutput(D){const h=this.signalOutputs.findIndex((h=>h.name===D));-1!==h&&(this.signalOutputs[h].dispose(),this.signalOutputs.splice(h,1))}_reportError(D,h){this.error.Co="string"===typeof h?new Error(h):h,this.error._activateSignal(D)}getSignalInput(D){return this.signalInputs.find((h=>h.name===D))}getSignalOutput(D){return this.signalOutputs.find((h=>h.name===D))}serialize(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(D),D.signalInputs=[],D.signalOutputs=[];for(const h of this.signalInputs){const o={};h.serialize(o),D.signalInputs.push(o)}for(const h of this.signalOutputs){const o={};h.serialize(o),D.signalOutputs.push(o)}}deserialize(D){for(let h=0;h<D.signalInputs.length;h++){const o=this.getSignalInput(D.signalInputs[h].name);if(!o)throw new Error("Could not find signal input with name "+D.signalInputs[h].name+" in block "+D.className);o.deserialize(D.signalInputs[h])}for(let h=0;h<D.signalOutputs.length;h++){const o=this.getSignalOutput(D.signalOutputs[h].name);if(!o)throw new Error("Could not find signal output with name "+D.signalOutputs[h].name+" in block "+D.className);o.deserialize(D.signalOutputs[h])}}getClassName(){return"FlowGraphExecutionBlock"}}},14415:(D,h,o)=>{"use strict";o.d(h,{d:()=>g});var H=o(14377);class g extends H.e{constructor(D){super(D),this.out=this._registerSignalOutput("out")}}},14362:(D,h,o)=>{"use strict";o.d(h,{A:()=>O,D:()=>N,F:()=>G,c:()=>S,f:()=>Q,h:()=>i,l:()=>s,m:()=>U,o:()=>q,q:()=>K,r:()=>b,s:()=>k,t:()=>v,w:()=>r,y:()=>B,z:()=>J});var H,g=o(12831),j=o(12870),M=o(14360),R=o(14366);!function(D){D.Any="any",D.String="string",D.Number="number",D.Boolean="boolean",D.Object="object",D.Integer="FlowGraphInteger",D.Vector2="Vector2",D.Gh="Gh",D.Vector4="Vector4",D.Quaternion="Quaternion",D.Matrix="Matrix",D.Matrix2D="Matrix2D",D.Matrix3D="Matrix3D",D.mo="mo",D.yg="yg"}(H||(H={}));class t{constructor(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=D,this.defaultValue=h,this.animationType=o}serialize(D){D.typeName=this.typeName,D.defaultValue=this.defaultValue}}const S=new t("any",void 0),k=new t("string",""),K=new t("number",0,0),Q=new t("boolean",!1),v=new t("Vector2",g.Vector2.Zero(),5),r=new t("Gh",g.Gh.Zero(),1),B=new t("Vector4",g.Vector4.Zero()),s=new t("Matrix",g.Matrix.Identity(),3),U=new t("Matrix2D",new R.e),q=new t("Matrix3D",new R.h),c=new t("mo",j.mo.Black(),4),y=new t("yg",new j.yg(0,0,0,0),7),b=new t("Quaternion",g.Quaternion.Identity(),2);b.typeTransformer=D=>{if(D.getClassName){if("Vector4"===D.getClassName())return g.Quaternion.Ih(D.Fh());if("Gh"===D.getClassName())return g.Quaternion.FromEulerVector(D);if("Matrix"===D.getClassName())return g.Quaternion.FromRotationMatrix(D)}return D};const i=new t("FlowGraphInteger",new M.b(0),0);function G(D){const h=D;switch(typeof D){case"string":return k;case"number":return K;case"boolean":return Q;case"object":if(h.getClassName)switch(h.getClassName()){case"Vector2":return v;case"Gh":return r;case"Vector4":return B;case"Matrix":return s;case"mo":return c;case"yg":return y;case"Quaternion":return b;case"FlowGraphInteger":return i;case"Matrix2D":return U;case"Matrix3D":return q}return S;default:return S}}function N(D){switch(D){case"string":return k;case"number":return K;case"boolean":return Q;case"Vector2":return v;case"Gh":return r;case"Vector4":return B;case"Matrix":return s;case"mo":return c;case"yg":return y;case"Quaternion":return b;case"FlowGraphInteger":return i;case"Matrix2D":return U;case"Matrix3D":return q;default:return S}}function J(D){switch(D){case"number":default:return 0;case"Vector2":return 5;case"Gh":return 1;case"Matrix":return 3;case"mo":return 4;case"yg":return 7;case"Quaternion":return 2}}function O(D){switch(D){case 0:return K;case 5:return v;case 1:return r;case 3:return s;case 4:return c;case 7:return y;case 2:return b;default:return S}}},14354:(D,h,o)=>{"use strict";o.d(h,{d:()=>k,e:()=>S,g:()=>K});var H=o(12870),g=o(12831),j=o(14360),M=o(14362),R=o(14366);function t(D){return"Vector2"===D||"Gh"===D||"Vector4"===D||"Quaternion"===D||"mo"===D||"yg"===D}function S(D,h,o){var H;const g=(null===h||void 0===h||null===(H=h.getClassName)||void 0===H?void 0:H.call(h))??"";if(t(g)||function(D){return"Matrix"===D||"Matrix2D"===D||"Matrix3D"===D}(g))o[D]={value:h.Fh(),className:g};else if("FlowGraphInteger"===g)o[D]={value:h.value,className:g};else if(g&&(h.id||h.name))o[D]={id:h.id,name:h.name,className:g};else{if("object"===typeof h)throw new Error(`Could not serialize value ${h}`);o[D]=h}}function k(D,h,o,S){const K=h[D];let Q;const v=(null===K||void 0===K?void 0:K.type)??(null===K||void 0===K?void 0:K.className);if(function(D){return"Mesh"===D||"AbstractMesh"===D||"GroundMesh"===D||"InstanceMesh"===D||"LinesMesh"===D||"GoldbergMesh"===D||"GreasedLineMesh"===D||"TrailMesh"===D}(v)){let D=S.meshes.filter((D=>K.id?D.id===K.id:D.name===K.name));0===D.length&&(D=S.transformNodes.filter((D=>K.id?D.id===K.id:D.name===K.name))),Q=K.uniqueId?D.find((D=>D.uniqueId===K.uniqueId)):D[0]}else if(t(v))Q=function(D,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===D)return g.Vector2.Ih(h);if("Gh"===D)return o&&(h[2]*=-1),g.Gh.Ih(h);if("Vector4"===D)return g.Vector4.Ih(h);if("Quaternion"===D)return o&&(h[2]*=-1,h[3]*=-1),g.Quaternion.Ih(h);if("mo"===D)return new H.mo(h[0],h[1],h[2]);if("yg"===D)return new H.yg(h[0],h[1],h[2],h[3]);throw new Error(`Unknown vector class name ${D}`)}(v,K.value);else if(function(D){return"AnimationGroup"===D}(v)){const D=S.animationGroups.filter((D=>D.name===K.name));Q=1===D.length?D[0]:D.find((D=>D.uniqueId===K.uniqueId))}else Q="Matrix"===v?g.Matrix.Ih(K.value):"Matrix2D"===v?new R.e(K.value):"Matrix3D"===v?new R.h(K.value):"FlowGraphInteger"===v?j.b.FromValue(K.value):"number"===v||"string"===v||"boolean"===v?K.value[0]:K&&void 0!==K.value?K.value:Array.isArray(K)?K.reduce(((D,h)=>h.eventData?(D[h.id]={type:(0,M.D)(h.type)},"undefined"!==typeof h.value&&(D[h.id].value=k("value",h,o,S)),D):D),{}):K;return Q}function K(D){return"FlowGraphJsonPointerParserBlock"===D}},14402:(D,h,o)=>{"use strict";function H(D,h){return!(!D.parent||D.parent!==h&&!H(D.parent,h))}function g(D){if(D.getClassName)return D.getClassName()}function j(D,h){return D===h&&("Vector2"===D||"Gh"===D||"Vector4"===D||"Quaternion"===D)}function M(D,h){return D===h&&("Matrix"===D||"Matrix2D"===D||"Matrix3D"===D)}function R(D,h){return"FlowGraphInteger"===D&&"FlowGraphInteger"===h}function t(D,h){const o="number"===typeof D||"number"===typeof(null===D||void 0===D?void 0:D.value);return o&&!h?!isNaN(S(D)):o}function S(D){return"number"===typeof D?D:D.value}o.d(h,{b:()=>R,e:()=>M,h:()=>j,l:()=>g,p:()=>H,q:()=>S,s:()=>t})},14724:(D,h,o)=>{"use strict";o.r(h),o.d(h,{SceneInstrumentation:()=>j});var H=o(12642),g=o(13044);class j{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(D){D!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=D,D?(this._onBeforeActiveMeshesEvaluationObserver=this.Th.onBeforeActiveMeshesEvaluationObservable.add((()=>{H.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Th.onAfterActiveMeshesEvaluationObservable.add((()=>{H.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Th.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Th.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(D){D!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=D,D?(this._onBeforeRenderTargetsRenderObserver=this.Th.onBeforeRenderTargetsRenderObservable.add((()=>{H.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Th.onAfterRenderTargetsRenderObservable.add((()=>{H.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Th.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Th.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(D){D!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=D,D?(this._onBeforeParticlesRenderingObserver=this.Th.onBeforeParticlesRenderingObservable.add((()=>{H.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Th.onAfterParticlesRenderingObservable.add((()=>{H.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Th.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Th.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(D){D!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=D,this.Th.spriteManagers&&(D?(this._onBeforeSpritesRenderingObserver=this.Th.onBeforeSpritesRenderingObservable.add((()=>{H.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Th.onAfterSpritesRenderingObservable.add((()=>{H.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Th.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Th.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(D){D!==this._capturePhysicsTime&&this.Th.onBeforePhysicsObservable&&(this._capturePhysicsTime=D,D?(this._onBeforePhysicsObserver=this.Th.onBeforePhysicsObservable.add((()=>{H.Tools.StartPerformanceCounter("Yg"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Th.onAfterPhysicsObservable.add((()=>{H.Tools.EndPerformanceCounter("Yg"),this._physicsTime.endMonitoring()}))):(this.Th.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Th.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(D){D!==this._captureAnimationsTime&&(this._captureAnimationsTime=D,D?this._onAfterAnimationsObserver=this.Th.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Th.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(D){this._captureFrameTime=D}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(D){this._captureInterFrameTime=D}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(D){D!==this._captureRenderTime&&(this._captureRenderTime=D,D?(this._onBeforeDrawPhaseObserver=this.Th.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),H.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Th.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),H.Tools.EndPerformanceCounter("Main render")}))):(this.Th.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Th.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(D){D!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=D,D?(this._onBeforeCameraRenderObserver=this.Th.onBeforeCameraRenderObservable.add((D=>{this._cameraRenderTime.beginMonitoring(),H.Tools.StartPerformanceCounter(`Rendering camera ${D.name}`)})),this._onAfterCameraRenderObserver=this.Th.onAfterCameraRenderObservable.add((D=>{this._cameraRenderTime.endMonitoring(!1),H.Tools.EndPerformanceCounter(`Rendering camera ${D.name}`)}))):(this.Th.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Th.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Th.getEngine()._drawCalls}constructor(D){this.Th=D,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new g.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new g.d,this._captureFrameTime=!1,this._frameTime=new g.d,this._captureRenderTime=!1,this._renderTime=new g.d,this._captureInterFrameTime=!1,this._interFrameTime=new g.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new g.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new g.d,this._capturePhysicsTime=!1,this._physicsTime=new g.d,this._captureAnimationsTime=!1,this._animationsTime=new g.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new g.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=D.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(H.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Th.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=D.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(H.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.ih(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.ih(),this._captureParticlesRenderTime&&this._particlesRenderTime.ih(),this._captureSpritesRenderTime&&this._spritesRenderTime.ih(),this._captureRenderTime&&this._renderTime.ih(),this._captureCameraRenderTime&&this._cameraRenderTime.ih()}))}dispose(){this._disposed||(this.Th.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Th.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Th.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Th.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Th.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Th.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Th.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Th.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Th.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Th.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Th.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Th.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Th.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Th.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Th.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Th.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Th.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Th=null,this._disposed=!0)}}},14345:(D,h,o)=>{"use strict";o.d(h,{c:()=>k});var H=o(12812),g=o(12815),j=o(12831),M=o(13258),R=o(13392),t=o(13439),S=o(12793);M.c.AddNodeConstructor("Light_Type_1",((D,h)=>()=>new k(D,j.Gh.Zero(),h)));class k extends t.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(D){this._shadowFrustumSize=D,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(D){this._shadowOrthoScale=D,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(D){this._orthoLeft=D}get orthoRight(){return this._orthoRight}set orthoRight(D){this._orthoRight=D}get orthoTop(){return this._orthoTop}set orthoTop(D){this._orthoTop=D}get orthoBottom(){return this._orthoBottom}set orthoBottom(D){this._orthoBottom=D}constructor(D,h,o){super(D,o),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=h.scale(-1),this.direction=h}getClassName(){return"lg"}getTypeID(){return R.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(D,h,o){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(D):this._setDefaultAutoExtendShadowProjectionMatrix(D,h,o)}_setDefaultFixedFrustumShadowProjectionMatrix(D){const h=this.GD().activeCamera;h&&j.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:h.Xh,void 0!==this.shadowMaxZ?this.shadowMaxZ:h.maxZ,D,this.GD().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(D,h,o){const H=this.GD().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const D=j.Gh.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let H=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let M=0;M<o.length;M++){const R=o[M];if(!R)continue;const t=R.getBoundingInfo().boundingBox;for(let o=0;o<t.vectorsWorld.length;o++)j.Gh.TransformCoordinatesToRef(t.vectorsWorld[o],h,D),D.x<this._orthoLeft&&(this._orthoLeft=D.x),D.y<this._orthoBottom&&(this._orthoBottom=D.y),D.x>this._orthoRight&&(this._orthoRight=D.x),D.y>this._orthoTop&&(this._orthoTop=D.y),this.autoCalcShadowZBounds&&(D.z<H&&(H=D.z),D.z>g&&(g=D.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=H,this._shadowMaxZ=g)}const g=this._orthoRight-this._orthoLeft,M=this._orthoTop-this._orthoBottom,R=void 0!==this.shadowMinZ?this.shadowMinZ:(null===H||void 0===H?void 0:H.Xh)||0,t=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===H||void 0===H?void 0:H.maxZ)||1e4,S=this.GD().getEngine().Bh;j.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-g*this.shadowOrthoScale,this._orthoRight+g*this.shadowOrthoScale,this._orthoBottom-M*this.shadowOrthoScale,this._orthoTop+M*this.shadowOrthoScale,S?t:R,S?R:t,D,this.GD().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(D,h){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,h),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,h),this)}transferToNodeMaterialEffect(D,h){return this.computeTransformedInformation()?(D.setFloat3(h,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(D.setFloat3(h,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(D){const h=this._scene.getEngine();return!h.Bh&&h.isNDCHalfZRange?0:1}getDepthMaxZ(D){const h=this._scene.getEngine();return h.Bh&&h.isNDCHalfZRange?0:1}prepareLightSpecificDefines(D,h){D["DIRLIGHT"+h]=!0}}(0,H.c)([(0,g.I)()],k.prototype,"shadowFrustumSize",null),(0,H.c)([(0,g.I)()],k.prototype,"shadowOrthoScale",null),(0,H.c)([(0,g.I)()],k.prototype,"autoUpdateExtends",void 0),(0,H.c)([(0,g.I)()],k.prototype,"autoCalcShadowZBounds",void 0),(0,H.c)([(0,g.I)("orthoLeft")],k.prototype,"_orthoLeft",void 0),(0,H.c)([(0,g.I)("orthoRight")],k.prototype,"_orthoRight",void 0),(0,H.c)([(0,g.I)("orthoTop")],k.prototype,"_orthoTop",void 0),(0,H.c)([(0,g.I)("orthoBottom")],k.prototype,"_orthoBottom",void 0),(0,S.g)("BABYLON.DirectionalLight",k)},14883:(D,h,o)=>{"use strict";o.d(h,{b:()=>k});var H=o(12812),g=o(12815),j=o(12831),M=o(12870),R=o(13258),t=o(13392),S=o(12793);R.c.AddNodeConstructor("Light_Type_3",((D,h)=>()=>new k(D,j.Gh.Zero(),h)));class k extends t.c{constructor(D,h,o){super(D,o),this.groundColor=new M.mo(0,0,0),this.direction=h||j.Gh.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Cg"}setDirectionToTarget(D){return this.direction=j.Gh.Normalize(D.Nh(j.Gh.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(D,h){const o=j.Gh.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",o.x,o.y,o.z,0,h),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Jg),h),this}transferToNodeMaterialEffect(D,h){const o=j.Gh.Normalize(this.direction);return D.setFloat3(h,o.x,o.y,o.z),this}xh(){return this._worldMatrix||(this._worldMatrix=j.Matrix.Identity()),this._worldMatrix}getTypeID(){return t.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(D,h){D["HEMILIGHT"+h]=!0}}(0,H.c)([(0,g.j)()],k.prototype,"groundColor",void 0),(0,H.c)([(0,g.H)()],k.prototype,"direction",void 0),(0,S.g)("BABYLON.HemisphericLight",k)},14315:(D,h,o)=>{"use strict";o.d(h,{e:()=>K});var H=o(12812),g=o(12815),j=o(12831),M=o(13258),R=o(13392),t=o(13439),S=o(12807),k=o(12793);M.c.AddNodeConstructor("Light_Type_2",((D,h)=>()=>new K(D,j.Gh.Zero(),j.Gh.Zero(),0,0,h)));class K extends t.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(D){this._iesProfileTexture!==D&&(this._iesProfileTexture=D,this._iesProfileTexture&&K._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(D){this._angle=D,this._cosHalfAngle=Math.cos(.5*D),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(D){this._innerAngle=D,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(D){this._shadowAngleScale=D,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(D){this._projectionTextureLightNear=D,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(D){this._projectionTextureLightFar=D,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(D){this._projectionTextureUpDirection=D,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(D){this._projectionTexture!==D&&(this._projectionTexture=D,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(K._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):K._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(D){return void 0!==D.onGeneratedObservable}static _IsTexture(D){return void 0!==D.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(D){this._projectionTextureProjectionLightMatrix=D,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(D,h,o,H,g,M){super(D,M),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=j.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=j.Gh.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=j.Gh.Zero(),this._projectionTextureViewLightMatrix=j.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=j.Matrix.Zero(),this._projectionTextureScalingMatrix=j.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=h,this.direction=o,this.angle=H,this.exponent=g}getClassName(){return"SpotLight"}getTypeID(){return R.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(D){super._setDirection(D),this._projectionTextureViewLightDirty=!0}_setPosition(D){super._setPosition(D),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(D,h,o){const H=this.GD().activeCamera;if(!H)return;this._shadowAngleScale=this._shadowAngleScale||1;const g=this._shadowAngleScale*this._angle,M=void 0!==this.shadowMinZ?this.shadowMinZ:H.Xh,R=void 0!==this.shadowMaxZ?this.shadowMaxZ:H.maxZ,t=this.GD().getEngine().Bh;j.Matrix.PerspectiveFovLHToRef(g,1,t?R:M,t?M:R,D,!0,this._scene.getEngine().isNDCHalfZRange,void 0,t)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),j.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const D=this.projectionTextureLightFar,h=this.projectionTextureLightNear,o=D/(D-h),H=-o*h,g=1/Math.tan(this._angle/2);j.Matrix.FromValuesToRef(g/1,0,0,0,0,g,0,0,0,0,o,1,0,0,H,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof S.b){const D=this._projectionTexture.uScale/2,h=this._projectionTexture.vScale/2;j.Matrix.FromValuesToRef(D,0,0,0,0,h,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(D,h){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),D.setMatrix("textureProjectionMatrix"+h,this._projectionTextureMatrix),D.setTexture("projectionLightTexture"+h,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&D.setTexture("iesLightTexture"+h,this._iesProfileTexture),this}transferToEffect(D,h){let o;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,h),o=j.Gh.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,h),o=j.Gh.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",o.x,o.y,o.z,this._cosHalfAngle,h),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,h),this}transferToNodeMaterialEffect(D,h){let o;return o=this.computeTransformedInformation()?j.Gh.Normalize(this.transformedDirection):j.Gh.Normalize(this.direction),this.GD().useRightHandedSystem?D.setFloat3(h,-o.x,-o.y,-o.z):D.setFloat3(h,o.x,o.y,o.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(D){const h=this._scene.getEngine(),o=void 0!==this.shadowMinZ?this.shadowMinZ:(null===D||void 0===D?void 0:D.Xh)??0;return h.Bh&&h.isNDCHalfZRange?o:this._scene.getEngine().isNDCHalfZRange?0:o}getDepthMaxZ(D){const h=this._scene.getEngine(),o=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===D||void 0===D?void 0:D.maxZ)??1e4;return h.Bh&&h.isNDCHalfZRange?0:o}prepareLightSpecificDefines(D,h){D["SPOTLIGHT"+h]=!0,D["PROJECTEDLIGHTTEXTURE"+h]=!(!this.projectionTexture||!this.projectionTexture.isReady()),D["IESLIGHTTEXTURE"+h]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,H.c)([(0,g.I)()],K.prototype,"angle",null),(0,H.c)([(0,g.I)()],K.prototype,"innerAngle",null),(0,H.c)([(0,g.I)()],K.prototype,"shadowAngleScale",null),(0,H.c)([(0,g.I)()],K.prototype,"exponent",void 0),(0,H.c)([(0,g.I)()],K.prototype,"projectionTextureLightNear",null),(0,H.c)([(0,g.I)()],K.prototype,"projectionTextureLightFar",null),(0,H.c)([(0,g.I)()],K.prototype,"projectionTextureUpDirection",null),(0,H.c)([(0,g.C)("projectedLightTexture")],K.prototype,"_projectionTexture",void 0),(0,k.g)("BABYLON.SpotLight",K)},14046:(D,h,o)=>{"use strict";o.d(h,{c:()=>M,e:()=>j,h:()=>R});const H={},g={};function j(D,h){H[D]=h}function M(D,h){g[D]=h}function R(D){return g[D]?g[D]:null}},13957:(D,h,o)=>{"use strict";o.d(h,{b:()=>G,c:()=>a});var H,g=o(12642),j=o(12648),M=o(13065),R=o(12683),t=o(12658),S=o(13307),k=o(12691),K=o(12698),Q=o(12798),v=o(12731),r=o(12674);!function(D){D[D.Clean=0]="Clean",D[D.Stop=1]="Stop",D[D.Sync=2]="Sync",D[D.NoSync=3]="NoSync"}(H||(H={}));const B=new j.c,s={};let U=!1;function q(){return s[".babylon"]}function c(D,h){const o=s[D];return o||(t.d.Warn("Unable to find a plugin to load "+D+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),h?q():void 0)}function y(D,h,o){let H="Unable to load from "+(D.rawData?"binary data":D.url);return h?H+=`: ${h}`:o&&(H+=`: ${o}`),H}async function b(D,h,o,H,g,j,M,R,t){var S;const K="data:"===(Q=D.url).substring(0,5)?Q.substring(5):null;var Q;if(D.rawData&&!M)throw"When using ArrayBufferView to load data the file extension must be provided.";const U=K||M?"":function(D){const h=D.indexOf("?");-1!==h&&(D=D.substring(0,h));const o=D.lastIndexOf(".");return D.substring(o,D.length).toLowerCase()}(D.url);let y=M?c(M,!0):K?function(D){for(const h in s){const o=s[h].plugin;if(o.canDirectLoad&&o.canDirectLoad(D))return s[h]}return q()}(D.url):c(U,!1);if(!y&&U){if(D.url&&!D.url.startsWith("blob:")){const h=await async function(D,h){const o=h.method||"GET";return await new Promise(((H,g)=>{const j=new r.e;j.addEventListener("readystatechange",(()=>{if(4==j.readyState)if(200==j.status){const D={};if(h.responseHeaders)for(const o of h.responseHeaders)D[o]=j.getResponseHeader(o)||"";H({response:j.response,headerValues:D})}else g(`Unable to fetch data from ${D}. Error code: ${j.status}`)})),j.open(o,D),j.send()}))}(D.url,{method:"HEAD",responseHeaders:["Content-Type"]}),o=h.headerValues?h.headerValues["Content-Type"]:"";o&&(y=function(D){for(const h in s){const o=s[h];if(o.mimeType===D)return o}}(o))}y||(y=q())}if(!y)throw new Error(`No plugin or fallback for ${M??D.url}`);if(!1===(null===t||void 0===t||null===(S=t[y.plugin.name])||void 0===S?void 0:S.enabled))throw new Error(`The '${y.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(D.rawData&&!y.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(D=>{if(y.plugin.createPlugin){const h=y.plugin.createPlugin(t??{});return h instanceof Promise?(h.then(D).catch((D=>{g("Error instantiating plugin.",D)})),null):(D(h),h)}return D(y.plugin),y.plugin})((t=>{var S;if(!t)throw`The loader plugin corresponding to the '${M}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(B.notifyObservers(t),K&&(t.canDirectLoad&&t.canDirectLoad(D.url)||!(0,k.l)(D.url))){if(t.directLoad){const D=t.directLoad(h,K);D instanceof Promise?D.then((D=>{o(t,D)})).catch((D=>{g("Error in directLoad of _loadData: "+D,D)})):o(t,D)}else o(t,K);return}const Q=y.isBinary,r=(D,H)=>{h.S?g("Scene has been disposed"):o(t,D,H)};let s=null,U=!1;null===(S=t.Jh)||void 0===S||S.add((()=>{U=!0,s&&(s.abort(),s=null),j()}));const q=()=>{if(U)return;const o=(D,h)=>{g(null===D||void 0===D?void 0:D.statusText,h)};if(!t.loadFile&&D.rawData)throw"Plugin does not support loading ArrayBufferView.";s=t.loadFile?t.loadFile(h,D.rawData||D.file||D.url,D.rootUrl,r,H,Q,o,R):h._loadFile(D.file||D.url,r,H,!0,Q,o)},c=h.getEngine();let b=c.enableOfflineSupport;if(b){let o=!1;for(const H of h.disableOfflineSupportExceptionRules)if(H.test(D.url)){o=!0;break}b=!o}b&&v.e.OfflineProviderFactory?h.offlineProvider=v.e.OfflineProviderFactory(D.url,q,c.disableManifestCheck):q()}))}function i(D,h){let o,H,j=null,M=null;if(h)if(h.name)o=`file:${h.name}`,H=h.name,j=h;else if(ArrayBuffer.isView(h))o="",H=(0,Q.d)(),M=h;else if(h.startsWith("data:"))o=h,H="";else if(D){const j=h;if("/"===j.substring(0,1))return g.Tools.Error("Wrong sceneFilename parameter"),null;o=D+j,H=j}else o=h,H=g.Tools.GetFilename(h),D=g.Tools.GetFolderPath(h);else o=D,H=g.Tools.GetFilename(D),D=g.Tools.GetFolderPath(D);return{url:o,rootUrl:D,name:H,file:j,rawData:M}}function G(D){if("string"===typeof D.extensions){const h=D.extensions;s[h.toLowerCase()]={plugin:D,isBinary:!1}}else{const h=D.extensions,o=Object.keys(h);for(const H of o)s[H.toLowerCase()]={plugin:D,isBinary:h[H].isBinary,mimeType:h[H].mimeType}}}async function N(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.d.LastCreatedScene,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!H)return t.d.Error("No scene available to import mesh to"),null;const v=i(h,o);if(!v)return null;const r={};H.addPendingData(r);const B=()=>{H.removePendingData(r)},s=(D,h)=>{const o=y(v,D,h);M?M(H,o,new K.i(o,K.g.SceneLoaderError,h)):t.d.Error(o),B()},U=j?D=>{try{j(D)}catch(h){s("Error in onProgress callback: "+h,h)}}:void 0,q=(D,h,o,j,M,R,t,S)=>{if(H.importedMeshesFiles.push(v.url),g)try{g(D,h,o,j,M,R,t,S)}catch(k){s("Error in onSuccess callback: "+k,k)}H.removePendingData(r)};return await b(v,H,((h,o,g)=>{if(h.rewriteRootURL&&(v.rootUrl=h.rewriteRootURL(v.rootUrl,g)),h.importMesh){const g=[],j=[],M=[];if(!h.importMesh(D,H,o,v.rootUrl,g,j,M,s))return;H.loadingPluginName=h.name,q(g,j,M,[],[],[],[],[])}else{h.importMeshAsync(D,H,o,v.rootUrl,U,v.name).then((D=>{H.loadingPluginName=h.name,q(D.meshes,D.YQ,D.skeletons,D.animationGroups,D.transformNodes,D.geometries,D.lights,D.spriteManagers)})).catch((D=>{s(D.message,D)}))}}),U,s,B,S,k,Q)}async function J(D,h,o,H,g,j,M,R){return await new Promise(((t,S)=>{try{N(D,h,o,H,((D,h,o,H,g,j,M,R)=>{t({meshes:D,YQ:h,skeletons:o,animationGroups:H,transformNodes:g,geometries:j,lights:M,spriteManagers:R})}),g,((D,h,o)=>{S(o||new Error(h))}),j,M,R).catch(S)}catch(K){S(K)}}))}async function O(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.d.LastCreatedEngine,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};o?await L(D,h,new M.b(o),H,j,t,S,k,K):g.Tools.Error("No engine available")}async function E(D,h,o,H,g,j,M){return await new Promise(((R,t)=>{O(D,h,o,(D=>{R(D)}),H,((D,h,o)=>{t(o||new Error(h))}),g,j,M)}))}async function L(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.d.LastCreatedScene,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!o)return t.d.Error("No scene available to append to"),null;const v=i(D,h);if(!v)return null;const r={};o.addPendingData(r);const B=()=>{o.removePendingData(r)};S.d.ShowLoadingScreen&&!U&&(U=!0,o.getEngine().displayLoadingUI(),o.executeWhenReady((()=>{o.getEngine().hideLoadingUI(),U=!1})));const s=(D,h)=>{const H=y(v,D,h);j?j(o,H,new K.i(H,K.g.SceneLoaderError,h)):t.d.Error(H),B()},q=g?D=>{try{g(D)}catch(h){s("Error in onProgress callback",h)}}:void 0,c=()=>{if(H)try{H(o)}catch(D){s("Error in onSuccess callback",D)}o.removePendingData(r)};return await b(v,o,((D,h)=>{if(D.load){if(!D.load(o,h,v.rootUrl,s))return;o.loadingPluginName=D.name,c()}else{D.loadAsync(o,h,v.rootUrl,q,v.name).then((()=>{o.loadingPluginName=D.name,c()})).catch((D=>{s(D.message,D)}))}}),q,s,B,M,k,Q)}async function T(D,h,o,H,g,j,M){return await new Promise(((R,t)=>{try{L(D,h,o,(D=>{R(D)}),H,((D,h,o)=>{t(o||new Error(h))}),g,j,M).catch(t)}catch(K){t(K)}}))}async function Z(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.d.LastCreatedScene,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!o)return t.d.Error("No scene available to load asset container to"),null;const Q=i(D,h);if(!Q)return null;const v={};o.addPendingData(v);const r=()=>{o.removePendingData(v)},B=(D,h)=>{const H=y(Q,D,h);j?j(o,H,new K.i(H,K.g.SceneLoaderError,h)):t.d.Error(H),r()},s=g?D=>{try{g(D)}catch(h){B("Error in onProgress callback",h)}}:void 0,U=D=>{if(H)try{H(D)}catch(h){B("Error in onSuccess callback",h)}o.removePendingData(v)};return await b(Q,o,((D,h)=>{if(D.loadAssetContainer){const H=D.loadAssetContainer(o,h,Q.rootUrl,B);if(!H)return;H.populateRootNodes(),o.loadingPluginName=D.name,U(H)}else if(D.loadAssetContainerAsync){D.loadAssetContainerAsync(o,h,Q.rootUrl,s,Q.name).then((h=>{h.populateRootNodes(),o.loadingPluginName=D.name,U(h)})).catch((D=>{B(D.message,D)}))}else B("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),s,B,r,M,S,k)}async function e(D,h,o,H,g,j,M){return await new Promise(((R,t)=>{try{Z(D,h,o,(D=>{R(D)}),H,((D,h,o)=>{t(o||new Error(h))}),g,j,M).catch(t)}catch(K){t(K)}}))}async function p(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.d.LastCreatedScene,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!o)return void t.d.Error("No scene available to load animations to");if(H){for(const H of o.animatables)H.reset();o.stopAllAnimations();const D=o.animationGroups.slice();for(const o of D)o.dispose();const h=o.getNodes();for(const o of h)o.animations&&(o.animations=[])}else switch(g){case 0:const D=o.animationGroups.slice();for(const h of D)h.dispose();break;case 1:for(const h of o.animationGroups)h.stop();break;case 2:for(const h of o.animationGroups)h.reset(),h.restart();break;case 3:break;default:return void t.d.Error("Unknown animation group loading mode value '"+g+"'")}const r=o.animatables.length;await Z(D,h,o,(D=>{D.mergeAnimationsTo(o,o.animatables.slice(r),j),D.dispose(),o.onAnimationFileImportedObservable.notifyObservers(o),M&&M(o)}),S,k,K,Q,v)}async function mD(D,h,o,H,g,j,M,R,t,S){return await new Promise(((k,Q)=>{try{p(D,h,o,H,g,j,(D=>{k(D)}),M,((D,h,o)=>{Q(o||new Error(h))}),R,t,S).catch(Q)}catch(K){Q(K)}}))}class a{static get ForceFullSceneLoadingForIncremental(){return S.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(D){S.d.ForceFullSceneLoadingForIncremental=D}static get ShowLoadingScreen(){return S.d.ShowLoadingScreen}static set ShowLoadingScreen(D){S.d.ShowLoadingScreen=D}static get loggingLevel(){return S.d.loggingLevel}static set loggingLevel(D){S.d.loggingLevel=D}static get CleanBoneMatrixWeights(){return S.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(D){S.d.CleanBoneMatrixWeights=D}static GetDefaultPlugin(){return q()}static GetPluginForExtension(D){var h;return null===(h=c(D,!0))||void 0===h?void 0:h.plugin}static IsPluginForExtensionAvailable(D){return function(D){return!!s[D]}(D)}static RegisterPlugin(D){G(D)}static ImportMesh(D,h,o,H,g,j,M,t,S){N(D,h,o,H,g,j,M,t,S).catch((D=>null===M||void 0===M?void 0:M(R.d.LastCreatedScene,null===D||void 0===D?void 0:D.message,D)))}static async ImportMeshAsync(D,h,o,H,g,j,M){return await J(D,h,o,H,g,j,M)}static Load(D,h,o,H,g,j,M,t){O(D,h,o,H,g,j,M,t).catch((D=>null===j||void 0===j?void 0:j(R.d.LastCreatedScene,null===D||void 0===D?void 0:D.message,D)))}static async LoadAsync(D,h,o,H,g,j){return await E(D,h,o,H,g,j)}static Append(D,h,o,H,g,j,M,t){L(D,h,o,H,g,j,M,t).catch((D=>null===j||void 0===j?void 0:j(o??R.d.LastCreatedScene,null===D||void 0===D?void 0:D.message,D)))}static async AppendAsync(D,h,o,H,g,j){return await T(D,h,o,H,g,j)}static LoadAssetContainer(D,h,o,H,g,j,M,t){Z(D,h,o,H,g,j,M,t).catch((D=>null===j||void 0===j?void 0:j(o??R.d.LastCreatedScene,null===D||void 0===D?void 0:D.message,D)))}static async LoadAssetContainerAsync(D,h,o,H,g,j){return await e(D,h,o,H,g,j)}static ImportAnimations(D,h,o,H,g,j,M,t,S,k,K){p(D,h,o,H,g,j,M,t,S,k,K).catch((D=>null===S||void 0===S?void 0:S(o??R.d.LastCreatedScene,null===D||void 0===D?void 0:D.message,D)))}static async ImportAnimationsAsync(D,h,o,H,g,j,M,R,t,S,k){return await mD(D,h,o,H,g,j,R,S,k)}}a.NO_LOGGING=0,a.MINIMAL_LOGGING=1,a.SUMMARY_LOGGING=2,a.DETAILED_LOGGING=3,a.OnPluginActivatedObservable=B},14325:(D,h,o)=>{"use strict";o.d(h,{e:()=>Q});var H=o(12812),g=o(12815),j=o(12642),M=o(12831),R=o(12849),t=o(12807),S=o(12793),k=o(12648),K=o(12860);o(14334);class Q extends R.e{set boundingBoxSize(D){if(this._boundingBoxSize&&this._boundingBoxSize.equals(D))return;this._boundingBoxSize=D;const h=this.GD();h&&h.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(D){this._rotationY=D,this.setReflectionTextureMatrix(M.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(D,h,o){let H="";for(const g of D)H+=g;return new Q(H,h,null,o,D)}static CreateFromPrefilteredData(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const g=h.useDelayedTextureLoading;h.useDelayedTextureLoading=!1;const j=new Q(D,h,null,!1,null,null,null,void 0,!0,o,H);return h.useDelayedTextureLoading=g,j}constructor(D,h){var o;let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,Q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],v=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,r=arguments.length>10&&void 0!==arguments[10]&&arguments[10],B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,s=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,U=arguments.length>13?arguments[13]:void 0,q=arguments.length>14?arguments[14]:void 0;super(h),this.onLoadObservable=new k.c,this.boundingBoxPosition=M.Gh.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new M.Matrix,this._buffer=null,this.name=D,this.url=D,this._noMipmap=g,this.Yh=!1,this.isCube=!0,this._textureMatrix=M.Matrix.Identity(),this.coordinatesMode=t.b.CUBIC_MODE;let c=null,y=null;null===H||Array.isArray(H)?(this._noMipmap=g,this._format=K,this._createPolynomials=r,c=H,this._loaderOptions=U,this._useSRGBBuffer=q,this._lodScale=B,this._lodOffset=s):(c=H.extensions??null,this._noMipmap=H.noMipmap??!1,j=H.files??null,y=H.buffer??null,this._format=H.format??5,Q=H.prefiltered??!1,v=H.forcedExtension??null,this._createPolynomials=H.createPolynomials??!1,this._lodScale=H.lodScale??.8,this._lodOffset=H.lodOffset??0,this._loaderOptions=H.loaderOptions,this._useSRGBBuffer=H.useSRGBBuffer,R=H.X??null,S=H.onError??null),(D||j)&&this.updateURL(D,v,R,Q,S,c,null===(o=this.GD())||void 0===o?void 0:o.useDelayedTextureLoading,j,y)}getClassName(){return"CubeTexture"}updateURL(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=D),this.url=D,h&&(this._forcedExtension=h);const S=D.lastIndexOf("."),k=h||(S>-1?D.substring(S).toLowerCase():""),K=0===k.indexOf(".dds"),Q=0===k.indexOf(".env"),v=0===k.indexOf(".basis");if(Q?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=H,H&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),R)this._files=R;else if(v||Q||K||j||(j=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,j){for(let h=0;h<j.length;h++)this._files.push(D+j[h]);this._extensions=j}this._buffer=t,M?(this.delayLoadState=4,this._delayedOnLoad=o,this._delayedOnError=g):this._loadTexture(o,g)}delayLoad(D){4===this.delayLoadState&&(D&&(this._forcedExtension=D),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(D){var h,o;if(D.updateFlag===this._textureMatrix.updateFlag)return;D.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(o=this.GD())||void 0===o||o.markAllMaterialsAsDirty(1,(D=>-1!==D.getActiveTextures().indexOf(this))));if(this._textureMatrix=D,null===(h=this.GD())||void 0===h||!h.useRightHandedSystem)return;const H=M.TmpVectors.Gh[0],g=M.TmpVectors.Quaternion[0],j=M.TmpVectors.Gh[1];this._textureMatrix.decompose(H,g,j),g.z*=-1,g.w*=-1,M.Matrix.ComposeToRef(H,g,j,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var D;return null!==(D=this.GD())&&void 0!==D&&D.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=this.GD(),H=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const g=()=>{var h;(this.onLoadObservable.notifyObservers(this),H)&&(H.dispose(),null===(h=this.GD())||void 0===h||h.markAllMaterialsAsDirty(1));D&&D()},M=(D,o)=>{this._loadingError=!0,this._errorObject={message:D,exception:o},h&&h(D,o),t.b.OnTextureLoadErrorObservable.notifyObservers(this)};var R;this._texture?this._texture.isReady?j.Tools.SetImmediate((()=>g())):this._texture.onLoadedObservable.add((()=>g())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,o,this._lodScale,this._lodOffset,D,M,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,o,this._files,this._noMipmap,D,M,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(R=this._texture)||void 0===R||R.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(D,h,o){const H=K.d.Parse((()=>{let H=!1;return D.prefiltered&&(H=D.prefiltered),new Q(o+(D.url??D.name),h,D.extensions,!1,D.files||null,null,null,void 0,H,D.forcedExtension)}),D,h);if(D.boundingBoxPosition&&(H.boundingBoxPosition=M.Gh.Ih(D.boundingBoxPosition)),D.boundingBoxSize&&(H.boundingBoxSize=M.Gh.Ih(D.boundingBoxSize)),D.animations)for(let g=0;g<D.animations.length;g++){const h=D.animations[g],o=(0,S.d)("BABYLON.Animation");o&&H.animations.push(o.Parse(h))}return H}clone(){let D=0;const h=K.d.Clone((()=>{const h=new Q(this.url,this.GD()||this._getEngine(),this._extensions,this._noMipmap,this._files);return D=h.uniqueId,h}),this);return h.uniqueId=D,h}}(0,H.c)([(0,g.I)()],Q.prototype,"url",void 0),(0,H.c)([(0,g.H)()],Q.prototype,"boundingBoxPosition",void 0),(0,H.c)([(0,g.H)()],Q.prototype,"boundingBoxSize",null),(0,H.c)([(0,g.I)("rotationY")],Q.prototype,"rotationY",null),(0,H.c)([(0,g.I)("files")],Q.prototype,"_files",void 0),(0,H.c)([(0,g.I)("forcedExtension")],Q.prototype,"_forcedExtension",void 0),(0,H.c)([(0,g.I)("extensions")],Q.prototype,"_extensions",void 0),(0,H.c)([(0,g.u)("textureMatrix")],Q.prototype,"_textureMatrix",void 0),(0,H.c)([(0,g.u)("textureMatrixRefraction")],Q.prototype,"_textureMatrixRefraction",void 0),t.b._CubeTextureParser=Q.Parse,(0,S.g)("BABYLON.CubeTexture",Q)},14892:(D,h,o)=>{"use strict";o.d(h,{b:()=>t});var H=o(12658),g=o(12807),j=o(12801),M=o(12962),R=o(12771);M.ThinEngine.prototype.createDynamicTexture=function(D,h,o,H){const g=new R.c(this,4);return g.baseWidth=D,g.baseHeight=h,o&&(D=this.needPOTTextures?(0,j.h)(D,this._caps.maxTextureSize):D,h=this.needPOTTextures?(0,j.h)(h,this._caps.maxTextureSize):h),g.width=D,g.height=h,g.isReady=!1,g.generateMipMaps=o,g.samplingMode=H,this.updateTextureSamplingMode(H,g),this._internalTexturesCache.push(g),g},M.ThinEngine.prototype.updateDynamicTexture=function(D,h,o){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4?arguments[4]:void 0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!D)return;const M=this._gl,R=M.TEXTURE_2D,t=this._bindTextureDirectly(R,D,!0,j);this._unpackFlipY(void 0===o?D.invertY:o),H&&M.pixelStorei(M.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const S=this._getWebGLTextureType(D.type),k=this._getInternalFormat(g||D.format),K=this._getRGBABufferInternalSizedFormat(D.type,k);M.texImage2D(R,0,K,k,S,h),D.generateMipMaps&&M.generateMipmap(R),t||this._bindTextureDirectly(R,null),H&&M.pixelStorei(M.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),g&&(D.format=g),D._dynamicTextureSource=h,D._premulAlpha=H,D.invertY=o||!1,D.isReady=!0};class t extends g.b{constructor(D,h,o){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,R=arguments.length>6?arguments[6]:void 0;const t=!o||o._isScene;super(null,t?o:null===o||void 0===o?void 0:o.Th,t?!H:o,R,j,void 0,void 0,void 0,void 0,M),this.name=D,this.wrapU=g.b.CLAMP_ADDRESSMODE,this.wrapV=g.b.CLAMP_ADDRESSMODE,this._generateMipMaps=H;const S=this._getEngine();if(!S)return;if(h.getContext)this._canvas=h,this._ownCanvas=!1,this._texture=S.createDynamicTexture(this._canvas.width,this._canvas.height,H,j);else{this._canvas=S.createCanvas(1,1),this._ownCanvas=!0;const D=h;D.width||0===D.width?this._texture=S.createDynamicTexture(D.width,D.height,H,j):this._texture=S.createDynamicTexture(h,h,H,j)}const k=this.getSize();this._canvas.width!==k.width&&(this._canvas.width=k.width),this._canvas.height!==k.height&&(this._canvas.height=k.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(D){this._canvas.width=D.width,this._canvas.height=D.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(D.width,D.height,this._generateMipMaps,this.samplingMode)}scale(D){const h=this.getSize();h.width*=D,h.height*=D,this._recreate(h)}scaleTo(D,h){const o=this.getSize();o.width=D,o.height=h,this._recreate(o)}getContext(){return this._context}clear(D){const h=this.getSize();D&&(this._context.fillStyle=D),this._context.clearRect(0,0,h.width,h.height)}update(D){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===D||D,h,this._format||void 0,void 0,o)}drawText(D,h,o,H,g,j,M){let R=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const t=this.getSize();if(j&&(this._context.fillStyle=j,this._context.fillRect(0,0,t.width,t.height)),this._context.font=H,null===h||void 0===h){const o=this._context.measureText(D);h=(t.width-o.width)/2}if(null===o||void 0===o){const D=parseInt(H.replace(/\D/g,""));o=t.height/2+D/3.65}this._context.fillStyle=g||"",this._context.fillText(D,h,o),R&&this.update(M)}dispose(){var D,h;(super.dispose(),this._ownCanvas)&&(null===(D=this._canvas)||void 0===D||null===(h=D.remove)||void 0===h||h.call(D));this._canvas=null,this._context=null}clone(){const D=this.GD();if(!D)return this;const h=this.getSize(),o=new t(this.name,h,D,this._generateMipMaps);return o.Yh=this.Yh,o.level=this.level,o.wrapU=this.wrapU,o.wrapV=this.wrapV,o}serialize(){const D=this.GD();D&&!D.isReady()&&H.d.Warn("The scene must be ready before serializing the dynamic texture");const h=super.serialize();return t._IsCanvasElement(this._canvas)&&(h.base64String=this._canvas.toDataURL()),h.invertY=this._invertY,h.samplingMode=this.samplingMode,h}static _IsCanvasElement(D){return void 0!==D.toDataURL}_rebuild(){this.update()}}},14248:(D,h,o)=>{"use strict";o.d(h,{c:()=>g});var H=o(12807);class g extends H.b{get depth(){return this._depth}constructor(D,h,o,g,j,M){let R=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],t=arguments.length>7&&void 0!==arguments[7]&&arguments[7],S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:H.b.TRILINEAR_SAMPLINGMODE,k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,K=arguments.length>10?arguments[10]:void 0;super(null,M,!R,t),this.format=j,this._texture=M.getEngine().createRawTexture2DArray(D,h,o,g,j,R,t,S,null,k,K),this._depth=g,this.is2DArray=!0}update(D){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,D,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(D,h,o,H,j){return new g(D,h,o,H,5,j,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},14065:(D,h,o)=>{"use strict";o.d(h,{e:()=>R,g:()=>t,k:()=>j,l:()=>M});var H=o(12842),g=o(12831);function j(D,h){return`{X: ${D.x.toFixed(h)} Y: ${D.y.toFixed(h)}}`}function M(D,h){return`{X: ${D._x.toFixed(h)} Y: ${D._y.toFixed(h)} Z: ${D._z.toFixed(h)}}`}function R(D,h){return 2*Math.acos((0,H.Clamp)(g.Quaternion.Dot(D,h)))}function t(D,h){const o=new g.Quaternion;return function(D,h,o){const j=g.Gh.Cross(D,h),M=Math.acos((0,H.Clamp)(g.Gh.Dot(D,h),-1,1));g.Quaternion.RotationAxisToRef(j,M,o)}(D,h,o),o}},13903:(D,h,o)=>{"use strict";o.d(h,{d:()=>S});var H=o(12831),g=o(12870),j=o(13288),M=o(13273),R=o(12877);o(13912);function t(D){let h=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const o=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],j=[];let t=[];const S=D.width||D.size||1,k=D.height||D.size||1,K=D.depth||D.size||1,Q=D.wrap||!1;let v=void 0===D.topBaseAt?1:D.topBaseAt,r=void 0===D.bottomBaseAt?0:D.bottomBaseAt;v=(v+4)%4,r=(r+4)%4;let B=[2,0,3,1][v],s=[2,0,1,3][r],U=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(Q){h=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],U=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let D=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],o=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const H=[17,18,19,16],g=[22,23,20,21];for(;B>0;)D.unshift(D.pop()),H.unshift(H.pop()),B--;for(;s>0;)o.unshift(o.pop()),g.unshift(g.pop()),s--;D=D.flat(),o=o.flat(),U=U.concat(D).concat(o),h.push(H[0],H[2],H[3],H[0],H[1],H[2]),h.push(g[0],g[2],g[3],g[0],g[1],g[2])}const q=[S/2,k/2,K/2];t=U.reduce(((D,h,o)=>D.concat(h*q[o%3])),[]);const c=0===D.sideOrientation?0:D.sideOrientation||M.d.DEFAULTSIDE,y=D.faceUV||new Array(6),b=D.faceColors,i=[];for(let M=0;M<6;M++)void 0===y[M]&&(y[M]=new H.Vector4(0,0,1,1)),b&&void 0===b[M]&&(b[M]=new g.yg(1,1,1,1));for(let H=0;H<6;H++)if(j.push(y[H].z,R.c?1-y[H].w:y[H].w),j.push(y[H].x,R.c?1-y[H].w:y[H].w),j.push(y[H].x,R.c?1-y[H].y:y[H].y),j.push(y[H].z,R.c?1-y[H].y:y[H].y),b)for(let D=0;D<4;D++)i.push(b[H].r,b[H].g,b[H].b,b[H].a);M.d._ComputeSides(c,t,h,o,j,D.frontUVs,D.backUVs);const G=new M.d;if(G.indices=h,G.JD=t,G.OD=o,G.LD=j,b){const D=c===M.d.DOUBLESIDE?i.concat(i):i;G.ED=D}return G}function S(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new j.d(D,o);h.sideOrientation=j.d._GetDefaultSideOrientation(h.sideOrientation),H._originalBuilderSideOrientation=h.sideOrientation;return t(h).ZD(H,h.updatable),H}M.d.CreateBox=t,j.d.CreateBox=function(D,h){return S(D,{size:h,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},14055:(D,h,o)=>{"use strict";o.d(h,{c:()=>R});var H=o(13288),g=o(13273),j=o(12877);function M(D){const h=[],o=[],H=[],M=[],R=D.radius||.5,t=D.tessellation||64,S=D.arc&&(D.arc<=0||D.arc>1)?1:D.arc||1,k=0===D.sideOrientation?0:D.sideOrientation||g.d.DEFAULTSIDE;h.push(0,0,0),M.push(.5,.5);const K=2*Math.PI*S,Q=1===S?K/t:K/(t-1);let v=0;for(let g=0;g<t;g++){const D=Math.cos(v),o=Math.sin(v),H=(D+1)/2,g=(1-o)/2;h.push(R*D,R*o,0),M.push(H,j.c?1-g:g),v+=Q}1===S&&(h.push(h[3],h[4],h[5]),M.push(M[2],j.c?1-M[3]:M[3]));const r=h.length/3;for(let g=1;g<r-1;g++)o.push(g+1,0,g);g.d.ComputeNormals(h,o,H),g.d._ComputeSides(k,h,o,H,M,D.frontUVs,D.backUVs);const B=new g.d;return B.indices=o,B.JD=h,B.OD=H,B.LD=M,B}function R(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new H.d(D,o);h.sideOrientation=H.d._GetDefaultSideOrientation(h.sideOrientation),g._originalBuilderSideOrientation=h.sideOrientation;return M(h).ZD(g,h.updatable),g}g.d.CreateDisc=M,H.d.CreateDisc=function(D,h,o){return R(D,{radius:h,tessellation:o,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13912:(D,h,o)=>{"use strict";o.d(h,{g:()=>s,d:()=>q,h:()=>U});var H=o(12831),g=o(12870),j=o(13288),M=o(13273),R=o(12894);j.d._GroundMeshParser=(D,h)=>t.Parse(D,h);class t extends j.d{constructor(D,h){super(D,h),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=D,this._subdivisionsY=D,this.subdivide(D);const o=this;o.createOrUpdateSubmeshesOctree&&o.createOrUpdateSubmeshesOctree(h)}getHeightAtCoordinates(D,h){const o=this.getWorldMatrix(),g=H.TmpVectors.Matrix[5];o.invertToRef(g);const j=H.TmpVectors.Gh[8];if(H.Gh.TransformCoordinatesFromFloatsToRef(D,0,h,g,j),D=j.x,h=j.z,D<this._minX||D>=this._maxX||h<=this._minZ||h>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const M=this._getFacetAt(D,h),R=-(M.x*D+M.z*h+M.w)/M.y;return H.Gh.TransformCoordinatesFromFloatsToRef(0,R,0,o,j),j.y}getNormalAtCoordinates(D,h){const o=new H.Gh(0,1,0);return this.getNormalAtCoordinatesToRef(D,h,o),o}getNormalAtCoordinatesToRef(D,h,o){const g=this.getWorldMatrix(),j=H.TmpVectors.Matrix[5];g.invertToRef(j);const M=H.TmpVectors.Gh[8];if(H.Gh.TransformCoordinatesFromFloatsToRef(D,0,h,j,M),D=M.x,h=M.z,D<this._minX||D>this._maxX||h<this._minZ||h>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const R=this._getFacetAt(D,h);return H.Gh.TransformNormalFromFloatsToRef(R.x,R.y,R.z,g,o),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(D,h){const o=Math.floor((D+this._maxX)*this._subdivisionsX/this._width),H=Math.floor(-(h+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),g=this._heightQuads[H*this._subdivisionsX+o];let j;return j=h<g.slope.x*D+g.slope.y?g.facet1:g.facet2,j}_initHeightQuads(){const D=this._subdivisionsX,h=this._subdivisionsY;this._heightQuads=[];for(let o=0;o<h;o++)for(let h=0;h<D;h++){const g={slope:H.Vector2.Zero(),facet1:new H.Vector4(0,0,0,0),facet2:new H.Vector4(0,0,0,0)};this._heightQuads[o*D+h]=g}return this}_computeHeightQuads(){const D=this.getVerticesData(R.f.PositionKind);if(!D)return this;const h=H.TmpVectors.Gh[3],o=H.TmpVectors.Gh[2],g=H.TmpVectors.Gh[1],j=H.TmpVectors.Gh[0],M=H.TmpVectors.Gh[4],t=H.TmpVectors.Gh[5],S=H.TmpVectors.Gh[6],k=H.TmpVectors.Gh[7],K=H.TmpVectors.Gh[8];let Q=0,v=0,r=0,B=0,s=0,U=0,q=0;const c=this._subdivisionsX,y=this._subdivisionsY;for(let R=0;R<y;R++)for(let y=0;y<c;y++){Q=3*y,v=R*(c+1)*3,r=(R+1)*(c+1)*3,h.x=D[v+Q],h.y=D[v+Q+1],h.z=D[v+Q+2],o.x=D[v+Q+3],o.y=D[v+Q+4],o.z=D[v+Q+5],g.x=D[r+Q],g.y=D[r+Q+1],g.z=D[r+Q+2],j.x=D[r+Q+3],j.y=D[r+Q+4],j.z=D[r+Q+5],B=(j.z-h.z)/(j.x-h.x),s=h.z-B*h.x,o.subtractToRef(h,M),g.subtractToRef(h,t),j.subtractToRef(h,S),H.Gh.CrossToRef(S,t,k),H.Gh.CrossToRef(M,S,K),k.normalize(),K.normalize(),U=-(k.x*h.x+k.y*h.y+k.z*h.z),q=-(K.x*o.x+K.y*o.y+K.z*o.z);const b=this._heightQuads[R*c+y];b.slope.Qg(B,s),b.facet1.Qg(k.x,k.y,k.z,U),b.facet2.Qg(K.x,K.y,K.z,q)}return this}serialize(D){super.serialize(D),D.subdivisionsX=this._subdivisionsX,D.subdivisionsY=this._subdivisionsY,D.minX=this._minX,D.maxX=this._maxX,D.Xh=this._minZ,D.maxZ=this._maxZ,D.width=this._width,D.height=this._height}static Parse(D,h){const o=new t(D.name,h);return o._subdivisionsX=D.subdivisionsX||1,o._subdivisionsY=D.subdivisionsY||1,o._minX=D.minX,o._maxX=D.maxX,o._minZ=D.Xh,o._maxZ=D.maxZ,o._width=D.width,o._height=D.height,o}}var S=o(12642),k=o(12683),K=o(12833),Q=o(12877);function v(D){const h=[],o=[],g=[],j=[];let R,t;const S=D.width||D.size||1,k=D.height||D.size||1,K=0|(D.subdivisionsX||D.subdivisions||1),v=0|(D.subdivisionsY||D.subdivisions||1);for(R=0;R<=v;R++)for(t=0;t<=K;t++){const D=new H.Gh(t*S/K-S/2,0,(v-R)*k/v-k/2),h=new H.Gh(0,1,0);o.push(D.x,D.y,D.z),g.push(h.x,h.y,h.z),j.push(t/K,Q.c?R/v:1-R/v)}for(R=0;R<v;R++)for(t=0;t<K;t++)h.push(t+1+(R+1)*(K+1)),h.push(t+1+R*(K+1)),h.push(t+R*(K+1)),h.push(t+(R+1)*(K+1)),h.push(t+1+(R+1)*(K+1)),h.push(t+R*(K+1));const r=new M.d;return r.indices=h,r.JD=o,r.OD=g,r.LD=j,r}function r(D){const h=void 0!==D.xmin&&null!==D.xmin?D.xmin:-1,o=void 0!==D.zmin&&null!==D.zmin?D.zmin:-1,g=void 0!==D.xmax&&null!==D.xmax?D.xmax:1,j=void 0!==D.zmax&&null!==D.zmax?D.zmax:1,R=D.subdivisions||{w:1,h:1},t=D.precision||{w:1,h:1},S=[],k=[],K=[],Q=[];let v,r,B,s;R.h=R.h<1?1:R.h,R.w=R.w<1?1:R.w,t.w=t.w<1?1:t.w,t.h=t.h<1?1:t.h;const U=(g-h)/R.w,q=(j-o)/R.h;function c(D,h,o,g){const j=k.length/3,M=t.w+1;for(v=0;v<t.h;v++)for(r=0;r<t.w;r++){const D=[j+r+v*M,j+(r+1)+v*M,j+(r+1)+(v+1)*M,j+r+(v+1)*M];S.push(D[1]),S.push(D[2]),S.push(D[3]),S.push(D[0]),S.push(D[1]),S.push(D[3])}const R=H.Gh.Zero(),B=new H.Gh(0,1,0);for(v=0;v<=t.h;v++)for(R.z=v*(g-h)/t.h+h,r=0;r<=t.w;r++)R.x=r*(o-D)/t.w+D,R.y=0,k.push(R.x,R.y,R.z),K.push(B.x,B.y,B.z),Q.push(r/t.w,v/t.h)}for(B=0;B<R.h;B++)for(s=0;s<R.w;s++)c(h+s*U,o+B*q,h+(s+1)*U,o+(B+1)*q);const y=new M.d;return y.indices=S,y.JD=k,y.OD=K,y.LD=Q,y}function B(D){const h=[],o=[],j=[],R=[];let t,S;const k=D.colorFilter||new g.mo(.3,.59,.11),Q=D.alphaFilter||0;let v=!1;if(D.minHeight>D.maxHeight){v=!0;const h=D.maxHeight;D.maxHeight=D.minHeight,D.minHeight=h}for(t=0;t<=D.subdivisions;t++)for(S=0;S<=D.subdivisions;S++){const h=new H.Gh(S*D.width/D.subdivisions-D.width/2,0,(D.subdivisions-t)*D.height/D.subdivisions-D.height/2),g=4*(((h.x+D.width/2)/D.width*(D.bufferWidth-1)|0)+((1-(h.z+D.height/2)/D.height)*(D.bufferHeight-1)|0)*D.bufferWidth);let M=D.buffer[g]/255,r=D.buffer[g+1]/255,B=D.buffer[g+2]/255;const s=D.buffer[g+3]/255;v&&(M=1-M,r=1-r,B=1-B);const U=M*k.r+r*k.g+B*k.b;h.y=s>=Q?D.minHeight+(D.maxHeight-D.minHeight)*U:D.minHeight-K.d,D.heightBuffer&&(D.heightBuffer[t*(D.subdivisions+1)+S]=h.y),o.push(h.x,h.y,h.z),j.push(0,0,0),R.push(S/D.subdivisions,1-t/D.subdivisions)}for(t=0;t<D.subdivisions;t++)for(S=0;S<D.subdivisions;S++){const H=S+1+(t+1)*(D.subdivisions+1),g=S+1+t*(D.subdivisions+1),j=S+t*(D.subdivisions+1),M=S+(t+1)*(D.subdivisions+1),R=o[3*H+1]>=D.minHeight,k=o[3*g+1]>=D.minHeight,K=o[3*j+1]>=D.minHeight;R&&k&&K&&(h.push(H),h.push(g),h.push(j));o[3*M+1]>=D.minHeight&&R&&K&&(h.push(M),h.push(H),h.push(j))}M.d.ComputeNormals(o,h,j);const r=new M.d;return r.indices=h,r.JD=o,r.OD=j,r.LD=R,r}function s(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=new t(D,arguments.length>2?arguments[2]:void 0);o._setReady(!1),o._subdivisionsX=h.subdivisionsX||h.subdivisions||1,o._subdivisionsY=h.subdivisionsY||h.subdivisions||1,o._width=h.width||1,o._height=h.height||1,o._maxX=o._width/2,o._maxZ=o._height/2,o._minX=-o._maxX,o._minZ=-o._maxZ;return v(h).ZD(o,h.updatable),o._setReady(!0),o}function U(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new j.d(D,o);return r(h).ZD(H,h.updatable),H}function q(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const j=o.width||10,M=o.height||10,R=o.subdivisions||1,K=o.minHeight||0,Q=o.maxHeight||1,v=o.colorFilter||new g.mo(.3,.59,.11),r=o.alphaFilter||0,s=o.updatable,U=o.onReady;H=H||k.d.LastCreatedScene;const q=new t(D,H);let c;q._subdivisionsX=R,q._subdivisionsY=R,q._width=j,q._height=M,q._maxX=q._width/2,q._maxZ=q._height/2,q._minX=-q._maxX,q._minZ=-q._maxZ,q._setReady(!1),o.passHeightBufferInCallback&&(c=new Float32Array((R+1)*(R+1)));const y=(D,h,o)=>{B({width:j,height:M,subdivisions:R,minHeight:K,maxHeight:Q,colorFilter:v,buffer:D,bufferWidth:h,bufferHeight:o,alphaFilter:r,heightBuffer:c}).ZD(q,s),U&&U(q,c),q._setReady(!0)};if("string"===typeof h){const D=D=>{var h;const o=D.width,g=D.height;if(H.S)return;const j=null===(h=H)||void 0===h?void 0:h.getEngine().resizeImageBitmap(D,o,g);y(j,o,g)};S.Tools.LoadImage(h,D,o.onError?o.onError:()=>{},H.offlineProvider)}else y(h.data,h.width,h.height);return q}M.d.CreateGround=v,M.d.CreateTiledGround=r,M.d.CreateGroundFromHeightMap=B,j.d.CreateGround=(D,h,o,H,g,j)=>s(D,{width:h,height:o,subdivisions:H,updatable:j},g),j.d.CreateTiledGround=(D,h,o,H,g,j,M,R,t)=>U(D,{xmin:h,zmin:o,xmax:H,zmax:g,subdivisions:j,precision:M,updatable:t},R),j.d.CreateGroundFromHeightMap=(D,h,o,H,g,j,M,R,t,S,k)=>q(D,h,{width:o,height:H,subdivisions:g,minHeight:j,maxHeight:M,updatable:t,onReady:S,alphaFilter:k},R)},14483:(D,h,o)=>{"use strict";o.d(h,{b:()=>v,c:()=>K,d:()=>Q});var H=o(12831),g=o(13288),j=o(13273),M=o(13396),R=o(12894),t=o(12658);function S(D){const h=[],o=[],H=D.lines,g=D.ED,M=[];let R=0;for(let j=0;j<H.length;j++){const D=H[j];for(let H=0;H<D.length;H++){const{x:t,y:S,z:k}=D[H];if(o.push(t,S,k),g){const D=g[j],{r:h,g:o,b:R,a:t}=D[H];M.push(h,o,R,t)}H>0&&(h.push(R-1),h.push(R)),R++}}const t=new j.d;return t.indices=h,t.JD=o,g&&(t.ED=M),t}function k(D){const h=D.dashSize||3,o=D.gapSize||1,g=D.dashNb||200,M=D.points,R=[],t=[],S=H.Gh.Zero();let k=0,K=0,Q=0,v=0,r=0,B=0,s=0;for(s=0;s<M.length-1;s++)M[s+1].subtractToRef(M[s],S),k+=S.length();for(Q=k/g,v=h*Q/(h+o),s=0;s<M.length-1;s++){M[s+1].subtractToRef(M[s],S),K=Math.floor(S.length()/Q),S.normalize();for(let D=0;D<K;D++)r=Q*D,R.push(M[s].x+r*S.x,M[s].y+r*S.y,M[s].z+r*S.z),R.push(M[s].x+(r+v)*S.x,M[s].y+(r+v)*S.y,M[s].z+(r+v)*S.z),t.push(B,B+1),B+=2}const U=new j.d;return U.JD=R,U.indices=t,U}function K(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=h.instance,g=h.lines,j=h.ED;if(H){const D=H.getVerticesData(R.f.PositionKind);let h,o;j&&(h=H.getVerticesData(R.f.ColorKind));let M=0,t=0;for(let H=0;H<g.length;H++){const R=g[H];for(let g=0;g<R.length;g++)D[M]=R[g].x,D[M+1]=R[g].y,D[M+2]=R[g].z,j&&h&&(o=j[H],h[t]=o[g].r,h[t+1]=o[g].g,h[t+2]=o[g].b,h[t+3]=o[g].a,t+=4),M+=3}return H.updateVerticesData(R.f.PositionKind,D,!1,!1),j&&h&&H.updateVerticesData(R.f.ColorKind,h,!1,!1),H.refreshBoundingInfo(),H}const t=!!j,k=new M.c(D,o,null,void 0,void 0,t,h.useVertexAlpha,h.material);return S(h).ZD(k,h.updatable),k}function Q(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=h.ED?[h.ED]:null;return K(D,{lines:[h.points],updatable:h.updatable,instance:h.instance,ED:H,useVertexAlpha:h.useVertexAlpha,material:h.material},o)}function v(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=h.points,R=h.instance,S=h.gapSize||1,K=h.dashSize||3;if(R){const D=D=>{const h=H.Gh.Zero(),o=D.length/6;let g=0,M=0,t=0,S=0,k=0,K=0,Q=0,v=0;for(Q=0;Q<j.length-1;Q++)j[Q+1].subtractToRef(j[Q],h),g+=h.length();t=g/o;const r=R._creationDataStorage.dashSize;for(S=r*t/(r+R._creationDataStorage.gapSize),Q=0;Q<j.length-1;Q++)for(j[Q+1].subtractToRef(j[Q],h),M=Math.floor(h.length()/t),h.normalize(),v=0;v<M&&K<D.length;)k=t*v,D[K]=j[Q].x+k*h.x,D[K+1]=j[Q].y+k*h.y,D[K+2]=j[Q].z+k*h.z,D[K+3]=j[Q].x+(k+S)*h.x,D[K+4]=j[Q].y+(k+S)*h.y,D[K+5]=j[Q].z+(k+S)*h.z,K+=6,v++;for(;K<D.length;)D[K]=j[Q].x,D[K+1]=j[Q].y,D[K+2]=j[Q].z,K+=3};return(h.dashNb||h.dashSize||h.gapSize||h.useVertexAlpha||h.material)&&t.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),R.updateMeshPositions(D,!1),R}const Q=new M.c(D,o,null,void 0,void 0,void 0,h.useVertexAlpha,h.material);return k(h).ZD(Q,h.updatable),Q._creationDataStorage=new g.e,Q._creationDataStorage.dashSize=K,Q._creationDataStorage.gapSize=S,Q}j.d.CreateLineSystem=S,j.d.CreateDashedLines=k,g.d.kk=function(D,h){return Q(D,{points:h,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},g.d.CreateDashedLines=function(D,h,o,H,g){return v(D,{points:h,dashSize:o,gapSize:H,dashNb:g,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13961:(D,h,o)=>{"use strict";o.d(h,{b:()=>R,e:()=>t});var H=o(13288),g=o(13273),j=o(12877);function M(D){const h=[],o=[],H=[],M=[],R=void 0!==D.width?D.width:void 0!==D.size?D.size:1,t=void 0!==D.height?D.height:void 0!==D.size?D.size:1,S=0===D.sideOrientation?0:D.sideOrientation||g.d.DEFAULTSIDE,k=R/2,K=t/2;o.push(-k,-K,0),H.push(0,0,-1),M.push(0,j.c?1:0),o.push(k,-K,0),H.push(0,0,-1),M.push(1,j.c?1:0),o.push(k,K,0),H.push(0,0,-1),M.push(1,j.c?0:1),o.push(-k,K,0),H.push(0,0,-1),M.push(0,j.c?0:1),h.push(0),h.push(1),h.push(2),h.push(0),h.push(2),h.push(3),g.d._ComputeSides(S,o,h,H,M,D.frontUVs,D.backUVs);const Q=new g.d;return Q.indices=h,Q.JD=o,Q.OD=H,Q.LD=M,Q}function R(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new H.d(D,o);h.sideOrientation=H.d._GetDefaultSideOrientation(h.sideOrientation),g._originalBuilderSideOrientation=h.sideOrientation;return M(h).ZD(g,h.updatable),h.sourcePlane&&(g.translate(h.sourcePlane.normal,-h.sourcePlane.d),g.setDirection(h.sourcePlane.normal.scale(-1))),g}const t={vk:R};g.d.vk=M,H.d.vk=(D,h,o,H,g)=>R(D,{size:h,width:h,height:h,sideOrientation:g,updatable:H},o)},14044:(D,h,o)=>{"use strict";o.d(h,{b:()=>t});var H=o(12831),g=o(13288),j=o(13273),M=o(12877);function R(D){const h=0|(D.segments||32),o=D.diameterX||D.diameter||1,g=D.diameterY||D.diameter||1,R=D.diameterZ||D.diameter||1,t=D.arc&&(D.arc<=0||D.arc>1)?1:D.arc||1,S=D.slice&&D.slice<=0?1:D.slice||1,k=0===D.sideOrientation?0:D.sideOrientation||j.d.DEFAULTSIDE,K=!!D.dedupTopBottomIndices,Q=new H.Gh(o/2,g/2,R/2),v=2+h,r=2*v,B=[],s=[],U=[],q=[];for(let j=0;j<=v;j++){const D=j/v,h=D*Math.PI*S;for(let o=0;o<=r;o++){const g=o/r,j=g*Math.PI*2*t,R=H.Matrix.RotationZ(-h),S=H.Matrix.RotationY(j),k=H.Gh.TransformCoordinates(H.Gh.Up(),R),K=H.Gh.TransformCoordinates(k,S),v=K.multiply(Q),B=K.divide(Q).normalize();s.push(v.x,v.y,v.z),U.push(B.x,B.y,B.z),q.push(g,M.c?1-D:D)}if(j>0){const D=s.length/3;for(let h=D-2*(r+1);h+r+2<D;h++)K?(j>1&&(B.push(h),B.push(h+1),B.push(h+r+1)),(j<v||S<1)&&(B.push(h+r+1),B.push(h+1),B.push(h+r+2))):(B.push(h),B.push(h+1),B.push(h+r+1),B.push(h+r+1),B.push(h+1),B.push(h+r+2))}}j.d._ComputeSides(k,s,B,U,q,D.frontUVs,D.backUVs);const c=new j.d;return c.indices=B,c.JD=s,c.OD=U,c.LD=q,c}function t(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new g.d(D,o);h.sideOrientation=g.d._GetDefaultSideOrientation(h.sideOrientation),H._originalBuilderSideOrientation=h.sideOrientation;return R(h).ZD(H,h.updatable),H}j.d.CreateSphere=R,g.d.CreateSphere=(D,h,o,H,g,j)=>t(D,{segments:h,diameterX:o,diameterY:o,diameterZ:o,sideOrientation:j,updatable:g},H)},14908:(D,h,o)=>{"use strict";o.d(h,{c:()=>R});var H=o(13409),g=o(14339),j=o(13426),M=o(13273);class R{static get Configuration(){return{get decoder(){return g.e.DefaultConfiguration},set decoder(D){g.e.DefaultConfiguration=D}}}static set Configuration(D){g.e.DefaultConfiguration=D.decoder}static get DecoderAvailable(){return(0,H.i)(g.e.DefaultConfiguration)}static get Default(){return R._Default??(R._Default=new R),R._Default}static ResetDefault(D){R._Default&&(D||R._Default.dispose(),R._Default=null)}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.DefaultNumWorkers;const h="number"===typeof D?{...g.e.DefaultConfiguration,numWorkers:D}:{...g.e.DefaultConfiguration,...D};this._decoder=new g.e(h)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(D,h,o){return this._decoder.decodeMeshToMeshDataAsync(D,h,o)}async decodeMeshToGeometryAsync(D,h,o,H){return await this._decoder.decodeMeshToGeometryAsync(D,h,o,H)}async _decodeMeshToGeometryForGltfAsync(D,h,o,H,g,j){return await this._decoder._decodeMeshToGeometryForGltfAsync(D,h,o,H,g,j)}async decodeMeshAsync(D,h){const o=await this._decoder.decodeMeshToMeshDataAsync(D,h),H=new M.d;o.indices&&(H.indices=o.indices);for(const g of o.attributes){const D=j.e.GetFloatData(g.data,g.size,j.e.GetDataType(g.data),g.byteOffset,g.byteStride,g.normalized,o.totalVertices);H.set(D,g.kind)}return H}}R.DefaultNumWorkers=(0,H.e)(),R._Default=null},14339:(D,h,o)=>{"use strict";o.d(h,{e:()=>S});var H=o(13409),g=o(12642),j=o(13299),M=o(13426),R=o(12658),t=o(13423);class S extends H.d{static get DefaultAvailable(){return(0,H.i)(S.DefaultConfiguration)}static get Default(){return S._Default??(S._Default=new S),S._Default}static ResetDefault(D){S._Default&&(D||S._Default.dispose(),S._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(D,h){return{module:await(h||DracoDecoderModule)({wasmBinary:D})}}_getWorkerContent(){return`${t.d}(${t.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.DefaultConfiguration)}decodeMeshToMeshDataAsync(D,h,o){const H=D instanceof ArrayBuffer?new Int8Array(D):new Int8Array(D.buffer,D.byteOffset,D.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async D=>await new Promise(((g,j)=>{D.push(((D,M)=>{let t=null;const S=[],k=h=>{D.removeEventListener("error",k),D.removeEventListener("message",K),j(h),M()},K=h=>{const H=h.data;switch(H.id){case"indices":t=H.data;break;case"attribute":S.push({kind:H.kind,data:H.data,size:H.size,byteOffset:H.byteOffset,byteStride:H.byteStride,normalized:(j=H.kind,Q=H.normalized,o&&void 0!==o[j]?(Q!==o[j]&&R.d.Warn(`Normalized flag from Draco data (${Q}) does not match normalized flag from glTF accessor (${o[j]}). Using flag from glTF accessor.`),o[j]):Q)});break;case"decodeMeshDone":D.removeEventListener("error",k),D.removeEventListener("message",K),g({indices:t,attributes:S,totalVertices:H.totalVertices}),M()}var j,Q};D.addEventListener("error",k),D.addEventListener("message",K);const Q=H.slice();D.postMessage({id:"decodeMesh",dataView:Q,attributes:h},[Q.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((D=>{let o=null;const g=[],j=(0,t.d)(D.module,H,h,(D=>{o=D}),((D,h,o,H,j,M)=>{g.push({kind:D,data:h,size:o,byteOffset:H,byteStride:j,normalized:M})}));return{indices:o,attributes:g,totalVertices:j}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(D,h,o,H){const g=await this.decodeMeshToMeshDataAsync(o,H),R=new j.d(D,h);g.indices&&R.setIndices(g.indices);for(const j of g.attributes)R.setVerticesBuffer(new M.e(h.getEngine(),j.data,j.kind,!1,void 0,j.byteStride,void 0,j.byteOffset,j.size,void 0,j.normalized,!0),g.totalVertices);return R}async _decodeMeshToGeometryForGltfAsync(D,h,o,H,g,R){const t=await this.decodeMeshToMeshDataAsync(o,H,g),S=new j.d(D,h);R&&(S._boundingInfo=R,S.useBoundingInfoFromGeometry=!0),t.indices&&S.setIndices(t.indices);for(const j of t.attributes)S.setVerticesBuffer(new M.e(h.getEngine(),j.data,j.kind,!1,void 0,j.byteStride,void 0,j.byteOffset,j.size,void 0,j.normalized,!0),t.totalVertices);return S}}S.DefaultConfiguration={wasmUrl:`${g.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${g.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${g.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},S._Default=null},14477:(D,h,o)=>{"use strict";o.d(h,{c:()=>RD});var H=o(12831),g=o(13288),j=o(12894),M=o(13273),R=o(12877);function t(D){let h=D.pathArray;const o=D.closeArray||!1,H=D.closePath||!1,g=D.invertUV||!1,t=Math.floor(h[0].length/2);let S=D.offset||t;S=S>t?t:Math.floor(S);const k=0===D.sideOrientation?0:D.sideOrientation||M.d.DEFAULTSIDE,K=D.LD,Q=D.ED,v=[],r=[],B=[],s=[],U=[],q=[],c=[],y=[];let b;const i=[],G=[];let N,J,O;if(h.length<2){const D=[],o=[];for(J=0;J<h[0].length-S;J++)D.push(h[0][J]),o.push(h[0][J+S]);h=[D,o]}let E=0;const L=H?1:0,T=o?1:0;let Z,e,p,mD,a,u;for(b=h[0].length,N=0;N<h.length+T;N++){for(c[N]=0,U[N]=[0],Z=N===h.length?h[0]:h[N],e=Z.length,b=b<e?b:e,O=0;O<e;)v.push(Z[O].x,Z[O].y,Z[O].z),O>0&&(p=Z[O].Nh(Z[O-1]).length(),mD=p+c[N],U[N].push(mD),c[N]=mD),O++;H&&(O--,v.push(Z[0].x,Z[0].y,Z[0].z),p=Z[O].Nh(Z[0]).length(),mD=p+c[N],U[N].push(mD),c[N]=mD),i[N]=e+L,G[N]=E,E+=e+L}let I,P,n=null,F=null;for(J=0;J<b+L;J++)for(y[J]=0,q[J]=[0],N=0;N<h.length-1+T;N++)a=h[N],u=N===h.length-1?h[0]:h[N+1],J===b?(n=a[0],F=u[0]):(n=a[J],F=u[J]),p=F.Nh(n).length(),mD=p+y[J],q[J].push(mD),y[J]=mD;if(K)for(N=0;N<K.length;N++)s.push(K[N].x,R.c?1-K[N].y:K[N].y);else for(N=0;N<h.length+T;N++)for(J=0;J<b+L;J++)I=0!=c[N]?U[N][J]/c[N]:0,P=0!=y[J]?q[J][N]/y[J]:0,g?s.push(P,I):s.push(I,R.c?1-P:P);N=0;let w=0,Y=i[N]-1,l=i[N+1]-1,C=Y<l?Y:l,z=G[1]-G[0];const f=i.length-1;for(;w<=C&&N<f;)r.push(w,w+z,w+1),r.push(w+z+1,w+1,w+z),w+=1,w===C&&(N++,z=G[N+1]-G[N],Y=i[N]-1,l=i[N+1]-1,w=G[N],C=Y<l?Y+w:l+w);if(M.d.ComputeNormals(v,r,B),H){let D=0,o=0;for(N=0;N<h.length;N++){D=3*G[N],o=N+1<h.length?3*(G[N+1]-1):B.length-3,B[D]=.5*(B[D]+B[o]),B[D+1]=.5*(B[D+1]+B[o+1]),B[D+2]=.5*(B[D+2]+B[o+2]);const H=Math.sqrt(B[D]*B[D]+B[D+1]*B[D+1]+B[D+2]*B[D+2]);B[D]/=H,B[D+1]/=H,B[D+2]/=H,B[o]=B[D],B[o+1]=B[D+1],B[o+2]=B[D+2]}}if(o){let D=3*G[0],o=3*G[h.length];for(J=0;J<b+L;J++){B[D]=.5*(B[D]+B[o]),B[D+1]=.5*(B[D+1]+B[o+1]),B[D+2]=.5*(B[D+2]+B[o+2]);const h=Math.sqrt(B[D]*B[D]+B[D+1]*B[D+1]+B[D+2]*B[D+2]);B[D]/=h,B[D+1]/=h,B[D+2]/=h,B[o]=B[D],B[o+1]=B[D+1],B[o+2]=B[D+2],D+=3,o+=3}}M.d._ComputeSides(k,v,r,B,s,D.frontUVs,D.backUVs);let V=null;if(Q){V=new Float32Array(4*Q.length);for(let D=0;D<Q.length;D++)V[4*D]=Q[D].r,V[4*D+1]=Q[D].g,V[4*D+2]=Q[D].b,V[4*D+3]=Q[D].a}const d=new M.d,X=new Float32Array(v),A=new Float32Array(B),W=new Float32Array(s);return d.indices=r,d.JD=X,d.OD=A,d.LD=W,V&&d.set(V,j.f.ColorKind),H&&(d._idx=G),d}function S(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=h.pathArray,k=h.closeArray,K=h.closePath,Q=g.d._GetDefaultSideOrientation(h.sideOrientation),v=h.instance,r=h.updatable;if(v){const D=H.TmpVectors.Gh[0].qg(Number.MAX_VALUE),o=H.TmpVectors.Gh[1].qg(-Number.MAX_VALUE),t=h=>{let H=S[0].length;const j=v;let M=0;const R=j._originalBuilderSideOrientation===g.d.DOUBLESIDE?2:1;for(let g=1;g<=R;++g)for(let R=0;R<S.length;++R){const g=S[R],t=g.length;H=H<t?H:t;for(let j=0;j<H;++j){const H=g[j];h[M]=H.x,h[M+1]=H.y,h[M+2]=H.z,D.minimizeInPlaceFromFloats(H.x,H.y,H.z),o.maximizeInPlaceFromFloats(H.x,H.y,H.z),M+=3}if(j._creationDataStorage&&j._creationDataStorage.closePath){const D=g[0];h[M]=D.x,h[M+1]=D.y,h[M+2]=D.z,M+=3}}},k=v.getVerticesData(j.f.PositionKind);if(t(k),v.hasBoundingInfo?v.getBoundingInfo().reConstruct(D,o,v._worldMatrix):v.buildBoundingInfo(D,o,v._worldMatrix),v.updateVerticesData(j.f.PositionKind,k,!1,!1),h.ED){const D=v.getVerticesData(j.f.ColorKind);for(let o=0,H=0;o<h.ED.length;o++,H+=4){const g=h.ED[o];D[H]=g.r,D[H+1]=g.g,D[H+2]=g.b,D[H+3]=g.a}v.updateVerticesData(j.f.ColorKind,D,!1,!1)}if(h.LD){const D=v.getVerticesData(j.f.UVKind);for(let o=0;o<h.LD.length;o++)D[2*o]=h.LD[o].x,D[2*o+1]=R.c?1-h.LD[o].y:h.LD[o].y;v.updateVerticesData(j.f.UVKind,D,!1,!1)}if(!v.areNormalsFrozen||v.isFacetDataEnabled){const D=v.jg(),h=v.getVerticesData(j.f.NormalKind),o=v.isFacetDataEnabled?v.getFacetDataParameters():null;if(M.d.ComputeNormals(k,D,h,o),v._creationDataStorage&&v._creationDataStorage.closePath){let D=0,o=0;for(let H=0;H<S.length;H++)D=3*v._creationDataStorage.idx[H],o=H+1<S.length?3*(v._creationDataStorage.idx[H+1]-1):h.length-3,h[D]=.5*(h[D]+h[o]),h[D+1]=.5*(h[D+1]+h[o+1]),h[D+2]=.5*(h[D+2]+h[o+2]),h[o]=h[D],h[o+1]=h[D+1],h[o+2]=h[D+2]}v.areNormalsFrozen||v.updateVerticesData(j.f.NormalKind,h,!1,!1)}return v}{const H=new g.d(D,o);H._originalBuilderSideOrientation=Q,H._creationDataStorage=new g.e;const j=t(h);return K&&(H._creationDataStorage.idx=j._idx),H._creationDataStorage.closePath=K,H._creationDataStorage.closeArray=k,j.ZD(H,r),H}}M.d.CreateRibbon=t,g.d.CreateRibbon=function(D,h){return S(D,{pathArray:h,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var k=o(14055),K=o(13903),Q=o(12870);function v(D){const h=D.pattern||g.d.NO_FLIP,o=D.tileWidth||D.tileSize||1,H=D.tileHeight||D.tileSize||1,j=D.alignHorizontal||0,R=D.alignVertical||0,t=D.width||D.size||1,S=Math.floor(t/o);let k=t-S*o;const K=D.height||D.size||1,Q=Math.floor(K/H);let v=K-Q*H;const r=o*S/2,B=H*Q/2;let s=0,U=0,q=0,c=0,y=0,b=0;if(k>0||v>0){switch(q=-r,c=-B,y=r,b=B,j){case g.d.CENTER:k/=2,q-=k,y+=k;break;case g.d.LEFT:y+=k,s=-k/2;break;case g.d.RIGHT:q-=k,s=k/2}switch(R){case g.d.CENTER:v/=2,c-=v,b+=v;break;case g.d.BOTTOM:b+=v,U=-v/2;break;case g.d.TOP:c-=v,U=v/2}}const i=[],G=[],N=[];N[0]=[0,0,1,0,1,1,0,1],N[1]=[0,0,1,0,1,1,0,1],h!==g.d.ROTATE_TILE&&h!==g.d.ROTATE_ROW||(N[1]=[1,1,0,1,0,0,1,0]),h!==g.d.FLIP_TILE&&h!==g.d.FLIP_ROW||(N[1]=[1,0,0,0,0,1,1,1]),h!==g.d.FLIP_N_ROTATE_TILE&&h!==g.d.FLIP_N_ROTATE_ROW||(N[1]=[0,1,1,1,1,0,0,0]);let J=[];const O=[],E=[];let L=0;for(let M=0;M<Q;M++)for(let D=0;D<S;D++)i.push(D*o-r+s,M*H-B+U,0),i.push((D+1)*o-r+s,M*H-B+U,0),i.push((D+1)*o-r+s,(M+1)*H-B+U,0),i.push(D*o-r+s,(M+1)*H-B+U,0),E.push(L,L+1,L+3,L+1,L+2,L+3),J=h===g.d.FLIP_TILE||h===g.d.ROTATE_TILE||h===g.d.FLIP_N_ROTATE_TILE?J.concat(N[(D%2+M%2)%2]):h===g.d.FLIP_ROW||h===g.d.ROTATE_ROW||h===g.d.FLIP_N_ROTATE_ROW?J.concat(N[M%2]):J.concat(N[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),L+=4;if(k>0||v>0){const D=v>0&&(R===g.d.CENTER||R===g.d.TOP),M=v>0&&(R===g.d.CENTER||R===g.d.BOTTOM),t=k>0&&(j===g.d.CENTER||j===g.d.RIGHT),K=k>0&&(j===g.d.CENTER||j===g.d.LEFT);let N,T,Z,e,p=[];if(D&&t&&(i.push(q+s,c+U,0),i.push(-r+s,c+U,0),i.push(-r+s,c+v+U,0),i.push(q+s,c+v+U,0),E.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,N=1-k/o,T=1-v/H,Z=1,e=1,p=[N,T,Z,T,Z,e,N,e],h===g.d.ROTATE_ROW&&(p=[1-N,1-T,1-Z,1-T,1-Z,1-e,1-N,1-e]),h===g.d.FLIP_ROW&&(p=[1-N,T,1-Z,T,1-Z,e,1-N,e]),h===g.d.FLIP_N_ROTATE_ROW&&(p=[N,1-T,Z,1-T,Z,1-e,N,1-e]),J=J.concat(p),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),D&&K&&(i.push(r+s,c+U,0),i.push(y+s,c+U,0),i.push(y+s,c+v+U,0),i.push(r+s,c+v+U,0),E.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,N=0,T=1-v/H,Z=k/o,e=1,p=[N,T,Z,T,Z,e,N,e],(h===g.d.ROTATE_ROW||h===g.d.ROTATE_TILE&&S%2===0)&&(p=[1-N,1-T,1-Z,1-T,1-Z,1-e,1-N,1-e]),(h===g.d.FLIP_ROW||h===g.d.FLIP_TILE&&S%2===0)&&(p=[1-N,T,1-Z,T,1-Z,e,1-N,e]),(h===g.d.FLIP_N_ROTATE_ROW||h===g.d.FLIP_N_ROTATE_TILE&&S%2===0)&&(p=[N,1-T,Z,1-T,Z,1-e,N,1-e]),J=J.concat(p),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M&&t&&(i.push(q+s,B+U,0),i.push(-r+s,B+U,0),i.push(-r+s,b+U,0),i.push(q+s,b+U,0),E.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,N=1-k/o,T=0,Z=1,e=v/H,p=[N,T,Z,T,Z,e,N,e],(h===g.d.ROTATE_ROW&&Q%2===1||h===g.d.ROTATE_TILE&&Q%1===0)&&(p=[1-N,1-T,1-Z,1-T,1-Z,1-e,1-N,1-e]),(h===g.d.FLIP_ROW&&Q%2===1||h===g.d.FLIP_TILE&&Q%2===0)&&(p=[1-N,T,1-Z,T,1-Z,e,1-N,e]),(h===g.d.FLIP_N_ROTATE_ROW&&Q%2===1||h===g.d.FLIP_N_ROTATE_TILE&&Q%2===0)&&(p=[N,1-T,Z,1-T,Z,1-e,N,1-e]),J=J.concat(p),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M&&K&&(i.push(r+s,B+U,0),i.push(y+s,B+U,0),i.push(y+s,b+U,0),i.push(r+s,b+U,0),E.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,N=0,T=0,Z=k/o,e=v/H,p=[N,T,Z,T,Z,e,N,e],(h===g.d.ROTATE_ROW&&Q%2===1||h===g.d.ROTATE_TILE&&(Q+S)%2===1)&&(p=[1-N,1-T,1-Z,1-T,1-Z,1-e,1-N,1-e]),(h===g.d.FLIP_ROW&&Q%2===1||h===g.d.FLIP_TILE&&(Q+S)%2===1)&&(p=[1-N,T,1-Z,T,1-Z,e,1-N,e]),(h===g.d.FLIP_N_ROTATE_ROW&&Q%2===1||h===g.d.FLIP_N_ROTATE_TILE&&(Q+S)%2===1)&&(p=[N,1-T,Z,1-T,Z,1-e,N,1-e]),J=J.concat(p),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),D){const D=[];N=0,T=1-v/H,Z=1,e=1,D[0]=[N,T,Z,T,Z,e,N,e],D[1]=[N,T,Z,T,Z,e,N,e],h!==g.d.ROTATE_TILE&&h!==g.d.ROTATE_ROW||(D[1]=[1-N,1-T,1-Z,1-T,1-Z,1-e,1-N,1-e]),h!==g.d.FLIP_TILE&&h!==g.d.FLIP_ROW||(D[1]=[1-N,T,1-Z,T,1-Z,e,1-N,e]),h!==g.d.FLIP_N_ROTATE_TILE&&h!==g.d.FLIP_N_ROTATE_ROW||(D[1]=[N,1-T,Z,1-T,Z,1-e,N,1-e]);for(let H=0;H<S;H++)i.push(H*o-r+s,c+U,0),i.push((H+1)*o-r+s,c+U,0),i.push((H+1)*o-r+s,c+v+U,0),i.push(H*o-r+s,c+v+U,0),E.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,J=h===g.d.FLIP_TILE||h===g.d.ROTATE_TILE||h===g.d.FLIP_N_ROTATE_TILE?J.concat(D[(H+1)%2]):h===g.d.FLIP_ROW||h===g.d.ROTATE_ROW||h===g.d.FLIP_N_ROTATE_ROW?J.concat(D[1]):J.concat(D[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(M){const D=[];N=0,T=0,Z=1,e=v/H,D[0]=[N,T,Z,T,Z,e,N,e],D[1]=[N,T,Z,T,Z,e,N,e],h!==g.d.ROTATE_TILE&&h!==g.d.ROTATE_ROW||(D[1]=[1-N,1-T,1-Z,1-T,1-Z,1-e,1-N,1-e]),h!==g.d.FLIP_TILE&&h!==g.d.FLIP_ROW||(D[1]=[1-N,T,1-Z,T,1-Z,e,1-N,e]),h!==g.d.FLIP_N_ROTATE_TILE&&h!==g.d.FLIP_N_ROTATE_ROW||(D[1]=[N,1-T,Z,1-T,Z,1-e,N,1-e]);for(let H=0;H<S;H++)i.push(H*o-r+s,b-v+U,0),i.push((H+1)*o-r+s,b-v+U,0),i.push((H+1)*o-r+s,b+U,0),i.push(H*o-r+s,b+U,0),E.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,J=h===g.d.FLIP_TILE||h===g.d.ROTATE_TILE||h===g.d.FLIP_N_ROTATE_TILE?J.concat(D[(H+Q)%2]):h===g.d.FLIP_ROW||h===g.d.ROTATE_ROW||h===g.d.FLIP_N_ROTATE_ROW?J.concat(D[Q%2]):J.concat(D[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(t){const D=[];N=1-k/o,T=0,Z=1,e=1,D[0]=[N,T,Z,T,Z,e,N,e],D[1]=[N,T,Z,T,Z,e,N,e],h!==g.d.ROTATE_TILE&&h!==g.d.ROTATE_ROW||(D[1]=[1-N,1-T,1-Z,1-T,1-Z,1-e,1-N,1-e]),h!==g.d.FLIP_TILE&&h!==g.d.FLIP_ROW||(D[1]=[1-N,T,1-Z,T,1-Z,e,1-N,e]),h!==g.d.FLIP_N_ROTATE_TILE&&h!==g.d.FLIP_N_ROTATE_ROW||(D[1]=[N,1-T,Z,1-T,Z,1-e,N,1-e]);for(let o=0;o<Q;o++)i.push(q+s,o*H-B+U,0),i.push(q+k+s,o*H-B+U,0),i.push(q+k+s,(o+1)*H-B+U,0),i.push(q+s,(o+1)*H-B+U,0),E.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,J=h===g.d.FLIP_TILE||h===g.d.ROTATE_TILE||h===g.d.FLIP_N_ROTATE_TILE?J.concat(D[(o+1)%2]):h===g.d.FLIP_ROW||h===g.d.ROTATE_ROW||h===g.d.FLIP_N_ROTATE_ROW?J.concat(D[o%2]):J.concat(D[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(K){const D=[];N=0,T=0,Z=k/H,e=1,D[0]=[N,T,Z,T,Z,e,N,e],D[1]=[N,T,Z,T,Z,e,N,e],h!==g.d.ROTATE_TILE&&h!==g.d.ROTATE_ROW||(D[1]=[1-N,1-T,1-Z,1-T,1-Z,1-e,1-N,1-e]),h!==g.d.FLIP_TILE&&h!==g.d.FLIP_ROW||(D[1]=[1-N,T,1-Z,T,1-Z,e,1-N,e]),h!==g.d.FLIP_N_ROTATE_TILE&&h!==g.d.FLIP_N_ROTATE_ROW||(D[1]=[N,1-T,Z,1-T,Z,1-e,N,1-e]);for(let o=0;o<Q;o++)i.push(y-k+s,o*H-B+U,0),i.push(y+s,o*H-B+U,0),i.push(y+s,(o+1)*H-B+U,0),i.push(y-k+s,(o+1)*H-B+U,0),E.push(L,L+1,L+3,L+1,L+2,L+3),L+=4,J=h===g.d.FLIP_TILE||h===g.d.ROTATE_TILE||h===g.d.FLIP_N_ROTATE_TILE?J.concat(D[(o+S)%2]):h===g.d.FLIP_ROW||h===g.d.ROTATE_ROW||h===g.d.FLIP_N_ROTATE_ROW?J.concat(D[o%2]):J.concat(D[0]),O.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),G.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const T=0===D.sideOrientation?0:D.sideOrientation||M.d.DEFAULTSIDE;M.d._ComputeSides(T,i,E,G,J,D.frontUVs,D.backUVs);const Z=new M.d;Z.indices=E,Z.JD=i,Z.OD=G,Z.LD=J;const e=T===M.d.DOUBLESIDE?O.concat(O):O;return Z.ED=e,Z}function r(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new g.d(D,o);h.sideOrientation=g.d._GetDefaultSideOrientation(h.sideOrientation),H._originalBuilderSideOrientation=h.sideOrientation;return v(h).ZD(H,h.updatable),H}function B(D){const h=D.faceUV||new Array(6),o=D.faceColors,j=D.pattern||g.d.NO_FLIP,t=D.width||D.size||1,S=D.height||D.size||1,k=D.depth||D.size||1,K=D.tileWidth||D.tileSize||1,r=D.tileHeight||D.tileSize||1,B=D.alignHorizontal||0,s=D.alignVertical||0,U=0===D.sideOrientation?0:D.sideOrientation||M.d.DEFAULTSIDE;for(let g=0;g<6;g++)void 0===h[g]&&(h[g]=new H.Vector4(0,0,1,1)),o&&void 0===o[g]&&(o[g]=new Q.yg(1,1,1,1));const q=t/2,c=S/2,y=k/2,b=[];for(let H=0;H<2;H++)b[H]=v({pattern:j,tileWidth:K,tileHeight:r,width:t,height:S,alignVertical:s,alignHorizontal:B,sideOrientation:U});for(let H=2;H<4;H++)b[H]=v({pattern:j,tileWidth:K,tileHeight:r,width:k,height:S,alignVertical:s,alignHorizontal:B,sideOrientation:U});let i=s;s===g.d.BOTTOM?i=g.d.TOP:s===g.d.TOP&&(i=g.d.BOTTOM);for(let H=4;H<6;H++)b[H]=v({pattern:j,tileWidth:K,tileHeight:r,width:t,height:k,alignVertical:i,alignHorizontal:B,sideOrientation:U});let G=[],N=[],J=[],O=[];const E=[],L=[],T=[],Z=[];let e=0,p=0;for(let g=0;g<6;g++){const D=b[g].JD.length;L[g]=[],T[g]=[];for(let h=0;h<D/3;h++)L[g].push(new H.Gh(b[g].JD[3*h],b[g].JD[3*h+1],b[g].JD[3*h+2])),T[g].push(new H.Gh(b[g].OD[3*h],b[g].OD[3*h+1],b[g].OD[3*h+2]));e=b[g].LD.length,Z[g]=[];for(let o=0;o<e;o+=2)Z[g][o]=h[g].x+(h[g].z-h[g].x)*b[g].LD[o],Z[g][o+1]=h[g].y+(h[g].w-h[g].y)*b[g].LD[o+1],R.c&&(Z[g][o+1]=1-Z[g][o+1]);if(J=J.concat(Z[g]),O=O.concat(b[g].indices.map((D=>D+p))),p+=L[g].length,o)for(let h=0;h<4;h++)E.push(o[g].r,o[g].g,o[g].b,o[g].a)}const mD=new H.Gh(0,0,y),a=H.Matrix.RotationY(Math.PI);G=L[0].map((D=>H.Gh.TransformNormal(D,a).add(mD))).map((D=>[D.x,D.y,D.z])).reduce(((D,h)=>D.concat(h)),[]),N=T[0].map((D=>H.Gh.TransformNormal(D,a))).map((D=>[D.x,D.y,D.z])).reduce(((D,h)=>D.concat(h)),[]),G=G.concat(L[1].map((D=>D.Nh(mD))).map((D=>[D.x,D.y,D.z])).reduce(((D,h)=>D.concat(h)),[])),N=N.concat(T[1].map((D=>[D.x,D.y,D.z])).reduce(((D,h)=>D.concat(h)),[]));const u=new H.Gh(q,0,0),I=H.Matrix.RotationY(-Math.PI/2);G=G.concat(L[2].map((D=>H.Gh.TransformNormal(D,I).add(u))).map((D=>[D.x,D.y,D.z])).reduce(((D,h)=>D.concat(h)),[])),N=N.concat(T[2].map((D=>H.Gh.TransformNormal(D,I))).map((D=>[D.x,D.y,D.z])).reduce(((D,h)=>D.concat(h)),[]));const P=H.Matrix.RotationY(Math.PI/2);G=G.concat(L[3].map((D=>H.Gh.TransformNormal(D,P).Nh(u))).map((D=>[D.x,D.y,D.z])).reduce(((D,h)=>D.concat(h)),[])),N=N.concat(T[3].map((D=>H.Gh.TransformNormal(D,P))).map((D=>[D.x,D.y,D.z])).reduce(((D,h)=>D.concat(h)),[]));const n=new H.Gh(0,c,0),F=H.Matrix.RotationX(Math.PI/2);G=G.concat(L[4].map((D=>H.Gh.TransformNormal(D,F).add(n))).map((D=>[D.x,D.y,D.z])).reduce(((D,h)=>D.concat(h)),[])),N=N.concat(T[4].map((D=>H.Gh.TransformNormal(D,F))).map((D=>[D.x,D.y,D.z])).reduce(((D,h)=>D.concat(h)),[]));const w=H.Matrix.RotationX(-Math.PI/2);G=G.concat(L[5].map((D=>H.Gh.TransformNormal(D,w).Nh(n))).map((D=>[D.x,D.y,D.z])).reduce(((D,h)=>D.concat(h)),[])),N=N.concat(T[5].map((D=>H.Gh.TransformNormal(D,w))).map((D=>[D.x,D.y,D.z])).reduce(((D,h)=>D.concat(h)),[])),M.d._ComputeSides(U,G,O,N,J);const Y=new M.d;if(Y.indices=O,Y.JD=G,Y.OD=N,Y.LD=J,o){const D=U===M.d.DOUBLESIDE?E.concat(E):E;Y.ED=D}return Y}function s(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new g.d(D,o);h.sideOrientation=g.d._GetDefaultSideOrientation(h.sideOrientation),H._originalBuilderSideOrientation=h.sideOrientation;return B(h).ZD(H,h.updatable),H}M.d.CreateTiledPlane=v;M.d.CreateTiledBox=B;var U=o(14044),q=o(13065),c=o(13031);function y(D){const h=D.height||2;let o=0===D.diameterTop?0:D.diameterTop||D.diameter||1,j=0===D.diameterBottom?0:D.diameterBottom||D.diameter||1;o=o||1e-5,j=j||1e-5;const t=0|(D.tessellation||24),S=0|(D.subdivisions||1),k=!!D.hasRings,K=!!D.enclose,v=0===D.cap?0:D.cap||g.d.CAP_ALL,r=D.arc&&(D.arc<=0||D.arc>1)?1:D.arc||1,B=0===D.sideOrientation?0:D.sideOrientation||M.d.DEFAULTSIDE,s=D.faceUV||new Array(3),U=D.faceColors,q=2+(1+(1!==r&&K?2:0))*(k?S:1);let y;for(y=0;y<q;y++)U&&void 0===U[y]&&(U[y]=new Q.yg(1,1,1,1));for(y=0;y<q;y++)s&&void 0===s[y]&&(s[y]=new H.Vector4(0,0,1,1));const b=[],i=[],G=[],N=[],J=[],O=2*Math.PI*r/t;let E,L,T;const Z=(j-o)/2/h,e=H.Gh.Zero(),p=H.Gh.Zero(),mD=H.Gh.Zero(),a=H.Gh.Zero(),u=H.Gh.Zero(),I=c.d.Y;let P,n,F,w=1,Y=1,l=0,C=0;for(P=0;P<=S;P++)for(L=P/S,T=(L*(o-j)+j)/2,w=k&&0!==P&&P!==S?2:1,F=0;F<w;F++){for(k&&(Y+=F),K&&(Y+=2*F),n=0;n<=t;n++)E=n*O,e.x=Math.cos(-E)*T,e.y=-h/2+L*h,e.z=Math.sin(-E)*T,0===o&&P===S?(p.x=G[G.length-3*(t+1)],p.y=G[G.length-3*(t+1)+1],p.z=G[G.length-3*(t+1)+2]):(p.x=e.x,p.z=e.z,p.y=Math.sqrt(p.x*p.x+p.z*p.z)*Z,p.normalize()),0===n&&(mD.M(e),a.M(p)),i.push(e.x,e.y,e.z),G.push(p.x,p.y,p.z),C=k?l!==Y?s[Y].y:s[Y].w:s[Y].y+(s[Y].w-s[Y].y)*L,N.push(s[Y].x+(s[Y].z-s[Y].x)*n/t,R.c?1-C:C),U&&J.push(U[Y].r,U[Y].g,U[Y].b,U[Y].a);1!==r&&K&&(i.push(e.x,e.y,e.z),i.push(0,e.y,0),i.push(0,e.y,0),i.push(mD.x,mD.y,mD.z),H.Gh.CrossToRef(I,p,u),u.normalize(),G.push(u.x,u.y,u.z,u.x,u.y,u.z),H.Gh.CrossToRef(a,I,u),u.normalize(),G.push(u.x,u.y,u.z,u.x,u.y,u.z),C=k?l!==Y?s[Y+1].y:s[Y+1].w:s[Y+1].y+(s[Y+1].w-s[Y+1].y)*L,N.push(s[Y+1].x,R.c?1-C:C),N.push(s[Y+1].z,R.c?1-C:C),C=k?l!==Y?s[Y+2].y:s[Y+2].w:s[Y+2].y+(s[Y+2].w-s[Y+2].y)*L,N.push(s[Y+2].x,R.c?1-C:C),N.push(s[Y+2].z,R.c?1-C:C),U&&(J.push(U[Y+1].r,U[Y+1].g,U[Y+1].b,U[Y+1].a),J.push(U[Y+1].r,U[Y+1].g,U[Y+1].b,U[Y+1].a),J.push(U[Y+2].r,U[Y+2].g,U[Y+2].b,U[Y+2].a),J.push(U[Y+2].r,U[Y+2].g,U[Y+2].b,U[Y+2].a))),l!==Y&&(l=Y)}const z=1!==r&&K?t+4:t;for(P=0,Y=0;Y<S;Y++){let D=0,h=0,o=0,H=0;for(n=0;n<t;n++)D=P*(z+1)+n,h=(P+1)*(z+1)+n,o=P*(z+1)+(n+1),H=(P+1)*(z+1)+(n+1),b.push(D,h,o),b.push(H,o,h);1!==r&&K&&(b.push(D+2,h+2,o+2),b.push(H+2,o+2,h+2),b.push(D+4,h+4,o+4),b.push(H+4,o+4,h+4)),P=k?P+2:P+1}const f=D=>{const g=D?o/2:j/2;if(0===g)return;let M,S,k;const K=D?s[q-1]:s[0];let Q=null;U&&(Q=D?U[q-1]:U[0]);const v=i.length/3,B=D?h/2:-h/2,c=new H.Gh(0,B,0);i.push(c.x,c.y,c.z),G.push(0,D?1:-1,0);const y=K.y+.5*(K.w-K.y);N.push(K.x+.5*(K.z-K.x),R.c?1-y:y),Q&&J.push(Q.r,Q.g,Q.b,Q.a);const O=new H.Vector2(.5,.5);for(k=0;k<=t;k++){M=2*Math.PI*k*r/t;const h=Math.cos(-M),o=Math.sin(-M);S=new H.Gh(h*g,B,o*g);const j=new H.Vector2(h*O.x+.5,o*O.y+.5);i.push(S.x,S.y,S.z),G.push(0,D?1:-1,0);const v=K.y+(K.w-K.y)*j.y;N.push(K.x+(K.z-K.x)*j.x,R.c?1-v:v),Q&&J.push(Q.r,Q.g,Q.b,Q.a)}for(k=0;k<t;k++)D?(b.push(v),b.push(v+(k+2)),b.push(v+(k+1))):(b.push(v),b.push(v+(k+1)),b.push(v+(k+2)))};v!==g.d.CAP_START&&v!==g.d.CAP_ALL||f(!1),v!==g.d.CAP_END&&v!==g.d.CAP_ALL||f(!0),M.d._ComputeSides(B,i,b,G,N,D.frontUVs,D.backUVs);const V=new M.d;return V.indices=b,V.JD=i,V.OD=G,V.LD=N,U&&(V.ED=J),V}function b(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const H=new g.d(D,o);h.sideOrientation=g.d._GetDefaultSideOrientation(h.sideOrientation),H._originalBuilderSideOrientation=h.sideOrientation;return y(h).ZD(H,h.updatable),H}function i(D){const h=[],o=[],g=[],j=[],t=D.diameter||1,S=D.thickness||.5,k=0|(D.tessellation||16),K=0===D.sideOrientation?0:D.sideOrientation||M.d.DEFAULTSIDE,Q=k+1;for(let M=0;M<=k;M++){const D=M/k,K=M*Math.PI*2/k-Math.PI/2,v=H.Matrix.Translation(t/2,0,0).multiply(H.Matrix.RotationY(K));for(let t=0;t<=k;t++){const K=1-t/k,r=t*Math.PI*2/k+Math.PI,B=Math.cos(r),s=Math.sin(r);let U=new H.Gh(B,s,0),q=U.scale(S/2);const c=new H.Vector2(D,K);q=H.Gh.TransformCoordinates(q,v),U=H.Gh.TransformNormal(U,v),o.push(q.x,q.y,q.z),g.push(U.x,U.y,U.z),j.push(c.x,R.c?1-c.y:c.y);const y=(M+1)%Q,b=(t+1)%Q;h.push(M*Q+t),h.push(M*Q+b),h.push(y*Q+t),h.push(M*Q+b),h.push(y*Q+b),h.push(y*Q+t)}}M.d._ComputeSides(K,o,h,g,j,D.frontUVs,D.backUVs);const v=new M.d;return v.indices=h,v.JD=o,v.OD=g,v.LD=j,v}function G(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const H=new g.d(D,o);h.sideOrientation=g.d._GetDefaultSideOrientation(h.sideOrientation),H._originalBuilderSideOrientation=h.sideOrientation;return i(h).ZD(H,h.updatable),H}M.d.CreateCylinder=y,g.d.CreateCylinder=(D,h,o,H,j,M,R,t,S)=>{void 0!==R&&R instanceof q.b||(void 0!==R&&(S=t||g.d.DEFAULTSIDE,t=R),R=M,M=1);return b(D,{height:h,diameterTop:o,diameterBottom:H,tessellation:j,subdivisions:M,sideOrientation:S,updatable:t},R)};function N(D){const h=[],o=[],g=[],j=[],t=D.radius||2,S=D.tube||.5,k=D.radialSegments||32,K=D.tubularSegments||32,Q=D.p||2,v=D.q||3,r=0===D.sideOrientation?0:D.sideOrientation||M.d.DEFAULTSIDE,B=D=>{const h=Math.cos(D),o=Math.sin(D),g=v/Q*D,j=Math.cos(g),M=t*(2+j)*.5*h,R=t*(2+j)*o*.5,S=t*Math.sin(g)*.5;return new H.Gh(M,R,S)};let s,U;for(s=0;s<=k;s++){const D=s%k/k*2*Q*Math.PI,h=B(D),g=B(D+.01),M=g.Nh(h);let t=g.add(h);const v=H.Gh.Cross(M,t);for(t=H.Gh.Cross(v,M),v.normalize(),t.normalize(),U=0;U<K;U++){const D=U%K/K*2*Math.PI,H=-S*Math.cos(D),g=S*Math.sin(D);o.push(h.x+H*t.x+g*v.x),o.push(h.y+H*t.y+g*v.y),o.push(h.z+H*t.z+g*v.z),j.push(s/k),j.push(R.c?1-U/K:U/K)}}for(s=0;s<k;s++)for(U=0;U<K;U++){const D=(U+1)%K,o=s*K+U,H=(s+1)*K+U,g=(s+1)*K+D,j=s*K+D;h.push(j),h.push(H),h.push(o),h.push(j),h.push(g),h.push(H)}M.d.ComputeNormals(o,h,g),M.d._ComputeSides(r,o,h,g,j,D.frontUVs,D.backUVs);const q=new M.d;return q.indices=h,q.JD=o,q.OD=g,q.LD=j,q}function J(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const H=new g.d(D,o);h.sideOrientation=g.d._GetDefaultSideOrientation(h.sideOrientation),H._originalBuilderSideOrientation=h.sideOrientation;return N(h).ZD(H,h.updatable),H}M.d.CreateTorus=i,g.d.CreateTorus=(D,h,o,H,g,j,M)=>G(D,{diameter:h,thickness:o,tessellation:H,sideOrientation:M,updatable:j},g);M.d.CreateTorusKnot=N,g.d.CreateTorusKnot=(D,h,o,H,g,j,M,R,t,S)=>J(D,{radius:h,tube:o,radialSegments:H,tubularSegments:g,p:j,q:M,sideOrientation:S,updatable:t},R);var O=o(14483),E=o(13401),L=o(13038);function T(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=h.path,j=h.shape,M=h.scale||1,R=h.rotation||0,t=0===h.cap?0:h.cap||g.d.NO_CAP,S=h.updatable,k=g.d._GetDefaultSideOrientation(h.sideOrientation),K=h.instance||null,Q=h.invertUV||!1,v=h.closeShape||!1,r=h.closePath||!1,B=h.capFunction||null;return e(D,j,H,M,R,null,null,r,v,t,!1,o,!!S,k,K,Q,h.frontUVs||null,h.backUVs||null,h.firstNormal||null,!!h.adjustFrame,B)}function Z(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=h.path,j=h.shape,M=h.scaleFunction||(()=>1),R=h.rotationFunction||(()=>0),t=h.closePath||h.ribbonCloseArray||!1,S=h.closeShape||h.ribbonClosePath||!1,k=0===h.cap?0:h.cap||g.d.NO_CAP,K=h.updatable,Q=h.firstNormal||null,v=h.adjustFrame||!1,r=g.d._GetDefaultSideOrientation(h.sideOrientation),B=h.instance,s=h.invertUV||!1,U=h.capFunction||null;return e(D,j,H,null,null,M,R,t,S,k,!0,o,!!K,r,B||null,s,h.frontUVs||null,h.backUVs||null,Q,v,U||null)}function e(D,h,o,j,M,R,t,k,K,Q,v,r,B,s,U,q,c,y,b,i,G){const N=(D,h,o,j,M,R,t,S,k,K,Q)=>{const v=o.getTangents(),r=o.getNormals(),B=o.getBinormals(),s=o.getDistances();if(Q)for(let g=0;g<v.length;g++)if(0==v[g].x&&0==v[g].y&&0==v[g].z&&v[g].M(v[g-1]),0==r[g].x&&0==r[g].y&&0==r[g].z&&r[g].M(r[g-1]),0==B[g].x&&0==B[g].y&&0==B[g].z&&B[g].M(B[g-1]),g>0){let D=v[g-1];H.Gh.Dot(D,v[g])<0&&v[g].scaleInPlace(-1),D=r[g-1],H.Gh.Dot(D,r[g])<0&&r[g].scaleInPlace(-1),D=B[g-1],H.Gh.Dot(D,B[g])<0&&B[g].scaleInPlace(-1)}let U=0;const q=K&&S?S:()=>null!==R?R:0,c=K&&t?t:()=>null!==M?M:1;let y=k===g.d.NO_CAP||k===g.d.CAP_END?0:2;const b=H.TmpVectors.Matrix[0];for(let g=0;g<h.length;g++){const o=[],M=q(g,s[g]),R=c(g,s[g]);H.Matrix.RotationAxisToRef(v[g],U,b);for(let j=0;j<D.length;j++){const M=v[g].scale(D[j].z).add(r[g].scale(D[j].x)).add(B[g].scale(D[j].y)),t=H.Gh.Zero();H.Gh.TransformCoordinatesToRef(M,b,t),t.scaleInPlace(R).addInPlace(h[g]),o[j]=t}j[y]=o,U+=M,y++}const i=G||(D=>{const h=Array(),o=H.Gh.Zero();let g;for(g=0;g<D.length;g++)o.addInPlace(D[g]);for(o.scaleInPlace(1/D.length),g=0;g<D.length;g++)h.push(o);return h});switch(k){case g.d.NO_CAP:break;case g.d.CAP_START:j[0]=i(j[2]),j[1]=j[2];break;case g.d.CAP_END:j[y]=j[y-1],j[y+1]=i(j[y-1]);break;case g.d.CAP_ALL:j[0]=i(j[2]),j[1]=j[2],j[y]=j[y-1],j[y+1]=i(j[y-1])}return j};let J,O;if(U){const D=U._creationDataStorage;return J=b?D.path3D.update(o,b):D.path3D.update(o),O=N(h,o,D.path3D,D.pathArray,j,M,R,t,D.cap,v,i),U=S("",{pathArray:O,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:U},r||void 0)}J=b?new L.j(o,b):new L.j(o);O=N(h,o,J,new Array,j,M,R,t,Q=Q<0||Q>3?0:Q,v,i);const E=S(D,{pathArray:O,closeArray:k,closePath:K,updatable:B,sideOrientation:s,invertUV:q,frontUVs:c||void 0,backUVs:y||void 0},r);return E._creationDataStorage.pathArray=O,E._creationDataStorage.path3D=J,E._creationDataStorage.cap=Q,E}function p(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=h.arc?h.arc<=0||h.arc>1?1:h.arc:1,M=void 0===h.closed||h.closed,R=h.shape,t=h.radius||1,k=h.tessellation||64,K=h.clip||0,Q=h.updatable,v=g.d._GetDefaultSideOrientation(h.sideOrientation),r=h.cap||g.d.NO_CAP,B=2*Math.PI,s=[],U=h.invertUV||!1;let q=0,c=0;const y=B/k*j;let b,i;for(q=0;q<=k-K;q++){for(i=[],r!=g.d.CAP_START&&r!=g.d.CAP_ALL||(i.push(new H.Gh(0,R[0].y,0)),i.push(new H.Gh(Math.cos(q*y)*R[0].x*t,R[0].y,Math.sin(q*y)*R[0].x*t))),c=0;c<R.length;c++)b=new H.Gh(Math.cos(q*y)*R[c].x*t,R[c].y,Math.sin(q*y)*R[c].x*t),i.push(b);r!=g.d.CAP_END&&r!=g.d.CAP_ALL||(i.push(new H.Gh(Math.cos(q*y)*R[R.length-1].x*t,R[R.length-1].y,Math.sin(q*y)*R[R.length-1].x*t)),i.push(new H.Gh(0,R[R.length-1].y,0))),s.push(i)}return S(D,{pathArray:s,closeArray:M,sideOrientation:v,updatable:Q,invertUV:U,frontUVs:h.frontUVs,backUVs:h.backUVs},o)}g.d.ExtrudeShape=function(D,h,o,H,j,M){let R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7?arguments[7]:void 0,S=arguments.length>8?arguments[8]:void 0,k=arguments.length>9?arguments[9]:void 0;return T(D,{shape:h,path:o,scale:H,rotation:j,cap:0===M?0:M||g.d.NO_CAP,sideOrientation:S,instance:k,updatable:t},R)},g.d.ExtrudeShapeCustom=(D,h,o,H,j,M,R,t,S,k,K,Q)=>Z(D,{shape:h,path:o,scaleFunction:H,rotationFunction:j,ribbonCloseArray:M,ribbonClosePath:R,cap:0===t?0:t||g.d.NO_CAP,sideOrientation:K,instance:Q,updatable:k},S);g.d.CreateLathe=(D,h,o,H,g,j,M)=>p(D,{shape:h,radius:o,tessellation:H,sideOrientation:M,updatable:j},g);var mD=o(13961),a=o(13912);function u(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=h.path;let M=h.instance,R=1;void 0!==h.radius?R=h.radius:M&&(R=M._creationDataStorage.radius);const t=h.tessellation||64,k=h.radiusFunction||null;let K=h.cap||g.d.NO_CAP;const Q=h.invertUV||!1,v=h.updatable,r=g.d._GetDefaultSideOrientation(h.sideOrientation);h.arc=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1;const B=(D,h,o,j,M,R,t,S)=>{const k=h.getTangents(),K=h.getNormals(),Q=h.getDistances(),v=2*Math.PI/M*S,r=R||(()=>j);let B,s,U,q;const c=H.TmpVectors.Matrix[0];let y=t===g.d.NO_CAP||t===g.d.CAP_END?0:2;for(let g=0;g<D.length;g++){s=r(g,Q[g]),B=Array(),U=K[g];for(let h=0;h<M;h++)H.Matrix.RotationAxisToRef(k[g],v*h,c),q=B[h]?B[h]:H.Gh.Zero(),H.Gh.TransformCoordinatesToRef(U,c,q),q.scaleInPlace(s).addInPlace(D[g]),B[h]=q;o[y]=B,y++}const b=(h,o)=>{const H=Array();for(let g=0;g<h;g++)H.push(D[o]);return H};switch(t){case g.d.NO_CAP:break;case g.d.CAP_START:o[0]=b(M,0),o[1]=o[2].slice(0);break;case g.d.CAP_END:o[y]=o[y-1].slice(0),o[y+1]=b(M,D.length-1);break;case g.d.CAP_ALL:o[0]=b(M,0),o[1]=o[2].slice(0),o[y]=o[y-1].slice(0),o[y+1]=b(M,D.length-1)}return o};let s,U;if(M){const D=M._creationDataStorage,o=h.arc||D.arc;return s=D.path3D.update(j),U=B(j,s,D.pathArray,R,D.tessellation,k,D.cap,o),M=S("",{pathArray:U,instance:M}),D.path3D=s,D.pathArray=U,D.arc=o,D.radius=R,M}s=new L.j(j);K=K<0||K>3?0:K,U=B(j,s,new Array,R,t,k,K,h.arc);const q=S(D,{pathArray:U,closePath:!0,closeArray:!1,updatable:v,sideOrientation:r,invertUV:Q,frontUVs:h.frontUVs,backUVs:h.backUVs},o);return q._creationDataStorage.pathArray=U,q._creationDataStorage.path3D=s,q._creationDataStorage.tessellation=t,q._creationDataStorage.cap=K,q._creationDataStorage.arc=h.arc,q._creationDataStorage.radius=R,q}function I(D){const h=[];h[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},h[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},h[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},h[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},h[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},h[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},h[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},h[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},h[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},h[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},h[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},h[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},h[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},h[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},h[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const o=D.type&&(D.type<0||D.type>=h.length)?0:D.type||0,g=D.size,j=D.sizeX||g||1,t=D.sizeY||g||1,S=D.sizeZ||g||1,k=D.custom||h[o],K=k.face.length,v=D.faceUV||new Array(K),r=D.faceColors,B=void 0===D.flat||D.flat,s=0===D.sideOrientation?0:D.sideOrientation||M.d.DEFAULTSIDE,U=[],q=[],c=[],y=[],b=[];let i=0,G=0;const N=[];let J,O,E,L,T,Z,e=0,p=0;if(B)for(p=0;p<K;p++)r&&void 0===r[p]&&(r[p]=new Q.yg(1,1,1,1)),v&&void 0===v[p]&&(v[p]=new H.Vector4(0,0,1,1));if(B)for(p=0;p<K;p++){const D=k.face[p].length;for(E=2*Math.PI/D,L=.5*Math.tan(E/2),T=.5,e=0;e<D;e++)U.push(k.vertex[k.face[p][e]][0]*j,k.vertex[k.face[p][e]][1]*t,k.vertex[k.face[p][e]][2]*S),N.push(i),i++,J=v[p].x+(v[p].z-v[p].x)*(.5+L),O=v[p].y+(v[p].w-v[p].y)*(T-.5),y.push(J,R.c?1-O:O),Z=L*Math.cos(E)-T*Math.sin(E),T=L*Math.sin(E)+T*Math.cos(E),L=Z,r&&b.push(r[p].r,r[p].g,r[p].b,r[p].a);for(e=0;e<D-2;e++)q.push(N[0+G],N[e+2+G],N[e+1+G]);G+=D}else{for(e=0;e<k.vertex.length;e++)U.push(k.vertex[e][0]*j,k.vertex[e][1]*t,k.vertex[e][2]*S),y.push(0,R.c?1:0);for(p=0;p<K;p++)for(e=0;e<k.face[p].length-2;e++)q.push(k.face[p][0],k.face[p][e+2],k.face[p][e+1])}M.d.ComputeNormals(U,q,c),M.d._ComputeSides(s,U,q,c,y,D.frontUVs,D.backUVs);const mD=new M.d;return mD.JD=U,mD.indices=q,mD.OD=c,mD.LD=y,r&&B&&(mD.ED=b),mD}function P(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new g.d(D,o);h.sideOrientation=g.d._GetDefaultSideOrientation(h.sideOrientation),H._originalBuilderSideOrientation=h.sideOrientation;return I(h).ZD(H,h.updatable),H}g.d.CreateTube=(D,h,o,H,g,j,M,R,t,S)=>u(D,{path:h,radius:o,tessellation:H,radiusFunction:g,arc:1,cap:j,updatable:R,sideOrientation:t,instance:S},M);function n(D){const h=D.sideOrientation||M.d.DEFAULTSIDE,o=D.radius||1,g=void 0===D.flat||D.flat,j=0|(D.subdivisions||4),t=D.radiusX||o,S=D.radiusY||o,k=D.radiusZ||o,K=(1+Math.sqrt(5))/2,Q=[-1,K,-0,1,K,0,-1,-K,0,1,-K,0,0,-1,-K,0,1,-K,0,-1,K,0,1,K,K,0,1,K,0,-1,-K,0,1,-K,0,-1],v=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],r=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],B=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],s=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],U=[],q=[],c=[],y=[];let b=0;const i=new Array(3),G=new Array(3);let N;for(N=0;N<3;N++)i[N]=H.Gh.Zero(),G[N]=H.Vector2.Zero();for(let M=0;M<20;M++){for(N=0;N<3;N++){const D=v[3*M+N];i[N].Qg(Q[3*r[D]],Q[3*r[D]+1],Q[3*r[D]+2]),i[N].normalize(),G[N].Qg(.134765625*B[2*D]+.05859375+-.0390625*s[M],.2333984375*B[2*D+1]+.025390625+.01953125*s[M])}const D=(D,h,o,M)=>{const K=H.Gh.Lerp(i[0],i[2],h/j),Q=H.Gh.Lerp(i[1],i[2],h/j),v=j===h?i[2]:H.Gh.Lerp(K,Q,D/(j-h));let r;if(v.normalize(),g){const D=H.Gh.Lerp(i[0],i[2],M/j),h=H.Gh.Lerp(i[1],i[2],M/j);r=H.Gh.Lerp(D,h,o/(j-M))}else r=new H.Gh(v.x,v.y,v.z);r.x/=t,r.y/=S,r.z/=k,r.normalize();const B=H.Vector2.Lerp(G[0],G[2],h/j),s=H.Vector2.Lerp(G[1],G[2],h/j),N=j===h?G[2]:H.Vector2.Lerp(B,s,D/(j-h));q.push(v.x*t,v.y*S,v.z*k),c.push(r.x,r.y,r.z),y.push(N.x,R.c?1-N.y:N.y),U.push(b),b++};for(let h=0;h<j;h++)for(let o=0;o+h<j;o++)D(o,h,o+1/3,h+1/3),D(o+1,h,o+1/3,h+1/3),D(o,h+1,o+1/3,h+1/3),o+h+1<j&&(D(o+1,h,o+2/3,h+2/3),D(o+1,h+1,o+2/3,h+2/3),D(o,h+1,o+2/3,h+2/3))}M.d._ComputeSides(h,q,U,c,y,D.frontUVs,D.backUVs);const J=new M.d;return J.indices=U,J.JD=q,J.OD=c,J.LD=y,J}function F(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const H=new g.d(D,o);h.sideOrientation=g.d._GetDefaultSideOrientation(h.sideOrientation),H._originalBuilderSideOrientation=h.sideOrientation;return n(h).ZD(H,h.updatable),H}M.d.CreatePolyhedron=I,g.d.CreatePolyhedron=(D,h,o)=>P(D,h,o);M.d.CreateIcoSphere=n,g.d.CreateIcoSphere=(D,h,o)=>F(D,h,o);var w=o(12842);const Y=new H.Gh(1,0,0),l=new H.Gh(-1,0,0),C=new H.Gh(0,1,0),z=new H.Gh(0,-1,0),f=new H.Gh(0,0,1),V=new H.Gh(0,0,-1);class d{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H.Gh.Zero(),h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.Gh.Up(),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H.Vector2.Zero(),g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=D,this.normal=h,this.uv=o,this.vertexIdx=g,this.vertexIdxForBones=j,this.localPositionOverride=M,this.localNormalOverride=R,this.matrixIndicesOverride=t,this.matrixWeightsOverride=S}clone(){var D,h,o,H;return new d(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(D=this.localPositionOverride)||void 0===D?void 0:D.slice(),null===(h=this.localNormalOverride)||void 0===h?void 0:h.slice(),null===(o=this.matrixIndicesOverride)||void 0===o?void 0:o.slice(),null===(H=this.matrixWeightsOverride)||void 0===H?void 0:H.slice())}}function X(D,h,o){var t,S,k,K,Q;const v=!!h.skeleton,r=!(null===(t=h.morphTargetManager)||void 0===t||!t.numTargets),B=o.localMode||v,s=h.jg(),U=v||r?h.Ot(!0,!0):h.getVerticesData(j.f.PositionKind),q=v||r?h.getNormalsData(!0,!0):h.getVerticesData(j.f.NormalKind),c=B?v?h.getVerticesData(j.f.PositionKind):U:null,y=B?v?h.getVerticesData(j.f.NormalKind):q:null,b=h.getVerticesData(j.f.UVKind),i=v?h.getVerticesData(j.f.MatricesIndicesKind):null,G=v?h.getVerticesData(j.f.MatricesWeightsKind):null,N=v?h.getVerticesData(j.f.MatricesIndicesExtraKind):null,J=v?h.getVerticesData(j.f.MatricesWeightsExtraKind):null,O=o.position||H.Gh.Zero();let E=o.normal||H.Gh.Up();const L=o.size||H.Gh.One(),T=o.angle||0;if(!E){const D=new H.Gh(0,0,1),o=h.GD().activeCamera,g=H.Gh.TransformCoordinates(D,o.getWorldMatrix());E=o.globalPosition.Nh(g)}const Z=-Math.atan2(E.z,E.x)-Math.PI/2,e=Math.sqrt(E.x*E.x+E.z*E.z),p=Math.atan2(E.y,e),mD=new M.d;mD.indices=[],mD.JD=[],mD.OD=[],mD.LD=[],mD.matricesIndices=v?[]:null,mD.matricesWeights=v?[]:null,mD.matricesIndicesExtra=N?[]:null,mD.matricesWeightsExtra=J?[]:null;let a=0;const u=(D,h)=>{const g=new d;if(!s||!U||!q)return g;const j=s[D];if(g.vertexIdx=3*j,g.vertexIdxForBones=4*j,g.position=new H.Gh(U[3*j],U[3*j+1],U[3*j+2]),H.Gh.TransformCoordinatesToRef(g.position,h,g.position),g.normal=new H.Gh(q[3*j],q[3*j+1],q[3*j+2]),H.Gh.TransformNormalToRef(g.normal,h,g.normal),o.captureUVS&&b){const D=b[2*j+1];g.uv=new H.Vector2(b[2*j],R.c?1-D:D)}return g},I=[0,0,0,0],P=(D,h)=>{if(0===D.length)return D;const o=.5*Math.abs(H.Gh.Dot(L,h)),g=(D,h,o,H)=>{for(let g=0;g<H;++g)if(D[o+g]===h)return o+g;return-1},j=(D,j)=>{const M=H.Gh.GetClipFactor(D.position,j.position,h,o);let R=I,t=I;if(i&&G){const h=D.matrixIndicesOverride?0:D.vertexIdxForBones,o=D.matrixIndicesOverride??i,H=D.matrixWeightsOverride??G,S=j.matrixIndicesOverride?0:j.vertexIdxForBones,k=j.matrixIndicesOverride??i,K=j.matrixWeightsOverride??G;R=[0,0,0,0],t=[0,0,0,0];let Q=0;for(let D=0;D<4;++D)if(H[h+D]>0){const j=g(k,o[h+D],S,4);R[Q]=o[h+D],t[Q]=(0,w.Lerp)(H[h+D],j>=0?K[j]:0,M),Q++}for(let D=0;D<4&&Q<4;++D){const H=k[S+D];-1===g(o,H,h,4)&&(R[Q]=H,t[Q]=(0,w.Lerp)(0,K[S+D],M),Q++)}const v=t[0]+t[1]+t[2]+t[3];t[0]/=v,t[1]/=v,t[2]/=v,t[3]/=v}const S=D.localPositionOverride?D.localPositionOverride[0]:(null===c||void 0===c?void 0:c[D.vertexIdx])??0,k=D.localPositionOverride?D.localPositionOverride[1]:(null===c||void 0===c?void 0:c[D.vertexIdx+1])??0,K=D.localPositionOverride?D.localPositionOverride[2]:(null===c||void 0===c?void 0:c[D.vertexIdx+2])??0,Q=j.localPositionOverride?j.localPositionOverride[0]:(null===c||void 0===c?void 0:c[j.vertexIdx])??0,v=j.localPositionOverride?j.localPositionOverride[1]:(null===c||void 0===c?void 0:c[j.vertexIdx+1])??0,r=j.localPositionOverride?j.localPositionOverride[2]:(null===c||void 0===c?void 0:c[j.vertexIdx+2])??0,B=D.localNormalOverride?D.localNormalOverride[0]:(null===y||void 0===y?void 0:y[D.vertexIdx])??0,s=D.localNormalOverride?D.localNormalOverride[1]:(null===y||void 0===y?void 0:y[D.vertexIdx+1])??0,U=D.localNormalOverride?D.localNormalOverride[2]:(null===y||void 0===y?void 0:y[D.vertexIdx+2])??0,q=B+((j.localNormalOverride?j.localNormalOverride[0]:(null===y||void 0===y?void 0:y[j.vertexIdx])??0)-B)*M,b=s+((j.localNormalOverride?j.localNormalOverride[1]:(null===y||void 0===y?void 0:y[j.vertexIdx+1])??0)-s)*M,N=U+((j.localNormalOverride?j.localNormalOverride[2]:(null===y||void 0===y?void 0:y[j.vertexIdx+2])??0)-U)*M,J=Math.sqrt(q*q+b*b+N*N);return new d(H.Gh.Lerp(D.position,j.position,M),H.Gh.Lerp(D.normal,j.normal,M).normalize(),H.Vector2.Lerp(D.uv,j.uv,M),-1,-1,c?[S+(Q-S)*M,k+(v-k)*M,K+(r-K)*M]:null,y?[q/J,b/J,N/J]:null,R,t)};let M=null;D.length>3&&(M=[]);for(let R=0;R<D.length;R+=3){let g=0,t=null,S=null,k=null,K=null;const Q=H.Gh.Dot(D[R].position,h)-o>0,v=H.Gh.Dot(D[R+1].position,h)-o>0,r=H.Gh.Dot(D[R+2].position,h)-o>0;switch(g=(Q?1:0)+(v?1:0)+(r?1:0),g){case 0:D.length>3?(M.push(D[R]),M.push(D[R+1]),M.push(D[R+2])):M=D;break;case 1:if(M=M??new Array,Q&&(t=D[R+1],S=D[R+2],k=j(D[R],t),K=j(D[R],S)),v){t=D[R],S=D[R+2],k=j(D[R+1],t),K=j(D[R+1],S),M.push(k),M.push(S.clone()),M.push(t.clone()),M.push(S.clone()),M.push(k.clone()),M.push(K);break}r&&(t=D[R],S=D[R+1],k=j(D[R+2],t),K=j(D[R+2],S)),t&&S&&k&&K&&(M.push(t.clone()),M.push(S.clone()),M.push(k),M.push(K),M.push(k.clone()),M.push(S.clone()));break;case 2:M=M??new Array,Q||(t=D[R].clone(),S=j(t,D[R+1]),k=j(t,D[R+2]),M.push(t),M.push(S),M.push(k)),v||(t=D[R+1].clone(),S=j(t,D[R+2]),k=j(t,D[R]),M.push(t),M.push(S),M.push(k)),r||(t=D[R+2].clone(),S=j(t,D[R]),k=j(t,D[R+1]),M.push(t),M.push(S),M.push(k))}}return M},n=h instanceof g.d?h:null,F=null===n||void 0===n?void 0:n._thinInstanceDataStorage.matrixData,X=(null===n||void 0===n?void 0:n.ig)||1,A=H.TmpVectors.Matrix[0];A.M(H.Matrix.IdentityReadOnly);for(let g=0;g<X;++g){if(null!==n&&void 0!==n&&n.hasThinInstances&&F){const D=16*g;A.setRowFromFloats(0,F[D+0],F[D+1],F[D+2],F[D+3]),A.setRowFromFloats(1,F[D+4],F[D+5],F[D+6],F[D+7]),A.setRowFromFloats(2,F[D+8],F[D+9],F[D+10],F[D+11]),A.setRowFromFloats(3,F[D+12],F[D+13],F[D+14],F[D+15])}const D=H.Matrix.RotationYawPitchRoll(Z,p,T).multiply(H.Matrix.Translation(O.x,O.y,O.z)),j=H.Matrix.Invert(D),M=h.getWorldMatrix(),t=A.multiply(M).multiply(j),S=new Array(3);for(let h=0;h<s.length;h+=3){let D=S;if(D[0]=u(h,t),D[1]=u(h+1,t),D[2]=u(h+2,t),!(o.cullBackFaces&&-D[0].normal.z<=0&&-D[1].normal.z<=0&&-D[2].normal.z<=0)&&(D=P(D,Y),D&&(D=P(D,l),D&&(D=P(D,C),D&&(D=P(D,z),D&&(D=P(D,f),D&&(D=P(D,V),D)))))))for(let h=0;h<D.length;h++){const H=D[h];if(mD.indices.push(a),B?(H.localPositionOverride?(mD.JD[3*a]=H.localPositionOverride[0],mD.JD[3*a+1]=H.localPositionOverride[1],mD.JD[3*a+2]=H.localPositionOverride[2]):c&&(mD.JD[3*a]=c[H.vertexIdx],mD.JD[3*a+1]=c[H.vertexIdx+1],mD.JD[3*a+2]=c[H.vertexIdx+2]),H.localNormalOverride?(mD.OD[3*a]=H.localNormalOverride[0],mD.OD[3*a+1]=H.localNormalOverride[1],mD.OD[3*a+2]=H.localNormalOverride[2]):y&&(mD.OD[3*a]=y[H.vertexIdx],mD.OD[3*a+1]=y[H.vertexIdx+1],mD.OD[3*a+2]=y[H.vertexIdx+2])):(H.position.toArray(mD.JD,3*a),H.normal.toArray(mD.OD,3*a)),mD.matricesIndices&&mD.matricesWeights&&(H.matrixIndicesOverride?(mD.matricesIndices[4*a]=H.matrixIndicesOverride[0],mD.matricesIndices[4*a+1]=H.matrixIndicesOverride[1],mD.matricesIndices[4*a+2]=H.matrixIndicesOverride[2],mD.matricesIndices[4*a+3]=H.matrixIndicesOverride[3]):(i&&(mD.matricesIndices[4*a]=i[H.vertexIdxForBones],mD.matricesIndices[4*a+1]=i[H.vertexIdxForBones+1],mD.matricesIndices[4*a+2]=i[H.vertexIdxForBones+2],mD.matricesIndices[4*a+3]=i[H.vertexIdxForBones+3]),N&&mD.matricesIndicesExtra&&(mD.matricesIndicesExtra[4*a]=N[H.vertexIdxForBones],mD.matricesIndicesExtra[4*a+1]=N[H.vertexIdxForBones+1],mD.matricesIndicesExtra[4*a+2]=N[H.vertexIdxForBones+2],mD.matricesIndicesExtra[4*a+3]=N[H.vertexIdxForBones+3])),H.matrixWeightsOverride?(mD.matricesWeights[4*a]=H.matrixWeightsOverride[0],mD.matricesWeights[4*a+1]=H.matrixWeightsOverride[1],mD.matricesWeights[4*a+2]=H.matrixWeightsOverride[2],mD.matricesWeights[4*a+3]=H.matrixWeightsOverride[3]):(G&&(mD.matricesWeights[4*a]=G[H.vertexIdxForBones],mD.matricesWeights[4*a+1]=G[H.vertexIdxForBones+1],mD.matricesWeights[4*a+2]=G[H.vertexIdxForBones+2],mD.matricesWeights[4*a+3]=G[H.vertexIdxForBones+3]),J&&mD.matricesWeightsExtra&&(mD.matricesWeightsExtra[4*a]=J[H.vertexIdxForBones],mD.matricesWeightsExtra[4*a+1]=J[H.vertexIdxForBones+1],mD.matricesWeightsExtra[4*a+2]=J[H.vertexIdxForBones+2],mD.matricesWeightsExtra[4*a+3]=J[H.vertexIdxForBones+3]))),o.captureUVS)H.uv.toArray(mD.LD,2*a);else{mD.LD.push(.5+H.position.x/L.x);const D=.5+H.position.y/L.y;mD.LD.push(R.c?1-D:D)}a++}}}0===mD.indices.length&&(mD.indices=null),0===mD.JD.length&&(mD.JD=null),0===mD.OD.length&&(mD.OD=null),0===mD.LD.length&&(mD.LD=null),0===(null===(S=mD.matricesIndices)||void 0===S?void 0:S.length)&&(mD.matricesIndices=null),0===(null===(k=mD.matricesWeights)||void 0===k?void 0:k.length)&&(mD.matricesWeights=null),0===(null===(K=mD.matricesIndicesExtra)||void 0===K?void 0:K.length)&&(mD.matricesIndicesExtra=null),0===(null===(Q=mD.matricesWeightsExtra)||void 0===Q?void 0:Q.length)&&(mD.matricesWeightsExtra=null);const W=new g.d(D,h.GD());return mD.ZD(W),B?(W.skeleton=h.skeleton,W.parent=h):(W.position=O.clone(),W.rotation=new H.Gh(p,Z,T)),W.xh(!0),W.refreshBoundingInfo(!0,!0),W}function A(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const h=0|Math.max(D.subdivisions?D.subdivisions:2,1),o=0|Math.max(D.tessellation?D.tessellation:16,3),g=Math.max(D.height?D.height:1,0),j=Math.max(D.radius?D.radius:.25,0),t=0|Math.max(D.capSubdivisions?D.capSubdivisions:6,1),S=o,k=h,K=Math.max(D.radiusTop?D.radiusTop:j,0),Q=Math.max(D.radiusBottom?D.radiusBottom:j,0),v=g-(K+Q),r=2*Math.PI,B=Math.max(D.topCapSubdivisions?D.topCapSubdivisions:t,1),s=Math.max(D.bottomCapSubdivisions?D.bottomCapSubdivisions:t,1),U=Math.acos((Q-K)/g);let q=[];const c=[],y=[],b=[];let i=0;const G=[],N=.5*v,J=.5*Math.PI;let O,E;const L=H.Gh.Zero(),T=H.Gh.Zero(),Z=Math.cos(U),e=Math.sin(U),p=new H.Vector2(K*e,N+K*Z).Nh(new H.Vector2(Q*e,Q*Z-N)).length(),mD=K*U+p+Q*(J-U);let a=0;for(E=0;E<=B;E++){const D=[],h=J-U*(E/B);a+=K*U/B;const o=Math.cos(h),H=Math.sin(h),g=o*K;for(O=0;O<=S;O++){const h=O/S,j=h*r+0,M=Math.sin(j),t=Math.cos(j);T.x=g*M,T.y=N+H*K,T.z=g*t,c.push(T.x,T.y,T.z),L.set(o*M,H,o*t),y.push(L.x,L.y,L.z),b.push(h,R.c?a/mD:1-a/mD),D.push(i),i++}G.push(D)}const u=g-K-Q+Z*K-Z*Q,I=e*(Q-K)/u;for(E=1;E<=k;E++){const D=[];a+=p/k;const h=e*(E*(Q-K)/k+K);for(O=0;O<=S;O++){const o=O/S,H=o*r+0,g=Math.sin(H),j=Math.cos(H);T.x=h*g,T.y=N+Z*K-E*u/k,T.z=h*j,c.push(T.x,T.y,T.z),L.set(g,I,j).normalize(),y.push(L.x,L.y,L.z),b.push(o,R.c?a/mD:1-a/mD),D.push(i),i++}G.push(D)}for(E=1;E<=s;E++){const D=[],h=J-U-(Math.PI-U)*(E/s);a+=Q*U/s;const o=Math.cos(h),H=Math.sin(h),g=o*Q;for(O=0;O<=S;O++){const h=O/S,j=h*r+0,M=Math.sin(j),t=Math.cos(j);T.x=g*M,T.y=H*Q-N,T.z=g*t,c.push(T.x,T.y,T.z),L.set(o*M,H,o*t),y.push(L.x,L.y,L.z),b.push(h,R.c?a/mD:1-a/mD),D.push(i),i++}G.push(D)}for(O=0;O<S;O++)for(E=0;E<B+k+s;E++){const D=G[E][O],h=G[E+1][O],o=G[E+1][O+1],H=G[E][O+1];q.push(D),q.push(h),q.push(H),q.push(h),q.push(o),q.push(H)}if(q=q.reverse(),D.orientation&&!D.orientation.equals(H.Gh.Up())){const h=new H.Matrix;D.orientation.clone().scale(.5*Math.PI).cross(H.Gh.Up()).toQuaternion().toRotationMatrix(h);const o=H.Gh.Zero();for(let D=0;D<c.length;D+=3)o.set(c[D],c[D+1],c[D+2]),H.Gh.TransformCoordinatesToRef(o.clone(),h,o),c[D]=o.x,c[D+1]=o.y,c[D+2]=o.z}const P=new M.d;return P.JD=c,P.OD=y,P.LD=b,P.indices=q,P}function W(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:H.Gh.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new g.d(D,o);return A(h).ZD(j,h.updatable),j}g.d.CreateDecal=(D,h,o,H,g,j)=>X(D,h,{position:o,normal:H,size:g,angle:j});g.d.CreateCapsule=(D,h,o)=>W(D,h,o),M.d.CreateCapsule=A;var x=o(12658),DD=o(12833);class hD{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=D,this.y=h,D!==Math.floor(D)&&(D=Math.floor(D),x.d.Warn("x is not an integer, floor(x) used")),h!==Math.floor(h)&&(h=Math.floor(h),x.d.Warn("y is not an integer, floor(y) used"))}clone(){return new hD(this.x,this.y)}rotate60About(D){const h=this.x;return this.x=D.x+D.y-this.y,this.y=h+this.y-D.x,this}rotateNeg60About(D){const h=this.x;return this.x=h+this.y-D.y,this.y=D.x+D.y-h,this}rotate120(D,h){D!==Math.floor(D)&&(D=Math.floor(D),x.d.Warn("m not an integer only floor(m) used")),h!==Math.floor(h)&&(h=Math.floor(h),x.d.Warn("n not an integer only floor(n) used"));const o=this.x;return this.x=D-o-this.y,this.y=h+o,this}rotateNeg120(D,h){D!==Math.floor(D)&&(D=Math.floor(D),x.d.Warn("m is not an integer, floor(m) used")),h!==Math.floor(h)&&(h=Math.floor(h),x.d.Warn("n is not an integer,   floor(n) used"));const o=this.x;return this.x=this.y-h,this.y=D+h-o-this.y,this}toCartesianOrigin(D,h){const o=H.Gh.Zero();return o.x=D.x+2*this.x*h+this.y*h,o.y=D.y+Math.sqrt(3)*this.y*h,o}static Zero(){return new hD(0,0)}}class oD{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new HD("icosahedron","Regular",[[0,DD.g,-1],[-DD.g,1,0],[-1,0,-DD.g],[1,0,-DD.g],[DD.g,1,0],[0,DD.g,1],[-1,0,DD.g],[-DD.g,-1,0],[0,-DD.g,-1],[DD.g,-1,0],[1,0,DD.g],[0,-DD.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let D=12;const h={},o=this.m,H=this.n;let g,j,M,R,t,S=o,k=1,K=0;0!==H&&(S=(0,w.HighestCommonFactor)(o,H)),k=o/S,K=H/S;const Q=hD.Zero(),v=new hD(o,H),r=new hD(-H,o+H),B=hD.Zero(),s=hD.Zero(),U=hD.Zero();let q,c,y,b,i=[];const G=[],N=this.vertByDist,J=(o,H,g,j)=>{q=o+"|"+g,c=H+"|"+j,q in h||c in h?q in h&&!(c in h)?h[c]=h[q]:c in h&&!(q in h)&&(h[q]=h[c]):(h[q]=D,h[c]=D,D++),N[g][0]>2?G[h[q]]=[-N[g][0],N[g][1],h[q]]:G[h[q]]=[i[N[g][0]],N[g][1],h[q]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let O=0;O<20;O++){if(i=this.IDATA.face[O],M=i[2],R=i[1],t=i[0],y=Q.x+"|"+Q.y,q=O+"|"+y,q in h||(h[q]=M,G[M]=[i[N[y][0]],N[y][1]]),y=v.x+"|"+v.y,q=O+"|"+y,q in h||(h[q]=R,G[R]=[i[N[y][0]],N[y][1]]),y=r.x+"|"+r.y,q=O+"|"+y,q in h||(h[q]=t,G[t]=[i[N[y][0]],N[y][1]]),g=this.IDATA.edgematch[O][0],j=this.IDATA.edgematch[O][1],"B"===j)for(let D=1;D<S;D++)s.x=o-D*(k+K),s.y=H+D*k,U.x=-D*K,U.y=D*(k+K),y=s.x+"|"+s.y,b=U.x+"|"+U.y,J(O,g,y,b);if("O"===j)for(let D=1;D<S;D++)U.x=-D*K,U.y=D*(k+K),B.x=D*k,B.y=D*K,y=U.x+"|"+U.y,b=B.x+"|"+B.y,J(O,g,y,b);if(g=this.IDATA.edgematch[O][2],j=this.IDATA.edgematch[O][3],j&&"A"===j)for(let D=1;D<S;D++)B.x=D*k,B.y=D*K,s.x=o-(S-D)*(k+K),s.y=H+(S-D)*k,y=B.x+"|"+B.y,b=s.x+"|"+s.y,J(O,g,y,b);for(let o=0;o<this.vertices.length;o++)y=this.vertices[o].x+"|"+this.vertices[o].y,q=O+"|"+y,q in h||(h[q]=D++,N[y][0]>2?G[h[q]]=[-N[y][0],N[y][1],h[q]]:G[h[q]]=[i[N[y][0]],N[y][1],h[q]])}this.closestTo=G,this.vecToidx=h}calcCoeffs(){const D=this.m,h=this.n,o=Math.sqrt(3)/3,H=D*D+h*h+D*h;this.coau=(D+h)/H,this.cobu=-h/H,this.coav=-o*(D-h)/H,this.cobv=o*(2*D+h)/H}createInnerFacets(){const D=this.m,h=this.n;for(let o=0;o<h+D+1;o++)for(let D=this.min[o];D<this.max[o]+1;D++)D<this.max[o]&&D<this.max[o+1]+1&&this.innerFacets.push(["|"+D+"|"+o,"|"+D+"|"+(o+1),"|"+(D+1)+"|"+o]),o>0&&D<this.max[o-1]&&D+1<this.max[o]+1&&this.innerFacets.push(["|"+D+"|"+o,"|"+(D+1)+"|"+o,"|"+(D+1)+"|"+(o-1)])}edgeVecsABOB(){const D=this.m,h=this.n,o=new hD(-h,D+h);for(let H=1;H<D+h;H++){const D=new hD(this.min[H],H),h=new hD(this.min[H-1],H-1),g=new hD(this.min[H+1],H+1),j=D.clone(),M=h.clone(),R=g.clone();j.rotate60About(o),M.rotate60About(o),R.rotate60About(o);const t=new hD(this.max[j.y],j.y),S=new hD(this.max[j.y-1],j.y-1),k=new hD(this.max[j.y-1]-1,j.y-1);j.x===t.x&&j.y===t.y||(j.x!==S.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([D,S,k]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([D,k,t])):j.y===R.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([D,h,S]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([D,S,g])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([D,h,S]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([D,S,t])))}}mapABOBtoOBOA(){const D=new hD(0,0);for(let h=0;h<this.isoVecsABOB.length;h++){const o=[];for(let H=0;H<3;H++)D.x=this.isoVecsABOB[h][H].x,D.y=this.isoVecsABOB[h][H].y,0===this.vertexTypes[h][H]&&D.rotateNeg120(this.m,this.n),o.push(D.clone());this.isoVecsOBOA.push(o)}}mapABOBtoBAOA(){const D=new hD(0,0);for(let h=0;h<this.isoVecsABOB.length;h++){const o=[];for(let H=0;H<3;H++)D.x=this.isoVecsABOB[h][H].x,D.y=this.isoVecsABOB[h][H].y,1===this.vertexTypes[h][H]&&D.rotate120(this.m,this.n),o.push(D.clone());this.isoVecsBAOA.push(o)}}MapToFace(D,h){const o=this.IDATA.face[D],g=o[2],j=o[1],M=o[0],R=H.Gh.Ih(this.IDATA.vertex[g]),t=H.Gh.Ih(this.IDATA.vertex[j]),S=H.Gh.Ih(this.IDATA.vertex[M]),k=t.Nh(R),K=S.Nh(R),Q=k.scale(this.coau).add(K.scale(this.cobu)),v=k.scale(this.coav).add(K.scale(this.cobv)),r=[];let B,s=H.TmpVectors.Gh[0];for(let H=0;H<this.cartesian.length;H++)s=Q.scale(this.cartesian[H].x).add(v.scale(this.cartesian[H].y)).add(R),r[H]=[s.x,s.y,s.z],B=D+"|"+this.vertices[H].x+"|"+this.vertices[H].y,h.vertex[this.vecToidx[B]]=[s.x,s.y,s.z]}build(D,h){const o=[],H=hD.Zero(),g=new hD(D,h),j=new hD(-h,D+h);o.push(H,g,j);for(let y=h;y<D+1;y++)for(let h=0;h<D+1-y;h++)o.push(new hD(h,y));if(h>0){const H=(0,w.HighestCommonFactor)(D,h),g=D/H,j=h/H;for(let R=1;R<H;R++)o.push(new hD(R*g,R*j)),o.push(new hD(-R*j,R*(g+j))),o.push(new hD(D-R*(g+j),h+R*g));const M=D/h;for(let R=1;R<h;R++)for(let H=0;H<R*M;H++)o.push(new hD(H,R)),o.push(new hD(H,R).rotate120(D,h)),o.push(new hD(H,R).rotateNeg120(D,h))}o.sort(((D,h)=>D.x-h.x)),o.sort(((D,h)=>D.y-h.y));const M=new Array(D+h+1),R=new Array(D+h+1);for(let y=0;y<M.length;y++)M[y]=1/0,R[y]=-1/0;let t=0,S=0;const k=o.length;for(let y=0;y<k;y++)S=o[y].x,t=o[y].y,M[t]=Math.min(S,M[t]),R[t]=Math.max(S,R[t]);const K=(o,H)=>{const g=o.clone();return"A"===H&&g.rotateNeg120(D,h),"B"===H&&g.rotate120(D,h),g.x<0?g.y:g.x+g.y},Q=[],v=[],r=[],B=[],s={},U=[];let q=-1,c=-1;for(let y=0;y<k;y++)Q[y]=o[y].toCartesianOrigin(new hD(0,0),.5),v[y]=K(o[y],"O"),r[y]=K(o[y],"A"),B[y]=K(o[y],"B"),v[y]===r[y]&&r[y]===B[y]?(q=3,c=v[y]):v[y]===r[y]?(q=4,c=v[y]):r[y]===B[y]?(q=5,c=r[y]):B[y]===v[y]&&(q=6,c=v[y]),v[y]<r[y]&&v[y]<B[y]&&(q=2,c=v[y]),r[y]<v[y]&&r[y]<B[y]&&(q=1,c=r[y]),B[y]<r[y]&&B[y]<v[y]&&(q=0,c=B[y]),U.push([q,c,o[y].x,o[y].y]);U.sort(((D,h)=>D[2]-h[2])),U.sort(((D,h)=>D[3]-h[3])),U.sort(((D,h)=>D[1]-h[1])),U.sort(((D,h)=>D[0]-h[0]));for(let y=0;y<U.length;y++)s[U[y][2]+"|"+U[y][3]]=[U[y][0],U[y][1],y];return this.m=D,this.n=h,this.vertices=o,this.vertByDist=s,this.cartesian=Q,this.min=M,this.max=R,this}}class HD{constructor(D,h,o,H){this.name=D,this.category=h,this.vertex=o,this.face=H}}class gD extends HD{innerToData(D,h){for(let o=0;o<h.innerFacets.length;o++)this.face.push(h.innerFacets[o].map((o=>h.vecToidx[D+o])))}mapABOBtoDATA(D,h){const o=h.IDATA.edgematch[D][0];for(let H=0;H<h.isoVecsABOB.length;H++){const g=[];for(let j=0;j<3;j++)0===h.vertexTypes[H][j]?g.push(D+"|"+h.isoVecsABOB[H][j].x+"|"+h.isoVecsABOB[H][j].y):g.push(o+"|"+h.isoVecsABOB[H][j].x+"|"+h.isoVecsABOB[H][j].y);this.face.push([h.vecToidx[g[0]],h.vecToidx[g[1]],h.vecToidx[g[2]]])}}mapOBOAtoDATA(D,h){const o=h.IDATA.edgematch[D][0];for(let H=0;H<h.isoVecsOBOA.length;H++){const g=[];for(let j=0;j<3;j++)1===h.vertexTypes[H][j]?g.push(D+"|"+h.isoVecsOBOA[H][j].x+"|"+h.isoVecsOBOA[H][j].y):g.push(o+"|"+h.isoVecsOBOA[H][j].x+"|"+h.isoVecsOBOA[H][j].y);this.face.push([h.vecToidx[g[0]],h.vecToidx[g[1]],h.vecToidx[g[2]]])}}mapBAOAtoDATA(D,h){const o=h.IDATA.edgematch[D][2];for(let H=0;H<h.isoVecsBAOA.length;H++){const g=[];for(let j=0;j<3;j++)1===h.vertexTypes[H][j]?g.push(D+"|"+h.isoVecsBAOA[H][j].x+"|"+h.isoVecsBAOA[H][j].y):g.push(o+"|"+h.isoVecsBAOA[H][j].x+"|"+h.isoVecsBAOA[H][j].y);this.face.push([h.vecToidx[g[0]],h.vecToidx[g[1]],h.vecToidx[g[2]]])}}orderData(D){const h=[];for(let j=0;j<13;j++)h[j]=[];const o=D.closestTo;for(let j=0;j<o.length;j++)o[j][0]>-1?o[j][1]>0&&h[o[j][0]].push([j,o[j][1]]):h[12].push([j,o[j][0]]);const H=[];for(let j=0;j<12;j++)H[j]=j;let g=12;for(let j=0;j<12;j++){h[j].sort(((D,h)=>D[1]-h[1]));for(let D=0;D<h[j].length;D++)H[h[j][D][0]]=g++}for(let j=0;j<h[12].length;j++)H[h[12][j][0]]=g++;for(let j=0;j<this.vertex.length;j++)this.vertex[j].push(H[j]);this.vertex.sort(((D,h)=>D[3]-h[3]));for(let j=0;j<this.vertex.length;j++)this.vertex[j].pop();for(let j=0;j<this.face.length;j++)for(let D=0;D<this.face[j].length;D++)this.face[j][D]=H[this.face[j][D]];this.sharedNodes=h[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(D,h){const o=[],H=[];let g=h.pop();H.push(g);let j=this.face[g].indexOf(D);j=(j+2)%3;let M=this.face[g][j];o.push(M);let R=0;for(;h.length>0;)g=h[R],this.face[g].indexOf(M)>-1?(j=(this.face[g].indexOf(M)+1)%3,M=this.face[g][j],o.push(M),H.push(g),h.splice(R,1),R=0):R++;return this.adjacentFaces.push(o),H}toGoldbergPolyhedronData(){const D=new HD("GeoDual","Goldberg",[],[]);D.name="GD dual";const h=this.vertex.length,o=new Array(h);for(let t=0;t<h;t++)o[t]=[];for(let t=0;t<this.face.length;t++)for(let D=0;D<3;D++)o[this.face[t][D]].push(t);let H=0,g=0,j=0,M=[],R=[];this.adjacentFaces=[];for(let t=0;t<o.length;t++){D.face[t]=this.setOrder(t,o[t].concat([]));for(const h of o[t]){H=0,g=0,j=0,M=this.face[h];for(let D=0;D<3;D++)R=this.vertex[M[D]],H+=R[0],g+=R[1],j+=R[2];D.vertex[h]=[H/3,g/3,j/3]}}return D}static BuildGeodesicData(D){const h=new gD("Geodesic-m-n","Geodesic",[[0,DD.g,-1],[-DD.g,1,0],[-1,0,-DD.g],[1,0,-DD.g],[DD.g,1,0],[0,DD.g,1],[-1,0,DD.g],[-DD.g,-1,0],[0,-DD.g,-1],[DD.g,-1,0],[1,0,DD.g],[0,-DD.g,1]],[]);D.setIndices(),D.calcCoeffs(),D.createInnerFacets(),D.edgeVecsABOB(),D.mapABOBtoOBOA(),D.mapABOBtoBAOA();for(let o=0;o<D.IDATA.face.length;o++)D.MapToFace(o,h),h.innerToData(o,D),"B"===D.IDATA.edgematch[o][1]&&h.mapABOBtoDATA(o,D),"O"===D.IDATA.edgematch[o][1]&&h.mapOBOAtoDATA(o,D),"A"===D.IDATA.edgematch[o][3]&&h.mapBAOAtoDATA(o,D);h.orderData(D);return h.vertex=h.vertex.map((function(D){const h=D[0],o=D[1],H=D[2],g=Math.sqrt(h*h+o*o+H*H);return D[0]*=1/g,D[1]*=1/g,D[2]*=1/g,D})),h}}g.d._GoldbergMeshParser=(D,h)=>jD.Parse(D,h);class jD extends g.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(D,h){return void 0===h?(D>this.goldbergData.nbUnsharedFaces-1&&(x.d.Warn("Maximum number of unshared faces used"),D=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+D):(D>11&&(x.d.Warn("Last pole used"),D=11),h>this.goldbergData.nbFacesAtPole-1&&(x.d.Warn("Maximum number of faces at a pole used"),h=this.goldbergData.nbFacesAtPole-1),12+D*this.goldbergData.nbFacesAtPole+h)}_changeGoldbergFaceColors(D){for(let o=0;o<D.length;o++){const h=D[o][0],H=D[o][1],g=D[o][2];for(let D=h;D<H+1;D++)this.goldbergData.faceColors[D]=g}const h=[];for(let o=0;o<12;o++)for(let D=0;D<5;D++)h.push(this.goldbergData.faceColors[o].r,this.goldbergData.faceColors[o].g,this.goldbergData.faceColors[o].b,this.goldbergData.faceColors[o].a);for(let o=12;o<this.goldbergData.faceColors.length;o++)for(let D=0;D<6;D++)h.push(this.goldbergData.faceColors[o].r,this.goldbergData.faceColors[o].g,this.goldbergData.faceColors[o].b,this.goldbergData.faceColors[o].a);return h}setGoldbergFaceColors(D){const h=this._changeGoldbergFaceColors(D);this.aD(j.f.ColorKind,h)}updateGoldbergFaceColors(D){const h=this._changeGoldbergFaceColors(D);this.updateVerticesData(j.f.ColorKind,h)}_changeGoldbergFaceUVs(D){const h=this.getVerticesData(j.f.UVKind);for(let o=0;o<D.length;o++){const H=D[o][0],g=D[o][1],j=D[o][2],M=D[o][3],R=D[o][4],t=[],S=[];let k,K;for(let D=0;D<5;D++)k=j.x+M*Math.cos(R+D*Math.PI/2.5),K=j.y+M*Math.sin(R+D*Math.PI/2.5),k<0&&(k=0),k>1&&(k=1),t.push(k,K);for(let D=0;D<6;D++)k=j.x+M*Math.cos(R+D*Math.PI/3),K=j.y+M*Math.sin(R+D*Math.PI/3),k<0&&(k=0),k>1&&(k=1),S.push(k,K);for(let D=H;D<Math.min(12,g+1);D++)for(let o=0;o<5;o++)h[10*D+2*o]=t[2*o],h[10*D+2*o+1]=t[2*o+1];for(let D=Math.max(12,H);D<g+1;D++)for(let o=0;o<6;o++)h[12*D-24+2*o]=S[2*o],h[12*D-23+2*o]=S[2*o+1]}return h}setGoldbergFaceUVs(D){const h=this._changeGoldbergFaceUVs(D);this.aD(j.f.UVKind,h)}updateGoldbergFaceUVs(D){const h=this._changeGoldbergFaceUVs(D);this.updateVerticesData(j.f.UVKind,h)}placeOnGoldbergFaceAt(D,h,o){const g=H.Gh.RotationFromAxis(this.goldbergData.faceXaxis[h],this.goldbergData.faceYaxis[h],this.goldbergData.faceZaxis[h]);D.rotation=g,D.position=this.goldbergData.faceCenters[h].add(this.goldbergData.faceXaxis[h].scale(o.x)).add(this.goldbergData.faceYaxis[h].scale(o.y)).add(this.goldbergData.faceZaxis[h].scale(o.z))}serialize(D){super.serialize(D),D.type="GoldbergMesh";const h={};if(h.adjacentFaces=this.goldbergData.adjacentFaces,h.nbSharedFaces=this.goldbergData.nbSharedFaces,h.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,h.nbFaces=this.goldbergData.nbFaces,h.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){h.faceColors=[];for(const D of this.goldbergData.faceColors)h.faceColors.push(D.Fh())}if(this.goldbergData.faceCenters){h.faceCenters=[];for(const D of this.goldbergData.faceCenters)h.faceCenters.push(D.Fh())}if(this.goldbergData.faceZaxis){h.faceZaxis=[];for(const D of this.goldbergData.faceZaxis)h.faceZaxis.push(D.Fh())}if(this.goldbergData.faceYaxis){h.faceYaxis=[];for(const D of this.goldbergData.faceYaxis)h.faceYaxis.push(D.Fh())}if(this.goldbergData.faceXaxis){h.faceXaxis=[];for(const D of this.goldbergData.faceXaxis)h.faceXaxis.push(D.Fh())}D.goldbergData=h}static Parse(D,h){const o=D.goldbergData;o.faceColors=o.faceColors.map((D=>Q.yg.Ih(D))),o.faceCenters=o.faceCenters.map((D=>H.Gh.Ih(D))),o.faceZaxis=o.faceZaxis.map((D=>H.Gh.Ih(D))),o.faceXaxis=o.faceXaxis.map((D=>H.Gh.Ih(D))),o.faceYaxis=o.faceYaxis.map((D=>H.Gh.Ih(D)));const g=new jD(D.name,h);return g.goldbergData=o,g}}var MD=o(13399);const RD={CreateBox:K.d,CreateTiledBox:s,CreateSphere:U.b,CreateDisc:k.c,CreateIcoSphere:F,CreateRibbon:S,CreateCylinder:b,CreateTorus:G,CreateTorusKnot:J,CreateLineSystem:O.c,kk:O.d,CreateDashedLines:O.b,ExtrudeShape:T,ExtrudeShapeCustom:Z,CreateLathe:p,CreateTiledPlane:r,vk:mD.b,CreateGround:a.g,CreateTiledGround:a.h,CreateGroundFromHeightMap:a.d,CreatePolygon:E.b,ExtrudePolygon:E.f,CreateTube:u,CreatePolyhedron:P,CreateGeodesic:function(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=h.m||1;H!==Math.floor(H)&&(H=Math.floor(H),x.d.Warn("m not an integer only floor(m) used"));let g=h.n||0;if(g!==Math.floor(g)&&(g=Math.floor(g),x.d.Warn("n not an integer only floor(n) used")),g>H){const D=g;g=H,H=D,x.d.Warn("n > m therefore m and n swapped")}const j=new oD;return j.build(H,g),P(D,{custom:gD.BuildGeodesicData(j),size:h.size,sizeX:h.sizeX,sizeY:h.sizeY,sizeZ:h.sizeZ,faceUV:h.faceUV,faceColors:h.faceColors,flat:h.flat,updatable:h.updatable,sideOrientation:h.sideOrientation,frontUVs:h.frontUVs,backUVs:h.backUVs},o)},CreateGoldberg:function(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=h.size,t=h.sizeX||j||1,S=h.sizeY||j||1,k=h.sizeZ||j||1;let K=h.m||1;K!==Math.floor(K)&&(K=Math.floor(K),x.d.Warn("m not an integer only floor(m) used"));let v=h.n||0;if(v!==Math.floor(v)&&(v=Math.floor(v),x.d.Warn("n not an integer only floor(n) used")),v>K){const D=v;v=K,K=D,x.d.Warn("n > m therefore m and n swapped")}const r=new oD;r.build(K,v);const B=gD.BuildGeodesicData(r),s=B.toGoldbergPolyhedronData(),U=new jD(D,o);h.sideOrientation=g.d._GetDefaultSideOrientation(h.sideOrientation),U._originalBuilderSideOrientation=h.sideOrientation;(function(D,h){const o=D.size,g=D.sizeX||o||1,j=D.sizeY||o||1,t=D.sizeZ||o||1,S=0===D.sideOrientation?0:D.sideOrientation||M.d.DEFAULTSIDE,k=[],K=[],Q=[],v=[];let r=1/0,B=-1/0,s=1/0,U=-1/0;for(let H=0;H<h.vertex.length;H++)r=Math.min(r,h.vertex[H][0]*g),B=Math.max(B,h.vertex[H][0]*g),s=Math.min(s,h.vertex[H][1]*j),U=Math.max(U,h.vertex[H][1]*j);let q=0;for(let M=0;M<h.face.length;M++){const D=h.face[M],o=H.Gh.Ih(h.vertex[D[0]]),S=H.Gh.Ih(h.vertex[D[2]]),c=H.Gh.Ih(h.vertex[D[1]]),y=S.Nh(o),b=c.Nh(o),i=H.Gh.Cross(b,y).normalize();for(let H=0;H<D.length;H++){Q.push(i.x,i.y,i.z);const o=h.vertex[D[H]];k.push(o[0]*g,o[1]*j,o[2]*t);const M=(o[1]*j-s)/(U-s);v.push((o[0]*g-r)/(B-r),R.c?1-M:M)}for(let h=0;h<D.length-2;h++)K.push(q,q+h+2,q+h+1);q+=D.length}M.d._ComputeSides(S,k,K,Q,v);const c=new M.d;return c.JD=k,c.indices=K,c.OD=Q,c.LD=v,c})(h,s).ZD(U,h.updatable),U.goldbergData.nbSharedFaces=B.sharedNodes,U.goldbergData.nbUnsharedFaces=B.poleNodes,U.goldbergData.adjacentFaces=B.adjacentFaces,U.goldbergData.nbFaces=U.goldbergData.nbSharedFaces+U.goldbergData.nbUnsharedFaces,U.goldbergData.nbFacesAtPole=(U.goldbergData.nbUnsharedFaces-12)/12;for(let g=0;g<B.vertex.length;g++)U.goldbergData.faceCenters.push(H.Gh.Ih(B.vertex[g])),U.goldbergData.faceCenters[g].x*=t,U.goldbergData.faceCenters[g].y*=S,U.goldbergData.faceCenters[g].z*=k,U.goldbergData.faceColors.push(new Q.yg(1,1,1,1));for(let g=0;g<s.face.length;g++){const D=s.face[g],h=H.Gh.Ih(s.vertex[D[0]]),o=H.Gh.Ih(s.vertex[D[2]]),j=H.Gh.Ih(s.vertex[D[1]]),M=o.Nh(h),R=j.Nh(h),t=H.Gh.Cross(R,M).normalize(),S=H.Gh.Cross(R,t).normalize();U.goldbergData.faceXaxis.push(R.normalize()),U.goldbergData.faceYaxis.push(t),U.goldbergData.faceZaxis.push(S)}return U},CreateDecal:X,CreateCapsule:W,CreateText:MD.f}},13973:(D,h,o)=>{"use strict";o.d(h,{c:()=>Rh});var H=o(12831),g=o(13213);class j extends g.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var M=o(12870),R=(o(12989),o(12793));class t{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(D){this._targetStopDuration!==D&&(this._targetStopDuration=D)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(D){this._noiseTexture!==D&&(this._noiseTexture=D,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(D){this._animationSheetEnabled!==D&&(this._animationSheetEnabled=D)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(D){this._isAnimationSheetEnabled!=D&&(this._isAnimationSheetEnabled=D,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(D){this._useLogarithmicDepth=D&&this.GD().getEngine().getCaps().fragmentDepthSupported}GD(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(D){switch(D){case t.BLENDMODE_MULTIPLYADD:return;case t.BLENDMODE_ADD:D=1;break;case t.BLENDMODE_ONEONE:D=6;break;case t.BLENDMODE_STANDARD:D=2;break;case t.BLENDMODE_MULTIPLY:D=4;break;case t.BLENDMODE_SUBTRACT:D=3}this._engine.setAlphaMode(D)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:H.Gh.Zero()}set direction1(D){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=D)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:H.Gh.Zero()}set direction2(D){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=D)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:H.Gh.Zero()}set minEmitBox(D){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=D)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:H.Gh.Zero()}set maxEmitBox(D){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=D)}get billboardMode(){return this._billboardMode}set billboardMode(D){this._billboardMode!==D&&(this._billboardMode=D,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(D){this._isBillboardBased!==D&&(this._isBillboardBased=D,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(D){this._attachImageProcessingConfiguration(D)}_attachImageProcessingConfiguration(D){D!==this._imageProcessingConfiguration&&(!D&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=D)}_reset(){}_removeGradientAndTexture(D,h,o){if(!h)return this;let H=0;for(const g of h){if(g.gradient===D){h.splice(H,1);break}H++}return o&&o.dispose(),this}constructor(D){this.animations=[],this.renderingGroupId=0,this.Hh=H.Gh.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new H.Gh(10,10,10),this.onAnimationEnd=null,this.blendMode=t.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new H.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Rk=new H.Gh(0,0,0),this._useLogarithmicDepth=!1,this.gravity=H.Gh.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new M.yg(1,1,1,1),this.color2=new M.yg(1,1,1,1),this.colorDead=new M.yg(0,0,0,1),this.textureMask=new M.yg(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new j,this.id=D,this.name=D}createPointEmitter(D,h){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new H.Gh(0,1,0),arguments.length>2&&void 0!==arguments[2]||new H.Gh(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new H.Gh(0,1,0),arguments.length>4&&void 0!==arguments[4]||new H.Gh(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new H.Gh(0,1,0),arguments.length>3&&void 0!==arguments[3]||new H.Gh(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(D,h,o,H){throw new Error("Method not implemented.")}}t.BLENDMODE_ONEONE=0,t.BLENDMODE_STANDARD=1,t.BLENDMODE_ADD=2,t.BLENDMODE_MULTIPLY=3,t.BLENDMODE_MULTIPLYADD=4,t.BLENDMODE_SUBTRACT=-1,(0,R.g)("BABYLON.BaseParticleSystem",t);var S=o(12842),k=o(12664);class K{constructor(){this.direction1=new H.Gh(0,1,0),this.direction2=new H.Gh(0,1,0),this.minEmitBox=new H.Gh(-.5,-.5,-.5),this.maxEmitBox=new H.Gh(.5,.5,.5)}startDirectionFunction(D,h,o,g){const j=(0,S.RandomRange)(this.direction1.x,this.direction2.x),M=(0,S.RandomRange)(this.direction1.y,this.direction2.y),R=(0,S.RandomRange)(this.direction1.z,this.direction2.z);if(g)return h.x=j,h.y=M,void(h.z=R);H.Gh.TransformNormalFromFloatsToRef(j,M,R,D,h)}startPositionFunction(D,h,o,g){const j=(0,S.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),M=(0,S.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),R=(0,S.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(g)return h.x=j,h.y=M,void(h.z=R);H.Gh.TransformCoordinatesFromFloatsToRef(j,M,R,D,h)}clone(){const D=new K;return k.d.DeepCopy(this,D),D}applyToShader(D){D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2),D.setVector3("minEmitBox",this.minEmitBox),D.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(D){D.addUniform("direction1",3),D.addUniform("direction2",3),D.addUniform("minEmitBox",3),D.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.direction1=this.direction1.Fh(),D.direction2=this.direction2.Fh(),D.minEmitBox=this.minEmitBox.Fh(),D.maxEmitBox=this.maxEmitBox.Fh(),D}parse(D){H.Gh.FromArrayToRef(D.direction1,0,this.direction1),H.Gh.FromArrayToRef(D.direction2,0,this.direction2),H.Gh.FromArrayToRef(D.minEmitBox,0,this.minEmitBox),H.Gh.FromArrayToRef(D.maxEmitBox,0,this.maxEmitBox)}}class Q{get radius(){return this._radius}set radius(D){this._radius=D,this._buildHeight()}get angle(){return this._angle}set angle(D){this._angle=D,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=o,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=h,this.radius=D}startDirectionFunction(D,h,o,g){g?H.TmpVectors.Gh[0].M(o.nt).normalize():o.position.subtractToRef(D.getTranslation(),H.TmpVectors.Gh[0]).normalize();const j=(0,S.RandomRange)(0,this.directionRandomizer),M=(0,S.RandomRange)(0,this.directionRandomizer),R=(0,S.RandomRange)(0,this.directionRandomizer);h.x=H.TmpVectors.Gh[0].x+j,h.y=H.TmpVectors.Gh[0].y+M,h.z=H.TmpVectors.Gh[0].z+R,h.normalize()}startPositionFunction(D,h,o,g){const j=(0,S.RandomRange)(0,2*Math.PI);let M;this.emitFromSpawnPointOnly?M=1e-4:(M=(0,S.RandomRange)(0,this.heightRange),M=1-M*M);let R=this._radius-(0,S.RandomRange)(0,this._radius*this.radiusRange);R*=M;const t=R*Math.sin(j),k=R*Math.cos(j),K=M*this._height;if(g)return h.x=t,h.y=K,void(h.z=k);H.Gh.TransformCoordinatesFromFloatsToRef(t,K,k,D,h)}clone(){const D=new Q(this._radius,this._angle,this.directionRandomizer);return k.d.DeepCopy(this,D),D}applyToShader(D){D.setFloat2("radius",this._radius,this.radiusRange),D.setFloat("coneAngle",this._angle),D.setFloat2("height",this._height,this.heightRange),D.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(D){D.addUniform("radius",2),D.addUniform("coneAngle",1),D.addUniform("height",2),D.addUniform("directionRandomizer",1)}getEffectDefines(){let D="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(D+="\n#define CONEEMITTERSPAWNPOINT"),D}getClassName(){return"ConeParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.radius=this._radius,D.angle=this._angle,D.directionRandomizer=this.directionRandomizer,D.radiusRange=this.radiusRange,D.heightRange=this.heightRange,D.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,D}parse(D){this.radius=D.radius,this.angle=D.angle,this.directionRandomizer=D.directionRandomizer,this.radiusRange=void 0!==D.radiusRange?D.radiusRange:1,this.heightRange=void 0!==D.radiusRange?D.heightRange:1,this.emitFromSpawnPointOnly=void 0!==D.emitFromSpawnPointOnly&&D.emitFromSpawnPointOnly}}class v extends Q{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.Gh(0,1,0),g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.Gh(0,1,0);super(D,h),this.direction1=o,this.direction2=g}startDirectionFunction(D,h){const o=(0,S.RandomRange)(this.direction1.x,this.direction2.x),g=(0,S.RandomRange)(this.direction1.y,this.direction2.y),j=(0,S.RandomRange)(this.direction1.z,this.direction2.z);H.Gh.TransformNormalFromFloatsToRef(o,g,j,D,h)}clone(){const D=new v(this.radius,this.angle,this.direction1,this.direction2);return k.d.DeepCopy(this,D),D}applyToShader(D){D.setFloat("radius",this.radius),D.setFloat("radiusRange",this.radiusRange),D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("radius",1),D.addUniform("radiusRange",1),D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const D=super.serialize();return D.direction1=this.direction1.Fh(),D.direction2=this.direction2.Fh(),D}parse(D){super.parse(D),this.direction1.M(D.direction1),this.direction2.M(D.direction2)}}class r{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=D,this.height=h,this.radiusRange=o,this.directionRandomizer=g,this._tempVector=H.Gh.Zero()}startDirectionFunction(D,h,o,g,j){o.position.subtractToRef(D.getTranslation(),this._tempVector),this._tempVector.normalize(),H.Gh.TransformNormalToRef(this._tempVector,j,this._tempVector);const M=(0,S.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let R=Math.atan2(this._tempVector.x,this._tempVector.z);R+=(0,S.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=M,this._tempVector.x=Math.sin(R),this._tempVector.z=Math.cos(R),this._tempVector.normalize(),g?h.M(this._tempVector):H.Gh.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,D,h)}startPositionFunction(D,h,o,g){const j=(0,S.RandomRange)(-this.height/2,this.height/2),M=(0,S.RandomRange)(0,2*Math.PI),R=(0,S.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),t=Math.sqrt(R)*this.radius,k=t*Math.cos(M),K=t*Math.sin(M);g?h.Qg(k,j,K):H.Gh.TransformCoordinatesFromFloatsToRef(k,j,K,D,h)}clone(){const D=new r(this.radius,this.directionRandomizer);return k.d.DeepCopy(this,D),D}applyToShader(D){D.setFloat("radius",this.radius),D.setFloat("height",this.height),D.setFloat("radiusRange",this.radiusRange),D.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(D){D.addUniform("radius",1),D.addUniform("height",1),D.addUniform("radiusRange",1),D.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.radius=this.radius,D.height=this.height,D.radiusRange=this.radiusRange,D.directionRandomizer=this.directionRandomizer,D}parse(D){this.radius=D.radius,this.height=D.height,this.radiusRange=D.radiusRange,this.directionRandomizer=D.directionRandomizer}}class B extends r{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.Gh(0,1,0),j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new H.Gh(0,1,0);super(D,h,o),this.direction1=g,this.direction2=j}startDirectionFunction(D,h,o,g){const j=(0,S.RandomRange)(this.direction1.x,this.direction2.x),M=(0,S.RandomRange)(this.direction1.y,this.direction2.y),R=(0,S.RandomRange)(this.direction1.z,this.direction2.z);g?h.Qg(j,M,R):H.Gh.TransformNormalFromFloatsToRef(j,M,R,D,h)}clone(){const D=new B(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return k.d.DeepCopy(this,D),D}applyToShader(D){D.setFloat("radius",this.radius),D.setFloat("height",this.height),D.setFloat("radiusRange",this.radiusRange),D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("radius",1),D.addUniform("height",1),D.addUniform("radiusRange",1),D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const D=super.serialize();return D.direction1=this.direction1.Fh(),D.direction2=this.direction2.Fh(),D}parse(D){super.parse(D),H.Gh.FromArrayToRef(D.direction1,0,this.direction1),H.Gh.FromArrayToRef(D.direction2,0,this.direction2)}}class s{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=D,this.radiusRange=h,this.directionRandomizer=o}startDirectionFunction(D,h,o,g){const j=o.position.Nh(D.getTranslation()).normalize(),M=(0,S.RandomRange)(0,this.directionRandomizer),R=(0,S.RandomRange)(0,this.directionRandomizer),t=(0,S.RandomRange)(0,this.directionRandomizer);j.x+=M,j.y+=R,j.z+=t,j.normalize(),g?h.M(j):H.Gh.TransformNormalFromFloatsToRef(j.x,j.y,j.z,D,h)}startPositionFunction(D,h,o,g){const j=this.radius-(0,S.RandomRange)(0,this.radius*this.radiusRange),M=(0,S.RandomRange)(0,1),R=(0,S.RandomRange)(0,2*Math.PI),t=Math.acos(2*M-1),k=j*Math.cos(R)*Math.sin(t),K=j*Math.cos(t),Q=j*Math.sin(R)*Math.sin(t);g?h.Qg(k,Math.abs(K),Q):H.Gh.TransformCoordinatesFromFloatsToRef(k,Math.abs(K),Q,D,h)}clone(){const D=new s(this.radius,this.directionRandomizer);return k.d.DeepCopy(this,D),D}applyToShader(D){D.setFloat("radius",this.radius),D.setFloat("radiusRange",this.radiusRange),D.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(D){D.addUniform("radius",1),D.addUniform("radiusRange",1),D.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.radius=this.radius,D.radiusRange=this.radiusRange,D.directionRandomizer=this.directionRandomizer,D}parse(D){this.radius=D.radius,this.radiusRange=D.radiusRange,this.directionRandomizer=D.directionRandomizer}}class U{constructor(){this.direction1=new H.Gh(0,1,0),this.direction2=new H.Gh(0,1,0)}startDirectionFunction(D,h,o,g){const j=(0,S.RandomRange)(this.direction1.x,this.direction2.x),M=(0,S.RandomRange)(this.direction1.y,this.direction2.y),R=(0,S.RandomRange)(this.direction1.z,this.direction2.z);g?h.Qg(j,M,R):H.Gh.TransformNormalFromFloatsToRef(j,M,R,D,h)}startPositionFunction(D,h,o,g){g?h.Qg(0,0,0):H.Gh.TransformCoordinatesFromFloatsToRef(0,0,0,D,h)}clone(){const D=new U;return k.d.DeepCopy(this,D),D}applyToShader(D){D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.direction1=this.direction1.Fh(),D.direction2=this.direction2.Fh(),D}parse(D){H.Gh.FromArrayToRef(D.direction1,0,this.direction1),H.Gh.FromArrayToRef(D.direction2,0,this.direction2)}}class q{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=D,this.radiusRange=h,this.directionRandomizer=o}startDirectionFunction(D,h,o,g){const j=o.position.Nh(D.getTranslation()).normalize(),M=(0,S.RandomRange)(0,this.directionRandomizer),R=(0,S.RandomRange)(0,this.directionRandomizer),t=(0,S.RandomRange)(0,this.directionRandomizer);j.x+=M,j.y+=R,j.z+=t,j.normalize(),g?h.M(j):H.Gh.TransformNormalFromFloatsToRef(j.x,j.y,j.z,D,h)}startPositionFunction(D,h,o,g){const j=this.radius-(0,S.RandomRange)(0,this.radius*this.radiusRange),M=(0,S.RandomRange)(0,1),R=(0,S.RandomRange)(0,2*Math.PI),t=Math.acos(2*M-1),k=j*Math.cos(R)*Math.sin(t),K=j*Math.cos(t),Q=j*Math.sin(R)*Math.sin(t);g?h.Qg(k,K,Q):H.Gh.TransformCoordinatesFromFloatsToRef(k,K,Q,D,h)}clone(){const D=new q(this.radius,this.directionRandomizer);return k.d.DeepCopy(this,D),D}applyToShader(D){D.setFloat("radius",this.radius),D.setFloat("radiusRange",this.radiusRange),D.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(D){D.addUniform("radius",1),D.addUniform("radiusRange",1),D.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.radius=this.radius,D.radiusRange=this.radiusRange,D.directionRandomizer=this.directionRandomizer,D}parse(D){this.radius=D.radius,this.radiusRange=D.radiusRange,this.directionRandomizer=D.directionRandomizer}}class c extends q{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new H.Gh(0,1,0),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.Gh(0,1,0);super(D),this.direction1=h,this.direction2=o}startDirectionFunction(D,h){const o=(0,S.RandomRange)(this.direction1.x,this.direction2.x),g=(0,S.RandomRange)(this.direction1.y,this.direction2.y),j=(0,S.RandomRange)(this.direction1.z,this.direction2.z);H.Gh.TransformNormalFromFloatsToRef(o,g,j,D,h)}clone(){const D=new c(this.radius,this.direction1,this.direction2);return k.d.DeepCopy(this,D),D}applyToShader(D){D.setFloat("radius",this.radius),D.setFloat("radiusRange",this.radiusRange),D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("radius",1),D.addUniform("radiusRange",1),D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const D=super.serialize();return D.direction1=this.direction1.Fh(),D.direction2=this.direction2.Fh(),D}parse(D){super.parse(D),this.direction1.M(D.direction1),this.direction2.M(D.direction2)}}class y{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(D,h,o,g){const j=H.TmpVectors.Gh[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,o,j);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,o,j);const D=H.TmpVectors.Gh[1];j.subtractToRef(o.position,D),D.scaleToRef(1/o.lifeTime,j)}else j.set(0,0,0);g?h.M(j):H.Gh.TransformNormalToRef(j,D,h)}startPositionFunction(D,h,o,g){const j=H.TmpVectors.Gh[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,o,j):j.set(0,0,0),g?h.M(j):H.Gh.TransformCoordinatesToRef(j,D,h)}clone(){const D=new y;return k.d.DeepCopy(this,D),D}applyToShader(D){}buildUniformLayout(D){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const D={};return D.type=this.getClassName(),D.particlePositionGenerator=this.particlePositionGenerator,D.particleDestinationGenerator=this.particleDestinationGenerator,D}parse(D){D.particlePositionGenerator&&(this.particlePositionGenerator=D.particlePositionGenerator),D.particleDestinationGenerator&&(this.particleDestinationGenerator=D.particleDestinationGenerator)}}var b=o(12894);class i{get mesh(){return this._mesh}set mesh(D){this._mesh!==D&&(this._mesh=D,D?(this._indices=D.jg(),this._positions=D.getVerticesData(b.f.PositionKind),this._normals=D.getVerticesData(b.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=H.Gh.Zero(),this._mesh=null,this.direction1=new H.Gh(0,1,0),this.direction2=new H.Gh(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=D}startDirectionFunction(D,h,o,g){if(this.useMeshNormalsForDirection&&this._normals)return void H.Gh.TransformNormalToRef(this._storedNormal,D,h);const j=(0,S.RandomRange)(this.direction1.x,this.direction2.x),M=(0,S.RandomRange)(this.direction1.y,this.direction2.y),R=(0,S.RandomRange)(this.direction1.z,this.direction2.z);g?h.Qg(j,M,R):H.Gh.TransformNormalFromFloatsToRef(j,M,R,D,h)}startPositionFunction(D,h,o,g){if(!this._indices||!this._positions)return;const j=3*(Math.random()*(this._indices.length/3)|0),M=Math.random(),R=Math.random()*(1-M),t=1-M-R,S=this._indices[j],k=this._indices[j+1],K=this._indices[j+2],Q=H.TmpVectors.Gh[0],v=H.TmpVectors.Gh[1],r=H.TmpVectors.Gh[2],B=H.TmpVectors.Gh[3];H.Gh.FromArrayToRef(this._positions,3*S,Q),H.Gh.FromArrayToRef(this._positions,3*k,v),H.Gh.FromArrayToRef(this._positions,3*K,r),B.x=M*Q.x+R*v.x+t*r.x,B.y=M*Q.y+R*v.y+t*r.y,B.z=M*Q.z+R*v.z+t*r.z,g?h.Qg(B.x,B.y,B.z):H.Gh.TransformCoordinatesFromFloatsToRef(B.x,B.y,B.z,D,h),this.useMeshNormalsForDirection&&this._normals&&(H.Gh.FromArrayToRef(this._normals,3*S,Q),H.Gh.FromArrayToRef(this._normals,3*k,v),H.Gh.FromArrayToRef(this._normals,3*K,r),this._storedNormal.x=M*Q.x+R*v.x+t*r.x,this._storedNormal.y=M*Q.y+R*v.y+t*r.y,this._storedNormal.z=M*Q.z+R*v.z+t*r.z)}clone(){const D=new i(this.mesh);return k.d.DeepCopy(this,D),D}applyToShader(D){D.setVector3("direction1",this.direction1),D.setVector3("direction2",this.direction2)}buildUniformLayout(D){D.addUniform("direction1",3),D.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var D;const h={};return h.type=this.getClassName(),h.direction1=this.direction1.Fh(),h.direction2=this.direction2.Fh(),h.meshId=null===(D=this.mesh)||void 0===D?void 0:D.id,h.useMeshNormalsForDirection=this.useMeshNormalsForDirection,h}parse(D,h){H.Gh.FromArrayToRef(D.direction1,0,this.direction1),H.Gh.FromArrayToRef(D.direction2,0,this.direction2),D.meshId&&h&&(this.mesh=h.getLastMeshById(D.meshId)),this.useMeshNormalsForDirection=D.useMeshNormalsForDirection}}class G{_isUbo(D){return void 0!==D.addUniform}constructor(D){this._isUbo(D)?(this.setMatrix3x3=D.updateMatrix3x3.bind(D),this.setMatrix2x2=D.updateMatrix2x2.bind(D),this.setFloat=D.updateFloat.bind(D),this.setFloat2=D.updateFloat2.bind(D),this.setFloat3=D.updateFloat3.bind(D),this.setFloat4=D.updateFloat4.bind(D),this.setFloatArray=D.updateFloatArray.bind(D),this.setArray=D.updateArray.bind(D),this.setIntArray=D.updateIntArray.bind(D),this.setMatrix=D.Wh.bind(D),this.setMatrices=D.updateMatrices.bind(D),this.setVector3=D.updateVector3.bind(D),this.setVector4=D.updateVector4.bind(D),this.setColor3=D.updateColor3.bind(D),this.setColor4=D.updateColor4.bind(D),this.setDirectColor4=D.updateDirectColor4.bind(D),this.setInt=D.updateInt.bind(D),this.setInt2=D.updateInt2.bind(D),this.setInt3=D.updateInt3.bind(D),this.setInt4=D.updateInt4.bind(D)):(this.setMatrix3x3=D.setMatrix3x3.bind(D),this.setMatrix2x2=D.setMatrix2x2.bind(D),this.setFloat=D.setFloat.bind(D),this.setFloat2=D.setFloat2.bind(D),this.setFloat3=D.setFloat3.bind(D),this.setFloat4=D.setFloat4.bind(D),this.setFloatArray=D.setFloatArray.bind(D),this.setArray=D.setArray.bind(D),this.setIntArray=D.setIntArray.bind(D),this.setMatrix=D.setMatrix.bind(D),this.setMatrices=D.setMatrices.bind(D),this.setVector3=D.setVector3.bind(D),this.setVector4=D.setVector4.bind(D),this.setColor3=D.setColor3.bind(D),this.setColor4=D.setColor4.bind(D),this.setDirectColor4=D.setDirectColor4.bind(D),this.setInt=D.setInt.bind(D),this.setInt2=D.setInt2.bind(D),this.setInt3=D.setInt3.bind(D),this.setInt4=D.setInt4.bind(D))}}var N=o(12741);const J="gpuUpdateParticlesPixelShader",O="#version 300 es\nvoid main() {discard;}\n";N.d.ShadersStore[J]||(N.d.ShadersStore[J]=O);const E="gpuUpdateParticlesVertexShader",L="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";N.d.ShadersStore[E]||(N.d.ShadersStore[E]=L);(0,R.g)("BABYLON.WebGL2ParticleSystem",class{constructor(D,h){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=D,this._engine=h,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var D;return(null===(D=this._updateEffect)||void 0===D?void 0:D.isReady())??!1}createUpdateBuffer(D){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof y&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=D,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new G(this._updateEffect)}createVertexBuffers(D,h){this._updateVAO.push(this._createUpdateVAO(D)),this._renderVAO.push(this._engine.recordVertexArrayObject(h,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=h}createParticleBuffer(D){return D}bindDrawBuffers(D,h,o){o?this._engine.bindBuffers(this._renderVertexBuffers,o,h):this._engine.bindVertexArrayObject(this._renderVAO[D],null)}preUpdateParticleBuffer(){const D=this._engine;if(this._engine.enableEffect(this._updateEffect),!D.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(D,h,o){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[D],null);const H=this._engine;H.bindTransformFeedbackBuffer(h.getBuffer()),H.setRasterizerState(!1),H.beginTransformFeedback(!0),H.drawArraysType(3,0,o),H.endTransformFeedback(),H.setRasterizerState(!0),H.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let D=0;D<this._updateVAO.length;D++)this._engine.releaseVertexArrayObject(this._updateVAO[D]);this._updateVAO.length=0;for(let D=0;D<this._renderVAO.length;D++)this._engine.releaseVertexArrayObject(this._renderVAO[D]);this._renderVAO.length=0}_createUpdateVAO(D){const h={};h.position=D.createVertexBuffer("position",0,3);let o=3;h.age=D.createVertexBuffer("age",o,1),o+=1,h.size=D.createVertexBuffer("size",o,3),o+=3,h.life=D.createVertexBuffer("life",o,1),o+=1,h.seed=D.createVertexBuffer("seed",o,4),o+=4,h.direction=D.createVertexBuffer("direction",o,3),o+=3,this._parent.particleEmitterType instanceof y&&(h.initialPosition=D.createVertexBuffer("initialPosition",o,3),o+=3),this._parent._colorGradientsTexture||(h.color=D.createVertexBuffer("color",o,4),o+=4),this._parent._isBillboardBased||(h.initialDirection=D.createVertexBuffer("initialDirection",o,3),o+=3),this._parent.noiseTexture&&(h.noiseCoordinates1=D.createVertexBuffer("noiseCoordinates1",o,3),o+=3,h.noiseCoordinates2=D.createVertexBuffer("noiseCoordinates2",o,3),o+=3),this._parent._angularSpeedGradientsTexture?(h.angle=D.createVertexBuffer("angle",o,1),o+=1):(h.angle=D.createVertexBuffer("angle",o,2),o+=2),this._parent._isAnimationSheetEnabled&&(h.cellIndex=D.createVertexBuffer("cellIndex",o,1),o+=1,this._parent.spriteRandomStartCell&&(h.cellStartOffset=D.createVertexBuffer("cellStartOffset",o,1),o+=1));const H=this._engine.recordVertexArrayObject(h,null,this._updateEffect);return this._engine.bindArrayBuffer(null),H}});class T{constructor(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,H=arguments.length>3?arguments[3]:void 0;this._engine=D,this._label=H,this._engine._storageBuffers.push(this),this._create(h,o)}_create(D,h){this._bufferSize=D,this._creationFlags=h,this._buffer=this._engine.createStorageBuffer(D,h,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(D,h,o){this._buffer&&this._engine.updateStorageBuffer(this._buffer,D,h,o)}async read(D,h,o,H){return await this._engine.readFromStorageBuffer(this._buffer,D,h,o,H)}dispose(){const D=this._engine._storageBuffers,h=D.indexOf(this);-1!==h&&(D[h]=D[D.length-1],D.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var Z=o(12812),e=o(12815),p=o(12860),mD=o(12807),a=o(13128),u=o(12658),I=o(12778),P=o(13044);class n{constructor(){this._gpuTimeInFrameId=-1,this.counter=new P.d}_addDuration(D,h){D<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==D?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(h,!1),this._gpuTimeInFrameId=D):this.counter.addCount(h,!1))}}var F=o(12722);class w{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(D,h,o){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=D,this._engine=h,this.uniqueId=a.c.UniqueId,h.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new n),this._engine.getCaps().supportComputeShaders?H.bindingsMapping?(this._context=h.createComputeContext(),this._shaderPath=o,this._options={bindingsMapping:{},defines:[],...H}):u.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):u.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(D,h){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const H=this._bindings[D];this._bindings[D]={type:o?0:4,object:h,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!H||H.object!==h||H.type!==this._bindings[D].type)}setStorageTexture(D,h){const o=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==h),this._bindings[D]={type:1,object:h,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setExternalTexture(D,h){const o=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==h),this._bindings[D]={type:6,object:h,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setVideoTexture(D,h){return!!h.externalTexture&&(this.setExternalTexture(D,h.externalTexture),!0)}setUniformBuffer(D,h){const o=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==h),this._bindings[D]={type:w._BufferIsDataBuffer(h)?7:2,object:h,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setStorageBuffer(D,h){const o=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!o||o.object!==h),this._bindings[D]={type:w._BufferIsDataBuffer(h)?7:3,object:h,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}setTextureSampler(D,h){const o=this._bindings[D];this._contextIsDirty||(this._contextIsDirty=!o||!h.compareSampler(o.object)),this._bindings[D]={type:5,object:h,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries}}isReady(){let D=this._effect;for(const g in this._bindings){const D=this._bindings[g],h=D.type,o=D.object;switch(h){case 0:case 4:case 1:if(!o.isReady())return!1;break;case 6:if(!o.isReady())return!1;break}}const h=[],o=this._shaderPath;if(this._options.defines)for(let g=0;g<this._options.defines.length;g++)h.push(this._options.defines[g]);const H=h.join("\n");return this._cachedDefines!==H&&(this._cachedDefines=H,D=this._engine.createComputeEffect(o,{defines:H,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=D),!!D.isReady()}dispatch(D,h,o){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,D,h,o,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const o=w._BufferIsDataBuffer(D)?D:D.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,o,h,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const h in this._bindings){const o=this._bindings[h];if(!this._options.bindingsMapping[h])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+h+"'");switch(o.type){case 0:{const H=this._samplers[h],g=o.object;var D;if(!H||!g._texture||!H.compareSampler(g._texture))this._samplers[h]=(new I.e).setParameters(g.wrapU,g.wrapV,g.wrapR,g.anisotropicFilteringLevel,g._texture.samplingMode,null===(D=g._texture)||void 0===D?void 0:D._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const D=o.object;D.getBuffer()!==o.buffer&&(o.buffer=D.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(D,h,o){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((g=>{(0,F.f)((()=>this.dispatch(D,h,o)),g,void 0,H)}))}serialize(){const D=p.d.Serialize(this);D.options=this._options,D.shaderPath=this._shaderPath,D.XQ={},D.textures={};for(const h in this._bindings){const o=this._bindings[h],H=o.object;switch(o.type){case 0:case 4:case 1:{const g=H.serialize();g&&(D.textures[h]=g,D.XQ[h]={type:o.type});break}}}return D}static Parse(D,h,o){const H=p.d.Parse((()=>new w(D.name,h.getEngine(),D.shaderPath,D.options)),D,h,o);for(const g in D.textures){const j=D.XQ[g],M=mD.b.Parse(D.textures[g],h,o);0===j.type?H.setTexture(g,M):4===j.type?H.setTexture(g,M,!1):H.setStorageTexture(g,M)}return H}static _BufferIsDataBuffer(D){return void 0!==D.underlyingResource}}(0,Z.c)([(0,e.I)()],w.prototype,"name",void 0),(0,Z.c)([(0,e.I)()],w.prototype,"fastMode",void 0),(0,R.g)("BABYLON.ComputeShader",w);var Y=o(13080);const l="gpuUpdateParticlesComputeShader",C="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";N.d.ShadersStoreWGSL[l]||(N.d.ShadersStoreWGSL[l]=C);(0,R.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(D,h){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=D,this._engine=h}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var D;return(null===(D=this._updateComputeShader)||void 0===D?void 0:D.isReady())??!1}createUpdateBuffer(D){var h;const o={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(o.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(o.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(o.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(o.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(o.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(o.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(o.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new w("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:o,defines:D.split("\n")}),null===(h=this._simParamsComputeShader)||void 0===h||h.dispose(),this._simParamsComputeShader=new Y.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new G(this._simParamsComputeShader)}createVertexBuffers(D,h){this._renderVertexBuffers.push(h)}createParticleBuffer(D){const h=new T(this._engine,4*D.length,11,"ComputeShaderParticleSystemBuffer");return h.update(D),this._bufferComputeShader.push(h),h.getBuffer()}bindDrawBuffers(D,h,o){this._engine.bindBuffers(this._renderVertexBuffers[D],o,h)}preUpdateParticleBuffer(){}updateParticleBuffer(D,h,o){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[D]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^D]),this._updateComputeShader.dispatch(Math.ceil(o/64))}releaseBuffers(){var D;for(let h=0;h<this._bufferComputeShader.length;++h)this._bufferComputeShader[h].dispose();this._bufferComputeShader.length=0,null===(D=this._simParamsComputeShader)||void 0===D||D.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class z{constructor(D,h,o){this.gradient=D,this.color1=h,this.color2=o}getColorToRef(D){this.color2?M.yg.LerpToRef(this.color1,this.color2,Math.random(),D):D.M(this.color1)}}class f{constructor(D,h){this.gradient=D,this.color=h}}class V{constructor(D,h,o){this.gradient=D,this.factor1=h,this.factor2=o}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class d{static GetCurrentGradient(D,h,o){if(h[0].gradient>D)return void o(h[0],h[0],1);for(let g=0;g<h.length-1;g++){const H=h[g],j=h[g+1];if(D>=H.gradient&&D<=j.gradient){return void o(H,j,(D-H.gradient)/(j.gradient-H.gradient))}}const H=h.length-1;o(h[H],h[H],1)}}var X=o(12648),A=o(13316),W=o(12683);class x{constructor(D){this.particleSystem=D,this.position=H.Gh.Zero(),this.direction=H.Gh.Zero(),this.color=new M.yg(0,0,0,0),this.colorStep=new M.yg(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new H.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new M.yg(0,0,0,0),this._currentColor2=new M.yg(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=x._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let D=this.age,h=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===h?(h=1,D=this._randomCellOffset):D+=this._randomCellOffset);const o=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let H;H=this._initialSpriteCellLoop?(0,S.Clamp)(D*h%this.lifeTime/this.lifeTime):(0,S.Clamp)(D*h/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+H*o|0}_inheritParticleInfoToSubEmitter(D){if(D.particleSystem.Hh.position){const h=D.particleSystem.Hh;if(h.position.M(this.position),D.inheritDirection){const D=H.TmpVectors.Gh[0];this.direction.normalizeToRef(D),h.setDirection(D,0,Math.PI/2)}}else{D.particleSystem.Hh.M(this.position)}this.direction.scaleToRef(D.inheritedVelocityAmount/2,H.TmpVectors.Gh[0]),D.particleSystem._inheritedVelocityOffset.M(H.TmpVectors.Gh[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const D of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(D)}_reset(){this.age=0,this.id=x._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(D){D.position.M(this.position),this._initialDirection?D._initialDirection?D._initialDirection.M(this._initialDirection):D._initialDirection=this._initialDirection.clone():D._initialDirection=null,D.direction.M(this.direction),this.nt&&(D.nt?D.nt.M(this.nt):D.nt=this.nt.clone()),D.color.M(this.color),D.colorStep.M(this.colorStep),D.lifeTime=this.lifeTime,D.age=this.age,D._randomCellOffset=this._randomCellOffset,D.size=this.size,D.scale.M(this.scale),D.angle=this.angle,D.angularSpeed=this.angularSpeed,D.particleSystem=this.particleSystem,D.cellIndex=this.cellIndex,D.id=this.id,D._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(D._currentColorGradient=this._currentColorGradient,D._currentColor1.M(this._currentColor1),D._currentColor2.M(this._currentColor2)),this._currentSizeGradient&&(D._currentSizeGradient=this._currentSizeGradient,D._currentSize1=this._currentSize1,D._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(D._currentAngularSpeedGradient=this._currentAngularSpeedGradient,D._currentAngularSpeed1=this._currentAngularSpeed1,D._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(D._currentVelocityGradient=this._currentVelocityGradient,D._currentVelocity1=this._currentVelocity1,D._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(D._currentLimitVelocityGradient=this._currentLimitVelocityGradient,D._currentLimitVelocity1=this._currentLimitVelocity1,D._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(D._currentDragGradient=this._currentDragGradient,D._currentDrag1=this._currentDrag1,D._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(D._initialStartSpriteCellId=this._initialStartSpriteCellId,D._initialEndSpriteCellId=this._initialEndSpriteCellId,D._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(D.remapData&&this.remapData?D.remapData.M(this.remapData):D.remapData=new H.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(D._randomNoiseCoordinates1?(D._randomNoiseCoordinates1.M(this._randomNoiseCoordinates1),D._randomNoiseCoordinates2.M(this._randomNoiseCoordinates2)):(D._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),D._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}x._Count=0;var DD=o(12940),hD=(o(12985),o(13198)),oD=o(13189),HD=o(13076);function gD(D,h){const o=(0,S.RandomRange)(0,1);M.yg.LerpToRef(h.color1,h.color2,o,D.color),h.colorDead.subtractToRef(D.color,h._colorDiff),h._colorDiff.scaleToRef(1/D.lifeTime,D.colorStep)}function jD(D,h){D._currentColorGradient=h._colorGradients[0],D._currentColorGradient.getColorToRef(D.color),D._currentColor1.M(D.color),h._colorGradients.length>1?h._colorGradients[1].getColorToRef(D._currentColor2):D._currentColor2.M(D.color)}function MD(D,h){const o=h._colorGradients;d.GetCurrentGradient(h._ratio,o,((h,o,H)=>{h!==D._currentColorGradient&&(D._currentColor1.M(D._currentColor2),o.getColorToRef(D._currentColor2),D._currentColorGradient=h),M.yg.LerpToRef(D._currentColor1,D._currentColor2,H,D.color)}))}function RD(D,h){D.colorStep.scaleToRef(h._scaledUpdateSpeed,h._scaledColorStep),D.color.addInPlace(h._scaledColorStep),D.color.a<0&&(D.color.a=0)}function tD(D,h){d.GetCurrentGradient(h._ratio,h._angularSpeedGradients,((h,o,H)=>{h!==D._currentAngularSpeedGradient&&(D._currentAngularSpeed1=D._currentAngularSpeed2,D._currentAngularSpeed2=o.getFactor(),D._currentAngularSpeedGradient=h),D.angularSpeed=(0,S.Lerp)(D._currentAngularSpeed1,D._currentAngularSpeed2,H)}))}function SD(D,h){D.angle+=D.angularSpeed*h._scaledUpdateSpeed}function kD(D,h){h.particleEmitterType.startDirectionFunction(h._emitterWorldMatrix,D.direction,D,h.isLocal,h._emitterInverseWorldMatrix)}function KD(D,h){h.startDirectionFunction(h._emitterWorldMatrix,D.direction,D,h.isLocal)}function QD(D,h){D._currentVelocityGradient=h._velocityGradients[0],D._currentVelocity1=D._currentVelocityGradient.getFactor(),h._velocityGradients.length>1?D._currentVelocity2=h._velocityGradients[1].getFactor():D._currentVelocity2=D._currentVelocity1}function vD(D,h){D._currentLimitVelocityGradient=h._limitVelocityGradients[0],D._currentLimitVelocity1=D._currentLimitVelocityGradient.getFactor(),h._limitVelocityGradients.length>1?D._currentLimitVelocity2=h._limitVelocityGradients[1].getFactor():D._currentLimitVelocity2=D._currentLimitVelocity1}function rD(D,h){d.GetCurrentGradient(h._ratio,h._velocityGradients,((o,H,g)=>{o!==D._currentVelocityGradient&&(D._currentVelocity1=D._currentVelocity2,D._currentVelocity2=H.getFactor(),D._currentVelocityGradient=o),h._directionScale*=(0,S.Lerp)(D._currentVelocity1,D._currentVelocity2,g)}))}function BD(D,h){d.GetCurrentGradient(h._ratio,h._limitVelocityGradients,((o,H,g)=>{o!==D._currentLimitVelocityGradient&&(D._currentLimitVelocity1=D._currentLimitVelocity2,D._currentLimitVelocity2=H.getFactor(),D._currentLimitVelocityGradient=o);const j=(0,S.Lerp)(D._currentLimitVelocity1,D._currentLimitVelocity2,g);D.direction.length()>j&&D.direction.scaleInPlace(h.limitVelocityDamping)}))}function sD(D,h){D.direction.scaleToRef(h._directionScale,h._scaledDirection)}function UD(D,h){h.particleEmitterType.startPositionFunction(h._emitterWorldMatrix,D.position,D,h.isLocal)}function qD(D,h){h.startPositionFunction(h._emitterWorldMatrix,D.position,D,h.isLocal)}function cD(D,h){D.nt?D.nt.M(D.position):D.nt=D.position.clone(),H.Gh.TransformCoordinatesToRef(D.nt,h._emitterWorldMatrix,D.position)}function yD(D,h){h.isLocal&&D.nt?(D.nt.addInPlace(h._scaledDirection),H.Gh.TransformCoordinatesToRef(D.nt,h._emitterWorldMatrix,D.position)):D.position.addInPlace(h._scaledDirection)}function bD(D,h){D._currentDragGradient=h._dragGradients[0],D._currentDrag1=D._currentDragGradient.getFactor(),h._dragGradients.length>1?D._currentDrag2=h._dragGradients[1].getFactor():D._currentDrag2=D._currentDrag1}function iD(D,h){d.GetCurrentGradient(h._ratio,h._dragGradients,((o,H,g)=>{o!==D._currentDragGradient&&(D._currentDrag1=D._currentDrag2,D._currentDrag2=H.getFactor(),D._currentDragGradient=o);const j=(0,S.Lerp)(D._currentDrag1,D._currentDrag2,g);h._scaledDirection.scaleInPlace(1-j)}))}function GD(D,h){D._randomNoiseCoordinates1?(D._randomNoiseCoordinates1.Qg(Math.random(),Math.random(),Math.random()),D._randomNoiseCoordinates2.Qg(Math.random(),Math.random(),Math.random())):(D._randomNoiseCoordinates1=new H.Gh(Math.random(),Math.random(),Math.random()),D._randomNoiseCoordinates2=new H.Gh(Math.random(),Math.random(),Math.random()))}function ND(D,h){const o=h._noiseTextureData,g=h._noiseTextureSize;if(o&&g&&D._randomNoiseCoordinates1){const j=h._fetchR(D._randomNoiseCoordinates1.x,D._randomNoiseCoordinates1.y,g.width,g.height,o),M=h._fetchR(D._randomNoiseCoordinates1.z,D._randomNoiseCoordinates2.x,g.width,g.height,o),R=h._fetchR(D._randomNoiseCoordinates2.y,D._randomNoiseCoordinates2.z,g.width,g.height,o),t=H.TmpVectors.Gh[0],S=H.TmpVectors.Gh[1];t.Qg((2*j-1)*h.noiseStrength.x,(2*M-1)*h.noiseStrength.y,(2*R-1)*h.noiseStrength.z),t.scaleToRef(h._tempScaledUpdateSpeed,S),D.direction.addInPlace(S)}}function JD(D,h){h.gravity.scaleToRef(h._tempScaledUpdateSpeed,h._scaledGravity),D.direction.addInPlace(h._scaledGravity)}function OD(D,h){D.size=(0,S.RandomRange)(h.minSize,h.maxSize),D.scale.Qg((0,S.RandomRange)(h.minScaleX,h.maxScaleX),(0,S.RandomRange)(h.minScaleY,h.maxScaleY))}function ED(D,h){D._currentSizeGradient=h._sizeGradients[0],D._currentSize1=D._currentSizeGradient.getFactor(),D.size=D._currentSize1,h._sizeGradients.length>1?D._currentSize2=h._sizeGradients[1].getFactor():D._currentSize2=D._currentSize1,D.scale.Qg((0,S.RandomRange)(h.minScaleX,h.maxScaleX),(0,S.RandomRange)(h.minScaleY,h.maxScaleY))}function LD(D,h){const o=h._actualFrame/h.targetStopDuration;d.GetCurrentGradient(o,h._startSizeGradients,((o,H,g)=>{o!==h._currentStartSizeGradient&&(h._currentStartSize1=h._currentStartSize2,h._currentStartSize2=H.getFactor(),h._currentStartSizeGradient=o);const j=(0,S.Lerp)(h._currentStartSize1,h._currentStartSize2,g);D.scale.scaleInPlace(j)}))}function TD(D,h){d.GetCurrentGradient(h._ratio,h._sizeGradients,((h,o,H)=>{h!==D._currentSizeGradient&&(D._currentSize1=D._currentSize2,D._currentSize2=o.getFactor(),D._currentSizeGradient=h),D.size=(0,S.Lerp)(D._currentSize1,D._currentSize2,H)}))}function ZD(D,h){D.remapData=new H.Vector4(0,1,0,1)}function eD(D,h){h._colorRemapGradients&&h._colorRemapGradients.length>0&&d.GetCurrentGradient(h._ratio,h._colorRemapGradients,((h,o,H)=>{const g=(0,S.Lerp)(h.factor1,o.factor1,H),j=(0,S.Lerp)(h.factor2,o.factor2,H);D.remapData.x=g,D.remapData.y=j-g})),h._alphaRemapGradients&&h._alphaRemapGradients.length>0&&d.GetCurrentGradient(h._ratio,h._alphaRemapGradients,((h,o,H)=>{const g=(0,S.Lerp)(h.factor1,o.factor1,H),j=(0,S.Lerp)(h.factor2,o.factor2,H);D.remapData.z=g,D.remapData.w=j-g}))}function pD(D,h){const o=(0,S.Clamp)(h._actualFrame/h.targetStopDuration);d.GetCurrentGradient(o,h._lifeTimeGradients,((h,H)=>{const g=h,j=H,M=g.getFactor(),R=j.getFactor(),t=(o-g.gradient)/(j.gradient-g.gradient);D.lifeTime=(0,S.Lerp)(M,R,t)})),h._emitPower=(0,S.RandomRange)(h.minEmitPower,h.maxEmitPower)}function mh(D,h){D.lifeTime=(0,S.RandomRange)(h.minLifeTime,h.maxLifeTime),h._emitPower=(0,S.RandomRange)(h.minEmitPower,h.maxEmitPower)}function aD(D,h){0===h._emitPower?(D._initialDirection?D._initialDirection.M(D.direction):D._initialDirection=D.direction.clone(),D.direction.set(0,0,0)):(D._initialDirection=null,D.direction.scaleInPlace(h._emitPower)),D.direction.addInPlace(h._inheritedVelocityOffset)}function uD(D,h){D.angularSpeed=(0,S.RandomRange)(h.minAngularSpeed,h.maxAngularSpeed),D.angle=(0,S.RandomRange)(h.minInitialRotation,h.maxInitialRotation)}function ID(D,h){D._currentAngularSpeedGradient=h._angularSpeedGradients[0],D.angularSpeed=D._currentAngularSpeedGradient.getFactor(),D._currentAngularSpeed1=D.angularSpeed,h._angularSpeedGradients.length>1?D._currentAngularSpeed2=h._angularSpeedGradients[1].getFactor():D._currentAngularSpeed2=D._currentAngularSpeed1,D.angle=(0,S.RandomRange)(h.minInitialRotation,h.maxInitialRotation)}function PD(D,h){D._initialStartSpriteCellId=h.startSpriteCellID,D._initialEndSpriteCellId=h.endSpriteCellID,D._initialSpriteCellLoop=h.spriteCellLoop}function nD(D,h){D.previousItem=h.previousItem,D.nextItem=h,h.previousItem&&(h.previousItem.nextItem=D),h.previousItem=D}function FD(D,h){D.previousItem=h,D.nextItem=h.nextItem,h.nextItem&&(h.nextItem.previousItem=D),h.nextItem=D}function wD(D,h){let o=h;for(;o.nextItem;)o=o.nextItem;D.previousItem=o,D.nextItem=o.nextItem,o.nextItem=D}function YD(D){D.previousItem&&(D.previousItem.nextItem=D.nextItem),D.nextItem&&(D.nextItem.previousItem=D.previousItem)}class lD extends t{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(D){this._startDirectionFunction!==D&&(this._startDirectionFunction=D,this._directionProcessing.process=D?KD:kD)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(D){this._startPositionFunction!==D&&(this._startPositionFunction=D,this._positionCreation.process=D?qD:UD)}set onDispose(D){this._onDisposeObserver&&this.Jh.remove(this._onDisposeObserver),this._onDisposeObserver=this.Jh.add(D)}get S(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(D){this._useRampGradients!==D&&(this._useRampGradients=D,this._resetEffect(),D?(this._rampCreation={process:ZD,previousItem:null,nextItem:null},FD(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:eD,previousItem:null,nextItem:null},FD(this._remapGradientProcessing,this._gravityProcessing)):(YD(this._rampCreation),YD(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(D){this._isLocal!==D&&(this._isLocal=D,D?(this._isLocalCreation={process:cD,previousItem:null,nextItem:null},FD(this._isLocalCreation,this._positionCreation)):YD(this._isLocalCreation))}get particles(){return this.CQ}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(D){this._animationSheetEnabled!==D&&(this._animationSheetEnabled=D,D?(this._sheetCreation={process:PD,previousItem:null,nextItem:null},FD(this._sheetCreation,this._colorCreation)):YD(this._sheetCreation),this._reset())}getActiveCount(){return this.CQ.length}getClassName(){return"eg"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var D;let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(D=this._customWrappers[h])||void 0===D?void 0:D.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[D]??this._customWrappers[0]}setCustomEffect(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[h]=new DD.c(this._engine),this._customWrappers[h].effect=D,this._customWrappers[h].drawContext&&(this._customWrappers[h].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new X.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(D){if(this.noiseTexture!==D){if(this._noiseTexture=D,!D)return YD(this._noiseCreation),void YD(this._noiseProcessing);this._noiseCreation={process:GD,previousItem:null,nextItem:null},FD(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:ND,previousItem:null,nextItem:null},FD(this._noiseProcessing,this._positionProcessing)}}constructor(D,h,o){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]&&arguments[4],R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(D),this._emitterInverseWorldMatrix=H.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new H.Gh,this.Jh=new X.c,this.onStoppedObservable=new X.c,this.onStartedObservable=new X.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.CQ=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new M.yg(0,0,0,0),this._colorDiff=new M.yg(0,0,0,0),this._scaledDirection=H.Gh.Zero(),this._scaledGravity=H.Gh.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=D=>{},this.recycleParticle=D=>{const h=this.CQ.pop();h!==D&&h.copyTo(D),this._stockParticles.push(h)},this._createParticle=()=>{let D;return 0!==this._stockParticles.length?(D=this._stockParticles.pop(),D._reset()):D=new x(this),this._prepareParticle(D),D},this.paused=!1,this._shadersLoaded=!1,this._capacity=h,this._epsilon=R,o&&"Scene"!==o.getClassName()?(this._engine=o,this.defaultProjectionMatrix=H.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=o||W.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.YQ.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:mh,previousItem:null,nextItem:null},this._positionCreation={process:UD,previousItem:null,nextItem:null},FD(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:kD,previousItem:null,nextItem:null},FD(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:aD,previousItem:null,nextItem:null},FD(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:OD,previousItem:null,nextItem:null},FD(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:uD,previousItem:null,nextItem:null},FD(this._angleCreation,this._sizeCreation),this._colorCreation={process:gD,previousItem:null,nextItem:null},FD(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,t||(this._colorProcessing={process:RD,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:SD,previousItem:null,nextItem:null},FD(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:sD,previousItem:null,nextItem:null},FD(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:yD,previousItem:null,nextItem:null},FD(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:JD,previousItem:null,nextItem:null},FD(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=j,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new DD.c(this._engine)},this._customWrappers[0].effect=g,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new K,this.updateFunction=D=>{var h;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(h=this.noiseTexture.getContent())||void 0===h||h.then((D=>{this._noiseTextureData=D})));const o=D===this.CQ;for(let H=0;H<D.length;H++){const h=D[H];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const g=h.age;if(h.age+=this._tempScaledUpdateSpeed,h.age>h.lifeTime){const D=h.age-g,o=h.lifeTime-g;this._tempScaledUpdateSpeed=o*this._tempScaledUpdateSpeed/D,h.age=h.lifeTime}this._ratio=h.age/h.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let j=this._updateQueueStart;for(;j;)j.process(h,this),j=j.nextItem;if(this._isAnimationSheetEnabled&&!t&&h.updateCellIndex(),h._inheritParticleInfoToSubEmitters(),h.age>=h.lifeTime){if(this._emitFromParticle(h),h._attachedSubEmitters){for(const D of h._attachedSubEmitters)D.particleSystem.disposeOnStop=!0,D.particleSystem.stop();h._attachedSubEmitters=null}this.recycleParticle(h),o&&H--}else;}}}serialize(D){throw new Error("Method not implemented.")}clone(D,h){throw new Error("Method not implemented.")}_addFactorGradient(D,h,o,H){const g=new V(h,o,H);D.push(g),D.sort(((D,h)=>D.gradient<h.gradient?-1:D.gradient>h.gradient?1:0))}_removeFactorGradient(D,h){if(!D)return;let o=0;for(const H of D){if(H.gradient===h){D.splice(o,1);break}o++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=pD:this._lifeTimeCreation.process=mh}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:LD,previousItem:null,nextItem:null},FD(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(YD(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(D){this.targetStopDuration!==D&&(this._targetStopDuration=D,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(D,h,o){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,D,h,o),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(D){return this._removeFactorGradient(this._lifeTimeGradients,D),this._syncLifeTimeCreation(),this}addSizeGradient(D,h,o){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=ED,this._sizeGradientProcessing={process:TD,previousItem:null,nextItem:null},nD(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,D,h,o),this}removeSizeGradient(D){var h;return this._removeFactorGradient(this._sizeGradients,D),0===(null===(h=this._sizeGradients)||void 0===h?void 0:h.length)&&(YD(this._sizeGradientProcessing),this._sizeCreation.process=OD),this}addColorRemapGradient(D,h,o){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,D,h,o),this}removeColorRemapGradient(D){return this._removeFactorGradient(this._colorRemapGradients,D),this}addAlphaRemapGradient(D,h,o){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,D,h,o),this}removeAlphaRemapGradient(D){return this._removeFactorGradient(this._alphaRemapGradients,D),this}addAngularSpeedGradient(D,h,o){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=ID,this._angularSpeedGradientProcessing={process:tD,previousItem:null,nextItem:null},nD(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,D,h,o),this}removeAngularSpeedGradient(D){var h;return this._removeFactorGradient(this._angularSpeedGradients,D),0===(null===(h=this._angularSpeedGradients)||void 0===h?void 0:h.length)&&(this._angleCreation.process=uD,YD(this._angularSpeedGradientProcessing)),this}addVelocityGradient(D,h,o){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:QD,previousItem:null,nextItem:null},FD(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:rD,previousItem:null,nextItem:null},nD(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,D,h,o),this}removeVelocityGradient(D){var h;return this._removeFactorGradient(this._velocityGradients,D),0===(null===(h=this._velocityGradients)||void 0===h?void 0:h.length)&&(YD(this._velocityCreation),YD(this._velocityGradientProcessing)),this}addLimitVelocityGradient(D,h,o){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:vD,previousItem:null,nextItem:null},FD(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:BD,previousItem:null,nextItem:null},FD(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,D,h,o),this}removeLimitVelocityGradient(D){var h;return this._removeFactorGradient(this._limitVelocityGradients,D),0===(null===(h=this._limitVelocityGradients)||void 0===h?void 0:h.length)&&(YD(this._limitVelocityCreation),YD(this._limitVelocityGradientProcessing)),this}addDragGradient(D,h,o){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:bD,previousItem:null,nextItem:null},nD(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:iD,previousItem:null,nextItem:null},nD(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,D,h,o),this}removeDragGradient(D){var h;return this._removeFactorGradient(this._dragGradients,D),0===(null===(h=this._dragGradients)||void 0===h?void 0:h.length)&&(YD(this._dragCreation),YD(this._dragGradientProcessing)),this}addEmitRateGradient(D,h,o){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,D,h,o),this}removeEmitRateGradient(D){return this._removeFactorGradient(this._emitRateGradients,D),this}addStartSizeGradient(D,h,o){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,D,h,o),this._syncStartSizeCreation(),this}removeStartSizeGradient(D){return this._removeFactorGradient(this._startSizeGradients,D),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const D=new Uint8Array(4*this._rawTextureWidth),h=M.TmpColors.mo[0];for(let o=0;o<this._rawTextureWidth;o++){const H=o/this._rawTextureWidth;d.GetCurrentGradient(H,this._rampGradients,((H,g,j)=>{M.mo.LerpToRef(H.color,g.color,j,h),D[4*o]=255*h.r,D[4*o+1]=255*h.g,D[4*o+2]=255*h.b,D[4*o+3]=255}))}this._rampGradientsTexture=A.c.CreateRGBATexture(D,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((D,h)=>D.gradient<h.gradient?-1:D.gradient>h.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(D,h){this._rampGradients||(this._rampGradients=[]);const o=new f(D,h);return this._rampGradients.push(o),this._syncRampGradientTexture(),this}removeRampGradient(D){return this._removeGradientAndTexture(D,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(D,h,o){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=jD,this._colorProcessing.process=MD);const H=new z(D,h,o);return this._colorGradients.push(H),this._colorGradients.sort(((D,h)=>D.gradient<h.gradient?-1:D.gradient>h.gradient?1:0)),this}removeColorGradient(D){if(!this._colorGradients)return this;let h=0;for(const o of this._colorGradients){if(o.gradient===D){this._colorGradients.splice(h,1);break}h++}return 0===this._colorGradients.length&&(this._colorCreation.process=gD,this._colorProcessing.process=RD),this}resetDrawCache(){if(this._drawWrappers){for(const D of this._drawWrappers)if(D)for(const h of D)null===h||void 0===h||h.dispose();this._drawWrappers=[]}}_fetchR(D,h,o,H,g){return g[4*(((D=.5*Math.abs(D)+.5)*o%o|0)+((h=.5*Math.abs(h)+.5)*H%H|0)*o)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const D=this._engine,h=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*h),this._vertexBuffer=new b.d(D,this._vertexData,!0,h);let o=0;const H=this._vertexBuffer.createVertexBuffer(b.f.PositionKind,o,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[b.f.PositionKind]=H,o+=3;const g=this._vertexBuffer.createVertexBuffer(b.f.ColorKind,o,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[b.f.ColorKind]=g,o+=4;const j=this._vertexBuffer.createVertexBuffer("angle",o,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=j,o+=1;const M=this._vertexBuffer.createVertexBuffer("size",o,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=M,o+=2,this._isAnimationSheetEnabled){const D=this._vertexBuffer.createVertexBuffer("cellIndex",o,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=D,o+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const D=this._vertexBuffer.createVertexBuffer("direction",o,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=D,o+=3}if(this._useRampGradients){const D=this._vertexBuffer.createVertexBuffer("remapData",o,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=D,o+=4}let R;if(this._useInstancing){const h=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new b.d(D,h,!1,2),R=this._spriteBuffer.createVertexBuffer("offset",0,2)}else R=this._vertexBuffer.createVertexBuffer("offset",o,2,this._vertexBufferSize,this._useInstancing),o+=2;this._vertexBuffers.offset=R,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const D=[],h=[];let o=0;for(let H=0;H<this._capacity;H++)D.push(o),D.push(o+1),D.push(o+2),D.push(o),D.push(o+2),D.push(o+3),h.push(o,o+1,o+1,o+2,o+2,o+3,o+3,o,o,o+3),o+=4;this._indexBuffer=this._engine.createIndexBuffer(D),this._linesIndexBuffer=this._engine.createIndexBuffer(h)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(D)setTimeout((()=>{this.start(0)}),D);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var h;-1!==(null===(h=this.Hh)||void 0===h?void 0:h.getClassName().indexOf("Mesh"))&&this.Hh.xh(!0);const D=this.noiseTexture;if(D&&D.onGeneratedObservable)D.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let h=0;h<this.preWarmCycles;h++)this.animate(!0),D.render()}))}));else for(let h=0;h<this.preWarmCycles;h++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(D))}_postStop(D){}reset(){this._stockParticles.length=0,this.CQ.length=0}_appendParticleVertex(D,h,o,g){let j=D*this._vertexBufferSize;if(this._vertexData[j++]=h.position.x+this.Rk.x,this._vertexData[j++]=h.position.y+this.Rk.y,this._vertexData[j++]=h.position.z+this.Rk.z,this._vertexData[j++]=h.color.r,this._vertexData[j++]=h.color.g,this._vertexData[j++]=h.color.b,this._vertexData[j++]=h.color.a,this._vertexData[j++]=h.angle,this._vertexData[j++]=h.scale.x*h.size,this._vertexData[j++]=h.scale.y*h.size,this._isAnimationSheetEnabled&&(this._vertexData[j++]=h.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[j++]=h.direction.x,this._vertexData[j++]=h.direction.y,this._vertexData[j++]=h.direction.z);else if(h._initialDirection){let D=h._initialDirection;this.isLocal&&(H.Gh.TransformNormalToRef(D,this._emitterWorldMatrix,H.TmpVectors.Gh[0]),D=H.TmpVectors.Gh[0]),0===D.x&&0===D.z&&(D.x=.001),this._vertexData[j++]=D.x,this._vertexData[j++]=D.y,this._vertexData[j++]=D.z}else{let D=h.direction;this.isLocal&&(H.Gh.TransformNormalToRef(D,this._emitterWorldMatrix,H.TmpVectors.Gh[0]),D=H.TmpVectors.Gh[0]),0===D.x&&0===D.z&&(D.x=.001),this._vertexData[j++]=D.x,this._vertexData[j++]=D.y,this._vertexData[j++]=D.z}this._useRampGradients&&h.remapData&&(this._vertexData[j++]=h.remapData.x,this._vertexData[j++]=h.remapData.y,this._vertexData[j++]=h.remapData.z,this._vertexData[j++]=h.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===o?o=this._epsilon:1===o&&(o=1-this._epsilon),0===g?g=this._epsilon:1===g&&(g=1-this._epsilon)),this._vertexData[j++]=o,this._vertexData[j++]=g)}_prepareParticle(D){}_createNewOnes(D){let h;for(let o=0;o<D&&this.CQ.length!==this._capacity;o++){h=this._createParticle(),this.CQ.push(h);let D=this._createQueueStart;for(;D;)D.process(h,this),D=D.nextItem;h._inheritParticleInfoToSubEmitters()}}_update(D){if(this._alive=this.CQ.length>0,this.Hh.position){const D=this.Hh;this._emitterWorldMatrix=D.getWorldMatrix()}else{const D=this.Hh;this._emitterWorldMatrix=H.Matrix.Translation(D.x,D.y,D.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.CQ),this._createNewOnes(D)}static _GetAttributeNamesOrOptions(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H=[b.f.PositionKind,b.f.ColorKind,"angle","offset","size"];return D&&H.push("cellIndex"),h||H.push("direction"),o&&H.push("remapData"),H}static _GetEffectCreationOptions(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,hD.e)(H),D&&H.push("particlesInfos"),h&&H.push("logarithmicDepthConstant"),o&&(H.push("vFogInfos"),H.push("vFogColor")),H}fillDefines(D,h){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,hD.k)(this,this._scene,D),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&D.push("#define FOG")),this._isAnimationSheetEnabled&&D.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&D.push("#define LOGARITHMICDEPTH"),h===t.BLENDMODE_MULTIPLY&&D.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&D.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(D.push("#define BILLBOARD"),this.billboardMode){case 2:D.push("#define BILLBOARDY");break;case 8:case 9:D.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&D.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:D.push("#define BILLBOARDMODE_ALL")}o&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),D.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(D,h,o){h.push(...lD._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),D.push(...lD._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),o.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,HD.h)(D,this._imageProcessingConfigurationDefines),(0,HD.d)(o,this._imageProcessingConfigurationDefines))}_getWrapper(D){const h=this._getCustomDrawWrapper(D);if(null!==h&&void 0!==h&&h.effect)return h;const o=[];this.fillDefines(o,D);const H=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let g=this._drawWrappers[H];g||(g=this._drawWrappers[H]=[]);let j=g[D];j||(j=new DD.c(this._engine),j.drawContext&&(j.drawContext.useInstancing=this._useInstancing),g[D]=j);const M=o.join("\n");if(j.defines!==M){const D=[],h=[],o=[];this.fillUniformsAttributesAndSamplerNames(h,D,o),j.setEffect(this._engine.createEffect("particles",D,h,o,M,void 0,void 0,void 0,void 0,this._shaderLanguage),M)}return j}animate(){var D;let h,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!o&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(o?this.preWarmStepOffset:(null===(D=this._scene)||void 0===D?void 0:D.getAnimationRatio())||1),this.manualEmitCount>-1)h=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let D=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const h=this._actualFrame/this.targetStopDuration;d.GetCurrentGradient(h,this._emitRateGradients,((h,o,H)=>{h!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=o.getFactor(),this._currentEmitRateGradient=h),D=(0,S.Lerp)(this._currentEmitRate1,this._currentEmitRate2,H)}))}h=D*this._scaledUpdateSpeed|0,this._newPartsExcess+=D*this._scaledUpdateSpeed-h}if(this._newPartsExcess>1&&(h+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?h=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(h),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!o){let D=0;for(let h=0;h<this.CQ.length;h++){const o=this.CQ[h];this._appendParticleVertices(D,o),D+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.CQ.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(D,h){this._appendParticleVertex(D++,h,0,0),this._useInstancing||(this._appendParticleVertex(D++,h,1,0),this._appendParticleVertex(D++,h,1,1),this._appendParticleVertex(D++,h,0,1))}rebuild(){var D;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(D=this._spriteBuffer)||void 0===D||D._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!lD.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(o.bind(o,14154)),Promise.resolve().then(o.bind(o,14089))])):await Promise.all([Promise.resolve().then(o.bind(o,14082)),Promise.resolve().then(o.bind(o,14070))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Hh||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==t.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(t.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(t.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(D){const h=this._getWrapper(D),o=h.effect,g=this._engine;g.enableEffect(h);const j=this.defaultViewMatrix??this._scene.getViewMatrix();if(o.setTexture("diffuseSampler",this.particleTexture),o.setMatrix("view",j),o.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const D=this.particleTexture.getBaseSize();o.setFloat3("particlesInfos",this.spriteCellWidth/D.width,this.spriteCellHeight/D.height,this.spriteCellWidth/D.width)}if(o.setVector2("translationPivot",this.translationPivot),o.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const D=this._scene.activeCamera;o.setVector3("eyePosition",D.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),o.setTexture("rampSampler",this._rampGradientsTexture));const M=o.defines;var R,t,S,k,K,Q;(this._scene&&((0,hD.g)(o,this,this._scene),this.applyFog&&(0,oD.d)(this._scene,void 0,o)),M.indexOf("#define BILLBOARDMODE_ALL")>=0&&(j.invertToRef(H.TmpVectors.Matrix[0]),o.setMatrix("invView",H.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?g.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,o):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,o)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?g.bindBuffers(this._vertexBuffers,null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._linesIndexBuffer:this._indexBuffer,o):g.bindBuffers(this._vertexBuffers,null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?this._linesIndexBufferUseInstancing:null,o);(this.useLogarithmicDepth&&this._scene&&(0,oD.j)(M,o,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(o),this._setEngineBasedOnBlendMode(D),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(o),this._useInstancing)?null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?g.drawElementsType(6,0,10,this.CQ.length):g.drawArraysType(7,0,4,this.CQ.length):null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?g.drawElementsType(1,0,10*this.CQ.length):g.drawElementsType(0,0,6*this.CQ.length);return this.CQ.length}render(){if(!this.isReady()||!this.CQ.length)return 0;const D=this._engine;D.setState&&(D.setState(!1),this.forceDepthWrite&&D.setDepthWrite(!0));let h=0;return h=this.blendMode===t.BLENDMODE_MULTIPLYADD?this._render(t.BLENDMODE_MULTIPLY)+this._render(t.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),h}_onDispose(){}dispose(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),D&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),D&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(h,o),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const D=this._scene.YQ.indexOf(this);D>-1&&this._scene.YQ.splice(D,1),this._scene._activeParticleSystems.dispose()}this.Jh.notifyObservers(this),this.Jh.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}lD.ForceGLSL=!1;var CD,zD=o(12672);!function(D){D[D.ATTACHED=0]="ATTACHED",D[D.END=1]="END"}(CD||(CD={}));class fD{constructor(D){if(this.particleSystem=D,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!D.Hh||!D.Hh.dispose){const h=(0,R.d)("BABYLON.AbstractMesh");D.Hh=new h("SubemitterSystemEmitter",D.GD()),D._disposeEmitterOnDispose=!0}}clone(){let D=this.particleSystem.Hh;if(D){if(D instanceof H.Gh)D=D.clone();else if(-1!==D.getClassName().indexOf("Mesh")){D=new((0,R.d)("BABYLON.Mesh"))("",D.GD()),D.isVisible=!1}}else D=new H.Gh;const h=new fD(this.particleSystem.clone(this.particleSystem.name,D));return h.particleSystem.name+="Clone",h.type=this.type,h.inheritDirection=this.inheritDirection,h.inheritedVelocityAmount=this.inheritedVelocityAmount,h.particleSystem._disposeEmitterOnDispose=!0,h.particleSystem.disposeOnStop=!0,h}serialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={};return h.type=this.type,h.inheritDirection=this.inheritDirection,h.inheritedVelocityAmount=this.inheritedVelocityAmount,h.particleSystem=this.particleSystem.serialize(D),h}static _ParseParticleSystem(D,h,o){throw(0,zD.e)("ParseParticle")}static Parse(D,h,o){const H=D.particleSystem,g=new fD(fD._ParseParticleSystem(H,h,o,!0));return g.type=D.type,g.inheritDirection=D.inheritDirection,g.inheritedVelocityAmount=D.inheritedVelocityAmount,g.particleSystem._isSubEmitter=!0,g}dispose(){this.particleSystem.dispose()}}var VD=o(12731);function dD(D,h){const o=new U;return o.direction1=D,o.direction2=h,o}function XD(){return new s(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function AD(){return new q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function WD(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new H.Gh(0,1,0),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.Gh(0,1,0);return new c(D,h,o)}function xD(){return new r(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Dh(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.Gh(0,1,0),j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new H.Gh(0,1,0);return new B(D,h,o,g,j)}function hh(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new Q(D,h)}function oh(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.Gh(0,1,0),g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.Gh(0,1,0);return new v(D,h,o,g)}const Hh=H.Gh.Zero(),gh=H.Gh.Zero(),jh=H.Gh.Zero();class Mh{constructor(){this.strength=0,this.position=H.Gh.Zero()}_processParticle(D,h){this.position.subtractToRef(D.position,Hh);const o=Hh.lengthSquared()+1;Hh.normalize().scaleToRef(this.strength/o,gh),gh.scaleToRef(h._tempScaledUpdateSpeed,jh),D.direction.addInPlace(jh)}serialize(){return{position:this.position.Fh(),strength:this.strength}}}class Rh extends lD{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=D=>{if(!this._subEmitters||0===this._subEmitters.length)return;const h=Math.floor(Math.random()*this._subEmitters.length);for(const o of this._subEmitters[h])if(1===o.type){const h=o.clone();D._inheritParticleInfoToSubEmitter(h),h.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(h.particleSystem),h.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(D,h){const o=dD(D,h);return this.particleEmitterType=o,o}get flowMap(){return this._flowMap}set flowMap(D){this._flowMap!==D&&(this._flowMap=D,this._flowMapUpdate&&(YD(this._flowMapUpdate),this._flowMapUpdate=null),D&&(this._flowMapUpdate={process:D=>{var h;const o=null===(h=this.GD())||void 0===h?void 0:h.getTransformMatrix();this._flowMap._processParticle(D,this.flowMapStrength*this._tempScaledUpdateSpeed,o)},previousItem:null,nextItem:null},FD(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(D){this._attractors.push(D),1===this._attractors.length&&(this._attractorUpdate={process:D=>{for(const h of this._attractors)h._processParticle(D,this)},previousItem:null,nextItem:null},FD(this._attractorUpdate,this._directionProcessing))}removeAttractor(D){const h=this._attractors.indexOf(D);-1!==h&&this._attractors.splice(h,1),0===this._attractors.length&&YD(this._attractorUpdate)}start(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(D)}createHemisphericEmitter(){const D=XD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=D,D}createSphereEmitter(){const D=AD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=D,D}createDirectedSphereEmitter(){const D=WD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new H.Gh(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.Gh(0,1,0));return this.particleEmitterType=D,D}createCylinderEmitter(){const D=xD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=D,D}createDirectedCylinderEmitter(){const D=Dh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.Gh(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new H.Gh(0,1,0));return this.particleEmitterType=D,D}createConeEmitter(){const D=hh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=D,D}createDirectedConeEmitter(){const D=oh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.Gh(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.Gh(0,1,0));return this.particleEmitterType=D,D}createBoxEmitter(D,h,o,H){const g=new K;return this.particleEmitterType=g,this.direction1=D,this.direction2=h,this.minEmitBox=o,this.maxEmitBox=H,g}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const D of this.subEmitters)D instanceof Rh?this._subEmitters.push([new fD(D)]):D instanceof fD?this._subEmitters.push([D]):D instanceof Array&&this._subEmitters.push(D)}_stopSubEmitters(){if(this.activeSubSystems){for(const D of this.activeSubSystems)D.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const D=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==D&&this._rootParticleSystem.activeSubSystems.splice(D,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(D){D&&this._stopSubEmitters()}_prepareParticle(D){if(this._subEmitters&&this._subEmitters.length>0){const h=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];D._attachedSubEmitters=[];for(const o of h)if(0===o.type){const h=o.clone();D._attachedSubEmitters.push(h),h.particleSystem.start()}}}_onDispose(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),D&&this.particles)for(const o of this.particles)if(o._attachedSubEmitters)for(let D=o._attachedSubEmitters.length-1;D>=0;D-=1)o._attachedSubEmitters[D].dispose();if(h&&this.activeSubSystems)for(let o=this.activeSubSystems.length-1;o>=0;o-=1)this.activeSubSystems[o].dispose();if(this._subEmitters&&this._subEmitters.length){for(let D=0;D<this._subEmitters.length;D++)for(const h of this._subEmitters[D])h.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Hh&&this.Hh.dispose&&this.Hh.dispose(!0)}static _Parse(D,h,o,g){let j;j=o instanceof VD.e?null:o;const t=(0,R.d)("BABYLON.Texture");if(t&&j&&(D.texture?h.particleTexture=t.Parse(D.texture,j,g):D.textureName&&(h.particleTexture=new t(g+D.textureName,j,!1,void 0===D.invertY||D.invertY),h.particleTexture.name=D.textureName)),D.emitterId||0===D.emitterId||void 0!==D.Hh?D.emitterId&&j?h.Hh=j.getLastMeshById(D.emitterId):h.Hh=H.Gh.Ih(D.Hh):h.Hh=H.Gh.Zero(),h.isLocal=!!D.isLocal,void 0!==D.renderingGroupId&&(h.renderingGroupId=D.renderingGroupId),void 0!==D.isBillboardBased&&(h.isBillboardBased=D.isBillboardBased),void 0!==D.billboardMode&&(h.billboardMode=D.billboardMode),void 0!==D.useLogarithmicDepth&&(h.useLogarithmicDepth=D.useLogarithmicDepth),D.animations){for(let o=0;o<D.animations.length;o++){const H=D.animations[o],g=(0,R.d)("BABYLON.Animation");g&&h.animations.push(g.Parse(H))}h.beginAnimationOnStart=D.beginAnimationOnStart,h.beginAnimationFrom=D.beginAnimationFrom,h.beginAnimationTo=D.beginAnimationTo,h.beginAnimationLoop=D.beginAnimationLoop}if(D.autoAnimate&&j&&j.beginAnimation(h,D.autoAnimateFrom,D.autoAnimateTo,D.autoAnimateLoop,D.autoAnimateSpeed||1),h.startDelay=0|D.startDelay,h.minAngularSpeed=D.minAngularSpeed,h.maxAngularSpeed=D.maxAngularSpeed,h.minSize=D.minSize,h.maxSize=D.maxSize,D.minScaleX&&(h.minScaleX=D.minScaleX,h.maxScaleX=D.maxScaleX,h.minScaleY=D.minScaleY,h.maxScaleY=D.maxScaleY),void 0!==D.preWarmCycles&&(h.preWarmCycles=D.preWarmCycles,h.preWarmStepOffset=D.preWarmStepOffset),void 0!==D.minInitialRotation&&(h.minInitialRotation=D.minInitialRotation,h.maxInitialRotation=D.maxInitialRotation),h.minLifeTime=D.minLifeTime,h.maxLifeTime=D.maxLifeTime,h.minEmitPower=D.minEmitPower,h.maxEmitPower=D.maxEmitPower,h.emitRate=D.emitRate,h.gravity=H.Gh.Ih(D.gravity),D.noiseStrength&&(h.noiseStrength=H.Gh.Ih(D.noiseStrength)),h.color1=M.yg.Ih(D.color1),h.color2=M.yg.Ih(D.color2),h.colorDead=M.yg.Ih(D.colorDead),h.updateSpeed=D.updateSpeed,h.targetStopDuration=D.targetStopDuration,h.blendMode=D.blendMode,D.colorGradients)for(const H of D.colorGradients)h.addColorGradient(H.gradient,M.yg.Ih(H.color1),H.color2?M.yg.Ih(H.color2):void 0);if(D.rampGradients){for(const o of D.rampGradients)h.addRampGradient(o.gradient,M.mo.Ih(o.color));h.useRampGradients=D.useRampGradients}if(D.colorRemapGradients)for(const H of D.colorRemapGradients)h.addColorRemapGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(D.alphaRemapGradients)for(const H of D.alphaRemapGradients)h.addAlphaRemapGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(D.sizeGradients)for(const H of D.sizeGradients)h.addSizeGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(D.angularSpeedGradients)for(const H of D.angularSpeedGradients)h.addAngularSpeedGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(D.velocityGradients)for(const H of D.velocityGradients)h.addVelocityGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(D.dragGradients)for(const H of D.dragGradients)h.addDragGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(D.emitRateGradients)for(const H of D.emitRateGradients)h.addEmitRateGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(D.startSizeGradients)for(const H of D.startSizeGradients)h.addStartSizeGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(D.lifeTimeGradients)for(const H of D.lifeTimeGradients)h.addLifeTimeGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);if(D.limitVelocityGradients){for(const o of D.limitVelocityGradients)h.addLimitVelocityGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);h.limitVelocityDamping=D.limitVelocityDamping}if(D.noiseTexture&&j){const o=(0,R.d)("BABYLON.ProceduralTexture");h.noiseTexture=o.Parse(D.noiseTexture,j,g)}let S;if(D.particleEmitterType){switch(D.particleEmitterType.type){case"SphereParticleEmitter":S=new q;break;case"SphereDirectedParticleEmitter":S=new c;break;case"ConeEmitter":case"ConeParticleEmitter":S=new Q;break;case"ConeDirectedParticleEmitter":S=new v;break;case"CylinderParticleEmitter":S=new r;break;case"CylinderDirectedParticleEmitter":S=new B;break;case"HemisphericParticleEmitter":S=new s;break;case"PointParticleEmitter":S=new U;break;case"MeshParticleEmitter":S=new i;break;case"CustomParticleEmitter":S=new y;break;default:S=new K}S.parse(D.particleEmitterType,j)}else S=new K,S.parse(D,j);h.particleEmitterType=S,h.startSpriteCellID=D.startSpriteCellID,h.endSpriteCellID=D.endSpriteCellID,h.spriteCellLoop=D.spriteCellLoop??!0,h.spriteCellWidth=D.spriteCellWidth,h.spriteCellHeight=D.spriteCellHeight,h.spriteCellChangeSpeed=D.spriteCellChangeSpeed,h.spriteRandomStartCell=D.spriteRandomStartCell,h.disposeOnStop=D.disposeOnStop??!1,h.manualEmitCount=D.manualEmitCount??-1}static Parse(D,h,o){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4?arguments[4]:void 0;const R=D.name;let t,S,k=null,K=null;if(h instanceof VD.e?t=h:(S=h,t=S.getEngine()),D.customShader&&t.createEffectForParticles){K=D.customShader;const h=K.shaderOptions.defines.length>0?K.shaderOptions.defines.join("\n"):"";k=t.createEffectForParticles(K.shaderPath.fragmentElement,K.shaderOptions.uniforms,K.shaderOptions.samplers,h)}const Q=new Rh(R,j||D.Ko,h,k,D.isAnimationSheetEnabled);if(Q.customShader=K,Q._rootUrl=o,D.id&&(Q.id=D.id),D.subEmitters){Q.subEmitters=[];for(const H of D.subEmitters){const D=[];for(const g of H)D.push(fD.Parse(g,h,o));Q.subEmitters.push(D)}}if(D.attractors)for(const M of D.attractors){const D=new Mh;D.position=H.Gh.Ih(M.position),D.strength=M.strength,Q.addAttractor(D)}return Rh._Parse(D,Q,h,o),D.textureMask&&(Q.textureMask=M.yg.Ih(D.textureMask)),D.Rk&&(Q.Rk=H.Gh.Ih(D.Rk)),D.preventAutoStart&&(Q.preventAutoStart=D.preventAutoStart),g||Q.preventAutoStart||Q.start(),Q}serialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={};if(Rh._Serialize(h,this,D),h.textureMask=this.textureMask.Fh(),h.customShader=this.customShader,h.preventAutoStart=this.preventAutoStart,h.Rk=this.Rk.Fh(),this.subEmitters){h.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const o of this._subEmitters){const H=[];for(const h of o)H.push(h.serialize(D));h.subEmitters.push(H)}}if(this._attractors&&this._attractors.length){h.attractors=[];for(const D of this._attractors)h.attractors.push(D.serialize())}return h}static _Serialize(D,h,o){if(D.name=h.name,D.id=h.id,D.Ko=h.getCapacity(),D.disposeOnStop=h.disposeOnStop,D.manualEmitCount=h.manualEmitCount,h.Hh.position){const o=h.Hh;D.emitterId=o.id}else{const o=h.Hh;D.Hh=o.Fh()}h.particleEmitterType&&(D.particleEmitterType=h.particleEmitterType.serialize()),h.particleTexture&&(o?D.texture=h.particleTexture.serialize():(D.textureName=h.particleTexture.name,D.invertY=!!h.particleTexture._invertY)),D.isLocal=h.isLocal,p.d.AppendSerializedAnimations(h,D),D.beginAnimationOnStart=h.beginAnimationOnStart,D.beginAnimationFrom=h.beginAnimationFrom,D.beginAnimationTo=h.beginAnimationTo,D.beginAnimationLoop=h.beginAnimationLoop,D.startDelay=h.startDelay,D.renderingGroupId=h.renderingGroupId,D.isBillboardBased=h.isBillboardBased,D.billboardMode=h.billboardMode,D.minAngularSpeed=h.minAngularSpeed,D.maxAngularSpeed=h.maxAngularSpeed,D.minSize=h.minSize,D.maxSize=h.maxSize,D.minScaleX=h.minScaleX,D.maxScaleX=h.maxScaleX,D.minScaleY=h.minScaleY,D.maxScaleY=h.maxScaleY,D.minEmitPower=h.minEmitPower,D.maxEmitPower=h.maxEmitPower,D.minLifeTime=h.minLifeTime,D.maxLifeTime=h.maxLifeTime,D.emitRate=h.emitRate,D.gravity=h.gravity.Fh(),D.noiseStrength=h.noiseStrength.Fh(),D.color1=h.color1.Fh(),D.color2=h.color2.Fh(),D.colorDead=h.colorDead.Fh(),D.updateSpeed=h.updateSpeed,D.targetStopDuration=h.targetStopDuration,D.blendMode=h.blendMode,D.preWarmCycles=h.preWarmCycles,D.preWarmStepOffset=h.preWarmStepOffset,D.minInitialRotation=h.minInitialRotation,D.maxInitialRotation=h.maxInitialRotation,D.startSpriteCellID=h.startSpriteCellID,D.spriteCellLoop=h.spriteCellLoop,D.endSpriteCellID=h.endSpriteCellID,D.spriteCellChangeSpeed=h.spriteCellChangeSpeed,D.spriteCellWidth=h.spriteCellWidth,D.spriteCellHeight=h.spriteCellHeight,D.spriteRandomStartCell=h.spriteRandomStartCell,D.isAnimationSheetEnabled=h.isAnimationSheetEnabled,D.useLogarithmicDepth=h.useLogarithmicDepth;const H=h.getColorGradients();if(H){D.colorGradients=[];for(const h of H){const o={gradient:h.gradient,color1:h.color1.Fh()};h.color2?o.color2=h.color2.Fh():o.color2=h.color1.Fh(),D.colorGradients.push(o)}}const g=h.getRampGradients();if(g){D.rampGradients=[];for(const h of g){const o={gradient:h.gradient,color:h.color.Fh()};D.rampGradients.push(o)}D.useRampGradients=h.useRampGradients}const j=h.getColorRemapGradients();if(j){D.colorRemapGradients=[];for(const h of j){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,D.colorRemapGradients.push(o)}}const M=h.getAlphaRemapGradients();if(M){D.alphaRemapGradients=[];for(const h of M){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,D.alphaRemapGradients.push(o)}}const R=h.getSizeGradients();if(R){D.sizeGradients=[];for(const h of R){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,D.sizeGradients.push(o)}}const t=h.getAngularSpeedGradients();if(t){D.angularSpeedGradients=[];for(const h of t){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,D.angularSpeedGradients.push(o)}}const S=h.getVelocityGradients();if(S){D.velocityGradients=[];for(const h of S){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,D.velocityGradients.push(o)}}const k=h.getDragGradients();if(k){D.dragGradients=[];for(const h of k){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,D.dragGradients.push(o)}}const K=h.getEmitRateGradients();if(K){D.emitRateGradients=[];for(const h of K){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,D.emitRateGradients.push(o)}}const Q=h.getStartSizeGradients();if(Q){D.startSizeGradients=[];for(const h of Q){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,D.startSizeGradients.push(o)}}const v=h.getLifeTimeGradients();if(v){D.lifeTimeGradients=[];for(const h of v){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,D.lifeTimeGradients.push(o)}}const r=h.getLimitVelocityGradients();if(r){D.limitVelocityGradients=[];for(const h of r){const o={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?o.factor2=h.factor2:o.factor2=h.factor1,D.limitVelocityGradients.push(o)}D.limitVelocityDamping=h.limitVelocityDamping}h.noiseTexture&&(D.noiseTexture=h.noiseTexture.serialize())}clone(D,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H={...this._customWrappers};let g=null;const j=this._engine;if(j.createEffectForParticles&&null!=this.customShader){g=this.customShader;const D=g.shaderOptions.defines.length>0?g.shaderOptions.defines.join("\n"):"",h=j.createEffectForParticles(g.shaderPath.fragmentElement,g.shaderOptions.uniforms,g.shaderOptions.samplers,D);H[0]?H[0].effect=h:this.setCustomEffect(h,0)}const M=this.serialize(o),R=Rh.Parse(M,this._scene||this._engine,this._rootUrl);return R.name=D,R.customShader=g,R._customWrappers=H,void 0===h&&(h=this.Hh),this.noiseTexture&&(R.noiseTexture=this.noiseTexture.clone()),R.Hh=h,this.preventAutoStart||R.start(),R}}Rh.BILLBOARDMODE_Y=2,Rh.BILLBOARDMODE_ALL=7,Rh.BILLBOARDMODE_STRETCHED=8,Rh.BILLBOARDMODE_STRETCHED_LOCAL=9,fD._ParseParticleSystem=Rh.Parse;var th=o(13070),Sh=o(13065),kh=o(12954);kh.d.prototype.createTransformFeedback=function(){const D=this._gl.createTransformFeedback();if(!D)throw new Error("Unable to create Transform Feedback");return D},kh.d.prototype.deleteTransformFeedback=function(D){this._gl.deleteTransformFeedback(D)},kh.d.prototype.bindTransformFeedback=function(D){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,D)},kh.d.prototype.beginTransformFeedback=function(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(D?this._gl.POINTS:this._gl.TRIANGLES)},kh.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},kh.d.prototype.setTranformFeedbackVaryings=function(D,h){this._gl.transformFeedbackVaryings(D,h,this._gl.INTERLEAVED_ATTRIBS)},kh.d.prototype.bindTransformFeedbackBuffer=function(D){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,D?D.underlyingResource:null)},kh.d.prototype.readTransformFeedbackBuffer=function(D){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,D)};const Kh="clipPlaneFragmentDeclaration2",Qh="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";N.d.IncludesShadersStore[Kh]||(N.d.IncludesShadersStore[Kh]=Qh);o(13978),o(13985),o(13987),o(13989),o(13994),o(14e3),o(14007),o(14016);const vh="gpuRenderParticlesPixelShader",rh="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";N.d.ShadersStore[vh]||(N.d.ShadersStore[vh]=rh);const Bh="clipPlaneVertexDeclaration2",sh="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";N.d.IncludesShadersStore[Bh]||(N.d.IncludesShadersStore[Bh]=sh);o(14023),o(14029),o(14035),o(14040);const Uh="gpuRenderParticlesVertexShader",qh="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";N.d.ShadersStore[Uh]||(N.d.ShadersStore[Uh]=qh);class ch extends t{static get IsSupported(){if(!W.d.LastCreatedEngine)return!1;const D=W.d.LastCreatedEngine.getCaps();return D.supportTransformFeedbacks||D.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(D){this._maxActiveParticleCount=Math.min(D,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(D){this.maxActiveParticleCount=D}createPointEmitter(D,h){const o=dD(D,h);return this.particleEmitterType=o,o}createHemisphericEmitter(){const D=XD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=D,D}createSphereEmitter(){const D=AD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=D,D}createDirectedSphereEmitter(){const D=WD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new H.Gh(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.Gh(0,1,0));return this.particleEmitterType=D,D}createCylinderEmitter(){const D=xD(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=D,D}createDirectedCylinderEmitter(){const D=Dh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.Gh(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new H.Gh(0,1,0));return this.particleEmitterType=D,D}createConeEmitter(){const D=hh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=D,D}createDirectedConeEmitter(){const D=oh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new H.Gh(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new H.Gh(0,1,0));return this.particleEmitterType=D,D}createBoxEmitter(D,h,o,H){const g=new K;return this.particleEmitterType=g,this.direction1=D,this.direction2=h,this.minEmitBox=o,this.maxEmitBox=H,g}get flowMap(){return this._flowMap}set flowMap(D){this._flowMap!==D&&(this._flowMap=D)}isReady(){if(!this.Hh||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Rh.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Rh.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Rh.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";D?setTimeout((()=>{this.start(0)}),D):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var D;let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(D=this._customWrappers[h])||void 0===D?void 0:D.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[D]??this._customWrappers[0]}setCustomEffect(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[h]=new DD.c(this._engine),this._customWrappers[h].effect=D}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new X.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(D,h,o){return super._removeGradientAndTexture(D,h,o),this._releaseBuffers(),this}addColorGradient(D,h){this._colorGradients||(this._colorGradients=[]);const o=new z(D,h);return this._colorGradients.push(o),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(D&&this._colorGradients.sort(((D,h)=>D.gradient<h.gradient?-1:D.gradient>h.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(D){return this._removeGradientAndTexture(D,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const h in this._drawWrappers){var D;null===(D=this._drawWrappers[h].drawContext)||void 0===D||D.reset()}}_addFactorGradient(D,h,o){const H=new V(h,o);D.push(H),this._releaseBuffers()}addSizeGradient(D,h){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,D,h),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(D){return this._removeGradientAndTexture(D,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(D,h){if(!D)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&D.sort(((D,h)=>D.gradient<h.gradient?-1:D.gradient>h.gradient?1:0));const o=this;o[h]&&(o[h].dispose(),o[h]=null)}addAngularSpeedGradient(D,h){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,D,h),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(D){return this._removeGradientAndTexture(D,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(D,h){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,D,h),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(D){return this._removeGradientAndTexture(D,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(D,h){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,D,h),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(D){return this._removeGradientAndTexture(D,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(D,h){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,D,h),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(D){return this._removeGradientAndTexture(D,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(D){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(D,h,o){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(D),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Jh=new X.c,this.onStoppedObservable=new X.c,this.onStartedObservable=new X.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,o&&"Scene"!==o.getClassName()?(this._engine=o,this.defaultProjectionMatrix=H.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=o||W.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.YQ.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,R.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,R.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,R.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,R.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new DD.c(this._engine)},this._customWrappers[0].effect=g,this._drawWrappers={0:new DD.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(h=h??{}).randomTextureSize||delete h.randomTextureSize;const M={Ko:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...h},t=h;isFinite(t)&&(M.Ko=t),this._capacity=M.Ko,this._maxActiveParticleCount=M.Ko,this._currentActiveCount=0,this._isAnimationSheetEnabled=j,this.particleEmitterType=new K;const S=Math.min(this._engine.getCaps().maxTextureSize,M.randomTextureSize);let k=[];for(let H=0;H<S;++H)k.push(Math.random()),k.push(Math.random()),k.push(Math.random()),k.push(Math.random());this._randomTexture=new A.c(new Float32Array(k),S,1,5,o,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,k=[];for(let H=0;H<S;++H)k.push(Math.random()),k.push(Math.random()),k.push(Math.random()),k.push(Math.random());this._randomTexture2=new A.c(new Float32Array(k),S,1,5,o,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=S}_reset(){this._releaseBuffers()}_createVertexBuffers(D,h,o){const H={};H.position=h.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let g=3;H.age=h.createVertexBuffer("age",g,1,this._attributesStrideSize,!0),g+=1,H.size=h.createVertexBuffer("size",g,3,this._attributesStrideSize,!0),g+=3,H.life=h.createVertexBuffer("life",g,1,this._attributesStrideSize,!0),g+=1,g+=4,this.billboardMode===Rh.BILLBOARDMODE_STRETCHED&&(H.direction=h.createVertexBuffer("direction",g,3,this._attributesStrideSize,!0)),g+=3,this._platform.alignDataInBuffer&&(g+=1),this.particleEmitterType instanceof y&&(g+=3,this._platform.alignDataInBuffer&&(g+=1)),this._colorGradientsTexture||(H.color=h.createVertexBuffer("color",g,4,this._attributesStrideSize,!0),g+=4),this._isBillboardBased||(H.initialDirection=h.createVertexBuffer("initialDirection",g,3,this._attributesStrideSize,!0),g+=3,this._platform.alignDataInBuffer&&(g+=1)),this.noiseTexture&&(H.noiseCoordinates1=h.createVertexBuffer("noiseCoordinates1",g,3,this._attributesStrideSize,!0),g+=3,this._platform.alignDataInBuffer&&(g+=1),H.noiseCoordinates2=h.createVertexBuffer("noiseCoordinates2",g,3,this._attributesStrideSize,!0),g+=3,this._platform.alignDataInBuffer&&(g+=1)),H.angle=h.createVertexBuffer("angle",g,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?g++:g+=2,this._isAnimationSheetEnabled&&(H.cellIndex=h.createVertexBuffer("cellIndex",g,1,this._attributesStrideSize,!0),g+=1,this.spriteRandomStartCell&&(H.cellStartOffset=h.createVertexBuffer("cellStartOffset",g,1,this._attributesStrideSize,!0),g+=1)),H.offset=o.createVertexBuffer("offset",0,2),H.uv=o.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(H),this._platform.createVertexBuffers(D,H),this.resetDrawCache()}_initialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!D)return;const h=this._engine,o=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof y&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const g=this.particleEmitterType instanceof y,j=H.TmpVectors.Gh[0];let M=0;for(let H=0;H<this._capacity;H++)if(o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(0),o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),g?(this.particleEmitterType.particleDestinationGenerator(H,null,j),o.push(j.x),o.push(j.y),o.push(j.z)):(o.push(0),o.push(0),o.push(0)),this._platform.alignDataInBuffer&&o.push(0),M+=16,g&&(this.particleEmitterType.particlePositionGenerator(H,null,j),o.push(j.x),o.push(j.y),o.push(j.z),this._platform.alignDataInBuffer&&o.push(0),M+=4),this._colorGradientsTexture||(o.push(0),o.push(0),o.push(0),o.push(0),M+=4),this.isBillboardBased||(o.push(0),o.push(0),o.push(0),this._platform.alignDataInBuffer&&o.push(0),M+=4),this.noiseTexture&&(o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),this._platform.alignDataInBuffer&&o.push(0),o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),this._platform.alignDataInBuffer&&o.push(0),M+=8),o.push(0),M+=1,this._angularSpeedGradientsTexture||(o.push(0),M+=1),this._isAnimationSheetEnabled&&(o.push(0),M+=1,this.spriteRandomStartCell&&(o.push(0),M+=1)),this._platform.alignDataInBuffer){let D=3-(M+3&3);for(M+=D;D-- >0;)o.push(0)}const R=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),t=this._platform.createParticleBuffer(o),S=this._platform.createParticleBuffer(o);this._buffer0=new b.d(h,t,!1,this._attributesStrideSize),this._buffer1=new b.d(h,S,!1,this._attributesStrideSize),this._spriteBuffer=new b.d(h,R,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let D=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(D+="\n#define BILLBOARD"),this._colorGradientsTexture&&(D+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(D+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(D+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(D+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(D+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(D+="\n#define DRAGGRADIENTS"),this._flowMap&&(D+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(D+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(D+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(D+="\n#define NOISE"),this.isLocal&&(D+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===D||(this._cachedUpdateDefines=D,this._updateBuffer=this._platform.createUpdateBuffer(D)),this._platform.isUpdateBufferReady()}_getWrapper(D){const h=this._getCustomDrawWrapper(D);if(null!==h&&void 0!==h&&h.effect)return h;const o=[];this.fillDefines(o,D);let H=this._drawWrappers[D];H||(H=new DD.c(this._engine),H.drawContext&&(H.drawContext.useInstancing=!0),this._drawWrappers[D]=H);const g=o.join("\n");if(H.defines!==g){const D=[],h=[],o=[];this.fillUniformsAttributesAndSamplerNames(h,D,o),H.setEffect(this._engine.createEffect("gpuRenderParticles",D,h,o,g),g)}return H}static _GetAttributeNamesOrOptions(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const g=[b.f.PositionKind,"age","life","size","angle"];return D||g.push(b.f.ColorKind),h&&g.push("cellIndex"),o||g.push("initialDirection"),H&&g.push("direction"),g.push("offset",b.f.UVKind),g}static _GetEffectCreationOptions(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H=["emitterWM","Rk","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,hD.e)(H),D&&H.push("sheetInfos"),h&&H.push("logarithmicDepthConstant"),o&&(H.push("vFogInfos"),H.push("vFogColor")),H}fillDefines(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,hD.k)(this,this._scene,D),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Sh.b.FOGMODE_NONE&&D.push("#define FOG")),h===Rh.BLENDMODE_MULTIPLY&&D.push("#define BLENDMULTIPLYMODE"),this.isLocal&&D.push("#define LOCAL"),this.useLogarithmicDepth&&D.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(D.push("#define BILLBOARD"),this.billboardMode){case Rh.BILLBOARDMODE_Y:D.push("#define BILLBOARDY");break;case Rh.BILLBOARDMODE_STRETCHED:D.push("#define BILLBOARDSTRETCHED");break;case Rh.BILLBOARDMODE_ALL:D.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&D.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&D.push("#define ANIMATESHEET"),o&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),D.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(D,h,o){h.push(...ch._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Rh.BILLBOARDMODE_STRETCHED)),D.push(...ch._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),o.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(th.c.PrepareUniforms(D,this._imageProcessingConfigurationDefines),th.c.PrepareSamplers(o,this._imageProcessingConfigurationDefines))}animate(){var D;let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(h?this.preWarmStepOffset:(null===(D=this._scene)||void 0===D?void 0:D.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(D,h){const o=this[h];if(!D||!D.length||o)return;const H=new Float32Array(this._rawTextureWidth);for(let g=0;g<this._rawTextureWidth;g++){const h=g/this._rawTextureWidth;d.GetCurrentGradient(h,D,((D,h,o)=>{H[g]=(0,S.Lerp)(D.factor1,h.factor1,o)}))}this[h]=A.c.CreateRTexture(H,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[h].name=h.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const D=new Uint8Array(4*this._rawTextureWidth),h=M.TmpColors.yg[0];for(let o=0;o<this._rawTextureWidth;o++){const H=o/this._rawTextureWidth;d.GetCurrentGradient(H,this._colorGradients,((H,g,j)=>{M.yg.LerpToRef(H.color1,g.color1,j,h),D[4*o]=255*h.r,D[4*o+1]=255*h.g,D[4*o+2]=255*h.b,D[4*o+3]=255*h.a}))}this._colorGradientsTexture=A.c.CreateRGBATexture(D,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(D,h){var o,g,j,M;const R=this._getWrapper(D),t=R.effect;this._engine.enableEffect(R);const S=(null===(o=this._scene)||void 0===o?void 0:o.getViewMatrix())||H.Matrix.IdentityReadOnly;if(t.setMatrix("view",S),t.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),t.setTexture("diffuseSampler",this.particleTexture),t.setVector2("translationPivot",this.translationPivot),t.setVector3("Rk",this.Rk),this.isLocal&&t.setMatrix("emitterWM",h),this._colorGradientsTexture?t.setTexture("colorGradientSampler",this._colorGradientsTexture):t.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const D=this.particleTexture.getBaseSize();t.setFloat3("sheetInfos",this.spriteCellWidth/D.width,this.spriteCellHeight/D.height,D.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const D=this._scene.activeCamera;t.setVector3("eyePosition",D.globalPosition)}const k=t.defines;if(this._scene&&((0,hD.g)(t,this,this._scene),this.applyFog&&(0,oD.d)(this._scene,void 0,t)),k.indexOf("#define BILLBOARDMODE_ALL")>=0){const D=S.clone();D.invert(),t.setMatrix("invView",D)}return this.useLogarithmicDepth&&this._scene&&(0,oD.j)(k,t,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(t),this._setEngineBasedOnBlendMode(D),this._platform.bindDrawBuffers(this._targetIndex,t,null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(t),null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(M=this._scene)&&void 0!==M&&M.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(D){if(!this.Hh||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!D)if(this.Hh.position){D=this.Hh.getWorldMatrix()}else{const h=this.Hh;D=H.TmpVectors.Matrix[0],H.Matrix.TranslationToRef(h.x,h.y,h.z,D)}const h=this._engine,o=h.getDepthWrite();if(h.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const D=this.GD();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",D.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",D),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const g=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=g,h.setDepthWrite(o)}render(){let D,h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!h&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let D=0;D<this.preWarmCycles;D++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const D=0|this._accumulatedCount;this._accumulatedCount-=D,this._currentActiveCount+=D}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Hh.position){D=this.Hh.getWorldMatrix()}else{const h=this.Hh;D=H.TmpVectors.Matrix[0],H.Matrix.TranslationToRef(h.x,h.y,h.z,D)}const g=this._engine;this.updateInAnimate||this._update(D);let j=0;return h||o||(g.setState(!1),this.forceDepthWrite&&g.setDepthWrite(!0),j=this.blendMode===Rh.BLENDMODE_MULTIPLYADD?this._render(Rh.BLENDMODE_MULTIPLY,D)+this._render(Rh.BLENDMODE_ADD,D):this._render(this.blendMode,D),this._engine.setAlphaMode(0)),j}rebuild(){const D=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(D,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,D()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const h in this._drawWrappers){this._drawWrappers[h].dispose()}if(this._drawWrappers={},this._scene){const D=this._scene.YQ.indexOf(this);D>-1&&this._scene.YQ.splice(D,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let h=0;h<this._renderVertexBuffers.length;++h){const D=this._renderVertexBuffers[h];for(const h in D)D[h].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),D&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),D&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Jh.notifyObservers(this),this.Jh.clear()}clone(D,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const H={...this._customWrappers};let g=null;const j=this._engine;if(j.createEffectForParticles&&null!=this.customShader){g=this.customShader;const D=g.shaderOptions.defines.length>0?g.shaderOptions.defines.join("\n"):"";H[0]=j.createEffectForParticles(g.shaderPath.fragmentElement,g.shaderOptions.uniforms,g.shaderOptions.samplers,D,void 0,void 0,void 0,this)}const M=this.serialize(o),R=ch.Parse(M,this._scene||this._engine,this._rootUrl);return R.name=D,R.customShader=g,R._customWrappers=H,void 0===h&&(h=this.Hh),this.noiseTexture&&(R.noiseTexture=this.noiseTexture.clone()),R.Hh=h,R}serialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={};return Rh._Serialize(h,this,D),h.activeParticleCount=this.activeParticleCount,h.randomTextureSize=this._randomTextureSize,h.customShader=this.customShader,h}static Parse(D,h,o){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4?arguments[4]:void 0;const j=D.name;let M,R;h instanceof VD.e?M=h:(R=h,M=R.getEngine());const t=new ch(j,{Ko:g||D.Ko,randomTextureSize:D.randomTextureSize},h,null,D.isAnimationSheetEnabled);if(t._rootUrl=o,D.customShader&&M.createEffectForParticles){const h=D.customShader,o=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"",H=M.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,o,void 0,void 0,void 0,t);t.setCustomEffect(H,0),t.customShader=h}return D.id&&(t.id=D.id),D.activeParticleCount&&(t.activeParticleCount=D.activeParticleCount),Rh._Parse(D,t,h,o),D.preventAutoStart&&(t.preventAutoStart=D.preventAutoStart),H||t.preventAutoStart||t.start(),t}}var yh=o(12642),bh=o(14044),ih=o(13205);class Gh{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(D){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const h of this.systems)h.Hh=D;this._emitterNode=D}setEmitterAsSphere(D,h,o){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:D,renderingGroupId:h};const H=(0,bh.b)("emitterSphere",{diameter:D.diameter,segments:D.segments},o);H.renderingGroupId=h;const g=new ih.Zh("emitterSphereMaterial",o);g.emissiveColor=D.color,H.material=g;for(const j of this.systems)j.Hh=H;this._emitterNode=H}start(D){for(const h of this.systems)D&&(h.Hh=D),h.start()}dispose(){for(const D of this.systems)D.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={systems:[]};for(const o of this.systems)h.systems.push(o.serialize(D));return this._emitterNode&&(h.Hh=this._emitterCreationOptions),h}static Parse(D,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3?arguments[3]:void 0;const g=new Gh,j=this.BaseAssetsUrl+"/textures/";h=h||W.d.LastCreatedScene;for(const M of D.systems)g.systems.push(o?ch.Parse(M,h,j,!0,H):Rh.Parse(M,h,j,!0,H));if(D.Hh){const o=D.Hh.options;if("Sphere"===D.Hh.kind)g.setEmitterAsSphere({diameter:o.diameter,segments:o.segments,color:M.mo.Ih(o.color)},D.Hh.renderingGroupId,h)}return g}}Gh.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Nh=o(12674);class Jh{static CreateDefault(D){let h,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,H=arguments.length>2?arguments[2]:void 0;h=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ch("default system",{Ko:o},H):new Rh("default system",o,H),h.Hh=D;const g=yh.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return h.particleTexture=new mD.b(g,h.GD()),h.createConeEmitter(.1,Math.PI/4),h.color1=new M.yg(1,1,1,1),h.color2=new M.yg(1,1,1,1),h.colorDead=new M.yg(1,1,1,0),h.minSize=.1,h.maxSize=.1,h.minEmitPower=2,h.maxEmitPower=2,h.updateSpeed=1/60,h.emitRate=30,h}static CreateAsync(D,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3?arguments[3]:void 0;h||(h=W.d.LastCreatedScene);const g={};return h.addPendingData(g),new Promise(((j,M)=>{if(o&&!ch.IsSupported)return h.removePendingData(g),M("Particle system with GPU is not supported.");yh.Tools.LoadFile(`${Jh.BaseAssetsUrl}/systems/${D}.json`,(D=>{h.removePendingData(g);const M=JSON.parse(D.toString());return j(Gh.Parse(M,h,o,H))}),void 0,void 0,void 0,(()=>(h.removePendingData(g),M(`An error occurred with the creation of your particle system. Check if your type '${D}' exists.`))))}))}static ExportSet(D){const h=new Gh;for(const o of D)h.systems.push(o);return h}static ParseFromFileAsync(D,h,o){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",j=arguments.length>5?arguments[5]:void 0;return new Promise(((M,R)=>{const t=new Nh.e;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const h=JSON.parse(t.responseText);let R;R=H?ch.Parse(h,o,g,!1,j):Rh.Parse(h,o,g,!1,j),D&&(R.name=D),M(R)}else R("Unable to load the particle system")})),t.open("GET",h),t.send()}))}static ParseFromSnippetAsync(D,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",g=arguments.length>4?arguments[4]:void 0;if("_BLANK"===D){const D=this.CreateDefault(null);return D.start(),Promise.resolve(D)}return new Promise(((j,M)=>{const R=new Nh.e;R.addEventListener("readystatechange",(()=>{if(4==R.readyState)if(200==R.status){const M=JSON.parse(JSON.parse(R.responseText).jsonPayload),t=JSON.parse(M.particleSystem);let S;S=o?ch.Parse(t,h,H,!1,g):Rh.Parse(t,h,H,!1,g),S.snippetId=D,j(S)}else M("Unable to load the snippet "+D)})),R.open("GET",this.SnippetUrl+"/"+D.replace(/#/g,"/")),R.send()}))}}Jh.BaseAssetsUrl=Gh.BaseAssetsUrl,Jh.SnippetUrl="https://snippet.babylonjs.com",Jh.CreateFromSnippetAsync=Jh.ParseFromSnippetAsync;var Oh=o(13288),Eh=o(13094),Lh=o(14046);(0,Lh.e)(Eh.e.NAME_PARTICLESYSTEM,((D,h,o,H)=>{const g=(0,Lh.h)(Eh.e.NAME_PARTICLESYSTEM);if(g&&void 0!==D.YQ&&null!==D.YQ)for(let j=0,M=D.YQ.length;j<M;j++){const M=D.YQ[j];o.YQ.push(g(M,h,H))}})),(0,Lh.c)(Eh.e.NAME_PARTICLESYSTEM,((D,h,o)=>{if(D.activeParticleCount){return ch.Parse(D,h,o)}return Rh.Parse(D,h,o)})),VD.e.prototype.createEffectForParticles=function(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",j=arguments.length>4?arguments[4]:void 0,M=arguments.length>5?arguments[5]:void 0,R=arguments.length>6?arguments[6]:void 0,t=arguments.length>7?arguments[7]:void 0,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,k=arguments.length>9?arguments[9]:void 0,K=[],Q=[];const v=[];return t?t.fillUniformsAttributesAndSamplerNames(Q,K,v):(K=Rh._GetAttributeNamesOrOptions(),Q=Rh._GetEffectCreationOptions()),-1===g.indexOf(" BILLBOARD")&&(g+="\n#define BILLBOARD\n"),null!==t&&void 0!==t&&t.isAnimationSheetEnabled&&-1===g.indexOf(" ANIMATESHEET")&&(g+="\n#define ANIMATESHEET\n"),-1===H.indexOf("diffuseSampler")&&H.push("diffuseSampler"),this.createEffect({vertex:k??(null===t||void 0===t?void 0:t.vertexShaderName)??"particles",fragmentElement:D},K,Q.concat(h),v.concat(H),g,j,M,R,void 0,S,(async()=>{0===S?await Promise.resolve().then(o.bind(o,14082)):await Promise.resolve().then(o.bind(o,14154))}))},Oh.d.prototype.getEmittedParticleSystems=function(){const D=[];for(let h=0;h<this.GD().YQ.length;h++){const o=this.GD().YQ[h];o.Hh===this&&D.push(o)}return D},Oh.d.prototype.getHierarchyEmittedParticleSystems=function(){const D=[],h=this.getDescendants();h.push(this);for(let o=0;o<this.GD().YQ.length;o++){const H=this.GD().YQ[o],g=H.Hh;g.position&&-1!==h.indexOf(g)&&D.push(H)}return D};o(13169),o(13176),o(13266);o(13273),o(14055),o(13031),o(13158),o(13312);o(13024);var Th;o(14058),o(12849);!function(D){D[D.Color=2]="Color",D[D.UV=1]="UV",D[D.Random=0]="Random",D[D.Stated=3]="Stated"}(Th||(Th={}));var Zh=o(13053);const eh=new H.Gh(0,0,0),ph=new H.Gh(0,0,0),mo=new H.Gh(0,0,0);class ah{constructor(D,h,o){this.width=D,this.height=h,this.data=o}processFlowable(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;if(!o)return;o instanceof H.Matrix?H.Gh.TransformCoordinatesToRef(D.position,o,mo):(mo.x=o.x,mo.y=o.y,mo.z=o.z);const g=.5*mo.x+.5,j=1-(.5*mo.y+.5),M=Math.floor(g*this.width),R=Math.floor(j*this.height);if(M<0||M>=this.width||R<0||R>=this.height)return;const t=4*(R*this.width+M),S=this.data[t]/255*2-1,k=this.data[t+1]/255*2-1,K=this.data[t+2]/255*2-1,Q=this.data[t+3]/255;eh.set(S,k,K),eh.scaleToRef(h*Q,ph),D.direction.addInPlace(ph)}_processParticle(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;this.processFlowable(D,h,o)}static async FromUrlAsync(D){return await new Promise(((h,o)=>{const H=document.createElement("canvas"),g=H.getContext("2d");let j=null;const M=new Image;M.crossOrigin="anonymous",M.src=D,M.onerror=h=>{o(new Error(`Failed to load image: ${D} : ${h}`))},M.onload=()=>{H.width=M.width,H.height=M.height,g.drawImage(M,0,0),j=g.getImageData(0,0,H.width,H.height),h(new ah(H.width,H.height,j.data))}}))}static async ExtractFromTextureAsync(D){return await new Promise(((h,o)=>{if(!D.isReady())return void D.onLoadObservable.addOnce((async()=>{try{const o=await this.ExtractFromTextureAsync(D);h(o)}catch(H){o(H)}}));const H=D.getSize();Zh.m.GetTextureDataAsync(D,H.width,H.height).then((D=>{h(new ah(H.width,H.height,new Uint8ClampedArray(D)))})).catch(o)}))}}var uh,Ih,Ph,nh,Fh,wh,Yh,lh,Ch;!function(D){D[D.Int=1]="Int",D[D.Float=2]="Float",D[D.Vector2=4]="Vector2",D[D.Gh=8]="Gh",D[D.Matrix=16]="Matrix",D[D.Particle=32]="Particle",D[D.Texture=64]="Texture",D[D.yg=128]="yg",D[D.FloatGradient=256]="FloatGradient",D[D.Vector2Gradient=512]="Vector2Gradient",D[D.Vector3Gradient=1024]="Vector3Gradient",D[D.Color4Gradient=2048]="Color4Gradient",D[D.System=4096]="System",D[D.AutoDetect=8192]="AutoDetect",D[D.BasedOnInput=16384]="BasedOnInput",D[D.Undefined=32768]="Undefined",D[D.All=65535]="All"}(uh||(uh={})),function(D){D[D.Compatible=0]="Compatible",D[D.TypeIncompatible=1]="TypeIncompatible",D[D.HierarchyIssue=2]="HierarchyIssue"}(Ih||(Ih={})),function(D){D[D.Input=0]="Input",D[D.Output=1]="Output"}(Ph||(Ph={}));class zh{get direction(){return this._direction}get type(){if(this._type===uh.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===uh.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(D){this._type=D}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((D=>D.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(D,h,o){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=uh.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new X.c,this.onDisconnectionObservable=new X.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=h,this.name=D,this._direction=o}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(D){var h;return this.isConnected?null!==(h=this._connectedPoint)&&void 0!==h&&h._storedFunction?this._connectedPoint._storedFunction(D):this._connectedPoint._storedValue:this.value}canConnectTo(D){return 0===this.checkCompatibilityState(D)}checkCompatibilityState(D){const h=this._ownerBlock,o=D.ownerBlock;if(this.type!==D.type&&D.innerType!==uh.AutoDetect)return D.acceptedConnectionPointTypes&&-1!==D.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(D.excludedConnectionPointTypes&&-1!==D.excludedConnectionPointTypes.indexOf(this.type))return 1;let H=o,g=h;return 0===this.direction&&(H=h,g=o),H.isAnAncestorOf(g)?2:0}connectTo(D){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(D))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${D.ownerBlock.name}".${D.name}`;return this._endpoints.push(D),D._connectedPoint=this,this.onConnectionObservable.notifyObservers(D),D.onConnectionObservable.notifyObservers(this),this}disconnectFrom(D){const h=this._endpoints.indexOf(D);return-1===h||(this._endpoints.splice(h,1),D._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(D),D.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(D){let h=1;for(;h<uh.All;)D&h||this.excludedConnectionPointTypes.push(h),h<<=1}serialize(){let D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const h={};return h.name=this.name,h.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Fh?(h.valueType="BABYLON."+this.value.getClassName(),h.value=this.value.Fh()):(h.valueType="number",h.value=this.value)),D&&this.connectedPoint&&(h.inputName=this.name,h.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,h.targetConnectionName=this.connectedPoint.name,h.isExposedOnFrame=!0,h.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(h.isExposedOnFrame=!0,h.exposedPortPosition=this.exposedPortPosition),h}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class fh{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(D){this._name=D}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(D){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new X.c,this.Jh=new X.c,this.onInputChangedObservable=new X.c,this.visibleOnFrame=!1,this._name=D,this.uniqueId=a.c.UniqueId}_inputRename(D){return D}_outputRename(D){return D}isAnAncestorOf(D){for(const h of this._outputs)if(h.hasEndpoints)for(const o of h.endpoints){if(o.ownerBlock===D)return!0;if(o.ownerBlock.isAnAncestorOf(D))return!0}return!1}isAnAncestorOfType(D){if(this.getClassName()===D)return!0;for(const h of this._outputs)if(h.hasEndpoints)for(const o of h.endpoints)if(o.ownerBlock.isAnAncestorOfType(D))return!0;return!1}getInputByName(D){const h=this._inputs.filter((h=>h.name===D));return h.length?h[0]:null}_linkConnectionTypes(D,h){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[h]._acceptedConnectionPointType=this._inputs[D]:(this._inputs[D]._linkedConnectionSource=this._inputs[h],this._inputs[D]._isMainLinkSource=!0),this._inputs[h]._linkedConnectionSource=this._inputs[D]}registerInput(D,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0,j=arguments.length>5?arguments[5]:void 0;const M=new zh(D,this,0);return M.type=h,M.isOptional=o,M.defaultValue=H,M.value=H,M.valueMin=g,M.valueMax=j,this._inputs.push(M),this.onInputChangedObservable.notifyObservers(M),this}registerOutput(D,h,o){return(o=o??new zh(D,this,1)).type=h,this._outputs.push(o),this}_build(D){}_customBuildStep(D){}build(D){if(this._buildId===D.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((D=>D.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=D.buildId;for(const h of this._inputs){if(!h.connectedPoint){h.isOptional||D.notConnectedNonOptionalInputs.push(h);continue}const o=h.connectedPoint.ownerBlock;o&&o!==this&&!o.isSystem&&o.build(D)}return this._customBuildStep(D),D.verbose&&u.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(D),this.onBuildObservable.notifyObservers(this),!1}serialize(){const D={};D.customType="BABYLON."+this.getClassName(),D.id=this.uniqueId,D.name=this.name,D.visibleOnFrame=this.visibleOnFrame,D.inputs=[],D.outputs=[];for(const h of this.inputs)D.inputs.push(h.serialize());for(const h of this.outputs)D.outputs.push(h.serialize(!1));return D}_deserialize(D){this._name=D.name,this.comments=D.comments,this.visibleOnFrame=!!D.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(D)}_deserializePortDisplayNamesAndExposedOnFrame(D){const h=D.inputs,o=D.outputs;if(h)for(const H of h){const D=this.inputs.find((D=>D.name===H.name));if(!D)return;if(H.displayName&&(D.displayName=H.displayName),H.isExposedOnFrame&&(D.isExposedOnFrame=H.isExposedOnFrame,D.exposedPortPosition=H.exposedPortPosition),void 0!==H.value&&null!==H.value)if("number"===H.valueType)D.value=H.value;else{const h=(0,R.d)(H.valueType);h&&(D.value=h.Ih(H.value))}}if(o)for(let H=0;H<o.length;H++){const D=o[H];D.displayName&&(this.outputs[H].displayName=D.displayName),D.isExposedOnFrame&&(this.outputs[H].isExposedOnFrame=D.isExposedOnFrame,this.outputs[H].exposedPortPosition=D.exposedPortPosition)}}clone(){const D=this.serialize(),h=(0,R.d)(D.customType);if(h){const o=new h;return o._deserialize(D),o}return null}dispose(){this.Jh.notifyObservers(this),this.Jh.clear();for(const D of this.inputs)D.dispose();for(const D of this.outputs)D.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Vh(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",H=arguments.length>3?arguments[3]:void 0;return(g,j)=>{let M=g._propStore;M||(M=[],g._propStore=M),M.push({propertyName:j,displayName:D,type:h,groupName:o,options:H??{},className:g.getClassName()})}}(0,Z.c)([(0,e.I)("comment")],fh.prototype,"comments",void 0),function(D){D[D.Boolean=0]="Boolean",D[D.Float=1]="Float",D[D.Int=2]="Int",D[D.Vector2=3]="Vector2",D[D.List=4]="List",D[D.yg=5]="yg",D[D.SamplingMode=6]="SamplingMode",D[D.TextureFormat=7]="TextureFormat",D[D.TextureType=8]="TextureType"}(nh||(nh={})),function(D){D[D.None=0]="None",D[D.Position=1]="Position",D[D.Direction=2]="Direction",D[D.Age=3]="Age",D[D.Lifetime=4]="Lifetime",D[D.Color=5]="Color",D[D.ScaledDirection=6]="ScaledDirection",D[D.Scale=7]="Scale",D[D.AgeGradient=8]="AgeGradient",D[D.Angle=9]="Angle",D[D.SpriteCellIndex=16]="SpriteCellIndex",D[D.SpriteCellStart=17]="SpriteCellStart",D[D.SpriteCellEnd=18]="SpriteCellEnd"}(Fh||(Fh={})),function(D){D[D.None=0]="None",D[D.Time=1]="Time",D[D.Delta=2]="Delta",D[D.Emitter=3]="Emitter"}(wh||(wh={}));class dh{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let D="";for(const h of this.notConnectedNonOptionalInputs)D+=`input ${h.name} from block ${h.ownerBlock.name}[${h.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(D)throw"Build of Node Particle System Set failed:\n"+D}adapt(D,h){const o=D.getConnectedValue(this)||0;if(D.type===h)return o;switch(h){case uh.Vector2:return new H.Vector2(o,o);case uh.Gh:return new H.Gh(o,o,o);case uh.yg:return new M.yg(o,o,o,o)}return null}getContextualValue(D){if(!this.particleContext||!this.systemContext)return null;switch(D){case Fh.Position:return this.particleContext.position;case Fh.Direction:return this.particleContext.direction;case Fh.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Fh.Color:return this.particleContext.color;case Fh.Age:return this.particleContext.age;case Fh.Lifetime:return this.particleContext.lifeTime;case Fh.Angle:return this.particleContext.angle;case Fh.Scale:return this.particleContext.scale;case Fh.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Fh.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Fh.SpriteCellIndex:return this.particleContext.cellIndex;case Fh.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Hh.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Hh.absolutePosition:this.systemContext.Hh:null}getSystemValue(D){if(!this.particleContext||!this.systemContext)return null;switch(D){case wh.Time:return this.systemContext._actualFrame;case wh.Delta:return this.systemContext._scaledUpdateSpeed;case wh.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Hh.absolutePosition}return this.systemContext.Hh}return null}}function Xh(D,h,o){const H=new dh;H.Th=h;const g=D.createSystem(H);return g.canStart=()=>!0,g.Hh=o.clone(),g.disposeOnStop=!0,g.start(),g}class Ah extends fh{constructor(D){super(D),this.blendMode=t.BLENDMODE_ONEONE,this.Ko=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",uh.Particle),this.registerInput("texture",uh.Texture),this.registerInput("onStart",uh.System,!0),this.registerInput("onEnd",uh.System,!0),this.registerOutput("system",uh.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(D){D.Ko=this.Ko,D.buildId=this._buildId++,this.build(D);const h=this.particle.getConnectedValue(D);return h.particleTexture=this.texture.getConnectedValue(D),h.emitRate=this.emitRate,h.blendMode=this.blendMode,h.name=this.name,h._nodeGenerated=!0,h._targetStopDuration=this.targetStopDuration,h.startDelay=this.startDelay,this.system._storedValue=this,h.canStart=()=>!this.doNoStart,h.onStartedObservable.add((o=>{const H=this.onStart.getConnectedValue(D);H&&o.onStartedObservable.addOnce((()=>{D.systemContext=h;const o=Xh(H,D.Th,D.emitterPosition);this.Jh.addOnce((()=>{o.dispose()}))}));const g=this.onEnd.getConnectedValue(D);g&&o.onStoppedObservable.addOnce((()=>{D.systemContext=h;const o=Xh(g,D.Th,D.emitterPosition);this.Jh.addOnce((()=>{o.dispose()}))}))})),this.Jh.addOnce((()=>{h.dispose()})),h}serialize(){const D=super.serialize();return D.Ko=this.Ko,D.emitRate=this.emitRate,D.blendMode=this.blendMode,D.doNoStart=this.doNoStart,D.targetStopDuration=this.targetStopDuration,D.startDelay=this.startDelay,D}_deserialize(D){super._deserialize(D),this.Ko=D.Ko,this.emitRate=D.emitRate,this.doNoStart=!!D.doNoStart,void 0!==D.blendMode&&(this.blendMode=D.blendMode),void 0!==D.targetStopDuration&&(this.targetStopDuration=D.targetStopDuration),void 0!==D.startDelay&&(this.startDelay=D.startDelay)}}(0,Z.c)([Vh("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:t.BLENDMODE_ONEONE},{label:"Standard",value:t.BLENDMODE_STANDARD},{label:"Add",value:t.BLENDMODE_ADD},{label:"Multiply",value:t.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:t.BLENDMODE_MULTIPLYADD}]})],Ah.prototype,"blendMode",void 0),(0,Z.c)([Vh("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Ah.prototype,"Ko",void 0),(0,Z.c)([Vh("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ah.prototype,"emitRate",void 0),(0,Z.c)([Vh("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ah.prototype,"targetStopDuration",void 0),(0,Z.c)([Vh("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ah.prototype,"startDelay",void 0),(0,Z.c)([Vh("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Ah.prototype,"doNoStart",void 0),(0,R.g)("BABYLON.SystemBlock",Ah);class Wh extends fh{get type(){if(this._type===uh.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=uh.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=uh.Vector2,this._type;case"Gh":return this._type=uh.Gh,this._type;case"yg":return this._type=uh.yg,this._type;case"Matrix":return this._type=uh.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Fh.None&&this._systemSource!==wh.None}get systemSource(){return this._systemSource}set systemSource(D){if(this._systemSource=D,D!==wh.None){switch(this._contextualSource=Fh.None,this._type=uh.Float,D){case wh.Time:case wh.Delta:this._type=uh.Float;break;case wh.Emitter:this._type=uh.Gh}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Fh.None}get contextualValue(){return this._contextualSource}set contextualValue(D){if(this._contextualSource=D,D!==Fh.None){switch(this._systemSource=wh.None,D){case Fh.Scale:this._type=uh.Vector2;break;case Fh.Position:case Fh.Direction:case Fh.ScaledDirection:this._type=uh.Gh;break;case Fh.Color:this._type=uh.yg;break;case Fh.Age:case Fh.Lifetime:case Fh.Angle:case Fh.AgeGradient:this._type=uh.Float;break;case Fh.SpriteCellEnd:case Fh.SpriteCellStart:case Fh.SpriteCellIndex:this._type=uh.Int}this.output&&(this.output.type=this._type)}}constructor(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:uh.AutoDetect;super(D),this._type=uh.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new X.c,this._systemSource=wh.None,this._contextualSource=Fh.None,this._type=h,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",h)}get value(){return this._storedValue}set value(D){this.type===uh.Float&&this.min!==this.max&&(D=Math.max(this.min,D),D=Math.min(this.max,D)),this._storedValue=D,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(D){this._valueCallback=D}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case uh.Int:case uh.Float:this.value=0;break;case uh.Vector2:this.value=H.Vector2.Zero();break;case uh.Gh:this.value=H.Gh.Zero();break;case uh.yg:this.value=new M.yg(1,1,1,1);break;case uh.Matrix:this.value=H.Matrix.Identity()}}_build(D){super._build(D),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=D=>D.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=D=>D.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const D=super.serialize();return D.type=this.type,D.contextualValue=this.contextualValue,D.systemSource=this.systemSource,D.min=this.min,D.max=this.max,D.groupInInspector=this.groupInInspector,D.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Fh?(D.valueType="BABYLON."+this._storedValue.getClassName(),D.value=this._storedValue.Fh()):(D.valueType="number",D.value=this._storedValue)),D}_deserialize(D){if(super._deserialize(D),this._type=D.type,this.contextualValue=D.contextualValue,this.systemSource=D.systemSource||wh.None,this.min=D.min||0,this.max=D.max||0,this.groupInInspector=D.groupInInspector||"",void 0!==D.displayInInspector&&(this.displayInInspector=D.displayInInspector),D.valueType)if("number"===D.valueType)this._storedValue=D.value;else{const h=(0,R.d)(D.valueType);h&&(this._storedValue=h.Ih(D.value))}}}(0,R.g)("BABYLON.ParticleInputBlock",Wh);class xh extends fh{get url(){return this._url}set url(D){this._url!==D&&(this._cachedData=null,this._url=D,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(D){this._textureDataUrl!==D&&(this._cachedData=null,this._textureDataUrl=D,this._url="",this._sourceTexture=null)}set sourceTexture(D){this._sourceTexture!==D&&(this._cachedData=null,this._sourceTexture=D,this._url="",this._textureDataUrl="")}constructor(D){super(D),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",uh.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const D=this.texture._storedValue;return await new Promise(((h,o)=>{if(!D.isReady())return void D.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),h(this._cachedData)}catch(D){o(D)}}));const H=D.getSize();Zh.m.GetTextureDataAsync(D,H.width,H.height).then((o=>{this._cachedData={width:H.width,height:H.height,data:new Uint8ClampedArray(o)},D.dispose(),h(this._cachedData)})).catch(o)}))}_build(D){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new mD.b(this._textureDataUrl,D.Th):this.texture._storedValue=new mD.b(this._url,D.Th):this.texture._storedValue=null}serialize(){const D=super.serialize();return D.url=this.url,D.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(D.textureDataUrl=this.textureDataUrl),D}_deserialize(D){super._deserialize(D),this.url=D.url,this.serializedCachedData=!!D.serializedCachedData,D.textureDataUrl&&(this.textureDataUrl=D.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,R.g)("BABYLON.ParticleTextureSourceBlock",xh);class Do extends fh{constructor(D){super(D),this.registerInput("particle",uh.Particle),this.registerInput("position",uh.Gh),this.registerOutput("output",uh.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(D){const h=this.particle.getConnectedValue(D);if(this.output._storedValue=h,!this.position.isConnected)return;const o={process:o=>{D.particleContext=o,D.systemContext=h,o.position.M(this.position.getConnectedValue(D))},previousItem:null,nextItem:null};h._updateQueueStart?wD(o,h._updateQueueStart):h._updateQueueStart=o}}(0,R.g)("BABYLON.UpdatePositionBlock",Do),function(D){D[D.Add=0]="Add",D[D.Subtract=1]="Subtract",D[D.Multiply=2]="Multiply",D[D.Divide=3]="Divide",D[D.Max=4]="Max",D[D.Min=5]="Min"}(Yh||(Yh={}));class ho extends fh{constructor(D){super(D),this.operation=Yh.Add,this.registerInput("left",uh.AutoDetect),this.registerInput("right",uh.AutoDetect),this.registerOutput("output",uh.BasedOnInput),this.output._typeConnectionSource=this.left;const h=[uh.Matrix,uh.Particle,uh.Texture,uh.System,uh.FloatGradient,uh.Color4Gradient,uh.Vector2Gradient,uh.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...h),this.right.excludedConnectionPointTypes.push(...h),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(D){let h;const o=this.left,g=this.right;if(!o.isConnected||!g.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const j=o.type===uh.Float||o.type===uh.Int,R=g.type===uh.Float||g.type===uh.Int,t=j&&R;switch(this.operation){case Yh.Add:h=t?D=>o.getConnectedValue(D)+g.getConnectedValue(D):j?D=>D.adapt(o,g.type).add(g.getConnectedValue(D)):D=>o.getConnectedValue(D).add(D.adapt(g,o.type));break;case Yh.Subtract:h=t?D=>o.getConnectedValue(D)-g.getConnectedValue(D):j?D=>D.adapt(o,g.type).Nh(g.getConnectedValue(D)):D=>o.getConnectedValue(D).Nh(D.adapt(g,o.type));break;case Yh.Multiply:h=t?D=>o.getConnectedValue(D)*g.getConnectedValue(D):j?D=>D.adapt(o,g.type).multiply(g.getConnectedValue(D)):D=>o.getConnectedValue(D).multiply(D.adapt(g,o.type));break;case Yh.Divide:h=t?D=>o.getConnectedValue(D)/g.getConnectedValue(D):j?D=>D.adapt(o,g.type).divide(g.getConnectedValue(D)):D=>o.getConnectedValue(D).divide(D.adapt(g,o.type));break;case Yh.Min:if(t)h=D=>Math.min(o.getConnectedValue(D),g.getConnectedValue(D));else{const[D,R]=j?[g,o]:[o,g];switch(D.type){case uh.Vector2:h=h=>H.Vector2.Minimize(D.getConnectedValue(h),h.adapt(R,D.type));break;case uh.Gh:h=h=>H.Gh.Minimize(D.getConnectedValue(h),h.adapt(R,D.type));break;case uh.yg:h=h=>{const o=D.getConnectedValue(h),{r:H,g:g,b:j,a:t}=h.adapt(R,D.type);return new M.yg(Math.min(o.r,H),Math.min(o.g,g),Math.min(o.b,j),Math.min(o.a,t))}}}break;case Yh.Max:if(!t){const[D,R]=j?[g,o]:[o,g];switch(D.type){case uh.Vector2:h=h=>H.Vector2.Maximize(D.getConnectedValue(h),h.adapt(R,D.type));break;case uh.Gh:h=h=>H.Gh.Maximize(D.getConnectedValue(h),h.adapt(R,D.type));break;case uh.yg:h=h=>{const o=D.getConnectedValue(h),{r:H,g:g,b:j,a:t}=h.adapt(R,D.type);return new M.yg(Math.max(o.r,H),Math.min(o.g,g),Math.min(o.b,j),Math.min(o.a,t))}}break}h=D=>Math.max(o.getConnectedValue(D),g.getConnectedValue(D))}this.output._storedFunction=D=>o.type===uh.Int?0|h(D):h(D)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===uh.Int||this.left.type===uh.Float&&this.right.type!==uh.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[D,h]of[[this.left,this.right],[this.right,this.left]])D.acceptedConnectionPointTypes=[uh.Int,uh.Float],h.isConnected&&(D.acceptedConnectionPointTypes.push(h.type),h.type!==uh.Int&&h.type!==uh.Float||D.acceptedConnectionPointTypes.push(uh.Vector2,uh.Gh,uh.yg))}dispose(){super.dispose();for(const D of this._connectionObservers)D.remove();this._connectionObservers.length=0}serialize(){const D=super.serialize();return D.operation=this.operation,D}_deserialize(D){super._deserialize(D),this.operation=D.operation}}(0,Z.c)([Vh("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Yh.Add},{label:"Subtract",value:Yh.Subtract},{label:"Multiply",value:Yh.Multiply},{label:"Divide",value:Yh.Divide},{label:"Max",value:Yh.Max},{label:"Min",value:Yh.Min}]})],ho.prototype,"operation",void 0),(0,R.g)("BABYLON.ParticleMathBlock",ho);class oo extends fh{constructor(D){super(D),this.registerInput("particle",uh.Particle),this.registerInput("direction1",uh.Gh,!0,new H.Gh(0,1,0)),this.registerInput("direction2",uh.Gh,!0,new H.Gh(0,1,0)),this.registerInput("minEmitBox",uh.Gh,!0,new H.Gh(-.5,-.5,-.5)),this.registerInput("maxEmitBox",uh.Gh,!0,new H.Gh(.5,.5,.5)),this.registerOutput("output",uh.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(D){const h=this.particle.getConnectedValue(D);h._directionCreation.process=o=>{D.particleContext=o,D.systemContext=h;const g=this.direction1.getConnectedValue(D),j=this.direction2.getConnectedValue(D),M=(0,S.RandomRange)(g.x,j.x),R=(0,S.RandomRange)(g.y,j.y),t=(0,S.RandomRange)(g.z,j.z);D.isEmitterTransformNode?H.Gh.TransformNormalFromFloatsToRef(M,R,t,D.emitterWorldMatrix,o.direction):o.direction.Qg(M,R,t)},h._positionCreation.process=o=>{D.particleContext=o,D.systemContext=h;const g=this.minEmitBox.getConnectedValue(D),j=this.maxEmitBox.getConnectedValue(D),M=(0,S.RandomRange)(g.x,j.x),R=(0,S.RandomRange)(g.y,j.y),t=(0,S.RandomRange)(g.z,j.z);D.isEmitterTransformNode?H.Gh.TransformCoordinatesFromFloatsToRef(M,R,t,D.emitterWorldMatrix,o.position):(o.position.Qg(M,R,t),o.position.addInPlace(D.emitterPosition))},this.output._storedValue=h}}(0,R.g)("BABYLON.BoxShapeBlock",oo);class Ho extends fh{constructor(D){super(D),this.registerInput("emitPower",uh.Float,!0,1),this.registerInput("lifeTime",uh.Float,!0,1),this.registerInput("color",uh.yg,!0,new M.yg(1,1,1,1)),this.registerInput("scale",uh.Vector2,!0,new H.Vector2(1,1)),this.registerInput("angle",uh.Float,!0,0),this.registerOutput("particle",uh.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(D){const h=new Rh(this.name,D.Ko,D.Th,null,!1,void 0,!0);h.particleEmitterType=new U,h._lifeTimeCreation.process=(h,o)=>{D.particleContext=h,h.lifeTime=this.lifeTime.getConnectedValue(D),o._emitPower=this.emitPower.getConnectedValue(D)},h._colorCreation.process=h=>{D.particleContext=h,h.color.M(this.color.getConnectedValue(D))},h._sizeCreation.process=h=>{D.particleContext=h,h.size=1,h.scale.M(this.scale.getConnectedValue(D))},h._angleCreation.process=h=>{D.particleContext=h,h.angle=this.angle.getConnectedValue(D)},this.particle._storedValue=h}}(0,R.g)("BABYLON.CreateParticleBlock",Ho);class go{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const D=[];for(const h of this.attachedBlocks)h.isInput&&D.push(h);return D}constructor(D){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new X.c,this.name=D}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(D){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(D)&&this.attachedBlocks.push(D);for(const o of D.inputs){const H=o.connectedPoint;if(H){const o=H.ownerBlock;o!==D&&this._initializeBlock(o,h)}}}async buildAsync(D){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((o=>{const H=new Gh;for(const D of this._systemBlocks)this._initializeBlock(D);for(const g of this.systemBlocks){const o=new dh;o.buildId=this._buildId++,o.Th=D,o.verbose=h;const j=g.createSystem(o);o.emitErrors(),H.systems.push(j)}this.onBuildObservable.notifyObservers(this),o(H)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const D=new Ah("Particle system"),h=new Do("Update position");h.output.connectTo(D.particle);const o=new Wh("Position");o.contextualValue=Fh.Position;const H=new Wh("Scaled direction");H.contextualValue=Fh.ScaledDirection;const g=new ho("Add");g.operation=Yh.Add,o.output.connectTo(g.left),H.output.connectTo(g.right),g.output.connectTo(h.position);const j=new Ho("Create particle"),M=new oo("Box shape");j.particle.connectTo(M.particle),M.output.connectTo(h.particle);const R=new xh("Texture");R.texture.connectTo(D.texture),R.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(D)}removeBlock(D){const h=this.attachedBlocks.indexOf(D);if(h>-1&&this.attachedBlocks.splice(h,1),D.isSystem){const h=this._systemBlocks.indexOf(D);h>-1&&this._systemBlocks.splice(h,1)}}parseSerializedObject(D){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h||this.clear();const o={};for(const H of D.HK){const D=(0,R.d)(H.customType);if(D){const h=new D;h._deserialize(H),o[H.id]=h,this.attachedBlocks.push(h),h.isSystem&&this._systemBlocks.push(h)}}for(const H of this.attachedBlocks)if(H.isTeleportOut){const D=H,h=D._tempEntryPointUniqueId;if(h){const H=o[h];H&&H.attachToEndpoint(D)}}for(let H=0;H<D.HK.length;H++){const g=D.HK[H],j=o[g.id];j&&(j.inputs.length&&g.inputs.some((D=>D.targetConnectionName))&&!h||this._restoreConnections(j,D,o))}if(D.locations||D.editorData&&D.editorData.locations){const H=D.locations||D.editorData.locations;for(const D of H)o[D.NH]&&(D.NH=o[D.NH].uniqueId);h&&this.editorData&&this.editorData.locations&&H.concat(this.editorData.locations),D.locations?this.editorData={locations:H}:(this.editorData=D.editorData,this.editorData.locations=H);const g=[];for(const D in o)g[D]=o[D].uniqueId;this.editorData.map=g}this.comment=D.comment}_restoreConnections(D,h,o){for(const H of D.outputs)for(const g of h.HK){const j=o[g.id];if(j)for(const M of g.inputs)if(o[M.targetBlockId]!==D||M.targetConnectionName!==H.name);else{const D=j.getInputByName(M.inputName);if(!D||D.isConnected)continue;H.connectTo(D,!0),this._restoreConnections(j,h,o)}}}serialize(D){const h=D?{}:p.d.Serialize(this);h.editorData=JSON.parse(JSON.stringify(this.editorData));let o=[];D?o=D:h.customType="BABYLON.NodeParticleSystemSet",h.HK=[];for(const H of o)h.HK.push(H.serialize());if(!D)for(const H of this.attachedBlocks)-1===o.indexOf(H)&&h.HK.push(H.serialize());return h}dispose(){for(const D of this.attachedBlocks)D.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(D){const h=new go(D);return h.setToDefault(),h}static Parse(D){const h=p.d.Parse((()=>new go(D.name)),D,null);return h.parseSerializedObject(D),h}static ParseFromSnippetAsync(D,h){return"_BLANK"===D?Promise.resolve(go.CreateDefault("blank")):new Promise(((o,H)=>{const g=new Nh.e;g.addEventListener("readystatechange",(()=>{if(4==g.readyState)if(200==g.status){const M=JSON.parse(JSON.parse(g.responseText).jsonPayload),R=JSON.parse(M.nodeParticle);h||(h=p.d.Parse((()=>new go(D)),R,null)),h.parseSerializedObject(R),h.snippetId=D;try{o(h)}catch(j){H(j)}}else H("Unable to load the snippet "+D)})),g.open("GET",this.SnippetUrl+"/"+D.replace(/#/g,"/")),g.send()}))}}go.EditorURL=`${yh.Tools._DefaultCdnUrl}/v${VD.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,go.SnippetUrl="https://snippet.babylonjs.com",(0,Z.c)([(0,e.I)()],go.prototype,"name",void 0),(0,Z.c)([(0,e.I)("comment")],go.prototype,"comment",void 0),function(D){D[D.None=0]="None",D[D.PerParticle=1]="PerParticle",D[D.PerSystem=2]="PerSystem"}(lh||(lh={}));class jo extends fh{constructor(D){super(D),this._currentLockId=-2,this.lockMode=lh.PerParticle,this.registerInput("min",uh.AutoDetect,!0,0),this.registerInput("max",uh.AutoDetect,!0,1),this.registerOutput("output",uh.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(uh.Float|uh.Int|uh.Vector2|uh.Gh|uh.yg),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(uh.Float|uh.Int|uh.Vector2|uh.Gh|uh.yg),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=uh.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let D=null;switch(this._currentLockId=-2,this.min.type){case uh.AutoDetect:case uh.Int:case uh.Float:D=D=>{const h=this.min.getConnectedValue(D)||0,o=this.max.getConnectedValue(D)||1;return h+Math.random()*(o-h)};break;case uh.Vector2:D=D=>{const h=this.min.getConnectedValue(D)||H.Vector2.Zero(),o=this.max.getConnectedValue(D)||H.Vector2.One();return new H.Vector2(h.x+Math.random()*(o.x-h.x),h.y+Math.random()*(o.y-h.y))};break;case uh.Gh:D=D=>{const h=this.min.getConnectedValue(D)||H.Gh.Zero(),o=this.max.getConnectedValue(D)||H.Gh.One();return new H.Gh(h.x+Math.random()*(o.x-h.x),h.y+Math.random()*(o.y-h.y),h.z+Math.random()*(o.z-h.z))};break;case uh.yg:D=D=>{const h=this.min.getConnectedValue(D)||new M.yg(0,0,0,0),o=this.max.getConnectedValue(D)||new M.yg(1,1,1,1);return new M.yg(h.x+Math.random()*(o.x-h.x),h.y+Math.random()*(o.y-h.y),h.z+Math.random()*(o.z-h.z),h.w+Math.random()*(o.w-h.w))}}this.output._storedFunction=h=>{var o;let H=0;switch(this.lockMode){case lh.PerParticle:H=(null===(o=h.particleContext)||void 0===o?void 0:o.id)||-1;break;case lh.PerSystem:H=h.buildId||0}return this._currentLockId!==H&&(this.lockMode!==lh.None&&(this._currentLockId=H),this.output._storedValue=D(h)),this.output._storedValue}}serialize(){const D=super.serialize();return D.lockMode=this.lockMode,D}_deserialize(D){super._deserialize(D),this.lockMode=D.lockMode}}(0,Z.c)([Vh("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:lh.None},{label:"Per particle",value:lh.PerParticle},{label:"Per system",value:lh.PerSystem}]})],jo.prototype,"lockMode",void 0),(0,R.g)("BABYLON.ParticleRandomBlock",jo);class Mo extends fh{constructor(D){super(D),this._currentLockId=-2,this.lockMode=lh.PerParticle,this.registerInput("min",uh.AutoDetect),this.registerInput("max",uh.AutoDetect),this.registerOutput("output",uh.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const h=[uh.Matrix,uh.Particle,uh.Texture,uh.System,uh.FloatGradient,uh.Color4Gradient,uh.Vector2Gradient,uh.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...h),this.max.excludedConnectionPointTypes.push(...h)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let D=null;switch(this._currentLockId=-2,this.min.type){case uh.Float:case uh.Int:D=D=>{const h=this.min.getConnectedValue(D),o=this.max.getConnectedValue(D);return Math.random()*(o-h)+h};break;case uh.Vector2:D=D=>{const h=this.min.getConnectedValue(D),o=this.max.getConnectedValue(D);return new H.Vector2(Math.random()*(o.x-h.x)+h.x,Math.random()*(o.y-h.y)+h.y)};break;case uh.Gh:D=D=>{const h=this.min.getConnectedValue(D),o=this.max.getConnectedValue(D);return new H.Gh(Math.random()*(o.x-h.x)+h.x,Math.random()*(o.y-h.y)+h.y,Math.random()*(o.z-h.z)+h.z)};break;case uh.yg:D=D=>{const h=this.min.getConnectedValue(D),o=this.max.getConnectedValue(D);return new M.yg(Math.random()*(o.r-h.r)+h.r,Math.random()*(o.g-h.g)+h.g,Math.random()*(o.b-h.b)+h.b,Math.random()*(o.a-h.a)+h.a)}}this.output._storedFunction=h=>{var o;let H=0;switch(this.lockMode){case lh.PerParticle:H=(null===(o=h.particleContext)||void 0===o?void 0:o.id)||-1;break;case lh.PerSystem:H=h.buildId||0}return this._currentLockId!==H&&(this.lockMode!==lh.None&&(this._currentLockId=H),this.output._storedValue=D(h)),this.output._storedValue}}serialize(){const D=super.serialize();return D.lockMode=this.lockMode,D}_deserialize(D){super._deserialize(D),void 0!==D.lockMode&&(this.lockMode=D.lockMode)}}(0,Z.c)([Vh("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:lh.None},{label:"Per particle",value:lh.PerParticle},{label:"Per system",value:lh.PerSystem}]})],Mo.prototype,"lockMode",void 0),(0,R.g)("BABYLON.RandomRangeBlock",Mo);(0,R.g)("BABYLON.ParticleLerpBlock",class extends fh{constructor(D){super(D),this.registerInput("left",uh.AutoDetect),this.registerInput("right",uh.AutoDetect),this.registerInput("gradient",uh.Float,!0,0,0,1),this.registerOutput("output",uh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(uh.Float|uh.Int|uh.Vector2|uh.Gh|uh.yg)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const D=(D,h,o)=>(1-D)*h+D*o;this.output._storedFunction=h=>{const o=this.left.getConnectedValue(h),g=this.right.getConnectedValue(h),j=this.gradient.getConnectedValue(h);switch(this.left.type){case uh.Int:case uh.Float:return D(j,o,g);case uh.Vector2:return new H.Vector2(D(j,o.x,g.x),D(j,o.y,g.y));case uh.Gh:return new H.Gh(D(j,o.x,g.x),D(j,o.y,g.y),D(j,o.z,g.z));case uh.yg:return new M.yg(D(j,o.r,g.r),D(j,o.g,g.g),D(j,o.b,g.b),D(j,o.a,g.a))}return 0}}});(0,R.g)("BABYLON.UpdateDirectionBlock",class extends fh{constructor(D){super(D),this.registerInput("particle",uh.Particle),this.registerInput("direction",uh.Gh),this.registerOutput("output",uh.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(D){const h=this.particle.getConnectedValue(D);if(this.output._storedValue=h,!this.direction.isConnected)return;const o={process:o=>{D.particleContext=o,D.systemContext=h,o.direction.M(this.direction.getConnectedValue(D))},previousItem:null,nextItem:null};h._updateQueueStart?wD(o,h._updateQueueStart):h._updateQueueStart=o}});(0,R.g)("BABYLON.UpdateColorBlock",class extends fh{constructor(D){super(D),this.registerInput("particle",uh.Particle),this.registerInput("color",uh.yg),this.registerOutput("output",uh.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(D){const h=this.particle.getConnectedValue(D);if(this.output._storedValue=h,!this.color.isConnected)return;const o={process:o=>{D.particleContext=o,D.systemContext=h,o.color.M(this.color.getConnectedValue(D))},previousItem:null,nextItem:null};h._updateQueueStart?wD(o,h._updateQueueStart):h._updateQueueStart=o}});(0,R.g)("BABYLON.UpdateScaleBlock",class extends fh{constructor(D){super(D),this.registerInput("particle",uh.Particle),this.registerInput("scale",uh.Vector2),this.registerOutput("output",uh.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(D){const h=this.particle.getConnectedValue(D);if(this.output._storedValue=h,!this.scale.isConnected)return;const o={process:o=>{D.particleContext=o,D.systemContext=h,o.scale.M(this.scale.getConnectedValue(D))},previousItem:null,nextItem:null};h._updateQueueStart?wD(o,h._updateQueueStart):h._updateQueueStart=o}});(0,R.g)("BABYLON.UpdateAngleBlock",class extends fh{constructor(D){super(D),this.registerInput("particle",uh.Particle),this.registerInput("angle",uh.Float),this.registerOutput("output",uh.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(D){const h=this.particle.getConnectedValue(D);if(this.output._storedValue=h,!this.angle.isConnected)return;const o={process:o=>{D.particleContext=o,D.systemContext=h,o.angle=this.angle.getConnectedValue(D)},previousItem:null,nextItem:null};h._updateQueueStart?wD(o,h._updateQueueStart):h._updateQueueStart=o}});(0,R.g)("BABYLON.BasicPositionUpdateBlock",class extends fh{constructor(D){super(D),this.registerInput("particle",uh.Particle),this.registerOutput("output",uh.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(D){const h=this.particle.getConnectedValue(D),o={process:o=>{D.particleContext=o,D.systemContext=h,o.direction.scaleToRef(h._directionScale,h._scaledDirection),o.position.addInPlace(h._scaledDirection)},previousItem:null,nextItem:null};h._updateQueueStart?wD(o,h._updateQueueStart):h._updateQueueStart=o,this.output._storedValue=h}});(0,R.g)("BABYLON.BasicSpriteUpdateBlock",class extends fh{constructor(D){super(D),this.registerInput("particle",uh.Particle),this.registerOutput("output",uh.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(D){const h=this.particle.getConnectedValue(D),o={process:o=>{D.particleContext=o,D.systemContext=h,o.updateCellIndex()},previousItem:null,nextItem:null};h._updateQueueStart?wD(o,h._updateQueueStart):h._updateQueueStart=o,this.output._storedValue=h}});(0,R.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends fh{constructor(D){super(D),this.registerInput("particle",uh.Particle),this.registerInput("cellIndex",uh.Int),this.registerOutput("output",uh.Particle),this.cellIndex.acceptedConnectionPointTypes=[uh.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(D){const h=this.particle.getConnectedValue(D);if(this.output._storedValue=h,!this.cellIndex.isConnected)return;const o={process:o=>{D.particleContext=o,D.systemContext=h,o.cellIndex=Math.floor(this.cellIndex.getConnectedValue(D))},previousItem:null,nextItem:null};h._updateQueueStart?wD(o,h._updateQueueStart):h._updateQueueStart=o}});class Ro extends fh{constructor(D){super(D),this.strength=1,this.registerInput("particle",uh.Particle),this.registerInput("flowMap",uh.Texture),this.registerOutput("output",uh.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(D){var h;const o=this.particle.getConnectedValue(D),H=D.Th;let g;(null===(h=this.flowMap.connectedPoint)||void 0===h?void 0:h.ownerBlock).extractTextureContentAsync().then((D=>{D&&(g=new ah(D.width,D.height,D.data))}));const j={process:D=>{const h=H.getTransformMatrix();g&&g._processParticle(D,this.strength*o._tempScaledUpdateSpeed,h)},previousItem:null,nextItem:null};o._updateQueueStart?wD(j,o._updateQueueStart):o._updateQueueStart=j,this.output._storedValue=o}serialize(){const D=super.serialize();return D.strength=this.strength,D}_deserialize(D){super._deserialize(D),this.strength=D.strength}}(0,Z.c)([Vh("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ro.prototype,"strength",void 0),(0,R.g)("BABYLON.UpdateFlowMapBlock",Ro);(0,R.g)("BABYLON.SphereShapeBlock",class extends fh{constructor(D){super(D),this.registerInput("input",uh.Particle),this.registerInput("radius",uh.Float,!0,1),this.registerInput("radiusRange",uh.Float,!0,1,0,1),this.registerInput("directionRandomizer",uh.Float,!0,0,0,1),this.registerOutput("output",uh.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(D){const h=this.input.getConnectedValue(D);h._directionCreation.process=o=>{D.particleContext=o,D.systemContext=h;const g=this.directionRandomizer.getConnectedValue(D),j=o.position.Nh(D.emitterPosition).normalize(),M=(0,S.RandomRange)(0,g),R=(0,S.RandomRange)(0,g),t=(0,S.RandomRange)(0,g);j.x+=M,j.y+=R,j.z+=t,j.normalize(),D.isEmitterTransformNode?H.Gh.TransformNormalFromFloatsToRef(M,R,t,D.emitterWorldMatrix,o.direction):o.direction.Qg(M,R,t)},h._positionCreation.process=o=>{D.particleContext=o,D.systemContext=h;const g=this.radius.getConnectedValue(D),j=this.radiusRange.getConnectedValue(D),M=g-(0,S.RandomRange)(0,g*j),R=(0,S.RandomRange)(0,1),t=(0,S.RandomRange)(0,2*Math.PI),k=Math.acos(2*R-1),K=M*Math.cos(t)*Math.sin(k),Q=M*Math.cos(k),v=M*Math.sin(t)*Math.sin(k);D.isEmitterTransformNode?H.Gh.TransformCoordinatesFromFloatsToRef(K,Q,v,D.emitterWorldMatrix,o.position):(o.position.Qg(K,Q,v),o.position.addInPlace(D.emitterPosition))},this.output._storedValue=h}});(0,R.g)("BABYLON.PointShapeBlock",class extends fh{constructor(D){super(D),this.registerInput("particle",uh.Particle),this.registerInput("direction1",uh.Gh,!0,new H.Gh(0,1,0)),this.registerInput("direction2",uh.Gh,!0,new H.Gh(0,1,0)),this.registerOutput("output",uh.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(D){const h=this.particle.getConnectedValue(D);h._directionCreation.process=o=>{D.particleContext=o,D.systemContext=h;const g=this.direction1.getConnectedValue(D),j=this.direction2.getConnectedValue(D),M=(0,S.RandomRange)(g.x,j.x),R=(0,S.RandomRange)(g.y,j.y),t=(0,S.RandomRange)(g.z,j.z);D.isEmitterTransformNode?H.Gh.TransformNormalFromFloatsToRef(M,R,t,D.emitterWorldMatrix,o.direction):o.direction.Qg(M,R,t)},h._positionCreation.process=o=>{D.systemContext=h,D.isEmitterTransformNode?H.Gh.TransformCoordinatesFromFloatsToRef(0,0,0,D.emitterWorldMatrix,o.position):o.position.M(D.emitterPosition)},this.output._storedValue=h}});(0,R.g)("BABYLON.CustomShapeBlock",class extends fh{constructor(D){super(D),this.registerInput("particle",uh.Particle),this.registerInput("position",uh.Gh,!0,new H.Gh(0,0,0)),this.registerInput("direction",uh.Gh,!0,new H.Gh(0,1,0)),this.registerOutput("output",uh.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(D){const h=this.particle.getConnectedValue(D);h._directionCreation.process=o=>{D.particleContext=o,D.systemContext=h;const g=this.direction.getConnectedValue(D);D.isEmitterTransformNode?H.Gh.TransformNormalToRef(g,D.emitterWorldMatrix,o.direction):o.direction.M(g)},h._positionCreation.process=o=>{D.particleContext=o,D.systemContext=h;const g=this.position.getConnectedValue(D);D.isEmitterTransformNode?H.Gh.TransformCoordinatesToRef(g,D.emitterWorldMatrix,o.position):(o.position.M(g),o.position.addInPlace(D.emitterPosition))},this.output._storedValue=h}});(0,R.g)("BABYLON.CylinderShapeBlock",class extends fh{constructor(D){super(D),this._tempVector=H.Gh.Zero(),this.registerInput("particle",uh.Particle),this.registerInput("radius",uh.Float,!0,1),this.registerInput("height",uh.Float,!0,1,0),this.registerInput("radiusRange",uh.Float,!0,1,0,1),this.registerInput("directionRandomizer",uh.Float,!0,0,0,1),this.registerOutput("output",uh.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(D){const h=this.particle.getConnectedValue(D);h._directionCreation.process=o=>{D.particleContext=o,D.systemContext=h;const g=this.directionRandomizer.getConnectedValue(D);o.position.subtractToRef(D.emitterPosition,this._tempVector),this._tempVector.normalize(),D.isEmitterTransformNode&&H.Gh.TransformNormalToRef(this._tempVector,D.emitterInverseWorldMatrix,this._tempVector);const j=(0,S.RandomRange)(-g/2,g/2);let M=Math.atan2(this._tempVector.x,this._tempVector.z);M+=(0,S.RandomRange)(-Math.PI/2,Math.PI/2)*g,this._tempVector.y=j,this._tempVector.x=Math.sin(M),this._tempVector.z=Math.cos(M),this._tempVector.normalize(),D.isEmitterTransformNode?H.Gh.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,D.emitterWorldMatrix,o.direction):o.direction.M(this._tempVector)},h._positionCreation.process=o=>{D.particleContext=o,D.systemContext=h;const g=this.height.getConnectedValue(D),j=this.radiusRange.getConnectedValue(D),M=this.radius.getConnectedValue(D),R=(0,S.RandomRange)(-g/2,g/2),t=(0,S.RandomRange)(0,2*Math.PI),k=(0,S.RandomRange)((1-j)*(1-j),1),K=Math.sqrt(k)*M,Q=K*Math.cos(t),v=K*Math.sin(t);D.isEmitterTransformNode?H.Gh.TransformCoordinatesFromFloatsToRef(Q,R,v,D.emitterWorldMatrix,o.position):(o.position.Qg(Q,R,v),o.position.addInPlace(D.emitterPosition))},this.output._storedValue=h}});class to extends fh{constructor(D){super(D),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",uh.Particle),this.registerOutput("output",uh.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(D){super._build(D);const h=this.particle.getConnectedValue(D);h._isAnimationSheetEnabled=!0,h.spriteCellWidth=this.width,h.spriteCellHeight=this.height,h.startSpriteCellID=this.start,h.endSpriteCellID=this.end,h.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=h}serialize(){const D=super.serialize();return D.width=this.width,D.height=this.height,D.start=this.start,D.end=this.end,D.randomStartCell=this.randomStartCell,D}_deserialize(D){super._deserialize(D),this.width=D.width,this.height=D.height,this.start=D.start,this.end=D.end,this.randomStartCell=D.randomStartCell}}(0,Z.c)([Vh("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],to.prototype,"start",void 0),(0,Z.c)([Vh("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],to.prototype,"end",void 0),(0,Z.c)([Vh("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],to.prototype,"width",void 0),(0,Z.c)([Vh("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],to.prototype,"height",void 0),(0,Z.c)([Vh("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],to.prototype,"loop",void 0),(0,Z.c)([Vh("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],to.prototype,"randomStartCell",void 0),(0,R.g)("BABYLON.SetupSpriteSheetBlock",to);class So extends fh{constructor(D){super(D),this.reference=0,this.registerInput("value",uh.AutoDetect),this.registerOutput("output",uh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=D=>{switch(D){case uh.Float:return uh.FloatGradient;case uh.Vector2:return uh.Vector2Gradient;case uh.Gh:return uh.Vector3Gradient;case uh.yg:return uh.Color4Gradient}return D},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(uh.Float|uh.Vector2|uh.Gh|uh.yg)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=D=>null}serialize(){const D=super.serialize();return D.reference=this.reference,D}_deserialize(D){super._deserialize(D),this.reference=D.reference}}(0,Z.c)([Vh("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],So.prototype,"reference",void 0),(0,R.g)("BABYLON.ParticleGradientValueBlock",So);(0,R.g)("BABYLON.ParticleGradientBlock",class extends fh{constructor(D){super(D),this._entryCount=1,this.registerInput("gradient",uh.Float,!0,1,0,1),this.registerInput("value0",uh.AutoDetect),this.registerOutput("output",uh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=D=>{switch(D){case uh.FloatGradient:return uh.Float;case uh.Vector2Gradient:return uh.Vector2;case uh.Vector3Gradient:return uh.Gh;case uh.Color4Gradient:return uh.yg}return D},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(uh.FloatGradient|uh.Vector2Gradient|uh.Vector3Gradient|uh.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(D){this._inputs[D].onConnectionObservable.add((()=>{this._entryCount>D||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),uh.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const D=[];for(let o=1;o<this._inputs.length;o++){var h;if(this._inputs[o].isConnected)D.push(null===(h=this._inputs[o].connectedPoint)||void 0===h?void 0:h.ownerBlock)}D.sort(((D,h)=>D.reference-h.reference)),this.output._storedFunction=h=>{const o=this.gradient.getConnectedValue(h);if(1===D.length)return D[0].value.getConnectedValue(h);let g=null;for(let j=D.length-1;j>=0;j--){const R=D[j];if(R.reference<=o){const D=R.value.getConnectedValue(h);if(g){const j=g.value.getConnectedValue(h),t=g.reference,k=R.reference,K=Math.max(0,Math.min(1,(o-k)/(t-k)));switch(this.output.type){case uh.Float:return(0,S.Lerp)(D,j,K);case uh.Vector2:return H.Vector2.Lerp(D,j,K);case uh.Gh:return H.Gh.Lerp(D,j,K);case uh.yg:return M.yg.Lerp(D,j,K)}}return D}g=R}return 0}}});(0,R.g)("BABYLON.ParticleConverterBlock",class extends fh{constructor(D){super(D),this.registerInput("color ",uh.yg,!0),this.registerInput("xyz ",uh.Gh,!0),this.registerInput("xy ",uh.Vector2,!0),this.registerInput("zw ",uh.Vector2,!0),this.registerInput("x ",uh.Float,!0),this.registerInput("y ",uh.Float,!0),this.registerInput("z ",uh.Float,!0),this.registerInput("w ",uh.Float,!0),this.registerOutput("color",uh.yg),this.registerOutput("xyz",uh.Gh),this.registerOutput("xy",uh.Vector2),this.registerOutput("zw",uh.Vector2),this.registerOutput("x",uh.Float),this.registerOutput("y",uh.Float),this.registerOutput("z",uh.Float),this.registerOutput("w",uh.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(D){return"color "===D?"colorIn":"xyz "===D?"xyzIn":"xy "===D?"xyIn":"zw "===D?"zwIn":"x "===D?"xIn":"y "===D?"yIn":"z "===D?"zIn":"w "===D?"wIn":D}_outputRename(D){switch(D){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return D}}_build(D){super._build(D);const h=this.xIn,o=this.yIn,g=this.zIn,j=this.wIn,R=this.xyIn,t=this.zwIn,S=this.xyzIn,k=this.colorIn,K=this.colorOut,Q=this.xyzOut,v=this.xyOut,r=this.zwOut,B=this.xOut,s=this.yOut,U=this.zOut,q=this.wOut,c=D=>{if(k.isConnected)return k.getConnectedValue(D);let H=0,K=0,Q=0,v=0;if(h.isConnected&&(H=h.getConnectedValue(D)),o.isConnected&&(K=o.getConnectedValue(D)),g.isConnected&&(Q=g.getConnectedValue(D)),j.isConnected&&(v=j.getConnectedValue(D)),R.isConnected){const h=R.getConnectedValue(D);h&&(H=h.x,K=h.y)}if(t.isConnected){const h=t.getConnectedValue(D);h&&(Q=h.x,v=h.y)}if(S.isConnected){const h=S.getConnectedValue(D);h&&(H=h.x,K=h.y,Q=h.z)}return new M.yg(H,K,Q,v)};K._storedFunction=D=>c(D),Q._storedFunction=D=>{const h=c(D);return new H.Gh(h.r,h.g,h.b)},v._storedFunction=D=>{const h=c(D);return new H.Vector2(h.r,h.g)},r._storedFunction=D=>{const h=c(D);return new H.Vector2(h.b,h.a)},B._storedFunction=D=>c(D).r,s._storedFunction=D=>c(D).g,U._storedFunction=D=>c(D).b,q._storedFunction=D=>c(D).a}}),function(D){D[D.Cos=0]="Cos",D[D.Sin=1]="Sin",D[D.Abs=2]="Abs",D[D.Exp=3]="Exp",D[D.Exp2=4]="Exp2",D[D.Round=5]="Round",D[D.Floor=6]="Floor",D[D.Ceiling=7]="Ceiling",D[D.Sqrt=8]="Sqrt",D[D.Log=9]="Log",D[D.Tan=10]="Tan",D[D.ArcTan=11]="ArcTan",D[D.ArcCos=12]="ArcCos",D[D.ArcSin=13]="ArcSin",D[D.Sign=14]="Sign",D[D.Negate=15]="Negate",D[D.OneMinus=16]="OneMinus",D[D.Reciprocal=17]="Reciprocal",D[D.ToDegrees=18]="ToDegrees",D[D.ToRadians=19]="ToRadians",D[D.Fract=20]="Fract"}(Ch||(Ch={}));class ko extends fh{constructor(D){super(D),this.operation=Ch.Cos,this.registerInput("input",uh.AutoDetect),this.registerOutput("output",uh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(uh.Float|uh.Int|uh.Vector2|uh.Gh|uh.yg)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(D){super._build(D);let h=null;switch(this.operation){case Ch.Cos:h=D=>Math.cos(D);break;case Ch.Sin:h=D=>Math.sin(D);break;case Ch.Abs:h=D=>Math.abs(D);break;case Ch.Exp:h=D=>Math.exp(D);break;case Ch.Exp2:h=D=>Math.pow(2,D);break;case Ch.Round:h=D=>Math.round(D);break;case Ch.Floor:h=D=>Math.floor(D);break;case Ch.Ceiling:h=D=>Math.ceil(D);break;case Ch.Sqrt:h=D=>Math.sqrt(D);break;case Ch.Log:h=D=>Math.log(D);break;case Ch.Tan:h=D=>Math.tan(D);break;case Ch.ArcTan:h=D=>Math.atan(D);break;case Ch.ArcCos:h=D=>Math.acos(D);break;case Ch.ArcSin:h=D=>Math.asin(D);break;case Ch.Sign:h=D=>Math.sign(D);break;case Ch.Negate:h=D=>-D;break;case Ch.OneMinus:h=D=>1-D;break;case Ch.Reciprocal:h=D=>1/D;break;case Ch.ToRadians:h=D=>D*Math.PI/180;break;case Ch.ToDegrees:h=D=>180*D/Math.PI;break;case Ch.Fract:h=D=>D>=0?D-Math.floor(D):D-Math.ceil(D)}if(!h)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case uh.Int:case uh.Float:this.output._storedFunction=D=>{const o=this.input.getConnectedValue(D);return h(o)};break;case uh.Vector2:this.output._storedFunction=D=>{const o=this.input.getConnectedValue(D);return new H.Vector2(h(o.x),h(o.y))};break;case uh.Gh:this.output._storedFunction=D=>{const o=this.input.getConnectedValue(D);return new H.Gh(h(o.x),h(o.y),h(o.z))};break;case uh.yg:this.output._storedFunction=D=>{const o=this.input.getConnectedValue(D);return new M.yg(h(o.r),h(o.g),h(o.b),h(o.a))}}return this}serialize(){const D=super.serialize();return D.operation=this.operation,D}_deserialize(D){super._deserialize(D),this.operation=D.operation}}(0,Z.c)([Vh("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Ch.Cos},{label:"Sin",value:Ch.Sin},{label:"Abs",value:Ch.Abs},{label:"Exp",value:Ch.Exp},{label:"Exp2",value:Ch.Exp2},{label:"Round",value:Ch.Round},{label:"Floor",value:Ch.Floor},{label:"Ceiling",value:Ch.Ceiling},{label:"Sqrt",value:Ch.Sqrt},{label:"Log",value:Ch.Log},{label:"Tan",value:Ch.Tan},{label:"ArcTan",value:Ch.ArcTan},{label:"ArcCos",value:Ch.ArcCos},{label:"ArcSin",value:Ch.ArcSin},{label:"Sign",value:Ch.Sign},{label:"Negate",value:Ch.Negate},{label:"OneMinus",value:Ch.OneMinus},{label:"Reciprocal",value:Ch.Reciprocal},{label:"ToDegrees",value:Ch.ToDegrees},{label:"ToRadians",value:Ch.ToRadians},{label:"Fract",value:Ch.Fract}]})],ko.prototype,"operation",void 0),(0,R.g)("BABYLON.ParticleTrigonometryBlock",ko);var Ko,Qo=o(14065);class vo extends fh{constructor(D){super(D),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",uh.AutoDetect),this.registerOutput("output",uh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(uh.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(uh.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(uh.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(uh.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(uh.System),this._inputs[0].excludedConnectionPointTypes.push(uh.Particle),this._inputs[0].excludedConnectionPointTypes.push(uh.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(D){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const h=D=>{const h=this.input.getConnectedValue(D);if(this.log.length>=this.stackSize)return h;if(null===h||void 0===h)return this.log.push(["null",""]),h;switch(this.input.type){case uh.Vector2:this.log.push([(0,Qo.k)(h,4),h.toString()]);break;case uh.Gh:this.log.push([(0,Qo.l)(h,4),h.toString()]);break;case uh.yg:this.log.push([`{R: ${h.r.toFixed(4)} G: ${h.g.toFixed(4)} B: ${h.b.toFixed(4)} A: ${h.a.toFixed(4)}}`,h.toString()]);break;default:this.log.push([h.toString(),h.toString()])}return h};this.output.isConnected?this.output._storedFunction=h:this.output._storedValue=h(D)}serialize(){const D=super.serialize();return D.stackSize=this.stackSize,D}_deserialize(D){super._deserialize(D),this.stackSize=D.stackSize}}(0,Z.c)([Vh("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],vo.prototype,"stackSize",void 0),(0,R.g)("BABYLON.ParticleDebugBlock",vo);(0,R.g)("BABYLON.ParticleElbowBlock",class extends fh{constructor(D){super(D),this.registerInput("input",uh.AutoDetect),this.registerOutput("output",uh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(D){super._build(D);const h=this._outputs[0],o=this._inputs[0];h._storedFunction=D=>o.getConnectedValue(D)}});(0,R.g)("BABYLON.ParticleTeleportInBlock",class extends fh{get endpoints(){return this._endpoints}constructor(D){super(D),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",uh.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(D){if(this.getClassName()===D)return!0;for(const h of this.endpoints)if(h.isAnAncestorOfType(D))return!0;return!1}isAnAncestorOf(D){for(const h of this.endpoints){if(h===D)return!0;if(h.isAnAncestorOf(D))return!0}return!1}attachToEndpoint(D){D.detach(),this._endpoints.push(D),D._entryPoint=this,D._outputs[0]._typeConnectionSource=this._inputs[0],D._tempEntryPointUniqueId=null,D.name="> "+this.name}detachFromEndpoint(D){const h=this._endpoints.indexOf(D);-1!==h&&(this._endpoints.splice(h,1),D._outputs[0]._typeConnectionSource=null,D._entryPoint=null)}_build(){for(const D of this._endpoints)D.output._storedFunction=D=>this.input.getConnectedValue(D)}});(0,R.g)("BABYLON.ParticleTeleportOutBlock",class extends fh{constructor(D){super(D),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",uh.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(D){this.entryPoint&&this.entryPoint.build(D)}clone(){const D=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(D),D}serialize(){var D;const h=super.serialize();return h.entryPoint=(null===(D=this.entryPoint)||void 0===D?void 0:D.uniqueId)??"",h}_deserialize(D){super._deserialize(D),this._tempEntryPointUniqueId=D.entryPoint}}),function(D){D[D.Equal=0]="Equal",D[D.NotEqual=1]="NotEqual",D[D.LessThan=2]="LessThan",D[D.GreaterThan=3]="GreaterThan",D[D.LessOrEqual=4]="LessOrEqual",D[D.GreaterOrEqual=5]="GreaterOrEqual",D[D.Xor=6]="Xor",D[D.Or=7]="Or",D[D.And=8]="And"}(Ko||(Ko={}));class ro extends fh{constructor(D){super(D),this.test=Ko.Equal,this.epsilon=0,this.registerInput("left",uh.Float),this.registerInput("right",uh.Float,!0,0),this.registerInput("ifTrue",uh.AutoDetect,!0,1),this.registerInput("ifFalse",uh.AutoDetect,!0,0),this.registerOutput("output",uh.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=uh.Float,this._inputs[0].acceptedConnectionPointTypes.push(uh.Int),this._inputs[1].acceptedConnectionPointTypes.push(uh.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const D=D=>{const h=this.left.getConnectedValue(D),o=this.right.getConnectedValue(D);let H=!1;switch(this.test){case Ko.Equal:H=(0,S.WithinEpsilon)(h,o,this.epsilon);break;case Ko.NotEqual:H=!(0,S.WithinEpsilon)(h,o,this.epsilon);break;case Ko.LessThan:H=h<o+this.epsilon;break;case Ko.GreaterThan:H=h>o-this.epsilon;break;case Ko.LessOrEqual:H=h<=o+this.epsilon;break;case Ko.GreaterOrEqual:H=h>=o-this.epsilon;break;case Ko.Xor:H=!!h&&!o||!h&&!!o;break;case Ko.Or:H=!!h||!!o;break;case Ko.And:H=!!h&&!!o}return H};this.output._storedFunction=h=>D(h)?this.ifTrue.getConnectedValue(h):this.ifFalse.getConnectedValue(h)}serialize(){const D=super.serialize();return D.test=this.test,D.epsilon=this.epsilon,D}_deserialize(D){super._deserialize(D),this.test=D.test,void 0!==D.epsilon&&(this.epsilon=D.epsilon)}}(0,Z.c)([Vh("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Ko.Equal},{label:"NotEqual",value:Ko.NotEqual},{label:"LessThan",value:Ko.LessThan},{label:"GreaterThan",value:Ko.GreaterThan},{label:"LessOrEqual",value:Ko.LessOrEqual},{label:"GreaterOrEqual",value:Ko.GreaterOrEqual},{label:"Xor",value:Ko.Xor},{label:"Or",value:Ko.Or},{label:"And",value:Ko.And}]})],ro.prototype,"test",void 0),(0,Z.c)([Vh("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ro.prototype,"epsilon",void 0),(0,R.g)("BABYLON.ParticleConditionBlock",ro);class Bo extends fh{constructor(D){super(D),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",uh.Particle),this.registerInput("condition",uh.Float,!0,0),this.registerInput("system",uh.System),this.registerOutput("output",uh.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(D){this._triggerCount=0;const h=this.input.getConnectedValue(D),o={process:o=>{if(D.particleContext=o,D.systemContext=h,0!==this.condition.getConnectedValue(D)&&(0===this.limit||this._triggerCount<this.limit)){const H=(new Date).getTime();if(this._previousOne&&H-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=H;const g=this.system.getConnectedValue(D);if(g){const H=Xh(g,D.Th,o.position);H.Jh.addOnce((()=>{this._triggerCount--})),h.Jh.addOnce((()=>{H.dispose()}))}}},previousItem:null,nextItem:null};h._updateQueueStart?wD(o,h._updateQueueStart):h._updateQueueStart=o,this.output._storedValue=h}serialize(){const D=super.serialize();return D.limit=this.limit,D.delay=this.delay,D}_deserialize(D){super._deserialize(D),void 0!==D.limit&&(this.limit=D.limit),void 0!==D.delay&&(this.delay=D.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,Z.c)([Vh("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bo.prototype,"limit",void 0),(0,Z.c)([Vh("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Bo.prototype,"delay",void 0),(0,R.g)("BABYLON.ParticleTriggerBlock",Bo);o(14070),o(14082),o(14089),o(14154)},14137:(D,h,o)=>{"use strict";var H=o(12741);const g="clipPlaneFragment",j="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14096:(D,h,o)=>{"use strict";var H=o(12741);const g="clipPlaneFragmentDeclaration",j="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14166:(D,h,o)=>{"use strict";var H=o(12741);const g="clipPlaneVertex",j="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14159:(D,h,o)=>{"use strict";var H=o(12741);const g="clipPlaneVertexDeclaration",j="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14150:(D,h,o)=>{"use strict";var H=o(12741);const g="fogFragment",j="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14131:(D,h,o)=>{"use strict";var H=o(12741);const g="fogFragmentDeclaration",j="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14168:(D,h,o)=>{"use strict";var H=o(12741);const g="fogVertex",j="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14162:(D,h,o)=>{"use strict";var H=o(12741);const g="fogVertexDeclaration",j="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14119:(D,h,o)=>{"use strict";var H=o(12741);const g="helperFunctions",j="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14103:(D,h,o)=>{"use strict";var H=o(12741);const g="imageProcessingDeclaration",j="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14123:(D,h,o)=>{"use strict";var H=o(12741);const g="imageProcessingFunctions",j="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14111:(D,h,o)=>{"use strict";var H=o(12741);const g="logDepthDeclaration",j="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14143:(D,h,o)=>{"use strict";var H=o(12741);const g="logDepthFragment",j="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14170:(D,h,o)=>{"use strict";var H=o(12741);const g="logDepthVertex",j="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";H.d.IncludesShadersStoreWGSL[g]||(H.d.IncludesShadersStoreWGSL[g]=j)},14089:(D,h,o)=>{"use strict";o.r(h),o.d(h,{particlesPixelShaderWGSL:()=>M});var H=o(12741);o(14096),o(14103),o(14111),o(14119),o(14123),o(14131),o(14137),o(14143),o(14150);const g="particlesPixelShader",j="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";H.d.ShadersStoreWGSL[g]||(H.d.ShadersStoreWGSL[g]=j);const M={name:g,shader:j}},14154:(D,h,o)=>{"use strict";o.r(h),o.d(h,{particlesVertexShaderWGSL:()=>M});var H=o(12741);o(14159),o(14162),o(14111),o(14166),o(14168),o(14170);const g="particlesVertexShader",j="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";H.d.ShadersStoreWGSL[g]||(H.d.ShadersStoreWGSL[g]=j);const M={name:g,shader:j}},14e3:(D,h,o)=>{"use strict";var H=o(12741);const g="clipPlaneFragment",j="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},14077:(D,h,o)=>{"use strict";var H=o(12741);const g="clipPlaneFragmentDeclaration",j="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},14029:(D,h,o)=>{"use strict";var H=o(12741);const g="clipPlaneVertex",j="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},14086:(D,h,o)=>{"use strict";var H=o(12741);const g="clipPlaneVertexDeclaration",j="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},14016:(D,h,o)=>{"use strict";var H=o(12741);const g="fogFragment",j="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},13994:(D,h,o)=>{"use strict";var H=o(12741);const g="fogFragmentDeclaration",j="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},14035:(D,h,o)=>{"use strict";var H=o(12741);const g="fogVertex",j="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},14023:(D,h,o)=>{"use strict";var H=o(12741);const g="fogVertexDeclaration",j="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},13987:(D,h,o)=>{"use strict";var H=o(12741);const g="helperFunctions",j="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},13978:(D,h,o)=>{"use strict";var H=o(12741);const g="imageProcessingDeclaration",j="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},13989:(D,h,o)=>{"use strict";var H=o(12741);const g="imageProcessingFunctions",j="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},13985:(D,h,o)=>{"use strict";var H=o(12741);const g="logDepthDeclaration",j="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},14007:(D,h,o)=>{"use strict";var H=o(12741);const g="logDepthFragment",j="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},14040:(D,h,o)=>{"use strict";var H=o(12741);const g="logDepthVertex",j="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";H.d.IncludesShadersStore[g]||(H.d.IncludesShadersStore[g]=j)},14070:(D,h,o)=>{"use strict";o.r(h),o.d(h,{particlesPixelShader:()=>M});var H=o(12741);o(14077),o(13978),o(13985),o(13987),o(13989),o(13994),o(14e3),o(14007),o(14016);const g="particlesPixelShader",j="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";H.d.ShadersStore[g]||(H.d.ShadersStore[g]=j);const M={name:g,shader:j}},14082:(D,h,o)=>{"use strict";o.r(h),o.d(h,{particlesVertexShader:()=>M});var H=o(12741);o(14086),o(14023),o(13985),o(14029),o(14035),o(14040);const g="particlesVertexShader",j="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";H.d.ShadersStore[g]||(H.d.ShadersStore[g]=j);const M={name:g,shader:j}},14423:(D,h,o)=>{"use strict";o.r(h),o.d(h,{FlowGraphGLTFDataProvider:()=>j});var H=o(14386),g=o(14362);class j extends H.e{constructor(D){var h,o;super();const H=D.glTF,j=(null===(h=H.animations)||void 0===h?void 0:h.map((D=>D._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",g.c,j);const M=(null===(o=H.nodes)||void 0===o?void 0:o.map((D=>D._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",g.c,M)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14308:(D,h,o)=>{"use strict";o.d(h,{b:()=>s,d:()=>r,h:()=>v,l:()=>B});var H=o(12831),g=o(13325),j=o(12870),M=o(14315);const R=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class t{constructor(D,h){this._gltf=D,this._infoTree=h}convert(D){let h,o=this._gltf,H=this._infoTree;if(!D.startsWith("/"))throw new Error("Path must start with a /");const g=D.split("/");if(g.shift(),g[g.length-1].includes(".length")){const D=g[g.length-1].split(".");g.pop(),g.push(...D)}let j=!1;for(const t of g){const g="length"===t;if(g&&!H.__array__)throw new Error(`Path ${D} is invalid`);if(H.__ignoreObjectTree__&&(j=!0),H.__array__&&!g)H=H.__array__;else if(H=H[t],!H)throw new Error(`Path ${D} is invalid`);if(!j)if(void 0===o){if(!R.find((h=>h.regex.test(D))))throw new Error(`Path ${D} is invalid`)}else if(!g){var M;o=null===(M=o)||void 0===M?void 0:M[t]}(H.__target__||g)&&(h=o)}return{object:h,info:H}}}function S(D,h,o,H){const g=k(D,h);return H?g[o][H]:g[o]}function k(D,h,o){var H,j;return null===(H=D._data)||void 0===H||null===(j=H[(null===o||void 0===o?void 0:o.fillMode)??g.d.MATERIAL_TriangleFillMode])||void 0===j?void 0:j.babylonMaterial}function K(D,h){return{offset:{componentsCount:2,type:"Vector2",get:(o,g,j)=>{const M=S(o,j,D,h);return new H.Vector2(null===M||void 0===M?void 0:M.uOffset,null===M||void 0===M?void 0:M.vOffset)},getTarget:k,set:(o,H,g,j)=>{const M=S(H,j,D,h);M.uOffset=o.x,M.vOffset=o.y},getPropertyName:[()=>`${D}${h?"."+h:""}.uOffset`,()=>`${D}${h?"."+h:""}.vOffset`]},rotation:{type:"number",get:(o,H,g)=>{var j;return null===(j=S(o,g,D,h))||void 0===j?void 0:j.wAng},getTarget:k,set:(o,H,g,j)=>S(H,j,D,h).wAng=o,getPropertyName:[()=>`${D}${h?"."+h:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(o,g,j)=>{const M=S(o,j,D,h);return new H.Vector2(null===M||void 0===M?void 0:M.uScale,null===M||void 0===M?void 0:M.vScale)},getTarget:k,set:(o,H,g,j)=>{const M=S(H,j,D,h);M.uScale=o.x,M.vScale=o.y},getPropertyName:[()=>`${D}${h?"."+h:""}.uScale`,()=>`${D}${h?"."+h:""}.vScale`]}}}const Q={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:D=>{var h,o;return new H.Vector2((null===(h=D._babylonCamera)||void 0===h?void 0:h.orthoLeft)??0,(null===(o=D._babylonCamera)||void 0===o?void 0:o.orthoRight)??0)},set:(D,h)=>{h._babylonCamera&&(h._babylonCamera.orthoLeft=D.x,h._babylonCamera.orthoRight=D.y)},getTarget:D=>D,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:D=>{var h,o;return new H.Vector2((null===(h=D._babylonCamera)||void 0===h?void 0:h.orthoBottom)??0,(null===(o=D._babylonCamera)||void 0===o?void 0:o.orthoTop)??0)},set:(D,h)=>{h._babylonCamera&&(h._babylonCamera.orthoBottom=D.x,h._babylonCamera.orthoTop=D.y)},getTarget:D=>D,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:D=>{var h;return null===(h=D._babylonCamera)||void 0===h?void 0:h.maxZ},set:(D,h)=>{h._babylonCamera&&(h._babylonCamera.maxZ=D)},getTarget:D=>D,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:D=>{var h;return null===(h=D._babylonCamera)||void 0===h?void 0:h.Xh},set:(D,h)=>{h._babylonCamera&&(h._babylonCamera.Xh=D)},getTarget:D=>D,getPropertyName:[()=>"Xh"]}},perspective:{aspectRatio:{type:"number",get:D=>{var h;return null===(h=D._babylonCamera)||void 0===h?void 0:h.getEngine().getAspectRatio(D._babylonCamera)},getTarget:D=>D,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:D=>{var h;return null===(h=D._babylonCamera)||void 0===h?void 0:h.fov},set:(D,h)=>{h._babylonCamera&&(h._babylonCamera.fov=D)},getTarget:D=>D,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:D=>{var h;return null===(h=D._babylonCamera)||void 0===h?void 0:h.maxZ},set:(D,h)=>{h._babylonCamera&&(h._babylonCamera.maxZ=D)},getTarget:D=>D,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:D=>{var h;return null===(h=D._babylonCamera)||void 0===h?void 0:h.Xh},set:(D,h)=>{h._babylonCamera&&(h._babylonCamera.Xh=D)},getTarget:D=>D,getPropertyName:[()=>"Xh"]}}}},nodes:{length:{type:"number",get:D=>D.length,getTarget:D=>D.map((D=>D._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Gh",get:D=>{var h;return null===(h=D._babylonTransformNode)||void 0===h?void 0:h.position},set:(D,h)=>{var o;return null===(o=h._babylonTransformNode)||void 0===o?void 0:o.position.M(D)},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:D=>{var h;return null===(h=D._babylonTransformNode)||void 0===h?void 0:h.rotationQuaternion},set:(D,h)=>{var o,H;return null===(o=h._babylonTransformNode)||void 0===o||null===(H=o.rotationQuaternion)||void 0===H?void 0:H.M(D)},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Gh",get:D=>{var h;return null===(h=D._babylonTransformNode)||void 0===h?void 0:h.Ug},set:(D,h)=>{var o;return null===(o=h._babylonTransformNode)||void 0===o?void 0:o.Ug.M(D)},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"Ug"]},weights:{length:{type:"number",get:D=>D._numMorphTargets,getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(D,h)=>{var o,H;return void 0!==h?null===(o=D._primitiveBabylonMeshes)||void 0===o||null===(H=o[0].morphTargetManager)||void 0===H?void 0:H.getTarget(h).influence:void 0},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(D,h)=>[0],getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:D=>{var h,o,g;return H.Matrix.Compose(null===(h=D._babylonTransformNode)||void 0===h?void 0:h.Ug,null===(o=D._babylonTransformNode)||void 0===o?void 0:o.rotationQuaternion,null===(g=D._babylonTransformNode)||void 0===g?void 0:g.position)},getTarget:D=>D._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:D=>{var h,o,g,j;const M=H.Matrix.Identity();let R=D.parent;for(;R&&R.parent;)R=R.parent;const t=(null===(h=D._babylonTransformNode)||void 0===h?void 0:h.position._isDirty)||(null===(o=D._babylonTransformNode)||void 0===o||null===(g=o.rotationQuaternion)||void 0===g?void 0:g._isDirty)||(null===(j=D._babylonTransformNode)||void 0===j?void 0:j.Ug._isDirty);if(R){var S;const h=null===(S=R._babylonTransformNode)||void 0===S?void 0:S.xh(!0).invert();var k,K;if(h)null===(k=D._babylonTransformNode)||void 0===k||null===(K=k.xh(t))||void 0===K||K.multiplyToRef(h,M)}else D._babylonTransformNode&&M.M(D._babylonTransformNode.xh(t));return M},getTarget:D=>D._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:D=>{var h,o;return null===(h=D._babylonTransformNode)||void 0===h||null===(o=h.getChildren((D=>D instanceof M.e),!0)[0])||void 0===o?void 0:o.Jg},getTarget:D=>{var h;return null===(h=D._babylonTransformNode)||void 0===h?void 0:h.getChildren((D=>D instanceof M.e),!0)[0]},set:(D,h)=>{if(h._babylonTransformNode){const o=h._babylonTransformNode.getChildren((D=>D instanceof M.e),!0)[0];o&&(o.Jg=D)}}},color:{type:"mo",get:D=>{var h,o;return null===(h=D._babylonTransformNode)||void 0===h||null===(o=h.getChildren((D=>D instanceof M.e),!0)[0])||void 0===o?void 0:o.Og},getTarget:D=>{var h;return null===(h=D._babylonTransformNode)||void 0===h?void 0:h.getChildren((D=>D instanceof M.e),!0)[0]},set:(D,h)=>{if(h._babylonTransformNode){const o=h._babylonTransformNode.getChildren((D=>D instanceof M.e),!0)[0];o&&(o.Og=D)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"mo",get:(D,h,o)=>k(D,h,o).emissiveColor,set:(D,h,o,H)=>k(h,o,H).emissiveColor.M(D),getTarget:(D,h,o)=>k(D,h,o),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:K("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(D,h,o)=>{var H;return null===(H=S(D,o,"bumpTexture"))||void 0===H?void 0:H.level},set:(D,h,o,H)=>{const g=S(h,H,"bumpTexture");g&&(g.level=D)},getTarget:(D,h,o)=>k(D,h,o),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:K("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(D,h,o)=>k(D,h,o).ambientTextureStrength,set:(D,h,o,H)=>{const g=k(h,o,H);g&&(g.ambientTextureStrength=D)},getTarget:(D,h,o)=>k(D,h,o),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:K("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"yg",get:(D,h,o)=>{const H=k(D,h,o);return j.yg.FromColor3(H.albedoColor,H.alpha)},set:(D,h,o,H)=>{const g=k(h,o,H);g.albedoColor.set(D.r,D.g,D.b),g.alpha=D.a},getTarget:(D,h,o)=>k(D,h,o),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:K("albedoTexture")}},metallicFactor:{type:"number",get:(D,h,o)=>k(D,h,o).metallic,set:(D,h,o,H)=>{const g=k(h,o,H);g&&(g.metallic=D)},getTarget:(D,h,o)=>k(D,h,o),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(D,h,o)=>k(D,h,o).roughness,set:(D,h,o,H)=>{const g=k(h,o,H);g&&(g.roughness=D)},getTarget:(D,h,o)=>k(D,h,o),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:K("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(D,h,o)=>k(D,h,o).anisotropy.Jg,set:(D,h,o,H)=>{k(h,o,H).anisotropy.Jg=D},getTarget:(D,h,o)=>k(D,h,o),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(D,h,o)=>k(D,h,o).anisotropy.angle,set:(D,h,o,H)=>{k(h,o,H).anisotropy.angle=D},getTarget:(D,h,o)=>k(D,h,o),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:K("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(D,h,o)=>k(D,h,o).clearCoat.Jg,set:(D,h,o,H)=>{k(h,o,H).clearCoat.Jg=D},getTarget:(D,h,o)=>k(D,h,o),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(D,h,o)=>k(D,h,o).clearCoat.roughness,set:(D,h,o,H)=>{k(h,o,H).clearCoat.roughness=D},getTarget:(D,h,o)=>k(D,h,o),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:K("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(D,h,o)=>{var H;return null===(H=k(D,h,o).clearCoat.bumpTexture)||void 0===H?void 0:H.level},getTarget:k,set:(D,h,o,H)=>k(h,o,H).clearCoat.bumpTexture.level=D},extensions:{KHR_texture_transform:K("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:K("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(D,h,o)=>k(D,h,o).subSurface.dispersion,getTarget:k,set:(D,h,o,H)=>k(h,o,H).subSurface.dispersion=D}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(D,h,o)=>k(D,h,o).emissiveIntensity,getTarget:k,set:(D,h,o,H)=>k(h,o,H).emissiveIntensity=D}},KHR_materials_ior:{ior:{type:"number",get:(D,h,o)=>k(D,h,o).indexOfRefraction,getTarget:k,set:(D,h,o,H)=>k(h,o,H).indexOfRefraction=D}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(D,h,o)=>k(D,h,o).iridescence.Jg,getTarget:k,set:(D,h,o,H)=>k(h,o,H).iridescence.Jg=D},iridescenceIor:{type:"number",get:(D,h,o)=>k(D,h,o).iridescence.indexOfRefraction,getTarget:k,set:(D,h,o,H)=>k(h,o,H).iridescence.indexOfRefraction=D},iridescenceTexture:{extensions:{KHR_texture_transform:K("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(D,h,o)=>k(D,h,o).iridescence.maximumThickness,getTarget:k,set:(D,h,o,H)=>k(h,o,H).iridescence.maximumThickness=D},iridescenceThicknessMinimum:{type:"number",get:(D,h,o)=>k(D,h,o).iridescence.minimumThickness,getTarget:k,set:(D,h,o,H)=>k(h,o,H).iridescence.minimumThickness=D},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:K("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"mo",get:(D,h,o)=>k(D,h,o).sheen.color,getTarget:k,set:(D,h,o,H)=>k(h,o,H).sheen.color.M(D)},sheenColorTexture:{extensions:{KHR_texture_transform:K("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(D,h,o)=>k(D,h,o).sheen.Jg,getTarget:k,set:(D,h,o,H)=>k(h,o,H).sheen.Jg=D},sheenRoughnessTexture:{extensions:{KHR_texture_transform:K("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(D,h,o)=>k(D,h,o).metallicF0Factor,getTarget:k,set:(D,h,o,H)=>k(h,o,H).metallicF0Factor=D,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"mo",get:(D,h,o)=>k(D,h,o).metallicReflectanceColor,getTarget:k,set:(D,h,o,H)=>k(h,o,H).metallicReflectanceColor.M(D),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:K("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:K("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(D,h,o)=>k(D,h,o).subSurface.refractionIntensity,getTarget:k,set:(D,h,o,H)=>k(h,o,H).subSurface.refractionIntensity=D,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:K("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(D,h,o)=>k(D,h,o).subSurface.translucencyIntensity,getTarget:k,set:(D,h,o,H)=>k(h,o,H).subSurface.translucencyIntensity=D},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:K("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"mo",get:(D,h,o)=>k(D,h,o).subSurface.translucencyColor,getTarget:k,set:(D,h,o,H)=>{var g;return D&&(null===(g=k(h,o,H).subSurface.translucencyColor)||void 0===g?void 0:g.M(D))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:K("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"mo",get:(D,h,o)=>k(D,h,o).subSurface.tintColor,getTarget:k,set:(D,h,o,H)=>k(h,o,H).subSurface.tintColor.M(D)},attenuationDistance:{type:"number",get:(D,h,o)=>k(D,h,o).subSurface.tintColorAtDistance,getTarget:k,set:(D,h,o,H)=>k(h,o,H).subSurface.tintColorAtDistance=D},thicknessFactor:{type:"number",get:(D,h,o)=>k(D,h,o).subSurface.maximumThickness,getTarget:k,set:(D,h,o,H)=>k(h,o,H).subSurface.maximumThickness=D},thicknessTexture:{extensions:{KHR_texture_transform:K("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:D=>D.length,getTarget:D=>D.map((D=>D._babylonLight)),getPropertyName:[D=>"length"]},__array__:{__target__:!0,color:{type:"mo",get:D=>{var h;return null===(h=D._babylonLight)||void 0===h?void 0:h.Og},set:(D,h)=>{var o;return null===(o=h._babylonLight)||void 0===o?void 0:o.Og.M(D)},getTarget:D=>D._babylonLight,getPropertyName:[D=>"diffuse"]},Jg:{type:"number",get:D=>{var h;return null===(h=D._babylonLight)||void 0===h?void 0:h.Jg},set:(D,h)=>h._babylonLight?h._babylonLight.Jg=D:void 0,getTarget:D=>D._babylonLight,getPropertyName:[D=>"intensity"]},range:{type:"number",get:D=>{var h;return null===(h=D._babylonLight)||void 0===h?void 0:h.range},set:(D,h)=>h._babylonLight?h._babylonLight.range=D:void 0,getTarget:D=>D._babylonLight,getPropertyName:[D=>"range"]},spot:{innerConeAngle:{type:"number",get:D=>{var h;return null===(h=D._babylonLight)||void 0===h?void 0:h.innerAngle},set:(D,h)=>h._babylonLight?h._babylonLight.innerAngle=D:void 0,getTarget:D=>D._babylonLight,getPropertyName:[D=>"innerConeAngle"]},outerConeAngle:{type:"number",get:D=>{var h;return null===(h=D._babylonLight)||void 0===h?void 0:h.angle},set:(D,h)=>h._babylonLight?h._babylonLight.angle=D:void 0,getTarget:D=>D._babylonLight,getPropertyName:[D=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:D=>D.length,getTarget:D=>D.map((D=>D._babylonLight)),getPropertyName:[D=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:D=>D.length,getTarget:D=>D.map((D=>D._babylonTexture)),getPropertyName:[D=>"length"]},__array__:{__target__:!0,Jg:{type:"number",get:D=>{var h;return null===(h=D._babylonTexture)||void 0===h?void 0:h.level},set:(D,h)=>{h._babylonTexture&&(h._babylonTexture.level=D)},getTarget:D=>D._babylonTexture},rotation:{type:"Quaternion",get:D=>{var h;return D._babylonTexture&&H.Quaternion.FromRotationMatrix(null===(h=D._babylonTexture)||void 0===h?void 0:h.getReflectionTextureMatrix())},set:(D,h)=>{var o;h._babylonTexture&&(null!==(o=h._babylonTexture.GD())&&void 0!==o&&o.useRightHandedSystem||(D=H.Quaternion.Inverse(D)),H.Matrix.FromQuaternionToRef(D,h._babylonTexture.getReflectionTextureMatrix()))},getTarget:D=>D._babylonTexture}}}}},animations:{length:{type:"number",get:D=>D.length,getTarget:D=>D.map((D=>D._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:D=>D.length,getTarget:D=>D.map((D=>{var h;return null===(h=D.primitives[0]._instanceData)||void 0===h?void 0:h.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function v(D){return new t(D,Q)}function r(D){const h=D.split("/").map((D=>D.replace(/{}/g,"__array__")));let o=Q;for(const H of h)H&&(o=o[H]);if(o&&o.type&&o.get)return o}function B(D,h){const o=D.split("/").map((D=>D.replace(/{}/g,"__array__")));let H=Q;for(const g of o)g&&(H=H[g]);H&&H.type&&H.get&&(H.interpolation=h)}function s(D,h){const o=D.split("/").map((D=>D.replace(/{}/g,"__array__")));let H=Q;for(const g of o)if(g){if(!H[g]){if("?"===g){H.__ignoreObjectTree__=!0;continue}H[g]={},"__array__"===g&&(H[g].__target__=!0)}H=H[g]}Object.assign(H,h)}},14317:(D,h,o)=>{"use strict";o.r(h),o.d(h,{AnimationPropertyInfo:()=>S,TransformNodeAnimationPropertyInfo:()=>k,WeightAnimationPropertyInfo:()=>K,getQuaternion:()=>R,getVector3:()=>M,getWeights:()=>t});var H=o(13377),g=o(12831),j=o(14308);function M(D,h,o,H){return g.Gh.Ih(h,o).scaleInPlace(H)}function R(D,h,o,H){return g.Quaternion.Ih(h,o).scaleInPlace(H)}function t(D,h,o,H){const g=new Array(D._numMorphTargets);for(let j=0;j<g.length;j++)g[j]=h[o++]*H;return g}class S{constructor(D,h,o,H){this.type=D,this.name=h,this.getValue=o,this.getStride=H}_buildAnimation(D,h,o){const g=new H.e(D,this.name,h,this.type);return g.setKeys(o),g}}class k extends S{buildAnimations(D,h,o,H){const g=[];return g.push({babylonAnimatable:D._babylonTransformNode,babylonAnimation:this._buildAnimation(h,o,H)}),g}}class K extends S{buildAnimations(D,h,o,g){const j=[];if(D._numMorphTargets)for(let M=0;M<D._numMorphTargets;M++){const R=new H.e(`${h}_${M}`,this.name,o,this.type);if(R.setKeys(g.map((D=>({frame:D.frame,inTangent:D.inTangent?D.inTangent[M]:void 0,value:D.value[M],outTangent:D.outTangent?D.outTangent[M]:void 0,interpolation:D.interpolation})))),D._primitiveBabylonMeshes)for(const h of D._primitiveBabylonMeshes)if(h.morphTargetManager){const D=h.morphTargetManager.getTarget(M),o=R.clone();D.animations.push(o),j.push({babylonAnimatable:D,babylonAnimation:o})}}return j}}(0,j.l)("/nodes/{}/translation",[new k(H.e.ANIMATIONTYPE_VECTOR3,"position",M,(()=>3))]),(0,j.l)("/nodes/{}/rotation",[new k(H.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",R,(()=>4))]),(0,j.l)("/nodes/{}/scale",[new k(H.e.ANIMATIONTYPE_VECTOR3,"Ug",M,(()=>3))]),(0,j.l)("/nodes/{}/weights",[new K(H.e.ANIMATIONTYPE_FLOAT,"influence",t,(D=>D._numMorphTargets))])},14282:(D,h,o)=>{"use strict";class H{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((D,h)=>{this._resolve=D,this._reject=h}))}}var g=o(12831),j=o(12870),M=o(12642),R=o(13296),t=o(14284),S=o(14292),k=o(12648),K=o(13316),Q=o(13377),v=o(13381),r=o(12683),B=o(12658),s=o(12664);class U{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(D){this._useTextureToStoreBoneMatrices=D,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(D){this._animationPropertiesOverride=D}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(D,h,o){this.name=D,this.id=h,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=g.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new k.c,this.bones=[],this._scene=o||r.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const H=this._scene.getEngine().getCaps();this._canUseTextureForBones=H.textureFloat&&H.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((D=>!D.getParent()))}getTransformMatrices(D){if(this.needInitialSkinMatrix){if(!D)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return D._bonesTransformMatrices||this.prepare(!0),D._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(D){return this.needInitialSkinMatrix&&D._transformMatrixTexture?D._transformMatrixTexture:this._transformMatrixTexture}GD(){return this._scene}toString(D){let h=`Name: ${this.name}, nBones: ${this.bones.length}`;if(h+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,D){h+=", Ranges: {";let D=!0;for(const o in this._ranges)D&&(h+=", ",D=!1),h+=o;h+="}"}return h}getBoneIndexByName(D){for(let h=0,o=this.bones.length;h<o;h++)if(this.bones[h].name===D)return h;return-1}createAnimationRange(D,h,o){if(!this._ranges[D]){this._ranges[D]=new v.e(D,h,o);for(let H=0,g=this.bones.length;H<g;H++)this.bones[H].animations[0]&&this.bones[H].animations[0].createRange(D,h,o)}}deleteAnimationRange(D){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let o=0,H=this.bones.length;o<H;o++)this.bones[o].animations[0]&&this.bones[o].animations[0].deleteRange(D,h);this._ranges[D]=null}getAnimationRange(D){return this._ranges[D]||null}getAnimationRanges(){const D=[];let h;for(h in this._ranges)D.push(this._ranges[h]);return D}copyAnimationRange(D,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[h]||!D.getAnimationRange(h))return!1;let H=!0;const g=this._getHighestAnimationFrame()+1,j={},M=D.bones;let R,t;for(t=0,R=M.length;t<R;t++)j[M[t].name]=M[t];this.bones.length!==M.length&&(B.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${M.length}`),H=!1);const S=o&&this.dimensionsAtRest&&D.dimensionsAtRest?this.dimensionsAtRest.divide(D.dimensionsAtRest):null;for(t=0,R=this.bones.length;t<R;t++){const D=this.bones[t].name,M=j[D];M?H=H&&this.bones[t].copyAnimationRange(M,h,g,o,S):(B.d.Warn("copyAnimationRange: not same rig, missing source bone "+D),H=!1)}const k=D.getAnimationRange(h);return k&&(this._ranges[h]=new v.e(h,k.from+g,k.to+g)),H}returnToRest(){for(const D of this.bones)-1!==D._index&&D.returnToRest()}_getHighestAnimationFrame(){let D=0;for(let h=0,o=this.bones.length;h<o;h++)if(this.bones[h].animations[0]){const o=this.bones[h].animations[0].getHighestFrame();D<o&&(D=o)}return D}beginAnimation(D,h,o,H){const g=this.getAnimationRange(D);return g?this._scene.beginAnimation(this,g.from,g.to,h,o,H):null}static MakeAnimationAdditive(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;const H=D.getAnimationRange(o);if(!H)return null;const g=D._scene.getAllAnimatablesByTarget(D);let j=null;for(let R=0;R<g.length;R++){const D=g[R];if(D.fromFrame===(null===H||void 0===H?void 0:H.from)&&D.toFrame===(null===H||void 0===H?void 0:H.to)){j=D;break}}const M=D.getAnimatables();for(let R=0;R<M.length;R++){const D=M[R].animations;if(D)for(let H=0;H<D.length;H++)Q.e.MakeAnimationAdditive(D[H],h,o)}return j&&(j.isAdditive=!0),D}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(D){this._meshesWithPoseMatrix.push(D)}_unregisterMeshWithPoseMatrix(D){const h=this._meshesWithPoseMatrix.indexOf(D);h>-1&&this._meshesWithPoseMatrix.splice(h,1)}_computeTransformMatrices(D,h){this.onBeforeComputeObservable.notifyObservers(this);for(let o=0;o<this.bones.length;o++){const H=this.bones[o];H._childUpdateId++;const g=H.getParent();if(g?H.getLocalMatrix().multiplyToRef(g.getFinalMatrix(),H.getFinalMatrix()):h?H.getLocalMatrix().multiplyToRef(h,H.getFinalMatrix()):H.getFinalMatrix().M(H.getLocalMatrix()),-1!==H._index){const h=null===H._index?o:H._index;H.getAbsoluteInverseBindMatrix().multiplyToArray(H.getFinalMatrix(),D,16*h)}}this._identity.copyToArray(D,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const D=this.GD().getRenderId();if(this._currentRenderId===D)return;this._currentRenderId=D}if(this._numBonesWithLinkedTransformNode>0)for(const D of this.bones)if(D._linkedTransformNode){const h=D._linkedTransformNode;D.position=h.position,h.rotationQuaternion?D.rotationQuaternion=h.rotationQuaternion:D.rotation=h.rotation,D.Ug=h.Ug}if(this.needInitialSkinMatrix)for(const D of this._meshesWithPoseMatrix){const h=D.getPoseMatrix();let o=this._isDirty;if(D._bonesTransformMatrices&&D._bonesTransformMatrices.length===16*(this.bones.length+1)||(D._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),o=!0),o){if(this._synchronizedWithMesh!==D){this._synchronizedWithMesh=D;for(const D of this.bones)if(!D.getParent()){D.getBindMatrix().multiplyToRef(h,g.TmpVectors.Matrix[1]),D._updateAbsoluteBindMatrices(g.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const h=4*(this.bones.length+1);D._transformMatrixTexture&&D._transformMatrixTexture.getSize().width===h||(D._transformMatrixTexture&&D._transformMatrixTexture.dispose(),D._transformMatrixTexture=K.c.CreateRGBATexture(D._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(D._bonesTransformMatrices,h),this.isUsingTextureForMatrices&&D._transformMatrixTexture&&D._transformMatrixTexture.update(D._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=K.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let D=0;D<this.bones.length;D++)this._animatables.push(this.bones[D])}return this._animatables}clone(D,h){const o=new U(D,h||D,this._scene);o.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let H=0;H<this.bones.length;H++){const D=this.bones[H];let h=null;const g=D.getParent();if(g){const D=this.bones.indexOf(g);h=o.bones[D]}const j=new S.d(D.name,o,h,D.getBindMatrix().clone(),D.getRestMatrix().clone());j._index=D._index,D._linkedTransformNode&&j.linkTransformNode(D._linkedTransformNode),s.d.DeepCopy(D.animations,j.animations)}if(this._ranges){o._ranges={};for(const D in this._ranges){const h=this._ranges[D];h&&(o._ranges[D]=h.clone())}}return this._isDirty=!0,o.prepare(!0),o}enableBlending(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const h of this.bones)for(const o of h.animations)o.enableBlending=!0,o.blendingSpeed=D}dispose(){if(this._meshesWithPoseMatrix.length=0,this.GD().stopAnimation(this),this.GD().removeSkeleton(this),this._parentContainer){const D=this._parentContainer.skeletons.indexOf(this);D>-1&&this._parentContainer.skeletons.splice(D,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const D={};D.name=this.name,D.id=this.id,this.dimensionsAtRest&&(D.dimensionsAtRest=this.dimensionsAtRest.Fh()),D.bones=[],D.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let o=0;o<this.bones.length;o++){var h;const H=this.bones[o],g=H.getParent(),j={parentBoneIndex:g?this.bones.indexOf(g):-1,index:H.getIndex(),name:H.name,id:H.id,matrix:H.getBindMatrix().Fh(),rest:H.getRestMatrix().Fh(),linkedTransformNodeId:null===(h=H.getTransformNode())||void 0===h?void 0:h.id};D.bones.push(j),H.length&&(j.length=H.length),H.metadata&&(j.metadata=H.metadata),H.animations&&H.animations.length>0&&(j.animation=H.animations[0].serialize()),D.ranges=[];for(const h in this._ranges){const o=this._ranges[h];if(!o)continue;const H={};H.name=h,H.from=o.from,H.to=o.to,D.ranges.push(H)}}return D}static Parse(D,h){const o=new U(D.name,D.id,h);let H;for(D.dimensionsAtRest&&(o.dimensionsAtRest=g.Gh.Ih(D.dimensionsAtRest)),o.needInitialSkinMatrix=D.needInitialSkinMatrix,H=0;H<D.bones.length;H++){const h=D.bones[H],j=D.bones[H].index;let M=null;h.parentBoneIndex>-1&&(M=o.bones[h.parentBoneIndex]);const R=h.rest?g.Matrix.Ih(h.rest):null,t=new S.d(h.name,o,M,g.Matrix.Ih(h.matrix),R,null,j);void 0!==h.id&&null!==h.id&&(t.id=h.id),h.length&&(t.length=h.length),h.metadata&&(t.metadata=h.metadata),h.animation&&t.animations.push(Q.e.Parse(h.animation)),void 0!==h.linkedTransformNodeId&&null!==h.linkedTransformNodeId&&(o._hasWaitingData=!0,t._waitingTransformNodeId=h.linkedTransformNodeId)}if(D.ranges)for(H=0;H<D.ranges.length;H++){const h=D.ranges[H];o.createAnimationRange(h.name,h.from,h.to)}return o}computeAbsoluteMatrices(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||D)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(D)}getPoseMatrix(){let D=null;return this._meshesWithPoseMatrix.length>0&&(D=this._meshesWithPoseMatrix[0].getPoseMatrix()),D}sortBones(){const D=[],h=new Array(this.bones.length);for(let o=0;o<this.bones.length;o++)this._sortBones(o,D,h);this.bones=D}_sortBones(D,h,o){if(o[D])return;o[D]=!0;const H=this.bones[D];if(!H)return;void 0===H._index&&(H._index=D);const g=H.getParent();g&&this._sortBones(this.bones.indexOf(g),h,o),h.push(H)}setCurrentPoseAsRest(){for(const D of this.bones)D.setCurrentPoseAsRest()}}var q=o(13151),c=o(13337),y=o(12807),b=o(13255),i=o(12894),G=o(13299),N=o(13266),J=o(13288),O=o(13389),E=o(12915),L=o(14248);class T{set areUpdatesFrozen(D){D?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new E.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,D||(D=r.d.LastCreatedScene),this._scene=D,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const D=this._scene.getEngine().getCaps();this._canUseTextureForTargets=D.canUseGLVertexID&&D.textureFloat&&D.maxVertexTextureImageUnits>0&&D.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return T.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?T.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(D){this._numMaxInfluencers!==D&&(this._numMaxInfluencers=D,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(D){this._useTextureToStoreTargets!==D&&(this._useTextureToStoreTargets=D,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var D;return T.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(D=this._scene)&&void 0!==D&&D.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(D){return this._activeTargets.data[D]}getTarget(D){return this._targets[D]}getTargetByName(D){for(const h of this._targets)if(h.name===D)return h;return null}addTarget(D){this._targets.push(D),this._targetInfluenceChangedObservers.push(D.onInfluenceChanged.add((D=>{this.areUpdatesFrozen&&D&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(D)}))),this._targetDataLayoutChangedObservers.push(D._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(D){const h=this._targets.indexOf(D);h>=0&&(this._targets.splice(h,1),D.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(h,1)[0]),D._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(h,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(D)}_bind(D){D.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),D.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),D.setTexture("morphTargets",this._targetStoreTexture),D.setInt("morphTargetCount",this.numInfluencers)}clone(){const D=new T(this._scene);for(const h of this._targets)D.addTarget(h.clone());return D.enablePositionMorphing=this.enablePositionMorphing,D.enableNormalMorphing=this.enableNormalMorphing,D.enableTangentMorphing=this.enableTangentMorphing,D.enableUVMorphing=this.enableUVMorphing,D.enableUV2Morphing=this.enableUV2Morphing,D.enableColorMorphing=this.enableColorMorphing,D}serialize(){const D={};D.id=this.uniqueId,D.targets=[];for(const h of this._targets)D.targets.push(h.serialize());return D}_syncActiveTargets(){let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const h=!!this._targetStoreTexture,o=this.isUsingTextureForTargets;(this._mustSynchronize||h!==o)&&(this._mustSynchronize=!1,this.synchronize());let H=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let g=-1;for(const j of this._targets)if(g++,0!==j.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=T.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(j),this._morphTargetTextureIndices[H]=g,this._tempInfluences[H++]=j.influence}this._morphTargetTextureIndices.length!==H&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,H)),this._influences&&this._influences.length===H||(this._influences=new Float32Array(H));for(let j=0;j<H;j++)this._influences[j]=this._tempInfluences[j];if(D&&this._scene)for(const j of this._scene.meshes)j.morphTargetManager===this&&(o?j._markSubMeshesAsAttributesDirty():j._syncGeometryWithMorphTargetManager())}synchronize(){var D;if(!this._scene||this.areUpdatesFrozen)return;const h=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(D=this._targetStoreTexture)||void 0===D||D.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>h.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const o of this._targets){this._supportsPositions=this._supportsPositions&&o.hasPositions,this._supportsNormals=this._supportsNormals&&o.hasNormals,this._supportsTangents=this._supportsTangents&&o.hasTangents,this._supportsUVs=this._supportsUVs&&o.hasUVs,this._supportsUV2s=this._supportsUV2s&&o.hasUV2s,this._supportsColors=this._supportsColors&&o.hasColors;const D=o.vertexCount;if(0===this._vertexCount)this._vertexCount=D;else if(this._vertexCount!==D)return void B.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${o.name}": ${D}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const D=h.getCaps().maxTextureSize;this._textureWidth>D&&(this._textureHeight=Math.ceil(this._textureWidth/D),this._textureWidth=D);const o=this._targets.length,H=new Float32Array(o*this._textureWidth*this._textureHeight*4);let g=0;for(let h=0;h<o;h++){const D=this._targets[h],o=D.getPositions(),j=D.getNormals(),M=D.getUVs(),R=D.getTangents(),t=D.getUV2s(),S=D.getColors();g=h*this._textureWidth*this._textureHeight*4;for(let h=0;h<this._vertexCount;h++)this._supportsPositions&&o&&(H[g]=o[3*h],H[g+1]=o[3*h+1],H[g+2]=o[3*h+2],g+=4),this._supportsNormals&&j&&(H[g]=j[3*h],H[g+1]=j[3*h+1],H[g+2]=j[3*h+2],g+=4),this._supportsUVs&&M&&(H[g]=M[2*h],H[g+1]=M[2*h+1],g+=4),this._supportsTangents&&R&&(H[g]=R[3*h],H[g+1]=R[3*h+1],H[g+2]=R[3*h+2],g+=4),this._supportsUV2s&&t&&(H[g]=t[2*h],H[g+1]=t[2*h+1],g+=4),this._supportsColors&&S&&(H[g]=S[4*h],H[g+1]=S[4*h+1],H[g+2]=S[4*h+2],H[g+3]=S[4*h+3],g+=4)}this._targetStoreTexture=L.c.CreateRGBATexture(H,this._textureWidth,this._textureHeight,o,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const o of this._scene.meshes)o.morphTargetManager===this&&o._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const D=this._parentContainer.morphTargetManagers.indexOf(this);D>-1&&this._parentContainer.morphTargetManagers.splice(D,1),this._parentContainer=null}for(const D of this._targets)this._scene.stopAnimation(D)}}static Parse(D,h){const o=new T(h);for(const H of D.targets)o.addTarget(O.c.Parse(H,h));return o}}T.EnableTextureStorage=!0,T.MaxActiveMorphTargetsInVertexAttributeMode=8,T.ConstantTargetCountForTextureMode=0;var Z=o(14299),e=o(12691),p=o(13169);const mD=new Map,a=mD;function u(D,h,o){I(D)&&B.d.Warn(`Extension with the name '${D}' already exists`),mD.set(D,{isGLTFExtension:h,factory:o})}function I(D){return mD.delete(D)}var P=o(14308),n=o(13431),F=o(12901);class w{static Get(D,h,o){if(!h||void 0==o||!h[o])throw new Error(`${D}: Failed to find index (${o})`);return h[o]}static TryGet(D,h){return D&&void 0!=h&&D[h]?D[h]:null}static Assign(D){if(D)for(let h=0;h<D.length;h++)D[h].index=h}}function Y(D){if(D.min&&D.max){const h=D.min,o=D.max,H=g.TmpVectors.Gh[0].Qg(h[0],h[1],h[2]),j=g.TmpVectors.Gh[1].Qg(o[0],o[1],o[2]);if(D.normalized&&5126!==D.componentType){let h=1;switch(D.componentType){case 5120:h=127;break;case 5121:h=255;break;case 5122:h=32767;break;case 5123:h=65535}const o=1/h;H.scaleInPlace(o),j.scaleInPlace(o)}return new p.d(H,j)}return null}class l{static RegisterExtension(D,h){u(D,!1,h)}static UnregisterExtension(D){return I(D)}get eh(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(D){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=D}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((D=>D.dispose&&D.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(D,h,o,H,g,j){let M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=h,this._assetContainer=o,this._loadData(H);let j=null;if(D){const h={};if(this._gltf.nodes)for(const D of this._gltf.nodes)D.name&&(h[D.name]=D.index);j=(D instanceof Array?D:[D]).map((D=>{const o=h[D];if(void 0===o)throw new Error(`Failed to find node '${D}'`);return o}))}return await this._loadAsync(g,M,j,(()=>({meshes:this._getMeshes(),YQ:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(D,h,o,H){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=D,this._loadData(h),await this._loadAsync(o,g,null,(()=>{}))}async _loadAsync(D,h,o,H){return await Promise.resolve().then((async()=>{this._rootUrl=D,this._uniqueRootUrl=!D.startsWith("file:")&&h?D:`${D}${Date.now()}/`,this._fileName=h,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const g=`${Z.h[Z.h.LOADING]} => ${Z.h[Z.h.READY]}`,j=`${Z.h[Z.h.LOADING]} => ${Z.h[Z.h.COMPLETE]}`;this._parent._startPerformanceCounter(g),this._parent._startPerformanceCounter(j),this._parent._setState(Z.h.LOADING),this._extensionsOnLoading();const R=new Array;if(!this.parent.loadOnlyMaterials)if(o)R.push(this.loadSceneAsync("/nodes",{nodes:o,index:-1}));else if(void 0!=this._gltf.Th||this._gltf.scenes&&this._gltf.scenes[0]){const D=w.Get("/scene",this._gltf.scenes,this._gltf.Th||0);R.push(this.loadSceneAsync(`/scenes/${D.index}`,D))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let D=0;D<this._gltf.materials.length;++D){const h=this._gltf.materials[D],o="/materials/"+D,H=q.c.TriangleFillMode;R.push(this._loadMaterialAsync(o,h,null,H,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&R.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&R.push(this._compileShadowGeneratorsAsync());const t=Promise.all(R).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.It(!0);for(const D of this._babylonScene.materials){const h=D;void 0!==h.maxSimultaneousLights&&(h.maxSimultaneousLights=Math.max(h.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(Z.h.READY),this._skipStartAnimationStep||this._startAnimations(),H()}));return await t.then((D=>(this._parent._endPerformanceCounter(g),M.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(j),this._parent._setState(Z.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(D=>{this._parent.onErrorObservable.notifyObservers(D),this._parent.onErrorObservable.clear(),this.dispose()}))})),D)))})).catch((D=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(D),this._parent.onErrorObservable.clear(),this.dispose()),D}))}_loadData(D){if(this._gltf=D.json,this._setupData(),D.bin){const h=this._gltf.buffers;if(h&&h[0]&&!h[0].uri){const o=h[0];(o.byteLength<D.bin.byteLength-3||o.byteLength>D.bin.byteLength)&&B.d.Warn(`Binary buffer length (${o.byteLength}) from JSON does not match chunk length (${D.bin.byteLength})`),this._bin=D.bin}else B.d.Warn("Unexpected BIN chunk")}}_setupData(){if(w.Assign(this._gltf.accessors),w.Assign(this._gltf.animations),w.Assign(this._gltf.buffers),w.Assign(this._gltf.bufferViews),w.Assign(this._gltf.cameras),w.Assign(this._gltf.images),w.Assign(this._gltf.materials),w.Assign(this._gltf.meshes),w.Assign(this._gltf.nodes),w.Assign(this._gltf.samplers),w.Assign(this._gltf.scenes),w.Assign(this._gltf.skins),w.Assign(this._gltf.textures),this._gltf.nodes){const D={};for(const o of this._gltf.nodes)if(o.children)for(const h of o.children)D[h]=o.index;const h=this._createRootNode();for(const o of this._gltf.nodes){const H=D[o.index];o.parent=void 0===H?h:this._gltf.nodes[H]}}}async _loadExtensionsAsync(){const D=[];if(a.forEach(((h,o)=>{var H;!1===(null===(H=this.parent.extensionOptions[o])||void 0===H?void 0:H.enabled)?h.isGLTFExtension&&this.isExtensionUsed(o)&&B.d.Warn(`Extension ${o} is used but has been explicitly disabled.`):h.isGLTFExtension&&!this.isExtensionUsed(o)||D.push((async()=>{const D=await h.factory(this);return D.name!==o&&B.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${D.name} !== ${o}`),this._parent.onExtensionLoadedObservable.notifyObservers(D),D})())})),this._extensions.push(...await Promise.all(D)),this._extensions.sort(((D,h)=>(D.order||Number.MAX_VALUE)-(h.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const o of this._gltf.extensionsRequired){if(!this._extensions.some((D=>D.name===o&&D.enabled))){var h;if(!1===(null===(h=this.parent.extensionOptions[o])||void 0===h?void 0:h.enabled))throw new Error(`Required extension ${o} is disabled`);throw new Error(`Required extension ${o} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const D=new J.d("__root__",this._babylonScene);this._rootBabylonMesh=D,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.It(!1);const h={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case Z.g.AUTO:this._babylonScene.useRightHandedSystem||(h.rotation=[0,1,0,0],h.scale=[1,1,-1],l._LoadTransform(h,this._rootBabylonMesh));break;case Z.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(D),h}loadSceneAsync(D,h){const o=this._extensionsLoadSceneAsync(D,h);if(o)return o;const H=new Array;if(this.logOpen(`${D} ${h.name||""}`),h.nodes)for(const g of h.nodes){const h=w.Get(`${D}/nodes/${g}`,this._gltf.nodes,g);H.push(this.loadNodeAsync(`/nodes/${h.index}`,h,(D=>{D.parent=this._rootBabylonMesh})))}for(const g of this._postSceneLoadActions)g();return H.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(H).then((()=>{}))}_forEachPrimitive(D,h){if(D._primitiveBabylonMeshes)for(const o of D._primitiveBabylonMeshes)h(o)}_getGeometries(){const D=[],h=this._gltf.nodes;if(h)for(const o of h)this._forEachPrimitive(o,(h=>{const o=h.mg;o&&-1===D.indexOf(o)&&D.push(o)}));return D}_getMeshes(){const D=[];this._rootBabylonMesh instanceof N.e&&D.push(this._rootBabylonMesh);const h=this._gltf.nodes;if(h)for(const o of h)this._forEachPrimitive(o,(h=>{D.push(h)}));return D}_getTransformNodes(){const D=[],h=this._gltf.nodes;if(h)for(const o of h)o._babylonTransformNode&&"ug"===o._babylonTransformNode.getClassName()&&D.push(o._babylonTransformNode),o._babylonTransformNodeForSkin&&D.push(o._babylonTransformNodeForSkin);return D}_getSkeletons(){const D=[],h=this._gltf.skins;if(h)for(const o of h)o._data&&D.push(o._data.babylonSkeleton);return D}_getAnimationGroups(){const D=[],h=this._gltf.animations;if(h)for(const o of h)o._babylonAnimationGroup&&D.push(o._babylonAnimationGroup);return D}_startAnimations(){switch(this._parent.animationStartMode){case Z.e.NONE:break;case Z.e.FIRST:{const D=this._getAnimationGroups();0!==D.length&&D[0].start(!0);break}case Z.e.ALL:{const D=this._getAnimationGroups();for(const h of D)h.start(!0);break}default:return void B.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const H=this._extensionsLoadNodeAsync(D,h,o);if(H)return H;if(h._babylonTransformNode)throw new Error(`${D}: Invalid recursive node hierarchy`);const g=new Array;this.logOpen(`${D} ${h.name||""}`);const j=H=>{if(l.AddPointerMetadata(H,D),l._LoadTransform(h,H),void 0!=h.camera){const o=w.Get(`${D}/camera`,this._gltf.cameras,h.camera);g.push(this.loadCameraAsync(`/cameras/${o.index}`,o,(D=>{D.parent=H,this._babylonScene.useRightHandedSystem||(H.Ug.x=-1)})))}if(h.children)for(const o of h.children){const h=w.Get(`${D}/children/${o}`,this._gltf.nodes,o);g.push(this.loadNodeAsync(`/nodes/${h.index}`,h,(D=>{D.parent=H})))}o(H)},M=void 0!=h.mesh,R=this._parent.loadSkins&&void 0!=h.skin;if(!M||R){const D=h.name||`node${h.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new b.c(D,this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==h.mesh?h._babylonTransformNode=o:h._babylonTransformNodeForSkin=o,j(o)}if(M)if(R){const o=w.Get(`${D}/mesh`,this._gltf.meshes,h.mesh);g.push(this._loadMeshAsync(`/meshes/${o.index}`,h,o,(o=>{const H=h._babylonTransformNodeForSkin;o.metadata=(0,n.c)(H.metadata,o.metadata||{});const j=w.Get(`${D}/skin`,this._gltf.skins,h.skin);g.push(this._loadSkinAsync(`/skins/${j.index}`,h,j,(D=>{this._forEachPrimitive(h,(h=>{h.skeleton=D})),this._postSceneLoadActions.push((()=>{if(void 0!=j.skeleton){const D=w.Get(`/skins/${j.index}/skeleton`,this._gltf.nodes,j.skeleton).parent;h.index===D.index?o.parent=H.parent:o.parent=D._babylonTransformNode}else o.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:H,skinnedNode:o})}))})))})))}else{const o=w.Get(`${D}/mesh`,this._gltf.meshes,h.mesh);g.push(this._loadMeshAsync(`/meshes/${o.index}`,h,o,j))}return this.logClose(),Promise.all(g).then((()=>(this._forEachPrimitive(h,(D=>{const h=D;!h.isAnInstance&&h.mg&&h.mg.useBoundingInfoFromGeometry?D.pD():D.refreshBoundingInfo(!0,!0)})),h._babylonTransformNode)))}_loadMeshAsync(D,h,o,H){const g=o.primitives;if(!g||!g.length)throw new Error(`${D}: Primitives are missing`);void 0==g[0].index&&w.Assign(g);const j=new Array;this.logOpen(`${D} ${o.name||""}`);const M=h.name||`node${h.index}`;if(1===g.length){const H=o.primitives[0];j.push(this._loadMeshPrimitiveAsync(`${D}/primitives/${H.index}`,M,h,o,H,(D=>{h._babylonTransformNode=D,h._primitiveBabylonMeshes=[D]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,h._babylonTransformNode=new b.c(M,this._babylonScene),h._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h._primitiveBabylonMeshes=[];for(const H of g)j.push(this._loadMeshPrimitiveAsync(`${D}/primitives/${H.index}`,`${M}_primitive${H.index}`,h,o,H,(D=>{D.parent=h._babylonTransformNode,h._primitiveBabylonMeshes.push(D)})))}return H(h._babylonTransformNode),this.logClose(),Promise.all(j).then((()=>h._babylonTransformNode))}_loadMeshPrimitiveAsync(D,h,o,H,g,j){const M=this._extensionsLoadMeshPrimitiveAsync(D,h,o,H,g,j);if(M)return M;this.logOpen(`${D}`);const R=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==o.skin&&!H.primitives[0].targets;let t,S;if(R&&g._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,t=g._instanceData.babylonSourceMesh.createInstance(h),t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S=g._instanceData.promise;else{const j=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new J.d(h,this._babylonScene);M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M.sideOrientation=this._babylonScene.useRightHandedSystem?q.c.CounterClockWiseSideOrientation:q.c.ClockWiseSideOrientation,this._createMorphTargets(D,o,H,g,M),j.push(this._loadVertexDataAsync(D,g,M).then((async h=>await this._loadMorphTargetsAsync(D,g,M,h).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,h.ZD(M),h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const k=l._GetDrawMode(D,g.mode);if(void 0==g.material){let D=this._defaultBabylonMaterialData[k];D||(D=this._createDefaultMaterial("__GLTFLoader._default",k),this._parent.onMaterialLoadedObservable.notifyObservers(D),this._defaultBabylonMaterialData[k]=D),M.material=D}else if(!this.parent.skipMaterials){const h=w.Get(`${D}/material`,this._gltf.materials,g.material);j.push(this._loadMaterialAsync(`/materials/${h.index}`,h,M,k,(D=>{M.material=D})))}S=Promise.all(j),R&&(g._instanceData={babylonSourceMesh:M,promise:S}),t=M}return l.AddPointerMetadata(t,D),this._parent.onMeshLoadedObservable.notifyObservers(t),j(t),this.logClose(),S.then((()=>t))}_loadVertexDataAsync(D,h,o){const H=this._extensionsLoadVertexDataAsync(D,h,o);if(H)return H;const g=h.attributes;if(!g)throw new Error(`${D}: Attributes are missing`);const j=new Array,M=new G.d(o.name,this._babylonScene);if(void 0==h.indices)o.isUnIndexed=!0;else{const o=w.Get(`${D}/indices`,this._gltf.accessors,h.indices);j.push(this._loadIndicesAccessorAsync(`/accessors/${o.index}`,o).then((D=>{M.setIndices(D)})))}const R=(h,H,R)=>{if(void 0==g[h])return;o._delayInfo=o._delayInfo||[],-1===o._delayInfo.indexOf(H)&&o._delayInfo.push(H);const t=w.Get(`${D}/attributes/${h}`,this._gltf.accessors,g[h]);j.push(this._loadVertexAccessorAsync(`/accessors/${t.index}`,t,H).then((D=>{if(D.getKind()===i.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!o.skeleton){const D=Y(t);D&&(M._boundingInfo=D,M.useBoundingInfoFromGeometry=!0)}M.setVerticesBuffer(D,t.count)}))),H==i.f.MatricesIndicesExtraKind&&(o.numBoneInfluencers=8),R&&R(t)};return R("POSITION",i.f.PositionKind),R("NORMAL",i.f.NormalKind),R("TANGENT",i.f.TangentKind),R("TEXCOORD_0",i.f.UVKind),R("TEXCOORD_1",i.f.UV2Kind),R("TEXCOORD_2",i.f.UV3Kind),R("TEXCOORD_3",i.f.UV4Kind),R("TEXCOORD_4",i.f.UV5Kind),R("TEXCOORD_5",i.f.UV6Kind),R("JOINTS_0",i.f.MatricesIndicesKind),R("WEIGHTS_0",i.f.MatricesWeightsKind),R("JOINTS_1",i.f.MatricesIndicesExtraKind),R("WEIGHTS_1",i.f.MatricesWeightsExtraKind),R("COLOR_0",i.f.ColorKind,(D=>{"VEC4"===D.type&&(o.hasVertexAlpha=!0)})),Promise.all(j).then((()=>M))}_createMorphTargets(D,h,o,H,g){if(!H.targets||!this._parent.loadMorphTargets)return;if(void 0==h._numMorphTargets)h._numMorphTargets=H.targets.length;else if(H.targets.length!==h._numMorphTargets)throw new Error(`${D}: Primitives do not have the same number of targets`);const j=o.extras?o.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,g.morphTargetManager=new T(this._babylonScene),g.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.morphTargetManager.areUpdatesFrozen=!0;for(let M=0;M<H.targets.length;M++){const D=h.weights?h.weights[M]:o.weights?o.weights[M]:0,H=j?j[M]:`morphTarget${M}`;g.morphTargetManager.addTarget(new O.c(H,D,g.GD()))}}_loadMorphTargetsAsync(D,h,o,H){if(!h.targets||!this._parent.loadMorphTargets)return Promise.resolve();const g=new Array,j=o.morphTargetManager;for(let M=0;M<j.numTargets;M++){const o=j.getTarget(M);g.push(this._loadMorphTargetVertexDataAsync(`${D}/targets/${M}`,H,h.targets[M],o))}return Promise.all(g).then((()=>{j.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(D,h,o,H){const g=new Array,j=(H,j,M)=>{if(void 0==o[H])return;const R=h.getVertexBuffer(j);if(!R)return;const t=w.Get(`${D}/${H}`,this._gltf.accessors,o[H]);g.push(this._loadFloatAccessorAsync(`/accessors/${t.index}`,t).then((D=>{M(R,D)})))};return j("POSITION",i.f.PositionKind,((D,h)=>{const o=new Float32Array(h.length);D.forEach(h.length,((D,H)=>{o[H]=h[H]+D})),H.setPositions(o)})),j("NORMAL",i.f.NormalKind,((D,h)=>{const o=new Float32Array(h.length);D.forEach(o.length,((D,H)=>{o[H]=h[H]+D})),H.setNormals(o)})),j("TANGENT",i.f.TangentKind,((D,h)=>{const o=new Float32Array(h.length/3*4);let g=0;D.forEach(h.length/3*4,((D,H)=>{(H+1)%4!==0&&(o[g]=h[g]+D,g++)})),H.setTangents(o)})),j("TEXCOORD_0",i.f.UVKind,((D,h)=>{const o=new Float32Array(h.length);D.forEach(h.length,((D,H)=>{o[H]=h[H]+D})),H.setUVs(o)})),j("TEXCOORD_1",i.f.UV2Kind,((D,h)=>{const o=new Float32Array(h.length);D.forEach(h.length,((D,H)=>{o[H]=h[H]+D})),H.setUV2s(o)})),j("COLOR_0",i.f.ColorKind,((h,o)=>{let g=null;const j=h.getSize();if(3===j){g=new Float32Array(o.length/3*4),h.forEach(o.length,((D,h)=>{const H=Math.floor(h/3),j=h%3;g[4*H+j]=o[3*H+j]+D}));for(let D=0;D<o.length/3;++D)g[4*D+3]=1}else{if(4!==j)throw new Error(`${D}: Invalid number of components (${j}) for COLOR_0 attribute`);g=new Float32Array(o.length),h.forEach(o.length,((D,h)=>{g[h]=o[h]+D}))}H.setColors(g)})),await Promise.all(g).then((()=>{}))}static _LoadTransform(D,h){if(void 0!=D.skin)return;let o=g.Gh.Zero(),H=g.Quaternion.Identity(),j=g.Gh.One();if(D.matrix){g.Matrix.Ih(D.matrix).decompose(j,H,o)}else D.translation&&(o=g.Gh.Ih(D.translation)),D.rotation&&(H=g.Quaternion.Ih(D.rotation)),D.scale&&(j=g.Gh.Ih(D.scale));h.position=o,h.rotationQuaternion=H,h.Ug=j}_loadSkinAsync(D,h,o,H){if(!this._parent.loadSkins)return Promise.resolve();const g=this._extensionsLoadSkinAsync(D,h,o);if(g)return g;if(o._data)return H(o._data.babylonSkeleton),o._data.promise;const j=`skeleton${o.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new U(o.name||j,j,this._babylonScene);M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(D,o,M);const R=this._loadSkinInverseBindMatricesDataAsync(D,o).then((D=>{this._updateBoneMatrices(M,D)}));return o._data={babylonSkeleton:M,promise:R},H(M),R}_loadBones(D,h,o){if(void 0==h.skeleton||this._parent.alwaysComputeSkeletonRootNode){const o=this._findSkeletonRootNode(`${D}/joints`,h.joints);if(o)if(void 0===h.skeleton)h.skeleton=o.index;else{const H=(D,h)=>{for(;h.parent;h=h.parent)if(h.parent===D)return!0;return!1},g=w.Get(`${D}/skeleton`,this._gltf.nodes,h.skeleton);g===o||H(g,o)||(B.d.Warn(`${D}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),h.skeleton=o.index)}else B.d.Warn(`${D}: Failed to find common root`)}const H={};for(const g of h.joints){const j=w.Get(`${D}/joints/${g}`,this._gltf.nodes,g);this._loadBone(j,h,o,H)}}_findSkeletonRootNode(D,h){if(0===h.length)return null;const o={};for(const g of h){const h=[];let H=w.Get(`${D}/${g}`,this._gltf.nodes,g);for(;-1!==H.index;)h.unshift(H),H=H.parent;o[g]=h}let H=null;for(let g=0;;++g){let D=o[h[0]];if(g>=D.length)return H;const j=D[g];for(let M=1;M<h.length;++M)if(D=o[h[M]],g>=D.length||j!==D[g])return H;H=j}}_loadBone(D,h,o,H){D._isJoint=!0;let g=H[D.index];if(g)return g;let j=null;D.index!==h.skeleton&&(D.parent&&-1!==D.parent.index?j=this._loadBone(D.parent,h,o,H):void 0!==h.skeleton&&B.d.Warn(`/skins/${h.index}/skeleton: Skeleton node is not a common root`));const M=h.joints.indexOf(D.index);return g=new S.d(D.name||`joint${D.index}`,o,j,this._getNodeMatrix(D),null,null,M),H[D.index]=g,this._postSceneLoadActions.push((()=>{g.linkTransformNode(D._babylonTransformNode)})),g}_loadSkinInverseBindMatricesDataAsync(D,h){if(void 0==h.inverseBindMatrices)return Promise.resolve(null);const o=w.Get(`${D}/inverseBindMatrices`,this._gltf.accessors,h.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${o.index}`,o)}_updateBoneMatrices(D,h){for(const o of D.bones){const D=g.Matrix.Identity(),H=o._index;h&&-1!==H&&(g.Matrix.FromArrayToRef(h,16*H,D),D.invertToRef(D));const j=o.getParent();j&&D.multiplyToRef(j.getAbsoluteInverseBindMatrix(),D),o.Wh(D,!1,!1),o._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(D){return D.matrix?g.Matrix.Ih(D.matrix):g.Matrix.Compose(D.scale?g.Gh.Ih(D.scale):g.Gh.One(),D.rotation?g.Quaternion.Ih(D.rotation):g.Quaternion.Identity(),D.translation?g.Gh.Ih(D.translation):g.Gh.Zero())}loadCameraAsync(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const H=this._extensionsLoadCameraAsync(D,h,o);if(H)return H;const j=new Array;this.logOpen(`${D} ${h.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new t.d(h.name||`camera${h.index}`,g.Gh.Zero(),this._babylonScene,!1);switch(M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h._babylonCamera=M,M.setTarget(new g.Gh(0,0,-1)),h.type){case"perspective":{const o=h.perspective;if(!o)throw new Error(`${D}: Camera perspective properties are missing`);M.fov=o.yfov,M.Xh=o.znear,M.maxZ=o.zfar||0;break}case"orthographic":if(!h.orthographic)throw new Error(`${D}: Camera orthographic properties are missing`);M.mode=R.b.ORTHOGRAPHIC_CAMERA,M.orthoLeft=-h.orthographic.xmag,M.orthoRight=h.orthographic.xmag,M.orthoBottom=-h.orthographic.ymag,M.orthoTop=h.orthographic.ymag,M.Xh=h.orthographic.znear,M.maxZ=h.orthographic.zfar;break;default:throw new Error(`${D}: Invalid camera type (${h.type})`)}return l.AddPointerMetadata(M,D),this._parent.onCameraLoadedObservable.notifyObservers(M),o(M),this.logClose(),Promise.all(j).then((()=>M))}_loadAnimationsAsync(){const D=this._gltf.animations;if(!D)return Promise.resolve();const h=new Array;for(let o=0;o<D.length;o++){const H=D[o];h.push(this.loadAnimationAsync(`/animations/${H.index}`,H).then((D=>{0===D.targetedAnimations.length&&D.dispose()})))}return Promise.all(h).then((()=>{}))}loadAnimationAsync(D,h){const H=this._extensionsLoadAnimationAsync(D,h);return H||o.e(78).then(o.bind(o,15837)).then((o=>{let{AnimationGroup:H}=o;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new H(h.name||`animation${h.index}`,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h._babylonAnimationGroup=g;const j=new Array;w.Assign(h.channels),w.Assign(h.samplers);for(const M of h.channels)j.push(this._loadAnimationChannelAsync(`${D}/channels/${M.index}`,D,h,M,((D,h)=>{D.animations=D.animations||[],D.animations.push(h),g.addTargetedAnimation(h,D)})));return Promise.all(j).then((()=>(g.normalize(0),g)))}))}async _loadAnimationChannelAsync(D,h,H,g,j){const M=this._extensionsLoadAnimationChannelAsync(D,h,H,g,j);if(M)return await M;if(void 0==g.target.node)return await Promise.resolve();const R=w.Get(`${D}/target/node`,this._gltf.nodes,g.target.node),t=g.target.path,S="weights"===t;if(S&&!R._numMorphTargets||!S&&!R._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!S&&!R._isJoint)return await Promise.resolve();let k;switch(await Promise.resolve().then(o.bind(o,14317)),t){case"translation":var K;k=null===(K=(0,P.d)("/nodes/{}/translation"))||void 0===K?void 0:K.interpolation;break;case"rotation":var Q;k=null===(Q=(0,P.d)("/nodes/{}/rotation"))||void 0===Q?void 0:Q.interpolation;break;case"scale":var v;k=null===(v=(0,P.d)("/nodes/{}/scale"))||void 0===v?void 0:v.interpolation;break;case"weights":var r;k=null===(r=(0,P.d)("/nodes/{}/weights"))||void 0===r?void 0:r.interpolation;break;default:throw new Error(`${D}/target/path: Invalid value (${g.target.path})`)}if(!k)throw new Error(`${D}/target/path: Could not find interpolation properties for target path (${g.target.path})`);const B={object:R,info:k};return await this._loadAnimationChannelFromTargetInfoAsync(D,h,H,g,B,j)}_loadAnimationChannelFromTargetInfoAsync(D,h,o,H,g,j){const M=this.parent.targetFps,R=1/M,t=w.Get(`${D}/sampler`,o.samplers,H.sampler);return this._loadAnimationSamplerAsync(`${h}/samplers/${H.sampler}`,t).then((D=>{let h=0;const t=g.object,S=g.info;for(const g of S){const S=g.getStride(t),k=D.input,K=D.output,Q=new Array(k.length);let v=0;switch(D.interpolation){case"STEP":for(let D=0;D<k.length;D++){const h=g.getValue(t,K,v,1);v+=S,Q[D]={frame:k[D]*M,value:h,interpolation:1}}break;case"CUBICSPLINE":for(let D=0;D<k.length;D++){const h=g.getValue(t,K,v,R);v+=S;const o=g.getValue(t,K,v,1);v+=S;const H=g.getValue(t,K,v,R);v+=S,Q[D]={frame:k[D]*M,inTangent:h,value:o,outTangent:H}}break;case"LINEAR":for(let D=0;D<k.length;D++){const h=g.getValue(t,K,v,1);v+=S,Q[D]={frame:k[D]*M,value:h}}}if(v>0){const D=`${o.name||`animation${o.index}`}_channel${H.index}_${h}`,R=g.buildAnimations(t,D,M,Q);for(const o of R)h++,j(o.babylonAnimatable,o.babylonAnimation)}}}))}_loadAnimationSamplerAsync(D,h){if(h._data)return h._data;const o=h.interpolation||"LINEAR";switch(o){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${D}/interpolation: Invalid value (${h.interpolation})`)}const H=w.Get(`${D}/input`,this._gltf.accessors,h.input),g=w.Get(`${D}/output`,this._gltf.accessors,h.output);return h._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${H.index}`,H),this._loadFloatAccessorAsync(`/accessors/${g.index}`,g)]).then((D=>{let[h,H]=D;return{input:h,interpolation:o,output:H}})),h._data}loadBufferAsync(D,h,o,H){const g=this._extensionsLoadBufferAsync(D,h,o,H);if(g)return g;if(!h._data)if(h.uri)h._data=this.loadUriAsync(`${D}/uri`,h,h.uri);else{if(!this._bin)throw new Error(`${D}: Uri is missing or the binary glTF is missing its binary chunk`);h._data=this._bin.readAsync(0,h.byteLength)}return h._data.then((h=>{try{return new Uint8Array(h.buffer,h.byteOffset+o,H)}catch(g){throw new Error(`${D}: ${g.message}`)}}))}loadBufferViewAsync(D,h){const o=this._extensionsLoadBufferViewAsync(D,h);if(o)return o;if(h._data)return h._data;const H=w.Get(`${D}/buffer`,this._gltf.buffers,h.buffer);return h._data=this.loadBufferAsync(`/buffers/${H.index}`,H,h.byteOffset||0,h.byteLength),h._data}_loadAccessorAsync(D,h,o){if(h._data)return h._data;const H=l._GetNumComponents(D,h.type),g=H*i.f.GetTypeByteLength(h.componentType),j=H*h.count;if(void 0==h.bufferView)h._data=Promise.resolve(new o(j));else{const M=w.Get(`${D}/bufferView`,this._gltf.bufferViews,h.bufferView);h._data=this.loadBufferViewAsync(`/bufferViews/${M.index}`,M).then((R=>{if(5126!==h.componentType||h.normalized||M.byteStride&&M.byteStride!==g){const D=new o(j);return i.f.ForEach(R,h.byteOffset||0,M.byteStride||g,H,h.componentType,D.length,h.normalized||!1,((h,o)=>{D[o]=h})),D}return l._GetTypedArray(D,h.componentType,R,h.byteOffset,j)}))}if(h.sparse){const j=h.sparse;h._data=h._data.then((M=>{const R=M,t=w.Get(`${D}/sparse/indices/bufferView`,this._gltf.bufferViews,j.indices.bufferView),S=w.Get(`${D}/sparse/values/bufferView`,this._gltf.bufferViews,j.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${t.index}`,t),this.loadBufferViewAsync(`/bufferViews/${S.index}`,S)]).then((M=>{let[t,S]=M;const k=l._GetTypedArray(`${D}/sparse/indices`,j.indices.componentType,t,j.indices.byteOffset,j.count),K=H*j.count;let Q;if(5126!==h.componentType||h.normalized){const M=l._GetTypedArray(`${D}/sparse/values`,h.componentType,S,j.values.byteOffset,K);Q=new o(K),i.f.ForEach(M,0,g,H,h.componentType,Q.length,h.normalized||!1,((D,h)=>{Q[h]=D}))}else Q=l._GetTypedArray(`${D}/sparse/values`,h.componentType,S,j.values.byteOffset,K);let v=0;for(let D=0;D<k.length;D++){let h=k[D]*H;for(let D=0;D<H;D++)R[h++]=Q[v++]}return R}))}))}return h._data}_loadFloatAccessorAsync(D,h){return this._loadAccessorAsync(D,h,Float32Array)}_loadIndicesAccessorAsync(D,h){if("SCALAR"!==h.type)throw new Error(`${D}/type: Invalid value ${h.type}`);if(5121!==h.componentType&&5123!==h.componentType&&5125!==h.componentType)throw new Error(`${D}/componentType: Invalid value ${h.componentType}`);if(h._data)return h._data;if(h.sparse){const o=l._GetTypedArrayConstructor(`${D}/componentType`,h.componentType);h._data=this._loadAccessorAsync(D,h,o)}else{const o=w.Get(`${D}/bufferView`,this._gltf.bufferViews,h.bufferView);h._data=this.loadBufferViewAsync(`/bufferViews/${o.index}`,o).then((o=>l._GetTypedArray(D,h.componentType,o,h.byteOffset,h.count)))}return h._data}_loadVertexBufferViewAsync(D){if(D._babylonBuffer)return D._babylonBuffer;const h=this._babylonScene.getEngine();return D._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${D.index}`,D).then((D=>new i.d(h,D,!1))),D._babylonBuffer}_loadVertexAccessorAsync(D,h,o){var H;if(null!==(H=h._babylonVertexBuffer)&&void 0!==H&&H[o])return h._babylonVertexBuffer[o];h._babylonVertexBuffer||(h._babylonVertexBuffer={});const g=this._babylonScene.getEngine();if(h.sparse||void 0==h.bufferView)h._babylonVertexBuffer[o]=this._loadFloatAccessorAsync(D,h).then((D=>new i.f(g,D,o,!1)));else{const H=w.Get(`${D}/bufferView`,this._gltf.bufferViews,h.bufferView);h._babylonVertexBuffer[o]=this._loadVertexBufferViewAsync(H).then((j=>{const M=l._GetNumComponents(D,h.type);return new i.f(g,j,o,!1,void 0,H.byteStride,void 0,h.byteOffset,M,h.componentType,h.normalized,!0,void 0,!0)}))}return h._babylonVertexBuffer[o]}_loadMaterialMetallicRoughnessPropertiesAsync(D,h,o){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);const H=new Array;return h&&(h.baseColorFactor?(o.albedoColor=j.mo.Ih(h.baseColorFactor),o.alpha=h.baseColorFactor[3]):o.albedoColor=j.mo.White(),o.metallic=void 0==h.metallicFactor?1:h.metallicFactor,o.roughness=void 0==h.roughnessFactor?1:h.roughnessFactor,h.baseColorTexture&&H.push(this.loadTextureInfoAsync(`${D}/baseColorTexture`,h.baseColorTexture,(D=>{D.name=`${o.name} (Base Color)`,o.albedoTexture=D}))),h.metallicRoughnessTexture&&(h.metallicRoughnessTexture.nonColorData=!0,H.push(this.loadTextureInfoAsync(`${D}/metallicRoughnessTexture`,h.metallicRoughnessTexture,(D=>{D.name=`${o.name} (Metallic Roughness)`,o.metallicTexture=D}))),o.useMetallnessFromMetallicTextureBlue=!0,o.useRoughnessFromMetallicTextureGreen=!0,o.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(H).then((()=>{}))}_loadMaterialAsync(D,h,o,H){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const j=this._extensionsLoadMaterialAsync(D,h,o,H,g);if(j)return j;h._data=h._data||{};let M=h._data[H];if(!M){this.logOpen(`${D} ${h.name||""}`);const o=this.createMaterial(D,h,H);M={babylonMaterial:o,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(D,h,o)},h._data[H]=M,l.AddPointerMetadata(o,D),this._parent.onMaterialLoadedObservable.notifyObservers(o),this.logClose()}return o&&(M.babylonMeshes.push(o),o.Jh.addOnce((()=>{const D=M.babylonMeshes.indexOf(o);-1!==D&&M.babylonMeshes.splice(D,1)}))),g(M.babylonMaterial),M.promise.then((()=>M.babylonMaterial))}_createDefaultMaterial(D,h){this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new c.b(D,this._babylonScene);return o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.fillMode=h,o.enableSpecularAntiAliasing=!0,o.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,o.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,o.transparencyMode=c.b.PBRMATERIAL_OPAQUE,o.metallic=1,o.roughness=1,o}createMaterial(D,h,o){const H=this._extensionsCreateMaterial(D,h,o);if(H)return H;const g=h.name||`material${h.index}`;return this._createDefaultMaterial(g,o)}loadMaterialPropertiesAsync(D,h,o){const H=this._extensionsLoadMaterialPropertiesAsync(D,h,o);if(H)return H;const g=new Array;return g.push(this.loadMaterialBasePropertiesAsync(D,h,o)),h.pbrMetallicRoughness&&g.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${D}/pbrMetallicRoughness`,h.pbrMetallicRoughness,o)),this.loadMaterialAlphaProperties(D,h,o),Promise.all(g).then((()=>{}))}loadMaterialBasePropertiesAsync(D,h,o){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);const H=new Array;return o.emissiveColor=h.emissiveFactor?j.mo.Ih(h.emissiveFactor):new j.mo(0,0,0),h.doubleSided&&(o.Mg=!1,o.twoSidedLighting=!0),h.normalTexture&&(h.normalTexture.nonColorData=!0,H.push(this.loadTextureInfoAsync(`${D}/normalTexture`,h.normalTexture,(D=>{D.name=`${o.name} (Normal)`,o.bumpTexture=D}))),o.invertNormalMapX=!this._babylonScene.useRightHandedSystem,o.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=h.normalTexture.scale&&o.bumpTexture&&(o.bumpTexture.level=h.normalTexture.scale),o.forceIrradianceInFragment=!0),h.occlusionTexture&&(h.occlusionTexture.nonColorData=!0,H.push(this.loadTextureInfoAsync(`${D}/occlusionTexture`,h.occlusionTexture,(D=>{D.name=`${o.name} (Occlusion)`,o.ambientTexture=D}))),o.useAmbientInGrayScale=!0,void 0!=h.occlusionTexture.strength&&(o.ambientTextureStrength=h.occlusionTexture.strength)),h.emissiveTexture&&H.push(this.loadTextureInfoAsync(`${D}/emissiveTexture`,h.emissiveTexture,(D=>{D.name=`${o.name} (Emissive)`,o.emissiveTexture=D}))),Promise.all(H).then((()=>{}))}loadMaterialAlphaProperties(D,h,o){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);switch(h.alphaMode||"OPAQUE"){case"OPAQUE":o.transparencyMode=c.b.PBRMATERIAL_OPAQUE,o.alpha=1;break;case"MASK":o.transparencyMode=c.b.PBRMATERIAL_ALPHATEST,o.alphaCutOff=void 0==h.alphaCutoff?.5:h.alphaCutoff,o.albedoTexture&&(o.albedoTexture.Yh=!0);break;case"BLEND":o.transparencyMode=c.b.PBRMATERIAL_ALPHABLEND,o.albedoTexture&&(o.albedoTexture.Yh=!0,o.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${D}/alphaMode: Invalid value (${h.alphaMode})`)}}loadTextureInfoAsync(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const H=this._extensionsLoadTextureInfoAsync(D,h,o);if(H)return H;if(this.logOpen(`${D}`),h.texCoord>=6)throw new Error(`${D}/texCoord: Invalid value (${h.texCoord})`);const g=w.Get(`${D}/index`,this._gltf.textures,h.index);g._textureInfo=h;const j=this._loadTextureAsync(`/textures/${h.index}`,g,(H=>{H.coordinatesIndex=h.texCoord||0,l.AddPointerMetadata(H,D),this._parent.onTextureLoadedObservable.notifyObservers(H),o(H)}));return this.logClose(),j}_loadTextureAsync(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const H=this._extensionsLoadTextureAsync(D,h,o);if(H)return H;this.logOpen(`${D} ${h.name||""}`);const g=void 0==h.sampler?l.DefaultSampler:w.Get(`${D}/sampler`,this._gltf.samplers,h.sampler),j=w.Get(`${D}/source`,this._gltf.images,h.source),M=this._createTextureAsync(D,g,j,o,void 0,!h._textureInfo.nonColorData);return this.logClose(),M}_createTextureAsync(D,h,o){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},j=arguments.length>4?arguments[4]:void 0,M=arguments.length>5?arguments[5]:void 0;const R=this._loadSampler(`/samplers/${h.index}`,h),t=new Array,S=new H;this._babylonScene._blockEntityCollection=!!this._assetContainer;const k={noMipmap:R.noMipMaps,invertY:!1,samplingMode:R.samplingMode,X:()=>{this._disposed||S.resolve()},onError:(h,o)=>{this._disposed||S.reject(new Error(`${D}: ${o&&o.message?o.message:h||"Failed to load texture"}`))},mimeType:o.mimeType??(0,e.k)(o.uri??""),loaderOptions:j,useSRGBBuffer:!!M&&this._parent.useSRGBBuffers},K=new y.b(null,this._babylonScene,k);return K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.push(S.promise),t.push(this.loadImageAsync(`/images/${o.index}`,o).then((D=>{const h=o.uri||`${this._fileName}#image${o.index}`,H=`data:${this._uniqueRootUrl}${h}`;K.updateURL(H,D);const g=K.getInternalTexture();g&&(g.label=o.name)}))),K.wrapU=R.wrapU,K.wrapV=R.wrapV,g(K),this._parent.useGltfTextureNames&&(K.name=o.name||o.uri||`image${o.index}`),Promise.all(t).then((()=>K))}_loadSampler(D,h){return h._data||(h._data={noMipMaps:9728===h.minFilter||9729===h.minFilter,samplingMode:l._GetTextureSamplingMode(D,h),wrapU:l._GetTextureWrapMode(`${D}/wrapS`,h.wrapS),wrapV:l._GetTextureWrapMode(`${D}/wrapT`,h.wrapT)}),h._data}loadImageAsync(D,h){if(!h._data){if(this.logOpen(`${D} ${h.name||""}`),h.uri)h._data=this.loadUriAsync(`${D}/uri`,h,h.uri);else{const o=w.Get(`${D}/bufferView`,this._gltf.bufferViews,h.bufferView);h._data=this.loadBufferViewAsync(`/bufferViews/${o.index}`,o)}this.logClose()}return h._data}loadUriAsync(D,h,o){const H=this._extensionsLoadUriAsync(D,h,o);if(H)return H;if(!l._ValidateUri(o))throw new Error(`${D}: '${o}' is invalid`);if((0,e.l)(o)){const h=new Uint8Array((0,e.e)(o));return this.log(`${D}: Decoded ${o.substring(0,64)}... (${h.length} bytes)`),Promise.resolve(h)}return this.log(`${D}: Loading ${o}`),this._parent.preprocessUrlAsync(this._rootUrl+o).then((h=>new Promise(((H,g)=>{this._parent._loadFile(this._babylonScene,h,(h=>{this._disposed||(this.log(`${D}: Loaded ${o} (${h.byteLength} bytes)`),H(new Uint8Array(h)))}),!0,(h=>{g(new e.o(`${D}: Failed to load '${o}'${h?": "+h.status+" "+h.statusText:""}`,h))}))}))))}static AddPointerMetadata(D,h){D.metadata=D.metadata||{};const o=D._internalMetadata=D._internalMetadata||{},H=o.eh=o.eh||{};(H.pointers=H.pointers||[]).push(h)}static _GetTextureWrapMode(D,h){switch(h=void 0==h?10497:h){case 33071:return y.b.CLAMP_ADDRESSMODE;case 33648:return y.b.MIRROR_ADDRESSMODE;case 10497:return y.b.WRAP_ADDRESSMODE;default:return B.d.Warn(`${D}: Invalid value (${h})`),y.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(D,h){const o=void 0==h.magFilter?9729:h.magFilter,H=void 0==h.minFilter?9987:h.minFilter;if(9729===o)switch(H){case 9728:return y.b.LINEAR_NEAREST;case 9729:return y.b.LINEAR_LINEAR;case 9984:return y.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return y.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return y.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return y.b.LINEAR_LINEAR_MIPLINEAR;default:return B.d.Warn(`${D}/minFilter: Invalid value (${H})`),y.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==o&&B.d.Warn(`${D}/magFilter: Invalid value (${o})`),H){case 9728:return y.b.NEAREST_NEAREST;case 9729:return y.b.NEAREST_LINEAR;case 9984:return y.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return y.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return y.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return y.b.NEAREST_LINEAR_MIPLINEAR;default:return B.d.Warn(`${D}/minFilter: Invalid value (${H})`),y.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(D,h){try{return(0,F.p)(h)}catch(o){throw new Error(`${D}: ${o.message}`)}}static _GetTypedArray(D,h,o,H,g){const j=o.buffer;H=o.byteOffset+(H||0);const M=l._GetTypedArrayConstructor(`${D}/componentType`,h),R=i.f.GetTypeByteLength(h);return H%R!==0?(B.d.Warn(`${D}: Copying buffer as byte offset (${H}) is not a multiple of component type byte length (${R})`),new M(j.slice(H,H+g*R),0)):new M(j,H,g)}static _GetNumComponents(D,h){switch(h){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${D}: Invalid type (${h})`)}static _ValidateUri(D){return M.Tools.IsBase64(D)||-1===D.indexOf("..")}static _GetDrawMode(D,h){switch(void 0==h&&(h=4),h){case 0:return q.c.PointListDrawMode;case 1:return q.c.LineListDrawMode;case 2:return q.c.LineLoopDrawMode;case 3:return q.c.LineStripDrawMode;case 4:return q.c.TriangleFillMode;case 5:return q.c.TriangleStripDrawMode;case 6:return q.c.TriangleFanDrawMode}throw new Error(`${D}: Invalid mesh primitive mode (${h})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const D=new Array;if(this._gltf.materials)for(const h of this._gltf.materials)if(h._data)for(const o in h._data){const H=h._data[o];for(const h of H.babylonMeshes){h.xh(!0);const o=H.babylonMaterial;D.push(o.forceCompilationAsync(h)),D.push(o.forceCompilationAsync(h,{useInstances:!0})),this._parent.useClipPlane&&(D.push(o.forceCompilationAsync(h,{clipPlane:!0})),D.push(o.forceCompilationAsync(h,{clipPlane:!0,useInstances:!0})))}}return Promise.all(D).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const D=new Array,h=this._babylonScene.lights;for(const o of h){const h=o.getShadowGenerator();h&&D.push(h.forceCompilationAsync())}return Promise.all(D).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(D){for(const h of this._extensions)h.enabled&&D(h)}_applyExtensions(D,h,o){for(const H of this._extensions)if(H.enabled){const g=`${H.name}.${h}`,j=D;j._activeLoaderExtensionFunctions=j._activeLoaderExtensionFunctions||{};const M=j._activeLoaderExtensionFunctions;if(!M[g]){M[g]=!0;try{const D=o(H);if(D)return D}finally{delete M[g]}}}return null}_extensionsOnLoading(){this._forEachExtensions((D=>D.onLoading&&D.onLoading()))}_extensionsOnReady(){this._forEachExtensions((D=>D.onReady&&D.onReady()))}_extensionsLoadSceneAsync(D,h){return this._applyExtensions(h,"loadScene",(o=>o.loadSceneAsync&&o.loadSceneAsync(D,h)))}_extensionsLoadNodeAsync(D,h,o){return this._applyExtensions(h,"loadNode",(H=>H.loadNodeAsync&&H.loadNodeAsync(D,h,o)))}_extensionsLoadCameraAsync(D,h,o){return this._applyExtensions(h,"loadCamera",(H=>H.loadCameraAsync&&H.loadCameraAsync(D,h,o)))}_extensionsLoadVertexDataAsync(D,h,o){return this._applyExtensions(h,"loadVertexData",(H=>H._loadVertexDataAsync&&H._loadVertexDataAsync(D,h,o)))}_extensionsLoadMeshPrimitiveAsync(D,h,o,H,g,j){return this._applyExtensions(g,"loadMeshPrimitive",(M=>M._loadMeshPrimitiveAsync&&M._loadMeshPrimitiveAsync(D,h,o,H,g,j)))}_extensionsLoadMaterialAsync(D,h,o,H,g){return this._applyExtensions(h,"loadMaterial",(j=>j._loadMaterialAsync&&j._loadMaterialAsync(D,h,o,H,g)))}_extensionsCreateMaterial(D,h,o){return this._applyExtensions(h,"createMaterial",(H=>H.createMaterial&&H.createMaterial(D,h,o)))}_extensionsLoadMaterialPropertiesAsync(D,h,o){return this._applyExtensions(h,"loadMaterialProperties",(H=>H.loadMaterialPropertiesAsync&&H.loadMaterialPropertiesAsync(D,h,o)))}_extensionsLoadTextureInfoAsync(D,h,o){return this._applyExtensions(h,"loadTextureInfo",(H=>H.loadTextureInfoAsync&&H.loadTextureInfoAsync(D,h,o)))}_extensionsLoadTextureAsync(D,h,o){return this._applyExtensions(h,"loadTexture",(H=>H._loadTextureAsync&&H._loadTextureAsync(D,h,o)))}_extensionsLoadAnimationAsync(D,h){return this._applyExtensions(h,"loadAnimation",(o=>o.loadAnimationAsync&&o.loadAnimationAsync(D,h)))}_extensionsLoadAnimationChannelAsync(D,h,o,H,g){return this._applyExtensions(o,"loadAnimationChannel",(j=>j._loadAnimationChannelAsync&&j._loadAnimationChannelAsync(D,h,o,H,g)))}_extensionsLoadSkinAsync(D,h,o){return this._applyExtensions(o,"loadSkin",(H=>H._loadSkinAsync&&H._loadSkinAsync(D,h,o)))}_extensionsLoadUriAsync(D,h,o){return this._applyExtensions(h,"loadUri",(H=>H._loadUriAsync&&H._loadUriAsync(D,h,o)))}_extensionsLoadBufferViewAsync(D,h){return this._applyExtensions(h,"loadBufferView",(o=>o.loadBufferViewAsync&&o.loadBufferViewAsync(D,h)))}_extensionsLoadBufferAsync(D,h,o,H){return this._applyExtensions(h,"loadBuffer",(g=>g.loadBufferAsync&&g.loadBufferAsync(D,h,o,H)))}static LoadExtensionAsync(D,h,o,H){if(!h.extensions)return null;const g=h.extensions[o];return g?H(`${D}/extensions/${o}`,g):null}static LoadExtraAsync(D,h,o,H){if(!h.extras)return null;const g=h.extras[o];return g?H(`${D}/extras/${o}`,g):null}isExtensionUsed(D){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(D)}logOpen(D){this._parent._logOpen(D)}logClose(){this._parent._logClose()}log(D){this._parent._log(D)}startPerformanceCounter(D){this._parent._startPerformanceCounter(D)}endPerformanceCounter(D){this._parent._endPerformanceCounter(D)}}l.DefaultSampler={index:-1},Z.c._CreateGLTF2Loader=D=>new l(D);var C=o(14317),z=o(13016),f=o(12860),V=o(14323),d=o(14325);class X extends d.e{constructor(D,h,o){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],M=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",D),this._texture=D.getEngine().createRawCubeTexture(h,o,H,g,j,M,R,t)}update(D,h,o,H){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,D,h,o,H,g)}updateRGBDAsync(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,V.m)(this._texture,D,h,o,H).then((()=>{}))}clone(){return f.d.Clone((()=>{const D=this.GD(),h=this._texture,o=new X(D,h._bufferViewArray,h.width,h.format,h.type,h.generateMipMaps,h.invertY,h.samplingMode,h._compression);return 13===h.source&&o.updateRGBDAsync(h._bufferViewArrayArray,h._sphericalPolynomial,h._lodGenerationScale,h._lodGenerationOffset),o}),this)}}const A="EXT_lights_image_based";class W{constructor(D){this.name=A,this._loader=D,this.enabled=this._loader.isExtensionUsed(A)}dispose(){this._loader=null,delete this._lights}onLoading(){const D=this._loader.eh.extensions;if(D&&D[this.name]){const h=D[this.name];this._lights=h.lights}}loadSceneAsync(D,h){return l.LoadExtensionAsync(D,h,this.name,(async(o,H)=>{this._loader._allMaterialsDirtyRequired=!0;const g=new Array;g.push(this._loader.loadSceneAsync(D,h)),this._loader.logOpen(`${o}`);const j=w.Get(`${o}/light`,this._lights,H.Kh);return g.push(this._loadLightAsync(`/extensions/${this.name}/lights/${H.Kh}`,j).then((D=>{this._loader.babylonScene.environmentTexture=D}))),this._loader.logClose(),await Promise.all(g).then((()=>{}))}))}_loadLightAsync(D,h){if(!h._loaded){const o=new Array;this._loader.logOpen(`${D}`);const H=new Array(h.specularImages.length);for(let g=0;g<h.specularImages.length;g++){const j=h.specularImages[g];H[g]=new Array(j.length);for(let h=0;h<j.length;h++){const M=`${D}/specularImages/${g}/${h}`;this._loader.logOpen(`${M}`);const R=j[h],t=w.Get(M,this._loader.eh.images,R);o.push(this._loader.loadImageAsync(`/images/${R}`,t).then((D=>{H[g][h]=D}))),this._loader.logClose()}}this._loader.logClose(),h._loaded=Promise.all(o).then((async()=>{const o=new X(this._loader.babylonScene,null,h.specularImageSize);if(o.name=h.name||"environment",h._babylonTexture=o,void 0!=h.Jg&&(o.level=h.Jg),h.rotation){let D=g.Quaternion.Ih(h.rotation);this._loader.babylonScene.useRightHandedSystem||(D=g.Quaternion.Inverse(D)),g.Matrix.FromQuaternionToRef(D,o.getReflectionTextureMatrix())}if(!h.irradianceCoefficients)throw new Error(`${D}: Irradiance coefficients are missing`);const j=z.c.Ih(h.irradianceCoefficients);j.scaleInPlace(h.Jg),j.convertIrradianceToLambertianRadiance();const M=z.g.FromHarmonics(j),R=(H.length-1)/Math.log2(h.specularImageSize);return await o.updateRGBDAsync(H,M,R)}))}return h._loaded.then((()=>h._babylonTexture))}}I(A),u(A,!0,(D=>new W(D)));o(13406);const x="EXT_mesh_gpu_instancing";class DD{constructor(D){this.name=x,this._loader=D,this.enabled=this._loader.isExtensionUsed(x)}dispose(){this._loader=null}loadNodeAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(D,H)=>{this._loader._disableInstancedMesh++;const j=this._loader.loadNodeAsync(`/nodes/${h.index}`,h,o);if(this._loader._disableInstancedMesh--,!h._primitiveBabylonMeshes)return await j;const M=new Array;let R=0;const t=h=>{if(void 0==H.attributes[h])return void M.push(Promise.resolve(null));const o=w.Get(`${D}/attributes/${h}`,this._loader.eh.accessors,H.attributes[h]);if(M.push(this._loader._loadFloatAccessorAsync(`/accessors/${o.bufferView}`,o)),0===R)R=o.count;else if(R!==o.count)throw new Error(`${D}/attributes: Instance buffer accessors do not have the same count.`)};return t("TRANSLATION"),t("ROTATION"),t("SCALE"),await j.then((async D=>{const[o,H,j]=await Promise.all(M),t=new Float32Array(16*R);g.TmpVectors.Gh[0].Qg(0,0,0),g.TmpVectors.Quaternion[0].Qg(0,0,0,1),g.TmpVectors.Gh[1].Qg(1,1,1);for(let h=0;h<R;++h)o&&g.Gh.FromArrayToRef(o,3*h,g.TmpVectors.Gh[0]),H&&g.Quaternion.FromArrayToRef(H,4*h,g.TmpVectors.Quaternion[0]),j&&g.Gh.FromArrayToRef(j,3*h,g.TmpVectors.Gh[1]),g.Matrix.ComposeToRef(g.TmpVectors.Gh[1],g.TmpVectors.Quaternion[0],g.TmpVectors.Gh[0],g.TmpVectors.Matrix[0]),g.TmpVectors.Matrix[0].copyToArray(t,16*h);for(const g of h._primitiveBabylonMeshes)g.tQ("matrix",t,16,!0);return D}))}))}}I(x),u(x,!0,(D=>new DD(D)));let hD=0,oD=null;class HD{static get Default(){return HD._Default||(HD._Default=new HD),HD._Default}constructor(){const D=HD.Configuration.decoder;this._decoderModulePromise=M.Tools.LoadBabylonScriptAsync(D.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(D,h,o,H,g){await this._decoderModulePromise,0===hD&&(MeshoptDecoder.useWorkers(1),hD=1);const j=await MeshoptDecoder.decodeGltfBufferAsync(h,o,D,H,g);return null!==oD&&clearTimeout(oD),oD=setTimeout((()=>{MeshoptDecoder.useWorkers(0),hD=0,oD=null}),1e3),j}}HD.Configuration={decoder:{url:`${M.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},HD._Default=null;const gD="EXT_meshopt_compression";class jD{constructor(D){this.name=gD,this.enabled=D.isExtensionUsed(gD),this._loader=D}dispose(){this._loader=null}loadBufferViewAsync(D,h){return l.LoadExtensionAsync(D,h,this.name,(async(o,H)=>{const g=h;if(g._meshOptData)return await g._meshOptData;const j=w.Get(`${D}/buffer`,this._loader.eh.buffers,H.buffer);return g._meshOptData=this._loader.loadBufferAsync(`/buffers/${j.index}`,j,H.byteOffset||0,H.byteLength).then((async D=>await HD.Default.decodeGltfBufferAsync(D,H.count,H.byteStride,H.mode,H.filter))),await g._meshOptData}))}}I(gD),u(gD,!0,(D=>new jD(D)));const MD="EXT_texture_webp";class RD{constructor(D){this.name=MD,this._loader=D,this.enabled=D.isExtensionUsed(MD)}dispose(){this._loader=null}_loadTextureAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=void 0==h.sampler?l.DefaultSampler:w.Get(`${D}/sampler`,this._loader.eh.samplers,h.sampler),M=w.Get(`${H}/source`,this._loader.eh.images,g.source);return await this._loader._createTextureAsync(D,j,M,(D=>{o(D)}),void 0,!h._textureInfo.nonColorData)}))}}I(MD),u(MD,!0,(D=>new RD(D)));const tD="EXT_texture_avif";class SD{constructor(D){this.name=tD,this._loader=D,this.enabled=D.isExtensionUsed(tD)}dispose(){this._loader=null}_loadTextureAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=void 0==h.sampler?l.DefaultSampler:w.Get(`${D}/sampler`,this._loader.eh.samplers,h.sampler),M=w.Get(`${H}/source`,this._loader.eh.images,g.source);return await this._loader._createTextureAsync(D,j,M,(D=>{o(D)}),void 0,!h._textureInfo.nonColorData)}))}}I(tD),u(tD,!0,(D=>new SD(D)));var kD=o(14315),KD=o(13392);const QD="EXT_lights_ies";class vD{constructor(D){this.name=QD,this._loader=D,this.enabled=this._loader.isExtensionUsed(QD)}dispose(){this._loader=null,delete this._lights}onLoading(){const D=this._loader.eh.extensions;if(D&&D[this.name]){const h=D[this.name];this._lights=h.lights,w.Assign(this._lights)}}loadNodeAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,M)=>{let R,t;this._loader._allMaterialsDirtyRequired=!0;const S=await this._loader.loadNodeAsync(D,h,(D=>{t=w.Get(H,this._lights,M.Kh);const h=t.name||D.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,R=new kD.e(h,g.Gh.Zero(),g.Gh.Backward(),0,1,this._loader.babylonScene),R.angle=Math.PI/2,R.innerAngle=0,R._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,t._babylonLight=R,R.falloffType=KD.c.FALLOFF_GLTF,R.Og=M.color?j.mo.Ih(M.color):j.mo.White(),R.Jg=M.multiplier||1,R.range=Number.MAX_VALUE,R.parent=D,this._loader._babylonLights.push(R),l.AddPointerMetadata(R,H),o(D)}));let k;if(t.uri)k=await this._loader.loadUriAsync(D,t,t.uri);else{const h=w.Get(`${D}/bufferView`,this._loader.eh.bufferViews,t.bufferView);k=await this._loader.loadBufferViewAsync(`/bufferViews/${h.index}`,h)}return R.iesProfileTexture=new y.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,k,!0,void 0,void 0,void 0,void 0,".ies"),S}))}}I(QD),u(QD,!0,(D=>new vD(D)));var rD=o(14339);const BD="KHR_draco_mesh_compression";class sD{constructor(D){this.name=BD,this.useNormalizedFlagFromAccessor=!0,this._loader=D,this.enabled=rD.e.DefaultAvailable&&this._loader.isExtensionUsed(BD)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{if(void 0!=h.mode&&4!==h.mode&&5!==h.mode)throw new Error(`${D}: Unsupported mode ${h.mode}`);const j={},M={},R=(D,H)=>{const R=g.attributes[D];if(void 0!=R&&(o._delayInfo=o._delayInfo||[],-1===o._delayInfo.indexOf(H)&&o._delayInfo.push(H),j[H]=R,this.useNormalizedFlagFromAccessor)){const o=w.TryGet(this._loader.eh.accessors,h.attributes[D]);o&&(M[H]=o.normalized||!1)}};R("POSITION",i.f.PositionKind),R("NORMAL",i.f.NormalKind),R("TANGENT",i.f.TangentKind),R("TEXCOORD_0",i.f.UVKind),R("TEXCOORD_1",i.f.UV2Kind),R("TEXCOORD_2",i.f.UV3Kind),R("TEXCOORD_3",i.f.UV4Kind),R("TEXCOORD_4",i.f.UV5Kind),R("TEXCOORD_5",i.f.UV6Kind),R("JOINTS_0",i.f.MatricesIndicesKind),R("WEIGHTS_0",i.f.MatricesWeightsKind),R("COLOR_0",i.f.ColorKind);const t=w.Get(H,this._loader.eh.bufferViews,g.bufferView);return t._dracoBabylonGeometry||(t._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${t.index}`,t).then((async H=>{const g=this.dracoDecoder||rD.e.Default,R=w.TryGet(this._loader.eh.accessors,h.attributes.POSITION),t=this._loader.parent.alwaysComputeBoundingBox||o.skeleton||!R?null:Y(R);return await g._decodeMeshToGeometryForGltfAsync(o.name,this._loader.babylonScene,H,j,M,t).catch((h=>{throw new Error(`${D}: ${h.message}`)}))}))),await t._dracoBabylonGeometry}))}}I(BD),u(BD,!0,(D=>new sD(D)));var UD=o(14345),qD=o(12812),cD=o(12815),yD=o(13258),bD=o(13439),iD=o(12793);yD.c.AddNodeConstructor("Light_Type_0",((D,h)=>()=>new GD(D,g.Gh.Zero(),h)));class GD extends bD.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(D){this._shadowAngle=D,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(D){const h=this.needCube();if(this._direction=D,this.needCube()!==h&&this._shadowGenerators){const D=this._shadowGenerators.values();for(let h=D.next();!0!==h.done;h=D.next()){h.value.recreateShadowMap()}}}constructor(D,h,o){super(D,o),this._shadowAngle=Math.PI/2,this.position=h}getClassName(){return"PointLight"}getTypeID(){return KD.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(D){if(this.direction)return super.getShadowDirection(D);switch(D){case 0:return new g.Gh(1,0,0);case 1:return new g.Gh(-1,0,0);case 2:return new g.Gh(0,-1,0);case 3:return new g.Gh(0,1,0);case 4:return new g.Gh(0,0,1);case 5:return new g.Gh(0,0,-1)}return g.Gh.Zero()}_setDefaultShadowProjectionMatrix(D,h,o){const H=this.GD().activeCamera;if(!H)return;const j=void 0!==this.shadowMinZ?this.shadowMinZ:H.Xh,M=void 0!==this.shadowMaxZ?this.shadowMaxZ:H.maxZ,R=this.GD().getEngine().Bh;g.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,R?M:j,R?j:M,D,!0,this._scene.getEngine().isNDCHalfZRange,void 0,R)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(D,h){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,h):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,h),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,h),this}transferToNodeMaterialEffect(D,h){return this.computeTransformedInformation()?D.setFloat3(h,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):D.setFloat3(h,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(D,h){D["POINTLIGHT"+h]=!0}}(0,qD.c)([(0,cD.I)()],GD.prototype,"shadowAngle",null),(0,iD.g)("BABYLON.PointLight",GD);const ND="KHR_lights_punctual";class JD{constructor(D){this.name=ND,this._loader=D,this.enabled=this._loader.isExtensionUsed(ND)}dispose(){this._loader=null,delete this._lights}onLoading(){const D=this._loader.eh.extensions;if(D&&D[this.name]){const h=D[this.name];this._lights=h.lights,w.Assign(this._lights)}}loadNodeAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,M)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(D,h,(D=>{let h;const R=w.Get(H,this._lights,M.Kh),t=R.name||D.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,R.type){case"directional":{const D=new UD.c(t,g.Gh.Backward(),this._loader.babylonScene);D.position.qg(0),h=D;break}case"point":h=new GD(t,g.Gh.Zero(),this._loader.babylonScene);break;case"spot":{const D=new kD.e(t,g.Gh.Zero(),g.Gh.Backward(),0,1,this._loader.babylonScene);D.angle=2*(R.spot&&R.spot.outerConeAngle||Math.PI/4),D.innerAngle=2*(R.spot&&R.spot.innerConeAngle||0),h=D;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${H}: Invalid light type (${R.type})`)}h._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,R._babylonLight=h,h.falloffType=KD.c.FALLOFF_GLTF,h.Og=R.color?j.mo.Ih(R.color):j.mo.White(),h.Jg=void 0==R.Jg?1:R.Jg,h.range=void 0==R.range?Number.MAX_VALUE:R.range,h.parent=D,this._loader._babylonLights.push(h),l.AddPointerMetadata(h,H),o(D)})))))}}I(ND),u(ND,!0,(D=>new JD(D)));const OD="KHR_materials_pbrSpecularGlossiness";class ED{constructor(D){this.name=OD,this.order=200,this._loader=D,this.enabled=this._loader.isExtensionUsed(OD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=new Array;return j.push(this._loader.loadMaterialBasePropertiesAsync(D,h,o)),j.push(this._loadSpecularGlossinessPropertiesAsync(H,g,o)),this._loader.loadMaterialAlphaProperties(D,h,o),await Promise.all(j).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(D,h,o){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);const H=new Array;return o.metallic=null,o.roughness=null,h.diffuseFactor?(o.albedoColor=j.mo.Ih(h.diffuseFactor),o.alpha=h.diffuseFactor[3]):o.albedoColor=j.mo.White(),o.reflectivityColor=h.specularFactor?j.mo.Ih(h.specularFactor):j.mo.White(),o.microSurface=void 0==h.glossinessFactor?1:h.glossinessFactor,h.diffuseTexture&&H.push(this._loader.loadTextureInfoAsync(`${D}/diffuseTexture`,h.diffuseTexture,(D=>{D.name=`${o.name} (Diffuse)`,o.albedoTexture=D}))),h.specularGlossinessTexture&&(H.push(this._loader.loadTextureInfoAsync(`${D}/specularGlossinessTexture`,h.specularGlossinessTexture,(D=>{D.name=`${o.name} (Specular Glossiness)`,o.reflectivityTexture=D,o.reflectivityTexture.Yh=!0}))),o.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(H).then((()=>{}))}}I(OD),u(OD,!0,(D=>new ED(D)));const LD="KHR_materials_unlit";class TD{constructor(D){this.name=LD,this.order=210,this._loader=D,this.enabled=this._loader.isExtensionUsed(LD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async()=>await this._loadUnlitPropertiesAsync(D,h,o)))}_loadUnlitPropertiesAsync(D,h,o){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);const H=new Array;o.unlit=!0;const g=h.pbrMetallicRoughness;return g&&(g.baseColorFactor?(o.albedoColor=j.mo.Ih(g.baseColorFactor),o.alpha=g.baseColorFactor[3]):o.albedoColor=j.mo.White(),g.baseColorTexture&&H.push(this._loader.loadTextureInfoAsync(`${D}/baseColorTexture`,g.baseColorTexture,(D=>{D.name=`${o.name} (Base Color)`,o.albedoTexture=D})))),h.doubleSided&&(o.Mg=!1,o.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(D,h,o),Promise.all(H).then((()=>{}))}}I(LD),u(LD,!0,(D=>new TD(D)));const ZD="KHR_materials_clearcoat";class eD{constructor(D){this.name=ZD,this.order=190,this._loader=D,this.enabled=this._loader.isExtensionUsed(ZD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=new Array;j.push(this._loader.loadMaterialPropertiesAsync(D,h,o)),j.push(this._loadClearCoatPropertiesAsync(H,g,o)),await Promise.all(j)}))}_loadClearCoatPropertiesAsync(D,h,o){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);const H=new Array;return o.clearCoat.isEnabled=!0,o.clearCoat.useRoughnessFromMainTexture=!1,o.clearCoat.remapF0OnInterfaceChange=!1,void 0!=h.clearcoatFactor?o.clearCoat.Jg=h.clearcoatFactor:o.clearCoat.Jg=0,h.clearcoatTexture&&H.push(this._loader.loadTextureInfoAsync(`${D}/clearcoatTexture`,h.clearcoatTexture,(D=>{D.name=`${o.name} (ClearCoat)`,o.clearCoat.texture=D}))),void 0!=h.clearcoatRoughnessFactor?o.clearCoat.roughness=h.clearcoatRoughnessFactor:o.clearCoat.roughness=0,h.clearcoatRoughnessTexture&&(h.clearcoatRoughnessTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${D}/clearcoatRoughnessTexture`,h.clearcoatRoughnessTexture,(D=>{D.name=`${o.name} (ClearCoat Roughness)`,o.clearCoat.textureRoughness=D})))),h.clearcoatNormalTexture&&(h.clearcoatNormalTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${D}/clearcoatNormalTexture`,h.clearcoatNormalTexture,(D=>{D.name=`${o.name} (ClearCoat Normal)`,o.clearCoat.bumpTexture=D}))),o.invertNormalMapX=!o.GD().useRightHandedSystem,o.invertNormalMapY=o.GD().useRightHandedSystem,void 0!=h.clearcoatNormalTexture.scale&&(o.clearCoat.bumpTexture.level=h.clearcoatNormalTexture.scale)),Promise.all(H).then((()=>{}))}}I(ZD),u(ZD,!0,(D=>new eD(D)));const pD="KHR_materials_iridescence";class mh{constructor(D){this.name=pD,this.order=195,this._loader=D,this.enabled=this._loader.isExtensionUsed(pD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(D,h,o)),j.push(this._loadIridescencePropertiesAsync(H,g,o)),await Promise.all(j).then((()=>{}))}))}_loadIridescencePropertiesAsync(D,h,o){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);const H=new Array;return o.iridescence.isEnabled=!0,o.iridescence.Jg=h.iridescenceFactor??0,o.iridescence.indexOfRefraction=h.iridescenceIor??h.iridescenceIOR??1.3,o.iridescence.minimumThickness=h.iridescenceThicknessMinimum??100,o.iridescence.maximumThickness=h.iridescenceThicknessMaximum??400,h.iridescenceTexture&&H.push(this._loader.loadTextureInfoAsync(`${D}/iridescenceTexture`,h.iridescenceTexture,(D=>{D.name=`${o.name} (Iridescence)`,o.iridescence.texture=D}))),h.iridescenceThicknessTexture&&H.push(this._loader.loadTextureInfoAsync(`${D}/iridescenceThicknessTexture`,h.iridescenceThicknessTexture,(D=>{D.name=`${o.name} (Iridescence Thickness)`,o.iridescence.thicknessTexture=D}))),Promise.all(H).then((()=>{}))}}I(pD),u(pD,!0,(D=>new mh(D)));const aD="KHR_materials_anisotropy";class uD{constructor(D){this.name=aD,this.order=195,this._loader=D,this.enabled=this._loader.isExtensionUsed(aD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=new Array;j.push(this._loader.loadMaterialPropertiesAsync(D,h,o)),j.push(this._loadIridescencePropertiesAsync(H,g,o)),await Promise.all(j)}))}async _loadIridescencePropertiesAsync(D,h,o){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);const H=new Array;o.anisotropy.isEnabled=!0,o.anisotropy.Jg=h.anisotropyStrength??0,o.anisotropy.angle=h.anisotropyRotation??0,h.anisotropyTexture&&(h.anisotropyTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${D}/anisotropyTexture`,h.anisotropyTexture,(D=>{D.name=`${o.name} (Anisotropy Intensity)`,o.anisotropy.texture=D})))),await Promise.all(H)}}I(aD),u(aD,!0,(D=>new uD(D)));const ID="KHR_materials_emissive_strength";class PD{constructor(D){this.name=ID,this.order=170,this._loader=D,this.enabled=this._loader.isExtensionUsed(ID)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>await this._loader.loadMaterialPropertiesAsync(D,h,o).then((()=>{this._loadEmissiveProperties(H,g,o)}))))}_loadEmissiveProperties(D,h,o){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);void 0!==h.emissiveStrength&&(o.emissiveIntensity=h.emissiveStrength)}}I(ID),u(ID,!0,(D=>new PD(D)));const nD="KHR_materials_sheen";class FD{constructor(D){this.name=nD,this.order=190,this._loader=D,this.enabled=this._loader.isExtensionUsed(nD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(D,h,o)),j.push(this._loadSheenPropertiesAsync(H,g,o)),await Promise.all(j).then((()=>{}))}))}_loadSheenPropertiesAsync(D,h,o){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);const H=new Array;return o.sheen.isEnabled=!0,o.sheen.Jg=1,void 0!=h.sheenColorFactor?o.sheen.color=j.mo.Ih(h.sheenColorFactor):o.sheen.color=j.mo.Black(),h.sheenColorTexture&&H.push(this._loader.loadTextureInfoAsync(`${D}/sheenColorTexture`,h.sheenColorTexture,(D=>{D.name=`${o.name} (Sheen Color)`,o.sheen.texture=D}))),void 0!==h.sheenRoughnessFactor?o.sheen.roughness=h.sheenRoughnessFactor:o.sheen.roughness=0,h.sheenRoughnessTexture&&(h.sheenRoughnessTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${D}/sheenRoughnessTexture`,h.sheenRoughnessTexture,(D=>{D.name=`${o.name} (Sheen Roughness)`,o.sheen.textureRoughness=D})))),o.sheen.albedoScaling=!0,o.sheen.useRoughnessFromMainTexture=!1,Promise.all(H).then((()=>{}))}}I(nD),u(nD,!0,(D=>new FD(D)));var wD=o(13325);const YD="KHR_materials_specular";class lD{constructor(D){this.name=YD,this.order=190,this._loader=D,this.enabled=this._loader.isExtensionUsed(YD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=new Array;if(j.push(this._loader.loadMaterialPropertiesAsync(D,h,o)),j.push(this._loadSpecularPropertiesAsync(H,g,o)),g.extensions&&g.extensions.EXT_materials_specular_edge_color&&o instanceof c.b){g.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(o.brdf.dielectricSpecularModel=wD.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,o.brdf.conductorSpecularModel=wD.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(j).then((()=>{}))}))}_loadSpecularPropertiesAsync(D,h,o){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);const H=new Array;return void 0!==h.specularFactor&&(o.metallicF0Factor=h.specularFactor),void 0!==h.specularColorFactor&&(o.metallicReflectanceColor=j.mo.Ih(h.specularColorFactor)),h.specularTexture&&(h.specularTexture.nonColorData=!0,H.push(this._loader.loadTextureInfoAsync(`${D}/specularTexture`,h.specularTexture,(D=>{D.name=`${o.name} (Specular)`,o.metallicReflectanceTexture=D,o.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),h.specularColorTexture&&H.push(this._loader.loadTextureInfoAsync(`${D}/specularColorTexture`,h.specularColorTexture,(D=>{D.name=`${o.name} (Specular Color)`,o.reflectanceTexture=D}))),Promise.all(H).then((()=>{}))}}I(YD),u(YD,!0,(D=>new lD(D)));const CD="KHR_materials_ior";class zD{constructor(D){this.name=CD,this.order=180,this._loader=D,this.enabled=this._loader.isExtensionUsed(CD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(D,h,o)),j.push(this._loadIorPropertiesAsync(H,g,o)),await Promise.all(j).then((()=>{}))}))}_loadIorPropertiesAsync(D,h,o){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);return void 0!==h.ior?o.indexOfRefraction=h.ior:o.indexOfRefraction=zD._DEFAULT_IOR,Promise.resolve()}}zD._DEFAULT_IOR=1.5,I(CD),u(CD,!0,(D=>new zD(D)));const fD="KHR_materials_variants";class VD{constructor(D){this.name=fD,this._loader=D,this.enabled=this._loader.isExtensionUsed(fD)}dispose(){this._loader=null}static GetAvailableVariants(D){const h=this._GetExtensionMetadata(D);return h?Object.keys(h.variants):[]}getAvailableVariants(D){return VD.GetAvailableVariants(D)}static SelectVariant(D,h){const o=this._GetExtensionMetadata(D);if(!o)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${fD} extension`);const H=D=>{const h=o.variants[D];if(h)for(const o of h)o.mesh.material=o.material};if(h instanceof Array)for(const g of h)H(g);else H(h);o.lastSelected=h}selectVariant(D,h){VD.SelectVariant(D,h)}static Reset(D){const h=this._GetExtensionMetadata(D);if(!h)throw new Error(`Cannot reset on a glTF mesh that does not have the ${fD} extension`);for(const o of h.original)o.mesh.material=o.material;h.lastSelected=null}reset(D){VD.Reset(D)}static GetLastSelectedVariant(D){const h=this._GetExtensionMetadata(D);if(!h)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${fD} extension`);return h.lastSelected}getLastSelectedVariant(D){return VD.GetLastSelectedVariant(D)}static _GetExtensionMetadata(D){var h,o;return(null===D||void 0===D||null===(h=D._internalMetadata)||void 0===h||null===(o=h.eh)||void 0===o?void 0:o[fD])||null}onLoading(){const D=this._loader.eh.extensions;if(D&&D[this.name]){const h=D[this.name];this._variants=h.variants}}onReady(){const D=this._loader.rootBabylonMesh;if(D){var h;const o=this._loader.parent.extensionOptions[fD];null!==o&&void 0!==o&&o.defaultVariant&&VD.SelectVariant(D,o.defaultVariant),null===o||void 0===o||null===(h=o.onLoaded)||void 0===h||h.call(o,{get variants(){return VD.GetAvailableVariants(D)},get selectedVariant(){const h=VD.GetLastSelectedVariant(D);return h?Array.isArray(h)?h[0]:h:VD.GetAvailableVariants(D)[0]},set selectedVariant(h){VD.SelectVariant(D,h)}})}}_loadMeshPrimitiveAsync(D,h,o,H,g,j){return l.LoadExtensionAsync(D,g,this.name,(async(M,R)=>{const t=new Array;return t.push(this._loader._loadMeshPrimitiveAsync(D,h,o,H,g,(h=>{if(j(h),h instanceof J.d){const o=l._GetDrawMode(D,g.mode),H=this._loader.rootBabylonMesh,j=H?H._internalMetadata=H._internalMetadata||{}:{},S=j.eh=j.eh||{},k=S[fD]=S[fD]||{lastSelected:null,original:[],variants:{}};k.original.push({mesh:h,material:h.material});for(let D=0;D<R.mappings.length;++D){const g=R.mappings[D],j=w.Get(`${M}/mappings/${D}/material`,this._loader.eh.materials,g.material);t.push(this._loader._loadMaterialAsync(`#/materials/${g.material}`,j,h,o,(D=>{for(let o=0;o<g.variants.length;++o){const j=g.variants[o],M=w.Get(`/extensions/${fD}/variants/${j}`,this._variants,j);k.variants[M.name]=k.variants[M.name]||[],k.variants[M.name].push({mesh:h,material:D}),h.onClonedObservable.add((D=>{const o=D;let g=null,j=o;do{if(j=j.parent,!j)return;g=VD._GetExtensionMetadata(j)}while(null===g);if(H&&g===VD._GetExtensionMetadata(H)){j._internalMetadata={};for(const D in H._internalMetadata)j._internalMetadata[D]=H._internalMetadata[D];j._internalMetadata.eh=[];for(const D in H._internalMetadata.eh)j._internalMetadata.eh[D]=H._internalMetadata.eh[D];j._internalMetadata.eh[fD]={lastSelected:null,original:[],variants:{}};for(const D of g.original)j._internalMetadata.eh[fD].original.push({mesh:D.mesh,material:D.material});for(const D in g.variants)if(Object.prototype.hasOwnProperty.call(g.variants,D)){j._internalMetadata.eh[fD].variants[D]=[];for(const h of g.variants[D])j._internalMetadata.eh[fD].variants[D].push({mesh:h.mesh,material:h.material})}g=j._internalMetadata.eh[fD]}for(const H of g.original)H.mesh===h&&(H.mesh=o);for(const H of g.variants[M.name])H.mesh===h&&(H.mesh=o)}))}})))}}}))),await Promise.all(t).then((D=>{let[h]=D;return h}))}))}}I(fD),u(fD,!0,(D=>new VD(D)));var dD=o(12885);class XD{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:wD.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(D,h){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...XD._GetDefaultOptions(),...D},this._scene=h,this._scene._transmissionHelper=this,this.onErrorObservable=new k.c,this._scene.Jh.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(D){if(!Object.keys(D).filter((h=>this._options[h]!==D[h])).length)return;const h={...this._options,...D},o=this._options;this._options=h,h.renderSize===o.renderSize&&h.renderTargetTextureType===o.renderTargetTextureType&&h.generateMipmaps===o.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=h.samples,this._opaqueRenderTarget.lodGenerationScale=h.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=h.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(D){return!!D&&!!(D instanceof c.b&&D.subSurface.isRefractionEnabled)}_addMesh(D){this._materialObservers[D.uniqueId]=D.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),M.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(D.material)?(D.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(D)&&this._transparentMeshesCache.push(D)):-1===this._opaqueMeshesCache.indexOf(D)&&this._opaqueMeshesCache.push(D)}))}_removeMesh(D){D.onMaterialChangedObservable.remove(this._materialObservers[D.uniqueId]),delete this._materialObservers[D.uniqueId];let h=this._transparentMeshesCache.indexOf(D);-1!==h&&this._transparentMeshesCache.splice(h,1),h=this._opaqueMeshesCache.indexOf(D),-1!==h&&this._opaqueMeshesCache.splice(h,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(D){const h=this._transparentMeshesCache.indexOf(D),o=this._opaqueMeshesCache.indexOf(D);this._shouldRenderAsTransmission(D.material)?(D.material instanceof c.b&&(D.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==o?(this._opaqueMeshesCache.splice(o,1),this._transparentMeshesCache.push(D)):-1===h&&this._transparentMeshesCache.push(D)):-1!==h?(this._transparentMeshesCache.splice(h,1),this._opaqueMeshesCache.push(D)):-1===o&&this._opaqueMeshesCache.push(D)}_isRenderTargetValid(){var D;return null!==(null===(D=this._opaqueRenderTarget)||void 0===D?void 0:D.getInternalTexture())}_setupRenderTargets(){var D;let h;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new dD.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(D=this._options.clearColor)||void 0===D?void 0:D.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((D=>{h=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?D.clearColor.M(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(D.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=h}));for(const o of this._transparentMeshesCache)this._shouldRenderAsTransmission(o.material)&&(o.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const AD="KHR_materials_transmission";class WD{constructor(D){this.name=AD,this.order=175,this._loader=D,this.enabled=this._loader.isExtensionUsed(AD),this.enabled&&(D.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(D,h,o)),j.push(this._loadTransparentPropertiesAsync(H,h,o,g)),await Promise.all(j).then((()=>{}))}))}_loadTransparentPropertiesAsync(D,h,o,H){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);const g=o;if(g.subSurface.isRefractionEnabled=!0,g.subSurface.volumeIndexOfRefraction=1,g.subSurface.useAlbedoToTintRefraction=!0,void 0===H.transmissionFactor)return g.subSurface.refractionIntensity=0,g.subSurface.isRefractionEnabled=!1,Promise.resolve();{var j;g.subSurface.refractionIntensity=H.transmissionFactor;const D=g.GD();if(g.subSurface.refractionIntensity&&!D._transmissionHelper)new XD({},g.GD());else if(g.subSurface.refractionIntensity&&(null===(j=D._transmissionHelper)||void 0===j||!j._isRenderTargetValid())){var M;null===(M=D._transmissionHelper)||void 0===M||M._setupRenderTargets()}}return g.subSurface.minimumThickness=0,g.subSurface.maximumThickness=0,H.transmissionTexture?(H.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${D}/transmissionTexture`,H.transmissionTexture,void 0).then((D=>{D.name=`${o.name} (Transmission)`,g.subSurface.refractionIntensityTexture=D,g.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}I(AD),u(AD,!0,(D=>new WD(D)));const xD="KHR_materials_diffuse_transmission";class Dh{constructor(D){this.name=xD,this.order=174,this._loader=D,this.enabled=this._loader.isExtensionUsed(xD),this.enabled&&(D.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(D,h,o)),j.push(this._loadTranslucentPropertiesAsync(H,h,o,g)),await Promise.all(j).then((()=>{}))}))}_loadTranslucentPropertiesAsync(D,h,o,H){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);const g=o;if(g.subSurface.isTranslucencyEnabled=!0,g.subSurface.volumeIndexOfRefraction=1,g.subSurface.minimumThickness=0,g.subSurface.maximumThickness=0,g.subSurface.useAlbedoToTintTranslucency=!1,void 0===H.diffuseTransmissionFactor)return g.subSurface.translucencyIntensity=0,g.subSurface.isTranslucencyEnabled=!1,Promise.resolve();g.subSurface.translucencyIntensity=H.diffuseTransmissionFactor;const M=new Array;return g.subSurface.useGltfStyleTextures=!0,H.diffuseTransmissionTexture&&(H.diffuseTransmissionTexture.nonColorData=!0,M.push(this._loader.loadTextureInfoAsync(`${D}/diffuseTransmissionTexture`,H.diffuseTransmissionTexture).then((D=>{D.name=`${o.name} (Diffuse Transmission)`,g.subSurface.translucencyIntensityTexture=D})))),void 0!==H.diffuseTransmissionColorFactor?g.subSurface.translucencyColor=j.mo.Ih(H.diffuseTransmissionColorFactor):g.subSurface.translucencyColor=j.mo.White(),H.diffuseTransmissionColorTexture&&M.push(this._loader.loadTextureInfoAsync(`${D}/diffuseTransmissionColorTexture`,H.diffuseTransmissionColorTexture).then((D=>{D.name=`${o.name} (Diffuse Transmission Color)`,g.subSurface.translucencyColorTexture=D}))),Promise.all(M).then((()=>{}))}}I(xD),u(xD,!0,(D=>new Dh(D)));const hh="KHR_materials_volume";class oh{constructor(D){this.name=hh,this.order=173,this._loader=D,this.enabled=this._loader.isExtensionUsed(hh),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(D,h,o)),j.push(this._loadVolumePropertiesAsync(H,h,o,g)),await Promise.all(j).then((()=>{}))}))}_loadVolumePropertiesAsync(D,h,o,H){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);if(!o.subSurface.isRefractionEnabled&&!o.subSurface.isTranslucencyEnabled||!H.thicknessFactor)return Promise.resolve();o.subSurface.volumeIndexOfRefraction=o.indexOfRefraction;const g=void 0!==H.attenuationDistance?H.attenuationDistance:Number.MAX_VALUE;return o.subSurface.tintColorAtDistance=g,void 0!==H.attenuationColor&&3==H.attenuationColor.length&&o.subSurface.tintColor.Qg(H.attenuationColor[0],H.attenuationColor[1],H.attenuationColor[2]),o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=H.thicknessFactor,o.subSurface.useThicknessAsDepth=!0,H.thicknessTexture?(H.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${D}/thicknessTexture`,H.thicknessTexture).then((D=>{D.name=`${o.name} (Thickness)`,o.subSurface.thicknessTexture=D,o.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}I(hh),u(hh,!0,(D=>new oh(D)));const Hh="KHR_materials_dispersion";class gh{constructor(D){this.name=Hh,this.order=174,this._loader=D,this.enabled=this._loader.isExtensionUsed(Hh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(D,h,o)),j.push(this._loadDispersionPropertiesAsync(H,h,o,g)),await Promise.all(j).then((()=>{}))}))}_loadDispersionPropertiesAsync(D,h,o,H){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);return o.subSurface.isRefractionEnabled&&H.dispersion?(o.subSurface.isDispersionEnabled=!0,o.subSurface.dispersion=H.dispersion,Promise.resolve()):Promise.resolve()}}I(Hh),u(Hh,!0,(D=>new gh(D)));const jh="EXT_materials_diffuse_roughness";class Mh{constructor(D){this.name=jh,this.order=190,this._loader=D,this.enabled=this._loader.isExtensionUsed(jh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(D,h,o)),j.push(this._loadDiffuseRoughnessPropertiesAsync(H,g,o)),await Promise.all(j).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(D,h,o){if(!(o instanceof c.b))throw new Error(`${D}: Material type not supported`);const H=new Array;return o.brdf.baseDiffuseModel=wD.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=h.diffuseRoughnessFactor?o.baseDiffuseRoughness=h.diffuseRoughnessFactor:o.baseDiffuseRoughness=0,h.diffuseRoughnessTexture&&H.push(this._loader.loadTextureInfoAsync(`${D}/diffuseRoughnessTexture`,h.diffuseRoughnessTexture,(D=>{D.name=`${o.name} (Diffuse Roughness)`,o.baseDiffuseRoughnessTexture=D}))),Promise.all(H).then((()=>{}))}}I(jh),u(jh,!0,(D=>new Mh(D)));const Rh="KHR_mesh_quantization";class th{constructor(D){this.name=Rh,this.enabled=D.isExtensionUsed(Rh)}dispose(){}}I(Rh),u(Rh,!0,(D=>new th(D)));const Sh="KHR_texture_basisu";class kh{constructor(D){this.name=Sh,this._loader=D,this.enabled=D.isExtensionUsed(Sh)}dispose(){this._loader=null}_loadTextureAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>{const j=void 0==h.sampler?l.DefaultSampler:w.Get(`${D}/sampler`,this._loader.eh.samplers,h.sampler),M=w.Get(`${H}/source`,this._loader.eh.images,g.source);return await this._loader._createTextureAsync(D,j,M,(D=>{o(D)}),h._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!h._textureInfo.nonColorData)}))}}I(Sh),u(Sh,!0,(D=>new kh(D)));const Kh="KHR_texture_transform";class Qh{constructor(D){this.name=Kh,this._loader=D,this.enabled=this._loader.isExtensionUsed(Kh)}dispose(){this._loader=null}loadTextureInfoAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(H,g)=>await this._loader.loadTextureInfoAsync(D,h,(D=>{if(!(D instanceof y.b))throw new Error(`${H}: Texture type not supported`);g.offset&&(D.uOffset=g.offset[0],D.vOffset=g.offset[1]),D.uRotationCenter=0,D.vRotationCenter=0,g.rotation&&(D.wAng=-g.rotation),g.scale&&(D.uScale=g.scale[0],D.vScale=g.scale[1]),void 0!=g.texCoord&&(D.coordinatesIndex=g.texCoord),o(D)}))))}}I(Kh),u(Kh,!0,(D=>new Qh(D)));const vh="KHR_xmp_json_ld";class rh{constructor(D){this.name=vh,this.order=100,this._loader=D,this.enabled=this._loader.isExtensionUsed(vh)}dispose(){this._loader=null}onLoading(){var D,h,o;if(null===this._loader.rootBabylonMesh)return;const H=null===(D=this._loader.eh.extensions)||void 0===D?void 0:D.KHR_xmp_json_ld,g=null===(h=this._loader.eh.asset)||void 0===h||null===(o=h.extensions)||void 0===o?void 0:o.KHR_xmp_json_ld;if(H&&g){const D=+g.packet;H.packets&&D<H.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=H.packets[D])}}}function Bh(D,h,o,H){return j.mo.Ih(h,o).scale(H)}function sh(D,h,o,H){return h[o]*H}function Uh(D,h,o,H){return-h[o]*H}function qh(D,h,o,H){return h[o+1]*H}function ch(D,h,o,H){return h[o]*H*2}function yh(D){return{scale:[new ih(Q.e.ANIMATIONTYPE_FLOAT,`${D}.uScale`,sh,(()=>2)),new ih(Q.e.ANIMATIONTYPE_FLOAT,`${D}.vScale`,qh,(()=>2))],offset:[new ih(Q.e.ANIMATIONTYPE_FLOAT,`${D}.uOffset`,sh,(()=>2)),new ih(Q.e.ANIMATIONTYPE_FLOAT,`${D}.vOffset`,qh,(()=>2))],rotation:[new ih(Q.e.ANIMATIONTYPE_FLOAT,`${D}.wAng`,Uh,(()=>1))]}}I(vh),u(vh,!0,(D=>new rh(D)));class bh extends C.AnimationPropertyInfo{buildAnimations(D,h,o,H){return[{babylonAnimatable:D._babylonCamera,babylonAnimation:this._buildAnimation(h,o,H)}]}}class ih extends C.AnimationPropertyInfo{buildAnimations(D,h,o,H){const g=[];for(const j in D._data)g.push({babylonAnimatable:D._data[j].babylonMaterial,babylonAnimation:this._buildAnimation(h,o,H)});return g}}class Gh extends C.AnimationPropertyInfo{buildAnimations(D,h,o,H){return[{babylonAnimatable:D._babylonLight,babylonAnimation:this._buildAnimation(h,o,H)}]}}(0,P.l)("/cameras/{}/orthographic/xmag",[new bh(Q.e.ANIMATIONTYPE_FLOAT,"orthoLeft",Uh,(()=>1)),new bh(Q.e.ANIMATIONTYPE_FLOAT,"orthoRight",qh,(()=>1))]),(0,P.l)("/cameras/{}/orthographic/ymag",[new bh(Q.e.ANIMATIONTYPE_FLOAT,"orthoBottom",Uh,(()=>1)),new bh(Q.e.ANIMATIONTYPE_FLOAT,"orthoTop",qh,(()=>1))]),(0,P.l)("/cameras/{}/orthographic/zfar",[new bh(Q.e.ANIMATIONTYPE_FLOAT,"maxZ",sh,(()=>1))]),(0,P.l)("/cameras/{}/orthographic/znear",[new bh(Q.e.ANIMATIONTYPE_FLOAT,"Xh",sh,(()=>1))]),(0,P.l)("/cameras/{}/perspective/yfov",[new bh(Q.e.ANIMATIONTYPE_FLOAT,"fov",sh,(()=>1))]),(0,P.l)("/cameras/{}/perspective/zfar",[new bh(Q.e.ANIMATIONTYPE_FLOAT,"maxZ",sh,(()=>1))]),(0,P.l)("/cameras/{}/perspective/znear",[new bh(Q.e.ANIMATIONTYPE_FLOAT,"Xh",sh,(()=>1))]),(0,P.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new ih(Q.e.ANIMATIONTYPE_COLOR3,"albedoColor",Bh,(()=>4)),new ih(Q.e.ANIMATIONTYPE_FLOAT,"alpha",(function(D,h,o,H){return h[o+3]*H}),(()=>4))]),(0,P.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"metallic",sh,(()=>1))]),(0,P.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"roughness",sh,(()=>1))]);const Nh=yh("albedoTexture");(0,P.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Nh.scale),(0,P.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Nh.offset),(0,P.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Nh.rotation);const Jh=yh("metallicTexture");(0,P.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Jh.scale),(0,P.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Jh.offset),(0,P.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Jh.rotation),(0,P.l)("/materials/{}/emissiveFactor",[new ih(Q.e.ANIMATIONTYPE_COLOR3,"emissiveColor",Bh,(()=>3))]);const Oh=yh("bumpTexture");(0,P.l)("/materials/{}/normalTexture/scale",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",sh,(()=>1))]),(0,P.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Oh.scale),(0,P.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Oh.offset),(0,P.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Oh.rotation),(0,P.l)("/materials/{}/occlusionTexture/strength",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",sh,(()=>1))]);const Eh=yh("ambientTexture");(0,P.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Eh.scale),(0,P.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Eh.offset),(0,P.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Eh.rotation);const Lh=yh("emissiveTexture");(0,P.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Lh.scale),(0,P.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Lh.offset),(0,P.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Lh.rotation),(0,P.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",sh,(()=>1))]),(0,P.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",sh,(()=>1))]);const Th=yh("anisotropy.texture");(0,P.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Th.scale),(0,P.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Th.offset),(0,P.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Th.rotation),(0,P.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",sh,(()=>1))]),(0,P.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",sh,(()=>1))]);const Zh=yh("clearCoat.texture");(0,P.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Zh.scale),(0,P.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Zh.offset),(0,P.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Zh.rotation);const eh=yh("clearCoat.bumpTexture");(0,P.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",sh,(()=>1))]),(0,P.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",eh.scale),(0,P.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",eh.offset),(0,P.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",eh.rotation);const ph=yh("clearCoat.textureRoughness");(0,P.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",ph.scale),(0,P.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",ph.offset),(0,P.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",ph.rotation),(0,P.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",sh,(()=>1))]),(0,P.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",sh,(()=>1))]),(0,P.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",sh,(()=>1))]),(0,P.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",sh,(()=>1))]),(0,P.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",sh,(()=>1))]),(0,P.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",sh,(()=>1))]),(0,P.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",sh,(()=>1))]);const mo=yh("iridescence.texture");(0,P.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",mo.scale),(0,P.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",mo.offset),(0,P.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",mo.rotation);const ah=yh("iridescence.thicknessTexture");(0,P.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",ah.scale),(0,P.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",ah.offset),(0,P.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",ah.rotation),(0,P.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new ih(Q.e.ANIMATIONTYPE_COLOR3,"sheen.color",Bh,(()=>3))]),(0,P.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",sh,(()=>1))]);const uh=yh("sheen.texture");(0,P.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",uh.scale),(0,P.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",uh.offset),(0,P.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",uh.rotation);const Ih=yh("sheen.textureRoughness");(0,P.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Ih.scale),(0,P.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Ih.offset),(0,P.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Ih.rotation),(0,P.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",sh,(()=>1))]),(0,P.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new ih(Q.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Bh,(()=>3))]);const Ph=yh("metallicReflectanceTexture");(0,P.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Ph.scale),(0,P.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Ph.offset),(0,P.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Ph.rotation);const nh=yh("reflectanceTexture");(0,P.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",nh.scale),(0,P.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",nh.offset),(0,P.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",nh.rotation),(0,P.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",sh,(()=>1))]);const Fh=yh("subSurface.refractionIntensityTexture");(0,P.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Fh.scale),(0,P.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Fh.offset),(0,P.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Fh.rotation),(0,P.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new ih(Q.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Bh,(()=>3))]),(0,P.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",sh,(()=>1))]),(0,P.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",sh,(()=>1))]);const wh=yh("subSurface.thicknessTexture");(0,P.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",wh.scale),(0,P.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",wh.offset),(0,P.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",wh.rotation),(0,P.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new ih(Q.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",sh,(()=>1))]);const Yh=yh("subSurface.translucencyIntensityTexture");(0,P.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Yh.scale),(0,P.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Yh.offset),(0,P.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Yh.rotation),(0,P.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new ih(Q.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Bh,(()=>3))]);const lh=yh("subSurface.translucencyColorTexture");(0,P.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",lh.scale),(0,P.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",lh.offset),(0,P.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",lh.rotation),(0,P.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new Gh(Q.e.ANIMATIONTYPE_COLOR3,"diffuse",Bh,(()=>3))]),(0,P.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Gh(Q.e.ANIMATIONTYPE_FLOAT,"intensity",sh,(()=>1))]),(0,P.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new Gh(Q.e.ANIMATIONTYPE_FLOAT,"range",sh,(()=>1))]),(0,P.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Gh(Q.e.ANIMATIONTYPE_FLOAT,"innerAngle",ch,(()=>1))]),(0,P.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Gh(Q.e.ANIMATIONTYPE_FLOAT,"angle",ch,(()=>1))]),(0,P.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new Gh(Q.e.ANIMATIONTYPE_COLOR3,"diffuse",Bh,(()=>3))]),(0,P.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Gh(Q.e.ANIMATIONTYPE_FLOAT,"intensity",sh,(()=>1))]);const Ch="KHR_animation_pointer";class zh{constructor(D){this.name=Ch,this._loader=D,this._pathToObjectConverter=(0,P.h)(this._loader.eh)}get enabled(){return this._loader.isExtensionUsed(Ch)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(D,h,o,H,g){var j;const M=null===(j=H.target.extensions)||void 0===j?void 0:j.KHR_animation_pointer;if(!M||!this._pathToObjectConverter)return null;"pointer"!==H.target.path&&B.d.Warn(`${D}/target/path: Value (${H.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=H.target.node&&B.d.Warn(`${D}/target/node: Value (${H.target.node}) must not be present when using the ${this.name} extension`);const R=`${D}/extensions/${this.name}`,t=M.pointer;if(!t)throw new Error(`${R}: Pointer is missing`);try{const j=this._pathToObjectConverter.convert(t);if(!j.info.interpolation)throw new Error(`${R}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(D,h,o,H,{object:j.object,info:j.info.interpolation},g)}catch(S){return B.d.Warn(`${R}/pointer: Invalid pointer (${t}) skipped`),null}}}I(Ch),u(Ch,!0,(D=>new zh(D)));class fh{constructor(D,h,o){this.frame=D,this.action=h,this.onlyOnce=o,this.isDone=!1}_clone(){return new fh(this.frame,this.action,this.onlyOnce)}}var Vh=o(12672),dh=o(12731),Xh=o(12722);class Ah{get loop(){return this._loop}set loop(D){D!==this._loop&&(this._loop=D,this.updateOptions({loop:D}))}get currentTime(){var D;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(D=dh.e.audioEngine)&&void 0!==D&&D.audioContext&&(this.isPlaying||this.isPaused)){const D=this.isPaused?0:dh.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+D}return 0}get spatialSound(){return this._spatialSound}set spatialSound(D){if(D==this._spatialSound)return;const h=this.isPlaying;this.pause(),D?(this._spatialSound=D,this._updateSpatialParameters()):this._disableSpatialSound(),h&&this.play()}constructor(D,h,o){var H;let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new k.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=g.Gh.Zero(),this._localDirection=new g.Gh(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=D,o=o||r.d.LastCreatedScene)if(this._scene=o,Ah._SceneComponentInitialization(o),this._readyToPlayCallback=j,this._customAttenuationFunction=(D,h,o,H,g)=>h<o?D*(1-h/o):0,R&&(this.autoplay=R.autoplay||!1,this._loop=R.loop||!1,void 0!==R.volume&&(this._volume=R.volume),this._spatialSound=R.spatialSound??!1,this.maxDistance=R.maxDistance??100,this.useCustomAttenuation=R.useCustomAttenuation??!1,this.rolloffFactor=R.rolloffFactor||1,this.refDistance=R.refDistance||1,this.distanceModel=R.distanceModel||"linear",this._playbackRate=R.playbackRate||1,this._streaming=R.streaming??!1,this._length=R.length,this._offset=R.offset),null!==(H=dh.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&dh.e.audioEngine.audioContext){this._soundGain=dh.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let D=!0;if(h)try{"string"===typeof h?(this._urlType="String",this._url=h):h instanceof ArrayBuffer?this._urlType="ArrayBuffer":h instanceof HTMLMediaElement?this._urlType="MediaElement":h instanceof MediaStream?this._urlType="MediaStream":h instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(h)&&(this._urlType="Array");let o=[],H=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=dh.e.audioEngine.audioContext.createMediaElementSource(h),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=dh.e.audioEngine.audioContext.createMediaStreamSource(h),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":h.byteLength>0&&(H=!0,this._soundLoaded(h));break;case"AudioBuffer":this._audioBufferLoaded(h);break;case"String":o.push(h);case"Array":0===o.length&&(o=h);for(let D=0;D<o.length;D++){const h=o[D];if(H=R&&R.skipCodecCheck||-1!==h.indexOf(".mp3",h.length-4)&&dh.e.audioEngine.isMP3supported||-1!==h.indexOf(".ogg",h.length-4)&&dh.e.audioEngine.isOGGsupported||-1!==h.indexOf(".wav",h.length-4)||-1!==h.indexOf(".m4a",h.length-4)||-1!==h.indexOf(".mp4",h.length-4)||-1!==h.indexOf("blob:"),H){this._streaming?(this._htmlAudioElement=new Audio(h),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,M.Tools.SetCorsBehavior(h,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(h,(D=>{this._soundLoaded(D)}),void 0,!0,!0,(D=>{D&&B.d.Error("XHR "+D.status+" error on: "+h+"."),B.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:D=!1}D?H||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):B.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(t){B.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),dh.e.audioEngine&&!dh.e.audioEngine.WarnedWebAudioUnsupported&&(B.d.Error("Web Audio is not supported by your browser."),dh.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var D;null!==(D=dh.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(D){var h;null!==(h=dh.e.audioEngine)&&void 0!==h&&h.audioContext&&(this._audioBuffer=D,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(D){var h;null!==(h=dh.e.audioEngine)&&void 0!==h&&h.audioContext&&dh.e.audioEngine.audioContext.decodeAudioData(D,(D=>{this._audioBufferLoaded(D)}),(D=>{B.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+D)}))}setAudioBuffer(D){var h;null!==(h=dh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&(this._audioBuffer=D,this._isReadyToPlay=!0)}updateOptions(D){D&&(this.loop=D.loop??this.loop,this.maxDistance=D.maxDistance??this.maxDistance,this.useCustomAttenuation=D.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=D.rolloffFactor??this.rolloffFactor,this.refDistance=D.refDistance??this.refDistance,this.distanceModel=D.distanceModel??this.distanceModel,this._playbackRate=D.playbackRate??this._playbackRate,this._length=D.length??void 0,this.spatialSound=D.spatialSound??this._spatialSound,this._setOffset(D.offset??void 0),this.setVolume(D.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var D;null!==(D=dh.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&dh.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??dh.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var D;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(D=this._soundPanner)||void 0===D||D.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var D;null!==(D=dh.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(D){var h;null!==(h=dh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(D),this._isOutputConnected=!0)}setDirectionalCone(D,h,o){h<D?B.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=D,this._coneOuterAngle=h,this._coneOuterGain=o,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(D){if(D!=this._coneInnerAngle){var h;if(this._coneOuterAngle<D)return void B.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=D,null!==(h=dh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(D){if(D!=this._coneOuterAngle){var h;if(D<this._coneInnerAngle)return void B.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=D,null!==(h=dh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(D){var h;D.equals(this._position)||(this._position.M(D),null!==(h=dh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(D){var h;this._localDirection=D,null!==(h=dh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const D=this._connectedTransformNode.getWorldMatrix(),h=g.Gh.TransformNormal(this._localDirection,D);h.normalize(),this._soundPanner.orientationX.value=h.x,this._soundPanner.orientationY.value=h.y,this._soundPanner.orientationZ.value=h.z}updateDistanceFromListener(){var D;if(null!==(D=dh.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const D=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Nh(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,D,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(D){this._customAttenuationFunction=D}play(D,h,o){var H;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(H=dh.e.audioEngine)&&void 0!==H&&H.audioContext)try{var g,j;this._clearTimeoutsAndObservers();let H=D?(null===(g=dh.e.audioEngine)||void 0===g?void 0:g.audioContext.currentTime)+D:null===(j=dh.e.audioEngine)||void 0===j?void 0:j.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=dh.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const D=()=>{var o;if(null!==(o=dh.e.audioEngine)&&void 0!==o&&o.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=h??0;const o=this._htmlAudioElement.play();void 0!==o&&o.catch((()=>{var h,o;(null===(h=dh.e.audioEngine)||void 0===h||h.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(o=dh.e.audioEngine)||void 0===o?void 0:o.onAudioUnlockedObservable.addOnce((()=>{D()})))}))}else{var H;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(H=dh.e.audioEngine)||void 0===H?void 0:H.onAudioUnlockedObservable.addOnce((()=>{D()}))}};D()}}else{var M;const g=()=>{var g;if(null!==(g=dh.e.audioEngine)&&void 0!==g&&g.audioContext){var j;if(o=o||this._length,void 0!==h&&this._setOffset(h),this._soundSource){const D=this._soundSource;D.onended=()=>{D.disconnect()}}if(this._soundSource=null===(j=dh.e.audioEngine)||void 0===j?void 0:j.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var M;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==h&&(this._soundSource.loopStart=h),void 0!==o&&(this._soundSource.loopEnd=(0|h)+o),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},H=D?(null===(M=dh.e.audioEngine)||void 0===M?void 0:M.audioContext.currentTime)+D:dh.e.audioEngine.audioContext.currentTime;const g=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(H,g,this.loop?void 0:o)}}};"suspended"===(null===(M=dh.e.audioEngine)||void 0===M?void 0:M.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var D;"suspended"===(null===(D=dh.e.audioEngine)||void 0===D?void 0:D.audioContext.state)?(dh.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=dh.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{g()})))):g()}),500):g()}this._startTime=H,this.isPlaying=!0,this.isPaused=!1}catch(R){B.d.Error("Error while trying to play audio: "+this.name+", "+R.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(D){var h;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var o;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(o=this._streamingSource)||void 0===o||o.disconnect();this.isPlaying=!1}else if(null!==(h=dh.e.audioEngine)&&void 0!==h&&h.audioContext&&this._soundSource){const h=D?dh.e.audioEngine.audioContext.currentTime+D:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(h)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var D;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var h;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(h=this._streamingSource)||void 0===h||h.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(D=dh.e.audioEngine)&&void 0!==D&&D.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=dh.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(D,h){var o;null!==(o=dh.e.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._soundGain&&(h&&dh.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(dh.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,dh.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(D,dh.e.audioEngine.audioContext.currentTime+h)):this._soundGain.gain.value=D),this._volume=D}setPlaybackRate(D){this._playbackRate=D,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(D){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=D,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=D=>this._onRegisterAfterWorldMatrixUpdate(D),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(D){var h;if(D.getBoundingInfo){const h=D.getBoundingInfo();this.setPosition(h.boundingSphere.centerWorld)}else this.setPosition(D.absolutePosition);null!==(h=dh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const D=()=>{(0,Xh.f)((()=>this._isReadyToPlay),(()=>{o._audioBuffer=this.getAudioBuffer(),o._isReadyToPlay=!0,o.autoplay&&o.play(0,this._offset,this._length)}),void 0,300)},h={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},o=new Ah(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,h);return this.useCustomAttenuation&&o.setAttenuationFunction(this._customAttenuationFunction),o.setPosition(this._position),o.setPlaybackRate(this._playbackRate),D(),o}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const D={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(D.connectedMeshId=this._connectedTransformNode.id),D.position=this._position.Fh(),D.refDistance=this.refDistance,D.distanceModel=this.distanceModel,D.isDirectional=this._isDirectional,D.localDirectionToMesh=this._localDirection.Fh(),D.coneInnerAngle=this._coneInnerAngle,D.coneOuterAngle=this._coneOuterAngle,D.coneOuterGain=this._coneOuterGain),D}static Parse(D,h,o,H){const j=D.name;let M;M=D.url?o+D.url:o+j;const R={autoplay:D.autoplay,loop:D.loop,volume:D.volume,spatialSound:D.spatialSound,maxDistance:D.maxDistance,rolloffFactor:D.rolloffFactor,refDistance:D.refDistance,distanceModel:D.distanceModel,playbackRate:D.playbackRate};let t;if(H){const D=()=>{(0,Xh.f)((()=>H._isReadyToPlay),(()=>{t._audioBuffer=H.getAudioBuffer(),t._isReadyToPlay=!0,t.autoplay&&t.play(0,t._offset,t._length)}),void 0,300)};t=new Ah(j,new ArrayBuffer(0),h,null,R),D()}else t=new Ah(j,M,h,(()=>{h.removePendingData(t)}),R),h.addPendingData(t);if(D.position){const h=g.Gh.Ih(D.position);t.setPosition(h)}if(D.isDirectional&&(t.setDirectionalCone(D.coneInnerAngle||360,D.coneOuterAngle||360,D.coneOuterGain||0),D.localDirectionToMesh)){const h=g.Gh.Ih(D.localDirectionToMesh);t.setLocalDirectionToMesh(h)}if(D.connectedMeshId){const o=h.getMeshById(D.connectedMeshId);o&&t.attachToMesh(o)}return D.metadata&&(t.metadata=D.metadata),t}_setOffset(D){this._offset!==D&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=D)}_clearTimeoutsAndObservers(){var D;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(D=dh.e.audioEngine)||void 0===D||D.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Ah._SceneComponentInitialization=D=>{throw(0,Vh.e)("AudioSceneComponent")},(0,iD.g)("BABYLON.Sound",Ah);class Wh{constructor(D,h,o){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],h.length!==o.length)throw new Error("Sounds length does not equal weights length");this.loop=D,this._weights=o;let H=0;for(const j of o)H+=j;const g=H>0?1/H:0;for(let j=0;j<this._weights.length;j++)this._weights[j]*=g;this._sounds=h;for(const j of this._sounds)j.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(D){if(D!==this._coneInnerAngle){if(this._coneOuterAngle<D)return void B.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=D;for(const h of this._sounds)h.directionalConeInnerAngle=D}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(D){if(D!==this._coneOuterAngle){if(D<this._coneInnerAngle)return void B.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=D;for(const h of this._sounds)h.directionalConeOuterAngle=D}}get volume(){return this._volume}set volume(D){if(D!==this._volume)for(const h of this._sounds)h.setVolume(D)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(D){if(!this.isPaused){this.stop();const D=Math.random();let h=0;for(let o=0;o<this._weights.length;o++)if(h+=this._weights[o],D<=h){this._currentIndex=o;break}}const h=this._sounds[this._currentIndex??0];h.isReady()?h.play(0,this.isPaused?void 0:D):h.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class xh{constructor(D){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(D=D||r.d.LastCreatedScene)&&(this._scene=D,this.soundCollection=[],this._options=h,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var D;null!==(D=dh.e.audioEngine)&&void 0!==D&&D.canUseWebAudio&&dh.e.audioEngine.audioContext&&(this._outputAudioNode=dh.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(dh.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(dh.e.audioEngine&&dh.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(D){var h;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(h=dh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&D.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==D.soundTrackId&&(-1===D.soundTrackId?this._scene.mainSoundTrack.removeSound(D):this._scene.soundTracks&&this._scene.soundTracks[D.soundTrackId].removeSound(D)),this.soundCollection.push(D),D.soundTrackId=this.id}removeSound(D){const h=this.soundCollection.indexOf(D);-1!==h&&this.soundCollection.splice(h,1)}setVolume(D){var h;null!==(h=dh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=D)}switchPanningModelToHRTF(){var D;if(null!==(D=dh.e.audioEngine)&&void 0!==D&&D.canUseWebAudio)for(let h=0;h<this.soundCollection.length;h++)this.soundCollection[h].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var D;if(null!==(D=dh.e.audioEngine)&&void 0!==D&&D.canUseWebAudio)for(let h=0;h<this.soundCollection.length;h++)this.soundCollection[h].switchPanningModelToEqualPower()}connectToAnalyser(D){var h;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=D,null!==(h=dh.e.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,dh.e.audioEngine.masterGain))}}var Do=o(13094),ho=o(13065),oo=o(12656);dh.e.AudioEngineFactory=(D,h,o)=>new Ho(D,h,o);class Ho{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new k.c,this.onAudioLockedObservable=new k.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,oo.m)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const H=document.createElement("audio");this._hostElement=D,this._audioContext=h,this._audioDestination=o;try{H&&H.canPlayType&&(H.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||H.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(g){}try{H&&H.canPlayType&&H.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(g){}}lock(){this._triggerSuspendedState()}unlock(){var D,h;if("running"===(null===(D=this._audioContext)||void 0===D?void 0:D.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(h=this._audioContext)||void 0===h||h.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{B.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var D;null===(D=this._audioContext)||void 0===D||D.addEventListener("statechange",(()=>{var D;this.unlocked&&"running"!==(null===(D=this._audioContext)||void 0===D?void 0:D.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var D;return null!==(D=this._audioContext)&&void 0!==D&&D.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(D){this.canUseWebAudio=!1,B.d.Error("Web Audio: "+D.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(D){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const D=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",h=document.createElement("style");h.appendChild(document.createTextNode(D)),document.getElementsByTagName("head")[0].appendChild(h),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var D;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(D=this._audioContext)||void 0===D||D.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(D){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=D)}connectToAnalyser(D){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=D,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var go=o(12667);(0,o(14046).e)(Do.e.NAME_AUDIO,((D,h,o,H)=>{let g,j=[];if(o.iv=o.iv||[],void 0!==D.iv&&null!==D.iv)for(let R=0,t=D.iv.length;R<t;R++){var M;const t=D.iv[R];null!==(M=dh.e.audioEngine)&&void 0!==M&&M.canUseWebAudio?(t.url||(t.url=t.name),j[t.url]?o.iv.push(Ah.Parse(t,h,H,j[t.url])):(g=Ah.Parse(t,h,H),j[t.url]=g,o.iv.push(g))):o.iv.push(new Ah(t.name,null,h))}j=[]})),Object.defineProperty(ho.b.prototype,"mainSoundTrack",{get:function(){let D=this._getComponent(Do.e.NAME_AUDIO);return D||(D=new jo(this),this.o(D)),this._mainSoundTrack||(this._mainSoundTrack=new xh(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),ho.b.prototype.getSoundByName=function(D){let h;for(h=0;h<this.mainSoundTrack.soundCollection.length;h++)if(this.mainSoundTrack.soundCollection[h].name===D)return this.mainSoundTrack.soundCollection[h];if(this.soundTracks)for(let o=0;o<this.soundTracks.length;o++)for(h=0;h<this.soundTracks[o].soundCollection.length;h++)if(this.soundTracks[o].soundCollection[h].name===D)return this.soundTracks[o].soundCollection[h];return null},Object.defineProperty(ho.b.prototype,"audioEnabled",{get:function(){let D=this._getComponent(Do.e.NAME_AUDIO);return D||(D=new jo(this),this.o(D)),D.audioEnabled},set:function(D){let h=this._getComponent(Do.e.NAME_AUDIO);h||(h=new jo(this),this.o(h)),D?h.enableAudio():h.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(ho.b.prototype,"headphone",{get:function(){let D=this._getComponent(Do.e.NAME_AUDIO);return D||(D=new jo(this),this.o(D)),D.headphone},set:function(D){let h=this._getComponent(Do.e.NAME_AUDIO);h||(h=new jo(this),this.o(h)),D?h.switchAudioModeForHeadphones():h.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(ho.b.prototype,"audioListenerPositionProvider",{get:function(){let D=this._getComponent(Do.e.NAME_AUDIO);return D||(D=new jo(this),this.o(D)),D.audioListenerPositionProvider},set:function(D){let h=this._getComponent(Do.e.NAME_AUDIO);if(h||(h=new jo(this),this.o(h)),D&&"function"!==typeof D)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");h.audioListenerPositionProvider=D},enumerable:!0,configurable:!0}),Object.defineProperty(ho.b.prototype,"audioListenerRotationProvider",{get:function(){let D=this._getComponent(Do.e.NAME_AUDIO);return D||(D=new jo(this),this.o(D)),D.audioListenerRotationProvider},set:function(D){let h=this._getComponent(Do.e.NAME_AUDIO);if(h||(h=new jo(this),this.o(h)),D&&"function"!==typeof D)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");h.audioListenerRotationProvider=D},enumerable:!0,configurable:!0}),Object.defineProperty(ho.b.prototype,"audioPositioningRefreshRate",{get:function(){let D=this._getComponent(Do.e.NAME_AUDIO);return D||(D=new jo(this),this.o(D)),D.audioPositioningRefreshRate},set:function(D){let h=this._getComponent(Do.e.NAME_AUDIO);h||(h=new jo(this),this.o(h)),h.audioPositioningRefreshRate=D},enumerable:!0,configurable:!0});class jo{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(D){this.name=Do.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new g.Gh,this._cachedCameraPosition=new g.Gh,this._lastCheck=0,this._invertMatrixTemp=new g.Matrix,this._cameraDirectionTemp=new g.Gh,(D=D||r.d.LastCreatedScene)&&(this.Th=D,D.soundTracks=[],D.iv=[])}register(){this.Th._afterRenderStage.registerStep(Do.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(D){if(D.iv=[],this.Th.soundTracks)for(let h=0;h<this.Th.soundTracks.length;h++){const o=this.Th.soundTracks[h];for(let h=0;h<o.soundCollection.length;h++)D.iv.push(o.soundCollection[h].serialize())}}addFromContainer(D){if(D.iv)for(const h of D.iv)h.play(),h.autoplay=!0,this.Th.mainSoundTrack.addSound(h)}removeFromContainer(D){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(D.iv)for(const o of D.iv)o.stop(),o.autoplay=!1,this.Th.mainSoundTrack.removeSound(o),h&&o.dispose()}dispose(){const D=this.Th;if(D._mainSoundTrack&&D.mainSoundTrack.dispose(),D.soundTracks)for(let h=0;h<D.soundTracks.length;h++)D.soundTracks[h].dispose()}disableAudio(){const D=this.Th;let h;for(this._audioEnabled=!1,dh.e.audioEngine&&dh.e.audioEngine.audioContext&&dh.e.audioEngine.audioContext.suspend(),h=0;h<D.mainSoundTrack.soundCollection.length;h++)D.mainSoundTrack.soundCollection[h].pause();if(D.soundTracks)for(h=0;h<D.soundTracks.length;h++)for(let o=0;o<D.soundTracks[h].soundCollection.length;o++)D.soundTracks[h].soundCollection[o].pause()}enableAudio(){const D=this.Th;let h;for(this._audioEnabled=!0,dh.e.audioEngine&&dh.e.audioEngine.audioContext&&dh.e.audioEngine.audioContext.resume(),h=0;h<D.mainSoundTrack.soundCollection.length;h++)D.mainSoundTrack.soundCollection[h].isPaused&&D.mainSoundTrack.soundCollection[h].play();if(D.soundTracks)for(h=0;h<D.soundTracks.length;h++)for(let o=0;o<D.soundTracks[h].soundCollection.length;o++)D.soundTracks[h].soundCollection[o].isPaused&&D.soundTracks[h].soundCollection[o].play()}switchAudioModeForHeadphones(){const D=this.Th;if(this._headphone=!0,D.mainSoundTrack.switchPanningModelToHRTF(),D.soundTracks)for(let h=0;h<D.soundTracks.length;h++)D.soundTracks[h].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const D=this.Th;if(this._headphone=!1,D.mainSoundTrack.switchPanningModelToEqualPower(),D.soundTracks)for(let h=0;h<D.soundTracks.length;h++)D.soundTracks[h].switchPanningModelToEqualPower()}_afterRender(){const D=go.b.Now;if(this._lastCheck&&D-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=D;const h=this.Th;if(!this._audioEnabled||!h._mainSoundTrack||!h.soundTracks||0===h._mainSoundTrack.soundCollection.length&&1===h.soundTracks.length)return;const o=dh.e.audioEngine;if(o&&o.audioContext){let D,H=h.activeCamera;if(h.activeCameras&&h.activeCameras.length>0&&(H=h.activeCameras[0]),this.audioListenerPositionProvider){const D=this.audioListenerPositionProvider();o.audioContext.listener.setPosition(D.x||0,D.y||0,D.z||0)}else H?this._cachedCameraPosition.equals(H.globalPosition)||(this._cachedCameraPosition.M(H.globalPosition),o.audioContext.listener.setPosition(H.globalPosition.x,H.globalPosition.y,H.globalPosition.z)):o.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const D=this.audioListenerRotationProvider();o.audioContext.listener.setOrientation(D.x||0,D.y||0,D.z||0,0,1,0)}else H?(H.rigCameras&&H.rigCameras.length>0&&(H=H.rigCameras[0]),H.getViewMatrix().invertToRef(this._invertMatrixTemp),g.Gh.TransformNormalToRef(jo._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.M(this._cameraDirectionTemp),o.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):o.audioContext.listener.setOrientation(0,0,0,0,1,0);for(D=0;D<h.mainSoundTrack.soundCollection.length;D++){const o=h.mainSoundTrack.soundCollection[D];o.useCustomAttenuation&&o.updateDistanceFromListener()}if(h.soundTracks)for(D=0;D<h.soundTracks.length;D++)for(let o=0;o<h.soundTracks[D].soundCollection.length;o++){const H=h.soundTracks[D].soundCollection[o];H.useCustomAttenuation&&H.updateDistanceFromListener()}}}}jo._CameraDirection=new g.Gh(0,0,-1),Ah._SceneComponentInitialization=D=>{let h=D._getComponent(Do.e.NAME_AUDIO);h||(h=new jo(D),D.o(h))};const Mo="MSFT_audio_emitter";class Ro{constructor(D){this.name=Mo,this._loader=D,this.enabled=this._loader.isExtensionUsed(Mo)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const D=this._loader.eh.extensions;if(D&&D[this.name]){const h=D[this.name];this._clips=h.clips,this._emitters=h.emitters,w.Assign(this._clips),w.Assign(this._emitters)}}loadSceneAsync(D,h){return l.LoadExtensionAsync(D,h,this.name,(async(o,H)=>{const g=new Array;g.push(this._loader.loadSceneAsync(D,h));for(const D of H.emitters){const h=w.Get(`${o}/emitters`,this._emitters,D);if(void 0!=h.refDistance||void 0!=h.maxDistance||void 0!=h.rolloffFactor||void 0!=h.distanceModel||void 0!=h.innerAngle||void 0!=h.outerAngle)throw new Error(`${o}: Direction or Distance properties are not allowed on emitters attached to a scene`);g.push(this._loadEmitterAsync(`${o}/emitters/${h.index}`,h))}await Promise.all(g)}))}loadNodeAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(D,H)=>{const j=new Array,R=await this._loader.loadNodeAsync(D,h,(h=>{for(const o of H.emitters){const H=w.Get(`${D}/emitters`,this._emitters,o);j.push(this._loadEmitterAsync(`${D}/emitters/${H.index}`,H).then((()=>{for(const D of H._babylonSounds)D.attachToMesh(h),void 0==H.innerAngle&&void 0==H.outerAngle||(D.setLocalDirectionToMesh(g.Gh.Forward()),D.setDirectionalCone(2*M.Tools.ToDegrees(void 0==H.innerAngle?Math.PI:H.innerAngle),2*M.Tools.ToDegrees(void 0==H.outerAngle?Math.PI:H.outerAngle),0))})))}o(h)}));return await Promise.all(j),R}))}loadAnimationAsync(D,h){return l.LoadExtensionAsync(D,h,this.name,(async(o,H)=>{const g=await this._loader.loadAnimationAsync(D,h),j=new Array;w.Assign(H.events);for(const M of H.events)j.push(this._loadAnimationEventAsync(`${o}/events/${M.index}`,D,h,M,g));return await Promise.all(j),g}))}_loadClipAsync(D,h){if(h._objectURL)return h._objectURL;let o;if(h.uri)o=this._loader.loadUriAsync(D,h,h.uri);else{const H=w.Get(`${D}/bufferView`,this._loader.eh.bufferViews,h.bufferView);o=this._loader.loadBufferViewAsync(`/bufferViews/${H.index}`,H)}return h._objectURL=o.then((D=>URL.createObjectURL(new Blob([D],{type:h.mimeType})))),h._objectURL}_loadEmitterAsync(D,h){if(h._babylonSounds=h._babylonSounds||[],!h._babylonData){const D=new Array,o=h.name||`emitter${h.index}`,H={loop:!1,autoplay:!1,volume:void 0==h.volume?1:h.volume};for(let j=0;j<h.clips.length;j++){const g=`/extensions/${this.name}/clips`,M=w.Get(g,this._clips,h.clips[j].clip);D.push(this._loadClipAsync(`${g}/${h.clips[j].clip}`,M).then((D=>{const g=h._babylonSounds[j]=new Ah(o,D,this._loader.babylonScene,null,H);g.refDistance=h.refDistance||1,g.maxDistance=h.maxDistance||256,g.rolloffFactor=h.rolloffFactor||1,g.distanceModel=h.distanceModel||"exponential"})))}const g=Promise.all(D).then((()=>{const D=h.clips.map((D=>D.weight||1)),o=new Wh(h.loop||!1,h._babylonSounds,D);h.innerAngle&&(o.directionalConeInnerAngle=2*M.Tools.ToDegrees(h.innerAngle)),h.outerAngle&&(o.directionalConeOuterAngle=2*M.Tools.ToDegrees(h.outerAngle)),h.volume&&(o.volume=h.volume),h._babylonData.sound=o}));h._babylonData={loaded:g}}return h._babylonData.loaded}_getEventAction(D,h,o,H,g){switch(o){case"play":return D=>{const o=(g||0)+(D-H);h.play(o)};case"stop":return()=>{h.stop()};case"pause":return()=>{h.pause()};default:throw new Error(`${D}: Unsupported action ${o}`)}}_loadAnimationEventAsync(D,h,o,H,g){if(0==g.targetedAnimations.length)return Promise.resolve();const j=g.targetedAnimations[0],M=H.Hh,R=w.Get(`/extensions/${this.name}/emitters`,this._emitters,M);return this._loadEmitterAsync(D,R).then((()=>{const h=R._babylonData.sound;if(h){const o=new fh(H.time,this._getEventAction(D,h,H.action,H.time,H.startOffset));j.animation.addEvent(o),g.onAnimationGroupEndObservable.add((()=>{h.stop()})),g.onAnimationGroupPauseObservable.add((()=>{h.pause()}))}}))}}I(Mo),u(Mo,!0,(D=>new Ro(D)));const to="MSFT_lod";class So{constructor(D){var h;this.name=to,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new k.c,this.onMaterialLODsLoadedObservable=new k.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=D,this.maxLODsToLoad=(null===(h=this._loader.parent.extensionOptions[to])||void 0===h?void 0:h.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(to)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let D=0;D<this._nodePromiseLODs.length;D++){const h=Promise.all(this._nodePromiseLODs[D]).then((()=>{0!==D&&(this._loader.endPerformanceCounter(`Node LOD ${D}`),this._loader.log(`Loaded node LOD ${D}`)),this.onNodeLODsLoadedObservable.notifyObservers(D),D!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${D+1}`),this._loadBufferLOD(this._nodeBufferLODs,D+1),this._nodeSignalLODs[D]&&this._nodeSignalLODs[D].resolve())}));this._loader._completePromises.push(h)}for(let D=0;D<this._materialPromiseLODs.length;D++){const h=Promise.all(this._materialPromiseLODs[D]).then((()=>{0!==D&&(this._loader.endPerformanceCounter(`Material LOD ${D}`),this._loader.log(`Loaded material LOD ${D}`)),this.onMaterialLODsLoadedObservable.notifyObservers(D),D!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${D+1}`),this._loadBufferLOD(this._materialBufferLODs,D+1),this._materialSignalLODs[D]&&this._materialSignalLODs[D].resolve())}));this._loader._completePromises.push(h)}}loadSceneAsync(D,h){const o=this._loader.loadSceneAsync(D,h);return this._loadBufferLOD(this._bufferLODs,0),o}loadNodeAsync(D,h,o){return l.LoadExtensionAsync(D,h,this.name,(async(D,g)=>{let j;const M=this._getLODs(D,h,this._loader.eh.nodes,g.ids);this._loader.logOpen(`${D}`);for(let h=0;h<M.length;h++){const D=M[h];0!==h&&(this._nodeIndexLOD=h,this._nodeSignalLODs[h]=this._nodeSignalLODs[h]||new H);const g=D=>{o(D),D.It(!1)},R=this._loader.loadNodeAsync(`/nodes/${D.index}`,D,g).then((D=>{if(0!==h){const D=M[h-1];D._babylonTransformNode&&(this._disposeTransformNode(D._babylonTransformNode),delete D._babylonTransformNode)}return D.It(!0),D}));this._nodePromiseLODs[h]=this._nodePromiseLODs[h]||[],0===h?j=R:(this._nodeIndexLOD=null,this._nodePromiseLODs[h].push(R))}return this._loader.logClose(),await j}))}_loadMaterialAsync(D,h,o,H,g){return this._nodeIndexLOD?null:l.LoadExtensionAsync(D,h,this.name,(async(D,j)=>{let M;const R=this._getLODs(D,h,this._loader.eh.materials,j.ids);this._loader.logOpen(`${D}`);for(let h=0;h<R.length;h++){const D=R[h];0!==h&&(this._materialIndexLOD=h);const j=this._loader._loadMaterialAsync(`/materials/${D.index}`,D,o,H,(D=>{0===h&&g(D)})).then((D=>{if(0!==h){g(D);const o=R[h-1]._data;o[H]&&(this._disposeMaterials([o[H].babylonMaterial]),delete o[H])}return D}));this._materialPromiseLODs[h]=this._materialPromiseLODs[h]||[],0===h?M=j:(this._materialIndexLOD=null,this._materialPromiseLODs[h].push(j))}return this._loader.logClose(),await M}))}_loadUriAsync(D,h,o){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const g=this._nodeIndexLOD-1;return this._nodeSignalLODs[g]=this._nodeSignalLODs[g]||new H,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(D,h,o)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const g=this._materialIndexLOD-1;return this._materialSignalLODs[g]=this._materialSignalLODs[g]||new H,this._materialSignalLODs[g].promise.then((async()=>await this._loader.loadUriAsync(D,h,o)))}return null}loadBufferAsync(D,h,o,g){if(this._loader.parent.useRangeRequests&&!h.uri){if(!this._loader.bin)throw new Error(`${D}: Uri is missing or the binary glTF is missing its binary chunk`);const h=async(D,h)=>{const j=o,M=j+g-1;let R=D[h];return R?(R.start=Math.min(R.start,j),R.end=Math.max(R.end,M)):(R={start:j,end:M,loaded:new H},D[h]=R),await R.loaded.promise.then((D=>new Uint8Array(D.buffer,D.byteOffset+o-R.start,g)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?h(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?h(this._materialBufferLODs,this._materialIndexLOD):h(this._bufferLODs,0)}return null}_loadBufferLOD(D,h){const o=D[h];o&&(this._loader.log(`Loading buffer range [${o.start}-${o.end}]`),this._loader.bin.readAsync(o.start,o.end-o.start+1).then((D=>{o.loaded.resolve(D)}),(D=>{o.loaded.reject(D)})))}_getLODs(D,h,o,H){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const g=[];for(let j=H.length-1;j>=0;j--)if(g.push(w.Get(`${D}/ids/${H[j]}`,o,H[j])),g.length===this.maxLODsToLoad)return g;return g.push(h),g}_disposeTransformNode(D){const h=[],o=D.material;o&&h.push(o);for(const g of D.getChildMeshes())g.material&&h.push(g.material);D.dispose();const H=h.filter((D=>this._loader.babylonScene.meshes.every((h=>h.material!=D))));this._disposeMaterials(H)}_disposeMaterials(D){const h={};for(const o of D){for(const D of o.getActiveTextures())h[D.uniqueId]=D;o.dispose()}for(const o in h)for(const D of this._loader.babylonScene.materials)D.hasTexture(h[o])&&delete h[o];for(const o in h)h[o].dispose()}}I(to),u(to,!0,(D=>new So(D)));const ko="MSFT_minecraftMesh";class Ko{constructor(D){this.name=ko,this._loader=D,this.enabled=this._loader.isExtensionUsed(ko)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtraAsync(D,h,this.name,(async(H,g)=>{if(g){if(!(o instanceof c.b))throw new Error(`${H}: Material type not supported`);const g=this._loader.loadMaterialPropertiesAsync(D,h,o);return o.needAlphaBlending()&&(o.forceDepthWrite=!0,o.separateCullingPass=!0),o.Mg=o.forceDepthWrite,o.twoSidedLighting=!0,await g}}))}}I(ko),u(ko,!0,(D=>new Ko(D)));const Qo="MSFT_sRGBFactors";class vo{constructor(D){this.name=Qo,this._loader=D,this.enabled=this._loader.isExtensionUsed(Qo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(D,h,o){return l.LoadExtraAsync(D,h,this.name,(async(H,g)=>{if(g){if(!(o instanceof c.b))throw new Error(`${H}: Material type not supported`);const g=this._loader.loadMaterialPropertiesAsync(D,h,o),j=o.GD().getEngine().useExactSrgbConversions;return o.albedoTexture||o.albedoColor.toLinearSpaceToRef(o.albedoColor,j),o.reflectivityTexture||o.reflectivityColor.toLinearSpaceToRef(o.reflectivityColor,j),await g}}))}}I(Qo),u(Qo,!0,(D=>new vo(D)));var ro=o(14347);const Bo={};var so=o(14408),Uo=o(14377),qo=o(14354),co=o(14362);function yo(D,h){for(const o of D)for(const D of o.dataOutputs)if(D.uniqueId===h)return D;throw new Error("Could not find data out connection with unique id "+h)}function bo(D,h){for(const o of D)if(o instanceof Uo.e)for(const D of o.signalInputs)if(D.uniqueId===h)return D;throw new Error("Could not find signal in connection with unique id "+h)}async function io(D,h){const H=await Promise.all(D.allBlocks.map((async D=>{const h=function(D){switch(D){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([o.e(78),o.e(79)]).then(o.bind(o,15841))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await o.e(80).then(o.bind(o,15850))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await o.e(81).then(o.bind(o,15854))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await o.e(82).then(o.bind(o,15863))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await o.e(83).then(o.bind(o,15872))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await o.e(84).then(o.bind(o,15874))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await o.e(85).then(o.bind(o,15879))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await o.e(86).then(o.bind(o,15883))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await o.e(87).then(o.bind(o,15891))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await o.e(89).then(o.bind(o,15921))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await o.e(89).then(o.bind(o,15921))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await o.e(89).then(o.bind(o,15921))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await o.e(89).then(o.bind(o,15921))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await o.e(89).then(o.bind(o,15921))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await o.e(89).then(o.bind(o,15921))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await o.e(90).then(o.bind(o,15925))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await o.e(90).then(o.bind(o,15925))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await o.e(90).then(o.bind(o,15925))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await o.e(90).then(o.bind(o,15925))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await o.e(95).then(o.bind(o,15931))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await o.e(96).then(o.bind(o,15933))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await o.e(97).then(o.bind(o,15936))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await o.e(98).then(o.bind(o,15938))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await o.e(99).then(o.bind(o,15945))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await o.e(100).then(o.bind(o,15950))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await o.e(101).then(o.bind(o,15955))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await o.e(102).then(o.bind(o,15959))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await o.e(103).then(o.bind(o,15961))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await o.e(104).then(o.bind(o,15966))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await o.e(105).then(o.bind(o,15970))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await o.e(106).then(o.bind(o,15977))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await o.e(107).then(o.bind(o,15981))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await o.e(108).then(o.bind(o,15986))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await o.e(109).then(o.bind(o,15989))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await o.e(110).then(o.bind(o,15998))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await o.e(111).then(o.bind(o,16001))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await o.e(112).then(o.bind(o,16009))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await o.e(113).then(o.bind(o,16018))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await o.e(92).then(o.bind(o,16023))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await o.e(114).then(o.bind(o,16026))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await o.e(115).then(o.bind(o,16034))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await o.e(116).then(o.bind(o,16038))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await o.e(93).then(o.bind(o,16044))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await o.e(88).then(o.bind(o,15897))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await o.e(94).then(o.bind(o,16052))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await o.e(94).then(o.bind(o,16052))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await o.e(94).then(o.bind(o,16052))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await o.e(94).then(o.bind(o,16052))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await o.e(94).then(o.bind(o,16052))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await o.e(94).then(o.bind(o,16052))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await o.e(94).then(o.bind(o,16052))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await o.e(94).then(o.bind(o,16052))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await o.e(89).then(o.bind(o,15921))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await o.e(89).then(o.bind(o,15921))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await o.e(89).then(o.bind(o,15921))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await o.e(89).then(o.bind(o,15921))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await o.e(89).then(o.bind(o,15921))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await o.e(89).then(o.bind(o,15921))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await o.e(89).then(o.bind(o,15921))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await o.e(90).then(o.bind(o,15925))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await o.e(90).then(o.bind(o,15925))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await o.e(91).then(o.bind(o,16054))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await o.e(91).then(o.bind(o,16054))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await o.e(91).then(o.bind(o,16054))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await o.e(91).then(o.bind(o,16054))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await o.e(91).then(o.bind(o,16054))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await o.e(91).then(o.bind(o,16054))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await o.e(117).then(o.bind(o,16057))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await o.e(118).then(o.bind(o,16065))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await o.e(119).then(o.bind(o,16071))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await o.e(120).then(o.bind(o,16078))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await o.e(121).then(o.bind(o,16086))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await o.e(122).then(o.bind(o,16094))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await o.e(123).then(o.bind(o,16102))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await o.e(124).then(o.bind(o,16110))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await o.e(125).then(o.bind(o,16119))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await o.e(126).then(o.bind(o,16128))).FlowGraphDataSwitchBlock;default:if(Bo[D])return Bo[D];throw new Error(`Unknown block name ${D}`)}}(D.className);return await h()})));return function(D,h,o){const H=h.coordinator.createGraph(),g=[],j=h.valueParseFunction??qo.d;for(let M=0;M<D.allBlocks.length;M++){const R=No(D.allBlocks[M],{Th:h.coordinator.config.Th,pathConverter:h.pathConverter,assetsContainer:h.coordinator.config.Th,valueParseFunction:j},o[M]);g.push(R),R instanceof so.b&&H.addEventBlock(R)}for(const M of g){for(const D of M.dataInputs)for(const h of D.connectedPointIds){const o=yo(g,h);D.connectTo(o)}if(M instanceof Uo.e)for(const D of M.signalOutputs)for(const h of D.connectedPointIds){const o=bo(g,h);D.connectTo(o)}}for(const M of D.executionContexts)Go(M,{graph:H,valueParseFunction:j},D.rightHanded);return H}(D,h,H)}function Go(D,h,o){const H=h.graph.createContext();D.enableLogging&&(H.enableLogging=!0),H.treatDataAsRightHanded=o||!1;const g=h.valueParseFunction??qo.d;H.uniqueId=D.uniqueId;const j=H.GD();if(D._assetsContext){var M,R,t,S,k,K,Q,v,r,B;const h=D._assetsContext,o={meshes:null===(M=h.meshes)||void 0===M?void 0:M.map((D=>j.getMeshById(D))),lights:null===(R=h.lights)||void 0===R?void 0:R.map((D=>j.getLightByName(D))),cameras:null===(t=h.cameras)||void 0===t?void 0:t.map((D=>j.getCameraByName(D))),materials:null===(S=h.materials)||void 0===S?void 0:S.map((D=>j.getMaterialById(D))),textures:null===(k=h.textures)||void 0===k?void 0:k.map((D=>j.getTextureByName(D))),animations:null===(K=h.animations)||void 0===K?void 0:K.map((D=>j.animations.find((h=>h.name===D)))),skeletons:null===(Q=h.skeletons)||void 0===Q?void 0:Q.map((D=>j.getSkeletonByName(D))),YQ:null===(v=h.YQ)||void 0===v?void 0:v.map((D=>j.getParticleSystemById(D))),animationGroups:null===(r=h.animationGroups)||void 0===r?void 0:r.map((D=>j.getAnimationGroupByName(D))),transformNodes:null===(B=h.transformNodes)||void 0===B?void 0:B.map((D=>j.getTransformNodeById(D))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],iv:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};H.assetsContext=o}for(const s in D._userVariables){const h=g(s,D._userVariables,H.assetsContext,j);H.userVariables[s]=h}for(const s in D._connectionValues){const h=g(s,D._connectionValues,H.assetsContext,j);H._setConnectionValueByKey(s,h)}return H}function No(D,h,o){const H={},g=h.valueParseFunction??qo.d;if(D.config)for(const M in D.config)H[M]=g(M,D.config,h.assetsContainer||h.Th,h.Th);if((0,qo.g)(D.className)){if(!h.pathConverter)throw new Error("Path converter is required for this block");H.pathConverter=h.pathConverter}const j=new o(H);j.uniqueId=D.uniqueId;for(let M=0;M<D.dataInputs.length;M++){const h=j.getDataInput(D.dataInputs[M].name);if(!h)throw new Error("Could not find data input with name "+D.dataInputs[M].name+" in block "+D.className);h.deserialize(D.dataInputs[M])}for(let M=0;M<D.dataOutputs.length;M++){const h=j.getDataOutput(D.dataOutputs[M].name);if(!h)throw new Error("Could not find data output with name "+D.dataOutputs[M].name+" in block "+D.className);h.deserialize(D.dataOutputs[M])}return j.metadata=D.metadata,j.deserialize&&j.deserialize(D),j}function Jo(D){const[h,o]=D.split(":");return Oo({op:h,extension:o})}function Oo(D){var h;let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const H=D.extension?null===(h=Lo[D.extension])||void 0===h?void 0:h[D.op]:To[D.op];if(!H&&(B.d.Warn(`No mapping found for operation ${D.op} and extension ${D.extension||"KHR_interactivity"}`),o)){const h={},o={flows:{}};if(D.inputValueSockets){h.values={};for(const o in D.inputValueSockets)h.values[o]={name:o}}return D.outputValueSockets&&(o.values={},Object.keys(D.outputValueSockets).forEach((D=>{o.values[D]={name:D}}))),{HK:[],inputs:h,outputs:o}}return H}function Eo(D,h,o){Lo[h]||(Lo[h]={}),Lo[h][D]=o}const Lo={BABYLON:{"flow/log":{HK:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},To={"event/onStart":{HK:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{HK:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{HK:["FlowGraphSendCustomEventBlock"],extraProcessor(D,h,o,H,g){if("event/send"!==h.op||!D.configuration||1!==Object.keys(D.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const j=D.configuration.event.value[0];if("number"!==typeof j)throw new Error("Event id should be a number");const M=H.arrays.events[j],R=g[0];return R.config||(R.config={}),R.config.eventId=M.eventId,R.config.eventData=M.eventData,g}},"event/receive":{HK:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(D,h){var o;if(!D.configuration)return B.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const H=D.configuration.event;if(!H)return B.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const g=H.value[0];if("number"!==typeof g)return B.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(o=h.events)||void 0===o?void 0:o[g])?{valid:!0}:(B.d.Error(`Event with id ${g} not found`),{valid:!1,error:`Event with id ${g} not found`})},extraProcessor(D,h,o,H,g){if("event/receive"!==h.op||!D.configuration||1!==Object.keys(D.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const j=D.configuration.event.value[0];if("number"!==typeof j)throw new Error("Event id should be a number");const M=H.arrays.events[j],R=g[0];return R.config||(R.config={}),R.config.eventId=M.eventId,R.config.eventData=M.eventData,g}},"math/e":Zo("FlowGraphEBlock"),"math/pi":Zo("FlowGraphPIBlock"),"math/inf":Zo("FlowGraphInfBlock"),"math/nan":Zo("FlowGraphNaNBlock"),"math/abs":Zo("FlowGraphAbsBlock"),"math/sign":Zo("FlowGraphSignBlock"),"math/trunc":Zo("FlowGraphTruncBlock"),"math/floor":Zo("FlowGraphFloorBlock"),"math/ceil":Zo("FlowGraphCeilBlock"),"math/round":{HK:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,h,o,H,g){var j;return(j=g[0]).config||(j.config={}),g[0].config.roundHalfAwayFromZero=!0,g}},"math/fract":Zo("FlowGraphFractBlock"),"math/neg":Zo("FlowGraphNegationBlock"),"math/add":Zo("FlowGraphAddBlock",["a","b"],!0),"math/sub":Zo("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{HK:["FlowGraphMultiplyBlock"],extraProcessor(D,h,o,H,g){var j;(j=g[0]).config||(j.config={}),g[0].config.useMatrixPerComponent=!0,g[0].config.preventIntegerFloatArithmetic=!0;let M=-1;return Object.keys(D.values||{}).find((h=>{var o;return void 0!==(null===(o=D.values)||void 0===o?void 0:o[h].type)&&(M=D.values[h].type,!0)})),-1!==M&&(g[0].config.type=H.arrays.types[M].flowGraphType),g},validation:D=>D.values?eo(D):{valid:!0}},"math/div":Zo("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Zo("FlowGraphModuloBlock",["a","b"]),"math/min":Zo("FlowGraphMinBlock",["a","b"]),"math/max":Zo("FlowGraphMaxBlock",["a","b"]),"math/clamp":Zo("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Zo("FlowGraphSaturateBlock"),"math/mix":Zo("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Zo("FlowGraphEqualityBlock",["a","b"]),"math/lt":Zo("FlowGraphLessThanBlock",["a","b"]),"math/le":Zo("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Zo("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Zo("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Zo("FlowGraphIsNaNBlock"),"math/isinf":Zo("FlowGraphIsInfBlock"),"math/select":{HK:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{HK:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Zo("FlowGraphSinBlock"),"math/cos":Zo("FlowGraphCosBlock"),"math/tan":Zo("FlowGraphTanBlock"),"math/asin":Zo("FlowGraphASinBlock"),"math/acos":Zo("FlowGraphACosBlock"),"math/atan":Zo("FlowGraphATanBlock"),"math/atan2":Zo("FlowGraphATan2Block",["a","b"]),"math/sinh":Zo("FlowGraphSinhBlock"),"math/cosh":Zo("FlowGraphCoshBlock"),"math/tanh":Zo("FlowGraphTanhBlock"),"math/asinh":Zo("FlowGraphASinhBlock"),"math/acosh":Zo("FlowGraphACoshBlock"),"math/atanh":Zo("FlowGraphATanhBlock"),"math/exp":Zo("FlowGraphExponentialBlock"),"math/log":Zo("FlowGraphLogBlock"),"math/log2":Zo("FlowGraphLog2Block"),"math/log10":Zo("FlowGraphLog10Block"),"math/sqrt":Zo("FlowGraphSquareRootBlock"),"math/cbrt":Zo("FlowGraphCubeRootBlock"),"math/pow":Zo("FlowGraphPowerBlock",["a","b"]),"math/length":Zo("FlowGraphLengthBlock"),"math/normalize":Zo("FlowGraphNormalizeBlock"),"math/dot":Zo("FlowGraphDotBlock",["a","b"]),"math/cross":Zo("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Zo("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Zo("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{HK:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{HK:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{HK:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{HK:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{HK:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{HK:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{HK:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Zo("FlowGraphTransposeBlock"),"math/determinant":Zo("FlowGraphDeterminantBlock"),"math/inverse":Zo("FlowGraphInvertMatrixBlock"),"math/matmul":Zo("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{HK:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Ug",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,h,o,H,g,j){const M=g[0].dataInputs.find((D=>"rotationQuaternion"===D.name));if(!M)throw new Error("Rotation quaternion input not found");return j._connectionValues[M.uniqueId]&&(j._connectionValues[M.uniqueId].type="Quaternion"),g}},"math/matDecompose":{HK:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Ug"}}}},"math/quatConjugate":Zo("FlowGraphConjugateBlock",["a"]),"math/quatMul":{HK:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,h,o,H,g){var j;return(j=g[0]).config||(j.config={}),g[0].config.type="Quaternion",g}},"math/quatAngleBetween":Zo("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{HK:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Zo("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Zo("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{HK:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,h,o,H,g){var j;return(j=g[0]).config||(j.config={}),g[0].config.inputIsColumnMajor=!0,g}},"math/extract2x2":{HK:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{HK:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,h,o,H,g){var j;return(j=g[0]).config||(j.config={}),g[0].config.inputIsColumnMajor=!0,g}},"math/extract3x3":{HK:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{HK:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,h,o,H,g){var j;return(j=g[0]).config||(j.config={}),g[0].config.inputIsColumnMajor=!0,g}},"math/extract4x4":{HK:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{HK:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,h,o,H,g,j){var M,R;(R=g[0]).config||(R.config={});const t=g[0].dataInputs[0];return g[0].config.valueType=(null===(M=j._connectionValues[t.uniqueId])||void 0===M?void 0:M.type)??"FlowGraphInteger",g}},"math/and":{HK:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,h,o,H,g,j){var M,R,t;(t=g[0]).config||(t.config={});const S=g[0].dataInputs[0],k=g[0].dataInputs[1];return g[0].config.valueType=(null===(M=j._connectionValues[S.uniqueId])||void 0===M?void 0:M.type)??(null===(R=j._connectionValues[k.uniqueId])||void 0===R?void 0:R.type)??"FlowGraphInteger",g}},"math/or":{HK:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,h,o,H,g,j){var M,R,t;(t=g[0]).config||(t.config={});const S=g[0].dataInputs[0],k=g[0].dataInputs[1];return g[0].config.valueType=(null===(M=j._connectionValues[S.uniqueId])||void 0===M?void 0:M.type)??(null===(R=j._connectionValues[k.uniqueId])||void 0===R?void 0:R.type)??"FlowGraphInteger",g}},"math/xor":{HK:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(D,h,o,H,g,j){var M,R,t;(t=g[0]).config||(t.config={});const S=g[0].dataInputs[0],k=g[0].dataInputs[1];return g[0].config.valueType=(null===(M=j._connectionValues[S.uniqueId])||void 0===M?void 0:M.type)??(null===(R=j._connectionValues[k.uniqueId])||void 0===R?void 0:R.type)??"FlowGraphInteger",g}},"math/asr":Zo("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Zo("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Zo("FlowGraphLeadingZerosBlock"),"math/ctz":Zo("FlowGraphTrailingZerosBlock"),"math/popcnt":Zo("FlowGraphOneBitsCounterBlock"),"math/rad":Zo("FlowGraphDegToRadBlock"),"math/deg":Zo("FlowGraphRadToDegBlock"),"type/boolToInt":Zo("FlowGraphBooleanToInt"),"type/boolToFloat":Zo("FlowGraphBooleanToFloat"),"type/intToBool":Zo("FlowGraphIntToBoolean"),"type/intToFloat":Zo("FlowGraphIntToFloat"),"type/floatToInt":Zo("FlowGraphFloatToInt"),"type/floatToBool":Zo("FlowGraphFloatToBoolean"),"flow/sequence":{HK:["FlowGraphSequenceBlock"],extraProcessor(D,h,o,H,g){const j=g[0];return j.config||(j.config={}),j.config.outputSignalCount=Object.keys(D.flows||[]).length,j.signalOutputs.forEach(((D,h)=>{D.name="out_"+h})),g}},"flow/branch":{HK:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{HK:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(D){if(D.configuration&&D.configuration.cases){const h=D.configuration.cases.value;if(!h.every((D=>"number"===typeof D&&/^-?\d+$/.test(D.toString()))))return B.d.Warn("Switch cases should be integers. Using empty array instead."),D.configuration.cases.value=[],{valid:!0};const o=new Set(h);D.configuration.cases.value=Array.from(o)}return{valid:!0}},extraProcessor(D,h,o,H,g){if("flow/switch"!==h.op||!D.flows||0===Object.keys(D.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return g[0].signalOutputs.forEach((D=>{"default"!==D.name&&(D.name="out_"+D.name)})),g}},"flow/while":{HK:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{HK:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(D,h,o,H,g){const j=g[0];return j.config||(j.config={}),j.config.incrementIndexWhenLoopDone=!0,g}},"flow/doN":{HK:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{HK:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(D,h,o,H,g){if("flow/multiGate"!==h.op||!D.flows||0===Object.keys(D.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const j=g[0];return j.config||(j.config={}),j.config.outputSignalCount=Object.keys(D.flows).length,j.signalOutputs.forEach(((D,h)=>{D.name="out_"+h})),g}},"flow/waitAll":{HK:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(D){var h,o;return"number"!==typeof(null===(h=D.configuration)||void 0===h||null===(o=h.inputFlows)||void 0===o?void 0:o.value[0])&&(D.configuration=D.configuration||{inputFlows:{value:[0]}},D.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{HK:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{HK:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{HK:["FlowGraphCancelDelayBlock"]},"variable/get":{HK:["FlowGraphGetVariableBlock"],validation(D){var h,o;return null!==(h=D.configuration)&&void 0!==h&&null!==(o=h.variable)&&void 0!==o&&o.value?{valid:!0}:(B.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(D,h)=>[h.getVariableName(D[0])]}}},"variable/set":{HK:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(D,h)=>[h.getVariableName(D[0])]}}},"variable/setMultiple":{HK:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(D,h)=>[D[0].map((D=>h.getVariableName(D)))]}},extraProcessor:(D,h,o,H,g)=>(g[0].dataInputs.forEach((D=>{D.name=H.getVariableName(+D.name)})),g)},"variable/interpolate":{HK:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(D,h)=>[h.getVariableName(D[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:D=>!0===D[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Wo:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Wo:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Wo:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Wo:"FlowGraphPlayAnimationBlock"},out:{name:"out",Wo:"FlowGraphPlayAnimationBlock"},done:{name:"done",Wo:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(D,h,o,H,g){var j,M,R;const t=g[0],S=null===(j=D.configuration)||void 0===j?void 0:j.variable.value[0];if("number"!==typeof S)throw B.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const k=H.arrays.staticVariables[S];"undefined"===typeof t.config.animationType.value&&(H.arrays.staticVariables,t.config.animationType.value=(0,co.z)(k.type));const K=g[4];return K.config||(K.config={}),(M=K.config).variable||(M.variable={}),K.config.variable.value=H.getVariableName(S),(R=g[3]).config||(R.config={}),g}},"pointer/get":{HK:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Wo:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Wo:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(D,h,o,H,g)=>(g.forEach((D=>{"FlowGraphJsonPointerParserBlock"===D.className&&(D.config||(D.config={}),D.config.outputValue=!0)})),g)},"pointer/set":{HK:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Wo:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Wo:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(D,h,o,H,g)=>(g.forEach((D=>{"FlowGraphJsonPointerParserBlock"===D.className&&(D.config||(D.config={}),D.config.outputValue=!0)})),g)},"pointer/interpolate":{HK:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Wo:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Wo:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Wo:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Wo:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Wo:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Wo:"FlowGraphPlayAnimationBlock"},out:{name:"out",Wo:"FlowGraphPlayAnimationBlock"},done:{name:"done",Wo:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(D,h,o,H,g)=>(g.forEach((h=>{"FlowGraphJsonPointerParserBlock"===h.className?(h.config||(h.config={}),h.config.outputValue=!0):"FlowGraphInterpolationBlock"===h.className&&(h.config||(h.config={}),Object.keys(D.values||[]).forEach((o=>{var g;const j=null===(g=D.values)||void 0===g?void 0:g[o];if("value"===o&&j){const D=j.type;void 0!==D&&(h.config.animationType=H.arrays.types[D].flowGraphType)}})))})),g)},"animation/start":{HK:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Wo:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(D,h)=>[D[0]*h._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(D,h)=>[D[0]*h._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(D,h,o,H,g,j,M){const R=g[g.length-1];return R.config||(R.config={}),R.config.glTF=M,g}},"animation/stop":{HK:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Wo:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(D,h,o,H,g,j,M){const R=g[g.length-1];return R.config||(R.config={}),R.config.glTF=M,g}},"animation/stopAt":{HK:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Wo:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(D,h)=>[D[0]*h._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(D,h,o,H,g,j,M){const R=g[g.length-1];return R.config||(R.config={}),R.config.glTF=M,g}},"math/switch":{HK:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(D){if(D.configuration&&D.configuration.cases){const h=D.configuration.cases.value;if(!h.every((D=>"number"===typeof D&&/^-?\d+$/.test(D.toString()))))return B.d.Warn("Switch cases should be integers. Using empty array instead."),D.configuration.cases.value=[],{valid:!0};const o=new Set(h);D.configuration.cases.value=Array.from(o)}return{valid:!0}},extraProcessor(D,h,o,H,g){const j=g[0];return j.dataInputs.forEach((D=>{"default"!==D.name&&"case"!==D.name&&(D.name="in_"+D.name)})),j.config||(j.config={}),j.config.treatCasesAsIntegers=!0,g}},"debug/log":{HK:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Zo(D){let h=arguments.length>2?arguments[2]:void 0;return{HK:[D],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((D,h)=>(D[h]={name:h},D)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(D,o,H,g,j){var M;if(h){(M=j[0]).config||(M.config={}),j[0].config.preventIntegerFloatArithmetic=!0;let h=-1;Object.keys(D.values||{}).find((o=>{var H;return void 0!==(null===(H=D.values)||void 0===H?void 0:H[o].type)&&(h=D.values[o].type,!0)})),-1!==h&&(j[0].config.type=g.arrays.types[h].flowGraphType)}return j},validation:D=>h?eo(D):{valid:!0}}}function eo(D){if(D.values){const h=Object.keys(D.values).map((h=>D.values[h].type)).filter((D=>void 0!==D));if(!h.every((D=>D===h[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}To["math/compose"]=To["math/matCompose"],To["math/decompose"]=To["math/matDecompose"];var po=o(12798);const mH={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Gh",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class ao{constructor(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=D,this._gltf=h,this._animationTargetFps=o,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const D of this._interactivityGraph.types)this._types.push(mH[D.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const D of this._interactivityGraph.declarations){const h=Oo(D);if(!h)throw B.d.Error(["No mapping found for declaration",D]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:h,fullOperationName:D.extension?D.op+":"+D.extension:D.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const D of this._interactivityGraph.variables){const h=this._parseVariable(D);this._staticVariables.push(h)}}_parseVariable(D,h){const o=this._types[D.type];if(!o)throw B.d.Error(["No type found for variable",D]),new Error("Error parsing variables");if(D.value&&D.value.length!==o.length)throw B.d.Error(["Invalid value length for variable",D,o]),new Error("Error parsing variables");const H=D.value||[];if(!H.length)switch(o.flowGraphType){case"boolean":H.push(!1);break;case"FlowGraphInteger":H.push(0);break;case"number":H.push(NaN);break;case"Vector2":H.push(NaN,NaN);break;case"Gh":H.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":H.fill(NaN,0,4);break;case"Matrix":H.fill(NaN,0,16);break;case"Matrix3D":H.fill(NaN,0,9)}return"number"===o.elementType&&"string"===typeof H[0]&&(H[0]=parseFloat(H[0])),{type:o.flowGraphType,value:h?h(H,this):H}}_parseEvents(){if(this._interactivityGraph.events)for(const D of this._interactivityGraph.events){const h={eventId:D.id||"internalEvent_"+this._internalEventsCounter++};D.values&&(h.eventData=Object.keys(D.values).map((h=>{var o;const H=null===(o=D.values)||void 0===o?void 0:o[h];if(!H)throw B.d.Error(["No value found for event key",h]),new Error("Error parsing events");const g=this._types[H.type];if(!g)throw B.d.Error(["No type found for event value",H]),new Error("Error parsing events");const j="undefined"!==typeof H.value?this._parseVariable(H):void 0;return{id:h,type:g.flowGraphType,eventData:!0,value:j}}))),this._events.push(h)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const h of this._interactivityGraph.nodes){if("number"!==typeof h.declaration)throw B.d.Error(["No declaration found for node",h]),new Error("Error parsing nodes");const o=this._mappings[h.declaration];if(!o)throw B.d.Error(["No mapping found for node",h]),new Error("Error parsing nodes");if(o.flowGraphMapping.validation){const H=o.flowGraphMapping.validation(h,this._interactivityGraph,this._gltf);var D;if(!H.valid)throw new Error(`Error validating interactivity node ${null===(D=this._interactivityGraph.declarations)||void 0===D?void 0:D[h.declaration].op} - ${H.error}`)}const H=[];for(const D of o.flowGraphMapping.HK){const g=this._getEmptyBlock(D,o.fullOperationName);this._parseNodeConfiguration(h,g,o.flowGraphMapping,D),H.push(g)}this._nodes.push({HK:H,fullOperationName:o.fullOperationName})}}_getEmptyBlock(D,h){return{uniqueId:(0,po.d)(),className:D,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:h,metadata:{}}}_parseNodeConfiguration(D,h,o,H){const g=h.config;if(D.configuration){const h=Object.keys(D.configuration);for(const R of h){var j,M;const h=null===(j=D.configuration)||void 0===j?void 0:j[R];if(!h)throw B.d.Error(["No value found for node configuration",R]),new Error("Error parsing node configuration");const t=null===(M=o.configuration)||void 0===M?void 0:M[R];if(t&&t.Wo?t.Wo===H:0===o.HK.indexOf(H)){const D=(null===t||void 0===t?void 0:t.name)||R;h&&"undefined"!==typeof h.value||"undefined"===typeof(null===t||void 0===t?void 0:t.defaultValue)?h.value.length>=0?g[D]={value:1===h.value.length?h.value[0]:h.value}:B.d.Warn(["Invalid value for node configuration",h]):g[D]={value:t.defaultValue},t&&t.dataTransformer&&(g[D].value=t.dataTransformer([g[D].value],this)[0])}}}}_parseNodeConnections(D){for(let i=0;i<this._nodes.length;i++){var h;const G=null===(h=this._interactivityGraph.nodes)||void 0===h?void 0:h[i];if(!G)throw B.d.Error(["No node found for interactivity node",this._nodes[i]]),new Error("Error parsing node connections");const N=this._nodes[i],J=this._mappings[G.declaration];if(!J)throw B.d.Error(["No mapping found for node",G]),new Error("Error parsing node connections");const O=G.flows||{},E=Object.keys(O).sort();for(const D of E){var o,H,g,j;const h=O[D],S=null===(o=J.flowGraphMapping.outputs)||void 0===o||null===(H=o.flows)||void 0===H?void 0:H[D],k=(null===S||void 0===S?void 0:S.name)||D,K=this._createNewSocketConnection(k,!0);(S&&S.Wo&&N.HK.find((D=>D.className===S.Wo))||N.HK[0]).signalOutputs.push(K);const Q=h.node,v=this._nodes[Q];if(!v)throw B.d.Error(["No node found for input node id",Q]),new Error("Error parsing node connections");const r=Jo(v.fullOperationName);if(!r)throw B.d.Error(["No mapping found for input node",v]),new Error("Error parsing node connections");let s=null===(g=r.inputs)||void 0===g||null===(j=g.flows)||void 0===j?void 0:j[h.socket||"in"],U=!1;if(!s)for(const D in null===(M=r.inputs)||void 0===M?void 0:M.flows){var M,R,t;if(D.startsWith("[")&&D.endsWith("]"))U=!0,s=null===(R=r.inputs)||void 0===R||null===(t=R.flows)||void 0===t?void 0:t[D]}const q=s?U?s.name.replace("$1",h.socket||""):s.name:h.socket||"in",c=s&&s.Wo&&v.HK.find((D=>D.className===s.Wo))||v.HK[0];let y=c.signalInputs.find((D=>D.name===q));y||(y=this._createNewSocketConnection(q),c.signalInputs.push(y)),y.connectedPointIds.push(K.uniqueId),K.connectedPointIds.push(y.uniqueId)}const L=G.values||{},T=Object.keys(L);for(const h of T){var S,k;const o=L[h];let H=null===(S=J.flowGraphMapping.inputs)||void 0===S||null===(k=S.values)||void 0===k?void 0:k[h],g=!1;if(!H)for(const D in null===(K=J.flowGraphMapping.inputs)||void 0===K?void 0:K.values){var K,Q,v;if(D.startsWith("[")&&D.endsWith("]"))g=!0,H=null===(Q=J.flowGraphMapping.inputs)||void 0===Q||null===(v=Q.values)||void 0===v?void 0:v[D]}const j=H?g?H.name.replace("$1",h):H.name:h,M=this._createNewSocketConnection(j);if((H&&H.Wo&&N.HK.find((D=>D.className===H.Wo))||N.HK[0]).dataInputs.push(M),void 0!==o.value){const h=this._parseVariable(o,H&&H.dataTransformer);D._connectionValues[M.uniqueId]=h}else{if("undefined"===typeof o.node)throw B.d.Error(["Invalid value for value connection",o]),new Error("Error parsing node connections");{var r,s,U;const D=o.node,h=o.socket||"value",H=this._nodes[D];if(!H)throw B.d.Error(["No node found for output socket reference",o]),new Error("Error parsing node connections");const g=Jo(H.fullOperationName);if(!g)throw B.d.Error(["No mapping found for output socket reference",o]),new Error("Error parsing node connections");let j=null===(r=g.outputs)||void 0===r||null===(s=r.values)||void 0===s?void 0:s[h],R=!1;if(!j)for(const o in null===(q=g.outputs)||void 0===q?void 0:q.values){var q,c,y;if(o.startsWith("[")&&o.endsWith("]"))R=!0,j=null===(c=g.outputs)||void 0===c||null===(y=c.values)||void 0===y?void 0:y[o]}const t=j?R?j.name.replace("$1",h):null===(U=j)||void 0===U?void 0:U.name:h,S=j&&j.Wo&&H.HK.find((D=>D.className===j.Wo))||H.HK[0];let k=S.dataOutputs.find((D=>D.name===t));k||(k=this._createNewSocketConnection(t,!0),S.dataOutputs.push(k)),M.connectedPointIds.push(k.uniqueId),k.connectedPointIds.push(M.uniqueId)}}}if(J.flowGraphMapping.interBlockConnectors)for(const D of J.flowGraphMapping.interBlockConnectors){const h=D.input,o=D.output,H=D.isVariable;this._connectFlowGraphNodes(h,o,N.HK[D.inputBlockIndex],N.HK[D.outputBlockIndex],H)}if(J.flowGraphMapping.extraProcessor){var b;const h=null===(b=this._interactivityGraph.declarations)||void 0===b?void 0:b[G.declaration];if(!h)throw B.d.Error(["No declaration found for extra processor",G]),new Error("Error parsing node connections");N.HK=J.flowGraphMapping.extraProcessor(G,h,J.flowGraphMapping,this,N.HK,D,this._gltf)}}}_createNewSocketConnection(D,h){return{uniqueId:(0,po.d)(),name:D,_connectionType:h?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(D,h,o,H,g){const j=g?o.dataInputs:o.signalInputs,M=g?H.dataOutputs:H.signalOutputs,R=j.find((h=>h.name===D))||this._createNewSocketConnection(D),t=M.find((D=>D.name===h))||this._createNewSocketConnection(h,!0);j.find((h=>h.name===D))||j.push(R),M.find((D=>D.name===h))||M.push(t),R.connectedPointIds.push(t.uniqueId),t.connectedPointIds.push(R.uniqueId)}getVariableName(D){return"staticVariable_"+D}serializeToFlowGraph(){const D={uniqueId:(0,po.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(D);for(let h=0;h<this._staticVariables.length;h++){const o=this._staticVariables[h];D._userVariables[this.getVariableName(h)]=o}return{rightHanded:!0,allBlocks:this._nodes.reduce(((D,h)=>D.concat(h.HK)),[]),executionContexts:[D]}}}const uo="KHR_interactivity";class Io{constructor(D){this._loader=D,this.name=uo,this.enabled=this._loader.isExtensionUsed(uo),this._pathConverter=(0,P.h)(this._loader.eh),D._skipStartAnimationStep=!0;const h=D.babylonScene;h&&function(D){(0,P.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!D.activeCamera)return new g.Quaternion(NaN,NaN,NaN,NaN);const h=g.Quaternion.FromRotationMatrix(D.activeCamera.getWorldMatrix()).normalize();return D.useRightHandedSystem||(h.w*=-1,h.x*=-1),h},type:"Quaternion",getTarget:()=>D.activeCamera}),(0,P.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!D.activeCamera)return new g.Gh(NaN,NaN,NaN);const h=D.activeCamera.getWorldMatrix().getTranslation();return D.useRightHandedSystem||(h.x*=-1),h},type:"Gh",getTarget:()=>D.activeCamera}),(0,P.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:D=>{var h;return(null===(h=D._babylonAnimationGroup)||void 0===h?void 0:h.isPlaying)??!1},type:"boolean",getTarget:D=>D._babylonAnimationGroup}),(0,P.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:D=>{var h;return((null===(h=D._babylonAnimationGroup)||void 0===h?void 0:h.from)??0)/60},type:"number",getTarget:D=>D._babylonAnimationGroup}),(0,P.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:D=>{var h;return((null===(h=D._babylonAnimationGroup)||void 0===h?void 0:h.to)??0)/60},type:"number",getTarget:D=>D._babylonAnimationGroup}),(0,P.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:D=>{var h;return((null===(h=D._babylonAnimationGroup)||void 0===h?void 0:h.getCurrentFrame())??0)/60},type:"number",getTarget:D=>D._babylonAnimationGroup}),(0,P.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:D=>{var h;return((null===(h=D._babylonAnimationGroup)||void 0===h?void 0:h.getCurrentFrame())??0)/60},type:"number",getTarget:D=>D._babylonAnimationGroup})}(h)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var D;if(!this._loader.babylonScene||!this._pathConverter)return;const h=this._loader.babylonScene,o=null===(D=this._loader.eh.extensions)||void 0===D?void 0:D.KHR_interactivity;if(!o)return;const H=new ro.c({Th:h});H.dispatchEventsSynchronously=!1;const g=o.graphs.map((D=>new ao(D,this._loader.eh,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(g.map((async D=>await io(D,{coordinator:H,pathConverter:this._pathConverter})))),H.start()}}var Po;Po=async()=>(await Promise.resolve().then(o.bind(o,14423))).FlowGraphGLTFDataProvider,Bo[`${uo}/${"FlowGraphGLTFDataProvider"}`]=Po,I(uo),u(uo,!0,(D=>new Io(D)));const no="KHR_node_visibility";(0,P.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:D=>{const h=D._babylonTransformNode;return!h||void 0===h.isVisible||h.isVisible},set:(D,h)=>{var o,H;null===(o=h._primitiveBabylonMeshes)||void 0===o||o.forEach((D=>{D.inheritVisibility=!0})),h._babylonTransformNode&&(h._babylonTransformNode.isVisible=D),null===(H=h._primitiveBabylonMeshes)||void 0===H||H.forEach((h=>{h.isVisible=D}))},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Fo{constructor(D){this.name=no,this._loader=D,this.enabled=D.isExtensionUsed(no)}async onReady(){var D;null===(D=this._loader.eh.nodes)||void 0===D||D.forEach((D=>{var h,o,H,g;(null===(h=D._primitiveBabylonMeshes)||void 0===h||h.forEach((D=>{D.inheritVisibility=!0})),null!==(o=D.extensions)&&void 0!==o&&o.KHR_node_visibility)&&(!1===(null===(H=D.extensions)||void 0===H?void 0:H.KHR_node_visibility.visible)&&(D._babylonTransformNode&&(D._babylonTransformNode.isVisible=!1),null===(g=D._primitiveBabylonMeshes)||void 0===g||g.forEach((D=>{D.isVisible=!1}))))}))}dispose(){this._loader=null}}I(no),u(no,!0,(D=>new Fo(D)));const wo="KHR_node_selectability";Eo("event/onSelect",wo,{HK:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Wo:"FlowGraphGetVariableBlock",dataTransformer:D=>["pickedMesh_"+D[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Wo:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(D,h,o,H,g,j,M){var R,t,S,k,K,Q;const v=g[g.length-1];v.config=v.config||{},v.config.glTF=M;const r=null===(R=D.configuration)||void 0===R||null===(t=R.nodeIndex)||void 0===t?void 0:t.value[0];if(void 0===r||"number"!==typeof r)throw new Error("nodeIndex not found in configuration");const B="pickedMesh_"+r;return g[1].config.variable=B,j._userVariables[B]={className:"Mesh",id:null===M||void 0===M||null===(S=M.nodes)||void 0===S||null===(k=S[r]._babylonTransformNode)||void 0===k?void 0:k.id,uniqueId:null===M||void 0===M||null===(K=M.nodes)||void 0===K||null===(Q=K[r]._babylonTransformNode)||void 0===Q?void 0:Q.uniqueId},g}}),(0,P.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:D=>{const h=D._babylonTransformNode;return!h||void 0===h.TS||h.TS},set:(D,h)=>{var o;null===(o=h._primitiveBabylonMeshes)||void 0===o||o.forEach((h=>{h.TS=D}))},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"TS"],type:"boolean"});class Yo{constructor(D){this.name=wo,this._loader=D,this.enabled=D.isExtensionUsed(wo)}async onReady(){var D;null===(D=this._loader.eh.nodes)||void 0===D||D.forEach((D=>{var h,o,H;null!==(h=D.extensions)&&void 0!==h&&h.KHR_node_selectability&&!1===(null===(o=D.extensions)||void 0===o?void 0:o.KHR_node_selectability.selectable)&&(null===(H=D._babylonTransformNode)||void 0===H||H.getChildMeshes().forEach((D=>{D.TS=!1})))}))}dispose(){this._loader=null}}I(wo),u(wo,!0,(D=>new Yo(D)));const lo="KHR_node_hoverability",Co="targetMeshPointerOver_";Eo("event/onHoverIn",lo,{HK:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Wo:"FlowGraphGetVariableBlock",dataTransformer:D=>[Co+D[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Wo:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(D,h,o,H,g,j,M){var R,t,S,k,K,Q;const v=g[g.length-1];v.config=v.config||{},v.config.glTF=M;const r=null===(R=D.configuration)||void 0===R||null===(t=R.nodeIndex)||void 0===t?void 0:t.value[0];if(void 0===r||"number"!==typeof r)throw new Error("nodeIndex not found in configuration");const B=Co+r;return g[1].config.variable=B,j._userVariables[B]={className:"Mesh",id:null===M||void 0===M||null===(S=M.nodes)||void 0===S||null===(k=S[r]._babylonTransformNode)||void 0===k?void 0:k.id,uniqueId:null===M||void 0===M||null===(K=M.nodes)||void 0===K||null===(Q=K[r]._babylonTransformNode)||void 0===Q?void 0:Q.uniqueId},g}});const zo="targetMeshPointerOut_";Eo("event/onHoverOut",lo,{HK:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Wo:"FlowGraphGetVariableBlock",dataTransformer:D=>[zo+D[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Wo:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(D,h,o,H,g,j,M){var R,t,S,k,K,Q;const v=g[g.length-1];v.config=v.config||{},v.config.glTF=M;const r=null===(R=D.configuration)||void 0===R||null===(t=R.nodeIndex)||void 0===t?void 0:t.value[0];if(void 0===r||"number"!==typeof r)throw new Error("nodeIndex not found in configuration");const B=zo+r;return g[1].config.variable=B,j._userVariables[B]={className:"Mesh",id:null===M||void 0===M||null===(S=M.nodes)||void 0===S||null===(k=S[r]._babylonTransformNode)||void 0===k?void 0:k.id,uniqueId:null===M||void 0===M||null===(K=M.nodes)||void 0===K||null===(Q=K[r]._babylonTransformNode)||void 0===Q?void 0:Q.uniqueId},g}}),(0,P.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:D=>{const h=D._babylonTransformNode;return!h||void 0===h.pointerOverDisableMeshTesting||h.pointerOverDisableMeshTesting},set:(D,h)=>{var o;null===(o=h._primitiveBabylonMeshes)||void 0===o||o.forEach((h=>{h.pointerOverDisableMeshTesting=!D}))},getTarget:D=>D._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class fo{constructor(D){this.name=lo,this._loader=D,this.enabled=D.isExtensionUsed(lo)}async onReady(){var D;null===(D=this._loader.eh.nodes)||void 0===D||D.forEach((D=>{var h,o,H;null!==(h=D.extensions)&&void 0!==h&&h.KHR_node_hoverability&&!1===(null===(o=D.extensions)||void 0===o?void 0:o.KHR_node_hoverability.hoverable)&&(null===(H=D._babylonTransformNode)||void 0===H||H.getChildMeshes().forEach((D=>{D.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}I(lo),u(lo,!0,(D=>new fo(D)));const Vo="ExtrasAsMetadata";class Xo{_assignExtras(D,h){if(h.extras&&Object.keys(h.extras).length>0){const o=D.metadata=D.metadata||{};(o.eh=o.eh||{}).extras=h.extras}}constructor(D){this.name=Vo,this.enabled=!0,this._loader=D}dispose(){this._loader=null}loadNodeAsync(D,h,o){return this._loader.loadNodeAsync(D,h,(D=>{this._assignExtras(D,h),o(D)}))}loadCameraAsync(D,h,o){return this._loader.loadCameraAsync(D,h,(D=>{this._assignExtras(D,h),o(D)}))}createMaterial(D,h,o){const H=this._loader.createMaterial(D,h,o);return this._assignExtras(H,h),H}}I(Vo),u(Vo,!1,(D=>new Xo(D)));o(14423)},14299:(D,h,o)=>{"use strict";o.d(h,{c:()=>e,e:()=>J,g:()=>N,h:()=>O});var H=o(12648),g=o(12642),j=o(13957),M=o(13288),R=o(13255),t=o(13266),S=o(12658),k=o(12683),K=o(13286),Q=o(13392),v=o(13296),r=o(12864);class B{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.YQ=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.iv=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(D){this._environmentTexture=D}getNodes(){let D=[];D=D.concat(this.meshes),D=D.concat(this.lights),D=D.concat(this.cameras),D=D.concat(this.transformNodes);for(const h of this.skeletons)D=D.concat(h.bones);return D}}class s extends B{}class U{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const D=this.rootNodes;for(const H of D)H.dispose();D.length=0;const h=this.skeletons;for(const H of h)H.dispose();h.length=0;const o=this.animationGroups;for(const H of o)H.dispose();o.length=0}}class q extends B{constructor(D){super(),this._wasAddedToScene=!1,(D=D||k.d.LastCreatedScene)&&(this.Th=D,this.proceduralTextures=[],D.Jh.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=D.getEngine().onContextRestoredObservable.add((()=>{for(const D of this.geometries)D._rebuild();for(const D of this.meshes)D._rebuild();for(const D of this.YQ)D.rebuild();for(const D of this.textures)D._rebuild()})))}_topologicalSort(D){const h=new Map;for(const M of D)h.set(M.uniqueId,M);const o={dependsOn:new Map,dependedBy:new Map};for(const M of D){const D=M.uniqueId;o.dependsOn.set(D,new Set),o.dependedBy.set(D,new Set)}for(const M of D){const D=M.uniqueId,H=o.dependsOn.get(D);if(M instanceof K.e){const g=M.sourceMesh;h.has(g.uniqueId)&&(H.add(g.uniqueId),o.dependedBy.get(g.uniqueId).add(D))}const g=o.dependedBy.get(D);for(const j of M.getDescendants()){const H=j.uniqueId;if(h.has(H)){g.add(H);o.dependsOn.get(H).add(D)}}}const H=[],g=[];for(const M of D){const D=M.uniqueId;0===o.dependsOn.get(D).size&&(g.push(M),h.delete(D))}const j=g;for(;j.length>0;){const D=j.shift();H.push(D);const g=o.dependedBy.get(D.uniqueId);for(const H of Array.from(g.values())){const g=o.dependsOn.get(H);g.delete(D.uniqueId),0===g.size&&h.get(H)&&(j.push(h.get(H)),h.delete(H))}}return h.size>0&&(S.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),h.forEach((D=>{S.d.Error(D.name)}))),H}_addNodeAndDescendantsToList(D,h,o,H){if(o&&(!H||H(o))&&!h.has(o.uniqueId)){D.push(o),h.add(o.uniqueId);for(const g of o.getDescendants(!0))this._addNodeAndDescendantsToList(D,h,g,H)}}_isNodeInContainer(D){return D instanceof t.e&&-1!==this.meshes.indexOf(D)||(D instanceof R.c&&-1!==this.transformNodes.indexOf(D)||(D instanceof Q.c&&-1!==this.lights.indexOf(D)||D instanceof v.b&&-1!==this.cameras.indexOf(D)))}_isValidHierarchy(){for(const D of this.meshes)if(D.parent&&!this._isNodeInContainer(D.parent))return S.d.Warn(`Node ${D.name} has a parent that is not in the container.`),!1;for(const D of this.transformNodes)if(D.parent&&!this._isNodeInContainer(D.parent))return S.d.Warn(`Node ${D.name} has a parent that is not in the container.`),!1;for(const D of this.lights)if(D.parent&&!this._isNodeInContainer(D.parent))return S.d.Warn(`Node ${D.name} has a parent that is not in the container.`),!1;for(const D of this.cameras)if(D.parent&&!this._isNodeInContainer(D.parent))return S.d.Warn(`Node ${D.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(D){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||g.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const H={},j={},R=new U,t=[],S=[],k={doNotInstantiate:!0,...o},K=[],Q=new Set;for(const g of this.transformNodes)null===g.parent&&this._addNodeAndDescendantsToList(K,Q,g,k.predicate);for(const g of this.meshes)null===g.parent&&this._addNodeAndDescendantsToList(K,Q,g,k.predicate);const v=this._topologicalSort(K),r=(o,g)=>{if(((h,o)=>{if(H[h.uniqueId]=o.uniqueId,j[o.uniqueId]=o,D&&(o.name=D(h.name)),o instanceof M.d){const D=o;if(D.morphTargetManager){const o=h.morphTargetManager;D.morphTargetManager=o.clone();for(let h=0;h<o.numTargets;h++){const g=o.getTarget(h),M=D.morphTargetManager.getTarget(h);H[g.uniqueId]=M.uniqueId,j[M.uniqueId]=M}}}})(o,g),o.parent){const D=H[o.parent.uniqueId],h=j[D];g.parent=h||o.parent}if(g.position&&o.position&&g.position.M(o.position),g.rotationQuaternion&&o.rotationQuaternion&&g.rotationQuaternion.M(o.rotationQuaternion),g.rotation&&o.rotation&&g.rotation.M(o.rotation),g.Ug&&o.Ug&&g.Ug.M(o.Ug),g.material){const M=g;if(M.material)if(h){const h=o.material;if(-1===S.indexOf(h)){let o=h.clone(D?D(h.name):"Clone of "+h.name);if(S.push(h),H[h.uniqueId]=o.uniqueId,j[o.uniqueId]=o,"MultiMaterial"===h.getClassName()){const g=h;for(const h of g.bg)h&&(o=h.clone(D?D(h.name):"Clone of "+h.name),S.push(h),H[h.uniqueId]=o.uniqueId,j[o.uniqueId]=o);g.bg=g.bg.map((D=>D&&j[H[D.uniqueId]]))}}"InstancedMesh"!==M.getClassName()&&(M.material=j[H[h.uniqueId]])}else"MultiMaterial"===M.material.getClassName()?-1===this.Th.multiMaterials.indexOf(M.material)&&this.Th.addMultiMaterial(M.material):-1===this.Th.materials.indexOf(M.material)&&this.Th.addMaterial(M.material)}null===g.parent&&R.rootNodes.push(g)};for(const g of v)if("InstancedMesh"===g.getClassName()){const D=g,h=D.sourceMesh,o=H[h.uniqueId];r(D,("number"===typeof o?j[o]:h).createInstance(D.name))}else{let D=!0;"ug"===g.getClassName()||"Node"===g.getClassName()||g.skeleton||!g.getTotalVertices||0===g.getTotalVertices()?D=!1:k.doNotInstantiate&&(D="function"===typeof k.doNotInstantiate?!k.doNotInstantiate(g):!k.doNotInstantiate);const h=D?g.createInstance(`instance of ${g.name}`):g.clone(`Clone of ${g.name}`,null,!0);if(!h)throw new Error(`Could not clone or instantiate node on Asset Container ${g.name}`);r(g,h)}for(const g of this.skeletons){if(k.predicate&&!k.predicate(g))continue;const h=g.clone(D?D(g.name):"Clone of "+g.name);for(const D of this.meshes)if(D.skeleton===g&&!D.isAnInstance){const o=j[H[D.uniqueId]];if(!o||o.isAnInstance)continue;if(o.skeleton=h,-1!==t.indexOf(h))continue;t.push(h);for(const D of h.bones)D._linkedTransformNode&&(D._linkedTransformNode=j[H[D._linkedTransformNode.uniqueId]])}R.skeletons.push(h)}for(const g of this.animationGroups){if(k.predicate&&!k.predicate(g))continue;const h=g.clone(D?D(g.name):"Clone of "+g.name,(D=>j[H[D.uniqueId]]||D));R.animationGroups.push(h)}return R}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||g.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Th.environmentTexture=this.environmentTexture);for(const D of this.Th._serializableComponents)D.addFromContainer(this);this.Th.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const h=[];for(const o of this.cameras)D&&!D(o)||(this.Th.addCamera(o),h.push(o));for(const o of this.lights)D&&!D(o)||(this.Th.addLight(o),h.push(o));for(const o of this.meshes)D&&!D(o)||(this.Th.dk(o),h.push(o));for(const o of this.skeletons)D&&!D(o)||this.Th.addSkeleton(o);for(const o of this.animations)D&&!D(o)||this.Th.addAnimation(o);for(const o of this.animationGroups)D&&!D(o)||this.Th.addAnimationGroup(o);for(const o of this.multiMaterials)D&&!D(o)||this.Th.addMultiMaterial(o);for(const o of this.materials)D&&!D(o)||this.Th.addMaterial(o);for(const o of this.morphTargetManagers)D&&!D(o)||this.Th.addMorphTargetManager(o);for(const o of this.geometries)D&&!D(o)||this.Th.addGeometry(o);for(const o of this.transformNodes)D&&!D(o)||(this.Th.addTransformNode(o),h.push(o));for(const o of this.actionManagers)D&&!D(o)||this.Th.addActionManager(o);for(const o of this.textures)D&&!D(o)||this.Th.addTexture(o);for(const o of this.reflectionProbes)D&&!D(o)||this.Th.addReflectionProbe(o);for(const o of h)o.parent&&-1===this.Th.getNodes().indexOf(o.parent)&&(o.setParent?o.setParent(null):o.parent=null)}removeAllFromScene(){this._isValidHierarchy()||g.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Th.environmentTexture&&(this.Th.environmentTexture=null);for(const D of this.Th._serializableComponents)D.removeFromContainer(this)}removeFromScene(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const h of this.cameras)D&&!D(h)||this.Th.removeCamera(h);for(const h of this.lights)D&&!D(h)||this.Th.removeLight(h);for(const h of this.meshes)D&&!D(h)||this.Th.Vk(h,!0);for(const h of this.skeletons)D&&!D(h)||this.Th.removeSkeleton(h);for(const h of this.animations)D&&!D(h)||this.Th.removeAnimation(h);for(const h of this.animationGroups)D&&!D(h)||this.Th.removeAnimationGroup(h);for(const h of this.multiMaterials)D&&!D(h)||this.Th.removeMultiMaterial(h);for(const h of this.materials)D&&!D(h)||this.Th.removeMaterial(h);for(const h of this.morphTargetManagers)D&&!D(h)||this.Th.removeMorphTargetManager(h);for(const h of this.geometries)D&&!D(h)||this.Th.removeGeometry(h);for(const h of this.transformNodes)D&&!D(h)||this.Th.removeTransformNode(h);for(const h of this.actionManagers)D&&!D(h)||this.Th.removeActionManager(h);for(const h of this.textures)D&&!D(h)||this.Th.removeTexture(h);for(const h of this.reflectionProbes)D&&!D(h)||this.Th.removeReflectionProbe(h)}dispose(){const D=this.cameras.slice(0);for(const v of D)v.dispose();this.cameras.length=0;const h=this.lights.slice(0);for(const v of h)v.dispose();this.lights.length=0;const o=this.meshes.slice(0);for(const v of o)v.dispose();this.meshes.length=0;const H=this.skeletons.slice(0);for(const v of H)v.dispose();this.skeletons.length=0;const g=this.animationGroups.slice(0);for(const v of g)v.dispose();this.animationGroups.length=0;const j=this.multiMaterials.slice(0);for(const v of j)v.dispose();this.multiMaterials.length=0;const M=this.materials.slice(0);for(const v of M)v.dispose();this.materials.length=0;const R=this.geometries.slice(0);for(const v of R)v.dispose();this.geometries.length=0;const t=this.transformNodes.slice(0);for(const v of t)v.dispose();this.transformNodes.length=0;const S=this.actionManagers.slice(0);for(const v of S)v.dispose();this.actionManagers.length=0;const k=this.textures.slice(0);for(const v of k)v.dispose();this.textures.length=0;const K=this.reflectionProbes.slice(0);for(const v of K)v.dispose();this.reflectionProbes.length=0;const Q=this.morphTargetManagers.slice(0);for(const v of Q)v.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const v of this.Th._serializableComponents)v.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Th.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(D,h,o){if(D&&h)for(const H of D){let D=!0;if(o)for(const h of o)if(H===h){D=!1;break}D&&(h.push(H),H._parentContainer=this)}}moveAllFromScene(D){this._wasAddedToScene=!1,void 0===D&&(D=new s);for(const h in this)Object.prototype.hasOwnProperty.call(this,h)&&(this[h]=this[h]||("_environmentTexture"===h?null:[]),this._moveAssets(this.Th[h],this[h],D[h]));this.environmentTexture=this.Th.environmentTexture,this.removeAllFromScene()}createRootMesh(){const D=new M.d("assetContainerRootMesh",this.Th);for(const h of this.meshes)h.parent||D.addChild(h);return this.meshes.unshift(D),D}mergeAnimationsTo(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.d.LastCreatedScene,h=arguments.length>1?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!D)return S.d.Error("No scene available to merge animations to"),[];const H=o||(h=>{let o=null;const H=h.animations.length?h.animations[0].targetProperty:"",g=h.name.split(".").join("").split("_primitive")[0];switch(H){case"position":case"rotationQuaternion":o=D.getTransformNodeByName(h.name)||D.getTransformNodeByName(g);break;case"influence":o=D.getMorphTargetByName(h.name)||D.getMorphTargetByName(g);break;default:o=D.getNodeByName(h.name)||D.getNodeByName(g)}return o}),g=this.getNodes();for(const R of g){const D=H(R);if(null!==D){for(const h of R.animations){const o=D.animations.filter((D=>D.targetProperty===h.targetProperty));for(const h of o){const o=D.animations.indexOf(h,0);o>-1&&D.animations.splice(o,1)}}D.animations=D.animations.concat(R.animations)}}const j=[],M=this.animationGroups.slice();for(const R of M){j.push(R.clone(R.name,H));for(const D of R.animatables)D.stop()}for(const R of h){const h=H(R.target);h&&(D.beginAnimation(h,R.fromFrame,R.toFrame,R.loopAnimation,R.speedRatio,R.onAnimationEnd?R.onAnimationEnd:void 0,void 0,!0,void 0,R.onAnimationLoop?R.onAnimationLoop:void 0),D.stopAnimation(R.target))}return j}populateRootNodes(){this.rootNodes.length=0;for(const D of this.meshes)D.parent||-1!==this.rootNodes.indexOf(D)||this.rootNodes.push(D);for(const D of this.transformNodes)D.parent||-1!==this.rootNodes.indexOf(D)||this.rootNodes.push(D);for(const D of this.lights)D.parent||-1!==this.rootNodes.indexOf(D)||this.rootNodes.push(D);for(const D of this.cameras)D.parent||-1!==this.rootNodes.indexOf(D)||this.rootNodes.push(D)}addAllAssetsToContainer(D){if(!D)return;const h=[],o=new Set;for(h.push(D);h.length>0;){const D=h.pop();if(D instanceof M.d?(D.mg&&-1===this.geometries.indexOf(D.mg)&&this.geometries.push(D.mg),this.meshes.push(D)):D instanceof K.e?this.meshes.push(D):D instanceof R.c?this.transformNodes.push(D):D instanceof Q.c?this.lights.push(D):D instanceof v.b&&this.cameras.push(D),D instanceof t.e){if(D.material&&-1===this.materials.indexOf(D.material)){this.materials.push(D.material);for(const h of D.material.getActiveTextures())-1===this.textures.indexOf(h)&&this.textures.push(h)}D.skeleton&&-1===this.skeletons.indexOf(D.skeleton)&&this.skeletons.push(D.skeleton),D.morphTargetManager&&-1===this.morphTargetManagers.indexOf(D.morphTargetManager)&&this.morphTargetManagers.push(D.morphTargetManager)}for(const H of D.getChildren())o.has(H)||h.push(H);o.add(D)}this.populateRootNodes()}_getByTags(D,h,o){if(void 0===h)return D;const H=[];for(const g in D){const j=D[g];r.b&&r.b.MatchesQuery(j,h)&&(!o||o(j))&&H.push(j)}return H}getMeshesByTags(D,h){return this._getByTags(this.meshes,D,h)}getCamerasByTags(D,h){return this._getByTags(this.cameras,D,h)}getLightsByTags(D,h){return this._getByTags(this.lights,D,h)}getMaterialsByTags(D,h){return this._getByTags(this.materials,D,h).concat(this._getByTags(this.multiMaterials,D,h))}getTransformNodesByTags(D,h){return this._getByTags(this.transformNodes,D,h)}}var c=o(12702);class y{constructor(D){this.byteOffset=0,this.buffer=D}async loadAsync(D){const h=await this.buffer.readAsync(this.byteOffset,D);this._dataView=new DataView(h.buffer,h.byteOffset,h.byteLength),this._dataByteOffset=0}readUint32(){const D=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,D}readUint8Array(D){const h=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,D);return this._dataByteOffset+=D,this.byteOffset+=D,h}readString(D){return(0,c.g)(this.readUint8Array(D))}skipBytes(D){this._dataByteOffset+=D,this.byteOffset+=D}}var b=o(14306);const i="Z2xURg",G={name:"eh",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:D=>-1!==D.indexOf("asset")&&-1!==D.indexOf("version")||D.startsWith("data:base64,"+i)||D.startsWith("data:;base64,"+i)||D.startsWith("data:application/octet-stream;base64,"+i)||D.startsWith("data:model/gltf-binary;base64,"+i)};var N,J,O,E=o(12691),L=o(12698);function T(D,h,o){try{return Promise.resolve(new Uint8Array(D,h,o))}catch(H){return Promise.reject(H)}}!function(D){D[D.AUTO=0]="AUTO",D[D.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(N||(N={})),function(D){D[D.NONE=0]="NONE",D[D.FIRST=1]="FIRST",D[D.ALL=2]="ALL"}(J||(J={})),function(D){D[D.LOADING=0]="LOADING",D[D.READY=1]="READY",D[D.COMPLETE=2]="COMPLETE"}(O||(O={}));class Z{constructor(){this.coordinateSystemMode=N.AUTO,this.animationStartMode=J.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=D=>Promise.resolve(D),this.extensionOptions={}}M(D){D&&(this.onParsed=D.onParsed,this.coordinateSystemMode=D.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=D.animationStartMode??this.animationStartMode,this.loadNodeAnimations=D.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=D.loadSkins??this.loadSkins,this.loadMorphTargets=D.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=D.compileMaterials??this.compileMaterials,this.useClipPlane=D.useClipPlane??this.useClipPlane,this.compileShadowGenerators=D.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=D.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=D.useRangeRequests??this.useRangeRequests,this.createInstances=D.createInstances??this.createInstances,this.alwaysComputeBoundingBox=D.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=D.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=D.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=D.skipMaterials??this.skipMaterials,this.useSRGBBuffers=D.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=D.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=D.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=D.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=D.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=D.customRootNode,this.onMeshLoaded=D.onMeshLoaded,this.onSkinLoaded=D.onSkinLoaded,this.onTextureLoaded=D.onTextureLoaded,this.onMaterialLoaded=D.onMaterialLoaded,this.onCameraLoaded=D.onCameraLoaded,this.extensionOptions=D.extensionOptions??this.extensionOptions)}}class e extends Z{constructor(D){super(),this.onParsedObservable=new H.c,this.onMeshLoadedObservable=new H.c,this.onSkinLoadedObservable=new H.c,this.onTextureLoadedObservable=new H.c,this.onMaterialLoadedObservable=new H.c,this.onCameraLoadedObservable=new H.c,this.onCompleteObservable=new H.c,this.onErrorObservable=new H.c,this.Jh=new H.c,this.onExtensionLoadedObservable=new H.c,this.validate=!1,this.onValidatedObservable=new H.c,this._loader=null,this._state=null,this._requests=new Array,this.name=G.name,this.extensions=G.extensions,this.onLoaderStateChangedObservable=new H.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.M(D)}set onParsed(D){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),D&&(this._onParsedObserver=this.onParsedObservable.add(D))}set onMeshLoaded(D){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),D&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(D))}set onSkinLoaded(D){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),D&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((h=>D(h.node,h.skinnedNode))))}set onTextureLoaded(D){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),D&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(D))}set onMaterialLoaded(D){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),D&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(D))}set onCameraLoaded(D){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),D&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(D))}set onComplete(D){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(D)}set onError(D){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(D)}set onDispose(D){this._onDisposeObserver&&this.Jh.remove(this._onDisposeObserver),this._onDisposeObserver=this.Jh.add(D)}set onExtensionLoaded(D){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(D)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(D){this._loggingEnabled!==D&&(this._loggingEnabled=D,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(D){this._capturePerformanceCounters!==D&&(this._capturePerformanceCounters=D,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(D){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(D)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const D of this._requests)D.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=D=>Promise.resolve(D),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Jh.notifyObservers(void 0),this.Jh.clear()}loadFile(D,h,o,j,M,R,t,k){if(ArrayBuffer.isView(h))return this._loadBinary(D,h,o,j,t,k),null;this._progressCallback=M;const K=h.name||g.Tools.GetFilename(h);if(R){if(this.useRangeRequests){this.validate&&S.d.Warn("glTF validation is not supported when range requests are enabled");const o={abort:()=>{},onCompleteObservable:new H.c},g={readAsync:(o,H)=>new Promise(((g,j)=>{this._loadFile(D,h,(D=>{g(new Uint8Array(D))}),!0,(D=>{j(D)}),(D=>{D.setRequestHeader("Range",`bytes=${o}-${o+H-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new y(g)).then((D=>{o.onCompleteObservable.notifyObservers(o),j(D)}),t?D=>t(void 0,D):void 0),o}return this._loadFile(D,h,(h=>{this._validate(D,new Uint8Array(h,0,h.byteLength),o,K),this._unpackBinaryAsync(new y({readAsync:(D,o)=>T(h,D,o),byteLength:h.byteLength})).then((D=>{j(D)}),t?D=>t(void 0,D):void 0)}),!0,t)}return this._loadFile(D,h,(h=>{try{this._validate(D,h,o,K),j({json:this._parseJson(h)})}catch{t&&t()}}),!1,t)}_loadBinary(D,h,o,H,g,j){this._validate(D,new Uint8Array(h.buffer,h.byteOffset,h.byteLength),o,j),this._unpackBinaryAsync(new y({readAsync:(D,o)=>function(D,h,o){try{if(h<0||h>=D.byteLength)throw new RangeError("Offset is out of range.");if(h+o>D.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(D.buffer,D.byteOffset+h,o))}catch(H){return Promise.reject(H)}}(h,D,o),byteLength:h.byteLength})).then((D=>{H(D)}),g?D=>g(void 0,D):void 0)}importMeshAsync(D,h,o,H,g,j){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(o),this.onParsedObservable.clear(),this._log(`Loading ${j||""}`),this._loader=this._getLoader(o),this._loader.importMeshAsync(D,h,null,o,H,g,j))))}loadAsync(D,h,o,H,g){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(h),this.onParsedObservable.clear(),this._log(`Loading ${g||""}`),this._loader=this._getLoader(h),this._loader.loadAsync(D,h,o,H,g))))}loadAssetContainerAsync(D,h,o,H,g){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(h),this.onParsedObservable.clear(),this._log(`Loading ${g||""}`),this._loader=this._getLoader(h);const j=new q(D),M=[];this.onMaterialLoadedObservable.add((D=>{M.push(D)}));const R=[];this.onTextureLoadedObservable.add((D=>{R.push(D)}));const t=[];this.onCameraLoadedObservable.add((D=>{t.push(D)}));const S=[];return this.onMeshLoadedObservable.add((D=>{D.morphTargetManager&&S.push(D.morphTargetManager)})),this._loader.importMeshAsync(null,D,j,h,o,H,g).then((D=>(Array.prototype.push.apply(j.geometries,D.geometries),Array.prototype.push.apply(j.meshes,D.meshes),Array.prototype.push.apply(j.YQ,D.YQ),Array.prototype.push.apply(j.skeletons,D.skeletons),Array.prototype.push.apply(j.animationGroups,D.animationGroups),Array.prototype.push.apply(j.materials,M),Array.prototype.push.apply(j.textures,R),Array.prototype.push.apply(j.lights,D.lights),Array.prototype.push.apply(j.transformNodes,D.transformNodes),Array.prototype.push.apply(j.cameras,t),Array.prototype.push.apply(j.morphTargetManagers,S),j)))}))}canDirectLoad(D){return G.canDirectLoad(D)}directLoad(D,h){if(h.startsWith("base64,"+i)||h.startsWith(";base64,"+i)||h.startsWith("application/octet-stream;base64,"+i)||h.startsWith("model/gltf-binary;base64,"+i)){const o=(0,E.e)(h);return this._validate(D,new Uint8Array(o,0,o.byteLength)),this._unpackBinaryAsync(new y({readAsync:(D,h)=>T(o,D,h),byteLength:o.byteLength}))}return this._validate(D,h),Promise.resolve({json:this._parseJson(h)})}createPlugin(D){return new e(D[G.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((D,h)=>{this.onCompleteObservable.addOnce((()=>{D()})),this.onErrorObservable.addOnce((D=>{h(D)}))}))}_setState(D){this._state!==D&&(this._state=D,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(O[this._state]))}_loadFile(D,h,o,H,g,j){const M=D._loadFile(h,o,(D=>{this._onProgress(D,M)}),!0,H,g,j);return M.onCompleteObservable.add((()=>{M._lengthComputable=!0,M._total=M._loaded})),this._requests.push(M),M}_onProgress(D,h){if(!this._progressCallback)return;h._lengthComputable=D.lengthComputable,h._loaded=D.loaded,h._total=D.total;let o=!0,H=0,g=0;for(const j of this._requests){if(void 0===j._lengthComputable||void 0===j._loaded||void 0===j._total)return;o=o&&j._lengthComputable,H+=j._loaded,g+=j._total}this._progressCallback({lengthComputable:o,loaded:H,total:o?g:0})}_validate(D,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),b.c.ValidateAsync(h,o,H,(h=>this.preprocessUrlAsync(o+h).then((h=>D._loadFileAsync(h,void 0,!0,!0).then((D=>new Uint8Array(D,0,D.byteLength))))))).then((D=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(D),this.onValidatedObservable.clear()}),(D=>{this._endPerformanceCounter("Validate JSON"),g.Tools.Warn(`Failed to validate: ${D.message}`),this.onValidatedObservable.clear()})))}_getLoader(D){const h=D.json.asset||{};this._log(`Asset version: ${h.version}`),h.minVersion&&this._log(`Asset minimum version: ${h.minVersion}`),h.generator&&this._log(`Asset generator: ${h.generator}`);const o=e._parseVersion(h.version);if(!o)throw new Error("Invalid version: "+h.version);if(void 0!==h.minVersion){const D=e._parseVersion(h.minVersion);if(!D)throw new Error("Invalid minimum version: "+h.minVersion);if(e._compareVersion(D,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+h.minVersion)}const H={1:e._CreateGLTF1Loader,2:e._CreateGLTF2Loader}[o.major];if(!H)throw new Error("Unsupported version: "+h.version);return H(this)}_parseJson(D){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${D.length}`);const h=JSON.parse(D);return this._endPerformanceCounter("Parse JSON"),h}_unpackBinaryAsync(D){return this._startPerformanceCounter("Unpack Binary"),D.loadAsync(20).then((()=>{const h=D.readUint32();if(1179937895!==h)throw new L.i("Unexpected magic: "+h,L.g.GLTFLoaderUnexpectedMagicError);const o=D.readUint32();this.loggingEnabled&&this._log(`Binary version: ${o}`);const H=D.readUint32();let g;switch(this.useRangeRequests||H===D.buffer.byteLength||S.d.Warn(`Length in header does not match actual data length: ${H} != ${D.buffer.byteLength}`),o){case 1:g=this._unpackBinaryV1Async(D,H);break;case 2:g=this._unpackBinaryV2Async(D,H);break;default:throw new Error("Unsupported version: "+o)}return this._endPerformanceCounter("Unpack Binary"),g}))}_unpackBinaryV1Async(D,h){const o=D.readUint32(),H=D.readUint32();if(0!==H)throw new Error(`Unexpected content format: ${H}`);const g=h-D.byteOffset,j={json:this._parseJson(D.readString(o)),bin:null};if(0!==g){const h=D.byteOffset;j.bin={readAsync:(o,H)=>D.buffer.readAsync(h+o,H),byteLength:g}}return Promise.resolve(j)}_unpackBinaryV2Async(D,h){const o=1313821514,H=5130562,g=D.readUint32();if(D.readUint32()!==o)throw new Error("First chunk format is not JSON");return D.byteOffset+g===h?D.loadAsync(g).then((()=>({json:this._parseJson(D.readString(g)),bin:null}))):D.loadAsync(g+8).then((()=>{const j={json:this._parseJson(D.readString(g)),bin:null},M=()=>{const g=D.readUint32();switch(D.readUint32()){case o:throw new Error("Unexpected JSON chunk");case H:{const h=D.byteOffset;j.bin={readAsync:(o,H)=>D.buffer.readAsync(h+o,H),byteLength:g},D.skipBytes(g);break}default:D.skipBytes(g)}return D.byteOffset!==h?D.loadAsync(8).then(M):Promise.resolve(j)};return M()}))}static _parseVersion(D){if("1.0"===D||"1.0.1"===D)return{major:1,minor:0};const h=(D+"").match(/^(\d+)\.(\d+)/);return h?{major:parseInt(h[1]),minor:parseInt(h[2])}:null}static _compareVersion(D,h){return D.major>h.major?1:D.major<h.major?-1:D.minor>h.minor?1:D.minor<h.minor?-1:0}_logOpen(D){this._log(D),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(D){const h=e._logSpaces.substring(0,2*this._logIndentLevel);S.d.Log(`${h}${D}`)}_logDisabled(D){}_startPerformanceCounterEnabled(D){g.Tools.StartPerformanceCounter(D)}_startPerformanceCounterDisabled(D){}_endPerformanceCounterEnabled(D){g.Tools.EndPerformanceCounter(D)}_endPerformanceCounterDisabled(D){}}e.IncrementalLoading=!0,e.HomogeneousCoordinates=!1,e._logSpaces="                                ",(0,j.b)(new e)},14306:(D,h,o)=>{"use strict";o.d(h,{c:()=>M});var H=o(12642);function g(D,h,o,H){const g={externalResourceFunction:H};return o&&(g.uri="file:"===h?o:h+o),ArrayBuffer.isView(D)?GLTFValidator.validateBytes(D,g):GLTFValidator.validateString(D,g)}function j(){const D=[];onmessage=h=>{const o=h.data;switch(o.id){case"init":importScripts(o.url);break;case"validate":g(o.data,o.rootUrl,o.fileName,(h=>new Promise(((o,H)=>{const g=D.length;D.push({resolve:o,reject:H}),postMessage({id:"getExternalResource",index:g,uri:h})})))).then((D=>{postMessage({id:"validate.resolve",value:D})}),(D=>{postMessage({id:"validate.reject",reason:D})}));break;case"getExternalResource.resolve":D[o.index].resolve(o.value);break;case"getExternalResource.reject":D[o.index].reject(o.reason)}}}class M{static ValidateAsync(D,h,o,M){return"function"===typeof Worker?new Promise(((R,t)=>{const S=`${g}(${j})()`,k=URL.createObjectURL(new Blob([S],{type:"application/javascript"})),K=new Worker(k),Q=D=>{K.removeEventListener("error",Q),K.removeEventListener("message",v),t(D)},v=D=>{const h=D.data;switch(h.id){case"getExternalResource":M(h.uri).then((D=>{K.postMessage({id:"getExternalResource.resolve",index:h.index,value:D},[D.buffer])}),(D=>{K.postMessage({id:"getExternalResource.reject",index:h.index,reason:D})}));break;case"validate.resolve":K.removeEventListener("error",Q),K.removeEventListener("message",v),R(h.value),K.terminate();break;case"validate.reject":K.removeEventListener("error",Q),K.removeEventListener("message",v),t(h.reason),K.terminate()}};if(K.addEventListener("error",Q),K.addEventListener("message",v),K.postMessage({id:"init",url:H.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(D)){const H=D.slice();K.postMessage({id:"validate",data:H,rootUrl:h,fileName:o},[H.buffer])}else K.postMessage({id:"validate",data:D,rootUrl:h,fileName:o})})):(this._LoadScriptPromise||(this._LoadScriptPromise=H.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>g(D,h,o,M))))}}M.Configuration={url:`${H.Tools._DefaultCdnUrl}/gltf_validator.js`}},14899:(D,h,o)=>{"use strict";o.d(h,{d:()=>G});var H=o(12812),g=o(12815),j=o(12860),M=o(12831),R=o(13213),t=o(13148),S=o(12894),k=o(13065),K=o(12793),Q=o(12741);o(14077),o(13985),o(13994),o(13987),o(14e3),o(14007),o(14016);const v="imageProcessingCompatibility",r="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";Q.d.IncludesShadersStore[v]||(Q.d.IncludesShadersStore[v]=r);const B="skyPixelShader",s="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";Q.d.ShadersStore[B]||(Q.d.ShadersStore[B]=s);o(14086),o(14023),o(14029),o(14040),o(14035);const U="skyVertexShader",q="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";Q.d.ShadersStore[U]||(Q.d.ShadersStore[U]=q);var c=o(13139),y=o(13198),b=o(13189);class i extends R.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class G extends t.d{constructor(D,h){super(D,h),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new M.Gh(0,100,0),this.useSunPosition=!1,this.cameraOffset=M.Gh.Zero(),this.up=M.Gh.Up(),this.dithering=!1,this._cameraPosition=M.Gh.Zero(),this._skyOrientation=new M.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(D,h){const o=h._drawWrapper;if(this.isFrozen&&o.effect&&o._wasPreviouslyReady)return!0;h.materialDefines||(h.materialDefines=new i);const H=h.materialDefines,g=this.GD();if(this._isReadyForSubMesh(h))return!0;if((0,b.Q)(D,g,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,H),(0,b.G)(D,H,!0,!1),H.IMAGEPROCESSINGPOSTPROCESS!==g.imageProcessingConfiguration.applyByPostProcess&&H.markAsMiscDirty(),H.DITHER!==this.dithering&&H.markAsMiscDirty(),H.isDirty){H.markAsProcessed(),g.resetCachedMaterial();const D=new c.c;H.FOG&&D.addFallback(1,"FOG"),H.IMAGEPROCESSINGPOSTPROCESS=g.imageProcessingConfiguration.applyByPostProcess,H.DITHER=this.dithering;const o=[S.f.PositionKind];H.VERTEXCOLOR&&o.push(S.f.ColorKind);const j="sky",M=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,y.e)(M);const R=H.toString();h.setEffect(g.getEngine().createEffect(j,o,M,[],R,D,this.onCompiled,this.onError),H,this._materialContext)}return!(!h.effect||!h.effect.isReady())&&(H._renderId=g.getRenderId(),o._wasPreviouslyReady=!0,!0)}bindForSubMesh(D,h,o){const H=this.GD(),g=o.materialDefines;if(!g)return;const j=o.effect;if(!j)return;this._activeEffect=j,this.bindOnlyWorldMatrix(D),this._activeEffect.setMatrix("viewProjection",H.getTransformMatrix()),this._mustRebind(H,j,o)&&((0,y.g)(j,this,H),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,b.j)(g,j,H)),H.fogEnabled&&h.applyFog&&H.fogMode!==k.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",H.getViewMatrix()),(0,b.d)(H,h,this._activeEffect);const R=H.activeCamera;if(R){const D=R.getWorldMatrix();this._cameraPosition.x=D.m[12],this._cameraPosition.y=D.m[13],this._cameraPosition.z=D.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const D=Math.PI*(this.inclination-.5),h=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(h)*Math.cos(D),this.sunPosition.y=this.distance*Math.sin(-D),this.sunPosition.z=this.distance*Math.sin(h)*Math.cos(D),M.Quaternion.FromUnitVectorsToRef(M.Gh.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(h,this._activeEffect,o)}getAnimatables(){return[]}dispose(D){super.dispose(D)}clone(D){return j.d.Clone((()=>new G(D,this.GD())),this)}serialize(){const D=super.serialize();return D.customType="BABYLON.SkyMaterial",D}getClassName(){return"SkyMaterial"}static Parse(D,h,o){return j.d.Parse((()=>new G(D.name,h)),D,h,o)}}(0,H.c)([(0,g.I)()],G.prototype,"luminance",void 0),(0,H.c)([(0,g.I)()],G.prototype,"turbidity",void 0),(0,H.c)([(0,g.I)()],G.prototype,"rayleigh",void 0),(0,H.c)([(0,g.I)()],G.prototype,"mieCoefficient",void 0),(0,H.c)([(0,g.I)()],G.prototype,"mieDirectionalG",void 0),(0,H.c)([(0,g.I)()],G.prototype,"distance",void 0),(0,H.c)([(0,g.I)()],G.prototype,"inclination",void 0),(0,H.c)([(0,g.I)()],G.prototype,"azimuth",void 0),(0,H.c)([(0,g.H)()],G.prototype,"sunPosition",void 0),(0,H.c)([(0,g.I)()],G.prototype,"useSunPosition",void 0),(0,H.c)([(0,g.H)()],G.prototype,"cameraOffset",void 0),(0,H.c)([(0,g.H)()],G.prototype,"up",void 0),(0,H.c)([(0,g.I)()],G.prototype,"dithering",void 0),(0,K.g)("BABYLON.SkyMaterial",G)},13537:(D,h,o)=>{"use strict";function H(D,h){h.headers=D.headers||{},h.statusMessage=D.statusText,h.statusCode=D.status,h.data=D.response}function g(D,h,o){return new Promise((function(g,j){o=o||{};var M,R,t,S=new XMLHttpRequest,k=o.body,K=o.headers||{};for(M in o.timeout&&(S.timeout=o.timeout),S.ontimeout=S.onerror=function(D){D.timeout="timeout"==D.type,j(D)},S.open(D,h.href||h),S.onload=function(){for(t=S.getAllResponseHeaders().trim().split(/[\r\n]+/),H(S,S);R=t.shift();)R=R.split(": "),S.headers[R.shift().toLowerCase()]=R.join(": ");if((R=S.headers["content-type"])&&~R.indexOf("application/json"))try{S.data=JSON.parse(S.data,o.reviver)}catch(D){return H(S,D),j(D)}(S.status>=400?j:g)(S)},typeof FormData<"u"&&k instanceof FormData||k&&"object"==typeof k&&(K["content-type"]="application/json",k=JSON.stringify(k)),S.withCredentials=!!o.withCredentials,K)S.setRequestHeader(M,K[M]);S.send(k)}))}o.r(h),o.d(h,{del:()=>t,get:()=>j,patch:()=>R,post:()=>M,put:()=>S,send:()=>g});var j=g.bind(g,"GET"),M=g.bind(g,"POST"),R=g.bind(g,"PATCH"),t=g.bind(g,"DELETE"),S=g.bind(g,"PUT")},15013:(D,h,o)=>{"use strict";o.d(h,{b:()=>K});const H=.5*(Math.sqrt(3)-1),g=(3-Math.sqrt(3))/6,j=1/3,M=1/6,R=(Math.sqrt(5)-1)/4,t=(5-Math.sqrt(5))/20,S=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),k=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const K=class{constructor(){let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const h="function"==typeof D?D:function(D){let h=0,o=0,H=0,g=1;const j=function(){let D=4022871197;return function(h){h=h.toString();for(let o=0;o<h.length;o++){D+=h.charCodeAt(o);let H=.02519603282416938*D;D=H>>>0,H-=D,H*=D,D=H>>>0,H-=D,D+=4294967296*H}return 2.3283064365386963e-10*(D>>>0)}}();h=j(" "),o=j(" "),H=j(" "),h-=j(D),h<0&&(h+=1);o-=j(D),o<0&&(o+=1);H-=j(D),H<0&&(H+=1);return function(){const D=2091639*h+2.3283064365386963e-10*g;return h=o,o=H,H=D-(g=0|D)}}(D);this.p=function(D){const h=new Uint8Array(256);for(let o=0;o<256;o++)h[o]=o;for(let o=0;o<255;o++){const H=o+~~(D()*(256-o)),g=h[o];h[o]=h[H],h[H]=g}return h}(h),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let o=0;o<512;o++)this.perm[o]=this.p[255&o],this.permMod12[o]=this.perm[o]%12}noise2D(D,h){const o=this.permMod12,j=this.perm;let M=0,R=0,t=0;const k=(D+h)*H,K=Math.floor(D+k),Q=Math.floor(h+k),v=(K+Q)*g,r=D-(K-v),B=h-(Q-v);let s,U;r>B?(s=1,U=0):(s=0,U=1);const q=r-s+g,c=B-U+g,y=r-1+2*g,b=B-1+2*g,i=255&K,G=255&Q;let N=.5-r*r-B*B;if(N>=0){const D=3*o[i+j[G]];N*=N,M=N*N*(S[D]*r+S[D+1]*B)}let J=.5-q*q-c*c;if(J>=0){const D=3*o[i+s+j[G+U]];J*=J,R=J*J*(S[D]*q+S[D+1]*c)}let O=.5-y*y-b*b;if(O>=0){const D=3*o[i+1+j[G+1]];O*=O,t=O*O*(S[D]*y+S[D+1]*b)}return 70*(M+R+t)}noise3D(D,h,o){const H=this.permMod12,g=this.perm;let R,t,k,K;const Q=(D+h+o)*j,v=Math.floor(D+Q),r=Math.floor(h+Q),B=Math.floor(o+Q),s=(v+r+B)*M,U=D-(v-s),q=h-(r-s),c=o-(B-s);let y,b,i,G,N,J;U>=q?q>=c?(y=1,b=0,i=0,G=1,N=1,J=0):U>=c?(y=1,b=0,i=0,G=1,N=0,J=1):(y=0,b=0,i=1,G=1,N=0,J=1):q<c?(y=0,b=0,i=1,G=0,N=1,J=1):U<c?(y=0,b=1,i=0,G=0,N=1,J=1):(y=0,b=1,i=0,G=1,N=1,J=0);const O=U-y+M,E=q-b+M,L=c-i+M,T=U-G+2*M,Z=q-N+2*M,e=c-J+2*M,p=U-1+.5,mD=q-1+.5,a=c-1+.5,u=255&v,I=255&r,P=255&B;let n=.6-U*U-q*q-c*c;if(n<0)R=0;else{const D=3*H[u+g[I+g[P]]];n*=n,R=n*n*(S[D]*U+S[D+1]*q+S[D+2]*c)}let F=.6-O*O-E*E-L*L;if(F<0)t=0;else{const D=3*H[u+y+g[I+b+g[P+i]]];F*=F,t=F*F*(S[D]*O+S[D+1]*E+S[D+2]*L)}let w=.6-T*T-Z*Z-e*e;if(w<0)k=0;else{const D=3*H[u+G+g[I+N+g[P+J]]];w*=w,k=w*w*(S[D]*T+S[D+1]*Z+S[D+2]*e)}let Y=.6-p*p-mD*mD-a*a;if(Y<0)K=0;else{const D=3*H[u+1+g[I+1+g[P+1]]];Y*=Y,K=Y*Y*(S[D]*p+S[D+1]*mD+S[D+2]*a)}return 32*(R+t+k+K)}noise4D(D,h,o,H){const g=this.perm;let j,M,S,K,Q;const v=(D+h+o+H)*R,r=Math.floor(D+v),B=Math.floor(h+v),s=Math.floor(o+v),U=Math.floor(H+v),q=(r+B+s+U)*t,c=D-(r-q),y=h-(B-q),b=o-(s-q),i=H-(U-q);let G=0,N=0,J=0,O=0;c>y?G++:N++,c>b?G++:J++,c>i?G++:O++,y>b?N++:J++,y>i?N++:O++,b>i?J++:O++;const E=G>=3?1:0,L=N>=3?1:0,T=J>=3?1:0,Z=O>=3?1:0,e=G>=2?1:0,p=N>=2?1:0,mD=J>=2?1:0,a=O>=2?1:0,u=G>=1?1:0,I=N>=1?1:0,P=J>=1?1:0,n=O>=1?1:0,F=c-E+t,w=y-L+t,Y=b-T+t,l=i-Z+t,C=c-e+2*t,z=y-p+2*t,f=b-mD+2*t,V=i-a+2*t,d=c-u+3*t,X=y-I+3*t,A=b-P+3*t,W=i-n+3*t,x=c-1+4*t,DD=y-1+4*t,hD=b-1+4*t,oD=i-1+4*t,HD=255&r,gD=255&B,jD=255&s,MD=255&U;let RD=.6-c*c-y*y-b*b-i*i;if(RD<0)j=0;else{const D=g[HD+g[gD+g[jD+g[MD]]]]%32*4;RD*=RD,j=RD*RD*(k[D]*c+k[D+1]*y+k[D+2]*b+k[D+3]*i)}let tD=.6-F*F-w*w-Y*Y-l*l;if(tD<0)M=0;else{const D=g[HD+E+g[gD+L+g[jD+T+g[MD+Z]]]]%32*4;tD*=tD,M=tD*tD*(k[D]*F+k[D+1]*w+k[D+2]*Y+k[D+3]*l)}let SD=.6-C*C-z*z-f*f-V*V;if(SD<0)S=0;else{const D=g[HD+e+g[gD+p+g[jD+mD+g[MD+a]]]]%32*4;SD*=SD,S=SD*SD*(k[D]*C+k[D+1]*z+k[D+2]*f+k[D+3]*V)}let kD=.6-d*d-X*X-A*A-W*W;if(kD<0)K=0;else{const D=g[HD+u+g[gD+I+g[jD+P+g[MD+n]]]]%32*4;kD*=kD,K=kD*kD*(k[D]*d+k[D+1]*X+k[D+2]*A+k[D+3]*W)}let KD=.6-x*x-DD*DD-hD*hD-oD*oD;if(KD<0)Q=0;else{const D=g[HD+1+g[gD+1+g[jD+1+g[MD+1]]]]%32*4;KD*=KD,Q=KD*KD*(k[D]*x+k[D+1]*DD+k[D+2]*hD+k[D+3]*oD)}return 27*(j+M+S+K+Q)}}}}]);