/*! For license information please see ofq5wc.32.2b8d10ed.chunk.js.LICENSE.txt */
(self.c2c3ycupenc=self.c2c3ycupenc||[]).push([[32],{13672:(c,r,D)=>{"use strict";var W=D(13680),B=D(13682),t=D(13688);D.g.__TYPEDARRAY_POOL||(D.g.__TYPEDARRAY_POOL={UINT8:B([32,0]),UINT16:B([32,0]),UINT32:B([32,0]),INT8:B([32,0]),INT16:B([32,0]),INT32:B([32,0]),FLOAT:B([32,0]),DOUBLE:B([32,0]),DATA:B([32,0]),UINT8C:B([32,0]),BUFFER:B([32,0])});var u="undefined"!==typeof Uint8ClampedArray,a=D.g.__TYPEDARRAY_POOL;a.UINT8C||(a.UINT8C=B([32,0])),a.BUFFER||(a.BUFFER=B([32,0]));var H=a.DATA,x=a.BUFFER;function M(c){if(c){var r=c.length||c.byteLength,D=W.log2(r);H[D].push(c)}}function E(c){c=W.nextPow2(c);var r=W.log2(c),D=H[r];return D.length>0?D.pop():new ArrayBuffer(c)}function m(c){return new Uint8Array(E(c),0,c)}function Y(c){return new Uint16Array(E(2*c),0,c)}function v(c){return new Uint32Array(E(4*c),0,c)}function k(c){return new Int8Array(E(c),0,c)}function w(c){return new Int16Array(E(2*c),0,c)}function Z(c){return new Int32Array(E(4*c),0,c)}function J(c){return new Float32Array(E(4*c),0,c)}function q(c){return new Float64Array(E(8*c),0,c)}function j(c){return u?new Uint8ClampedArray(E(c),0,c):m(c)}function X(c){return new DataView(E(c),0,c)}r.free=function(c){if(t(c))x[W.log2(c.length)].push(c);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(c)&&(c=c.buffer),!c)return;var r=c.length||c.byteLength,D=0|W.log2(r);H[D].push(c)}},r.freeUint8=r.freeUint16=r.freeUint32=r.freeInt8=r.freeInt16=r.freeInt32=r.freeFloat32=r.freeFloat=r.freeFloat64=r.freeDouble=r.freeUint8Clamped=r.freeDataView=function(c){M(c.buffer)},r.freeArrayBuffer=M,r.freeBuffer=function(c){x[W.log2(c.length)].push(c)},r.malloc=function(c,r){if(void 0===r||"arraybuffer"===r)return E(c);switch(r){case"uint8":return m(c);case"uint16":return Y(c);case"uint32":return v(c);case"int8":return k(c);case"int16":return w(c);case"int32":return Z(c);case"float":case"float32":return J(c);case"double":case"float64":return q(c);case"uint8_clamped":return j(c);case"buffer":throw"Buffer not supported";case"data":case"dataview":return X(c);default:return null}return null},r.mallocArrayBuffer=E,r.mallocUint8=m,r.mallocUint16=Y,r.mallocUint32=v,r.mallocInt8=k,r.mallocInt16=w,r.mallocInt32=Z,r.mallocFloat32=r.mallocFloat=J,r.mallocFloat64=r.mallocDouble=q,r.mallocUint8Clamped=j,r.mallocDataView=X,r.clearCache=function(){for(var c=0;c<32;++c)a.UINT8[c].length=0,a.UINT16[c].length=0,a.UINT32[c].length=0,a.INT8[c].length=0,a.INT16[c].length=0,a.INT32[c].length=0,a.FLOAT[c].length=0,a.DOUBLE[c].length=0,a.UINT8C[c].length=0,H[c].length=0,x[c].length=0}},13753:(c,r,D)=>{c.exports=B;var W=D(12486);function B(c,r){if(!(this instanceof B))return new B(c,r);var D=W.create();W.add(D,c,r),this.base=W.min(W.create(),c,D),this.DM=W.clone(r),this.max=W.max(W.create(),c,D),this.mag=W.length(this.DM)}var t=B.prototype;t.width=function(){return this.DM[0]},t.height=function(){return this.DM[1]},t.depth=function(){return this.DM[2]},t.x0=function(){return this.base[0]},t.y0=function(){return this.base[1]},t.z0=function(){return this.base[2]},t.x1=function(){return this.max[0]},t.y1=function(){return this.max[1]},t.z1=function(){return this.max[2]},t.translate=function(c){return W.add(this.max,this.max,c),W.add(this.base,this.base,c),this},t.setPosition=function(c){return W.add(this.max,c,this.DM),W.i(this.base,c),this},t.expand=function(c){var r=W.create(),D=W.create();return W.max(r,c.max,this.max),W.min(D,c.base,this.base),W.Jr(r,r,D),new B(D,r)},t.intersects=function(c){return!(c.base[0]>this.max[0])&&(!(c.base[1]>this.max[1])&&(!(c.base[2]>this.max[2])&&(!(c.max[0]<this.base[0])&&(!(c.max[1]<this.base[1])&&!(c.max[2]<this.base[2])))))},t.touches=function(c){var r=this.union(c);return null!==r&&(0==r.width()||0==r.height()||0==r.depth())},t.union=function(c){if(!this.intersects(c))return null;var r=Math.max(c.base[0],this.base[0]),D=Math.max(c.base[1],this.base[1]),W=Math.max(c.base[2],this.base[2]);return new B([r,D,W],[Math.min(c.max[0],this.max[0])-r,Math.min(c.max[1],this.max[1])-D,Math.min(c.max[2],this.max[2])-W])}},13680:(c,r)=>{"use strict";function D(c){var r=32;return(c&=-c)&&r--,65535&c&&(r-=16),16711935&c&&(r-=8),252645135&c&&(r-=4),858993459&c&&(r-=2),1431655765&c&&(r-=1),r}r.INT_BITS=32,r.INT_MAX=2147483647,r.INT_MIN=-1<<31,r.sign=function(c){return(c>0)-(c<0)},r.abs=function(c){var r=c>>31;return(c^r)-r},r.min=function(c,r){return r^(c^r)&-(c<r)},r.max=function(c,r){return c^(c^r)&-(c<r)},r.isPow2=function(c){return!(c&c-1)&&!!c},r.log2=function(c){var r,D;return r=(c>65535)<<4,r|=D=((c>>>=r)>255)<<3,r|=D=((c>>>=D)>15)<<2,(r|=D=((c>>>=D)>3)<<1)|(c>>>=D)>>1},r.log10=function(c){return c>=1e9?9:c>=1e8?8:c>=1e7?7:c>=1e6?6:c>=1e5?5:c>=1e4?4:c>=1e3?3:c>=100?2:c>=10?1:0},r.popCount=function(c){return 16843009*((c=(858993459&(c-=c>>>1&1431655765))+(c>>>2&858993459))+(c>>>4)&252645135)>>>24},r.countTrailingZeros=D,r.nextPow2=function(c){return c+=0===c,--c,c|=c>>>1,c|=c>>>2,c|=c>>>4,c|=c>>>8,(c|=c>>>16)+1},r.prevPow2=function(c){return c|=c>>>1,c|=c>>>2,c|=c>>>4,c|=c>>>8,(c|=c>>>16)-(c>>>1)},r.parity=function(c){return c^=c>>>16,c^=c>>>8,c^=c>>>4,27030>>>(c&=15)&1};var W=new Array(256);!function(c){for(var r=0;r<256;++r){var D=r,W=r,B=7;for(D>>>=1;D;D>>>=1)W<<=1,W|=1&D,--B;c[r]=W<<B&255}}(W),r.reverse=function(c){return W[255&c]<<24|W[c>>>8&255]<<16|W[c>>>16&255]<<8|W[c>>>24&255]},r.interleave2=function(c,r){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r&=65535)|r<<8))|r<<4))|r<<2))|r<<1))<<1},r.deinterleave2=function(c,r){return(c=65535&((c=16711935&((c=252645135&((c=858993459&((c=c>>>r&1431655765)|c>>>1))|c>>>2))|c>>>4))|c>>>16))<<16>>16},r.interleave3=function(c,r,D){return c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2),(c|=(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<1)|(D=1227133513&((D=3272356035&((D=251719695&((D=4278190335&((D&=1023)|D<<16))|D<<8))|D<<4))|D<<2))<<2},r.deinterleave3=function(c,r){return(c=1023&((c=4278190335&((c=251719695&((c=3272356035&((c=c>>>r&1227133513)|c>>>2))|c>>>4))|c>>>8))|c>>>16))<<22>>22},r.nextCombination=function(c){var r=c|c-1;return r+1|(~r&-~r)-1>>>D(c)+1}},13663:(c,r,D)=>{"use strict";c.exports=function(c,r,D){switch(arguments.length){case 1:return W=[],x(B=c,B,M,!0),W;case 2:return"function"===typeof r?x(c,c,r,!0):function(c,r){return W=[],x(c,r,M,!1),W}(c,r);case 3:return x(c,r,D,!1);default:throw new Error("box-intersect: Invalid arguments")}var B};var W,B=D(13672),t=D(13690),u=D(13699);function a(c,r){for(var D=0;D<c;++D)if(!(r[D]<=r[D+c]))return!0;return!1}function H(c,r,D,W){for(var B=0,t=0,u=0,H=c.length;u<H;++u){var x=c[u];if(!a(r,x)){for(var M=0;M<2*r;++M)D[B++]=x[M];W[t++]=u}}return t}function x(c,r,D,W){var a=c.length,x=r.length;if(!(a<=0||x<=0)){var M=c[0].length>>>1;if(!(M<=0)){var E,m=B.mallocDouble(2*M*a),Y=B.mallocInt32(a);if((a=H(c,M,m,Y))>0){if(1===M&&W)t.init(a),E=t.sweepComplete(M,D,0,a,m,Y,0,a,m,Y);else{var v=B.mallocDouble(2*M*x),k=B.mallocInt32(x);(x=H(r,M,v,k))>0&&(t.init(a+x),E=1===M?t.sweepBipartite(M,D,0,a,m,Y,0,x,v,k):u(M,D,W,a,m,Y,x,v,k),B.free(v),B.free(k))}B.free(m),B.free(Y)}return E}}}function M(c,r){W.push([c,r])}},13707:(c,r)=>{"use strict";var D="d",W="ax",B="fp",t="es",u="rs",a="re",H="rb",x="bs",M="be",E="bb",m=[D,W,"vv",u,a,H,"ri",x,M,E,"bi"];function Y(c){var r="bruteForce"+(c?"Full":"Partial"),W=[],u=m.slice();c||u.splice(3,0,B);var a=["function "+r+"("+u.join()+"){"];function H(r,B){var u=function(c,r,W){var B="bruteForce"+(c?"Red":"Blue")+(r?"Flip":"")+(W?"Full":""),u=["function ",B,"(",m.join(),"){","var ",t,"=2*",D,";"],a="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",H="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(W?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return c?u.push(a,"Q",":",H):u.push(H,"Q",":",a),W?u.push("if(y1<x0||x1<y0)continue;"):r?u.push("if(y0<=x0||x1<y0)continue;"):u.push("if(y0<x0||x1<y0)continue;"),u.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),r?u.push("yi,xi"):u.push("xi,yi"),u.push(");if(rv!==void 0)return rv;}}}"),{name:B,code:u.join("")}}(r,B,c);W.push(u.code),a.push("return "+u.name+"("+m.join()+");")}a.push("if(re-rs>be-bs){"),c?(H(!0,!1),a.push("}else{"),H(!1,!1)):(a.push("if(fp){"),H(!0,!0),a.push("}else{"),H(!0,!1),a.push("}}else{if(fp){"),H(!1,!0),a.push("}else{"),H(!1,!1),a.push("}")),a.push("}}return "+r);var x=W.join("")+a.join("");return new Function(x)()}r.partial=Y(!1),r.full=Y(!0)},13699:(c,r,D)=>{"use strict";c.exports=function(c,r,D,t,M,z,S,K,f){!function(c,r){var D=8*B.log2(r+1)*(c+1)|0,t=B.nextPow2(j*D);e.length<t&&(W.free(e),e=W.mallocInt32(t));var u=B.nextPow2(X*D);y.length<u&&(W.free(y),y=W.mallocDouble(u))}(c,t+S);var A,h=0,L=2*c;U(h++,0,0,t,0,S,D?16:0,-1/0,1/0),D||U(h++,0,0,S,0,t,1,-1/0,1/0);for(;h>0;){var P=(h-=1)*j,G=e[P],d=e[P+1],T=e[P+2],b=e[P+3],O=e[P+4],C=e[P+5],p=h*X,R=y[p],s=y[p+1],o=1&C,Q=!!(16&C),l=M,F=z,I=K,i=f;if(o&&(l=K,F=f,I=M,i=z),!(2&C&&d>=(T=w(c,G,d,T,l,F,s)))&&!(4&C&&(d=Z(c,G,d,T,l,F,R))>=T)){var n=T-d,V=O-b;if(Q){if(c*n*(n+V)<Y){if(void 0!==(A=H.scanComplete(c,G,r,d,T,l,F,b,O,I,i)))return A;continue}}else{if(c*Math.min(n,V)<E){if(void 0!==(A=u(c,G,r,o,d,T,l,F,b,O,I,i)))return A;continue}if(c*n*V<m){if(void 0!==(A=H.scanBipartite(c,G,r,o,d,T,l,F,b,O,I,i)))return A;continue}}var cc=v(c,G,d,T,l,F,R,s);if(d<cc)if(c*(cc-d)<E){if(void 0!==(A=a(c,G+1,r,d,cc,l,F,b,O,I,i)))return A}else if(G===c-2){if(void 0!==(A=o?H.sweepBipartite(c,r,b,O,I,i,d,cc,l,F):H.sweepBipartite(c,r,d,cc,l,F,b,O,I,i)))return A}else U(h++,G+1,d,cc,b,O,o,-1/0,1/0),U(h++,G+1,b,O,d,cc,1^o,-1/0,1/0);if(cc<T){var rc=x(c,G,b,O,I,i),Dc=I[L*rc+G],Wc=k(c,G,rc,O,I,i,Dc);if(Wc<O&&U(h++,G,cc,T,Wc,O,(4|o)+(Q?16:0),Dc,s),b<rc&&U(h++,G,cc,T,b,rc,(2|o)+(Q?16:0),R,Dc),rc+1===Wc){if(void 0!==(A=Q?g(c,G,r,cc,T,l,F,rc,I,i[rc]):N(c,G,r,o,cc,T,l,F,rc,I,i[rc])))return A}else if(rc<Wc){var Bc;if(Q){if(cc<(Bc=J(c,G,cc,T,l,F,Dc))){var tc=k(c,G,cc,Bc,l,F,Dc);if(G===c-2){if(cc<tc&&void 0!==(A=H.sweepComplete(c,r,cc,tc,l,F,rc,Wc,I,i)))return A;if(tc<Bc&&void 0!==(A=H.sweepBipartite(c,r,tc,Bc,l,F,rc,Wc,I,i)))return A}else cc<tc&&U(h++,G+1,cc,tc,rc,Wc,16,-1/0,1/0),tc<Bc&&(U(h++,G+1,tc,Bc,rc,Wc,0,-1/0,1/0),U(h++,G+1,rc,Wc,tc,Bc,1,-1/0,1/0))}}else cc<(Bc=o?q(c,G,cc,T,l,F,Dc):J(c,G,cc,T,l,F,Dc))&&(G===c-2?A=o?H.sweepBipartite(c,r,rc,Wc,I,i,cc,Bc,l,F):H.sweepBipartite(c,r,cc,Bc,l,F,rc,Wc,I,i):(U(h++,G+1,cc,Bc,rc,Wc,o,-1/0,1/0),U(h++,G+1,rc,Wc,cc,Bc,1^o,-1/0,1/0)))}}}}};var W=D(13672),B=D(13680),t=D(13707),u=t.partial,a=t.full,H=D(13690),x=D(13712),M=D(13715),E=128,m=1<<22,Y=1<<22,v=M("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),k=M("lo===p0",["p0"]),w=M("lo<p0",["p0"]),Z=M("hi<=p0",["p0"]),J=M("lo<=p0&&p0<=hi",["p0"]),q=M("lo<p0&&p0<=hi",["p0"]),j=6,X=2,e=W.mallocInt32(1024),y=W.mallocDouble(1024);function U(c,r,D,W,B,t,u,a,H){var x=j*c;e[x]=r,e[x+1]=D,e[x+2]=W,e[x+3]=B,e[x+4]=t,e[x+5]=u;var M=X*c;y[M]=a,y[M+1]=H}function N(c,r,D,W,B,t,u,a,H,x,M){var E=2*c,m=H*E,Y=x[m+r];c:for(var v=B,k=B*E;v<t;++v,k+=E){var w=u[k+r],Z=u[k+r+c];if(!(Y<w||Z<Y)&&(!W||Y!==w)){for(var J,q=a[v],j=r+1;j<c;++j){w=u[k+j],Z=u[k+j+c];var X=x[m+j],e=x[m+j+c];if(Z<X||e<w)continue c}if(void 0!==(J=W?D(M,q):D(q,M)))return J}}}function g(c,r,D,W,B,t,u,a,H,x){var M=2*c,E=a*M,m=H[E+r];c:for(var Y=W,v=W*M;Y<B;++Y,v+=M){var k=u[Y];if(k!==x){var w=t[v+r],Z=t[v+r+c];if(!(m<w||Z<m)){for(var J=r+1;J<c;++J){w=t[v+J],Z=t[v+J+c];var q=H[E+J],j=H[E+J+c];if(Z<q||j<w)continue c}var X=D(k,x);if(void 0!==X)return X}}}}},13712:(c,r,D)=>{"use strict";c.exports=function(c,r,D,u,a,H){if(u<=D+1)return D;var x=D,M=u,E=u+D>>>1,m=2*c,Y=E,v=a[m*E+r];for(;x<M;){if(M-x<B){t(c,r,x,M,a,H),v=a[m*E+r];break}var k=M-x,w=Math.random()*k+x|0,Z=a[m*w+r],J=Math.random()*k+x|0,q=a[m*J+r],j=Math.random()*k+x|0,X=a[m*j+r];Z<=q?X>=q?(Y=J,v=q):Z>=X?(Y=w,v=Z):(Y=j,v=X):q>=X?(Y=J,v=q):X>=Z?(Y=w,v=Z):(Y=j,v=X);for(var e=m*(M-1),y=m*Y,U=0;U<m;++U,++e,++y){var N=a[e];a[e]=a[y],a[y]=N}var g=H[M-1];H[M-1]=H[Y],H[Y]=g;for(e=m*(M-1),y=m*(Y=W(c,r,x,M-1,a,H,v)),U=0;U<m;++U,++e,++y){N=a[e];a[e]=a[y],a[y]=N}g=H[M-1];if(H[M-1]=H[Y],H[Y]=g,E<Y){for(M=Y-1;x<M&&a[m*(M-1)+r]===v;)M-=1;M+=1}else{if(!(Y<E))break;for(x=Y+1;x<M&&a[m*x+r]===v;)x+=1}}return W(c,r,D,E,a,H,a[m*E+r])};var W=D(13715)("lo<p0",["p0"]),B=8;function t(c,r,D,W,B,t){for(var u=2*c,a=u*(D+1)+r,H=D+1;H<W;++H,a+=u)for(var x=B[a],M=H,E=u*(H-1);M>D&&B[E+r]>x;--M,E-=u){for(var m=E,Y=E+u,v=0;v<u;++v,++m,++Y){var k=B[m];B[m]=B[Y],B[Y]=k}var w=t[M];t[M]=t[M-1],t[M-1]=w}}},13715:c=>{"use strict";c.exports=function(c,D){var W="abcdef".split("").concat(D),B=[];c.indexOf("lo")>=0&&B.push("lo=e[k+n]");c.indexOf("hi")>=0&&B.push("hi=e[k+o]");return W.push(r.replace("_",B.join()).replace("$",c)),Function.apply(void 0,W)};var r="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13692:c=>{"use strict";c.exports=function(c,W){W<=4*r?D(0,W-1,c):x(0,W-1,c)};var r=32;function D(c,r,D){for(var W=2*(c+1),B=c+1;B<=r;++B){for(var t=D[W++],u=D[W++],a=B,H=W-2;a-- >c;){var x=D[H-2],M=D[H-1];if(x<t)break;if(x===t&&M<u)break;D[H]=x,D[H+1]=M,H-=2}D[H]=t,D[H+1]=u}}function W(c,r,D){r*=2;var W=D[c*=2],B=D[c+1];D[c]=D[r],D[c+1]=D[r+1],D[r]=W,D[r+1]=B}function B(c,r,D){r*=2,D[c*=2]=D[r],D[c+1]=D[r+1]}function t(c,r,D,W){r*=2,D*=2;var B=W[c*=2],t=W[c+1];W[c]=W[r],W[c+1]=W[r+1],W[r]=W[D],W[r+1]=W[D+1],W[D]=B,W[D+1]=t}function u(c,r,D,W,B){r*=2,B[c*=2]=B[r],B[r]=D,B[c+1]=B[r+1],B[r+1]=W}function a(c,r,D){r*=2;var W=D[c*=2],B=D[r];return!(W<B)&&(W!==B||D[c+1]>D[r+1])}function H(c,r,D,W){var B=W[c*=2];return B<r||B===r&&W[c+1]<D}function x(c,M,E){var m=(M-c+1)/6|0,Y=c+m,v=M-m,k=c+M>>1,w=k-m,Z=k+m,J=Y,q=w,j=k,X=Z,e=v,y=c+1,U=M-1,N=0;a(J,q,E)&&(N=J,J=q,q=N),a(X,e,E)&&(N=X,X=e,e=N),a(J,j,E)&&(N=J,J=j,j=N),a(q,j,E)&&(N=q,q=j,j=N),a(J,X,E)&&(N=J,J=X,X=N),a(j,X,E)&&(N=j,j=X,X=N),a(q,e,E)&&(N=q,q=e,e=N),a(q,j,E)&&(N=q,q=j,j=N),a(X,e,E)&&(N=X,X=e,e=N);for(var g=E[2*q],z=E[2*q+1],S=E[2*X],K=E[2*X+1],f=2*J,A=2*j,h=2*e,L=2*Y,P=2*k,G=2*v,d=0;d<2;++d){var T=E[f+d],b=E[A+d],O=E[h+d];E[L+d]=T,E[P+d]=b,E[G+d]=O}B(w,c,E),B(Z,M,E);for(var C=y;C<=U;++C)if(H(C,g,z,E))C!==y&&W(C,y,E),++y;else if(!H(C,S,K,E))for(;;){if(H(U,S,K,E)){H(U,g,z,E)?(t(C,y,U,E),++y,--U):(W(C,U,E),--U);break}if(--U<C)break}u(c,y-1,g,z,E),u(M,U+1,S,K,E),y-2-c<=r?D(c,y-2,E):x(c,y-2,E),M-(U+2)<=r?D(U+2,M,E):x(U+2,M,E),U-y<=r?D(y,U,E):x(y,U,E)}},13690:(c,r,D)=>{"use strict";c.exports={init:function(c){var r=B.nextPow2(c);H.length<r&&(W.free(H),H=W.mallocInt32(r));x.length<r&&(W.free(x),x=W.mallocInt32(r));M.length<r&&(W.free(M),M=W.mallocInt32(r));E.length<r&&(W.free(E),E=W.mallocInt32(r));m.length<r&&(W.free(m),m=W.mallocInt32(r));Y.length<r&&(W.free(Y),Y=W.mallocInt32(r));var D=8*r;v.length<D&&(W.free(v),v=W.mallocDouble(D))},sweepBipartite:function(c,r,D,W,B,a,m,Y,Z,J){for(var q=0,j=2*c,X=c-1,e=j-1,y=D;y<W;++y){var U=a[y],N=j*y;v[q++]=B[N+X],v[q++]=-(U+1),v[q++]=B[N+e],v[q++]=U}for(y=m;y<Y;++y){U=J[y]+u;var g=j*y;v[q++]=Z[g+X],v[q++]=-U,v[q++]=Z[g+e],v[q++]=U}var z=q>>>1;t(v,z);var S=0,K=0;for(y=0;y<z;++y){var f=0|v[2*y+1];if(f>=u)k(M,E,K--,f=f-u|0);else if(f>=0)k(H,x,S--,f);else if(f<=-u){f=-f-u|0;for(var A=0;A<S;++A){if(void 0!==(h=r(H[A],f)))return h}w(M,E,K++,f)}else{f=-f-1|0;for(A=0;A<K;++A){var h;if(void 0!==(h=r(f,M[A])))return h}w(H,x,S++,f)}}},sweepComplete:function(c,r,D,W,B,u,a,Z,J,q){for(var j=0,X=2*c,e=c-1,y=X-1,U=D;U<W;++U){var N=u[U]+1<<1,g=X*U;v[j++]=B[g+e],v[j++]=-N,v[j++]=B[g+y],v[j++]=N}for(U=a;U<Z;++U){N=q[U]+1<<1;var z=X*U;v[j++]=J[z+e],v[j++]=1|-N,v[j++]=J[z+y],v[j++]=1|N}var S=j>>>1;t(v,S);var K=0,f=0,A=0;for(U=0;U<S;++U){var h=0|v[2*U+1],L=1&h;if(U<S-1&&h>>1===v[2*U+3]>>1&&(L=2,U+=1),h<0){for(var P=-(h>>1)-1,G=0;G<A;++G){if(void 0!==(d=r(m[G],P)))return d}if(0!==L)for(G=0;G<K;++G){if(void 0!==(d=r(H[G],P)))return d}if(1!==L)for(G=0;G<f;++G){var d;if(void 0!==(d=r(M[G],P)))return d}0===L?w(H,x,K++,P):1===L?w(M,E,f++,P):2===L&&w(m,Y,A++,P)}else{P=(h>>1)-1;0===L?k(H,x,K--,P):1===L?k(M,E,f--,P):2===L&&k(m,Y,A--,P)}}},scanBipartite:function(c,r,D,W,B,a,M,E,m,Y,Z,J){var q=0,j=2*c,X=r,e=r+c,y=1,U=1;W?U=u:y=u;for(var N=B;N<a;++N){var g=N+y,z=j*N;v[q++]=M[z+X],v[q++]=-g,v[q++]=M[z+e],v[q++]=g}for(N=m;N<Y;++N){g=N+U;var S=j*N;v[q++]=Z[S+X],v[q++]=-g}var K=q>>>1;t(v,K);var f=0;for(N=0;N<K;++N){var A=0|v[2*N+1];if(A<0){var h=!1;if((g=-A)>=u?(h=!W,g-=u):(h=!!W,g-=1),h)w(H,x,f++,g);else{var L=J[g],P=j*g,G=Z[P+r+1],d=Z[P+r+1+c];c:for(var T=0;T<f;++T){var b=H[T],O=j*b;if(!(d<M[O+r+1]||M[O+r+1+c]<G)){for(var C=r+2;C<c;++C)if(Z[P+C+c]<M[O+C]||M[O+C+c]<Z[P+C])continue c;var p,R=E[b];if(void 0!==(p=W?D(L,R):D(R,L)))return p}}}}else k(H,x,f--,A-y)}},scanComplete:function(c,r,D,W,B,a,x,M,E,m,Y){for(var k=0,w=2*c,Z=r,J=r+c,q=W;q<B;++q){var j=q+u,X=w*q;v[k++]=a[X+Z],v[k++]=-j,v[k++]=a[X+J],v[k++]=j}for(q=M;q<E;++q){j=q+1;var e=w*q;v[k++]=m[e+Z],v[k++]=-j}var y=k>>>1;t(v,y);var U=0;for(q=0;q<y;++q){var N=0|v[2*q+1];if(N<0){if((j=-N)>=u)H[U++]=j-u;else{var g=Y[j-=1],z=w*j,S=m[z+r+1],K=m[z+r+1+c];c:for(var f=0;f<U;++f){var A=H[f],h=x[A];if(h===g)break;var L=w*A;if(!(K<a[L+r+1]||a[L+r+1+c]<S)){for(var P=r+2;P<c;++P)if(m[z+P+c]<a[L+P]||a[L+P+c]<m[z+P])continue c;var G=D(h,g);if(void 0!==G)return G}}}}else{for(j=N-u,f=U-1;f>=0;--f)if(H[f]===j){for(P=f+1;P<U;++P)H[P-1]=H[P];break}--U}}}};var W=D(13672),B=D(13680),t=D(13692),u=1<<28,a=1024,H=W.mallocInt32(a),x=W.mallocInt32(a),M=W.mallocInt32(a),E=W.mallocInt32(a),m=W.mallocInt32(a),Y=W.mallocInt32(a),v=W.mallocDouble(8192);function k(c,r,D,W){var B=r[W],t=c[D-1];c[B]=t,r[t]=B}function w(c,r,D,W){c[D]=W,r[W]=D}},13682:c=>{"use strict";function r(c,D,W){var B=0|c[W];if(B<=0)return[];var t,u=new Array(B);if(W===c.length-1)for(t=0;t<B;++t)u[t]=D;else for(t=0;t<B;++t)u[t]=r(c,D,W+1);return u}c.exports=function(c,D){switch("undefined"===typeof D&&(D=0),typeof c){case"number":if(c>0)return function(c,r){var D,W;for(D=new Array(c),W=0;W<c;++W)D[W]=r;return D}(0|c,D);break;case"object":if("number"===typeof c.length)return r(c,D,0)}return[]}},13632:(c,r,D)=>{c.exports=function(){var c=this;this.components={},this.comps=this.components;var r=this.components,D=1,B={},t=[],u=[],a={timeout:!1,removals:[],multiComps:[]};function H(c,D){var W=r[D],t=B[D],u=t.hash[c];u&&(t.remove(c),W.hr&&(W.multi?(u.forEach((r=>{r&&W.hr(c,r)})),u.length=0):W.hr(c,u)),a.removals.push(t),x())}function x(){a.timeout||(a.timeout=!0,setTimeout(M,1))}function M(){a.timeout=!1,E()}function E(){a.multiComps.length&&function(c){for(var r=0;r<c.length;r++){var{entID:D,data:W}=c[r],B=W.hash[D];if(B){for(var t=0;t<B.length;t++)B[t]||(B.splice(t,1),t--);0===B.length&&(W.remove(D),a.removals.push(W))}}c.length=0}(a.multiComps),a.removals.length&&function(c){for(var r=0;r<c.length;r++){c[r].flush()}c.length=0}(a.removals)}this.wE=B,this._systems=t,this._renderSystems=u,this.tM=function(r){var W=D++;return Array.isArray(r)&&r.forEach((r=>c.LH(W,r))),W},this.deleteEntity=function(r){return Object.keys(B).forEach((c=>{B[c].hash[r]&&H(r,c)})),c},this.jM=function(c){if(!c)throw new Error("Missing component definition");var D=c.name;if(!D)throw new Error("Component definition must have a name property.");if("string"!==typeof D)throw new Error("Component name must be a string.");if(""===D)throw new Error("Component name must be a non-empty string.");if(B[D])throw new Error(`Component ${D} already exists.`);var a={};return a.name=D,a.multi=!!c.multi,a.order=isNaN(c.order)?99:c.order,a.stateConstructor=c.stateConstructor||null,a.state=c.state||{},a.Aa=c.Aa||null,a.hr=c.hr||null,a.system=c.system||null,a.Ta=c.Ta||null,r[D]=a,B[D]=new W,B[D]._pendingMultiCleanup=!1,B[D]._multiCleanupIDs=a.multi?[]:null,a.system&&(t.push(D),t.sort(((c,D)=>r[c].order-r[D].order))),a.Ta&&(u.push(D),u.sort(((c,D)=>r[c].order-r[D].order))),D},this.overwriteComponent=function(c,D){var W=r[c];if(!W)throw new Error(`Unknown component: ${c}`);if(!D)throw new Error("Missing component definition");if(W.name!==D.name)throw new Error("Overwriting component must use the same name property.");var a={};a.name=c,a.multi=!!D.multi,a.order=isNaN(D.order)?99:D.order,a.state=D.state||{},a.Aa=D.Aa||null,a.hr=D.hr||null,a.system=D.system||null,a.Ta=D.Ta||null,r[c]=a,B[c]._pendingMultiCleanup=!1,B[c]._multiCleanupIDs=a.multi?[]:null;var H=t.indexOf(c);a.system&&H<0&&t.push(c),!a.system&&H>=0&&t.splice(H,1),t.sort(((c,D)=>r[c].order-r[D].order));var x=u.indexOf(c);a.Ta&&x<0&&u.push(c),!a.Ta&&x>=0&&u.splice(x,1),u.sort(((c,D)=>r[c].order-r[D].order));var M=a.state;return this.Tx(c).forEach((c=>{for(var r in M)r in c||(c[r]=M[r]);a.Aa&&a.Aa(c.Ga,c)})),c},this.deleteComponent=function(D){var W=B[D];if(!W)throw new Error(`Unknown component: ${D}`);W.flush(),W.list.forEach((c=>{c&&H(c.Ga||c[0].Ga,D)}));var a=t.indexOf(D),x=u.indexOf(D);return a>-1&&t.splice(a,1),x>-1&&u.splice(x,1),B[D].dispose(),delete B[D],delete r[D],c},this.LH=function(c,D,W){var t,u=r[D],a=B[D];if(!a)throw new Error(`Unknown component: ${D}.`);if(a.hash[c]&&!u.multi)throw new Error(`Entity ${c} already has component: ${D}.`);if(u.stateConstructor){if(!(t=new u.stateConstructor).hasOwnProperty("Ga"))throw new Error(`Component ${u.name} stateConstructor type does not have property __id`)}else t=Object.assign({},{Ga:c},u.state,W);if(t.Ga=c,u.multi){var H=a.hash[c];H||(H=[],a.add(c,H)),H.push(t)}else a.add(c,t);return u.Aa&&u.Aa(c,t),this},this.sH=function(c,r){var D=B[r];if(!D)throw new Error(`Unknown component: ${r}.`);return!!D.hash[c]},this.TH=function(r,D){if(!B[D])throw new Error(`Unknown component: ${D}.`);return H(r,D),c},this.getState=function(c,r){var D=B[r];if(!D)throw new Error(`Unknown component: ${r}.`);return D.hash[c]},this.Tx=function(c){var r=B[c];if(!r)throw new Error(`Unknown component: ${c}.`);return E(),r.list},this.aY=function(c){if(!B[c])throw new Error(`Unknown component: ${c}.`);var r=B[c].hash;return c=>r[c]},this.MY=function(c){if(!B[c])throw new Error(`Unknown component: ${c}.`);var r=B[c].hash;return c=>!!r[c]},this.ra=function(D){E();for(var W=0;W<t.length;W++){var u=t[W],a=r[u],H=B[u];a.system(D,H.list),E()}return c},this.render=function(D){E();for(var W=0;W<u.length;W++){var t=u[W],a=r[t],H=B[t];a.Ta(D,H.list),E()}return c},this.removeMultiComponent=function(D,W,t){var u=r[W],H=B[W];if(!H)throw new Error(`Unknown component: ${W}.`);if(!u.multi)throw new Error("removeMultiComponent called on non-multi component");return function(c,r,D,W){var B=D.hash[c];if(B){var t=B[W];t&&(B[W]=null,r.hr&&r.hr(c,t),a.multiComps.push({entID:c,data:D}),x())}}(D,u,H,t),c}};var W=D(13639)},13639:c=>{function r(c,r){var D=c._map[r];if(delete c.hash[r],delete c._map[r],D===c.list.length-1)c.list.pop();else{var W=c.list.pop();if(c.list[D]=W,null===W||null===W[0]){var B=c.list.length;for(var t in c._map)if(c._map[t]===B)return void(c._map[t]=D)}else{var u=W.Ga||W[0].Ga;c._map[u]=D}}}c.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(c,r){if("number"===typeof this._map[c]){var D=this._map[c];this.hash[c]=r,this.list[D]=r}else this._map[c]=this.list.length,this.hash[c]=r,this.list.push(r)}remove(c){var r=this._map[c];this.hash[c]=null,this.list[r]=null,this._pendingRemovals.push(c)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var c=0;c<this._pendingRemovals.length;c++){var D=this._pendingRemovals[c];null===this.hash[D]&&r(this,D)}this._pendingRemovals.length=0}}},13589:c=>{"use strict";var r,D="object"===typeof Reflect?Reflect:null,W=function(c,r,D){return Function.prototype.apply.call(c,r,D)};r=D&&"function"===typeof D.ownKeys?D.ownKeys:Object.getOwnPropertySymbols?function(c){return Object.getOwnPropertyNames(c).concat(Object.getOwnPropertySymbols(c))}:function(c){return Object.getOwnPropertyNames(c)};var B=Number.isNaN||function(c){return c!==c};function t(){t.init.call(this)}c.exports=t,c.exports.once=function(c,r){return new Promise((function(D,W){function B(D){c.removeListener(r,t),W(D)}function t(){"function"===typeof c.removeListener&&c.removeListener("error",B),D([].slice.call(arguments))}k(c,r,t,{once:!0}),"error"!==r&&function(c,r,D){"function"===typeof c.on&&k(c,"error",r,D)}(c,B,{once:!0})}))},t.EventEmitter=t,t.prototype._events=void 0,t.prototype._eventsCount=0,t.prototype._maxListeners=void 0;var u=10;function a(c){if("function"!==typeof c)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof c)}function H(c){return void 0===c._maxListeners?t.defaultMaxListeners:c._maxListeners}function x(c,r,D,W){var B,t,u,x;if(a(D),void 0===(t=c._events)?(t=c._events=Object.create(null),c._eventsCount=0):(void 0!==t.newListener&&(c.emit("newListener",r,D.listener?D.listener:D),t=c._events),u=t[r]),void 0===u)u=t[r]=D,++c._eventsCount;else if("function"===typeof u?u=t[r]=W?[D,u]:[u,D]:W?u.unshift(D):u.push(D),(B=H(c))>0&&u.length>B&&!u.warned){u.warned=!0;var M=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");M.name="MaxListenersExceededWarning",M.tr=c,M.type=r,M.count=u.length,x=M,console&&console.warn&&console.warn(x)}return c}function M(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function E(c,r,D){var W={fired:!1,wrapFn:void 0,target:c,type:r,listener:D},B=M.bind(W);return B.listener=D,W.wrapFn=B,B}function m(c,r,D){var W=c._events;if(void 0===W)return[];var B=W[r];return void 0===B?[]:"function"===typeof B?D?[B.listener||B]:[B]:D?function(c){for(var r=new Array(c.length),D=0;D<r.length;++D)r[D]=c[D].listener||c[D];return r}(B):v(B,B.length)}function Y(c){var r=this._events;if(void 0!==r){var D=r[c];if("function"===typeof D)return 1;if(void 0!==D)return D.length}return 0}function v(c,r){for(var D=new Array(r),W=0;W<r;++W)D[W]=c[W];return D}function k(c,r,D,W){if("function"===typeof c.on)W.once?c.once(r,D):c.on(r,D);else{if("function"!==typeof c.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof c);c.addEventListener(r,(function B(t){W.once&&c.removeEventListener(r,B),D(t)}))}}Object.defineProperty(t,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(c){if("number"!==typeof c||c<0||B(c))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+c+".");u=c}}),t.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},t.prototype.setMaxListeners=function(c){if("number"!==typeof c||c<0||B(c))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+c+".");return this._maxListeners=c,this},t.prototype.getMaxListeners=function(){return H(this)},t.prototype.emit=function(c){for(var r=[],D=1;D<arguments.length;D++)r.push(arguments[D]);var B="error"===c,t=this._events;if(void 0!==t)B=B&&void 0===t.error;else if(!B)return!1;if(B){var u;if(r.length>0&&(u=r[0]),u instanceof Error)throw u;var a=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw a.context=u,a}var H=t[c];if(void 0===H)return!1;if("function"===typeof H)W(H,this,r);else{var x=H.length,M=v(H,x);for(D=0;D<x;++D)W(M[D],this,r)}return!0},t.prototype.addListener=function(c,r){return x(this,c,r,!1)},t.prototype.on=t.prototype.addListener,t.prototype.prependListener=function(c,r){return x(this,c,r,!0)},t.prototype.once=function(c,r){return a(r),this.on(c,E(this,c,r)),this},t.prototype.prependOnceListener=function(c,r){return a(r),this.prependListener(c,E(this,c,r)),this},t.prototype.removeListener=function(c,r){var D,W,B,t,u;if(a(r),void 0===(W=this._events))return this;if(void 0===(D=W[c]))return this;if(D===r||D.listener===r)0===--this._eventsCount?this._events=Object.create(null):(delete W[c],W.removeListener&&this.emit("removeListener",c,D.listener||r));else if("function"!==typeof D){for(B=-1,t=D.length-1;t>=0;t--)if(D[t]===r||D[t].listener===r){u=D[t].listener,B=t;break}if(B<0)return this;0===B?D.shift():function(c,r){for(;r+1<c.length;r++)c[r]=c[r+1];c.pop()}(D,B),1===D.length&&(W[c]=D[0]),void 0!==W.removeListener&&this.emit("removeListener",c,u||r)}return this},t.prototype.off=t.prototype.removeListener,t.prototype.ur=function(c){var r,D,W;if(void 0===(D=this._events))return this;if(void 0===D.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==D[c]&&(0===--this._eventsCount?this._events=Object.create(null):delete D[c]),this;if(0===arguments.length){var B,t=Object.keys(D);for(W=0;W<t.length;++W)"removeListener"!==(B=t[W])&&this.ur(B);return this.ur("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(r=D[c]))this.removeListener(c,r);else if(void 0!==r)for(W=r.length-1;W>=0;W--)this.removeListener(c,r[W]);return this},t.prototype.listeners=function(c){return m(this,c,!0)},t.prototype.rawListeners=function(c){return m(this,c,!1)},t.listenerCount=function(c,r){return"function"===typeof c.listenerCount?c.listenerCount(r):Y.call(c,r)},t.prototype.listenerCount=Y,t.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},13907:c=>{"use strict";c.exports=function(c,r,D,W,B,t){var u=+r[0],a=+r[1],H=+r[2],x=+D[0],M=+D[1],E=+D[2],m=Math.sqrt(x*x+M*M+E*E);if(0===m)throw new Error("Can't raycast along a zero vector");return function(c,r,D,W,B,t,u,a,H,x){for(var M=0,E=Math.floor,m=0|E(r),Y=0|E(D),v=0|E(W),k=B>0?1:-1,w=t>0?1:-1,Z=u>0?1:-1,J=Math.abs(1/B),q=Math.abs(1/t),j=Math.abs(1/u),X=J<1/0?J*(k>0?m+1-r:r-m):1/0,e=q<1/0?q*(w>0?Y+1-D:D-Y):1/0,y=j<1/0?j*(Z>0?v+1-W:W-v):1/0,U=-1;M<=a;){var N=c(m,Y,v);if(N)return H&&(H[0]=r+M*B,H[1]=D+M*t,H[2]=W+M*u),x&&(x[0]=x[1]=x[2]=0,0===U&&(x[0]=-k),1===U&&(x[1]=-w),2===U&&(x[2]=-Z)),N;X<e?X<y?(m+=k,M=X,X+=J,U=0):(v+=Z,M=y,y+=j,U=2):e<y?(Y+=w,M=e,e+=q,U=1):(v+=Z,M=y,y+=j,U=2)}return H&&(H[0]=r+M*B,H[1]=D+M*t,H[2]=W+M*u),x&&(x[0]=x[1]=x[2]=0),0}(c,u,a,H,x/=m,M/=m,E/=m,W="undefined"===typeof W?64:+W,B,t)}},13941:(c,r,D)=>{"use strict";D.d(r,{c:()=>t});var W=D(13589);function B(){this.um=!1,this.stopPropagation=!1,this.am=!1,this.disabled=!1}class t{constructor(c,r){this.version="0.7.0";var D=Object.assign({},new B,r||{});this.element=c||document,this.um=!!D.um,this.stopPropagation=!!D.stopPropagation,this.am=!!D.am,this.disabled=!!D.disabled,this.filterEvents=(c,r)=>!0,this.down=new W.EventEmitter,this.up=new W.EventEmitter,this.state={},this.Kx={dx:0,dy:0,nm:0,Sx:0,Vm:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?a(this):document.addEventListener("DOMContentLoaded",(c=>{a(this)}),{once:!0})}bind(c){for(var r=arguments.length,D=new Array(r>1?r-1:0),W=1;W<r;W++)D[W-1]=arguments[W];D.forEach((r=>{var D=this._keyBindmap[r]||[];D.includes(c)||(D.push(c),this._keyBindmap[r]=D)})),this.state[c]=!!this.state[c],this.pressCount[c]=this.pressCount[c]||0,this.releaseCount[c]=this.releaseCount[c]||0}unbind(c){for(var r in this._keyBindmap){var D=this._keyBindmap[r],W=D.indexOf(c);W>-1&&D.splice(W,1)}}getBindings(){var c={};for(var r in this._keyBindmap){this._keyBindmap[r].forEach((D=>{c[D]=c[D]||[],c[D].push(r)}))}return c}ra(){u(this.Kx),u(this.pressCount),u(this.releaseCount)}}function u(c){for(var r in c)c[r]=0}function a(c){window.addEventListener("keydown",v.bind(null,c,!0),!1),window.addEventListener("keyup",v.bind(null,c,!1),!1);var r={passive:!0};c.element.addEventListener("touchstart",E.bind(void 0,c),{passive:!1}),c.element.addEventListener("touchend",Y.bind(void 0,c),r),c.element.addEventListener("mousedown",k.bind(null,c,!0),r),window.document.addEventListener("mouseup",k.bind(null,c,!1),r),c.element.addEventListener("touchmove",w.bind(null,c),r),c.element.addEventListener("mousemove",w.bind(null,c),r),window.PointerEvent,c.element.addEventListener("wheel",Z.bind(null,c),r),c.element.addEventListener("contextmenu",J.bind(null,c),!1),window.addEventListener("blur",q.bind(null,c),!1)}var H=0,x=0,M=null;function E(c,r){r.preventDefault(),m(r)}function m(c){let r=!1;for(let D=0;D<c.touches.length;++D)if(c.touches[D].identifier===M){r=!0;break}if(!r){const r=c.changedTouches[0];H=r.clientX,x=r.clientY,M=r.identifier}}function Y(c,r){for(var D=r.changedTouches,W=0;W<D.length;++W)D[W].identifier===M&&(M=null)}function v(c,r,D){j(D.code,r,c,D)}function k(c,r,D){if("pointerId"in D)if(r){if(null!==c._touches.currID)return;c._touches.currID=D.pointerId}else{if(c._touches.currID!==D.pointerId)return;c._touches.currID=null}return j("Mouse"+("button"in D?D.button+1:1),r,c,D),!1}function w(c,r){var D=r.movementX||r.mozMovementX||0,W=r.movementY||r.mozMovementY||0;if(r.touches&&0===(D|W)){var B=function(c){m(c);for(let r=0;r<c.changedTouches.length;++r)if(c.changedTouches[r].identifier==M){const D=c.changedTouches[r],W=[D.clientX-H,D.clientY-x];return H=D.clientX,x=D.clientY,W}return console.error(`Did not find touch id ${M}`),[0,0]}(r);D=B[0],W=B[1]}c.Kx.dx+=D,c.Kx.dy+=W}function Z(c,r){var D=1;switch(r.deltaMode){case 0:D=1;break;case 1:D=12;break;case 2:D=c.element.clientHeight||window.innerHeight}c.Kx.nm+=(r.deltaX||0)*D,c.Kx.Sx+=(r.deltaY||0)*D,c.Kx.Vm+=(r.deltaZ||0)*D}function J(c,r){if(!c.am)return r.preventDefault(),!1}function q(c){for(var r in c._keyStates)c._keyStates[r]&&(/^Mouse\d/.test(r)||j(r,!1,c,{code:r,note:"phwcz1puyn",preventDefault:()=>{},stopPropagation:()=>{}}))}function j(c,r,D,W){var B=D._keyBindmap[c];B&&(X(D._keyStates[c],r)&&(D._keyStates[c]=r,B.forEach((c=>{(!D.filterEvents||D.filterEvents(W,c))&&function(c,r,D,W){var B=r?D.pressCount:D.releaseCount;B[c]=(B[c]||0)+1;var t=D._bindPressCount[c]||0;(t+=r?1:-1)<0&&(t=0);D._bindPressCount[c]=t;var u=D.state[c];if(X(u,t)){D.state[c]=t>0;var a=r?D.down:D.up;D.disabled||a.emit(c,W)}}(c,r,D,W)}))),"button"in W||(D.um&&!W.defaultPrevented&&W.preventDefault(),D.stopPropagation&&W.stopPropagation()))}function X(c,r){return c?!r:r}},12552:c=>{c.exports=function(c,r,D){return c[0]=r[0]+D[0],c[1]=r[1]+D[1],c[2]=r[2]+D[2],c}},12503:(c,r,D)=>{c.exports=function(c,r){var D=W(c[0],c[1],c[2]),u=W(r[0],r[1],r[2]);B(D,D),B(u,u);var a=t(D,u);return a>1?0:Math.acos(a)};var W=D(12507),B=D(12513),t=D(12519)},12616:c=>{c.exports=function(c,r){return c[0]=Math.ceil(r[0]),c[1]=Math.ceil(r[1]),c[2]=Math.ceil(r[2]),c}},12501:c=>{c.exports=function(c){var r=new Float32Array(3);return r[0]=c[0],r[1]=c[1],r[2]=c[2],r}},12523:c=>{c.exports=function(c,r){return c[0]=r[0],c[1]=r[1],c[2]=r[2],c}},12497:c=>{c.exports=function(){var c=new Float32Array(3);return c[0]=0,c[1]=0,c[2]=0,c}},12694:c=>{c.exports=function(c,r,D){var W=r[0],B=r[1],t=r[2],u=D[0],a=D[1],H=D[2];return c[0]=B*H-t*a,c[1]=t*u-W*H,c[2]=W*a-B*u,c}},12646:(c,r,D)=>{c.exports=D(12641)},12641:c=>{c.exports=function(c,r){var D=r[0]-c[0],W=r[1]-c[1],B=r[2]-c[2];return Math.sqrt(D*D+W*W+B*B)}},12590:(c,r,D)=>{c.exports=D(12582)},12582:c=>{c.exports=function(c,r,D){return c[0]=r[0]/D[0],c[1]=r[1]/D[1],c[2]=r[2]/D[2],c}},12519:c=>{c.exports=function(c,r){return c[0]*r[0]+c[1]*r[1]+c[2]*r[2]}},12488:c=>{c.exports=1e-6},12535:(c,r,D)=>{c.exports=function(c,r){var D=c[0],B=c[1],t=c[2],u=r[0],a=r[1],H=r[2];return Math.abs(D-u)<=W*Math.max(1,Math.abs(D),Math.abs(u))&&Math.abs(B-a)<=W*Math.max(1,Math.abs(B),Math.abs(a))&&Math.abs(t-H)<=W*Math.max(1,Math.abs(t),Math.abs(H))};var W=D(12488)},12543:c=>{c.exports=function(c,r){return c[0]===r[0]&&c[1]===r[1]&&c[2]===r[2]}},12608:c=>{c.exports=function(c,r){return c[0]=Math.floor(r[0]),c[1]=Math.floor(r[1]),c[2]=Math.floor(r[2]),c}},12743:(c,r,D)=>{c.exports=function(c,r,D,B,t,u){var a,H;r||(r=3);D||(D=0);H=B?Math.min(B*r+D,c.length):c.length;for(a=D;a<H;a+=r)W[0]=c[a],W[1]=c[a+1],W[2]=c[a+2],t(W,W,u),c[a]=W[0],c[a+1]=W[1],c[a+2]=W[2];return c};var W=D(12497)()},12507:c=>{c.exports=function(c,r,D){var W=new Float32Array(3);return W[0]=c,W[1]=r,W[2]=D,W}},12486:(c,r,D)=>{c.exports={EPSILON:D(12488),create:D(12497),clone:D(12501),angle:D(12503),ou:D(12507),i:D(12523),set:D(12529),equals:D(12535),exactEquals:D(12543),add:D(12552),Jr:D(12555),sub:D(12559),multiply:D(12568),mul:D(12575),divide:D(12582),div:D(12590),min:D(12593),max:D(12601),floor:D(12608),ceil:D(12616),round:D(12624),scale:D(12629),Qu:D(12634),distance:D(12641),k:D(12646),squaredDistance:D(12653),sqrDist:D(12655),length:D(12660),len:D(12664),squaredLength:D(12667),lu:D(12675),negate:D(12684),inverse:D(12689),normalize:D(12513),dot:D(12519),cross:D(12694),pu:D(12699),random:D(12707),transformMat4:D(12709),transformMat3:D(12715),transformQuat:D(12717),Fu:D(12726),Iu:D(12733),iu:D(12735),forEach:D(12743)}},12689:c=>{c.exports=function(c,r){return c[0]=1/r[0],c[1]=1/r[1],c[2]=1/r[2],c}},12664:(c,r,D)=>{c.exports=D(12660)},12660:c=>{c.exports=function(c){var r=c[0],D=c[1],W=c[2];return Math.sqrt(r*r+D*D+W*W)}},12699:c=>{c.exports=function(c,r,D,W){var B=r[0],t=r[1],u=r[2];return c[0]=B+W*(D[0]-B),c[1]=t+W*(D[1]-t),c[2]=u+W*(D[2]-u),c}},12601:c=>{c.exports=function(c,r,D){return c[0]=Math.max(r[0],D[0]),c[1]=Math.max(r[1],D[1]),c[2]=Math.max(r[2],D[2]),c}},12593:c=>{c.exports=function(c,r,D){return c[0]=Math.min(r[0],D[0]),c[1]=Math.min(r[1],D[1]),c[2]=Math.min(r[2],D[2]),c}},12575:(c,r,D)=>{c.exports=D(12568)},12568:c=>{c.exports=function(c,r,D){return c[0]=r[0]*D[0],c[1]=r[1]*D[1],c[2]=r[2]*D[2],c}},12684:c=>{c.exports=function(c,r){return c[0]=-r[0],c[1]=-r[1],c[2]=-r[2],c}},12513:c=>{c.exports=function(c,r){var D=r[0],W=r[1],B=r[2],t=D*D+W*W+B*B;t>0&&(t=1/Math.sqrt(t),c[0]=r[0]*t,c[1]=r[1]*t,c[2]=r[2]*t);return c}},12707:c=>{c.exports=function(c,r){r=r||1;var D=2*Math.random()*Math.PI,W=2*Math.random()-1,B=Math.sqrt(1-W*W)*r;return c[0]=Math.cos(D)*B,c[1]=Math.sin(D)*B,c[2]=W*r,c}},12726:c=>{c.exports=function(c,r,D,W){var B=D[1],t=D[2],u=r[1]-B,a=r[2]-t,H=Math.sin(W),x=Math.cos(W);return c[0]=r[0],c[1]=B+u*x-a*H,c[2]=t+u*H+a*x,c}},12733:c=>{c.exports=function(c,r,D,W){var B=D[0],t=D[2],u=r[0]-B,a=r[2]-t,H=Math.sin(W),x=Math.cos(W);return c[0]=B+a*H+u*x,c[1]=r[1],c[2]=t+a*x-u*H,c}},12735:c=>{c.exports=function(c,r,D,W){var B=D[0],t=D[1],u=r[0]-B,a=r[1]-t,H=Math.sin(W),x=Math.cos(W);return c[0]=B+u*x-a*H,c[1]=t+u*H+a*x,c[2]=r[2],c}},12624:c=>{c.exports=function(c,r){return c[0]=Math.round(r[0]),c[1]=Math.round(r[1]),c[2]=Math.round(r[2]),c}},12629:c=>{c.exports=function(c,r,D){return c[0]=r[0]*D,c[1]=r[1]*D,c[2]=r[2]*D,c}},12634:c=>{c.exports=function(c,r,D,W){return c[0]=r[0]+D[0]*W,c[1]=r[1]+D[1]*W,c[2]=r[2]+D[2]*W,c}},12529:c=>{c.exports=function(c,r,D,W){return c[0]=r,c[1]=D,c[2]=W,c}},12655:(c,r,D)=>{c.exports=D(12653)},12675:(c,r,D)=>{c.exports=D(12667)},12653:c=>{c.exports=function(c,r){var D=r[0]-c[0],W=r[1]-c[1],B=r[2]-c[2];return D*D+W*W+B*B}},12667:c=>{c.exports=function(c){var r=c[0],D=c[1],W=c[2];return r*r+D*D+W*W}},12559:(c,r,D)=>{c.exports=D(12555)},12555:c=>{c.exports=function(c,r,D){return c[0]=r[0]-D[0],c[1]=r[1]-D[1],c[2]=r[2]-D[2],c}},12715:c=>{c.exports=function(c,r,D){var W=r[0],B=r[1],t=r[2];return c[0]=W*D[0]+B*D[3]+t*D[6],c[1]=W*D[1]+B*D[4]+t*D[7],c[2]=W*D[2]+B*D[5]+t*D[8],c}},12709:c=>{c.exports=function(c,r,D){var W=r[0],B=r[1],t=r[2],u=D[3]*W+D[7]*B+D[11]*t+D[15];return u=u||1,c[0]=(D[0]*W+D[4]*B+D[8]*t+D[12])/u,c[1]=(D[1]*W+D[5]*B+D[9]*t+D[13])/u,c[2]=(D[2]*W+D[6]*B+D[10]*t+D[14])/u,c}},12717:c=>{c.exports=function(c,r,D){var W=r[0],B=r[1],t=r[2],u=D[0],a=D[1],H=D[2],x=D[3],M=x*W+a*t-H*B,E=x*B+H*W-u*t,m=x*t+u*B-a*W,Y=-u*W-a*B-H*t;return c[0]=M*x+Y*-u+E*-H-m*-a,c[1]=E*x+Y*-a+m*-u-M*-H,c[2]=m*x+Y*-H+M*-a-E*-u,c}},13611:c=>{"use strict";c.exports=function(c){for(var r=new Array(c),D=0;D<c;++D)r[D]=D;return r}},13688:c=>{c.exports=function(c){return null!=c&&null!=c.constructor&&"function"===typeof c.constructor.isBuffer&&c.constructor.isBuffer(c)}},13915:(c,r,D)=>{"use strict";D.d(r,{c:()=>W});class W{constructor(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.CM=!1,this.pM=!1,this.bM=30,this.OM=0,this.iM=!1,this.fullscreen=!1,this.sM=function(c){},this.oM=function(){},this.FM=function(){},this.br=function(){},this.QM=function(c){},this.onFullscreenChanged=function(c){},x((()=>{!function(c,r){c._nowObject=performance||Date,c._lastTick=0,c._renderAccum=0,c._rt=0,c._frameCB=a.bind(null,c),requestAnimationFrame(c._frameCB),r>0&&(c._intervalCB=u.bind(null,c),c._interval=setInterval(c._intervalCB,Math.max(r,1e3/c.bM/2)))}(this,r),function(c,r){if(!r)return;var D=!1,W=!1;document.addEventListener("pointerlockchange",(W=>{D=document.pointerLockElement===r,c.QM(D)})),document.addEventListener("fullscreenchange",(D=>{W=document.fullscreenElement===r,c.onFullscreenChanged(W)})),Object.defineProperty(c,"iM",{get:()=>D,set:c=>{c&&!D?H(r):D&&!c&&function(c){c.exitPointerLock&&c.exitPointerLock()}(document)}}),Object.defineProperty(c,"fullscreen",{get:()=>W,set:c=>{c&&!W?r.requestFullscreen():W&&!c&&document.exitFullscreen()}}),r.addEventListener("click",(B=>{c.CM&&!D&&H(r),c.pM&&!W&&r.requestFullscreen()}));var B=()=>c.br();if(window.ResizeObserver){new ResizeObserver(B).observe(r)}else window.addEventListener("resize",B)}(this,c),this.FM()}))}}var B=3,t=20;function u(c){for(var r=1e3/c.bM,D=c._nowObject.now()+t,W=0;c._nowObject.now()>=c._lastTick+r&&c._nowObject.now()<D&&++W<=B;)c.sM(r),c._lastTick+=r;var u=5*(r+5),a=c._nowObject.now();if(a-c._lastTick>u)for(;a>=c._lastTick+r;)c._lastTick+=r}function a(c){requestAnimationFrame(c._frameCB),u(c);var r=c._nowObject.now(),D=r-c._rt;if(c._rt=r,c.OM>0){c._renderAccum+=D;var W=1e3/c.OM;if(c._renderAccum<W)return;c._renderAccum=Math.min(c._renderAccum-W,W)}var B=1e3/c.bM,t=(r-c._lastTick)/B;c.oM(D,t,B)}function H(c){c.requestPointerLock&&c.requestPointerLock()}var x=c=>{if("loading"===document.readyState){var r=()=>{document.removeEventListener("readystatechange",r),c()};document.addEventListener("readystatechange",r)}else setTimeout(c,1)}},13608:(c,r,D)=>{var W=D(13611),B=D(13618),t="undefined"!==typeof Float64Array;function u(c,r){return c[0]-r[0]}function a(){var c,r=this.stride,D=new Array(r.length);for(c=0;c<D.length;++c)D[c]=[Math.abs(r[c]),c];D.sort(u);var W=new Array(D.length);for(c=0;c<W.length;++c)W[c]=D[c][1];return W}function H(c,r){var D=["View",r,"d",c].join("");r<0&&(D="View_Nil"+c);var B="generic"===c;if(-1===r){var t="function "+D+"(a){this.data=a;};var proto="+D+".prototype;proto.dtype='"+c+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+D+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+D+"(a){return new "+D+"(a);}";return new Function(t)()}if(0===r){t="function "+D+"(a,d) {this.data = a;this.offset = d};var proto="+D+".prototype;proto.dtype='"+c+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+D+"_copy() {return new "+D+"(this.data,this.offset)};proto.pick=function "+D+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+D+"_get(){return "+(B?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+D+"_set(v){return "+(B?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+D+"(a,b,c,d){return new "+D+"(a,d)}";return new Function("TrivialArray",t)(x[c][0])}t=["'use strict'"];var u=W(r),H=u.map((function(c){return"i"+c})),M="this.offset+"+u.map((function(c){return"this.stride["+c+"]*i"+c})).join("+"),E=u.map((function(c){return"b"+c})).join(","),m=u.map((function(c){return"c"+c})).join(",");t.push("function "+D+"(a,"+E+","+m+",d){this.data=a","this.shape=["+E+"]","this.stride=["+m+"]","this.offset=d|0}","var proto="+D+".prototype","proto.dtype='"+c+"'","proto.dimension="+r),t.push("Object.defineProperty(proto,'size',{get:function "+D+"_size(){return "+u.map((function(c){return"this.shape["+c+"]"})).join("*"),"}})"),1===r?t.push("proto.order=[0]"):(t.push("Object.defineProperty(proto,'order',{get:"),r<4?(t.push("function "+D+"_order(){"),2===r?t.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===r&&t.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):t.push("ORDER})")),t.push("proto.set=function "+D+"_set("+H.join(",")+",v){"),B?t.push("return this.data.set("+M+",v)}"):t.push("return this.data["+M+"]=v}"),t.push("proto.get=function "+D+"_get("+H.join(",")+"){"),B?t.push("return this.data.get("+M+")}"):t.push("return this.data["+M+"]}"),t.push("proto.index=function "+D+"_index(",H.join(),"){return "+M+"}"),t.push("proto.hi=function "+D+"_hi("+H.join(",")+"){return new "+D+"(this.data,"+u.map((function(c){return["(typeof i",c,"!=='number'||i",c,"<0)?this.shape[",c,"]:i",c,"|0"].join("")})).join(",")+","+u.map((function(c){return"this.stride["+c+"]"})).join(",")+",this.offset)}");var Y=u.map((function(c){return"a"+c+"=this.shape["+c+"]"})),v=u.map((function(c){return"c"+c+"=this.stride["+c+"]"}));t.push("proto.lo=function "+D+"_lo("+H.join(",")+"){var b=this.offset,d=0,"+Y.join(",")+","+v.join(","));for(var k=0;k<r;++k)t.push("if(typeof i"+k+"==='number'&&i"+k+">=0){d=i"+k+"|0;b+=c"+k+"*d;a"+k+"-=d}");t.push("return new "+D+"(this.data,"+u.map((function(c){return"a"+c})).join(",")+","+u.map((function(c){return"c"+c})).join(",")+",b)}"),t.push("proto.step=function "+D+"_step("+H.join(",")+"){var "+u.map((function(c){return"a"+c+"=this.shape["+c+"]"})).join(",")+","+u.map((function(c){return"b"+c+"=this.stride["+c+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(k=0;k<r;++k)t.push("if(typeof i"+k+"==='number'){d=i"+k+"|0;if(d<0){c+=b"+k+"*(a"+k+"-1);a"+k+"=ceil(-a"+k+"/d)}else{a"+k+"=ceil(a"+k+"/d)}b"+k+"*=d}");t.push("return new "+D+"(this.data,"+u.map((function(c){return"a"+c})).join(",")+","+u.map((function(c){return"b"+c})).join(",")+",c)}");var w=new Array(r),Z=new Array(r);for(k=0;k<r;++k)w[k]="a[i"+k+"]",Z[k]="b[i"+k+"]";t.push("proto.transpose=function "+D+"_transpose("+H+"){"+H.map((function(c,r){return c+"=("+c+"===undefined?"+r+":"+c+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+D+"(this.data,"+w.join(",")+","+Z.join(",")+",this.offset)}"),t.push("proto.pick=function "+D+"_pick("+H+"){var a=[],b=[],c=this.offset");for(k=0;k<r;++k)t.push("if(typeof i"+k+"==='number'&&i"+k+">=0){c=(c+this.stride["+k+"]*i"+k+")|0}else{a.push(this.shape["+k+"]);b.push(this.stride["+k+"])}");return t.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),t.push("return function construct_"+D+"(data,shape,stride,offset){return new "+D+"(data,"+u.map((function(c){return"shape["+c+"]"})).join(",")+","+u.map((function(c){return"stride["+c+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",t.join("\n"))(x[c],a)}var x={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};c.exports=function(c,r,D,W){if(void 0===c)return(0,x.array[0])([]);"number"===typeof c&&(c=[c]),void 0===r&&(r=[c.length]);var u=r.length;if(void 0===D){D=new Array(u);for(var a=u-1,M=1;a>=0;--a)D[a]=M,M*=r[a]}if(void 0===W){W=0;for(a=0;a<u;++a)D[a]<0&&(W-=(r[a]-1)*D[a])}for(var E=function(c){if(B(c))return"buffer";if(t)switch(Object.prototype.toString.call(c)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(c)?"array":"generic"}(c),m=x[E];m.length<=u+1;)m.push(H(E,m.length-1));return(0,m[u+1])(c,r,D,W)}},13618:c=>{function r(c){return!!c.constructor&&"function"===typeof c.constructor.isBuffer&&c.constructor.isBuffer(c)}c.exports=function(c){return null!=c&&(r(c)||function(c){return"function"===typeof c.readFloatLE&&"function"===typeof c.slice&&r(c.slice(0,0))}(c)||!!c._isBuffer)}},13758:c=>{"use strict";var r=[],D=[],W=[],B=[],t=[],u=[],a=[],H=[],x=[],M=[],E=[],m=[];c.exports=function(c,Y,v,k,w,Z){for(var J=a,q=x,j=M,X=m,e=0;e<3;e++)J[e]=+v[e],j[e]=+Y.max[e],q[e]=+Y.base[e];Z||(Z=1e-10);var y=function(c,a,x,M,m,Y){var v=r,k=D,w=W,Z=B,J=t,q=u,j=H,X=Math.floor,e=0,y=0,U=0,N=0,g=0;if(z(),0===U)return 0;for(N=f();y<=U;){if(S(N)&&K())return e;N=f()}for(e+=U,g=0;g<3;g++)M[g]+=x[g],m[g]+=x[g];return e;function z(){if(y=0,0!==(U=Math.sqrt(x[0]*x[0]+x[1]*x[1]+x[2]*x[2])))for(var c=0;c<3;c++){var r=x[c]>=0;Z[c]=r?1:-1;var D=r?m[c]:M[c];v[c]=r?M[c]:m[c],k[c]=A(D,Z[c]),w[c]=h(v[c],Z[c]),j[c]=x[c]/U,J[c]=Math.abs(1/j[c]);var W=r?k[c]+1-D:D-k[c];q[c]=J[c]<1/0?J[c]*W:1/0}}function S(r){for(var D=Z[0],W=0===r?k[0]:w[0],B=k[0]+D,t=Z[1],u=1===r?k[1]:w[1],a=k[1]+t,H=Z[2],x=2===r?k[2]:w[2],M=k[2]+H,E=W;E!=B;E+=D)for(var m=u;m!=a;m+=t)for(var Y=x;Y!=M;Y+=H)if(c(E,m,Y))return!0;return!1}function K(){e+=y;var c=Z[N],r=y/U,D=E;for(g=0;g<3;g++){var W=x[g]*r;M[g]+=W,m[g]+=W,D[g]=x[g]-W}if(c>0?m[N]=Math.round(m[N]):M[N]=Math.round(M[N]),a(e,N,c,D))return!0;for(g=0;g<3;g++)x[g]=D[g];return z(),0===U}function f(){var c=q[0]<q[1]?q[0]<q[2]?0:2:q[1]<q[2]?1:2,r=q[c]-y;for(y=q[c],k[c]+=Z[c],q[c]+=J[c],g=0;g<3;g++)v[g]+=r*j[g],w[g]=h(v[g],Z[g]);return c}function A(c,r){return X(c-r*Y)}function h(c,r){return X(c+r*Y)}}(c,k,J,q,j,Z);if(!w){for(e=0;e<3;e++)X[e]=v[e]>0?j[e]-Y.max[e]:q[e]-Y.base[e];Y.translate(X)}return y}},13945:(c,r,D)=>{"use strict";D.d(r,{b:()=>E});var W=D(13753),B=D(12486);class t{constructor(c,r,D,t,u,a,H){this.Gx=new W(c.base,c.DM),this.oW=r,this.friction=D,this.restitution=t,this.Pu=u,this.JY=a,this.Gu=!!H,this.rM=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.uv=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.xx=B.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=B.create(),this._impulses=B.create(),this._sleepFrameCount=10}loadFromCopy(c){B.i(this.Gx.base,c.Gx.base),B.i(this.Gx.DM,c.Gx.DM),B.i(this.Gx.max,c.Gx.max),this.Gx.mag=c.Gx.mag,this.oW=c.oW,this.friction=c.friction,this.restitution=c.restitution,this.Pu=c.Pu,this.JY=c.JY,this.Gu=c.Gu,this.rM=c.rM,this.fluidDrag=c.fluidDrag,this.uv=c.uv,this.preventFallOffEdge=c.preventFallOffEdge,this.rolledBackLastTick=c.rolledBackLastTick,B.i(this.xx,c.xx),B.i(this.resting,c.resting),this.inFluid=c.inFluid,this._ratioInFluid=c._ratioInFluid,B.i(this._forces,c._forces),B.i(this._impulses,c._impulses),this._sleepFrameCount=c._sleepFrameCount}setPosition(c){u(c),B.Jr(c,c,this.Gx.base),this.Gx.translate(c),this.mx()}CD(){return B.clone(this.Gx.base)}applyForce(c){u(c),B.add(this._forces,this._forces,c),this.mx()}applyImpulse(c){u(c),B.add(this._impulses,this._impulses,c),this.mx()}mx(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var u=c=>{};var a=D(13753),H=D(12486),x=D(13758);function M(){this.rM=.1,this.fluidDrag=.4,this.Cu=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function E(c,r,D){c=Object.assign(new M,c),this.gravity=c.gravity||[0,-10,0],this.rM=c.rM||.1,this.Cu=c.Cu||2,this.fluidDrag=c.fluidDrag||.4,this.minBounceImpulse=c.minBounceImpulse,this.bodies=[],this.Cm=c.Cm,this.testSolid=r,this.testFluid=D}E.prototype.NY=function(c,r,D,W,B,u){c=c||new a([0,0,0],[1,1,1]),"undefined"==typeof r&&(r=1),"undefined"==typeof D&&(D=1),"undefined"==typeof W&&(W=0),"undefined"==typeof B&&(B=1);var H=new t(c,r,D,W,B,u);return this.bodies.push(H),H},E.prototype.gY=function(c){var r=this.bodies.indexOf(c);r<0||(this.bodies.splice(r,1),c.Gx=c.JY=null)};var m=H.create(),Y=H.create(),v=H.create(),k=H.create(),w=H.create(),Z=H.create(),J=H.create(),q=new a([0,0,0],[1,1,1]),j=new t(q,1,1,0,1,(()=>{}),!1);function X(c,r,D){return r=D,r*=1-(1-c.ratioInFluid)**2}E.prototype.ra=function(c){c/=1e3;var r=T(0,H.squaredLength(this.gravity));this.bodies.forEach((D=>function(c,r,D,W){H.i(w,r.resting),c.Cm&&j.loadFromCopy(r);if(r.oW<=0)return H.set(r.xx,0,0,0),H.set(r._forces,0,0,0),void H.set(r._impulses,0,0,0);var B=W||0===r.Pu;if(function(c,r,D,W){if(r._sleepFrameCount>0)return!1;if(W)return!0;var B=!1,t=.5*D*D*r.Pu;return H.scale(d,c.gravity,t),x(c.testSolid,r.Gx,d,(function(){return B=!0,!0}),!0),B}(c,r,D,B))return;r._sleepFrameCount--,function(c,r){var D=r.Gx,W=Math.floor(D.base[0]),B=Math.floor(D.base[2]),t=Math.floor(D.base[1]),u=Math.floor(D.max[1]);if(!c.testFluid(W,t,B))return r.inFluid=!1,void(r.ratioInFluid=0);var a=1,x=t+1;for(;x<=u&&c.testFluid(W,x,B);)a++,x++;var M=(t+a-D.base[1])/D.DM[1];M>1&&(M=1);var E=D.DM[0]*D.DM[1]*D.DM[2]*M,m=y;H.scale(m,c.gravity,-c.Cu*E*r.Pu),r.applyForce(m),r.inFluid=!0,r.ratioInFluid=M}(c,r),O(r._forces),O(r._impulses),O(r.xx),O(r.resting),H.scale(m,r._forces,1/r.oW),H.Qu(m,m,c.gravity,r.Pu),H.scale(Y,r._impulses,1/r.oW),H.Qu(Y,Y,m,D),H.add(r.xx,r.xx,Y),r.friction&&(U(c,0,r,Y,D),U(c,1,r,Y,D),U(c,2,r,Y,D));var t=r.fluidDrag>=0?r.fluidDrag:c.fluidDrag,u=r.rM>=0?r.rM:c.rM,a=u,M=u;r.inFluid&&(a=X(r,a,r.fluidDragHoriz>=0?r.fluidDragHoriz:t),M=X(r,M,r.fluidDragVert>=0?r.fluidDragVert:t));a=Math.max(1-a*D/r.oW,0),M=Math.max(1-M*D/r.oW,0),H.set(e,a,M,a),H.multiply(r.xx,r.xx,e),H.scale(v,r.xx,D),H.set(r._forces,0,0,0),H.set(r._impulses,0,0,0),r.Gu&&b(z,r.Gx);H.i(Z,v),H.set(J,0,0,0),r.preventFallOffEdge&&function(c,r,D,W){if(!r.resting[1]||D[1]>0)return;var B=L;b(B,r.Gx);for(var t=0;t<3;t+=2){H.set(h,0,0,0),h[t]=D[t];var u=!0;(u=(u=(u=(u=u&&!G(c,B.base[0]+h[0]+1e-5,B.base[1],B.base[2]+h[2]+1e-5))&&!G(c,B.max[0]+h[0]-1e-5,B.base[1],B.base[2]+h[2]+1e-5))&&!G(c,B.base[0]+h[0]+1e-5,B.base[1],B.max[2]+h[2]-1e-5))&&!G(c,B.max[0]+h[0]-1e-5,B.base[1],B.max[2]+h[2]-1e-5))?(W[t]=D[t]>0?1:-1,D[t]=0):0===t&&(H.set(P,D[0],0,0),g(c,B,P,W,r.slideOnCollision))}}(c,r,v,J);g(c,r.Gx,v,r.resting,r.slideOnCollision),r.Gu&&function(c,r,D,W){if(r.resting[1]>=0&&!r.inFluid)return;var B=0!==r.resting[0],t=0!==r.resting[2];if(!B&&!t)return;var u=Math.abs(W[0]/W[2]),a=4;if(!B&&u>a)return;if(!t&&u<1/a)return;H.add(K,D.base,W);var M=c.testSolid;x(M,D,W,(function(c,r,D,W){if(1!==r)return!0;W[r]=0}));var E=D.base[1],m=r.inFluid?1.951:1.001,Y=Math.floor(E+m)-E;H.set(f,0,Y,0);var v=!1;if(x(M,D,f,(function(c,r,D,W){return v=!0,!0})),v)return;H.Jr(A,K,D.base),A[1]=0,g(c,D,A,S,!0);var k=T(D.base[0],K[0]),w=T(D.base[2],K[2]);if(B&&!k&&(!w||!t))return;if(t&&(!k||!B)&&!w)return;var Z=!0;if(Z=Z&&!G(c,D.base[0]+1e-5,D.base[1],D.base[2]+1e-5),Z=Z&&!G(c,D.max[0]-1e-5,D.base[1],D.base[2]+1e-5),Z=Z&&!G(c,D.base[0]+1e-5,D.base[1],D.max[2]-1e-5),Z=Z&&!G(c,D.max[0]-1e-5,D.base[1],D.max[2]-1e-5),Z)return;b(r.Gx,D),r.resting[0]=S[0],r.resting[2]=S[2],r.uv&&r.uv()}(c,r,z,Z);for(var E=0;E<3;++E)r.resting[E]=r.resting[E]||J[E],k[E]=0,r.resting[E]&&(w[E]||(k[E]=-r.xx[E]),r.xx[E]=0);var q=H.length(k);q>.001&&(H.scale(k,k,r.oW),r.JY&&r.JY(k),r.restitution>0&&q>c.minBounceImpulse&&(H.scale(k,k,r.restitution),r.applyImpulse(k)));var N=H.squaredLength(r.xx);N>1e-5&&r.mx();c.Cm&&c.Cm(r)?(r.loadFromCopy(j),r.rolledBackLastTick=!0):r.rolledBackLastTick=!1}(this,D,c,r)))};var e=H.create([0,0,0]);var y=H.create();function U(c,r,D,W,B){var t=D.resting[r],u=W[r];if(!D.alwaysApplyHorizFriction||1!==r){if(0===t)return;if(t*u<=0)return}H.i(N,D.xx),N[r]=0;var a=H.length(N);if(!T(a,0)){var x=Math.abs(D.friction*c.gravity[r]*B),M=a>x?(a-x)/a:0;D.xx[(r+1)%3]*=M,D.xx[(r+2)%3]*=M}}var N=H.create();function g(c,r,D,W,B){return H.set(W,0,0,0),x(c.testSolid,r,D,(function(c,r,D,t){W[r]=D,t[r]=0,B||(t[0]=0,t[1]=0,t[2]=0)}))}var z=new a([],[]),S=H.create(),K=H.create(),f=H.create(),A=H.create();var h=H.create(),L=new a([],[]),P=H.create();function G(c,r,D,W){return c.testSolid(Math.floor(r),Math.floor(D-1),Math.floor(W))}var d=H.create();function T(c,r){return Math.abs(c-r)<1e-5}function b(c,r){for(var D=0;D<3;D++)c.base[D]=r.base[D],c.max[D]=r.max[D],c.DM[D]=r.DM[D]}var O=function(c){}},12347:function(c,r){!function(c){"use strict";var r=function(c,D){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,r){c.__proto__=r}||function(c,r){for(var D in r)Object.prototype.hasOwnProperty.call(r,D)&&(c[D]=r[D])},r(c,D)};function D(c,D){if("function"!==typeof D&&null!==D)throw new TypeError("Class extends value "+String(D)+" is not a constructor or null");function W(){this.constructor=c}r(c,D),c.prototype=null===D?Object.create(D):(W.prototype=D.prototype,new W)}function W(c,r,D,W){var B,t=arguments.length,u=t<3?r:null===W?W=Object.getOwnPropertyDescriptor(r,D):W;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)u=Reflect.decorate(c,r,D,W);else for(var a=c.length-1;a>=0;a--)(B=c[a])&&(u=(t<3?B(u):t>3?B(r,D,u):B(r,D))||u);return t>3&&u&&Object.defineProperty(r,D,u),u}function B(c,r,D){if(D||2===arguments.length)for(var W,B=0,t=r.length;B<t;B++)!W&&B in r||(W||(W=Array.prototype.slice.call(r,0,B)),W[B]=r[B]);return c.concat(W||Array.prototype.slice.call(r))}var t,u=255,a=213;c.OPERATION=void 0,(t=c.OPERATION||(c.OPERATION={}))[t.ADD=128]="ADD",t[t.REPLACE=0]="REPLACE",t[t.DELETE=64]="DELETE",t[t.DELETE_AND_ADD=192]="DELETE_AND_ADD",t[t.TOUCH=1]="TOUCH",t[t.CLEAR=10]="CLEAR";var H=function(){function r(c,r,D){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=c,this.setParent(r,D)}return r.prototype.setParent=function(c,r,D){var W=this;if(this.indexes||(this.indexes=this.ref instanceof Ac?this.ref._definition.indexes:{}),this.parent=c,this.parentIndex=D,r)if(this.root=r,this.ref instanceof Ac){var B=this.ref._definition;for(var t in B.schema){var u=this.ref[t];if(u&&u.$changes){var a=B.indexes[t];u.$changes.setParent(this.ref,r,a)}}}else"object"===typeof this.ref&&this.ref.forEach((function(c,r){if(c instanceof Ac){var D=c.$changes,B=W.ref.$changes.indexes[r];D.setParent(W.ref,W.root,B)}}))},r.prototype.operation=function(c){this.changes.set(--this.currentCustomOperation,c)},r.prototype.change=function(r,D){void 0===D&&(D=c.OPERATION.ADD);var W="number"===typeof r?r:this.indexes[r];this.assertValidIndex(W,r);var B=this.changes.get(W);B&&B.op!==c.OPERATION.DELETE&&B.op!==c.OPERATION.TOUCH||this.changes.set(W,{op:B&&B.op===c.OPERATION.DELETE?c.OPERATION.DELETE_AND_ADD:D,index:W}),this.allChanges.add(W),this.changed=!0,this.touchParents()},r.prototype.touch=function(r){var D="number"===typeof r?r:this.indexes[r];this.assertValidIndex(D,r),this.changes.has(D)||this.changes.set(D,{op:c.OPERATION.TOUCH,index:D}),this.allChanges.add(D),this.touchParents()},r.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},r.prototype.getType=function(c){if(this.ref._definition)return(r=this.ref._definition).schema[r.fieldsByIndex[c]];var r,D=(r=this.parent._definition).schema[r.fieldsByIndex[this.parentIndex]];return Object.values(D)[0]},r.prototype.getChildrenFilter=function(){var c=this.parent._definition.childFilters;return c&&c[this.parentIndex]},r.prototype.getValue=function(c){return this.ref.getByIndex(c)},r.prototype.delete=function(r){var D="number"===typeof r?r:this.indexes[r];if(void 0!==D){var W=this.getValue(D);this.changes.set(D,{op:c.OPERATION.DELETE,index:D}),this.allChanges.delete(D),delete this.caches[D],W&&W.$changes&&(W.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(r," (").concat(D,")"))},r.prototype.discard=function(r,D){var W=this;void 0===r&&(r=!1),void 0===D&&(D=!1),this.ref instanceof Ac||this.changes.forEach((function(r){if(r.op===c.OPERATION.DELETE){var D=W.ref.getIndex(r.index);delete W.indexes[D]}})),this.changes.clear(),this.changed=r,D&&this.allChanges.clear(),this.currentCustomOperation=0},r.prototype.discardAll=function(){var c=this;this.changes.forEach((function(r){var D=c.getValue(r.index);D&&D.$changes&&D.$changes.discardAll()})),this.discard()},r.prototype.cache=function(c,r){this.caches[c]=r},r.prototype.clone=function(){return new r(this.ref,this.parent,this.root)},r.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},r.prototype.assertValidIndex=function(c,r){if(void 0===c)throw new Error('ChangeTree: missing index for field "'.concat(r,'"'))},r}();function x(c,r,D,W){return c[r]||(c[r]=[]),c[r].push(D),null===W||void 0===W||W.forEach((function(c,r){return D(c,r)})),function(){return E(c[r],c[r].indexOf(D))}}function M(r){var D=this,W="string"!==typeof this.$changes.getType();this.$items.forEach((function(B,t){r.push({refId:D.$changes.refId,op:c.OPERATION.DELETE,field:t,value:void 0,previousValue:B}),W&&D.$changes.root.removeRef(B.$changes.refId)}))}function E(c,r){if(-1===r||r>=c.length)return!1;for(var D=c.length-1,W=r;W<D;W++)c[W]=c[W+1];return c.length=D,!0}var m=function(c,r){var D=c.toString(),W=r.toString();return D<W?-1:D>W?1:0};function Y(c){return c.$proxy=!0,c=new Proxy(c,{get:function(c,r){return"symbol"===typeof r||isNaN(r)?c[r]:c.at(r)},set:function(c,r,D){if("symbol"===typeof r||isNaN(r))c[r]=D;else{var W=Array.from(c.$items.keys()),B=parseInt(W[r]||r);void 0===D||null===D?c.deleteAt(B):c.setAt(B,D)}return!0},deleteProperty:function(c,r){return"number"===typeof r?c.deleteAt(r):delete c[r],!0}})}var v=function(){function r(){for(var c=[],r=0;r<arguments.length;r++)c[r]=arguments[r];this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,c)}return r.prototype.Aa=function(r,D){return void 0===D&&(D=!0),x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.ADD,r,D?this.$items:void 0)},r.prototype.hr=function(r){return x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.DELETE,r)},r.prototype.onChange=function(r){return x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.REPLACE,r)},r.is=function(c){return Array.isArray(c)||void 0!==c.array},Object.defineProperty(r.prototype,"length",{get:function(){return this.$items.size},set:function(c){0===c?this.clear():this.splice(c,this.length-c)},enumerable:!1,configurable:!0}),r.prototype.push=function(){for(var c,r=this,D=[],W=0;W<arguments.length;W++)D[W]=arguments[W];return D.forEach((function(D){c=r.$refId++,r.setAt(c,D)})),c},r.prototype.pop=function(){var c=Array.from(this.$indexes.values()).pop();if(void 0!==c){this.$changes.delete(c),this.$indexes.delete(c);var r=this.$items.get(c);return this.$items.delete(c),r}},r.prototype.at=function(c){var r=Array.from(this.$items.keys())[c];return this.$items.get(r)},r.prototype.setAt=function(r,D){var W,B;if(void 0!==D&&null!==D){if(this.$items.get(r)!==D){void 0!==D.$changes&&D.$changes.setParent(this,this.$changes.root,r);var t=null!==(B=null===(W=this.$changes.indexes[r])||void 0===W?void 0:W.op)&&void 0!==B?B:c.OPERATION.ADD;this.$changes.indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,D),this.$changes.change(r,t)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},r.prototype.deleteAt=function(c){var r=Array.from(this.$items.keys())[c];return void 0!==r&&this.$deleteAt(r)},r.prototype.$deleteAt=function(c){return this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c)},r.prototype.clear=function(r){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),r&&M.call(this,r),this.$items.clear(),this.$changes.operation({index:0,op:c.OPERATION.CLEAR}),this.$changes.touchParents()},r.prototype.concat=function(){for(var c,D=[],W=0;W<arguments.length;W++)D[W]=arguments[W];return new(r.bind.apply(r,B([void 0],(c=Array.from(this.$items.values())).concat.apply(c,D),!1)))},r.prototype.join=function(c){return Array.from(this.$items.values()).join(c)},r.prototype.reverse=function(){var c=this,r=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(D,W){c.setAt(r[W],D)})),this},r.prototype.shift=function(){var c=Array.from(this.$items.keys()).shift();if(void 0!==c){var r=this.$items.get(c);return this.$deleteAt(c),r}},r.prototype.slice=function(c,D){var W=new r;return W.push.apply(W,Array.from(this.$items.values()).slice(c,D)),W},r.prototype.sort=function(c){var r=this;void 0===c&&(c=m);var D=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(c).forEach((function(c,W){r.setAt(D[W],c)})),this},r.prototype.splice=function(c,r){void 0===r&&(r=this.length-c);for(var D=Array.from(this.$items.keys()),W=[],B=c;B<c+r;B++)W.push(this.$items.get(D[B])),this.$deleteAt(D[B]);return W},r.prototype.unshift=function(){for(var c=this,r=[],D=0;D<arguments.length;D++)r[D]=arguments[D];var W=this.length,B=r.length,t=Array.from(this.$items.values());return r.forEach((function(r,D){c.setAt(D,r)})),t.forEach((function(r,D){c.setAt(B+D,r)})),W+B},r.prototype.indexOf=function(c,r){return Array.from(this.$items.values()).indexOf(c,r)},r.prototype.lastIndexOf=function(c,r){return void 0===r&&(r=this.length-1),Array.from(this.$items.values()).lastIndexOf(c,r)},r.prototype.every=function(c,r){return Array.from(this.$items.values()).every(c,r)},r.prototype.some=function(c,r){return Array.from(this.$items.values()).some(c,r)},r.prototype.forEach=function(c,r){Array.from(this.$items.values()).forEach(c,r)},r.prototype.map=function(c,r){return Array.from(this.$items.values()).map(c,r)},r.prototype.filter=function(c,r){return Array.from(this.$items.values()).filter(c,r)},r.prototype.reduce=function(c,r){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},r.prototype.reduceRight=function(c,r){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},r.prototype.find=function(c,r){return Array.from(this.$items.values()).find(c,r)},r.prototype.findIndex=function(c,r){return Array.from(this.$items.values()).findIndex(c,r)},r.prototype.fill=function(c,r,D){throw new Error("ArraySchema#fill() not implemented")},r.prototype.copyWithin=function(c,r,D){throw new Error("ArraySchema#copyWithin() not implemented")},r.prototype.toString=function(){return this.$items.toString()},r.prototype.toLocaleString=function(){return this.$items.toLocaleString()},r.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(r,Symbol.species,{get:function(){return r},enumerable:!1,configurable:!0}),r.prototype.entries=function(){return this.$items.entries()},r.prototype.keys=function(){return this.$items.keys()},r.prototype.values=function(){return this.$items.values()},r.prototype.includes=function(c,r){return Array.from(this.$items.values()).includes(c,r)},r.prototype.flatMap=function(c,r){throw new Error("ArraySchema#flatMap() is not supported.")},r.prototype.flat=function(c){throw new Error("ArraySchema#flat() is not supported.")},r.prototype.findLast=function(){var c=Array.from(this.$items.values());return c.findLast.apply(c,arguments)},r.prototype.findLastIndex=function(){var c=Array.from(this.$items.values());return c.findLastIndex.apply(c,arguments)},r.prototype.setIndex=function(c,r){this.$indexes.set(c,r)},r.prototype.getIndex=function(c){return this.$indexes.get(c)},r.prototype.getByIndex=function(c){return this.$items.get(this.$indexes.get(c))},r.prototype.deleteByIndex=function(c){var r=this.$indexes.get(c);this.$items.delete(r),this.$indexes.delete(c)},r.prototype.toArray=function(){return Array.from(this.$items.values())},r.prototype.toJSON=function(){return this.toArray().map((function(c){return"function"===typeof c.toJSON?c.toJSON():c}))},r.prototype.clone=function(c){return c?new(r.bind.apply(r,B([void 0],Array.from(this.$items.values()),!1))):new(r.bind.apply(r,B([void 0],this.map((function(c){return c.$changes?c.clone():c})),!1)))},r}();function k(c){return c.$proxy=!0,c=new Proxy(c,{get:function(c,r){return"symbol"!==typeof r&&"undefined"===typeof c[r]?c.get(r):c[r]},set:function(c,r,D){return"symbol"!==typeof r&&-1===r.indexOf("$")&&"Aa"!==r&&"hr"!==r&&"onChange"!==r?c.set(r,D):c[r]=D,!0},deleteProperty:function(c,r){return c.delete(r),!0}})}var w=function(){function r(c){var D=this;if(this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,c)if(c instanceof Map||c instanceof r)c.forEach((function(c,r){return D.set(r,c)}));else for(var W in c)this.set(W,c[W])}return r.prototype.Aa=function(r,D){return void 0===D&&(D=!0),x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.ADD,r,D?this.$items:void 0)},r.prototype.hr=function(r){return x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.DELETE,r)},r.prototype.onChange=function(r){return x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.REPLACE,r)},r.is=function(c){return void 0!==c.map},r.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(r.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(r,Symbol.species,{get:function(){return r},enumerable:!1,configurable:!0}),r.prototype.set=function(r,D){if(void 0===D||null===D)throw new Error("MapSchema#set('".concat(r,"', ").concat(D,"): trying to set ").concat(D," value on '").concat(r,"'."));r=r.toString();var W="undefined"!==typeof this.$changes.indexes[r],B=W?this.$changes.indexes[r]:this.$refId++,t=W?c.OPERATION.REPLACE:c.OPERATION.ADD,u=void 0!==D.$changes;if(u&&D.$changes.setParent(this,this.$changes.root,B),W){if(!u&&this.$items.get(r)===D)return;u&&this.$items.get(r)!==D&&(t=c.OPERATION.ADD)}else this.$changes.indexes[r]=B,this.$indexes.set(B,r);return this.$items.set(r,D),this.$changes.change(r,t),this},r.prototype.get=function(c){return this.$items.get(c)},r.prototype.delete=function(c){return this.$changes.delete(c),this.$items.delete(c)},r.prototype.clear=function(r){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),r&&M.call(this,r),this.$items.clear(),this.$changes.operation({index:0,op:c.OPERATION.CLEAR}),this.$changes.touchParents()},r.prototype.has=function(c){return this.$items.has(c)},r.prototype.forEach=function(c){this.$items.forEach(c)},r.prototype.entries=function(){return this.$items.entries()},r.prototype.keys=function(){return this.$items.keys()},r.prototype.values=function(){return this.$items.values()},Object.defineProperty(r.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),r.prototype.setIndex=function(c,r){this.$indexes.set(c,r)},r.prototype.getIndex=function(c){return this.$indexes.get(c)},r.prototype.getByIndex=function(c){return this.$items.get(this.$indexes.get(c))},r.prototype.deleteByIndex=function(c){var r=this.$indexes.get(c);this.$items.delete(r),this.$indexes.delete(c)},r.prototype.toJSON=function(){var c={};return this.forEach((function(r,D){c[D]="function"===typeof r.toJSON?r.toJSON():r})),c},r.prototype.clone=function(c){var D;return c?D=Object.assign(new r,this):(D=new r,this.forEach((function(c,r){c.$changes?D.set(r,c.clone()):D.set(r,c)}))),D},r}(),Z={};function J(c,r){Z[c]=r}function q(c){return Z[c]}var j=function(){function c(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return c.create=function(r){var D=new c;return D.schema=Object.assign({},r&&r.schema||{}),D.indexes=Object.assign({},r&&r.indexes||{}),D.fieldsByIndex=Object.assign({},r&&r.fieldsByIndex||{}),D.descriptors=Object.assign({},r&&r.descriptors||{}),D.deprecated=Object.assign({},r&&r.deprecated||{}),D},c.prototype.addField=function(c,r){var D=this.getNextFieldIndex();this.fieldsByIndex[D]=c,this.indexes[c]=D,this.schema[c]=Array.isArray(r)?{array:r[0]}:r},c.prototype.hasField=function(c){return void 0!==this.indexes[c]},c.prototype.addFilter=function(c,r){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[c]]=r,this.indexesWithFilters.push(this.indexes[c]),!0},c.prototype.addChildrenFilter=function(c,r){var D=this.indexes[c],W=this.schema[c];if(q(Object.keys(W)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[D]=r,!0;console.warn("@filterChildren: field '".concat(c,"' can't have children. Ignoring filter."))},c.prototype.getChildrenFilter=function(c){return this.childFilters&&this.childFilters[this.indexes[c]]},c.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},c}();function X(c){return c._context&&c._context.useFilters}var e=function(){function c(){this.types={},this.schemas=new Map,this.useFilters=!1}return c.prototype.has=function(c){return this.schemas.has(c)},c.prototype.get=function(c){return this.types[c]},c.prototype.add=function(c,r){void 0===r&&(r=this.schemas.size),c._definition=j.create(c._definition),c._typeid=r,this.types[r]=c,this.schemas.set(c,r)},c.create=function(r){return void 0===r&&(r={}),function(D){return r.context||(r.context=new c),U(D,r)}},c}(),y=new e;function U(c,r){return void 0===r&&(r={}),function(D,W){var t=r.context||y,u=D.constructor;if(u._context=t,!c)throw new Error("".concat(u.name,': @type() reference provided for "').concat(W,"\" is undefined. Make sure you don't have any circular dependencies."));t.has(u)||t.add(u);var a=u._definition;if(a.addField(W,c),a.descriptors[W]){if(a.deprecated[W])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(W,"' definition on '").concat(u.name,"'.\nCheck @type() annotation"))}catch(Z){var H=Z.stack.split("\n")[4].trim();throw new Error("".concat(Z.message," ").concat(H))}}var x=v.is(c),M=!x&&w.is(c);if("string"!==typeof c&&!Ac.is(c)){var E=Object.values(c)[0];"string"===typeof E||t.has(E)||t.add(E)}if(r.manual)a.descriptors[W]={enumerable:!0,configurable:!0,writable:!0};else{var m="_".concat(W);a.descriptors[m]={enumerable:!1,configurable:!1,writable:!0},a.descriptors[W]={get:function(){return this[m]},set:function(c){c!==this[m]&&(void 0!==c&&null!==c?(!x||c instanceof v||(c=new(v.bind.apply(v,B([void 0],c,!1)))),!M||c instanceof w||(c=new w(c)),void 0===c.$proxy&&(M?c=k(c):x&&(c=Y(c))),this.$changes.change(W),c.$changes&&c.$changes.setParent(this,this.$changes.root,this._definition.indexes[W])):this[m]&&this.$changes.delete(W),this[m]=c)},enumerable:!0,configurable:!0}}}}function N(c){return function(r,D){var W=r.constructor;W._definition.addFilter(D,c)&&(W._context.useFilters=!0)}}function g(c){return function(r,D){var W=r.constructor;W._definition.addChildrenFilter(D,c)&&(W._context.useFilters=!0)}}function z(c){return void 0===c&&(c=!0),function(r,D){var W=r.constructor._definition;W.deprecated[D]=!0,c&&(W.descriptors[D]={get:function(){throw new Error("".concat(D," is deprecated."))},set:function(c){},enumerable:!1,configurable:!0})}}function S(c,r,D){for(var W in void 0===D&&(D={}),D.context||(D.context=c._context||D.context||y),r)U(r[W],D)(c.prototype,W);return c}function K(c){for(var r=0,D=0,W=0,B=c.length;W<B;W++)(r=c.charCodeAt(W))<128?D+=1:r<2048?D+=2:r<55296||r>=57344?D+=3:(W++,D+=4);return D}function f(c,r,D){for(var W=0,B=0,t=D.length;B<t;B++)(W=D.charCodeAt(B))<128?c[r++]=W:W<2048?(c[r++]=192|W>>6,c[r++]=128|63&W):W<55296||W>=57344?(c[r++]=224|W>>12,c[r++]=128|W>>6&63,c[r++]=128|63&W):(B++,W=65536+((1023&W)<<10|1023&D.charCodeAt(B)),c[r++]=240|W>>18,c[r++]=128|W>>12&63,c[r++]=128|W>>6&63,c[r++]=128|63&W)}function A(c,r){c.push(255&r)}function h(c,r){c.push(255&r)}function L(c,r){c.push(255&r),c.push(r>>8&255)}function P(c,r){c.push(255&r),c.push(r>>8&255)}function G(c,r){c.push(255&r),c.push(r>>8&255),c.push(r>>16&255),c.push(r>>24&255)}function d(c,r){var D=r>>24,W=r>>16,B=r>>8,t=r;c.push(255&t),c.push(255&B),c.push(255&W),c.push(255&D)}function T(c,r){var D=Math.floor(r/Math.pow(2,32));d(c,r>>>0),d(c,D)}function b(c,r){var D=r/Math.pow(2,32)|0;d(c,r>>>0),d(c,D)}function O(c,r){o(c,r)}function C(c,r){Q(c,r)}var p=new Int32Array(2),R=new Float32Array(p.buffer),s=new Float64Array(p.buffer);function o(c,r){R[0]=r,G(c,p[0])}function Q(c,r){s[0]=r,G(c,p[0]),G(c,p[1])}function l(c,r){return h(c,r?1:0)}function F(c,r){r||(r="");var D=K(r),W=0;if(D<32)c.push(160|D),W=1;else if(D<256)c.push(217),h(c,D),W=2;else if(D<65536)c.push(218),P(c,D),W=3;else{if(!(D<4294967296))throw new Error("String too long");c.push(219),d(c,D),W=5}return f(c,c.length,r),W+D}function I(c,r){return isNaN(r)?I(c,0):isFinite(r)?r!==(0|r)?(c.push(203),Q(c,r),9):r>=0?r<128?(h(c,r),1):r<256?(c.push(204),h(c,r),2):r<65536?(c.push(205),P(c,r),3):r<4294967296?(c.push(206),d(c,r),5):(c.push(207),b(c,r),9):r>=-32?(c.push(224|r+32),1):r>=-128?(c.push(208),A(c,r),2):r>=-32768?(c.push(209),L(c,r),3):r>=-2147483648?(c.push(210),G(c,r),5):(c.push(211),T(c,r),9):I(c,r>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var i=Object.freeze({__proto__:null,utf8Write:f,int8:A,uint8:h,int16:L,uint16:P,int32:G,uint32:d,int64:T,uint64:b,float32:O,float64:C,writeFloat32:o,writeFloat64:Q,boolean:l,string:F,number:I});function n(c,r,D){for(var W="",B=0,t=r,u=r+D;t<u;t++){var a=c[t];0!==(128&a)?192!==(224&a)?224!==(240&a)?240!==(248&a)?console.error("Invalid byte "+a.toString(16)):(B=(7&a)<<18|(63&c[++t])<<12|(63&c[++t])<<6|63&c[++t])>=65536?(B-=65536,W+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):W+=String.fromCharCode(B):W+=String.fromCharCode((15&a)<<12|(63&c[++t])<<6|63&c[++t]):W+=String.fromCharCode((31&a)<<6|63&c[++t]):W+=String.fromCharCode(a)}return W}function V(c,r){return cc(c,r)<<24>>24}function cc(c,r){return c[r.offset++]}function rc(c,r){return Dc(c,r)<<16>>16}function Dc(c,r){return c[r.offset++]|c[r.offset++]<<8}function Wc(c,r){return c[r.offset++]|c[r.offset++]<<8|c[r.offset++]<<16|c[r.offset++]<<24}function Bc(c,r){return Wc(c,r)>>>0}function tc(c,r){return mc(c,r)}function uc(c,r){return Yc(c,r)}function ac(c,r){var D=Bc(c,r);return Wc(c,r)*Math.pow(2,32)+D}function Hc(c,r){var D=Bc(c,r);return Bc(c,r)*Math.pow(2,32)+D}var xc=new Int32Array(2),Mc=new Float32Array(xc.buffer),Ec=new Float64Array(xc.buffer);function mc(c,r){return xc[0]=Wc(c,r),Mc[0]}function Yc(c,r){return xc[0]=Wc(c,r),xc[1]=Wc(c,r),Ec[0]}function vc(c,r){return cc(c,r)>0}function kc(c,r){var D,W=c[r.offset++];W<192?D=31&W:217===W?D=cc(c,r):218===W?D=Dc(c,r):219===W&&(D=Bc(c,r));var B=n(c,r.offset,D);return r.offset+=D,B}function wc(c,r){var D=c[r.offset];return D<192&&D>160||217===D||218===D||219===D}function Zc(c,r){var D=c[r.offset++];return D<128?D:202===D?mc(c,r):203===D?Yc(c,r):204===D?cc(c,r):205===D?Dc(c,r):206===D?Bc(c,r):207===D?Hc(c,r):208===D?V(c,r):209===D?rc(c,r):210===D?Wc(c,r):211===D?ac(c,r):D>223?-1*(255-D+1):void 0}function Jc(c,r){var D=c[r.offset];return D<128||D>=202&&D<=211}function qc(c,r){return c[r.offset]<160}function jc(c,r){return c[r.offset-1]===u&&(c[r.offset]<128||c[r.offset]>=202&&c[r.offset]<=211)}var Xc=Object.freeze({__proto__:null,int8:V,uint8:cc,int16:rc,uint16:Dc,int32:Wc,uint32:Bc,float32:tc,float64:uc,int64:ac,uint64:Hc,readFloat32:mc,readFloat64:Yc,boolean:vc,string:kc,stringCheck:wc,number:Zc,numberCheck:Jc,arrayCheck:qc,switchStructureCheck:jc}),ec=function(){function r(c){var r=this;this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,c&&c.forEach((function(c){return r.add(c)}))}return r.prototype.Aa=function(r,D){return void 0===D&&(D=!0),x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.ADD,r,D?this.$items:void 0)},r.prototype.hr=function(r){return x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.DELETE,r)},r.prototype.onChange=function(r){return x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.REPLACE,r)},r.is=function(c){return void 0!==c.collection},r.prototype.add=function(c){var r=this.$refId++;return void 0!==c.$changes&&c.$changes.setParent(this,this.$changes.root,r),this.$changes.indexes[r]=r,this.$indexes.set(r,r),this.$items.set(r,c),this.$changes.change(r),r},r.prototype.at=function(c){var r=Array.from(this.$items.keys())[c];return this.$items.get(r)},r.prototype.entries=function(){return this.$items.entries()},r.prototype.delete=function(c){for(var r,D,W=this.$items.entries();(D=W.next())&&!D.done;)if(c===D.value[1]){r=D.value[0];break}return void 0!==r&&(this.$changes.delete(r),this.$indexes.delete(r),this.$items.delete(r))},r.prototype.clear=function(r){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),r&&M.call(this,r),this.$items.clear(),this.$changes.operation({index:0,op:c.OPERATION.CLEAR}),this.$changes.touchParents()},r.prototype.has=function(c){return Array.from(this.$items.values()).some((function(r){return r===c}))},r.prototype.forEach=function(c){var r=this;this.$items.forEach((function(D,W,B){return c(D,W,r)}))},r.prototype.values=function(){return this.$items.values()},Object.defineProperty(r.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),r.prototype.setIndex=function(c,r){this.$indexes.set(c,r)},r.prototype.getIndex=function(c){return this.$indexes.get(c)},r.prototype.getByIndex=function(c){return this.$items.get(this.$indexes.get(c))},r.prototype.deleteByIndex=function(c){var r=this.$indexes.get(c);this.$items.delete(r),this.$indexes.delete(c)},r.prototype.toArray=function(){return Array.from(this.$items.values())},r.prototype.toJSON=function(){var c=[];return this.forEach((function(r,D){c.push("function"===typeof r.toJSON?r.toJSON():r)})),c},r.prototype.clone=function(c){var D;return c?D=Object.assign(new r,this):(D=new r,this.forEach((function(c){c.$changes?D.add(c.clone()):D.add(c)}))),D},r}(),yc=function(){function r(c){var r=this;this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,c&&c.forEach((function(c){return r.add(c)}))}return r.prototype.Aa=function(r,D){return void 0===D&&(D=!0),x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.ADD,r,D?this.$items:void 0)},r.prototype.hr=function(r){return x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.DELETE,r)},r.prototype.onChange=function(r){return x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.REPLACE,r)},r.is=function(c){return void 0!==c.set},r.prototype.add=function(r){var D,W;if(this.has(r))return!1;var B=this.$refId++;void 0!==r.$changes&&r.$changes.setParent(this,this.$changes.root,B);var t=null!==(W=null===(D=this.$changes.indexes[B])||void 0===D?void 0:D.op)&&void 0!==W?W:c.OPERATION.ADD;return this.$changes.indexes[B]=B,this.$indexes.set(B,B),this.$items.set(B,r),this.$changes.change(B,t),B},r.prototype.entries=function(){return this.$items.entries()},r.prototype.delete=function(c){for(var r,D,W=this.$items.entries();(D=W.next())&&!D.done;)if(c===D.value[1]){r=D.value[0];break}return void 0!==r&&(this.$changes.delete(r),this.$indexes.delete(r),this.$items.delete(r))},r.prototype.clear=function(r){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),r&&M.call(this,r),this.$items.clear(),this.$changes.operation({index:0,op:c.OPERATION.CLEAR}),this.$changes.touchParents()},r.prototype.has=function(c){for(var r,D=this.$items.values(),W=!1;(r=D.next())&&!r.done;)if(c===r.value){W=!0;break}return W},r.prototype.forEach=function(c){var r=this;this.$items.forEach((function(D,W,B){return c(D,W,r)}))},r.prototype.values=function(){return this.$items.values()},Object.defineProperty(r.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),r.prototype.setIndex=function(c,r){this.$indexes.set(c,r)},r.prototype.getIndex=function(c){return this.$indexes.get(c)},r.prototype.getByIndex=function(c){return this.$items.get(this.$indexes.get(c))},r.prototype.deleteByIndex=function(c){var r=this.$indexes.get(c);this.$items.delete(r),this.$indexes.delete(c)},r.prototype.toArray=function(){return Array.from(this.$items.values())},r.prototype.toJSON=function(){var c=[];return this.forEach((function(r,D){c.push("function"===typeof r.toJSON?r.toJSON():r)})),c},r.prototype.clone=function(c){var D;return c?D=Object.assign(new r,this):(D=new r,this.forEach((function(c){c.$changes?D.add(c.clone()):D.add(c)}))),D},r}(),Uc=function(){function c(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return c.prototype.addRefId=function(c){this.refIds.has(c)||(this.refIds.add(c),this.containerIndexes.set(c,new Set))},c.get=function(r){return void 0===r.$filterState&&(r.$filterState=new c),r.$filterState},c}(),Nc=function(){function c(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return c.prototype.getNextUniqueId=function(){return this.nextUniqueId++},c.prototype.addRef=function(c,r,D){void 0===D&&(D=!0),this.refs.set(c,r),D&&(this.refCounts[c]=(this.refCounts[c]||0)+1)},c.prototype.removeRef=function(c){this.refCounts[c]=this.refCounts[c]-1,this.deletedRefs.add(c)},c.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},c.prototype.garbageCollectDeletedRefs=function(){var c=this;this.deletedRefs.forEach((function(r){if(!(c.refCounts[r]>0)){var D=c.refs.get(r);if(D instanceof Ac)for(var W in D._definition.schema)"string"!==typeof D._definition.schema[W]&&D[W]&&D[W].$changes&&c.removeRef(D[W].$changes.refId);else{var B=D.$changes.parent._definition,t=B.schema[B.fieldsByIndex[D.$changes.parentIndex]];"function"===typeof Object.values(t)[0]&&Array.from(D.values()).forEach((function(r){return c.removeRef(r.$changes.refId)}))}c.refs.delete(r),delete c.refCounts[r]}})),this.deletedRefs.clear()},c}(),gc=function(c){function r(){return null!==c&&c.apply(this,arguments)||this}return D(r,c),r}(Error);function zc(c,r,D,W){var B,t=!1;switch(r){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":B="number",isNaN(c)&&console.log('trying to encode "NaN" in '.concat(D.constructor.name,"#").concat(W));break;case"string":B="string",t=!0;break;case"boolean":return}if(typeof c!==B&&(!t||t&&null!==c)){var u="'".concat(JSON.stringify(c),"'").concat(c&&c.constructor&&" (".concat(c.constructor.name,")")||"");throw new gc("a '".concat(B,"' was expected, but ").concat(u," was provided in ").concat(D.constructor.name,"#").concat(W))}}function Sc(c,r,D,W){if(!(c instanceof r))throw new gc("a '".concat(r.name,"' was expected, but '").concat(c.constructor.name,"' was provided in ").concat(D.constructor.name,"#").concat(W))}function Kc(c,r,D,W,B){zc(D,c,W,B);var t=i[c];if(!t)throw new gc("a '".concat(c,"' was expected, but ").concat(D," was provided in ").concat(W.constructor.name,"#").concat(B));t(r,D)}function fc(c,r,D){return Xc[c](r,D)}var Ac=function(){function r(){for(var c=[],r=0;r<arguments.length;r++)c[r]=arguments[r];Object.defineProperties(this,{$changes:{value:new H(this,void 0,new Nc),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var D=this._definition.descriptors;D&&Object.defineProperties(this,D),c[0]&&this.assign(c[0])}return r.onError=function(c){console.error(c)},r.is=function(c){return c._definition&&void 0!==c._definition.schema},r.prototype.onChange=function(r){return x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.REPLACE,r)},r.prototype.hr=function(r){return x(this.$callbacks||(this.$callbacks=[]),c.OPERATION.DELETE,r)},r.prototype.assign=function(c){return Object.assign(this,c),this},Object.defineProperty(r.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),r.prototype.setDirty=function(c,r){this.$changes.change(c,r)},r.prototype.listen=function(c,r,D){var W=this;return void 0===D&&(D=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[c]||(this.$callbacks[c]=[]),this.$callbacks[c].push(r),D&&void 0!==this[c]&&r(this[c],void 0),function(){return E(W.$callbacks[c],W.$callbacks[c].indexOf(r))}},r.prototype.decode=function(D,W,B){var t;void 0===W&&(W={offset:0}),void 0===B&&(B=this);var a=[],H=this.$changes.root,x=D.length,M=0;for(H.refs.set(M,this);W.offset<x;){var E=D[W.offset++];if(E!=u){var m=B.$changes,Y=void 0!==B._definition,k=Y?E>>6<<6:E;if(k!==c.OPERATION.CLEAR){var Z=Y?E%(k||255):Zc(D,W),J=Y?B._definition.fieldsByIndex[Z]:"",j=m.getType(Z),X=void 0,e=void 0,y=void 0;if(Y?e=B["_".concat(J)]:(e=B.getByIndex(Z),(k&c.OPERATION.ADD)===c.OPERATION.ADD?(y=B instanceof w?kc(D,W):Z,B.setIndex(Z,y)):y=B.getIndex(Z)),(k&c.OPERATION.DELETE)===c.OPERATION.DELETE&&(k!==c.OPERATION.DELETE_AND_ADD&&B.deleteByIndex(Z),e&&e.$changes&&H.removeRef(e.$changes.refId),X=null),void 0!==J){if(k===c.OPERATION.DELETE);else if(r.is(j)){var U=Zc(D,W);if(X=H.refs.get(U),k!==c.OPERATION.REPLACE){var N=this.getSchemaType(D,W,j);X||((X=this.createTypeInstance(N)).$changes.refId=U,e&&(X.$callbacks=e.$callbacks,e.$changes.refId&&U!==e.$changes.refId&&H.removeRef(e.$changes.refId))),H.addRef(U,X,X!==e)}}else if("string"===typeof j)X=fc(j,D,W);else{var g=q(Object.keys(j)[0]),z=Zc(D,W),S=H.refs.has(z)?e||H.refs.get(z):new g.constructor;if((X=S.clone(!0)).$changes.refId=z,e&&(X.$callbacks=e.$callbacks,e.$changes.refId&&z!==e.$changes.refId)){H.removeRef(e.$changes.refId);for(var K=e.entries(),f=void 0;(f=K.next())&&!f.done;){var A=(t=f.value)[0],h=t[1];a.push({refId:z,op:c.OPERATION.DELETE,field:A,value:void 0,previousValue:h})}}H.addRef(z,X,S!==e)}if(null!==X&&void 0!==X)if(X.$changes&&X.$changes.setParent(m.ref,m.root,Z),B instanceof r)B[J]=X;else if(B instanceof w)A=y,B.$items.set(A,X),B.$changes.allChanges.add(Z);else if(B instanceof v)B.setAt(Z,X);else if(B instanceof ec){var L=B.add(X);B.setIndex(Z,L)}else B instanceof yc&&!1!==(L=B.add(X))&&B.setIndex(Z,L);e!==X&&a.push({refId:M,op:k,field:J,dynamicIndex:y,value:X,previousValue:e})}else{console.warn("@colyseus/schema: definition mismatch");for(var P={offset:W.offset};W.offset<x&&(!jc(D,W)||(P.offset=W.offset+1,!H.refs.has(Zc(D,P))));)W.offset++}}else B.clear(a)}else{M=Zc(D,W);var G=H.refs.get(M);if(!G)throw new Error('"refId" not found: '.concat(M));B=G}}return this._triggerChanges(a),H.garbageCollectDeletedRefs(),a},r.prototype.encode=function(D,W,B){void 0===D&&(D=!1),void 0===W&&(W=[]),void 0===B&&(B=!1);for(var t=this.$changes,a=new WeakSet,H=[t],x=1,M=0;M<x;M++){var E=H[M],m=E.ref,Y=m instanceof r;E.ensureRefId(),a.add(E),E!==t&&(E.changed||D)&&(h(W,u),I(W,E.refId));for(var v=D?Array.from(E.allChanges):Array.from(E.changes.values()),k=0,Z=v.length;k<Z;k++){var J=D?{op:c.OPERATION.ADD,index:v[k]}:v[k],j=J.index,X=Y?m._definition.fieldsByIndex&&m._definition.fieldsByIndex[j]:j,e=W.length;if(J.op!==c.OPERATION.TOUCH)if(Y)h(W,j|J.op);else{if(h(W,J.op),J.op===c.OPERATION.CLEAR)continue;I(W,j)}if(Y||(J.op&c.OPERATION.ADD)!=c.OPERATION.ADD||m instanceof w&&F(W,E.ref.$indexes.get(j)),J.op!==c.OPERATION.DELETE){var y=E.getType(j),U=E.getValue(j);if(U&&U.$changes&&!a.has(U.$changes)&&(H.push(U.$changes),U.$changes.ensureRefId(),x++),J.op!==c.OPERATION.TOUCH){if(r.is(y))Sc(U,y,m,X),I(W,U.$changes.refId),(J.op&c.OPERATION.ADD)===c.OPERATION.ADD&&this.tryEncodeTypeId(W,y,U.constructor);else if("string"===typeof y)Kc(y,W,U,m,X);else{var N=q(Object.keys(y)[0]);Sc(m["_".concat(X)],N.constructor,m,X),I(W,U.$changes.refId)}B&&E.cache(j,W.slice(e))}}}D||B||E.discard()}return W},r.prototype.encodeAll=function(c){return this.encode(!0,[],c)},r.prototype.applyFilters=function(D,W){var B,t;void 0===W&&(W=!1);for(var a=this,H=new Set,x=Uc.get(D),M=[this.$changes],E=1,m=[],Y=function(Y){var v=M[Y];if(H.has(v.refId))return"continue";var k=v.ref,Z=k instanceof r;h(m,u),I(m,v.refId);var J=x.refIds.has(v),q=W||!J;x.addRefId(v);var j=x.containerIndexes.get(v),X=q?Array.from(v.allChanges):Array.from(v.changes.values());!W&&Z&&k._definition.indexesWithFilters&&k._definition.indexesWithFilters.forEach((function(r){!j.has(r)&&v.allChanges.has(r)&&(q?X.push(r):X.push({op:c.OPERATION.ADD,index:r}))}));for(var e=0,y=X.length;e<y;e++){var U=q?{op:c.OPERATION.ADD,index:X[e]}:X[e];if(U.op!==c.OPERATION.CLEAR){var N=U.index;if(U.op!==c.OPERATION.DELETE){var g=v.getValue(N),z=v.getType(N);if(Z){if((S=k._definition.filters&&k._definition.filters[N])&&!S.call(k,D,g,a)){g&&g.$changes&&H.add(g.$changes.refId);continue}}else{var S,K=v.parent;if((S=v.getChildrenFilter())&&!S.call(K,D,k.$indexes.get(N),g,a)){g&&g.$changes&&H.add(g.$changes.refId);continue}}if(g.$changes&&(M.push(g.$changes),E++),U.op!==c.OPERATION.TOUCH)if(U.op===c.OPERATION.ADD||Z)m.push.apply(m,null!==(B=v.caches[N])&&void 0!==B?B:[]),j.add(N);else if(j.has(N))m.push.apply(m,null!==(t=v.caches[N])&&void 0!==t?t:[]);else{if(j.add(N),h(m,c.OPERATION.ADD),I(m,N),k instanceof w){var f=v.ref.$indexes.get(N);F(m,f)}g.$changes?I(m,g.$changes.refId):i[z](m,g)}else g.$changes&&!Z&&(h(m,c.OPERATION.ADD),I(m,N),k instanceof w&&(f=v.ref.$indexes.get(N),F(m,f)),I(m,g.$changes.refId))}else Z?h(m,U.op|N):(h(m,U.op),I(m,N))}else h(m,U.op)}},v=0;v<E;v++)Y(v);return m},r.prototype.clone=function(){var c,r=new this.constructor,D=this._definition.schema;for(var W in D)"object"===typeof this[W]&&"function"===typeof(null===(c=this[W])||void 0===c?void 0:c.clone)?r[W]=this[W].clone():r[W]=this[W];return r},r.prototype.toJSON=function(){var c=this._definition.schema,r=this._definition.deprecated,D={};for(var W in c)r[W]||null===this[W]||"undefined"===typeof this[W]||(D[W]="function"===typeof this[W].toJSON?this[W].toJSON():this["_".concat(W)]);return D},r.prototype.discardAllChanges=function(){this.$changes.discardAll()},r.prototype.getByIndex=function(c){return this[this._definition.fieldsByIndex[c]]},r.prototype.deleteByIndex=function(c){this[this._definition.fieldsByIndex[c]]=void 0},r.prototype.tryEncodeTypeId=function(c,r,D){r._typeid!==D._typeid&&(h(c,a),I(c,D._typeid))},r.prototype.getSchemaType=function(c,r,D){var W;return c[r.offset]===a&&(r.offset++,W=this.constructor._context.get(Zc(c,r))),W||D},r.prototype.createTypeInstance=function(c){var r=new c;return r.$changes.root=this.$changes.root,r},r.prototype._triggerChanges=function(D){for(var W,B,t,u,a,H,x,M,E,m=new Set,Y=this.$changes.root.refs,v=function(v){var k=D[v],w=k.refId,Z=Y.get(w),J=Z.$callbacks;if((k.op&c.OPERATION.DELETE)===c.OPERATION.DELETE&&k.previousValue instanceof r&&(null===(B=null===(W=k.previousValue.$callbacks)||void 0===W?void 0:W[c.OPERATION.DELETE])||void 0===B||B.forEach((function(c){return c()}))),!J)return"continue";if(Z instanceof r){if(!m.has(w))try{null===(t=null===J||void 0===J?void 0:J[c.OPERATION.REPLACE])||void 0===t||t.forEach((function(c){return c()}))}catch(q){r.onError(q)}try{J.hasOwnProperty(k.field)&&(null===(u=J[k.field])||void 0===u||u.forEach((function(c){return c(k.value,k.previousValue)})))}catch(q){r.onError(q)}}else k.op===c.OPERATION.ADD&&void 0===k.previousValue?null===(a=J[c.OPERATION.ADD])||void 0===a||a.forEach((function(c){var r;return c(k.value,null!==(r=k.dynamicIndex)&&void 0!==r?r:k.field)})):k.op===c.OPERATION.DELETE?void 0!==k.previousValue&&(null===(H=J[c.OPERATION.DELETE])||void 0===H||H.forEach((function(c){var r;return c(k.previousValue,null!==(r=k.dynamicIndex)&&void 0!==r?r:k.field)}))):k.op===c.OPERATION.DELETE_AND_ADD&&(void 0!==k.previousValue&&(null===(x=J[c.OPERATION.DELETE])||void 0===x||x.forEach((function(c){var r;return c(k.previousValue,null!==(r=k.dynamicIndex)&&void 0!==r?r:k.field)}))),null===(M=J[c.OPERATION.ADD])||void 0===M||M.forEach((function(c){var r;return c(k.value,null!==(r=k.dynamicIndex)&&void 0!==r?r:k.field)}))),k.value!==k.previousValue&&(null===(E=J[c.OPERATION.REPLACE])||void 0===E||E.forEach((function(c){var r;return c(k.value,null!==(r=k.dynamicIndex)&&void 0!==r?r:k.field)})));m.add(w)},k=0;k<D.length;k++)v(k)},r._definition=j.create(),r}();function hc(c){for(var r=[c.$changes],D=1,W={},B=W,t=function(c){var D=r[c];D.changes.forEach((function(c){var r=D.ref,W=c.index,t=r._definition?r._definition.fieldsByIndex[W]:r.$indexes.get(W);B[t]=D.getValue(W)}))},u=0;u<D;u++)t(u);return W}var Lc={context:new e},Pc=function(c){function r(){return null!==c&&c.apply(this,arguments)||this}return D(r,c),W([U("string",Lc)],r.prototype,"name",void 0),W([U("string",Lc)],r.prototype,"type",void 0),W([U("number",Lc)],r.prototype,"referencedType",void 0),r}(Ac),Gc=function(c){function r(){var r=null!==c&&c.apply(this,arguments)||this;return r.fields=new v,r}return D(r,c),W([U("number",Lc)],r.prototype,"id",void 0),W([U([Pc],Lc)],r.prototype,"fields",void 0),r}(Ac),dc=function(c){function r(){var r=null!==c&&c.apply(this,arguments)||this;return r.types=new v,r}return D(r,c),r.encode=function(c){var D=c.constructor,W=new r;W.rootType=D._typeid;var B=function(c,r){for(var D in r){var B=new Pc;B.name=D;var t=void 0;if("string"===typeof r[D])t=r[D];else{var u=r[D],a=void 0;Ac.is(u)?(t="ref",a=r[D]):"string"===typeof u[t=Object.keys(u)[0]]?t+=":"+u[t]:a=u[t],B.referencedType=a?a._typeid:-1}B.type=t,c.fields.push(B)}W.types.push(c)},t=D._context.types;for(var u in t){var a=new Gc;a.id=Number(u),B(a,t[u]._definition.schema)}return W.encodeAll()},r.decode=function(c,W){var B=new e,t=new r;t.decode(c,W);var u=t.types.reduce((function(c,r){var W=function(c){function r(){return null!==c&&c.apply(this,arguments)||this}return D(r,c),r}(Ac),t=r.id;return c[t]=W,B.add(W,t),c}),{});t.types.forEach((function(c){var r=u[c.id];c.fields.forEach((function(c){var D;if(void 0!==c.referencedType){var W=c.type,t=u[c.referencedType];if(!t){var a=c.type.split(":");W=a[0],t=a[1]}"ref"===W?U(t,{context:B})(r.prototype,c.name):U(((D={})[W]=t,D),{context:B})(r.prototype,c.name)}else U(c.type,{context:B})(r.prototype,c.name)}))}));var a=u[t.rootType],H=new a;for(var x in a._definition.schema){var M=a._definition.schema[x];"string"!==typeof M&&(H[x]="function"===typeof M?new M:new(q(Object.keys(M)[0]).constructor))}return H},W([U([Gc],Lc)],r.prototype,"types",void 0),W([U("number",Lc)],r.prototype,"rootType",void 0),r}(Ac);J("map",{constructor:w}),J("array",{constructor:v}),J("set",{constructor:yc}),J("collection",{constructor:ec}),c.ArraySchema=v,c.CollectionSchema=ec,c.Context=e,c.MapSchema=w,c.Reflection=dc,c.ReflectionField=Pc,c.ReflectionType=Gc,c.Schema=Ac,c.SchemaDefinition=j,c.SetSchema=yc,c.decode=Xc,c.defineTypes=S,c.deprecated=z,c.dumpChanges=hc,c.encode=i,c.filter=N,c.filterChildren=g,c.hasFilter=X,c.registerType=J,c.type=U,Object.defineProperty(c,"__esModule",{value:!0})}(r)},13809:c=>{"use strict";c.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13802:(c,r,D)=>{var W=D(13809),B=D(13813),t=Object.hasOwnProperty,u=Object.create(null);for(var a in W)t.call(W,a)&&(u[W[a]]=a);var H=c.exports={to:{},get:{}};function x(c,r,D){return Math.min(Math.max(r,c),D)}function M(c){var r=Math.round(c).toString(16).toUpperCase();return r.length<2?"0"+r:r}H.get=function(c){var r,D;switch(c.substring(0,3).toLowerCase()){case"hsl":r=H.get.hsl(c),D="hsl";break;case"hwb":r=H.get.hwb(c),D="hwb";break;default:r=H.get.rgb(c),D="rgb"}return r?{model:D,value:r}:null},H.get.rgb=function(c){if(!c)return null;var r,D,B,u=[0,0,0,1];if(r=c.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(B=r[2],r=r[1],D=0;D<3;D++){var a=2*D;u[D]=parseInt(r.slice(a,a+2),16)}B&&(u[3]=parseInt(B,16)/255)}else if(r=c.match(/^#([a-f0-9]{3,4})$/i)){for(B=(r=r[1])[3],D=0;D<3;D++)u[D]=parseInt(r[D]+r[D],16);B&&(u[3]=parseInt(B+B,16)/255)}else if(r=c.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(D=0;D<3;D++)u[D]=parseInt(r[D+1],0);r[4]&&(r[5]?u[3]=.01*parseFloat(r[4]):u[3]=parseFloat(r[4]))}else{if(!(r=c.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(r=c.match(/^(\w+)$/))?"transparent"===r[1]?[0,0,0,0]:t.call(W,r[1])?((u=W[r[1]])[3]=1,u):null:null;for(D=0;D<3;D++)u[D]=Math.round(2.55*parseFloat(r[D+1]));r[4]&&(r[5]?u[3]=.01*parseFloat(r[4]):u[3]=parseFloat(r[4]))}for(D=0;D<3;D++)u[D]=x(u[D],0,255);return u[3]=x(u[3],0,1),u},H.get.hsl=function(c){if(!c)return null;var r=c.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(r){var D=parseFloat(r[4]);return[(parseFloat(r[1])%360+360)%360,x(parseFloat(r[2]),0,100),x(parseFloat(r[3]),0,100),x(isNaN(D)?1:D,0,1)]}return null},H.get.hwb=function(c){if(!c)return null;var r=c.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(r){var D=parseFloat(r[4]);return[(parseFloat(r[1])%360+360)%360,x(parseFloat(r[2]),0,100),x(parseFloat(r[3]),0,100),x(isNaN(D)?1:D,0,1)]}return null},H.to.hex=function(){var c=B(arguments);return"#"+M(c[0])+M(c[1])+M(c[2])+(c[3]<1?M(Math.round(255*c[3])):"")},H.to.rgb=function(){var c=B(arguments);return c.length<4||1===c[3]?"rgb("+Math.round(c[0])+", "+Math.round(c[1])+", "+Math.round(c[2])+")":"rgba("+Math.round(c[0])+", "+Math.round(c[1])+", "+Math.round(c[2])+", "+c[3]+")"},H.to.rgb.percent=function(){var c=B(arguments),r=Math.round(c[0]/255*100),D=Math.round(c[1]/255*100),W=Math.round(c[2]/255*100);return c.length<4||1===c[3]?"rgb("+r+"%, "+D+"%, "+W+"%)":"rgba("+r+"%, "+D+"%, "+W+"%, "+c[3]+")"},H.to.hsl=function(){var c=B(arguments);return c.length<4||1===c[3]?"hsl("+c[0]+", "+c[1]+"%, "+c[2]+"%)":"hsla("+c[0]+", "+c[1]+"%, "+c[2]+"%, "+c[3]+")"},H.to.hwb=function(){var c=B(arguments),r="";return c.length>=4&&1!==c[3]&&(r=", "+c[3]),"hwb("+c[0]+", "+c[1]+"%, "+c[2]+"%"+r+")"},H.to.keyword=function(c){return u[c.slice(0,3)]}},13796:(c,r,D)=>{const W=D(13802),B=D(13825),t=["keyword","gray","hex"],u={};for(const Y of Object.keys(B))u[[...B[Y].labels].sort().join("")]=Y;const a={};function H(c,r){if(!(this instanceof H))return new H(c,r);if(r&&r in t&&(r=null),r&&!(r in B))throw new Error("Unknown model: "+r);let D,x;if(null==c)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(c instanceof H)this.model=c.model,this.color=[...c.color],this.valpha=c.valpha;else if("string"===typeof c){const r=W.get(c);if(null===r)throw new Error("Unable to parse color from string: "+c);this.model=r.model,x=B[this.model].channels,this.color=r.value.slice(0,x),this.valpha="number"===typeof r.value[x]?r.value[x]:1}else if(c.length>0){this.model=r||"rgb",x=B[this.model].channels;const D=Array.prototype.slice.call(c,0,x);this.color=m(D,x),this.valpha="number"===typeof c[x]?c[x]:1}else if("number"===typeof c)this.model="rgb",this.color=[c>>16&255,c>>8&255,255&c],this.valpha=1;else{this.valpha=1;const r=Object.keys(c);"alpha"in c&&(r.splice(r.indexOf("alpha"),1),this.valpha="number"===typeof c.alpha?c.alpha:0);const W=r.sort().join("");if(!(W in u))throw new Error("Unable to parse color from object: "+JSON.stringify(c));this.model=u[W];const{labels:t}=B[this.model],a=[];for(D=0;D<t.length;D++)a.push(c[t[D]]);this.color=m(a)}if(a[this.model])for(x=B[this.model].channels,D=0;D<x;D++){const c=a[this.model][D];c&&(this.color[D]=c(this.color[D]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}H.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(c){let r=this.model in W.to?this:this.rgb();r=r.round("number"===typeof c?c:1);const D=1===r.valpha?r.color:[...r.color,this.valpha];return W.to[r.model](D)},percentString(c){const r=this.rgb().round("number"===typeof c?c:1),D=1===r.valpha?r.color:[...r.color,this.valpha];return W.to.rgb.percent(D)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const c={},{channels:r}=B[this.model],{labels:D}=B[this.model];for(let W=0;W<r;W++)c[D[W]]=this.color[W];return 1!==this.valpha&&(c.alpha=this.valpha),c},unitArray(){const c=this.rgb().color;return c[0]/=255,c[1]/=255,c[2]/=255,1!==this.valpha&&c.push(this.valpha),c},unitObject(){const c=this.rgb().object();return c.r/=255,c.g/=255,c.b/=255,1!==this.valpha&&(c.alpha=this.valpha),c},round(c){return c=Math.max(c||0,0),new H([...this.color.map(x(c)),this.valpha],this.model)},alpha(c){return void 0!==c?new H([...this.color,Math.max(0,Math.min(1,c))],this.model):this.valpha},red:M("rgb",0,E(255)),green:M("rgb",1,E(255)),blue:M("rgb",2,E(255)),hue:M(["hsl","hsv","hsl","hwb","hcg"],0,(c=>(c%360+360)%360)),saturationl:M("hsl",1,E(100)),lightness:M("hsl",2,E(100)),saturationv:M("hsv",1,E(100)),value:M("hsv",2,E(100)),chroma:M("hcg",1,E(100)),gray:M("hcg",2,E(100)),white:M("hwb",1,E(100)),wblack:M("hwb",2,E(100)),cyan:M("cmyk",0,E(100)),magenta:M("cmyk",1,E(100)),yellow:M("cmyk",2,E(100)),black:M("cmyk",3,E(100)),x:M("xyz",0,E(95.047)),y:M("xyz",1,E(100)),z:M("xyz",2,E(108.833)),l:M("lab",0,E(100)),a:M("lab",1),b:M("lab",2),keyword(c){return void 0!==c?new H(c):B[this.model].keyword(this.color)},hex(c){return void 0!==c?new H(c):W.to.hex(this.rgb().round().color)},hexa(c){if(void 0!==c)return new H(c);const r=this.rgb().round().color;let D=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===D.length&&(D="0"+D),W.to.hex(r)+D},rgbNumber(){const c=this.rgb().color;return(255&c[0])<<16|(255&c[1])<<8|255&c[2]},luminosity(){const c=this.rgb().color,r=[];for(const[D,W]of c.entries()){const c=W/255;r[D]=c<=.04045?c/12.92:((c+.055)/1.055)**2.4}return.2126*r[0]+.7152*r[1]+.0722*r[2]},contrast(c){const r=this.luminosity(),D=c.luminosity();return r>D?(r+.05)/(D+.05):(D+.05)/(r+.05)},level(c){const r=this.contrast(c);return r>=7?"AAA":r>=4.5?"AA":""},isDark(){const c=this.rgb().color;return(2126*c[0]+7152*c[1]+722*c[2])/1e4<128},isLight(){return!this.isDark()},negate(){const c=this.rgb();for(let r=0;r<3;r++)c.color[r]=255-c.color[r];return c},lighten(c){const r=this.hsl();return r.color[2]+=r.color[2]*c,r},darken(c){const r=this.hsl();return r.color[2]-=r.color[2]*c,r},saturate(c){const r=this.hsl();return r.color[1]+=r.color[1]*c,r},desaturate(c){const r=this.hsl();return r.color[1]-=r.color[1]*c,r},whiten(c){const r=this.hwb();return r.color[1]+=r.color[1]*c,r},blacken(c){const r=this.hwb();return r.color[2]+=r.color[2]*c,r},grayscale(){const c=this.rgb().color,r=.3*c[0]+.59*c[1]+.11*c[2];return H.rgb(r,r,r)},fade(c){return this.alpha(this.valpha-this.valpha*c)},opaquer(c){return this.alpha(this.valpha+this.valpha*c)},rotate(c){const r=this.hsl();let D=r.color[0];return D=(D+c)%360,D=D<0?360+D:D,r.color[0]=D,r},mix(c,r){if(!c||!c.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof c);const D=c.rgb(),W=this.rgb(),B=void 0===r?.5:r,t=2*B-1,u=D.alpha()-W.alpha(),a=((t*u===-1?t:(t+u)/(1+t*u))+1)/2,x=1-a;return H.rgb(a*D.red()+x*W.red(),a*D.green()+x*W.green(),a*D.blue()+x*W.blue(),D.alpha()*B+W.alpha()*(1-B))}};for(const Y of Object.keys(B)){if(t.includes(Y))continue;const{channels:c}=B[Y];H.prototype[Y]=function(){if(this.model===Y)return new H(this);for(var c=arguments.length,r=new Array(c),D=0;D<c;D++)r[D]=arguments[D];return r.length>0?new H(r,Y):new H([...(W=B[this.model][Y].raw(this.color),Array.isArray(W)?W:[W]),this.valpha],Y);var W},H[Y]=function(){for(var r=arguments.length,D=new Array(r),W=0;W<r;W++)D[W]=arguments[W];let B=D[0];return"number"===typeof B&&(B=m(D,c)),new H(B,Y)}}function x(c){return function(r){return function(c,r){return Number(c.toFixed(r))}(r,c)}}function M(c,r,D){c=Array.isArray(c)?c:[c];for(const W of c)(a[W]||(a[W]=[]))[r]=D;return c=c[0],function(W){let B;return void 0!==W?(D&&(W=D(W)),B=this[c](),B.color[r]=W,B):(B=this[c]().color[r],D&&(B=D(B)),B)}}function E(c){return function(r){return Math.max(0,Math.min(c,r))}}function m(c,r){for(let D=0;D<r;D++)"number"!==typeof c[D]&&(c[D]=0);return c}c.exports=H},13834:(c,r,D)=>{const W=D(13840),B={};for(const u of Object.keys(W))B[W[u]]=u;const t={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};c.exports=t;for(const u of Object.keys(t)){if(!("channels"in t[u]))throw new Error("missing channels property: "+u);if(!("labels"in t[u]))throw new Error("missing channel labels property: "+u);if(t[u].labels.length!==t[u].channels)throw new Error("channel and label counts mismatch: "+u);const{channels:c,labels:r}=t[u];delete t[u].channels,delete t[u].labels,Object.defineProperty(t[u],"channels",{value:c}),Object.defineProperty(t[u],"labels",{value:r})}t.rgb.hsl=function(c){const r=c[0]/255,D=c[1]/255,W=c[2]/255,B=Math.min(r,D,W),t=Math.max(r,D,W),u=t-B;let a,H;t===B?a=0:r===t?a=(D-W)/u:D===t?a=2+(W-r)/u:W===t&&(a=4+(r-D)/u),a=Math.min(60*a,360),a<0&&(a+=360);const x=(B+t)/2;return H=t===B?0:x<=.5?u/(t+B):u/(2-t-B),[a,100*H,100*x]},t.rgb.hsv=function(c){let r,D,W,B,t;const u=c[0]/255,a=c[1]/255,H=c[2]/255,x=Math.max(u,a,H),M=x-Math.min(u,a,H),E=function(c){return(x-c)/6/M+.5};return 0===M?(B=0,t=0):(t=M/x,r=E(u),D=E(a),W=E(H),u===x?B=W-D:a===x?B=1/3+r-W:H===x&&(B=2/3+D-r),B<0?B+=1:B>1&&(B-=1)),[360*B,100*t,100*x]},t.rgb.hwb=function(c){const r=c[0],D=c[1];let W=c[2];const B=t.rgb.hsl(c)[0],u=1/255*Math.min(r,Math.min(D,W));return W=1-1/255*Math.max(r,Math.max(D,W)),[B,100*u,100*W]},t.rgb.cmyk=function(c){const r=c[0]/255,D=c[1]/255,W=c[2]/255,B=Math.min(1-r,1-D,1-W);return[100*((1-r-B)/(1-B)||0),100*((1-D-B)/(1-B)||0),100*((1-W-B)/(1-B)||0),100*B]},t.rgb.keyword=function(c){const r=B[c];if(r)return r;let D,t=1/0;for(const B of Object.keys(W)){const r=W[B],H=(a=r,((u=c)[0]-a[0])**2+(u[1]-a[1])**2+(u[2]-a[2])**2);H<t&&(t=H,D=B)}var u,a;return D},t.keyword.rgb=function(c){return W[c]},t.rgb.xyz=function(c){let r=c[0]/255,D=c[1]/255,W=c[2]/255;r=r>.04045?((r+.055)/1.055)**2.4:r/12.92,D=D>.04045?((D+.055)/1.055)**2.4:D/12.92,W=W>.04045?((W+.055)/1.055)**2.4:W/12.92;return[100*(.4124*r+.3576*D+.1805*W),100*(.2126*r+.7152*D+.0722*W),100*(.0193*r+.1192*D+.9505*W)]},t.rgb.lab=function(c){const r=t.rgb.xyz(c);let D=r[0],W=r[1],B=r[2];D/=95.047,W/=100,B/=108.883,D=D>.008856?D**(1/3):7.787*D+16/116,W=W>.008856?W**(1/3):7.787*W+16/116,B=B>.008856?B**(1/3):7.787*B+16/116;return[116*W-16,500*(D-W),200*(W-B)]},t.hsl.rgb=function(c){const r=c[0]/360,D=c[1]/100,W=c[2]/100;let B,t,u;if(0===D)return u=255*W,[u,u,u];B=W<.5?W*(1+D):W+D-W*D;const a=2*W-B,H=[0,0,0];for(let x=0;x<3;x++)t=r+1/3*-(x-1),t<0&&t++,t>1&&t--,u=6*t<1?a+6*(B-a)*t:2*t<1?B:3*t<2?a+(B-a)*(2/3-t)*6:a,H[x]=255*u;return H},t.hsl.hsv=function(c){const r=c[0];let D=c[1]/100,W=c[2]/100,B=D;const t=Math.max(W,.01);W*=2,D*=W<=1?W:2-W,B*=t<=1?t:2-t;return[r,100*(0===W?2*B/(t+B):2*D/(W+D)),100*((W+D)/2)]},t.hsv.rgb=function(c){const r=c[0]/60,D=c[1]/100;let W=c[2]/100;const B=Math.floor(r)%6,t=r-Math.floor(r),u=255*W*(1-D),a=255*W*(1-D*t),H=255*W*(1-D*(1-t));switch(W*=255,B){case 0:return[W,H,u];case 1:return[a,W,u];case 2:return[u,W,H];case 3:return[u,a,W];case 4:return[H,u,W];case 5:return[W,u,a]}},t.hsv.hsl=function(c){const r=c[0],D=c[1]/100,W=c[2]/100,B=Math.max(W,.01);let t,u;u=(2-D)*W;const a=(2-D)*B;return t=D*B,t/=a<=1?a:2-a,t=t||0,u/=2,[r,100*t,100*u]},t.hwb.rgb=function(c){const r=c[0]/360;let D=c[1]/100,W=c[2]/100;const B=D+W;let t;B>1&&(D/=B,W/=B);const u=Math.floor(6*r),a=1-W;t=6*r-u,0!==(1&u)&&(t=1-t);const H=D+t*(a-D);let x,M,E;switch(u){default:case 6:case 0:x=a,M=H,E=D;break;case 1:x=H,M=a,E=D;break;case 2:x=D,M=a,E=H;break;case 3:x=D,M=H,E=a;break;case 4:x=H,M=D,E=a;break;case 5:x=a,M=D,E=H}return[255*x,255*M,255*E]},t.cmyk.rgb=function(c){const r=c[0]/100,D=c[1]/100,W=c[2]/100,B=c[3]/100;return[255*(1-Math.min(1,r*(1-B)+B)),255*(1-Math.min(1,D*(1-B)+B)),255*(1-Math.min(1,W*(1-B)+B))]},t.xyz.rgb=function(c){const r=c[0]/100,D=c[1]/100,W=c[2]/100;let B,t,u;return B=3.2406*r+-1.5372*D+-.4986*W,t=-.9689*r+1.8758*D+.0415*W,u=.0557*r+-.204*D+1.057*W,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,t=t>.0031308?1.055*t**(1/2.4)-.055:12.92*t,u=u>.0031308?1.055*u**(1/2.4)-.055:12.92*u,B=Math.min(Math.max(0,B),1),t=Math.min(Math.max(0,t),1),u=Math.min(Math.max(0,u),1),[255*B,255*t,255*u]},t.xyz.lab=function(c){let r=c[0],D=c[1],W=c[2];r/=95.047,D/=100,W/=108.883,r=r>.008856?r**(1/3):7.787*r+16/116,D=D>.008856?D**(1/3):7.787*D+16/116,W=W>.008856?W**(1/3):7.787*W+16/116;return[116*D-16,500*(r-D),200*(D-W)]},t.lab.xyz=function(c){let r,D,W;D=(c[0]+16)/116,r=c[1]/500+D,W=D-c[2]/200;const B=D**3,t=r**3,u=W**3;return D=B>.008856?B:(D-16/116)/7.787,r=t>.008856?t:(r-16/116)/7.787,W=u>.008856?u:(W-16/116)/7.787,r*=95.047,D*=100,W*=108.883,[r,D,W]},t.lab.lch=function(c){const r=c[0],D=c[1],W=c[2];let B;B=360*Math.atan2(W,D)/2/Math.PI,B<0&&(B+=360);return[r,Math.sqrt(D*D+W*W),B]},t.lch.lab=function(c){const r=c[0],D=c[1],W=c[2]/360*2*Math.PI;return[r,D*Math.cos(W),D*Math.sin(W)]},t.rgb.ansi16=function(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[D,W,B]=c;let u=null===r?t.rgb.hsv(c)[2]:r;if(u=Math.round(u/50),0===u)return 30;let a=30+(Math.round(B/255)<<2|Math.round(W/255)<<1|Math.round(D/255));return 2===u&&(a+=60),a},t.hsv.ansi16=function(c){return t.rgb.ansi16(t.hsv.rgb(c),c[2])},t.rgb.ansi256=function(c){const r=c[0],D=c[1],W=c[2];if(r===D&&D===W)return r<8?16:r>248?231:Math.round((r-8)/247*24)+232;return 16+36*Math.round(r/255*5)+6*Math.round(D/255*5)+Math.round(W/255*5)},t.ansi16.rgb=function(c){let r=c%10;if(0===r||7===r)return c>50&&(r+=3.5),r=r/10.5*255,[r,r,r];const D=.5*(1+~~(c>50));return[(1&r)*D*255,(r>>1&1)*D*255,(r>>2&1)*D*255]},t.ansi256.rgb=function(c){if(c>=232){const r=10*(c-232)+8;return[r,r,r]}let r;c-=16;return[Math.floor(c/36)/5*255,Math.floor((r=c%36)/6)/5*255,r%6/5*255]},t.rgb.hex=function(c){const r=(((255&Math.round(c[0]))<<16)+((255&Math.round(c[1]))<<8)+(255&Math.round(c[2]))).toString(16).toUpperCase();return"000000".substring(r.length)+r},t.hex.rgb=function(c){const r=c.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!r)return[0,0,0];let D=r[0];3===r[0].length&&(D=D.split("").map((c=>c+c)).join(""));const W=parseInt(D,16);return[W>>16&255,W>>8&255,255&W]},t.rgb.hcg=function(c){const r=c[0]/255,D=c[1]/255,W=c[2]/255,B=Math.max(Math.max(r,D),W),t=Math.min(Math.min(r,D),W),u=B-t;let a,H;return a=u<1?t/(1-u):0,H=u<=0?0:B===r?(D-W)/u%6:B===D?2+(W-r)/u:4+(r-D)/u,H/=6,H%=1,[360*H,100*u,100*a]},t.hsl.hcg=function(c){const r=c[1]/100,D=c[2]/100,W=D<.5?2*r*D:2*r*(1-D);let B=0;return W<1&&(B=(D-.5*W)/(1-W)),[c[0],100*W,100*B]},t.hsv.hcg=function(c){const r=c[1]/100,D=c[2]/100,W=r*D;let B=0;return W<1&&(B=(D-W)/(1-W)),[c[0],100*W,100*B]},t.hcg.rgb=function(c){const r=c[0]/360,D=c[1]/100,W=c[2]/100;if(0===D)return[255*W,255*W,255*W];const B=[0,0,0],t=r%1*6,u=t%1,a=1-u;let H=0;switch(Math.floor(t)){case 0:B[0]=1,B[1]=u,B[2]=0;break;case 1:B[0]=a,B[1]=1,B[2]=0;break;case 2:B[0]=0,B[1]=1,B[2]=u;break;case 3:B[0]=0,B[1]=a,B[2]=1;break;case 4:B[0]=u,B[1]=0,B[2]=1;break;default:B[0]=1,B[1]=0,B[2]=a}return H=(1-D)*W,[255*(D*B[0]+H),255*(D*B[1]+H),255*(D*B[2]+H)]},t.hcg.hsv=function(c){const r=c[1]/100,D=r+c[2]/100*(1-r);let W=0;return D>0&&(W=r/D),[c[0],100*W,100*D]},t.hcg.hsl=function(c){const r=c[1]/100,D=c[2]/100*(1-r)+.5*r;let W=0;return D>0&&D<.5?W=r/(2*D):D>=.5&&D<1&&(W=r/(2*(1-D))),[c[0],100*W,100*D]},t.hcg.hwb=function(c){const r=c[1]/100,D=r+c[2]/100*(1-r);return[c[0],100*(D-r),100*(1-D)]},t.hwb.hcg=function(c){const r=c[1]/100,D=1-c[2]/100,W=D-r;let B=0;return W<1&&(B=(D-W)/(1-W)),[c[0],100*W,100*B]},t.apple.rgb=function(c){return[c[0]/65535*255,c[1]/65535*255,c[2]/65535*255]},t.rgb.apple=function(c){return[c[0]/255*65535,c[1]/255*65535,c[2]/255*65535]},t.gray.rgb=function(c){return[c[0]/100*255,c[0]/100*255,c[0]/100*255]},t.gray.hsl=function(c){return[0,0,c[0]]},t.gray.hsv=t.gray.hsl,t.gray.hwb=function(c){return[0,100,c[0]]},t.gray.cmyk=function(c){return[0,0,0,c[0]]},t.gray.lab=function(c){return[c[0],0,0]},t.gray.hex=function(c){const r=255&Math.round(c[0]/100*255),D=((r<<16)+(r<<8)+r).toString(16).toUpperCase();return"000000".substring(D.length)+D},t.rgb.gray=function(c){return[(c[0]+c[1]+c[2])/3/255*100]}},13825:(c,r,D)=>{const W=D(13834),B=D(13849),t={};Object.keys(W).forEach((c=>{t[c]={},Object.defineProperty(t[c],"channels",{value:W[c].channels}),Object.defineProperty(t[c],"labels",{value:W[c].labels});const r=B(c);Object.keys(r).forEach((D=>{const W=r[D];t[c][D]=function(c){const r=function(){for(var r=arguments.length,D=new Array(r),W=0;W<r;W++)D[W]=arguments[W];const B=D[0];if(void 0===B||null===B)return B;B.length>1&&(D=B);const t=c(D);if("object"===typeof t)for(let c=t.length,u=0;u<c;u++)t[u]=Math.round(t[u]);return t};return"conversion"in c&&(r.conversion=c.conversion),r}(W),t[c][D].raw=function(c){const r=function(){for(var r=arguments.length,D=new Array(r),W=0;W<r;W++)D[W]=arguments[W];const B=D[0];return void 0===B||null===B?B:(B.length>1&&(D=B),c(D))};return"conversion"in c&&(r.conversion=c.conversion),r}(W)}))})),c.exports=t},13849:(c,r,D)=>{const W=D(13834);function B(c){const r=function(){const c={},r=Object.keys(W);for(let D=r.length,W=0;W<D;W++)c[r[W]]={distance:-1,parent:null};return c}(),D=[c];for(r[c].distance=0;D.length;){const c=D.pop(),B=Object.keys(W[c]);for(let W=B.length,t=0;t<W;t++){const W=B[t],u=r[W];-1===u.distance&&(u.distance=r[c].distance+1,u.parent=c,D.unshift(W))}}return r}function t(c,r){return function(D){return r(c(D))}}function u(c,r){const D=[r[c].parent,c];let B=W[r[c].parent][c],u=r[c].parent;for(;r[u].parent;)D.unshift(r[u].parent),B=t(W[r[u].parent][u],B),u=r[u].parent;return B.conversion=D,B}c.exports=function(c){const r=B(c),D={},W=Object.keys(r);for(let B=W.length,t=0;t<B;t++){const c=W[t];null!==r[c].parent&&(D[c]=u(c,r))}return D}},13840:c=>{"use strict";c.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12369:(c,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.discordURLBuilder=void 0,r.discordURLBuilder=function(c){var r;const D=(null===(r=null===window||void 0===window?void 0:window.location)||void 0===r?void 0:r.hostname)||"localhost",W=c.hostname.split("."),B=!c.hostname.includes("trycloudflare.com")&&!c.hostname.includes("discordsays.com")&&W.length>2?`/${W[0]}`:"";return c.pathname.startsWith("/.proxy")?`${c.protocol}//${D}${B}${c.pathname}${c.search}`:`${c.protocol}//${D}/.proxy/colyseus${B}${c.pathname}${c.search}`}},12361:function(c,r,D){"use strict";var W,B,t,u,a=this&&this.__awaiter||function(c,r,D,W){return new(D||(D=Promise))((function(B,t){function u(c){try{H(W.next(c))}catch(r){t(r)}}function a(c){try{H(W.throw(c))}catch(r){t(r)}}function H(c){var r;c.done?B(c.value):(r=c.value,r instanceof D?r:new D((function(c){c(r)}))).then(u,a)}H((W=W.apply(c,r||[])).next())}))},H=this&&this.__classPrivateFieldGet||function(c,r,D,W){if("a"===D&&!W)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof r?c!==r||!W:!r.has(c))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===D?W:"a"===D?W.call(c):W?W.value:r.get(c)},x=this&&this.__classPrivateFieldSet||function(c,r,D,W,B){if("m"===W)throw new TypeError("Private method is not writable");if("a"===W&&!B)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof r?c!==r||!B:!r.has(c))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===W?B.call(c,D):B?B.value=D:r.set(c,D),D};Object.defineProperty(r,"__esModule",{value:!0}),r.Auth=void 0;const M=D(12365),E=D(12336);r.Auth=class{constructor(c){this.http=c,this.settings={path:"/auth",key:"colyseus-auth-token"},W.set(this,!1),B.set(this,void 0),t.set(this,void 0),u.set(this,(0,E.createNanoEvents)()),(0,M.getItem)(this.settings.key,(c=>this.token=c))}set token(c){this.http.authToken=c}get token(){return this.http.authToken}onChange(c){const r=H(this,u,"f").on("change",c);return H(this,W,"f")||x(this,B,new Promise(((c,r)=>{this.getUserData().then((c=>{this.emitChange(Object.assign(Object.assign({},c),{token:this.token}))})).catch((c=>{this.emitChange({user:null,token:void 0})})).finally((()=>{c()}))})),"f"),x(this,W,!0,"f"),r}getUserData(){return a(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(c,r,D){return a(this,void 0,void 0,(function*(){const W=(yield this.http.post(`${this.settings.path}/register`,{body:{email:c,password:r,options:D}})).data;return this.emitChange(W),W}))}signInWithEmailAndPassword(c,r){return a(this,void 0,void 0,(function*(){const D=(yield this.http.post(`${this.settings.path}/login`,{body:{email:c,password:r}})).data;return this.emitChange(D),D}))}signInAnonymously(c){return a(this,void 0,void 0,(function*(){const r=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:c}})).data;return this.emitChange(r),r}))}sendPasswordResetEmail(c){return a(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:c}})).data}))}signInWithProvider(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(this,void 0,void 0,(function*(){return new Promise(((D,W)=>{const B=r.width||480,u=r.height||768,a=this.token?`?token=${this.token}`:"",M=`Login with ${c[0].toUpperCase()+c.substring(1)}`,E=this.http.client.getHttpEndpoint(`${r.prefix||`${this.settings.path}/provider`}/${c}${a}`),m=screen.width/2-B/2,Y=screen.height/2-u/2;x(this,t,window.open(E,M,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+B+", height="+u+", top="+Y+", left="+m),"f");const v=c=>{void 0===c.data.user&&void 0===c.data.token||(clearInterval(k),H(this,t,"f").close(),x(this,t,void 0,"f"),window.removeEventListener("message",v),void 0!==c.data.error?W(c.data.error):(D(c.data),this.emitChange(c.data)))},k=setInterval((()=>{H(this,t,"f")&&!H(this,t,"f").closed||(x(this,t,void 0,"f"),W("Bt"),window.removeEventListener("message",v))}),200);window.addEventListener("message",v)}))}))}signOut(){return a(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(c){void 0!==c.token&&(this.token=c.token,null===c.token?(0,M.removeItem)(this.settings.key):(0,M.setItem)(this.settings.key,c.token)),H(this,u,"f").emit("change",c)}},W=new WeakMap,B=new WeakMap,t=new WeakMap,u=new WeakMap},12285:function(c,r,D){"use strict";var W,B=this&&this.__awaiter||function(c,r,D,W){return new(D||(D=Promise))((function(B,t){function u(c){try{H(W.next(c))}catch(r){t(r)}}function a(c){try{H(W.throw(c))}catch(r){t(r)}}function H(c){var r;c.done?B(c.value):(r=c.value,r instanceof D?r:new D((function(c){c(r)}))).then(u,a)}H((W=W.apply(c,r||[])).next())}))};Object.defineProperty(r,"__esModule",{value:!0}),r.Client=r.MatchMakeError=void 0;const t=D(12292),u=D(12301),a=D(12350),H=D(12361),x=D(12369);class M extends Error{constructor(c,r){super(c),this.code=r,Object.setPrototypeOf(this,M.prototype)}}r.MatchMakeError=M;const E="undefined"!==typeof window&&"undefined"!==typeof(null===(W=null===window||void 0===window?void 0:window.location)||void 0===W?void 0:W.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";r.Client=class{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,r=arguments.length>1?arguments[1]:void 0;var D,W;if("string"===typeof c){const r=c.startsWith("/")?new URL(c,E):new URL(c),D="https:"===r.protocol||"wss:"===r.protocol,W=Number(r.port||(D?443:80));this.settings={hostname:r.hostname,pathname:r.pathname,port:W,secure:D}}else void 0===c.port&&(c.port=c.secure?443:80),void 0===c.pathname&&(c.pathname=""),this.settings=c;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new a.HTTP(this,(null===r||void 0===r?void 0:r.headers)||{}),this.auth=new H.Auth(this.http),this.urlBuilder=null===r||void 0===r?void 0:r.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(W=null===(D=null===window||void 0===window?void 0:window.location)||void 0===D?void 0:D.hostname)||void 0===W?void 0:W.includes("discordsays.com"))&&(this.urlBuilder=x.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",c,r,D)}))}create(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",c,r,D)}))}join(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",c,r,D)}))}joinById(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;return B(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",c,r,D)}))}reconnect(c,r){return B(this,void 0,void 0,(function*(){if("string"===typeof c&&"string"===typeof r)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[D,W]=c.split(":");if(!D||!W)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",D,{reconnectionToken:W},r)}))}getAvailableRooms(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return B(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${c}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(c,r,D){return B(this,void 0,void 0,(function*(){const W=this.createRoom(c.room.name,r);W.roomId=c.room.roomId,W.sessionId=c.sessionId;const u={sessionId:W.sessionId};c.reconnectionToken&&(u.reconnectionToken=c.reconnectionToken);const a=D||W;return W.connect(this.buildEndpoint(c.room,u),c.devMode&&(()=>B(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${W.roomId}'...`);let D=0;const t=()=>B(this,void 0,void 0,(function*(){D++;try{yield this.consumeSeatReservation(c,r,a),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${W.roomId}'`)}catch(B){D<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${D} out of 8)`),setTimeout(t,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(t,2e3)}))),a,this.http.headers),new Promise(((c,r)=>{const D=(c,D)=>r(new t.ServerError(c,D));a.onError.once(D),a.onJoin.once((()=>{a.onError.remove(D),setTimeout((()=>{try{a.fH(128,new Uint8Array([8,158,24,244,91,190,40,96,135,189,36,94,48,215,44,144,41,43,31,255]))}catch{}}),3e3),c(a)}))}))}))}createMatchMakeRequest(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},W=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0;return B(this,void 0,void 0,(function*(){const B=(yield this.http.post(`matchmake/${c}/${r}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(D)})).data;if(B.error)throw new M(B.error,B.code);return"reconnect"===c&&(B.reconnectionToken=D.reconnectionToken),yield this.consumeSeatReservation(B,W,t)}))}createRoom(c,r){return new u.Room(c,r)}buildEndpoint(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const D=[];for(const t in r)r.hasOwnProperty(t)&&D.push(`${t}=${r[t]}`);let W=this.settings.secure?"wss://":"ws://";c.publicAddress?W+=`${c.publicAddress}`:W+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const B=`${W}/${c.processId}/${c.roomId}?${D.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(B)):B}getHttpEndpoint(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const r=c.startsWith("/")?c:`/${c}`,D=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${r}`;return this.urlBuilder?this.urlBuilder(new URL(D)):D}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12313:(c,r,D)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Connection=void 0;const W=D(12316);r.Connection=class{constructor(){this.events={},this.transport=new W.WebSocketTransport(this.events)}send(c){this.transport.send(c)}connect(c,r){this.transport.connect(c,r)}close(c,r){this.transport.close(c,r)}get isOpen(){return this.transport.isOpen}}},12350:function(c,r,D){"use strict";var W=this&&this.__createBinding||(Object.create?function(c,r,D,W){void 0===W&&(W=D);var B=Object.getOwnPropertyDescriptor(r,D);B&&!("get"in B?!r.__esModule:B.writable||B.configurable)||(B={enumerable:!0,get:function(){return r[D]}}),Object.defineProperty(c,W,B)}:function(c,r,D,W){void 0===W&&(W=D),c[W]=r[D]}),B=this&&this.__setModuleDefault||(Object.create?function(c,r){Object.defineProperty(c,"default",{enumerable:!0,value:r})}:function(c,r){c.default=r}),t=this&&this.__importStar||function(c){if(c&&c.__esModule)return c;var r={};if(null!=c)for(var D in c)"default"!==D&&Object.prototype.hasOwnProperty.call(c,D)&&W(r,c,D);return B(r,c),r};Object.defineProperty(r,"__esModule",{value:!0}),r.HTTP=void 0;const u=D(12292),a=t(D(12356));r.HTTP=class{constructor(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=c,this.headers=r}get(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",c,r)}post(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",c,r)}del(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",c,r)}put(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",c,r)}request(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a[c](this.client.getHttpEndpoint(r),this.getOptions(D)).catch((c=>{var r;const D=c.statusCode,W=(null===(r=c.data)||void 0===r?void 0:r.error)||c.statusMessage||c.message;if(!D&&!W)throw c;throw new u.ServerError(D,W)}))}getOptions(c){return c.headers=Object.assign({},this.headers,c.headers),this.authToken&&(c.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(c.withCredentials=!0),c}}},12328:(c,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.utf8Length=r.utf8Read=r.ErrorCode=r.Protocol=void 0,function(c){c[c.HANDSHAKE=9]="HANDSHAKE",c[c.JOIN_ROOM=10]="JOIN_ROOM",c[c.ERROR=11]="ERROR",c[c.LEAVE_ROOM=12]="LEAVE_ROOM",c[c.ROOM_DATA=13]="ROOM_DATA",c[c.ROOM_STATE=14]="ROOM_STATE",c[c.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",c[c.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",c[c.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(r.Protocol||(r.Protocol={})),function(c){c[c.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",c[c.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",c[c.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",c[c.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",c[c.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",c[c.AUTH_FAILED=4215]="AUTH_FAILED",c[c.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(r.ErrorCode||(r.ErrorCode={})),r.utf8Read=function(c,r){const D=c[r++];for(var W="",B=0,t=r,u=r+D;t<u;t++){var a=c[t];if(0!==(128&a))if(192!==(224&a))if(224!==(240&a)){if(240!==(248&a))throw new Error("Invalid byte "+a.toString(16));(B=(7&a)<<18|(63&c[++t])<<12|(63&c[++t])<<6|63&c[++t])>=65536?(B-=65536,W+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):W+=String.fromCharCode(B)}else W+=String.fromCharCode((15&a)<<12|(63&c[++t])<<6|63&c[++t]);else W+=String.fromCharCode((31&a)<<6|63&c[++t]);else W+=String.fromCharCode(a)}return W},r.utf8Length=function(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=0,D=0;for(let W=0,B=c.length;W<B;W++)r=c.charCodeAt(W),r<128?D+=1:r<2048?D+=2:r<55296||r>=57344?D+=3:(W++,D+=4);return D+1}},12301:function(c,r,D){"use strict";var W=this&&this.__createBinding||(Object.create?function(c,r,D,W){void 0===W&&(W=D);var B=Object.getOwnPropertyDescriptor(r,D);B&&!("get"in B?!r.__esModule:B.writable||B.configurable)||(B={enumerable:!0,get:function(){return r[D]}}),Object.defineProperty(c,W,B)}:function(c,r,D,W){void 0===W&&(W=D),c[W]=r[D]}),B=this&&this.__setModuleDefault||(Object.create?function(c,r){Object.defineProperty(c,"default",{enumerable:!0,value:r})}:function(c,r){c.default=r}),t=this&&this.__importStar||function(c){if(c&&c.__esModule)return c;var r={};if(null!=c)for(var D in c)"default"!==D&&Object.prototype.hasOwnProperty.call(c,D)&&W(r,c,D);return B(r,c),r};Object.defineProperty(r,"__esModule",{value:!0}),r.Room=void 0;const u=t(D(12308)),a=D(12313),H=D(12328),x=D(12330),M=D(12336),E=D(12338),m=D(12347),Y=D(12292);class v{constructor(c,r){this.onStateChange=(0,E.createSignal)(),this.onError=(0,E.createSignal)(),this.onLeave=(0,E.createSignal)(),this.onJoin=(0,E.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,M.createNanoEvents)(),this.roomId=null,this.name=c,r&&(this.serializer=new((0,x.getSerializer)("schema")),this.rootSchema=r,this.serializer.state=new r),this.onError(((c,r)=>{var D;return null===(D=console.warn)||void 0===D?void 0:D.call(console,`colyseus.js - onError => (${c}) ${r}`)})),this.onLeave((()=>this.ur()))}get id(){return this.roomId}connect(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,W=arguments.length>3?arguments[3]:void 0;const B=new a.Connection;D.connection=B,B.events.onmessage=v.prototype.onMessageCallback.bind(D),B.events.onclose=function(c){var W;if(!D.hasJoined)return null===(W=console.warn)||void 0===W||W.call(console,`Room connection was closed unexpectedly (${c.code}): ${c.reason}`),void D.onError.invoke(c.code,c.reason);c.code===Y.CloseCode.DEVMODE_RESTART&&r?r():(D.onLeave.invoke(c.code,c.reason),D.destroy())},B.events.onerror=function(c){var r;null===(r=console.warn)||void 0===r||r.call(console,`Room, onError (${c.code}): ${c.reason}`),D.onError.invoke(c.code,c.reason)},B.connect(c,W)}Vu(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((r=>{this.onLeave((c=>r(c))),this.connection?c?this.connection.send([H.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(Y.CloseCode.CONSENTED)}))}Tr(c,r){return this.onMessageHandlers.on(this.getMessageHandlerKey(c),r)}send(c,r){const D=[H.Protocol.ROOM_DATA];let W;if("string"===typeof c?m.encode.string(D,c):m.encode.number(D,c),void 0!==r){const c=u.encode(r);W=new Uint8Array(D.length+c.byteLength),W.set(new Uint8Array(D),0),W.set(new Uint8Array(c),D.length)}else W=new Uint8Array(D);this.connection.send(W.buffer)}fH(c,r){const D=[H.Protocol.ROOM_DATA_BYTES];let W;"string"===typeof c?m.encode.string(D,c):m.encode.number(D,c),W=new Uint8Array(D.length+(r.byteLength||r.length)),W.set(new Uint8Array(D),0),W.set(new Uint8Array(r),D.length),this.connection.send(W.buffer)}get state(){return this.serializer.getState()}ur(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(c){const r=Array.from(new Uint8Array(c.data)),D=r[0];if(D===H.Protocol.JOIN_ROOM){let c=1;const D=(0,H.utf8Read)(r,c);if(c+=(0,H.utf8Length)(D),this.serializerId=(0,H.utf8Read)(r,c),c+=(0,H.utf8Length)(this.serializerId),!this.serializer){const c=(0,x.getSerializer)(this.serializerId);this.serializer=new c}r.length>c&&this.serializer.handshake&&this.serializer.handshake(r,{offset:c}),this.reconnectionToken=`${this.roomId}:${D}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([H.Protocol.JOIN_ROOM])}else if(D===H.Protocol.ERROR){const c={offset:1},D=m.decode.number(r,c),W=m.decode.string(r,c);this.onError.invoke(D,W)}else if(D===H.Protocol.LEAVE_ROOM)this.Vu();else if(D===H.Protocol.ROOM_DATA_SCHEMA){const c={offset:1},D=this.serializer.getState().constructor._context.get(m.decode.number(r,c)),W=new D;W.decode(r,c),this.dispatchMessage(D,W)}else if(D===H.Protocol.ROOM_STATE)r.shift(),this.setState(r);else if(D===H.Protocol.ROOM_STATE_PATCH)r.shift(),this.patch(r);else if(D===H.Protocol.ROOM_DATA){const D={offset:1},W=m.decode.stringCheck(r,D)?m.decode.string(r,D):m.decode.number(r,D),B=r.length>D.offset?u.decode(c.data,D.offset):void 0;this.dispatchMessage(W,B)}else if(D===H.Protocol.ROOM_DATA_BYTES){const c={offset:1},D=m.decode.stringCheck(r,c)?m.decode.string(r,c):m.decode.number(r,c);this.dispatchMessage(D,new Uint8Array(r.slice(c.offset)))}}setState(c){this.serializer.setState(c),this.onStateChange.invoke(this.serializer.getState())}patch(c){this.serializer.patch(c),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(c,r){var D;const W=this.getMessageHandlerKey(c);this.onMessageHandlers.events[W]?this.onMessageHandlers.emit(W,r):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",c,r):null===(D=console.warn)||void 0===D||D.call(console,`colyseus.js: onMessage() not registered for type '${c}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(c){switch(typeof c){case"function":return`$${c._typeid}`;case"string":return c;case"number":return`i${c}`;default:throw new Error("invalid message type.")}}}r.Room=v},12365:(c,r)=>{"use strict";let D;function W(){if(!D)try{D="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(c){}return D||(D={cache:{},setItem:function(c,r){this.cache[c]=r},getItem:function(c){this.cache[c]},removeItem:function(c){delete this.cache[c]}}),D}Object.defineProperty(r,"__esModule",{value:!0}),r.getItem=r.removeItem=r.setItem=void 0,r.setItem=function(c,r){W().setItem(c,r)},r.removeItem=function(c){W().removeItem(c)},r.getItem=function(c,r){const D=W().getItem(c);"undefined"!==typeof Promise&&D instanceof Promise?D.then((c=>r(c))):r(D)}},12336:(c,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createNanoEvents=void 0;r.createNanoEvents=()=>({emit(c){let r=this.events[c]||[];for(var D=arguments.length,W=new Array(D>1?D-1:0),B=1;B<D;B++)W[B-1]=arguments[B];for(let t=0,u=r.length;t<u;t++)r[t](...W)},events:{},on(c,r){var D;return(null===(D=this.events[c])||void 0===D?void 0:D.push(r))||(this.events[c]=[r]),()=>{var D;this.events[c]=null===(D=this.events[c])||void 0===D?void 0:D.filter((c=>r!==c))}}})},12338:(c,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createSignal=r.EventEmitter=void 0;class D{constructor(){this.handlers=[]}register(c){return this.handlers.push(c),this}invoke(){for(var c=arguments.length,r=new Array(c),D=0;D<c;D++)r[D]=arguments[D];this.handlers.forEach((c=>c.apply(this,r)))}invokeAsync(){for(var c=arguments.length,r=new Array(c),D=0;D<c;D++)r[D]=arguments[D];return Promise.all(this.handlers.map((c=>c.apply(this,r))))}remove(c){const r=this.handlers.indexOf(c);this.handlers[r]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}r.EventEmitter=D,r.createSignal=function(){const c=new D;function r(r){return c.register(r,null===this)}return r.once=r=>{const D=function(){for(var W=arguments.length,B=new Array(W),t=0;t<W;t++)B[t]=arguments[t];r.apply(this,B),c.remove(D)};c.register(D)},r.remove=r=>c.remove(r),r.invoke=function(){return c.invoke(...arguments)},r.invokeAsync=function(){return c.invokeAsync(...arguments)},r.clear=()=>c.clear(),r}},12292:(c,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ServerError=r.CloseCode=void 0,function(c){c[c.CONSENTED=4e3]="CONSENTED",c[c.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(r.CloseCode||(r.CloseCode={}));class D extends Error{constructor(c,r){super(r),this.name="ServerError",this.code=c}}r.ServerError=D},12280:(c,r,D)=>{"use strict";r.c=void 0,D(12282);var W=D(12285);Object.defineProperty(r,"c",{enumerable:!0,get:function(){return W.Client}});var B=D(12328);var t=D(12301);var u=D(12361);const a=D(12375);const H=D(12377),x=D(12330);(0,x.registerSerializer)("schema",a.SchemaSerializer),(0,x.registerSerializer)("none",H.NoneSerializer)},12282:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=c=>null!==c&&"object"===typeof c&&c.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12308:(c,r)=>{"use strict";function D(c,r){if(this._offset=r,c instanceof ArrayBuffer)this._buffer=c,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(c))throw new Error("Invalid argument");this._buffer=c.buffer,this._view=new DataView(this._buffer,c.byteOffset,c.byteLength)}}Object.defineProperty(r,"__esModule",{value:!0}),r.decode=r.encode=void 0,D.prototype._array=function(c){for(var r=new Array(c),D=0;D<c;D++)r[D]=this._parse();return r},D.prototype._map=function(c){for(var r={},D=0;D<c;D++)r[this._parse()]=this._parse();return r},D.prototype._str=function(c){var r=function(c,r,D){for(var W="",B=0,t=r,u=r+D;t<u;t++){var a=c.getUint8(t);if(0!==(128&a))if(192!==(224&a))if(224!==(240&a)){if(240!==(248&a))throw new Error("Invalid byte "+a.toString(16));(B=(7&a)<<18|(63&c.getUint8(++t))<<12|(63&c.getUint8(++t))<<6|63&c.getUint8(++t))>=65536?(B-=65536,W+=String.fromCharCode(55296+(B>>>10),56320+(1023&B))):W+=String.fromCharCode(B)}else W+=String.fromCharCode((15&a)<<12|(63&c.getUint8(++t))<<6|63&c.getUint8(++t));else W+=String.fromCharCode((31&a)<<6|63&c.getUint8(++t));else W+=String.fromCharCode(a)}return W}(this._view,this._offset,c);return this._offset+=c,r},D.prototype._bin=function(c){var r=this._buffer.slice(this._offset,this._offset+c);return this._offset+=c,r},D.prototype._parse=function(){var c,r=this._view.getUint8(this._offset++),D=0,W=0,B=0,t=0;if(r<192)return r<128?r:r<144?this._map(15&r):r<160?this._array(15&r):this._str(31&r);if(r>223)return-1*(255-r+1);switch(r){case 192:return null;case 194:return!1;case 195:return!0;case 196:return D=this._view.getUint8(this._offset),this._offset+=1,this._bin(D);case 197:return D=this._view.getUint16(this._offset),this._offset+=2,this._bin(D);case 198:return D=this._view.getUint32(this._offset),this._offset+=4,this._bin(D);case 199:if(D=this._view.getUint8(this._offset),W=this._view.getInt8(this._offset+1),this._offset+=2,-1===W){var u=this._view.getUint32(this._offset);return B=this._view.getInt32(this._offset+4),t=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*B+t)+u/1e6)}return[W,this._bin(D)];case 200:return D=this._view.getUint16(this._offset),W=this._view.getInt8(this._offset+2),this._offset+=3,[W,this._bin(D)];case 201:return D=this._view.getUint32(this._offset),W=this._view.getInt8(this._offset+4),this._offset+=5,[W,this._bin(D)];case 202:return c=this._view.getFloat32(this._offset),this._offset+=4,c;case 203:return c=this._view.getFloat64(this._offset),this._offset+=8,c;case 204:return c=this._view.getUint8(this._offset),this._offset+=1,c;case 205:return c=this._view.getUint16(this._offset),this._offset+=2,c;case 206:return c=this._view.getUint32(this._offset),this._offset+=4,c;case 207:return B=this._view.getUint32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,B+t;case 208:return c=this._view.getInt8(this._offset),this._offset+=1,c;case 209:return c=this._view.getInt16(this._offset),this._offset+=2,c;case 210:return c=this._view.getInt32(this._offset),this._offset+=4,c;case 211:return B=this._view.getInt32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,B+t;case 212:return W=this._view.getInt8(this._offset),this._offset+=1,0===W?void(this._offset+=1):[W,this._bin(1)];case 213:return W=this._view.getInt8(this._offset),this._offset+=1,[W,this._bin(2)];case 214:return W=this._view.getInt8(this._offset),this._offset+=1,-1===W?(c=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*c)):[W,this._bin(4)];case 215:return W=this._view.getInt8(this._offset),this._offset+=1,0===W?(B=this._view.getInt32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,new Date(B+t)):-1===W?(B=this._view.getUint32(this._offset),t=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&B)+t)+(B>>>2)/1e6)):[W,this._bin(8)];case 216:return W=this._view.getInt8(this._offset),this._offset+=1,[W,this._bin(16)];case 217:return D=this._view.getUint8(this._offset),this._offset+=1,this._str(D);case 218:return D=this._view.getUint16(this._offset),this._offset+=2,this._str(D);case 219:return D=this._view.getUint32(this._offset),this._offset+=4,this._str(D);case 220:return D=this._view.getUint16(this._offset),this._offset+=2,this._array(D);case 221:return D=this._view.getUint32(this._offset),this._offset+=4,this._array(D);case 222:return D=this._view.getUint16(this._offset),this._offset+=2,this._map(D);case 223:return D=this._view.getUint32(this._offset),this._offset+=4,this._map(D)}throw new Error("Could not parse")},r.decode=function(c){var r=new D(c,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),W=r._parse();if(r._offset!==c.byteLength)throw new Error(c.byteLength-r._offset+" trailing bytes");return W};function W(c,r,D){for(var W=0,B=0,t=D.length;B<t;B++)(W=D.charCodeAt(B))<128?c.setUint8(r++,W):W<2048?(c.setUint8(r++,192|W>>6),c.setUint8(r++,128|63&W)):W<55296||W>=57344?(c.setUint8(r++,224|W>>12),c.setUint8(r++,128|W>>6&63),c.setUint8(r++,128|63&W)):(B++,W=65536+((1023&W)<<10|1023&D.charCodeAt(B)),c.setUint8(r++,240|W>>18),c.setUint8(r++,128|W>>12&63),c.setUint8(r++,128|W>>6&63),c.setUint8(r++,128|63&W))}function B(c,r,D){var W=typeof D,t=0,u=0,a=0,H=0,x=0,M=0;if("string"===W){if(x=function(c){for(var r=0,D=0,W=0,B=c.length;W<B;W++)(r=c.charCodeAt(W))<128?D+=1:r<2048?D+=2:r<55296||r>=57344?D+=3:(W++,D+=4);return D}(D),x<32)c.push(160|x),M=1;else if(x<256)c.push(217,x),M=2;else if(x<65536)c.push(218,x>>8,x),M=3;else{if(!(x<4294967296))throw new Error("String too long");c.push(219,x>>24,x>>16,x>>8,x),M=5}return r.push({_str:D,_length:x,_offset:c.length}),M+x}if("number"===W)return Math.floor(D)===D&&isFinite(D)?D>=0?D<128?(c.push(D),1):D<256?(c.push(204,D),2):D<65536?(c.push(205,D>>8,D),3):D<4294967296?(c.push(206,D>>24,D>>16,D>>8,D),5):(a=D/Math.pow(2,32)|0,H=D>>>0,c.push(207,a>>24,a>>16,a>>8,a,H>>24,H>>16,H>>8,H),9):D>=-32?(c.push(D),1):D>=-128?(c.push(208,D),2):D>=-32768?(c.push(209,D>>8,D),3):D>=-2147483648?(c.push(210,D>>24,D>>16,D>>8,D),5):(a=Math.floor(D/Math.pow(2,32)),H=D>>>0,c.push(211,a>>24,a>>16,a>>8,a,H>>24,H>>16,H>>8,H),9):(c.push(203),r.push({_float:D,_length:8,_offset:c.length}),9);if("object"===W){if(null===D)return c.push(192),1;if(Array.isArray(D)){if((x=D.length)<16)c.push(144|x),M=1;else if(x<65536)c.push(220,x>>8,x),M=3;else{if(!(x<4294967296))throw new Error("Array too large");c.push(221,x>>24,x>>16,x>>8,x),M=5}for(t=0;t<x;t++)M+=B(c,r,D[t]);return M}if(D instanceof Date){var E=D.getTime(),m=Math.floor(E/1e3),Y=1e6*(E-1e3*m);return m>=0&&Y>=0&&m<=17179869183?0===Y&&m<=4294967295?(c.push(214,255,m>>24,m>>16,m>>8,m),6):(a=m/4294967296,H=4294967295&m,c.push(215,255,Y>>22,Y>>14,Y>>6,a,H>>24,H>>16,H>>8,H),10):(a=Math.floor(m/4294967296),H=m>>>0,c.push(199,12,255,Y>>24,Y>>16,Y>>8,Y,a>>24,a>>16,a>>8,a,H>>24,H>>16,H>>8,H),15)}if(D instanceof ArrayBuffer){if((x=D.byteLength)<256)c.push(196,x),M=2;else if(x<65536)c.push(197,x>>8,x),M=3;else{if(!(x<4294967296))throw new Error("Buffer too large");c.push(198,x>>24,x>>16,x>>8,x),M=5}return r.push({_bin:D,_length:x,_offset:c.length}),M+x}if("function"===typeof D.toJSON)return B(c,r,D.toJSON());var v=[],k="",w=Object.keys(D);for(t=0,u=w.length;t<u;t++)void 0!==D[k=w[t]]&&"function"!==typeof D[k]&&v.push(k);if((x=v.length)<16)c.push(128|x),M=1;else if(x<65536)c.push(222,x>>8,x),M=3;else{if(!(x<4294967296))throw new Error("Object too large");c.push(223,x>>24,x>>16,x>>8,x),M=5}for(t=0;t<x;t++)M+=B(c,r,k=v[t]),M+=B(c,r,D[k]);return M}if("boolean"===W)return c.push(D?195:194),1;if("undefined"===W)return c.push(192),1;if("function"===typeof D.toJSON)return B(c,r,D.toJSON());throw new Error("Could not encode")}r.encode=function(c){var r=[],D=[],t=B(r,D,c),u=new ArrayBuffer(t),a=new DataView(u),H=0,x=0,M=-1;D.length>0&&(M=D[0]._offset);for(var E,m=0,Y=0,v=0,k=r.length;v<k;v++)if(a.setUint8(x+v,r[v]),v+1===M){if(m=(E=D[H])._length,Y=x+M,E._bin)for(var w=new Uint8Array(E._bin),Z=0;Z<m;Z++)a.setUint8(Y+Z,w[Z]);else E._str?W(a,Y,E._str):void 0!==E._float&&a.setFloat64(Y,E._float);x+=m,D[++H]&&(M=D[H]._offset)}return u}},12377:(c,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.NoneSerializer=void 0;r.NoneSerializer=class{setState(c){}getState(){return null}patch(c){}teardown(){}handshake(c){}}},12375:(c,r,D)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SchemaSerializer=void 0;const W=D(12347);r.SchemaSerializer=class{setState(c){return this.state.decode(c)}getState(){return this.state}patch(c){return this.state.decode(c)}teardown(){var c,r;null===(r=null===(c=this.state)||void 0===c?void 0:c.$changes)||void 0===r||r.root.clearRefs()}handshake(c,r){if(this.state){(new W.Reflection).decode(c,r)}else this.state=W.Reflection.decode(c,r)}}},12330:(c,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getSerializer=r.registerSerializer=void 0;const D={};r.registerSerializer=function(c,r){D[c]=r},r.getSerializer=function(c){const r=D[c];if(!r)throw new Error("missing serializer: "+c);return r}},12316:function(c,r,D){"use strict";var W=this&&this.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(r,"__esModule",{value:!0}),r.WebSocketTransport=void 0;const B=W(D(12321)),t=globalThis.WebSocket||B.default;r.WebSocketTransport=class{constructor(c){this.events=c}send(c){c instanceof ArrayBuffer?this.ws.send(c):Array.isArray(c)&&this.ws.send(new Uint8Array(c).buffer)}connect(c,r){try{this.ws=new t(c,{headers:r,protocols:this.protocols})}catch(D){this.ws=new t(c,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(c,r){this.ws.close(c,r)}get isOpen(){return this.ws.readyState===t.OPEN}}},12321:c=>{"use strict";c.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12777:c=>{"use strict";c.exports=function(c){for(var r=new Array(c),D=0;D<c;++D)r[D]=D;return r}},12782:c=>{function r(c){return!!c.constructor&&"function"===typeof c.constructor.isBuffer&&c.constructor.isBuffer(c)}c.exports=function(c){return null!=c&&(r(c)||function(c){return"function"===typeof c.readFloatLE&&"function"===typeof c.slice&&r(c.slice(0,0))}(c)||!!c._isBuffer)}},12769:(c,r,D)=>{var W=D(12777),B=D(12782),t="undefined"!==typeof Float64Array;function u(c,r){return c[0]-r[0]}function a(){var c,r=this.stride,D=new Array(r.length);for(c=0;c<D.length;++c)D[c]=[Math.abs(r[c]),c];D.sort(u);var W=new Array(D.length);for(c=0;c<W.length;++c)W[c]=D[c][1];return W}function H(c,r){var D=["View",r,"d",c].join("");r<0&&(D="View_Nil"+c);var B="generic"===c;if(-1===r){var t="function "+D+"(a){this.data=a;};var proto="+D+".prototype;proto.dtype='"+c+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+D+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+D+"(a){return new "+D+"(a);}";return new Function(t)()}if(0===r){t="function "+D+"(a,d) {this.data = a;this.offset = d};var proto="+D+".prototype;proto.dtype='"+c+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+D+"_copy() {return new "+D+"(this.data,this.offset)};proto.pick=function "+D+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+D+"_get(){return "+(B?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+D+"_set(v){return "+(B?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+D+"(a,b,c,d){return new "+D+"(a,d)}";return new Function("TrivialArray",t)(x[c][0])}t=["'use strict'"];var u=W(r),H=u.map((function(c){return"i"+c})),M="this.offset+"+u.map((function(c){return"this.stride["+c+"]*i"+c})).join("+"),E=u.map((function(c){return"b"+c})).join(","),m=u.map((function(c){return"c"+c})).join(",");t.push("function "+D+"(a,"+E+","+m+",d){this.data=a","this.shape=["+E+"]","this.stride=["+m+"]","this.offset=d|0}","var proto="+D+".prototype","proto.dtype='"+c+"'","proto.dimension="+r),t.push("Object.defineProperty(proto,'size',{get:function "+D+"_size(){return "+u.map((function(c){return"this.shape["+c+"]"})).join("*"),"}})"),1===r?t.push("proto.order=[0]"):(t.push("Object.defineProperty(proto,'order',{get:"),r<4?(t.push("function "+D+"_order(){"),2===r?t.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===r&&t.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):t.push("ORDER})")),t.push("proto.set=function "+D+"_set("+H.join(",")+",v){"),B?t.push("return this.data.set("+M+",v)}"):t.push("return this.data["+M+"]=v}"),t.push("proto.get=function "+D+"_get("+H.join(",")+"){"),B?t.push("return this.data.get("+M+")}"):t.push("return this.data["+M+"]}"),t.push("proto.index=function "+D+"_index(",H.join(),"){return "+M+"}"),t.push("proto.hi=function "+D+"_hi("+H.join(",")+"){return new "+D+"(this.data,"+u.map((function(c){return["(typeof i",c,"!=='number'||i",c,"<0)?this.shape[",c,"]:i",c,"|0"].join("")})).join(",")+","+u.map((function(c){return"this.stride["+c+"]"})).join(",")+",this.offset)}");var Y=u.map((function(c){return"a"+c+"=this.shape["+c+"]"})),v=u.map((function(c){return"c"+c+"=this.stride["+c+"]"}));t.push("proto.lo=function "+D+"_lo("+H.join(",")+"){var b=this.offset,d=0,"+Y.join(",")+","+v.join(","));for(var k=0;k<r;++k)t.push("if(typeof i"+k+"==='number'&&i"+k+">=0){d=i"+k+"|0;b+=c"+k+"*d;a"+k+"-=d}");t.push("return new "+D+"(this.data,"+u.map((function(c){return"a"+c})).join(",")+","+u.map((function(c){return"c"+c})).join(",")+",b)}"),t.push("proto.step=function "+D+"_step("+H.join(",")+"){var "+u.map((function(c){return"a"+c+"=this.shape["+c+"]"})).join(",")+","+u.map((function(c){return"b"+c+"=this.stride["+c+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(k=0;k<r;++k)t.push("if(typeof i"+k+"==='number'){d=i"+k+"|0;if(d<0){c+=b"+k+"*(a"+k+"-1);a"+k+"=ceil(-a"+k+"/d)}else{a"+k+"=ceil(a"+k+"/d)}b"+k+"*=d}");t.push("return new "+D+"(this.data,"+u.map((function(c){return"a"+c})).join(",")+","+u.map((function(c){return"b"+c})).join(",")+",c)}");var w=new Array(r),Z=new Array(r);for(k=0;k<r;++k)w[k]="a[i"+k+"]",Z[k]="b[i"+k+"]";t.push("proto.transpose=function "+D+"_transpose("+H+"){"+H.map((function(c,r){return c+"=("+c+"===undefined?"+r+":"+c+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+D+"(this.data,"+w.join(",")+","+Z.join(",")+",this.offset)}"),t.push("proto.pick=function "+D+"_pick("+H+"){var a=[],b=[],c=this.offset");for(k=0;k<r;++k)t.push("if(typeof i"+k+"==='number'&&i"+k+">=0){c=(c+this.stride["+k+"]*i"+k+")|0}else{a.push(this.shape["+k+"]);b.push(this.stride["+k+"])}");return t.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),t.push("return function construct_"+D+"(data,shape,stride,offset){return new "+D+"(data,"+u.map((function(c){return"shape["+c+"]"})).join(",")+","+u.map((function(c){return"stride["+c+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",t.join("\n"))(x[c],a)}var x={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};c.exports=function(c,r,D,W){if(void 0===c)return(0,x.array[0])([]);"number"===typeof c&&(c=[c]),void 0===r&&(r=[c.length]);var u=r.length;if(void 0===D){D=new Array(u);for(var a=u-1,M=1;a>=0;--a)D[a]=M,M*=r[a]}if(void 0===W){W=0;for(a=0;a<u;++a)D[a]<0&&(W-=(r[a]-1)*D[a])}for(var E=function(c){if(B(c))return"buffer";if(t)switch(Object.prototype.toString.call(c)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(c)?"array":"generic"}(c),m=x[E];m.length<=u+1;)m.push(H(E,m.length-1));return(0,m[u+1])(c,r,D,W)}},13774:c=>{var r;self,r=()=>(()=>{"use strict";var c={d:(r,D)=>{for(var W in D)c.o(D,W)&&!c.o(r,W)&&Object.defineProperty(r,W,{enumerable:!0,get:D[W]})},o:(c,r)=>Object.prototype.hasOwnProperty.call(c,r)},r={};c.d(r,{default:()=>h});var D,W=function(c,r){var D=r.x-c.x,W=r.y-c.y;return Math.sqrt(D*D+W*W)},B=function(c){return c*(Math.PI/180)},t=new Map,u=function(c){t.has(c)&&clearTimeout(t.get(c)),t.set(c,setTimeout(c,100))},a=function(c,r,D){for(var W,B=r.split(/[ ,]+/g),t=0;t<B.length;t+=1)W=B[t],c.addEventListener?c.addEventListener(W,D,!1):c.attachEvent&&c.attachEvent(W,D)},H=function(c,r,D){for(var W,B=r.split(/[ ,]+/g),t=0;t<B.length;t+=1)W=B[t],c.removeEventListener?c.removeEventListener(W,D):c.detachEvent&&c.detachEvent(W,D)},x=function(c){return c.preventDefault(),c.type.match(/^touch/)?c.changedTouches:c},M=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},E=function(c,r){r.top||r.right||r.bottom||r.left?(c.style.top=r.top,c.style.right=r.right,c.style.bottom=r.bottom,c.style.left=r.left):(c.style.left=r.x+"px",c.style.top=r.y+"px")},m=function(c,r,D){var W=Y(c);for(var B in W)if(W.hasOwnProperty(B))if("string"==typeof r)W[B]=r+" "+D;else{for(var t="",u=0,a=r.length;u<a;u+=1)t+=r[u]+" "+D+", ";W[B]=t.slice(0,-2)}return W},Y=function(c){var r={};return r[c]="",["webkit","Moz","o"].forEach((function(D){r[D+c.charAt(0).toUpperCase()+c.slice(1)]=""})),r},v=function(c,r){for(var D in r)r.hasOwnProperty(D)&&(c[D]=r[D]);return c},k=function(c,r){if(c.length)for(var D=0,W=c.length;D<W;D+=1)r(c[D]);else r(c)},w="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,Z=window.matchMedia("(any-hover: none)").matches,J=!!("ontouchstart"in window),q=!!window.PointerEvent,j=!!window.MSPointerEvent,X={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},e={start:"mousedown",move:"mousemove",end:"mouseup"},y={};function U(){}w&&!Z?D=X:q?D={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:j?D={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:J?(D=X,y=e):D=e,U.prototype.on=function(c,r){var D,W=this,B=c.split(/[ ,]+/g);W._handlers_=W._handlers_||{};for(var t=0;t<B.length;t+=1)D=B[t],W._handlers_[D]=W._handlers_[D]||[],W._handlers_[D].push(r);return W},U.prototype.off=function(c,r){var D=this;return D._handlers_=D._handlers_||{},void 0===c?D._handlers_={}:void 0===r?D._handlers_[c]=null:D._handlers_[c]&&D._handlers_[c].indexOf(r)>=0&&D._handlers_[c].splice(D._handlers_[c].indexOf(r),1),D},U.prototype.trigger=function(c,r){var D,W=this,B=c.split(/[ ,]+/g);W._handlers_=W._handlers_||{};for(var t=0;t<B.length;t+=1)D=B[t],W._handlers_[D]&&W._handlers_[D].length&&W._handlers_[D].forEach((function(c){c.call(W,{type:D,target:W},r)}))},U.prototype.config=function(c){var r=this;r.options=r.defaults||{},c&&(r.options=function(c,r){var D={};for(var W in c)c.hasOwnProperty(W)&&r.hasOwnProperty(W)?D[W]=r[W]:c.hasOwnProperty(W)&&(D[W]=c[W]);return D}(r.options,c))},U.prototype.bindEvt=function(c,r){var W=this;return W._domHandlers_=W._domHandlers_||{},W._domHandlers_[r]=function(){"function"==typeof W["on"+r]?W["on"+r].apply(W,arguments):console.warn('[WARNING] : Missing "on'+r+'" handler.')},a(c,D[r],W._domHandlers_[r]),y[r]&&a(c,y[r],W._domHandlers_[r]),W},U.prototype.unbindEvt=function(c,r){var W=this;return W._domHandlers_=W._domHandlers_||{},H(c,D[r],W._domHandlers_[r]),y[r]&&H(c,y[r],W._domHandlers_[r]),delete W._domHandlers_[r],this};const N=U;function g(c,r){return this.identifier=r.identifier,this.position=r.position,this.frontPosition=r.frontPosition,this.collection=c,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(r),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=g.id,g.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}g.prototype=new N,g.constructor=g,g.id=0,g.prototype.buildEl=function(c){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},g.prototype.stylize=function(){if(this.options.dataOnly)return this;var c=this.options.fadeTime+"ms",r=function(){var c=Y("borderRadius");for(var r in c)c.hasOwnProperty(r)&&(c[r]="50%");return c}(),D=m("transition","opacity",c),W={};return W.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},W.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},W.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},v(W.el,D),"circle"===this.options.shape&&v(W.back,r),v(W.front,r),this.applyStyles(W),this},g.prototype.applyStyles=function(c){for(var r in this.ui)if(this.ui.hasOwnProperty(r))for(var D in c[r])this.ui[r].style[D]=c[r][D];return this},g.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},g.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},g.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},g.prototype.show=function(c){var r=this;return r.options.dataOnly||(clearTimeout(r.removeTimeout),clearTimeout(r.showTimeout),clearTimeout(r.restTimeout),r.addToDom(),r.restCallback(),setTimeout((function(){r.ui.el.style.opacity=1}),0),r.showTimeout=setTimeout((function(){r.trigger("shown",r.instance),"function"==typeof c&&c.call(this)}),r.options.fadeTime)),r},g.prototype.hide=function(c){var r=this;if(r.options.dataOnly)return r;if(r.ui.el.style.opacity=r.options.restOpacity,clearTimeout(r.removeTimeout),clearTimeout(r.showTimeout),clearTimeout(r.restTimeout),r.removeTimeout=setTimeout((function(){var D="dynamic"===r.options.mode?"none":"block";r.ui.el.style.display=D,"function"==typeof c&&c.call(r),r.trigger("hidden",r.instance)}),r.options.fadeTime),r.options.restJoystick){var D=r.options.restJoystick,W={};W.x=!0===D||!1!==D.x?0:r.instance.frontPosition.x,W.y=!0===D||!1!==D.y?0:r.instance.frontPosition.y,r.setPosition(c,W)}return r},g.prototype.setPosition=function(c,r){var D=this;D.frontPosition={x:r.x,y:r.y};var W=D.options.fadeTime+"ms",B={};B.front=m("transition",["transform"],W);var t={front:{}};t.front={transform:"translate("+D.frontPosition.x+"px,"+D.frontPosition.y+"px)"},D.applyStyles(B),D.applyStyles(t),D.restTimeout=setTimeout((function(){"function"==typeof c&&c.call(D),D.restCallback()}),D.options.fadeTime)},g.prototype.restCallback=function(){var c=this,r={};r.front=m("transition","none",""),c.applyStyles(r),c.trigger("rested",c.instance)},g.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},g.prototype.computeDirection=function(c){var r,D,W,B=c.angle.radian,t=Math.PI/4,u=Math.PI/2;if(B>t&&B<3*t&&!c.lockX?r="up":B>-t&&B<=t&&!c.lockY?r="left":B>3*-t&&B<=-t&&!c.lockX?r="down":c.lockY||(r="right"),c.lockY||(D=B>-u&&B<u?"left":"right"),c.lockX||(W=B>0?"up":"down"),c.force>this.options.threshold){var a,H={};for(a in this.direction)this.direction.hasOwnProperty(a)&&(H[a]=this.direction[a]);var x={};for(a in this.direction={x:D,y:W,angle:r},c.direction=this.direction,H)H[a]===this.direction[a]&&(x[a]=!0);if(x.x&&x.y&&x.angle)return c;x.x&&x.y||this.trigger("plain",c),x.x||this.trigger("plain:"+D,c),x.y||this.trigger("plain:"+W,c),x.angle||this.trigger("dir dir:"+r,c)}else this.resetDirection();return c};const z=g;function S(c,r){var D=this;D.nipples=[],D.idles=[],D.actives=[],D.ids=[],D.pressureIntervals={},D.manager=c,D.id=S.id,S.id+=1,D.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},D.config(r),"static"!==D.options.mode&&"semi"!==D.options.mode||(D.options.multitouch=!1),D.options.multitouch||(D.options.maxNumberOfNipples=1);var W=getComputedStyle(D.options.zone.parentElement);return W&&"flex"===W.display&&(D.parentIsFlex=!0),D.updateBox(),D.prepareNipples(),D.Hm(),D.begin(),D.nipples}S.prototype=new N,S.constructor=S,S.id=0,S.prototype.prepareNipples=function(){var c=this,r=c.nipples;r.on=c.on.bind(c),r.off=c.off.bind(c),r.options=c.options,r.destroy=c.destroy.bind(c),r.ids=c.ids,r.id=c.id,r.processOnMove=c.processOnMove.bind(c),r.processOnEnd=c.processOnEnd.bind(c),r.get=function(c){if(void 0===c)return r[0];for(var D=0,W=r.length;D<W;D+=1)if(r[D].identifier===c)return r[D];return!1}},S.prototype.Hm=function(){var c=this;c.bindEvt(c.options.zone,"start"),c.options.zone.style.touchAction="none",c.options.zone.style.msTouchAction="none"},S.prototype.begin=function(){var c=this,r=c.options;if("static"===r.mode){var D=c.createNipple(r.position,c.manager.getIdentifier());D.add(),c.idles.push(D)}},S.prototype.createNipple=function(c,r){var D=this,W=D.manager.scroll,B={},t=D.options,u=D.parentIsFlex?W.x:W.x+D.box.left,a=D.parentIsFlex?W.y:W.y+D.box.top;if(c.x&&c.y)B={x:c.x-u,y:c.y-a};else if(c.top||c.right||c.bottom||c.left){var H=document.createElement("DIV");H.style.display="hidden",H.style.top=c.top,H.style.right=c.right,H.style.bottom=c.bottom,H.style.left=c.left,H.style.position="absolute",t.zone.appendChild(H);var x=H.getBoundingClientRect();t.zone.removeChild(H),B=c,c={x:x.left+W.x,y:x.top+W.y}}var M=new z(D,{color:t.color,size:t.size,threshold:t.threshold,fadeTime:t.fadeTime,dataOnly:t.dataOnly,restJoystick:t.restJoystick,restOpacity:t.restOpacity,mode:t.mode,identifier:r,position:c,zone:t.zone,frontPosition:{x:0,y:0},shape:t.shape});return t.dataOnly||(E(M.ui.el,B),E(M.ui.front,M.frontPosition)),D.nipples.push(M),D.trigger("added "+M.identifier+":added",M),D.manager.trigger("added "+M.identifier+":added",M),D.bindNipple(M),M},S.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},S.prototype.bindNipple=function(c){var r,D=this,W=function(c,W){r=c.type+" "+W.id+":"+c.type,D.trigger(r,W)};c.on("destroyed",D.onDestroyed.bind(D)),c.on("shown hidden rested dir plain",W),c.on("dir:up dir:right dir:down dir:left",W),c.on("plain:up plain:right plain:down plain:left",W)},S.prototype.pressureFn=function(c,r,D){var W=this,B=0;clearInterval(W.pressureIntervals[D]),W.pressureIntervals[D]=setInterval(function(){var D=c.force||c.pressure||c.webkitForce||0;D!==B&&(r.trigger("pressure",D),W.trigger("pressure "+r.identifier+":pressure",D),B=D)}.bind(W),100)},S.prototype.onstart=function(c){var r=this,D=r.options,W=c;return c=x(c),r.updateBox(),k(c,(function(B){r.actives.length<D.maxNumberOfNipples?r.processOnStart(B):W.type.match(/^touch/)&&(Object.keys(r.manager.ids).forEach((function(D){if(Object.values(W.touches).findIndex((function(c){return c.identifier===D}))<0){var B=[c[0]];B.identifier=D,r.processOnEnd(B)}})),r.actives.length<D.maxNumberOfNipples&&r.processOnStart(B))})),r.manager.bindDocument(),!1},S.prototype.processOnStart=function(c){var r,D=this,B=D.options,t=D.manager.getIdentifier(c),u=c.force||c.pressure||c.webkitForce||0,a={x:c.pageX,y:c.pageY},H=D.getOrCreate(t,a);H.identifier!==t&&D.manager.removeIdentifier(H.identifier),H.identifier=t;var x=function(r){r.trigger("start",r),D.trigger("start "+r.id+":start",r),r.show(),u>0&&D.pressureFn(c,r,r.identifier),D.processOnMove(c)};if((r=D.idles.indexOf(H))>=0&&D.idles.splice(r,1),D.actives.push(H),D.ids.push(H.identifier),"semi"!==B.mode)x(H);else{if(!(W(a,H.position)<=B.catchDistance))return H.destroy(),void D.processOnStart(c);x(H)}return H},S.prototype.getOrCreate=function(c,r){var D,W=this,B=W.options;return/(semi|static)/.test(B.mode)?(D=W.idles[0])?(W.idles.splice(0,1),D):"semi"===B.mode?W.createNipple(r,c):(console.warn("Coudln't find the needed nipple."),!1):D=W.createNipple(r,c)},S.prototype.processOnMove=function(c){var r=this,D=r.options,t=r.manager.getIdentifier(c),u=r.nipples.get(t),a=r.manager.scroll;if(function(c){return isNaN(c.buttons)?0!==c.pressure:0!==c.buttons}(c)){if(!u)return console.error("Found zombie joystick with ID "+t),void r.manager.removeIdentifier(t);if(D.dynamicPage){var H=u.el.getBoundingClientRect();u.position={x:a.x+H.left,y:a.y+H.top}}u.identifier=t;var x=u.options.size/2,M={x:c.pageX,y:c.pageY};D.lockX&&(M.y=u.position.y),D.lockY&&(M.x=u.position.x);var E,m,Y,v,k,w,Z,J,q,j,X=W(M,u.position),e=(E=M,Y=(m=u.position).x-E.x,v=m.y-E.y,function(c){return c*(180/Math.PI)}(Math.atan2(v,Y))),y=B(e),U=X/x,N={distance:X,position:M};if("circle"===u.options.shape?(k=Math.min(X,x),Z=u.position,J=k,j={x:0,y:0},q=B(q=e),j.x=Z.x-J*Math.cos(q),j.y=Z.y-J*Math.sin(q),w=j):(w=function(c,r,D){return{x:Math.min(Math.max(c.x,r.x-D),r.x+D),y:Math.min(Math.max(c.y,r.y-D),r.y+D)}}(M,u.position,x),k=W(w,u.position)),D.follow){if(X>x){var g=M.x-w.x,z=M.y-w.y;u.position.x+=g,u.position.y+=z,u.el.style.top=u.position.y-(r.box.top+a.y)+"px",u.el.style.left=u.position.x-(r.box.left+a.x)+"px",X=W(M,u.position)}}else M=w,X=k;var S=M.x-u.position.x,K=M.y-u.position.y;u.frontPosition={x:S,y:K},D.dataOnly||(u.ui.front.style.transform="translate("+S+"px,"+K+"px)");var f={identifier:u.identifier,position:M,force:U,pressure:c.force||c.pressure||c.webkitForce||0,distance:X,angle:{radian:y,degree:e},vector:{x:S/x,y:-K/x},raw:N,instance:u,lockX:D.lockX,lockY:D.lockY};(f=u.computeDirection(f)).angle={radian:B(180-e),degree:180-e},u.trigger("move",f),r.trigger("move "+u.id+":move",f)}else this.processOnEnd(c)},S.prototype.processOnEnd=function(c){var r=this,D=r.options,W=r.manager.getIdentifier(c),B=r.nipples.get(W),t=r.manager.removeIdentifier(B.identifier);B&&(D.dataOnly||B.hide((function(){"dynamic"===D.mode&&(B.trigger("removed",B),r.trigger("removed "+B.id+":removed",B),r.manager.trigger("removed "+B.id+":removed",B),B.destroy())})),clearInterval(r.pressureIntervals[B.identifier]),B.resetDirection(),B.trigger("end",B),r.trigger("end "+B.id+":end",B),r.ids.indexOf(B.identifier)>=0&&r.ids.splice(r.ids.indexOf(B.identifier),1),r.actives.indexOf(B)>=0&&r.actives.splice(r.actives.indexOf(B),1),/(semi|static)/.test(D.mode)?r.idles.push(B):r.nipples.indexOf(B)>=0&&r.nipples.splice(r.nipples.indexOf(B),1),r.manager.unbindDocument(),/(semi|static)/.test(D.mode)&&(r.manager.ids[t.id]=t.identifier))},S.prototype.onDestroyed=function(c,r){var D=this;D.nipples.indexOf(r)>=0&&D.nipples.splice(D.nipples.indexOf(r),1),D.actives.indexOf(r)>=0&&D.actives.splice(D.actives.indexOf(r),1),D.idles.indexOf(r)>=0&&D.idles.splice(D.idles.indexOf(r),1),D.ids.indexOf(r.identifier)>=0&&D.ids.splice(D.ids.indexOf(r.identifier),1),D.manager.removeIdentifier(r.identifier),D.manager.unbindDocument()},S.prototype.destroy=function(){var c=this;for(var r in c.unbindEvt(c.options.zone,"start"),c.nipples.forEach((function(c){c.destroy()})),c.pressureIntervals)c.pressureIntervals.hasOwnProperty(r)&&clearInterval(c.pressureIntervals[r]);c.trigger("destroyed",c.nipples),c.manager.unbindDocument(),c.off()};const K=S;function f(c){var r=this;r.ids={},r.index=0,r.collections=[],r.scroll=M(),r.config(c),r.prepareCollections();var D=function(){var c;r.collections.forEach((function(D){D.forEach((function(D){c=D.el.getBoundingClientRect(),D.position={x:r.scroll.x+c.left,y:r.scroll.y+c.top}}))}))};a(window,"resize",(function(){u(D)}));var W=function(){r.scroll=M()};return a(window,"scroll",(function(){u(W)})),r.collections}f.prototype=new N,f.constructor=f,f.prototype.prepareCollections=function(){var c=this;c.collections.create=c.create.bind(c),c.collections.on=c.on.bind(c),c.collections.off=c.off.bind(c),c.collections.destroy=c.destroy.bind(c),c.collections.get=function(r){var D;return c.collections.every((function(c){return!(D=c.get(r))})),D}},f.prototype.create=function(c){return this.createCollection(c)},f.prototype.createCollection=function(c){var r=this,D=new K(r,c);return r.bindCollection(D),r.collections.push(D),D},f.prototype.bindCollection=function(c){var r,D=this,W=function(c,W){r=c.type+" "+W.id+":"+c.type,D.trigger(r,W)};c.on("destroyed",D.onDestroyed.bind(D)),c.on("shown hidden rested dir plain",W),c.on("dir:up dir:right dir:down dir:left",W),c.on("plain:up plain:right plain:down plain:left",W)},f.prototype.bindDocument=function(){var c=this;c.binded||(c.bindEvt(document,"move").bindEvt(document,"end"),c.binded=!0)},f.prototype.unbindDocument=function(c){var r=this;Object.keys(r.ids).length&&!0!==c||(r.unbindEvt(document,"move").unbindEvt(document,"end"),r.binded=!1)},f.prototype.getIdentifier=function(c){var r;return c?void 0===(r=void 0===c.identifier?c.pointerId:c.identifier)&&(r=this.latest||0):r=this.index,void 0===this.ids[r]&&(this.ids[r]=this.index,this.index+=1),this.latest=r,this.ids[r]},f.prototype.removeIdentifier=function(c){var r={};for(var D in this.ids)if(this.ids[D]===c){r.id=D,r.identifier=this.ids[D],delete this.ids[D];break}return r},f.prototype.onmove=function(c){return this.onAny("move",c),!1},f.prototype.onend=function(c){return this.onAny("end",c),!1},f.prototype.oncancel=function(c){return this.onAny("end",c),!1},f.prototype.onAny=function(c,r){var D,W=this,B="processOn"+c.charAt(0).toUpperCase()+c.slice(1);r=x(r);var t=function(c,r,D){D.ids.indexOf(r)>=0&&(D[B](c),c._found_=!0)};return k(r,(function(c){D=W.getIdentifier(c),k(W.collections,t.bind(null,c,D)),c._found_||W.removeIdentifier(D)})),!1},f.prototype.destroy=function(){var c=this;c.unbindDocument(!0),c.ids={},c.index=0,c.collections.forEach((function(c){c.destroy()})),c.off()},f.prototype.onDestroyed=function(c,r){var D=this;if(D.collections.indexOf(r)<0)return!1;D.collections.splice(D.collections.indexOf(r),1)};var A=new f;const h={create:function(c){return A.create(c)},factory:A};return r.default})(),c.exports=r()},12793:(c,r,D)=>{"use strict";const{Deflate:W,deflate:B,deflateRaw:t,gzip:u}=D(12802),{Inflate:a,inflate:H,inflateRaw:x,ungzip:M}=D(12863),E=D(12837);c.exports.Deflate=W,c.exports.deflate=B,c.exports.deflateRaw=t,c.exports.gzip=u,c.exports.Inflate=a,c.exports.inflate=H,c.exports.inflateRaw=x,c.exports.ungzip=M,c.exports.constants=E},12802:(c,r,D)=>{"use strict";const W=D(12810),B=D(12846),t=D(12853),u=D(12835),a=D(12861),H=Object.prototype.toString,{Z_NO_FLUSH:x,Z_SYNC_FLUSH:M,Z_FULL_FLUSH:E,Z_FINISH:m,Z_OK:Y,Z_STREAM_END:v,Z_DEFAULT_COMPRESSION:k,Z_DEFAULT_STRATEGY:w,Z_DEFLATED:Z}=D(12837);function J(c){this.options=B.assign({level:k,method:Z,Tc:16384,windowBits:15,memLevel:8,strategy:w},c||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.mr="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let D=W.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(D!==Y)throw new Error(u[D]);if(r.header&&W.deflateSetHeader(this.strm,r.header),r.dictionary){let c;if(c="string"===typeof r.dictionary?t.string2buf(r.dictionary):"[object ArrayBuffer]"===H.call(r.dictionary)?new Uint8Array(r.dictionary):r.dictionary,D=W.deflateSetDictionary(this.strm,c),D!==Y)throw new Error(u[D]);this._dict_set=!0}}function q(c,r){const D=new J(r);if(D.push(c,!0),D.err)throw D.mr||u[D.err];return D.result}J.prototype.push=function(c,r){const D=this.strm,B=this.options.Tc;let u,a;if(this.ended)return!1;for(a=r===~~r?r:!0===r?m:x,"string"===typeof c?D.input=t.string2buf(c):"[object ArrayBuffer]"===H.call(c)?D.input=new Uint8Array(c):D.input=c,D.next_in=0,D.avail_in=D.input.length;;)if(0===D.avail_out&&(D.output=new Uint8Array(B),D.next_out=0,D.avail_out=B),(a===M||a===E)&&D.avail_out<=6)this.onData(D.output.subarray(0,D.next_out)),D.avail_out=0;else{if(u=W.deflate(D,a),u===v)return D.next_out>0&&this.onData(D.output.subarray(0,D.next_out)),u=W.deflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===Y;if(0!==D.avail_out){if(a>0&&D.next_out>0)this.onData(D.output.subarray(0,D.next_out)),D.avail_out=0;else if(0===D.avail_in)break}else this.onData(D.output)}return!0},J.prototype.onData=function(c){this.chunks.push(c)},J.prototype.onEnd=function(c){c===Y&&(this.result=B.flattenChunks(this.chunks)),this.chunks=[],this.err=c,this.mr=this.strm.mr},c.exports.Deflate=J,c.exports.deflate=q,c.exports.deflateRaw=function(c,r){return(r=r||{}).raw=!0,q(c,r)},c.exports.gzip=function(c,r){return(r=r||{}).gzip=!0,q(c,r)},c.exports.constants=D(12837)},12863:(c,r,D)=>{"use strict";const W=D(12865),B=D(12846),t=D(12853),u=D(12835),a=D(12861),H=D(12888),x=Object.prototype.toString,{Z_NO_FLUSH:M,Z_FINISH:E,Z_OK:m,Z_STREAM_END:Y,Z_NEED_DICT:v,Z_STREAM_ERROR:k,Z_DATA_ERROR:w,Z_MEM_ERROR:Z}=D(12837);function J(c){this.options=B.assign({Tc:65536,windowBits:15,to:""},c||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,0===r.windowBits&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||c&&c.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&0===(15&r.windowBits)&&(r.windowBits|=15),this.err=0,this.mr="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let D=W.inflateInit2(this.strm,r.windowBits);if(D!==m)throw new Error(u[D]);if(this.header=new H,W.inflateGetHeader(this.strm,this.header),r.dictionary&&("string"===typeof r.dictionary?r.dictionary=t.string2buf(r.dictionary):"[object ArrayBuffer]"===x.call(r.dictionary)&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(D=W.inflateSetDictionary(this.strm,r.dictionary),D!==m)))throw new Error(u[D])}function q(c,r){const D=new J(r);if(D.push(c),D.err)throw D.mr||u[D.err];return D.result}J.prototype.push=function(c,r){const D=this.strm,B=this.options.Tc,u=this.options.dictionary;let a,H,J;if(this.ended)return!1;for(H=r===~~r?r:!0===r?E:M,"[object ArrayBuffer]"===x.call(c)?D.input=new Uint8Array(c):D.input=c,D.next_in=0,D.avail_in=D.input.length;;){for(0===D.avail_out&&(D.output=new Uint8Array(B),D.next_out=0,D.avail_out=B),a=W.inflate(D,H),a===v&&u&&(a=W.inflateSetDictionary(D,u),a===m?a=W.inflate(D,H):a===w&&(a=v));D.avail_in>0&&a===Y&&D.state.wrap>0&&0!==c[D.next_in];)W.inflateReset(D),a=W.inflate(D,H);switch(a){case k:case w:case v:case Z:return this.onEnd(a),this.ended=!0,!1}if(J=D.avail_out,D.next_out&&(0===D.avail_out||a===Y))if("string"===this.options.to){let c=t.utf8border(D.output,D.next_out),r=D.next_out-c,W=t.buf2string(D.output,c);D.next_out=r,D.avail_out=B-r,r&&D.output.set(D.output.subarray(c,c+r),0),this.onData(W)}else this.onData(D.output.length===D.next_out?D.output:D.output.subarray(0,D.next_out));if(a!==m||0!==J){if(a===Y)return a=W.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===D.avail_in)break}}return!0},J.prototype.onData=function(c){this.chunks.push(c)},J.prototype.onEnd=function(c){c===m&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=B.flattenChunks(this.chunks)),this.chunks=[],this.err=c,this.mr=this.strm.mr},c.exports.Inflate=J,c.exports.inflate=q,c.exports.inflateRaw=function(c,r){return(r=r||{}).raw=!0,q(c,r)},c.exports.ungzip=q,c.exports.constants=D(12837)},12846:c=>{"use strict";const r=(c,r)=>Object.prototype.hasOwnProperty.call(c,r);c.exports.assign=function(c){const D=Array.prototype.slice.call(arguments,1);for(;D.length;){const W=D.shift();if(W){if("object"!==typeof W)throw new TypeError(W+"must be non-object");for(const D in W)r(W,D)&&(c[D]=W[D])}}return c},c.exports.flattenChunks=c=>{let r=0;for(let W=0,B=c.length;W<B;W++)r+=c[W].length;const D=new Uint8Array(r);for(let W=0,B=0,t=c.length;W<t;W++){let r=c[W];D.set(r,B),B+=r.length}return D}},12853:c=>{"use strict";let r=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(W){r=!1}const D=new Uint8Array(256);for(let B=0;B<256;B++)D[B]=B>=252?6:B>=248?5:B>=240?4:B>=224?3:B>=192?2:1;D[254]=D[254]=1,c.exports.string2buf=c=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(c);let r,D,W,B,t,u=c.length,a=0;for(B=0;B<u;B++)D=c.charCodeAt(B),55296===(64512&D)&&B+1<u&&(W=c.charCodeAt(B+1),56320===(64512&W)&&(D=65536+(D-55296<<10)+(W-56320),B++)),a+=D<128?1:D<2048?2:D<65536?3:4;for(r=new Uint8Array(a),t=0,B=0;t<a;B++)D=c.charCodeAt(B),55296===(64512&D)&&B+1<u&&(W=c.charCodeAt(B+1),56320===(64512&W)&&(D=65536+(D-55296<<10)+(W-56320),B++)),D<128?r[t++]=D:D<2048?(r[t++]=192|D>>>6,r[t++]=128|63&D):D<65536?(r[t++]=224|D>>>12,r[t++]=128|D>>>6&63,r[t++]=128|63&D):(r[t++]=240|D>>>18,r[t++]=128|D>>>12&63,r[t++]=128|D>>>6&63,r[t++]=128|63&D);return r};c.exports.buf2string=(c,W)=>{const B=W||c.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(c.subarray(0,W));let t,u;const a=new Array(2*B);for(u=0,t=0;t<B;){let r=c[t++];if(r<128){a[u++]=r;continue}let W=D[r];if(W>4)a[u++]=65533,t+=W-1;else{for(r&=2===W?31:3===W?15:7;W>1&&t<B;)r=r<<6|63&c[t++],W--;W>1?a[u++]=65533:r<65536?a[u++]=r:(r-=65536,a[u++]=55296|r>>10&1023,a[u++]=56320|1023&r)}}return((c,D)=>{if(D<65534&&c.subarray&&r)return String.fromCharCode.apply(null,c.length===D?c:c.subarray(0,D));let W="";for(let r=0;r<D;r++)W+=String.fromCharCode(c[r]);return W})(a,u)},c.exports.utf8border=(c,r)=>{(r=r||c.length)>c.length&&(r=c.length);let W=r-1;for(;W>=0&&128===(192&c[W]);)W--;return W<0||0===W?r:W+D[c[W]]>r?W:r}},12823:c=>{"use strict";c.exports=(c,r,D,W)=>{let B=65535&c,t=c>>>16&65535,u=0;for(;0!==D;){u=D>2e3?2e3:D,D-=u;do{B=B+r[W++]|0,t=t+B|0}while(--u);B%=65521,t%=65521}return B|t<<16}},12837:c=>{"use strict";c.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12827:c=>{"use strict";const r=new Uint32Array((()=>{let c,r=[];for(var D=0;D<256;D++){c=D;for(var W=0;W<8;W++)c=1&c?3988292384^c>>>1:c>>>1;r[D]=c}return r})());c.exports=(c,D,W,B)=>{const t=r,u=B+W;c^=-1;for(let r=B;r<u;r++)c=c>>>8^t[255&(c^D[r])];return~c}},12810:(c,r,D)=>{"use strict";const{_tr_init:W,_tr_stored_block:B,_tr_flush_block:t,_tr_tally:u,_tr_align:a}=D(12819),H=D(12823),x=D(12827),M=D(12835),{Z_NO_FLUSH:E,Z_PARTIAL_FLUSH:m,Z_FULL_FLUSH:Y,Z_FINISH:v,Z_BLOCK:k,Z_OK:w,Z_STREAM_END:Z,Z_STREAM_ERROR:J,Z_DATA_ERROR:q,Z_BUF_ERROR:j,Z_DEFAULT_COMPRESSION:X,Z_FILTERED:e,Z_HUFFMAN_ONLY:y,Z_RLE:U,Z_FIXED:N,Z_DEFAULT_STRATEGY:g,Z_UNKNOWN:z,Z_DEFLATED:S}=D(12837),K=258,f=262,A=103,h=113,L=666,P=(c,r)=>(c.mr=M[r],r),G=c=>(c<<1)-(c>4?9:0),d=c=>{let r=c.length;for(;--r>=0;)c[r]=0};let T=(c,r,D)=>(r<<c.hash_shift^D)&c.hash_mask;const b=c=>{const r=c.state;let D=r.pending;D>c.avail_out&&(D=c.avail_out),0!==D&&(c.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+D),c.next_out),c.next_out+=D,r.pending_out+=D,c.total_out+=D,c.avail_out-=D,r.pending-=D,0===r.pending&&(r.pending_out=0))},O=(c,r)=>{t(c,c.block_start>=0?c.block_start:-1,c.strstart-c.block_start,r),c.block_start=c.strstart,b(c.strm)},C=(c,r)=>{c.pending_buf[c.pending++]=r},p=(c,r)=>{c.pending_buf[c.pending++]=r>>>8&255,c.pending_buf[c.pending++]=255&r},R=(c,r,D,W)=>{let B=c.avail_in;return B>W&&(B=W),0===B?0:(c.avail_in-=B,r.set(c.input.subarray(c.next_in,c.next_in+B),D),1===c.state.wrap?c.adler=H(c.adler,r,B,D):2===c.state.wrap&&(c.adler=x(c.adler,r,B,D)),c.next_in+=B,c.total_in+=B,B)},s=(c,r)=>{let D,W,B=c.max_chain_length,t=c.strstart,u=c.prev_length,a=c.nice_match;const H=c.strstart>c.w_size-f?c.strstart-(c.w_size-f):0,x=c.window,M=c.w_mask,E=c.prev,m=c.strstart+K;let Y=x[t+u-1],v=x[t+u];c.prev_length>=c.good_match&&(B>>=2),a>c.lookahead&&(a=c.lookahead);do{if(D=r,x[D+u]===v&&x[D+u-1]===Y&&x[D]===x[t]&&x[++D]===x[t+1]){t+=2,D++;do{}while(x[++t]===x[++D]&&x[++t]===x[++D]&&x[++t]===x[++D]&&x[++t]===x[++D]&&x[++t]===x[++D]&&x[++t]===x[++D]&&x[++t]===x[++D]&&x[++t]===x[++D]&&t<m);if(W=K-(m-t),t=m-K,W>u){if(c.match_start=r,u=W,W>=a)break;Y=x[t+u-1],v=x[t+u]}}}while((r=E[r&M])>H&&0!==--B);return u<=c.lookahead?u:c.lookahead},o=c=>{const r=c.w_size;let D,W,B,t,u;do{if(t=c.window_size-c.lookahead-c.strstart,c.strstart>=r+(r-f)){c.window.set(c.window.subarray(r,r+r),0),c.match_start-=r,c.strstart-=r,c.block_start-=r,W=c.hash_size,D=W;do{B=c.head[--D],c.head[D]=B>=r?B-r:0}while(--W);W=r,D=W;do{B=c.prev[--D],c.prev[D]=B>=r?B-r:0}while(--W);t+=r}if(0===c.strm.avail_in)break;if(W=R(c.strm,c.window,c.strstart+c.lookahead,t),c.lookahead+=W,c.lookahead+c.insert>=3)for(u=c.strstart-c.insert,c.ins_h=c.window[u],c.ins_h=T(c,c.ins_h,c.window[u+1]);c.insert&&(c.ins_h=T(c,c.ins_h,c.window[u+3-1]),c.prev[u&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=u,u++,c.insert--,!(c.lookahead+c.insert<3)););}while(c.lookahead<f&&0!==c.strm.avail_in)},Q=(c,r)=>{let D,W;for(;;){if(c.lookahead<f){if(o(c),c.lookahead<f&&r===E)return 1;if(0===c.lookahead)break}if(D=0,c.lookahead>=3&&(c.ins_h=T(c,c.ins_h,c.window[c.strstart+3-1]),D=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart),0!==D&&c.strstart-D<=c.w_size-f&&(c.match_length=s(c,D)),c.match_length>=3)if(W=u(c,c.strstart-c.match_start,c.match_length-3),c.lookahead-=c.match_length,c.match_length<=c.max_lazy_match&&c.lookahead>=3){c.match_length--;do{c.strstart++,c.ins_h=T(c,c.ins_h,c.window[c.strstart+3-1]),D=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart}while(0!==--c.match_length);c.strstart++}else c.strstart+=c.match_length,c.match_length=0,c.ins_h=c.window[c.strstart],c.ins_h=T(c,c.ins_h,c.window[c.strstart+1]);else W=u(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++;if(W&&(O(c,!1),0===c.strm.avail_out))return 1}return c.insert=c.strstart<2?c.strstart:2,r===v?(O(c,!0),0===c.strm.avail_out?3:4):c.last_lit&&(O(c,!1),0===c.strm.avail_out)?1:2},l=(c,r)=>{let D,W,B;for(;;){if(c.lookahead<f){if(o(c),c.lookahead<f&&r===E)return 1;if(0===c.lookahead)break}if(D=0,c.lookahead>=3&&(c.ins_h=T(c,c.ins_h,c.window[c.strstart+3-1]),D=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart),c.prev_length=c.match_length,c.prev_match=c.match_start,c.match_length=2,0!==D&&c.prev_length<c.max_lazy_match&&c.strstart-D<=c.w_size-f&&(c.match_length=s(c,D),c.match_length<=5&&(c.strategy===e||3===c.match_length&&c.strstart-c.match_start>4096)&&(c.match_length=2)),c.prev_length>=3&&c.match_length<=c.prev_length){B=c.strstart+c.lookahead-3,W=u(c,c.strstart-1-c.prev_match,c.prev_length-3),c.lookahead-=c.prev_length-1,c.prev_length-=2;do{++c.strstart<=B&&(c.ins_h=T(c,c.ins_h,c.window[c.strstart+3-1]),D=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=c.strstart)}while(0!==--c.prev_length);if(c.match_available=0,c.match_length=2,c.strstart++,W&&(O(c,!1),0===c.strm.avail_out))return 1}else if(c.match_available){if(W=u(c,0,c.window[c.strstart-1]),W&&O(c,!1),c.strstart++,c.lookahead--,0===c.strm.avail_out)return 1}else c.match_available=1,c.strstart++,c.lookahead--}return c.match_available&&(W=u(c,0,c.window[c.strstart-1]),c.match_available=0),c.insert=c.strstart<2?c.strstart:2,r===v?(O(c,!0),0===c.strm.avail_out?3:4):c.last_lit&&(O(c,!1),0===c.strm.avail_out)?1:2};function F(c,r,D,W,B){this.good_length=c,this.max_lazy=r,this.nice_length=D,this.max_chain=W,this.func=B}const I=[new F(0,0,0,0,((c,r)=>{let D=65535;for(D>c.pending_buf_size-5&&(D=c.pending_buf_size-5);;){if(c.lookahead<=1){if(o(c),0===c.lookahead&&r===E)return 1;if(0===c.lookahead)break}c.strstart+=c.lookahead,c.lookahead=0;const W=c.block_start+D;if((0===c.strstart||c.strstart>=W)&&(c.lookahead=c.strstart-W,c.strstart=W,O(c,!1),0===c.strm.avail_out))return 1;if(c.strstart-c.block_start>=c.w_size-f&&(O(c,!1),0===c.strm.avail_out))return 1}return c.insert=0,r===v?(O(c,!0),0===c.strm.avail_out?3:4):(c.strstart>c.block_start&&(O(c,!1),c.strm.avail_out),1)})),new F(4,4,8,4,Q),new F(4,5,16,8,Q),new F(4,6,32,32,Q),new F(4,4,16,16,l),new F(8,16,32,32,l),new F(8,16,128,128,l),new F(8,32,128,256,l),new F(32,128,258,1024,l),new F(32,258,258,4096,l)];function i(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),d(this.dyn_ltree),d(this.dyn_dtree),d(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),d(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),d(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const n=c=>{if(!c||!c.state)return P(c,J);c.total_in=c.total_out=0,c.data_type=z;const r=c.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap?42:h,c.adler=2===r.wrap?0:1,r.last_flush=E,W(r),w},V=c=>{const r=n(c);var D;return r===w&&((D=c.state).window_size=2*D.w_size,d(D.head),D.max_lazy_match=I[D.level].max_lazy,D.good_match=I[D.level].good_length,D.nice_match=I[D.level].nice_length,D.max_chain_length=I[D.level].max_chain,D.strstart=0,D.block_start=0,D.lookahead=0,D.insert=0,D.match_length=D.prev_length=2,D.match_available=0,D.ins_h=0),r},cc=(c,r,D,W,B,t)=>{if(!c)return J;let u=1;if(r===X&&(r=6),W<0?(u=0,W=-W):W>15&&(u=2,W-=16),B<1||B>9||D!==S||W<8||W>15||r<0||r>9||t<0||t>N)return P(c,J);8===W&&(W=9);const a=new i;return c.state=a,a.strm=c,a.wrap=u,a.gzhead=null,a.w_bits=W,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=B+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<B+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=r,a.strategy=t,a.method=D,V(c)};c.exports.deflateInit=(c,r)=>cc(c,r,S,15,8,g),c.exports.deflateInit2=cc,c.exports.deflateReset=V,c.exports.deflateResetKeep=n,c.exports.deflateSetHeader=(c,r)=>c&&c.state?2!==c.state.wrap?J:(c.state.gzhead=r,w):J,c.exports.deflate=(c,r)=>{let D,W;if(!c||!c.state||r>k||r<0)return c?P(c,J):J;const t=c.state;if(!c.output||!c.input&&0!==c.avail_in||t.status===L&&r!==v)return P(c,0===c.avail_out?j:J);t.strm=c;const H=t.last_flush;if(t.last_flush=r,42===t.status)if(2===t.wrap)c.adler=0,C(t,31),C(t,139),C(t,8),t.gzhead?(C(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),C(t,255&t.gzhead.time),C(t,t.gzhead.time>>8&255),C(t,t.gzhead.time>>16&255),C(t,t.gzhead.time>>24&255),C(t,9===t.level?2:t.strategy>=y||t.level<2?4:0),C(t,255&t.gzhead.os),t.gzhead.extra&&t.gzhead.extra.length&&(C(t,255&t.gzhead.extra.length),C(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(c.adler=x(c.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=69):(C(t,0),C(t,0),C(t,0),C(t,0),C(t,0),C(t,9===t.level?2:t.strategy>=y||t.level<2?4:0),C(t,3),t.status=h);else{let r=S+(t.w_bits-8<<4)<<8,D=-1;D=t.strategy>=y||t.level<2?0:t.level<6?1:6===t.level?2:3,r|=D<<6,0!==t.strstart&&(r|=32),r+=31-r%31,t.status=h,p(t,r),0!==t.strstart&&(p(t,c.adler>>>16),p(t,65535&c.adler)),c.adler=1}if(69===t.status)if(t.gzhead.extra){for(D=t.pending;t.gzindex<(65535&t.gzhead.extra.length)&&(t.pending!==t.pending_buf_size||(t.gzhead.hcrc&&t.pending>D&&(c.adler=x(c.adler,t.pending_buf,t.pending-D,D)),b(c),D=t.pending,t.pending!==t.pending_buf_size));)C(t,255&t.gzhead.extra[t.gzindex]),t.gzindex++;t.gzhead.hcrc&&t.pending>D&&(c.adler=x(c.adler,t.pending_buf,t.pending-D,D)),t.gzindex===t.gzhead.extra.length&&(t.gzindex=0,t.status=73)}else t.status=73;if(73===t.status)if(t.gzhead.name){D=t.pending;do{if(t.pending===t.pending_buf_size&&(t.gzhead.hcrc&&t.pending>D&&(c.adler=x(c.adler,t.pending_buf,t.pending-D,D)),b(c),D=t.pending,t.pending===t.pending_buf_size)){W=1;break}W=t.gzindex<t.gzhead.name.length?255&t.gzhead.name.charCodeAt(t.gzindex++):0,C(t,W)}while(0!==W);t.gzhead.hcrc&&t.pending>D&&(c.adler=x(c.adler,t.pending_buf,t.pending-D,D)),0===W&&(t.gzindex=0,t.status=91)}else t.status=91;if(91===t.status)if(t.gzhead.comment){D=t.pending;do{if(t.pending===t.pending_buf_size&&(t.gzhead.hcrc&&t.pending>D&&(c.adler=x(c.adler,t.pending_buf,t.pending-D,D)),b(c),D=t.pending,t.pending===t.pending_buf_size)){W=1;break}W=t.gzindex<t.gzhead.comment.length?255&t.gzhead.comment.charCodeAt(t.gzindex++):0,C(t,W)}while(0!==W);t.gzhead.hcrc&&t.pending>D&&(c.adler=x(c.adler,t.pending_buf,t.pending-D,D)),0===W&&(t.status=A)}else t.status=A;if(t.status===A&&(t.gzhead.hcrc?(t.pending+2>t.pending_buf_size&&b(c),t.pending+2<=t.pending_buf_size&&(C(t,255&c.adler),C(t,c.adler>>8&255),c.adler=0,t.status=h)):t.status=h),0!==t.pending){if(b(c),0===c.avail_out)return t.last_flush=-1,w}else if(0===c.avail_in&&G(r)<=G(H)&&r!==v)return P(c,j);if(t.status===L&&0!==c.avail_in)return P(c,j);if(0!==c.avail_in||0!==t.lookahead||r!==E&&t.status!==L){let D=t.strategy===y?((c,r)=>{let D;for(;;){if(0===c.lookahead&&(o(c),0===c.lookahead)){if(r===E)return 1;break}if(c.match_length=0,D=u(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++,D&&(O(c,!1),0===c.strm.avail_out))return 1}return c.insert=0,r===v?(O(c,!0),0===c.strm.avail_out?3:4):c.last_lit&&(O(c,!1),0===c.strm.avail_out)?1:2})(t,r):t.strategy===U?((c,r)=>{let D,W,B,t;const a=c.window;for(;;){if(c.lookahead<=K){if(o(c),c.lookahead<=K&&r===E)return 1;if(0===c.lookahead)break}if(c.match_length=0,c.lookahead>=3&&c.strstart>0&&(B=c.strstart-1,W=a[B],W===a[++B]&&W===a[++B]&&W===a[++B])){t=c.strstart+K;do{}while(W===a[++B]&&W===a[++B]&&W===a[++B]&&W===a[++B]&&W===a[++B]&&W===a[++B]&&W===a[++B]&&W===a[++B]&&B<t);c.match_length=K-(t-B),c.match_length>c.lookahead&&(c.match_length=c.lookahead)}if(c.match_length>=3?(D=u(c,1,c.match_length-3),c.lookahead-=c.match_length,c.strstart+=c.match_length,c.match_length=0):(D=u(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++),D&&(O(c,!1),0===c.strm.avail_out))return 1}return c.insert=0,r===v?(O(c,!0),0===c.strm.avail_out?3:4):c.last_lit&&(O(c,!1),0===c.strm.avail_out)?1:2})(t,r):I[t.level].func(t,r);if(3!==D&&4!==D||(t.status=L),1===D||3===D)return 0===c.avail_out&&(t.last_flush=-1),w;if(2===D&&(r===m?a(t):r!==k&&(B(t,0,0,!1),r===Y&&(d(t.head),0===t.lookahead&&(t.strstart=0,t.block_start=0,t.insert=0))),b(c),0===c.avail_out))return t.last_flush=-1,w}return r!==v?w:t.wrap<=0?Z:(2===t.wrap?(C(t,255&c.adler),C(t,c.adler>>8&255),C(t,c.adler>>16&255),C(t,c.adler>>24&255),C(t,255&c.total_in),C(t,c.total_in>>8&255),C(t,c.total_in>>16&255),C(t,c.total_in>>24&255)):(p(t,c.adler>>>16),p(t,65535&c.adler)),b(c),t.wrap>0&&(t.wrap=-t.wrap),0!==t.pending?w:Z)},c.exports.deflateEnd=c=>{if(!c||!c.state)return J;const r=c.state.status;return 42!==r&&69!==r&&73!==r&&91!==r&&r!==A&&r!==h&&r!==L?P(c,J):(c.state=null,r===h?P(c,q):w)},c.exports.deflateSetDictionary=(c,r)=>{let D=r.length;if(!c||!c.state)return J;const W=c.state,B=W.wrap;if(2===B||1===B&&42!==W.status||W.lookahead)return J;if(1===B&&(c.adler=H(c.adler,r,D,0)),W.wrap=0,D>=W.w_size){0===B&&(d(W.head),W.strstart=0,W.block_start=0,W.insert=0);let c=new Uint8Array(W.w_size);c.set(r.subarray(D-W.w_size,D),0),r=c,D=W.w_size}const t=c.avail_in,u=c.next_in,a=c.input;for(c.avail_in=D,c.next_in=0,c.input=r,o(W);W.lookahead>=3;){let c=W.strstart,r=W.lookahead-2;do{W.ins_h=T(W,W.ins_h,W.window[c+3-1]),W.prev[c&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=c,c++}while(--r);W.strstart=c,W.lookahead=2,o(W)}return W.strstart+=W.lookahead,W.block_start=W.strstart,W.insert=W.lookahead,W.lookahead=0,W.match_length=W.prev_length=2,W.match_available=0,c.next_in=u,c.input=a,c.avail_in=t,W.wrap=B,w},c.exports.deflateInfo="pako deflate (from Nodeca project)"},12888:c=>{"use strict";c.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12874:c=>{"use strict";c.exports=function(c,r){let D,W,B,t,u,a,H,x,M,E,m,Y,v,k,w,Z,J,q,j,X,e,y,U,N;const g=c.state;D=c.next_in,U=c.input,W=D+(c.avail_in-5),B=c.next_out,N=c.output,t=B-(r-c.avail_out),u=B+(c.avail_out-257),a=g.dmax,H=g.wsize,x=g.whave,M=g.wnext,E=g.window,m=g.hold,Y=g.bits,v=g.lencode,k=g.distcode,w=(1<<g.lenbits)-1,Z=(1<<g.distbits)-1;c:do{Y<15&&(m+=U[D++]<<Y,Y+=8,m+=U[D++]<<Y,Y+=8),J=v[m&w];r:for(;;){if(q=J>>>24,m>>>=q,Y-=q,q=J>>>16&255,0===q)N[B++]=65535&J;else{if(!(16&q)){if(0===(64&q)){J=v[(65535&J)+(m&(1<<q)-1)];continue r}if(32&q){g.mode=12;break c}c.mr="invalid literal/length code",g.mode=30;break c}j=65535&J,q&=15,q&&(Y<q&&(m+=U[D++]<<Y,Y+=8),j+=m&(1<<q)-1,m>>>=q,Y-=q),Y<15&&(m+=U[D++]<<Y,Y+=8,m+=U[D++]<<Y,Y+=8),J=k[m&Z];D:for(;;){if(q=J>>>24,m>>>=q,Y-=q,q=J>>>16&255,!(16&q)){if(0===(64&q)){J=k[(65535&J)+(m&(1<<q)-1)];continue D}c.mr="invalid distance code",g.mode=30;break c}if(X=65535&J,q&=15,Y<q&&(m+=U[D++]<<Y,Y+=8,Y<q&&(m+=U[D++]<<Y,Y+=8)),X+=m&(1<<q)-1,X>a){c.mr="invalid distance too far back",g.mode=30;break c}if(m>>>=q,Y-=q,q=B-t,X>q){if(q=X-q,q>x&&g.sane){c.mr="invalid distance too far back",g.mode=30;break c}if(e=0,y=E,0===M){if(e+=H-q,q<j){j-=q;do{N[B++]=E[e++]}while(--q);e=B-X,y=N}}else if(M<q){if(e+=H+M-q,q-=M,q<j){j-=q;do{N[B++]=E[e++]}while(--q);if(e=0,M<j){q=M,j-=q;do{N[B++]=E[e++]}while(--q);e=B-X,y=N}}}else if(e+=M-q,q<j){j-=q;do{N[B++]=E[e++]}while(--q);e=B-X,y=N}for(;j>2;)N[B++]=y[e++],N[B++]=y[e++],N[B++]=y[e++],j-=3;j&&(N[B++]=y[e++],j>1&&(N[B++]=y[e++]))}else{e=B-X;do{N[B++]=N[e++],N[B++]=N[e++],N[B++]=N[e++],j-=3}while(j>2);j&&(N[B++]=N[e++],j>1&&(N[B++]=N[e++]))}break}}break}}while(D<W&&B<u);j=Y>>3,D-=j,Y-=j<<3,m&=(1<<Y)-1,c.next_in=D,c.next_out=B,c.avail_in=D<W?W-D+5:5-(D-W),c.avail_out=B<u?u-B+257:257-(B-u),g.hold=m,g.bits=Y}},12865:(c,r,D)=>{"use strict";const W=D(12823),B=D(12827),t=D(12874),u=D(12882),{Z_FINISH:a,Z_BLOCK:H,Z_TREES:x,Z_OK:M,Z_STREAM_END:E,Z_NEED_DICT:m,Z_STREAM_ERROR:Y,Z_DATA_ERROR:v,Z_MEM_ERROR:k,Z_BUF_ERROR:w,Z_DEFLATED:Z}=D(12837),J=12,q=30,j=c=>(c>>>24&255)+(c>>>8&65280)+((65280&c)<<8)+((255&c)<<24);function X(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const e=c=>{if(!c||!c.state)return Y;const r=c.state;return c.total_in=c.total_out=r.total=0,c.mr="",r.wrap&&(c.adler=1&r.wrap),r.mode=1,r.last=0,r.havedict=0,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,M},y=c=>{if(!c||!c.state)return Y;const r=c.state;return r.wsize=0,r.whave=0,r.wnext=0,e(c)},U=(c,r)=>{let D;if(!c||!c.state)return Y;const W=c.state;return r<0?(D=0,r=-r):(D=1+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Y:(null!==W.window&&W.wbits!==r&&(W.window=null),W.wrap=D,W.wbits=r,y(c))},N=(c,r)=>{if(!c)return Y;const D=new X;c.state=D,D.window=null;const W=U(c,r);return W!==M&&(c.state=null),W};let g,z,S=!0;const K=c=>{if(S){g=new Int32Array(512),z=new Int32Array(32);let r=0;for(;r<144;)c.lens[r++]=8;for(;r<256;)c.lens[r++]=9;for(;r<280;)c.lens[r++]=7;for(;r<288;)c.lens[r++]=8;for(u(1,c.lens,0,288,g,0,c.work,{bits:9}),r=0;r<32;)c.lens[r++]=5;u(2,c.lens,0,32,z,0,c.work,{bits:5}),S=!1}c.lencode=g,c.lenbits=9,c.distcode=z,c.distbits=5},f=(c,r,D,W)=>{let B;const t=c.state;return null===t.window&&(t.wsize=1<<t.wbits,t.wnext=0,t.whave=0,t.window=new Uint8Array(t.wsize)),W>=t.wsize?(t.window.set(r.subarray(D-t.wsize,D),0),t.wnext=0,t.whave=t.wsize):(B=t.wsize-t.wnext,B>W&&(B=W),t.window.set(r.subarray(D-W,D-W+B),t.wnext),(W-=B)?(t.window.set(r.subarray(D-W,D),0),t.wnext=W,t.whave=t.wsize):(t.wnext+=B,t.wnext===t.wsize&&(t.wnext=0),t.whave<t.wsize&&(t.whave+=B))),0};c.exports.inflateReset=y,c.exports.inflateReset2=U,c.exports.inflateResetKeep=e,c.exports.inflateInit=c=>N(c,15),c.exports.inflateInit2=N,c.exports.inflate=(c,r)=>{let D,X,e,y,U,N,g,z,S,A,h,L,P,G,d,T,b,O,C,p,R,s,o=0;const Q=new Uint8Array(4);let l,F;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!c||!c.state||!c.output||!c.input&&0!==c.avail_in)return Y;D=c.state,D.mode===J&&(D.mode=13),U=c.next_out,e=c.output,g=c.avail_out,y=c.next_in,X=c.input,N=c.avail_in,z=D.hold,S=D.bits,A=N,h=g,s=M;c:for(;;)switch(D.mode){case 1:if(0===D.wrap){D.mode=13;break}for(;S<16;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}if(2&D.wrap&&35615===z){D.check=0,Q[0]=255&z,Q[1]=z>>>8&255,D.check=B(D.check,Q,2,0),z=0,S=0,D.mode=2;break}if(D.flags=0,D.head&&(D.head.done=!1),!(1&D.wrap)||(((255&z)<<8)+(z>>8))%31){c.mr="incorrect header check",D.mode=q;break}if((15&z)!==Z){c.mr="unknown compression method",D.mode=q;break}if(z>>>=4,S-=4,R=8+(15&z),0===D.wbits)D.wbits=R;else if(R>D.wbits){c.mr="invalid window size",D.mode=q;break}D.dmax=1<<D.wbits,c.adler=D.check=1,D.mode=512&z?10:J,z=0,S=0;break;case 2:for(;S<16;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}if(D.flags=z,(255&D.flags)!==Z){c.mr="unknown compression method",D.mode=q;break}if(57344&D.flags){c.mr="unknown header flags set",D.mode=q;break}D.head&&(D.head.text=z>>8&1),512&D.flags&&(Q[0]=255&z,Q[1]=z>>>8&255,D.check=B(D.check,Q,2,0)),z=0,S=0,D.mode=3;case 3:for(;S<32;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}D.head&&(D.head.time=z),512&D.flags&&(Q[0]=255&z,Q[1]=z>>>8&255,Q[2]=z>>>16&255,Q[3]=z>>>24&255,D.check=B(D.check,Q,4,0)),z=0,S=0,D.mode=4;case 4:for(;S<16;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}D.head&&(D.head.xflags=255&z,D.head.os=z>>8),512&D.flags&&(Q[0]=255&z,Q[1]=z>>>8&255,D.check=B(D.check,Q,2,0)),z=0,S=0,D.mode=5;case 5:if(1024&D.flags){for(;S<16;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}D.length=z,D.head&&(D.head.extra_len=z),512&D.flags&&(Q[0]=255&z,Q[1]=z>>>8&255,D.check=B(D.check,Q,2,0)),z=0,S=0}else D.head&&(D.head.extra=null);D.mode=6;case 6:if(1024&D.flags&&(L=D.length,L>N&&(L=N),L&&(D.head&&(R=D.head.extra_len-D.length,D.head.extra||(D.head.extra=new Uint8Array(D.head.extra_len)),D.head.extra.set(X.subarray(y,y+L),R)),512&D.flags&&(D.check=B(D.check,X,L,y)),N-=L,y+=L,D.length-=L),D.length))break c;D.length=0,D.mode=7;case 7:if(2048&D.flags){if(0===N)break c;L=0;do{R=X[y+L++],D.head&&R&&D.length<65536&&(D.head.name+=String.fromCharCode(R))}while(R&&L<N);if(512&D.flags&&(D.check=B(D.check,X,L,y)),N-=L,y+=L,R)break c}else D.head&&(D.head.name=null);D.length=0,D.mode=8;case 8:if(4096&D.flags){if(0===N)break c;L=0;do{R=X[y+L++],D.head&&R&&D.length<65536&&(D.head.comment+=String.fromCharCode(R))}while(R&&L<N);if(512&D.flags&&(D.check=B(D.check,X,L,y)),N-=L,y+=L,R)break c}else D.head&&(D.head.comment=null);D.mode=9;case 9:if(512&D.flags){for(;S<16;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}if(z!==(65535&D.check)){c.mr="header crc mismatch",D.mode=q;break}z=0,S=0}D.head&&(D.head.hcrc=D.flags>>9&1,D.head.done=!0),c.adler=D.check=0,D.mode=J;break;case 10:for(;S<32;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}c.adler=D.check=j(z),z=0,S=0,D.mode=11;case 11:if(0===D.havedict)return c.next_out=U,c.avail_out=g,c.next_in=y,c.avail_in=N,D.hold=z,D.bits=S,m;c.adler=D.check=1,D.mode=J;case J:if(r===H||r===x)break c;case 13:if(D.last){z>>>=7&S,S-=7&S,D.mode=27;break}for(;S<3;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}switch(D.last=1&z,z>>>=1,S-=1,3&z){case 0:D.mode=14;break;case 1:if(K(D),D.mode=20,r===x){z>>>=2,S-=2;break c}break;case 2:D.mode=17;break;case 3:c.mr="invalid block type",D.mode=q}z>>>=2,S-=2;break;case 14:for(z>>>=7&S,S-=7&S;S<32;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}if((65535&z)!==(z>>>16^65535)){c.mr="invalid stored block lengths",D.mode=q;break}if(D.length=65535&z,z=0,S=0,D.mode=15,r===x)break c;case 15:D.mode=16;case 16:if(L=D.length,L){if(L>N&&(L=N),L>g&&(L=g),0===L)break c;e.set(X.subarray(y,y+L),U),N-=L,y+=L,g-=L,U+=L,D.length-=L;break}D.mode=J;break;case 17:for(;S<14;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}if(D.nlen=257+(31&z),z>>>=5,S-=5,D.ndist=1+(31&z),z>>>=5,S-=5,D.ncode=4+(15&z),z>>>=4,S-=4,D.nlen>286||D.ndist>30){c.mr="too many length or distance symbols",D.mode=q;break}D.have=0,D.mode=18;case 18:for(;D.have<D.ncode;){for(;S<3;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}D.lens[I[D.have++]]=7&z,z>>>=3,S-=3}for(;D.have<19;)D.lens[I[D.have++]]=0;if(D.lencode=D.lendyn,D.lenbits=7,l={bits:D.lenbits},s=u(0,D.lens,0,19,D.lencode,0,D.work,l),D.lenbits=l.bits,s){c.mr="invalid code lengths set",D.mode=q;break}D.have=0,D.mode=19;case 19:for(;D.have<D.nlen+D.ndist;){for(;o=D.lencode[z&(1<<D.lenbits)-1],d=o>>>24,T=o>>>16&255,b=65535&o,!(d<=S);){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}if(b<16)z>>>=d,S-=d,D.lens[D.have++]=b;else{if(16===b){for(F=d+2;S<F;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}if(z>>>=d,S-=d,0===D.have){c.mr="invalid bit length repeat",D.mode=q;break}R=D.lens[D.have-1],L=3+(3&z),z>>>=2,S-=2}else if(17===b){for(F=d+3;S<F;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}z>>>=d,S-=d,R=0,L=3+(7&z),z>>>=3,S-=3}else{for(F=d+7;S<F;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}z>>>=d,S-=d,R=0,L=11+(127&z),z>>>=7,S-=7}if(D.have+L>D.nlen+D.ndist){c.mr="invalid bit length repeat",D.mode=q;break}for(;L--;)D.lens[D.have++]=R}}if(D.mode===q)break;if(0===D.lens[256]){c.mr="invalid code -- missing end-of-block",D.mode=q;break}if(D.lenbits=9,l={bits:D.lenbits},s=u(1,D.lens,0,D.nlen,D.lencode,0,D.work,l),D.lenbits=l.bits,s){c.mr="invalid literal/lengths set",D.mode=q;break}if(D.distbits=6,D.distcode=D.distdyn,l={bits:D.distbits},s=u(2,D.lens,D.nlen,D.ndist,D.distcode,0,D.work,l),D.distbits=l.bits,s){c.mr="invalid distances set",D.mode=q;break}if(D.mode=20,r===x)break c;case 20:D.mode=21;case 21:if(N>=6&&g>=258){c.next_out=U,c.avail_out=g,c.next_in=y,c.avail_in=N,D.hold=z,D.bits=S,t(c,h),U=c.next_out,e=c.output,g=c.avail_out,y=c.next_in,X=c.input,N=c.avail_in,z=D.hold,S=D.bits,D.mode===J&&(D.back=-1);break}for(D.back=0;o=D.lencode[z&(1<<D.lenbits)-1],d=o>>>24,T=o>>>16&255,b=65535&o,!(d<=S);){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}if(T&&0===(240&T)){for(O=d,C=T,p=b;o=D.lencode[p+((z&(1<<O+C)-1)>>O)],d=o>>>24,T=o>>>16&255,b=65535&o,!(O+d<=S);){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}z>>>=O,S-=O,D.back+=O}if(z>>>=d,S-=d,D.back+=d,D.length=b,0===T){D.mode=26;break}if(32&T){D.back=-1,D.mode=J;break}if(64&T){c.mr="invalid literal/length code",D.mode=q;break}D.extra=15&T,D.mode=22;case 22:if(D.extra){for(F=D.extra;S<F;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}D.length+=z&(1<<D.extra)-1,z>>>=D.extra,S-=D.extra,D.back+=D.extra}D.was=D.length,D.mode=23;case 23:for(;o=D.distcode[z&(1<<D.distbits)-1],d=o>>>24,T=o>>>16&255,b=65535&o,!(d<=S);){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}if(0===(240&T)){for(O=d,C=T,p=b;o=D.distcode[p+((z&(1<<O+C)-1)>>O)],d=o>>>24,T=o>>>16&255,b=65535&o,!(O+d<=S);){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}z>>>=O,S-=O,D.back+=O}if(z>>>=d,S-=d,D.back+=d,64&T){c.mr="invalid distance code",D.mode=q;break}D.offset=b,D.extra=15&T,D.mode=24;case 24:if(D.extra){for(F=D.extra;S<F;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}D.offset+=z&(1<<D.extra)-1,z>>>=D.extra,S-=D.extra,D.back+=D.extra}if(D.offset>D.dmax){c.mr="invalid distance too far back",D.mode=q;break}D.mode=25;case 25:if(0===g)break c;if(L=h-g,D.offset>L){if(L=D.offset-L,L>D.whave&&D.sane){c.mr="invalid distance too far back",D.mode=q;break}L>D.wnext?(L-=D.wnext,P=D.wsize-L):P=D.wnext-L,L>D.length&&(L=D.length),G=D.window}else G=e,P=U-D.offset,L=D.length;L>g&&(L=g),g-=L,D.length-=L;do{e[U++]=G[P++]}while(--L);0===D.length&&(D.mode=21);break;case 26:if(0===g)break c;e[U++]=D.length,g--,D.mode=21;break;case 27:if(D.wrap){for(;S<32;){if(0===N)break c;N--,z|=X[y++]<<S,S+=8}if(h-=g,c.total_out+=h,D.total+=h,h&&(c.adler=D.check=D.flags?B(D.check,e,h,U-h):W(D.check,e,h,U-h)),h=g,(D.flags?z:j(z))!==D.check){c.mr="incorrect data check",D.mode=q;break}z=0,S=0}D.mode=28;case 28:if(D.wrap&&D.flags){for(;S<32;){if(0===N)break c;N--,z+=X[y++]<<S,S+=8}if(z!==(4294967295&D.total)){c.mr="incorrect length check",D.mode=q;break}z=0,S=0}D.mode=29;case 29:s=E;break c;case q:s=v;break c;case 31:return k;default:return Y}return c.next_out=U,c.avail_out=g,c.next_in=y,c.avail_in=N,D.hold=z,D.bits=S,(D.wsize||h!==c.avail_out&&D.mode<q&&(D.mode<27||r!==a))&&f(c,c.output,c.next_out,h-c.avail_out)?(D.mode=31,k):(A-=c.avail_in,h-=c.avail_out,c.total_in+=A,c.total_out+=h,D.total+=h,D.wrap&&h&&(c.adler=D.check=D.flags?B(D.check,e,h,c.next_out-h):W(D.check,e,h,c.next_out-h)),c.data_type=D.bits+(D.last?64:0)+(D.mode===J?128:0)+(20===D.mode||15===D.mode?256:0),(0===A&&0===h||r===a)&&s===M&&(s=w),s)},c.exports.inflateEnd=c=>{if(!c||!c.state)return Y;let r=c.state;return r.window&&(r.window=null),c.state=null,M},c.exports.inflateGetHeader=(c,r)=>{if(!c||!c.state)return Y;const D=c.state;return 0===(2&D.wrap)?Y:(D.head=r,r.done=!1,M)},c.exports.inflateSetDictionary=(c,r)=>{const D=r.length;let B,t,u;return c&&c.state?(B=c.state,0!==B.wrap&&11!==B.mode?Y:11===B.mode&&(t=1,t=W(t,r,D,0),t!==B.check)?v:(u=f(c,r,D,D),u?(B.mode=31,k):(B.havedict=1,M))):Y},c.exports.inflateInfo="pako inflate (from Nodeca project)"},12882:c=>{"use strict";const r=15,D=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),W=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),B=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),t=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);c.exports=(c,u,a,H,x,M,E,m)=>{const Y=m.bits;let v,k,w,Z,J,q,j=0,X=0,e=0,y=0,U=0,N=0,g=0,z=0,S=0,K=0,f=null,A=0;const h=new Uint16Array(16),L=new Uint16Array(16);let P,G,d,T=null,b=0;for(j=0;j<=r;j++)h[j]=0;for(X=0;X<H;X++)h[u[a+X]]++;for(U=Y,y=r;y>=1&&0===h[y];y--);if(U>y&&(U=y),0===y)return x[M++]=20971520,x[M++]=20971520,m.bits=1,0;for(e=1;e<y&&0===h[e];e++);for(U<e&&(U=e),z=1,j=1;j<=r;j++)if(z<<=1,z-=h[j],z<0)return-1;if(z>0&&(0===c||1!==y))return-1;for(L[1]=0,j=1;j<r;j++)L[j+1]=L[j]+h[j];for(X=0;X<H;X++)0!==u[a+X]&&(E[L[u[a+X]]++]=X);if(0===c?(f=T=E,q=19):1===c?(f=D,A-=257,T=W,b-=257,q=256):(f=B,T=t,q=-1),K=0,X=0,j=e,J=M,N=U,g=0,w=-1,S=1<<U,Z=S-1,1===c&&S>852||2===c&&S>592)return 1;for(;;){P=j-g,E[X]<q?(G=0,d=E[X]):E[X]>q?(G=T[b+E[X]],d=f[A+E[X]]):(G=96,d=0),v=1<<j-g,k=1<<N,e=k;do{k-=v,x[J+(K>>g)+k]=P<<24|G<<16|d}while(0!==k);for(v=1<<j-1;K&v;)v>>=1;if(0!==v?(K&=v-1,K+=v):K=0,X++,0===--h[j]){if(j===y)break;j=u[a+E[X]]}if(j>U&&(K&Z)!==w){for(0===g&&(g=U),J+=e,N=j-g,z=1<<N;N+g<y&&(z-=h[N+g],!(z<=0));)N++,z<<=1;if(S+=1<<N,1===c&&S>852||2===c&&S>592)return 1;w=K&Z,x[w]=U<<24|N<<16|J-M}}return 0!==K&&(x[J+K]=j-g<<24|64<<16),m.bits=U,0}},12835:c=>{"use strict";c.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12819:c=>{"use strict";function r(c){let r=c.length;for(;--r>=0;)c[r]=0}const D=256,W=286,B=30,t=15,u=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),H=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),x=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),M=new Array(576);r(M);const E=new Array(60);r(E);const m=new Array(512);r(m);const Y=new Array(256);r(Y);const v=new Array(29);r(v);const k=new Array(B);function w(c,r,D,W,B){this.static_tree=c,this.extra_bits=r,this.extra_base=D,this.elems=W,this.max_length=B,this.has_stree=c&&c.length}let Z,J,q;function j(c,r){this.dyn_tree=c,this.max_code=0,this.stat_desc=r}r(k);const X=c=>c<256?m[c]:m[256+(c>>>7)],e=(c,r)=>{c.pending_buf[c.pending++]=255&r,c.pending_buf[c.pending++]=r>>>8&255},y=(c,r,D)=>{c.bi_valid>16-D?(c.bi_buf|=r<<c.bi_valid&65535,e(c,c.bi_buf),c.bi_buf=r>>16-c.bi_valid,c.bi_valid+=D-16):(c.bi_buf|=r<<c.bi_valid&65535,c.bi_valid+=D)},U=(c,r,D)=>{y(c,D[2*r],D[2*r+1])},N=(c,r)=>{let D=0;do{D|=1&c,c>>>=1,D<<=1}while(--r>0);return D>>>1},g=(c,r,D)=>{const W=new Array(16);let B,u,a=0;for(B=1;B<=t;B++)W[B]=a=a+D[B-1]<<1;for(u=0;u<=r;u++){let r=c[2*u+1];0!==r&&(c[2*u]=N(W[r]++,r))}},z=c=>{let r;for(r=0;r<W;r++)c.dyn_ltree[2*r]=0;for(r=0;r<B;r++)c.dyn_dtree[2*r]=0;for(r=0;r<19;r++)c.bl_tree[2*r]=0;c.dyn_ltree[512]=1,c.opt_len=c.static_len=0,c.last_lit=c.matches=0},S=c=>{c.bi_valid>8?e(c,c.bi_buf):c.bi_valid>0&&(c.pending_buf[c.pending++]=c.bi_buf),c.bi_buf=0,c.bi_valid=0},K=(c,r,D,W)=>{const B=2*r,t=2*D;return c[B]<c[t]||c[B]===c[t]&&W[r]<=W[D]},f=(c,r,D)=>{const W=c.heap[D];let B=D<<1;for(;B<=c.heap_len&&(B<c.heap_len&&K(r,c.heap[B+1],c.heap[B],c.depth)&&B++,!K(r,W,c.heap[B],c.depth));)c.heap[D]=c.heap[B],D=B,B<<=1;c.heap[D]=W},A=(c,r,W)=>{let B,t,H,x,M=0;if(0!==c.last_lit)do{B=c.pending_buf[c.d_buf+2*M]<<8|c.pending_buf[c.d_buf+2*M+1],t=c.pending_buf[c.l_buf+M],M++,0===B?U(c,t,r):(H=Y[t],U(c,H+D+1,r),x=u[H],0!==x&&(t-=v[H],y(c,t,x)),B--,H=X(B),U(c,H,W),x=a[H],0!==x&&(B-=k[H],y(c,B,x)))}while(M<c.last_lit);U(c,256,r)},h=(c,r)=>{const D=r.dyn_tree,W=r.stat_desc.static_tree,B=r.stat_desc.has_stree,u=r.stat_desc.elems;let a,H,x,M=-1;for(c.heap_len=0,c.heap_max=573,a=0;a<u;a++)0!==D[2*a]?(c.heap[++c.heap_len]=M=a,c.depth[a]=0):D[2*a+1]=0;for(;c.heap_len<2;)x=c.heap[++c.heap_len]=M<2?++M:0,D[2*x]=1,c.depth[x]=0,c.opt_len--,B&&(c.static_len-=W[2*x+1]);for(r.max_code=M,a=c.heap_len>>1;a>=1;a--)f(c,D,a);x=u;do{a=c.heap[1],c.heap[1]=c.heap[c.heap_len--],f(c,D,1),H=c.heap[1],c.heap[--c.heap_max]=a,c.heap[--c.heap_max]=H,D[2*x]=D[2*a]+D[2*H],c.depth[x]=(c.depth[a]>=c.depth[H]?c.depth[a]:c.depth[H])+1,D[2*a+1]=D[2*H+1]=x,c.heap[1]=x++,f(c,D,1)}while(c.heap_len>=2);c.heap[--c.heap_max]=c.heap[1],((c,r)=>{const D=r.dyn_tree,W=r.max_code,B=r.stat_desc.static_tree,u=r.stat_desc.has_stree,a=r.stat_desc.extra_bits,H=r.stat_desc.extra_base,x=r.stat_desc.max_length;let M,E,m,Y,v,k,w=0;for(Y=0;Y<=t;Y++)c.bl_count[Y]=0;for(D[2*c.heap[c.heap_max]+1]=0,M=c.heap_max+1;M<573;M++)E=c.heap[M],Y=D[2*D[2*E+1]+1]+1,Y>x&&(Y=x,w++),D[2*E+1]=Y,E>W||(c.bl_count[Y]++,v=0,E>=H&&(v=a[E-H]),k=D[2*E],c.opt_len+=k*(Y+v),u&&(c.static_len+=k*(B[2*E+1]+v)));if(0!==w){do{for(Y=x-1;0===c.bl_count[Y];)Y--;c.bl_count[Y]--,c.bl_count[Y+1]+=2,c.bl_count[x]--,w-=2}while(w>0);for(Y=x;0!==Y;Y--)for(E=c.bl_count[Y];0!==E;)m=c.heap[--M],m>W||(D[2*m+1]!==Y&&(c.opt_len+=(Y-D[2*m+1])*D[2*m],D[2*m+1]=Y),E--)}})(c,r),g(D,M,c.bl_count)},L=(c,r,D)=>{let W,B,t=-1,u=r[1],a=0,H=7,x=4;for(0===u&&(H=138,x=3),r[2*(D+1)+1]=65535,W=0;W<=D;W++)B=u,u=r[2*(W+1)+1],++a<H&&B===u||(a<x?c.bl_tree[2*B]+=a:0!==B?(B!==t&&c.bl_tree[2*B]++,c.bl_tree[32]++):a<=10?c.bl_tree[34]++:c.bl_tree[36]++,a=0,t=B,0===u?(H=138,x=3):B===u?(H=6,x=3):(H=7,x=4))},P=(c,r,D)=>{let W,B,t=-1,u=r[1],a=0,H=7,x=4;for(0===u&&(H=138,x=3),W=0;W<=D;W++)if(B=u,u=r[2*(W+1)+1],!(++a<H&&B===u)){if(a<x)do{U(c,B,c.bl_tree)}while(0!==--a);else 0!==B?(B!==t&&(U(c,B,c.bl_tree),a--),U(c,16,c.bl_tree),y(c,a-3,2)):a<=10?(U(c,17,c.bl_tree),y(c,a-3,3)):(U(c,18,c.bl_tree),y(c,a-11,7));a=0,t=B,0===u?(H=138,x=3):B===u?(H=6,x=3):(H=7,x=4)}};let G=!1;const d=(c,r,D,W)=>{y(c,0+(W?1:0),3),((c,r,D,W)=>{S(c),W&&(e(c,D),e(c,~D)),c.pending_buf.set(c.window.subarray(r,r+D),c.pending),c.pending+=D})(c,r,D,!0)};c.exports._tr_init=c=>{G||((()=>{let c,r,D,x,j;const X=new Array(16);for(D=0,x=0;x<28;x++)for(v[x]=D,c=0;c<1<<u[x];c++)Y[D++]=x;for(Y[D-1]=x,j=0,x=0;x<16;x++)for(k[x]=j,c=0;c<1<<a[x];c++)m[j++]=x;for(j>>=7;x<B;x++)for(k[x]=j<<7,c=0;c<1<<a[x]-7;c++)m[256+j++]=x;for(r=0;r<=t;r++)X[r]=0;for(c=0;c<=143;)M[2*c+1]=8,c++,X[8]++;for(;c<=255;)M[2*c+1]=9,c++,X[9]++;for(;c<=279;)M[2*c+1]=7,c++,X[7]++;for(;c<=287;)M[2*c+1]=8,c++,X[8]++;for(g(M,287,X),c=0;c<B;c++)E[2*c+1]=5,E[2*c]=N(c,5);Z=new w(M,u,257,W,t),J=new w(E,a,0,B,t),q=new w(new Array(0),H,0,19,7)})(),G=!0),c.l_desc=new j(c.dyn_ltree,Z),c.d_desc=new j(c.dyn_dtree,J),c.bl_desc=new j(c.bl_tree,q),c.bi_buf=0,c.bi_valid=0,z(c)},c.exports._tr_stored_block=d,c.exports._tr_flush_block=(c,r,W,B)=>{let t,u,a=0;c.level>0?(2===c.strm.data_type&&(c.strm.data_type=(c=>{let r,W=4093624447;for(r=0;r<=31;r++,W>>>=1)if(1&W&&0!==c.dyn_ltree[2*r])return 0;if(0!==c.dyn_ltree[18]||0!==c.dyn_ltree[20]||0!==c.dyn_ltree[26])return 1;for(r=32;r<D;r++)if(0!==c.dyn_ltree[2*r])return 1;return 0})(c)),h(c,c.l_desc),h(c,c.d_desc),a=(c=>{let r;for(L(c,c.dyn_ltree,c.l_desc.max_code),L(c,c.dyn_dtree,c.d_desc.max_code),h(c,c.bl_desc),r=18;r>=3&&0===c.bl_tree[2*x[r]+1];r--);return c.opt_len+=3*(r+1)+5+5+4,r})(c),t=c.opt_len+3+7>>>3,u=c.static_len+3+7>>>3,u<=t&&(t=u)):t=u=W+5,W+4<=t&&-1!==r?d(c,r,W,B):4===c.strategy||u===t?(y(c,2+(B?1:0),3),A(c,M,E)):(y(c,4+(B?1:0),3),((c,r,D,W)=>{let B;for(y(c,r-257,5),y(c,D-1,5),y(c,W-4,4),B=0;B<W;B++)y(c,c.bl_tree[2*x[B]+1],3);P(c,c.dyn_ltree,r-1),P(c,c.dyn_dtree,D-1)})(c,c.l_desc.max_code+1,c.d_desc.max_code+1,a+1),A(c,c.dyn_ltree,c.dyn_dtree)),z(c),B&&S(c)},c.exports._tr_tally=(c,r,W)=>(c.pending_buf[c.d_buf+2*c.last_lit]=r>>>8&255,c.pending_buf[c.d_buf+2*c.last_lit+1]=255&r,c.pending_buf[c.l_buf+c.last_lit]=255&W,c.last_lit++,0===r?c.dyn_ltree[2*W]++:(c.matches++,r--,c.dyn_ltree[2*(Y[W]+D+1)]++,c.dyn_dtree[2*X(r)]++),c.last_lit===c.lit_bufsize-1),c.exports._tr_align=c=>{y(c,2,3),U(c,256,M),(c=>{16===c.bi_valid?(e(c,c.bi_buf),c.bi_buf=0,c.bi_valid=0):c.bi_valid>=8&&(c.pending_buf[c.pending++]=255&c.bi_buf,c.bi_buf>>=8,c.bi_valid-=8)})(c)}},12861:c=>{"use strict";c.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.mr="",this.state=null,this.data_type=2,this.adler=0}},12473:c=>{function r(c,r,D){for(var W=c.length,B=-1/0,t=1/0,u=0;u<W;u++){var a=(D[0][u]-c[u])/r[u],H=(D[1][u]-c[u])/r[u];if(a>H){var x=a;a=H,H=x}if(H<B||a>t)return 1/0;a>B&&(B=a),H<t&&(t=H)}return B>t?1/0:B}c.exports=function(c,D,W,B){var t=r(D,W,B);if(t===1/0)c=null;else{c=c||[];for(var u=0;u<D.length;u++)c[u]=D[u]+W[u]*t}return c},c.exports.distance=r},13873:(c,r,D)=>{"use strict";D.d(r,{b:()=>u});var W=D(31);const B=W.useLayoutEffect;const t=function(c){var r=(0,W.useRef)(c);return B((function(){r.current=c})),r};var u=function(c){var r=t(c);(0,W.Hr)((function(){var c=function(c){var D;if(null!=r.current&&(D=r.current(c)),c.defaultPrevented&&(c.returnValue=""),"string"===typeof D)return c.returnValue=D,D};return window.addEventListener("beforeunload",c),function(){window.removeEventListener("beforeunload",c)}}),[])}},13813:(c,r,D)=>{"use strict";var W=D(13818),B=Array.prototype.concat,t=Array.prototype.slice,u=c.exports=function(c){for(var r=[],D=0,u=c.length;D<u;D++){var a=c[D];W(a)?r=B.call(r,t.call(a)):r.push(a)}return r};u.wrap=function(c){return function(){return c(u(arguments))}}},13818:c=>{c.exports=function(c){return!(!c||"string"===typeof c)&&(c instanceof Array||Array.isArray(c)||c.length>=0&&(c.splice instanceof Function||Object.getOwnPropertyDescriptor(c,c.length-1)&&"String"!==c.constructor.name))}},12759:(c,r,D)=>{var W=D(12765);function B(c){for(var r,D,B=0,t=c.length,u=0;u<c.length;){for(r=c[u],D=0;u<t&&c[u]===r;)++u,++D;B+=W.log2(D)/7|0,B+=W.log2(r>>>0)/7|0,B+=2}return B}r.size=B,r.encode=function(c,r){r||(r=new Uint8Array(B(c)));for(var D,W,t=0,u=r.length,a=0;a<c.length;){for(D=c[a],W=0;a<c.length&&c[a]===D;)++a,++W;for(;t<u&&W>=128;)r[t++]=128+(127&W),W>>>=7;if(t>=u)throw new Error("RLE buffer overflow");for(r[t++]=W,D>>>=0;t<u&&D>=128;)r[t++]=128+(127&D),D>>>=7;if(t>=u)throw new Error("RLE buffer overflow");r[t++]=D}return r},r.decode=function(c,r){for(var D,W,B,t,u=r.length,a=c.length,H=0,x=0;x<a;){for(D=0,W=0;x<a&&c[x]>=128;)D+=(127&c[x++])<<W,W+=7;if(D+=c[x++]<<W,x>=a)throw new Error("RLE buffer underrun");if(H+D>u)throw new Error("Chunk buffer overflow");for(B=0,W=0;x<a&&c[x]>=128;)B+=(127&c[x++])<<W,W+=7;if(x>=a)throw new Error("RLE buffer underrun");for(B+=c[x++]<<W,t=0;t<D;++t)r[H++]=B}return r}},12765:(c,r)=>{"use strict";function D(c){var r=32;return(c&=-c)&&r--,65535&c&&(r-=16),16711935&c&&(r-=8),252645135&c&&(r-=4),858993459&c&&(r-=2),1431655765&c&&(r-=1),r}r.INT_BITS=32,r.INT_MAX=2147483647,r.INT_MIN=-1<<31,r.sign=function(c){return(c>0)-(c<0)},r.abs=function(c){var r=c>>31;return(c^r)-r},r.min=function(c,r){return r^(c^r)&-(c<r)},r.max=function(c,r){return c^(c^r)&-(c<r)},r.isPow2=function(c){return!(c&c-1)&&!!c},r.log2=function(c){var r,D;return r=(c>65535)<<4,r|=D=((c>>>=r)>255)<<3,r|=D=((c>>>=D)>15)<<2,(r|=D=((c>>>=D)>3)<<1)|(c>>>=D)>>1},r.log10=function(c){return c>=1e9?9:c>=1e8?8:c>=1e7?7:c>=1e6?6:c>=1e5?5:c>=1e4?4:c>=1e3?3:c>=100?2:c>=10?1:0},r.popCount=function(c){return 16843009*((c=(858993459&(c-=c>>>1&1431655765))+(c>>>2&858993459))+(c>>>4)&252645135)>>>24},r.countTrailingZeros=D,r.nextPow2=function(c){return c+=0===c,--c,c|=c>>>1,c|=c>>>2,c|=c>>>4,c|=c>>>8,(c|=c>>>16)+1},r.prevPow2=function(c){return c|=c>>>1,c|=c>>>2,c|=c>>>4,c|=c>>>8,(c|=c>>>16)-(c>>>1)},r.parity=function(c){return c^=c>>>16,c^=c>>>8,c^=c>>>4,27030>>>(c&=15)&1};var W=new Array(256);!function(c){for(var r=0;r<256;++r){var D=r,W=r,B=7;for(D>>>=1;D;D>>>=1)W<<=1,W|=1&D,--B;c[r]=W<<B&255}}(W),r.reverse=function(c){return W[255&c]<<24|W[c>>>8&255]<<16|W[c>>>16&255]<<8|W[c>>>24&255]},r.interleave2=function(c,r){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r&=65535)|r<<8))|r<<4))|r<<2))|r<<1))<<1},r.deinterleave2=function(c,r){return(c=65535&((c=16711935&((c=252645135&((c=858993459&((c=c>>>r&1431655765)|c>>>1))|c>>>2))|c>>>4))|c>>>16))<<16>>16},r.interleave3=function(c,r,D){return c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2),(c|=(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<1)|(D=1227133513&((D=3272356035&((D=251719695&((D=4278190335&((D&=1023)|D<<16))|D<<8))|D<<4))|D<<2))<<2},r.deinterleave3=function(c,r){return(c=1023&((c=4278190335&((c=251719695&((c=3272356035&((c=c>>>r&1227133513)|c>>>2))|c>>>4))|c>>>8))|c>>>16))<<22>>22},r.nextCombination=function(c){var r=c|c-1;return r+1|(~r&-~r)-1>>>D(c)+1}},12787:c=>{"use strict";c.exports=function(c,r,D,W){var B=self||window;try{try{var t;try{t=new B.Blob([c])}catch(x){(t=new(B.BlobBuilder||B.WebKitBlobBuilder||B.MozBlobBuilder||B.MSBlobBuilder)).append(c),t=t.getBlob()}var u=B.URL||B.webkitURL,a=u.createObjectURL(t),H=new B[r](a,D);return u.revokeObjectURL(a),H}catch(x){return new B[r]("data:application/javascript,".concat(encodeURIComponent(c)),D)}}catch(x){if(!W)throw Error("Inline worker is not supported");return new B[r](W,D)}}},12462:(c,r,D)=>{"use strict";function W(c,r,D,W,B){var t={};return Object.keys(W).forEach((function(c){t[c]=W[c]})),t.enumerable=!!t.enumerable,t.configurable=!!t.configurable,("value"in t||t.initializer)&&(t.writable=!0),t=D.slice().reverse().reduce((function(D,W){return W(c,r,D)||D}),t),B&&void 0!==t.initializer&&(t.value=t.initializer?t.initializer.call(B):void 0,t.initializer=void 0),void 0===t.initializer&&(Object.defineProperty(c,r,t),t=null),t}D.d(r,{e:()=>W})},12453:(c,r,D)=>{"use strict";function W(c,r,D,W){D&&Object.defineProperty(c,r,{enumerable:D.enumerable,configurable:D.configurable,writable:D.writable,value:D.initializer?D.initializer.call(W):void 0})}D.d(r,{e:()=>W})},13862:(c,r,D)=>{"use strict";D.d(r,{d:()=>u,g:()=>E,i:()=>a,j:()=>t,n:()=>H,o:()=>B,p:()=>x,t:()=>M});var W=D(11899);class B{constructor(){this._easingMode=B.EASINGMODE_EASEIN}setEasingMode(c){const r=Math.min(Math.max(c,0),2);this._easingMode=r}getEasingMode(){return this._easingMode}easeInCore(c){throw new Error("You must implement this method")}ease(c){switch(this._easingMode){case B.EASINGMODE_EASEIN:return this.easeInCore(c);case B.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-c)}return c>=.5?.5*(1-this.easeInCore(2*(1-c)))+.5:.5*this.easeInCore(2*c)}}B.EASINGMODE_EASEIN=0,B.EASINGMODE_EASEOUT=1,B.EASINGMODE_EASEINOUT=2;class t extends B{easeInCore(c){return c=Math.max(0,Math.min(1,c)),1-Math.sqrt(1-c*c)}}class u extends B{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=c}easeInCore(c){const r=Math.max(0,this.amplitude);return Math.pow(c,3)-c*r*Math.sin(3.141592653589793*c)}}class a extends B{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=c,this.bounciness=r}easeInCore(c){const r=Math.max(0,this.bounces);let D=this.bounciness;D<=1&&(D=1.001);const W=Math.pow(D,r),B=1-D,t=(1-W)/B+.5*W,u=c*t,a=Math.log(-u*(1-D)+1)/Math.log(D),H=Math.floor(a),x=H+1,M=(1-Math.pow(D,H))/(B*t),E=.5*(M+(1-Math.pow(D,x))/(B*t)),m=c-E,Y=E-M;return-Math.pow(1/D,r-H)/(Y*Y)*(m-Y)*(m+Y)}}class H extends B{easeInCore(c){return c*c*c}}class x extends B{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=c,this.springiness=r}easeInCore(c){let r;const D=Math.max(0,this.oscillations),W=Math.max(0,this.springiness);return r=0==W?c:(Math.exp(W*c)-1)/(Math.exp(W)-1),r*Math.sin((6.283185307179586*D+1.5707963267948966)*c)}}class M extends B{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=c}easeInCore(c){return this.exponent<=0?c:(Math.exp(this.exponent*c)-1)/(Math.exp(this.exponent)-1)}}class E extends B{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=c,this.y1=r,this.x2=D,this.y2=W}easeInCore(c){return W.c.Interpolate(c,this.x1,this.y1,this.x2,this.y2)}}},13318:(c,r,D)=>{"use strict";D.d(r,{c:()=>u});var W=D(11683),B=D(11694),t=D(12102);class u extends t.c{get _matrix(){return this._compose(),this.Nm}set _matrix(c){(c.updateFlag!==this.Nm.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Nm.t(c),this._markAsDirtyAndDecompose())}constructor(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(c,r.yc(),!1),this.name=c,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=r,this.Nm=(null===B||void 0===B?void 0:B.clone())??W.Matrix.Identity(),this._restMatrix=t??this.Nm.clone(),this._bindMatrix=u??this.Nm.clone(),this._index=a,this._absoluteMatrix=new W.Matrix,this._absoluteBindMatrix=new W.Matrix,this._absoluteInverseBindMatrix=new W.Matrix,this._finalMatrix=new W.Matrix,r.bones.push(this),this.setParent(D,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(c){this.setParent(c)}setParent(c){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==c){if(this.parent){const c=this.parent.children.indexOf(this);-1!==c&&this.parent.children.splice(c,1)}this._parentNode=c,this.parent&&this.parent.children.push(this),r&&this._updateAbsoluteBindMatrices(),this.Qx()}}getLocalMatrix(){return this._compose(),this.Nm}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(c){this._restMatrix.t(c)}setRestPose(c){this.setRestMatrix(c)}getBindPose(){return this.getBindMatrix()}setBindMatrix(c){this.Ya(c)}setBindPose(c){this.setBindMatrix(c)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const c=W.TmpVectors.Zr[0],r=W.TmpVectors.Quaternion[0],D=W.TmpVectors.Zr[1];this.getRestMatrix().decompose(c,r,D),this._linkedTransformNode.position.t(D),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??W.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.t(r),this._linkedTransformNode.qa.t(c)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(c){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=c,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.sa}set position(c){this._decompose(),this.sa.t(c),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(c){this.setRotation(c)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(c){this.setRotationQuaternion(c)}get qa(){return this.getScale()}set qa(c){this.setScale(c)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=W.Zr.Zero(),this._localRotation=W.Quaternion.Zero(),this.sa=W.Zr.Zero()),this.Nm.decompose(this._localScaling,this._localRotation,this.sa))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,W.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.sa,this.Nm)):this._needToCompose=!1)}Ya(c){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.t(c),r&&this._updateAbsoluteBindMatrices(),D?this._matrix=c:this.Qx()}_updateAbsoluteBindMatrices(c){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(c||(c=this._bindMatrix),this.parent?c.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.t(c),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),r)for(let D=0;D<this.children.length;D++)this.children[D]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Qx(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Qx(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Qx(),this._needToDecompose=!0}_updatePosition(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0,B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const t=this.getLocalMatrix();if(0==r)B?(t.addAtIndex(12,c.x),t.addAtIndex(13,c.y),t.addAtIndex(14,c.z)):t.setTranslationFromFloats(c.x,c.y,c.z);else{let r=null;D&&(r=D.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const a=u._TmpMats[0],H=u._TmpVecs[0];this.parent?D&&r?(a.t(this.parent.getAbsoluteMatrix()),a.multiplyToRef(r,a)):a.t(this.parent.getAbsoluteMatrix()):W.Matrix.IdentityToRef(a),B&&a.setTranslationFromFloats(0,0,0),a.invert(),W.Zr.TransformCoordinatesToRef(c,a,H),B?(t.addAtIndex(12,H.x),t.addAtIndex(13,H.y),t.addAtIndex(14,H.z)):t.setTranslationFromFloats(H.x,H.y,H.z)}this._markAsDirtyAndDecompose()}translate(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;this._updatePosition(c,r,D,!0)}setPosition(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;this._updatePosition(c,r,D,!1)}setAbsolutePosition(c,r){this.setPosition(c,1,r)}scale(c,r,D){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const t=this.getLocalMatrix(),a=u._TmpMats[0];W.Matrix.ScalingToRef(c,r,D,a),a.multiplyToRef(t,t),a.invert();for(const W of this.children){const B=W.getLocalMatrix();B.multiplyToRef(a,B),B.multiplyAtIndex(12,c),B.multiplyAtIndex(13,r),B.multiplyAtIndex(14,D),W._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),B)for(const W of this.children)W.scale(c,r,D,B)}setScale(c){this._decompose(),this._localScaling.t(c),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(c){this._decompose(),c.t(this._localScaling)}setYawPitchRoll(c,r,D){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4?arguments[4]:void 0;if(0===B){const a=u._TmpQuat;return W.Quaternion.RotationYawPitchRollToRef(c,r,D,a),void this.setRotationQuaternion(a,B,t)}const a=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,t))return;const H=u._TmpMats[1];W.Matrix.RotationYawPitchRollToRef(c,r,D,H),a.multiplyToRef(H,H),this._rotateWithMatrix(H,B,t)}rotate(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3?arguments[3]:void 0;const t=u._TmpMats[0];t.setTranslationFromFloats(0,0,0),W.Matrix.RotationAxisToRef(c,r,t),this._rotateWithMatrix(t,D,B)}setAxisAngle(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3?arguments[3]:void 0;if(0===D){const t=u._TmpQuat;return W.Quaternion.RotationAxisToRef(c,r,t),void this.setRotationQuaternion(t,D,B)}const t=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,B))return;const a=u._TmpMats[1];W.Matrix.RotationAxisToRef(c,r,a),t.multiplyToRef(a,a),this._rotateWithMatrix(a,D,B)}setRotation(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(c.y,c.x,c.z,r,D)}setRotationQuaternion(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;if(0===r)return this._decompose(),this._localRotation.t(c),void this._markAsDirtyAndCompose();const B=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,D))return;const t=u._TmpMats[1];W.Matrix.FromQuaternionToRef(c,t),B.multiplyToRef(t,t),this._rotateWithMatrix(t,r,D)}setRotationMatrix(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;if(0===r){const B=u._TmpQuat;return W.Quaternion.FromRotationMatrixToRef(c,B),void this.setRotationQuaternion(B,r,D)}const B=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(B,D))return;const t=u._TmpMats[1];t.t(c),B.multiplyToRef(c,t),this._rotateWithMatrix(t,r,D)}_rotateWithMatrix(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;const W=this.getLocalMatrix(),B=W.m[12],t=W.m[13],a=W.m[14],H=this.getParent(),x=u._TmpMats[3],M=u._TmpMats[4];H&&1==r?(D?(x.t(D.getWorldMatrix()),H.getAbsoluteMatrix().multiplyToRef(x,x)):x.t(H.getAbsoluteMatrix()),M.t(x),M.invert(),W.multiplyToRef(x,W),W.multiplyToRef(c,W),W.multiplyToRef(M,W)):1==r&&D?(x.t(D.getWorldMatrix()),M.t(x),M.invert(),W.multiplyToRef(x,W),W.multiplyToRef(c,W),W.multiplyToRef(M,W)):W.multiplyToRef(c,W),W.setTranslationFromFloats(B,t,a),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(c,r){const D=u._TmpMats[2];return c.t(this.getAbsoluteMatrix()),r?(c.multiplyToRef(r.getWorldMatrix(),c),W.Matrix.ScalingToRef(r.qa.x,r.qa.y,r.qa.z,D)):W.Matrix.IdentityToRef(D),c.invert(),!isNaN(c.m[0])&&(D.multiplyAtIndex(0,this._scalingDeterminant),c.multiplyToRef(D,c),!0)}CD(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=W.Zr.Zero();return this.getPositionToRef(c,r,D),D}getPositionToRef(){let c=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const c=this.getLocalMatrix();r.x=c.m[12],r.y=c.m[13],r.z=c.m[14]}else{let D=null;c&&(D=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let W=u._TmpMats[0];c&&D?(W.t(this.getAbsoluteMatrix()),W.multiplyToRef(D,W)):W=this.getAbsoluteMatrix(),r.x=W.m[12],r.y=W.m[13],r.z=W.m[14]}}getAbsolutePosition(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const r=W.Zr.Zero();return this.getPositionToRef(1,c,r),r}getAbsolutePositionToRef(c,r){this.getPositionToRef(1,c,r)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Nm.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.t(this.Nm);const c=this._skeleton.getPoseMatrix();c&&this._absoluteMatrix.multiplyToRef(c,this._absoluteMatrix)}const c=this.children,r=c.length;for(let D=0;D<r;D++)c[D].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}JH(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=W.Zr.Zero();return this.getDirectionToRef(c,r,D),D}getDirectionToRef(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0,B=null;r&&(B=r.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=u._TmpMats[0];t.t(this.getAbsoluteMatrix()),r&&B&&t.multiplyToRef(B,t),W.Zr.TransformNormalToRef(c,t,D),D.normalize()}getRotation(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=W.Zr.Zero();return this.getRotationToRef(c,r,D),D}getRotationToRef(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0;const W=u._TmpQuat;this.getRotationQuaternionToRef(c,r,W),W.toEulerAnglesToRef(D)}getRotationQuaternion(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=W.Quaternion.Identity();return this.getRotationQuaternionToRef(c,r,D),D}getRotationQuaternionToRef(){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),r.t(this._localRotation);else{const D=u._TmpMats[0],W=this.getAbsoluteMatrix();c?W.multiplyToRef(c.getWorldMatrix(),D):D.t(W),D.multiplyAtIndex(0,this._scalingDeterminant),D.multiplyAtIndex(1,this._scalingDeterminant),D.multiplyAtIndex(2,this._scalingDeterminant),D.decompose(void 0,r,void 0)}}getRotationMatrix(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1?arguments[1]:void 0;const D=W.Matrix.Identity();return this.getRotationMatrixToRef(c,r,D),D}getRotationMatrixToRef(){let c=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(r);else{const D=u._TmpMats[0],W=this.getAbsoluteMatrix();c?W.multiplyToRef(c.getWorldMatrix(),D):D.t(W),D.multiplyAtIndex(0,this._scalingDeterminant),D.multiplyAtIndex(1,this._scalingDeterminant),D.multiplyAtIndex(2,this._scalingDeterminant),D.getRotationMatrixToRef(r)}}getAbsolutePositionFromLocal(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=W.Zr.Zero();return this.getAbsolutePositionFromLocalToRef(c,r,D),D}getAbsolutePositionFromLocalToRef(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0,B=null;r&&(B=r.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=u._TmpMats[0];t.t(this.getAbsoluteMatrix()),r&&B&&t.multiplyToRef(B,t),W.Zr.TransformCoordinatesToRef(c,t,D)}getLocalPositionFromAbsolute(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=W.Zr.Zero();return this.getLocalPositionFromAbsoluteToRef(c,r,D),D}getLocalPositionFromAbsoluteToRef(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0,B=null;r&&(B=r.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=u._TmpMats[0];t.t(this.getAbsoluteMatrix()),r&&B&&t.multiplyToRef(B,t),t.invert(),W.Zr.TransformCoordinatesToRef(c,t,D)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const c=this._skeleton.bones.indexOf(this);if(-1!==c&&this._skeleton.bones.splice(c,1),this._parentNode&&this._parentNode.children){const c=this._parentNode.children,r=c.indexOf(this);-1!==r&&c.splice(r,1)}super.dispose()}}u._TmpVecs=(0,B.d)(2,W.Zr.Zero),u._TmpQuat=W.Quaternion.Identity(),u._TmpMats=(0,B.d)(5,W.Matrix.Identity)},13856:(c,r,D)=>{"use strict";D.d(r,{d:()=>h});var W=D(11664),B=D(11669),t=D(11494),u=D(11683),a=D(11696),H=D(12102),x=D(12135),M=D(11966),E=D(11517),m=D(11687);class Y{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(c){this._zoomStopsAnimation=c}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(c){this._idleRotationSpeed=c}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(c){this._idleRotationWaitTime=c}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(c){this._idleRotationSpinupTime=c}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(c){this._attachedCamera=c;const r=this._attachedCamera.yc();this._onPrePointerObservableObserver=r.onPrePointerObservable.add((c=>{c.type!==M.c.POINTERDOWN?c.type===M.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=c.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const c=E.e.Now;let r=0;null!=this._lastFrameTime&&(r=c-this._lastFrameTime),this._lastFrameTime=c,this._applyUserInteraction();const D=c-this._lastInteractionTime-this._idleRotationWaitTime,W=Math.max(Math.min(D/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*W,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(r/1e3))}))}detach(){if(!this._attachedCamera)return;const c=this._attachedCamera.yc();this._onPrePointerObservableObserver&&c.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(c){this._lastInteractionTime=c??E.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<m.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let c=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(c=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?c:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=E.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var v=D(13862),k=D(12202);class w{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(c){if(this._autoTransitionRange===c)return;this._autoTransitionRange=c;const r=this._attachedCamera;r&&(c?this._onMeshTargetChangedObserver=r.onMeshTargetChangedObservable.add((c=>{if(c&&(c.va(!0),c.getBoundingInfo)){const r=c.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*r,this.upperRadiusTransitionRange=.05*r}})):this._onMeshTargetChangedObserver&&r.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(c){this._attachedCamera=c,this._onAfterCheckInputsObserver=c.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(c){return!!this._attachedCamera&&(this._attachedCamera.radius===c&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(c){if(!this._attachedCamera)return;this._radiusBounceTransition||(w.EasingFunction.setEasingMode(w.EasingMode),this._radiusBounceTransition=k.b.CreateAnimation("radius",k.b.ANIMATIONTYPE_FLOAT,60,w.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const r=k.b.TransitionTo("radius",this._attachedCamera.radius+c,this._attachedCamera,this._attachedCamera.yc(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));r&&this._animatables.push(r)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}w.EasingFunction=new v.d(.3),w.EasingMode=v.o.EASINGMODE_EASEOUT;class Z{constructor(){this.onTargetFramingAnimationEndObservable=new t.c,this._mode=Z.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(c){this._mode=c}get mode(){return this._mode}set radiusScale(c){this._radiusScale=c}get radiusScale(){return this._radiusScale}set positionScale(c){this._positionScale=c}get positionScale(){return this._positionScale}set defaultElevation(c){this._defaultElevation=c}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(c){this._elevationReturnTime=c}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(c){this._elevationReturnWaitTime=c}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(c){this._zoomStopsAnimation=c}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(c){this._framingTime=c}get framingTime(){return this._framingTime}init(){}attach(c){this._attachedCamera=c;const r=this._attachedCamera.yc();Z.EasingFunction.setEasingMode(Z.EasingMode),this._onPrePointerObservableObserver=r.onPrePointerObservable.add((c=>{c.type!==M.c.POINTERDOWN?c.type===M.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=c.onMeshTargetChangedObservable.add((c=>{c&&c.getBoundingInfo&&this.zoomOnMesh(c,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=c.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const c=this._attachedCamera.yc();this._onPrePointerObservableObserver&&c.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;c.va(!0);const W=c.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(W.minimumWorld,W.maximumWorld,r,D)}zoomOnMeshHierarchy(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;c.va(!0);const W=c.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(W.min,W.max,r,D)}zoomOnMeshesHierarchy(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=new u.Zr(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),B=new u.Zr(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let t=0;t<c.length;t++){const r=c[t].getHierarchyBoundingVectors(!0);u.Zr.CheckExtends(r.min,W,B),u.Zr.CheckExtends(r.max,W,B)}this.zoomOnBoundingInfo(W,B,r,D)}zoomOnBoundingInfo(c,r){let D,W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const t=c.y,a=t+(r.y-t)*this._positionScale,H=r.Jr(c).scale(.5);if(!isFinite(a))return!1;if(W)D=new u.Zr(0,a,0);else{const r=c.add(H);D=new u.Zr(r.x,a,r.z)}this._vectorTransition||(this._vectorTransition=k.b.CreateAnimation("target",k.b.ANIMATIONTYPE_VECTOR3,60,Z.EasingFunction)),this._betaIsAnimating=!0;let x=k.b.TransitionTo("target",D,this._attachedCamera,this._attachedCamera.yc(),60,this._vectorTransition,this._framingTime);x&&this._animatables.push(x);let M=0;if(this._mode===Z.FitFrustumSidesMode){const D=this._calculateLowerRadiusFromModelBoundingSphere(c,r);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=H.length()+this._attachedCamera.ma),M=D}else this._mode===Z.IgnoreBoundsSizeMode&&(M=this._calculateLowerRadiusFromModelBoundingSphere(c,r),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ma));if(this.autoCorrectCameraLimitsAndSensibility){const D=r.Jr(c).length();this._attachedCamera.panningSensibility=5e3/D,this._attachedCamera.wheelPrecision=100/M}return this._radiusTransition||(this._radiusTransition=k.b.CreateAnimation("radius",k.b.ANIMATIONTYPE_FLOAT,60,Z.EasingFunction)),x=k.b.TransitionTo("radius",M,this._attachedCamera,this._attachedCamera.yc(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),B&&B(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),x&&this._animatables.push(x),!0}_calculateLowerRadiusFromModelBoundingSphere(c,r){const D=this._attachedCamera;if(!D)return 0;let W=D._calculateLowerRadiusFromModelBoundingSphere(c,r,this._radiusScale);return D.lowerRadiusLimit&&this._mode===Z.IgnoreBoundsSizeMode&&(W=W<D.lowerRadiusLimit?D.lowerRadiusLimit:W),D.upperRadiusLimit&&(W=W>D.upperRadiusLimit?D.upperRadiusLimit:W),W}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const c=E.e.Now-this._lastInteractionTime,r=.5*Math.PI-this._defaultElevation,D=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>D&&c>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=k.b.CreateAnimation("beta",k.b.ANIMATIONTYPE_FLOAT,60,Z.EasingFunction));const c=k.b.TransitionTo("beta",r,this._attachedCamera,this._attachedCamera.yc(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));c&&this._animatables.push(c)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=E.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}Z.EasingFunction=new v.t,Z.EasingMode=v.o.EASINGMODE_EASEINOUT,Z.IgnoreBoundsSizeMode=0,Z.FitFrustumSidesMode=1;var J=D(12143),q=D(12169),j=D(13314),X=D(11487);class e{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(c){c=X.Tools.BackCompatCameraNoPreventDefault(arguments);const r=this.camera.getEngine(),D=r.getInputElement();let W=0,B=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=t=>{var u,a;const H=t.event,x="touch"===H.pointerType;if(t.type!==M.c.POINTERMOVE&&-1===this.buttons.indexOf(H.button))return;const E=H.target;if(this._altKey=H.altKey,this._ctrlKey=H.ctrlKey,this._metaKey=H.metaKey,this._shiftKey=H.shiftKey,this._buttonsPressed=H.buttons,r.isPointerLock){const c=H.movementX,r=H.movementY;this.onTouch(null,c,r),this._pointA=null,this._pointB=null}else{if(t.type!==M.c.POINTERDOWN&&t.type!==M.c.POINTERDOUBLETAP&&x&&(null===(u=this._pointA)||void 0===u?void 0:u.pointerId)!==H.pointerId&&(null===(a=this._pointB)||void 0===a?void 0:a.pointerId)!==H.pointerId)return;if(t.type!==M.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!x)if(t.type===M.c.POINTERDOUBLETAP)this.onDoubleTap(H.pointerType);else if(t.type!==M.c.POINTERUP||this._currentMousePointerIdDown!==H.pointerId&&!x){if(t.type===M.c.POINTERMOVE)if(c||H.preventDefault(),this._pointA&&null===this._pointB){const c=H.clientX-this._pointA.x,r=H.clientY-this._pointA.y;this._pointA.x=H.clientX,this._pointA.y=H.clientY,this.onTouch(this._pointA,c,r)}else if(this._pointA&&this._pointB){const c=this._pointA.pointerId===H.pointerId?this._pointA:this._pointB;c.x=H.clientX,c.y=H.clientY;const r=this._pointA.x-this._pointB.x,D=this._pointA.y-this._pointB.y,u=r*r+D*D,a={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:H.pointerId,type:t.type};this.onMultiTouch(this._pointA,this._pointB,W,u,B,a),B=a,W=u}}else{try{null===E||void 0===E||E.releasePointerCapture(H.pointerId)}catch(m){}x||(this._pointB=null),r._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==H.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==H.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==W||B)&&(this.onMultiTouch(this._pointA,this._pointB,W,0,B,null),W=0,B=null),this._currentMousePointerIdDown=-1,this.onButtonUp(H),c||H.preventDefault()}else{try{null===E||void 0===E||E.setPointerCapture(H.pointerId)}catch(m){}if(null===this._pointA)this._pointA={x:H.clientX,y:H.clientY,pointerId:H.pointerId,type:H.pointerType};else{if(null!==this._pointB)return;this._pointB={x:H.clientX,y:H.clientY,pointerId:H.pointerId,type:H.pointerType}}-1!==this._currentMousePointerIdDown||x||(this._currentMousePointerIdDown=H.pointerId),this.onButtonDown(H),c||(H.preventDefault(),D&&D.focus())}}},this._observer=this.camera.yc()._inputManager._addCameraPointerObserver(this._pointerInput,M.c.POINTERDOWN|M.c.POINTERUP|M.c.POINTERMOVE|M.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,W=0,B=null,this.onLostFocus()},this._contextMenuBind=c=>this.onContextMenu(c),D&&D.addEventListener("contextmenu",this._contextMenuBind,!1);const t=this.camera.yc().getEngine().getHostWindow();t&&X.Tools.RegisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}LE(){if(this._onLostFocus){const c=this.camera.yc().getEngine().getHostWindow();c&&X.Tools.UnregisterTopRootEvents(c,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.yc()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const c=this.camera.yc().getEngine().getInputElement();c&&c.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(c){}onTouch(c,r,D){}onMultiTouch(c,r,D,W,B,t){}onContextMenu(c){c.preventDefault()}onButtonDown(c){}onButtonUp(c){}onLostFocus(){}}(0,W.e)([(0,B.K)()],e.prototype,"buttons",void 0);class y extends e{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(c,r){if(0!==this.panningSensibility&&c&&r){const D=r.x-c.x,W=r.y-c.y;this.camera.inertialPanningX+=-D/this.panningSensibility,this.camera.inertialPanningY+=W/this.panningSensibility}}_computePinchZoom(c,r){const D=this.camera.radius||y.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=D*Math.sqrt(c)/Math.sqrt(r):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(r-c)*D*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(r-c)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(c,r,D){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-r/this.panningSensibility,this.camera.inertialPanningY+=D/this.panningSensibility):(this.camera.inertialAlphaOffset-=r/this.angularSensibilityX,this.camera.inertialBetaOffset-=D/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(c,r,D,W,B,t){0===D&&null===B||0===W&&null===t||(this.multiTouchPanAndZoom?(this._computePinchZoom(D,W),this._computeMultiTouchPanning(B,t)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(W)-Math.sqrt(D))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(D,W),this._isPinching=!0):this._computeMultiTouchPanning(B,t)):this.multiTouchPanning?this._computeMultiTouchPanning(B,t):this.pinchZoom&&this._computePinchZoom(D,W))}onButtonDown(c){this._isPanClick=c.button===this.camera._panningMouseButton}onButtonUp(c){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}y.MinimumRadiusForPinch=.001,(0,W.e)([(0,B.K)()],y.prototype,"buttons",void 0),(0,W.e)([(0,B.K)()],y.prototype,"angularSensibilityX",void 0),(0,W.e)([(0,B.K)()],y.prototype,"angularSensibilityY",void 0),(0,W.e)([(0,B.K)()],y.prototype,"pinchPrecision",void 0),(0,W.e)([(0,B.K)()],y.prototype,"pinchDeltaPercentage",void 0),(0,W.e)([(0,B.K)()],y.prototype,"useNaturalPinchZoom",void 0),(0,W.e)([(0,B.K)()],y.prototype,"pinchZoom",void 0),(0,W.e)([(0,B.K)()],y.prototype,"panningSensibility",void 0),(0,W.e)([(0,B.K)()],y.prototype,"multiTouchPanning",void 0),(0,W.e)([(0,B.K)()],y.prototype,"multiTouchPanAndZoom",void 0),j.c.ArcRotateCameraPointersInput=y;var U=D(11971);class N{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(c){c=X.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.yc(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((r=>{const D=r.event;if(!D.metaKey)if(r.type===U.b.KEYDOWN){if(this._ctrlPressed=D.ctrlKey,this._altPressed=D.altKey,-1!==this.keysUp.indexOf(D.keyCode)||-1!==this.keysDown.indexOf(D.keyCode)||-1!==this.keysLeft.indexOf(D.keyCode)||-1!==this.keysRight.indexOf(D.keyCode)||-1!==this.keysReset.indexOf(D.keyCode)){-1===this._keys.indexOf(D.keyCode)&&this._keys.push(D.keyCode),D.preventDefault&&(c||D.preventDefault())}}else if(-1!==this.keysUp.indexOf(D.keyCode)||-1!==this.keysDown.indexOf(D.keyCode)||-1!==this.keysLeft.indexOf(D.keyCode)||-1!==this.keysRight.indexOf(D.keyCode)||-1!==this.keysReset.indexOf(D.keyCode)){const r=this._keys.indexOf(D.keyCode);r>=0&&this._keys.splice(r,1),D.preventDefault&&(c||D.preventDefault())}})))}LE(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const c=this.camera;for(let r=0;r<this._keys.length;r++){const D=this._keys[r];-1!==this.keysLeft.indexOf(D)?this._ctrlPressed&&this.camera._useCtrlForPanning?c.inertialPanningX-=1/this.panningSensibility:c.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(D)?this._ctrlPressed&&this.camera._useCtrlForPanning?c.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?c.inertialRadiusOffset+=1/this.zoomingSensibility:c.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(D)?this._ctrlPressed&&this.camera._useCtrlForPanning?c.inertialPanningX+=1/this.panningSensibility:c.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(D)?this._ctrlPressed&&this.camera._useCtrlForPanning?c.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?c.inertialRadiusOffset-=1/this.zoomingSensibility:c.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(D)&&c.useInputToRestoreState&&c.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,W.e)([(0,B.K)()],N.prototype,"keysUp",void 0),(0,W.e)([(0,B.K)()],N.prototype,"keysDown",void 0),(0,W.e)([(0,B.K)()],N.prototype,"keysLeft",void 0),(0,W.e)([(0,B.K)()],N.prototype,"keysRight",void 0),(0,W.e)([(0,B.K)()],N.prototype,"keysReset",void 0),(0,W.e)([(0,B.K)()],N.prototype,"panningSensibility",void 0),(0,W.e)([(0,B.K)()],N.prototype,"zoomingSensibility",void 0),(0,W.e)([(0,B.K)()],N.prototype,"useAltToZoom",void 0),(0,W.e)([(0,B.K)()],N.prototype,"angularSpeed",void 0),j.c.ArcRotateCameraKeyboardMoveInput=N;var g=D(11729),z=D(11976);class S{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new u.Zr(0,0,0),this._globalOffset=new u.Zr(0,0,0),this._inertialPanning=u.Zr.Zero()}_computeDeltaFromMouseWheelLegacyEvent(c,r){let D=0;const W=.01*c*this.wheelDeltaPercentage*r;return D=c>0?W/(1+this.wheelDeltaPercentage):W*(1+this.wheelDeltaPercentage),D}attachControl(c){c=X.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=r=>{if(r.type!==M.c.POINTERWHEEL)return;const D=r.event;let W=0;const B=D.deltaMode===z.e.DOM_DELTA_LINE?40:1,t=-D.deltaY*B;if(this.customComputeDeltaFromMouseWheel)W=this.customComputeDeltaFromMouseWheel(t,this,D);else if(this.wheelDeltaPercentage){if(W=this._computeDeltaFromMouseWheelLegacyEvent(t,this.camera.radius),W>0){let c=this.camera.radius,r=this.camera.inertialRadiusOffset+W;for(let D=0;D<20&&!(c<=r)&&!(Math.abs(r*this.camera.inertia)<.001);D++)c-=r,r*=this.camera.inertia;c=(0,a.Clamp)(c,0,Number.MAX_VALUE),W=this._computeDeltaFromMouseWheelLegacyEvent(t,c)}}else W=t/(40*this.wheelPrecision);W&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(W)):this.camera.inertialRadiusOffset+=W),D.preventDefault&&(c||D.preventDefault())},this._observer=this.camera.yc()._inputManager._addCameraPointerObserver(this._wheel,M.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.ja(0)}LE(){this._observer&&(this.camera.yc()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const c=this.camera;0+c.inertialAlphaOffset+c.inertialBetaOffset+c.inertialRadiusOffset&&(this._updateHitPlane(),c.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(c.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const c=this.camera,r=c.target.Jr(c.position);this._hitPlane=g.d.FromPositionAndNormal(c.target,r)}_getPosition(){const c=this.camera,r=c.yc(),D=r.createPickingRay(r.pointerX,r.pointerY,u.Matrix.Identity(),c,!1);0===c.targetScreenOffset.x&&0===c.targetScreenOffset.y||(this._viewOffset.set(c.targetScreenOffset.x,c.targetScreenOffset.y,0),c.getViewMatrix().invertToRef(c._cameraTransformMatrix),this._globalOffset=u.Zr.TransformNormal(this._viewOffset,c._cameraTransformMatrix),D.origin.addInPlace(this._globalOffset));let W=0;return this._hitPlane&&(W=D.intersectsPlane(this._hitPlane)??0),D.origin.addInPlace(D.direction.scaleInPlace(W))}_zoomToMouse(c){const r=this.camera,D=1-r.inertia;if(r.lowerRadiusLimit){const W=r.lowerRadiusLimit??0;r.radius-(r.inertialRadiusOffset+c)/D<W&&(c=(r.radius-W)*D-r.inertialRadiusOffset)}if(r.upperRadiusLimit){const W=r.upperRadiusLimit??0;r.radius-(r.inertialRadiusOffset+c)/D>W&&(c=(r.radius-W)*D-r.inertialRadiusOffset)}const W=c/D/r.radius,B=this._getPosition(),t=u.TmpVectors.Zr[6];B.subtractToRef(r.target,t),t.scaleInPlace(W),t.scaleInPlace(D),this._inertialPanning.addInPlace(t),r.inertialRadiusOffset+=c}_zeroIfClose(c){Math.abs(c.x)<m.c&&(c.x=0),Math.abs(c.y)<m.c&&(c.y=0),Math.abs(c.z)<m.c&&(c.z=0)}}(0,W.e)([(0,B.K)()],S.prototype,"wheelPrecision",void 0),(0,W.e)([(0,B.K)()],S.prototype,"zoomToMouseLocation",void 0),(0,W.e)([(0,B.K)()],S.prototype,"wheelDeltaPercentage",void 0),j.c.ArcRotateCameraMouseWheelInput=S;class K extends j.f{constructor(c){super(c)}addMouseWheel(){return this.add(new S),this}addPointers(){return this.add(new y),this}addKeyboard(){return this.add(new N),this}}var f=D(11637);function A(c,r){return isNaN(c)?r:c}H.c.AddNodeConstructor("ArcRotateCamera",((c,r)=>()=>new h(c,0,0,1,u.Zr.Zero(),r)));class h extends q.e{get target(){return this._target}set target(c){this.setTarget(c)}get targetHost(){return this._targetHost}set targetHost(c){c&&this.setTarget(c)}getTarget(){return this.target}get position(){return this._position}set position(c){this.setPosition(c)}set upVector(c){this._upToYMatrix||(this._yToUpMatrix=new u.Matrix,this._upToYMatrix=new u.Matrix,this._upVector=u.Zr.Zero()),c.normalize(),this._upVector.t(c),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){u.Matrix.RotationAlignToRef(u.Zr.UpReadOnly,this._upVector,this._yToUpMatrix),u.Matrix.RotationAlignToRef(this._upVector,u.Zr.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const c=this.inputs.attached.pointers;return c?c.angularSensibilityX:0}set angularSensibilityX(c){const r=this.inputs.attached.pointers;r&&(r.angularSensibilityX=c)}get angularSensibilityY(){const c=this.inputs.attached.pointers;return c?c.angularSensibilityY:0}set angularSensibilityY(c){const r=this.inputs.attached.pointers;r&&(r.angularSensibilityY=c)}get pinchPrecision(){const c=this.inputs.attached.pointers;return c?c.pinchPrecision:0}set pinchPrecision(c){const r=this.inputs.attached.pointers;r&&(r.pinchPrecision=c)}get pinchDeltaPercentage(){const c=this.inputs.attached.pointers;return c?c.pinchDeltaPercentage:0}set pinchDeltaPercentage(c){const r=this.inputs.attached.pointers;r&&(r.pinchDeltaPercentage=c)}get useNaturalPinchZoom(){const c=this.inputs.attached.pointers;return!!c&&c.useNaturalPinchZoom}set useNaturalPinchZoom(c){const r=this.inputs.attached.pointers;r&&(r.useNaturalPinchZoom=c)}get panningSensibility(){const c=this.inputs.attached.pointers;return c?c.panningSensibility:0}set panningSensibility(c){const r=this.inputs.attached.pointers;r&&(r.panningSensibility=c)}get keysUp(){const c=this.inputs.attached.keyboard;return c?c.keysUp:[]}set keysUp(c){const r=this.inputs.attached.keyboard;r&&(r.keysUp=c)}get keysDown(){const c=this.inputs.attached.keyboard;return c?c.keysDown:[]}set keysDown(c){const r=this.inputs.attached.keyboard;r&&(r.keysDown=c)}get keysLeft(){const c=this.inputs.attached.keyboard;return c?c.keysLeft:[]}set keysLeft(c){const r=this.inputs.attached.keyboard;r&&(r.keysLeft=c)}get keysRight(){const c=this.inputs.attached.keyboard;return c?c.keysRight:[]}set keysRight(c){const r=this.inputs.attached.keyboard;r&&(r.keysRight=c)}get wheelPrecision(){const c=this.inputs.attached.mousewheel;return c?c.wheelPrecision:0}set wheelPrecision(c){const r=this.inputs.attached.mousewheel;r&&(r.wheelPrecision=c)}get zoomToMouseLocation(){const c=this.inputs.attached.mousewheel;return!!c&&c.zoomToMouseLocation}set zoomToMouseLocation(c){const r=this.inputs.attached.mousewheel;r&&(r.zoomToMouseLocation=c)}get wheelDeltaPercentage(){const c=this.inputs.attached.mousewheel;return c?c.wheelDeltaPercentage:0}set wheelDeltaPercentage(c){const r=this.inputs.attached.mousewheel;r&&(r.wheelDeltaPercentage=c)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(c){c!==this.useBouncingBehavior&&(c?(this._bouncingBehavior=new w,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(c){c!==this.useFramingBehavior&&(c?(this._framingBehavior=new Z,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(c){c!==this.useAutoRotationBehavior&&(c?(this._autoRotationBehavior=new Y,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(c,r,D,W,B,a){var H;let x=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(c,u.Zr.Zero(),a,x),H=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=u.Zr.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=u.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new u.Matrix,this.panningAxis=new u.Zr(1,1,0),this._transformedDirection=new u.Zr,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new t.c,this.checkCollisions=!1,this.collisionRadius=new u.Zr(.5,.5,.5),this._previousPosition=u.Zr.Zero(),this._collisionVelocity=u.Zr.Zero(),this._newPosition=u.Zr.Zero(),this._computationVector=u.Zr.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new u.Zr(NaN,NaN,NaN),this._goalTargetScreenOffset=new u.Vector2(NaN,NaN),this._onCollisionPositionChange=function(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;D?(H.setPosition(r),H.JY&&H.JY(D)):H._previousPosition.t(H._position);const W=Math.cos(H.alpha),B=Math.sin(H.alpha),t=Math.cos(H.beta);let u=Math.sin(H.beta);0===u&&(u=1e-4);const a=H._getTargetPosition();H._computationVector.Ja(H.radius*W*u,H.radius*t,H.radius*B*u),a.addToRef(H._computationVector,H._newPosition),H._position.t(H._newPosition);let x=H.upVector;H.allowUpsideDown&&H.beta<0&&(x=x.clone(),x=x.negate()),H._computeViewMatrix(H._position,a,x),H._viewMatrix.addAtIndex(12,H.targetScreenOffset.x),H._viewMatrix.addAtIndex(13,H.targetScreenOffset.y),H._collisionTriggered=!1},this._target=u.Zr.Zero(),B&&this.setTarget(B),this.alpha=r,this.beta=D,this.radius=W,this.getViewMatrix(),this.inputs=new K(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new u.Zr(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=u.Vector2.Zero()}_updateCache(c){c||super._updateCache(),this._cache._target.t(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.t(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const c=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?c.addToRef(this._targetBoundingCenter,this._target):this._target.t(c)}const c=this._getLockedTargetPosition();return c||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>m.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,t=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=t?this._currentInterpolationFactor=t:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=A(c,this._goalAlpha),this._goalBeta=A(r,this._goalBeta),this._goalRadius=A(D,this._goalRadius),this._goalTarget.set(A(W.x,this._goalTarget.x),A(W.y,this._goalTarget.y),A(W.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(A(B.x,this._goalTargetScreenOffset.x),A(B.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,a.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,a.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,a.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,a.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(c,r){let D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const B=arguments;r=X.Tools.BackCompatCameraNoPreventDefault(B),this._useCtrlForPanning=D,this._panningMouseButton=W,"boolean"===typeof B[0]&&(B.length>1&&(this._useCtrlForPanning=B[1]),B.length>2&&(this._panningMouseButton=B[2])),this.inputs.attachElement(r),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}LE(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let c=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){c=!0;const r=this.invertRotation?-1:1,D=this._calculateHandednessMultiplier();let W=this.inertialAlphaOffset*D;this.beta<0&&(W*=-1),this.alpha+=W*r,this.beta+=this.inertialBetaOffset*r,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<m.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<m.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*m.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){c=!0;const r=new u.Zr(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),r.multiplyInPlace(this.panningAxis),u.Zr.TransformNormalToRef(r,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const c=this.upVector,r=u.Zr.CrossToRef(this._transformedDirection,c,this._transformedDirection);u.Zr.CrossToRef(c,r,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);u.Zr.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.t(this._transformedDirection)}else{if(this.parent){const c=u.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(c),c.transposeToRef(c),u.Zr.TransformCoordinatesToRef(this._transformedDirection,c,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*m.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*m.c&&(this.inertialPanningY=0)}if(c)this.stopInterpolation();else if(this._isInterpolating){let c=!1;const r=this._scene.getEngine().getDeltaTime()/1e3,D=1-Math.pow(2,-r/this._currentInterpolationFactor),W=A(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const r=u.TmpVectors.Zr[0].set(A(this._goalTarget.x,this._target.x),A(this._goalTarget.y,this._target.y),A(this._goalTarget.z,this._target.z));u.Zr.LerpToRef(this.target,r,D,this._target),10*u.Zr.Distance(this.target,r)/W<m.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.t(r),this.setTarget(this.target,!1,!0,!0)):c=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const r=u.Quaternion.RotationAlphaBetaGammaToRef(A(this._goalAlpha,this.alpha),A(this._goalBeta,this.beta),0,u.TmpVectors.Quaternion[0]),W=u.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,u.TmpVectors.Quaternion[1]),B=u.Quaternion.SlerpToRef(W,r,D,u.TmpVectors.Quaternion[2]);B.normalize();const t=B.toAlphaBetaGammaToRef(u.TmpVectors.Zr[0]);if(this.alpha=t.x,this.beta=t.y,B.isApprox(r,m.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const c=r.toAlphaBetaGammaToRef(u.TmpVectors.Zr[0]);this.alpha=c.x,this.beta=c.y}else c=!0}if(isNaN(this._goalRadius)||(this.radius+=(W-this.radius)*D,Math.abs(W/this.radius-1)<m.c?(this._goalRadius=NaN,this.radius=W):c=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const r=u.TmpVectors.Vector2[0].set(A(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),A(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));u.Vector2.LerpToRef(this.targetScreenOffset,r,D,this.targetScreenOffset),u.Vector2.Distance(this.targetScreenOffset,r)<m.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.t(r)):c=!0}this._isInterpolating=c}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||u.Zr.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const c=this.alpha;var r,D;this.alpha=function(c){let r=Math.PI/2;return 0===c.x&&0===c.z||(r=Math.acos(c.x/Math.sqrt(Math.pow(c.x,2)+Math.pow(c.z,2)))),c.z<0&&(r=2*Math.PI-r),r}(this._computationVector),this.beta=(r=this._computationVector.y,D=this.radius,Math.acos(r/D));const W=Math.round((c-this.alpha)/(2*Math.PI));this.alpha+=2*W*Math.PI,this._checkLimits()}setPosition(c){this._position.equals(c)||(this._position.t(c),this.rebuildAnglesAndRadius())}setTarget(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],W=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(W=this.overrideCloneAlphaBetaRadius??W,c.va)r&&c.getBoundingInfo?this._targetBoundingCenter=c.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,c.va(),this._targetHost=c,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const r=c,W=this._getTargetPosition();if(W&&!D&&W.equals(r))return;this._targetHost=null,this._target=r,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}W||this.rebuildAnglesAndRadius()}_getViewMatrix(){const c=Math.cos(this.alpha),r=Math.sin(this.alpha),D=Math.cos(this.beta);let W=Math.sin(this.beta);0===W&&(W=1e-4),0===this.radius&&(this.radius=1e-4);const B=this._getTargetPosition();if(this._computationVector.Ja(this.radius*c*W,this.radius*D,this.radius*r*W),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||u.Zr.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),B.addToRef(this._computationVector,this._newPosition),this.yc().collisionsEnabled&&this.checkCollisions){const c=this.yc().collisionCoordinator;this._collider||(this._collider=c.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,c.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.t(this._newPosition);let c=this.upVector;this.allowUpsideDown&&W<0&&(c=c.negate()),this._computeViewMatrix(this._position,B,c),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.t(B),this._viewMatrix}zoomOn(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c=c||this.yc().meshes;const D=x.e.MinMax(c);let W=this._calculateLowerRadiusFromModelBoundingSphere(D.min,D.max);if(W=Math.max(Math.min(W,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=W*this.zoomOnFactor,this.mode===J.d.ORTHOGRAPHIC_CAMERA){const c=this.yc().getEngine().getAspectRatio(this),r=W*this.zoomOnFactor/2;this.orthoLeft=-r*c,this.orthoRight=r*c,this.orthoBottom=-r,this.orthoTop=r}this.focusOn({min:D.min,max:D.max,distance:W},r)}focusOn(c){let r,D,W=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===c.min){const W=c||this.yc().meshes;r=x.e.MinMax(W),D=u.Zr.Distance(r.min,r.max)}else{r=c,D=c.distance}this._target=x.e.Center(r),W||(this.maxZ=2*D)}createRigCamera(c,r){let D=0;switch(this.cameraRigMode){case J.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case J.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case J.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case J.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case J.d.RIG_MODE_VR:D=this._cameraRigParams.stereoHalfAngle*(0===r?1:-1);break;case J.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:D=this._cameraRigParams.stereoHalfAngle*(0===r?-1:1)}const W=new h(c,this.alpha+D,this.beta,this.radius,this._target,this.yc());return W._cameraRigParams={},W.isRigCamera=!0,W.rigParent=this,W.upVector=this.upVector,W.mode=this.mode,W.orthoLeft=this.orthoLeft,W.orthoRight=this.orthoRight,W.orthoBottom=this.orthoBottom,W.orthoTop=this.orthoTop,W}_updateRigCameras(){const c=this._rigCameras[0],r=this._rigCameras[1];switch(c.beta=r.beta=this.beta,this.cameraRigMode){case J.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case J.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case J.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case J.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case J.d.RIG_MODE_VR:c.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,r.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case J.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,r.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const W=u.Zr.Distance(c,r),B=this.yc().getEngine().getAspectRatio(this),t=Math.tan(this.fov/2),a=t*B,H=.5*W*D,x=H*Math.sqrt(1+1/(a*a)),M=H*Math.sqrt(1+1/(t*t));return Math.max(x,M)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,W.e)([(0,B.K)()],h.prototype,"alpha",void 0),(0,W.e)([(0,B.K)()],h.prototype,"beta",void 0),(0,W.e)([(0,B.K)()],h.prototype,"radius",void 0),(0,W.e)([(0,B.K)()],h.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,W.e)([(0,B.J)("target")],h.prototype,"_target",void 0),(0,W.e)([(0,B.A)("targetHost")],h.prototype,"_targetHost",void 0),(0,W.e)([(0,B.K)()],h.prototype,"inertialAlphaOffset",void 0),(0,W.e)([(0,B.K)()],h.prototype,"inertialBetaOffset",void 0),(0,W.e)([(0,B.K)()],h.prototype,"inertialRadiusOffset",void 0),(0,W.e)([(0,B.K)()],h.prototype,"lowerAlphaLimit",void 0),(0,W.e)([(0,B.K)()],h.prototype,"upperAlphaLimit",void 0),(0,W.e)([(0,B.K)()],h.prototype,"lowerBetaLimit",void 0),(0,W.e)([(0,B.K)()],h.prototype,"upperBetaLimit",void 0),(0,W.e)([(0,B.K)()],h.prototype,"lowerRadiusLimit",void 0),(0,W.e)([(0,B.K)()],h.prototype,"upperRadiusLimit",void 0),(0,W.e)([(0,B.K)()],h.prototype,"lowerTargetYLimit",void 0),(0,W.e)([(0,B.K)()],h.prototype,"inertialPanningX",void 0),(0,W.e)([(0,B.K)()],h.prototype,"inertialPanningY",void 0),(0,W.e)([(0,B.K)()],h.prototype,"pinchToPanMaxDistance",void 0),(0,W.e)([(0,B.K)()],h.prototype,"panningDistanceLimit",void 0),(0,W.e)([(0,B.J)()],h.prototype,"panningOriginTarget",void 0),(0,W.e)([(0,B.K)()],h.prototype,"panningInertia",void 0),(0,W.e)([(0,B.K)()],h.prototype,"zoomToMouseLocation",null),(0,W.e)([(0,B.K)()],h.prototype,"zoomOnFactor",void 0),(0,W.e)([(0,B.H)()],h.prototype,"targetScreenOffset",void 0),(0,W.e)([(0,B.K)()],h.prototype,"allowUpsideDown",void 0),(0,W.e)([(0,B.K)()],h.prototype,"useInputToRestoreState",void 0),(0,W.e)([(0,B.K)()],h.prototype,"restoreStateInterpolationFactor",void 0),(0,f.e)("BABYLON.ArcRotateCamera",h)},13314:(c,r,D)=>{"use strict";D.d(r,{c:()=>u,f:()=>a});var W=D(11509),B=D(11717),t=D(12143),u={};class a{constructor(c){this.attachedToElement=!1,this.attached={},this.camera=c,this.checkInputs=()=>{}}add(c){const r=c.getSimpleName();this.attached[r]?W.e.Warn("camera input of type "+r+" already exists on camera"):(this.attached[r]=c,c.camera=this.camera,c.checkInputs&&(this.checkInputs=this._addCheckInputs(c.checkInputs.bind(c))),this.attachedToElement&&c.attachControl(this.noPreventDefault))}remove(c){for(const r in this.attached){const D=this.attached[r];if(D===c)return D.LE(),D.camera=null,delete this.attached[r],void this.rebuildInputCheck()}}removeByType(c){for(const r in this.attached){const D=this.attached[r];D.getClassName()===c&&(D.LE(),D.camera=null,delete this.attached[r],this.rebuildInputCheck())}}_addCheckInputs(c){const r=this.checkInputs;return()=>{r(),c()}}attachInput(c){this.attachedToElement&&c.attachControl(this.noPreventDefault)}attachElement(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){c=!t.d.ForceAttachControlToAlwaysPreventDefault&&c,this.attachedToElement=!0,this.noPreventDefault=c;for(const r in this.attached)this.attached[r].attachControl(c)}}detachElement(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const r in this.attached)this.attached[r].LE(),c&&(this.attached[r].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const c in this.attached){const r=this.attached[c];r.checkInputs&&(this.checkInputs=this._addCheckInputs(r.checkInputs.bind(r)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(c){const r={};for(const D in this.attached){const c=this.attached[D],W=B.d.Serialize(c);r[c.getClassName()]=W}c.inputsmgr=r}parse(c){const r=c.inputsmgr;if(r){this.clear();for(const c in r){const D=u[c];if(D){const W=r[c],t=B.d.Parse((()=>new D),W,null);this.add(t)}}}else for(const D in this.attached){const r=u[this.attached[D].getClassName()];if(r){const W=B.d.Parse((()=>new r),c,null);this.remove(this.attached[D]),this.add(W)}}}}},13306:(c,r,D)=>{"use strict";D.d(r,{d:()=>e});var W=D(11664),B=D(11669),t=D(11683),u=D(12169),a=D(13314),H=D(11971),x=D(11487);class M{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(c){c=x.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.yc(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((r=>{const D=r.event;if(!D.metaKey)if(r.type===H.b.KEYDOWN){if(-1!==this.keysUp.indexOf(D.keyCode)||-1!==this.keysDown.indexOf(D.keyCode)||-1!==this.keysLeft.indexOf(D.keyCode)||-1!==this.keysRight.indexOf(D.keyCode)||-1!==this.keysUpward.indexOf(D.keyCode)||-1!==this.keysDownward.indexOf(D.keyCode)||-1!==this.keysRotateLeft.indexOf(D.keyCode)||-1!==this.keysRotateRight.indexOf(D.keyCode)||-1!==this.keysRotateUp.indexOf(D.keyCode)||-1!==this.keysRotateDown.indexOf(D.keyCode)){-1===this._keys.indexOf(D.keyCode)&&this._keys.push(D.keyCode),c||D.preventDefault()}}else if(-1!==this.keysUp.indexOf(D.keyCode)||-1!==this.keysDown.indexOf(D.keyCode)||-1!==this.keysLeft.indexOf(D.keyCode)||-1!==this.keysRight.indexOf(D.keyCode)||-1!==this.keysUpward.indexOf(D.keyCode)||-1!==this.keysDownward.indexOf(D.keyCode)||-1!==this.keysRotateLeft.indexOf(D.keyCode)||-1!==this.keysRotateRight.indexOf(D.keyCode)||-1!==this.keysRotateUp.indexOf(D.keyCode)||-1!==this.keysRotateDown.indexOf(D.keyCode)){const r=this._keys.indexOf(D.keyCode);r>=0&&this._keys.splice(r,1),c||D.preventDefault()}})))}LE(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const c=this.camera;for(let r=0;r<this._keys.length;r++){const D=this._keys[r],W=c._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(D)?c._localDirection.Ja(-W,0,0):-1!==this.keysUp.indexOf(D)?c._localDirection.Ja(0,0,W):-1!==this.keysRight.indexOf(D)?c._localDirection.Ja(W,0,0):-1!==this.keysDown.indexOf(D)?c._localDirection.Ja(0,0,-W):-1!==this.keysUpward.indexOf(D)?c._localDirection.Ja(0,W,0):-1!==this.keysDownward.indexOf(D)?c._localDirection.Ja(0,-W,0):-1!==this.keysRotateLeft.indexOf(D)?(c._localDirection.Ja(0,0,0),c.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(D)?(c._localDirection.Ja(0,0,0),c.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(D)?(c._localDirection.Ja(0,0,0),c.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(D)&&(c._localDirection.Ja(0,0,0),c.cameraRotation.x+=this._getLocalRotation()),c.yc().useRightHandedSystem&&(c._localDirection.z*=-1),c.getViewMatrix().invertToRef(c._cameraTransformMatrix),t.Zr.TransformNormalToRef(c._localDirection,c._cameraTransformMatrix,c._transformedDirection),c.cameraDirection.addInPlace(c._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const c=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*c}}(0,W.e)([(0,B.K)()],M.prototype,"keysUp",void 0),(0,W.e)([(0,B.K)()],M.prototype,"keysUpward",void 0),(0,W.e)([(0,B.K)()],M.prototype,"keysDown",void 0),(0,W.e)([(0,B.K)()],M.prototype,"keysDownward",void 0),(0,W.e)([(0,B.K)()],M.prototype,"keysLeft",void 0),(0,W.e)([(0,B.K)()],M.prototype,"keysRight",void 0),(0,W.e)([(0,B.K)()],M.prototype,"rotationSpeed",void 0),(0,W.e)([(0,B.K)()],M.prototype,"keysRotateLeft",void 0),(0,W.e)([(0,B.K)()],M.prototype,"keysRotateRight",void 0),(0,W.e)([(0,B.K)()],M.prototype,"keysRotateUp",void 0),(0,W.e)([(0,B.K)()],M.prototype,"keysRotateDown",void 0),a.c.FreeCameraKeyboardMoveInput=M;var E=D(11494),m=D(11966);class Y{constructor(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=c,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new E.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(c){c=x.Tools.BackCompatCameraNoPreventDefault(arguments);const r=this.camera.getEngine(),D=r.getInputElement();this._pointerInput||(this._pointerInput=W=>{const B=W.event,t="touch"===B.pointerType;if(!this.touchEnabled&&t)return;if(W.type!==m.c.POINTERMOVE&&-1===this.buttons.indexOf(B.button))return;const u=B.target;if(W.type===m.c.POINTERDOWN){if(t&&-1!==this._activePointerId||!t&&-1!==this._currentActiveButton)return;this._activePointerId=B.pointerId;try{null===u||void 0===u||u.setPointerCapture(B.pointerId)}catch(a){}-1===this._currentActiveButton&&(this._currentActiveButton=B.button),this._previousPosition={x:B.clientX,y:B.clientY},c||(B.preventDefault(),D&&D.focus()),r.isPointerLock&&this._onMouseMove&&this._onMouseMove(W.event)}else if(W.type===m.c.POINTERUP){if(t&&this._activePointerId!==B.pointerId||!t&&this._currentActiveButton!==B.button)return;try{null===u||void 0===u||u.releasePointerCapture(B.pointerId)}catch(a){}this._currentActiveButton=-1,this._previousPosition=null,c||B.preventDefault(),this._activePointerId=-1}else if(W.type===m.c.POINTERMOVE&&(this._activePointerId===B.pointerId||!t))if(r.isPointerLock&&this._onMouseMove)this._onMouseMove(W.event);else if(this._previousPosition){const r=this.camera._calculateHandednessMultiplier(),D=(B.clientX-this._previousPosition.x)*r,W=B.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=D/this.angularSensibility,this.camera.cameraRotation.x+=W/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:D,offsetY:W}),this._previousPosition={x:B.clientX,y:B.clientY},c||B.preventDefault()}}),this._onMouseMove=D=>{if(!r.isPointerLock)return;const W=this.camera._calculateHandednessMultiplier(),B=D.movementX*W;this.camera.cameraRotation.y+=B/this.angularSensibility;const t=D.movementY;this.camera.cameraRotation.x+=t/this.angularSensibility,this._previousPosition=null,c||D.preventDefault()},this._observer=this.camera.yc()._inputManager._addCameraPointerObserver(this._pointerInput,m.c.POINTERDOWN|m.c.POINTERUP|m.c.POINTERMOVE),D&&(this._contextMenuBind=c=>this.onContextMenu(c),D.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(c){c.preventDefault()}LE(){if(this._observer){if(this.camera.yc()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const c=this.camera.getEngine().getInputElement();c&&c.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,W.e)([(0,B.K)()],Y.prototype,"buttons",void 0),(0,W.e)([(0,B.K)()],Y.prototype,"angularSensibility",void 0),a.c.FreeCameraMouseInput=Y;var v,k=D(11976);class w{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new E.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(c){c=x.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=r=>{if(r.type!==m.c.POINTERWHEEL)return;const D=r.event,W=D.deltaMode===k.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*W*D.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*W*D.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*W*D.deltaZ/this._normalize,D.preventDefault&&(c||D.preventDefault())},this._observer=this.camera.yc()._inputManager._addCameraPointerObserver(this._wheel,m.c.POINTERWHEEL)}LE(){this._observer&&(this.camera.yc()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,W.e)([(0,B.K)()],w.prototype,"wheelPrecisionX",void 0),(0,W.e)([(0,B.K)()],w.prototype,"wheelPrecisionY",void 0),(0,W.e)([(0,B.K)()],w.prototype,"wheelPrecisionZ",void 0),function(c){c[c.MoveRelative=0]="MoveRelative",c[c.RotateRelative=1]="RotateRelative",c[c.MoveScene=2]="MoveScene"}(v||(v={}));class Z extends w{constructor(){super(...arguments),this._moveRelative=t.Zr.Zero(),this._rotateRelative=t.Zr.Zero(),this._moveScene=t.Zr.Zero(),this._wheelXAction=v.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=v.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(c){null===c&&this._wheelXAction!==v.MoveRelative||(this._wheelXAction=v.MoveRelative,this._wheelXActionCoordinate=c)}get wheelXMoveRelative(){return this._wheelXAction!==v.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(c){null===c&&this._wheelYAction!==v.MoveRelative||(this._wheelYAction=v.MoveRelative,this._wheelYActionCoordinate=c)}get wheelYMoveRelative(){return this._wheelYAction!==v.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(c){null===c&&this._wheelZAction!==v.MoveRelative||(this._wheelZAction=v.MoveRelative,this._wheelZActionCoordinate=c)}get wheelZMoveRelative(){return this._wheelZAction!==v.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(c){null===c&&this._wheelXAction!==v.RotateRelative||(this._wheelXAction=v.RotateRelative,this._wheelXActionCoordinate=c)}get wheelXRotateRelative(){return this._wheelXAction!==v.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(c){null===c&&this._wheelYAction!==v.RotateRelative||(this._wheelYAction=v.RotateRelative,this._wheelYActionCoordinate=c)}get wheelYRotateRelative(){return this._wheelYAction!==v.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(c){null===c&&this._wheelZAction!==v.RotateRelative||(this._wheelZAction=v.RotateRelative,this._wheelZActionCoordinate=c)}get wheelZRotateRelative(){return this._wheelZAction!==v.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(c){null===c&&this._wheelXAction!==v.MoveScene||(this._wheelXAction=v.MoveScene,this._wheelXActionCoordinate=c)}get wheelXMoveScene(){return this._wheelXAction!==v.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(c){null===c&&this._wheelYAction!==v.MoveScene||(this._wheelYAction=v.MoveScene,this._wheelYActionCoordinate=c)}get wheelYMoveScene(){return this._wheelYAction!==v.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(c){null===c&&this._wheelZAction!==v.MoveScene||(this._wheelZAction=v.MoveScene,this._wheelZActionCoordinate=c)}get wheelZMoveScene(){return this._wheelZAction!==v.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.ja(0),this._rotateRelative.ja(0),this._moveScene.ja(0),this._updateCamera(),this.camera.yc().useRightHandedSystem&&(this._moveRelative.z*=-1);const c=t.Matrix.Zero();this.camera.getViewMatrix().invertToRef(c);const r=t.Zr.Zero();t.Zr.TransformNormalToRef(this._moveRelative,c,r),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(r),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(c,r,D){if(0===c)return;if(null===r||null===D)return;let W=null;switch(r){case v.MoveRelative:W=this._moveRelative;break;case v.RotateRelative:W=this._rotateRelative;break;case v.MoveScene:W=this._moveScene}switch(D){case 0:W.set(c,0,0);break;case 1:W.set(0,c,0);break;case 2:W.set(0,0,c)}}}(0,W.e)([(0,B.K)()],Z.prototype,"wheelXMoveRelative",null),(0,W.e)([(0,B.K)()],Z.prototype,"wheelYMoveRelative",null),(0,W.e)([(0,B.K)()],Z.prototype,"wheelZMoveRelative",null),(0,W.e)([(0,B.K)()],Z.prototype,"wheelXRotateRelative",null),(0,W.e)([(0,B.K)()],Z.prototype,"wheelYRotateRelative",null),(0,W.e)([(0,B.K)()],Z.prototype,"wheelZRotateRelative",null),(0,W.e)([(0,B.K)()],Z.prototype,"wheelXMoveScene",null),(0,W.e)([(0,B.K)()],Z.prototype,"wheelYMoveScene",null),(0,W.e)([(0,B.K)()],Z.prototype,"wheelZMoveScene",null),a.c.FreeCameraMouseWheelInput=Z;class J{constructor(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=c,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=x.Tools.IsSafari()}attachControl(c){c=x.Tools.BackCompatCameraNoPreventDefault(arguments);let r=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=D=>{const W=D.event,B="mouse"===W.pointerType||this._isSafari&&"undefined"===typeof W.pointerType;if(this.allowMouse||!B)if(D.type===m.c.POINTERDOWN){if(c||W.preventDefault(),this._pointerPressed.push(W.pointerId),1!==this._pointerPressed.length)return;r={x:W.clientX,y:W.clientY}}else if(D.type===m.c.POINTERUP){c||W.preventDefault();const D=this._pointerPressed.indexOf(W.pointerId);if(-1===D)return;if(this._pointerPressed.splice(D,1),0!=D)return;r=null,this._offsetX=null,this._offsetY=null}else if(D.type===m.c.POINTERMOVE){if(c||W.preventDefault(),!r)return;if(0!=this._pointerPressed.indexOf(W.pointerId))return;this._offsetX=W.clientX-r.x,this._offsetY=-(W.clientY-r.y)}}),this._observer=this.camera.yc()._inputManager._addCameraPointerObserver(this._pointerInput,m.c.POINTERDOWN|m.c.POINTERUP|m.c.POINTERMOVE),this._onLostFocus){const c=this.camera.getEngine().getInputElement();c&&c.addEventListener("blur",this._onLostFocus)}}LE(){if(this._pointerInput){if(this._observer&&(this.camera.yc()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const c=this.camera.getEngine().getInputElement();c&&c.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const c=this.camera,r=c._calculateHandednessMultiplier();c.cameraRotation.y=r*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)c.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const r=c._computeLocalCameraSpeed(),D=new t.Zr(0,0,0!==this.touchMoveSensibility?r*this._offsetY/this.touchMoveSensibility:0);t.Matrix.RotationYawPitchRollToRef(c.rotation.y,c.rotation.x,0,c._cameraRotationMatrix),c.cameraDirection.addInPlace(t.Zr.TransformCoordinates(D,c._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,W.e)([(0,B.K)()],J.prototype,"touchAngularSensibility",void 0),(0,W.e)([(0,B.K)()],J.prototype,"touchMoveSensibility",void 0),a.c.FreeCameraTouchInput=J;class q extends a.f{constructor(c){super(c),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new M),this}addMouse(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new Y(c),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new Z,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new J),this}clear(){super.clear(),this._mouseInput=null}}var j=D(11637),X=D(11584);class e extends u.e{get angularSensibility(){const c=this.inputs.attached.mouse;return c?c.angularSensibility:0}set angularSensibility(c){const r=this.inputs.attached.mouse;r&&(r.angularSensibility=c)}get keysUp(){const c=this.inputs.attached.keyboard;return c?c.keysUp:[]}set keysUp(c){const r=this.inputs.attached.keyboard;r&&(r.keysUp=c)}get keysUpward(){const c=this.inputs.attached.keyboard;return c?c.keysUpward:[]}set keysUpward(c){const r=this.inputs.attached.keyboard;r&&(r.keysUpward=c)}get keysDown(){const c=this.inputs.attached.keyboard;return c?c.keysDown:[]}set keysDown(c){const r=this.inputs.attached.keyboard;r&&(r.keysDown=c)}get keysDownward(){const c=this.inputs.attached.keyboard;return c?c.keysDownward:[]}set keysDownward(c){const r=this.inputs.attached.keyboard;r&&(r.keysDownward=c)}get keysLeft(){const c=this.inputs.attached.keyboard;return c?c.keysLeft:[]}set keysLeft(c){const r=this.inputs.attached.keyboard;r&&(r.keysLeft=c)}get keysRight(){const c=this.inputs.attached.keyboard;return c?c.keysRight:[]}set keysRight(c){const r=this.inputs.attached.keyboard;r&&(r.keysRight=c)}get keysRotateLeft(){const c=this.inputs.attached.keyboard;return c?c.keysRotateLeft:[]}set keysRotateLeft(c){const r=this.inputs.attached.keyboard;r&&(r.keysRotateLeft=c)}get keysRotateRight(){const c=this.inputs.attached.keyboard;return c?c.keysRotateRight:[]}set keysRotateRight(c){const r=this.inputs.attached.keyboard;r&&(r.keysRotateRight=c)}get keysRotateUp(){const c=this.inputs.attached.keyboard;return c?c.keysRotateUp:[]}set keysRotateUp(c){const r=this.inputs.attached.keyboard;r&&(r.keysRotateUp=c)}get keysRotateDown(){const c=this.inputs.attached.keyboard;return c?c.keysRotateDown:[]}set keysRotateDown(c){const r=this.inputs.attached.keyboard;r&&(r.keysRotateDown=c)}constructor(c,r,D){var W;super(c,r,D,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),W=this,this.ellipsoid=new t.Zr(.5,1,.5),this.ellipsoidOffset=new t.Zr(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=t.Zr.Zero(),this._diffPosition=t.Zr.Zero(),this._newPosition=t.Zr.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;W._newPosition.t(r),W._newPosition.subtractToRef(W._oldPosition,W._diffPosition),W._diffPosition.length()>X.b.CollisionsEpsilon&&(W.position.addToRef(W._diffPosition,W._deferredPositionUpdate),W._deferOnly?W._deferredUpdated=!0:W.position.t(W._deferredPositionUpdate),W.JY&&D&&W.JY(D))},this.inputs=new q(this),this.inputs.addKeyboard().addMouse()}attachControl(c,r){r=x.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(r)}LE(){this.inputs.detachElement(),this.cameraDirection=new t.Zr(0,0,0),this.cameraRotation=new t.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(c){this._collisionMask=isNaN(c)?-1:c}_collideWithWorld(c){let r;r=this.parent?t.Zr.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,r.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const D=this.yc().collisionCoordinator;this._collider||(this._collider=D.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let W=c;this.applyGravity&&(W=c.add(this.yc().gravity)),D.getNewPosition(this._oldPosition,W,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=t.Zr.Zero(),this._transformedDirection=t.Zr.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(c){this._needMoveForGravity=c}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.yc().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Iv"}}(0,W.e)([(0,B.J)()],e.prototype,"ellipsoid",void 0),(0,W.e)([(0,B.J)()],e.prototype,"ellipsoidOffset",void 0),(0,W.e)([(0,B.K)()],e.prototype,"checkCollisions",void 0),(0,W.e)([(0,B.K)()],e.prototype,"applyGravity",void 0),(0,j.e)("BABYLON.FreeCamera",e)},13919:(c,r,D)=>{"use strict";D.d(r,{e:()=>t});var W=D(11766),B=D(13924);class t{constructor(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=D,this.cE=[],this._maxBlockCapacity=r||64,this._selectionContent=new W.d(1024),this._creationFunc=c}update(c,r,D){B.e._CreateBlocks(c,r,D,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}aM(c){for(let r=0;r<this.qM.length;r++){this.qM[r].addEntry(c)}}uM(c){for(let r=0;r<this.qM.length;r++){this.qM[r].removeEntry(c)}}select(c,r){this._selectionContent.reset();for(let D=0;D<this.qM.length;D++){this.qM[D].select(c,this._selectionContent,r)}return r?this._selectionContent.concat(this.cE):this._selectionContent.concatWithNoDuplicate(this.cE),this._selectionContent}intersects(c,r,D){this._selectionContent.reset();for(let W=0;W<this.qM.length;W++){this.qM[W].intersects(c,r,this._selectionContent,D)}return D?this._selectionContent.concat(this.cE):this._selectionContent.concatWithNoDuplicate(this.cE),this._selectionContent}intersectsRay(c){this._selectionContent.reset();for(let r=0;r<this.qM.length;r++){this.qM[r].intersectsRay(c,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.cE),this._selectionContent}}t.CreationFuncForMeshes=(c,r)=>{const D=c.getBoundingInfo();!c.isBlocked&&D.boundingBox.intersectsMinMax(r.tE,r.uE)&&r.entries.push(c)},t.CreationFuncForSubMeshes=(c,r)=>{c.getBoundingInfo().boundingBox.intersectsMinMax(r.tE,r.uE)&&r.entries.push(c)}},13924:(c,r,D)=>{"use strict";D.d(r,{e:()=>t});var W=D(11683),B=D(12031);class t{constructor(c,r,D,W,B,t){this.entries=[],this.aE=new Array,this._capacity=D,this._depth=W,this._maxDepth=B,this._creationFunc=t,this._minPoint=c,this._maxPoint=r,this.aE.push(c.clone()),this.aE.push(r.clone()),this.aE.push(c.clone()),this.aE[2].x=r.x,this.aE.push(c.clone()),this.aE[3].y=r.y,this.aE.push(c.clone()),this.aE[4].z=r.z,this.aE.push(r.clone()),this.aE[5].z=c.z,this.aE.push(r.clone()),this.aE[6].x=c.x,this.aE.push(r.clone()),this.aE[7].y=c.y}get wD(){return this._capacity}get tE(){return this._minPoint}get uE(){return this._maxPoint}addEntry(c){if(this.qM)for(let r=0;r<this.qM.length;r++){this.qM[r].addEntry(c)}else this._creationFunc(c,this),this.entries.length>this.wD&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(c){if(this.qM){for(let r=0;r<this.qM.length;r++){this.qM[r].removeEntry(c)}return}const r=this.entries.indexOf(c);r>-1&&this.entries.splice(r,1)}addEntries(c){for(let r=0;r<c.length;r++){const D=c[r];this.addEntry(D)}}select(c,r,D){if(B.c.IsInFrustum(this.aE,c)){if(this.qM){for(let W=0;W<this.qM.length;W++){this.qM[W].select(c,r,D)}return}D?r.concat(this.entries):r.concatWithNoDuplicate(this.entries)}}intersects(c,r,D,W){if(B.c.IntersectsSphere(this._minPoint,this._maxPoint,c,r)){if(this.qM){for(let B=0;B<this.qM.length;B++){this.qM[B].intersects(c,r,D,W)}return}W?D.concat(this.entries):D.concatWithNoDuplicate(this.entries)}}intersectsRay(c,r){if(c.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.qM){for(let D=0;D<this.qM.length;D++){this.qM[D].intersectsRay(c,r)}return}r.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){t._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(c,r,D,B,u,a,H,x){H.qM=new Array;const M=new W.Zr((r.x-c.x)/2,(r.y-c.y)/2,(r.z-c.z)/2);for(let W=0;W<2;W++)for(let r=0;r<2;r++)for(let E=0;E<2;E++){const m=c.add(M.multiplyByFloats(W,r,E)),Y=c.add(M.multiplyByFloats(W+1,r+1,E+1)),v=new t(m,Y,B,u+1,a,x);v.addEntries(D),H.qM.push(v)}}}},13931:(c,r,D)=>{"use strict";D.d(r,{e:()=>M});var W=D(11924),B=D(11683),t=D(12109),u=D(13064),a=D(11962),H=D(13919),x=D(11538);W.b.prototype.createOrUpdateSelectionOctree=function(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,D=this._getComponent(a.c.NAME_OCTREE);D||(D=new M(this),this.o(D)),this.nM||(this.nM=new H.e(H.e.CreationFuncForMeshes,c,r));const W=this.getWorldExtends();return this.nM.update(W.min,W.max,this.meshes),this.nM},Object.defineProperty(W.b.prototype,"selectionOctree",{get:function(){return this.nM},enumerable:!0,configurable:!0}),t.d.prototype.createOrUpdateSubmeshesOctree=function(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const D=this.yc();let W=D._getComponent(a.c.NAME_OCTREE);W||(W=new M(D),D.o(W)),this._submeshesOctree||(this._submeshesOctree=new H.e(H.e.CreationFuncForSubMeshes,c,r)),this.va(!0);const B=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(B.minimumWorld,B.maximumWorld,this.xa),this._submeshesOctree};class M{constructor(c){this.name=a.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new u.c(B.Zr.Zero(),new B.Zr(1,1,1)),(c=c||x.c.LastCreatedScene)&&(this.qr=c,this.qr.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.qr.getActiveSubMeshCandidates=c=>this.getActiveSubMeshCandidates(c),this.qr.getCollidingSubMeshCandidates=(c,r)=>this.getCollidingSubMeshCandidates(c,r),this.qr.getIntersectingSubMeshCandidates=(c,r)=>this.getIntersectingSubMeshCandidates(c,r))}register(){this.qr.onMeshRemovedObservable.add((c=>{const r=this.qr.selectionOctree;if(void 0!==r&&null!==r){const D=r.cE.indexOf(c);-1!==D&&r.cE.splice(D,1)}})),this.qr.onMeshImportedObservable.add((c=>{const r=this.qr.selectionOctree;void 0!==r&&null!==r&&r.aM(c)}))}getActiveMeshCandidates(){var c;return(null===(c=this.qr.nM)||void 0===c?void 0:c.select(this.qr.frustumPlanes))||this.qr._getDefaultMeshCandidates()}getActiveSubMeshCandidates(c){if(c._submeshesOctree&&c.useOctreeForRenderingSelection){return c._submeshesOctree.select(this.qr.frustumPlanes)}return this.qr._getDefaultSubMeshCandidates(c)}getIntersectingSubMeshCandidates(c,r){if(c._submeshesOctree&&c.useOctreeForPicking){u.c.TransformToRef(r,c.getWorldMatrix(),this._tempRay);return c._submeshesOctree.intersectsRay(this._tempRay)}return this.qr._getDefaultSubMeshCandidates(c)}getCollidingSubMeshCandidates(c,r){if(c._submeshesOctree&&c.useOctreeForCollisions){const D=r._velocityWorldLength+Math.max(r._radius.x,r._radius.y,r._radius.z);return c._submeshesOctree.intersects(r._basePointWorld,D)}return this.qr._getDefaultSubMeshCandidates(c)}rebuild(){}dispose(){}}},13064:(c,r,D)=>{"use strict";D.d(r,{c:()=>Y});var W=D(11924),B=D(12143),t=D(11687),u=D(11683),a=D(11694),H=D(12023),x=D(11954),M=D(11538),E=D(11982);const m={internalPickerForMesh:void 0};class Y{constructor(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.c;this.origin=c,this.direction=r,this.length=D,this.epsilon=W}clone(){return new Y(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const W=Y._TmpVector3[0].Ja(c.x-D,c.y-D,c.z-D),B=Y._TmpVector3[1].Ja(r.x+D,r.y+D,r.z+D);let t,u,a,H,x=0,M=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<W.x||this.origin.x>B.x)return!1}else if(t=1/this.direction.x,u=(W.x-this.origin.x)*t,a=(B.x-this.origin.x)*t,a===-1/0&&(a=1/0),u>a&&(H=u,u=a,a=H),x=Math.max(u,x),M=Math.min(a,M),x>M)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<W.y||this.origin.y>B.y)return!1}else if(t=1/this.direction.y,u=(W.y-this.origin.y)*t,a=(B.y-this.origin.y)*t,a===-1/0&&(a=1/0),u>a&&(H=u,u=a,a=H),x=Math.max(u,x),M=Math.min(a,M),x>M)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<W.z||this.origin.z>B.z)return!1}else if(t=1/this.direction.z,u=(W.z-this.origin.z)*t,a=(B.z-this.origin.z)*t,a===-1/0&&(a=1/0),u>a&&(H=u,u=a,a=H),x=Math.max(u,x),M=Math.min(a,M),x>M)return!1;return!0}intersectsBox(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(c.minimum,c.maximum,r)}intersectsSphere(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const D=c.center.x-this.origin.x,W=c.center.y-this.origin.y,B=c.center.z-this.origin.z,t=D*D+W*W+B*B,u=c.radius+r,a=u*u;if(t<=a)return!0;const H=D*this.direction.x+W*this.direction.y+B*this.direction.z;if(H<0)return!1;return t-H*H<=a}intersectsTriangle(c,r,D){const W=Y._TmpVector3[0],B=Y._TmpVector3[1],t=Y._TmpVector3[2],a=Y._TmpVector3[3],x=Y._TmpVector3[4];r.subtractToRef(c,W),D.subtractToRef(c,B),u.Zr.CrossToRef(this.direction,B,t);const M=u.Zr.Dot(W,t);if(0===M)return null;const E=1/M;this.origin.subtractToRef(c,a);const m=u.Zr.Dot(a,t)*E;if(m<-this.epsilon||m>1+this.epsilon)return null;u.Zr.CrossToRef(a,W,x);const v=u.Zr.Dot(this.direction,x)*E;if(v<-this.epsilon||m+v>1+this.epsilon)return null;const k=u.Zr.Dot(B,x)*E;return k>this.length?null:new H.b(1-m-v,m,k)}intersectsPlane(c){let r;const D=u.Zr.Dot(c.normal,this.direction);if(Math.abs(D)<9.99999997475243e-7)return null;{const W=u.Zr.Dot(c.normal,this.origin);return r=(-c.d-W)/D,r<0?r<-9.99999997475243e-7?null:0:r}}intersectsAxis(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(c){case"y":{const c=(this.origin.y-r)/this.direction.y;return c>0?null:new u.Zr(this.origin.x+this.direction.x*-c,r,this.origin.z+this.direction.z*-c)}case"x":{const c=(this.origin.x-r)/this.direction.x;return c>0?null:new u.Zr(r,this.origin.y+this.direction.y*-c,this.origin.z+this.direction.z*-c)}case"z":{const c=(this.origin.z-r)/this.direction.z;return c>0?null:new u.Zr(this.origin.x+this.direction.x*-c,this.origin.y+this.direction.y*-c,r)}default:return null}}intersectsMesh(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=u.TmpVectors.Matrix[0];return c.getWorldMatrix().invertToRef(a),this._tmpRay?Y.TransformToRef(this,a,this._tmpRay):this._tmpRay=Y.Transform(this,a),c.intersects(this._tmpRay,r,D,W,B,t)}intersectsMeshes(c,r,D){D?D.length=0:D=[];for(let W=0;W<c.length;W++){const B=this.intersectsMesh(c[W],r);B.hit&&D.push(B)}return D.sort(this._comparePickingInfo),D}_comparePickingInfo(c,r){return c.distance<r.distance?-1:c.distance>r.distance?1:0}intersectionSegment(c,r,D){const W=this.origin,B=u.TmpVectors.Zr[0],t=u.TmpVectors.Zr[1],a=u.TmpVectors.Zr[2],H=u.TmpVectors.Zr[3];r.subtractToRef(c,B),this.direction.scaleToRef(Y._Rayl,a),W.addToRef(a,t),c.subtractToRef(W,H);const x=u.Zr.Dot(B,B),M=u.Zr.Dot(B,a),E=u.Zr.Dot(a,a),m=u.Zr.Dot(B,H),v=u.Zr.Dot(a,H),k=x*E-M*M;let w,Z,J=k,q=k;k<Y._Smallnum?(w=0,J=1,Z=v,q=E):(w=M*v-E*m,Z=x*v-M*m,w<0?(w=0,Z=v,q=E):w>J&&(w=J,Z=v+M,q=E)),Z<0?(Z=0,-m<0?w=0:-m>x?w=J:(w=-m,J=x)):Z>q&&(Z=q,-m+M<0?w=0:-m+M>x?w=J:(w=-m+M,J=x));const j=Math.abs(w)<Y._Smallnum?0:w/J,X=Math.abs(Z)<Y._Smallnum?0:Z/q,e=u.TmpVectors.Zr[4];a.scaleToRef(X,e);const y=u.TmpVectors.Zr[5];B.scaleToRef(j,y),y.addInPlace(H);const U=u.TmpVectors.Zr[6];y.subtractToRef(e,U);return X>0&&X<=this.length&&U.lengthSquared()<D*D?y.length():-1}update(c,r,D,W,B,t,a){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){Y._RayDistant||(Y._RayDistant=Y.Zero()),Y._RayDistant.unprojectRayToRef(c,r,D,W,u.Matrix.IdentityReadOnly,t,a);const H=u.TmpVectors.Matrix[0];B.invertToRef(H),Y.TransformToRef(Y._RayDistant,H,this)}else this.unprojectRayToRef(c,r,D,W,B,t,a);return this}static Zero(){return new Y(u.Zr.Zero(),u.Zr.Zero())}static CreateNew(c,r,D,W,B,t,u){return Y.Zero().update(c,r,D,W,B,t,u)}static CreateNewFromTo(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.Matrix.IdentityReadOnly;const W=new Y(new u.Zr(0,0,0),new u.Zr(0,0,0));return Y.CreateFromToToRef(c,r,W,D)}static CreateFromToToRef(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.Matrix.IdentityReadOnly;D.origin.t(c);const B=r.subtractToRef(c,D.direction),t=Math.sqrt(B.x*B.x+B.y*B.y+B.z*B.z);return D.length=t,D.direction.normalize(),Y.TransformToRef(D,W,D)}static Transform(c,r){const D=new Y(new u.Zr(0,0,0),new u.Zr(0,0,0));return Y.TransformToRef(c,r,D),D}static TransformToRef(c,r,D){u.Zr.TransformCoordinatesToRef(c.origin,r,D.origin),u.Zr.TransformNormalToRef(c.direction,r,D.direction),D.length=c.length,D.epsilon=c.epsilon;const W=D.direction,B=W.length();if(0!==B&&1!==B){const c=1/B;W.x*=c,W.y*=c,W.z*=c,D.length*=B}return D}unprojectRayToRef(c,r,D,W,B,t,a){const H=u.TmpVectors.Matrix[0];B.multiplyToRef(t,H),H.multiplyToRef(a,H),H.invert();const x=M.c.LastCreatedEngine,E=u.TmpVectors.Zr[0];E.x=c/D*2-1,E.y=-(r/W*2-1),E.z=null!==x&&void 0!==x&&x.useReverseDepthBuffer?1:null!==x&&void 0!==x&&x.isNDCHalfZRange?0:-1;const m=u.TmpVectors.Zr[1].Ja(E.x,E.y,1-1e-8),Y=u.TmpVectors.Zr[2],v=u.TmpVectors.Zr[3];u.Zr._UnprojectFromInvertedMatrixToRef(E,H,Y),u.Zr._UnprojectFromInvertedMatrixToRef(m,H,v),this.origin.t(Y),v.subtractToRef(Y,this.direction),this.direction.normalize()}}function v(c,r,D,W,B){let t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const u=Y.Zero();return k(c,r,D,W,u,B,t),u}function k(c,r,D,W,B,t){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const x=c.getEngine();if(!t&&!(t=c.activeCamera))return c;const M=t.viewport,E=x.getRenderHeight(),{x:m,y:Y,width:v,height:k}=M.toGlobal(x.getRenderWidth(),E),w=1/x.getHardwareScalingLevel();return r=r*w-m,D=D*w-(E-Y-k),B.update(r,D,v,k,W||u.Matrix.IdentityReadOnly,a?u.Matrix.IdentityReadOnly:t.getViewMatrix(),t.getProjectionMatrix(),H),c}function w(c,r,D,W,B){if(!x.c)return c;const t=c.getEngine();if(!B&&!(B=c.activeCamera))throw new Error("Active camera not set");const a=B.viewport,H=t.getRenderHeight(),{x:M,y:E,width:m,height:Y}=a.toGlobal(t.getRenderWidth(),H),v=u.Matrix.Identity(),k=1/t.getHardwareScalingLevel();return r=r*k-M,D=D*k-(H-E-Y),W.update(r,D,m,Y,v,v,B.getProjectionMatrix()),c}function Z(c,r,D,W,B,t,u,a){const H=r(W,D.enableDistantPicking),x=D.intersects(H,B,u,t,W,a);return x&&x.hit?!B&&null!=c&&x.distance>=c.distance?null:x:null}function J(c,r,D,W,B,t){let a=null;const H=!!(c.activeCameras&&c.activeCameras.length>1&&c.cameraToUseForPointers!==c.activeCamera),M=c.cameraToUseForPointers||c.activeCamera,E=m.internalPickerForMesh||Z;for(let x=0;x<c.meshes.length;x++){const m=c.meshes[x];if(D){if(!D(m,-1))continue}else if(!m.isEnabled()||!m.isVisible||!m.GH)continue;const Y=H&&m.isWorldMatrixCameraDependent(),v=m.va(Y,M);if(m.hasThinInstances&&m.Jx){const c=E(a,r,m,v,!0,!0,t);if(c){if(B)return c;const H=u.TmpVectors.Matrix[1],x=m.thinInstanceGetWorldMatrices();for(let c=0;c<x.length;c++){if(D&&!D(m,c))continue;x[c].multiplyToRef(v,H);const u=E(a,r,m,H,W,B,t,!0);if(u&&(a=u,a.thinInstanceIndex=c,W))return a}}}else{const c=E(a,r,m,v,W,B,t);if(c&&(a=c,W))return a}}return a||new x.c}function q(c,r,D,W){if(!x.c)return null;const B=[],t=!!(c.activeCameras&&c.activeCameras.length>1&&c.cameraToUseForPointers!==c.activeCamera),a=c.cameraToUseForPointers||c.activeCamera,H=m.internalPickerForMesh||Z;for(let x=0;x<c.meshes.length;x++){const M=c.meshes[x];if(D){if(!D(M,-1))continue}else if(!M.isEnabled()||!M.isVisible||!M.GH)continue;const E=t&&M.isWorldMatrixCameraDependent(),m=M.va(E,a);if(M.hasThinInstances&&M.Jx){if(H(null,r,M,m,!0,!0,W)){const c=u.TmpVectors.Matrix[1],t=M.thinInstanceGetWorldMatrices();for(let u=0;u<t.length;u++){if(D&&!D(M,u))continue;t[u].multiplyToRef(m,c);const a=H(null,r,M,c,!1,!1,W,!0);a&&(a.thinInstanceIndex=u,B.push(a))}}}else{const c=H(null,r,M,m,!1,!1,W);c&&B.push(c)}}return B}function j(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,W=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0;W||(W=c.getWorldMatrix()),r.length=D,B?r.origin.t(B):r.origin.t(c.position);const t=u.TmpVectors.Zr[2];t.set(0,0,c._scene.useRightHandedSystem?-1:1);const a=u.TmpVectors.Zr[3];return u.Zr.TransformNormalToRef(t,W,a),u.Zr.NormalizeToRef(a,r.direction),r}var X,e;Y._TmpVector3=(0,a.d)(6,u.Zr.Zero),Y._RayDistant=Y.Zero(),Y._Smallnum=1e-8,Y._Rayl=1e9,X=W.b,(e=B.d)&&(e.prototype.getForwardRay=function(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,r=arguments.length>1?arguments[1]:void 0,D=arguments.length>2?arguments[2]:void 0;return j(this,new Y(u.Zr.Zero(),u.Zr.Zero(),c),c,r,D)},e.prototype.getForwardRayToRef=function(c){return j(this,c,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),X&&(E.c._IsPickingAvailable=!0,X.prototype.createPickingRay=function(c,r,D,W){return v(this,c,r,D,W,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),W.b.prototype.createPickingRayToRef=function(c,r,D,W,B){return k(this,c,r,D,W,B,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},W.b.prototype.createPickingRayInCameraSpace=function(c,r,D){return function(c,r,D,W){const B=Y.Zero();return w(c,r,D,B,W),B}(this,c,r,D)},W.b.prototype.createPickingRayInCameraSpaceToRef=function(c,r,D,W){return w(this,c,r,D,W)},W.b.prototype.pickWithBoundingInfo=function(c,r,D,W,B){return function(c,r,D,W,B,t){if(!x.c)return null;const a=J(c,(W=>(c._tempPickingRay||(c._tempPickingRay=Y.Zero()),k(c,r,D,W,c._tempPickingRay,t||null),c._tempPickingRay)),W,B,!0);return a&&(a.ray=v(c,r,D,u.Matrix.Identity(),t||null)),a}(this,c,r,D,W,B)},W.b.prototype.qD=function(c,r,D,W,B,t){return function(c,r,D,W,B,t,a){const H=J(c,((W,B)=>(c._tempPickingRay||(c._tempPickingRay=Y.Zero()),k(c,r,D,W,c._tempPickingRay,t||null,!1,B),c._tempPickingRay)),W,B,!1,a);return H&&(H.ray=v(c,r,D,u.Matrix.Identity(),t||null)),H}(this,c,r,D,W,B,t)},W.b.prototype.pickWithRay=function(c,r,D,W){return function(c,r,D,W,B){const t=J(c,(D=>(c._pickWithRayInverseMatrix||(c._pickWithRayInverseMatrix=u.Matrix.Identity()),D.invertToRef(c._pickWithRayInverseMatrix),c._cachedRayForTransform||(c._cachedRayForTransform=Y.Zero()),Y.TransformToRef(r,c._pickWithRayInverseMatrix,c._cachedRayForTransform),c._cachedRayForTransform)),D,W,!1,B);return t&&(t.ray=r),t}(this,c,r,D,W)},W.b.prototype.multiPick=function(c,r,D,W,B){return function(c,r,D,W,B,t){return q(c,(W=>v(c,r,D,W,B||null)),W,t)}(this,c,r,D,W,B)},W.b.prototype.multiPickWithRay=function(c,r,D){return function(c,r,D,W){return q(c,(D=>(c._pickWithRayInverseMatrix||(c._pickWithRayInverseMatrix=u.Matrix.Identity()),D.invertToRef(c._pickWithRayInverseMatrix),c._cachedRayForTransform||(c._cachedRayForTransform=Y.Zero()),Y.TransformToRef(r,c._pickWithRayInverseMatrix,c._cachedRayForTransform),c._cachedRayForTransform)),D,W)}(this,c,r,D)}},13364:(c,r,D)=>{"use strict";var W=D(11615),B=D(11509),t=D(11545),u=D(11646),a=D(11584),H=D(11624);a.b.prototype._partialLoadFile=function(c,r,D,W){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(c,(c=>{D[r]=c,D._internalCount++,6===D._internalCount&&W(D)}),void 0,void 0,!0,((c,r)=>{B&&c&&B(c.status+" "+c.statusText,r)}))},a.b.prototype._cascadeLoadFiles=function(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const B=[];B._internalCount=0;for(let t=0;t<6;t++)this._partialLoadFile(D[t],t,B,r,W)},a.b.prototype._cascadeLoadImgs=function(c,r,D,W){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5?arguments[5]:void 0;const u=[];u._internalCount=0;for(let a=0;a<6;a++)this._partialLoadImg(W[a],a,u,c,r,D,B,t)},a.b.prototype._partialLoadImg=function(c,r,D,W,B,a){let H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7?arguments[7]:void 0;const M=(0,u.c)();(0,t.q)(c,(c=>{D[r]=c,D._internalCount++,W&&W.removePendingData(M),6===D._internalCount&&a&&a(B,D)}),((c,r)=>{W&&W.removePendingData(M),H&&H(c,r)}),W?W.offlineProvider:null,x),W&&W.addPendingData(M)},a.b.prototype.createCubeTextureBase=function(c,r,D,t){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6?arguments[6]:void 0,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]&&arguments[8],m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,k=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,w=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,Z=arguments.length>14&&void 0!==arguments[14]&&arguments[14],J=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const q=v||new W.e(this,7);q.isCube=!0,q.url=c,q.generateMipMaps=!t,q._lodGenerationScale=m,q._lodGenerationOffset=Y,q._useSRGBBuffer=!!Z&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!t),q!==v&&(q.label=c.substring(0,60)),this._doNotHandleContextLost||(q._extension=M,q._files=D,q._buffer=J);const j=c;this._transformTextureUrl&&!v&&(c=this._transformTextureUrl(c));const X=M??function(c){const r=c.split("?")[0],D=r.lastIndexOf(".");return D>-1?r.substring(D).toLowerCase():""}(c),e=(0,H.e)(X),y=(c,r)=>{q.dispose(),a?a(c,r):c&&B.e.Warn(c)},U=(W,a)=>{c===j?W&&y(W.status+" "+W.statusText,a):(B.e.Warn(`Failed to load ${c}, falling back to the ${j}`),this.createCubeTextureBase(j,r,D,!!t,u,y,x,M,E,m,Y,q,k,w,Z,J))};if(e)e.then((W=>{const B=c=>{k&&k(q,c),W.loadCubeData(c,q,E,u,((c,r)=>{y(c,r)}))};J?B(J):D&&6===D.length?W.supportCascades?this._cascadeLoadFiles(r,(c=>B(c.map((c=>new Uint8Array(c))))),D,y):y("Textures type does not support cascades."):this._loadFile(c,(c=>B(new Uint8Array(c))),void 0,void 0,!0,U)}));else{if(!D||0===D.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(r,q,((c,r)=>{w&&w(c,r)}),D,y)}return this._internalTexturesCache.push(q),q}},13938:(c,r,D)=>{"use strict";D(11509);var W=D(11792);D(11615),D(11756),D(11608),D(11855),D(11799);W.b},13390:(c,r,D)=>{"use strict";D.d(r,{d:()=>B});var W=D(11637);class B{constructor(c){this.value=this._toInt(c)}_toInt(c){return 0|c}add(c){return new B(this.value+c.value)}Jr(c){return new B(this.value-c.value)}multiply(c){return new B(Math.imul(this.value,c.value))}divide(c){return new B(this.value/c.value)}getClassName(){return B.ClassName}equals(c){return this.value===c.value}static FromValue(c){return new B(c)}toString(){return this.value.toString()}}B.ClassName="FlowGraphInteger",(0,W.e)("FlowGraphInteger",B)},13395:(c,r,D)=>{"use strict";D.d(r,{e:()=>B,i:()=>t});var W=D(11683);class B{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Ba=c}get m(){return this.Ba}transformVector(c){return this.transformVectorToRef(c,new W.Vector2)}transformVectorToRef(c,r){return r.x=c.x*this.Ba[0]+c.y*this.Ba[1],r.y=c.x*this.Ba[2]+c.y*this.Ba[3],r}Ma(){return this.toArray()}toArray(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let r=0;r<4;r++)c[r]=this.Ba[r];return c}jD(c){for(let r=0;r<4;r++)this.Ba[r]=c[r];return this}multiplyToRef(c,r){const D=c.Ba,W=this.Ba,B=r.Ba;return B[0]=D[0]*W[0]+D[1]*W[2],B[1]=D[0]*W[1]+D[1]*W[3],B[2]=D[2]*W[0]+D[3]*W[2],B[3]=D[2]*W[1]+D[3]*W[3],r}multiply(c){return this.multiplyToRef(c,new B)}divideToRef(c,r){const D=this.Ba,W=c.Ba,B=r.Ba;return B[0]=D[0]/W[0],B[1]=D[1]/W[1],B[2]=D[2]/W[2],B[3]=D[3]/W[3],r}divide(c){return this.divideToRef(c,new B)}addToRef(c,r){const D=this.Ba,W=c.m,B=r.m;return B[0]=D[0]+W[0],B[1]=D[1]+W[1],B[2]=D[2]+W[2],B[3]=D[3]+W[3],r}add(c){return this.addToRef(c,new B)}subtractToRef(c,r){const D=this.Ba,W=c.m,B=r.m;return B[0]=D[0]-W[0],B[1]=D[1]-W[1],B[2]=D[2]-W[2],B[3]=D[3]-W[3],r}Jr(c){return this.subtractToRef(c,new B)}transpose(){const c=this.Ba;return new B([c[0],c[2],c[1],c[3]])}determinant(){const c=this.Ba;return c[0]*c[3]-c[1]*c[2]}inverse(){const c=this.determinant();if(0===c)throw new Error("Matrix is not invertible");const r=this.Ba,D=1/c;return new B([r[3]*D,-r[1]*D,-r[2]*D,r[0]*D])}equals(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const D=this.Ba,W=c.m;return 0===r?D[0]===W[0]&&D[1]===W[1]&&D[2]===W[2]&&D[3]===W[3]:Math.abs(D[0]-W[0])<r&&Math.abs(D[1]-W[1])<r&&Math.abs(D[2]-W[2])<r&&Math.abs(D[3]-W[3])<r}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Ba.join(", ")})`}}class t{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Ba=c}get m(){return this.Ba}transformVector(c){return this.transformVectorToRef(c,new W.Zr)}transformVectorToRef(c,r){const D=this.Ba;return r.x=c.x*D[0]+c.y*D[1]+c.z*D[2],r.y=c.x*D[3]+c.y*D[4]+c.z*D[5],r.z=c.x*D[6]+c.y*D[7]+c.z*D[8],r}multiplyToRef(c,r){const D=c.Ba,W=this.Ba,B=r.m;return B[0]=D[0]*W[0]+D[1]*W[3]+D[2]*W[6],B[1]=D[0]*W[1]+D[1]*W[4]+D[2]*W[7],B[2]=D[0]*W[2]+D[1]*W[5]+D[2]*W[8],B[3]=D[3]*W[0]+D[4]*W[3]+D[5]*W[6],B[4]=D[3]*W[1]+D[4]*W[4]+D[5]*W[7],B[5]=D[3]*W[2]+D[4]*W[5]+D[5]*W[8],B[6]=D[6]*W[0]+D[7]*W[3]+D[8]*W[6],B[7]=D[6]*W[1]+D[7]*W[4]+D[8]*W[7],B[8]=D[6]*W[2]+D[7]*W[5]+D[8]*W[8],r}multiply(c){return this.multiplyToRef(c,new t)}divideToRef(c,r){const D=this.Ba,W=c.m,B=r.m;return B[0]=D[0]/W[0],B[1]=D[1]/W[1],B[2]=D[2]/W[2],B[3]=D[3]/W[3],B[4]=D[4]/W[4],B[5]=D[5]/W[5],B[6]=D[6]/W[6],B[7]=D[7]/W[7],B[8]=D[8]/W[8],r}divide(c){return this.divideToRef(c,new t)}addToRef(c,r){const D=this.Ba,W=c.m,B=r.m;return B[0]=D[0]+W[0],B[1]=D[1]+W[1],B[2]=D[2]+W[2],B[3]=D[3]+W[3],B[4]=D[4]+W[4],B[5]=D[5]+W[5],B[6]=D[6]+W[6],B[7]=D[7]+W[7],B[8]=D[8]+W[8],r}add(c){return this.addToRef(c,new t)}subtractToRef(c,r){const D=this.Ba,W=c.m,B=r.m;return B[0]=D[0]-W[0],B[1]=D[1]-W[1],B[2]=D[2]-W[2],B[3]=D[3]-W[3],B[4]=D[4]-W[4],B[5]=D[5]-W[5],B[6]=D[6]-W[6],B[7]=D[7]-W[7],B[8]=D[8]-W[8],r}Jr(c){return this.subtractToRef(c,new t)}toArray(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let r=0;r<9;r++)c[r]=this.Ba[r];return c}Ma(){return this.toArray()}jD(c){for(let r=0;r<9;r++)this.Ba[r]=c[r];return this}transpose(){const c=this.Ba;return new t([c[0],c[3],c[6],c[1],c[4],c[7],c[2],c[5],c[8]])}determinant(){const c=this.Ba;return c[0]*(c[4]*c[8]-c[5]*c[7])-c[1]*(c[3]*c[8]-c[5]*c[6])+c[2]*(c[3]*c[7]-c[4]*c[6])}inverse(){const c=this.determinant();if(0===c)throw new Error("Matrix is not invertible");const r=this.Ba,D=1/c;return new t([(r[4]*r[8]-r[5]*r[7])*D,(r[2]*r[7]-r[1]*r[8])*D,(r[1]*r[5]-r[2]*r[4])*D,(r[5]*r[6]-r[3]*r[8])*D,(r[0]*r[8]-r[2]*r[6])*D,(r[2]*r[3]-r[0]*r[5])*D,(r[3]*r[7]-r[4]*r[6])*D,(r[1]*r[6]-r[0]*r[7])*D,(r[0]*r[4]-r[1]*r[3])*D])}equals(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const D=this.Ba,W=c.m;return 0===r?D[0]===W[0]&&D[1]===W[1]&&D[2]===W[2]&&D[3]===W[3]&&D[4]===W[4]&&D[5]===W[5]&&D[6]===W[6]&&D[7]===W[7]&&D[8]===W[8]:Math.abs(D[0]-W[0])<r&&Math.abs(D[1]-W[1])<r&&Math.abs(D[2]-W[2])<r&&Math.abs(D[3]-W[3])<r&&Math.abs(D[4]-W[4])<r&&Math.abs(D[5]-W[5])<r&&Math.abs(D[6]-W[6])<r&&Math.abs(D[7]-W[7])<r&&Math.abs(D[8]-W[8])<r}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Ba.join(", ")})`}}},13397:(c,r,D)=>{"use strict";var W;function B(c,r,D,W){switch(r){case"Animation":return W?c.animations.find((c=>c.uniqueId===D))??null:c.animations[D]??null;case"AnimationGroup":return W?c.animationGroups.find((c=>c.uniqueId===D))??null:c.animationGroups[D]??null;case"Mesh":return W?c.meshes.find((c=>c.uniqueId===D))??null:c.meshes[D]??null;case"Material":return W?c.materials.find((c=>c.uniqueId===D))??null:c.materials[D]??null;case"kM":return W?c.cameras.find((c=>c.uniqueId===D))??null:c.cameras[D]??null;case"Light":return W?c.lights.find((c=>c.uniqueId===D))??null:c.lights[D]??null;default:return null}}D.d(r,{c:()=>B}),function(c){c.Animation="Animation",c.AnimationGroup="AnimationGroup",c.Mesh="Mesh",c.Material="Material",c.kM="kM",c.Light="Light"}(W||(W={}))},13429:(c,r,D)=>{"use strict";D.d(r,{e:()=>B});var W=D(13431);class B extends W.d{constructor(c,r){if(super(c),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),r)for(const D of r)this._eventsSignalOutputs[D]=this._registerSignalOutput(D+"Event")}_executeOnTick(c){}_startPendingTasks(c){c._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(c),this._resetAfterCanceled(c)),this._preparePendingTasks(c),c._addPendingBlock(this),this.out._activateSignal(c),c._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(c){c._deleteExecutionVariable(this,"_initialized"),c._removePendingBlock(this)}}},13408:(c,r,D)=>{"use strict";D.d(r,{d:()=>x});var W=D(11646),B=D(11637),t=D(13414),u=D(11494),a=D(13388);class H extends t.d{constructor(c,r,D,W){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:W.defaultValue,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(c,r,D),this.richType=W,this._defaultValue=B,this._optional=t,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new u.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(c){this._isDisabled!==c&&(this._isDisabled=c,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(c,r){r._getConnectionValue(this)!==c&&(r._setConnectionValue(this,c),this.onValueChangedObservable.notifyObservers(c))}resetToDefaultValue(c){c._setConnectionValue(this,this._defaultValue)}connectTo(c){this._isDisabled||super.connectTo(c)}_getValueOrDefault(c){const r=c._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(r):r}getValue(c){if(1===this.connectionType){c._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(c);const r=this._getValueOrDefault(c);return this._lastValue=r,this.richType.typeTransformer?this.richType.typeTransformer(r):r}const r=this.isConnected()?this._connectedPoint[0].getValue(c):this._getValueOrDefault(c);return this._lastValue=r,this.richType.typeTransformer?this.richType.typeTransformer(r):r}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(c),c.richType={},this.richType.serialize(c.richType),c.optional=this._optional,(0,a.f)("defaultValue",this._defaultValue,c)}}(0,B.e)("FlowGraphDataConnection",H);class x{constructor(c){var r;this.config=c,this.uniqueId=(0,W.c)(),this.name=(null===(r=this.config)||void 0===r?void 0:r.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(c){}registerDataInput(c,r,D){const W=new H(c,0,this,r,D);return this.dataInputs.push(W),W}registerDataOutput(c,r,D){const W=new H(c,1,this,r,D);return this.dataOutputs.push(W),W}getDataInput(c){return this.dataInputs.find((r=>r.name===c))}getDataOutput(c){return this.dataOutputs.find((r=>r.name===c))}serialize(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.f;if(c.uniqueId=this.uniqueId,c.config={},this.config){const D=this.config,W=Object.keys(D);for(const B of W)r(B,D[B],c.config)}c.dataInputs=[],c.dataOutputs=[],c.className=this.getClassName();for(const D of this.dataInputs){const r={};D.serialize(r),c.dataInputs.push(r)}for(const D of this.dataOutputs){const r={};D.serialize(r),c.dataOutputs.push(r)}}deserialize(c){}_log(c,r,D){var W;null===(W=c.logger)||void 0===W||W.addLogItem({action:r,XD:D,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13414:(c,r,D)=>{"use strict";D.d(r,{d:()=>t});var W,B=D(11646);!function(c){c[c.Input=0]="Input",c[c.Output=1]="Output"}(W||(W={}));class t{constructor(c,r,D){this._ownerBlock=D,this._connectedPoint=[],this.uniqueId=(0,B.c)(),this.connectedPointIds=[],this.name=c,this._connectionType=r}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(c){if(this._connectionType===c._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||c._isSingularConnection()&&c._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(c),c._connectedPoint.push(this)}disconnectFrom(c){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const D=this._connectedPoint.indexOf(c),W=c._connectedPoint.indexOf(this);-1!==D&&-1!==W&&(r&&this._connectedPoint.splice(D,1),c._connectedPoint.splice(W,1))}disconnectFromAll(){for(const c of this._connectedPoint)this.disconnectFrom(c,!1);this._connectedPoint.length=0}dispose(){for(const c of this._connectedPoint)this.disconnectFrom(c)}serialize(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c.uniqueId=this.uniqueId,c.name=this.name,c._connectionType=this._connectionType,c.connectedPointIds=[],c.className=this.getClassName();for(const r of this._connectedPoint)c.connectedPointIds.push(r.uniqueId)}getClassName(){return"FGConnection"}deserialize(c){this.uniqueId=c.uniqueId,this.name=c.name,this._connectionType=c._connectionType,this.connectedPointIds=c.connectedPointIds}}},13384:(c,r,D)=>{"use strict";D.d(r,{e:()=>q});var W,B=D(11494),t=D(11664),u=D(11669),a=D(11646),H=D(13388),x=D(13397),M=D(11509);!function(c){c.ExecuteBlock="ExecuteBlock",c.ExecuteEvent="ExecuteEvent",c.TriggerConnection="TriggerConnection",c.ContextVariableSet="ContextVariableSet",c.GlobalVariableSet="GlobalVariableSet",c.GlobalVariableDelete="GlobalVariableDelete",c.GlobalVariableGet="GlobalVariableGet",c.AddConnection="AddConnection",c.GetConnectionValue="GetConnectionValue",c.SetConnectionValue="SetConnectionValue",c.ActivateSignal="ActivateSignal",c.ContextVariableGet="ContextVariableGet"}(W||(W={}));class E{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(c){if(c.time||(c.time=Date.now()),this.log.push(c),this.logToConsole){var r;const D=null===(r=c.XD)||void 0===r?void 0:r.value;"object"===typeof D&&D.getClassName?M.e.Log(`[FGLog] ${c.className}:${c.uniqueId.split("-")[0]} ${c.action} - ${JSON.stringify(D.getClassName())}: ${D.toString()}`):M.e.Log(`[FGLog] ${c.className}:${c.uniqueId.split("-")[0]} ${c.action} - ${JSON.stringify(c.XD)}`)}}getItemsOfType(c){return this.log.filter((r=>r.action===c))}}class m{get enableLogging(){return this._enableLogging}set enableLogging(c){this._enableLogging!==c&&(this._enableLogging=c,this._enableLogging?(this.logger=new E,this.logger.logToConsole=!0):this.logger=null)}constructor(c){this.uniqueId=(0,a.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new B.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=c,this.assetsContext=c.assetsContext??c.qr}hasVariable(c){return c in this._userVariables}setVariable(c,r){var D;this._userVariables[c]=r,null===(D=this.logger)||void 0===D||D.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",XD:{name:c,value:r}})}getAsset(c,r){return(0,x.c)(this.assetsContext,c,r)}getVariable(c){var r;return null===(r=this.logger)||void 0===r||r.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",XD:{name:c,value:this._userVariables[c]}}),this._userVariables[c]}get userVariables(){return this._userVariables}yc(){return this._configuration.qr}_getUniqueIdPrefixedName(c,r){return`${c.uniqueId}_${r}`}_getGlobalContextVariable(c,r){var D;return null===(D=this.logger)||void 0===D||D.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",XD:{name:c,defaultValue:r,possibleValue:this._globalContextVariables[c]}}),this._hasGlobalContextVariable(c)?this._globalContextVariables[c]:r}_setGlobalContextVariable(c,r){var D;null===(D=this.logger)||void 0===D||D.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",XD:{name:c,value:r}}),this._globalContextVariables[c]=r}_deleteGlobalContextVariable(c){var r;null===(r=this.logger)||void 0===r||r.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",XD:{name:c}}),delete this._globalContextVariables[c]}_hasGlobalContextVariable(c){return c in this._globalContextVariables}_setExecutionVariable(c,r,D){this._executionVariables[this._getUniqueIdPrefixedName(c,r)]=D}_getExecutionVariable(c,r,D){return this._hasExecutionVariable(c,r)?this._executionVariables[this._getUniqueIdPrefixedName(c,r)]:D}_deleteExecutionVariable(c,r){delete this._executionVariables[this._getUniqueIdPrefixedName(c,r)]}_hasExecutionVariable(c,r){return this._getUniqueIdPrefixedName(c,r)in this._executionVariables}_hasConnectionValue(c){return c.uniqueId in this._connectionValues}_setConnectionValue(c,r){var D;this._connectionValues[c.uniqueId]=r,null===(D=this.logger)||void 0===D||D.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",XD:{connectionPointId:c.uniqueId,value:r}})}_setConnectionValueByKey(c,r){this._connectionValues[c]=r}_getConnectionValue(c){var r;return null===(r=this.logger)||void 0===r||r.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",XD:{connectionPointId:c.uniqueId,value:this._connectionValues[c.uniqueId]}}),this._connectionValues[c.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(c){this._pendingBlocks.includes(c)||(this._pendingBlocks.push(c),this._pendingBlocks.sort(((c,r)=>c.priority-r.priority)))}_removePendingBlock(c){const r=this._pendingBlocks.indexOf(c);-1!==r&&this._pendingBlocks.splice(r,1)}_clearPendingBlocks(){for(const c of this._pendingBlocks)c._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(c){var r;this.onNodeExecutedObservable.notifyObservers(c),null===(r=this.logger)||void 0===r||r.addLogItem({time:Date.now(),className:c.getClassName(),uniqueId:c.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(c){this._setGlobalContextVariable("timeSinceStart",c.timeSinceStart),this._setGlobalContextVariable("deltaTime",c.deltaTime);for(const D of this._pendingBlocks){var r;null===(r=D._executeOnTick)||void 0===r||r.call(D,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.f;c.uniqueId=this.uniqueId,c._userVariables={};for(const W in this._userVariables)r(W,this._userVariables[W],c._userVariables);c._connectionValues={};for(const W in this._connectionValues)r(W,this._connectionValues[W],c._connectionValues);var D;this.assetsContext!==this.yc()&&(c._assetsContext={meshes:this.assetsContext.meshes.map((c=>c.id)),materials:this.assetsContext.materials.map((c=>c.id)),textures:this.assetsContext.textures.map((c=>c.name)),animations:this.assetsContext.animations.map((c=>c.name)),lights:this.assetsContext.lights.map((c=>c.id)),cameras:this.assetsContext.cameras.map((c=>c.id)),dm:null===(D=this.assetsContext.dm)||void 0===D?void 0:D.map((c=>c.name)),skeletons:this.assetsContext.skeletons.map((c=>c.id)),rm:this.assetsContext.rm.map((c=>c.name)),geometries:this.assetsContext.geometries.map((c=>c.id)),multiMaterials:this.assetsContext.multiMaterials.map((c=>c.id)),transformNodes:this.assetsContext.transformNodes.map((c=>c.id))})}getClassName(){return"FlowGraphContext"}}(0,t.e)([(0,u.K)()],m.prototype,"uniqueId",void 0);var Y=D(13406),v=D(11966);class k{constructor(c){this.onEventTriggeredObservable=new B.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=c,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Wa.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const c=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",XD:{timeSinceStart:this._startingTime,deltaTime:c}}),this._startingTime+=c})),this._meshPickedObserver=this._scene.onPointerObservable.add((c=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",XD:c})}),v.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((c=>{const r=c.pointerId,D=c.mesh,W=this._pointerUnderMeshState[r];!W&&D?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",XD:{pointerId:r,mesh:D}}):W&&!D?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",XD:{pointerId:r,mesh:W}}):W&&D&&W!==D&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",XD:{pointerId:r,mesh:W,over:D}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",XD:{pointerId:r,mesh:D,out:W}})),this._pointerUnderMeshState[r]=D}),v.c.POINTERMOVE)}dispose(){var c,r,D,W,B;null===(c=this._sceneDisposeObserver)||void 0===c||c.remove(),null===(r=this._sceneReadyObserver)||void 0===r||r.remove(),null===(D=this._sceneOnBeforeRenderObserver)||void 0===D||D.remove(),null===(W=this._meshPickedObserver)||void 0===W||W.remove(),null===(B=this._meshUnderPointerObserver)||void 0===B||B.remove(),this.onEventTriggeredObservable.clear()}}var w,Z=D(13420);!function(c){c[c.Stopped=0]="Stopped",c[c.Started=1]="Started"}(w||(w={}));class J{get state(){return this._state}set state(c){this._state=c,this.onStateChangedObservable.notifyObservers(c)}constructor(c){this.onStateChangedObservable=new B.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=c.qr,this._sceneEventCoordinator=new k(this._scene),this._coordinator=c.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((c=>{for(const r of this._executionContexts){const D=this._getContextualOrder(c.type,r);for(const W of D)if(!W._executeEvent(r,c.XD))break}switch(c.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const r of this._executionContexts)r._notifyOnTick(c.XD);break;case"SceneDispose":this.dispose()}}))}createContext(){const c=new m({qr:this._scene,coordinator:this._coordinator});return this._executionContexts.push(c),c}getContext(c){return this._executionContexts[c]}addEventBlock(c){if("PointerOver"!==c.type&&"PointerOut"!==c.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==c.type&&this._eventBlocks[c.type].push(c),1===this.state)for(const r of this._executionContexts)c._startPendingTasks(r);else this.onStateChangedObservable.addOnce((r=>{if(1===r)for(const D of this._executionContexts)c._startPendingTasks(D)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((c=>{1===c&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const c of this._executionContexts)for(const r in this._eventBlocks){const D=this._getContextualOrder(r,c);for(const r of D)r._startPendingTasks(c)}}_getContextualOrder(c,r){const D=this._eventBlocks[c].sort(((c,r)=>r.initPriority-c.initPriority));if("MeshPick"===c){const c=[];for(const W of D){const B=W.asset.getValue(r);let t=0;for(;t<D.length;t++){const c=D[t].asset.getValue(r);if(B&&c&&(0,Z.i)(B,c))break}c.splice(t,0,W)}return c}return D}dispose(){var c;if(0!==this.state){this.state=0;for(const c of this._executionContexts)c._clearPendingBlocks();this._executionContexts.length=0;for(const c in this._eventBlocks)this._eventBlocks[c].length=0;null===(c=this._eventObserver)||void 0===c||c.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(c){const r=[],D=new Set;for(const W in this._eventBlocks)for(const c of this._eventBlocks[W])r.push(c),D.add(c.uniqueId);for(;r.length>0;){const W=r.pop();c(W);for(const c of W.dataInputs)for(const W of c._connectedPoint)D.has(W._ownerBlock.uniqueId)||(r.push(W._ownerBlock),D.add(W._ownerBlock.uniqueId));if(W instanceof Y.b)for(const c of W.signalOutputs)for(const W of c._connectedPoint)D.has(W._ownerBlock.uniqueId)||(r.push(W._ownerBlock),D.add(W._ownerBlock.uniqueId))}}serialize(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;c.allBlocks=[],this.visitAllBlocks((r=>{const D={};r.serialize(D),c.allBlocks.push(D)})),c.executionContexts=[];for(const D of this._executionContexts){const W={};D.serialize(W,r),c.executionContexts.push(W)}}}class q{constructor(c){this.config=c,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.qr.Wa.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.qr.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const c=this._executeOnNextFrame.slice(0);if(c.length)for(const r of c){this.notifyCustomEvent(r.id,r.data,!1);const c=this._executeOnNextFrame.findIndex((c=>c.uniqueId===r.uniqueId));-1!==c&&this._executeOnNextFrame.splice(c,1)}}));(q.SceneCoordinators.get(this.config.qr)??[]).push(this)}createGraph(){const c=new J({qr:this.config.qr,coordinator:this});return this._flowGraphs.push(c),c}removeGraph(c){const r=this._flowGraphs.indexOf(c);-1!==r&&(c.dispose(),this._flowGraphs.splice(r,1))}start(){for(const c of this._flowGraphs)c.start()}dispose(){var c,r;for(const B of this._flowGraphs)B.dispose();this._flowGraphs.length=0,null===(c=this._disposeObserver)||void 0===c||c.remove(),null===(r=this._onBeforeRenderObserver)||void 0===r||r.remove();const D=q.SceneCoordinators.get(this.config.qr)??[],W=D.indexOf(this);-1!==W&&D.splice(W,1)}serialize(c,r){c._flowGraphs=[];for(const D of this._flowGraphs){const W={};D.serialize(W,r),c._flowGraphs.push(W)}c.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(c){let r=this._customEventsMap.get(c);return r||(r=new B.c,this._customEventsMap.set(c,r)),r}notifyCustomEvent(c,r){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:c,data:r,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(c)){const r=this._eventExecutionCounter.get(c);if(this._eventExecutionCounter.set(c,r+1),r>=q.MaxEventTypeExecutionPerFrame)return void(r===q.MaxEventTypeExecutionPerFrame&&M.e.Warn(`FlowGraphCoordinator: Too many executions of event "${c}".`))}else this._eventExecutionCounter.set(c,1);const D=this._customEventsMap.get(c);D&&D.notifyObservers(r)}}q.MaxEventsPerType=30,q.MaxEventTypeExecutionPerFrame=30,q.SceneCoordinators=new Map},13426:(c,r,D)=>{"use strict";D.d(r,{d:()=>B});var W=D(13429);class B extends W.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(c){c._notifyExecuteNode(this),this.done._activateSignal(c)}}},13406:(c,r,D)=>{"use strict";D.d(r,{b:()=>a});var W=D(13408),B=D(13414),t=D(11637);class u extends B.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(c){super.connectTo(c),this._connectedPoint.sort(((c,r)=>r.priority-c.priority))}_activateSignal(c){var r;if(null===(r=c.logger)||void 0===r||r.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,XD:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)c._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(c,this),c._increaseExecutionId();else for(const D of this._connectedPoint)D._activateSignal(c)}}(0,t.e)("FlowGraphSignalConnection",u);class a extends W.d{constructor(c){super(c),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(c){const r=new u(c,0,this);return this.signalInputs.push(r),r}_registerSignalOutput(c){const r=new u(c,1,this);return this.signalOutputs.push(r),r}_unregisterSignalInput(c){const r=this.signalInputs.findIndex((r=>r.name===c));-1!==r&&(this.signalInputs[r].dispose(),this.signalInputs.splice(r,1))}_unregisterSignalOutput(c){const r=this.signalOutputs.findIndex((r=>r.name===c));-1!==r&&(this.signalOutputs[r].dispose(),this.signalOutputs.splice(r,1))}_reportError(c,r){this.error.XD="string"===typeof r?new Error(r):r,this.error._activateSignal(c)}getSignalInput(c){return this.signalInputs.find((r=>r.name===c))}getSignalOutput(c){return this.signalOutputs.find((r=>r.name===c))}serialize(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(c),c.signalInputs=[],c.signalOutputs=[];for(const r of this.signalInputs){const D={};r.serialize(D),c.signalInputs.push(D)}for(const r of this.signalOutputs){const D={};r.serialize(D),c.signalOutputs.push(D)}}deserialize(c){for(let r=0;r<c.signalInputs.length;r++){const D=this.getSignalInput(c.signalInputs[r].name);if(!D)throw new Error("Could not find signal input with name "+c.signalInputs[r].name+" in block "+c.className);D.deserialize(c.signalInputs[r])}for(let r=0;r<c.signalOutputs.length;r++){const D=this.getSignalOutput(c.signalOutputs[r].name);if(!D)throw new Error("Could not find signal output with name "+c.signalOutputs[r].name+" in block "+c.className);D.deserialize(c.signalOutputs[r])}}getClassName(){return"FlowGraphExecutionBlock"}}},13431:(c,r,D)=>{"use strict";D.d(r,{d:()=>B});var W=D(13406);class B extends W.b{constructor(c){super(c),this.out=this._registerSignalOutput("out")}}},13392:(c,r,D)=>{"use strict";D.d(r,{A:()=>Y,B:()=>v,E:()=>k,I:()=>N,M:()=>g,O:()=>U,P:()=>y,c:()=>x,e:()=>m,h:()=>e,l:()=>w,m:()=>Z,q:()=>J,u:()=>E,x:()=>X,y:()=>M});var W,B=D(11683),t=D(11722),u=D(13390),a=D(13395);!function(c){c.Any="any",c.String="string",c.Number="number",c.Boolean="boolean",c.Object="object",c.Integer="FlowGraphInteger",c.Vector2="Vector2",c.Zr="Zr",c.Vector4="Vector4",c.Quaternion="Quaternion",c.Matrix="Matrix",c.Matrix2D="Matrix2D",c.Matrix3D="Matrix3D",c.Xr="Xr",c.Xa="Xa"}(W||(W={}));class H{constructor(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=c,this.defaultValue=r,this.animationType=D}serialize(c){c.typeName=this.typeName,c.defaultValue=this.defaultValue}}const x=new H("any",void 0),M=new H("string",""),E=new H("number",0,0),m=new H("boolean",!1),Y=new H("Vector2",B.Vector2.Zero(),5),v=new H("Zr",B.Zr.Zero(),1),k=new H("Vector4",B.Vector4.Zero()),w=new H("Matrix",B.Matrix.Identity(),3),Z=new H("Matrix2D",new a.e),J=new H("Matrix3D",new a.i),q=new H("Xr",t.Xr.Black(),4),j=new H("Xa",new t.Xa(0,0,0,0),7),X=new H("Quaternion",B.Quaternion.Identity(),2);X.typeTransformer=c=>{if(c.getClassName){if("Vector4"===c.getClassName())return B.Quaternion.er(c.Ma());if("Zr"===c.getClassName())return B.Quaternion.FromEulerVector(c);if("Matrix"===c.getClassName())return B.Quaternion.FromRotationMatrix(c)}return c};const e=new H("FlowGraphInteger",new u.d(0),0);function y(c){const r=c;switch(typeof c){case"string":return M;case"number":return E;case"boolean":return m;case"object":if(r.getClassName)switch(r.getClassName()){case"Vector2":return Y;case"Zr":return v;case"Vector4":return k;case"Matrix":return w;case"Xr":return q;case"Xa":return j;case"Quaternion":return X;case"FlowGraphInteger":return e;case"Matrix2D":return Z;case"Matrix3D":return J}return x;default:return x}}function U(c){switch(c){case"string":return M;case"number":return E;case"boolean":return m;case"Vector2":return Y;case"Zr":return v;case"Vector4":return k;case"Matrix":return w;case"Xr":return q;case"Xa":return j;case"Quaternion":return X;case"FlowGraphInteger":return e;case"Matrix2D":return Z;case"Matrix3D":return J;default:return x}}function N(c){switch(c){case"number":default:return 0;case"Vector2":return 5;case"Zr":return 1;case"Matrix":return 3;case"Xr":return 4;case"Xa":return 7;case"Quaternion":return 2}}function g(c){switch(c){case 0:return E;case 5:return Y;case 1:return v;case 3:return w;case 4:return q;case 7:return j;case 2:return X;default:return x}}},13388:(c,r,D)=>{"use strict";D.d(r,{d:()=>M,f:()=>x,i:()=>E});var W=D(11722),B=D(11683),t=D(13390),u=D(13392),a=D(13395);function H(c){return"Vector2"===c||"Zr"===c||"Vector4"===c||"Quaternion"===c||"Xr"===c||"Xa"===c}function x(c,r,D){var W;const B=(null===r||void 0===r||null===(W=r.getClassName)||void 0===W?void 0:W.call(r))??"";if(H(B)||function(c){return"Matrix"===c||"Matrix2D"===c||"Matrix3D"===c}(B))D[c]={value:r.Ma(),className:B};else if("FlowGraphInteger"===B)D[c]={value:r.value,className:B};else if(B&&(r.id||r.name))D[c]={id:r.id,name:r.name,className:B};else{if("object"===typeof r)throw new Error(`Could not serialize value ${r}`);D[c]=r}}function M(c,r,D,x){const E=r[c];let m;const Y=(null===E||void 0===E?void 0:E.type)??(null===E||void 0===E?void 0:E.className);if(function(c){return"Mesh"===c||"AbstractMesh"===c||"GroundMesh"===c||"InstanceMesh"===c||"LinesMesh"===c||"GoldbergMesh"===c||"GreasedLineMesh"===c||"TrailMesh"===c}(Y)){let c=x.meshes.filter((c=>E.id?c.id===E.id:c.name===E.name));0===c.length&&(c=x.transformNodes.filter((c=>E.id?c.id===E.id:c.name===E.name))),m=E.uniqueId?c.find((c=>c.uniqueId===E.uniqueId)):c[0]}else if(H(Y))m=function(c,r){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===c)return B.Vector2.er(r);if("Zr"===c)return D&&(r[2]*=-1),B.Zr.er(r);if("Vector4"===c)return B.Vector4.er(r);if("Quaternion"===c)return D&&(r[2]*=-1,r[3]*=-1),B.Quaternion.er(r);if("Xr"===c)return new W.Xr(r[0],r[1],r[2]);if("Xa"===c)return new W.Xa(r[0],r[1],r[2],r[3]);throw new Error(`Unknown vector class name ${c}`)}(Y,E.value);else if(function(c){return"AnimationGroup"===c}(Y)){const c=x.animationGroups.filter((c=>c.name===E.name));m=1===c.length?c[0]:c.find((c=>c.uniqueId===E.uniqueId))}else m="Matrix"===Y?B.Matrix.er(E.value):"Matrix2D"===Y?new a.e(E.value):"Matrix3D"===Y?new a.i(E.value):"FlowGraphInteger"===Y?t.d.FromValue(E.value):"number"===Y||"string"===Y||"boolean"===Y?E.value[0]:E&&void 0!==E.value?E.value:Array.isArray(E)?E.reduce(((c,r)=>r.eventData?(c[r.id]={type:(0,u.O)(r.type)},"undefined"!==typeof r.value&&(c[r.id].value=M("value",r,D,x)),c):c),{}):E;return m}function E(c){return"FlowGraphJsonPointerParserBlock"===c}},13420:(c,r,D)=>{"use strict";function W(c,r){return!(!c.parent||c.parent!==r&&!W(c.parent,r))}function B(c){if(c.getClassName)return c.getClassName()}function t(c,r){return c===r&&("Vector2"===c||"Zr"===c||"Vector4"===c||"Quaternion"===c)}function u(c,r){return c===r&&("Matrix"===c||"Matrix2D"===c||"Matrix3D"===c)}function a(c,r){return"FlowGraphInteger"===c&&"FlowGraphInteger"===r}function H(c,r){const D="number"===typeof c||"number"===typeof(null===c||void 0===c?void 0:c.value);return D&&!r?!isNaN(x(c)):D}function x(c){return"number"===typeof c?c:c.value}D.d(r,{b:()=>a,c:()=>u,d:()=>t,f:()=>B,i:()=>W,j:()=>x,m:()=>H})},12784:(c,r,D)=>{"use strict";D.r(r),D.d(r,{SceneInstrumentation:()=>t});var W=D(11487),B=D(11902);class t{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(c){c!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=c,c?(this._onBeforeActiveMeshesEvaluationObserver=this.qr.onBeforeActiveMeshesEvaluationObservable.add((()=>{W.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.qr.onAfterActiveMeshesEvaluationObservable.add((()=>{W.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.qr.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.qr.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(c){c!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=c,c?(this._onBeforeRenderTargetsRenderObserver=this.qr.onBeforeRenderTargetsRenderObservable.add((()=>{W.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.qr.onAfterRenderTargetsRenderObservable.add((()=>{W.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.qr.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.qr.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(c){c!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=c,c?(this._onBeforeParticlesRenderingObserver=this.qr.onBeforeParticlesRenderingObservable.add((()=>{W.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.qr.onAfterParticlesRenderingObservable.add((()=>{W.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.qr.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.qr.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(c){c!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=c,this.qr.spriteManagers&&(c?(this._onBeforeSpritesRenderingObserver=this.qr.onBeforeSpritesRenderingObservable.add((()=>{W.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.qr.onAfterSpritesRenderingObservable.add((()=>{W.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.qr.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.qr.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(c){c!==this._capturePhysicsTime&&this.qr.onBeforePhysicsObservable&&(this._capturePhysicsTime=c,c?(this._onBeforePhysicsObserver=this.qr.onBeforePhysicsObservable.add((()=>{W.Tools.StartPerformanceCounter("iv"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.qr.onAfterPhysicsObservable.add((()=>{W.Tools.EndPerformanceCounter("iv"),this._physicsTime.endMonitoring()}))):(this.qr.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.qr.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(c){c!==this._captureAnimationsTime&&(this._captureAnimationsTime=c,c?this._onAfterAnimationsObserver=this.qr.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.qr.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(c){this._captureFrameTime=c}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(c){this._captureInterFrameTime=c}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(c){c!==this._captureRenderTime&&(this._captureRenderTime=c,c?(this._onBeforeDrawPhaseObserver=this.qr.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),W.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.qr.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),W.Tools.EndPerformanceCounter("Main render")}))):(this.qr.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.qr.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(c){c!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=c,c?(this._onBeforeCameraRenderObserver=this.qr.onBeforeCameraRenderObservable.add((c=>{this._cameraRenderTime.beginMonitoring(),W.Tools.StartPerformanceCounter(`Rendering camera ${c.name}`)})),this._onAfterCameraRenderObserver=this.qr.onAfterCameraRenderObservable.add((c=>{this._cameraRenderTime.endMonitoring(!1),W.Tools.EndPerformanceCounter(`Rendering camera ${c.name}`)}))):(this.qr.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.qr.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.qr.getEngine()._drawCalls}constructor(c){this.qr=c,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new B.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new B.b,this._captureFrameTime=!1,this._frameTime=new B.b,this._captureRenderTime=!1,this._renderTime=new B.b,this._captureInterFrameTime=!1,this._interFrameTime=new B.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new B.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new B.b,this._capturePhysicsTime=!1,this._physicsTime=new B.b,this._captureAnimationsTime=!1,this._animationsTime=new B.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new B.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=c.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(W.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.qr.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=c.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(W.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Da(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Da(),this._captureParticlesRenderTime&&this._particlesRenderTime.Da(),this._captureSpritesRenderTime&&this._spritesRenderTime.Da(),this._captureRenderTime&&this._renderTime.Da(),this._captureCameraRenderTime&&this._cameraRenderTime.Da()}))}dispose(){this._disposed||(this.qr.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.qr.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.qr.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.qr.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.qr.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.qr.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.qr.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.qr.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.qr.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.qr.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.qr.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.qr.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.qr.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.qr.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.qr.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.qr.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.qr.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.qr=null,this._disposed=!0)}}},13381:(c,r,D)=>{"use strict";D.d(r,{d:()=>M});var W=D(11664),B=D(11669),t=D(11683),u=D(12102),a=D(12218),H=D(12275),x=D(11637);u.c.AddNodeConstructor("Light_Type_1",((c,r)=>()=>new M(c,t.Zr.Zero(),r)));class M extends H.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(c){this._shadowFrustumSize=c,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(c){this._shadowOrthoScale=c,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(c){this._orthoLeft=c}get orthoRight(){return this._orthoRight}set orthoRight(c){this._orthoRight=c}get orthoTop(){return this._orthoTop}set orthoTop(c){this._orthoTop=c}get orthoBottom(){return this._orthoBottom}set orthoBottom(c){this._orthoBottom=c}constructor(c,r,D){super(c,D),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=r.scale(-1),this.direction=r}getClassName(){return"nv"}getTypeID(){return a.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(c,r,D){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(c):this._setDefaultAutoExtendShadowProjectionMatrix(c,r,D)}_setDefaultFixedFrustumShadowProjectionMatrix(c){const r=this.yc().activeCamera;r&&t.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:r.ma,void 0!==this.shadowMaxZ?this.shadowMaxZ:r.maxZ,c,this.yc().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(c,r,D){const W=this.yc().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const c=t.Zr.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let W=Number.MAX_VALUE,B=-Number.MAX_VALUE;for(let u=0;u<D.length;u++){const a=D[u];if(!a)continue;const H=a.getBoundingInfo().boundingBox;for(let D=0;D<H.vectorsWorld.length;D++)t.Zr.TransformCoordinatesToRef(H.vectorsWorld[D],r,c),c.x<this._orthoLeft&&(this._orthoLeft=c.x),c.y<this._orthoBottom&&(this._orthoBottom=c.y),c.x>this._orthoRight&&(this._orthoRight=c.x),c.y>this._orthoTop&&(this._orthoTop=c.y),this.autoCalcShadowZBounds&&(c.z<W&&(W=c.z),c.z>B&&(B=c.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=W,this._shadowMaxZ=B)}const B=this._orthoRight-this._orthoLeft,u=this._orthoTop-this._orthoBottom,a=void 0!==this.shadowMinZ?this.shadowMinZ:(null===W||void 0===W?void 0:W.ma)||0,H=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===W||void 0===W?void 0:W.maxZ)||1e4,x=this.yc().getEngine().useReverseDepthBuffer;t.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-B*this.shadowOrthoScale,this._orthoRight+B*this.shadowOrthoScale,this._orthoBottom-u*this.shadowOrthoScale,this._orthoTop+u*this.shadowOrthoScale,x?H:a,x?a:H,c,this.yc().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(c,r){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,r),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,r),this)}transferToNodeMaterialEffect(c,r){return this.computeTransformedInformation()?(c.setFloat3(r,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(c.setFloat3(r,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(c){const r=this._scene.getEngine();return!r.useReverseDepthBuffer&&r.isNDCHalfZRange?0:1}getDepthMaxZ(c){const r=this._scene.getEngine();return r.useReverseDepthBuffer&&r.isNDCHalfZRange?0:1}prepareLightSpecificDefines(c,r){c["DIRLIGHT"+r]=!0}}(0,W.e)([(0,B.K)()],M.prototype,"shadowFrustumSize",null),(0,W.e)([(0,B.K)()],M.prototype,"shadowOrthoScale",null),(0,W.e)([(0,B.K)()],M.prototype,"autoUpdateExtends",void 0),(0,W.e)([(0,B.K)()],M.prototype,"autoCalcShadowZBounds",void 0),(0,W.e)([(0,B.K)("orthoLeft")],M.prototype,"_orthoLeft",void 0),(0,W.e)([(0,B.K)("orthoRight")],M.prototype,"_orthoRight",void 0),(0,W.e)([(0,B.K)("orthoTop")],M.prototype,"_orthoTop",void 0),(0,W.e)([(0,B.K)("orthoBottom")],M.prototype,"_orthoBottom",void 0),(0,x.e)("BABYLON.DirectionalLight",M)},13867:(c,r,D)=>{"use strict";D.d(r,{e:()=>M});var W=D(11664),B=D(11669),t=D(11683),u=D(11722),a=D(12102),H=D(12218),x=D(11637);a.c.AddNodeConstructor("Light_Type_3",((c,r)=>()=>new M(c,t.Zr.Zero(),r)));class M extends H.b{constructor(c,r,D){super(c,D),this.groundColor=new u.Xr(0,0,0),this.direction=r||t.Zr.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Vv"}setDirectionToTarget(c){return this.direction=t.Zr.Normalize(c.Jr(t.Zr.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(c,r){const D=t.Zr.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",D.x,D.y,D.z,0,r),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Ua),r),this}transferToNodeMaterialEffect(c,r){const D=t.Zr.Normalize(this.direction);return c.setFloat3(r,D.x,D.y,D.z),this}va(){return this._worldMatrix||(this._worldMatrix=t.Matrix.Identity()),this._worldMatrix}getTypeID(){return H.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(c,r){c["HEMILIGHT"+r]=!0}}(0,W.e)([(0,B.i)()],M.prototype,"groundColor",void 0),(0,W.e)([(0,B.J)()],M.prototype,"direction",void 0),(0,x.e)("BABYLON.HemisphericLight",M)},13339:(c,r,D)=>{"use strict";D.d(r,{e:()=>E});var W=D(11664),B=D(11669),t=D(11683),u=D(12102),a=D(12218),H=D(12275),x=D(11656),M=D(11637);u.c.AddNodeConstructor("Light_Type_2",((c,r)=>()=>new E(c,t.Zr.Zero(),t.Zr.Zero(),0,0,r)));class E extends H.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(c){this._iesProfileTexture!==c&&(this._iesProfileTexture=c,this._iesProfileTexture&&E._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(c){this._angle=c,this._cosHalfAngle=Math.cos(.5*c),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(c){this._innerAngle=c,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(c){this._shadowAngleScale=c,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(c){this._projectionTextureLightNear=c,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(c){this._projectionTextureLightFar=c,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(c){this._projectionTextureUpDirection=c,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(c){this._projectionTexture!==c&&(this._projectionTexture=c,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(E._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):E._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(c){return void 0!==c.onGeneratedObservable}static _IsTexture(c){return void 0!==c.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(c){this._projectionTextureProjectionLightMatrix=c,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(c,r,D,W,B,u){super(c,u),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=t.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=t.Zr.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=t.Zr.Zero(),this._projectionTextureViewLightMatrix=t.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=t.Matrix.Zero(),this._projectionTextureScalingMatrix=t.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=r,this.direction=D,this.angle=W,this.exponent=B}getClassName(){return"SpotLight"}getTypeID(){return a.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(c){super._setDirection(c),this._projectionTextureViewLightDirty=!0}_setPosition(c){super._setPosition(c),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(c,r,D){const W=this.yc().activeCamera;if(!W)return;this._shadowAngleScale=this._shadowAngleScale||1;const B=this._shadowAngleScale*this._angle,u=void 0!==this.shadowMinZ?this.shadowMinZ:W.ma,a=void 0!==this.shadowMaxZ?this.shadowMaxZ:W.maxZ,H=this.yc().getEngine().useReverseDepthBuffer;t.Matrix.PerspectiveFovLHToRef(B,1,H?a:u,H?u:a,c,!0,this._scene.getEngine().isNDCHalfZRange,void 0,H)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),t.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const c=this.projectionTextureLightFar,r=this.projectionTextureLightNear,D=c/(c-r),W=-D*r,B=1/Math.tan(this._angle/2);t.Matrix.FromValuesToRef(B/1,0,0,0,0,B,0,0,0,0,D,1,0,0,W,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof x.b){const c=this._projectionTexture.uScale/2,r=this._projectionTexture.vScale/2;t.Matrix.FromValuesToRef(c,0,0,0,0,r,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(c,r){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),c.setMatrix("textureProjectionMatrix"+r,this._projectionTextureMatrix),c.setTexture("projectionLightTexture"+r,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&c.setTexture("iesLightTexture"+r,this._iesProfileTexture),this}transferToEffect(c,r){let D;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,r),D=t.Zr.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,r),D=t.Zr.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",D.x,D.y,D.z,this._cosHalfAngle,r),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,r),this}transferToNodeMaterialEffect(c,r){let D;return D=this.computeTransformedInformation()?t.Zr.Normalize(this.transformedDirection):t.Zr.Normalize(this.direction),this.yc().useRightHandedSystem?c.setFloat3(r,-D.x,-D.y,-D.z):c.setFloat3(r,D.x,D.y,D.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(c){const r=this._scene.getEngine(),D=void 0!==this.shadowMinZ?this.shadowMinZ:(null===c||void 0===c?void 0:c.ma)??0;return r.useReverseDepthBuffer&&r.isNDCHalfZRange?D:this._scene.getEngine().isNDCHalfZRange?0:D}getDepthMaxZ(c){const r=this._scene.getEngine(),D=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===c||void 0===c?void 0:c.maxZ)??1e4;return r.useReverseDepthBuffer&&r.isNDCHalfZRange?0:D}prepareLightSpecificDefines(c,r){c["SPOTLIGHT"+r]=!0,c["PROJECTEDLIGHTTEXTURE"+r]=!(!this.projectionTexture||!this.projectionTexture.isReady()),c["IESLIGHTTEXTURE"+r]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,W.e)([(0,B.K)()],E.prototype,"angle",null),(0,W.e)([(0,B.K)()],E.prototype,"innerAngle",null),(0,W.e)([(0,B.K)()],E.prototype,"shadowAngleScale",null),(0,W.e)([(0,B.K)()],E.prototype,"exponent",void 0),(0,W.e)([(0,B.K)()],E.prototype,"projectionTextureLightNear",null),(0,W.e)([(0,B.K)()],E.prototype,"projectionTextureLightFar",null),(0,W.e)([(0,B.K)()],E.prototype,"projectionTextureUpDirection",null),(0,W.e)([(0,B.F)("projectedLightTexture")],E.prototype,"_projectionTexture",void 0),(0,M.e)("BABYLON.SpotLight",E)},13060:(c,r,D)=>{"use strict";D.d(r,{b:()=>u,c:()=>t,e:()=>a});const W={},B={};function t(c,r){W[c]=r}function u(c,r){B[c]=r}function a(c){return B[c]?B[c]:null}},12969:(c,r,D)=>{"use strict";D.d(r,{c:()=>y,e:()=>P});var W,B=D(11487),t=D(11494),u=D(11924),a=D(11538),H=D(11509),x=D(12152),M=D(11545),E=D(11550),m=D(11646),Y=D(11584),v=D(11532);!function(c){c[c.Clean=0]="Clean",c[c.Stop=1]="Stop",c[c.Sync=2]="Sync",c[c.NoSync=3]="NoSync"}(W||(W={}));const k=new t.c,w={};let Z=!1;function J(){return w[".babylon"]}function q(c,r){const D=w[c];return D||(H.e.Warn("Unable to find a plugin to load "+c+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),r?J():void 0)}function j(c,r,D){let W="Unable to load from "+(c.rawData?"binary data":c.url);return r?W+=`: ${r}`:D&&(W+=`: ${D}`),W}async function X(c,r,D,W,B,t,u,a,H){var x;const E="data:"===(m=c.url).substring(0,5)?m.substring(5):null;var m;if(c.rawData&&!u)throw"When using ArrayBufferView to load data the file extension must be provided.";const Z=E||u?"":function(c){const r=c.indexOf("?");-1!==r&&(c=c.substring(0,r));const D=c.lastIndexOf(".");return c.substring(D,c.length).toLowerCase()}(c.url);let j=u?q(u,!0):E?function(c){for(const r in w){const D=w[r].plugin;if(D.canDirectLoad&&D.canDirectLoad(c))return w[r]}return J()}(c.url):q(Z,!1);if(!j&&Z){if(c.url&&!c.url.startsWith("blob:")){const r=await async function(c,r){const D=r.method||"GET";return await new Promise(((W,B)=>{const t=new v.d;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const c={};if(r.responseHeaders)for(const D of r.responseHeaders)c[D]=t.getResponseHeader(D)||"";W({response:t.response,headerValues:c})}else B(`Unable to fetch data from ${c}. Error code: ${t.status}`)})),t.open(D,c),t.send()}))}(c.url,{method:"HEAD",responseHeaders:["Content-Type"]}),D=r.headerValues?r.headerValues["Content-Type"]:"";D&&(j=function(c){for(const r in w){const D=w[r];if(D.mimeType===c)return D}}(D))}j||(j=J())}if(!j)throw new Error(`No plugin or fallback for ${u??c.url}`);if(!1===(null===H||void 0===H||null===(x=H[j.plugin.name])||void 0===x?void 0:x.enabled))throw new Error(`The '${j.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(c.rawData&&!j.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(c=>{if(j.plugin.createPlugin){const r=j.plugin.createPlugin(H??{});return r instanceof Promise?(r.then(c).catch((c=>{B("Error instantiating plugin.",c)})),null):(c(r),r)}return c(j.plugin),j.plugin})((H=>{var x;if(!H)throw`The loader plugin corresponding to the '${u}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(k.notifyObservers(H),E&&(H.canDirectLoad&&H.canDirectLoad(c.url)||!(0,M.j)(c.url))){if(H.directLoad){const c=H.directLoad(r,E);c instanceof Promise?c.then((c=>{D(H,c)})).catch((c=>{B("Error in directLoad of _loadData: "+c,c)})):D(H,c)}else D(H,E);return}const m=j.isBinary,v=(c,W)=>{r.M?B("Scene has been disposed"):D(H,c,W)};let w=null,Z=!1;null===(x=H.Wa)||void 0===x||x.add((()=>{Z=!0,w&&(w.abort(),w=null),t()}));const J=()=>{if(Z)return;const D=(c,r)=>{B(null===c||void 0===c?void 0:c.statusText,r)};if(!H.loadFile&&c.rawData)throw"Plugin does not support loading ArrayBufferView.";w=H.loadFile?H.loadFile(r,c.rawData||c.file||c.url,c.rootUrl,v,W,m,D,a):r._loadFile(c.file||c.url,v,W,!0,m,D)},q=r.getEngine();let X=q.enableOfflineSupport;if(X){let D=!1;for(const W of r.disableOfflineSupportExceptionRules)if(W.test(c.url)){D=!0;break}X=!D}X&&Y.b.OfflineProviderFactory?r.offlineProvider=Y.b.OfflineProviderFactory(c.url,J,q.disableManifestCheck):J()}))}function e(c,r){let D,W,t=null,u=null;if(r)if(r.name)D=`file:${r.name}`,W=r.name,t=r;else if(ArrayBuffer.isView(r))D="",W=(0,m.c)(),u=r;else if(r.startsWith("data:"))D=r,W="";else if(c){const t=r;if("/"===t.substring(0,1))return B.Tools.Error("Wrong sceneFilename parameter"),null;D=c+t,W=t}else D=r,W=B.Tools.GetFilename(r),c=B.Tools.GetFolderPath(r);else D=c,W=B.Tools.GetFilename(c),c=B.Tools.GetFolderPath(c);return{url:D,rootUrl:c,name:W,file:t,rawData:u}}function y(c){if("string"===typeof c.extensions){const r=c.extensions;w[r.toLowerCase()]={plugin:c,isBinary:!1}}else{const r=c.extensions,D=Object.keys(r);for(const W of D)w[W.toLowerCase()]={plugin:c,isBinary:r[W].isBinary,mimeType:r[W].mimeType}}}async function U(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.c.LastCreatedScene,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!W)return H.e.Error("No scene available to import mesh to"),null;const Y=e(r,D);if(!Y)return null;const v={};W.addPendingData(v);const k=()=>{W.removePendingData(v)},w=(c,r)=>{const D=j(Y,c,r);u?u(W,D,new E.k(D,E.g.SceneLoaderError,r)):H.e.Error(D),k()},Z=t?c=>{try{t(c)}catch(r){w("Error in onProgress callback: "+r,r)}}:void 0,J=(c,r,D,t,u,a,H,x)=>{if(W.importedMeshesFiles.push(Y.url),B)try{B(c,r,D,t,u,a,H,x)}catch(M){w("Error in onSuccess callback: "+M,M)}W.removePendingData(v)};return await X(Y,W,((r,D,B)=>{if(r.rewriteRootURL&&(Y.rootUrl=r.rewriteRootURL(Y.rootUrl,B)),r.importMesh){const B=[],t=[],u=[];if(!r.importMesh(c,W,D,Y.rootUrl,B,t,u,w))return;W.loadingPluginName=r.name,J(B,t,u,[],[],[],[],[])}else{r.importMeshAsync(c,W,D,Y.rootUrl,Z,Y.name).then((c=>{W.loadingPluginName=r.name,J(c.meshes,c.rm,c.skeletons,c.animationGroups,c.transformNodes,c.geometries,c.lights,c.spriteManagers)})).catch((c=>{w(c.message,c)}))}}),Z,w,k,x,M,m)}async function N(c,r,D,W,B,t,u,a){return await new Promise(((H,x)=>{try{U(c,r,D,W,((c,r,D,W,B,t,u,a)=>{H({meshes:c,rm:r,skeletons:D,animationGroups:W,transformNodes:B,geometries:t,lights:u,spriteManagers:a})}),B,((c,r,D)=>{x(D||new Error(r))}),t,u,a).catch(x)}catch(E){x(E)}}))}async function g(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.c.LastCreatedEngine,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};D?await S(c,r,new u.b(D),W,t,H,x,M,E):B.Tools.Error("No engine available")}async function z(c,r,D,W,B,t,u){return await new Promise(((a,H)=>{g(c,r,D,(c=>{a(c)}),W,((c,r,D)=>{H(D||new Error(r))}),B,t,u)}))}async function S(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.c.LastCreatedScene,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",m=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!D)return H.e.Error("No scene available to append to"),null;const Y=e(c,r);if(!Y)return null;const v={};D.addPendingData(v);const k=()=>{D.removePendingData(v)};x.c.ShowLoadingScreen&&!Z&&(Z=!0,D.getEngine().displayLoadingUI(),D.executeWhenReady((()=>{D.getEngine().hideLoadingUI(),Z=!1})));const w=(c,r)=>{const W=j(Y,c,r);t?t(D,W,new E.k(W,E.g.SceneLoaderError,r)):H.e.Error(W),k()},J=B?c=>{try{B(c)}catch(r){w("Error in onProgress callback",r)}}:void 0,q=()=>{if(W)try{W(D)}catch(c){w("Error in onSuccess callback",c)}D.removePendingData(v)};return await X(Y,D,((c,r)=>{if(c.load){if(!c.load(D,r,Y.rootUrl,w))return;D.loadingPluginName=c.name,q()}else{c.loadAsync(D,r,Y.rootUrl,J,Y.name).then((()=>{D.loadingPluginName=c.name,q()})).catch((c=>{w(c.message,c)}))}}),J,w,k,u,M,m)}async function K(c,r,D,W,B,t,u){return await new Promise(((a,H)=>{try{S(c,r,D,(c=>{a(c)}),W,((c,r,D)=>{H(D||new Error(r))}),B,t,u).catch(H)}catch(E){H(E)}}))}async function f(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.c.LastCreatedScene,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!D)return H.e.Error("No scene available to load asset container to"),null;const m=e(c,r);if(!m)return null;const Y={};D.addPendingData(Y);const v=()=>{D.removePendingData(Y)},k=(c,r)=>{const W=j(m,c,r);t?t(D,W,new E.k(W,E.g.SceneLoaderError,r)):H.e.Error(W),v()},w=B?c=>{try{B(c)}catch(r){k("Error in onProgress callback",r)}}:void 0,Z=c=>{if(W)try{W(c)}catch(r){k("Error in onSuccess callback",r)}D.removePendingData(Y)};return await X(m,D,((c,r)=>{if(c.loadAssetContainer){const W=c.loadAssetContainer(D,r,m.rootUrl,k);if(!W)return;W.populateRootNodes(),D.loadingPluginName=c.name,Z(W)}else if(c.loadAssetContainerAsync){c.loadAssetContainerAsync(D,r,m.rootUrl,w,m.name).then((r=>{r.populateRootNodes(),D.loadingPluginName=c.name,Z(r)})).catch((c=>{k(c.message,c)}))}else k("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),w,k,v,u,x,M)}async function A(c,r,D,W,B,t,u){return await new Promise(((a,H)=>{try{f(c,r,D,(c=>{a(c)}),W,((c,r,D)=>{H(D||new Error(r))}),B,t,u).catch(H)}catch(E){H(E)}}))}async function h(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.c.LastCreatedScene,W=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,m=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!D)return void H.e.Error("No scene available to load animations to");if(W){for(const W of D.animatables)W.reset();D.stopAllAnimations();const c=D.animationGroups.slice();for(const D of c)D.dispose();const r=D.getNodes();for(const D of r)D.animations&&(D.animations=[])}else switch(B){case 0:const c=D.animationGroups.slice();for(const r of c)r.dispose();break;case 1:for(const r of D.animationGroups)r.stop();break;case 2:for(const r of D.animationGroups)r.reset(),r.restart();break;case 3:break;default:return void H.e.Error("Unknown animation group loading mode value '"+B+"'")}const v=D.animatables.length;await f(c,r,D,(c=>{c.mergeAnimationsTo(D,D.animatables.slice(v),t),c.dispose(),D.onAnimationFileImportedObservable.notifyObservers(D),u&&u(D)}),x,M,E,m,Y)}async function L(c,r,D,W,B,t,u,a,H,x){return await new Promise(((M,m)=>{try{h(c,r,D,W,B,t,(c=>{M(c)}),u,((c,r,D)=>{m(D||new Error(r))}),a,H,x).catch(m)}catch(E){m(E)}}))}class P{static get ForceFullSceneLoadingForIncremental(){return x.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(c){x.c.ForceFullSceneLoadingForIncremental=c}static get ShowLoadingScreen(){return x.c.ShowLoadingScreen}static set ShowLoadingScreen(c){x.c.ShowLoadingScreen=c}static get loggingLevel(){return x.c.loggingLevel}static set loggingLevel(c){x.c.loggingLevel=c}static get CleanBoneMatrixWeights(){return x.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(c){x.c.CleanBoneMatrixWeights=c}static GetDefaultPlugin(){return J()}static GetPluginForExtension(c){var r;return null===(r=q(c,!0))||void 0===r?void 0:r.plugin}static IsPluginForExtensionAvailable(c){return function(c){return!!w[c]}(c)}static RegisterPlugin(c){y(c)}static ImportMesh(c,r,D,W,B,t,u,H,x){U(c,r,D,W,B,t,u,H,x).catch((c=>null===u||void 0===u?void 0:u(a.c.LastCreatedScene,null===c||void 0===c?void 0:c.message,c)))}static async ImportMeshAsync(c,r,D,W,B,t,u){return await N(c,r,D,W,B,t,u)}static Load(c,r,D,W,B,t,u,H){g(c,r,D,W,B,t,u,H).catch((c=>null===t||void 0===t?void 0:t(a.c.LastCreatedScene,null===c||void 0===c?void 0:c.message,c)))}static async LoadAsync(c,r,D,W,B,t){return await z(c,r,D,W,B,t)}static Append(c,r,D,W,B,t,u,H){S(c,r,D,W,B,t,u,H).catch((c=>null===t||void 0===t?void 0:t(D??a.c.LastCreatedScene,null===c||void 0===c?void 0:c.message,c)))}static async AppendAsync(c,r,D,W,B,t){return await K(c,r,D,W,B,t)}static LoadAssetContainer(c,r,D,W,B,t,u,H){f(c,r,D,W,B,t,u,H).catch((c=>null===t||void 0===t?void 0:t(D??a.c.LastCreatedScene,null===c||void 0===c?void 0:c.message,c)))}static async LoadAssetContainerAsync(c,r,D,W,B,t){return await A(c,r,D,W,B,t)}static ImportAnimations(c,r,D,W,B,t,u,H,x,M,E){h(c,r,D,W,B,t,u,H,x,M,E).catch((c=>null===x||void 0===x?void 0:x(D??a.c.LastCreatedScene,null===c||void 0===c?void 0:c.message,c)))}static async ImportAnimationsAsync(c,r,D,W,B,t,u,a,H,x,M){return await L(c,r,D,W,B,t,a,x,M)}}P.NO_LOGGING=0,P.MINIMAL_LOGGING=1,P.SUMMARY_LOGGING=2,P.DETAILED_LOGGING=3,P.OnPluginActivatedObservable=k},13355:(c,r,D)=>{"use strict";D.d(r,{e:()=>m});var W=D(11664),B=D(11669),t=D(11487),u=D(11683),a=D(11705),H=D(11656),x=D(11637),M=D(11494),E=D(11717);D(13364);class m extends a.c{set boundingBoxSize(c){if(this._boundingBoxSize&&this._boundingBoxSize.equals(c))return;this._boundingBoxSize=c;const r=this.yc();r&&r.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(c){this._rotationY=c,this.setReflectionTextureMatrix(u.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(c,r,D){let W="";for(const B of c)W+=B;return new m(W,r,null,D,c)}static CreateFromPrefilteredData(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,W=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const B=r.useDelayedTextureLoading;r.useDelayedTextureLoading=!1;const t=new m(c,r,null,!1,null,null,null,void 0,!0,D,W);return r.useDelayedTextureLoading=B,t}constructor(c,r){var D;let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,m=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,v=arguments.length>10&&void 0!==arguments[10]&&arguments[10],k=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,w=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,Z=arguments.length>13?arguments[13]:void 0,J=arguments.length>14?arguments[14]:void 0;super(r),this.onLoadObservable=new M.c,this.boundingBoxPosition=u.Zr.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new u.Matrix,this._buffer=null,this.name=c,this.url=c,this._noMipmap=B,this.Ea=!1,this.isCube=!0,this._textureMatrix=u.Matrix.Identity(),this.coordinatesMode=H.b.CUBIC_MODE;let q=null,j=null;null===W||Array.isArray(W)?(this._noMipmap=B,this._format=E,this._createPolynomials=v,q=W,this._loaderOptions=Z,this._useSRGBBuffer=J,this._lodScale=k,this._lodOffset=w):(q=W.extensions??null,this._noMipmap=W.noMipmap??!1,t=W.files??null,j=W.buffer??null,this._format=W.format??5,m=W.prefiltered??!1,Y=W.forcedExtension??null,this._createPolynomials=W.createPolynomials??!1,this._lodScale=W.lodScale??.8,this._lodOffset=W.lodOffset??0,this._loaderOptions=W.loaderOptions,this._useSRGBBuffer=W.useSRGBBuffer,a=W.F??null,x=W.onError??null),(c||t)&&this.updateURL(c,Y,a,m,x,q,null===(D=this.yc())||void 0===D?void 0:D.useDelayedTextureLoading,t,j)}getClassName(){return"CubeTexture"}updateURL(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,W=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=c),this.url=c,r&&(this._forcedExtension=r);const x=c.lastIndexOf("."),M=r||(x>-1?c.substring(x).toLowerCase():""),E=0===M.indexOf(".dds"),m=0===M.indexOf(".env"),Y=0===M.indexOf(".basis");if(m?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=W,W&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),a)this._files=a;else if(Y||m||E||t||(t=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,t){for(let r=0;r<t.length;r++)this._files.push(c+t[r]);this._extensions=t}this._buffer=H,u?(this.delayLoadState=4,this._delayedOnLoad=D,this._delayedOnError=B):this._loadTexture(D,B)}delayLoad(c){4===this.delayLoadState&&(c&&(this._forcedExtension=c),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(c){var r,D;if(c.updateFlag===this._textureMatrix.updateFlag)return;c.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(D=this.yc())||void 0===D||D.markAllMaterialsAsDirty(1,(c=>-1!==c.getActiveTextures().indexOf(this))));if(this._textureMatrix=c,null===(r=this.yc())||void 0===r||!r.useRightHandedSystem)return;const W=u.TmpVectors.Zr[0],B=u.TmpVectors.Quaternion[0],t=u.TmpVectors.Zr[1];this._textureMatrix.decompose(W,B,t),B.z*=-1,B.w*=-1,u.Matrix.ComposeToRef(W,B,t,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var c;return null!==(c=this.yc())&&void 0!==c&&c.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=this.yc(),W=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const B=()=>{var r;(this.onLoadObservable.notifyObservers(this),W)&&(W.dispose(),null===(r=this.yc())||void 0===r||r.markAllMaterialsAsDirty(1));c&&c()},u=(c,D)=>{this._loadingError=!0,this._errorObject={message:c,exception:D},r&&r(c,D),H.b.OnTextureLoadErrorObservable.notifyObservers(this)};var a;this._texture?this._texture.isReady?t.Tools.SetImmediate((()=>B())):this._texture.onLoadedObservable.add((()=>B())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,D,this._lodScale,this._lodOffset,c,u,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,D,this._files,this._noMipmap,c,u,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(a=this._texture)||void 0===a||a.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(c,r,D){const W=E.d.Parse((()=>{let W=!1;return c.prefiltered&&(W=c.prefiltered),new m(D+(c.url??c.name),r,c.extensions,!1,c.files||null,null,null,void 0,W,c.forcedExtension)}),c,r);if(c.boundingBoxPosition&&(W.boundingBoxPosition=u.Zr.er(c.boundingBoxPosition)),c.boundingBoxSize&&(W.boundingBoxSize=u.Zr.er(c.boundingBoxSize)),c.animations)for(let B=0;B<c.animations.length;B++){const r=c.animations[B],D=(0,x.b)("BABYLON.Animation");D&&W.animations.push(D.Parse(r))}return W}clone(){let c=0;const r=E.d.Clone((()=>{const r=new m(this.url,this.yc()||this._getEngine(),this._extensions,this._noMipmap,this._files);return c=r.uniqueId,r}),this);return r.uniqueId=c,r}}(0,W.e)([(0,B.K)()],m.prototype,"url",void 0),(0,W.e)([(0,B.J)()],m.prototype,"boundingBoxPosition",void 0),(0,W.e)([(0,B.J)()],m.prototype,"boundingBoxSize",null),(0,W.e)([(0,B.K)("rotationY")],m.prototype,"rotationY",null),(0,W.e)([(0,B.K)("files")],m.prototype,"_files",void 0),(0,W.e)([(0,B.K)("forcedExtension")],m.prototype,"_forcedExtension",void 0),(0,W.e)([(0,B.K)("extensions")],m.prototype,"_extensions",void 0),(0,W.e)([(0,B.w)("textureMatrix")],m.prototype,"_textureMatrix",void 0),(0,W.e)([(0,B.w)("textureMatrixRefraction")],m.prototype,"_textureMatrixRefraction",void 0),H.b._CubeTextureParser=m.Parse,(0,x.e)("BABYLON.CubeTexture",m)},13879:(c,r,D)=>{"use strict";D.d(r,{c:()=>H});var W=D(11509),B=D(11656),t=D(11648),u=D(11797),a=D(11615);u.ThinEngine.prototype.createDynamicTexture=function(c,r,D,W){const B=new a.e(this,4);return B.baseWidth=c,B.baseHeight=r,D&&(c=this.needPOTTextures?(0,t.e)(c,this._caps.maxTextureSize):c,r=this.needPOTTextures?(0,t.e)(r,this._caps.maxTextureSize):r),B.width=c,B.height=r,B.isReady=!1,B.generateMipMaps=D,B.samplingMode=W,this.updateTextureSamplingMode(W,B),this._internalTexturesCache.push(B),B},u.ThinEngine.prototype.updateDynamicTexture=function(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!c)return;const u=this._gl,a=u.TEXTURE_2D,H=this._bindTextureDirectly(a,c,!0,t);this._unpackFlipY(void 0===D?c.invertY:D),W&&u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const x=this._getWebGLTextureType(c.type),M=this._getInternalFormat(B||c.format),E=this._getRGBABufferInternalSizedFormat(c.type,M);u.texImage2D(a,0,E,M,x,r),c.generateMipMaps&&u.generateMipmap(a),H||this._bindTextureDirectly(a,null),W&&u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),B&&(c.format=B),c._dynamicTextureSource=r,c._premulAlpha=W,c.invertY=D||!1,c.isReady=!0};class H extends B.b{constructor(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,a=arguments.length>6?arguments[6]:void 0;const H=!D||D._isScene;super(null,H?D:null===D||void 0===D?void 0:D.qr,H?!W:D,a,t,void 0,void 0,void 0,void 0,u),this.name=c,this.wrapU=B.b.CLAMP_ADDRESSMODE,this.wrapV=B.b.CLAMP_ADDRESSMODE,this._generateMipMaps=W;const x=this._getEngine();if(!x)return;if(r.getContext)this._canvas=r,this._ownCanvas=!1,this._texture=x.createDynamicTexture(this._canvas.width,this._canvas.height,W,t);else{this._canvas=x.createCanvas(1,1),this._ownCanvas=!0;const c=r;c.width||0===c.width?this._texture=x.createDynamicTexture(c.width,c.height,W,t):this._texture=x.createDynamicTexture(r,r,W,t)}const M=this.getSize();this._canvas.width!==M.width&&(this._canvas.width=M.width),this._canvas.height!==M.height&&(this._canvas.height=M.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(c){this._canvas.width=c.width,this._canvas.height=c.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(c.width,c.height,this._generateMipMaps,this.samplingMode)}scale(c){const r=this.getSize();r.width*=c,r.height*=c,this._recreate(r)}scaleTo(c,r){const D=this.getSize();D.width=c,D.height=r,this._recreate(D)}getContext(){return this._context}clear(c){const r=this.getSize();c&&(this._context.fillStyle=c),this._context.clearRect(0,0,r.width,r.height)}update(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===c||c,r,this._format||void 0,void 0,D)}drawText(c,r,D,W,B,t,u){let a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const H=this.getSize();if(t&&(this._context.fillStyle=t,this._context.fillRect(0,0,H.width,H.height)),this._context.font=W,null===r||void 0===r){const D=this._context.measureText(c);r=(H.width-D.width)/2}if(null===D||void 0===D){const c=parseInt(W.replace(/\D/g,""));D=H.height/2+c/3.65}this._context.fillStyle=B||"",this._context.fillText(c,r,D),a&&this.update(u)}dispose(){var c,r;(super.dispose(),this._ownCanvas)&&(null===(c=this._canvas)||void 0===c||null===(r=c.remove)||void 0===r||r.call(c));this._canvas=null,this._context=null}clone(){const c=this.yc();if(!c)return this;const r=this.getSize(),D=new H(this.name,r,c,this._generateMipMaps);return D.Ea=this.Ea,D.level=this.level,D.wrapU=this.wrapU,D.wrapV=this.wrapV,D}serialize(){const c=this.yc();c&&!c.isReady()&&W.e.Warn("The scene must be ready before serializing the dynamic texture");const r=super.serialize();return H._IsCanvasElement(this._canvas)&&(r.base64String=this._canvas.toDataURL()),r.invertY=this._invertY,r.samplingMode=this.samplingMode,r}static _IsCanvasElement(c){return void 0!==c.toDataURL}_rebuild(){this.update()}}},13272:(c,r,D)=>{"use strict";D.d(r,{b:()=>B});var W=D(11656);class B extends W.b{get depth(){return this._depth}constructor(c,r,D,B,t,u){let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],H=arguments.length>7&&void 0!==arguments[7]&&arguments[7],x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:W.b.TRILINEAR_SAMPLINGMODE,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,E=arguments.length>10?arguments[10]:void 0;super(null,u,!a,H),this.format=t,this._texture=u.getEngine().createRawTexture2DArray(c,r,D,B,t,a,H,x,null,M,E),this._depth=B,this.is2DArray=!0}update(c){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,c,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(c,r,D,W,t){return new B(c,r,D,W,5,t,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13069:(c,r,D)=>{"use strict";D.d(r,{b:()=>a,e:()=>H,i:()=>t,l:()=>u});var W=D(11696),B=D(11683);function t(c,r){return`{X: ${c.x.toFixed(r)} Y: ${c.y.toFixed(r)}}`}function u(c,r){return`{X: ${c._x.toFixed(r)} Y: ${c._y.toFixed(r)} Z: ${c._z.toFixed(r)}}`}function a(c,r){return 2*Math.acos((0,W.Clamp)(B.Quaternion.Dot(c,r)))}function H(c,r){const D=new B.Quaternion;return function(c,r,D){const t=B.Zr.Cross(c,r),u=Math.acos((0,W.Clamp)(B.Zr.Dot(c,r),-1,1));B.Quaternion.RotationAxisToRef(t,u,D)}(c,r,D),D}},12917:(c,r,D)=>{"use strict";D.d(r,{e:()=>x});var W=D(11683),B=D(11722),t=D(12135),u=D(12118),a=D(11733);D(12925);function H(c){let r=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const D=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],t=[];let H=[];const x=c.width||c.size||1,M=c.height||c.size||1,E=c.depth||c.size||1,m=c.wrap||!1;let Y=void 0===c.topBaseAt?1:c.topBaseAt,v=void 0===c.bottomBaseAt?0:c.bottomBaseAt;Y=(Y+4)%4,v=(v+4)%4;let k=[2,0,3,1][Y],w=[2,0,1,3][v],Z=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(m){r=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],Z=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let c=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],D=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const W=[17,18,19,16],B=[22,23,20,21];for(;k>0;)c.unshift(c.pop()),W.unshift(W.pop()),k--;for(;w>0;)D.unshift(D.pop()),B.unshift(B.pop()),w--;c=c.flat(),D=D.flat(),Z=Z.concat(c).concat(D),r.push(W[0],W[2],W[3],W[0],W[1],W[2]),r.push(B[0],B[2],B[3],B[0],B[1],B[2])}const J=[x/2,M/2,E/2];H=Z.reduce(((c,r,D)=>c.concat(r*J[D%3])),[]);const q=0===c.sideOrientation?0:c.sideOrientation||u.b.DEFAULTSIDE,j=c.faceUV||new Array(6),X=c.faceColors,e=[];for(let u=0;u<6;u++)void 0===j[u]&&(j[u]=new W.Vector4(0,0,1,1)),X&&void 0===X[u]&&(X[u]=new B.Xa(1,1,1,1));for(let W=0;W<6;W++)if(t.push(j[W].z,a.b?1-j[W].w:j[W].w),t.push(j[W].x,a.b?1-j[W].w:j[W].w),t.push(j[W].x,a.b?1-j[W].y:j[W].y),t.push(j[W].z,a.b?1-j[W].y:j[W].y),X)for(let c=0;c<4;c++)e.push(X[W].r,X[W].g,X[W].b,X[W].a);u.b._ComputeSides(q,H,r,D,t,c.frontUVs,c.backUVs);const y=new u.b;if(y.indices=r,y.Nc=H,y.gc=D,y.Sc=t,X){const c=q===u.b.DOUBLESIDE?e.concat(e):e;y.zc=c}return y}function x(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=new t.e(c,D);r.sideOrientation=t.e._GetDefaultSideOrientation(r.sideOrientation),W._originalBuilderSideOrientation=r.sideOrientation;return H(r).fc(W,r.updatable),W}u.b.CreateBox=H,t.e.CreateBox=function(c,r){return x(c,{size:r,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13062:(c,r,D)=>{"use strict";D.d(r,{c:()=>a});var W=D(12135),B=D(12118),t=D(11733);function u(c){const r=[],D=[],W=[],u=[],a=c.radius||.5,H=c.tessellation||64,x=c.arc&&(c.arc<=0||c.arc>1)?1:c.arc||1,M=0===c.sideOrientation?0:c.sideOrientation||B.b.DEFAULTSIDE;r.push(0,0,0),u.push(.5,.5);const E=2*Math.PI*x,m=1===x?E/H:E/(H-1);let Y=0;for(let B=0;B<H;B++){const c=Math.cos(Y),D=Math.sin(Y),W=(c+1)/2,B=(1-D)/2;r.push(a*c,a*D,0),u.push(W,t.b?1-B:B),Y+=m}1===x&&(r.push(r[3],r[4],r[5]),u.push(u[2],t.b?1-u[3]:u[3]));const v=r.length/3;for(let B=1;B<v-1;B++)D.push(B+1,0,B);B.b.ComputeNormals(r,D,W),B.b._ComputeSides(M,r,D,W,u,c.frontUVs,c.backUVs);const k=new B.b;return k.indices=D,k.Nc=r,k.gc=W,k.Sc=u,k}function a(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new W.e(c,D);r.sideOrientation=W.e._GetDefaultSideOrientation(r.sideOrientation),B._originalBuilderSideOrientation=r.sideOrientation;return u(r).fc(B,r.updatable),B}B.b.CreateDisc=u,W.e.CreateDisc=function(c,r,D){return a(c,{radius:r,tessellation:D,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12925:(c,r,D)=>{"use strict";D.d(r,{g:()=>w,d:()=>J,j:()=>Z});var W=D(11683),B=D(11722),t=D(12135),u=D(12118),a=D(11750);t.e._GroundMeshParser=(c,r)=>H.Parse(c,r);class H extends t.e{constructor(c,r){super(c,r),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=c,this._subdivisionsY=c,this.subdivide(c);const D=this;D.createOrUpdateSubmeshesOctree&&D.createOrUpdateSubmeshesOctree(r)}getHeightAtCoordinates(c,r){const D=this.getWorldMatrix(),B=W.TmpVectors.Matrix[5];D.invertToRef(B);const t=W.TmpVectors.Zr[8];if(W.Zr.TransformCoordinatesFromFloatsToRef(c,0,r,B,t),c=t.x,r=t.z,c<this._minX||c>=this._maxX||r<=this._minZ||r>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const u=this._getFacetAt(c,r),a=-(u.x*c+u.z*r+u.w)/u.y;return W.Zr.TransformCoordinatesFromFloatsToRef(0,a,0,D,t),t.y}getNormalAtCoordinates(c,r){const D=new W.Zr(0,1,0);return this.getNormalAtCoordinatesToRef(c,r,D),D}getNormalAtCoordinatesToRef(c,r,D){const B=this.getWorldMatrix(),t=W.TmpVectors.Matrix[5];B.invertToRef(t);const u=W.TmpVectors.Zr[8];if(W.Zr.TransformCoordinatesFromFloatsToRef(c,0,r,t,u),c=u.x,r=u.z,c<this._minX||c>this._maxX||r<this._minZ||r>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const a=this._getFacetAt(c,r);return W.Zr.TransformNormalFromFloatsToRef(a.x,a.y,a.z,B,D),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(c,r){const D=Math.floor((c+this._maxX)*this._subdivisionsX/this._width),W=Math.floor(-(r+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),B=this._heightQuads[W*this._subdivisionsX+D];let t;return t=r<B.slope.x*c+B.slope.y?B.facet1:B.facet2,t}_initHeightQuads(){const c=this._subdivisionsX,r=this._subdivisionsY;this._heightQuads=[];for(let D=0;D<r;D++)for(let r=0;r<c;r++){const B={slope:W.Vector2.Zero(),facet1:new W.Vector4(0,0,0,0),facet2:new W.Vector4(0,0,0,0)};this._heightQuads[D*c+r]=B}return this}_computeHeightQuads(){const c=this.getVerticesData(a.d.PositionKind);if(!c)return this;const r=W.TmpVectors.Zr[3],D=W.TmpVectors.Zr[2],B=W.TmpVectors.Zr[1],t=W.TmpVectors.Zr[0],u=W.TmpVectors.Zr[4],H=W.TmpVectors.Zr[5],x=W.TmpVectors.Zr[6],M=W.TmpVectors.Zr[7],E=W.TmpVectors.Zr[8];let m=0,Y=0,v=0,k=0,w=0,Z=0,J=0;const q=this._subdivisionsX,j=this._subdivisionsY;for(let a=0;a<j;a++)for(let j=0;j<q;j++){m=3*j,Y=a*(q+1)*3,v=(a+1)*(q+1)*3,r.x=c[Y+m],r.y=c[Y+m+1],r.z=c[Y+m+2],D.x=c[Y+m+3],D.y=c[Y+m+4],D.z=c[Y+m+5],B.x=c[v+m],B.y=c[v+m+1],B.z=c[v+m+2],t.x=c[v+m+3],t.y=c[v+m+4],t.z=c[v+m+5],k=(t.z-r.z)/(t.x-r.x),w=r.z-k*r.x,D.subtractToRef(r,u),B.subtractToRef(r,H),t.subtractToRef(r,x),W.Zr.CrossToRef(x,H,M),W.Zr.CrossToRef(u,x,E),M.normalize(),E.normalize(),Z=-(M.x*r.x+M.y*r.y+M.z*r.z),J=-(E.x*D.x+E.y*D.y+E.z*D.z);const X=this._heightQuads[a*q+j];X.slope.Ja(k,w),X.facet1.Ja(M.x,M.y,M.z,Z),X.facet2.Ja(E.x,E.y,E.z,J)}return this}serialize(c){super.serialize(c),c.subdivisionsX=this._subdivisionsX,c.subdivisionsY=this._subdivisionsY,c.minX=this._minX,c.maxX=this._maxX,c.ma=this._minZ,c.maxZ=this._maxZ,c.width=this._width,c.height=this._height}static Parse(c,r){const D=new H(c.name,r);return D._subdivisionsX=c.subdivisionsX||1,D._subdivisionsY=c.subdivisionsY||1,D._minX=c.minX,D._maxX=c.maxX,D._minZ=c.ma,D._maxZ=c.maxZ,D._width=c.width,D._height=c.height,D}}var x=D(11487),M=D(11538),E=D(11687),m=D(11733);function Y(c){const r=[],D=[],B=[],t=[];let a,H;const x=c.width||c.size||1,M=c.height||c.size||1,E=0|(c.subdivisionsX||c.subdivisions||1),Y=0|(c.subdivisionsY||c.subdivisions||1);for(a=0;a<=Y;a++)for(H=0;H<=E;H++){const c=new W.Zr(H*x/E-x/2,0,(Y-a)*M/Y-M/2),r=new W.Zr(0,1,0);D.push(c.x,c.y,c.z),B.push(r.x,r.y,r.z),t.push(H/E,m.b?a/Y:1-a/Y)}for(a=0;a<Y;a++)for(H=0;H<E;H++)r.push(H+1+(a+1)*(E+1)),r.push(H+1+a*(E+1)),r.push(H+a*(E+1)),r.push(H+(a+1)*(E+1)),r.push(H+1+(a+1)*(E+1)),r.push(H+a*(E+1));const v=new u.b;return v.indices=r,v.Nc=D,v.gc=B,v.Sc=t,v}function v(c){const r=void 0!==c.xmin&&null!==c.xmin?c.xmin:-1,D=void 0!==c.zmin&&null!==c.zmin?c.zmin:-1,B=void 0!==c.xmax&&null!==c.xmax?c.xmax:1,t=void 0!==c.zmax&&null!==c.zmax?c.zmax:1,a=c.subdivisions||{w:1,h:1},H=c.precision||{w:1,h:1},x=[],M=[],E=[],m=[];let Y,v,k,w;a.h=a.h<1?1:a.h,a.w=a.w<1?1:a.w,H.w=H.w<1?1:H.w,H.h=H.h<1?1:H.h;const Z=(B-r)/a.w,J=(t-D)/a.h;function q(c,r,D,B){const t=M.length/3,u=H.w+1;for(Y=0;Y<H.h;Y++)for(v=0;v<H.w;v++){const c=[t+v+Y*u,t+(v+1)+Y*u,t+(v+1)+(Y+1)*u,t+v+(Y+1)*u];x.push(c[1]),x.push(c[2]),x.push(c[3]),x.push(c[0]),x.push(c[1]),x.push(c[3])}const a=W.Zr.Zero(),k=new W.Zr(0,1,0);for(Y=0;Y<=H.h;Y++)for(a.z=Y*(B-r)/H.h+r,v=0;v<=H.w;v++)a.x=v*(D-c)/H.w+c,a.y=0,M.push(a.x,a.y,a.z),E.push(k.x,k.y,k.z),m.push(v/H.w,Y/H.h)}for(k=0;k<a.h;k++)for(w=0;w<a.w;w++)q(r+w*Z,D+k*J,r+(w+1)*Z,D+(k+1)*J);const j=new u.b;return j.indices=x,j.Nc=M,j.gc=E,j.Sc=m,j}function k(c){const r=[],D=[],t=[],a=[];let H,x;const M=c.colorFilter||new B.Xr(.3,.59,.11),m=c.alphaFilter||0;let Y=!1;if(c.minHeight>c.maxHeight){Y=!0;const r=c.maxHeight;c.maxHeight=c.minHeight,c.minHeight=r}for(H=0;H<=c.subdivisions;H++)for(x=0;x<=c.subdivisions;x++){const r=new W.Zr(x*c.width/c.subdivisions-c.width/2,0,(c.subdivisions-H)*c.height/c.subdivisions-c.height/2),B=4*(((r.x+c.width/2)/c.width*(c.bufferWidth-1)|0)+((1-(r.z+c.height/2)/c.height)*(c.bufferHeight-1)|0)*c.bufferWidth);let u=c.buffer[B]/255,v=c.buffer[B+1]/255,k=c.buffer[B+2]/255;const w=c.buffer[B+3]/255;Y&&(u=1-u,v=1-v,k=1-k);const Z=u*M.r+v*M.g+k*M.b;r.y=w>=m?c.minHeight+(c.maxHeight-c.minHeight)*Z:c.minHeight-E.c,c.heightBuffer&&(c.heightBuffer[H*(c.subdivisions+1)+x]=r.y),D.push(r.x,r.y,r.z),t.push(0,0,0),a.push(x/c.subdivisions,1-H/c.subdivisions)}for(H=0;H<c.subdivisions;H++)for(x=0;x<c.subdivisions;x++){const W=x+1+(H+1)*(c.subdivisions+1),B=x+1+H*(c.subdivisions+1),t=x+H*(c.subdivisions+1),u=x+(H+1)*(c.subdivisions+1),a=D[3*W+1]>=c.minHeight,M=D[3*B+1]>=c.minHeight,E=D[3*t+1]>=c.minHeight;a&&M&&E&&(r.push(W),r.push(B),r.push(t));D[3*u+1]>=c.minHeight&&a&&E&&(r.push(u),r.push(W),r.push(t))}u.b.ComputeNormals(D,r,t);const v=new u.b;return v.indices=r,v.Nc=D,v.gc=t,v.Sc=a,v}function w(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const D=new H(c,arguments.length>2?arguments[2]:void 0);D._setReady(!1),D._subdivisionsX=r.subdivisionsX||r.subdivisions||1,D._subdivisionsY=r.subdivisionsY||r.subdivisions||1,D._width=r.width||1,D._height=r.height||1,D._maxX=D._width/2,D._maxZ=D._height/2,D._minX=-D._maxX,D._minZ=-D._maxZ;return Y(r).fc(D,r.updatable),D._setReady(!0),D}function Z(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=new t.e(c,D);return v(r).fc(W,r.updatable),W}function J(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const t=D.width||10,u=D.height||10,a=D.subdivisions||1,E=D.minHeight||0,m=D.maxHeight||1,Y=D.colorFilter||new B.Xr(.3,.59,.11),v=D.alphaFilter||0,w=D.updatable,Z=D.onReady;W=W||M.c.LastCreatedScene;const J=new H(c,W);let q;J._subdivisionsX=a,J._subdivisionsY=a,J._width=t,J._height=u,J._maxX=J._width/2,J._maxZ=J._height/2,J._minX=-J._maxX,J._minZ=-J._maxZ,J._setReady(!1),D.passHeightBufferInCallback&&(q=new Float32Array((a+1)*(a+1)));const j=(c,r,D)=>{k({width:t,height:u,subdivisions:a,minHeight:E,maxHeight:m,colorFilter:Y,buffer:c,bufferWidth:r,bufferHeight:D,alphaFilter:v,heightBuffer:q}).fc(J,w),Z&&Z(J,q),J._setReady(!0)};if("string"===typeof r){const c=c=>{var r;const D=c.width,B=c.height;if(W.M)return;const t=null===(r=W)||void 0===r?void 0:r.getEngine().resizeImageBitmap(c,D,B);j(t,D,B)};x.Tools.LoadImage(r,c,D.onError?D.onError:()=>{},W.offlineProvider)}else j(r.data,r.width,r.height);return J}u.b.CreateGround=Y,u.b.CreateTiledGround=v,u.b.CreateGroundFromHeightMap=k,t.e.CreateGround=(c,r,D,W,B,t)=>w(c,{width:r,height:D,subdivisions:W,updatable:t},B),t.e.CreateTiledGround=(c,r,D,W,B,t,u,a,H)=>Z(c,{xmin:r,zmin:D,xmax:W,zmax:B,subdivisions:t,precision:u,updatable:H},a),t.e.CreateGroundFromHeightMap=(c,r,D,W,B,t,u,a,H,x,M)=>J(c,r,{width:D,height:W,subdivisions:B,minHeight:t,maxHeight:u,updatable:H,onReady:x,alphaFilter:M},a)},13560:(c,r,D)=>{"use strict";D.d(r,{e:()=>Y,g:()=>E,i:()=>m});var W=D(11683),B=D(12135),t=D(12118),u=D(12222),a=D(11750),H=D(11509);function x(c){const r=[],D=[],W=c.lines,B=c.zc,u=[];let a=0;for(let t=0;t<W.length;t++){const c=W[t];for(let W=0;W<c.length;W++){const{x:H,y:x,z:M}=c[W];if(D.push(H,x,M),B){const c=B[t],{r:r,g:D,b:a,a:H}=c[W];u.push(r,D,a,H)}W>0&&(r.push(a-1),r.push(a)),a++}}const H=new t.b;return H.indices=r,H.Nc=D,B&&(H.zc=u),H}function M(c){const r=c.dashSize||3,D=c.gapSize||1,B=c.dashNb||200,u=c.points,a=[],H=[],x=W.Zr.Zero();let M=0,E=0,m=0,Y=0,v=0,k=0,w=0;for(w=0;w<u.length-1;w++)u[w+1].subtractToRef(u[w],x),M+=x.length();for(m=M/B,Y=r*m/(r+D),w=0;w<u.length-1;w++){u[w+1].subtractToRef(u[w],x),E=Math.floor(x.length()/m),x.normalize();for(let c=0;c<E;c++)v=m*c,a.push(u[w].x+v*x.x,u[w].y+v*x.y,u[w].z+v*x.z),a.push(u[w].x+(v+Y)*x.x,u[w].y+(v+Y)*x.y,u[w].z+(v+Y)*x.z),H.push(k,k+1),k+=2}const Z=new t.b;return Z.Nc=a,Z.indices=H,Z}function E(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=r.instance,B=r.lines,t=r.zc;if(W){const c=W.getVerticesData(a.d.PositionKind);let r,D;t&&(r=W.getVerticesData(a.d.ColorKind));let u=0,H=0;for(let W=0;W<B.length;W++){const a=B[W];for(let B=0;B<a.length;B++)c[u]=a[B].x,c[u+1]=a[B].y,c[u+2]=a[B].z,t&&r&&(D=t[W],r[H]=D[B].r,r[H+1]=D[B].g,r[H+2]=D[B].b,r[H+3]=D[B].a,H+=4),u+=3}return W.updateVerticesData(a.d.PositionKind,c,!1,!1),t&&r&&W.updateVerticesData(a.d.ColorKind,r,!1,!1),W.refreshBoundingInfo(),W}const H=!!t,M=new u.b(c,D,null,void 0,void 0,H,r.useVertexAlpha,r.material);return x(r).fc(M,r.updatable),M}function m(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=r.zc?[r.zc]:null;return E(c,{lines:[r.points],updatable:r.updatable,instance:r.instance,zc:W,useVertexAlpha:r.useVertexAlpha,material:r.material},D)}function Y(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=r.points,a=r.instance,x=r.gapSize||1,E=r.dashSize||3;if(a){const c=c=>{const r=W.Zr.Zero(),D=c.length/6;let B=0,u=0,H=0,x=0,M=0,E=0,m=0,Y=0;for(m=0;m<t.length-1;m++)t[m+1].subtractToRef(t[m],r),B+=r.length();H=B/D;const v=a._creationDataStorage.dashSize;for(x=v*H/(v+a._creationDataStorage.gapSize),m=0;m<t.length-1;m++)for(t[m+1].subtractToRef(t[m],r),u=Math.floor(r.length()/H),r.normalize(),Y=0;Y<u&&E<c.length;)M=H*Y,c[E]=t[m].x+M*r.x,c[E+1]=t[m].y+M*r.y,c[E+2]=t[m].z+M*r.z,c[E+3]=t[m].x+(M+x)*r.x,c[E+4]=t[m].y+(M+x)*r.y,c[E+5]=t[m].z+(M+x)*r.z,E+=6,Y++;for(;E<c.length;)c[E]=t[m].x,c[E+1]=t[m].y,c[E+2]=t[m].z,E+=3};return(r.dashNb||r.dashSize||r.gapSize||r.useVertexAlpha||r.material)&&H.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),a.updateMeshPositions(c,!1),a}const m=new u.b(c,D,null,void 0,void 0,void 0,r.useVertexAlpha,r.material);return M(r).fc(m,r.updatable),m._creationDataStorage=new B.f,m._creationDataStorage.dashSize=E,m._creationDataStorage.gapSize=x,m}t.b.CreateLineSystem=x,t.b.CreateDashedLines=M,B.e.Zx=function(c,r){return m(c,{points:r,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},B.e.CreateDashedLines=function(c,r,D,W,B){return Y(c,{points:r,dashSize:D,gapSize:W,dashNb:B,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12974:(c,r,D)=>{"use strict";D.d(r,{b:()=>a,e:()=>H});var W=D(12135),B=D(12118),t=D(11733);function u(c){const r=[],D=[],W=[],u=[],a=void 0!==c.width?c.width:void 0!==c.size?c.size:1,H=void 0!==c.height?c.height:void 0!==c.size?c.size:1,x=0===c.sideOrientation?0:c.sideOrientation||B.b.DEFAULTSIDE,M=a/2,E=H/2;D.push(-M,-E,0),W.push(0,0,-1),u.push(0,t.b?1:0),D.push(M,-E,0),W.push(0,0,-1),u.push(1,t.b?1:0),D.push(M,E,0),W.push(0,0,-1),u.push(1,t.b?0:1),D.push(-M,E,0),W.push(0,0,-1),u.push(0,t.b?0:1),r.push(0),r.push(1),r.push(2),r.push(0),r.push(2),r.push(3),B.b._ComputeSides(x,D,r,W,u,c.frontUVs,c.backUVs);const m=new B.b;return m.indices=r,m.Nc=D,m.gc=W,m.Sc=u,m}function a(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=new W.e(c,D);r.sideOrientation=W.e._GetDefaultSideOrientation(r.sideOrientation),B._originalBuilderSideOrientation=r.sideOrientation;return u(r).fc(B,r.updatable),r.sourcePlane&&(B.translate(r.sourcePlane.normal,-r.sourcePlane.d),B.setDirection(r.sourcePlane.normal.scale(-1))),B}const H={jx:a};B.b.jx=u,W.e.jx=(c,r,D,W,B)=>a(c,{size:r,width:r,height:r,sideOrientation:B,updatable:W},D)},13057:(c,r,D)=>{"use strict";D.d(r,{e:()=>H});var W=D(11683),B=D(12135),t=D(12118),u=D(11733);function a(c){const r=0|(c.segments||32),D=c.diameterX||c.diameter||1,B=c.diameterY||c.diameter||1,a=c.diameterZ||c.diameter||1,H=c.arc&&(c.arc<=0||c.arc>1)?1:c.arc||1,x=c.slice&&c.slice<=0?1:c.slice||1,M=0===c.sideOrientation?0:c.sideOrientation||t.b.DEFAULTSIDE,E=!!c.dedupTopBottomIndices,m=new W.Zr(D/2,B/2,a/2),Y=2+r,v=2*Y,k=[],w=[],Z=[],J=[];for(let t=0;t<=Y;t++){const c=t/Y,r=c*Math.PI*x;for(let D=0;D<=v;D++){const B=D/v,t=B*Math.PI*2*H,a=W.Matrix.RotationZ(-r),x=W.Matrix.RotationY(t),M=W.Zr.TransformCoordinates(W.Zr.Up(),a),E=W.Zr.TransformCoordinates(M,x),Y=E.multiply(m),k=E.divide(m).normalize();w.push(Y.x,Y.y,Y.z),Z.push(k.x,k.y,k.z),J.push(B,u.b?1-c:c)}if(t>0){const c=w.length/3;for(let r=c-2*(v+1);r+v+2<c;r++)E?(t>1&&(k.push(r),k.push(r+1),k.push(r+v+1)),(t<Y||x<1)&&(k.push(r+v+1),k.push(r+1),k.push(r+v+2))):(k.push(r),k.push(r+1),k.push(r+v+1),k.push(r+v+1),k.push(r+1),k.push(r+v+2))}}t.b._ComputeSides(M,w,k,Z,J,c.frontUVs,c.backUVs);const q=new t.b;return q.indices=k,q.Nc=w,q.gc=Z,q.Sc=J,q}function H(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=new B.e(c,D);r.sideOrientation=B.e._GetDefaultSideOrientation(r.sideOrientation),W._originalBuilderSideOrientation=r.sideOrientation;return a(r).fc(W,r.updatable),W}t.b.CreateSphere=a,B.e.CreateSphere=(c,r,D,W,B,t)=>H(c,{segments:r,diameterX:D,diameterY:D,diameterZ:D,sideOrientation:t,updatable:B},W)},13895:(c,r,D)=>{"use strict";D.d(r,{e:()=>a});var W=D(12244),B=D(13372),t=D(12263),u=D(12118);class a{static get Configuration(){return{get decoder(){return B.d.DefaultConfiguration},set decoder(c){B.d.DefaultConfiguration=c}}}static set Configuration(c){B.d.DefaultConfiguration=c.decoder}static get DecoderAvailable(){return(0,W.g)(B.d.DefaultConfiguration)}static get Default(){return a._Default??(a._Default=new a),a._Default}static ResetDefault(c){a._Default&&(c||a._Default.dispose(),a._Default=null)}constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.DefaultNumWorkers;const r="number"===typeof c?{...B.d.DefaultConfiguration,numWorkers:c}:{...B.d.DefaultConfiguration,...c};this._decoder=new B.d(r)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(c,r,D){return this._decoder.decodeMeshToMeshDataAsync(c,r,D)}async decodeMeshToGeometryAsync(c,r,D,W){return await this._decoder.decodeMeshToGeometryAsync(c,r,D,W)}async _decodeMeshToGeometryForGltfAsync(c,r,D,W,B,t){return await this._decoder._decodeMeshToGeometryForGltfAsync(c,r,D,W,B,t)}async decodeMeshAsync(c,r){const D=await this._decoder.decodeMeshToMeshDataAsync(c,r),W=new u.b;D.indices&&(W.indices=D.indices);for(const B of D.attributes){const c=t.c.GetFloatData(B.data,B.size,t.c.GetDataType(B.data),B.byteOffset,B.byteStride,B.normalized,D.totalVertices);W.set(c,B.kind)}return W}}a.DefaultNumWorkers=(0,W.e)(),a._Default=null},13372:(c,r,D)=>{"use strict";D.d(r,{d:()=>x});var W=D(12244),B=D(11487),t=D(12147),u=D(12263),a=D(11509),H=D(12256);class x extends W.c{static get DefaultAvailable(){return(0,W.g)(x.DefaultConfiguration)}static get Default(){return x._Default??(x._Default=new x),x._Default}static ResetDefault(c){x._Default&&(c||x._Default.dispose(),x._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(c,r){return{module:await(r||DracoDecoderModule)({wasmBinary:c})}}_getWorkerContent(){return`${H.e}(${H.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.DefaultConfiguration)}decodeMeshToMeshDataAsync(c,r,D){const W=c instanceof ArrayBuffer?new Int8Array(c):new Int8Array(c.buffer,c.byteOffset,c.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async c=>await new Promise(((B,t)=>{c.push(((c,u)=>{let H=null;const x=[],M=r=>{c.removeEventListener("error",M),c.removeEventListener("message",E),t(r),u()},E=r=>{const W=r.data;switch(W.id){case"indices":H=W.data;break;case"attribute":x.push({kind:W.kind,data:W.data,size:W.size,byteOffset:W.byteOffset,byteStride:W.byteStride,normalized:(t=W.kind,m=W.normalized,D&&void 0!==D[t]?(m!==D[t]&&a.e.Warn(`Normalized flag from Draco data (${m}) does not match normalized flag from glTF accessor (${D[t]}). Using flag from glTF accessor.`),D[t]):m)});break;case"decodeMeshDone":c.removeEventListener("error",M),c.removeEventListener("message",E),B({indices:H,attributes:x,totalVertices:W.totalVertices}),u()}var t,m};c.addEventListener("error",M),c.addEventListener("message",E);const m=W.slice();c.postMessage({id:"decodeMesh",dataView:m,attributes:r},[m.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((c=>{let D=null;const B=[],t=(0,H.e)(c.module,W,r,(c=>{D=c}),((c,r,D,W,t,u)=>{B.push({kind:c,data:r,size:D,byteOffset:W,byteStride:t,normalized:u})}));return{indices:D,attributes:B,totalVertices:t}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(c,r,D,W){const B=await this.decodeMeshToMeshDataAsync(D,W),a=new t.e(c,r);B.indices&&a.setIndices(B.indices);for(const t of B.attributes)a.setVerticesBuffer(new u.c(r.getEngine(),t.data,t.kind,!1,void 0,t.byteStride,void 0,t.byteOffset,t.size,void 0,t.normalized,!0),B.totalVertices);return a}async _decodeMeshToGeometryForGltfAsync(c,r,D,W,B,a){const H=await this.decodeMeshToMeshDataAsync(D,W,B),x=new t.e(c,r);a&&(x._boundingInfo=a,x.useBoundingInfoFromGeometry=!0),H.indices&&x.setIndices(H.indices);for(const t of H.attributes)x.setVerticesBuffer(new u.c(r.getEngine(),t.data,t.kind,!1,void 0,t.byteStride,void 0,t.byteOffset,t.size,void 0,t.normalized,!0),H.totalVertices);return x}}x.DefaultConfiguration={wasmUrl:`${B.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${B.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${B.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},x._Default=null},13554:(c,r,D)=>{"use strict";D.d(r,{e:()=>ac});var W=D(11683),B=D(12135),t=D(11750),u=D(12118),a=D(11733);function H(c){let r=c.pathArray;const D=c.closeArray||!1,W=c.closePath||!1,B=c.invertUV||!1,H=Math.floor(r[0].length/2);let x=c.offset||H;x=x>H?H:Math.floor(x);const M=0===c.sideOrientation?0:c.sideOrientation||u.b.DEFAULTSIDE,E=c.Sc,m=c.zc,Y=[],v=[],k=[],w=[],Z=[],J=[],q=[],j=[];let X;const e=[],y=[];let U,N,g;if(r.length<2){const c=[],D=[];for(N=0;N<r[0].length-x;N++)c.push(r[0][N]),D.push(r[0][N+x]);r=[c,D]}let z=0;const S=W?1:0,K=D?1:0;let f,A,h,L,P,G;for(X=r[0].length,U=0;U<r.length+K;U++){for(q[U]=0,Z[U]=[0],f=U===r.length?r[0]:r[U],A=f.length,X=X<A?X:A,g=0;g<A;)Y.push(f[g].x,f[g].y,f[g].z),g>0&&(h=f[g].Jr(f[g-1]).length(),L=h+q[U],Z[U].push(L),q[U]=L),g++;W&&(g--,Y.push(f[0].x,f[0].y,f[0].z),h=f[g].Jr(f[0]).length(),L=h+q[U],Z[U].push(L),q[U]=L),e[U]=A+S,y[U]=z,z+=A+S}let d,T,b=null,O=null;for(N=0;N<X+S;N++)for(j[N]=0,J[N]=[0],U=0;U<r.length-1+K;U++)P=r[U],G=U===r.length-1?r[0]:r[U+1],N===X?(b=P[0],O=G[0]):(b=P[N],O=G[N]),h=O.Jr(b).length(),L=h+j[N],J[N].push(L),j[N]=L;if(E)for(U=0;U<E.length;U++)w.push(E[U].x,a.b?1-E[U].y:E[U].y);else for(U=0;U<r.length+K;U++)for(N=0;N<X+S;N++)d=0!=q[U]?Z[U][N]/q[U]:0,T=0!=j[N]?J[N][U]/j[N]:0,B?w.push(T,d):w.push(d,a.b?1-T:T);U=0;let C=0,p=e[U]-1,R=e[U+1]-1,s=p<R?p:R,o=y[1]-y[0];const Q=e.length-1;for(;C<=s&&U<Q;)v.push(C,C+o,C+1),v.push(C+o+1,C+1,C+o),C+=1,C===s&&(U++,o=y[U+1]-y[U],p=e[U]-1,R=e[U+1]-1,C=y[U],s=p<R?p+C:R+C);if(u.b.ComputeNormals(Y,v,k),W){let c=0,D=0;for(U=0;U<r.length;U++){c=3*y[U],D=U+1<r.length?3*(y[U+1]-1):k.length-3,k[c]=.5*(k[c]+k[D]),k[c+1]=.5*(k[c+1]+k[D+1]),k[c+2]=.5*(k[c+2]+k[D+2]);const W=Math.sqrt(k[c]*k[c]+k[c+1]*k[c+1]+k[c+2]*k[c+2]);k[c]/=W,k[c+1]/=W,k[c+2]/=W,k[D]=k[c],k[D+1]=k[c+1],k[D+2]=k[c+2]}}if(D){let c=3*y[0],D=3*y[r.length];for(N=0;N<X+S;N++){k[c]=.5*(k[c]+k[D]),k[c+1]=.5*(k[c+1]+k[D+1]),k[c+2]=.5*(k[c+2]+k[D+2]);const r=Math.sqrt(k[c]*k[c]+k[c+1]*k[c+1]+k[c+2]*k[c+2]);k[c]/=r,k[c+1]/=r,k[c+2]/=r,k[D]=k[c],k[D+1]=k[c+1],k[D+2]=k[c+2],c+=3,D+=3}}u.b._ComputeSides(M,Y,v,k,w,c.frontUVs,c.backUVs);let l=null;if(m){l=new Float32Array(4*m.length);for(let c=0;c<m.length;c++)l[4*c]=m[c].r,l[4*c+1]=m[c].g,l[4*c+2]=m[c].b,l[4*c+3]=m[c].a}const F=new u.b,I=new Float32Array(Y),i=new Float32Array(k),n=new Float32Array(w);return F.indices=v,F.Nc=I,F.gc=i,F.Sc=n,l&&F.set(l,t.d.ColorKind),W&&(F._idx=y),F}function x(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=r.pathArray,M=r.closeArray,E=r.closePath,m=B.e._GetDefaultSideOrientation(r.sideOrientation),Y=r.instance,v=r.updatable;if(Y){const c=W.TmpVectors.Zr[0].ja(Number.MAX_VALUE),D=W.TmpVectors.Zr[1].ja(-Number.MAX_VALUE),H=r=>{let W=x[0].length;const t=Y;let u=0;const a=t._originalBuilderSideOrientation===B.e.DOUBLESIDE?2:1;for(let B=1;B<=a;++B)for(let a=0;a<x.length;++a){const B=x[a],H=B.length;W=W<H?W:H;for(let t=0;t<W;++t){const W=B[t];r[u]=W.x,r[u+1]=W.y,r[u+2]=W.z,c.minimizeInPlaceFromFloats(W.x,W.y,W.z),D.maximizeInPlaceFromFloats(W.x,W.y,W.z),u+=3}if(t._creationDataStorage&&t._creationDataStorage.closePath){const c=B[0];r[u]=c.x,r[u+1]=c.y,r[u+2]=c.z,u+=3}}},M=Y.getVerticesData(t.d.PositionKind);if(H(M),Y.hasBoundingInfo?Y.getBoundingInfo().reConstruct(c,D,Y._worldMatrix):Y.buildBoundingInfo(c,D,Y._worldMatrix),Y.updateVerticesData(t.d.PositionKind,M,!1,!1),r.zc){const c=Y.getVerticesData(t.d.ColorKind);for(let D=0,W=0;D<r.zc.length;D++,W+=4){const B=r.zc[D];c[W]=B.r,c[W+1]=B.g,c[W+2]=B.b,c[W+3]=B.a}Y.updateVerticesData(t.d.ColorKind,c,!1,!1)}if(r.Sc){const c=Y.getVerticesData(t.d.UVKind);for(let D=0;D<r.Sc.length;D++)c[2*D]=r.Sc[D].x,c[2*D+1]=a.b?1-r.Sc[D].y:r.Sc[D].y;Y.updateVerticesData(t.d.UVKind,c,!1,!1)}if(!Y.areNormalsFrozen||Y.isFacetDataEnabled){const c=Y.wa(),r=Y.getVerticesData(t.d.NormalKind),D=Y.isFacetDataEnabled?Y.getFacetDataParameters():null;if(u.b.ComputeNormals(M,c,r,D),Y._creationDataStorage&&Y._creationDataStorage.closePath){let c=0,D=0;for(let W=0;W<x.length;W++)c=3*Y._creationDataStorage.idx[W],D=W+1<x.length?3*(Y._creationDataStorage.idx[W+1]-1):r.length-3,r[c]=.5*(r[c]+r[D]),r[c+1]=.5*(r[c+1]+r[D+1]),r[c+2]=.5*(r[c+2]+r[D+2]),r[D]=r[c],r[D+1]=r[c+1],r[D+2]=r[c+2]}Y.areNormalsFrozen||Y.updateVerticesData(t.d.NormalKind,r,!1,!1)}return Y}{const W=new B.e(c,D);W._originalBuilderSideOrientation=m,W._creationDataStorage=new B.f;const t=H(r);return E&&(W._creationDataStorage.idx=t._idx),W._creationDataStorage.closePath=E,W._creationDataStorage.closeArray=M,t.fc(W,v),W}}u.b.CreateRibbon=H,B.e.CreateRibbon=function(c,r){return x(c,{pathArray:r,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var M=D(13062),E=D(12917),m=D(11722);function Y(c){const r=c.pattern||B.e.NO_FLIP,D=c.tileWidth||c.tileSize||1,W=c.tileHeight||c.tileSize||1,t=c.alignHorizontal||0,a=c.alignVertical||0,H=c.width||c.size||1,x=Math.floor(H/D);let M=H-x*D;const E=c.height||c.size||1,m=Math.floor(E/W);let Y=E-m*W;const v=D*x/2,k=W*m/2;let w=0,Z=0,J=0,q=0,j=0,X=0;if(M>0||Y>0){switch(J=-v,q=-k,j=v,X=k,t){case B.e.CENTER:M/=2,J-=M,j+=M;break;case B.e.LEFT:j+=M,w=-M/2;break;case B.e.RIGHT:J-=M,w=M/2}switch(a){case B.e.CENTER:Y/=2,q-=Y,X+=Y;break;case B.e.BOTTOM:X+=Y,Z=-Y/2;break;case B.e.TOP:q-=Y,Z=Y/2}}const e=[],y=[],U=[];U[0]=[0,0,1,0,1,1,0,1],U[1]=[0,0,1,0,1,1,0,1],r!==B.e.ROTATE_TILE&&r!==B.e.ROTATE_ROW||(U[1]=[1,1,0,1,0,0,1,0]),r!==B.e.FLIP_TILE&&r!==B.e.FLIP_ROW||(U[1]=[1,0,0,0,0,1,1,1]),r!==B.e.FLIP_N_ROTATE_TILE&&r!==B.e.FLIP_N_ROTATE_ROW||(U[1]=[0,1,1,1,1,0,0,0]);let N=[];const g=[],z=[];let S=0;for(let u=0;u<m;u++)for(let c=0;c<x;c++)e.push(c*D-v+w,u*W-k+Z,0),e.push((c+1)*D-v+w,u*W-k+Z,0),e.push((c+1)*D-v+w,(u+1)*W-k+Z,0),e.push(c*D-v+w,(u+1)*W-k+Z,0),z.push(S,S+1,S+3,S+1,S+2,S+3),N=r===B.e.FLIP_TILE||r===B.e.ROTATE_TILE||r===B.e.FLIP_N_ROTATE_TILE?N.concat(U[(c%2+u%2)%2]):r===B.e.FLIP_ROW||r===B.e.ROTATE_ROW||r===B.e.FLIP_N_ROTATE_ROW?N.concat(U[u%2]):N.concat(U[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),S+=4;if(M>0||Y>0){const c=Y>0&&(a===B.e.CENTER||a===B.e.TOP),u=Y>0&&(a===B.e.CENTER||a===B.e.BOTTOM),H=M>0&&(t===B.e.CENTER||t===B.e.RIGHT),E=M>0&&(t===B.e.CENTER||t===B.e.LEFT);let U,K,f,A,h=[];if(c&&H&&(e.push(J+w,q+Z,0),e.push(-v+w,q+Z,0),e.push(-v+w,q+Y+Z,0),e.push(J+w,q+Y+Z,0),z.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,U=1-M/D,K=1-Y/W,f=1,A=1,h=[U,K,f,K,f,A,U,A],r===B.e.ROTATE_ROW&&(h=[1-U,1-K,1-f,1-K,1-f,1-A,1-U,1-A]),r===B.e.FLIP_ROW&&(h=[1-U,K,1-f,K,1-f,A,1-U,A]),r===B.e.FLIP_N_ROTATE_ROW&&(h=[U,1-K,f,1-K,f,1-A,U,1-A]),N=N.concat(h),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),c&&E&&(e.push(v+w,q+Z,0),e.push(j+w,q+Z,0),e.push(j+w,q+Y+Z,0),e.push(v+w,q+Y+Z,0),z.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,U=0,K=1-Y/W,f=M/D,A=1,h=[U,K,f,K,f,A,U,A],(r===B.e.ROTATE_ROW||r===B.e.ROTATE_TILE&&x%2===0)&&(h=[1-U,1-K,1-f,1-K,1-f,1-A,1-U,1-A]),(r===B.e.FLIP_ROW||r===B.e.FLIP_TILE&&x%2===0)&&(h=[1-U,K,1-f,K,1-f,A,1-U,A]),(r===B.e.FLIP_N_ROTATE_ROW||r===B.e.FLIP_N_ROTATE_TILE&&x%2===0)&&(h=[U,1-K,f,1-K,f,1-A,U,1-A]),N=N.concat(h),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),u&&H&&(e.push(J+w,k+Z,0),e.push(-v+w,k+Z,0),e.push(-v+w,X+Z,0),e.push(J+w,X+Z,0),z.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,U=1-M/D,K=0,f=1,A=Y/W,h=[U,K,f,K,f,A,U,A],(r===B.e.ROTATE_ROW&&m%2===1||r===B.e.ROTATE_TILE&&m%1===0)&&(h=[1-U,1-K,1-f,1-K,1-f,1-A,1-U,1-A]),(r===B.e.FLIP_ROW&&m%2===1||r===B.e.FLIP_TILE&&m%2===0)&&(h=[1-U,K,1-f,K,1-f,A,1-U,A]),(r===B.e.FLIP_N_ROTATE_ROW&&m%2===1||r===B.e.FLIP_N_ROTATE_TILE&&m%2===0)&&(h=[U,1-K,f,1-K,f,1-A,U,1-A]),N=N.concat(h),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),u&&E&&(e.push(v+w,k+Z,0),e.push(j+w,k+Z,0),e.push(j+w,X+Z,0),e.push(v+w,X+Z,0),z.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,U=0,K=0,f=M/D,A=Y/W,h=[U,K,f,K,f,A,U,A],(r===B.e.ROTATE_ROW&&m%2===1||r===B.e.ROTATE_TILE&&(m+x)%2===1)&&(h=[1-U,1-K,1-f,1-K,1-f,1-A,1-U,1-A]),(r===B.e.FLIP_ROW&&m%2===1||r===B.e.FLIP_TILE&&(m+x)%2===1)&&(h=[1-U,K,1-f,K,1-f,A,1-U,A]),(r===B.e.FLIP_N_ROTATE_ROW&&m%2===1||r===B.e.FLIP_N_ROTATE_TILE&&(m+x)%2===1)&&(h=[U,1-K,f,1-K,f,1-A,U,1-A]),N=N.concat(h),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),c){const c=[];U=0,K=1-Y/W,f=1,A=1,c[0]=[U,K,f,K,f,A,U,A],c[1]=[U,K,f,K,f,A,U,A],r!==B.e.ROTATE_TILE&&r!==B.e.ROTATE_ROW||(c[1]=[1-U,1-K,1-f,1-K,1-f,1-A,1-U,1-A]),r!==B.e.FLIP_TILE&&r!==B.e.FLIP_ROW||(c[1]=[1-U,K,1-f,K,1-f,A,1-U,A]),r!==B.e.FLIP_N_ROTATE_TILE&&r!==B.e.FLIP_N_ROTATE_ROW||(c[1]=[U,1-K,f,1-K,f,1-A,U,1-A]);for(let W=0;W<x;W++)e.push(W*D-v+w,q+Z,0),e.push((W+1)*D-v+w,q+Z,0),e.push((W+1)*D-v+w,q+Y+Z,0),e.push(W*D-v+w,q+Y+Z,0),z.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,N=r===B.e.FLIP_TILE||r===B.e.ROTATE_TILE||r===B.e.FLIP_N_ROTATE_TILE?N.concat(c[(W+1)%2]):r===B.e.FLIP_ROW||r===B.e.ROTATE_ROW||r===B.e.FLIP_N_ROTATE_ROW?N.concat(c[1]):N.concat(c[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(u){const c=[];U=0,K=0,f=1,A=Y/W,c[0]=[U,K,f,K,f,A,U,A],c[1]=[U,K,f,K,f,A,U,A],r!==B.e.ROTATE_TILE&&r!==B.e.ROTATE_ROW||(c[1]=[1-U,1-K,1-f,1-K,1-f,1-A,1-U,1-A]),r!==B.e.FLIP_TILE&&r!==B.e.FLIP_ROW||(c[1]=[1-U,K,1-f,K,1-f,A,1-U,A]),r!==B.e.FLIP_N_ROTATE_TILE&&r!==B.e.FLIP_N_ROTATE_ROW||(c[1]=[U,1-K,f,1-K,f,1-A,U,1-A]);for(let W=0;W<x;W++)e.push(W*D-v+w,X-Y+Z,0),e.push((W+1)*D-v+w,X-Y+Z,0),e.push((W+1)*D-v+w,X+Z,0),e.push(W*D-v+w,X+Z,0),z.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,N=r===B.e.FLIP_TILE||r===B.e.ROTATE_TILE||r===B.e.FLIP_N_ROTATE_TILE?N.concat(c[(W+m)%2]):r===B.e.FLIP_ROW||r===B.e.ROTATE_ROW||r===B.e.FLIP_N_ROTATE_ROW?N.concat(c[m%2]):N.concat(c[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(H){const c=[];U=1-M/D,K=0,f=1,A=1,c[0]=[U,K,f,K,f,A,U,A],c[1]=[U,K,f,K,f,A,U,A],r!==B.e.ROTATE_TILE&&r!==B.e.ROTATE_ROW||(c[1]=[1-U,1-K,1-f,1-K,1-f,1-A,1-U,1-A]),r!==B.e.FLIP_TILE&&r!==B.e.FLIP_ROW||(c[1]=[1-U,K,1-f,K,1-f,A,1-U,A]),r!==B.e.FLIP_N_ROTATE_TILE&&r!==B.e.FLIP_N_ROTATE_ROW||(c[1]=[U,1-K,f,1-K,f,1-A,U,1-A]);for(let D=0;D<m;D++)e.push(J+w,D*W-k+Z,0),e.push(J+M+w,D*W-k+Z,0),e.push(J+M+w,(D+1)*W-k+Z,0),e.push(J+w,(D+1)*W-k+Z,0),z.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,N=r===B.e.FLIP_TILE||r===B.e.ROTATE_TILE||r===B.e.FLIP_N_ROTATE_TILE?N.concat(c[(D+1)%2]):r===B.e.FLIP_ROW||r===B.e.ROTATE_ROW||r===B.e.FLIP_N_ROTATE_ROW?N.concat(c[D%2]):N.concat(c[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(E){const c=[];U=0,K=0,f=M/W,A=1,c[0]=[U,K,f,K,f,A,U,A],c[1]=[U,K,f,K,f,A,U,A],r!==B.e.ROTATE_TILE&&r!==B.e.ROTATE_ROW||(c[1]=[1-U,1-K,1-f,1-K,1-f,1-A,1-U,1-A]),r!==B.e.FLIP_TILE&&r!==B.e.FLIP_ROW||(c[1]=[1-U,K,1-f,K,1-f,A,1-U,A]),r!==B.e.FLIP_N_ROTATE_TILE&&r!==B.e.FLIP_N_ROTATE_ROW||(c[1]=[U,1-K,f,1-K,f,1-A,U,1-A]);for(let D=0;D<m;D++)e.push(j-M+w,D*W-k+Z,0),e.push(j+w,D*W-k+Z,0),e.push(j+w,(D+1)*W-k+Z,0),e.push(j-M+w,(D+1)*W-k+Z,0),z.push(S,S+1,S+3,S+1,S+2,S+3),S+=4,N=r===B.e.FLIP_TILE||r===B.e.ROTATE_TILE||r===B.e.FLIP_N_ROTATE_TILE?N.concat(c[(D+x)%2]):r===B.e.FLIP_ROW||r===B.e.ROTATE_ROW||r===B.e.FLIP_N_ROTATE_ROW?N.concat(c[D%2]):N.concat(c[0]),g.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const K=0===c.sideOrientation?0:c.sideOrientation||u.b.DEFAULTSIDE;u.b._ComputeSides(K,e,z,y,N,c.frontUVs,c.backUVs);const f=new u.b;f.indices=z,f.Nc=e,f.gc=y,f.Sc=N;const A=K===u.b.DOUBLESIDE?g.concat(g):g;return f.zc=A,f}function v(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=new B.e(c,D);r.sideOrientation=B.e._GetDefaultSideOrientation(r.sideOrientation),W._originalBuilderSideOrientation=r.sideOrientation;return Y(r).fc(W,r.updatable),W}function k(c){const r=c.faceUV||new Array(6),D=c.faceColors,t=c.pattern||B.e.NO_FLIP,H=c.width||c.size||1,x=c.height||c.size||1,M=c.depth||c.size||1,E=c.tileWidth||c.tileSize||1,v=c.tileHeight||c.tileSize||1,k=c.alignHorizontal||0,w=c.alignVertical||0,Z=0===c.sideOrientation?0:c.sideOrientation||u.b.DEFAULTSIDE;for(let B=0;B<6;B++)void 0===r[B]&&(r[B]=new W.Vector4(0,0,1,1)),D&&void 0===D[B]&&(D[B]=new m.Xa(1,1,1,1));const J=H/2,q=x/2,j=M/2,X=[];for(let W=0;W<2;W++)X[W]=Y({pattern:t,tileWidth:E,tileHeight:v,width:H,height:x,alignVertical:w,alignHorizontal:k,sideOrientation:Z});for(let W=2;W<4;W++)X[W]=Y({pattern:t,tileWidth:E,tileHeight:v,width:M,height:x,alignVertical:w,alignHorizontal:k,sideOrientation:Z});let e=w;w===B.e.BOTTOM?e=B.e.TOP:w===B.e.TOP&&(e=B.e.BOTTOM);for(let W=4;W<6;W++)X[W]=Y({pattern:t,tileWidth:E,tileHeight:v,width:H,height:M,alignVertical:e,alignHorizontal:k,sideOrientation:Z});let y=[],U=[],N=[],g=[];const z=[],S=[],K=[],f=[];let A=0,h=0;for(let B=0;B<6;B++){const c=X[B].Nc.length;S[B]=[],K[B]=[];for(let r=0;r<c/3;r++)S[B].push(new W.Zr(X[B].Nc[3*r],X[B].Nc[3*r+1],X[B].Nc[3*r+2])),K[B].push(new W.Zr(X[B].gc[3*r],X[B].gc[3*r+1],X[B].gc[3*r+2]));A=X[B].Sc.length,f[B]=[];for(let D=0;D<A;D+=2)f[B][D]=r[B].x+(r[B].z-r[B].x)*X[B].Sc[D],f[B][D+1]=r[B].y+(r[B].w-r[B].y)*X[B].Sc[D+1],a.b&&(f[B][D+1]=1-f[B][D+1]);if(N=N.concat(f[B]),g=g.concat(X[B].indices.map((c=>c+h))),h+=S[B].length,D)for(let r=0;r<4;r++)z.push(D[B].r,D[B].g,D[B].b,D[B].a)}const L=new W.Zr(0,0,j),P=W.Matrix.RotationY(Math.PI);y=S[0].map((c=>W.Zr.TransformNormal(c,P).add(L))).map((c=>[c.x,c.y,c.z])).reduce(((c,r)=>c.concat(r)),[]),U=K[0].map((c=>W.Zr.TransformNormal(c,P))).map((c=>[c.x,c.y,c.z])).reduce(((c,r)=>c.concat(r)),[]),y=y.concat(S[1].map((c=>c.Jr(L))).map((c=>[c.x,c.y,c.z])).reduce(((c,r)=>c.concat(r)),[])),U=U.concat(K[1].map((c=>[c.x,c.y,c.z])).reduce(((c,r)=>c.concat(r)),[]));const G=new W.Zr(J,0,0),d=W.Matrix.RotationY(-Math.PI/2);y=y.concat(S[2].map((c=>W.Zr.TransformNormal(c,d).add(G))).map((c=>[c.x,c.y,c.z])).reduce(((c,r)=>c.concat(r)),[])),U=U.concat(K[2].map((c=>W.Zr.TransformNormal(c,d))).map((c=>[c.x,c.y,c.z])).reduce(((c,r)=>c.concat(r)),[]));const T=W.Matrix.RotationY(Math.PI/2);y=y.concat(S[3].map((c=>W.Zr.TransformNormal(c,T).Jr(G))).map((c=>[c.x,c.y,c.z])).reduce(((c,r)=>c.concat(r)),[])),U=U.concat(K[3].map((c=>W.Zr.TransformNormal(c,T))).map((c=>[c.x,c.y,c.z])).reduce(((c,r)=>c.concat(r)),[]));const b=new W.Zr(0,q,0),O=W.Matrix.RotationX(Math.PI/2);y=y.concat(S[4].map((c=>W.Zr.TransformNormal(c,O).add(b))).map((c=>[c.x,c.y,c.z])).reduce(((c,r)=>c.concat(r)),[])),U=U.concat(K[4].map((c=>W.Zr.TransformNormal(c,O))).map((c=>[c.x,c.y,c.z])).reduce(((c,r)=>c.concat(r)),[]));const C=W.Matrix.RotationX(-Math.PI/2);y=y.concat(S[5].map((c=>W.Zr.TransformNormal(c,C).Jr(b))).map((c=>[c.x,c.y,c.z])).reduce(((c,r)=>c.concat(r)),[])),U=U.concat(K[5].map((c=>W.Zr.TransformNormal(c,C))).map((c=>[c.x,c.y,c.z])).reduce(((c,r)=>c.concat(r)),[])),u.b._ComputeSides(Z,y,g,U,N);const p=new u.b;if(p.indices=g,p.Nc=y,p.gc=U,p.Sc=N,D){const c=Z===u.b.DOUBLESIDE?z.concat(z):z;p.zc=c}return p}function w(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=new B.e(c,D);r.sideOrientation=B.e._GetDefaultSideOrientation(r.sideOrientation),W._originalBuilderSideOrientation=r.sideOrientation;return k(r).fc(W,r.updatable),W}u.b.CreateTiledPlane=Y;u.b.CreateTiledBox=k;var Z=D(13057),J=D(11924),q=D(11886);function j(c){const r=c.height||2;let D=0===c.diameterTop?0:c.diameterTop||c.diameter||1,t=0===c.diameterBottom?0:c.diameterBottom||c.diameter||1;D=D||1e-5,t=t||1e-5;const H=0|(c.tessellation||24),x=0|(c.subdivisions||1),M=!!c.hasRings,E=!!c.enclose,Y=0===c.cap?0:c.cap||B.e.CAP_ALL,v=c.arc&&(c.arc<=0||c.arc>1)?1:c.arc||1,k=0===c.sideOrientation?0:c.sideOrientation||u.b.DEFAULTSIDE,w=c.faceUV||new Array(3),Z=c.faceColors,J=2+(1+(1!==v&&E?2:0))*(M?x:1);let j;for(j=0;j<J;j++)Z&&void 0===Z[j]&&(Z[j]=new m.Xa(1,1,1,1));for(j=0;j<J;j++)w&&void 0===w[j]&&(w[j]=new W.Vector4(0,0,1,1));const X=[],e=[],y=[],U=[],N=[],g=2*Math.PI*v/H;let z,S,K;const f=(t-D)/2/r,A=W.Zr.Zero(),h=W.Zr.Zero(),L=W.Zr.Zero(),P=W.Zr.Zero(),G=W.Zr.Zero(),d=q.b.Y;let T,b,O,C=1,p=1,R=0,s=0;for(T=0;T<=x;T++)for(S=T/x,K=(S*(D-t)+t)/2,C=M&&0!==T&&T!==x?2:1,O=0;O<C;O++){for(M&&(p+=O),E&&(p+=2*O),b=0;b<=H;b++)z=b*g,A.x=Math.cos(-z)*K,A.y=-r/2+S*r,A.z=Math.sin(-z)*K,0===D&&T===x?(h.x=y[y.length-3*(H+1)],h.y=y[y.length-3*(H+1)+1],h.z=y[y.length-3*(H+1)+2]):(h.x=A.x,h.z=A.z,h.y=Math.sqrt(h.x*h.x+h.z*h.z)*f,h.normalize()),0===b&&(L.t(A),P.t(h)),e.push(A.x,A.y,A.z),y.push(h.x,h.y,h.z),s=M?R!==p?w[p].y:w[p].w:w[p].y+(w[p].w-w[p].y)*S,U.push(w[p].x+(w[p].z-w[p].x)*b/H,a.b?1-s:s),Z&&N.push(Z[p].r,Z[p].g,Z[p].b,Z[p].a);1!==v&&E&&(e.push(A.x,A.y,A.z),e.push(0,A.y,0),e.push(0,A.y,0),e.push(L.x,L.y,L.z),W.Zr.CrossToRef(d,h,G),G.normalize(),y.push(G.x,G.y,G.z,G.x,G.y,G.z),W.Zr.CrossToRef(P,d,G),G.normalize(),y.push(G.x,G.y,G.z,G.x,G.y,G.z),s=M?R!==p?w[p+1].y:w[p+1].w:w[p+1].y+(w[p+1].w-w[p+1].y)*S,U.push(w[p+1].x,a.b?1-s:s),U.push(w[p+1].z,a.b?1-s:s),s=M?R!==p?w[p+2].y:w[p+2].w:w[p+2].y+(w[p+2].w-w[p+2].y)*S,U.push(w[p+2].x,a.b?1-s:s),U.push(w[p+2].z,a.b?1-s:s),Z&&(N.push(Z[p+1].r,Z[p+1].g,Z[p+1].b,Z[p+1].a),N.push(Z[p+1].r,Z[p+1].g,Z[p+1].b,Z[p+1].a),N.push(Z[p+2].r,Z[p+2].g,Z[p+2].b,Z[p+2].a),N.push(Z[p+2].r,Z[p+2].g,Z[p+2].b,Z[p+2].a))),R!==p&&(R=p)}const o=1!==v&&E?H+4:H;for(T=0,p=0;p<x;p++){let c=0,r=0,D=0,W=0;for(b=0;b<H;b++)c=T*(o+1)+b,r=(T+1)*(o+1)+b,D=T*(o+1)+(b+1),W=(T+1)*(o+1)+(b+1),X.push(c,r,D),X.push(W,D,r);1!==v&&E&&(X.push(c+2,r+2,D+2),X.push(W+2,D+2,r+2),X.push(c+4,r+4,D+4),X.push(W+4,D+4,r+4)),T=M?T+2:T+1}const Q=c=>{const B=c?D/2:t/2;if(0===B)return;let u,x,M;const E=c?w[J-1]:w[0];let m=null;Z&&(m=c?Z[J-1]:Z[0]);const Y=e.length/3,k=c?r/2:-r/2,q=new W.Zr(0,k,0);e.push(q.x,q.y,q.z),y.push(0,c?1:-1,0);const j=E.y+.5*(E.w-E.y);U.push(E.x+.5*(E.z-E.x),a.b?1-j:j),m&&N.push(m.r,m.g,m.b,m.a);const g=new W.Vector2(.5,.5);for(M=0;M<=H;M++){u=2*Math.PI*M*v/H;const r=Math.cos(-u),D=Math.sin(-u);x=new W.Zr(r*B,k,D*B);const t=new W.Vector2(r*g.x+.5,D*g.y+.5);e.push(x.x,x.y,x.z),y.push(0,c?1:-1,0);const Y=E.y+(E.w-E.y)*t.y;U.push(E.x+(E.z-E.x)*t.x,a.b?1-Y:Y),m&&N.push(m.r,m.g,m.b,m.a)}for(M=0;M<H;M++)c?(X.push(Y),X.push(Y+(M+2)),X.push(Y+(M+1))):(X.push(Y),X.push(Y+(M+1)),X.push(Y+(M+2)))};Y!==B.e.CAP_START&&Y!==B.e.CAP_ALL||Q(!1),Y!==B.e.CAP_END&&Y!==B.e.CAP_ALL||Q(!0),u.b._ComputeSides(k,e,X,y,U,c.frontUVs,c.backUVs);const l=new u.b;return l.indices=X,l.Nc=e,l.gc=y,l.Sc=U,Z&&(l.zc=N),l}function X(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;const W=new B.e(c,D);r.sideOrientation=B.e._GetDefaultSideOrientation(r.sideOrientation),W._originalBuilderSideOrientation=r.sideOrientation;return j(r).fc(W,r.updatable),W}function e(c){const r=[],D=[],B=[],t=[],H=c.diameter||1,x=c.thickness||.5,M=0|(c.tessellation||16),E=0===c.sideOrientation?0:c.sideOrientation||u.b.DEFAULTSIDE,m=M+1;for(let u=0;u<=M;u++){const c=u/M,E=u*Math.PI*2/M-Math.PI/2,Y=W.Matrix.Translation(H/2,0,0).multiply(W.Matrix.RotationY(E));for(let H=0;H<=M;H++){const E=1-H/M,v=H*Math.PI*2/M+Math.PI,k=Math.cos(v),w=Math.sin(v);let Z=new W.Zr(k,w,0),J=Z.scale(x/2);const q=new W.Vector2(c,E);J=W.Zr.TransformCoordinates(J,Y),Z=W.Zr.TransformNormal(Z,Y),D.push(J.x,J.y,J.z),B.push(Z.x,Z.y,Z.z),t.push(q.x,a.b?1-q.y:q.y);const j=(u+1)%m,X=(H+1)%m;r.push(u*m+H),r.push(u*m+X),r.push(j*m+H),r.push(u*m+X),r.push(j*m+X),r.push(j*m+H)}}u.b._ComputeSides(E,D,r,B,t,c.frontUVs,c.backUVs);const Y=new u.b;return Y.indices=r,Y.Nc=D,Y.gc=B,Y.Sc=t,Y}function y(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;const W=new B.e(c,D);r.sideOrientation=B.e._GetDefaultSideOrientation(r.sideOrientation),W._originalBuilderSideOrientation=r.sideOrientation;return e(r).fc(W,r.updatable),W}u.b.CreateCylinder=j,B.e.CreateCylinder=(c,r,D,W,t,u,a,H,x)=>{void 0!==a&&a instanceof J.b||(void 0!==a&&(x=H||B.e.DEFAULTSIDE,H=a),a=u,u=1);return X(c,{height:r,diameterTop:D,diameterBottom:W,tessellation:t,subdivisions:u,sideOrientation:x,updatable:H},a)};function U(c){const r=[],D=[],B=[],t=[],H=c.radius||2,x=c.tube||.5,M=c.radialSegments||32,E=c.tubularSegments||32,m=c.p||2,Y=c.q||3,v=0===c.sideOrientation?0:c.sideOrientation||u.b.DEFAULTSIDE,k=c=>{const r=Math.cos(c),D=Math.sin(c),B=Y/m*c,t=Math.cos(B),u=H*(2+t)*.5*r,a=H*(2+t)*D*.5,x=H*Math.sin(B)*.5;return new W.Zr(u,a,x)};let w,Z;for(w=0;w<=M;w++){const c=w%M/M*2*m*Math.PI,r=k(c),B=k(c+.01),u=B.Jr(r);let H=B.add(r);const Y=W.Zr.Cross(u,H);for(H=W.Zr.Cross(Y,u),Y.normalize(),H.normalize(),Z=0;Z<E;Z++){const c=Z%E/E*2*Math.PI,W=-x*Math.cos(c),B=x*Math.sin(c);D.push(r.x+W*H.x+B*Y.x),D.push(r.y+W*H.y+B*Y.y),D.push(r.z+W*H.z+B*Y.z),t.push(w/M),t.push(a.b?1-Z/E:Z/E)}}for(w=0;w<M;w++)for(Z=0;Z<E;Z++){const c=(Z+1)%E,D=w*E+Z,W=(w+1)*E+Z,B=(w+1)*E+c,t=w*E+c;r.push(t),r.push(W),r.push(D),r.push(t),r.push(B),r.push(W)}u.b.ComputeNormals(D,r,B),u.b._ComputeSides(v,D,r,B,t,c.frontUVs,c.backUVs);const J=new u.b;return J.indices=r,J.Nc=D,J.gc=B,J.Sc=t,J}function N(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2?arguments[2]:void 0;const W=new B.e(c,D);r.sideOrientation=B.e._GetDefaultSideOrientation(r.sideOrientation),W._originalBuilderSideOrientation=r.sideOrientation;return U(r).fc(W,r.updatable),W}u.b.CreateTorus=e,B.e.CreateTorus=(c,r,D,W,B,t,u)=>y(c,{diameter:r,thickness:D,tessellation:W,sideOrientation:u,updatable:t},B);u.b.CreateTorusKnot=U,B.e.CreateTorusKnot=(c,r,D,W,B,t,u,a,H,x)=>N(c,{radius:r,tube:D,radialSegments:W,tubularSegments:B,p:t,q:u,sideOrientation:x,updatable:H},a);var g=D(13560),z=D(12232),S=D(11899);function K(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=r.path,t=r.shape,u=r.scale||1,a=r.rotation||0,H=0===r.cap?0:r.cap||B.e.NO_CAP,x=r.updatable,M=B.e._GetDefaultSideOrientation(r.sideOrientation),E=r.instance||null,m=r.invertUV||!1,Y=r.closeShape||!1,v=r.closePath||!1,k=r.capFunction||null;return A(c,t,W,u,a,null,null,v,Y,H,!1,D,!!x,M,E,m,r.frontUVs||null,r.backUVs||null,r.firstNormal||null,!!r.adjustFrame,k)}function f(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=r.path,t=r.shape,u=r.scaleFunction||(()=>1),a=r.rotationFunction||(()=>0),H=r.closePath||r.ribbonCloseArray||!1,x=r.closeShape||r.ribbonClosePath||!1,M=0===r.cap?0:r.cap||B.e.NO_CAP,E=r.updatable,m=r.firstNormal||null,Y=r.adjustFrame||!1,v=B.e._GetDefaultSideOrientation(r.sideOrientation),k=r.instance,w=r.invertUV||!1,Z=r.capFunction||null;return A(c,t,W,null,null,u,a,H,x,M,!0,D,!!E,v,k||null,w,r.frontUVs||null,r.backUVs||null,m,Y,Z||null)}function A(c,r,D,t,u,a,H,M,E,m,Y,v,k,w,Z,J,q,j,X,e,y){const U=(c,r,D,t,u,a,H,x,M,E,m)=>{const Y=D.getTangents(),v=D.getNormals(),k=D.getBinormals(),w=D.getDistances();if(m)for(let B=0;B<Y.length;B++)if(0==Y[B].x&&0==Y[B].y&&0==Y[B].z&&Y[B].t(Y[B-1]),0==v[B].x&&0==v[B].y&&0==v[B].z&&v[B].t(v[B-1]),0==k[B].x&&0==k[B].y&&0==k[B].z&&k[B].t(k[B-1]),B>0){let c=Y[B-1];W.Zr.Dot(c,Y[B])<0&&Y[B].scaleInPlace(-1),c=v[B-1],W.Zr.Dot(c,v[B])<0&&v[B].scaleInPlace(-1),c=k[B-1],W.Zr.Dot(c,k[B])<0&&k[B].scaleInPlace(-1)}let Z=0;const J=E&&x?x:()=>null!==a?a:0,q=E&&H?H:()=>null!==u?u:1;let j=M===B.e.NO_CAP||M===B.e.CAP_END?0:2;const X=W.TmpVectors.Matrix[0];for(let B=0;B<r.length;B++){const D=[],u=J(B,w[B]),a=q(B,w[B]);W.Matrix.RotationAxisToRef(Y[B],Z,X);for(let t=0;t<c.length;t++){const u=Y[B].scale(c[t].z).add(v[B].scale(c[t].x)).add(k[B].scale(c[t].y)),H=W.Zr.Zero();W.Zr.TransformCoordinatesToRef(u,X,H),H.scaleInPlace(a).addInPlace(r[B]),D[t]=H}t[j]=D,Z+=u,j++}const e=y||(c=>{const r=Array(),D=W.Zr.Zero();let B;for(B=0;B<c.length;B++)D.addInPlace(c[B]);for(D.scaleInPlace(1/c.length),B=0;B<c.length;B++)r.push(D);return r});switch(M){case B.e.NO_CAP:break;case B.e.CAP_START:t[0]=e(t[2]),t[1]=t[2];break;case B.e.CAP_END:t[j]=t[j-1],t[j+1]=e(t[j-1]);break;case B.e.CAP_ALL:t[0]=e(t[2]),t[1]=t[2],t[j]=t[j-1],t[j+1]=e(t[j-1])}return t};let N,g;if(Z){const c=Z._creationDataStorage;return N=X?c.path3D.update(D,X):c.path3D.update(D),g=U(r,D,c.path3D,c.pathArray,t,u,a,H,c.cap,Y,e),Z=x("",{pathArray:g,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:Z},v||void 0)}N=X?new S.f(D,X):new S.f(D);g=U(r,D,N,new Array,t,u,a,H,m=m<0||m>3?0:m,Y,e);const z=x(c,{pathArray:g,closeArray:M,closePath:E,updatable:k,sideOrientation:w,invertUV:J,frontUVs:q||void 0,backUVs:j||void 0},v);return z._creationDataStorage.pathArray=g,z._creationDataStorage.path3D=N,z._creationDataStorage.cap=m,z}function h(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=r.arc?r.arc<=0||r.arc>1?1:r.arc:1,u=void 0===r.closed||r.closed,a=r.shape,H=r.radius||1,M=r.tessellation||64,E=r.clip||0,m=r.updatable,Y=B.e._GetDefaultSideOrientation(r.sideOrientation),v=r.cap||B.e.NO_CAP,k=2*Math.PI,w=[],Z=r.invertUV||!1;let J=0,q=0;const j=k/M*t;let X,e;for(J=0;J<=M-E;J++){for(e=[],v!=B.e.CAP_START&&v!=B.e.CAP_ALL||(e.push(new W.Zr(0,a[0].y,0)),e.push(new W.Zr(Math.cos(J*j)*a[0].x*H,a[0].y,Math.sin(J*j)*a[0].x*H))),q=0;q<a.length;q++)X=new W.Zr(Math.cos(J*j)*a[q].x*H,a[q].y,Math.sin(J*j)*a[q].x*H),e.push(X);v!=B.e.CAP_END&&v!=B.e.CAP_ALL||(e.push(new W.Zr(Math.cos(J*j)*a[a.length-1].x*H,a[a.length-1].y,Math.sin(J*j)*a[a.length-1].x*H)),e.push(new W.Zr(0,a[a.length-1].y,0))),w.push(e)}return x(c,{pathArray:w,closeArray:u,sideOrientation:Y,updatable:m,invertUV:Z,frontUVs:r.frontUVs,backUVs:r.backUVs},D)}B.e.ExtrudeShape=function(c,r,D,W,t,u){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7?arguments[7]:void 0,x=arguments.length>8?arguments[8]:void 0,M=arguments.length>9?arguments[9]:void 0;return K(c,{shape:r,path:D,scale:W,rotation:t,cap:0===u?0:u||B.e.NO_CAP,sideOrientation:x,instance:M,updatable:H},a)},B.e.ExtrudeShapeCustom=(c,r,D,W,t,u,a,H,x,M,E,m)=>f(c,{shape:r,path:D,scaleFunction:W,rotationFunction:t,ribbonCloseArray:u,ribbonClosePath:a,cap:0===H?0:H||B.e.NO_CAP,sideOrientation:E,instance:m,updatable:M},x);B.e.CreateLathe=(c,r,D,W,B,t,u)=>h(c,{shape:r,radius:D,tessellation:W,sideOrientation:u,updatable:t},B);var L=D(12974),P=D(12925);function G(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=r.path;let u=r.instance,a=1;void 0!==r.radius?a=r.radius:u&&(a=u._creationDataStorage.radius);const H=r.tessellation||64,M=r.radiusFunction||null;let E=r.cap||B.e.NO_CAP;const m=r.invertUV||!1,Y=r.updatable,v=B.e._GetDefaultSideOrientation(r.sideOrientation);r.arc=r.arc&&(r.arc<=0||r.arc>1)?1:r.arc||1;const k=(c,r,D,t,u,a,H,x)=>{const M=r.getTangents(),E=r.getNormals(),m=r.getDistances(),Y=2*Math.PI/u*x,v=a||(()=>t);let k,w,Z,J;const q=W.TmpVectors.Matrix[0];let j=H===B.e.NO_CAP||H===B.e.CAP_END?0:2;for(let B=0;B<c.length;B++){w=v(B,m[B]),k=Array(),Z=E[B];for(let r=0;r<u;r++)W.Matrix.RotationAxisToRef(M[B],Y*r,q),J=k[r]?k[r]:W.Zr.Zero(),W.Zr.TransformCoordinatesToRef(Z,q,J),J.scaleInPlace(w).addInPlace(c[B]),k[r]=J;D[j]=k,j++}const X=(r,D)=>{const W=Array();for(let B=0;B<r;B++)W.push(c[D]);return W};switch(H){case B.e.NO_CAP:break;case B.e.CAP_START:D[0]=X(u,0),D[1]=D[2].slice(0);break;case B.e.CAP_END:D[j]=D[j-1].slice(0),D[j+1]=X(u,c.length-1);break;case B.e.CAP_ALL:D[0]=X(u,0),D[1]=D[2].slice(0),D[j]=D[j-1].slice(0),D[j+1]=X(u,c.length-1)}return D};let w,Z;if(u){const c=u._creationDataStorage,D=r.arc||c.arc;return w=c.path3D.update(t),Z=k(t,w,c.pathArray,a,c.tessellation,M,c.cap,D),u=x("",{pathArray:Z,instance:u}),c.path3D=w,c.pathArray=Z,c.arc=D,c.radius=a,u}w=new S.f(t);E=E<0||E>3?0:E,Z=k(t,w,new Array,a,H,M,E,r.arc);const J=x(c,{pathArray:Z,closePath:!0,closeArray:!1,updatable:Y,sideOrientation:v,invertUV:m,frontUVs:r.frontUVs,backUVs:r.backUVs},D);return J._creationDataStorage.pathArray=Z,J._creationDataStorage.path3D=w,J._creationDataStorage.tessellation=H,J._creationDataStorage.cap=E,J._creationDataStorage.arc=r.arc,J._creationDataStorage.radius=a,J}function d(c){const r=[];r[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},r[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},r[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},r[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},r[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},r[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},r[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},r[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},r[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},r[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},r[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},r[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},r[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},r[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},r[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const D=c.type&&(c.type<0||c.type>=r.length)?0:c.type||0,B=c.size,t=c.sizeX||B||1,H=c.sizeY||B||1,x=c.sizeZ||B||1,M=c.custom||r[D],E=M.face.length,Y=c.faceUV||new Array(E),v=c.faceColors,k=void 0===c.flat||c.flat,w=0===c.sideOrientation?0:c.sideOrientation||u.b.DEFAULTSIDE,Z=[],J=[],q=[],j=[],X=[];let e=0,y=0;const U=[];let N,g,z,S,K,f,A=0,h=0;if(k)for(h=0;h<E;h++)v&&void 0===v[h]&&(v[h]=new m.Xa(1,1,1,1)),Y&&void 0===Y[h]&&(Y[h]=new W.Vector4(0,0,1,1));if(k)for(h=0;h<E;h++){const c=M.face[h].length;for(z=2*Math.PI/c,S=.5*Math.tan(z/2),K=.5,A=0;A<c;A++)Z.push(M.vertex[M.face[h][A]][0]*t,M.vertex[M.face[h][A]][1]*H,M.vertex[M.face[h][A]][2]*x),U.push(e),e++,N=Y[h].x+(Y[h].z-Y[h].x)*(.5+S),g=Y[h].y+(Y[h].w-Y[h].y)*(K-.5),j.push(N,a.b?1-g:g),f=S*Math.cos(z)-K*Math.sin(z),K=S*Math.sin(z)+K*Math.cos(z),S=f,v&&X.push(v[h].r,v[h].g,v[h].b,v[h].a);for(A=0;A<c-2;A++)J.push(U[0+y],U[A+2+y],U[A+1+y]);y+=c}else{for(A=0;A<M.vertex.length;A++)Z.push(M.vertex[A][0]*t,M.vertex[A][1]*H,M.vertex[A][2]*x),j.push(0,a.b?1:0);for(h=0;h<E;h++)for(A=0;A<M.face[h].length-2;A++)J.push(M.face[h][0],M.face[h][A+2],M.face[h][A+1])}u.b.ComputeNormals(Z,J,q),u.b._ComputeSides(w,Z,J,q,j,c.frontUVs,c.backUVs);const L=new u.b;return L.Nc=Z,L.indices=J,L.gc=q,L.Sc=j,v&&k&&(L.zc=X),L}function T(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=new B.e(c,D);r.sideOrientation=B.e._GetDefaultSideOrientation(r.sideOrientation),W._originalBuilderSideOrientation=r.sideOrientation;return d(r).fc(W,r.updatable),W}B.e.CreateTube=(c,r,D,W,B,t,u,a,H,x)=>G(c,{path:r,radius:D,tessellation:W,radiusFunction:B,arc:1,cap:t,updatable:a,sideOrientation:H,instance:x},u);function b(c){const r=c.sideOrientation||u.b.DEFAULTSIDE,D=c.radius||1,B=void 0===c.flat||c.flat,t=0|(c.subdivisions||4),H=c.radiusX||D,x=c.radiusY||D,M=c.radiusZ||D,E=(1+Math.sqrt(5))/2,m=[-1,E,-0,1,E,0,-1,-E,0,1,-E,0,0,-1,-E,0,1,-E,0,-1,E,0,1,E,E,0,1,E,0,-1,-E,0,1,-E,0,-1],Y=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],v=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],k=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],w=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],Z=[],J=[],q=[],j=[];let X=0;const e=new Array(3),y=new Array(3);let U;for(U=0;U<3;U++)e[U]=W.Zr.Zero(),y[U]=W.Vector2.Zero();for(let u=0;u<20;u++){for(U=0;U<3;U++){const c=Y[3*u+U];e[U].Ja(m[3*v[c]],m[3*v[c]+1],m[3*v[c]+2]),e[U].normalize(),y[U].Ja(.134765625*k[2*c]+.05859375+-.0390625*w[u],.2333984375*k[2*c+1]+.025390625+.01953125*w[u])}const c=(c,r,D,u)=>{const E=W.Zr.Lerp(e[0],e[2],r/t),m=W.Zr.Lerp(e[1],e[2],r/t),Y=t===r?e[2]:W.Zr.Lerp(E,m,c/(t-r));let v;if(Y.normalize(),B){const c=W.Zr.Lerp(e[0],e[2],u/t),r=W.Zr.Lerp(e[1],e[2],u/t);v=W.Zr.Lerp(c,r,D/(t-u))}else v=new W.Zr(Y.x,Y.y,Y.z);v.x/=H,v.y/=x,v.z/=M,v.normalize();const k=W.Vector2.Lerp(y[0],y[2],r/t),w=W.Vector2.Lerp(y[1],y[2],r/t),U=t===r?y[2]:W.Vector2.Lerp(k,w,c/(t-r));J.push(Y.x*H,Y.y*x,Y.z*M),q.push(v.x,v.y,v.z),j.push(U.x,a.b?1-U.y:U.y),Z.push(X),X++};for(let r=0;r<t;r++)for(let D=0;D+r<t;D++)c(D,r,D+1/3,r+1/3),c(D+1,r,D+1/3,r+1/3),c(D,r+1,D+1/3,r+1/3),D+r+1<t&&(c(D+1,r,D+2/3,r+2/3),c(D+1,r+1,D+2/3,r+2/3),c(D,r+1,D+2/3,r+2/3))}u.b._ComputeSides(r,J,Z,q,j,c.frontUVs,c.backUVs);const N=new u.b;return N.indices=Z,N.Nc=J,N.gc=q,N.Sc=j,N}function O(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=new B.e(c,D);r.sideOrientation=B.e._GetDefaultSideOrientation(r.sideOrientation),W._originalBuilderSideOrientation=r.sideOrientation;return b(r).fc(W,r.updatable),W}u.b.CreatePolyhedron=d,B.e.CreatePolyhedron=(c,r,D)=>T(c,r,D);u.b.CreateIcoSphere=b,B.e.CreateIcoSphere=(c,r,D)=>O(c,r,D);var C=D(11696);const p=new W.Zr(1,0,0),R=new W.Zr(-1,0,0),s=new W.Zr(0,1,0),o=new W.Zr(0,-1,0),Q=new W.Zr(0,0,1),l=new W.Zr(0,0,-1);class F{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W.Zr.Zero(),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W.Zr.Up(),D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.Vector2.Zero(),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=c,this.normal=r,this.uv=D,this.vertexIdx=B,this.vertexIdxForBones=t,this.localPositionOverride=u,this.localNormalOverride=a,this.matrixIndicesOverride=H,this.matrixWeightsOverride=x}clone(){var c,r,D,W;return new F(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(c=this.localPositionOverride)||void 0===c?void 0:c.slice(),null===(r=this.localNormalOverride)||void 0===r?void 0:r.slice(),null===(D=this.matrixIndicesOverride)||void 0===D?void 0:D.slice(),null===(W=this.matrixWeightsOverride)||void 0===W?void 0:W.slice())}}function I(c,r,D){var H,x,M,E,m;const Y=!!r.skeleton,v=!(null===(H=r.morphTargetManager)||void 0===H||!H.numTargets),k=D.localMode||Y,w=r.wa(),Z=Y||v?r.La(!0,!0):r.getVerticesData(t.d.PositionKind),J=Y||v?r.getNormalsData(!0,!0):r.getVerticesData(t.d.NormalKind),q=k?Y?r.getVerticesData(t.d.PositionKind):Z:null,j=k?Y?r.getVerticesData(t.d.NormalKind):J:null,X=r.getVerticesData(t.d.UVKind),e=Y?r.getVerticesData(t.d.MatricesIndicesKind):null,y=Y?r.getVerticesData(t.d.MatricesWeightsKind):null,U=Y?r.getVerticesData(t.d.MatricesIndicesExtraKind):null,N=Y?r.getVerticesData(t.d.MatricesWeightsExtraKind):null,g=D.position||W.Zr.Zero();let z=D.normal||W.Zr.Up();const S=D.size||W.Zr.One(),K=D.angle||0;if(!z){const c=new W.Zr(0,0,1),D=r.yc().activeCamera,B=W.Zr.TransformCoordinates(c,D.getWorldMatrix());z=D.globalPosition.Jr(B)}const f=-Math.atan2(z.z,z.x)-Math.PI/2,A=Math.sqrt(z.x*z.x+z.z*z.z),h=Math.atan2(z.y,A),L=new u.b;L.indices=[],L.Nc=[],L.gc=[],L.Sc=[],L.matricesIndices=Y?[]:null,L.matricesWeights=Y?[]:null,L.matricesIndicesExtra=U?[]:null,L.matricesWeightsExtra=N?[]:null;let P=0;const G=(c,r)=>{const B=new F;if(!w||!Z||!J)return B;const t=w[c];if(B.vertexIdx=3*t,B.vertexIdxForBones=4*t,B.position=new W.Zr(Z[3*t],Z[3*t+1],Z[3*t+2]),W.Zr.TransformCoordinatesToRef(B.position,r,B.position),B.normal=new W.Zr(J[3*t],J[3*t+1],J[3*t+2]),W.Zr.TransformNormalToRef(B.normal,r,B.normal),D.captureUVS&&X){const c=X[2*t+1];B.uv=new W.Vector2(X[2*t],a.b?1-c:c)}return B},d=[0,0,0,0],T=(c,r)=>{if(0===c.length)return c;const D=.5*Math.abs(W.Zr.Dot(S,r)),B=(c,r,D,W)=>{for(let B=0;B<W;++B)if(c[D+B]===r)return D+B;return-1},t=(c,t)=>{const u=W.Zr.GetClipFactor(c.position,t.position,r,D);let a=d,H=d;if(e&&y){const r=c.matrixIndicesOverride?0:c.vertexIdxForBones,D=c.matrixIndicesOverride??e,W=c.matrixWeightsOverride??y,x=t.matrixIndicesOverride?0:t.vertexIdxForBones,M=t.matrixIndicesOverride??e,E=t.matrixWeightsOverride??y;a=[0,0,0,0],H=[0,0,0,0];let m=0;for(let c=0;c<4;++c)if(W[r+c]>0){const t=B(M,D[r+c],x,4);a[m]=D[r+c],H[m]=(0,C.Lerp)(W[r+c],t>=0?E[t]:0,u),m++}for(let c=0;c<4&&m<4;++c){const W=M[x+c];-1===B(D,W,r,4)&&(a[m]=W,H[m]=(0,C.Lerp)(0,E[x+c],u),m++)}const Y=H[0]+H[1]+H[2]+H[3];H[0]/=Y,H[1]/=Y,H[2]/=Y,H[3]/=Y}const x=c.localPositionOverride?c.localPositionOverride[0]:(null===q||void 0===q?void 0:q[c.vertexIdx])??0,M=c.localPositionOverride?c.localPositionOverride[1]:(null===q||void 0===q?void 0:q[c.vertexIdx+1])??0,E=c.localPositionOverride?c.localPositionOverride[2]:(null===q||void 0===q?void 0:q[c.vertexIdx+2])??0,m=t.localPositionOverride?t.localPositionOverride[0]:(null===q||void 0===q?void 0:q[t.vertexIdx])??0,Y=t.localPositionOverride?t.localPositionOverride[1]:(null===q||void 0===q?void 0:q[t.vertexIdx+1])??0,v=t.localPositionOverride?t.localPositionOverride[2]:(null===q||void 0===q?void 0:q[t.vertexIdx+2])??0,k=c.localNormalOverride?c.localNormalOverride[0]:(null===j||void 0===j?void 0:j[c.vertexIdx])??0,w=c.localNormalOverride?c.localNormalOverride[1]:(null===j||void 0===j?void 0:j[c.vertexIdx+1])??0,Z=c.localNormalOverride?c.localNormalOverride[2]:(null===j||void 0===j?void 0:j[c.vertexIdx+2])??0,J=k+((t.localNormalOverride?t.localNormalOverride[0]:(null===j||void 0===j?void 0:j[t.vertexIdx])??0)-k)*u,X=w+((t.localNormalOverride?t.localNormalOverride[1]:(null===j||void 0===j?void 0:j[t.vertexIdx+1])??0)-w)*u,U=Z+((t.localNormalOverride?t.localNormalOverride[2]:(null===j||void 0===j?void 0:j[t.vertexIdx+2])??0)-Z)*u,N=Math.sqrt(J*J+X*X+U*U);return new F(W.Zr.Lerp(c.position,t.position,u),W.Zr.Lerp(c.normal,t.normal,u).normalize(),W.Vector2.Lerp(c.uv,t.uv,u),-1,-1,q?[x+(m-x)*u,M+(Y-M)*u,E+(v-E)*u]:null,j?[J/N,X/N,U/N]:null,a,H)};let u=null;c.length>3&&(u=[]);for(let a=0;a<c.length;a+=3){let B=0,H=null,x=null,M=null,E=null;const m=W.Zr.Dot(c[a].position,r)-D>0,Y=W.Zr.Dot(c[a+1].position,r)-D>0,v=W.Zr.Dot(c[a+2].position,r)-D>0;switch(B=(m?1:0)+(Y?1:0)+(v?1:0),B){case 0:c.length>3?(u.push(c[a]),u.push(c[a+1]),u.push(c[a+2])):u=c;break;case 1:if(u=u??new Array,m&&(H=c[a+1],x=c[a+2],M=t(c[a],H),E=t(c[a],x)),Y){H=c[a],x=c[a+2],M=t(c[a+1],H),E=t(c[a+1],x),u.push(M),u.push(x.clone()),u.push(H.clone()),u.push(x.clone()),u.push(M.clone()),u.push(E);break}v&&(H=c[a],x=c[a+1],M=t(c[a+2],H),E=t(c[a+2],x)),H&&x&&M&&E&&(u.push(H.clone()),u.push(x.clone()),u.push(M),u.push(E),u.push(M.clone()),u.push(x.clone()));break;case 2:u=u??new Array,m||(H=c[a].clone(),x=t(H,c[a+1]),M=t(H,c[a+2]),u.push(H),u.push(x),u.push(M)),Y||(H=c[a+1].clone(),x=t(H,c[a+2]),M=t(H,c[a]),u.push(H),u.push(x),u.push(M)),v||(H=c[a+2].clone(),x=t(H,c[a]),M=t(H,c[a+1]),u.push(H),u.push(x),u.push(M))}}return u},b=r instanceof B.e?r:null,O=null===b||void 0===b?void 0:b._thinInstanceDataStorage.matrixData,I=(null===b||void 0===b?void 0:b.ya)||1,i=W.TmpVectors.Matrix[0];i.t(W.Matrix.IdentityReadOnly);for(let B=0;B<I;++B){if(null!==b&&void 0!==b&&b.hasThinInstances&&O){const c=16*B;i.setRowFromFloats(0,O[c+0],O[c+1],O[c+2],O[c+3]),i.setRowFromFloats(1,O[c+4],O[c+5],O[c+6],O[c+7]),i.setRowFromFloats(2,O[c+8],O[c+9],O[c+10],O[c+11]),i.setRowFromFloats(3,O[c+12],O[c+13],O[c+14],O[c+15])}const c=W.Matrix.RotationYawPitchRoll(f,h,K).multiply(W.Matrix.Translation(g.x,g.y,g.z)),t=W.Matrix.Invert(c),u=r.getWorldMatrix(),H=i.multiply(u).multiply(t),x=new Array(3);for(let r=0;r<w.length;r+=3){let c=x;if(c[0]=G(r,H),c[1]=G(r+1,H),c[2]=G(r+2,H),!(D.cullBackFaces&&-c[0].normal.z<=0&&-c[1].normal.z<=0&&-c[2].normal.z<=0)&&(c=T(c,p),c&&(c=T(c,R),c&&(c=T(c,s),c&&(c=T(c,o),c&&(c=T(c,Q),c&&(c=T(c,l),c)))))))for(let r=0;r<c.length;r++){const W=c[r];if(L.indices.push(P),k?(W.localPositionOverride?(L.Nc[3*P]=W.localPositionOverride[0],L.Nc[3*P+1]=W.localPositionOverride[1],L.Nc[3*P+2]=W.localPositionOverride[2]):q&&(L.Nc[3*P]=q[W.vertexIdx],L.Nc[3*P+1]=q[W.vertexIdx+1],L.Nc[3*P+2]=q[W.vertexIdx+2]),W.localNormalOverride?(L.gc[3*P]=W.localNormalOverride[0],L.gc[3*P+1]=W.localNormalOverride[1],L.gc[3*P+2]=W.localNormalOverride[2]):j&&(L.gc[3*P]=j[W.vertexIdx],L.gc[3*P+1]=j[W.vertexIdx+1],L.gc[3*P+2]=j[W.vertexIdx+2])):(W.position.toArray(L.Nc,3*P),W.normal.toArray(L.gc,3*P)),L.matricesIndices&&L.matricesWeights&&(W.matrixIndicesOverride?(L.matricesIndices[4*P]=W.matrixIndicesOverride[0],L.matricesIndices[4*P+1]=W.matrixIndicesOverride[1],L.matricesIndices[4*P+2]=W.matrixIndicesOverride[2],L.matricesIndices[4*P+3]=W.matrixIndicesOverride[3]):(e&&(L.matricesIndices[4*P]=e[W.vertexIdxForBones],L.matricesIndices[4*P+1]=e[W.vertexIdxForBones+1],L.matricesIndices[4*P+2]=e[W.vertexIdxForBones+2],L.matricesIndices[4*P+3]=e[W.vertexIdxForBones+3]),U&&L.matricesIndicesExtra&&(L.matricesIndicesExtra[4*P]=U[W.vertexIdxForBones],L.matricesIndicesExtra[4*P+1]=U[W.vertexIdxForBones+1],L.matricesIndicesExtra[4*P+2]=U[W.vertexIdxForBones+2],L.matricesIndicesExtra[4*P+3]=U[W.vertexIdxForBones+3])),W.matrixWeightsOverride?(L.matricesWeights[4*P]=W.matrixWeightsOverride[0],L.matricesWeights[4*P+1]=W.matrixWeightsOverride[1],L.matricesWeights[4*P+2]=W.matrixWeightsOverride[2],L.matricesWeights[4*P+3]=W.matrixWeightsOverride[3]):(y&&(L.matricesWeights[4*P]=y[W.vertexIdxForBones],L.matricesWeights[4*P+1]=y[W.vertexIdxForBones+1],L.matricesWeights[4*P+2]=y[W.vertexIdxForBones+2],L.matricesWeights[4*P+3]=y[W.vertexIdxForBones+3]),N&&L.matricesWeightsExtra&&(L.matricesWeightsExtra[4*P]=N[W.vertexIdxForBones],L.matricesWeightsExtra[4*P+1]=N[W.vertexIdxForBones+1],L.matricesWeightsExtra[4*P+2]=N[W.vertexIdxForBones+2],L.matricesWeightsExtra[4*P+3]=N[W.vertexIdxForBones+3]))),D.captureUVS)W.uv.toArray(L.Sc,2*P);else{L.Sc.push(.5+W.position.x/S.x);const c=.5+W.position.y/S.y;L.Sc.push(a.b?1-c:c)}P++}}}0===L.indices.length&&(L.indices=null),0===L.Nc.length&&(L.Nc=null),0===L.gc.length&&(L.gc=null),0===L.Sc.length&&(L.Sc=null),0===(null===(x=L.matricesIndices)||void 0===x?void 0:x.length)&&(L.matricesIndices=null),0===(null===(M=L.matricesWeights)||void 0===M?void 0:M.length)&&(L.matricesWeights=null),0===(null===(E=L.matricesIndicesExtra)||void 0===E?void 0:E.length)&&(L.matricesIndicesExtra=null),0===(null===(m=L.matricesWeightsExtra)||void 0===m?void 0:m.length)&&(L.matricesWeightsExtra=null);const n=new B.e(c,r.yc());return L.fc(n),k?(n.skeleton=r.skeleton,n.parent=r):(n.position=g.clone(),n.rotation=new W.Zr(h,f,K)),n.va(!0),n.refreshBoundingInfo(!0,!0),n}function i(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const r=0|Math.max(c.subdivisions?c.subdivisions:2,1),D=0|Math.max(c.tessellation?c.tessellation:16,3),B=Math.max(c.height?c.height:1,0),t=Math.max(c.radius?c.radius:.25,0),H=0|Math.max(c.capSubdivisions?c.capSubdivisions:6,1),x=D,M=r,E=Math.max(c.radiusTop?c.radiusTop:t,0),m=Math.max(c.radiusBottom?c.radiusBottom:t,0),Y=B-(E+m),v=2*Math.PI,k=Math.max(c.topCapSubdivisions?c.topCapSubdivisions:H,1),w=Math.max(c.bottomCapSubdivisions?c.bottomCapSubdivisions:H,1),Z=Math.acos((m-E)/B);let J=[];const q=[],j=[],X=[];let e=0;const y=[],U=.5*Y,N=.5*Math.PI;let g,z;const S=W.Zr.Zero(),K=W.Zr.Zero(),f=Math.cos(Z),A=Math.sin(Z),h=new W.Vector2(E*A,U+E*f).Jr(new W.Vector2(m*A,m*f-U)).length(),L=E*Z+h+m*(N-Z);let P=0;for(z=0;z<=k;z++){const c=[],r=N-Z*(z/k);P+=E*Z/k;const D=Math.cos(r),W=Math.sin(r),B=D*E;for(g=0;g<=x;g++){const r=g/x,t=r*v+0,u=Math.sin(t),H=Math.cos(t);K.x=B*u,K.y=U+W*E,K.z=B*H,q.push(K.x,K.y,K.z),S.set(D*u,W,D*H),j.push(S.x,S.y,S.z),X.push(r,a.b?P/L:1-P/L),c.push(e),e++}y.push(c)}const G=B-E-m+f*E-f*m,d=A*(m-E)/G;for(z=1;z<=M;z++){const c=[];P+=h/M;const r=A*(z*(m-E)/M+E);for(g=0;g<=x;g++){const D=g/x,W=D*v+0,B=Math.sin(W),t=Math.cos(W);K.x=r*B,K.y=U+f*E-z*G/M,K.z=r*t,q.push(K.x,K.y,K.z),S.set(B,d,t).normalize(),j.push(S.x,S.y,S.z),X.push(D,a.b?P/L:1-P/L),c.push(e),e++}y.push(c)}for(z=1;z<=w;z++){const c=[],r=N-Z-(Math.PI-Z)*(z/w);P+=m*Z/w;const D=Math.cos(r),W=Math.sin(r),B=D*m;for(g=0;g<=x;g++){const r=g/x,t=r*v+0,u=Math.sin(t),H=Math.cos(t);K.x=B*u,K.y=W*m-U,K.z=B*H,q.push(K.x,K.y,K.z),S.set(D*u,W,D*H),j.push(S.x,S.y,S.z),X.push(r,a.b?P/L:1-P/L),c.push(e),e++}y.push(c)}for(g=0;g<x;g++)for(z=0;z<k+M+w;z++){const c=y[z][g],r=y[z+1][g],D=y[z+1][g+1],W=y[z][g+1];J.push(c),J.push(r),J.push(W),J.push(r),J.push(D),J.push(W)}if(J=J.reverse(),c.orientation&&!c.orientation.equals(W.Zr.Up())){const r=new W.Matrix;c.orientation.clone().scale(.5*Math.PI).cross(W.Zr.Up()).toQuaternion().toRotationMatrix(r);const D=W.Zr.Zero();for(let c=0;c<q.length;c+=3)D.set(q[c],q[c+1],q[c+2]),W.Zr.TransformCoordinatesToRef(D.clone(),r,D),q[c]=D.x,q[c+1]=D.y,q[c+2]=D.z}const T=new u.b;return T.Nc=q,T.gc=j,T.Sc=X,T.indices=J,T}function n(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:W.Zr.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new B.e(c,D);return i(r).fc(t,r.updatable),t}B.e.CreateDecal=(c,r,D,W,B,t)=>I(c,r,{position:D,normal:W,size:B,angle:t});B.e.CreateCapsule=(c,r,D)=>n(c,r,D),u.b.CreateCapsule=i;var V=D(11509),cc=D(11687);class rc{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=c,this.y=r,c!==Math.floor(c)&&(c=Math.floor(c),V.e.Warn("x is not an integer, floor(x) used")),r!==Math.floor(r)&&(r=Math.floor(r),V.e.Warn("y is not an integer, floor(y) used"))}clone(){return new rc(this.x,this.y)}rotate60About(c){const r=this.x;return this.x=c.x+c.y-this.y,this.y=r+this.y-c.x,this}rotateNeg60About(c){const r=this.x;return this.x=r+this.y-c.y,this.y=c.x+c.y-r,this}rotate120(c,r){c!==Math.floor(c)&&(c=Math.floor(c),V.e.Warn("m not an integer only floor(m) used")),r!==Math.floor(r)&&(r=Math.floor(r),V.e.Warn("n not an integer only floor(n) used"));const D=this.x;return this.x=c-D-this.y,this.y=r+D,this}rotateNeg120(c,r){c!==Math.floor(c)&&(c=Math.floor(c),V.e.Warn("m is not an integer, floor(m) used")),r!==Math.floor(r)&&(r=Math.floor(r),V.e.Warn("n is not an integer,   floor(n) used"));const D=this.x;return this.x=this.y-r,this.y=c+r-D-this.y,this}toCartesianOrigin(c,r){const D=W.Zr.Zero();return D.x=c.x+2*this.x*r+this.y*r,D.y=c.y+Math.sqrt(3)*this.y*r,D}static Zero(){return new rc(0,0)}}class Dc{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Wc("icosahedron","Regular",[[0,cc.e,-1],[-cc.e,1,0],[-1,0,-cc.e],[1,0,-cc.e],[cc.e,1,0],[0,cc.e,1],[-1,0,cc.e],[-cc.e,-1,0],[0,-cc.e,-1],[cc.e,-1,0],[1,0,cc.e],[0,-cc.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let c=12;const r={},D=this.m,W=this.n;let B,t,u,a,H,x=D,M=1,E=0;0!==W&&(x=(0,C.HighestCommonFactor)(D,W)),M=D/x,E=W/x;const m=rc.Zero(),Y=new rc(D,W),v=new rc(-W,D+W),k=rc.Zero(),w=rc.Zero(),Z=rc.Zero();let J,q,j,X,e=[];const y=[],U=this.vertByDist,N=(D,W,B,t)=>{J=D+"|"+B,q=W+"|"+t,J in r||q in r?J in r&&!(q in r)?r[q]=r[J]:q in r&&!(J in r)&&(r[J]=r[q]):(r[J]=c,r[q]=c,c++),U[B][0]>2?y[r[J]]=[-U[B][0],U[B][1],r[J]]:y[r[J]]=[e[U[B][0]],U[B][1],r[J]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let g=0;g<20;g++){if(e=this.IDATA.face[g],u=e[2],a=e[1],H=e[0],j=m.x+"|"+m.y,J=g+"|"+j,J in r||(r[J]=u,y[u]=[e[U[j][0]],U[j][1]]),j=Y.x+"|"+Y.y,J=g+"|"+j,J in r||(r[J]=a,y[a]=[e[U[j][0]],U[j][1]]),j=v.x+"|"+v.y,J=g+"|"+j,J in r||(r[J]=H,y[H]=[e[U[j][0]],U[j][1]]),B=this.IDATA.edgematch[g][0],t=this.IDATA.edgematch[g][1],"B"===t)for(let c=1;c<x;c++)w.x=D-c*(M+E),w.y=W+c*M,Z.x=-c*E,Z.y=c*(M+E),j=w.x+"|"+w.y,X=Z.x+"|"+Z.y,N(g,B,j,X);if("O"===t)for(let c=1;c<x;c++)Z.x=-c*E,Z.y=c*(M+E),k.x=c*M,k.y=c*E,j=Z.x+"|"+Z.y,X=k.x+"|"+k.y,N(g,B,j,X);if(B=this.IDATA.edgematch[g][2],t=this.IDATA.edgematch[g][3],t&&"A"===t)for(let c=1;c<x;c++)k.x=c*M,k.y=c*E,w.x=D-(x-c)*(M+E),w.y=W+(x-c)*M,j=k.x+"|"+k.y,X=w.x+"|"+w.y,N(g,B,j,X);for(let D=0;D<this.vertices.length;D++)j=this.vertices[D].x+"|"+this.vertices[D].y,J=g+"|"+j,J in r||(r[J]=c++,U[j][0]>2?y[r[J]]=[-U[j][0],U[j][1],r[J]]:y[r[J]]=[e[U[j][0]],U[j][1],r[J]])}this.closestTo=y,this.vecToidx=r}calcCoeffs(){const c=this.m,r=this.n,D=Math.sqrt(3)/3,W=c*c+r*r+c*r;this.coau=(c+r)/W,this.cobu=-r/W,this.coav=-D*(c-r)/W,this.cobv=D*(2*c+r)/W}createInnerFacets(){const c=this.m,r=this.n;for(let D=0;D<r+c+1;D++)for(let c=this.min[D];c<this.max[D]+1;c++)c<this.max[D]&&c<this.max[D+1]+1&&this.innerFacets.push(["|"+c+"|"+D,"|"+c+"|"+(D+1),"|"+(c+1)+"|"+D]),D>0&&c<this.max[D-1]&&c+1<this.max[D]+1&&this.innerFacets.push(["|"+c+"|"+D,"|"+(c+1)+"|"+D,"|"+(c+1)+"|"+(D-1)])}edgeVecsABOB(){const c=this.m,r=this.n,D=new rc(-r,c+r);for(let W=1;W<c+r;W++){const c=new rc(this.min[W],W),r=new rc(this.min[W-1],W-1),B=new rc(this.min[W+1],W+1),t=c.clone(),u=r.clone(),a=B.clone();t.rotate60About(D),u.rotate60About(D),a.rotate60About(D);const H=new rc(this.max[t.y],t.y),x=new rc(this.max[t.y-1],t.y-1),M=new rc(this.max[t.y-1]-1,t.y-1);t.x===H.x&&t.y===H.y||(t.x!==x.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([c,x,M]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([c,M,H])):t.y===a.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([c,r,x]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([c,x,B])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([c,r,x]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([c,x,H])))}}mapABOBtoOBOA(){const c=new rc(0,0);for(let r=0;r<this.isoVecsABOB.length;r++){const D=[];for(let W=0;W<3;W++)c.x=this.isoVecsABOB[r][W].x,c.y=this.isoVecsABOB[r][W].y,0===this.vertexTypes[r][W]&&c.rotateNeg120(this.m,this.n),D.push(c.clone());this.isoVecsOBOA.push(D)}}mapABOBtoBAOA(){const c=new rc(0,0);for(let r=0;r<this.isoVecsABOB.length;r++){const D=[];for(let W=0;W<3;W++)c.x=this.isoVecsABOB[r][W].x,c.y=this.isoVecsABOB[r][W].y,1===this.vertexTypes[r][W]&&c.rotate120(this.m,this.n),D.push(c.clone());this.isoVecsBAOA.push(D)}}MapToFace(c,r){const D=this.IDATA.face[c],B=D[2],t=D[1],u=D[0],a=W.Zr.er(this.IDATA.vertex[B]),H=W.Zr.er(this.IDATA.vertex[t]),x=W.Zr.er(this.IDATA.vertex[u]),M=H.Jr(a),E=x.Jr(a),m=M.scale(this.coau).add(E.scale(this.cobu)),Y=M.scale(this.coav).add(E.scale(this.cobv)),v=[];let k,w=W.TmpVectors.Zr[0];for(let W=0;W<this.cartesian.length;W++)w=m.scale(this.cartesian[W].x).add(Y.scale(this.cartesian[W].y)).add(a),v[W]=[w.x,w.y,w.z],k=c+"|"+this.vertices[W].x+"|"+this.vertices[W].y,r.vertex[this.vecToidx[k]]=[w.x,w.y,w.z]}build(c,r){const D=[],W=rc.Zero(),B=new rc(c,r),t=new rc(-r,c+r);D.push(W,B,t);for(let j=r;j<c+1;j++)for(let r=0;r<c+1-j;r++)D.push(new rc(r,j));if(r>0){const W=(0,C.HighestCommonFactor)(c,r),B=c/W,t=r/W;for(let a=1;a<W;a++)D.push(new rc(a*B,a*t)),D.push(new rc(-a*t,a*(B+t))),D.push(new rc(c-a*(B+t),r+a*B));const u=c/r;for(let a=1;a<r;a++)for(let W=0;W<a*u;W++)D.push(new rc(W,a)),D.push(new rc(W,a).rotate120(c,r)),D.push(new rc(W,a).rotateNeg120(c,r))}D.sort(((c,r)=>c.x-r.x)),D.sort(((c,r)=>c.y-r.y));const u=new Array(c+r+1),a=new Array(c+r+1);for(let j=0;j<u.length;j++)u[j]=1/0,a[j]=-1/0;let H=0,x=0;const M=D.length;for(let j=0;j<M;j++)x=D[j].x,H=D[j].y,u[H]=Math.min(x,u[H]),a[H]=Math.max(x,a[H]);const E=(D,W)=>{const B=D.clone();return"A"===W&&B.rotateNeg120(c,r),"B"===W&&B.rotate120(c,r),B.x<0?B.y:B.x+B.y},m=[],Y=[],v=[],k=[],w={},Z=[];let J=-1,q=-1;for(let j=0;j<M;j++)m[j]=D[j].toCartesianOrigin(new rc(0,0),.5),Y[j]=E(D[j],"O"),v[j]=E(D[j],"A"),k[j]=E(D[j],"B"),Y[j]===v[j]&&v[j]===k[j]?(J=3,q=Y[j]):Y[j]===v[j]?(J=4,q=Y[j]):v[j]===k[j]?(J=5,q=v[j]):k[j]===Y[j]&&(J=6,q=Y[j]),Y[j]<v[j]&&Y[j]<k[j]&&(J=2,q=Y[j]),v[j]<Y[j]&&v[j]<k[j]&&(J=1,q=v[j]),k[j]<v[j]&&k[j]<Y[j]&&(J=0,q=k[j]),Z.push([J,q,D[j].x,D[j].y]);Z.sort(((c,r)=>c[2]-r[2])),Z.sort(((c,r)=>c[3]-r[3])),Z.sort(((c,r)=>c[1]-r[1])),Z.sort(((c,r)=>c[0]-r[0]));for(let j=0;j<Z.length;j++)w[Z[j][2]+"|"+Z[j][3]]=[Z[j][0],Z[j][1],j];return this.m=c,this.n=r,this.vertices=D,this.vertByDist=w,this.cartesian=m,this.min=u,this.max=a,this}}class Wc{constructor(c,r,D,W){this.name=c,this.category=r,this.vertex=D,this.face=W}}class Bc extends Wc{innerToData(c,r){for(let D=0;D<r.innerFacets.length;D++)this.face.push(r.innerFacets[D].map((D=>r.vecToidx[c+D])))}mapABOBtoDATA(c,r){const D=r.IDATA.edgematch[c][0];for(let W=0;W<r.isoVecsABOB.length;W++){const B=[];for(let t=0;t<3;t++)0===r.vertexTypes[W][t]?B.push(c+"|"+r.isoVecsABOB[W][t].x+"|"+r.isoVecsABOB[W][t].y):B.push(D+"|"+r.isoVecsABOB[W][t].x+"|"+r.isoVecsABOB[W][t].y);this.face.push([r.vecToidx[B[0]],r.vecToidx[B[1]],r.vecToidx[B[2]]])}}mapOBOAtoDATA(c,r){const D=r.IDATA.edgematch[c][0];for(let W=0;W<r.isoVecsOBOA.length;W++){const B=[];for(let t=0;t<3;t++)1===r.vertexTypes[W][t]?B.push(c+"|"+r.isoVecsOBOA[W][t].x+"|"+r.isoVecsOBOA[W][t].y):B.push(D+"|"+r.isoVecsOBOA[W][t].x+"|"+r.isoVecsOBOA[W][t].y);this.face.push([r.vecToidx[B[0]],r.vecToidx[B[1]],r.vecToidx[B[2]]])}}mapBAOAtoDATA(c,r){const D=r.IDATA.edgematch[c][2];for(let W=0;W<r.isoVecsBAOA.length;W++){const B=[];for(let t=0;t<3;t++)1===r.vertexTypes[W][t]?B.push(c+"|"+r.isoVecsBAOA[W][t].x+"|"+r.isoVecsBAOA[W][t].y):B.push(D+"|"+r.isoVecsBAOA[W][t].x+"|"+r.isoVecsBAOA[W][t].y);this.face.push([r.vecToidx[B[0]],r.vecToidx[B[1]],r.vecToidx[B[2]]])}}orderData(c){const r=[];for(let t=0;t<13;t++)r[t]=[];const D=c.closestTo;for(let t=0;t<D.length;t++)D[t][0]>-1?D[t][1]>0&&r[D[t][0]].push([t,D[t][1]]):r[12].push([t,D[t][0]]);const W=[];for(let t=0;t<12;t++)W[t]=t;let B=12;for(let t=0;t<12;t++){r[t].sort(((c,r)=>c[1]-r[1]));for(let c=0;c<r[t].length;c++)W[r[t][c][0]]=B++}for(let t=0;t<r[12].length;t++)W[r[12][t][0]]=B++;for(let t=0;t<this.vertex.length;t++)this.vertex[t].push(W[t]);this.vertex.sort(((c,r)=>c[3]-r[3]));for(let t=0;t<this.vertex.length;t++)this.vertex[t].pop();for(let t=0;t<this.face.length;t++)for(let c=0;c<this.face[t].length;c++)this.face[t][c]=W[this.face[t][c]];this.sharedNodes=r[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(c,r){const D=[],W=[];let B=r.pop();W.push(B);let t=this.face[B].indexOf(c);t=(t+2)%3;let u=this.face[B][t];D.push(u);let a=0;for(;r.length>0;)B=r[a],this.face[B].indexOf(u)>-1?(t=(this.face[B].indexOf(u)+1)%3,u=this.face[B][t],D.push(u),W.push(B),r.splice(a,1),a=0):a++;return this.adjacentFaces.push(D),W}toGoldbergPolyhedronData(){const c=new Wc("GeoDual","Goldberg",[],[]);c.name="GD dual";const r=this.vertex.length,D=new Array(r);for(let H=0;H<r;H++)D[H]=[];for(let H=0;H<this.face.length;H++)for(let c=0;c<3;c++)D[this.face[H][c]].push(H);let W=0,B=0,t=0,u=[],a=[];this.adjacentFaces=[];for(let H=0;H<D.length;H++){c.face[H]=this.setOrder(H,D[H].concat([]));for(const r of D[H]){W=0,B=0,t=0,u=this.face[r];for(let c=0;c<3;c++)a=this.vertex[u[c]],W+=a[0],B+=a[1],t+=a[2];c.vertex[r]=[W/3,B/3,t/3]}}return c}static BuildGeodesicData(c){const r=new Bc("Geodesic-m-n","Geodesic",[[0,cc.e,-1],[-cc.e,1,0],[-1,0,-cc.e],[1,0,-cc.e],[cc.e,1,0],[0,cc.e,1],[-1,0,cc.e],[-cc.e,-1,0],[0,-cc.e,-1],[cc.e,-1,0],[1,0,cc.e],[0,-cc.e,1]],[]);c.setIndices(),c.calcCoeffs(),c.createInnerFacets(),c.edgeVecsABOB(),c.mapABOBtoOBOA(),c.mapABOBtoBAOA();for(let D=0;D<c.IDATA.face.length;D++)c.MapToFace(D,r),r.innerToData(D,c),"B"===c.IDATA.edgematch[D][1]&&r.mapABOBtoDATA(D,c),"O"===c.IDATA.edgematch[D][1]&&r.mapOBOAtoDATA(D,c),"A"===c.IDATA.edgematch[D][3]&&r.mapBAOAtoDATA(D,c);r.orderData(c);return r.vertex=r.vertex.map((function(c){const r=c[0],D=c[1],W=c[2],B=Math.sqrt(r*r+D*D+W*W);return c[0]*=1/B,c[1]*=1/B,c[2]*=1/B,c})),r}}B.e._GoldbergMeshParser=(c,r)=>tc.Parse(c,r);class tc extends B.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(c,r){return void 0===r?(c>this.goldbergData.nbUnsharedFaces-1&&(V.e.Warn("Maximum number of unshared faces used"),c=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+c):(c>11&&(V.e.Warn("Last pole used"),c=11),r>this.goldbergData.nbFacesAtPole-1&&(V.e.Warn("Maximum number of faces at a pole used"),r=this.goldbergData.nbFacesAtPole-1),12+c*this.goldbergData.nbFacesAtPole+r)}_changeGoldbergFaceColors(c){for(let D=0;D<c.length;D++){const r=c[D][0],W=c[D][1],B=c[D][2];for(let c=r;c<W+1;c++)this.goldbergData.faceColors[c]=B}const r=[];for(let D=0;D<12;D++)for(let c=0;c<5;c++)r.push(this.goldbergData.faceColors[D].r,this.goldbergData.faceColors[D].g,this.goldbergData.faceColors[D].b,this.goldbergData.faceColors[D].a);for(let D=12;D<this.goldbergData.faceColors.length;D++)for(let c=0;c<6;c++)r.push(this.goldbergData.faceColors[D].r,this.goldbergData.faceColors[D].g,this.goldbergData.faceColors[D].b,this.goldbergData.faceColors[D].a);return r}setGoldbergFaceColors(c){const r=this._changeGoldbergFaceColors(c);this.Pc(t.d.ColorKind,r)}updateGoldbergFaceColors(c){const r=this._changeGoldbergFaceColors(c);this.updateVerticesData(t.d.ColorKind,r)}_changeGoldbergFaceUVs(c){const r=this.getVerticesData(t.d.UVKind);for(let D=0;D<c.length;D++){const W=c[D][0],B=c[D][1],t=c[D][2],u=c[D][3],a=c[D][4],H=[],x=[];let M,E;for(let c=0;c<5;c++)M=t.x+u*Math.cos(a+c*Math.PI/2.5),E=t.y+u*Math.sin(a+c*Math.PI/2.5),M<0&&(M=0),M>1&&(M=1),H.push(M,E);for(let c=0;c<6;c++)M=t.x+u*Math.cos(a+c*Math.PI/3),E=t.y+u*Math.sin(a+c*Math.PI/3),M<0&&(M=0),M>1&&(M=1),x.push(M,E);for(let c=W;c<Math.min(12,B+1);c++)for(let D=0;D<5;D++)r[10*c+2*D]=H[2*D],r[10*c+2*D+1]=H[2*D+1];for(let c=Math.max(12,W);c<B+1;c++)for(let D=0;D<6;D++)r[12*c-24+2*D]=x[2*D],r[12*c-23+2*D]=x[2*D+1]}return r}setGoldbergFaceUVs(c){const r=this._changeGoldbergFaceUVs(c);this.Pc(t.d.UVKind,r)}updateGoldbergFaceUVs(c){const r=this._changeGoldbergFaceUVs(c);this.updateVerticesData(t.d.UVKind,r)}placeOnGoldbergFaceAt(c,r,D){const B=W.Zr.RotationFromAxis(this.goldbergData.faceXaxis[r],this.goldbergData.faceYaxis[r],this.goldbergData.faceZaxis[r]);c.rotation=B,c.position=this.goldbergData.faceCenters[r].add(this.goldbergData.faceXaxis[r].scale(D.x)).add(this.goldbergData.faceYaxis[r].scale(D.y)).add(this.goldbergData.faceZaxis[r].scale(D.z))}serialize(c){super.serialize(c),c.type="GoldbergMesh";const r={};if(r.adjacentFaces=this.goldbergData.adjacentFaces,r.nbSharedFaces=this.goldbergData.nbSharedFaces,r.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,r.nbFaces=this.goldbergData.nbFaces,r.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){r.faceColors=[];for(const c of this.goldbergData.faceColors)r.faceColors.push(c.Ma())}if(this.goldbergData.faceCenters){r.faceCenters=[];for(const c of this.goldbergData.faceCenters)r.faceCenters.push(c.Ma())}if(this.goldbergData.faceZaxis){r.faceZaxis=[];for(const c of this.goldbergData.faceZaxis)r.faceZaxis.push(c.Ma())}if(this.goldbergData.faceYaxis){r.faceYaxis=[];for(const c of this.goldbergData.faceYaxis)r.faceYaxis.push(c.Ma())}if(this.goldbergData.faceXaxis){r.faceXaxis=[];for(const c of this.goldbergData.faceXaxis)r.faceXaxis.push(c.Ma())}c.goldbergData=r}static Parse(c,r){const D=c.goldbergData;D.faceColors=D.faceColors.map((c=>m.Xa.er(c))),D.faceCenters=D.faceCenters.map((c=>W.Zr.er(c))),D.faceZaxis=D.faceZaxis.map((c=>W.Zr.er(c))),D.faceXaxis=D.faceXaxis.map((c=>W.Zr.er(c))),D.faceYaxis=D.faceYaxis.map((c=>W.Zr.er(c)));const B=new tc(c.name,r);return B.goldbergData=D,B}}var uc=D(12224);const ac={CreateBox:E.e,CreateTiledBox:w,CreateSphere:Z.e,CreateDisc:M.c,CreateIcoSphere:O,CreateRibbon:x,CreateCylinder:X,CreateTorus:y,CreateTorusKnot:N,CreateLineSystem:g.g,Zx:g.i,CreateDashedLines:g.e,ExtrudeShape:K,ExtrudeShapeCustom:f,CreateLathe:h,CreateTiledPlane:v,jx:L.b,CreateGround:P.g,CreateTiledGround:P.j,CreateGroundFromHeightMap:P.d,CreatePolygon:z.e,ExtrudePolygon:z.f,CreateTube:G,CreatePolyhedron:T,CreateGeodesic:function(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,W=r.m||1;W!==Math.floor(W)&&(W=Math.floor(W),V.e.Warn("m not an integer only floor(m) used"));let B=r.n||0;if(B!==Math.floor(B)&&(B=Math.floor(B),V.e.Warn("n not an integer only floor(n) used")),B>W){const c=B;B=W,W=c,V.e.Warn("n > m therefore m and n swapped")}const t=new Dc;return t.build(W,B),T(c,{custom:Bc.BuildGeodesicData(t),size:r.size,sizeX:r.sizeX,sizeY:r.sizeY,sizeZ:r.sizeZ,faceUV:r.faceUV,faceColors:r.faceColors,flat:r.flat,updatable:r.updatable,sideOrientation:r.sideOrientation,frontUVs:r.frontUVs,backUVs:r.backUVs},D)},CreateGoldberg:function(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=r.size,H=r.sizeX||t||1,x=r.sizeY||t||1,M=r.sizeZ||t||1;let E=r.m||1;E!==Math.floor(E)&&(E=Math.floor(E),V.e.Warn("m not an integer only floor(m) used"));let Y=r.n||0;if(Y!==Math.floor(Y)&&(Y=Math.floor(Y),V.e.Warn("n not an integer only floor(n) used")),Y>E){const c=Y;Y=E,E=c,V.e.Warn("n > m therefore m and n swapped")}const v=new Dc;v.build(E,Y);const k=Bc.BuildGeodesicData(v),w=k.toGoldbergPolyhedronData(),Z=new tc(c,D);r.sideOrientation=B.e._GetDefaultSideOrientation(r.sideOrientation),Z._originalBuilderSideOrientation=r.sideOrientation;(function(c,r){const D=c.size,B=c.sizeX||D||1,t=c.sizeY||D||1,H=c.sizeZ||D||1,x=0===c.sideOrientation?0:c.sideOrientation||u.b.DEFAULTSIDE,M=[],E=[],m=[],Y=[];let v=1/0,k=-1/0,w=1/0,Z=-1/0;for(let W=0;W<r.vertex.length;W++)v=Math.min(v,r.vertex[W][0]*B),k=Math.max(k,r.vertex[W][0]*B),w=Math.min(w,r.vertex[W][1]*t),Z=Math.max(Z,r.vertex[W][1]*t);let J=0;for(let u=0;u<r.face.length;u++){const c=r.face[u],D=W.Zr.er(r.vertex[c[0]]),x=W.Zr.er(r.vertex[c[2]]),q=W.Zr.er(r.vertex[c[1]]),j=x.Jr(D),X=q.Jr(D),e=W.Zr.Cross(X,j).normalize();for(let W=0;W<c.length;W++){m.push(e.x,e.y,e.z);const D=r.vertex[c[W]];M.push(D[0]*B,D[1]*t,D[2]*H);const u=(D[1]*t-w)/(Z-w);Y.push((D[0]*B-v)/(k-v),a.b?1-u:u)}for(let r=0;r<c.length-2;r++)E.push(J,J+r+2,J+r+1);J+=c.length}u.b._ComputeSides(x,M,E,m,Y);const q=new u.b;return q.Nc=M,q.indices=E,q.gc=m,q.Sc=Y,q})(r,w).fc(Z,r.updatable),Z.goldbergData.nbSharedFaces=k.sharedNodes,Z.goldbergData.nbUnsharedFaces=k.poleNodes,Z.goldbergData.adjacentFaces=k.adjacentFaces,Z.goldbergData.nbFaces=Z.goldbergData.nbSharedFaces+Z.goldbergData.nbUnsharedFaces,Z.goldbergData.nbFacesAtPole=(Z.goldbergData.nbUnsharedFaces-12)/12;for(let B=0;B<k.vertex.length;B++)Z.goldbergData.faceCenters.push(W.Zr.er(k.vertex[B])),Z.goldbergData.faceCenters[B].x*=H,Z.goldbergData.faceCenters[B].y*=x,Z.goldbergData.faceCenters[B].z*=M,Z.goldbergData.faceColors.push(new m.Xa(1,1,1,1));for(let B=0;B<w.face.length;B++){const c=w.face[B],r=W.Zr.er(w.vertex[c[0]]),D=W.Zr.er(w.vertex[c[2]]),t=W.Zr.er(w.vertex[c[1]]),u=D.Jr(r),a=t.Jr(r),H=W.Zr.Cross(a,u).normalize(),x=W.Zr.Cross(a,H).normalize();Z.goldbergData.faceXaxis.push(a.normalize()),Z.goldbergData.faceYaxis.push(H),Z.goldbergData.faceZaxis.push(x)}return Z},CreateDecal:I,CreateCapsule:n,CreateText:uc.h}},12990:(c,r,D)=>{"use strict";D.d(r,{b:()=>ar});var W=D(11683),B=D(12061);class t extends B.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var u=D(11722),a=(D(11839),D(11637));class H{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(c){this._targetStopDuration!==c&&(this._targetStopDuration=c)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(c){this._noiseTexture!==c&&(this._noiseTexture=c,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(c){this._animationSheetEnabled!==c&&(this._animationSheetEnabled=c)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(c){this._isAnimationSheetEnabled!=c&&(this._isAnimationSheetEnabled=c,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(c){this._useLogarithmicDepth=c&&this.yc().getEngine().getCaps().fragmentDepthSupported}yc(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(c){switch(c){case H.BLENDMODE_MULTIPLYADD:return;case H.BLENDMODE_ADD:c=1;break;case H.BLENDMODE_ONEONE:c=6;break;case H.BLENDMODE_STANDARD:c=2;break;case H.BLENDMODE_MULTIPLY:c=4;break;case H.BLENDMODE_SUBTRACT:c=3}this._engine.setAlphaMode(c)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:W.Zr.Zero()}set direction1(c){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=c)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:W.Zr.Zero()}set direction2(c){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=c)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:W.Zr.Zero()}set minEmitBox(c){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=c)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:W.Zr.Zero()}set maxEmitBox(c){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=c)}get billboardMode(){return this._billboardMode}set billboardMode(c){this._billboardMode!==c&&(this._billboardMode=c,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(c){this._isBillboardBased!==c&&(this._isBillboardBased=c,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(c){this._attachImageProcessingConfiguration(c)}_attachImageProcessingConfiguration(c){c!==this._imageProcessingConfiguration&&(!c&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=c)}_reset(){}_removeGradientAndTexture(c,r,D){if(!r)return this;let W=0;for(const B of r){if(B.gradient===c){r.splice(W,1);break}W++}return D&&D.dispose(),this}constructor(c){this.animations=[],this.renderingGroupId=0,this.tr=W.Zr.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new W.Zr(10,10,10),this.onAnimationEnd=null,this.blendMode=H.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new W.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.vx=new W.Zr(0,0,0),this._useLogarithmicDepth=!1,this.gravity=W.Zr.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new u.Xa(1,1,1,1),this.color2=new u.Xa(1,1,1,1),this.colorDead=new u.Xa(0,0,0,1),this.textureMask=new u.Xa(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new t,this.id=c,this.name=c}createPointEmitter(c,r){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new W.Zr(0,1,0),arguments.length>2&&void 0!==arguments[2]||new W.Zr(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new W.Zr(0,1,0),arguments.length>4&&void 0!==arguments[4]||new W.Zr(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new W.Zr(0,1,0),arguments.length>3&&void 0!==arguments[3]||new W.Zr(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(c,r,D,W){throw new Error("Method not implemented.")}}H.BLENDMODE_ONEONE=0,H.BLENDMODE_STANDARD=1,H.BLENDMODE_ADD=2,H.BLENDMODE_MULTIPLY=3,H.BLENDMODE_MULTIPLYADD=4,H.BLENDMODE_SUBTRACT=-1,(0,a.e)("BABYLON.BaseParticleSystem",H);var x=D(11696),M=D(11515);class E{constructor(){this.direction1=new W.Zr(0,1,0),this.direction2=new W.Zr(0,1,0),this.minEmitBox=new W.Zr(-.5,-.5,-.5),this.maxEmitBox=new W.Zr(.5,.5,.5)}startDirectionFunction(c,r,D,B){const t=(0,x.RandomRange)(this.direction1.x,this.direction2.x),u=(0,x.RandomRange)(this.direction1.y,this.direction2.y),a=(0,x.RandomRange)(this.direction1.z,this.direction2.z);if(B)return r.x=t,r.y=u,void(r.z=a);W.Zr.TransformNormalFromFloatsToRef(t,u,a,c,r)}startPositionFunction(c,r,D,B){const t=(0,x.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),u=(0,x.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),a=(0,x.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(B)return r.x=t,r.y=u,void(r.z=a);W.Zr.TransformCoordinatesFromFloatsToRef(t,u,a,c,r)}clone(){const c=new E;return M.e.DeepCopy(this,c),c}applyToShader(c){c.setVector3("direction1",this.direction1),c.setVector3("direction2",this.direction2),c.setVector3("minEmitBox",this.minEmitBox),c.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(c){c.addUniform("direction1",3),c.addUniform("direction2",3),c.addUniform("minEmitBox",3),c.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.direction1=this.direction1.Ma(),c.direction2=this.direction2.Ma(),c.minEmitBox=this.minEmitBox.Ma(),c.maxEmitBox=this.maxEmitBox.Ma(),c}parse(c){W.Zr.FromArrayToRef(c.direction1,0,this.direction1),W.Zr.FromArrayToRef(c.direction2,0,this.direction2),W.Zr.FromArrayToRef(c.minEmitBox,0,this.minEmitBox),W.Zr.FromArrayToRef(c.maxEmitBox,0,this.maxEmitBox)}}class m{get radius(){return this._radius}set radius(c){this._radius=c,this._buildHeight()}get angle(){return this._angle}set angle(c){this._angle=c,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=D,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=r,this.radius=c}startDirectionFunction(c,r,D,B){B?W.TmpVectors.Zr[0].t(D.sa).normalize():D.position.subtractToRef(c.getTranslation(),W.TmpVectors.Zr[0]).normalize();const t=(0,x.RandomRange)(0,this.directionRandomizer),u=(0,x.RandomRange)(0,this.directionRandomizer),a=(0,x.RandomRange)(0,this.directionRandomizer);r.x=W.TmpVectors.Zr[0].x+t,r.y=W.TmpVectors.Zr[0].y+u,r.z=W.TmpVectors.Zr[0].z+a,r.normalize()}startPositionFunction(c,r,D,B){const t=(0,x.RandomRange)(0,2*Math.PI);let u;this.emitFromSpawnPointOnly?u=1e-4:(u=(0,x.RandomRange)(0,this.heightRange),u=1-u*u);let a=this._radius-(0,x.RandomRange)(0,this._radius*this.radiusRange);a*=u;const H=a*Math.sin(t),M=a*Math.cos(t),E=u*this._height;if(B)return r.x=H,r.y=E,void(r.z=M);W.Zr.TransformCoordinatesFromFloatsToRef(H,E,M,c,r)}clone(){const c=new m(this._radius,this._angle,this.directionRandomizer);return M.e.DeepCopy(this,c),c}applyToShader(c){c.setFloat2("radius",this._radius,this.radiusRange),c.setFloat("coneAngle",this._angle),c.setFloat2("height",this._height,this.heightRange),c.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(c){c.addUniform("radius",2),c.addUniform("coneAngle",1),c.addUniform("height",2),c.addUniform("directionRandomizer",1)}getEffectDefines(){let c="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(c+="\n#define CONEEMITTERSPAWNPOINT"),c}getClassName(){return"ConeParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.radius=this._radius,c.angle=this._angle,c.directionRandomizer=this.directionRandomizer,c.radiusRange=this.radiusRange,c.heightRange=this.heightRange,c.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,c}parse(c){this.radius=c.radius,this.angle=c.angle,this.directionRandomizer=c.directionRandomizer,this.radiusRange=void 0!==c.radiusRange?c.radiusRange:1,this.heightRange=void 0!==c.radiusRange?c.heightRange:1,this.emitFromSpawnPointOnly=void 0!==c.emitFromSpawnPointOnly&&c.emitFromSpawnPointOnly}}class Y extends m{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new W.Zr(0,1,0),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new W.Zr(0,1,0);super(c,r),this.direction1=D,this.direction2=B}startDirectionFunction(c,r){const D=(0,x.RandomRange)(this.direction1.x,this.direction2.x),B=(0,x.RandomRange)(this.direction1.y,this.direction2.y),t=(0,x.RandomRange)(this.direction1.z,this.direction2.z);W.Zr.TransformNormalFromFloatsToRef(D,B,t,c,r)}clone(){const c=new Y(this.radius,this.angle,this.direction1,this.direction2);return M.e.DeepCopy(this,c),c}applyToShader(c){c.setFloat("radius",this.radius),c.setFloat("radiusRange",this.radiusRange),c.setVector3("direction1",this.direction1),c.setVector3("direction2",this.direction2)}buildUniformLayout(c){c.addUniform("radius",1),c.addUniform("radiusRange",1),c.addUniform("direction1",3),c.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const c=super.serialize();return c.direction1=this.direction1.Ma(),c.direction2=this.direction2.Ma(),c}parse(c){super.parse(c),this.direction1.t(c.direction1),this.direction2.t(c.direction2)}}class v{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=c,this.height=r,this.radiusRange=D,this.directionRandomizer=B,this._tempVector=W.Zr.Zero()}startDirectionFunction(c,r,D,B,t){D.position.subtractToRef(c.getTranslation(),this._tempVector),this._tempVector.normalize(),W.Zr.TransformNormalToRef(this._tempVector,t,this._tempVector);const u=(0,x.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let a=Math.atan2(this._tempVector.x,this._tempVector.z);a+=(0,x.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=u,this._tempVector.x=Math.sin(a),this._tempVector.z=Math.cos(a),this._tempVector.normalize(),B?r.t(this._tempVector):W.Zr.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,c,r)}startPositionFunction(c,r,D,B){const t=(0,x.RandomRange)(-this.height/2,this.height/2),u=(0,x.RandomRange)(0,2*Math.PI),a=(0,x.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),H=Math.sqrt(a)*this.radius,M=H*Math.cos(u),E=H*Math.sin(u);B?r.Ja(M,t,E):W.Zr.TransformCoordinatesFromFloatsToRef(M,t,E,c,r)}clone(){const c=new v(this.radius,this.directionRandomizer);return M.e.DeepCopy(this,c),c}applyToShader(c){c.setFloat("radius",this.radius),c.setFloat("height",this.height),c.setFloat("radiusRange",this.radiusRange),c.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(c){c.addUniform("radius",1),c.addUniform("height",1),c.addUniform("radiusRange",1),c.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.radius=this.radius,c.height=this.height,c.radiusRange=this.radiusRange,c.directionRandomizer=this.directionRandomizer,c}parse(c){this.radius=c.radius,this.height=c.height,this.radiusRange=c.radiusRange,this.directionRandomizer=c.directionRandomizer}}class k extends v{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new W.Zr(0,1,0),t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new W.Zr(0,1,0);super(c,r,D),this.direction1=B,this.direction2=t}startDirectionFunction(c,r,D,B){const t=(0,x.RandomRange)(this.direction1.x,this.direction2.x),u=(0,x.RandomRange)(this.direction1.y,this.direction2.y),a=(0,x.RandomRange)(this.direction1.z,this.direction2.z);B?r.Ja(t,u,a):W.Zr.TransformNormalFromFloatsToRef(t,u,a,c,r)}clone(){const c=new k(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return M.e.DeepCopy(this,c),c}applyToShader(c){c.setFloat("radius",this.radius),c.setFloat("height",this.height),c.setFloat("radiusRange",this.radiusRange),c.setVector3("direction1",this.direction1),c.setVector3("direction2",this.direction2)}buildUniformLayout(c){c.addUniform("radius",1),c.addUniform("height",1),c.addUniform("radiusRange",1),c.addUniform("direction1",3),c.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const c=super.serialize();return c.direction1=this.direction1.Ma(),c.direction2=this.direction2.Ma(),c}parse(c){super.parse(c),W.Zr.FromArrayToRef(c.direction1,0,this.direction1),W.Zr.FromArrayToRef(c.direction2,0,this.direction2)}}class w{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=c,this.radiusRange=r,this.directionRandomizer=D}startDirectionFunction(c,r,D,B){const t=D.position.Jr(c.getTranslation()).normalize(),u=(0,x.RandomRange)(0,this.directionRandomizer),a=(0,x.RandomRange)(0,this.directionRandomizer),H=(0,x.RandomRange)(0,this.directionRandomizer);t.x+=u,t.y+=a,t.z+=H,t.normalize(),B?r.t(t):W.Zr.TransformNormalFromFloatsToRef(t.x,t.y,t.z,c,r)}startPositionFunction(c,r,D,B){const t=this.radius-(0,x.RandomRange)(0,this.radius*this.radiusRange),u=(0,x.RandomRange)(0,1),a=(0,x.RandomRange)(0,2*Math.PI),H=Math.acos(2*u-1),M=t*Math.cos(a)*Math.sin(H),E=t*Math.cos(H),m=t*Math.sin(a)*Math.sin(H);B?r.Ja(M,Math.abs(E),m):W.Zr.TransformCoordinatesFromFloatsToRef(M,Math.abs(E),m,c,r)}clone(){const c=new w(this.radius,this.directionRandomizer);return M.e.DeepCopy(this,c),c}applyToShader(c){c.setFloat("radius",this.radius),c.setFloat("radiusRange",this.radiusRange),c.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(c){c.addUniform("radius",1),c.addUniform("radiusRange",1),c.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.radius=this.radius,c.radiusRange=this.radiusRange,c.directionRandomizer=this.directionRandomizer,c}parse(c){this.radius=c.radius,this.radiusRange=c.radiusRange,this.directionRandomizer=c.directionRandomizer}}class Z{constructor(){this.direction1=new W.Zr(0,1,0),this.direction2=new W.Zr(0,1,0)}startDirectionFunction(c,r,D,B){const t=(0,x.RandomRange)(this.direction1.x,this.direction2.x),u=(0,x.RandomRange)(this.direction1.y,this.direction2.y),a=(0,x.RandomRange)(this.direction1.z,this.direction2.z);B?r.Ja(t,u,a):W.Zr.TransformNormalFromFloatsToRef(t,u,a,c,r)}startPositionFunction(c,r,D,B){B?r.Ja(0,0,0):W.Zr.TransformCoordinatesFromFloatsToRef(0,0,0,c,r)}clone(){const c=new Z;return M.e.DeepCopy(this,c),c}applyToShader(c){c.setVector3("direction1",this.direction1),c.setVector3("direction2",this.direction2)}buildUniformLayout(c){c.addUniform("direction1",3),c.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.direction1=this.direction1.Ma(),c.direction2=this.direction2.Ma(),c}parse(c){W.Zr.FromArrayToRef(c.direction1,0,this.direction1),W.Zr.FromArrayToRef(c.direction2,0,this.direction2)}}class J{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=c,this.radiusRange=r,this.directionRandomizer=D}startDirectionFunction(c,r,D,B){const t=D.position.Jr(c.getTranslation()).normalize(),u=(0,x.RandomRange)(0,this.directionRandomizer),a=(0,x.RandomRange)(0,this.directionRandomizer),H=(0,x.RandomRange)(0,this.directionRandomizer);t.x+=u,t.y+=a,t.z+=H,t.normalize(),B?r.t(t):W.Zr.TransformNormalFromFloatsToRef(t.x,t.y,t.z,c,r)}startPositionFunction(c,r,D,B){const t=this.radius-(0,x.RandomRange)(0,this.radius*this.radiusRange),u=(0,x.RandomRange)(0,1),a=(0,x.RandomRange)(0,2*Math.PI),H=Math.acos(2*u-1),M=t*Math.cos(a)*Math.sin(H),E=t*Math.cos(H),m=t*Math.sin(a)*Math.sin(H);B?r.Ja(M,E,m):W.Zr.TransformCoordinatesFromFloatsToRef(M,E,m,c,r)}clone(){const c=new J(this.radius,this.directionRandomizer);return M.e.DeepCopy(this,c),c}applyToShader(c){c.setFloat("radius",this.radius),c.setFloat("radiusRange",this.radiusRange),c.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(c){c.addUniform("radius",1),c.addUniform("radiusRange",1),c.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.radius=this.radius,c.radiusRange=this.radiusRange,c.directionRandomizer=this.directionRandomizer,c}parse(c){this.radius=c.radius,this.radiusRange=c.radiusRange,this.directionRandomizer=c.directionRandomizer}}class q extends J{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new W.Zr(0,1,0),D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new W.Zr(0,1,0);super(c),this.direction1=r,this.direction2=D}startDirectionFunction(c,r){const D=(0,x.RandomRange)(this.direction1.x,this.direction2.x),B=(0,x.RandomRange)(this.direction1.y,this.direction2.y),t=(0,x.RandomRange)(this.direction1.z,this.direction2.z);W.Zr.TransformNormalFromFloatsToRef(D,B,t,c,r)}clone(){const c=new q(this.radius,this.direction1,this.direction2);return M.e.DeepCopy(this,c),c}applyToShader(c){c.setFloat("radius",this.radius),c.setFloat("radiusRange",this.radiusRange),c.setVector3("direction1",this.direction1),c.setVector3("direction2",this.direction2)}buildUniformLayout(c){c.addUniform("radius",1),c.addUniform("radiusRange",1),c.addUniform("direction1",3),c.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const c=super.serialize();return c.direction1=this.direction1.Ma(),c.direction2=this.direction2.Ma(),c}parse(c){super.parse(c),this.direction1.t(c.direction1),this.direction2.t(c.direction2)}}class j{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(c,r,D,B){const t=W.TmpVectors.Zr[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,D,t);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,D,t);const c=W.TmpVectors.Zr[1];t.subtractToRef(D.position,c),c.scaleToRef(1/D.lifeTime,t)}else t.set(0,0,0);B?r.t(t):W.Zr.TransformNormalToRef(t,c,r)}startPositionFunction(c,r,D,B){const t=W.TmpVectors.Zr[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,D,t):t.set(0,0,0),B?r.t(t):W.Zr.TransformCoordinatesToRef(t,c,r)}clone(){const c=new j;return M.e.DeepCopy(this,c),c}applyToShader(c){}buildUniformLayout(c){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const c={};return c.type=this.getClassName(),c.particlePositionGenerator=this.particlePositionGenerator,c.particleDestinationGenerator=this.particleDestinationGenerator,c}parse(c){c.particlePositionGenerator&&(this.particlePositionGenerator=c.particlePositionGenerator),c.particleDestinationGenerator&&(this.particleDestinationGenerator=c.particleDestinationGenerator)}}var X=D(11750);class e{get mesh(){return this._mesh}set mesh(c){this._mesh!==c&&(this._mesh=c,c?(this._indices=c.wa(),this._positions=c.getVerticesData(X.d.PositionKind),this._normals=c.getVerticesData(X.d.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=W.Zr.Zero(),this._mesh=null,this.direction1=new W.Zr(0,1,0),this.direction2=new W.Zr(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=c}startDirectionFunction(c,r,D,B){if(this.useMeshNormalsForDirection&&this._normals)return void W.Zr.TransformNormalToRef(this._storedNormal,c,r);const t=(0,x.RandomRange)(this.direction1.x,this.direction2.x),u=(0,x.RandomRange)(this.direction1.y,this.direction2.y),a=(0,x.RandomRange)(this.direction1.z,this.direction2.z);B?r.Ja(t,u,a):W.Zr.TransformNormalFromFloatsToRef(t,u,a,c,r)}startPositionFunction(c,r,D,B){if(!this._indices||!this._positions)return;const t=3*(Math.random()*(this._indices.length/3)|0),u=Math.random(),a=Math.random()*(1-u),H=1-u-a,x=this._indices[t],M=this._indices[t+1],E=this._indices[t+2],m=W.TmpVectors.Zr[0],Y=W.TmpVectors.Zr[1],v=W.TmpVectors.Zr[2],k=W.TmpVectors.Zr[3];W.Zr.FromArrayToRef(this._positions,3*x,m),W.Zr.FromArrayToRef(this._positions,3*M,Y),W.Zr.FromArrayToRef(this._positions,3*E,v),k.x=u*m.x+a*Y.x+H*v.x,k.y=u*m.y+a*Y.y+H*v.y,k.z=u*m.z+a*Y.z+H*v.z,B?r.Ja(k.x,k.y,k.z):W.Zr.TransformCoordinatesFromFloatsToRef(k.x,k.y,k.z,c,r),this.useMeshNormalsForDirection&&this._normals&&(W.Zr.FromArrayToRef(this._normals,3*x,m),W.Zr.FromArrayToRef(this._normals,3*M,Y),W.Zr.FromArrayToRef(this._normals,3*E,v),this._storedNormal.x=u*m.x+a*Y.x+H*v.x,this._storedNormal.y=u*m.y+a*Y.y+H*v.y,this._storedNormal.z=u*m.z+a*Y.z+H*v.z)}clone(){const c=new e(this.mesh);return M.e.DeepCopy(this,c),c}applyToShader(c){c.setVector3("direction1",this.direction1),c.setVector3("direction2",this.direction2)}buildUniformLayout(c){c.addUniform("direction1",3),c.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var c;const r={};return r.type=this.getClassName(),r.direction1=this.direction1.Ma(),r.direction2=this.direction2.Ma(),r.meshId=null===(c=this.mesh)||void 0===c?void 0:c.id,r.useMeshNormalsForDirection=this.useMeshNormalsForDirection,r}parse(c,r){W.Zr.FromArrayToRef(c.direction1,0,this.direction1),W.Zr.FromArrayToRef(c.direction2,0,this.direction2),c.meshId&&r&&(this.mesh=r.getLastMeshById(c.meshId)),this.useMeshNormalsForDirection=c.useMeshNormalsForDirection}}class y{_isUbo(c){return void 0!==c.addUniform}constructor(c){this._isUbo(c)?(this.setMatrix3x3=c.updateMatrix3x3.bind(c),this.setMatrix2x2=c.updateMatrix2x2.bind(c),this.setFloat=c.updateFloat.bind(c),this.setFloat2=c.updateFloat2.bind(c),this.setFloat3=c.updateFloat3.bind(c),this.setFloat4=c.updateFloat4.bind(c),this.setFloatArray=c.updateFloatArray.bind(c),this.setArray=c.updateArray.bind(c),this.setIntArray=c.updateIntArray.bind(c),this.setMatrix=c.Ya.bind(c),this.setMatrices=c.updateMatrices.bind(c),this.setVector3=c.updateVector3.bind(c),this.setVector4=c.updateVector4.bind(c),this.setColor3=c.updateColor3.bind(c),this.setColor4=c.updateColor4.bind(c),this.setDirectColor4=c.updateDirectColor4.bind(c),this.setInt=c.updateInt.bind(c),this.setInt2=c.updateInt2.bind(c),this.setInt3=c.updateInt3.bind(c),this.setInt4=c.updateInt4.bind(c)):(this.setMatrix3x3=c.setMatrix3x3.bind(c),this.setMatrix2x2=c.setMatrix2x2.bind(c),this.setFloat=c.setFloat.bind(c),this.setFloat2=c.setFloat2.bind(c),this.setFloat3=c.setFloat3.bind(c),this.setFloat4=c.setFloat4.bind(c),this.setFloatArray=c.setFloatArray.bind(c),this.setArray=c.setArray.bind(c),this.setIntArray=c.setIntArray.bind(c),this.setMatrix=c.setMatrix.bind(c),this.setMatrices=c.setMatrices.bind(c),this.setVector3=c.setVector3.bind(c),this.setVector4=c.setVector4.bind(c),this.setColor3=c.setColor3.bind(c),this.setColor4=c.setColor4.bind(c),this.setDirectColor4=c.setDirectColor4.bind(c),this.setInt=c.setInt.bind(c),this.setInt2=c.setInt2.bind(c),this.setInt3=c.setInt3.bind(c),this.setInt4=c.setInt4.bind(c))}}var U=D(11595);const N="gpuUpdateParticlesPixelShader",g="#version 300 es\nvoid main() {discard;}\n";U.d.ShadersStore[N]||(U.d.ShadersStore[N]=g);const z="gpuUpdateParticlesVertexShader",S="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";U.d.ShadersStore[z]||(U.d.ShadersStore[z]=S);(0,a.e)("BABYLON.WebGL2ParticleSystem",class{constructor(c,r){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=c,this._engine=r,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var c;return(null===(c=this._updateEffect)||void 0===c?void 0:c.isReady())??!1}createUpdateBuffer(c){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof j&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=c,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new y(this._updateEffect)}createVertexBuffers(c,r){this._updateVAO.push(this._createUpdateVAO(c)),this._renderVAO.push(this._engine.recordVertexArrayObject(r,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=r}createParticleBuffer(c){return c}bindDrawBuffers(c,r,D){D?this._engine.bindBuffers(this._renderVertexBuffers,D,r):this._engine.bindVertexArrayObject(this._renderVAO[c],null)}preUpdateParticleBuffer(){const c=this._engine;if(this._engine.enableEffect(this._updateEffect),!c.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(c,r,D){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[c],null);const W=this._engine;W.bindTransformFeedbackBuffer(r.getBuffer()),W.setRasterizerState(!1),W.beginTransformFeedback(!0),W.drawArraysType(3,0,D),W.endTransformFeedback(),W.setRasterizerState(!0),W.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let c=0;c<this._updateVAO.length;c++)this._engine.releaseVertexArrayObject(this._updateVAO[c]);this._updateVAO.length=0;for(let c=0;c<this._renderVAO.length;c++)this._engine.releaseVertexArrayObject(this._renderVAO[c]);this._renderVAO.length=0}_createUpdateVAO(c){const r={};r.position=c.createVertexBuffer("position",0,3);let D=3;r.age=c.createVertexBuffer("age",D,1),D+=1,r.size=c.createVertexBuffer("size",D,3),D+=3,r.life=c.createVertexBuffer("life",D,1),D+=1,r.seed=c.createVertexBuffer("seed",D,4),D+=4,r.direction=c.createVertexBuffer("direction",D,3),D+=3,this._parent.particleEmitterType instanceof j&&(r.initialPosition=c.createVertexBuffer("initialPosition",D,3),D+=3),this._parent._colorGradientsTexture||(r.color=c.createVertexBuffer("color",D,4),D+=4),this._parent._isBillboardBased||(r.initialDirection=c.createVertexBuffer("initialDirection",D,3),D+=3),this._parent.noiseTexture&&(r.noiseCoordinates1=c.createVertexBuffer("noiseCoordinates1",D,3),D+=3,r.noiseCoordinates2=c.createVertexBuffer("noiseCoordinates2",D,3),D+=3),this._parent._angularSpeedGradientsTexture?(r.angle=c.createVertexBuffer("angle",D,1),D+=1):(r.angle=c.createVertexBuffer("angle",D,2),D+=2),this._parent._isAnimationSheetEnabled&&(r.cellIndex=c.createVertexBuffer("cellIndex",D,1),D+=1,this._parent.spriteRandomStartCell&&(r.cellStartOffset=c.createVertexBuffer("cellStartOffset",D,1),D+=1));const W=this._engine.recordVertexArrayObject(r,null,this._updateEffect);return this._engine.bindArrayBuffer(null),W}});class K{constructor(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,W=arguments.length>3?arguments[3]:void 0;this._engine=c,this._label=W,this._engine._storageBuffers.push(this),this._create(r,D)}_create(c,r){this._bufferSize=c,this._creationFlags=r,this._buffer=this._engine.createStorageBuffer(c,r,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(c,r,D){this._buffer&&this._engine.updateStorageBuffer(this._buffer,c,r,D)}async read(c,r,D,W){return await this._engine.readFromStorageBuffer(this._buffer,c,r,D,W)}dispose(){const c=this._engine._storageBuffers,r=c.indexOf(this);-1!==r&&(c[r]=c[c.length-1],c.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var f=D(11664),A=D(11669),h=D(11717),L=D(11656),P=D(11988),G=D(11509),d=D(11617),T=D(11902);class b{constructor(){this._gpuTimeInFrameId=-1,this.counter=new T.b}_addDuration(c,r){c<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==c?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(r,!1),this._gpuTimeInFrameId=c):this.counter.addCount(r,!1))}}var O=D(11581);class C{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=c,this._engine=r,this.uniqueId=P.c.UniqueId,r.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new b),this._engine.getCaps().supportComputeShaders?W.bindingsMapping?(this._context=r.createComputeContext(),this._shaderPath=D,this._options={bindingsMapping:{},defines:[],...W}):G.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):G.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(c,r){let D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const W=this._bindings[c];this._bindings[c]={type:D?0:4,object:r,indexInGroupEntries:null===W||void 0===W?void 0:W.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!W||W.object!==r||W.type!==this._bindings[c].type)}setStorageTexture(c,r){const D=this._bindings[c];this._contextIsDirty||(this._contextIsDirty=!D||D.object!==r),this._bindings[c]={type:1,object:r,indexInGroupEntries:null===D||void 0===D?void 0:D.indexInGroupEntries}}setExternalTexture(c,r){const D=this._bindings[c];this._contextIsDirty||(this._contextIsDirty=!D||D.object!==r),this._bindings[c]={type:6,object:r,indexInGroupEntries:null===D||void 0===D?void 0:D.indexInGroupEntries}}setVideoTexture(c,r){return!!r.externalTexture&&(this.setExternalTexture(c,r.externalTexture),!0)}setUniformBuffer(c,r){const D=this._bindings[c];this._contextIsDirty||(this._contextIsDirty=!D||D.object!==r),this._bindings[c]={type:C._BufferIsDataBuffer(r)?7:2,object:r,indexInGroupEntries:null===D||void 0===D?void 0:D.indexInGroupEntries}}setStorageBuffer(c,r){const D=this._bindings[c];this._contextIsDirty||(this._contextIsDirty=!D||D.object!==r),this._bindings[c]={type:C._BufferIsDataBuffer(r)?7:3,object:r,indexInGroupEntries:null===D||void 0===D?void 0:D.indexInGroupEntries}}setTextureSampler(c,r){const D=this._bindings[c];this._contextIsDirty||(this._contextIsDirty=!D||!r.compareSampler(D.object)),this._bindings[c]={type:5,object:r,indexInGroupEntries:null===D||void 0===D?void 0:D.indexInGroupEntries}}isReady(){let c=this._effect;for(const B in this._bindings){const c=this._bindings[B],r=c.type,D=c.object;switch(r){case 0:case 4:case 1:if(!D.isReady())return!1;break;case 6:if(!D.isReady())return!1;break}}const r=[],D=this._shaderPath;if(this._options.defines)for(let B=0;B<this._options.defines.length;B++)r.push(this._options.defines[B]);const W=r.join("\n");return this._cachedDefines!==W&&(this._cachedDefines=W,c=this._engine.createComputeEffect(D,{defines:W,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=c),!!c.isReady()}dispatch(c,r,D){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,c,r,D,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const D=C._BufferIsDataBuffer(c)?c:c.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,D,r,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const r in this._bindings){const D=this._bindings[r];if(!this._options.bindingsMapping[r])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+r+"'");switch(D.type){case 0:{const W=this._samplers[r],B=D.object;var c;if(!W||!B._texture||!W.compareSampler(B._texture))this._samplers[r]=(new d.e).setParameters(B.wrapU,B.wrapV,B.wrapR,B.anisotropicFilteringLevel,B._texture.samplingMode,null===(c=B._texture)||void 0===c?void 0:c._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const c=D.object;c.getBuffer()!==D.buffer&&(D.buffer=c.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((B=>{(0,O.f)((()=>this.dispatch(c,r,D)),B,void 0,W)}))}serialize(){const c=h.d.Serialize(this);c.options=this._options,c.shaderPath=this._shaderPath,c.Hm={},c.textures={};for(const r in this._bindings){const D=this._bindings[r],W=D.object;switch(D.type){case 0:case 4:case 1:{const B=W.serialize();B&&(c.textures[r]=B,c.Hm[r]={type:D.type});break}}}return c}static Parse(c,r,D){const W=h.d.Parse((()=>new C(c.name,r.getEngine(),c.shaderPath,c.options)),c,r,D);for(const B in c.textures){const t=c.Hm[B],u=L.b.Parse(c.textures[B],r,D);0===t.type?W.setTexture(B,u):4===t.type?W.setTexture(B,u,!1):W.setStorageTexture(B,u)}return W}static _BufferIsDataBuffer(c){return void 0!==c.underlyingResource}}(0,f.e)([(0,A.K)()],C.prototype,"name",void 0),(0,f.e)([(0,A.K)()],C.prototype,"fastMode",void 0),(0,a.e)("BABYLON.ComputeShader",C);var p=D(11946);const R="gpuUpdateParticlesComputeShader",s="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";U.d.ShadersStoreWGSL[R]||(U.d.ShadersStoreWGSL[R]=s);(0,a.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(c,r){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=c,this._engine=r}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var c;return(null===(c=this._updateComputeShader)||void 0===c?void 0:c.isReady())??!1}createUpdateBuffer(c){var r;const D={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(D.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(D.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(D.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(D.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(D.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(D.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(D.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new C("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:D,defines:c.split("\n")}),null===(r=this._simParamsComputeShader)||void 0===r||r.dispose(),this._simParamsComputeShader=new p.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new y(this._simParamsComputeShader)}createVertexBuffers(c,r){this._renderVertexBuffers.push(r)}createParticleBuffer(c){const r=new K(this._engine,4*c.length,11,"ComputeShaderParticleSystemBuffer");return r.update(c),this._bufferComputeShader.push(r),r.getBuffer()}bindDrawBuffers(c,r,D){this._engine.bindBuffers(this._renderVertexBuffers[c],D,r)}preUpdateParticleBuffer(){}updateParticleBuffer(c,r,D){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[c]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^c]),this._updateComputeShader.dispatch(Math.ceil(D/64))}releaseBuffers(){var c;for(let r=0;r<this._bufferComputeShader.length;++r)this._bufferComputeShader[r].dispose();this._bufferComputeShader.length=0,null===(c=this._simParamsComputeShader)||void 0===c||c.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class o{constructor(c,r,D){this.gradient=c,this.color1=r,this.color2=D}getColorToRef(c){this.color2?u.Xa.LerpToRef(this.color1,this.color2,Math.random(),c):c.t(this.color1)}}class Q{constructor(c,r){this.gradient=c,this.color=r}}class l{constructor(c,r,D){this.gradient=c,this.factor1=r,this.factor2=D}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class F{static GetCurrentGradient(c,r,D){if(r[0].gradient>c)return void D(r[0],r[0],1);for(let B=0;B<r.length-1;B++){const W=r[B],t=r[B+1];if(c>=W.gradient&&c<=t.gradient){return void D(W,t,(c-W.gradient)/(t.gradient-W.gradient))}}const W=r.length-1;D(r[W],r[W],1)}}var I=D(11494),i=D(12159),n=D(11538);class V{constructor(c){this.particleSystem=c,this.position=W.Zr.Zero(),this.direction=W.Zr.Zero(),this.color=new u.Xa(0,0,0,0),this.colorStep=new u.Xa(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new W.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new u.Xa(0,0,0,0),this._currentColor2=new u.Xa(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=V._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let c=this.age,r=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===r?(r=1,c=this._randomCellOffset):c+=this._randomCellOffset);const D=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let W;W=this._initialSpriteCellLoop?(0,x.Clamp)(c*r%this.lifeTime/this.lifeTime):(0,x.Clamp)(c*r/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+W*D|0}_inheritParticleInfoToSubEmitter(c){if(c.particleSystem.tr.position){const r=c.particleSystem.tr;if(r.position.t(this.position),c.inheritDirection){const c=W.TmpVectors.Zr[0];this.direction.normalizeToRef(c),r.setDirection(c,0,Math.PI/2)}}else{c.particleSystem.tr.t(this.position)}this.direction.scaleToRef(c.inheritedVelocityAmount/2,W.TmpVectors.Zr[0]),c.particleSystem._inheritedVelocityOffset.t(W.TmpVectors.Zr[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const c of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(c)}_reset(){this.age=0,this.id=V._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(c){c.position.t(this.position),this._initialDirection?c._initialDirection?c._initialDirection.t(this._initialDirection):c._initialDirection=this._initialDirection.clone():c._initialDirection=null,c.direction.t(this.direction),this.sa&&(c.sa?c.sa.t(this.sa):c.sa=this.sa.clone()),c.color.t(this.color),c.colorStep.t(this.colorStep),c.lifeTime=this.lifeTime,c.age=this.age,c._randomCellOffset=this._randomCellOffset,c.size=this.size,c.scale.t(this.scale),c.angle=this.angle,c.angularSpeed=this.angularSpeed,c.particleSystem=this.particleSystem,c.cellIndex=this.cellIndex,c.id=this.id,c._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(c._currentColorGradient=this._currentColorGradient,c._currentColor1.t(this._currentColor1),c._currentColor2.t(this._currentColor2)),this._currentSizeGradient&&(c._currentSizeGradient=this._currentSizeGradient,c._currentSize1=this._currentSize1,c._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(c._currentAngularSpeedGradient=this._currentAngularSpeedGradient,c._currentAngularSpeed1=this._currentAngularSpeed1,c._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(c._currentVelocityGradient=this._currentVelocityGradient,c._currentVelocity1=this._currentVelocity1,c._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(c._currentLimitVelocityGradient=this._currentLimitVelocityGradient,c._currentLimitVelocity1=this._currentLimitVelocity1,c._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(c._currentDragGradient=this._currentDragGradient,c._currentDrag1=this._currentDrag1,c._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(c._initialStartSpriteCellId=this._initialStartSpriteCellId,c._initialEndSpriteCellId=this._initialEndSpriteCellId,c._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(c.remapData&&this.remapData?c.remapData.t(this.remapData):c.remapData=new W.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(c._randomNoiseCoordinates1?(c._randomNoiseCoordinates1.t(this._randomNoiseCoordinates1),c._randomNoiseCoordinates2.t(this._randomNoiseCoordinates2)):(c._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),c._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}V._Count=0;var cc=D(11782),rc=(D(11831),D(12050)),Dc=D(12048),Wc=D(11942);function Bc(c,r){const D=(0,x.RandomRange)(0,1);u.Xa.LerpToRef(r.color1,r.color2,D,c.color),r.colorDead.subtractToRef(c.color,r._colorDiff),r._colorDiff.scaleToRef(1/c.lifeTime,c.colorStep)}function tc(c,r){c._currentColorGradient=r._colorGradients[0],c._currentColorGradient.getColorToRef(c.color),c._currentColor1.t(c.color),r._colorGradients.length>1?r._colorGradients[1].getColorToRef(c._currentColor2):c._currentColor2.t(c.color)}function uc(c,r){const D=r._colorGradients;F.GetCurrentGradient(r._ratio,D,((r,D,W)=>{r!==c._currentColorGradient&&(c._currentColor1.t(c._currentColor2),D.getColorToRef(c._currentColor2),c._currentColorGradient=r),u.Xa.LerpToRef(c._currentColor1,c._currentColor2,W,c.color)}))}function ac(c,r){c.colorStep.scaleToRef(r._scaledUpdateSpeed,r._scaledColorStep),c.color.addInPlace(r._scaledColorStep),c.color.a<0&&(c.color.a=0)}function Hc(c,r){F.GetCurrentGradient(r._ratio,r._angularSpeedGradients,((r,D,W)=>{r!==c._currentAngularSpeedGradient&&(c._currentAngularSpeed1=c._currentAngularSpeed2,c._currentAngularSpeed2=D.getFactor(),c._currentAngularSpeedGradient=r),c.angularSpeed=(0,x.Lerp)(c._currentAngularSpeed1,c._currentAngularSpeed2,W)}))}function xc(c,r){c.angle+=c.angularSpeed*r._scaledUpdateSpeed}function Mc(c,r){r.particleEmitterType.startDirectionFunction(r._emitterWorldMatrix,c.direction,c,r.isLocal,r._emitterInverseWorldMatrix)}function Ec(c,r){r.startDirectionFunction(r._emitterWorldMatrix,c.direction,c,r.isLocal)}function mc(c,r){c._currentVelocityGradient=r._velocityGradients[0],c._currentVelocity1=c._currentVelocityGradient.getFactor(),r._velocityGradients.length>1?c._currentVelocity2=r._velocityGradients[1].getFactor():c._currentVelocity2=c._currentVelocity1}function Yc(c,r){c._currentLimitVelocityGradient=r._limitVelocityGradients[0],c._currentLimitVelocity1=c._currentLimitVelocityGradient.getFactor(),r._limitVelocityGradients.length>1?c._currentLimitVelocity2=r._limitVelocityGradients[1].getFactor():c._currentLimitVelocity2=c._currentLimitVelocity1}function vc(c,r){F.GetCurrentGradient(r._ratio,r._velocityGradients,((D,W,B)=>{D!==c._currentVelocityGradient&&(c._currentVelocity1=c._currentVelocity2,c._currentVelocity2=W.getFactor(),c._currentVelocityGradient=D),r._directionScale*=(0,x.Lerp)(c._currentVelocity1,c._currentVelocity2,B)}))}function kc(c,r){F.GetCurrentGradient(r._ratio,r._limitVelocityGradients,((D,W,B)=>{D!==c._currentLimitVelocityGradient&&(c._currentLimitVelocity1=c._currentLimitVelocity2,c._currentLimitVelocity2=W.getFactor(),c._currentLimitVelocityGradient=D);const t=(0,x.Lerp)(c._currentLimitVelocity1,c._currentLimitVelocity2,B);c.direction.length()>t&&c.direction.scaleInPlace(r.limitVelocityDamping)}))}function wc(c,r){c.direction.scaleToRef(r._directionScale,r._scaledDirection)}function Zc(c,r){r.particleEmitterType.startPositionFunction(r._emitterWorldMatrix,c.position,c,r.isLocal)}function Jc(c,r){r.startPositionFunction(r._emitterWorldMatrix,c.position,c,r.isLocal)}function qc(c,r){c.sa?c.sa.t(c.position):c.sa=c.position.clone(),W.Zr.TransformCoordinatesToRef(c.sa,r._emitterWorldMatrix,c.position)}function jc(c,r){r.isLocal&&c.sa?(c.sa.addInPlace(r._scaledDirection),W.Zr.TransformCoordinatesToRef(c.sa,r._emitterWorldMatrix,c.position)):c.position.addInPlace(r._scaledDirection)}function Xc(c,r){c._currentDragGradient=r._dragGradients[0],c._currentDrag1=c._currentDragGradient.getFactor(),r._dragGradients.length>1?c._currentDrag2=r._dragGradients[1].getFactor():c._currentDrag2=c._currentDrag1}function ec(c,r){F.GetCurrentGradient(r._ratio,r._dragGradients,((D,W,B)=>{D!==c._currentDragGradient&&(c._currentDrag1=c._currentDrag2,c._currentDrag2=W.getFactor(),c._currentDragGradient=D);const t=(0,x.Lerp)(c._currentDrag1,c._currentDrag2,B);r._scaledDirection.scaleInPlace(1-t)}))}function yc(c,r){c._randomNoiseCoordinates1?(c._randomNoiseCoordinates1.Ja(Math.random(),Math.random(),Math.random()),c._randomNoiseCoordinates2.Ja(Math.random(),Math.random(),Math.random())):(c._randomNoiseCoordinates1=new W.Zr(Math.random(),Math.random(),Math.random()),c._randomNoiseCoordinates2=new W.Zr(Math.random(),Math.random(),Math.random()))}function Uc(c,r){const D=r._noiseTextureData,B=r._noiseTextureSize;if(D&&B&&c._randomNoiseCoordinates1){const t=r._fetchR(c._randomNoiseCoordinates1.x,c._randomNoiseCoordinates1.y,B.width,B.height,D),u=r._fetchR(c._randomNoiseCoordinates1.z,c._randomNoiseCoordinates2.x,B.width,B.height,D),a=r._fetchR(c._randomNoiseCoordinates2.y,c._randomNoiseCoordinates2.z,B.width,B.height,D),H=W.TmpVectors.Zr[0],x=W.TmpVectors.Zr[1];H.Ja((2*t-1)*r.noiseStrength.x,(2*u-1)*r.noiseStrength.y,(2*a-1)*r.noiseStrength.z),H.scaleToRef(r._tempScaledUpdateSpeed,x),c.direction.addInPlace(x)}}function Nc(c,r){r.gravity.scaleToRef(r._tempScaledUpdateSpeed,r._scaledGravity),c.direction.addInPlace(r._scaledGravity)}function gc(c,r){c.size=(0,x.RandomRange)(r.minSize,r.maxSize),c.scale.Ja((0,x.RandomRange)(r.minScaleX,r.maxScaleX),(0,x.RandomRange)(r.minScaleY,r.maxScaleY))}function zc(c,r){c._currentSizeGradient=r._sizeGradients[0],c._currentSize1=c._currentSizeGradient.getFactor(),c.size=c._currentSize1,r._sizeGradients.length>1?c._currentSize2=r._sizeGradients[1].getFactor():c._currentSize2=c._currentSize1,c.scale.Ja((0,x.RandomRange)(r.minScaleX,r.maxScaleX),(0,x.RandomRange)(r.minScaleY,r.maxScaleY))}function Sc(c,r){const D=r._actualFrame/r.targetStopDuration;F.GetCurrentGradient(D,r._startSizeGradients,((D,W,B)=>{D!==r._currentStartSizeGradient&&(r._currentStartSize1=r._currentStartSize2,r._currentStartSize2=W.getFactor(),r._currentStartSizeGradient=D);const t=(0,x.Lerp)(r._currentStartSize1,r._currentStartSize2,B);c.scale.scaleInPlace(t)}))}function Kc(c,r){F.GetCurrentGradient(r._ratio,r._sizeGradients,((r,D,W)=>{r!==c._currentSizeGradient&&(c._currentSize1=c._currentSize2,c._currentSize2=D.getFactor(),c._currentSizeGradient=r),c.size=(0,x.Lerp)(c._currentSize1,c._currentSize2,W)}))}function fc(c,r){c.remapData=new W.Vector4(0,1,0,1)}function Ac(c,r){r._colorRemapGradients&&r._colorRemapGradients.length>0&&F.GetCurrentGradient(r._ratio,r._colorRemapGradients,((r,D,W)=>{const B=(0,x.Lerp)(r.factor1,D.factor1,W),t=(0,x.Lerp)(r.factor2,D.factor2,W);c.remapData.x=B,c.remapData.y=t-B})),r._alphaRemapGradients&&r._alphaRemapGradients.length>0&&F.GetCurrentGradient(r._ratio,r._alphaRemapGradients,((r,D,W)=>{const B=(0,x.Lerp)(r.factor1,D.factor1,W),t=(0,x.Lerp)(r.factor2,D.factor2,W);c.remapData.z=B,c.remapData.w=t-B}))}function hc(c,r){const D=(0,x.Clamp)(r._actualFrame/r.targetStopDuration);F.GetCurrentGradient(D,r._lifeTimeGradients,((r,W)=>{const B=r,t=W,u=B.getFactor(),a=t.getFactor(),H=(D-B.gradient)/(t.gradient-B.gradient);c.lifeTime=(0,x.Lerp)(u,a,H)})),r._emitPower=(0,x.RandomRange)(r.minEmitPower,r.maxEmitPower)}function Lc(c,r){c.lifeTime=(0,x.RandomRange)(r.minLifeTime,r.maxLifeTime),r._emitPower=(0,x.RandomRange)(r.minEmitPower,r.maxEmitPower)}function Pc(c,r){0===r._emitPower?(c._initialDirection?c._initialDirection.t(c.direction):c._initialDirection=c.direction.clone(),c.direction.set(0,0,0)):(c._initialDirection=null,c.direction.scaleInPlace(r._emitPower)),c.direction.addInPlace(r._inheritedVelocityOffset)}function Gc(c,r){c.angularSpeed=(0,x.RandomRange)(r.minAngularSpeed,r.maxAngularSpeed),c.angle=(0,x.RandomRange)(r.minInitialRotation,r.maxInitialRotation)}function dc(c,r){c._currentAngularSpeedGradient=r._angularSpeedGradients[0],c.angularSpeed=c._currentAngularSpeedGradient.getFactor(),c._currentAngularSpeed1=c.angularSpeed,r._angularSpeedGradients.length>1?c._currentAngularSpeed2=r._angularSpeedGradients[1].getFactor():c._currentAngularSpeed2=c._currentAngularSpeed1,c.angle=(0,x.RandomRange)(r.minInitialRotation,r.maxInitialRotation)}function Tc(c,r){c._initialStartSpriteCellId=r.startSpriteCellID,c._initialEndSpriteCellId=r.endSpriteCellID,c._initialSpriteCellLoop=r.spriteCellLoop}function bc(c,r){c.previousItem=r.previousItem,c.nextItem=r,r.previousItem&&(r.previousItem.nextItem=c),r.previousItem=c}function Oc(c,r){c.previousItem=r,c.nextItem=r.nextItem,r.nextItem&&(r.nextItem.previousItem=c),r.nextItem=c}function Cc(c,r){let D=r;for(;D.nextItem;)D=D.nextItem;c.previousItem=D,c.nextItem=D.nextItem,D.nextItem=c}function pc(c){c.previousItem&&(c.previousItem.nextItem=c.nextItem),c.nextItem&&(c.nextItem.previousItem=c.previousItem)}class Rc extends H{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(c){this._startDirectionFunction!==c&&(this._startDirectionFunction=c,this._directionProcessing.process=c?Ec:Mc)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(c){this._startPositionFunction!==c&&(this._startPositionFunction=c,this._positionCreation.process=c?Jc:Zc)}set onDispose(c){this._onDisposeObserver&&this.Wa.remove(this._onDisposeObserver),this._onDisposeObserver=this.Wa.add(c)}get M(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(c){this._useRampGradients!==c&&(this._useRampGradients=c,this._resetEffect(),c?(this._rampCreation={process:fc,previousItem:null,nextItem:null},Oc(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Ac,previousItem:null,nextItem:null},Oc(this._remapGradientProcessing,this._gravityProcessing)):(pc(this._rampCreation),pc(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(c){this._isLocal!==c&&(this._isLocal=c,c?(this._isLocalCreation={process:qc,previousItem:null,nextItem:null},Oc(this._isLocalCreation,this._positionCreation)):pc(this._isLocalCreation))}get particles(){return this.Wm}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(c){this._animationSheetEnabled!==c&&(this._animationSheetEnabled=c,c?(this._sheetCreation={process:Tc,previousItem:null,nextItem:null},Oc(this._sheetCreation,this._colorCreation)):pc(this._sheetCreation),this._reset())}getActiveCount(){return this.Wm.length}getClassName(){return"nx"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var c;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(c=this._customWrappers[r])||void 0===c?void 0:c.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[c]??this._customWrappers[0]}setCustomEffect(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[r]=new cc.c(this._engine),this._customWrappers[r].effect=c,this._customWrappers[r].drawContext&&(this._customWrappers[r].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new I.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(c){if(this.noiseTexture!==c){if(this._noiseTexture=c,!c)return pc(this._noiseCreation),void pc(this._noiseProcessing);this._noiseCreation={process:yc,previousItem:null,nextItem:null},Oc(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Uc,previousItem:null,nextItem:null},Oc(this._noiseProcessing,this._positionProcessing)}}constructor(c,r,D){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,H=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(c),this._emitterInverseWorldMatrix=W.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new W.Zr,this.Wa=new I.c,this.onStoppedObservable=new I.c,this.onStartedObservable=new I.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.Wm=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new u.Xa(0,0,0,0),this._colorDiff=new u.Xa(0,0,0,0),this._scaledDirection=W.Zr.Zero(),this._scaledGravity=W.Zr.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=c=>{},this.recycleParticle=c=>{const r=this.Wm.pop();r!==c&&r.copyTo(c),this._stockParticles.push(r)},this._createParticle=()=>{let c;return 0!==this._stockParticles.length?(c=this._stockParticles.pop(),c._reset()):c=new V(this),this._prepareParticle(c),c},this.paused=!1,this._shadersLoaded=!1,this._capacity=r,this._epsilon=a,D&&"Scene"!==D.getClassName()?(this._engine=D,this.defaultProjectionMatrix=W.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=D||n.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.rm.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Lc,previousItem:null,nextItem:null},this._positionCreation={process:Zc,previousItem:null,nextItem:null},Oc(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Mc,previousItem:null,nextItem:null},Oc(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Pc,previousItem:null,nextItem:null},Oc(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:gc,previousItem:null,nextItem:null},Oc(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Gc,previousItem:null,nextItem:null},Oc(this._angleCreation,this._sizeCreation),this._colorCreation={process:Bc,previousItem:null,nextItem:null},Oc(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,H||(this._colorProcessing={process:ac,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:xc,previousItem:null,nextItem:null},Oc(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:wc,previousItem:null,nextItem:null},Oc(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:jc,previousItem:null,nextItem:null},Oc(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:Nc,previousItem:null,nextItem:null},Oc(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=t,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new cc.c(this._engine)},this._customWrappers[0].effect=B,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new E,this.updateFunction=c=>{var r;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(r=this.noiseTexture.getContent())||void 0===r||r.then((c=>{this._noiseTextureData=c})));const D=c===this.Wm;for(let W=0;W<c.length;W++){const r=c[W];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const B=r.age;if(r.age+=this._tempScaledUpdateSpeed,r.age>r.lifeTime){const c=r.age-B,D=r.lifeTime-B;this._tempScaledUpdateSpeed=D*this._tempScaledUpdateSpeed/c,r.age=r.lifeTime}this._ratio=r.age/r.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let t=this._updateQueueStart;for(;t;)t.process(r,this),t=t.nextItem;if(this._isAnimationSheetEnabled&&!H&&r.updateCellIndex(),r._inheritParticleInfoToSubEmitters(),r.age>=r.lifeTime){if(this._emitFromParticle(r),r._attachedSubEmitters){for(const c of r._attachedSubEmitters)c.particleSystem.disposeOnStop=!0,c.particleSystem.stop();r._attachedSubEmitters=null}this.recycleParticle(r),D&&W--}else;}}}serialize(c){throw new Error("Method not implemented.")}clone(c,r){throw new Error("Method not implemented.")}_addFactorGradient(c,r,D,W){const B=new l(r,D,W);c.push(B),c.sort(((c,r)=>c.gradient<r.gradient?-1:c.gradient>r.gradient?1:0))}_removeFactorGradient(c,r){if(!c)return;let D=0;for(const W of c){if(W.gradient===r){c.splice(D,1);break}D++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=hc:this._lifeTimeCreation.process=Lc}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Sc,previousItem:null,nextItem:null},Oc(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(pc(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(c){this.targetStopDuration!==c&&(this._targetStopDuration=c,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(c,r,D){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,c,r,D),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(c){return this._removeFactorGradient(this._lifeTimeGradients,c),this._syncLifeTimeCreation(),this}addSizeGradient(c,r,D){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=zc,this._sizeGradientProcessing={process:Kc,previousItem:null,nextItem:null},bc(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,c,r,D),this}removeSizeGradient(c){var r;return this._removeFactorGradient(this._sizeGradients,c),0===(null===(r=this._sizeGradients)||void 0===r?void 0:r.length)&&(pc(this._sizeGradientProcessing),this._sizeCreation.process=gc),this}addColorRemapGradient(c,r,D){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,c,r,D),this}removeColorRemapGradient(c){return this._removeFactorGradient(this._colorRemapGradients,c),this}addAlphaRemapGradient(c,r,D){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,c,r,D),this}removeAlphaRemapGradient(c){return this._removeFactorGradient(this._alphaRemapGradients,c),this}addAngularSpeedGradient(c,r,D){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=dc,this._angularSpeedGradientProcessing={process:Hc,previousItem:null,nextItem:null},bc(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,c,r,D),this}removeAngularSpeedGradient(c){var r;return this._removeFactorGradient(this._angularSpeedGradients,c),0===(null===(r=this._angularSpeedGradients)||void 0===r?void 0:r.length)&&(this._angleCreation.process=Gc,pc(this._angularSpeedGradientProcessing)),this}addVelocityGradient(c,r,D){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:mc,previousItem:null,nextItem:null},Oc(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:vc,previousItem:null,nextItem:null},bc(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,c,r,D),this}removeVelocityGradient(c){var r;return this._removeFactorGradient(this._velocityGradients,c),0===(null===(r=this._velocityGradients)||void 0===r?void 0:r.length)&&(pc(this._velocityCreation),pc(this._velocityGradientProcessing)),this}addLimitVelocityGradient(c,r,D){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Yc,previousItem:null,nextItem:null},Oc(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:kc,previousItem:null,nextItem:null},Oc(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,c,r,D),this}removeLimitVelocityGradient(c){var r;return this._removeFactorGradient(this._limitVelocityGradients,c),0===(null===(r=this._limitVelocityGradients)||void 0===r?void 0:r.length)&&(pc(this._limitVelocityCreation),pc(this._limitVelocityGradientProcessing)),this}addDragGradient(c,r,D){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Xc,previousItem:null,nextItem:null},bc(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:ec,previousItem:null,nextItem:null},bc(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,c,r,D),this}removeDragGradient(c){var r;return this._removeFactorGradient(this._dragGradients,c),0===(null===(r=this._dragGradients)||void 0===r?void 0:r.length)&&(pc(this._dragCreation),pc(this._dragGradientProcessing)),this}addEmitRateGradient(c,r,D){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,c,r,D),this}removeEmitRateGradient(c){return this._removeFactorGradient(this._emitRateGradients,c),this}addStartSizeGradient(c,r,D){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,c,r,D),this._syncStartSizeCreation(),this}removeStartSizeGradient(c){return this._removeFactorGradient(this._startSizeGradients,c),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const c=new Uint8Array(4*this._rawTextureWidth),r=u.TmpColors.Xr[0];for(let D=0;D<this._rawTextureWidth;D++){const W=D/this._rawTextureWidth;F.GetCurrentGradient(W,this._rampGradients,((W,B,t)=>{u.Xr.LerpToRef(W.color,B.color,t,r),c[4*D]=255*r.r,c[4*D+1]=255*r.g,c[4*D+2]=255*r.b,c[4*D+3]=255}))}this._rampGradientsTexture=i.e.CreateRGBATexture(c,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((c,r)=>c.gradient<r.gradient?-1:c.gradient>r.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(c,r){this._rampGradients||(this._rampGradients=[]);const D=new Q(c,r);return this._rampGradients.push(D),this._syncRampGradientTexture(),this}removeRampGradient(c){return this._removeGradientAndTexture(c,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(c,r,D){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=tc,this._colorProcessing.process=uc);const W=new o(c,r,D);return this._colorGradients.push(W),this._colorGradients.sort(((c,r)=>c.gradient<r.gradient?-1:c.gradient>r.gradient?1:0)),this}removeColorGradient(c){if(!this._colorGradients)return this;let r=0;for(const D of this._colorGradients){if(D.gradient===c){this._colorGradients.splice(r,1);break}r++}return 0===this._colorGradients.length&&(this._colorCreation.process=Bc,this._colorProcessing.process=ac),this}resetDrawCache(){if(this._drawWrappers){for(const c of this._drawWrappers)if(c)for(const r of c)null===r||void 0===r||r.dispose();this._drawWrappers=[]}}_fetchR(c,r,D,W,B){return B[4*(((c=.5*Math.abs(c)+.5)*D%D|0)+((r=.5*Math.abs(r)+.5)*W%W|0)*D)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const c=this._engine,r=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*r),this._vertexBuffer=new X.b(c,this._vertexData,!0,r);let D=0;const W=this._vertexBuffer.createVertexBuffer(X.d.PositionKind,D,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[X.d.PositionKind]=W,D+=3;const B=this._vertexBuffer.createVertexBuffer(X.d.ColorKind,D,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[X.d.ColorKind]=B,D+=4;const t=this._vertexBuffer.createVertexBuffer("angle",D,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=t,D+=1;const u=this._vertexBuffer.createVertexBuffer("size",D,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=u,D+=2,this._isAnimationSheetEnabled){const c=this._vertexBuffer.createVertexBuffer("cellIndex",D,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=c,D+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const c=this._vertexBuffer.createVertexBuffer("direction",D,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=c,D+=3}if(this._useRampGradients){const c=this._vertexBuffer.createVertexBuffer("remapData",D,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=c,D+=4}let a;if(this._useInstancing){const r=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new X.b(c,r,!1,2),a=this._spriteBuffer.createVertexBuffer("offset",0,2)}else a=this._vertexBuffer.createVertexBuffer("offset",D,2,this._vertexBufferSize,this._useInstancing),D+=2;this._vertexBuffers.offset=a,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const c=[],r=[];let D=0;for(let W=0;W<this._capacity;W++)c.push(D),c.push(D+1),c.push(D+2),c.push(D),c.push(D+2),c.push(D+3),r.push(D,D+1,D+1,D+2,D+2,D+3,D+3,D,D,D+3),D+=4;this._indexBuffer=this._engine.createIndexBuffer(c),this._linesIndexBuffer=this._engine.createIndexBuffer(r)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(c)setTimeout((()=>{this.start(0)}),c);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var r;-1!==(null===(r=this.tr)||void 0===r?void 0:r.getClassName().indexOf("Mesh"))&&this.tr.va(!0);const c=this.noiseTexture;if(c&&c.onGeneratedObservable)c.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let r=0;r<this.preWarmCycles;r++)this.animate(!0),c.render()}))}));else for(let r=0;r<this.preWarmCycles;r++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(c))}_postStop(c){}reset(){this._stockParticles.length=0,this.Wm.length=0}_appendParticleVertex(c,r,D,B){let t=c*this._vertexBufferSize;if(this._vertexData[t++]=r.position.x+this.vx.x,this._vertexData[t++]=r.position.y+this.vx.y,this._vertexData[t++]=r.position.z+this.vx.z,this._vertexData[t++]=r.color.r,this._vertexData[t++]=r.color.g,this._vertexData[t++]=r.color.b,this._vertexData[t++]=r.color.a,this._vertexData[t++]=r.angle,this._vertexData[t++]=r.scale.x*r.size,this._vertexData[t++]=r.scale.y*r.size,this._isAnimationSheetEnabled&&(this._vertexData[t++]=r.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[t++]=r.direction.x,this._vertexData[t++]=r.direction.y,this._vertexData[t++]=r.direction.z);else if(r._initialDirection){let c=r._initialDirection;this.isLocal&&(W.Zr.TransformNormalToRef(c,this._emitterWorldMatrix,W.TmpVectors.Zr[0]),c=W.TmpVectors.Zr[0]),0===c.x&&0===c.z&&(c.x=.001),this._vertexData[t++]=c.x,this._vertexData[t++]=c.y,this._vertexData[t++]=c.z}else{let c=r.direction;this.isLocal&&(W.Zr.TransformNormalToRef(c,this._emitterWorldMatrix,W.TmpVectors.Zr[0]),c=W.TmpVectors.Zr[0]),0===c.x&&0===c.z&&(c.x=.001),this._vertexData[t++]=c.x,this._vertexData[t++]=c.y,this._vertexData[t++]=c.z}this._useRampGradients&&r.remapData&&(this._vertexData[t++]=r.remapData.x,this._vertexData[t++]=r.remapData.y,this._vertexData[t++]=r.remapData.z,this._vertexData[t++]=r.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===D?D=this._epsilon:1===D&&(D=1-this._epsilon),0===B?B=this._epsilon:1===B&&(B=1-this._epsilon)),this._vertexData[t++]=D,this._vertexData[t++]=B)}_prepareParticle(c){}_createNewOnes(c){let r;for(let D=0;D<c&&this.Wm.length!==this._capacity;D++){r=this._createParticle(),this.Wm.push(r);let c=this._createQueueStart;for(;c;)c.process(r,this),c=c.nextItem;r._inheritParticleInfoToSubEmitters()}}_update(c){if(this._alive=this.Wm.length>0,this.tr.position){const c=this.tr;this._emitterWorldMatrix=c.getWorldMatrix()}else{const c=this.tr;this._emitterWorldMatrix=W.Matrix.Translation(c.x,c.y,c.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Wm),this._createNewOnes(c)}static _GetAttributeNamesOrOptions(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const W=[X.d.PositionKind,X.d.ColorKind,"angle","offset","size"];return c&&W.push("cellIndex"),r||W.push("direction"),D&&W.push("remapData"),W}static _GetEffectCreationOptions(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const W=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,rc.c)(W),c&&W.push("particlesInfos"),r&&W.push("logarithmicDepthConstant"),D&&(W.push("vFogInfos"),W.push("vFogColor")),W}fillDefines(c,r){let D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,rc.j)(this,this._scene,c),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&c.push("#define FOG")),this._isAnimationSheetEnabled&&c.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&c.push("#define LOGARITHMICDEPTH"),r===H.BLENDMODE_MULTIPLY&&c.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&c.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(c.push("#define BILLBOARD"),this.billboardMode){case 2:c.push("#define BILLBOARDY");break;case 8:case 9:c.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&c.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:c.push("#define BILLBOARDMODE_ALL")}D&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),c.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(c,r,D){r.push(...Rc._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),c.push(...Rc._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),D.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Wc.e)(c,this._imageProcessingConfigurationDefines),(0,Wc.c)(D,this._imageProcessingConfigurationDefines))}_getWrapper(c){const r=this._getCustomDrawWrapper(c);if(null!==r&&void 0!==r&&r.effect)return r;const D=[];this.fillDefines(D,c);const W=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let B=this._drawWrappers[W];B||(B=this._drawWrappers[W]=[]);let t=B[c];t||(t=new cc.c(this._engine),t.drawContext&&(t.drawContext.useInstancing=this._useInstancing),B[c]=t);const u=D.join("\n");if(t.defines!==u){const c=[],r=[],D=[];this.fillUniformsAttributesAndSamplerNames(r,c,D),t.setEffect(this._engine.createEffect("particles",c,r,D,u,void 0,void 0,void 0,void 0,this._shaderLanguage),u)}return t}animate(){var c;let r,D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!D&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(D?this.preWarmStepOffset:(null===(c=this._scene)||void 0===c?void 0:c.getAnimationRatio())||1),this.manualEmitCount>-1)r=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let c=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const r=this._actualFrame/this.targetStopDuration;F.GetCurrentGradient(r,this._emitRateGradients,((r,D,W)=>{r!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=D.getFactor(),this._currentEmitRateGradient=r),c=(0,x.Lerp)(this._currentEmitRate1,this._currentEmitRate2,W)}))}r=c*this._scaledUpdateSpeed|0,this._newPartsExcess+=c*this._scaledUpdateSpeed-r}if(this._newPartsExcess>1&&(r+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?r=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(r),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!D){let c=0;for(let r=0;r<this.Wm.length;r++){const D=this.Wm[r];this._appendParticleVertices(c,D),c+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Wm.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(c,r){this._appendParticleVertex(c++,r,0,0),this._useInstancing||(this._appendParticleVertex(c++,r,1,0),this._appendParticleVertex(c++,r,1,1),this._appendParticleVertex(c++,r,0,1))}rebuild(){var c;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(c=this._spriteBuffer)||void 0===c||c._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Rc.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(D.bind(D,13157)),Promise.resolve().then(D.bind(D,13101))])):await Promise.all([Promise.resolve().then(D.bind(D,13088)),Promise.resolve().then(D.bind(D,13071))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.tr||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==H.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(H.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(H.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(c){const r=this._getWrapper(c),D=r.effect,B=this._engine;B.enableEffect(r);const t=this.defaultViewMatrix??this._scene.getViewMatrix();if(D.setTexture("diffuseSampler",this.particleTexture),D.setMatrix("view",t),D.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const c=this.particleTexture.getBaseSize();D.setFloat3("particlesInfos",this.spriteCellWidth/c.width,this.spriteCellHeight/c.height,this.spriteCellWidth/c.width)}if(D.setVector2("translationPivot",this.translationPivot),D.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const c=this._scene.activeCamera;D.setVector3("eyePosition",c.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),D.setTexture("rampSampler",this._rampGradientsTexture));const u=D.defines;var a,H,x,M,E,m;(this._scene&&((0,rc.d)(D,this,this._scene),this.applyFog&&(0,Dc.f)(this._scene,void 0,D)),u.indexOf("#define BILLBOARDMODE_ALL")>=0&&(t.invertToRef(W.TmpVectors.Matrix[0]),D.setMatrix("invView",W.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?B.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,D):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,D)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?B.bindBuffers(this._vertexBuffers,null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?this._linesIndexBuffer:this._indexBuffer,D):B.bindBuffers(this._vertexBuffers,null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?this._linesIndexBufferUseInstancing:null,D);(this.useLogarithmicDepth&&this._scene&&(0,Dc.m)(u,D,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(D),this._setEngineBasedOnBlendMode(c),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(D),this._useInstancing)?null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?B.drawElementsType(6,0,10,this.Wm.length):B.drawArraysType(7,0,4,this.Wm.length):null!==(m=this._scene)&&void 0!==m&&m.forceWireframe?B.drawElementsType(1,0,10*this.Wm.length):B.drawElementsType(0,0,6*this.Wm.length);return this.Wm.length}render(){if(!this.isReady()||!this.Wm.length)return 0;const c=this._engine;c.setState&&(c.setState(!1),this.forceDepthWrite&&c.setDepthWrite(!0));let r=0;return r=this.blendMode===H.BLENDMODE_MULTIPLYADD?this._render(H.BLENDMODE_MULTIPLY)+this._render(H.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),r}_onDispose(){}dispose(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),c&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),c&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(r,D),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const c=this._scene.rm.indexOf(this);c>-1&&this._scene.rm.splice(c,1),this._scene._activeParticleSystems.dispose()}this.Wa.notifyObservers(this),this.Wa.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Rc.ForceGLSL=!1;var sc,oc=D(11524);!function(c){c[c.ATTACHED=0]="ATTACHED",c[c.END=1]="END"}(sc||(sc={}));class Qc{constructor(c){if(this.particleSystem=c,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!c.tr||!c.tr.dispose){const r=(0,a.b)("BABYLON.AbstractMesh");c.tr=new r("SubemitterSystemEmitter",c.yc()),c._disposeEmitterOnDispose=!0}}clone(){let c=this.particleSystem.tr;if(c){if(c instanceof W.Zr)c=c.clone();else if(-1!==c.getClassName().indexOf("Mesh")){c=new((0,a.b)("BABYLON.Mesh"))("",c.yc()),c.isVisible=!1}}else c=new W.Zr;const r=new Qc(this.particleSystem.clone(this.particleSystem.name,c));return r.particleSystem.name+="Clone",r.type=this.type,r.inheritDirection=this.inheritDirection,r.inheritedVelocityAmount=this.inheritedVelocityAmount,r.particleSystem._disposeEmitterOnDispose=!0,r.particleSystem.disposeOnStop=!0,r}serialize(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r={};return r.type=this.type,r.inheritDirection=this.inheritDirection,r.inheritedVelocityAmount=this.inheritedVelocityAmount,r.particleSystem=this.particleSystem.serialize(c),r}static _ParseParticleSystem(c,r,D){throw(0,oc.e)("ParseParticle")}static Parse(c,r,D){const W=c.particleSystem,B=new Qc(Qc._ParseParticleSystem(W,r,D,!0));return B.type=c.type,B.inheritDirection=c.inheritDirection,B.inheritedVelocityAmount=c.inheritedVelocityAmount,B.particleSystem._isSubEmitter=!0,B}dispose(){this.particleSystem.dispose()}}var lc=D(11584);function Fc(c,r){const D=new Z;return D.direction1=c,D.direction2=r,D}function Ic(){return new w(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function ic(){return new J(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function nc(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new W.Zr(0,1,0),D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new W.Zr(0,1,0);return new q(c,r,D)}function Vc(){return new v(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function cr(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new W.Zr(0,1,0),t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new W.Zr(0,1,0);return new k(c,r,D,B,t)}function rr(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new m(c,r)}function Dr(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new W.Zr(0,1,0),B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new W.Zr(0,1,0);return new Y(c,r,D,B)}const Wr=W.Zr.Zero(),Br=W.Zr.Zero(),tr=W.Zr.Zero();class ur{constructor(){this.strength=0,this.position=W.Zr.Zero()}_processParticle(c,r){this.position.subtractToRef(c.position,Wr);const D=Wr.lengthSquared()+1;Wr.normalize().scaleToRef(this.strength/D,Br),Br.scaleToRef(r._tempScaledUpdateSpeed,tr),c.direction.addInPlace(tr)}serialize(){return{position:this.position.Ma(),strength:this.strength}}}class ar extends Rc{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=c=>{if(!this._subEmitters||0===this._subEmitters.length)return;const r=Math.floor(Math.random()*this._subEmitters.length);for(const D of this._subEmitters[r])if(1===D.type){const r=D.clone();c._inheritParticleInfoToSubEmitter(r),r.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(r.particleSystem),r.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(c,r){const D=Fc(c,r);return this.particleEmitterType=D,D}get flowMap(){return this._flowMap}set flowMap(c){this._flowMap!==c&&(this._flowMap=c,this._flowMapUpdate&&(pc(this._flowMapUpdate),this._flowMapUpdate=null),c&&(this._flowMapUpdate={process:c=>{var r;const D=null===(r=this.yc())||void 0===r?void 0:r.getTransformMatrix();this._flowMap._processParticle(c,this.flowMapStrength*this._tempScaledUpdateSpeed,D)},previousItem:null,nextItem:null},Oc(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(c){this._attractors.push(c),1===this._attractors.length&&(this._attractorUpdate={process:c=>{for(const r of this._attractors)r._processParticle(c,this)},previousItem:null,nextItem:null},Oc(this._attractorUpdate,this._directionProcessing))}removeAttractor(c){const r=this._attractors.indexOf(c);-1!==r&&this._attractors.splice(r,1),0===this._attractors.length&&pc(this._attractorUpdate)}start(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(c)}createHemisphericEmitter(){const c=Ic(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=c,c}createSphereEmitter(){const c=ic(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=c,c}createDirectedSphereEmitter(){const c=nc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new W.Zr(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new W.Zr(0,1,0));return this.particleEmitterType=c,c}createCylinderEmitter(){const c=Vc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=c,c}createDirectedCylinderEmitter(){const c=cr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new W.Zr(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new W.Zr(0,1,0));return this.particleEmitterType=c,c}createConeEmitter(){const c=rr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=c,c}createDirectedConeEmitter(){const c=Dr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new W.Zr(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new W.Zr(0,1,0));return this.particleEmitterType=c,c}createBoxEmitter(c,r,D,W){const B=new E;return this.particleEmitterType=B,this.direction1=c,this.direction2=r,this.minEmitBox=D,this.maxEmitBox=W,B}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const c of this.subEmitters)c instanceof ar?this._subEmitters.push([new Qc(c)]):c instanceof Qc?this._subEmitters.push([c]):c instanceof Array&&this._subEmitters.push(c)}_stopSubEmitters(){if(this.activeSubSystems){for(const c of this.activeSubSystems)c.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const c=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==c&&this._rootParticleSystem.activeSubSystems.splice(c,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(c){c&&this._stopSubEmitters()}_prepareParticle(c){if(this._subEmitters&&this._subEmitters.length>0){const r=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];c._attachedSubEmitters=[];for(const D of r)if(0===D.type){const r=D.clone();c._attachedSubEmitters.push(r),r.particleSystem.start()}}}_onDispose(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),c&&this.particles)for(const D of this.particles)if(D._attachedSubEmitters)for(let c=D._attachedSubEmitters.length-1;c>=0;c-=1)D._attachedSubEmitters[c].dispose();if(r&&this.activeSubSystems)for(let D=this.activeSubSystems.length-1;D>=0;D-=1)this.activeSubSystems[D].dispose();if(this._subEmitters&&this._subEmitters.length){for(let c=0;c<this._subEmitters.length;c++)for(const r of this._subEmitters[c])r.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.tr&&this.tr.dispose&&this.tr.dispose(!0)}static _Parse(c,r,D,B){let t;t=D instanceof lc.b?null:D;const H=(0,a.b)("BABYLON.Texture");if(H&&t&&(c.texture?r.particleTexture=H.Parse(c.texture,t,B):c.textureName&&(r.particleTexture=new H(B+c.textureName,t,!1,void 0===c.invertY||c.invertY),r.particleTexture.name=c.textureName)),c.emitterId||0===c.emitterId||void 0!==c.tr?c.emitterId&&t?r.tr=t.getLastMeshById(c.emitterId):r.tr=W.Zr.er(c.tr):r.tr=W.Zr.Zero(),r.isLocal=!!c.isLocal,void 0!==c.renderingGroupId&&(r.renderingGroupId=c.renderingGroupId),void 0!==c.isBillboardBased&&(r.isBillboardBased=c.isBillboardBased),void 0!==c.billboardMode&&(r.billboardMode=c.billboardMode),void 0!==c.useLogarithmicDepth&&(r.useLogarithmicDepth=c.useLogarithmicDepth),c.animations){for(let D=0;D<c.animations.length;D++){const W=c.animations[D],B=(0,a.b)("BABYLON.Animation");B&&r.animations.push(B.Parse(W))}r.beginAnimationOnStart=c.beginAnimationOnStart,r.beginAnimationFrom=c.beginAnimationFrom,r.beginAnimationTo=c.beginAnimationTo,r.beginAnimationLoop=c.beginAnimationLoop}if(c.autoAnimate&&t&&t.beginAnimation(r,c.autoAnimateFrom,c.autoAnimateTo,c.autoAnimateLoop,c.autoAnimateSpeed||1),r.startDelay=0|c.startDelay,r.minAngularSpeed=c.minAngularSpeed,r.maxAngularSpeed=c.maxAngularSpeed,r.minSize=c.minSize,r.maxSize=c.maxSize,c.minScaleX&&(r.minScaleX=c.minScaleX,r.maxScaleX=c.maxScaleX,r.minScaleY=c.minScaleY,r.maxScaleY=c.maxScaleY),void 0!==c.preWarmCycles&&(r.preWarmCycles=c.preWarmCycles,r.preWarmStepOffset=c.preWarmStepOffset),void 0!==c.minInitialRotation&&(r.minInitialRotation=c.minInitialRotation,r.maxInitialRotation=c.maxInitialRotation),r.minLifeTime=c.minLifeTime,r.maxLifeTime=c.maxLifeTime,r.minEmitPower=c.minEmitPower,r.maxEmitPower=c.maxEmitPower,r.emitRate=c.emitRate,r.gravity=W.Zr.er(c.gravity),c.noiseStrength&&(r.noiseStrength=W.Zr.er(c.noiseStrength)),r.color1=u.Xa.er(c.color1),r.color2=u.Xa.er(c.color2),r.colorDead=u.Xa.er(c.colorDead),r.updateSpeed=c.updateSpeed,r.targetStopDuration=c.targetStopDuration,r.blendMode=c.blendMode,c.colorGradients)for(const W of c.colorGradients)r.addColorGradient(W.gradient,u.Xa.er(W.color1),W.color2?u.Xa.er(W.color2):void 0);if(c.rampGradients){for(const D of c.rampGradients)r.addRampGradient(D.gradient,u.Xr.er(D.color));r.useRampGradients=c.useRampGradients}if(c.colorRemapGradients)for(const W of c.colorRemapGradients)r.addColorRemapGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2);if(c.alphaRemapGradients)for(const W of c.alphaRemapGradients)r.addAlphaRemapGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2);if(c.sizeGradients)for(const W of c.sizeGradients)r.addSizeGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2);if(c.angularSpeedGradients)for(const W of c.angularSpeedGradients)r.addAngularSpeedGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2);if(c.velocityGradients)for(const W of c.velocityGradients)r.addVelocityGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2);if(c.dragGradients)for(const W of c.dragGradients)r.addDragGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2);if(c.emitRateGradients)for(const W of c.emitRateGradients)r.addEmitRateGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2);if(c.startSizeGradients)for(const W of c.startSizeGradients)r.addStartSizeGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2);if(c.lifeTimeGradients)for(const W of c.lifeTimeGradients)r.addLifeTimeGradient(W.gradient,void 0!==W.factor1?W.factor1:W.factor,W.factor2);if(c.limitVelocityGradients){for(const D of c.limitVelocityGradients)r.addLimitVelocityGradient(D.gradient,void 0!==D.factor1?D.factor1:D.factor,D.factor2);r.limitVelocityDamping=c.limitVelocityDamping}if(c.noiseTexture&&t){const D=(0,a.b)("BABYLON.ProceduralTexture");r.noiseTexture=D.Parse(c.noiseTexture,t,B)}let x;if(c.particleEmitterType){switch(c.particleEmitterType.type){case"SphereParticleEmitter":x=new J;break;case"SphereDirectedParticleEmitter":x=new q;break;case"ConeEmitter":case"ConeParticleEmitter":x=new m;break;case"ConeDirectedParticleEmitter":x=new Y;break;case"CylinderParticleEmitter":x=new v;break;case"CylinderDirectedParticleEmitter":x=new k;break;case"HemisphericParticleEmitter":x=new w;break;case"PointParticleEmitter":x=new Z;break;case"MeshParticleEmitter":x=new e;break;case"CustomParticleEmitter":x=new j;break;default:x=new E}x.parse(c.particleEmitterType,t)}else x=new E,x.parse(c,t);r.particleEmitterType=x,r.startSpriteCellID=c.startSpriteCellID,r.endSpriteCellID=c.endSpriteCellID,r.spriteCellLoop=c.spriteCellLoop??!0,r.spriteCellWidth=c.spriteCellWidth,r.spriteCellHeight=c.spriteCellHeight,r.spriteCellChangeSpeed=c.spriteCellChangeSpeed,r.spriteRandomStartCell=c.spriteRandomStartCell,r.disposeOnStop=c.disposeOnStop??!1,r.manualEmitCount=c.manualEmitCount??-1}static Parse(c,r,D){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0;const a=c.name;let H,x,M=null,E=null;if(r instanceof lc.b?H=r:(x=r,H=x.getEngine()),c.customShader&&H.createEffectForParticles){E=c.customShader;const r=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"";M=H.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,r)}const m=new ar(a,t||c.wD,r,M,c.isAnimationSheetEnabled);if(m.customShader=E,m._rootUrl=D,c.id&&(m.id=c.id),c.subEmitters){m.subEmitters=[];for(const W of c.subEmitters){const c=[];for(const B of W)c.push(Qc.Parse(B,r,D));m.subEmitters.push(c)}}if(c.attractors)for(const u of c.attractors){const c=new ur;c.position=W.Zr.er(u.position),c.strength=u.strength,m.addAttractor(c)}return ar._Parse(c,m,r,D),c.textureMask&&(m.textureMask=u.Xa.er(c.textureMask)),c.vx&&(m.vx=W.Zr.er(c.vx)),c.preventAutoStart&&(m.preventAutoStart=c.preventAutoStart),B||m.preventAutoStart||m.start(),m}serialize(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r={};if(ar._Serialize(r,this,c),r.textureMask=this.textureMask.Ma(),r.customShader=this.customShader,r.preventAutoStart=this.preventAutoStart,r.vx=this.vx.Ma(),this.subEmitters){r.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const D of this._subEmitters){const W=[];for(const r of D)W.push(r.serialize(c));r.subEmitters.push(W)}}if(this._attractors&&this._attractors.length){r.attractors=[];for(const c of this._attractors)r.attractors.push(c.serialize())}return r}static _Serialize(c,r,D){if(c.name=r.name,c.id=r.id,c.wD=r.getCapacity(),c.disposeOnStop=r.disposeOnStop,c.manualEmitCount=r.manualEmitCount,r.tr.position){const D=r.tr;c.emitterId=D.id}else{const D=r.tr;c.tr=D.Ma()}r.particleEmitterType&&(c.particleEmitterType=r.particleEmitterType.serialize()),r.particleTexture&&(D?c.texture=r.particleTexture.serialize():(c.textureName=r.particleTexture.name,c.invertY=!!r.particleTexture._invertY)),c.isLocal=r.isLocal,h.d.AppendSerializedAnimations(r,c),c.beginAnimationOnStart=r.beginAnimationOnStart,c.beginAnimationFrom=r.beginAnimationFrom,c.beginAnimationTo=r.beginAnimationTo,c.beginAnimationLoop=r.beginAnimationLoop,c.startDelay=r.startDelay,c.renderingGroupId=r.renderingGroupId,c.isBillboardBased=r.isBillboardBased,c.billboardMode=r.billboardMode,c.minAngularSpeed=r.minAngularSpeed,c.maxAngularSpeed=r.maxAngularSpeed,c.minSize=r.minSize,c.maxSize=r.maxSize,c.minScaleX=r.minScaleX,c.maxScaleX=r.maxScaleX,c.minScaleY=r.minScaleY,c.maxScaleY=r.maxScaleY,c.minEmitPower=r.minEmitPower,c.maxEmitPower=r.maxEmitPower,c.minLifeTime=r.minLifeTime,c.maxLifeTime=r.maxLifeTime,c.emitRate=r.emitRate,c.gravity=r.gravity.Ma(),c.noiseStrength=r.noiseStrength.Ma(),c.color1=r.color1.Ma(),c.color2=r.color2.Ma(),c.colorDead=r.colorDead.Ma(),c.updateSpeed=r.updateSpeed,c.targetStopDuration=r.targetStopDuration,c.blendMode=r.blendMode,c.preWarmCycles=r.preWarmCycles,c.preWarmStepOffset=r.preWarmStepOffset,c.minInitialRotation=r.minInitialRotation,c.maxInitialRotation=r.maxInitialRotation,c.startSpriteCellID=r.startSpriteCellID,c.spriteCellLoop=r.spriteCellLoop,c.endSpriteCellID=r.endSpriteCellID,c.spriteCellChangeSpeed=r.spriteCellChangeSpeed,c.spriteCellWidth=r.spriteCellWidth,c.spriteCellHeight=r.spriteCellHeight,c.spriteRandomStartCell=r.spriteRandomStartCell,c.isAnimationSheetEnabled=r.isAnimationSheetEnabled,c.useLogarithmicDepth=r.useLogarithmicDepth;const W=r.getColorGradients();if(W){c.colorGradients=[];for(const r of W){const D={gradient:r.gradient,color1:r.color1.Ma()};r.color2?D.color2=r.color2.Ma():D.color2=r.color1.Ma(),c.colorGradients.push(D)}}const B=r.getRampGradients();if(B){c.rampGradients=[];for(const r of B){const D={gradient:r.gradient,color:r.color.Ma()};c.rampGradients.push(D)}c.useRampGradients=r.useRampGradients}const t=r.getColorRemapGradients();if(t){c.colorRemapGradients=[];for(const r of t){const D={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?D.factor2=r.factor2:D.factor2=r.factor1,c.colorRemapGradients.push(D)}}const u=r.getAlphaRemapGradients();if(u){c.alphaRemapGradients=[];for(const r of u){const D={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?D.factor2=r.factor2:D.factor2=r.factor1,c.alphaRemapGradients.push(D)}}const a=r.getSizeGradients();if(a){c.sizeGradients=[];for(const r of a){const D={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?D.factor2=r.factor2:D.factor2=r.factor1,c.sizeGradients.push(D)}}const H=r.getAngularSpeedGradients();if(H){c.angularSpeedGradients=[];for(const r of H){const D={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?D.factor2=r.factor2:D.factor2=r.factor1,c.angularSpeedGradients.push(D)}}const x=r.getVelocityGradients();if(x){c.velocityGradients=[];for(const r of x){const D={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?D.factor2=r.factor2:D.factor2=r.factor1,c.velocityGradients.push(D)}}const M=r.getDragGradients();if(M){c.dragGradients=[];for(const r of M){const D={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?D.factor2=r.factor2:D.factor2=r.factor1,c.dragGradients.push(D)}}const E=r.getEmitRateGradients();if(E){c.emitRateGradients=[];for(const r of E){const D={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?D.factor2=r.factor2:D.factor2=r.factor1,c.emitRateGradients.push(D)}}const m=r.getStartSizeGradients();if(m){c.startSizeGradients=[];for(const r of m){const D={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?D.factor2=r.factor2:D.factor2=r.factor1,c.startSizeGradients.push(D)}}const Y=r.getLifeTimeGradients();if(Y){c.lifeTimeGradients=[];for(const r of Y){const D={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?D.factor2=r.factor2:D.factor2=r.factor1,c.lifeTimeGradients.push(D)}}const v=r.getLimitVelocityGradients();if(v){c.limitVelocityGradients=[];for(const r of v){const D={gradient:r.gradient,factor1:r.factor1};void 0!==r.factor2?D.factor2=r.factor2:D.factor2=r.factor1,c.limitVelocityGradients.push(D)}c.limitVelocityDamping=r.limitVelocityDamping}r.noiseTexture&&(c.noiseTexture=r.noiseTexture.serialize())}clone(c,r){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const W={...this._customWrappers};let B=null;const t=this._engine;if(t.createEffectForParticles&&null!=this.customShader){B=this.customShader;const c=B.shaderOptions.defines.length>0?B.shaderOptions.defines.join("\n"):"",r=t.createEffectForParticles(B.shaderPath.fragmentElement,B.shaderOptions.uniforms,B.shaderOptions.samplers,c);W[0]?W[0].effect=r:this.setCustomEffect(r,0)}const u=this.serialize(D),a=ar.Parse(u,this._scene||this._engine,this._rootUrl);return a.name=c,a.customShader=B,a._customWrappers=W,void 0===r&&(r=this.tr),this.noiseTexture&&(a.noiseTexture=this.noiseTexture.clone()),a.tr=r,this.preventAutoStart||a.start(),a}}ar.BILLBOARDMODE_Y=2,ar.BILLBOARDMODE_ALL=7,ar.BILLBOARDMODE_STRETCHED=8,ar.BILLBOARDMODE_STRETCHED_LOCAL=9,Qc._ParseParticleSystem=ar.Parse;var Hr=D(11931),xr=D(11924),Mr=D(11792);Mr.b.prototype.createTransformFeedback=function(){const c=this._gl.createTransformFeedback();if(!c)throw new Error("Unable to create Transform Feedback");return c},Mr.b.prototype.deleteTransformFeedback=function(c){this._gl.deleteTransformFeedback(c)},Mr.b.prototype.bindTransformFeedback=function(c){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,c)},Mr.b.prototype.beginTransformFeedback=function(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(c?this._gl.POINTS:this._gl.TRIANGLES)},Mr.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Mr.b.prototype.setTranformFeedbackVaryings=function(c,r){this._gl.transformFeedbackVaryings(c,r,this._gl.INTERLEAVED_ATTRIBS)},Mr.b.prototype.bindTransformFeedbackBuffer=function(c){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,c?c.underlyingResource:null)},Mr.b.prototype.readTransformFeedbackBuffer=function(c){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,c)};const Er="clipPlaneFragmentDeclaration2",mr="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";U.d.IncludesShadersStore[Er]||(U.d.IncludesShadersStore[Er]=mr);D(12996),D(13e3),D(13009),D(13016),D(13018),D(13023),D(13028),D(13030);const Yr="gpuRenderParticlesPixelShader",vr="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";U.d.ShadersStore[Yr]||(U.d.ShadersStore[Yr]=vr);const kr="clipPlaneVertexDeclaration2",wr="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";U.d.IncludesShadersStore[kr]||(U.d.IncludesShadersStore[kr]=wr);D(13037),D(13040),D(13047),D(13051);const Zr="gpuRenderParticlesVertexShader",Jr="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";U.d.ShadersStore[Zr]||(U.d.ShadersStore[Zr]=Jr);class qr extends H{static get IsSupported(){if(!n.c.LastCreatedEngine)return!1;const c=n.c.LastCreatedEngine.getCaps();return c.supportTransformFeedbacks||c.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(c){this._maxActiveParticleCount=Math.min(c,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(c){this.maxActiveParticleCount=c}createPointEmitter(c,r){const D=Fc(c,r);return this.particleEmitterType=D,D}createHemisphericEmitter(){const c=Ic(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=c,c}createSphereEmitter(){const c=ic(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=c,c}createDirectedSphereEmitter(){const c=nc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new W.Zr(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new W.Zr(0,1,0));return this.particleEmitterType=c,c}createCylinderEmitter(){const c=Vc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=c,c}createDirectedCylinderEmitter(){const c=cr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new W.Zr(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new W.Zr(0,1,0));return this.particleEmitterType=c,c}createConeEmitter(){const c=rr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=c,c}createDirectedConeEmitter(){const c=Dr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new W.Zr(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new W.Zr(0,1,0));return this.particleEmitterType=c,c}createBoxEmitter(c,r,D,W){const B=new E;return this.particleEmitterType=B,this.direction1=c,this.direction2=r,this.minEmitBox=D,this.maxEmitBox=W,B}get flowMap(){return this._flowMap}set flowMap(c){this._flowMap!==c&&(this._flowMap=c)}isReady(){if(!this.tr||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==ar.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(ar.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(ar.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";c?setTimeout((()=>{this.start(0)}),c):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var c;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(c=this._customWrappers[r])||void 0===c?void 0:c.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[c]??this._customWrappers[0]}setCustomEffect(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[r]=new cc.c(this._engine),this._customWrappers[r].effect=c}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new I.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(c,r,D){return super._removeGradientAndTexture(c,r,D),this._releaseBuffers(),this}addColorGradient(c,r){this._colorGradients||(this._colorGradients=[]);const D=new o(c,r);return this._colorGradients.push(D),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(c&&this._colorGradients.sort(((c,r)=>c.gradient<r.gradient?-1:c.gradient>r.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(c){return this._removeGradientAndTexture(c,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const r in this._drawWrappers){var c;null===(c=this._drawWrappers[r].drawContext)||void 0===c||c.reset()}}_addFactorGradient(c,r,D){const W=new l(r,D);c.push(W),this._releaseBuffers()}addSizeGradient(c,r){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,c,r),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(c){return this._removeGradientAndTexture(c,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(c,r){if(!c)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&c.sort(((c,r)=>c.gradient<r.gradient?-1:c.gradient>r.gradient?1:0));const D=this;D[r]&&(D[r].dispose(),D[r]=null)}addAngularSpeedGradient(c,r){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,c,r),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(c){return this._removeGradientAndTexture(c,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(c,r){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,c,r),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(c){return this._removeGradientAndTexture(c,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(c,r){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,c,r),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(c){return this._removeGradientAndTexture(c,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(c,r){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,c,r),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(c){return this._removeGradientAndTexture(c,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(c){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(c,r,D){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(c),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Wa=new I.c,this.onStoppedObservable=new I.c,this.onStartedObservable=new I.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,D&&"Scene"!==D.getClassName()?(this._engine=D,this.defaultProjectionMatrix=W.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=D||n.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.rm.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,a.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,a.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,a.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,a.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new cc.c(this._engine)},this._customWrappers[0].effect=B,this._drawWrappers={0:new cc.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(r=r??{}).randomTextureSize||delete r.randomTextureSize;const u={wD:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...r},H=r;isFinite(H)&&(u.wD=H),this._capacity=u.wD,this._maxActiveParticleCount=u.wD,this._currentActiveCount=0,this._isAnimationSheetEnabled=t,this.particleEmitterType=new E;const x=Math.min(this._engine.getCaps().maxTextureSize,u.randomTextureSize);let M=[];for(let W=0;W<x;++W)M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),M.push(Math.random());this._randomTexture=new i.e(new Float32Array(M),x,1,5,D,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,M=[];for(let W=0;W<x;++W)M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),M.push(Math.random());this._randomTexture2=new i.e(new Float32Array(M),x,1,5,D,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=x}_reset(){this._releaseBuffers()}_createVertexBuffers(c,r,D){const W={};W.position=r.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let B=3;W.age=r.createVertexBuffer("age",B,1,this._attributesStrideSize,!0),B+=1,W.size=r.createVertexBuffer("size",B,3,this._attributesStrideSize,!0),B+=3,W.life=r.createVertexBuffer("life",B,1,this._attributesStrideSize,!0),B+=1,B+=4,this.billboardMode===ar.BILLBOARDMODE_STRETCHED&&(W.direction=r.createVertexBuffer("direction",B,3,this._attributesStrideSize,!0)),B+=3,this._platform.alignDataInBuffer&&(B+=1),this.particleEmitterType instanceof j&&(B+=3,this._platform.alignDataInBuffer&&(B+=1)),this._colorGradientsTexture||(W.color=r.createVertexBuffer("color",B,4,this._attributesStrideSize,!0),B+=4),this._isBillboardBased||(W.initialDirection=r.createVertexBuffer("initialDirection",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1)),this.noiseTexture&&(W.noiseCoordinates1=r.createVertexBuffer("noiseCoordinates1",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1),W.noiseCoordinates2=r.createVertexBuffer("noiseCoordinates2",B,3,this._attributesStrideSize,!0),B+=3,this._platform.alignDataInBuffer&&(B+=1)),W.angle=r.createVertexBuffer("angle",B,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?B++:B+=2,this._isAnimationSheetEnabled&&(W.cellIndex=r.createVertexBuffer("cellIndex",B,1,this._attributesStrideSize,!0),B+=1,this.spriteRandomStartCell&&(W.cellStartOffset=r.createVertexBuffer("cellStartOffset",B,1,this._attributesStrideSize,!0),B+=1)),W.offset=D.createVertexBuffer("offset",0,2),W.uv=D.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(W),this._platform.createVertexBuffers(c,W),this.resetDrawCache()}_initialize(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!c)return;const r=this._engine,D=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof j&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const B=this.particleEmitterType instanceof j,t=W.TmpVectors.Zr[0];let u=0;for(let W=0;W<this._capacity;W++)if(D.push(0),D.push(0),D.push(0),D.push(0),D.push(0),D.push(0),D.push(0),D.push(0),D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),B?(this.particleEmitterType.particleDestinationGenerator(W,null,t),D.push(t.x),D.push(t.y),D.push(t.z)):(D.push(0),D.push(0),D.push(0)),this._platform.alignDataInBuffer&&D.push(0),u+=16,B&&(this.particleEmitterType.particlePositionGenerator(W,null,t),D.push(t.x),D.push(t.y),D.push(t.z),this._platform.alignDataInBuffer&&D.push(0),u+=4),this._colorGradientsTexture||(D.push(0),D.push(0),D.push(0),D.push(0),u+=4),this.isBillboardBased||(D.push(0),D.push(0),D.push(0),this._platform.alignDataInBuffer&&D.push(0),u+=4),this.noiseTexture&&(D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),this._platform.alignDataInBuffer&&D.push(0),D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),this._platform.alignDataInBuffer&&D.push(0),u+=8),D.push(0),u+=1,this._angularSpeedGradientsTexture||(D.push(0),u+=1),this._isAnimationSheetEnabled&&(D.push(0),u+=1,this.spriteRandomStartCell&&(D.push(0),u+=1)),this._platform.alignDataInBuffer){let c=3-(u+3&3);for(u+=c;c-- >0;)D.push(0)}const a=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),H=this._platform.createParticleBuffer(D),x=this._platform.createParticleBuffer(D);this._buffer0=new X.b(r,H,!1,this._attributesStrideSize),this._buffer1=new X.b(r,x,!1,this._attributesStrideSize),this._spriteBuffer=new X.b(r,a,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let c=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(c+="\n#define BILLBOARD"),this._colorGradientsTexture&&(c+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(c+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(c+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(c+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(c+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(c+="\n#define DRAGGRADIENTS"),this._flowMap&&(c+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(c+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(c+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(c+="\n#define NOISE"),this.isLocal&&(c+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===c||(this._cachedUpdateDefines=c,this._updateBuffer=this._platform.createUpdateBuffer(c)),this._platform.isUpdateBufferReady()}_getWrapper(c){const r=this._getCustomDrawWrapper(c);if(null!==r&&void 0!==r&&r.effect)return r;const D=[];this.fillDefines(D,c);let W=this._drawWrappers[c];W||(W=new cc.c(this._engine),W.drawContext&&(W.drawContext.useInstancing=!0),this._drawWrappers[c]=W);const B=D.join("\n");if(W.defines!==B){const c=[],r=[],D=[];this.fillUniformsAttributesAndSamplerNames(r,c,D),W.setEffect(this._engine.createEffect("gpuRenderParticles",c,r,D,B),B)}return W}static _GetAttributeNamesOrOptions(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],W=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const B=[X.d.PositionKind,"age","life","size","angle"];return c||B.push(X.d.ColorKind),r&&B.push("cellIndex"),D||B.push("initialDirection"),W&&B.push("direction"),B.push("offset",X.d.UVKind),B}static _GetEffectCreationOptions(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const W=["emitterWM","vx","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,rc.c)(W),c&&W.push("sheetInfos"),r&&W.push("logarithmicDepthConstant"),D&&(W.push("vFogInfos"),W.push("vFogColor")),W}fillDefines(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,rc.j)(this,this._scene,c),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==xr.b.FOGMODE_NONE&&c.push("#define FOG")),r===ar.BLENDMODE_MULTIPLY&&c.push("#define BLENDMULTIPLYMODE"),this.isLocal&&c.push("#define LOCAL"),this.useLogarithmicDepth&&c.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(c.push("#define BILLBOARD"),this.billboardMode){case ar.BILLBOARDMODE_Y:c.push("#define BILLBOARDY");break;case ar.BILLBOARDMODE_STRETCHED:c.push("#define BILLBOARDSTRETCHED");break;case ar.BILLBOARDMODE_ALL:c.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&c.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&c.push("#define ANIMATESHEET"),D&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),c.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(c,r,D){r.push(...qr._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===ar.BILLBOARDMODE_STRETCHED)),c.push(...qr._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),D.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Hr.e.PrepareUniforms(c,this._imageProcessingConfigurationDefines),Hr.e.PrepareSamplers(D,this._imageProcessingConfigurationDefines))}animate(){var c;let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(r?this.preWarmStepOffset:(null===(c=this._scene)||void 0===c?void 0:c.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(c,r){const D=this[r];if(!c||!c.length||D)return;const W=new Float32Array(this._rawTextureWidth);for(let B=0;B<this._rawTextureWidth;B++){const r=B/this._rawTextureWidth;F.GetCurrentGradient(r,c,((c,r,D)=>{W[B]=(0,x.Lerp)(c.factor1,r.factor1,D)}))}this[r]=i.e.CreateRTexture(W,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[r].name=r.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const c=new Uint8Array(4*this._rawTextureWidth),r=u.TmpColors.Xa[0];for(let D=0;D<this._rawTextureWidth;D++){const W=D/this._rawTextureWidth;F.GetCurrentGradient(W,this._colorGradients,((W,B,t)=>{u.Xa.LerpToRef(W.color1,B.color1,t,r),c[4*D]=255*r.r,c[4*D+1]=255*r.g,c[4*D+2]=255*r.b,c[4*D+3]=255*r.a}))}this._colorGradientsTexture=i.e.CreateRGBATexture(c,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(c,r){var D,B,t,u;const a=this._getWrapper(c),H=a.effect;this._engine.enableEffect(a);const x=(null===(D=this._scene)||void 0===D?void 0:D.getViewMatrix())||W.Matrix.IdentityReadOnly;if(H.setMatrix("view",x),H.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),H.setTexture("diffuseSampler",this.particleTexture),H.setVector2("translationPivot",this.translationPivot),H.setVector3("vx",this.vx),this.isLocal&&H.setMatrix("emitterWM",r),this._colorGradientsTexture?H.setTexture("colorGradientSampler",this._colorGradientsTexture):H.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const c=this.particleTexture.getBaseSize();H.setFloat3("sheetInfos",this.spriteCellWidth/c.width,this.spriteCellHeight/c.height,c.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const c=this._scene.activeCamera;H.setVector3("eyePosition",c.globalPosition)}const M=H.defines;if(this._scene&&((0,rc.d)(H,this,this._scene),this.applyFog&&(0,Dc.f)(this._scene,void 0,H)),M.indexOf("#define BILLBOARDMODE_ALL")>=0){const c=x.clone();c.invert(),H.setMatrix("invView",c)}return this.useLogarithmicDepth&&this._scene&&(0,Dc.m)(M,H,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(H),this._setEngineBasedOnBlendMode(c),this._platform.bindDrawBuffers(this._targetIndex,H,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(H),null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(u=this._scene)&&void 0!==u&&u.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(c){if(!this.tr||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!c)if(this.tr.position){c=this.tr.getWorldMatrix()}else{const r=this.tr;c=W.TmpVectors.Matrix[0],W.Matrix.TranslationToRef(r.x,r.y,r.z,c)}const r=this._engine,D=r.getDepthWrite();if(r.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const c=this.yc();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",c.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",c),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const B=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=B,r.setDepthWrite(D)}render(){let c,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!r&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let c=0;c<this.preWarmCycles;c++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const c=0|this._accumulatedCount;this._accumulatedCount-=c,this._currentActiveCount+=c}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.tr.position){c=this.tr.getWorldMatrix()}else{const r=this.tr;c=W.TmpVectors.Matrix[0],W.Matrix.TranslationToRef(r.x,r.y,r.z,c)}const B=this._engine;this.updateInAnimate||this._update(c);let t=0;return r||D||(B.setState(!1),this.forceDepthWrite&&B.setDepthWrite(!0),t=this.blendMode===ar.BLENDMODE_MULTIPLYADD?this._render(ar.BLENDMODE_MULTIPLY,c)+this._render(ar.BLENDMODE_ADD,c):this._render(this.blendMode,c),this._engine.setAlphaMode(0)),t}rebuild(){const c=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(c,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,c()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const r in this._drawWrappers){this._drawWrappers[r].dispose()}if(this._drawWrappers={},this._scene){const c=this._scene.rm.indexOf(this);c>-1&&this._scene.rm.splice(c,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let r=0;r<this._renderVertexBuffers.length;++r){const c=this._renderVertexBuffers[r];for(const r in c)c[r].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),c&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),c&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Wa.notifyObservers(this),this.Wa.clear()}clone(c,r){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const W={...this._customWrappers};let B=null;const t=this._engine;if(t.createEffectForParticles&&null!=this.customShader){B=this.customShader;const c=B.shaderOptions.defines.length>0?B.shaderOptions.defines.join("\n"):"";W[0]=t.createEffectForParticles(B.shaderPath.fragmentElement,B.shaderOptions.uniforms,B.shaderOptions.samplers,c,void 0,void 0,void 0,this)}const u=this.serialize(D),a=qr.Parse(u,this._scene||this._engine,this._rootUrl);return a.name=c,a.customShader=B,a._customWrappers=W,void 0===r&&(r=this.tr),this.noiseTexture&&(a.noiseTexture=this.noiseTexture.clone()),a.tr=r,a}serialize(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r={};return ar._Serialize(r,this,c),r.activeParticleCount=this.activeParticleCount,r.randomTextureSize=this._randomTextureSize,r.customShader=this.customShader,r}static Parse(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0;const t=c.name;let u,a;r instanceof lc.b?u=r:(a=r,u=a.getEngine());const H=new qr(t,{wD:B||c.wD,randomTextureSize:c.randomTextureSize},r,null,c.isAnimationSheetEnabled);if(H._rootUrl=D,c.customShader&&u.createEffectForParticles){const r=c.customShader,D=r.shaderOptions.defines.length>0?r.shaderOptions.defines.join("\n"):"",W=u.createEffectForParticles(r.shaderPath.fragmentElement,r.shaderOptions.uniforms,r.shaderOptions.samplers,D,void 0,void 0,void 0,H);H.setCustomEffect(W,0),H.customShader=r}return c.id&&(H.id=c.id),c.activeParticleCount&&(H.activeParticleCount=c.activeParticleCount),ar._Parse(c,H,r,D),c.preventAutoStart&&(H.preventAutoStart=c.preventAutoStart),W||H.preventAutoStart||H.start(),H}}var jr=D(11487),Xr=D(13057),er=D(12055);class yr{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(c){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const r of this.systems)r.tr=c;this._emitterNode=c}setEmitterAsSphere(c,r,D){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:c,renderingGroupId:r};const W=(0,Xr.e)("emitterSphere",{diameter:c.diameter,segments:c.segments},D);W.renderingGroupId=r;const B=new er.jr("emitterSphereMaterial",D);B.emissiveColor=c.color,W.material=B;for(const t of this.systems)t.tr=W;this._emitterNode=W}start(c){for(const r of this.systems)c&&(r.tr=c),r.start()}dispose(){for(const c of this.systems)c.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r={systems:[]};for(const D of this.systems)r.systems.push(D.serialize(c));return this._emitterNode&&(r.tr=this._emitterCreationOptions),r}static Parse(c,r){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],W=arguments.length>3?arguments[3]:void 0;const B=new yr,t=this.BaseAssetsUrl+"/textures/";r=r||n.c.LastCreatedScene;for(const u of c.systems)B.systems.push(D?qr.Parse(u,r,t,!0,W):ar.Parse(u,r,t,!0,W));if(c.tr){const D=c.tr.options;if("Sphere"===c.tr.kind)B.setEmitterAsSphere({diameter:D.diameter,segments:D.segments,color:u.Xr.er(D.color)},c.tr.renderingGroupId,r)}return B}}yr.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Ur=D(11532);class Nr{static CreateDefault(c){let r,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,W=arguments.length>2?arguments[2]:void 0;r=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new qr("default system",{wD:D},W):new ar("default system",D,W),r.tr=c;const B=jr.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return r.particleTexture=new L.b(B,r.yc()),r.createConeEmitter(.1,Math.PI/4),r.color1=new u.Xa(1,1,1,1),r.color2=new u.Xa(1,1,1,1),r.colorDead=new u.Xa(1,1,1,0),r.minSize=.1,r.maxSize=.1,r.minEmitPower=2,r.maxEmitPower=2,r.updateSpeed=1/60,r.emitRate=30,r}static CreateAsync(c,r){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],W=arguments.length>3?arguments[3]:void 0;r||(r=n.c.LastCreatedScene);const B={};return r.addPendingData(B),new Promise(((t,u)=>{if(D&&!qr.IsSupported)return r.removePendingData(B),u("Particle system with GPU is not supported.");jr.Tools.LoadFile(`${Nr.BaseAssetsUrl}/systems/${c}.json`,(c=>{r.removePendingData(B);const u=JSON.parse(c.toString());return t(yr.Parse(u,r,D,W))}),void 0,void 0,void 0,(()=>(r.removePendingData(B),u(`An error occurred with the creation of your particle system. Check if your type '${c}' exists.`))))}))}static ExportSet(c){const r=new yr;for(const D of c)r.systems.push(D);return r}static ParseFromFileAsync(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",t=arguments.length>5?arguments[5]:void 0;return new Promise(((u,a)=>{const H=new Ur.d;H.addEventListener("readystatechange",(()=>{if(4==H.readyState)if(200==H.status){const r=JSON.parse(H.responseText);let a;a=W?qr.Parse(r,D,B,!1,t):ar.Parse(r,D,B,!1,t),c&&(a.name=c),u(a)}else a("Unable to load the particle system")})),H.open("GET",r),H.send()}))}static ParseFromSnippetAsync(c,r){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",B=arguments.length>4?arguments[4]:void 0;if("_BLANK"===c){const c=this.CreateDefault(null);return c.start(),Promise.resolve(c)}return new Promise(((t,u)=>{const a=new Ur.d;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const u=JSON.parse(JSON.parse(a.responseText).jsonPayload),H=JSON.parse(u.particleSystem);let x;x=D?qr.Parse(H,r,W,!1,B):ar.Parse(H,r,W,!1,B),x.snippetId=c,t(x)}else u("Unable to load the snippet "+c)})),a.open("GET",this.SnippetUrl+"/"+c.replace(/#/g,"/")),a.send()}))}}Nr.BaseAssetsUrl=yr.BaseAssetsUrl,Nr.SnippetUrl="https://snippet.babylonjs.com",Nr.CreateFromSnippetAsync=Nr.ParseFromSnippetAsync;var gr=D(12135),zr=D(11962),Sr=D(13060);(0,Sr.c)(zr.c.NAME_PARTICLESYSTEM,((c,r,D,W)=>{const B=(0,Sr.e)(zr.c.NAME_PARTICLESYSTEM);if(B&&void 0!==c.rm&&null!==c.rm)for(let t=0,u=c.rm.length;t<u;t++){const u=c.rm[t];D.rm.push(B(u,r,W))}})),(0,Sr.b)(zr.c.NAME_PARTICLESYSTEM,((c,r,D)=>{if(c.activeParticleCount){return qr.Parse(c,r,D)}return ar.Parse(c,r,D)})),lc.b.prototype.createEffectForParticles=function(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",t=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,H=arguments.length>7?arguments[7]:void 0,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,M=arguments.length>9?arguments[9]:void 0,E=[],m=[];const Y=[];return H?H.fillUniformsAttributesAndSamplerNames(m,E,Y):(E=ar._GetAttributeNamesOrOptions(),m=ar._GetEffectCreationOptions()),-1===B.indexOf(" BILLBOARD")&&(B+="\n#define BILLBOARD\n"),null!==H&&void 0!==H&&H.isAnimationSheetEnabled&&-1===B.indexOf(" ANIMATESHEET")&&(B+="\n#define ANIMATESHEET\n"),-1===W.indexOf("diffuseSampler")&&W.push("diffuseSampler"),this.createEffect({vertex:M??(null===H||void 0===H?void 0:H.vertexShaderName)??"particles",fragmentElement:c},E,m.concat(r),Y.concat(W),B,t,u,a,void 0,x,(async()=>{0===x?await Promise.resolve().then(D.bind(D,13088)):await Promise.resolve().then(D.bind(D,13157))}))},gr.e.prototype.getEmittedParticleSystems=function(){const c=[];for(let r=0;r<this.yc().rm.length;r++){const D=this.yc().rm[r];D.tr===this&&c.push(D)}return c},gr.e.prototype.getHierarchyEmittedParticleSystems=function(){const c=[],r=this.getDescendants();r.push(this);for(let D=0;D<this.yc().rm.length;D++){const W=this.yc().rm[D],B=W.tr;B.position&&-1!==r.indexOf(B)&&c.push(W)}return c};D(12028),D(12033),D(12109);D(12118),D(13062),D(11886),D(12018),D(12157);D(11877);var Kr;D(13064),D(11705);!function(c){c[c.Color=2]="Color",c[c.UV=1]="UV",c[c.Random=0]="Random",c[c.Stated=3]="Stated"}(Kr||(Kr={}));var fr=D(11907);const Ar=new W.Zr(0,0,0),hr=new W.Zr(0,0,0),Lr=new W.Zr(0,0,0);class Pr{constructor(c,r,D){this.width=c,this.height=r,this.data=D}processFlowable(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2?arguments[2]:void 0;if(!D)return;D instanceof W.Matrix?W.Zr.TransformCoordinatesToRef(c.position,D,Lr):(Lr.x=D.x,Lr.y=D.y,Lr.z=D.z);const B=.5*Lr.x+.5,t=1-(.5*Lr.y+.5),u=Math.floor(B*this.width),a=Math.floor(t*this.height);if(u<0||u>=this.width||a<0||a>=this.height)return;const H=4*(a*this.width+u),x=this.data[H]/255*2-1,M=this.data[H+1]/255*2-1,E=this.data[H+2]/255*2-1,m=this.data[H+3]/255;Ar.set(x,M,E),Ar.scaleToRef(r*m,hr),c.direction.addInPlace(hr)}_processParticle(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,D=arguments.length>2?arguments[2]:void 0;this.processFlowable(c,r,D)}static async FromUrlAsync(c){return await new Promise(((r,D)=>{const W=document.createElement("canvas"),B=W.getContext("2d");let t=null;const u=new Image;u.crossOrigin="anonymous",u.src=c,u.onerror=r=>{D(new Error(`Failed to load image: ${c} : ${r}`))},u.onload=()=>{W.width=u.width,W.height=u.height,B.drawImage(u,0,0),t=B.getImageData(0,0,W.width,W.height),r(new Pr(W.width,W.height,t.data))}}))}static async ExtractFromTextureAsync(c){return await new Promise(((r,D)=>{if(!c.isReady())return void c.onLoadObservable.addOnce((async()=>{try{const D=await this.ExtractFromTextureAsync(c);r(D)}catch(W){D(W)}}));const W=c.getSize();fr.m.GetTextureDataAsync(c,W.width,W.height).then((c=>{r(new Pr(W.width,W.height,new Uint8ClampedArray(c)))})).catch(D)}))}}var Gr,dr,Tr,br,Or,Cr,pr,Rr,sr;!function(c){c[c.Int=1]="Int",c[c.Float=2]="Float",c[c.Vector2=4]="Vector2",c[c.Zr=8]="Zr",c[c.Matrix=16]="Matrix",c[c.Particle=32]="Particle",c[c.Texture=64]="Texture",c[c.Xa=128]="Xa",c[c.FloatGradient=256]="FloatGradient",c[c.Vector2Gradient=512]="Vector2Gradient",c[c.Vector3Gradient=1024]="Vector3Gradient",c[c.Color4Gradient=2048]="Color4Gradient",c[c.System=4096]="System",c[c.AutoDetect=8192]="AutoDetect",c[c.BasedOnInput=16384]="BasedOnInput",c[c.Undefined=32768]="Undefined",c[c.All=65535]="All"}(Gr||(Gr={})),function(c){c[c.Compatible=0]="Compatible",c[c.TypeIncompatible=1]="TypeIncompatible",c[c.HierarchyIssue=2]="HierarchyIssue"}(dr||(dr={})),function(c){c[c.Input=0]="Input",c[c.Output=1]="Output"}(Tr||(Tr={}));class or{get direction(){return this._direction}get type(){if(this._type===Gr.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Gr.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(c){this._type=c}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((c=>c.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(c,r,D){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Gr.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new I.c,this.onDisconnectionObservable=new I.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=r,this.name=c,this._direction=D}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(c){var r;return this.isConnected?null!==(r=this._connectedPoint)&&void 0!==r&&r._storedFunction?this._connectedPoint._storedFunction(c):this._connectedPoint._storedValue:this.value}canConnectTo(c){return 0===this.checkCompatibilityState(c)}checkCompatibilityState(c){const r=this._ownerBlock,D=c.ownerBlock;if(this.type!==c.type&&c.innerType!==Gr.AutoDetect)return c.acceptedConnectionPointTypes&&-1!==c.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(c.excludedConnectionPointTypes&&-1!==c.excludedConnectionPointTypes.indexOf(this.type))return 1;let W=D,B=r;return 0===this.direction&&(W=r,B=D),W.isAnAncestorOf(B)?2:0}connectTo(c){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(c))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${c.ownerBlock.name}".${c.name}`;return this._endpoints.push(c),c._connectedPoint=this,this.onConnectionObservable.notifyObservers(c),c.onConnectionObservable.notifyObservers(this),this}disconnectFrom(c){const r=this._endpoints.indexOf(c);return-1===r||(this._endpoints.splice(r,1),c._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(c),c.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(c){let r=1;for(;r<Gr.All;)c&r||this.excludedConnectionPointTypes.push(r),r<<=1}serialize(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const r={};return r.name=this.name,r.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Ma?(r.valueType="BABYLON."+this.value.getClassName(),r.value=this.value.Ma()):(r.valueType="number",r.value=this.value)),c&&this.connectedPoint&&(r.inputName=this.name,r.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,r.targetConnectionName=this.connectedPoint.name,r.isExposedOnFrame=!0,r.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(r.isExposedOnFrame=!0,r.exposedPortPosition=this.exposedPortPosition),r}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Qr{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(c){this._name=c}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(c){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new I.c,this.Wa=new I.c,this.onInputChangedObservable=new I.c,this.visibleOnFrame=!1,this._name=c,this.uniqueId=P.c.UniqueId}_inputRename(c){return c}_outputRename(c){return c}isAnAncestorOf(c){for(const r of this._outputs)if(r.hasEndpoints)for(const D of r.endpoints){if(D.ownerBlock===c)return!0;if(D.ownerBlock.isAnAncestorOf(c))return!0}return!1}isAnAncestorOfType(c){if(this.getClassName()===c)return!0;for(const r of this._outputs)if(r.hasEndpoints)for(const D of r.endpoints)if(D.ownerBlock.isAnAncestorOfType(c))return!0;return!1}getInputByName(c){const r=this._inputs.filter((r=>r.name===c));return r.length?r[0]:null}_linkConnectionTypes(c,r){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[r]._acceptedConnectionPointType=this._inputs[c]:(this._inputs[c]._linkedConnectionSource=this._inputs[r],this._inputs[c]._isMainLinkSource=!0),this._inputs[r]._linkedConnectionSource=this._inputs[c]}registerInput(c,r){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],W=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0,t=arguments.length>5?arguments[5]:void 0;const u=new or(c,this,0);return u.type=r,u.isOptional=D,u.defaultValue=W,u.value=W,u.valueMin=B,u.valueMax=t,this._inputs.push(u),this.onInputChangedObservable.notifyObservers(u),this}registerOutput(c,r,D){return(D=D??new or(c,this,1)).type=r,this._outputs.push(D),this}_build(c){}_customBuildStep(c){}build(c){if(this._buildId===c.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((c=>c.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=c.buildId;for(const r of this._inputs){if(!r.connectedPoint){r.isOptional||c.notConnectedNonOptionalInputs.push(r);continue}const D=r.connectedPoint.ownerBlock;D&&D!==this&&!D.isSystem&&D.build(c)}return this._customBuildStep(c),c.verbose&&G.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(c),this.onBuildObservable.notifyObservers(this),!1}serialize(){const c={};c.customType="BABYLON."+this.getClassName(),c.id=this.uniqueId,c.name=this.name,c.visibleOnFrame=this.visibleOnFrame,c.inputs=[],c.outputs=[];for(const r of this.inputs)c.inputs.push(r.serialize());for(const r of this.outputs)c.outputs.push(r.serialize(!1));return c}_deserialize(c){this._name=c.name,this.comments=c.comments,this.visibleOnFrame=!!c.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(c)}_deserializePortDisplayNamesAndExposedOnFrame(c){const r=c.inputs,D=c.outputs;if(r)for(const W of r){const c=this.inputs.find((c=>c.name===W.name));if(!c)return;if(W.displayName&&(c.displayName=W.displayName),W.isExposedOnFrame&&(c.isExposedOnFrame=W.isExposedOnFrame,c.exposedPortPosition=W.exposedPortPosition),void 0!==W.value&&null!==W.value)if("number"===W.valueType)c.value=W.value;else{const r=(0,a.b)(W.valueType);r&&(c.value=r.er(W.value))}}if(D)for(let W=0;W<D.length;W++){const c=D[W];c.displayName&&(this.outputs[W].displayName=c.displayName),c.isExposedOnFrame&&(this.outputs[W].isExposedOnFrame=c.isExposedOnFrame,this.outputs[W].exposedPortPosition=c.exposedPortPosition)}}clone(){const c=this.serialize(),r=(0,a.b)(c.customType);if(r){const D=new r;return D._deserialize(c),D}return null}dispose(){this.Wa.notifyObservers(this),this.Wa.clear();for(const c of this.inputs)c.dispose();for(const c of this.outputs)c.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function lr(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",W=arguments.length>3?arguments[3]:void 0;return(B,t)=>{let u=B._propStore;u||(u=[],B._propStore=u),u.push({propertyName:t,displayName:c,type:r,groupName:D,options:W??{},className:B.getClassName()})}}(0,f.e)([(0,A.K)("comment")],Qr.prototype,"comments",void 0),function(c){c[c.Boolean=0]="Boolean",c[c.Float=1]="Float",c[c.Int=2]="Int",c[c.Vector2=3]="Vector2",c[c.List=4]="List",c[c.Xa=5]="Xa",c[c.SamplingMode=6]="SamplingMode",c[c.TextureFormat=7]="TextureFormat",c[c.TextureType=8]="TextureType"}(br||(br={})),function(c){c[c.None=0]="None",c[c.Position=1]="Position",c[c.Direction=2]="Direction",c[c.Age=3]="Age",c[c.Lifetime=4]="Lifetime",c[c.Color=5]="Color",c[c.ScaledDirection=6]="ScaledDirection",c[c.Scale=7]="Scale",c[c.AgeGradient=8]="AgeGradient",c[c.Angle=9]="Angle",c[c.SpriteCellIndex=16]="SpriteCellIndex",c[c.SpriteCellStart=17]="SpriteCellStart",c[c.SpriteCellEnd=18]="SpriteCellEnd"}(Or||(Or={})),function(c){c[c.None=0]="None",c[c.Time=1]="Time",c[c.Delta=2]="Delta",c[c.Emitter=3]="Emitter"}(Cr||(Cr={}));class Fr{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let c="";for(const r of this.notConnectedNonOptionalInputs)c+=`input ${r.name} from block ${r.ownerBlock.name}[${r.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(c)throw"Build of Node Particle System Set failed:\n"+c}adapt(c,r){const D=c.getConnectedValue(this)||0;if(c.type===r)return D;switch(r){case Gr.Vector2:return new W.Vector2(D,D);case Gr.Zr:return new W.Zr(D,D,D);case Gr.Xa:return new u.Xa(D,D,D,D)}return null}getContextualValue(c){if(!this.particleContext||!this.systemContext)return null;switch(c){case Or.Position:return this.particleContext.position;case Or.Direction:return this.particleContext.direction;case Or.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Or.Color:return this.particleContext.color;case Or.Age:return this.particleContext.age;case Or.Lifetime:return this.particleContext.lifeTime;case Or.Angle:return this.particleContext.angle;case Or.Scale:return this.particleContext.scale;case Or.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Or.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Or.SpriteCellIndex:return this.particleContext.cellIndex;case Or.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.tr.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.tr.absolutePosition:this.systemContext.tr:null}getSystemValue(c){if(!this.particleContext||!this.systemContext)return null;switch(c){case Cr.Time:return this.systemContext._actualFrame;case Cr.Delta:return this.systemContext._scaledUpdateSpeed;case Cr.Emitter:if(this.isEmitterTransformNode){return this.systemContext.tr.absolutePosition}return this.systemContext.tr}return null}}function Ir(c,r,D){const W=new Fr;W.qr=r;const B=c.createSystem(W);return B.canStart=()=>!0,B.tr=D.clone(),B.disposeOnStop=!0,B.start(),B}class ir extends Qr{constructor(c){super(c),this.blendMode=H.BLENDMODE_ONEONE,this.wD=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Gr.Particle),this.registerInput("texture",Gr.Texture),this.registerInput("onStart",Gr.System,!0),this.registerInput("onEnd",Gr.System,!0),this.registerOutput("system",Gr.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(c){c.wD=this.wD,c.buildId=this._buildId++,this.build(c);const r=this.particle.getConnectedValue(c);return r.particleTexture=this.texture.getConnectedValue(c),r.emitRate=this.emitRate,r.blendMode=this.blendMode,r.name=this.name,r._nodeGenerated=!0,r._targetStopDuration=this.targetStopDuration,r.startDelay=this.startDelay,this.system._storedValue=this,r.canStart=()=>!this.doNoStart,r.onStartedObservable.add((D=>{const W=this.onStart.getConnectedValue(c);W&&D.onStartedObservable.addOnce((()=>{c.systemContext=r;const D=Ir(W,c.qr,c.emitterPosition);this.Wa.addOnce((()=>{D.dispose()}))}));const B=this.onEnd.getConnectedValue(c);B&&D.onStoppedObservable.addOnce((()=>{c.systemContext=r;const D=Ir(B,c.qr,c.emitterPosition);this.Wa.addOnce((()=>{D.dispose()}))}))})),this.Wa.addOnce((()=>{r.dispose()})),r}serialize(){const c=super.serialize();return c.wD=this.wD,c.emitRate=this.emitRate,c.blendMode=this.blendMode,c.doNoStart=this.doNoStart,c.targetStopDuration=this.targetStopDuration,c.startDelay=this.startDelay,c}_deserialize(c){super._deserialize(c),this.wD=c.wD,this.emitRate=c.emitRate,this.doNoStart=!!c.doNoStart,void 0!==c.blendMode&&(this.blendMode=c.blendMode),void 0!==c.targetStopDuration&&(this.targetStopDuration=c.targetStopDuration),void 0!==c.startDelay&&(this.startDelay=c.startDelay)}}(0,f.e)([lr("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:H.BLENDMODE_ONEONE},{label:"Standard",value:H.BLENDMODE_STANDARD},{label:"Add",value:H.BLENDMODE_ADD},{label:"Multiply",value:H.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:H.BLENDMODE_MULTIPLYADD}]})],ir.prototype,"blendMode",void 0),(0,f.e)([lr("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],ir.prototype,"wD",void 0),(0,f.e)([lr("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ir.prototype,"emitRate",void 0),(0,f.e)([lr("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ir.prototype,"targetStopDuration",void 0),(0,f.e)([lr("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ir.prototype,"startDelay",void 0),(0,f.e)([lr("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ir.prototype,"doNoStart",void 0),(0,a.e)("BABYLON.SystemBlock",ir);class nr extends Qr{get type(){if(this._type===Gr.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Gr.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Gr.Vector2,this._type;case"Zr":return this._type=Gr.Zr,this._type;case"Xa":return this._type=Gr.Xa,this._type;case"Matrix":return this._type=Gr.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Or.None&&this._systemSource!==Cr.None}get systemSource(){return this._systemSource}set systemSource(c){if(this._systemSource=c,c!==Cr.None){switch(this._contextualSource=Or.None,this._type=Gr.Float,c){case Cr.Time:case Cr.Delta:this._type=Gr.Float;break;case Cr.Emitter:this._type=Gr.Zr}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Or.None}get contextualValue(){return this._contextualSource}set contextualValue(c){if(this._contextualSource=c,c!==Or.None){switch(this._systemSource=Cr.None,c){case Or.Scale:this._type=Gr.Vector2;break;case Or.Position:case Or.Direction:case Or.ScaledDirection:this._type=Gr.Zr;break;case Or.Color:this._type=Gr.Xa;break;case Or.Age:case Or.Lifetime:case Or.Angle:case Or.AgeGradient:this._type=Gr.Float;break;case Or.SpriteCellEnd:case Or.SpriteCellStart:case Or.SpriteCellIndex:this._type=Gr.Int}this.output&&(this.output.type=this._type)}}constructor(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Gr.AutoDetect;super(c),this._type=Gr.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new I.c,this._systemSource=Cr.None,this._contextualSource=Or.None,this._type=r,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",r)}get value(){return this._storedValue}set value(c){this.type===Gr.Float&&this.min!==this.max&&(c=Math.max(this.min,c),c=Math.min(this.max,c)),this._storedValue=c,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(c){this._valueCallback=c}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Gr.Int:case Gr.Float:this.value=0;break;case Gr.Vector2:this.value=W.Vector2.Zero();break;case Gr.Zr:this.value=W.Zr.Zero();break;case Gr.Xa:this.value=new u.Xa(1,1,1,1);break;case Gr.Matrix:this.value=W.Matrix.Identity()}}_build(c){super._build(c),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=c=>c.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=c=>c.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const c=super.serialize();return c.type=this.type,c.contextualValue=this.contextualValue,c.systemSource=this.systemSource,c.min=this.min,c.max=this.max,c.groupInInspector=this.groupInInspector,c.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Ma?(c.valueType="BABYLON."+this._storedValue.getClassName(),c.value=this._storedValue.Ma()):(c.valueType="number",c.value=this._storedValue)),c}_deserialize(c){if(super._deserialize(c),this._type=c.type,this.contextualValue=c.contextualValue,this.systemSource=c.systemSource||Cr.None,this.min=c.min||0,this.max=c.max||0,this.groupInInspector=c.groupInInspector||"",void 0!==c.displayInInspector&&(this.displayInInspector=c.displayInInspector),c.valueType)if("number"===c.valueType)this._storedValue=c.value;else{const r=(0,a.b)(c.valueType);r&&(this._storedValue=r.er(c.value))}}}(0,a.e)("BABYLON.ParticleInputBlock",nr);class Vr extends Qr{get url(){return this._url}set url(c){this._url!==c&&(this._cachedData=null,this._url=c,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(c){this._textureDataUrl!==c&&(this._cachedData=null,this._textureDataUrl=c,this._url="",this._sourceTexture=null)}set sourceTexture(c){this._sourceTexture!==c&&(this._cachedData=null,this._sourceTexture=c,this._url="",this._textureDataUrl="")}constructor(c){super(c),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Gr.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const c=this.texture._storedValue;return await new Promise(((r,D)=>{if(!c.isReady())return void c.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),r(this._cachedData)}catch(c){D(c)}}));const W=c.getSize();fr.m.GetTextureDataAsync(c,W.width,W.height).then((D=>{this._cachedData={width:W.width,height:W.height,data:new Uint8ClampedArray(D)},c.dispose(),r(this._cachedData)})).catch(D)}))}_build(c){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new L.b(this._textureDataUrl,c.qr):this.texture._storedValue=new L.b(this._url,c.qr):this.texture._storedValue=null}serialize(){const c=super.serialize();return c.url=this.url,c.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(c.textureDataUrl=this.textureDataUrl),c}_deserialize(c){super._deserialize(c),this.url=c.url,this.serializedCachedData=!!c.serializedCachedData,c.textureDataUrl&&(this.textureDataUrl=c.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,a.e)("BABYLON.ParticleTextureSourceBlock",Vr);class cD extends Qr{constructor(c){super(c),this.registerInput("particle",Gr.Particle),this.registerInput("position",Gr.Zr),this.registerOutput("output",Gr.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(c){const r=this.particle.getConnectedValue(c);if(this.output._storedValue=r,!this.position.isConnected)return;const D={process:D=>{c.particleContext=D,c.systemContext=r,D.position.t(this.position.getConnectedValue(c))},previousItem:null,nextItem:null};r._updateQueueStart?Cc(D,r._updateQueueStart):r._updateQueueStart=D}}(0,a.e)("BABYLON.UpdatePositionBlock",cD),function(c){c[c.Add=0]="Add",c[c.Subtract=1]="Subtract",c[c.Multiply=2]="Multiply",c[c.Divide=3]="Divide",c[c.Max=4]="Max",c[c.Min=5]="Min"}(pr||(pr={}));class rD extends Qr{constructor(c){super(c),this.operation=pr.Add,this.registerInput("left",Gr.AutoDetect),this.registerInput("right",Gr.AutoDetect),this.registerOutput("output",Gr.BasedOnInput),this.output._typeConnectionSource=this.left;const r=[Gr.Matrix,Gr.Particle,Gr.Texture,Gr.System,Gr.FloatGradient,Gr.Color4Gradient,Gr.Vector2Gradient,Gr.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...r),this.right.excludedConnectionPointTypes.push(...r),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(c){let r;const D=this.left,B=this.right;if(!D.isConnected||!B.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const t=D.type===Gr.Float||D.type===Gr.Int,a=B.type===Gr.Float||B.type===Gr.Int,H=t&&a;switch(this.operation){case pr.Add:r=H?c=>D.getConnectedValue(c)+B.getConnectedValue(c):t?c=>c.adapt(D,B.type).add(B.getConnectedValue(c)):c=>D.getConnectedValue(c).add(c.adapt(B,D.type));break;case pr.Subtract:r=H?c=>D.getConnectedValue(c)-B.getConnectedValue(c):t?c=>c.adapt(D,B.type).Jr(B.getConnectedValue(c)):c=>D.getConnectedValue(c).Jr(c.adapt(B,D.type));break;case pr.Multiply:r=H?c=>D.getConnectedValue(c)*B.getConnectedValue(c):t?c=>c.adapt(D,B.type).multiply(B.getConnectedValue(c)):c=>D.getConnectedValue(c).multiply(c.adapt(B,D.type));break;case pr.Divide:r=H?c=>D.getConnectedValue(c)/B.getConnectedValue(c):t?c=>c.adapt(D,B.type).divide(B.getConnectedValue(c)):c=>D.getConnectedValue(c).divide(c.adapt(B,D.type));break;case pr.Min:if(H)r=c=>Math.min(D.getConnectedValue(c),B.getConnectedValue(c));else{const[c,a]=t?[B,D]:[D,B];switch(c.type){case Gr.Vector2:r=r=>W.Vector2.Minimize(c.getConnectedValue(r),r.adapt(a,c.type));break;case Gr.Zr:r=r=>W.Zr.Minimize(c.getConnectedValue(r),r.adapt(a,c.type));break;case Gr.Xa:r=r=>{const D=c.getConnectedValue(r),{r:W,g:B,b:t,a:H}=r.adapt(a,c.type);return new u.Xa(Math.min(D.r,W),Math.min(D.g,B),Math.min(D.b,t),Math.min(D.a,H))}}}break;case pr.Max:if(!H){const[c,a]=t?[B,D]:[D,B];switch(c.type){case Gr.Vector2:r=r=>W.Vector2.Maximize(c.getConnectedValue(r),r.adapt(a,c.type));break;case Gr.Zr:r=r=>W.Zr.Maximize(c.getConnectedValue(r),r.adapt(a,c.type));break;case Gr.Xa:r=r=>{const D=c.getConnectedValue(r),{r:W,g:B,b:t,a:H}=r.adapt(a,c.type);return new u.Xa(Math.max(D.r,W),Math.min(D.g,B),Math.min(D.b,t),Math.min(D.a,H))}}break}r=c=>Math.max(D.getConnectedValue(c),B.getConnectedValue(c))}this.output._storedFunction=c=>D.type===Gr.Int?0|r(c):r(c)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Gr.Int||this.left.type===Gr.Float&&this.right.type!==Gr.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[c,r]of[[this.left,this.right],[this.right,this.left]])c.acceptedConnectionPointTypes=[Gr.Int,Gr.Float],r.isConnected&&(c.acceptedConnectionPointTypes.push(r.type),r.type!==Gr.Int&&r.type!==Gr.Float||c.acceptedConnectionPointTypes.push(Gr.Vector2,Gr.Zr,Gr.Xa))}dispose(){super.dispose();for(const c of this._connectionObservers)c.remove();this._connectionObservers.length=0}serialize(){const c=super.serialize();return c.operation=this.operation,c}_deserialize(c){super._deserialize(c),this.operation=c.operation}}(0,f.e)([lr("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:pr.Add},{label:"Subtract",value:pr.Subtract},{label:"Multiply",value:pr.Multiply},{label:"Divide",value:pr.Divide},{label:"Max",value:pr.Max},{label:"Min",value:pr.Min}]})],rD.prototype,"operation",void 0),(0,a.e)("BABYLON.ParticleMathBlock",rD);class DD extends Qr{constructor(c){super(c),this.registerInput("particle",Gr.Particle),this.registerInput("direction1",Gr.Zr,!0,new W.Zr(0,1,0)),this.registerInput("direction2",Gr.Zr,!0,new W.Zr(0,1,0)),this.registerInput("minEmitBox",Gr.Zr,!0,new W.Zr(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Gr.Zr,!0,new W.Zr(.5,.5,.5)),this.registerOutput("output",Gr.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(c){const r=this.particle.getConnectedValue(c);r._directionCreation.process=D=>{c.particleContext=D,c.systemContext=r;const B=this.direction1.getConnectedValue(c),t=this.direction2.getConnectedValue(c),u=(0,x.RandomRange)(B.x,t.x),a=(0,x.RandomRange)(B.y,t.y),H=(0,x.RandomRange)(B.z,t.z);c.isEmitterTransformNode?W.Zr.TransformNormalFromFloatsToRef(u,a,H,c.emitterWorldMatrix,D.direction):D.direction.Ja(u,a,H)},r._positionCreation.process=D=>{c.particleContext=D,c.systemContext=r;const B=this.minEmitBox.getConnectedValue(c),t=this.maxEmitBox.getConnectedValue(c),u=(0,x.RandomRange)(B.x,t.x),a=(0,x.RandomRange)(B.y,t.y),H=(0,x.RandomRange)(B.z,t.z);c.isEmitterTransformNode?W.Zr.TransformCoordinatesFromFloatsToRef(u,a,H,c.emitterWorldMatrix,D.position):(D.position.Ja(u,a,H),D.position.addInPlace(c.emitterPosition))},this.output._storedValue=r}}(0,a.e)("BABYLON.BoxShapeBlock",DD);class WD extends Qr{constructor(c){super(c),this.registerInput("emitPower",Gr.Float,!0,1),this.registerInput("lifeTime",Gr.Float,!0,1),this.registerInput("color",Gr.Xa,!0,new u.Xa(1,1,1,1)),this.registerInput("scale",Gr.Vector2,!0,new W.Vector2(1,1)),this.registerInput("angle",Gr.Float,!0,0),this.registerOutput("particle",Gr.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(c){const r=new ar(this.name,c.wD,c.qr,null,!1,void 0,!0);r.particleEmitterType=new Z,r._lifeTimeCreation.process=(r,D)=>{c.particleContext=r,r.lifeTime=this.lifeTime.getConnectedValue(c),D._emitPower=this.emitPower.getConnectedValue(c)},r._colorCreation.process=r=>{c.particleContext=r,r.color.t(this.color.getConnectedValue(c))},r._sizeCreation.process=r=>{c.particleContext=r,r.size=1,r.scale.t(this.scale.getConnectedValue(c))},r._angleCreation.process=r=>{c.particleContext=r,r.angle=this.angle.getConnectedValue(c)},this.particle._storedValue=r}}(0,a.e)("BABYLON.CreateParticleBlock",WD);class BD{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const c=[];for(const r of this.attachedBlocks)r.isInput&&c.push(r);return c}constructor(c){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new I.c,this.name=c}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(c){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(c)&&this.attachedBlocks.push(c);for(const D of c.inputs){const W=D.connectedPoint;if(W){const D=W.ownerBlock;D!==c&&this._initializeBlock(D,r)}}}async buildAsync(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((D=>{const W=new yr;for(const c of this._systemBlocks)this._initializeBlock(c);for(const B of this.systemBlocks){const D=new Fr;D.buildId=this._buildId++,D.qr=c,D.verbose=r;const t=B.createSystem(D);D.emitErrors(),W.systems.push(t)}this.onBuildObservable.notifyObservers(this),D(W)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const c=new ir("Particle system"),r=new cD("Update position");r.output.connectTo(c.particle);const D=new nr("Position");D.contextualValue=Or.Position;const W=new nr("Scaled direction");W.contextualValue=Or.ScaledDirection;const B=new rD("Add");B.operation=pr.Add,D.output.connectTo(B.left),W.output.connectTo(B.right),B.output.connectTo(r.position);const t=new WD("Create particle"),u=new DD("Box shape");t.particle.connectTo(u.particle),u.output.connectTo(r.particle);const a=new Vr("Texture");a.texture.connectTo(c.texture),a.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(c)}removeBlock(c){const r=this.attachedBlocks.indexOf(c);if(r>-1&&this.attachedBlocks.splice(r,1),c.isSystem){const r=this._systemBlocks.indexOf(c);r>-1&&this._systemBlocks.splice(r,1)}}parseSerializedObject(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r||this.clear();const D={};for(const W of c.qM){const c=(0,a.b)(W.customType);if(c){const r=new c;r._deserialize(W),D[W.id]=r,this.attachedBlocks.push(r),r.isSystem&&this._systemBlocks.push(r)}}for(const W of this.attachedBlocks)if(W.isTeleportOut){const c=W,r=c._tempEntryPointUniqueId;if(r){const W=D[r];W&&W.attachToEndpoint(c)}}for(let W=0;W<c.qM.length;W++){const B=c.qM[W],t=D[B.id];t&&(t.inputs.length&&B.inputs.some((c=>c.targetConnectionName))&&!r||this._restoreConnections(t,c,D))}if(c.locations||c.editorData&&c.editorData.locations){const W=c.locations||c.editorData.locations;for(const c of W)D[c.AB]&&(c.AB=D[c.AB].uniqueId);r&&this.editorData&&this.editorData.locations&&W.concat(this.editorData.locations),c.locations?this.editorData={locations:W}:(this.editorData=c.editorData,this.editorData.locations=W);const B=[];for(const c in D)B[c]=D[c].uniqueId;this.editorData.map=B}this.comment=c.comment}_restoreConnections(c,r,D){for(const W of c.outputs)for(const B of r.qM){const t=D[B.id];if(t)for(const u of B.inputs)if(D[u.targetBlockId]!==c||u.targetConnectionName!==W.name);else{const c=t.getInputByName(u.inputName);if(!c||c.isConnected)continue;W.connectTo(c,!0),this._restoreConnections(t,r,D)}}}serialize(c){const r=c?{}:h.d.Serialize(this);r.editorData=JSON.parse(JSON.stringify(this.editorData));let D=[];c?D=c:r.customType="BABYLON.NodeParticleSystemSet",r.qM=[];for(const W of D)r.qM.push(W.serialize());if(!c)for(const W of this.attachedBlocks)-1===D.indexOf(W)&&r.qM.push(W.serialize());return r}dispose(){for(const c of this.attachedBlocks)c.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(c){const r=new BD(c);return r.setToDefault(),r}static Parse(c){const r=h.d.Parse((()=>new BD(c.name)),c,null);return r.parseSerializedObject(c),r}static ParseFromSnippetAsync(c,r){return"_BLANK"===c?Promise.resolve(BD.CreateDefault("blank")):new Promise(((D,W)=>{const B=new Ur.d;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const u=JSON.parse(JSON.parse(B.responseText).jsonPayload),a=JSON.parse(u.nodeParticle);r||(r=h.d.Parse((()=>new BD(c)),a,null)),r.parseSerializedObject(a),r.snippetId=c;try{D(r)}catch(t){W(t)}}else W("Unable to load the snippet "+c)})),B.open("GET",this.SnippetUrl+"/"+c.replace(/#/g,"/")),B.send()}))}}BD.EditorURL=`${jr.Tools._DefaultCdnUrl}/v${lc.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,BD.SnippetUrl="https://snippet.babylonjs.com",(0,f.e)([(0,A.K)()],BD.prototype,"name",void 0),(0,f.e)([(0,A.K)("comment")],BD.prototype,"comment",void 0),function(c){c[c.None=0]="None",c[c.PerParticle=1]="PerParticle",c[c.PerSystem=2]="PerSystem"}(Rr||(Rr={}));class tD extends Qr{constructor(c){super(c),this._currentLockId=-2,this.lockMode=Rr.PerParticle,this.registerInput("min",Gr.AutoDetect,!0,0),this.registerInput("max",Gr.AutoDetect,!0,1),this.registerOutput("output",Gr.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Gr.Float|Gr.Int|Gr.Vector2|Gr.Zr|Gr.Xa),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Gr.Float|Gr.Int|Gr.Vector2|Gr.Zr|Gr.Xa),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Gr.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let c=null;switch(this._currentLockId=-2,this.min.type){case Gr.AutoDetect:case Gr.Int:case Gr.Float:c=c=>{const r=this.min.getConnectedValue(c)||0,D=this.max.getConnectedValue(c)||1;return r+Math.random()*(D-r)};break;case Gr.Vector2:c=c=>{const r=this.min.getConnectedValue(c)||W.Vector2.Zero(),D=this.max.getConnectedValue(c)||W.Vector2.One();return new W.Vector2(r.x+Math.random()*(D.x-r.x),r.y+Math.random()*(D.y-r.y))};break;case Gr.Zr:c=c=>{const r=this.min.getConnectedValue(c)||W.Zr.Zero(),D=this.max.getConnectedValue(c)||W.Zr.One();return new W.Zr(r.x+Math.random()*(D.x-r.x),r.y+Math.random()*(D.y-r.y),r.z+Math.random()*(D.z-r.z))};break;case Gr.Xa:c=c=>{const r=this.min.getConnectedValue(c)||new u.Xa(0,0,0,0),D=this.max.getConnectedValue(c)||new u.Xa(1,1,1,1);return new u.Xa(r.x+Math.random()*(D.x-r.x),r.y+Math.random()*(D.y-r.y),r.z+Math.random()*(D.z-r.z),r.w+Math.random()*(D.w-r.w))}}this.output._storedFunction=r=>{var D;let W=0;switch(this.lockMode){case Rr.PerParticle:W=(null===(D=r.particleContext)||void 0===D?void 0:D.id)||-1;break;case Rr.PerSystem:W=r.buildId||0}return this._currentLockId!==W&&(this.lockMode!==Rr.None&&(this._currentLockId=W),this.output._storedValue=c(r)),this.output._storedValue}}serialize(){const c=super.serialize();return c.lockMode=this.lockMode,c}_deserialize(c){super._deserialize(c),this.lockMode=c.lockMode}}(0,f.e)([lr("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Rr.None},{label:"Per particle",value:Rr.PerParticle},{label:"Per system",value:Rr.PerSystem}]})],tD.prototype,"lockMode",void 0),(0,a.e)("BABYLON.ParticleRandomBlock",tD);class uD extends Qr{constructor(c){super(c),this._currentLockId=-2,this.lockMode=Rr.PerParticle,this.registerInput("min",Gr.AutoDetect),this.registerInput("max",Gr.AutoDetect),this.registerOutput("output",Gr.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const r=[Gr.Matrix,Gr.Particle,Gr.Texture,Gr.System,Gr.FloatGradient,Gr.Color4Gradient,Gr.Vector2Gradient,Gr.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...r),this.max.excludedConnectionPointTypes.push(...r)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let c=null;switch(this._currentLockId=-2,this.min.type){case Gr.Float:case Gr.Int:c=c=>{const r=this.min.getConnectedValue(c),D=this.max.getConnectedValue(c);return Math.random()*(D-r)+r};break;case Gr.Vector2:c=c=>{const r=this.min.getConnectedValue(c),D=this.max.getConnectedValue(c);return new W.Vector2(Math.random()*(D.x-r.x)+r.x,Math.random()*(D.y-r.y)+r.y)};break;case Gr.Zr:c=c=>{const r=this.min.getConnectedValue(c),D=this.max.getConnectedValue(c);return new W.Zr(Math.random()*(D.x-r.x)+r.x,Math.random()*(D.y-r.y)+r.y,Math.random()*(D.z-r.z)+r.z)};break;case Gr.Xa:c=c=>{const r=this.min.getConnectedValue(c),D=this.max.getConnectedValue(c);return new u.Xa(Math.random()*(D.r-r.r)+r.r,Math.random()*(D.g-r.g)+r.g,Math.random()*(D.b-r.b)+r.b,Math.random()*(D.a-r.a)+r.a)}}this.output._storedFunction=r=>{var D;let W=0;switch(this.lockMode){case Rr.PerParticle:W=(null===(D=r.particleContext)||void 0===D?void 0:D.id)||-1;break;case Rr.PerSystem:W=r.buildId||0}return this._currentLockId!==W&&(this.lockMode!==Rr.None&&(this._currentLockId=W),this.output._storedValue=c(r)),this.output._storedValue}}serialize(){const c=super.serialize();return c.lockMode=this.lockMode,c}_deserialize(c){super._deserialize(c),void 0!==c.lockMode&&(this.lockMode=c.lockMode)}}(0,f.e)([lr("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Rr.None},{label:"Per particle",value:Rr.PerParticle},{label:"Per system",value:Rr.PerSystem}]})],uD.prototype,"lockMode",void 0),(0,a.e)("BABYLON.RandomRangeBlock",uD);(0,a.e)("BABYLON.ParticleLerpBlock",class extends Qr{constructor(c){super(c),this.registerInput("left",Gr.AutoDetect),this.registerInput("right",Gr.AutoDetect),this.registerInput("gradient",Gr.Float,!0,0,0,1),this.registerOutput("output",Gr.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Gr.Float|Gr.Int|Gr.Vector2|Gr.Zr|Gr.Xa)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const c=(c,r,D)=>(1-c)*r+c*D;this.output._storedFunction=r=>{const D=this.left.getConnectedValue(r),B=this.right.getConnectedValue(r),t=this.gradient.getConnectedValue(r);switch(this.left.type){case Gr.Int:case Gr.Float:return c(t,D,B);case Gr.Vector2:return new W.Vector2(c(t,D.x,B.x),c(t,D.y,B.y));case Gr.Zr:return new W.Zr(c(t,D.x,B.x),c(t,D.y,B.y),c(t,D.z,B.z));case Gr.Xa:return new u.Xa(c(t,D.r,B.r),c(t,D.g,B.g),c(t,D.b,B.b),c(t,D.a,B.a))}return 0}}});(0,a.e)("BABYLON.UpdateDirectionBlock",class extends Qr{constructor(c){super(c),this.registerInput("particle",Gr.Particle),this.registerInput("direction",Gr.Zr),this.registerOutput("output",Gr.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(c){const r=this.particle.getConnectedValue(c);if(this.output._storedValue=r,!this.direction.isConnected)return;const D={process:D=>{c.particleContext=D,c.systemContext=r,D.direction.t(this.direction.getConnectedValue(c))},previousItem:null,nextItem:null};r._updateQueueStart?Cc(D,r._updateQueueStart):r._updateQueueStart=D}});(0,a.e)("BABYLON.UpdateColorBlock",class extends Qr{constructor(c){super(c),this.registerInput("particle",Gr.Particle),this.registerInput("color",Gr.Xa),this.registerOutput("output",Gr.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(c){const r=this.particle.getConnectedValue(c);if(this.output._storedValue=r,!this.color.isConnected)return;const D={process:D=>{c.particleContext=D,c.systemContext=r,D.color.t(this.color.getConnectedValue(c))},previousItem:null,nextItem:null};r._updateQueueStart?Cc(D,r._updateQueueStart):r._updateQueueStart=D}});(0,a.e)("BABYLON.UpdateScaleBlock",class extends Qr{constructor(c){super(c),this.registerInput("particle",Gr.Particle),this.registerInput("scale",Gr.Vector2),this.registerOutput("output",Gr.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(c){const r=this.particle.getConnectedValue(c);if(this.output._storedValue=r,!this.scale.isConnected)return;const D={process:D=>{c.particleContext=D,c.systemContext=r,D.scale.t(this.scale.getConnectedValue(c))},previousItem:null,nextItem:null};r._updateQueueStart?Cc(D,r._updateQueueStart):r._updateQueueStart=D}});(0,a.e)("BABYLON.UpdateAngleBlock",class extends Qr{constructor(c){super(c),this.registerInput("particle",Gr.Particle),this.registerInput("angle",Gr.Float),this.registerOutput("output",Gr.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(c){const r=this.particle.getConnectedValue(c);if(this.output._storedValue=r,!this.angle.isConnected)return;const D={process:D=>{c.particleContext=D,c.systemContext=r,D.angle=this.angle.getConnectedValue(c)},previousItem:null,nextItem:null};r._updateQueueStart?Cc(D,r._updateQueueStart):r._updateQueueStart=D}});(0,a.e)("BABYLON.BasicPositionUpdateBlock",class extends Qr{constructor(c){super(c),this.registerInput("particle",Gr.Particle),this.registerOutput("output",Gr.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(c){const r=this.particle.getConnectedValue(c),D={process:D=>{c.particleContext=D,c.systemContext=r,D.direction.scaleToRef(r._directionScale,r._scaledDirection),D.position.addInPlace(r._scaledDirection)},previousItem:null,nextItem:null};r._updateQueueStart?Cc(D,r._updateQueueStart):r._updateQueueStart=D,this.output._storedValue=r}});(0,a.e)("BABYLON.BasicSpriteUpdateBlock",class extends Qr{constructor(c){super(c),this.registerInput("particle",Gr.Particle),this.registerOutput("output",Gr.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(c){const r=this.particle.getConnectedValue(c),D={process:D=>{c.particleContext=D,c.systemContext=r,D.updateCellIndex()},previousItem:null,nextItem:null};r._updateQueueStart?Cc(D,r._updateQueueStart):r._updateQueueStart=D,this.output._storedValue=r}});(0,a.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends Qr{constructor(c){super(c),this.registerInput("particle",Gr.Particle),this.registerInput("cellIndex",Gr.Int),this.registerOutput("output",Gr.Particle),this.cellIndex.acceptedConnectionPointTypes=[Gr.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(c){const r=this.particle.getConnectedValue(c);if(this.output._storedValue=r,!this.cellIndex.isConnected)return;const D={process:D=>{c.particleContext=D,c.systemContext=r,D.cellIndex=Math.floor(this.cellIndex.getConnectedValue(c))},previousItem:null,nextItem:null};r._updateQueueStart?Cc(D,r._updateQueueStart):r._updateQueueStart=D}});class aD extends Qr{constructor(c){super(c),this.strength=1,this.registerInput("particle",Gr.Particle),this.registerInput("flowMap",Gr.Texture),this.registerOutput("output",Gr.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(c){var r;const D=this.particle.getConnectedValue(c),W=c.qr;let B;(null===(r=this.flowMap.connectedPoint)||void 0===r?void 0:r.ownerBlock).extractTextureContentAsync().then((c=>{c&&(B=new Pr(c.width,c.height,c.data))}));const t={process:c=>{const r=W.getTransformMatrix();B&&B._processParticle(c,this.strength*D._tempScaledUpdateSpeed,r)},previousItem:null,nextItem:null};D._updateQueueStart?Cc(t,D._updateQueueStart):D._updateQueueStart=t,this.output._storedValue=D}serialize(){const c=super.serialize();return c.strength=this.strength,c}_deserialize(c){super._deserialize(c),this.strength=c.strength}}(0,f.e)([lr("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aD.prototype,"strength",void 0),(0,a.e)("BABYLON.UpdateFlowMapBlock",aD);(0,a.e)("BABYLON.SphereShapeBlock",class extends Qr{constructor(c){super(c),this.registerInput("input",Gr.Particle),this.registerInput("radius",Gr.Float,!0,1),this.registerInput("radiusRange",Gr.Float,!0,1,0,1),this.registerInput("directionRandomizer",Gr.Float,!0,0,0,1),this.registerOutput("output",Gr.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(c){const r=this.input.getConnectedValue(c);r._directionCreation.process=D=>{c.particleContext=D,c.systemContext=r;const B=this.directionRandomizer.getConnectedValue(c),t=D.position.Jr(c.emitterPosition).normalize(),u=(0,x.RandomRange)(0,B),a=(0,x.RandomRange)(0,B),H=(0,x.RandomRange)(0,B);t.x+=u,t.y+=a,t.z+=H,t.normalize(),c.isEmitterTransformNode?W.Zr.TransformNormalFromFloatsToRef(u,a,H,c.emitterWorldMatrix,D.direction):D.direction.Ja(u,a,H)},r._positionCreation.process=D=>{c.particleContext=D,c.systemContext=r;const B=this.radius.getConnectedValue(c),t=this.radiusRange.getConnectedValue(c),u=B-(0,x.RandomRange)(0,B*t),a=(0,x.RandomRange)(0,1),H=(0,x.RandomRange)(0,2*Math.PI),M=Math.acos(2*a-1),E=u*Math.cos(H)*Math.sin(M),m=u*Math.cos(M),Y=u*Math.sin(H)*Math.sin(M);c.isEmitterTransformNode?W.Zr.TransformCoordinatesFromFloatsToRef(E,m,Y,c.emitterWorldMatrix,D.position):(D.position.Ja(E,m,Y),D.position.addInPlace(c.emitterPosition))},this.output._storedValue=r}});(0,a.e)("BABYLON.PointShapeBlock",class extends Qr{constructor(c){super(c),this.registerInput("particle",Gr.Particle),this.registerInput("direction1",Gr.Zr,!0,new W.Zr(0,1,0)),this.registerInput("direction2",Gr.Zr,!0,new W.Zr(0,1,0)),this.registerOutput("output",Gr.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(c){const r=this.particle.getConnectedValue(c);r._directionCreation.process=D=>{c.particleContext=D,c.systemContext=r;const B=this.direction1.getConnectedValue(c),t=this.direction2.getConnectedValue(c),u=(0,x.RandomRange)(B.x,t.x),a=(0,x.RandomRange)(B.y,t.y),H=(0,x.RandomRange)(B.z,t.z);c.isEmitterTransformNode?W.Zr.TransformNormalFromFloatsToRef(u,a,H,c.emitterWorldMatrix,D.direction):D.direction.Ja(u,a,H)},r._positionCreation.process=D=>{c.systemContext=r,c.isEmitterTransformNode?W.Zr.TransformCoordinatesFromFloatsToRef(0,0,0,c.emitterWorldMatrix,D.position):D.position.t(c.emitterPosition)},this.output._storedValue=r}});(0,a.e)("BABYLON.CustomShapeBlock",class extends Qr{constructor(c){super(c),this.registerInput("particle",Gr.Particle),this.registerInput("position",Gr.Zr,!0,new W.Zr(0,0,0)),this.registerInput("direction",Gr.Zr,!0,new W.Zr(0,1,0)),this.registerOutput("output",Gr.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(c){const r=this.particle.getConnectedValue(c);r._directionCreation.process=D=>{c.particleContext=D,c.systemContext=r;const B=this.direction.getConnectedValue(c);c.isEmitterTransformNode?W.Zr.TransformNormalToRef(B,c.emitterWorldMatrix,D.direction):D.direction.t(B)},r._positionCreation.process=D=>{c.particleContext=D,c.systemContext=r;const B=this.position.getConnectedValue(c);c.isEmitterTransformNode?W.Zr.TransformCoordinatesToRef(B,c.emitterWorldMatrix,D.position):(D.position.t(B),D.position.addInPlace(c.emitterPosition))},this.output._storedValue=r}});(0,a.e)("BABYLON.CylinderShapeBlock",class extends Qr{constructor(c){super(c),this._tempVector=W.Zr.Zero(),this.registerInput("particle",Gr.Particle),this.registerInput("radius",Gr.Float,!0,1),this.registerInput("height",Gr.Float,!0,1,0),this.registerInput("radiusRange",Gr.Float,!0,1,0,1),this.registerInput("directionRandomizer",Gr.Float,!0,0,0,1),this.registerOutput("output",Gr.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(c){const r=this.particle.getConnectedValue(c);r._directionCreation.process=D=>{c.particleContext=D,c.systemContext=r;const B=this.directionRandomizer.getConnectedValue(c);D.position.subtractToRef(c.emitterPosition,this._tempVector),this._tempVector.normalize(),c.isEmitterTransformNode&&W.Zr.TransformNormalToRef(this._tempVector,c.emitterInverseWorldMatrix,this._tempVector);const t=(0,x.RandomRange)(-B/2,B/2);let u=Math.atan2(this._tempVector.x,this._tempVector.z);u+=(0,x.RandomRange)(-Math.PI/2,Math.PI/2)*B,this._tempVector.y=t,this._tempVector.x=Math.sin(u),this._tempVector.z=Math.cos(u),this._tempVector.normalize(),c.isEmitterTransformNode?W.Zr.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,c.emitterWorldMatrix,D.direction):D.direction.t(this._tempVector)},r._positionCreation.process=D=>{c.particleContext=D,c.systemContext=r;const B=this.height.getConnectedValue(c),t=this.radiusRange.getConnectedValue(c),u=this.radius.getConnectedValue(c),a=(0,x.RandomRange)(-B/2,B/2),H=(0,x.RandomRange)(0,2*Math.PI),M=(0,x.RandomRange)((1-t)*(1-t),1),E=Math.sqrt(M)*u,m=E*Math.cos(H),Y=E*Math.sin(H);c.isEmitterTransformNode?W.Zr.TransformCoordinatesFromFloatsToRef(m,a,Y,c.emitterWorldMatrix,D.position):(D.position.Ja(m,a,Y),D.position.addInPlace(c.emitterPosition))},this.output._storedValue=r}});class HD extends Qr{constructor(c){super(c),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Gr.Particle),this.registerOutput("output",Gr.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(c){super._build(c);const r=this.particle.getConnectedValue(c);r._isAnimationSheetEnabled=!0,r.spriteCellWidth=this.width,r.spriteCellHeight=this.height,r.startSpriteCellID=this.start,r.endSpriteCellID=this.end,r.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=r}serialize(){const c=super.serialize();return c.width=this.width,c.height=this.height,c.start=this.start,c.end=this.end,c.randomStartCell=this.randomStartCell,c}_deserialize(c){super._deserialize(c),this.width=c.width,this.height=c.height,this.start=c.start,this.end=c.end,this.randomStartCell=c.randomStartCell}}(0,f.e)([lr("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HD.prototype,"start",void 0),(0,f.e)([lr("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HD.prototype,"end",void 0),(0,f.e)([lr("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HD.prototype,"width",void 0),(0,f.e)([lr("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],HD.prototype,"height",void 0),(0,f.e)([lr("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],HD.prototype,"loop",void 0),(0,f.e)([lr("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],HD.prototype,"randomStartCell",void 0),(0,a.e)("BABYLON.SetupSpriteSheetBlock",HD);class xD extends Qr{constructor(c){super(c),this.reference=0,this.registerInput("value",Gr.AutoDetect),this.registerOutput("output",Gr.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=c=>{switch(c){case Gr.Float:return Gr.FloatGradient;case Gr.Vector2:return Gr.Vector2Gradient;case Gr.Zr:return Gr.Vector3Gradient;case Gr.Xa:return Gr.Color4Gradient}return c},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Gr.Float|Gr.Vector2|Gr.Zr|Gr.Xa)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=c=>null}serialize(){const c=super.serialize();return c.reference=this.reference,c}_deserialize(c){super._deserialize(c),this.reference=c.reference}}(0,f.e)([lr("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],xD.prototype,"reference",void 0),(0,a.e)("BABYLON.ParticleGradientValueBlock",xD);(0,a.e)("BABYLON.ParticleGradientBlock",class extends Qr{constructor(c){super(c),this._entryCount=1,this.registerInput("gradient",Gr.Float,!0,1,0,1),this.registerInput("value0",Gr.AutoDetect),this.registerOutput("output",Gr.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=c=>{switch(c){case Gr.FloatGradient:return Gr.Float;case Gr.Vector2Gradient:return Gr.Vector2;case Gr.Vector3Gradient:return Gr.Zr;case Gr.Color4Gradient:return Gr.Xa}return c},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Gr.FloatGradient|Gr.Vector2Gradient|Gr.Vector3Gradient|Gr.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(c){this._inputs[c].onConnectionObservable.add((()=>{this._entryCount>c||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Gr.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const c=[];for(let D=1;D<this._inputs.length;D++){var r;if(this._inputs[D].isConnected)c.push(null===(r=this._inputs[D].connectedPoint)||void 0===r?void 0:r.ownerBlock)}c.sort(((c,r)=>c.reference-r.reference)),this.output._storedFunction=r=>{const D=this.gradient.getConnectedValue(r);if(1===c.length)return c[0].value.getConnectedValue(r);let B=null;for(let t=c.length-1;t>=0;t--){const a=c[t];if(a.reference<=D){const c=a.value.getConnectedValue(r);if(B){const t=B.value.getConnectedValue(r),H=B.reference,M=a.reference,E=Math.max(0,Math.min(1,(D-M)/(H-M)));switch(this.output.type){case Gr.Float:return(0,x.Lerp)(c,t,E);case Gr.Vector2:return W.Vector2.Lerp(c,t,E);case Gr.Zr:return W.Zr.Lerp(c,t,E);case Gr.Xa:return u.Xa.Lerp(c,t,E)}}return c}B=a}return 0}}});(0,a.e)("BABYLON.ParticleConverterBlock",class extends Qr{constructor(c){super(c),this.registerInput("color ",Gr.Xa,!0),this.registerInput("xyz ",Gr.Zr,!0),this.registerInput("xy ",Gr.Vector2,!0),this.registerInput("zw ",Gr.Vector2,!0),this.registerInput("x ",Gr.Float,!0),this.registerInput("y ",Gr.Float,!0),this.registerInput("z ",Gr.Float,!0),this.registerInput("w ",Gr.Float,!0),this.registerOutput("color",Gr.Xa),this.registerOutput("xyz",Gr.Zr),this.registerOutput("xy",Gr.Vector2),this.registerOutput("zw",Gr.Vector2),this.registerOutput("x",Gr.Float),this.registerOutput("y",Gr.Float),this.registerOutput("z",Gr.Float),this.registerOutput("w",Gr.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(c){return"color "===c?"colorIn":"xyz "===c?"xyzIn":"xy "===c?"xyIn":"zw "===c?"zwIn":"x "===c?"xIn":"y "===c?"yIn":"z "===c?"zIn":"w "===c?"wIn":c}_outputRename(c){switch(c){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return c}}_build(c){super._build(c);const r=this.xIn,D=this.yIn,B=this.zIn,t=this.wIn,a=this.xyIn,H=this.zwIn,x=this.xyzIn,M=this.colorIn,E=this.colorOut,m=this.xyzOut,Y=this.xyOut,v=this.zwOut,k=this.xOut,w=this.yOut,Z=this.zOut,J=this.wOut,q=c=>{if(M.isConnected)return M.getConnectedValue(c);let W=0,E=0,m=0,Y=0;if(r.isConnected&&(W=r.getConnectedValue(c)),D.isConnected&&(E=D.getConnectedValue(c)),B.isConnected&&(m=B.getConnectedValue(c)),t.isConnected&&(Y=t.getConnectedValue(c)),a.isConnected){const r=a.getConnectedValue(c);r&&(W=r.x,E=r.y)}if(H.isConnected){const r=H.getConnectedValue(c);r&&(m=r.x,Y=r.y)}if(x.isConnected){const r=x.getConnectedValue(c);r&&(W=r.x,E=r.y,m=r.z)}return new u.Xa(W,E,m,Y)};E._storedFunction=c=>q(c),m._storedFunction=c=>{const r=q(c);return new W.Zr(r.r,r.g,r.b)},Y._storedFunction=c=>{const r=q(c);return new W.Vector2(r.r,r.g)},v._storedFunction=c=>{const r=q(c);return new W.Vector2(r.b,r.a)},k._storedFunction=c=>q(c).r,w._storedFunction=c=>q(c).g,Z._storedFunction=c=>q(c).b,J._storedFunction=c=>q(c).a}}),function(c){c[c.Cos=0]="Cos",c[c.Sin=1]="Sin",c[c.Abs=2]="Abs",c[c.Exp=3]="Exp",c[c.Exp2=4]="Exp2",c[c.Round=5]="Round",c[c.Floor=6]="Floor",c[c.Ceiling=7]="Ceiling",c[c.Sqrt=8]="Sqrt",c[c.Log=9]="Log",c[c.Tan=10]="Tan",c[c.ArcTan=11]="ArcTan",c[c.ArcCos=12]="ArcCos",c[c.ArcSin=13]="ArcSin",c[c.Sign=14]="Sign",c[c.Negate=15]="Negate",c[c.OneMinus=16]="OneMinus",c[c.Reciprocal=17]="Reciprocal",c[c.ToDegrees=18]="ToDegrees",c[c.ToRadians=19]="ToRadians",c[c.Fract=20]="Fract"}(sr||(sr={}));class MD extends Qr{constructor(c){super(c),this.operation=sr.Cos,this.registerInput("input",Gr.AutoDetect),this.registerOutput("output",Gr.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Gr.Float|Gr.Int|Gr.Vector2|Gr.Zr|Gr.Xa)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(c){super._build(c);let r=null;switch(this.operation){case sr.Cos:r=c=>Math.cos(c);break;case sr.Sin:r=c=>Math.sin(c);break;case sr.Abs:r=c=>Math.abs(c);break;case sr.Exp:r=c=>Math.exp(c);break;case sr.Exp2:r=c=>Math.pow(2,c);break;case sr.Round:r=c=>Math.round(c);break;case sr.Floor:r=c=>Math.floor(c);break;case sr.Ceiling:r=c=>Math.ceil(c);break;case sr.Sqrt:r=c=>Math.sqrt(c);break;case sr.Log:r=c=>Math.log(c);break;case sr.Tan:r=c=>Math.tan(c);break;case sr.ArcTan:r=c=>Math.atan(c);break;case sr.ArcCos:r=c=>Math.acos(c);break;case sr.ArcSin:r=c=>Math.asin(c);break;case sr.Sign:r=c=>Math.sign(c);break;case sr.Negate:r=c=>-c;break;case sr.OneMinus:r=c=>1-c;break;case sr.Reciprocal:r=c=>1/c;break;case sr.ToRadians:r=c=>c*Math.PI/180;break;case sr.ToDegrees:r=c=>180*c/Math.PI;break;case sr.Fract:r=c=>c>=0?c-Math.floor(c):c-Math.ceil(c)}if(!r)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Gr.Int:case Gr.Float:this.output._storedFunction=c=>{const D=this.input.getConnectedValue(c);return r(D)};break;case Gr.Vector2:this.output._storedFunction=c=>{const D=this.input.getConnectedValue(c);return new W.Vector2(r(D.x),r(D.y))};break;case Gr.Zr:this.output._storedFunction=c=>{const D=this.input.getConnectedValue(c);return new W.Zr(r(D.x),r(D.y),r(D.z))};break;case Gr.Xa:this.output._storedFunction=c=>{const D=this.input.getConnectedValue(c);return new u.Xa(r(D.r),r(D.g),r(D.b),r(D.a))}}return this}serialize(){const c=super.serialize();return c.operation=this.operation,c}_deserialize(c){super._deserialize(c),this.operation=c.operation}}(0,f.e)([lr("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:sr.Cos},{label:"Sin",value:sr.Sin},{label:"Abs",value:sr.Abs},{label:"Exp",value:sr.Exp},{label:"Exp2",value:sr.Exp2},{label:"Round",value:sr.Round},{label:"Floor",value:sr.Floor},{label:"Ceiling",value:sr.Ceiling},{label:"Sqrt",value:sr.Sqrt},{label:"Log",value:sr.Log},{label:"Tan",value:sr.Tan},{label:"ArcTan",value:sr.ArcTan},{label:"ArcCos",value:sr.ArcCos},{label:"ArcSin",value:sr.ArcSin},{label:"Sign",value:sr.Sign},{label:"Negate",value:sr.Negate},{label:"OneMinus",value:sr.OneMinus},{label:"Reciprocal",value:sr.Reciprocal},{label:"ToDegrees",value:sr.ToDegrees},{label:"ToRadians",value:sr.ToRadians},{label:"Fract",value:sr.Fract}]})],MD.prototype,"operation",void 0),(0,a.e)("BABYLON.ParticleTrigonometryBlock",MD);var ED,mD=D(13069);class YD extends Qr{constructor(c){super(c),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Gr.AutoDetect),this.registerOutput("output",Gr.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Gr.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Gr.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Gr.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Gr.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Gr.System),this._inputs[0].excludedConnectionPointTypes.push(Gr.Particle),this._inputs[0].excludedConnectionPointTypes.push(Gr.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(c){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const r=c=>{const r=this.input.getConnectedValue(c);if(this.log.length>=this.stackSize)return r;if(null===r||void 0===r)return this.log.push(["null",""]),r;switch(this.input.type){case Gr.Vector2:this.log.push([(0,mD.i)(r,4),r.toString()]);break;case Gr.Zr:this.log.push([(0,mD.l)(r,4),r.toString()]);break;case Gr.Xa:this.log.push([`{R: ${r.r.toFixed(4)} G: ${r.g.toFixed(4)} B: ${r.b.toFixed(4)} A: ${r.a.toFixed(4)}}`,r.toString()]);break;default:this.log.push([r.toString(),r.toString()])}return r};this.output.isConnected?this.output._storedFunction=r:this.output._storedValue=r(c)}serialize(){const c=super.serialize();return c.stackSize=this.stackSize,c}_deserialize(c){super._deserialize(c),this.stackSize=c.stackSize}}(0,f.e)([lr("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],YD.prototype,"stackSize",void 0),(0,a.e)("BABYLON.ParticleDebugBlock",YD);(0,a.e)("BABYLON.ParticleElbowBlock",class extends Qr{constructor(c){super(c),this.registerInput("input",Gr.AutoDetect),this.registerOutput("output",Gr.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(c){super._build(c);const r=this._outputs[0],D=this._inputs[0];r._storedFunction=c=>D.getConnectedValue(c)}});(0,a.e)("BABYLON.ParticleTeleportInBlock",class extends Qr{get endpoints(){return this._endpoints}constructor(c){super(c),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Gr.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(c){if(this.getClassName()===c)return!0;for(const r of this.endpoints)if(r.isAnAncestorOfType(c))return!0;return!1}isAnAncestorOf(c){for(const r of this.endpoints){if(r===c)return!0;if(r.isAnAncestorOf(c))return!0}return!1}attachToEndpoint(c){c.detach(),this._endpoints.push(c),c._entryPoint=this,c._outputs[0]._typeConnectionSource=this._inputs[0],c._tempEntryPointUniqueId=null,c.name="> "+this.name}detachFromEndpoint(c){const r=this._endpoints.indexOf(c);-1!==r&&(this._endpoints.splice(r,1),c._outputs[0]._typeConnectionSource=null,c._entryPoint=null)}_build(){for(const c of this._endpoints)c.output._storedFunction=c=>this.input.getConnectedValue(c)}});(0,a.e)("BABYLON.ParticleTeleportOutBlock",class extends Qr{constructor(c){super(c),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Gr.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(c){this.entryPoint&&this.entryPoint.build(c)}clone(){const c=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(c),c}serialize(){var c;const r=super.serialize();return r.entryPoint=(null===(c=this.entryPoint)||void 0===c?void 0:c.uniqueId)??"",r}_deserialize(c){super._deserialize(c),this._tempEntryPointUniqueId=c.entryPoint}}),function(c){c[c.Equal=0]="Equal",c[c.NotEqual=1]="NotEqual",c[c.LessThan=2]="LessThan",c[c.GreaterThan=3]="GreaterThan",c[c.LessOrEqual=4]="LessOrEqual",c[c.GreaterOrEqual=5]="GreaterOrEqual",c[c.Xor=6]="Xor",c[c.Or=7]="Or",c[c.And=8]="And"}(ED||(ED={}));class vD extends Qr{constructor(c){super(c),this.test=ED.Equal,this.epsilon=0,this.registerInput("left",Gr.Float),this.registerInput("right",Gr.Float,!0,0),this.registerInput("ifTrue",Gr.AutoDetect,!0,1),this.registerInput("ifFalse",Gr.AutoDetect,!0,0),this.registerOutput("output",Gr.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Gr.Float,this._inputs[0].acceptedConnectionPointTypes.push(Gr.Int),this._inputs[1].acceptedConnectionPointTypes.push(Gr.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const c=c=>{const r=this.left.getConnectedValue(c),D=this.right.getConnectedValue(c);let W=!1;switch(this.test){case ED.Equal:W=(0,x.WithinEpsilon)(r,D,this.epsilon);break;case ED.NotEqual:W=!(0,x.WithinEpsilon)(r,D,this.epsilon);break;case ED.LessThan:W=r<D+this.epsilon;break;case ED.GreaterThan:W=r>D-this.epsilon;break;case ED.LessOrEqual:W=r<=D+this.epsilon;break;case ED.GreaterOrEqual:W=r>=D-this.epsilon;break;case ED.Xor:W=!!r&&!D||!r&&!!D;break;case ED.Or:W=!!r||!!D;break;case ED.And:W=!!r&&!!D}return W};this.output._storedFunction=r=>c(r)?this.ifTrue.getConnectedValue(r):this.ifFalse.getConnectedValue(r)}serialize(){const c=super.serialize();return c.test=this.test,c.epsilon=this.epsilon,c}_deserialize(c){super._deserialize(c),this.test=c.test,void 0!==c.epsilon&&(this.epsilon=c.epsilon)}}(0,f.e)([lr("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:ED.Equal},{label:"NotEqual",value:ED.NotEqual},{label:"LessThan",value:ED.LessThan},{label:"GreaterThan",value:ED.GreaterThan},{label:"LessOrEqual",value:ED.LessOrEqual},{label:"GreaterOrEqual",value:ED.GreaterOrEqual},{label:"Xor",value:ED.Xor},{label:"Or",value:ED.Or},{label:"And",value:ED.And}]})],vD.prototype,"test",void 0),(0,f.e)([lr("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],vD.prototype,"epsilon",void 0),(0,a.e)("BABYLON.ParticleConditionBlock",vD);class kD extends Qr{constructor(c){super(c),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Gr.Particle),this.registerInput("condition",Gr.Float,!0,0),this.registerInput("system",Gr.System),this.registerOutput("output",Gr.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(c){this._triggerCount=0;const r=this.input.getConnectedValue(c),D={process:D=>{if(c.particleContext=D,c.systemContext=r,0!==this.condition.getConnectedValue(c)&&(0===this.limit||this._triggerCount<this.limit)){const W=(new Date).getTime();if(this._previousOne&&W-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=W;const B=this.system.getConnectedValue(c);if(B){const W=Ir(B,c.qr,D.position);W.Wa.addOnce((()=>{this._triggerCount--})),r.Wa.addOnce((()=>{W.dispose()}))}}},previousItem:null,nextItem:null};r._updateQueueStart?Cc(D,r._updateQueueStart):r._updateQueueStart=D,this.output._storedValue=r}serialize(){const c=super.serialize();return c.limit=this.limit,c.delay=this.delay,c}_deserialize(c){super._deserialize(c),void 0!==c.limit&&(this.limit=c.limit),void 0!==c.delay&&(this.delay=c.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,f.e)([lr("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kD.prototype,"limit",void 0),(0,f.e)([lr("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kD.prototype,"delay",void 0),(0,a.e)("BABYLON.ParticleTriggerBlock",kD);D(13071),D(13088),D(13101),D(13157)},13139:(c,r,D)=>{"use strict";var W=D(11595);const B="clipPlaneFragment",t="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13104:(c,r,D)=>{"use strict";var W=D(11595);const B="clipPlaneFragmentDeclaration",t="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13173:(c,r,D)=>{"use strict";var W=D(11595);const B="clipPlaneVertex",t="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13159:(c,r,D)=>{"use strict";var W=D(11595);const B="clipPlaneVertexDeclaration",t="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13151:(c,r,D)=>{"use strict";var W=D(11595);const B="fogFragment",t="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13133:(c,r,D)=>{"use strict";var W=D(11595);const B="fogFragmentDeclaration",t="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13180:(c,r,D)=>{"use strict";var W=D(11595);const B="fogVertex",t="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13167:(c,r,D)=>{"use strict";var W=D(11595);const B="fogVertexDeclaration",t="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13123:(c,r,D)=>{"use strict";var W=D(11595);const B="helperFunctions",t="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13107:(c,r,D)=>{"use strict";var W=D(11595);const B="imageProcessingDeclaration",t="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13129:(c,r,D)=>{"use strict";var W=D(11595);const B="imageProcessingFunctions",t="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13116:(c,r,D)=>{"use strict";var W=D(11595);const B="logDepthDeclaration",t="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13142:(c,r,D)=>{"use strict";var W=D(11595);const B="logDepthFragment",t="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13189:(c,r,D)=>{"use strict";var W=D(11595);const B="logDepthVertex",t="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";W.d.IncludesShadersStoreWGSL[B]||(W.d.IncludesShadersStoreWGSL[B]=t)},13101:(c,r,D)=>{"use strict";D.r(r),D.d(r,{particlesPixelShaderWGSL:()=>u});var W=D(11595);D(13104),D(13107),D(13116),D(13123),D(13129),D(13133),D(13139),D(13142),D(13151);const B="particlesPixelShader",t="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";W.d.ShadersStoreWGSL[B]||(W.d.ShadersStoreWGSL[B]=t);const u={name:B,shader:t}},13157:(c,r,D)=>{"use strict";D.r(r),D.d(r,{particlesVertexShaderWGSL:()=>u});var W=D(11595);D(13159),D(13167),D(13116),D(13173),D(13180),D(13189);const B="particlesVertexShader",t="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";W.d.ShadersStoreWGSL[B]||(W.d.ShadersStoreWGSL[B]=t);const u={name:B,shader:t}},13023:(c,r,D)=>{"use strict";var W=D(11595);const B="clipPlaneFragment",t="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},13080:(c,r,D)=>{"use strict";var W=D(11595);const B="clipPlaneFragmentDeclaration",t="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},13040:(c,r,D)=>{"use strict";var W=D(11595);const B="clipPlaneVertex",t="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},13097:(c,r,D)=>{"use strict";var W=D(11595);const B="clipPlaneVertexDeclaration",t="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},13030:(c,r,D)=>{"use strict";var W=D(11595);const B="fogFragment",t="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},13018:(c,r,D)=>{"use strict";var W=D(11595);const B="fogFragmentDeclaration",t="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},13047:(c,r,D)=>{"use strict";var W=D(11595);const B="fogVertex",t="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},13037:(c,r,D)=>{"use strict";var W=D(11595);const B="fogVertexDeclaration",t="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},13009:(c,r,D)=>{"use strict";var W=D(11595);const B="helperFunctions",t="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},12996:(c,r,D)=>{"use strict";var W=D(11595);const B="imageProcessingDeclaration",t="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},13016:(c,r,D)=>{"use strict";var W=D(11595);const B="imageProcessingFunctions",t="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},13e3:(c,r,D)=>{"use strict";var W=D(11595);const B="logDepthDeclaration",t="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},13028:(c,r,D)=>{"use strict";var W=D(11595);const B="logDepthFragment",t="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},13051:(c,r,D)=>{"use strict";var W=D(11595);const B="logDepthVertex",t="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";W.d.IncludesShadersStore[B]||(W.d.IncludesShadersStore[B]=t)},13071:(c,r,D)=>{"use strict";D.r(r),D.d(r,{particlesPixelShader:()=>u});var W=D(11595);D(13080),D(12996),D(13e3),D(13009),D(13016),D(13018),D(13023),D(13028),D(13030);const B="particlesPixelShader",t="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";W.d.ShadersStore[B]||(W.d.ShadersStore[B]=t);const u={name:B,shader:t}},13088:(c,r,D)=>{"use strict";D.r(r),D.d(r,{particlesVertexShader:()=>u});var W=D(11595);D(13097),D(13037),D(13e3),D(13040),D(13047),D(13051);const B="particlesVertexShader",t="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";W.d.ShadersStore[B]||(W.d.ShadersStore[B]=t);const u={name:B,shader:t}},13437:(c,r,D)=>{"use strict";D.r(r),D.d(r,{FlowGraphGLTFDataProvider:()=>t});var W=D(13408),B=D(13392);class t extends W.d{constructor(c){var r,D;super();const W=c.glTF,t=(null===(r=W.animations)||void 0===r?void 0:r.map((c=>c._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",B.c,t);const u=(null===(D=W.nodes)||void 0===D?void 0:D.map((c=>c._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",B.c,u)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13334:(c,r,D)=>{"use strict";D.d(r,{e:()=>w,g:()=>v,h:()=>Y,l:()=>k});var W=D(11683),B=D(12166),t=D(11722),u=D(13339);const a=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class H{constructor(c,r){this._gltf=c,this._infoTree=r}convert(c){let r,D=this._gltf,W=this._infoTree;if(!c.startsWith("/"))throw new Error("Path must start with a /");const B=c.split("/");if(B.shift(),B[B.length-1].includes(".length")){const c=B[B.length-1].split(".");B.pop(),B.push(...c)}let t=!1;for(const H of B){const B="length"===H;if(B&&!W.__array__)throw new Error(`Path ${c} is invalid`);if(W.__ignoreObjectTree__&&(t=!0),W.__array__&&!B)W=W.__array__;else if(W=W[H],!W)throw new Error(`Path ${c} is invalid`);if(!t)if(void 0===D){if(!a.find((r=>r.regex.test(c))))throw new Error(`Path ${c} is invalid`)}else if(!B){var u;D=null===(u=D)||void 0===u?void 0:u[H]}(W.__target__||B)&&(r=D)}return{object:r,info:W}}}function x(c,r,D,W){const B=M(c,r);return W?B[D][W]:B[D]}function M(c,r,D){var W,t;return null===(W=c._data)||void 0===W||null===(t=W[(null===D||void 0===D?void 0:D.fillMode)??B.e.MATERIAL_TriangleFillMode])||void 0===t?void 0:t.babylonMaterial}function E(c,r){return{offset:{componentsCount:2,type:"Vector2",get:(D,B,t)=>{const u=x(D,t,c,r);return new W.Vector2(null===u||void 0===u?void 0:u.uOffset,null===u||void 0===u?void 0:u.vOffset)},getTarget:M,set:(D,W,B,t)=>{const u=x(W,t,c,r);u.uOffset=D.x,u.vOffset=D.y},getPropertyName:[()=>`${c}${r?"."+r:""}.uOffset`,()=>`${c}${r?"."+r:""}.vOffset`]},rotation:{type:"number",get:(D,W,B)=>{var t;return null===(t=x(D,B,c,r))||void 0===t?void 0:t.wAng},getTarget:M,set:(D,W,B,t)=>x(W,t,c,r).wAng=D,getPropertyName:[()=>`${c}${r?"."+r:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(D,B,t)=>{const u=x(D,t,c,r);return new W.Vector2(null===u||void 0===u?void 0:u.uScale,null===u||void 0===u?void 0:u.vScale)},getTarget:M,set:(D,W,B,t)=>{const u=x(W,t,c,r);u.uScale=D.x,u.vScale=D.y},getPropertyName:[()=>`${c}${r?"."+r:""}.uScale`,()=>`${c}${r?"."+r:""}.vScale`]}}}const m={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:c=>{var r,D;return new W.Vector2((null===(r=c._babylonCamera)||void 0===r?void 0:r.orthoLeft)??0,(null===(D=c._babylonCamera)||void 0===D?void 0:D.orthoRight)??0)},set:(c,r)=>{r._babylonCamera&&(r._babylonCamera.orthoLeft=c.x,r._babylonCamera.orthoRight=c.y)},getTarget:c=>c,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:c=>{var r,D;return new W.Vector2((null===(r=c._babylonCamera)||void 0===r?void 0:r.orthoBottom)??0,(null===(D=c._babylonCamera)||void 0===D?void 0:D.orthoTop)??0)},set:(c,r)=>{r._babylonCamera&&(r._babylonCamera.orthoBottom=c.x,r._babylonCamera.orthoTop=c.y)},getTarget:c=>c,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:c=>{var r;return null===(r=c._babylonCamera)||void 0===r?void 0:r.maxZ},set:(c,r)=>{r._babylonCamera&&(r._babylonCamera.maxZ=c)},getTarget:c=>c,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:c=>{var r;return null===(r=c._babylonCamera)||void 0===r?void 0:r.ma},set:(c,r)=>{r._babylonCamera&&(r._babylonCamera.ma=c)},getTarget:c=>c,getPropertyName:[()=>"ma"]}},perspective:{aspectRatio:{type:"number",get:c=>{var r;return null===(r=c._babylonCamera)||void 0===r?void 0:r.getEngine().getAspectRatio(c._babylonCamera)},getTarget:c=>c,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:c=>{var r;return null===(r=c._babylonCamera)||void 0===r?void 0:r.fov},set:(c,r)=>{r._babylonCamera&&(r._babylonCamera.fov=c)},getTarget:c=>c,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:c=>{var r;return null===(r=c._babylonCamera)||void 0===r?void 0:r.maxZ},set:(c,r)=>{r._babylonCamera&&(r._babylonCamera.maxZ=c)},getTarget:c=>c,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:c=>{var r;return null===(r=c._babylonCamera)||void 0===r?void 0:r.ma},set:(c,r)=>{r._babylonCamera&&(r._babylonCamera.ma=c)},getTarget:c=>c,getPropertyName:[()=>"ma"]}}}},nodes:{length:{type:"number",get:c=>c.length,getTarget:c=>c.map((c=>c._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Zr",get:c=>{var r;return null===(r=c._babylonTransformNode)||void 0===r?void 0:r.position},set:(c,r)=>{var D;return null===(D=r._babylonTransformNode)||void 0===D?void 0:D.position.t(c)},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:c=>{var r;return null===(r=c._babylonTransformNode)||void 0===r?void 0:r.rotationQuaternion},set:(c,r)=>{var D,W;return null===(D=r._babylonTransformNode)||void 0===D||null===(W=D.rotationQuaternion)||void 0===W?void 0:W.t(c)},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Zr",get:c=>{var r;return null===(r=c._babylonTransformNode)||void 0===r?void 0:r.qa},set:(c,r)=>{var D;return null===(D=r._babylonTransformNode)||void 0===D?void 0:D.qa.t(c)},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"qa"]},weights:{length:{type:"number",get:c=>c._numMorphTargets,getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(c,r)=>{var D,W;return void 0!==r?null===(D=c._primitiveBabylonMeshes)||void 0===D||null===(W=D[0].morphTargetManager)||void 0===W?void 0:W.getTarget(r).influence:void 0},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(c,r)=>[0],getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:c=>{var r,D,B;return W.Matrix.Compose(null===(r=c._babylonTransformNode)||void 0===r?void 0:r.qa,null===(D=c._babylonTransformNode)||void 0===D?void 0:D.rotationQuaternion,null===(B=c._babylonTransformNode)||void 0===B?void 0:B.position)},getTarget:c=>c._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:c=>{var r,D,B,t;const u=W.Matrix.Identity();let a=c.parent;for(;a&&a.parent;)a=a.parent;const H=(null===(r=c._babylonTransformNode)||void 0===r?void 0:r.position._isDirty)||(null===(D=c._babylonTransformNode)||void 0===D||null===(B=D.rotationQuaternion)||void 0===B?void 0:B._isDirty)||(null===(t=c._babylonTransformNode)||void 0===t?void 0:t.qa._isDirty);if(a){var x;const r=null===(x=a._babylonTransformNode)||void 0===x?void 0:x.va(!0).invert();var M,E;if(r)null===(M=c._babylonTransformNode)||void 0===M||null===(E=M.va(H))||void 0===E||E.multiplyToRef(r,u)}else c._babylonTransformNode&&u.t(c._babylonTransformNode.va(H));return u},getTarget:c=>c._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:c=>{var r,D;return null===(r=c._babylonTransformNode)||void 0===r||null===(D=r.getChildren((c=>c instanceof u.e),!0)[0])||void 0===D?void 0:D.Ua},getTarget:c=>{var r;return null===(r=c._babylonTransformNode)||void 0===r?void 0:r.getChildren((c=>c instanceof u.e),!0)[0]},set:(c,r)=>{if(r._babylonTransformNode){const D=r._babylonTransformNode.getChildren((c=>c instanceof u.e),!0)[0];D&&(D.Ua=c)}}},color:{type:"Xr",get:c=>{var r,D;return null===(r=c._babylonTransformNode)||void 0===r||null===(D=r.getChildren((c=>c instanceof u.e),!0)[0])||void 0===D?void 0:D.Na},getTarget:c=>{var r;return null===(r=c._babylonTransformNode)||void 0===r?void 0:r.getChildren((c=>c instanceof u.e),!0)[0]},set:(c,r)=>{if(r._babylonTransformNode){const D=r._babylonTransformNode.getChildren((c=>c instanceof u.e),!0)[0];D&&(D.Na=c)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Xr",get:(c,r,D)=>M(c,r,D).emissiveColor,set:(c,r,D,W)=>M(r,D,W).emissiveColor.t(c),getTarget:(c,r,D)=>M(c,r,D),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:E("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(c,r,D)=>{var W;return null===(W=x(c,D,"bumpTexture"))||void 0===W?void 0:W.level},set:(c,r,D,W)=>{const B=x(r,W,"bumpTexture");B&&(B.level=c)},getTarget:(c,r,D)=>M(c,r,D),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:E("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(c,r,D)=>M(c,r,D).ambientTextureStrength,set:(c,r,D,W)=>{const B=M(r,D,W);B&&(B.ambientTextureStrength=c)},getTarget:(c,r,D)=>M(c,r,D),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:E("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Xa",get:(c,r,D)=>{const W=M(c,r,D);return t.Xa.FromColor3(W.albedoColor,W.alpha)},set:(c,r,D,W)=>{const B=M(r,D,W);B.albedoColor.set(c.r,c.g,c.b),B.alpha=c.a},getTarget:(c,r,D)=>M(c,r,D),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:E("albedoTexture")}},metallicFactor:{type:"number",get:(c,r,D)=>M(c,r,D).metallic,set:(c,r,D,W)=>{const B=M(r,D,W);B&&(B.metallic=c)},getTarget:(c,r,D)=>M(c,r,D),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(c,r,D)=>M(c,r,D).roughness,set:(c,r,D,W)=>{const B=M(r,D,W);B&&(B.roughness=c)},getTarget:(c,r,D)=>M(c,r,D),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:E("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(c,r,D)=>M(c,r,D).anisotropy.Ua,set:(c,r,D,W)=>{M(r,D,W).anisotropy.Ua=c},getTarget:(c,r,D)=>M(c,r,D),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(c,r,D)=>M(c,r,D).anisotropy.angle,set:(c,r,D,W)=>{M(r,D,W).anisotropy.angle=c},getTarget:(c,r,D)=>M(c,r,D),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:E("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(c,r,D)=>M(c,r,D).clearCoat.Ua,set:(c,r,D,W)=>{M(r,D,W).clearCoat.Ua=c},getTarget:(c,r,D)=>M(c,r,D),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(c,r,D)=>M(c,r,D).clearCoat.roughness,set:(c,r,D,W)=>{M(r,D,W).clearCoat.roughness=c},getTarget:(c,r,D)=>M(c,r,D),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:E("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(c,r,D)=>{var W;return null===(W=M(c,r,D).clearCoat.bumpTexture)||void 0===W?void 0:W.level},getTarget:M,set:(c,r,D,W)=>M(r,D,W).clearCoat.bumpTexture.level=c},extensions:{KHR_texture_transform:E("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:E("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(c,r,D)=>M(c,r,D).subSurface.dispersion,getTarget:M,set:(c,r,D,W)=>M(r,D,W).subSurface.dispersion=c}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(c,r,D)=>M(c,r,D).emissiveIntensity,getTarget:M,set:(c,r,D,W)=>M(r,D,W).emissiveIntensity=c}},KHR_materials_ior:{ior:{type:"number",get:(c,r,D)=>M(c,r,D).indexOfRefraction,getTarget:M,set:(c,r,D,W)=>M(r,D,W).indexOfRefraction=c}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(c,r,D)=>M(c,r,D).iridescence.Ua,getTarget:M,set:(c,r,D,W)=>M(r,D,W).iridescence.Ua=c},iridescenceIor:{type:"number",get:(c,r,D)=>M(c,r,D).iridescence.indexOfRefraction,getTarget:M,set:(c,r,D,W)=>M(r,D,W).iridescence.indexOfRefraction=c},iridescenceTexture:{extensions:{KHR_texture_transform:E("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(c,r,D)=>M(c,r,D).iridescence.maximumThickness,getTarget:M,set:(c,r,D,W)=>M(r,D,W).iridescence.maximumThickness=c},iridescenceThicknessMinimum:{type:"number",get:(c,r,D)=>M(c,r,D).iridescence.minimumThickness,getTarget:M,set:(c,r,D,W)=>M(r,D,W).iridescence.minimumThickness=c},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:E("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Xr",get:(c,r,D)=>M(c,r,D).sheen.color,getTarget:M,set:(c,r,D,W)=>M(r,D,W).sheen.color.t(c)},sheenColorTexture:{extensions:{KHR_texture_transform:E("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(c,r,D)=>M(c,r,D).sheen.Ua,getTarget:M,set:(c,r,D,W)=>M(r,D,W).sheen.Ua=c},sheenRoughnessTexture:{extensions:{KHR_texture_transform:E("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(c,r,D)=>M(c,r,D).metallicF0Factor,getTarget:M,set:(c,r,D,W)=>M(r,D,W).metallicF0Factor=c,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Xr",get:(c,r,D)=>M(c,r,D).metallicReflectanceColor,getTarget:M,set:(c,r,D,W)=>M(r,D,W).metallicReflectanceColor.t(c),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:E("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:E("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(c,r,D)=>M(c,r,D).subSurface.refractionIntensity,getTarget:M,set:(c,r,D,W)=>M(r,D,W).subSurface.refractionIntensity=c,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:E("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(c,r,D)=>M(c,r,D).subSurface.translucencyIntensity,getTarget:M,set:(c,r,D,W)=>M(r,D,W).subSurface.translucencyIntensity=c},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:E("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Xr",get:(c,r,D)=>M(c,r,D).subSurface.translucencyColor,getTarget:M,set:(c,r,D,W)=>{var B;return c&&(null===(B=M(r,D,W).subSurface.translucencyColor)||void 0===B?void 0:B.t(c))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:E("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Xr",get:(c,r,D)=>M(c,r,D).subSurface.tintColor,getTarget:M,set:(c,r,D,W)=>M(r,D,W).subSurface.tintColor.t(c)},attenuationDistance:{type:"number",get:(c,r,D)=>M(c,r,D).subSurface.tintColorAtDistance,getTarget:M,set:(c,r,D,W)=>M(r,D,W).subSurface.tintColorAtDistance=c},thicknessFactor:{type:"number",get:(c,r,D)=>M(c,r,D).subSurface.maximumThickness,getTarget:M,set:(c,r,D,W)=>M(r,D,W).subSurface.maximumThickness=c},thicknessTexture:{extensions:{KHR_texture_transform:E("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:c=>c.length,getTarget:c=>c.map((c=>c._babylonLight)),getPropertyName:[c=>"length"]},__array__:{__target__:!0,color:{type:"Xr",get:c=>{var r;return null===(r=c._babylonLight)||void 0===r?void 0:r.Na},set:(c,r)=>{var D;return null===(D=r._babylonLight)||void 0===D?void 0:D.Na.t(c)},getTarget:c=>c._babylonLight,getPropertyName:[c=>"diffuse"]},Ua:{type:"number",get:c=>{var r;return null===(r=c._babylonLight)||void 0===r?void 0:r.Ua},set:(c,r)=>r._babylonLight?r._babylonLight.Ua=c:void 0,getTarget:c=>c._babylonLight,getPropertyName:[c=>"intensity"]},range:{type:"number",get:c=>{var r;return null===(r=c._babylonLight)||void 0===r?void 0:r.range},set:(c,r)=>r._babylonLight?r._babylonLight.range=c:void 0,getTarget:c=>c._babylonLight,getPropertyName:[c=>"range"]},spot:{innerConeAngle:{type:"number",get:c=>{var r;return null===(r=c._babylonLight)||void 0===r?void 0:r.innerAngle},set:(c,r)=>r._babylonLight?r._babylonLight.innerAngle=c:void 0,getTarget:c=>c._babylonLight,getPropertyName:[c=>"innerConeAngle"]},outerConeAngle:{type:"number",get:c=>{var r;return null===(r=c._babylonLight)||void 0===r?void 0:r.angle},set:(c,r)=>r._babylonLight?r._babylonLight.angle=c:void 0,getTarget:c=>c._babylonLight,getPropertyName:[c=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:c=>c.length,getTarget:c=>c.map((c=>c._babylonLight)),getPropertyName:[c=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:c=>c.length,getTarget:c=>c.map((c=>c._babylonTexture)),getPropertyName:[c=>"length"]},__array__:{__target__:!0,Ua:{type:"number",get:c=>{var r;return null===(r=c._babylonTexture)||void 0===r?void 0:r.level},set:(c,r)=>{r._babylonTexture&&(r._babylonTexture.level=c)},getTarget:c=>c._babylonTexture},rotation:{type:"Quaternion",get:c=>{var r;return c._babylonTexture&&W.Quaternion.FromRotationMatrix(null===(r=c._babylonTexture)||void 0===r?void 0:r.getReflectionTextureMatrix())},set:(c,r)=>{var D;r._babylonTexture&&(null!==(D=r._babylonTexture.yc())&&void 0!==D&&D.useRightHandedSystem||(c=W.Quaternion.Inverse(c)),W.Matrix.FromQuaternionToRef(c,r._babylonTexture.getReflectionTextureMatrix()))},getTarget:c=>c._babylonTexture}}}}},animations:{length:{type:"number",get:c=>c.length,getTarget:c=>c.map((c=>c._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:c=>c.length,getTarget:c=>c.map((c=>{var r;return null===(r=c.primitives[0]._instanceData)||void 0===r?void 0:r.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function Y(c){return new H(c,m)}function v(c){const r=c.split("/").map((c=>c.replace(/{}/g,"__array__")));let D=m;for(const W of r)W&&(D=D[W]);if(D&&D.type&&D.get)return D}function k(c,r){const D=c.split("/").map((c=>c.replace(/{}/g,"__array__")));let W=m;for(const B of D)B&&(W=W[B]);W&&W.type&&W.get&&(W.interpolation=r)}function w(c,r){const D=c.split("/").map((c=>c.replace(/{}/g,"__array__")));let W=m;for(const B of D)if(B){if(!W[B]){if("?"===B){W.__ignoreObjectTree__=!0;continue}W[B]={},"__array__"===B&&(W[B].__target__=!0)}W=W[B]}Object.assign(W,r)}},13342:(c,r,D)=>{"use strict";D.r(r),D.d(r,{AnimationPropertyInfo:()=>x,TransformNodeAnimationPropertyInfo:()=>M,WeightAnimationPropertyInfo:()=>E,getQuaternion:()=>a,getVector3:()=>u,getWeights:()=>H});var W=D(12202),B=D(11683),t=D(13334);function u(c,r,D,W){return B.Zr.er(r,D).scaleInPlace(W)}function a(c,r,D,W){return B.Quaternion.er(r,D).scaleInPlace(W)}function H(c,r,D,W){const B=new Array(c._numMorphTargets);for(let t=0;t<B.length;t++)B[t]=r[D++]*W;return B}class x{constructor(c,r,D,W){this.type=c,this.name=r,this.getValue=D,this.getStride=W}_buildAnimation(c,r,D){const B=new W.b(c,this.name,r,this.type);return B.setKeys(D),B}}class M extends x{buildAnimations(c,r,D,W){const B=[];return B.push({babylonAnimatable:c._babylonTransformNode,babylonAnimation:this._buildAnimation(r,D,W)}),B}}class E extends x{buildAnimations(c,r,D,B){const t=[];if(c._numMorphTargets)for(let u=0;u<c._numMorphTargets;u++){const a=new W.b(`${r}_${u}`,this.name,D,this.type);if(a.setKeys(B.map((c=>({frame:c.frame,inTangent:c.inTangent?c.inTangent[u]:void 0,value:c.value[u],outTangent:c.outTangent?c.outTangent[u]:void 0,interpolation:c.interpolation})))),c._primitiveBabylonMeshes)for(const r of c._primitiveBabylonMeshes)if(r.morphTargetManager){const c=r.morphTargetManager.getTarget(u),D=a.clone();c.animations.push(D),t.push({babylonAnimatable:c,babylonAnimation:D})}}return t}}(0,t.l)("/nodes/{}/translation",[new M(W.b.ANIMATIONTYPE_VECTOR3,"position",u,(()=>3))]),(0,t.l)("/nodes/{}/rotation",[new M(W.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",a,(()=>4))]),(0,t.l)("/nodes/{}/scale",[new M(W.b.ANIMATIONTYPE_VECTOR3,"qa",u,(()=>3))]),(0,t.l)("/nodes/{}/weights",[new E(W.b.ANIMATIONTYPE_FLOAT,"influence",H,(c=>c._numMorphTargets))])},13298:(c,r,D)=>{"use strict";class W{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((c,r)=>{this._resolve=c,this._reject=r}))}}var B=D(11683),t=D(11722),u=D(11487),a=D(12143),H=D(13306),x=D(13318),M=D(11494),E=D(12159),m=D(12202),Y=D(12208),v=D(11538),k=D(11509),w=D(11515);class Z{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(c){this._useTextureToStoreBoneMatrices=c,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(c){this._animationPropertiesOverride=c}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(c,r,D){this.name=c,this.id=r,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=B.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new M.c,this.bones=[],this._scene=D||v.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const W=this._scene.getEngine().getCaps();this._canUseTextureForBones=W.textureFloat&&W.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((c=>!c.getParent()))}getTransformMatrices(c){if(this.needInitialSkinMatrix){if(!c)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return c._bonesTransformMatrices||this.prepare(!0),c._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(c){return this.needInitialSkinMatrix&&c._transformMatrixTexture?c._transformMatrixTexture:this._transformMatrixTexture}yc(){return this._scene}toString(c){let r=`Name: ${this.name}, nBones: ${this.bones.length}`;if(r+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,c){r+=", Ranges: {";let c=!0;for(const D in this._ranges)c&&(r+=", ",c=!1),r+=D;r+="}"}return r}getBoneIndexByName(c){for(let r=0,D=this.bones.length;r<D;r++)if(this.bones[r].name===c)return r;return-1}createAnimationRange(c,r,D){if(!this._ranges[c]){this._ranges[c]=new Y.b(c,r,D);for(let W=0,B=this.bones.length;W<B;W++)this.bones[W].animations[0]&&this.bones[W].animations[0].createRange(c,r,D)}}deleteAnimationRange(c){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let D=0,W=this.bones.length;D<W;D++)this.bones[D].animations[0]&&this.bones[D].animations[0].deleteRange(c,r);this._ranges[c]=null}getAnimationRange(c){return this._ranges[c]||null}getAnimationRanges(){const c=[];let r;for(r in this._ranges)c.push(this._ranges[r]);return c}copyAnimationRange(c,r){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[r]||!c.getAnimationRange(r))return!1;let W=!0;const B=this._getHighestAnimationFrame()+1,t={},u=c.bones;let a,H;for(H=0,a=u.length;H<a;H++)t[u[H].name]=u[H];this.bones.length!==u.length&&(k.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${u.length}`),W=!1);const x=D&&this.dimensionsAtRest&&c.dimensionsAtRest?this.dimensionsAtRest.divide(c.dimensionsAtRest):null;for(H=0,a=this.bones.length;H<a;H++){const c=this.bones[H].name,u=t[c];u?W=W&&this.bones[H].copyAnimationRange(u,r,B,D,x):(k.e.Warn("copyAnimationRange: not same rig, missing source bone "+c),W=!1)}const M=c.getAnimationRange(r);return M&&(this._ranges[r]=new Y.b(r,M.from+B,M.to+B)),W}returnToRest(){for(const c of this.bones)-1!==c._index&&c.returnToRest()}_getHighestAnimationFrame(){let c=0;for(let r=0,D=this.bones.length;r<D;r++)if(this.bones[r].animations[0]){const D=this.bones[r].animations[0].getHighestFrame();c<D&&(c=D)}return c}beginAnimation(c,r,D,W){const B=this.getAnimationRange(c);return B?this._scene.beginAnimation(this,B.from,B.to,r,D,W):null}static MakeAnimationAdditive(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,D=arguments.length>2?arguments[2]:void 0;const W=c.getAnimationRange(D);if(!W)return null;const B=c._scene.getAllAnimatablesByTarget(c);let t=null;for(let a=0;a<B.length;a++){const c=B[a];if(c.fromFrame===(null===W||void 0===W?void 0:W.from)&&c.toFrame===(null===W||void 0===W?void 0:W.to)){t=c;break}}const u=c.getAnimatables();for(let a=0;a<u.length;a++){const c=u[a].animations;if(c)for(let W=0;W<c.length;W++)m.b.MakeAnimationAdditive(c[W],r,D)}return t&&(t.isAdditive=!0),c}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(c){this._meshesWithPoseMatrix.push(c)}_unregisterMeshWithPoseMatrix(c){const r=this._meshesWithPoseMatrix.indexOf(c);r>-1&&this._meshesWithPoseMatrix.splice(r,1)}_computeTransformMatrices(c,r){this.onBeforeComputeObservable.notifyObservers(this);for(let D=0;D<this.bones.length;D++){const W=this.bones[D];W._childUpdateId++;const B=W.getParent();if(B?W.getLocalMatrix().multiplyToRef(B.getFinalMatrix(),W.getFinalMatrix()):r?W.getLocalMatrix().multiplyToRef(r,W.getFinalMatrix()):W.getFinalMatrix().t(W.getLocalMatrix()),-1!==W._index){const r=null===W._index?D:W._index;W.getAbsoluteInverseBindMatrix().multiplyToArray(W.getFinalMatrix(),c,16*r)}}this._identity.copyToArray(c,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const c=this.yc().getRenderId();if(this._currentRenderId===c)return;this._currentRenderId=c}if(this._numBonesWithLinkedTransformNode>0)for(const c of this.bones)if(c._linkedTransformNode){const r=c._linkedTransformNode;c.position=r.position,r.rotationQuaternion?c.rotationQuaternion=r.rotationQuaternion:c.rotation=r.rotation,c.qa=r.qa}if(this.needInitialSkinMatrix)for(const c of this._meshesWithPoseMatrix){const r=c.getPoseMatrix();let D=this._isDirty;if(c._bonesTransformMatrices&&c._bonesTransformMatrices.length===16*(this.bones.length+1)||(c._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),D=!0),D){if(this._synchronizedWithMesh!==c){this._synchronizedWithMesh=c;for(const c of this.bones)if(!c.getParent()){c.getBindMatrix().multiplyToRef(r,B.TmpVectors.Matrix[1]),c._updateAbsoluteBindMatrices(B.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const r=4*(this.bones.length+1);c._transformMatrixTexture&&c._transformMatrixTexture.getSize().width===r||(c._transformMatrixTexture&&c._transformMatrixTexture.dispose(),c._transformMatrixTexture=E.e.CreateRGBATexture(c._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(c._bonesTransformMatrices,r),this.isUsingTextureForMatrices&&c._transformMatrixTexture&&c._transformMatrixTexture.update(c._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=E.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let c=0;c<this.bones.length;c++)this._animatables.push(this.bones[c])}return this._animatables}clone(c,r){const D=new Z(c,r||c,this._scene);D.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let W=0;W<this.bones.length;W++){const c=this.bones[W];let r=null;const B=c.getParent();if(B){const c=this.bones.indexOf(B);r=D.bones[c]}const t=new x.c(c.name,D,r,c.getBindMatrix().clone(),c.getRestMatrix().clone());t._index=c._index,c._linkedTransformNode&&t.linkTransformNode(c._linkedTransformNode),w.e.DeepCopy(c.animations,t.animations)}if(this._ranges){D._ranges={};for(const c in this._ranges){const r=this._ranges[c];r&&(D._ranges[c]=r.clone())}}return this._isDirty=!0,D.prepare(!0),D}enableBlending(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const r of this.bones)for(const D of r.animations)D.enableBlending=!0,D.blendingSpeed=c}dispose(){if(this._meshesWithPoseMatrix.length=0,this.yc().stopAnimation(this),this.yc().removeSkeleton(this),this._parentContainer){const c=this._parentContainer.skeletons.indexOf(this);c>-1&&this._parentContainer.skeletons.splice(c,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const c={};c.name=this.name,c.id=this.id,this.dimensionsAtRest&&(c.dimensionsAtRest=this.dimensionsAtRest.Ma()),c.bones=[],c.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let D=0;D<this.bones.length;D++){var r;const W=this.bones[D],B=W.getParent(),t={parentBoneIndex:B?this.bones.indexOf(B):-1,index:W.getIndex(),name:W.name,id:W.id,matrix:W.getBindMatrix().Ma(),rest:W.getRestMatrix().Ma(),linkedTransformNodeId:null===(r=W.getTransformNode())||void 0===r?void 0:r.id};c.bones.push(t),W.length&&(t.length=W.length),W.metadata&&(t.metadata=W.metadata),W.animations&&W.animations.length>0&&(t.animation=W.animations[0].serialize()),c.ranges=[];for(const r in this._ranges){const D=this._ranges[r];if(!D)continue;const W={};W.name=r,W.from=D.from,W.to=D.to,c.ranges.push(W)}}return c}static Parse(c,r){const D=new Z(c.name,c.id,r);let W;for(c.dimensionsAtRest&&(D.dimensionsAtRest=B.Zr.er(c.dimensionsAtRest)),D.needInitialSkinMatrix=c.needInitialSkinMatrix,W=0;W<c.bones.length;W++){const r=c.bones[W],t=c.bones[W].index;let u=null;r.parentBoneIndex>-1&&(u=D.bones[r.parentBoneIndex]);const a=r.rest?B.Matrix.er(r.rest):null,H=new x.c(r.name,D,u,B.Matrix.er(r.matrix),a,null,t);void 0!==r.id&&null!==r.id&&(H.id=r.id),r.length&&(H.length=r.length),r.metadata&&(H.metadata=r.metadata),r.animation&&H.animations.push(m.b.Parse(r.animation)),void 0!==r.linkedTransformNodeId&&null!==r.linkedTransformNodeId&&(D._hasWaitingData=!0,H._waitingTransformNodeId=r.linkedTransformNodeId)}if(c.ranges)for(W=0;W<c.ranges.length;W++){const r=c.ranges[W];D.createAnimationRange(r.name,r.from,r.to)}return D}computeAbsoluteMatrices(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||c)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(c)}getPoseMatrix(){let c=null;return this._meshesWithPoseMatrix.length>0&&(c=this._meshesWithPoseMatrix[0].getPoseMatrix()),c}sortBones(){const c=[],r=new Array(this.bones.length);for(let D=0;D<this.bones.length;D++)this._sortBones(D,c,r);this.bones=c}_sortBones(c,r,D){if(D[c])return;D[c]=!0;const W=this.bones[c];if(!W)return;void 0===W._index&&(W._index=c);const B=W.getParent();B&&this._sortBones(this.bones.indexOf(B),r,D),r.push(W)}setCurrentPoseAsRest(){for(const c of this.bones)c.setCurrentPoseAsRest()}}var J=D(12010),q=D(12172),j=D(11656),X=D(12096),e=D(11750),y=D(12147),U=D(12109),N=D(12135),g=D(12215),z=D(11766),S=D(13272);class K{set areUpdatesFrozen(c){c?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new z.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,c||(c=v.c.LastCreatedScene),this._scene=c,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const c=this._scene.getEngine().getCaps();this._canUseTextureForTargets=c.canUseGLVertexID&&c.textureFloat&&c.maxVertexTextureImageUnits>0&&c.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return K.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?K.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(c){this._numMaxInfluencers!==c&&(this._numMaxInfluencers=c,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(c){this._useTextureToStoreTargets!==c&&(this._useTextureToStoreTargets=c,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var c;return K.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(c=this._scene)&&void 0!==c&&c.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(c){return this._activeTargets.data[c]}getTarget(c){return this._targets[c]}getTargetByName(c){for(const r of this._targets)if(r.name===c)return r;return null}addTarget(c){this._targets.push(c),this._targetInfluenceChangedObservers.push(c.onInfluenceChanged.add((c=>{this.areUpdatesFrozen&&c&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(c)}))),this._targetDataLayoutChangedObservers.push(c._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(c){const r=this._targets.indexOf(c);r>=0&&(this._targets.splice(r,1),c.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(r,1)[0]),c._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(r,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(c)}_bind(c){c.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),c.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),c.setTexture("morphTargets",this._targetStoreTexture),c.setInt("morphTargetCount",this.numInfluencers)}clone(){const c=new K(this._scene);for(const r of this._targets)c.addTarget(r.clone());return c.enablePositionMorphing=this.enablePositionMorphing,c.enableNormalMorphing=this.enableNormalMorphing,c.enableTangentMorphing=this.enableTangentMorphing,c.enableUVMorphing=this.enableUVMorphing,c.enableUV2Morphing=this.enableUV2Morphing,c.enableColorMorphing=this.enableColorMorphing,c}serialize(){const c={};c.id=this.uniqueId,c.targets=[];for(const r of this._targets)c.targets.push(r.serialize());return c}_syncActiveTargets(){let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const r=!!this._targetStoreTexture,D=this.isUsingTextureForTargets;(this._mustSynchronize||r!==D)&&(this._mustSynchronize=!1,this.synchronize());let W=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let B=-1;for(const t of this._targets)if(B++,0!==t.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=K.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(t),this._morphTargetTextureIndices[W]=B,this._tempInfluences[W++]=t.influence}this._morphTargetTextureIndices.length!==W&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,W)),this._influences&&this._influences.length===W||(this._influences=new Float32Array(W));for(let t=0;t<W;t++)this._influences[t]=this._tempInfluences[t];if(c&&this._scene)for(const t of this._scene.meshes)t.morphTargetManager===this&&(D?t._markSubMeshesAsAttributesDirty():t._syncGeometryWithMorphTargetManager())}synchronize(){var c;if(!this._scene||this.areUpdatesFrozen)return;const r=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(c=this._targetStoreTexture)||void 0===c||c.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>r.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const D of this._targets){this._supportsPositions=this._supportsPositions&&D.hasPositions,this._supportsNormals=this._supportsNormals&&D.hasNormals,this._supportsTangents=this._supportsTangents&&D.hasTangents,this._supportsUVs=this._supportsUVs&&D.hasUVs,this._supportsUV2s=this._supportsUV2s&&D.hasUV2s,this._supportsColors=this._supportsColors&&D.hasColors;const c=D.vertexCount;if(0===this._vertexCount)this._vertexCount=c;else if(this._vertexCount!==c)return void k.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${D.name}": ${c}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const c=r.getCaps().maxTextureSize;this._textureWidth>c&&(this._textureHeight=Math.ceil(this._textureWidth/c),this._textureWidth=c);const D=this._targets.length,W=new Float32Array(D*this._textureWidth*this._textureHeight*4);let B=0;for(let r=0;r<D;r++){const c=this._targets[r],D=c.getPositions(),t=c.getNormals(),u=c.getUVs(),a=c.getTangents(),H=c.getUV2s(),x=c.getColors();B=r*this._textureWidth*this._textureHeight*4;for(let r=0;r<this._vertexCount;r++)this._supportsPositions&&D&&(W[B]=D[3*r],W[B+1]=D[3*r+1],W[B+2]=D[3*r+2],B+=4),this._supportsNormals&&t&&(W[B]=t[3*r],W[B+1]=t[3*r+1],W[B+2]=t[3*r+2],B+=4),this._supportsUVs&&u&&(W[B]=u[2*r],W[B+1]=u[2*r+1],B+=4),this._supportsTangents&&a&&(W[B]=a[3*r],W[B+1]=a[3*r+1],W[B+2]=a[3*r+2],B+=4),this._supportsUV2s&&H&&(W[B]=H[2*r],W[B+1]=H[2*r+1],B+=4),this._supportsColors&&x&&(W[B]=x[4*r],W[B+1]=x[4*r+1],W[B+2]=x[4*r+2],W[B+3]=x[4*r+3],B+=4)}this._targetStoreTexture=S.b.CreateRGBATexture(W,this._textureWidth,this._textureHeight,D,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const D of this._scene.meshes)D.morphTargetManager===this&&D._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const c=this._parentContainer.morphTargetManagers.indexOf(this);c>-1&&this._parentContainer.morphTargetManagers.splice(c,1),this._parentContainer=null}for(const c of this._targets)this._scene.stopAnimation(c)}}static Parse(c,r){const D=new K(r);for(const W of c.targets)D.addTarget(g.e.Parse(W,r));return D}}K.EnableTextureStorage=!0,K.MaxActiveMorphTargetsInVertexAttributeMode=8,K.ConstantTargetCountForTextureMode=0;var f=D(13322),A=D(11545),h=D(12028);const L=new Map,P=L;function G(c,r,D){d(c)&&k.e.Warn(`Extension with the name '${c}' already exists`),L.set(c,{isGLTFExtension:r,factory:D})}function d(c){return L.delete(c)}var T=D(13334),b=D(12272),O=D(11759);class C{static Get(c,r,D){if(!r||void 0==D||!r[D])throw new Error(`${c}: Failed to find index (${D})`);return r[D]}static TryGet(c,r){return c&&void 0!=r&&c[r]?c[r]:null}static Assign(c){if(c)for(let r=0;r<c.length;r++)c[r].index=r}}function p(c){if(c.min&&c.max){const r=c.min,D=c.max,W=B.TmpVectors.Zr[0].Ja(r[0],r[1],r[2]),t=B.TmpVectors.Zr[1].Ja(D[0],D[1],D[2]);if(c.normalized&&5126!==c.componentType){let r=1;switch(c.componentType){case 5120:r=127;break;case 5121:r=255;break;case 5122:r=32767;break;case 5123:r=65535}const D=1/r;W.scaleInPlace(D),t.scaleInPlace(D)}return new h.b(W,t)}return null}class R{static RegisterExtension(c,r){G(c,!1,r)}static UnregisterExtension(c){return d(c)}get ua(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(c){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=c}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((c=>c.dispose&&c.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(c,r,D,W,B,t){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=r,this._assetContainer=D,this._loadData(W);let t=null;if(c){const r={};if(this._gltf.nodes)for(const c of this._gltf.nodes)c.name&&(r[c.name]=c.index);t=(c instanceof Array?c:[c]).map((c=>{const D=r[c];if(void 0===D)throw new Error(`Failed to find node '${c}'`);return D}))}return await this._loadAsync(B,u,t,(()=>({meshes:this._getMeshes(),rm:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(c,r,D,W){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=c,this._loadData(r),await this._loadAsync(D,B,null,(()=>{}))}async _loadAsync(c,r,D,W){return await Promise.resolve().then((async()=>{this._rootUrl=c,this._uniqueRootUrl=!c.startsWith("file:")&&r?c:`${c}${Date.now()}/`,this._fileName=r,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const B=`${f.j[f.j.LOADING]} => ${f.j[f.j.READY]}`,t=`${f.j[f.j.LOADING]} => ${f.j[f.j.COMPLETE]}`;this._parent._startPerformanceCounter(B),this._parent._startPerformanceCounter(t),this._parent._setState(f.j.LOADING),this._extensionsOnLoading();const a=new Array;if(!this.parent.loadOnlyMaterials)if(D)a.push(this.loadSceneAsync("/nodes",{nodes:D,index:-1}));else if(void 0!=this._gltf.qr||this._gltf.scenes&&this._gltf.scenes[0]){const c=C.Get("/scene",this._gltf.scenes,this._gltf.qr||0);a.push(this.loadSceneAsync(`/scenes/${c.index}`,c))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let c=0;c<this._gltf.materials.length;++c){const r=this._gltf.materials[c],D="/materials/"+c,W=J.c.TriangleFillMode;a.push(this._loadMaterialAsync(D,r,null,W,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&a.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&a.push(this._compileShadowGeneratorsAsync());const H=Promise.all(a).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.pa(!0);for(const c of this._babylonScene.materials){const r=c;void 0!==r.maxSimultaneousLights&&(r.maxSimultaneousLights=Math.max(r.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(f.j.READY),this._skipStartAnimationStep||this._startAnimations(),W()}));return await H.then((c=>(this._parent._endPerformanceCounter(B),u.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(t),this._parent._setState(f.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(c=>{this._parent.onErrorObservable.notifyObservers(c),this._parent.onErrorObservable.clear(),this.dispose()}))})),c)))})).catch((c=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(c),this._parent.onErrorObservable.clear(),this.dispose()),c}))}_loadData(c){if(this._gltf=c.json,this._setupData(),c.bin){const r=this._gltf.buffers;if(r&&r[0]&&!r[0].uri){const D=r[0];(D.byteLength<c.bin.byteLength-3||D.byteLength>c.bin.byteLength)&&k.e.Warn(`Binary buffer length (${D.byteLength}) from JSON does not match chunk length (${c.bin.byteLength})`),this._bin=c.bin}else k.e.Warn("Unexpected BIN chunk")}}_setupData(){if(C.Assign(this._gltf.accessors),C.Assign(this._gltf.animations),C.Assign(this._gltf.buffers),C.Assign(this._gltf.bufferViews),C.Assign(this._gltf.cameras),C.Assign(this._gltf.images),C.Assign(this._gltf.materials),C.Assign(this._gltf.meshes),C.Assign(this._gltf.nodes),C.Assign(this._gltf.samplers),C.Assign(this._gltf.scenes),C.Assign(this._gltf.skins),C.Assign(this._gltf.textures),this._gltf.nodes){const c={};for(const D of this._gltf.nodes)if(D.children)for(const r of D.children)c[r]=D.index;const r=this._createRootNode();for(const D of this._gltf.nodes){const W=c[D.index];D.parent=void 0===W?r:this._gltf.nodes[W]}}}async _loadExtensionsAsync(){const c=[];if(P.forEach(((r,D)=>{var W;!1===(null===(W=this.parent.extensionOptions[D])||void 0===W?void 0:W.enabled)?r.isGLTFExtension&&this.isExtensionUsed(D)&&k.e.Warn(`Extension ${D} is used but has been explicitly disabled.`):r.isGLTFExtension&&!this.isExtensionUsed(D)||c.push((async()=>{const c=await r.factory(this);return c.name!==D&&k.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${c.name} !== ${D}`),this._parent.onExtensionLoadedObservable.notifyObservers(c),c})())})),this._extensions.push(...await Promise.all(c)),this._extensions.sort(((c,r)=>(c.order||Number.MAX_VALUE)-(r.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const D of this._gltf.extensionsRequired){if(!this._extensions.some((c=>c.name===D&&c.enabled))){var r;if(!1===(null===(r=this.parent.extensionOptions[D])||void 0===r?void 0:r.enabled))throw new Error(`Required extension ${D} is disabled`);throw new Error(`Required extension ${D} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new N.e("__root__",this._babylonScene);this._rootBabylonMesh=c,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.pa(!1);const r={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case f.i.AUTO:this._babylonScene.useRightHandedSystem||(r.rotation=[0,1,0,0],r.scale=[1,1,-1],R._LoadTransform(r,this._rootBabylonMesh));break;case f.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(c),r}loadSceneAsync(c,r){const D=this._extensionsLoadSceneAsync(c,r);if(D)return D;const W=new Array;if(this.logOpen(`${c} ${r.name||""}`),r.nodes)for(const B of r.nodes){const r=C.Get(`${c}/nodes/${B}`,this._gltf.nodes,B);W.push(this.loadNodeAsync(`/nodes/${r.index}`,r,(c=>{c.parent=this._rootBabylonMesh})))}for(const B of this._postSceneLoadActions)B();return W.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(W).then((()=>{}))}_forEachPrimitive(c,r){if(c._primitiveBabylonMeshes)for(const D of c._primitiveBabylonMeshes)r(D)}_getGeometries(){const c=[],r=this._gltf.nodes;if(r)for(const D of r)this._forEachPrimitive(D,(r=>{const D=r.ka;D&&-1===c.indexOf(D)&&c.push(D)}));return c}_getMeshes(){const c=[];this._rootBabylonMesh instanceof U.d&&c.push(this._rootBabylonMesh);const r=this._gltf.nodes;if(r)for(const D of r)this._forEachPrimitive(D,(r=>{c.push(r)}));return c}_getTransformNodes(){const c=[],r=this._gltf.nodes;if(r)for(const D of r)D._babylonTransformNode&&"Fv"===D._babylonTransformNode.getClassName()&&c.push(D._babylonTransformNode),D._babylonTransformNodeForSkin&&c.push(D._babylonTransformNodeForSkin);return c}_getSkeletons(){const c=[],r=this._gltf.skins;if(r)for(const D of r)D._data&&c.push(D._data.babylonSkeleton);return c}_getAnimationGroups(){const c=[],r=this._gltf.animations;if(r)for(const D of r)D._babylonAnimationGroup&&c.push(D._babylonAnimationGroup);return c}_startAnimations(){switch(this._parent.animationStartMode){case f.f.NONE:break;case f.f.FIRST:{const c=this._getAnimationGroups();0!==c.length&&c[0].start(!0);break}case f.f.ALL:{const c=this._getAnimationGroups();for(const r of c)r.start(!0);break}default:return void k.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const W=this._extensionsLoadNodeAsync(c,r,D);if(W)return W;if(r._babylonTransformNode)throw new Error(`${c}: Invalid recursive node hierarchy`);const B=new Array;this.logOpen(`${c} ${r.name||""}`);const t=W=>{if(R.AddPointerMetadata(W,c),R._LoadTransform(r,W),void 0!=r.camera){const D=C.Get(`${c}/camera`,this._gltf.cameras,r.camera);B.push(this.loadCameraAsync(`/cameras/${D.index}`,D,(c=>{c.parent=W,this._babylonScene.useRightHandedSystem||(W.qa.x=-1)})))}if(r.children)for(const D of r.children){const r=C.Get(`${c}/children/${D}`,this._gltf.nodes,D);B.push(this.loadNodeAsync(`/nodes/${r.index}`,r,(c=>{c.parent=W})))}D(W)},u=void 0!=r.mesh,a=this._parent.loadSkins&&void 0!=r.skin;if(!u||a){const c=r.name||`node${r.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const D=new X.e(c,this._babylonScene);D._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==r.mesh?r._babylonTransformNode=D:r._babylonTransformNodeForSkin=D,t(D)}if(u)if(a){const D=C.Get(`${c}/mesh`,this._gltf.meshes,r.mesh);B.push(this._loadMeshAsync(`/meshes/${D.index}`,r,D,(D=>{const W=r._babylonTransformNodeForSkin;D.metadata=(0,b.b)(W.metadata,D.metadata||{});const t=C.Get(`${c}/skin`,this._gltf.skins,r.skin);B.push(this._loadSkinAsync(`/skins/${t.index}`,r,t,(c=>{this._forEachPrimitive(r,(r=>{r.skeleton=c})),this._postSceneLoadActions.push((()=>{if(void 0!=t.skeleton){const c=C.Get(`/skins/${t.index}/skeleton`,this._gltf.nodes,t.skeleton).parent;r.index===c.index?D.parent=W.parent:D.parent=c._babylonTransformNode}else D.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:W,skinnedNode:D})}))})))})))}else{const D=C.Get(`${c}/mesh`,this._gltf.meshes,r.mesh);B.push(this._loadMeshAsync(`/meshes/${D.index}`,r,D,t))}return this.logClose(),Promise.all(B).then((()=>(this._forEachPrimitive(r,(c=>{const r=c;!r.isAnInstance&&r.ka&&r.ka.useBoundingInfoFromGeometry?c.hc():c.refreshBoundingInfo(!0,!0)})),r._babylonTransformNode)))}_loadMeshAsync(c,r,D,W){const B=D.primitives;if(!B||!B.length)throw new Error(`${c}: Primitives are missing`);void 0==B[0].index&&C.Assign(B);const t=new Array;this.logOpen(`${c} ${D.name||""}`);const u=r.name||`node${r.index}`;if(1===B.length){const W=D.primitives[0];t.push(this._loadMeshPrimitiveAsync(`${c}/primitives/${W.index}`,u,r,D,W,(c=>{r._babylonTransformNode=c,r._primitiveBabylonMeshes=[c]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,r._babylonTransformNode=new X.e(u,this._babylonScene),r._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r._primitiveBabylonMeshes=[];for(const W of B)t.push(this._loadMeshPrimitiveAsync(`${c}/primitives/${W.index}`,`${u}_primitive${W.index}`,r,D,W,(c=>{c.parent=r._babylonTransformNode,r._primitiveBabylonMeshes.push(c)})))}return W(r._babylonTransformNode),this.logClose(),Promise.all(t).then((()=>r._babylonTransformNode))}_loadMeshPrimitiveAsync(c,r,D,W,B,t){const u=this._extensionsLoadMeshPrimitiveAsync(c,r,D,W,B,t);if(u)return u;this.logOpen(`${c}`);const a=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==D.skin&&!W.primitives[0].targets;let H,x;if(a&&B._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,H=B._instanceData.babylonSourceMesh.createInstance(r),H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x=B._instanceData.promise;else{const t=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new N.e(r,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.sideOrientation=this._babylonScene.useRightHandedSystem?J.c.CounterClockWiseSideOrientation:J.c.ClockWiseSideOrientation,this._createMorphTargets(c,D,W,B,u),t.push(this._loadVertexDataAsync(c,B,u).then((async r=>await this._loadMorphTargetsAsync(c,B,u,r).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,r.fc(u),r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const M=R._GetDrawMode(c,B.mode);if(void 0==B.material){let c=this._defaultBabylonMaterialData[M];c||(c=this._createDefaultMaterial("__GLTFLoader._default",M),this._parent.onMaterialLoadedObservable.notifyObservers(c),this._defaultBabylonMaterialData[M]=c),u.material=c}else if(!this.parent.skipMaterials){const r=C.Get(`${c}/material`,this._gltf.materials,B.material);t.push(this._loadMaterialAsync(`/materials/${r.index}`,r,u,M,(c=>{u.material=c})))}x=Promise.all(t),a&&(B._instanceData={babylonSourceMesh:u,promise:x}),H=u}return R.AddPointerMetadata(H,c),this._parent.onMeshLoadedObservable.notifyObservers(H),t(H),this.logClose(),x.then((()=>H))}_loadVertexDataAsync(c,r,D){const W=this._extensionsLoadVertexDataAsync(c,r,D);if(W)return W;const B=r.attributes;if(!B)throw new Error(`${c}: Attributes are missing`);const t=new Array,u=new y.e(D.name,this._babylonScene);if(void 0==r.indices)D.isUnIndexed=!0;else{const D=C.Get(`${c}/indices`,this._gltf.accessors,r.indices);t.push(this._loadIndicesAccessorAsync(`/accessors/${D.index}`,D).then((c=>{u.setIndices(c)})))}const a=(r,W,a)=>{if(void 0==B[r])return;D._delayInfo=D._delayInfo||[],-1===D._delayInfo.indexOf(W)&&D._delayInfo.push(W);const H=C.Get(`${c}/attributes/${r}`,this._gltf.accessors,B[r]);t.push(this._loadVertexAccessorAsync(`/accessors/${H.index}`,H,W).then((c=>{if(c.getKind()===e.d.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!D.skeleton){const c=p(H);c&&(u._boundingInfo=c,u.useBoundingInfoFromGeometry=!0)}u.setVerticesBuffer(c,H.count)}))),W==e.d.MatricesIndicesExtraKind&&(D.numBoneInfluencers=8),a&&a(H)};return a("POSITION",e.d.PositionKind),a("NORMAL",e.d.NormalKind),a("TANGENT",e.d.TangentKind),a("TEXCOORD_0",e.d.UVKind),a("TEXCOORD_1",e.d.UV2Kind),a("TEXCOORD_2",e.d.UV3Kind),a("TEXCOORD_3",e.d.UV4Kind),a("TEXCOORD_4",e.d.UV5Kind),a("TEXCOORD_5",e.d.UV6Kind),a("JOINTS_0",e.d.MatricesIndicesKind),a("WEIGHTS_0",e.d.MatricesWeightsKind),a("JOINTS_1",e.d.MatricesIndicesExtraKind),a("WEIGHTS_1",e.d.MatricesWeightsExtraKind),a("COLOR_0",e.d.ColorKind,(c=>{"VEC4"===c.type&&(D.hasVertexAlpha=!0)})),Promise.all(t).then((()=>u))}_createMorphTargets(c,r,D,W,B){if(!W.targets||!this._parent.loadMorphTargets)return;if(void 0==r._numMorphTargets)r._numMorphTargets=W.targets.length;else if(W.targets.length!==r._numMorphTargets)throw new Error(`${c}: Primitives do not have the same number of targets`);const t=D.extras?D.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,B.morphTargetManager=new K(this._babylonScene),B.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.morphTargetManager.areUpdatesFrozen=!0;for(let u=0;u<W.targets.length;u++){const c=r.weights?r.weights[u]:D.weights?D.weights[u]:0,W=t?t[u]:`morphTarget${u}`;B.morphTargetManager.addTarget(new g.e(W,c,B.yc()))}}_loadMorphTargetsAsync(c,r,D,W){if(!r.targets||!this._parent.loadMorphTargets)return Promise.resolve();const B=new Array,t=D.morphTargetManager;for(let u=0;u<t.numTargets;u++){const D=t.getTarget(u);B.push(this._loadMorphTargetVertexDataAsync(`${c}/targets/${u}`,W,r.targets[u],D))}return Promise.all(B).then((()=>{t.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(c,r,D,W){const B=new Array,t=(W,t,u)=>{if(void 0==D[W])return;const a=r.getVertexBuffer(t);if(!a)return;const H=C.Get(`${c}/${W}`,this._gltf.accessors,D[W]);B.push(this._loadFloatAccessorAsync(`/accessors/${H.index}`,H).then((c=>{u(a,c)})))};return t("POSITION",e.d.PositionKind,((c,r)=>{const D=new Float32Array(r.length);c.forEach(r.length,((c,W)=>{D[W]=r[W]+c})),W.setPositions(D)})),t("NORMAL",e.d.NormalKind,((c,r)=>{const D=new Float32Array(r.length);c.forEach(D.length,((c,W)=>{D[W]=r[W]+c})),W.setNormals(D)})),t("TANGENT",e.d.TangentKind,((c,r)=>{const D=new Float32Array(r.length/3*4);let B=0;c.forEach(r.length/3*4,((c,W)=>{(W+1)%4!==0&&(D[B]=r[B]+c,B++)})),W.setTangents(D)})),t("TEXCOORD_0",e.d.UVKind,((c,r)=>{const D=new Float32Array(r.length);c.forEach(r.length,((c,W)=>{D[W]=r[W]+c})),W.setUVs(D)})),t("TEXCOORD_1",e.d.UV2Kind,((c,r)=>{const D=new Float32Array(r.length);c.forEach(r.length,((c,W)=>{D[W]=r[W]+c})),W.setUV2s(D)})),t("COLOR_0",e.d.ColorKind,((r,D)=>{let B=null;const t=r.getSize();if(3===t){B=new Float32Array(D.length/3*4),r.forEach(D.length,((c,r)=>{const W=Math.floor(r/3),t=r%3;B[4*W+t]=D[3*W+t]+c}));for(let c=0;c<D.length/3;++c)B[4*c+3]=1}else{if(4!==t)throw new Error(`${c}: Invalid number of components (${t}) for COLOR_0 attribute`);B=new Float32Array(D.length),r.forEach(D.length,((c,r)=>{B[r]=D[r]+c}))}W.setColors(B)})),await Promise.all(B).then((()=>{}))}static _LoadTransform(c,r){if(void 0!=c.skin)return;let D=B.Zr.Zero(),W=B.Quaternion.Identity(),t=B.Zr.One();if(c.matrix){B.Matrix.er(c.matrix).decompose(t,W,D)}else c.translation&&(D=B.Zr.er(c.translation)),c.rotation&&(W=B.Quaternion.er(c.rotation)),c.scale&&(t=B.Zr.er(c.scale));r.position=D,r.rotationQuaternion=W,r.qa=t}_loadSkinAsync(c,r,D,W){if(!this._parent.loadSkins)return Promise.resolve();const B=this._extensionsLoadSkinAsync(c,r,D);if(B)return B;if(D._data)return W(D._data.babylonSkeleton),D._data.promise;const t=`skeleton${D.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new Z(D.name||t,t,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(c,D,u);const a=this._loadSkinInverseBindMatricesDataAsync(c,D).then((c=>{this._updateBoneMatrices(u,c)}));return D._data={babylonSkeleton:u,promise:a},W(u),a}_loadBones(c,r,D){if(void 0==r.skeleton||this._parent.alwaysComputeSkeletonRootNode){const D=this._findSkeletonRootNode(`${c}/joints`,r.joints);if(D)if(void 0===r.skeleton)r.skeleton=D.index;else{const W=(c,r)=>{for(;r.parent;r=r.parent)if(r.parent===c)return!0;return!1},B=C.Get(`${c}/skeleton`,this._gltf.nodes,r.skeleton);B===D||W(B,D)||(k.e.Warn(`${c}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),r.skeleton=D.index)}else k.e.Warn(`${c}: Failed to find common root`)}const W={};for(const B of r.joints){const t=C.Get(`${c}/joints/${B}`,this._gltf.nodes,B);this._loadBone(t,r,D,W)}}_findSkeletonRootNode(c,r){if(0===r.length)return null;const D={};for(const B of r){const r=[];let W=C.Get(`${c}/${B}`,this._gltf.nodes,B);for(;-1!==W.index;)r.unshift(W),W=W.parent;D[B]=r}let W=null;for(let B=0;;++B){let c=D[r[0]];if(B>=c.length)return W;const t=c[B];for(let u=1;u<r.length;++u)if(c=D[r[u]],B>=c.length||t!==c[B])return W;W=t}}_loadBone(c,r,D,W){c._isJoint=!0;let B=W[c.index];if(B)return B;let t=null;c.index!==r.skeleton&&(c.parent&&-1!==c.parent.index?t=this._loadBone(c.parent,r,D,W):void 0!==r.skeleton&&k.e.Warn(`/skins/${r.index}/skeleton: Skeleton node is not a common root`));const u=r.joints.indexOf(c.index);return B=new x.c(c.name||`joint${c.index}`,D,t,this._getNodeMatrix(c),null,null,u),W[c.index]=B,this._postSceneLoadActions.push((()=>{B.linkTransformNode(c._babylonTransformNode)})),B}_loadSkinInverseBindMatricesDataAsync(c,r){if(void 0==r.inverseBindMatrices)return Promise.resolve(null);const D=C.Get(`${c}/inverseBindMatrices`,this._gltf.accessors,r.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${D.index}`,D)}_updateBoneMatrices(c,r){for(const D of c.bones){const c=B.Matrix.Identity(),W=D._index;r&&-1!==W&&(B.Matrix.FromArrayToRef(r,16*W,c),c.invertToRef(c));const t=D.getParent();t&&c.multiplyToRef(t.getAbsoluteInverseBindMatrix(),c),D.Ya(c,!1,!1),D._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(c){return c.matrix?B.Matrix.er(c.matrix):B.Matrix.Compose(c.scale?B.Zr.er(c.scale):B.Zr.One(),c.rotation?B.Quaternion.er(c.rotation):B.Quaternion.Identity(),c.translation?B.Zr.er(c.translation):B.Zr.Zero())}loadCameraAsync(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const W=this._extensionsLoadCameraAsync(c,r,D);if(W)return W;const t=new Array;this.logOpen(`${c} ${r.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new H.d(r.name||`camera${r.index}`,B.Zr.Zero(),this._babylonScene,!1);switch(u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r._babylonCamera=u,u.setTarget(new B.Zr(0,0,-1)),r.type){case"perspective":{const D=r.perspective;if(!D)throw new Error(`${c}: Camera perspective properties are missing`);u.fov=D.yfov,u.ma=D.znear,u.maxZ=D.zfar||0;break}case"orthographic":if(!r.orthographic)throw new Error(`${c}: Camera orthographic properties are missing`);u.mode=a.d.ORTHOGRAPHIC_CAMERA,u.orthoLeft=-r.orthographic.xmag,u.orthoRight=r.orthographic.xmag,u.orthoBottom=-r.orthographic.ymag,u.orthoTop=r.orthographic.ymag,u.ma=r.orthographic.znear,u.maxZ=r.orthographic.zfar;break;default:throw new Error(`${c}: Invalid camera type (${r.type})`)}return R.AddPointerMetadata(u,c),this._parent.onCameraLoadedObservable.notifyObservers(u),D(u),this.logClose(),Promise.all(t).then((()=>u))}_loadAnimationsAsync(){const c=this._gltf.animations;if(!c)return Promise.resolve();const r=new Array;for(let D=0;D<c.length;D++){const W=c[D];r.push(this.loadAnimationAsync(`/animations/${W.index}`,W).then((c=>{0===c.targetedAnimations.length&&c.dispose()})))}return Promise.all(r).then((()=>{}))}loadAnimationAsync(c,r){const W=this._extensionsLoadAnimationAsync(c,r);return W||D.e(78).then(D.bind(D,14880)).then((D=>{let{AnimationGroup:W}=D;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new W(r.name||`animation${r.index}`,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r._babylonAnimationGroup=B;const t=new Array;C.Assign(r.channels),C.Assign(r.samplers);for(const u of r.channels)t.push(this._loadAnimationChannelAsync(`${c}/channels/${u.index}`,c,r,u,((c,r)=>{c.animations=c.animations||[],c.animations.push(r),B.addTargetedAnimation(r,c)})));return Promise.all(t).then((()=>(B.normalize(0),B)))}))}async _loadAnimationChannelAsync(c,r,W,B,t){const u=this._extensionsLoadAnimationChannelAsync(c,r,W,B,t);if(u)return await u;if(void 0==B.target.node)return await Promise.resolve();const a=C.Get(`${c}/target/node`,this._gltf.nodes,B.target.node),H=B.target.path,x="weights"===H;if(x&&!a._numMorphTargets||!x&&!a._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!x&&!a._isJoint)return await Promise.resolve();let M;switch(await Promise.resolve().then(D.bind(D,13342)),H){case"translation":var E;M=null===(E=(0,T.g)("/nodes/{}/translation"))||void 0===E?void 0:E.interpolation;break;case"rotation":var m;M=null===(m=(0,T.g)("/nodes/{}/rotation"))||void 0===m?void 0:m.interpolation;break;case"scale":var Y;M=null===(Y=(0,T.g)("/nodes/{}/scale"))||void 0===Y?void 0:Y.interpolation;break;case"weights":var v;M=null===(v=(0,T.g)("/nodes/{}/weights"))||void 0===v?void 0:v.interpolation;break;default:throw new Error(`${c}/target/path: Invalid value (${B.target.path})`)}if(!M)throw new Error(`${c}/target/path: Could not find interpolation properties for target path (${B.target.path})`);const k={object:a,info:M};return await this._loadAnimationChannelFromTargetInfoAsync(c,r,W,B,k,t)}_loadAnimationChannelFromTargetInfoAsync(c,r,D,W,B,t){const u=this.parent.targetFps,a=1/u,H=C.Get(`${c}/sampler`,D.samplers,W.sampler);return this._loadAnimationSamplerAsync(`${r}/samplers/${W.sampler}`,H).then((c=>{let r=0;const H=B.object,x=B.info;for(const B of x){const x=B.getStride(H),M=c.input,E=c.output,m=new Array(M.length);let Y=0;switch(c.interpolation){case"STEP":for(let c=0;c<M.length;c++){const r=B.getValue(H,E,Y,1);Y+=x,m[c]={frame:M[c]*u,value:r,interpolation:1}}break;case"CUBICSPLINE":for(let c=0;c<M.length;c++){const r=B.getValue(H,E,Y,a);Y+=x;const D=B.getValue(H,E,Y,1);Y+=x;const W=B.getValue(H,E,Y,a);Y+=x,m[c]={frame:M[c]*u,inTangent:r,value:D,outTangent:W}}break;case"LINEAR":for(let c=0;c<M.length;c++){const r=B.getValue(H,E,Y,1);Y+=x,m[c]={frame:M[c]*u,value:r}}}if(Y>0){const c=`${D.name||`animation${D.index}`}_channel${W.index}_${r}`,a=B.buildAnimations(H,c,u,m);for(const D of a)r++,t(D.babylonAnimatable,D.babylonAnimation)}}}))}_loadAnimationSamplerAsync(c,r){if(r._data)return r._data;const D=r.interpolation||"LINEAR";switch(D){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${c}/interpolation: Invalid value (${r.interpolation})`)}const W=C.Get(`${c}/input`,this._gltf.accessors,r.input),B=C.Get(`${c}/output`,this._gltf.accessors,r.output);return r._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${W.index}`,W),this._loadFloatAccessorAsync(`/accessors/${B.index}`,B)]).then((c=>{let[r,W]=c;return{input:r,interpolation:D,output:W}})),r._data}loadBufferAsync(c,r,D,W){const B=this._extensionsLoadBufferAsync(c,r,D,W);if(B)return B;if(!r._data)if(r.uri)r._data=this.loadUriAsync(`${c}/uri`,r,r.uri);else{if(!this._bin)throw new Error(`${c}: Uri is missing or the binary glTF is missing its binary chunk`);r._data=this._bin.readAsync(0,r.byteLength)}return r._data.then((r=>{try{return new Uint8Array(r.buffer,r.byteOffset+D,W)}catch(B){throw new Error(`${c}: ${B.message}`)}}))}loadBufferViewAsync(c,r){const D=this._extensionsLoadBufferViewAsync(c,r);if(D)return D;if(r._data)return r._data;const W=C.Get(`${c}/buffer`,this._gltf.buffers,r.buffer);return r._data=this.loadBufferAsync(`/buffers/${W.index}`,W,r.byteOffset||0,r.byteLength),r._data}_loadAccessorAsync(c,r,D){if(r._data)return r._data;const W=R._GetNumComponents(c,r.type),B=W*e.d.GetTypeByteLength(r.componentType),t=W*r.count;if(void 0==r.bufferView)r._data=Promise.resolve(new D(t));else{const u=C.Get(`${c}/bufferView`,this._gltf.bufferViews,r.bufferView);r._data=this.loadBufferViewAsync(`/bufferViews/${u.index}`,u).then((a=>{if(5126!==r.componentType||r.normalized||u.byteStride&&u.byteStride!==B){const c=new D(t);return e.d.ForEach(a,r.byteOffset||0,u.byteStride||B,W,r.componentType,c.length,r.normalized||!1,((r,D)=>{c[D]=r})),c}return R._GetTypedArray(c,r.componentType,a,r.byteOffset,t)}))}if(r.sparse){const t=r.sparse;r._data=r._data.then((u=>{const a=u,H=C.Get(`${c}/sparse/indices/bufferView`,this._gltf.bufferViews,t.indices.bufferView),x=C.Get(`${c}/sparse/values/bufferView`,this._gltf.bufferViews,t.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${H.index}`,H),this.loadBufferViewAsync(`/bufferViews/${x.index}`,x)]).then((u=>{let[H,x]=u;const M=R._GetTypedArray(`${c}/sparse/indices`,t.indices.componentType,H,t.indices.byteOffset,t.count),E=W*t.count;let m;if(5126!==r.componentType||r.normalized){const u=R._GetTypedArray(`${c}/sparse/values`,r.componentType,x,t.values.byteOffset,E);m=new D(E),e.d.ForEach(u,0,B,W,r.componentType,m.length,r.normalized||!1,((c,r)=>{m[r]=c}))}else m=R._GetTypedArray(`${c}/sparse/values`,r.componentType,x,t.values.byteOffset,E);let Y=0;for(let c=0;c<M.length;c++){let r=M[c]*W;for(let c=0;c<W;c++)a[r++]=m[Y++]}return a}))}))}return r._data}_loadFloatAccessorAsync(c,r){return this._loadAccessorAsync(c,r,Float32Array)}_loadIndicesAccessorAsync(c,r){if("SCALAR"!==r.type)throw new Error(`${c}/type: Invalid value ${r.type}`);if(5121!==r.componentType&&5123!==r.componentType&&5125!==r.componentType)throw new Error(`${c}/componentType: Invalid value ${r.componentType}`);if(r._data)return r._data;if(r.sparse){const D=R._GetTypedArrayConstructor(`${c}/componentType`,r.componentType);r._data=this._loadAccessorAsync(c,r,D)}else{const D=C.Get(`${c}/bufferView`,this._gltf.bufferViews,r.bufferView);r._data=this.loadBufferViewAsync(`/bufferViews/${D.index}`,D).then((D=>R._GetTypedArray(c,r.componentType,D,r.byteOffset,r.count)))}return r._data}_loadVertexBufferViewAsync(c){if(c._babylonBuffer)return c._babylonBuffer;const r=this._babylonScene.getEngine();return c._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${c.index}`,c).then((c=>new e.b(r,c,!1))),c._babylonBuffer}_loadVertexAccessorAsync(c,r,D){var W;if(null!==(W=r._babylonVertexBuffer)&&void 0!==W&&W[D])return r._babylonVertexBuffer[D];r._babylonVertexBuffer||(r._babylonVertexBuffer={});const B=this._babylonScene.getEngine();if(r.sparse||void 0==r.bufferView)r._babylonVertexBuffer[D]=this._loadFloatAccessorAsync(c,r).then((c=>new e.d(B,c,D,!1)));else{const W=C.Get(`${c}/bufferView`,this._gltf.bufferViews,r.bufferView);r._babylonVertexBuffer[D]=this._loadVertexBufferViewAsync(W).then((t=>{const u=R._GetNumComponents(c,r.type);return new e.d(B,t,D,!1,void 0,W.byteStride,void 0,r.byteOffset,u,r.componentType,r.normalized,!0,void 0,!0)}))}return r._babylonVertexBuffer[D]}_loadMaterialMetallicRoughnessPropertiesAsync(c,r,D){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);const W=new Array;return r&&(r.baseColorFactor?(D.albedoColor=t.Xr.er(r.baseColorFactor),D.alpha=r.baseColorFactor[3]):D.albedoColor=t.Xr.White(),D.metallic=void 0==r.metallicFactor?1:r.metallicFactor,D.roughness=void 0==r.roughnessFactor?1:r.roughnessFactor,r.baseColorTexture&&W.push(this.loadTextureInfoAsync(`${c}/baseColorTexture`,r.baseColorTexture,(c=>{c.name=`${D.name} (Base Color)`,D.albedoTexture=c}))),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture.nonColorData=!0,W.push(this.loadTextureInfoAsync(`${c}/metallicRoughnessTexture`,r.metallicRoughnessTexture,(c=>{c.name=`${D.name} (Metallic Roughness)`,D.metallicTexture=c}))),D.useMetallnessFromMetallicTextureBlue=!0,D.useRoughnessFromMetallicTextureGreen=!0,D.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(W).then((()=>{}))}_loadMaterialAsync(c,r,D,W){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const t=this._extensionsLoadMaterialAsync(c,r,D,W,B);if(t)return t;r._data=r._data||{};let u=r._data[W];if(!u){this.logOpen(`${c} ${r.name||""}`);const D=this.createMaterial(c,r,W);u={babylonMaterial:D,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(c,r,D)},r._data[W]=u,R.AddPointerMetadata(D,c),this._parent.onMaterialLoadedObservable.notifyObservers(D),this.logClose()}return D&&(u.babylonMeshes.push(D),D.Wa.addOnce((()=>{const c=u.babylonMeshes.indexOf(D);-1!==c&&u.babylonMeshes.splice(c,1)}))),B(u.babylonMaterial),u.promise.then((()=>u.babylonMaterial))}_createDefaultMaterial(c,r){this._babylonScene._blockEntityCollection=!!this._assetContainer;const D=new q.d(c,this._babylonScene);return D._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,D.fillMode=r,D.enableSpecularAntiAliasing=!0,D.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,D.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,D.transparencyMode=q.d.PBRMATERIAL_OPAQUE,D.metallic=1,D.roughness=1,D}createMaterial(c,r,D){const W=this._extensionsCreateMaterial(c,r,D);if(W)return W;const B=r.name||`material${r.index}`;return this._createDefaultMaterial(B,D)}loadMaterialPropertiesAsync(c,r,D){const W=this._extensionsLoadMaterialPropertiesAsync(c,r,D);if(W)return W;const B=new Array;return B.push(this.loadMaterialBasePropertiesAsync(c,r,D)),r.pbrMetallicRoughness&&B.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${c}/pbrMetallicRoughness`,r.pbrMetallicRoughness,D)),this.loadMaterialAlphaProperties(c,r,D),Promise.all(B).then((()=>{}))}loadMaterialBasePropertiesAsync(c,r,D){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);const W=new Array;return D.emissiveColor=r.emissiveFactor?t.Xr.er(r.emissiveFactor):new t.Xr(0,0,0),r.doubleSided&&(D.Za=!1,D.twoSidedLighting=!0),r.normalTexture&&(r.normalTexture.nonColorData=!0,W.push(this.loadTextureInfoAsync(`${c}/normalTexture`,r.normalTexture,(c=>{c.name=`${D.name} (Normal)`,D.bumpTexture=c}))),D.invertNormalMapX=!this._babylonScene.useRightHandedSystem,D.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=r.normalTexture.scale&&D.bumpTexture&&(D.bumpTexture.level=r.normalTexture.scale),D.forceIrradianceInFragment=!0),r.occlusionTexture&&(r.occlusionTexture.nonColorData=!0,W.push(this.loadTextureInfoAsync(`${c}/occlusionTexture`,r.occlusionTexture,(c=>{c.name=`${D.name} (Occlusion)`,D.ambientTexture=c}))),D.useAmbientInGrayScale=!0,void 0!=r.occlusionTexture.strength&&(D.ambientTextureStrength=r.occlusionTexture.strength)),r.emissiveTexture&&W.push(this.loadTextureInfoAsync(`${c}/emissiveTexture`,r.emissiveTexture,(c=>{c.name=`${D.name} (Emissive)`,D.emissiveTexture=c}))),Promise.all(W).then((()=>{}))}loadMaterialAlphaProperties(c,r,D){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);switch(r.alphaMode||"OPAQUE"){case"OPAQUE":D.transparencyMode=q.d.PBRMATERIAL_OPAQUE,D.alpha=1;break;case"MASK":D.transparencyMode=q.d.PBRMATERIAL_ALPHATEST,D.alphaCutOff=void 0==r.alphaCutoff?.5:r.alphaCutoff,D.albedoTexture&&(D.albedoTexture.Ea=!0);break;case"BLEND":D.transparencyMode=q.d.PBRMATERIAL_ALPHABLEND,D.albedoTexture&&(D.albedoTexture.Ea=!0,D.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${c}/alphaMode: Invalid value (${r.alphaMode})`)}}loadTextureInfoAsync(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const W=this._extensionsLoadTextureInfoAsync(c,r,D);if(W)return W;if(this.logOpen(`${c}`),r.texCoord>=6)throw new Error(`${c}/texCoord: Invalid value (${r.texCoord})`);const B=C.Get(`${c}/index`,this._gltf.textures,r.index);B._textureInfo=r;const t=this._loadTextureAsync(`/textures/${r.index}`,B,(W=>{W.coordinatesIndex=r.texCoord||0,R.AddPointerMetadata(W,c),this._parent.onTextureLoadedObservable.notifyObservers(W),D(W)}));return this.logClose(),t}_loadTextureAsync(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const W=this._extensionsLoadTextureAsync(c,r,D);if(W)return W;this.logOpen(`${c} ${r.name||""}`);const B=void 0==r.sampler?R.DefaultSampler:C.Get(`${c}/sampler`,this._gltf.samplers,r.sampler),t=C.Get(`${c}/source`,this._gltf.images,r.source),u=this._createTextureAsync(c,B,t,D,void 0,!r._textureInfo.nonColorData);return this.logClose(),u}_createTextureAsync(c,r,D){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},t=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0;const a=this._loadSampler(`/samplers/${r.index}`,r),H=new Array,x=new W;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M={noMipmap:a.noMipMaps,invertY:!1,samplingMode:a.samplingMode,F:()=>{this._disposed||x.resolve()},onError:(r,D)=>{this._disposed||x.reject(new Error(`${c}: ${D&&D.message?D.message:r||"Failed to load texture"}`))},mimeType:D.mimeType??(0,A.i)(D.uri??""),loaderOptions:t,useSRGBBuffer:!!u&&this._parent.useSRGBBuffers},E=new j.b(null,this._babylonScene,M);return E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.push(x.promise),H.push(this.loadImageAsync(`/images/${D.index}`,D).then((c=>{const r=D.uri||`${this._fileName}#image${D.index}`,W=`data:${this._uniqueRootUrl}${r}`;E.updateURL(W,c);const B=E.getInternalTexture();B&&(B.label=D.name)}))),E.wrapU=a.wrapU,E.wrapV=a.wrapV,B(E),this._parent.useGltfTextureNames&&(E.name=D.name||D.uri||`image${D.index}`),Promise.all(H).then((()=>E))}_loadSampler(c,r){return r._data||(r._data={noMipMaps:9728===r.minFilter||9729===r.minFilter,samplingMode:R._GetTextureSamplingMode(c,r),wrapU:R._GetTextureWrapMode(`${c}/wrapS`,r.wrapS),wrapV:R._GetTextureWrapMode(`${c}/wrapT`,r.wrapT)}),r._data}loadImageAsync(c,r){if(!r._data){if(this.logOpen(`${c} ${r.name||""}`),r.uri)r._data=this.loadUriAsync(`${c}/uri`,r,r.uri);else{const D=C.Get(`${c}/bufferView`,this._gltf.bufferViews,r.bufferView);r._data=this.loadBufferViewAsync(`/bufferViews/${D.index}`,D)}this.logClose()}return r._data}loadUriAsync(c,r,D){const W=this._extensionsLoadUriAsync(c,r,D);if(W)return W;if(!R._ValidateUri(D))throw new Error(`${c}: '${D}' is invalid`);if((0,A.j)(D)){const r=new Uint8Array((0,A.b)(D));return this.log(`${c}: Decoded ${D.substring(0,64)}... (${r.length} bytes)`),Promise.resolve(r)}return this.log(`${c}: Loading ${D}`),this._parent.preprocessUrlAsync(this._rootUrl+D).then((r=>new Promise(((W,B)=>{this._parent._loadFile(this._babylonScene,r,(r=>{this._disposed||(this.log(`${c}: Loaded ${D} (${r.byteLength} bytes)`),W(new Uint8Array(r)))}),!0,(r=>{B(new A.l(`${c}: Failed to load '${D}'${r?": "+r.status+" "+r.statusText:""}`,r))}))}))))}static AddPointerMetadata(c,r){c.metadata=c.metadata||{};const D=c._internalMetadata=c._internalMetadata||{},W=D.ua=D.ua||{};(W.pointers=W.pointers||[]).push(r)}static _GetTextureWrapMode(c,r){switch(r=void 0==r?10497:r){case 33071:return j.b.CLAMP_ADDRESSMODE;case 33648:return j.b.MIRROR_ADDRESSMODE;case 10497:return j.b.WRAP_ADDRESSMODE;default:return k.e.Warn(`${c}: Invalid value (${r})`),j.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(c,r){const D=void 0==r.magFilter?9729:r.magFilter,W=void 0==r.minFilter?9987:r.minFilter;if(9729===D)switch(W){case 9728:return j.b.LINEAR_NEAREST;case 9729:return j.b.LINEAR_LINEAR;case 9984:return j.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return j.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return j.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return j.b.LINEAR_LINEAR_MIPLINEAR;default:return k.e.Warn(`${c}/minFilter: Invalid value (${W})`),j.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==D&&k.e.Warn(`${c}/magFilter: Invalid value (${D})`),W){case 9728:return j.b.NEAREST_NEAREST;case 9729:return j.b.NEAREST_LINEAR;case 9984:return j.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return j.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return j.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return j.b.NEAREST_LINEAR_MIPLINEAR;default:return k.e.Warn(`${c}/minFilter: Invalid value (${W})`),j.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(c,r){try{return(0,O.r)(r)}catch(D){throw new Error(`${c}: ${D.message}`)}}static _GetTypedArray(c,r,D,W,B){const t=D.buffer;W=D.byteOffset+(W||0);const u=R._GetTypedArrayConstructor(`${c}/componentType`,r),a=e.d.GetTypeByteLength(r);return W%a!==0?(k.e.Warn(`${c}: Copying buffer as byte offset (${W}) is not a multiple of component type byte length (${a})`),new u(t.slice(W,W+B*a),0)):new u(t,W,B)}static _GetNumComponents(c,r){switch(r){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${c}: Invalid type (${r})`)}static _ValidateUri(c){return u.Tools.IsBase64(c)||-1===c.indexOf("..")}static _GetDrawMode(c,r){switch(void 0==r&&(r=4),r){case 0:return J.c.PointListDrawMode;case 1:return J.c.LineListDrawMode;case 2:return J.c.LineLoopDrawMode;case 3:return J.c.LineStripDrawMode;case 4:return J.c.TriangleFillMode;case 5:return J.c.TriangleStripDrawMode;case 6:return J.c.TriangleFanDrawMode}throw new Error(`${c}: Invalid mesh primitive mode (${r})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const c=new Array;if(this._gltf.materials)for(const r of this._gltf.materials)if(r._data)for(const D in r._data){const W=r._data[D];for(const r of W.babylonMeshes){r.va(!0);const D=W.babylonMaterial;c.push(D.forceCompilationAsync(r)),c.push(D.forceCompilationAsync(r,{useInstances:!0})),this._parent.useClipPlane&&(c.push(D.forceCompilationAsync(r,{clipPlane:!0})),c.push(D.forceCompilationAsync(r,{clipPlane:!0,useInstances:!0})))}}return Promise.all(c).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const c=new Array,r=this._babylonScene.lights;for(const D of r){const r=D.getShadowGenerator();r&&c.push(r.forceCompilationAsync())}return Promise.all(c).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(c){for(const r of this._extensions)r.enabled&&c(r)}_applyExtensions(c,r,D){for(const W of this._extensions)if(W.enabled){const B=`${W.name}.${r}`,t=c;t._activeLoaderExtensionFunctions=t._activeLoaderExtensionFunctions||{};const u=t._activeLoaderExtensionFunctions;if(!u[B]){u[B]=!0;try{const c=D(W);if(c)return c}finally{delete u[B]}}}return null}_extensionsOnLoading(){this._forEachExtensions((c=>c.onLoading&&c.onLoading()))}_extensionsOnReady(){this._forEachExtensions((c=>c.onReady&&c.onReady()))}_extensionsLoadSceneAsync(c,r){return this._applyExtensions(r,"loadScene",(D=>D.loadSceneAsync&&D.loadSceneAsync(c,r)))}_extensionsLoadNodeAsync(c,r,D){return this._applyExtensions(r,"loadNode",(W=>W.loadNodeAsync&&W.loadNodeAsync(c,r,D)))}_extensionsLoadCameraAsync(c,r,D){return this._applyExtensions(r,"loadCamera",(W=>W.loadCameraAsync&&W.loadCameraAsync(c,r,D)))}_extensionsLoadVertexDataAsync(c,r,D){return this._applyExtensions(r,"loadVertexData",(W=>W._loadVertexDataAsync&&W._loadVertexDataAsync(c,r,D)))}_extensionsLoadMeshPrimitiveAsync(c,r,D,W,B,t){return this._applyExtensions(B,"loadMeshPrimitive",(u=>u._loadMeshPrimitiveAsync&&u._loadMeshPrimitiveAsync(c,r,D,W,B,t)))}_extensionsLoadMaterialAsync(c,r,D,W,B){return this._applyExtensions(r,"loadMaterial",(t=>t._loadMaterialAsync&&t._loadMaterialAsync(c,r,D,W,B)))}_extensionsCreateMaterial(c,r,D){return this._applyExtensions(r,"createMaterial",(W=>W.createMaterial&&W.createMaterial(c,r,D)))}_extensionsLoadMaterialPropertiesAsync(c,r,D){return this._applyExtensions(r,"loadMaterialProperties",(W=>W.loadMaterialPropertiesAsync&&W.loadMaterialPropertiesAsync(c,r,D)))}_extensionsLoadTextureInfoAsync(c,r,D){return this._applyExtensions(r,"loadTextureInfo",(W=>W.loadTextureInfoAsync&&W.loadTextureInfoAsync(c,r,D)))}_extensionsLoadTextureAsync(c,r,D){return this._applyExtensions(r,"loadTexture",(W=>W._loadTextureAsync&&W._loadTextureAsync(c,r,D)))}_extensionsLoadAnimationAsync(c,r){return this._applyExtensions(r,"loadAnimation",(D=>D.loadAnimationAsync&&D.loadAnimationAsync(c,r)))}_extensionsLoadAnimationChannelAsync(c,r,D,W,B){return this._applyExtensions(D,"loadAnimationChannel",(t=>t._loadAnimationChannelAsync&&t._loadAnimationChannelAsync(c,r,D,W,B)))}_extensionsLoadSkinAsync(c,r,D){return this._applyExtensions(D,"loadSkin",(W=>W._loadSkinAsync&&W._loadSkinAsync(c,r,D)))}_extensionsLoadUriAsync(c,r,D){return this._applyExtensions(r,"loadUri",(W=>W._loadUriAsync&&W._loadUriAsync(c,r,D)))}_extensionsLoadBufferViewAsync(c,r){return this._applyExtensions(r,"loadBufferView",(D=>D.loadBufferViewAsync&&D.loadBufferViewAsync(c,r)))}_extensionsLoadBufferAsync(c,r,D,W){return this._applyExtensions(r,"loadBuffer",(B=>B.loadBufferAsync&&B.loadBufferAsync(c,r,D,W)))}static LoadExtensionAsync(c,r,D,W){if(!r.extensions)return null;const B=r.extensions[D];return B?W(`${c}/extensions/${D}`,B):null}static LoadExtraAsync(c,r,D,W){if(!r.extras)return null;const B=r.extras[D];return B?W(`${c}/extras/${D}`,B):null}isExtensionUsed(c){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(c)}logOpen(c){this._parent._logOpen(c)}logClose(){this._parent._logClose()}log(c){this._parent._log(c)}startPerformanceCounter(c){this._parent._startPerformanceCounter(c)}endPerformanceCounter(c){this._parent._endPerformanceCounter(c)}}R.DefaultSampler={index:-1},f.d._CreateGLTF2Loader=c=>new R(c);var s=D(13342),o=D(11868),Q=D(11717),l=D(13347),F=D(13355);class I extends F.e{constructor(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",c),this._texture=c.getEngine().createRawCubeTexture(r,D,W,B,t,u,a,H)}update(c,r,D,W){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,c,r,D,W,B)}updateRGBDAsync(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,l.j)(this._texture,c,r,D,W).then((()=>{}))}clone(){return Q.d.Clone((()=>{const c=this.yc(),r=this._texture,D=new I(c,r._bufferViewArray,r.width,r.format,r.type,r.generateMipMaps,r.invertY,r.samplingMode,r._compression);return 13===r.source&&D.updateRGBDAsync(r._bufferViewArrayArray,r._sphericalPolynomial,r._lodGenerationScale,r._lodGenerationOffset),D}),this)}}const i="EXT_lights_image_based";class n{constructor(c){this.name=i,this._loader=c,this.enabled=this._loader.isExtensionUsed(i)}dispose(){this._loader=null,delete this._lights}onLoading(){const c=this._loader.ua.extensions;if(c&&c[this.name]){const r=c[this.name];this._lights=r.lights}}loadSceneAsync(c,r){return R.LoadExtensionAsync(c,r,this.name,(async(D,W)=>{this._loader._allMaterialsDirtyRequired=!0;const B=new Array;B.push(this._loader.loadSceneAsync(c,r)),this._loader.logOpen(`${D}`);const t=C.Get(`${D}/light`,this._lights,W.gt);return B.push(this._loadLightAsync(`/extensions/${this.name}/lights/${W.gt}`,t).then((c=>{this._loader.babylonScene.environmentTexture=c}))),this._loader.logClose(),await Promise.all(B).then((()=>{}))}))}_loadLightAsync(c,r){if(!r._loaded){const D=new Array;this._loader.logOpen(`${c}`);const W=new Array(r.specularImages.length);for(let B=0;B<r.specularImages.length;B++){const t=r.specularImages[B];W[B]=new Array(t.length);for(let r=0;r<t.length;r++){const u=`${c}/specularImages/${B}/${r}`;this._loader.logOpen(`${u}`);const a=t[r],H=C.Get(u,this._loader.ua.images,a);D.push(this._loader.loadImageAsync(`/images/${a}`,H).then((c=>{W[B][r]=c}))),this._loader.logClose()}}this._loader.logClose(),r._loaded=Promise.all(D).then((async()=>{const D=new I(this._loader.babylonScene,null,r.specularImageSize);if(D.name=r.name||"environment",r._babylonTexture=D,void 0!=r.Ua&&(D.level=r.Ua),r.rotation){let c=B.Quaternion.er(r.rotation);this._loader.babylonScene.useRightHandedSystem||(c=B.Quaternion.Inverse(c)),B.Matrix.FromQuaternionToRef(c,D.getReflectionTextureMatrix())}if(!r.irradianceCoefficients)throw new Error(`${c}: Irradiance coefficients are missing`);const t=o.c.er(r.irradianceCoefficients);t.scaleInPlace(r.Ua),t.convertIrradianceToLambertianRadiance();const u=o.e.FromHarmonics(t),a=(W.length-1)/Math.log2(r.specularImageSize);return await D.updateRGBDAsync(W,u,a)}))}return r._loaded.then((()=>r._babylonTexture))}}d(i),G(i,!0,(c=>new n(c)));D(12236);const V="EXT_mesh_gpu_instancing";class cc{constructor(c){this.name=V,this._loader=c,this.enabled=this._loader.isExtensionUsed(V)}dispose(){this._loader=null}loadNodeAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(c,W)=>{this._loader._disableInstancedMesh++;const t=this._loader.loadNodeAsync(`/nodes/${r.index}`,r,D);if(this._loader._disableInstancedMesh--,!r._primitiveBabylonMeshes)return await t;const u=new Array;let a=0;const H=r=>{if(void 0==W.attributes[r])return void u.push(Promise.resolve(null));const D=C.Get(`${c}/attributes/${r}`,this._loader.ua.accessors,W.attributes[r]);if(u.push(this._loader._loadFloatAccessorAsync(`/accessors/${D.bufferView}`,D)),0===a)a=D.count;else if(a!==D.count)throw new Error(`${c}/attributes: Instance buffer accessors do not have the same count.`)};return H("TRANSLATION"),H("ROTATION"),H("SCALE"),await t.then((async c=>{const[D,W,t]=await Promise.all(u),H=new Float32Array(16*a);B.TmpVectors.Zr[0].Ja(0,0,0),B.TmpVectors.Quaternion[0].Ja(0,0,0,1),B.TmpVectors.Zr[1].Ja(1,1,1);for(let r=0;r<a;++r)D&&B.Zr.FromArrayToRef(D,3*r,B.TmpVectors.Zr[0]),W&&B.Quaternion.FromArrayToRef(W,4*r,B.TmpVectors.Quaternion[0]),t&&B.Zr.FromArrayToRef(t,3*r,B.TmpVectors.Zr[1]),B.Matrix.ComposeToRef(B.TmpVectors.Zr[1],B.TmpVectors.Quaternion[0],B.TmpVectors.Zr[0],B.TmpVectors.Matrix[0]),B.TmpVectors.Matrix[0].copyToArray(H,16*r);for(const B of r._primitiveBabylonMeshes)B.jE("matrix",H,16,!0);return c}))}))}}d(V),G(V,!0,(c=>new cc(c)));let rc=0,Dc=null;class Wc{static get Default(){return Wc._Default||(Wc._Default=new Wc),Wc._Default}constructor(){const c=Wc.Configuration.decoder;this._decoderModulePromise=u.Tools.LoadBabylonScriptAsync(c.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(c,r,D,W,B){await this._decoderModulePromise,0===rc&&(MeshoptDecoder.useWorkers(1),rc=1);const t=await MeshoptDecoder.decodeGltfBufferAsync(r,D,c,W,B);return null!==Dc&&clearTimeout(Dc),Dc=setTimeout((()=>{MeshoptDecoder.useWorkers(0),rc=0,Dc=null}),1e3),t}}Wc.Configuration={decoder:{url:`${u.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Wc._Default=null;const Bc="EXT_meshopt_compression";class tc{constructor(c){this.name=Bc,this.enabled=c.isExtensionUsed(Bc),this._loader=c}dispose(){this._loader=null}loadBufferViewAsync(c,r){return R.LoadExtensionAsync(c,r,this.name,(async(D,W)=>{const B=r;if(B._meshOptData)return await B._meshOptData;const t=C.Get(`${c}/buffer`,this._loader.ua.buffers,W.buffer);return B._meshOptData=this._loader.loadBufferAsync(`/buffers/${t.index}`,t,W.byteOffset||0,W.byteLength).then((async c=>await Wc.Default.decodeGltfBufferAsync(c,W.count,W.byteStride,W.mode,W.filter))),await B._meshOptData}))}}d(Bc),G(Bc,!0,(c=>new tc(c)));const uc="EXT_texture_webp";class ac{constructor(c){this.name=uc,this._loader=c,this.enabled=c.isExtensionUsed(uc)}dispose(){this._loader=null}_loadTextureAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=void 0==r.sampler?R.DefaultSampler:C.Get(`${c}/sampler`,this._loader.ua.samplers,r.sampler),u=C.Get(`${W}/source`,this._loader.ua.images,B.source);return await this._loader._createTextureAsync(c,t,u,(c=>{D(c)}),void 0,!r._textureInfo.nonColorData)}))}}d(uc),G(uc,!0,(c=>new ac(c)));const Hc="EXT_texture_avif";class xc{constructor(c){this.name=Hc,this._loader=c,this.enabled=c.isExtensionUsed(Hc)}dispose(){this._loader=null}_loadTextureAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=void 0==r.sampler?R.DefaultSampler:C.Get(`${c}/sampler`,this._loader.ua.samplers,r.sampler),u=C.Get(`${W}/source`,this._loader.ua.images,B.source);return await this._loader._createTextureAsync(c,t,u,(c=>{D(c)}),void 0,!r._textureInfo.nonColorData)}))}}d(Hc),G(Hc,!0,(c=>new xc(c)));var Mc=D(13339),Ec=D(12218);const mc="EXT_lights_ies";class Yc{constructor(c){this.name=mc,this._loader=c,this.enabled=this._loader.isExtensionUsed(mc)}dispose(){this._loader=null,delete this._lights}onLoading(){const c=this._loader.ua.extensions;if(c&&c[this.name]){const r=c[this.name];this._lights=r.lights,C.Assign(this._lights)}}loadNodeAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,u)=>{let a,H;this._loader._allMaterialsDirtyRequired=!0;const x=await this._loader.loadNodeAsync(c,r,(c=>{H=C.Get(W,this._lights,u.gt);const r=H.name||c.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,a=new Mc.e(r,B.Zr.Zero(),B.Zr.Backward(),0,1,this._loader.babylonScene),a.angle=Math.PI/2,a.innerAngle=0,a._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,H._babylonLight=a,a.falloffType=Ec.b.FALLOFF_GLTF,a.Na=u.color?t.Xr.er(u.color):t.Xr.White(),a.Ua=u.multiplier||1,a.range=Number.MAX_VALUE,a.parent=c,this._loader._babylonLights.push(a),R.AddPointerMetadata(a,W),D(c)}));let M;if(H.uri)M=await this._loader.loadUriAsync(c,H,H.uri);else{const r=C.Get(`${c}/bufferView`,this._loader.ua.bufferViews,H.bufferView);M=await this._loader.loadBufferViewAsync(`/bufferViews/${r.index}`,r)}return a.iesProfileTexture=new j.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,M,!0,void 0,void 0,void 0,void 0,".ies"),x}))}}d(mc),G(mc,!0,(c=>new Yc(c)));var vc=D(13372);const kc="KHR_draco_mesh_compression";class wc{constructor(c){this.name=kc,this.useNormalizedFlagFromAccessor=!0,this._loader=c,this.enabled=vc.d.DefaultAvailable&&this._loader.isExtensionUsed(kc)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{if(void 0!=r.mode&&4!==r.mode&&5!==r.mode)throw new Error(`${c}: Unsupported mode ${r.mode}`);const t={},u={},a=(c,W)=>{const a=B.attributes[c];if(void 0!=a&&(D._delayInfo=D._delayInfo||[],-1===D._delayInfo.indexOf(W)&&D._delayInfo.push(W),t[W]=a,this.useNormalizedFlagFromAccessor)){const D=C.TryGet(this._loader.ua.accessors,r.attributes[c]);D&&(u[W]=D.normalized||!1)}};a("POSITION",e.d.PositionKind),a("NORMAL",e.d.NormalKind),a("TANGENT",e.d.TangentKind),a("TEXCOORD_0",e.d.UVKind),a("TEXCOORD_1",e.d.UV2Kind),a("TEXCOORD_2",e.d.UV3Kind),a("TEXCOORD_3",e.d.UV4Kind),a("TEXCOORD_4",e.d.UV5Kind),a("TEXCOORD_5",e.d.UV6Kind),a("JOINTS_0",e.d.MatricesIndicesKind),a("WEIGHTS_0",e.d.MatricesWeightsKind),a("COLOR_0",e.d.ColorKind);const H=C.Get(W,this._loader.ua.bufferViews,B.bufferView);return H._dracoBabylonGeometry||(H._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((async W=>{const B=this.dracoDecoder||vc.d.Default,a=C.TryGet(this._loader.ua.accessors,r.attributes.POSITION),H=this._loader.parent.alwaysComputeBoundingBox||D.skeleton||!a?null:p(a);return await B._decodeMeshToGeometryForGltfAsync(D.name,this._loader.babylonScene,W,t,u,H).catch((r=>{throw new Error(`${c}: ${r.message}`)}))}))),await H._dracoBabylonGeometry}))}}d(kc),G(kc,!0,(c=>new wc(c)));var Zc=D(13381),Jc=D(11664),qc=D(11669),jc=D(12102),Xc=D(12275),ec=D(11637);jc.c.AddNodeConstructor("Light_Type_0",((c,r)=>()=>new yc(c,B.Zr.Zero(),r)));class yc extends Xc.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(c){this._shadowAngle=c,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(c){const r=this.needCube();if(this._direction=c,this.needCube()!==r&&this._shadowGenerators){const c=this._shadowGenerators.values();for(let r=c.next();!0!==r.done;r=c.next()){r.value.recreateShadowMap()}}}constructor(c,r,D){super(c,D),this._shadowAngle=Math.PI/2,this.position=r}getClassName(){return"PointLight"}getTypeID(){return Ec.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(c){if(this.direction)return super.getShadowDirection(c);switch(c){case 0:return new B.Zr(1,0,0);case 1:return new B.Zr(-1,0,0);case 2:return new B.Zr(0,-1,0);case 3:return new B.Zr(0,1,0);case 4:return new B.Zr(0,0,1);case 5:return new B.Zr(0,0,-1)}return B.Zr.Zero()}_setDefaultShadowProjectionMatrix(c,r,D){const W=this.yc().activeCamera;if(!W)return;const t=void 0!==this.shadowMinZ?this.shadowMinZ:W.ma,u=void 0!==this.shadowMaxZ?this.shadowMaxZ:W.maxZ,a=this.yc().getEngine().useReverseDepthBuffer;B.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,a?u:t,a?t:u,c,!0,this._scene.getEngine().isNDCHalfZRange,void 0,a)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(c,r){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,r):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,r),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,r),this}transferToNodeMaterialEffect(c,r){return this.computeTransformedInformation()?c.setFloat3(r,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):c.setFloat3(r,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(c,r){c["POINTLIGHT"+r]=!0}}(0,Jc.e)([(0,qc.K)()],yc.prototype,"shadowAngle",null),(0,ec.e)("BABYLON.PointLight",yc);const Uc="KHR_lights_punctual";class Nc{constructor(c){this.name=Uc,this._loader=c,this.enabled=this._loader.isExtensionUsed(Uc)}dispose(){this._loader=null,delete this._lights}onLoading(){const c=this._loader.ua.extensions;if(c&&c[this.name]){const r=c[this.name];this._lights=r.lights,C.Assign(this._lights)}}loadNodeAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,u)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(c,r,(c=>{let r;const a=C.Get(W,this._lights,u.gt),H=a.name||c.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,a.type){case"directional":{const c=new Zc.d(H,B.Zr.Backward(),this._loader.babylonScene);c.position.ja(0),r=c;break}case"point":r=new yc(H,B.Zr.Zero(),this._loader.babylonScene);break;case"spot":{const c=new Mc.e(H,B.Zr.Zero(),B.Zr.Backward(),0,1,this._loader.babylonScene);c.angle=2*(a.spot&&a.spot.outerConeAngle||Math.PI/4),c.innerAngle=2*(a.spot&&a.spot.innerConeAngle||0),r=c;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${W}: Invalid light type (${a.type})`)}r._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,a._babylonLight=r,r.falloffType=Ec.b.FALLOFF_GLTF,r.Na=a.color?t.Xr.er(a.color):t.Xr.White(),r.Ua=void 0==a.Ua?1:a.Ua,r.range=void 0==a.range?Number.MAX_VALUE:a.range,r.parent=c,this._loader._babylonLights.push(r),R.AddPointerMetadata(r,W),D(c)})))))}}d(Uc),G(Uc,!0,(c=>new Nc(c)));const gc="KHR_materials_pbrSpecularGlossiness";class zc{constructor(c){this.name=gc,this.order=200,this._loader=c,this.enabled=this._loader.isExtensionUsed(gc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=new Array;return t.push(this._loader.loadMaterialBasePropertiesAsync(c,r,D)),t.push(this._loadSpecularGlossinessPropertiesAsync(W,B,D)),this._loader.loadMaterialAlphaProperties(c,r,D),await Promise.all(t).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(c,r,D){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);const W=new Array;return D.metallic=null,D.roughness=null,r.diffuseFactor?(D.albedoColor=t.Xr.er(r.diffuseFactor),D.alpha=r.diffuseFactor[3]):D.albedoColor=t.Xr.White(),D.reflectivityColor=r.specularFactor?t.Xr.er(r.specularFactor):t.Xr.White(),D.microSurface=void 0==r.glossinessFactor?1:r.glossinessFactor,r.diffuseTexture&&W.push(this._loader.loadTextureInfoAsync(`${c}/diffuseTexture`,r.diffuseTexture,(c=>{c.name=`${D.name} (Diffuse)`,D.albedoTexture=c}))),r.specularGlossinessTexture&&(W.push(this._loader.loadTextureInfoAsync(`${c}/specularGlossinessTexture`,r.specularGlossinessTexture,(c=>{c.name=`${D.name} (Specular Glossiness)`,D.reflectivityTexture=c,D.reflectivityTexture.Ea=!0}))),D.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(W).then((()=>{}))}}d(gc),G(gc,!0,(c=>new zc(c)));const Sc="KHR_materials_unlit";class Kc{constructor(c){this.name=Sc,this.order=210,this._loader=c,this.enabled=this._loader.isExtensionUsed(Sc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async()=>await this._loadUnlitPropertiesAsync(c,r,D)))}_loadUnlitPropertiesAsync(c,r,D){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);const W=new Array;D.unlit=!0;const B=r.pbrMetallicRoughness;return B&&(B.baseColorFactor?(D.albedoColor=t.Xr.er(B.baseColorFactor),D.alpha=B.baseColorFactor[3]):D.albedoColor=t.Xr.White(),B.baseColorTexture&&W.push(this._loader.loadTextureInfoAsync(`${c}/baseColorTexture`,B.baseColorTexture,(c=>{c.name=`${D.name} (Base Color)`,D.albedoTexture=c})))),r.doubleSided&&(D.Za=!1,D.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(c,r,D),Promise.all(W).then((()=>{}))}}d(Sc),G(Sc,!0,(c=>new Kc(c)));const fc="KHR_materials_clearcoat";class Ac{constructor(c){this.name=fc,this.order=190,this._loader=c,this.enabled=this._loader.isExtensionUsed(fc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=new Array;t.push(this._loader.loadMaterialPropertiesAsync(c,r,D)),t.push(this._loadClearCoatPropertiesAsync(W,B,D)),await Promise.all(t)}))}_loadClearCoatPropertiesAsync(c,r,D){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);const W=new Array;return D.clearCoat.isEnabled=!0,D.clearCoat.useRoughnessFromMainTexture=!1,D.clearCoat.remapF0OnInterfaceChange=!1,void 0!=r.clearcoatFactor?D.clearCoat.Ua=r.clearcoatFactor:D.clearCoat.Ua=0,r.clearcoatTexture&&W.push(this._loader.loadTextureInfoAsync(`${c}/clearcoatTexture`,r.clearcoatTexture,(c=>{c.name=`${D.name} (ClearCoat)`,D.clearCoat.texture=c}))),void 0!=r.clearcoatRoughnessFactor?D.clearCoat.roughness=r.clearcoatRoughnessFactor:D.clearCoat.roughness=0,r.clearcoatRoughnessTexture&&(r.clearcoatRoughnessTexture.nonColorData=!0,W.push(this._loader.loadTextureInfoAsync(`${c}/clearcoatRoughnessTexture`,r.clearcoatRoughnessTexture,(c=>{c.name=`${D.name} (ClearCoat Roughness)`,D.clearCoat.textureRoughness=c})))),r.clearcoatNormalTexture&&(r.clearcoatNormalTexture.nonColorData=!0,W.push(this._loader.loadTextureInfoAsync(`${c}/clearcoatNormalTexture`,r.clearcoatNormalTexture,(c=>{c.name=`${D.name} (ClearCoat Normal)`,D.clearCoat.bumpTexture=c}))),D.invertNormalMapX=!D.yc().useRightHandedSystem,D.invertNormalMapY=D.yc().useRightHandedSystem,void 0!=r.clearcoatNormalTexture.scale&&(D.clearCoat.bumpTexture.level=r.clearcoatNormalTexture.scale)),Promise.all(W).then((()=>{}))}}d(fc),G(fc,!0,(c=>new Ac(c)));const hc="KHR_materials_iridescence";class Lc{constructor(c){this.name=hc,this.order=195,this._loader=c,this.enabled=this._loader.isExtensionUsed(hc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(c,r,D)),t.push(this._loadIridescencePropertiesAsync(W,B,D)),await Promise.all(t).then((()=>{}))}))}_loadIridescencePropertiesAsync(c,r,D){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);const W=new Array;return D.iridescence.isEnabled=!0,D.iridescence.Ua=r.iridescenceFactor??0,D.iridescence.indexOfRefraction=r.iridescenceIor??r.iridescenceIOR??1.3,D.iridescence.minimumThickness=r.iridescenceThicknessMinimum??100,D.iridescence.maximumThickness=r.iridescenceThicknessMaximum??400,r.iridescenceTexture&&W.push(this._loader.loadTextureInfoAsync(`${c}/iridescenceTexture`,r.iridescenceTexture,(c=>{c.name=`${D.name} (Iridescence)`,D.iridescence.texture=c}))),r.iridescenceThicknessTexture&&W.push(this._loader.loadTextureInfoAsync(`${c}/iridescenceThicknessTexture`,r.iridescenceThicknessTexture,(c=>{c.name=`${D.name} (Iridescence Thickness)`,D.iridescence.thicknessTexture=c}))),Promise.all(W).then((()=>{}))}}d(hc),G(hc,!0,(c=>new Lc(c)));const Pc="KHR_materials_anisotropy";class Gc{constructor(c){this.name=Pc,this.order=195,this._loader=c,this.enabled=this._loader.isExtensionUsed(Pc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=new Array;t.push(this._loader.loadMaterialPropertiesAsync(c,r,D)),t.push(this._loadIridescencePropertiesAsync(W,B,D)),await Promise.all(t)}))}async _loadIridescencePropertiesAsync(c,r,D){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);const W=new Array;D.anisotropy.isEnabled=!0,D.anisotropy.Ua=r.anisotropyStrength??0,D.anisotropy.angle=r.anisotropyRotation??0,r.anisotropyTexture&&(r.anisotropyTexture.nonColorData=!0,W.push(this._loader.loadTextureInfoAsync(`${c}/anisotropyTexture`,r.anisotropyTexture,(c=>{c.name=`${D.name} (Anisotropy Intensity)`,D.anisotropy.texture=c})))),await Promise.all(W)}}d(Pc),G(Pc,!0,(c=>new Gc(c)));const dc="KHR_materials_emissive_strength";class Tc{constructor(c){this.name=dc,this.order=170,this._loader=c,this.enabled=this._loader.isExtensionUsed(dc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>await this._loader.loadMaterialPropertiesAsync(c,r,D).then((()=>{this._loadEmissiveProperties(W,B,D)}))))}_loadEmissiveProperties(c,r,D){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);void 0!==r.emissiveStrength&&(D.emissiveIntensity=r.emissiveStrength)}}d(dc),G(dc,!0,(c=>new Tc(c)));const bc="KHR_materials_sheen";class Oc{constructor(c){this.name=bc,this.order=190,this._loader=c,this.enabled=this._loader.isExtensionUsed(bc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(c,r,D)),t.push(this._loadSheenPropertiesAsync(W,B,D)),await Promise.all(t).then((()=>{}))}))}_loadSheenPropertiesAsync(c,r,D){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);const W=new Array;return D.sheen.isEnabled=!0,D.sheen.Ua=1,void 0!=r.sheenColorFactor?D.sheen.color=t.Xr.er(r.sheenColorFactor):D.sheen.color=t.Xr.Black(),r.sheenColorTexture&&W.push(this._loader.loadTextureInfoAsync(`${c}/sheenColorTexture`,r.sheenColorTexture,(c=>{c.name=`${D.name} (Sheen Color)`,D.sheen.texture=c}))),void 0!==r.sheenRoughnessFactor?D.sheen.roughness=r.sheenRoughnessFactor:D.sheen.roughness=0,r.sheenRoughnessTexture&&(r.sheenRoughnessTexture.nonColorData=!0,W.push(this._loader.loadTextureInfoAsync(`${c}/sheenRoughnessTexture`,r.sheenRoughnessTexture,(c=>{c.name=`${D.name} (Sheen Roughness)`,D.sheen.textureRoughness=c})))),D.sheen.albedoScaling=!0,D.sheen.useRoughnessFromMainTexture=!1,Promise.all(W).then((()=>{}))}}d(bc),G(bc,!0,(c=>new Oc(c)));var Cc=D(12166);const pc="KHR_materials_specular";class Rc{constructor(c){this.name=pc,this.order=190,this._loader=c,this.enabled=this._loader.isExtensionUsed(pc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=new Array;if(t.push(this._loader.loadMaterialPropertiesAsync(c,r,D)),t.push(this._loadSpecularPropertiesAsync(W,B,D)),B.extensions&&B.extensions.EXT_materials_specular_edge_color&&D instanceof q.d){B.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(D.brdf.dielectricSpecularModel=Cc.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,D.brdf.conductorSpecularModel=Cc.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(t).then((()=>{}))}))}_loadSpecularPropertiesAsync(c,r,D){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);const W=new Array;return void 0!==r.specularFactor&&(D.metallicF0Factor=r.specularFactor),void 0!==r.specularColorFactor&&(D.metallicReflectanceColor=t.Xr.er(r.specularColorFactor)),r.specularTexture&&(r.specularTexture.nonColorData=!0,W.push(this._loader.loadTextureInfoAsync(`${c}/specularTexture`,r.specularTexture,(c=>{c.name=`${D.name} (Specular)`,D.metallicReflectanceTexture=c,D.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),r.specularColorTexture&&W.push(this._loader.loadTextureInfoAsync(`${c}/specularColorTexture`,r.specularColorTexture,(c=>{c.name=`${D.name} (Specular Color)`,D.reflectanceTexture=c}))),Promise.all(W).then((()=>{}))}}d(pc),G(pc,!0,(c=>new Rc(c)));const sc="KHR_materials_ior";class oc{constructor(c){this.name=sc,this.order=180,this._loader=c,this.enabled=this._loader.isExtensionUsed(sc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(c,r,D)),t.push(this._loadIorPropertiesAsync(W,B,D)),await Promise.all(t).then((()=>{}))}))}_loadIorPropertiesAsync(c,r,D){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);return void 0!==r.ior?D.indexOfRefraction=r.ior:D.indexOfRefraction=oc._DEFAULT_IOR,Promise.resolve()}}oc._DEFAULT_IOR=1.5,d(sc),G(sc,!0,(c=>new oc(c)));const Qc="KHR_materials_variants";class lc{constructor(c){this.name=Qc,this._loader=c,this.enabled=this._loader.isExtensionUsed(Qc)}dispose(){this._loader=null}static GetAvailableVariants(c){const r=this._GetExtensionMetadata(c);return r?Object.keys(r.variants):[]}getAvailableVariants(c){return lc.GetAvailableVariants(c)}static SelectVariant(c,r){const D=this._GetExtensionMetadata(c);if(!D)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Qc} extension`);const W=c=>{const r=D.variants[c];if(r)for(const D of r)D.mesh.material=D.material};if(r instanceof Array)for(const B of r)W(B);else W(r);D.lastSelected=r}selectVariant(c,r){lc.SelectVariant(c,r)}static Reset(c){const r=this._GetExtensionMetadata(c);if(!r)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Qc} extension`);for(const D of r.original)D.mesh.material=D.material;r.lastSelected=null}reset(c){lc.Reset(c)}static GetLastSelectedVariant(c){const r=this._GetExtensionMetadata(c);if(!r)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Qc} extension`);return r.lastSelected}getLastSelectedVariant(c){return lc.GetLastSelectedVariant(c)}static _GetExtensionMetadata(c){var r,D;return(null===c||void 0===c||null===(r=c._internalMetadata)||void 0===r||null===(D=r.ua)||void 0===D?void 0:D[Qc])||null}onLoading(){const c=this._loader.ua.extensions;if(c&&c[this.name]){const r=c[this.name];this._variants=r.variants}}onReady(){const c=this._loader.rootBabylonMesh;if(c){var r;const D=this._loader.parent.extensionOptions[Qc];null!==D&&void 0!==D&&D.defaultVariant&&lc.SelectVariant(c,D.defaultVariant),null===D||void 0===D||null===(r=D.onLoaded)||void 0===r||r.call(D,{get variants(){return lc.GetAvailableVariants(c)},get selectedVariant(){const r=lc.GetLastSelectedVariant(c);return r?Array.isArray(r)?r[0]:r:lc.GetAvailableVariants(c)[0]},set selectedVariant(r){lc.SelectVariant(c,r)}})}}_loadMeshPrimitiveAsync(c,r,D,W,B,t){return R.LoadExtensionAsync(c,B,this.name,(async(u,a)=>{const H=new Array;return H.push(this._loader._loadMeshPrimitiveAsync(c,r,D,W,B,(r=>{if(t(r),r instanceof N.e){const D=R._GetDrawMode(c,B.mode),W=this._loader.rootBabylonMesh,t=W?W._internalMetadata=W._internalMetadata||{}:{},x=t.ua=t.ua||{},M=x[Qc]=x[Qc]||{lastSelected:null,original:[],variants:{}};M.original.push({mesh:r,material:r.material});for(let c=0;c<a.mappings.length;++c){const B=a.mappings[c],t=C.Get(`${u}/mappings/${c}/material`,this._loader.ua.materials,B.material);H.push(this._loader._loadMaterialAsync(`#/materials/${B.material}`,t,r,D,(c=>{for(let D=0;D<B.variants.length;++D){const t=B.variants[D],u=C.Get(`/extensions/${Qc}/variants/${t}`,this._variants,t);M.variants[u.name]=M.variants[u.name]||[],M.variants[u.name].push({mesh:r,material:c}),r.onClonedObservable.add((c=>{const D=c;let B=null,t=D;do{if(t=t.parent,!t)return;B=lc._GetExtensionMetadata(t)}while(null===B);if(W&&B===lc._GetExtensionMetadata(W)){t._internalMetadata={};for(const c in W._internalMetadata)t._internalMetadata[c]=W._internalMetadata[c];t._internalMetadata.ua=[];for(const c in W._internalMetadata.ua)t._internalMetadata.ua[c]=W._internalMetadata.ua[c];t._internalMetadata.ua[Qc]={lastSelected:null,original:[],variants:{}};for(const c of B.original)t._internalMetadata.ua[Qc].original.push({mesh:c.mesh,material:c.material});for(const c in B.variants)if(Object.prototype.hasOwnProperty.call(B.variants,c)){t._internalMetadata.ua[Qc].variants[c]=[];for(const r of B.variants[c])t._internalMetadata.ua[Qc].variants[c].push({mesh:r.mesh,material:r.material})}B=t._internalMetadata.ua[Qc]}for(const W of B.original)W.mesh===r&&(W.mesh=D);for(const W of B.variants[u.name])W.mesh===r&&(W.mesh=D)}))}})))}}}))),await Promise.all(H).then((c=>{let[r]=c;return r}))}))}}d(Qc),G(Qc,!0,(c=>new lc(c)));var Fc=D(11737);class Ic{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Cc.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(c,r){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Ic._GetDefaultOptions(),...c},this._scene=r,this._scene._transmissionHelper=this,this.onErrorObservable=new M.c,this._scene.Wa.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(c){if(!Object.keys(c).filter((r=>this._options[r]!==c[r])).length)return;const r={...this._options,...c},D=this._options;this._options=r,r.renderSize===D.renderSize&&r.renderTargetTextureType===D.renderTargetTextureType&&r.generateMipmaps===D.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=r.samples,this._opaqueRenderTarget.lodGenerationScale=r.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=r.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(c){return!!c&&!!(c instanceof q.d&&c.subSurface.isRefractionEnabled)}_addMesh(c){this._materialObservers[c.uniqueId]=c.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),u.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(c.material)?(c.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(c)&&this._transparentMeshesCache.push(c)):-1===this._opaqueMeshesCache.indexOf(c)&&this._opaqueMeshesCache.push(c)}))}_removeMesh(c){c.onMaterialChangedObservable.remove(this._materialObservers[c.uniqueId]),delete this._materialObservers[c.uniqueId];let r=this._transparentMeshesCache.indexOf(c);-1!==r&&this._transparentMeshesCache.splice(r,1),r=this._opaqueMeshesCache.indexOf(c),-1!==r&&this._opaqueMeshesCache.splice(r,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(c){const r=this._transparentMeshesCache.indexOf(c),D=this._opaqueMeshesCache.indexOf(c);this._shouldRenderAsTransmission(c.material)?(c.material instanceof q.d&&(c.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==D?(this._opaqueMeshesCache.splice(D,1),this._transparentMeshesCache.push(c)):-1===r&&this._transparentMeshesCache.push(c)):-1!==r?(this._transparentMeshesCache.splice(r,1),this._opaqueMeshesCache.push(c)):-1===D&&this._opaqueMeshesCache.push(c)}_isRenderTargetValid(){var c;return null!==(null===(c=this._opaqueRenderTarget)||void 0===c?void 0:c.getInternalTexture())}_setupRenderTargets(){var c;let r;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Fc.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(c=this._options.clearColor)||void 0===c?void 0:c.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((c=>{r=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?c.clearColor.t(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(c.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=r}));for(const D of this._transparentMeshesCache)this._shouldRenderAsTransmission(D.material)&&(D.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const ic="KHR_materials_transmission";class nc{constructor(c){this.name=ic,this.order=175,this._loader=c,this.enabled=this._loader.isExtensionUsed(ic),this.enabled&&(c.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(c,r,D)),t.push(this._loadTransparentPropertiesAsync(W,r,D,B)),await Promise.all(t).then((()=>{}))}))}_loadTransparentPropertiesAsync(c,r,D,W){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);const B=D;if(B.subSurface.isRefractionEnabled=!0,B.subSurface.volumeIndexOfRefraction=1,B.subSurface.useAlbedoToTintRefraction=!0,void 0===W.transmissionFactor)return B.subSurface.refractionIntensity=0,B.subSurface.isRefractionEnabled=!1,Promise.resolve();{var t;B.subSurface.refractionIntensity=W.transmissionFactor;const c=B.yc();if(B.subSurface.refractionIntensity&&!c._transmissionHelper)new Ic({},B.yc());else if(B.subSurface.refractionIntensity&&(null===(t=c._transmissionHelper)||void 0===t||!t._isRenderTargetValid())){var u;null===(u=c._transmissionHelper)||void 0===u||u._setupRenderTargets()}}return B.subSurface.minimumThickness=0,B.subSurface.maximumThickness=0,W.transmissionTexture?(W.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${c}/transmissionTexture`,W.transmissionTexture,void 0).then((c=>{c.name=`${D.name} (Transmission)`,B.subSurface.refractionIntensityTexture=c,B.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}d(ic),G(ic,!0,(c=>new nc(c)));const Vc="KHR_materials_diffuse_transmission";class cr{constructor(c){this.name=Vc,this.order=174,this._loader=c,this.enabled=this._loader.isExtensionUsed(Vc),this.enabled&&(c.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(c,r,D)),t.push(this._loadTranslucentPropertiesAsync(W,r,D,B)),await Promise.all(t).then((()=>{}))}))}_loadTranslucentPropertiesAsync(c,r,D,W){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);const B=D;if(B.subSurface.isTranslucencyEnabled=!0,B.subSurface.volumeIndexOfRefraction=1,B.subSurface.minimumThickness=0,B.subSurface.maximumThickness=0,B.subSurface.useAlbedoToTintTranslucency=!1,void 0===W.diffuseTransmissionFactor)return B.subSurface.translucencyIntensity=0,B.subSurface.isTranslucencyEnabled=!1,Promise.resolve();B.subSurface.translucencyIntensity=W.diffuseTransmissionFactor;const u=new Array;return B.subSurface.useGltfStyleTextures=!0,W.diffuseTransmissionTexture&&(W.diffuseTransmissionTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${c}/diffuseTransmissionTexture`,W.diffuseTransmissionTexture).then((c=>{c.name=`${D.name} (Diffuse Transmission)`,B.subSurface.translucencyIntensityTexture=c})))),void 0!==W.diffuseTransmissionColorFactor?B.subSurface.translucencyColor=t.Xr.er(W.diffuseTransmissionColorFactor):B.subSurface.translucencyColor=t.Xr.White(),W.diffuseTransmissionColorTexture&&u.push(this._loader.loadTextureInfoAsync(`${c}/diffuseTransmissionColorTexture`,W.diffuseTransmissionColorTexture).then((c=>{c.name=`${D.name} (Diffuse Transmission Color)`,B.subSurface.translucencyColorTexture=c}))),Promise.all(u).then((()=>{}))}}d(Vc),G(Vc,!0,(c=>new cr(c)));const rr="KHR_materials_volume";class Dr{constructor(c){this.name=rr,this.order=173,this._loader=c,this.enabled=this._loader.isExtensionUsed(rr),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(c,r,D)),t.push(this._loadVolumePropertiesAsync(W,r,D,B)),await Promise.all(t).then((()=>{}))}))}_loadVolumePropertiesAsync(c,r,D,W){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);if(!D.subSurface.isRefractionEnabled&&!D.subSurface.isTranslucencyEnabled||!W.thicknessFactor)return Promise.resolve();D.subSurface.volumeIndexOfRefraction=D.indexOfRefraction;const B=void 0!==W.attenuationDistance?W.attenuationDistance:Number.MAX_VALUE;return D.subSurface.tintColorAtDistance=B,void 0!==W.attenuationColor&&3==W.attenuationColor.length&&D.subSurface.tintColor.Ja(W.attenuationColor[0],W.attenuationColor[1],W.attenuationColor[2]),D.subSurface.minimumThickness=0,D.subSurface.maximumThickness=W.thicknessFactor,D.subSurface.useThicknessAsDepth=!0,W.thicknessTexture?(W.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${c}/thicknessTexture`,W.thicknessTexture).then((c=>{c.name=`${D.name} (Thickness)`,D.subSurface.thicknessTexture=c,D.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}d(rr),G(rr,!0,(c=>new Dr(c)));const Wr="KHR_materials_dispersion";class Br{constructor(c){this.name=Wr,this.order=174,this._loader=c,this.enabled=this._loader.isExtensionUsed(Wr)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(c,r,D)),t.push(this._loadDispersionPropertiesAsync(W,r,D,B)),await Promise.all(t).then((()=>{}))}))}_loadDispersionPropertiesAsync(c,r,D,W){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);return D.subSurface.isRefractionEnabled&&W.dispersion?(D.subSurface.isDispersionEnabled=!0,D.subSurface.dispersion=W.dispersion,Promise.resolve()):Promise.resolve()}}d(Wr),G(Wr,!0,(c=>new Br(c)));const tr="EXT_materials_diffuse_roughness";class ur{constructor(c){this.name=tr,this.order=190,this._loader=c,this.enabled=this._loader.isExtensionUsed(tr)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(c,r,D)),t.push(this._loadDiffuseRoughnessPropertiesAsync(W,B,D)),await Promise.all(t).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(c,r,D){if(!(D instanceof q.d))throw new Error(`${c}: Material type not supported`);const W=new Array;return D.brdf.baseDiffuseModel=Cc.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=r.diffuseRoughnessFactor?D.baseDiffuseRoughness=r.diffuseRoughnessFactor:D.baseDiffuseRoughness=0,r.diffuseRoughnessTexture&&W.push(this._loader.loadTextureInfoAsync(`${c}/diffuseRoughnessTexture`,r.diffuseRoughnessTexture,(c=>{c.name=`${D.name} (Diffuse Roughness)`,D.baseDiffuseRoughnessTexture=c}))),Promise.all(W).then((()=>{}))}}d(tr),G(tr,!0,(c=>new ur(c)));const ar="KHR_mesh_quantization";class Hr{constructor(c){this.name=ar,this.enabled=c.isExtensionUsed(ar)}dispose(){}}d(ar),G(ar,!0,(c=>new Hr(c)));const xr="KHR_texture_basisu";class Mr{constructor(c){this.name=xr,this._loader=c,this.enabled=c.isExtensionUsed(xr)}dispose(){this._loader=null}_loadTextureAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>{const t=void 0==r.sampler?R.DefaultSampler:C.Get(`${c}/sampler`,this._loader.ua.samplers,r.sampler),u=C.Get(`${W}/source`,this._loader.ua.images,B.source);return await this._loader._createTextureAsync(c,t,u,(c=>{D(c)}),r._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!r._textureInfo.nonColorData)}))}}d(xr),G(xr,!0,(c=>new Mr(c)));const Er="KHR_texture_transform";class mr{constructor(c){this.name=Er,this._loader=c,this.enabled=this._loader.isExtensionUsed(Er)}dispose(){this._loader=null}loadTextureInfoAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(W,B)=>await this._loader.loadTextureInfoAsync(c,r,(c=>{if(!(c instanceof j.b))throw new Error(`${W}: Texture type not supported`);B.offset&&(c.uOffset=B.offset[0],c.vOffset=B.offset[1]),c.uRotationCenter=0,c.vRotationCenter=0,B.rotation&&(c.wAng=-B.rotation),B.scale&&(c.uScale=B.scale[0],c.vScale=B.scale[1]),void 0!=B.texCoord&&(c.coordinatesIndex=B.texCoord),D(c)}))))}}d(Er),G(Er,!0,(c=>new mr(c)));const Yr="KHR_xmp_json_ld";class vr{constructor(c){this.name=Yr,this.order=100,this._loader=c,this.enabled=this._loader.isExtensionUsed(Yr)}dispose(){this._loader=null}onLoading(){var c,r,D;if(null===this._loader.rootBabylonMesh)return;const W=null===(c=this._loader.ua.extensions)||void 0===c?void 0:c.KHR_xmp_json_ld,B=null===(r=this._loader.ua.asset)||void 0===r||null===(D=r.extensions)||void 0===D?void 0:D.KHR_xmp_json_ld;if(W&&B){const c=+B.packet;W.packets&&c<W.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=W.packets[c])}}}function kr(c,r,D,W){return t.Xr.er(r,D).scale(W)}function wr(c,r,D,W){return r[D]*W}function Zr(c,r,D,W){return-r[D]*W}function Jr(c,r,D,W){return r[D+1]*W}function qr(c,r,D,W){return r[D]*W*2}function jr(c){return{scale:[new er(m.b.ANIMATIONTYPE_FLOAT,`${c}.uScale`,wr,(()=>2)),new er(m.b.ANIMATIONTYPE_FLOAT,`${c}.vScale`,Jr,(()=>2))],offset:[new er(m.b.ANIMATIONTYPE_FLOAT,`${c}.uOffset`,wr,(()=>2)),new er(m.b.ANIMATIONTYPE_FLOAT,`${c}.vOffset`,Jr,(()=>2))],rotation:[new er(m.b.ANIMATIONTYPE_FLOAT,`${c}.wAng`,Zr,(()=>1))]}}d(Yr),G(Yr,!0,(c=>new vr(c)));class Xr extends s.AnimationPropertyInfo{buildAnimations(c,r,D,W){return[{babylonAnimatable:c._babylonCamera,babylonAnimation:this._buildAnimation(r,D,W)}]}}class er extends s.AnimationPropertyInfo{buildAnimations(c,r,D,W){const B=[];for(const t in c._data)B.push({babylonAnimatable:c._data[t].babylonMaterial,babylonAnimation:this._buildAnimation(r,D,W)});return B}}class yr extends s.AnimationPropertyInfo{buildAnimations(c,r,D,W){return[{babylonAnimatable:c._babylonLight,babylonAnimation:this._buildAnimation(r,D,W)}]}}(0,T.l)("/cameras/{}/orthographic/xmag",[new Xr(m.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Zr,(()=>1)),new Xr(m.b.ANIMATIONTYPE_FLOAT,"orthoRight",Jr,(()=>1))]),(0,T.l)("/cameras/{}/orthographic/ymag",[new Xr(m.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Zr,(()=>1)),new Xr(m.b.ANIMATIONTYPE_FLOAT,"orthoTop",Jr,(()=>1))]),(0,T.l)("/cameras/{}/orthographic/zfar",[new Xr(m.b.ANIMATIONTYPE_FLOAT,"maxZ",wr,(()=>1))]),(0,T.l)("/cameras/{}/orthographic/znear",[new Xr(m.b.ANIMATIONTYPE_FLOAT,"ma",wr,(()=>1))]),(0,T.l)("/cameras/{}/perspective/yfov",[new Xr(m.b.ANIMATIONTYPE_FLOAT,"fov",wr,(()=>1))]),(0,T.l)("/cameras/{}/perspective/zfar",[new Xr(m.b.ANIMATIONTYPE_FLOAT,"maxZ",wr,(()=>1))]),(0,T.l)("/cameras/{}/perspective/znear",[new Xr(m.b.ANIMATIONTYPE_FLOAT,"ma",wr,(()=>1))]),(0,T.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new er(m.b.ANIMATIONTYPE_COLOR3,"albedoColor",kr,(()=>4)),new er(m.b.ANIMATIONTYPE_FLOAT,"alpha",(function(c,r,D,W){return r[D+3]*W}),(()=>4))]),(0,T.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new er(m.b.ANIMATIONTYPE_FLOAT,"metallic",wr,(()=>1))]),(0,T.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new er(m.b.ANIMATIONTYPE_FLOAT,"roughness",wr,(()=>1))]);const Ur=jr("albedoTexture");(0,T.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Ur.scale),(0,T.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Ur.offset),(0,T.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Ur.rotation);const Nr=jr("metallicTexture");(0,T.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Nr.scale),(0,T.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Nr.offset),(0,T.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Nr.rotation),(0,T.l)("/materials/{}/emissiveFactor",[new er(m.b.ANIMATIONTYPE_COLOR3,"emissiveColor",kr,(()=>3))]);const gr=jr("bumpTexture");(0,T.l)("/materials/{}/normalTexture/scale",[new er(m.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",wr,(()=>1))]),(0,T.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",gr.scale),(0,T.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",gr.offset),(0,T.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",gr.rotation),(0,T.l)("/materials/{}/occlusionTexture/strength",[new er(m.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",wr,(()=>1))]);const zr=jr("ambientTexture");(0,T.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",zr.scale),(0,T.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",zr.offset),(0,T.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",zr.rotation);const Sr=jr("emissiveTexture");(0,T.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Sr.scale),(0,T.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Sr.offset),(0,T.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Sr.rotation),(0,T.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new er(m.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",wr,(()=>1))]),(0,T.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new er(m.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",wr,(()=>1))]);const Kr=jr("anisotropy.texture");(0,T.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Kr.scale),(0,T.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Kr.offset),(0,T.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Kr.rotation),(0,T.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new er(m.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",wr,(()=>1))]),(0,T.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new er(m.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",wr,(()=>1))]);const fr=jr("clearCoat.texture");(0,T.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",fr.scale),(0,T.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",fr.offset),(0,T.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",fr.rotation);const Ar=jr("clearCoat.bumpTexture");(0,T.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new er(m.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",wr,(()=>1))]),(0,T.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Ar.scale),(0,T.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Ar.offset),(0,T.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Ar.rotation);const hr=jr("clearCoat.textureRoughness");(0,T.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",hr.scale),(0,T.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",hr.offset),(0,T.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",hr.rotation),(0,T.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new er(m.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",wr,(()=>1))]),(0,T.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new er(m.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",wr,(()=>1))]),(0,T.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new er(m.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",wr,(()=>1))]),(0,T.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new er(m.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",wr,(()=>1))]),(0,T.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new er(m.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",wr,(()=>1))]),(0,T.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new er(m.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",wr,(()=>1))]),(0,T.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new er(m.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",wr,(()=>1))]);const Lr=jr("iridescence.texture");(0,T.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Lr.scale),(0,T.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Lr.offset),(0,T.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Lr.rotation);const Pr=jr("iridescence.thicknessTexture");(0,T.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Pr.scale),(0,T.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Pr.offset),(0,T.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Pr.rotation),(0,T.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new er(m.b.ANIMATIONTYPE_COLOR3,"sheen.color",kr,(()=>3))]),(0,T.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new er(m.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",wr,(()=>1))]);const Gr=jr("sheen.texture");(0,T.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Gr.scale),(0,T.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Gr.offset),(0,T.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Gr.rotation);const dr=jr("sheen.textureRoughness");(0,T.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",dr.scale),(0,T.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",dr.offset),(0,T.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",dr.rotation),(0,T.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new er(m.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",wr,(()=>1))]),(0,T.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new er(m.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",kr,(()=>3))]);const Tr=jr("metallicReflectanceTexture");(0,T.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Tr.scale),(0,T.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Tr.offset),(0,T.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Tr.rotation);const br=jr("reflectanceTexture");(0,T.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",br.scale),(0,T.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",br.offset),(0,T.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",br.rotation),(0,T.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new er(m.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",wr,(()=>1))]);const Or=jr("subSurface.refractionIntensityTexture");(0,T.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Or.scale),(0,T.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Or.offset),(0,T.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Or.rotation),(0,T.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new er(m.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",kr,(()=>3))]),(0,T.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new er(m.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",wr,(()=>1))]),(0,T.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new er(m.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",wr,(()=>1))]);const Cr=jr("subSurface.thicknessTexture");(0,T.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Cr.scale),(0,T.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Cr.offset),(0,T.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Cr.rotation),(0,T.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new er(m.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",wr,(()=>1))]);const pr=jr("subSurface.translucencyIntensityTexture");(0,T.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",pr.scale),(0,T.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",pr.offset),(0,T.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",pr.rotation),(0,T.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new er(m.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",kr,(()=>3))]);const Rr=jr("subSurface.translucencyColorTexture");(0,T.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Rr.scale),(0,T.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Rr.offset),(0,T.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Rr.rotation),(0,T.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new yr(m.b.ANIMATIONTYPE_COLOR3,"diffuse",kr,(()=>3))]),(0,T.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new yr(m.b.ANIMATIONTYPE_FLOAT,"intensity",wr,(()=>1))]),(0,T.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new yr(m.b.ANIMATIONTYPE_FLOAT,"range",wr,(()=>1))]),(0,T.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new yr(m.b.ANIMATIONTYPE_FLOAT,"innerAngle",qr,(()=>1))]),(0,T.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new yr(m.b.ANIMATIONTYPE_FLOAT,"angle",qr,(()=>1))]),(0,T.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new yr(m.b.ANIMATIONTYPE_COLOR3,"diffuse",kr,(()=>3))]),(0,T.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new yr(m.b.ANIMATIONTYPE_FLOAT,"intensity",wr,(()=>1))]);const sr="KHR_animation_pointer";class or{constructor(c){this.name=sr,this._loader=c,this._pathToObjectConverter=(0,T.h)(this._loader.ua)}get enabled(){return this._loader.isExtensionUsed(sr)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(c,r,D,W,B){var t;const u=null===(t=W.target.extensions)||void 0===t?void 0:t.KHR_animation_pointer;if(!u||!this._pathToObjectConverter)return null;"pointer"!==W.target.path&&k.e.Warn(`${c}/target/path: Value (${W.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=W.target.node&&k.e.Warn(`${c}/target/node: Value (${W.target.node}) must not be present when using the ${this.name} extension`);const a=`${c}/extensions/${this.name}`,H=u.pointer;if(!H)throw new Error(`${a}: Pointer is missing`);try{const t=this._pathToObjectConverter.convert(H);if(!t.info.interpolation)throw new Error(`${a}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(c,r,D,W,{object:t.object,info:t.info.interpolation},B)}catch(x){return k.e.Warn(`${a}/pointer: Invalid pointer (${H}) skipped`),null}}}d(sr),G(sr,!0,(c=>new or(c)));class Qr{constructor(c,r,D){this.frame=c,this.action=r,this.onlyOnce=D,this.isDone=!1}_clone(){return new Qr(this.frame,this.action,this.onlyOnce)}}var lr=D(11524),Fr=D(11584),Ir=D(11581);class ir{get loop(){return this._loop}set loop(c){c!==this._loop&&(this._loop=c,this.updateOptions({loop:c}))}get currentTime(){var c;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(c=Fr.b.audioEngine)&&void 0!==c&&c.audioContext&&(this.isPlaying||this.isPaused)){const c=this.isPaused?0:Fr.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+c}return 0}get spatialSound(){return this._spatialSound}set spatialSound(c){if(c==this._spatialSound)return;const r=this.isPlaying;this.pause(),c?(this._spatialSound=c,this._updateSpatialParameters()):this._disableSpatialSound(),r&&this.play()}constructor(c,r,D){var W;let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new M.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=B.Zr.Zero(),this._localDirection=new B.Zr(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=c,D=D||v.c.LastCreatedScene)if(this._scene=D,ir._SceneComponentInitialization(D),this._readyToPlayCallback=t,this._customAttenuationFunction=(c,r,D,W,B)=>r<D?c*(1-r/D):0,a&&(this.autoplay=a.autoplay||!1,this._loop=a.loop||!1,void 0!==a.volume&&(this._volume=a.volume),this._spatialSound=a.spatialSound??!1,this.maxDistance=a.maxDistance??100,this.useCustomAttenuation=a.useCustomAttenuation??!1,this.rolloffFactor=a.rolloffFactor||1,this.refDistance=a.refDistance||1,this.distanceModel=a.distanceModel||"linear",this._playbackRate=a.playbackRate||1,this._streaming=a.streaming??!1,this._length=a.length,this._offset=a.offset),null!==(W=Fr.b.audioEngine)&&void 0!==W&&W.canUseWebAudio&&Fr.b.audioEngine.audioContext){this._soundGain=Fr.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let c=!0;if(r)try{"string"===typeof r?(this._urlType="String",this._url=r):r instanceof ArrayBuffer?this._urlType="ArrayBuffer":r instanceof HTMLMediaElement?this._urlType="MediaElement":r instanceof MediaStream?this._urlType="MediaStream":r instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(r)&&(this._urlType="Array");let D=[],W=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Fr.b.audioEngine.audioContext.createMediaElementSource(r),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Fr.b.audioEngine.audioContext.createMediaStreamSource(r),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":r.byteLength>0&&(W=!0,this._soundLoaded(r));break;case"AudioBuffer":this._audioBufferLoaded(r);break;case"String":D.push(r);case"Array":0===D.length&&(D=r);for(let c=0;c<D.length;c++){const r=D[c];if(W=a&&a.skipCodecCheck||-1!==r.indexOf(".mp3",r.length-4)&&Fr.b.audioEngine.isMP3supported||-1!==r.indexOf(".ogg",r.length-4)&&Fr.b.audioEngine.isOGGsupported||-1!==r.indexOf(".wav",r.length-4)||-1!==r.indexOf(".m4a",r.length-4)||-1!==r.indexOf(".mp4",r.length-4)||-1!==r.indexOf("blob:"),W){this._streaming?(this._htmlAudioElement=new Audio(r),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,u.Tools.SetCorsBehavior(r,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(r,(c=>{this._soundLoaded(c)}),void 0,!0,!0,(c=>{c&&k.e.Error("XHR "+c.status+" error on: "+r+"."),k.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:c=!1}c?W||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):k.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(H){k.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Fr.b.audioEngine&&!Fr.b.audioEngine.WarnedWebAudioUnsupported&&(k.e.Error("Web Audio is not supported by your browser."),Fr.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var c;null!==(c=Fr.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(c){var r;null!==(r=Fr.b.audioEngine)&&void 0!==r&&r.audioContext&&(this._audioBuffer=c,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(c){var r;null!==(r=Fr.b.audioEngine)&&void 0!==r&&r.audioContext&&Fr.b.audioEngine.audioContext.decodeAudioData(c,(c=>{this._audioBufferLoaded(c)}),(c=>{k.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+c)}))}setAudioBuffer(c){var r;null!==(r=Fr.b.audioEngine)&&void 0!==r&&r.canUseWebAudio&&(this._audioBuffer=c,this._isReadyToPlay=!0)}updateOptions(c){c&&(this.loop=c.loop??this.loop,this.maxDistance=c.maxDistance??this.maxDistance,this.useCustomAttenuation=c.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=c.rolloffFactor??this.rolloffFactor,this.refDistance=c.refDistance??this.refDistance,this.distanceModel=c.distanceModel??this.distanceModel,this._playbackRate=c.playbackRate??this._playbackRate,this._length=c.length??void 0,this.spatialSound=c.spatialSound??this._spatialSound,this._setOffset(c.offset??void 0),this.setVolume(c.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var c;null!==(c=Fr.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&Fr.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Fr.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var c;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(c=this._soundPanner)||void 0===c||c.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var c;null!==(c=Fr.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(c){var r;null!==(r=Fr.b.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(c),this._isOutputConnected=!0)}setDirectionalCone(c,r,D){r<c?k.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=c,this._coneOuterAngle=r,this._coneOuterGain=D,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(c){if(c!=this._coneInnerAngle){var r;if(this._coneOuterAngle<c)return void k.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=c,null!==(r=Fr.b.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(c){if(c!=this._coneOuterAngle){var r;if(c<this._coneInnerAngle)return void k.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=c,null!==(r=Fr.b.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(c){var r;c.equals(this._position)||(this._position.t(c),null!==(r=Fr.b.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(c){var r;this._localDirection=c,null!==(r=Fr.b.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const c=this._connectedTransformNode.getWorldMatrix(),r=B.Zr.TransformNormal(this._localDirection,c);r.normalize(),this._soundPanner.orientationX.value=r.x,this._soundPanner.orientationY.value=r.y,this._soundPanner.orientationZ.value=r.z}updateDistanceFromListener(){var c;if(null!==(c=Fr.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const c=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Jr(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,c,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(c){this._customAttenuationFunction=c}play(c,r,D){var W;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(W=Fr.b.audioEngine)&&void 0!==W&&W.audioContext)try{var B,t;this._clearTimeoutsAndObservers();let W=c?(null===(B=Fr.b.audioEngine)||void 0===B?void 0:B.audioContext.currentTime)+c:null===(t=Fr.b.audioEngine)||void 0===t?void 0:t.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Fr.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const c=()=>{var D;if(null!==(D=Fr.b.audioEngine)&&void 0!==D&&D.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=r??0;const D=this._htmlAudioElement.play();void 0!==D&&D.catch((()=>{var r,D;(null===(r=Fr.b.audioEngine)||void 0===r||r.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(D=Fr.b.audioEngine)||void 0===D?void 0:D.onAudioUnlockedObservable.addOnce((()=>{c()})))}))}else{var W;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(W=Fr.b.audioEngine)||void 0===W?void 0:W.onAudioUnlockedObservable.addOnce((()=>{c()}))}};c()}}else{var u;const B=()=>{var B;if(null!==(B=Fr.b.audioEngine)&&void 0!==B&&B.audioContext){var t;if(D=D||this._length,void 0!==r&&this._setOffset(r),this._soundSource){const c=this._soundSource;c.onended=()=>{c.disconnect()}}if(this._soundSource=null===(t=Fr.b.audioEngine)||void 0===t?void 0:t.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var u;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==r&&(this._soundSource.loopStart=r),void 0!==D&&(this._soundSource.loopEnd=(0|r)+D),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},W=c?(null===(u=Fr.b.audioEngine)||void 0===u?void 0:u.audioContext.currentTime)+c:Fr.b.audioEngine.audioContext.currentTime;const B=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(W,B,this.loop?void 0:D)}}};"suspended"===(null===(u=Fr.b.audioEngine)||void 0===u?void 0:u.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var c;"suspended"===(null===(c=Fr.b.audioEngine)||void 0===c?void 0:c.audioContext.state)?(Fr.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Fr.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{B()})))):B()}),500):B()}this._startTime=W,this.isPlaying=!0,this.isPaused=!1}catch(a){k.e.Error("Error while trying to play audio: "+this.name+", "+a.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(c){var r;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var D;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(D=this._streamingSource)||void 0===D||D.disconnect();this.isPlaying=!1}else if(null!==(r=Fr.b.audioEngine)&&void 0!==r&&r.audioContext&&this._soundSource){const r=c?Fr.b.audioEngine.audioContext.currentTime+c:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(r)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var c;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var r;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(r=this._streamingSource)||void 0===r||r.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(c=Fr.b.audioEngine)&&void 0!==c&&c.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Fr.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(c,r){var D;null!==(D=Fr.b.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._soundGain&&(r&&Fr.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Fr.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Fr.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(c,Fr.b.audioEngine.audioContext.currentTime+r)):this._soundGain.gain.value=c),this._volume=c}setPlaybackRate(c){this._playbackRate=c,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(c){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=c,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=c=>this._onRegisterAfterWorldMatrixUpdate(c),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(c){var r;if(c.getBoundingInfo){const r=c.getBoundingInfo();this.setPosition(r.boundingSphere.centerWorld)}else this.setPosition(c.absolutePosition);null!==(r=Fr.b.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const c=()=>{(0,Ir.f)((()=>this._isReadyToPlay),(()=>{D._audioBuffer=this.getAudioBuffer(),D._isReadyToPlay=!0,D.autoplay&&D.play(0,this._offset,this._length)}),void 0,300)},r={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},D=new ir(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,r);return this.useCustomAttenuation&&D.setAttenuationFunction(this._customAttenuationFunction),D.setPosition(this._position),D.setPlaybackRate(this._playbackRate),c(),D}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const c={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(c.connectedMeshId=this._connectedTransformNode.id),c.position=this._position.Ma(),c.refDistance=this.refDistance,c.distanceModel=this.distanceModel,c.isDirectional=this._isDirectional,c.localDirectionToMesh=this._localDirection.Ma(),c.coneInnerAngle=this._coneInnerAngle,c.coneOuterAngle=this._coneOuterAngle,c.coneOuterGain=this._coneOuterGain),c}static Parse(c,r,D,W){const t=c.name;let u;u=c.url?D+c.url:D+t;const a={autoplay:c.autoplay,loop:c.loop,volume:c.volume,spatialSound:c.spatialSound,maxDistance:c.maxDistance,rolloffFactor:c.rolloffFactor,refDistance:c.refDistance,distanceModel:c.distanceModel,playbackRate:c.playbackRate};let H;if(W){const c=()=>{(0,Ir.f)((()=>W._isReadyToPlay),(()=>{H._audioBuffer=W.getAudioBuffer(),H._isReadyToPlay=!0,H.autoplay&&H.play(0,H._offset,H._length)}),void 0,300)};H=new ir(t,new ArrayBuffer(0),r,null,a),c()}else H=new ir(t,u,r,(()=>{r.removePendingData(H)}),a),r.addPendingData(H);if(c.position){const r=B.Zr.er(c.position);H.setPosition(r)}if(c.isDirectional&&(H.setDirectionalCone(c.coneInnerAngle||360,c.coneOuterAngle||360,c.coneOuterGain||0),c.localDirectionToMesh)){const r=B.Zr.er(c.localDirectionToMesh);H.setLocalDirectionToMesh(r)}if(c.connectedMeshId){const D=r.getMeshById(c.connectedMeshId);D&&H.attachToMesh(D)}return c.metadata&&(H.metadata=c.metadata),H}_setOffset(c){this._offset!==c&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=c)}_clearTimeoutsAndObservers(){var c;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(c=Fr.b.audioEngine)||void 0===c||c.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}ir._SceneComponentInitialization=c=>{throw(0,lr.e)("AudioSceneComponent")},(0,ec.e)("BABYLON.Sound",ir);class nr{constructor(c,r,D){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],r.length!==D.length)throw new Error("Sounds length does not equal weights length");this.loop=c,this._weights=D;let W=0;for(const t of D)W+=t;const B=W>0?1/W:0;for(let t=0;t<this._weights.length;t++)this._weights[t]*=B;this._sounds=r;for(const t of this._sounds)t.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(c){if(c!==this._coneInnerAngle){if(this._coneOuterAngle<c)return void k.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=c;for(const r of this._sounds)r.directionalConeInnerAngle=c}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(c){if(c!==this._coneOuterAngle){if(c<this._coneInnerAngle)return void k.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=c;for(const r of this._sounds)r.directionalConeOuterAngle=c}}get volume(){return this._volume}set volume(c){if(c!==this._volume)for(const r of this._sounds)r.setVolume(c)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(c){if(!this.isPaused){this.stop();const c=Math.random();let r=0;for(let D=0;D<this._weights.length;D++)if(r+=this._weights[D],c<=r){this._currentIndex=D;break}}const r=this._sounds[this._currentIndex??0];r.isReady()?r.play(0,this.isPaused?void 0:c):r.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Vr{constructor(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(c=c||v.c.LastCreatedScene)&&(this._scene=c,this.soundCollection=[],this._options=r,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var c;null!==(c=Fr.b.audioEngine)&&void 0!==c&&c.canUseWebAudio&&Fr.b.audioEngine.audioContext&&(this._outputAudioNode=Fr.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Fr.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Fr.b.audioEngine&&Fr.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(c){var r;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(r=Fr.b.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._outputAudioNode&&c.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==c.soundTrackId&&(-1===c.soundTrackId?this._scene.mainSoundTrack.removeSound(c):this._scene.soundTracks&&this._scene.soundTracks[c.soundTrackId].removeSound(c)),this.soundCollection.push(c),c.soundTrackId=this.id}removeSound(c){const r=this.soundCollection.indexOf(c);-1!==r&&this.soundCollection.splice(r,1)}setVolume(c){var r;null!==(r=Fr.b.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=c)}switchPanningModelToHRTF(){var c;if(null!==(c=Fr.b.audioEngine)&&void 0!==c&&c.canUseWebAudio)for(let r=0;r<this.soundCollection.length;r++)this.soundCollection[r].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var c;if(null!==(c=Fr.b.audioEngine)&&void 0!==c&&c.canUseWebAudio)for(let r=0;r<this.soundCollection.length;r++)this.soundCollection[r].switchPanningModelToEqualPower()}connectToAnalyser(c){var r;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=c,null!==(r=Fr.b.audioEngine)&&void 0!==r&&r.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Fr.b.audioEngine.masterGain))}}var cD=D(11962),rD=D(11924),DD=D(11501);Fr.b.AudioEngineFactory=(c,r,D)=>new WD(c,r,D);class WD{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new M.c,this.onAudioLockedObservable=new M.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,DD.f)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const W=document.createElement("audio");this._hostElement=c,this._audioContext=r,this._audioDestination=D;try{W&&W.canPlayType&&(W.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||W.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(B){}try{W&&W.canPlayType&&W.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(B){}}lock(){this._triggerSuspendedState()}unlock(){var c,r;if("running"===(null===(c=this._audioContext)||void 0===c?void 0:c.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(r=this._audioContext)||void 0===r||r.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{k.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var c;null===(c=this._audioContext)||void 0===c||c.addEventListener("statechange",(()=>{var c;this.unlocked&&"running"!==(null===(c=this._audioContext)||void 0===c?void 0:c.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var c;return null!==(c=this._audioContext)&&void 0!==c&&c.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(c){this.canUseWebAudio=!1,k.e.Error("Web Audio: "+c.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(c){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const c=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",r=document.createElement("style");r.appendChild(document.createTextNode(c)),document.getElementsByTagName("head")[0].appendChild(r),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var c;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(c=this._audioContext)||void 0===c||c.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(c){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=c)}connectToAnalyser(c){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=c,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var BD=D(11517);(0,D(13060).c)(cD.c.NAME_AUDIO,((c,r,D,W)=>{let B,t=[];if(D.dm=D.dm||[],void 0!==c.dm&&null!==c.dm)for(let a=0,H=c.dm.length;a<H;a++){var u;const H=c.dm[a];null!==(u=Fr.b.audioEngine)&&void 0!==u&&u.canUseWebAudio?(H.url||(H.url=H.name),t[H.url]?D.dm.push(ir.Parse(H,r,W,t[H.url])):(B=ir.Parse(H,r,W),t[H.url]=B,D.dm.push(B))):D.dm.push(new ir(H.name,null,r))}t=[]})),Object.defineProperty(rD.b.prototype,"mainSoundTrack",{get:function(){let c=this._getComponent(cD.c.NAME_AUDIO);return c||(c=new tD(this),this.o(c)),this._mainSoundTrack||(this._mainSoundTrack=new Vr(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),rD.b.prototype.getSoundByName=function(c){let r;for(r=0;r<this.mainSoundTrack.soundCollection.length;r++)if(this.mainSoundTrack.soundCollection[r].name===c)return this.mainSoundTrack.soundCollection[r];if(this.soundTracks)for(let D=0;D<this.soundTracks.length;D++)for(r=0;r<this.soundTracks[D].soundCollection.length;r++)if(this.soundTracks[D].soundCollection[r].name===c)return this.soundTracks[D].soundCollection[r];return null},Object.defineProperty(rD.b.prototype,"audioEnabled",{get:function(){let c=this._getComponent(cD.c.NAME_AUDIO);return c||(c=new tD(this),this.o(c)),c.audioEnabled},set:function(c){let r=this._getComponent(cD.c.NAME_AUDIO);r||(r=new tD(this),this.o(r)),c?r.enableAudio():r.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(rD.b.prototype,"headphone",{get:function(){let c=this._getComponent(cD.c.NAME_AUDIO);return c||(c=new tD(this),this.o(c)),c.headphone},set:function(c){let r=this._getComponent(cD.c.NAME_AUDIO);r||(r=new tD(this),this.o(r)),c?r.switchAudioModeForHeadphones():r.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(rD.b.prototype,"audioListenerPositionProvider",{get:function(){let c=this._getComponent(cD.c.NAME_AUDIO);return c||(c=new tD(this),this.o(c)),c.audioListenerPositionProvider},set:function(c){let r=this._getComponent(cD.c.NAME_AUDIO);if(r||(r=new tD(this),this.o(r)),c&&"function"!==typeof c)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");r.audioListenerPositionProvider=c},enumerable:!0,configurable:!0}),Object.defineProperty(rD.b.prototype,"audioListenerRotationProvider",{get:function(){let c=this._getComponent(cD.c.NAME_AUDIO);return c||(c=new tD(this),this.o(c)),c.audioListenerRotationProvider},set:function(c){let r=this._getComponent(cD.c.NAME_AUDIO);if(r||(r=new tD(this),this.o(r)),c&&"function"!==typeof c)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");r.audioListenerRotationProvider=c},enumerable:!0,configurable:!0}),Object.defineProperty(rD.b.prototype,"audioPositioningRefreshRate",{get:function(){let c=this._getComponent(cD.c.NAME_AUDIO);return c||(c=new tD(this),this.o(c)),c.audioPositioningRefreshRate},set:function(c){let r=this._getComponent(cD.c.NAME_AUDIO);r||(r=new tD(this),this.o(r)),r.audioPositioningRefreshRate=c},enumerable:!0,configurable:!0});class tD{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(c){this.name=cD.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new B.Zr,this._cachedCameraPosition=new B.Zr,this._lastCheck=0,this._invertMatrixTemp=new B.Matrix,this._cameraDirectionTemp=new B.Zr,(c=c||v.c.LastCreatedScene)&&(this.qr=c,c.soundTracks=[],c.dm=[])}register(){this.qr._afterRenderStage.registerStep(cD.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(c){if(c.dm=[],this.qr.soundTracks)for(let r=0;r<this.qr.soundTracks.length;r++){const D=this.qr.soundTracks[r];for(let r=0;r<D.soundCollection.length;r++)c.dm.push(D.soundCollection[r].serialize())}}addFromContainer(c){if(c.dm)for(const r of c.dm)r.play(),r.autoplay=!0,this.qr.mainSoundTrack.addSound(r)}removeFromContainer(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(c.dm)for(const D of c.dm)D.stop(),D.autoplay=!1,this.qr.mainSoundTrack.removeSound(D),r&&D.dispose()}dispose(){const c=this.qr;if(c._mainSoundTrack&&c.mainSoundTrack.dispose(),c.soundTracks)for(let r=0;r<c.soundTracks.length;r++)c.soundTracks[r].dispose()}disableAudio(){const c=this.qr;let r;for(this._audioEnabled=!1,Fr.b.audioEngine&&Fr.b.audioEngine.audioContext&&Fr.b.audioEngine.audioContext.suspend(),r=0;r<c.mainSoundTrack.soundCollection.length;r++)c.mainSoundTrack.soundCollection[r].pause();if(c.soundTracks)for(r=0;r<c.soundTracks.length;r++)for(let D=0;D<c.soundTracks[r].soundCollection.length;D++)c.soundTracks[r].soundCollection[D].pause()}enableAudio(){const c=this.qr;let r;for(this._audioEnabled=!0,Fr.b.audioEngine&&Fr.b.audioEngine.audioContext&&Fr.b.audioEngine.audioContext.resume(),r=0;r<c.mainSoundTrack.soundCollection.length;r++)c.mainSoundTrack.soundCollection[r].isPaused&&c.mainSoundTrack.soundCollection[r].play();if(c.soundTracks)for(r=0;r<c.soundTracks.length;r++)for(let D=0;D<c.soundTracks[r].soundCollection.length;D++)c.soundTracks[r].soundCollection[D].isPaused&&c.soundTracks[r].soundCollection[D].play()}switchAudioModeForHeadphones(){const c=this.qr;if(this._headphone=!0,c.mainSoundTrack.switchPanningModelToHRTF(),c.soundTracks)for(let r=0;r<c.soundTracks.length;r++)c.soundTracks[r].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const c=this.qr;if(this._headphone=!1,c.mainSoundTrack.switchPanningModelToEqualPower(),c.soundTracks)for(let r=0;r<c.soundTracks.length;r++)c.soundTracks[r].switchPanningModelToEqualPower()}_afterRender(){const c=BD.e.Now;if(this._lastCheck&&c-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=c;const r=this.qr;if(!this._audioEnabled||!r._mainSoundTrack||!r.soundTracks||0===r._mainSoundTrack.soundCollection.length&&1===r.soundTracks.length)return;const D=Fr.b.audioEngine;if(D&&D.audioContext){let c,W=r.activeCamera;if(r.activeCameras&&r.activeCameras.length>0&&(W=r.activeCameras[0]),this.audioListenerPositionProvider){const c=this.audioListenerPositionProvider();D.audioContext.listener.setPosition(c.x||0,c.y||0,c.z||0)}else W?this._cachedCameraPosition.equals(W.globalPosition)||(this._cachedCameraPosition.t(W.globalPosition),D.audioContext.listener.setPosition(W.globalPosition.x,W.globalPosition.y,W.globalPosition.z)):D.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const c=this.audioListenerRotationProvider();D.audioContext.listener.setOrientation(c.x||0,c.y||0,c.z||0,0,1,0)}else W?(W.rigCameras&&W.rigCameras.length>0&&(W=W.rigCameras[0]),W.getViewMatrix().invertToRef(this._invertMatrixTemp),B.Zr.TransformNormalToRef(tD._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.t(this._cameraDirectionTemp),D.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):D.audioContext.listener.setOrientation(0,0,0,0,1,0);for(c=0;c<r.mainSoundTrack.soundCollection.length;c++){const D=r.mainSoundTrack.soundCollection[c];D.useCustomAttenuation&&D.updateDistanceFromListener()}if(r.soundTracks)for(c=0;c<r.soundTracks.length;c++)for(let D=0;D<r.soundTracks[c].soundCollection.length;D++){const W=r.soundTracks[c].soundCollection[D];W.useCustomAttenuation&&W.updateDistanceFromListener()}}}}tD._CameraDirection=new B.Zr(0,0,-1),ir._SceneComponentInitialization=c=>{let r=c._getComponent(cD.c.NAME_AUDIO);r||(r=new tD(c),c.o(r))};const uD="MSFT_audio_emitter";class aD{constructor(c){this.name=uD,this._loader=c,this.enabled=this._loader.isExtensionUsed(uD)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const c=this._loader.ua.extensions;if(c&&c[this.name]){const r=c[this.name];this._clips=r.clips,this._emitters=r.emitters,C.Assign(this._clips),C.Assign(this._emitters)}}loadSceneAsync(c,r){return R.LoadExtensionAsync(c,r,this.name,(async(D,W)=>{const B=new Array;B.push(this._loader.loadSceneAsync(c,r));for(const c of W.emitters){const r=C.Get(`${D}/emitters`,this._emitters,c);if(void 0!=r.refDistance||void 0!=r.maxDistance||void 0!=r.rolloffFactor||void 0!=r.distanceModel||void 0!=r.innerAngle||void 0!=r.outerAngle)throw new Error(`${D}: Direction or Distance properties are not allowed on emitters attached to a scene`);B.push(this._loadEmitterAsync(`${D}/emitters/${r.index}`,r))}await Promise.all(B)}))}loadNodeAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(c,W)=>{const t=new Array,a=await this._loader.loadNodeAsync(c,r,(r=>{for(const D of W.emitters){const W=C.Get(`${c}/emitters`,this._emitters,D);t.push(this._loadEmitterAsync(`${c}/emitters/${W.index}`,W).then((()=>{for(const c of W._babylonSounds)c.attachToMesh(r),void 0==W.innerAngle&&void 0==W.outerAngle||(c.setLocalDirectionToMesh(B.Zr.Forward()),c.setDirectionalCone(2*u.Tools.ToDegrees(void 0==W.innerAngle?Math.PI:W.innerAngle),2*u.Tools.ToDegrees(void 0==W.outerAngle?Math.PI:W.outerAngle),0))})))}D(r)}));return await Promise.all(t),a}))}loadAnimationAsync(c,r){return R.LoadExtensionAsync(c,r,this.name,(async(D,W)=>{const B=await this._loader.loadAnimationAsync(c,r),t=new Array;C.Assign(W.events);for(const u of W.events)t.push(this._loadAnimationEventAsync(`${D}/events/${u.index}`,c,r,u,B));return await Promise.all(t),B}))}_loadClipAsync(c,r){if(r._objectURL)return r._objectURL;let D;if(r.uri)D=this._loader.loadUriAsync(c,r,r.uri);else{const W=C.Get(`${c}/bufferView`,this._loader.ua.bufferViews,r.bufferView);D=this._loader.loadBufferViewAsync(`/bufferViews/${W.index}`,W)}return r._objectURL=D.then((c=>URL.createObjectURL(new Blob([c],{type:r.mimeType})))),r._objectURL}_loadEmitterAsync(c,r){if(r._babylonSounds=r._babylonSounds||[],!r._babylonData){const c=new Array,D=r.name||`emitter${r.index}`,W={loop:!1,autoplay:!1,volume:void 0==r.volume?1:r.volume};for(let t=0;t<r.clips.length;t++){const B=`/extensions/${this.name}/clips`,u=C.Get(B,this._clips,r.clips[t].clip);c.push(this._loadClipAsync(`${B}/${r.clips[t].clip}`,u).then((c=>{const B=r._babylonSounds[t]=new ir(D,c,this._loader.babylonScene,null,W);B.refDistance=r.refDistance||1,B.maxDistance=r.maxDistance||256,B.rolloffFactor=r.rolloffFactor||1,B.distanceModel=r.distanceModel||"exponential"})))}const B=Promise.all(c).then((()=>{const c=r.clips.map((c=>c.weight||1)),D=new nr(r.loop||!1,r._babylonSounds,c);r.innerAngle&&(D.directionalConeInnerAngle=2*u.Tools.ToDegrees(r.innerAngle)),r.outerAngle&&(D.directionalConeOuterAngle=2*u.Tools.ToDegrees(r.outerAngle)),r.volume&&(D.volume=r.volume),r._babylonData.sound=D}));r._babylonData={loaded:B}}return r._babylonData.loaded}_getEventAction(c,r,D,W,B){switch(D){case"play":return c=>{const D=(B||0)+(c-W);r.play(D)};case"stop":return()=>{r.stop()};case"pause":return()=>{r.pause()};default:throw new Error(`${c}: Unsupported action ${D}`)}}_loadAnimationEventAsync(c,r,D,W,B){if(0==B.targetedAnimations.length)return Promise.resolve();const t=B.targetedAnimations[0],u=W.tr,a=C.Get(`/extensions/${this.name}/emitters`,this._emitters,u);return this._loadEmitterAsync(c,a).then((()=>{const r=a._babylonData.sound;if(r){const D=new Qr(W.time,this._getEventAction(c,r,W.action,W.time,W.startOffset));t.animation.addEvent(D),B.onAnimationGroupEndObservable.add((()=>{r.stop()})),B.onAnimationGroupPauseObservable.add((()=>{r.pause()}))}}))}}d(uD),G(uD,!0,(c=>new aD(c)));const HD="MSFT_lod";class xD{constructor(c){var r;this.name=HD,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new M.c,this.onMaterialLODsLoadedObservable=new M.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=c,this.maxLODsToLoad=(null===(r=this._loader.parent.extensionOptions[HD])||void 0===r?void 0:r.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(HD)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let c=0;c<this._nodePromiseLODs.length;c++){const r=Promise.all(this._nodePromiseLODs[c]).then((()=>{0!==c&&(this._loader.endPerformanceCounter(`Node LOD ${c}`),this._loader.log(`Loaded node LOD ${c}`)),this.onNodeLODsLoadedObservable.notifyObservers(c),c!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${c+1}`),this._loadBufferLOD(this._nodeBufferLODs,c+1),this._nodeSignalLODs[c]&&this._nodeSignalLODs[c].resolve())}));this._loader._completePromises.push(r)}for(let c=0;c<this._materialPromiseLODs.length;c++){const r=Promise.all(this._materialPromiseLODs[c]).then((()=>{0!==c&&(this._loader.endPerformanceCounter(`Material LOD ${c}`),this._loader.log(`Loaded material LOD ${c}`)),this.onMaterialLODsLoadedObservable.notifyObservers(c),c!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${c+1}`),this._loadBufferLOD(this._materialBufferLODs,c+1),this._materialSignalLODs[c]&&this._materialSignalLODs[c].resolve())}));this._loader._completePromises.push(r)}}loadSceneAsync(c,r){const D=this._loader.loadSceneAsync(c,r);return this._loadBufferLOD(this._bufferLODs,0),D}loadNodeAsync(c,r,D){return R.LoadExtensionAsync(c,r,this.name,(async(c,B)=>{let t;const u=this._getLODs(c,r,this._loader.ua.nodes,B.ids);this._loader.logOpen(`${c}`);for(let r=0;r<u.length;r++){const c=u[r];0!==r&&(this._nodeIndexLOD=r,this._nodeSignalLODs[r]=this._nodeSignalLODs[r]||new W);const B=c=>{D(c),c.pa(!1)},a=this._loader.loadNodeAsync(`/nodes/${c.index}`,c,B).then((c=>{if(0!==r){const c=u[r-1];c._babylonTransformNode&&(this._disposeTransformNode(c._babylonTransformNode),delete c._babylonTransformNode)}return c.pa(!0),c}));this._nodePromiseLODs[r]=this._nodePromiseLODs[r]||[],0===r?t=a:(this._nodeIndexLOD=null,this._nodePromiseLODs[r].push(a))}return this._loader.logClose(),await t}))}_loadMaterialAsync(c,r,D,W,B){return this._nodeIndexLOD?null:R.LoadExtensionAsync(c,r,this.name,(async(c,t)=>{let u;const a=this._getLODs(c,r,this._loader.ua.materials,t.ids);this._loader.logOpen(`${c}`);for(let r=0;r<a.length;r++){const c=a[r];0!==r&&(this._materialIndexLOD=r);const t=this._loader._loadMaterialAsync(`/materials/${c.index}`,c,D,W,(c=>{0===r&&B(c)})).then((c=>{if(0!==r){B(c);const D=a[r-1]._data;D[W]&&(this._disposeMaterials([D[W].babylonMaterial]),delete D[W])}return c}));this._materialPromiseLODs[r]=this._materialPromiseLODs[r]||[],0===r?u=t:(this._materialIndexLOD=null,this._materialPromiseLODs[r].push(t))}return this._loader.logClose(),await u}))}_loadUriAsync(c,r,D){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const B=this._nodeIndexLOD-1;return this._nodeSignalLODs[B]=this._nodeSignalLODs[B]||new W,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(c,r,D)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const B=this._materialIndexLOD-1;return this._materialSignalLODs[B]=this._materialSignalLODs[B]||new W,this._materialSignalLODs[B].promise.then((async()=>await this._loader.loadUriAsync(c,r,D)))}return null}loadBufferAsync(c,r,D,B){if(this._loader.parent.useRangeRequests&&!r.uri){if(!this._loader.bin)throw new Error(`${c}: Uri is missing or the binary glTF is missing its binary chunk`);const r=async(c,r)=>{const t=D,u=t+B-1;let a=c[r];return a?(a.start=Math.min(a.start,t),a.end=Math.max(a.end,u)):(a={start:t,end:u,loaded:new W},c[r]=a),await a.loaded.promise.then((c=>new Uint8Array(c.buffer,c.byteOffset+D-a.start,B)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?r(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?r(this._materialBufferLODs,this._materialIndexLOD):r(this._bufferLODs,0)}return null}_loadBufferLOD(c,r){const D=c[r];D&&(this._loader.log(`Loading buffer range [${D.start}-${D.end}]`),this._loader.bin.readAsync(D.start,D.end-D.start+1).then((c=>{D.loaded.resolve(c)}),(c=>{D.loaded.reject(c)})))}_getLODs(c,r,D,W){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const B=[];for(let t=W.length-1;t>=0;t--)if(B.push(C.Get(`${c}/ids/${W[t]}`,D,W[t])),B.length===this.maxLODsToLoad)return B;return B.push(r),B}_disposeTransformNode(c){const r=[],D=c.material;D&&r.push(D);for(const B of c.getChildMeshes())B.material&&r.push(B.material);c.dispose();const W=r.filter((c=>this._loader.babylonScene.meshes.every((r=>r.material!=c))));this._disposeMaterials(W)}_disposeMaterials(c){const r={};for(const D of c){for(const c of D.getActiveTextures())r[c.uniqueId]=c;D.dispose()}for(const D in r)for(const c of this._loader.babylonScene.materials)c.hasTexture(r[D])&&delete r[D];for(const D in r)r[D].dispose()}}d(HD),G(HD,!0,(c=>new xD(c)));const MD="MSFT_minecraftMesh";class ED{constructor(c){this.name=MD,this._loader=c,this.enabled=this._loader.isExtensionUsed(MD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtraAsync(c,r,this.name,(async(W,B)=>{if(B){if(!(D instanceof q.d))throw new Error(`${W}: Material type not supported`);const B=this._loader.loadMaterialPropertiesAsync(c,r,D);return D.needAlphaBlending()&&(D.forceDepthWrite=!0,D.separateCullingPass=!0),D.Za=D.forceDepthWrite,D.twoSidedLighting=!0,await B}}))}}d(MD),G(MD,!0,(c=>new ED(c)));const mD="MSFT_sRGBFactors";class YD{constructor(c){this.name=mD,this._loader=c,this.enabled=this._loader.isExtensionUsed(mD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(c,r,D){return R.LoadExtraAsync(c,r,this.name,(async(W,B)=>{if(B){if(!(D instanceof q.d))throw new Error(`${W}: Material type not supported`);const B=this._loader.loadMaterialPropertiesAsync(c,r,D),t=D.yc().getEngine().useExactSrgbConversions;return D.albedoTexture||D.albedoColor.toLinearSpaceToRef(D.albedoColor,t),D.reflectivityTexture||D.reflectivityColor.toLinearSpaceToRef(D.reflectivityColor,t),await B}}))}}d(mD),G(mD,!0,(c=>new YD(c)));var vD=D(13384);const kD={};var wD=D(13426),ZD=D(13406),JD=D(13388),qD=D(13392);function jD(c,r){for(const D of c)for(const c of D.dataOutputs)if(c.uniqueId===r)return c;throw new Error("Could not find data out connection with unique id "+r)}function XD(c,r){for(const D of c)if(D instanceof ZD.b)for(const c of D.signalInputs)if(c.uniqueId===r)return c;throw new Error("Could not find signal in connection with unique id "+r)}async function eD(c,r){const W=await Promise.all(c.allBlocks.map((async c=>{const r=function(c){switch(c){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([D.e(78),D.e(79)]).then(D.bind(D,14884))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await D.e(80).then(D.bind(D,14888))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await D.e(81).then(D.bind(D,14891))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await D.e(82).then(D.bind(D,14897))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await D.e(83).then(D.bind(D,14899))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await D.e(84).then(D.bind(D,14907))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await D.e(85).then(D.bind(D,14911))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await D.e(86).then(D.bind(D,14914))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await D.e(87).then(D.bind(D,14919))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await D.e(89).then(D.bind(D,14945))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await D.e(89).then(D.bind(D,14945))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await D.e(89).then(D.bind(D,14945))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await D.e(89).then(D.bind(D,14945))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await D.e(89).then(D.bind(D,14945))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await D.e(89).then(D.bind(D,14945))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await D.e(90).then(D.bind(D,14948))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await D.e(90).then(D.bind(D,14948))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await D.e(90).then(D.bind(D,14948))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await D.e(90).then(D.bind(D,14948))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await D.e(95).then(D.bind(D,14953))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await D.e(96).then(D.bind(D,14962))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await D.e(97).then(D.bind(D,14965))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await D.e(98).then(D.bind(D,14973))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await D.e(99).then(D.bind(D,14977))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await D.e(100).then(D.bind(D,14983))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await D.e(101).then(D.bind(D,14985))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await D.e(102).then(D.bind(D,14989))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await D.e(103).then(D.bind(D,14998))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await D.e(104).then(D.bind(D,15e3))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await D.e(105).then(D.bind(D,15009))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await D.e(106).then(D.bind(D,15017))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await D.e(107).then(D.bind(D,15023))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await D.e(108).then(D.bind(D,15030))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await D.e(109).then(D.bind(D,15032))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await D.e(110).then(D.bind(D,15035))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await D.e(111).then(D.bind(D,15042))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await D.e(112).then(D.bind(D,15049))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await D.e(113).then(D.bind(D,15057))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await D.e(92).then(D.bind(D,15065))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await D.e(114).then(D.bind(D,15073))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await D.e(115).then(D.bind(D,15075))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await D.e(116).then(D.bind(D,15081))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await D.e(93).then(D.bind(D,15089))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await D.e(88).then(D.bind(D,14928))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await D.e(94).then(D.bind(D,15091))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await D.e(94).then(D.bind(D,15091))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await D.e(94).then(D.bind(D,15091))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await D.e(94).then(D.bind(D,15091))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await D.e(94).then(D.bind(D,15091))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await D.e(94).then(D.bind(D,15091))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await D.e(94).then(D.bind(D,15091))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await D.e(94).then(D.bind(D,15091))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await D.e(89).then(D.bind(D,14945))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await D.e(89).then(D.bind(D,14945))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await D.e(89).then(D.bind(D,14945))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await D.e(89).then(D.bind(D,14945))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await D.e(89).then(D.bind(D,14945))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await D.e(89).then(D.bind(D,14945))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await D.e(89).then(D.bind(D,14945))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await D.e(90).then(D.bind(D,14948))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await D.e(90).then(D.bind(D,14948))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await D.e(91).then(D.bind(D,15094))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await D.e(91).then(D.bind(D,15094))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await D.e(91).then(D.bind(D,15094))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await D.e(91).then(D.bind(D,15094))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await D.e(91).then(D.bind(D,15094))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await D.e(91).then(D.bind(D,15094))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await D.e(117).then(D.bind(D,15098))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await D.e(118).then(D.bind(D,15100))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await D.e(119).then(D.bind(D,15103))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await D.e(120).then(D.bind(D,15107))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await D.e(121).then(D.bind(D,15114))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await D.e(122).then(D.bind(D,15120))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await D.e(123).then(D.bind(D,15126))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await D.e(124).then(D.bind(D,15134))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await D.e(125).then(D.bind(D,15139))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await D.e(126).then(D.bind(D,15144))).FlowGraphDataSwitchBlock;default:if(kD[c])return kD[c];throw new Error(`Unknown block name ${c}`)}}(c.className);return await r()})));return function(c,r,D){const W=r.coordinator.createGraph(),B=[],t=r.valueParseFunction??JD.d;for(let u=0;u<c.allBlocks.length;u++){const a=UD(c.allBlocks[u],{qr:r.coordinator.config.qr,pathConverter:r.pathConverter,assetsContainer:r.coordinator.config.qr,valueParseFunction:t},D[u]);B.push(a),a instanceof wD.d&&W.addEventBlock(a)}for(const u of B){for(const c of u.dataInputs)for(const r of c.connectedPointIds){const D=jD(B,r);c.connectTo(D)}if(u instanceof ZD.b)for(const c of u.signalOutputs)for(const r of c.connectedPointIds){const D=XD(B,r);c.connectTo(D)}}for(const u of c.executionContexts)yD(u,{graph:W,valueParseFunction:t},c.rightHanded);return W}(c,r,W)}function yD(c,r,D){const W=r.graph.createContext();c.enableLogging&&(W.enableLogging=!0),W.treatDataAsRightHanded=D||!1;const B=r.valueParseFunction??JD.d;W.uniqueId=c.uniqueId;const t=W.yc();if(c._assetsContext){var u,a,H,x,M,E,m,Y,v,k;const r=c._assetsContext,D={meshes:null===(u=r.meshes)||void 0===u?void 0:u.map((c=>t.getMeshById(c))),lights:null===(a=r.lights)||void 0===a?void 0:a.map((c=>t.getLightByName(c))),cameras:null===(H=r.cameras)||void 0===H?void 0:H.map((c=>t.getCameraByName(c))),materials:null===(x=r.materials)||void 0===x?void 0:x.map((c=>t.getMaterialById(c))),textures:null===(M=r.textures)||void 0===M?void 0:M.map((c=>t.getTextureByName(c))),animations:null===(E=r.animations)||void 0===E?void 0:E.map((c=>t.animations.find((r=>r.name===c)))),skeletons:null===(m=r.skeletons)||void 0===m?void 0:m.map((c=>t.getSkeletonByName(c))),rm:null===(Y=r.rm)||void 0===Y?void 0:Y.map((c=>t.getParticleSystemById(c))),animationGroups:null===(v=r.animationGroups)||void 0===v?void 0:v.map((c=>t.getAnimationGroupByName(c))),transformNodes:null===(k=r.transformNodes)||void 0===k?void 0:k.map((c=>t.getTransformNodeById(c))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],dm:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};W.assetsContext=D}for(const w in c._userVariables){const r=B(w,c._userVariables,W.assetsContext,t);W.userVariables[w]=r}for(const w in c._connectionValues){const r=B(w,c._connectionValues,W.assetsContext,t);W._setConnectionValueByKey(w,r)}return W}function UD(c,r,D){const W={},B=r.valueParseFunction??JD.d;if(c.config)for(const u in c.config)W[u]=B(u,c.config,r.assetsContainer||r.qr,r.qr);if((0,JD.i)(c.className)){if(!r.pathConverter)throw new Error("Path converter is required for this block");W.pathConverter=r.pathConverter}const t=new D(W);t.uniqueId=c.uniqueId;for(let u=0;u<c.dataInputs.length;u++){const r=t.getDataInput(c.dataInputs[u].name);if(!r)throw new Error("Could not find data input with name "+c.dataInputs[u].name+" in block "+c.className);r.deserialize(c.dataInputs[u])}for(let u=0;u<c.dataOutputs.length;u++){const r=t.getDataOutput(c.dataOutputs[u].name);if(!r)throw new Error("Could not find data output with name "+c.dataOutputs[u].name+" in block "+c.className);r.deserialize(c.dataOutputs[u])}return t.metadata=c.metadata,t.deserialize&&t.deserialize(c),t}function ND(c){const[r,D]=c.split(":");return gD({op:r,extension:D})}function gD(c){var r;let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const W=c.extension?null===(r=SD[c.extension])||void 0===r?void 0:r[c.op]:KD[c.op];if(!W&&(k.e.Warn(`No mapping found for operation ${c.op} and extension ${c.extension||"KHR_interactivity"}`),D)){const r={},D={flows:{}};if(c.inputValueSockets){r.values={};for(const D in c.inputValueSockets)r.values[D]={name:D}}return c.outputValueSockets&&(D.values={},Object.keys(c.outputValueSockets).forEach((c=>{D.values[c]={name:c}}))),{qM:[],inputs:r,outputs:D}}return W}function zD(c,r,D){SD[r]||(SD[r]={}),SD[r][c]=D}const SD={BABYLON:{"flow/log":{qM:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},KD={"event/onStart":{qM:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{qM:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{qM:["FlowGraphSendCustomEventBlock"],extraProcessor(c,r,D,W,B){if("event/send"!==r.op||!c.configuration||1!==Object.keys(c.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const t=c.configuration.event.value[0];if("number"!==typeof t)throw new Error("Event id should be a number");const u=W.arrays.events[t],a=B[0];return a.config||(a.config={}),a.config.eventId=u.eventId,a.config.eventData=u.eventData,B}},"event/receive":{qM:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(c,r){var D;if(!c.configuration)return k.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const W=c.configuration.event;if(!W)return k.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const B=W.value[0];if("number"!==typeof B)return k.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(D=r.events)||void 0===D?void 0:D[B])?{valid:!0}:(k.e.Error(`Event with id ${B} not found`),{valid:!1,error:`Event with id ${B} not found`})},extraProcessor(c,r,D,W,B){if("event/receive"!==r.op||!c.configuration||1!==Object.keys(c.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const t=c.configuration.event.value[0];if("number"!==typeof t)throw new Error("Event id should be a number");const u=W.arrays.events[t],a=B[0];return a.config||(a.config={}),a.config.eventId=u.eventId,a.config.eventData=u.eventData,B}},"math/e":fD("FlowGraphEBlock"),"math/pi":fD("FlowGraphPIBlock"),"math/inf":fD("FlowGraphInfBlock"),"math/nan":fD("FlowGraphNaNBlock"),"math/abs":fD("FlowGraphAbsBlock"),"math/sign":fD("FlowGraphSignBlock"),"math/trunc":fD("FlowGraphTruncBlock"),"math/floor":fD("FlowGraphFloorBlock"),"math/ceil":fD("FlowGraphCeilBlock"),"math/round":{qM:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,r,D,W,B){var t;return(t=B[0]).config||(t.config={}),B[0].config.roundHalfAwayFromZero=!0,B}},"math/fract":fD("FlowGraphFractBlock"),"math/neg":fD("FlowGraphNegationBlock"),"math/add":fD("FlowGraphAddBlock",["a","b"],!0),"math/sub":fD("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{qM:["FlowGraphMultiplyBlock"],extraProcessor(c,r,D,W,B){var t;(t=B[0]).config||(t.config={}),B[0].config.useMatrixPerComponent=!0,B[0].config.preventIntegerFloatArithmetic=!0;let u=-1;return Object.keys(c.values||{}).find((r=>{var D;return void 0!==(null===(D=c.values)||void 0===D?void 0:D[r].type)&&(u=c.values[r].type,!0)})),-1!==u&&(B[0].config.type=W.arrays.types[u].flowGraphType),B},validation:c=>c.values?AD(c):{valid:!0}},"math/div":fD("FlowGraphDivideBlock",["a","b"],!0),"math/rem":fD("FlowGraphModuloBlock",["a","b"]),"math/min":fD("FlowGraphMinBlock",["a","b"]),"math/max":fD("FlowGraphMaxBlock",["a","b"]),"math/clamp":fD("FlowGraphClampBlock",["a","b","c"]),"math/saturate":fD("FlowGraphSaturateBlock"),"math/mix":fD("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":fD("FlowGraphEqualityBlock",["a","b"]),"math/lt":fD("FlowGraphLessThanBlock",["a","b"]),"math/le":fD("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":fD("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":fD("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":fD("FlowGraphIsNaNBlock"),"math/isinf":fD("FlowGraphIsInfBlock"),"math/select":{qM:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{qM:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":fD("FlowGraphSinBlock"),"math/cos":fD("FlowGraphCosBlock"),"math/tan":fD("FlowGraphTanBlock"),"math/asin":fD("FlowGraphASinBlock"),"math/acos":fD("FlowGraphACosBlock"),"math/atan":fD("FlowGraphATanBlock"),"math/atan2":fD("FlowGraphATan2Block",["a","b"]),"math/sinh":fD("FlowGraphSinhBlock"),"math/cosh":fD("FlowGraphCoshBlock"),"math/tanh":fD("FlowGraphTanhBlock"),"math/asinh":fD("FlowGraphASinhBlock"),"math/acosh":fD("FlowGraphACoshBlock"),"math/atanh":fD("FlowGraphATanhBlock"),"math/exp":fD("FlowGraphExponentialBlock"),"math/log":fD("FlowGraphLogBlock"),"math/log2":fD("FlowGraphLog2Block"),"math/log10":fD("FlowGraphLog10Block"),"math/sqrt":fD("FlowGraphSquareRootBlock"),"math/cbrt":fD("FlowGraphCubeRootBlock"),"math/pow":fD("FlowGraphPowerBlock",["a","b"]),"math/length":fD("FlowGraphLengthBlock"),"math/normalize":fD("FlowGraphNormalizeBlock"),"math/dot":fD("FlowGraphDotBlock",["a","b"]),"math/cross":fD("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":fD("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":fD("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{qM:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{qM:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{qM:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{qM:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{qM:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{qM:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{qM:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":fD("FlowGraphTransposeBlock"),"math/determinant":fD("FlowGraphDeterminantBlock"),"math/inverse":fD("FlowGraphInvertMatrixBlock"),"math/matmul":fD("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{qM:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"qa",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,r,D,W,B,t){const u=B[0].dataInputs.find((c=>"rotationQuaternion"===c.name));if(!u)throw new Error("Rotation quaternion input not found");return t._connectionValues[u.uniqueId]&&(t._connectionValues[u.uniqueId].type="Quaternion"),B}},"math/matDecompose":{qM:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"qa"}}}},"math/quatConjugate":fD("FlowGraphConjugateBlock",["a"]),"math/quatMul":{qM:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,r,D,W,B){var t;return(t=B[0]).config||(t.config={}),B[0].config.type="Quaternion",B}},"math/quatAngleBetween":fD("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{qM:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":fD("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":fD("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{qM:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,r,D,W,B){var t;return(t=B[0]).config||(t.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract2x2":{qM:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{qM:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,r,D,W,B){var t;return(t=B[0]).config||(t.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract3x3":{qM:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{qM:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,r,D,W,B){var t;return(t=B[0]).config||(t.config={}),B[0].config.inputIsColumnMajor=!0,B}},"math/extract4x4":{qM:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{qM:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,r,D,W,B,t){var u,a;(a=B[0]).config||(a.config={});const H=B[0].dataInputs[0];return B[0].config.valueType=(null===(u=t._connectionValues[H.uniqueId])||void 0===u?void 0:u.type)??"FlowGraphInteger",B}},"math/and":{qM:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,r,D,W,B,t){var u,a,H;(H=B[0]).config||(H.config={});const x=B[0].dataInputs[0],M=B[0].dataInputs[1];return B[0].config.valueType=(null===(u=t._connectionValues[x.uniqueId])||void 0===u?void 0:u.type)??(null===(a=t._connectionValues[M.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",B}},"math/or":{qM:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,r,D,W,B,t){var u,a,H;(H=B[0]).config||(H.config={});const x=B[0].dataInputs[0],M=B[0].dataInputs[1];return B[0].config.valueType=(null===(u=t._connectionValues[x.uniqueId])||void 0===u?void 0:u.type)??(null===(a=t._connectionValues[M.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",B}},"math/xor":{qM:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(c,r,D,W,B,t){var u,a,H;(H=B[0]).config||(H.config={});const x=B[0].dataInputs[0],M=B[0].dataInputs[1];return B[0].config.valueType=(null===(u=t._connectionValues[x.uniqueId])||void 0===u?void 0:u.type)??(null===(a=t._connectionValues[M.uniqueId])||void 0===a?void 0:a.type)??"FlowGraphInteger",B}},"math/asr":fD("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":fD("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":fD("FlowGraphLeadingZerosBlock"),"math/ctz":fD("FlowGraphTrailingZerosBlock"),"math/popcnt":fD("FlowGraphOneBitsCounterBlock"),"math/rad":fD("FlowGraphDegToRadBlock"),"math/deg":fD("FlowGraphRadToDegBlock"),"type/boolToInt":fD("FlowGraphBooleanToInt"),"type/boolToFloat":fD("FlowGraphBooleanToFloat"),"type/intToBool":fD("FlowGraphIntToBoolean"),"type/intToFloat":fD("FlowGraphIntToFloat"),"type/floatToInt":fD("FlowGraphFloatToInt"),"type/floatToBool":fD("FlowGraphFloatToBoolean"),"flow/sequence":{qM:["FlowGraphSequenceBlock"],extraProcessor(c,r,D,W,B){const t=B[0];return t.config||(t.config={}),t.config.outputSignalCount=Object.keys(c.flows||[]).length,t.signalOutputs.forEach(((c,r)=>{c.name="out_"+r})),B}},"flow/branch":{qM:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{qM:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(c){if(c.configuration&&c.configuration.cases){const r=c.configuration.cases.value;if(!r.every((c=>"number"===typeof c&&/^-?\d+$/.test(c.toString()))))return k.e.Warn("Switch cases should be integers. Using empty array instead."),c.configuration.cases.value=[],{valid:!0};const D=new Set(r);c.configuration.cases.value=Array.from(D)}return{valid:!0}},extraProcessor(c,r,D,W,B){if("flow/switch"!==r.op||!c.flows||0===Object.keys(c.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return B[0].signalOutputs.forEach((c=>{"default"!==c.name&&(c.name="out_"+c.name)})),B}},"flow/while":{qM:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{qM:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(c,r,D,W,B){const t=B[0];return t.config||(t.config={}),t.config.incrementIndexWhenLoopDone=!0,B}},"flow/doN":{qM:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{qM:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(c,r,D,W,B){if("flow/multiGate"!==r.op||!c.flows||0===Object.keys(c.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const t=B[0];return t.config||(t.config={}),t.config.outputSignalCount=Object.keys(c.flows).length,t.signalOutputs.forEach(((c,r)=>{c.name="out_"+r})),B}},"flow/waitAll":{qM:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(c){var r,D;return"number"!==typeof(null===(r=c.configuration)||void 0===r||null===(D=r.inputFlows)||void 0===D?void 0:D.value[0])&&(c.configuration=c.configuration||{inputFlows:{value:[0]}},c.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{qM:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{qM:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{qM:["FlowGraphCancelDelayBlock"]},"variable/get":{qM:["FlowGraphGetVariableBlock"],validation(c){var r,D;return null!==(r=c.configuration)&&void 0!==r&&null!==(D=r.variable)&&void 0!==D&&D.value?{valid:!0}:(k.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(c,r)=>[r.getVariableName(c[0])]}}},"variable/set":{qM:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(c,r)=>[r.getVariableName(c[0])]}}},"variable/setMultiple":{qM:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(c,r)=>[c[0].map((c=>r.getVariableName(c)))]}},extraProcessor:(c,r,D,W,B)=>(B[0].dataInputs.forEach((c=>{c.name=W.getVariableName(+c.name)})),B)},"variable/interpolate":{qM:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(c,r)=>[r.getVariableName(c[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:c=>!0===c[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",UD:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",UD:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",UD:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",UD:"FlowGraphPlayAnimationBlock"},out:{name:"out",UD:"FlowGraphPlayAnimationBlock"},done:{name:"done",UD:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(c,r,D,W,B){var t,u,a;const H=B[0],x=null===(t=c.configuration)||void 0===t?void 0:t.variable.value[0];if("number"!==typeof x)throw k.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const M=W.arrays.staticVariables[x];"undefined"===typeof H.config.animationType.value&&(W.arrays.staticVariables,H.config.animationType.value=(0,qD.I)(M.type));const E=B[4];return E.config||(E.config={}),(u=E.config).variable||(u.variable={}),E.config.variable.value=W.getVariableName(x),(a=B[3]).config||(a.config={}),B}},"pointer/get":{qM:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",UD:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",UD:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(c,r,D,W,B)=>(B.forEach((c=>{"FlowGraphJsonPointerParserBlock"===c.className&&(c.config||(c.config={}),c.config.outputValue=!0)})),B)},"pointer/set":{qM:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",UD:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",UD:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(c,r,D,W,B)=>(B.forEach((c=>{"FlowGraphJsonPointerParserBlock"===c.className&&(c.config||(c.config={}),c.config.outputValue=!0)})),B)},"pointer/interpolate":{qM:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",UD:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",UD:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",UD:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",UD:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",UD:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",UD:"FlowGraphPlayAnimationBlock"},out:{name:"out",UD:"FlowGraphPlayAnimationBlock"},done:{name:"done",UD:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(c,r,D,W,B)=>(B.forEach((r=>{"FlowGraphJsonPointerParserBlock"===r.className?(r.config||(r.config={}),r.config.outputValue=!0):"FlowGraphInterpolationBlock"===r.className&&(r.config||(r.config={}),Object.keys(c.values||[]).forEach((D=>{var B;const t=null===(B=c.values)||void 0===B?void 0:B[D];if("value"===D&&t){const c=t.type;void 0!==c&&(r.config.animationType=W.arrays.types[c].flowGraphType)}})))})),B)},"animation/start":{qM:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",UD:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(c,r)=>[c[0]*r._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(c,r)=>[c[0]*r._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(c,r,D,W,B,t,u){const a=B[B.length-1];return a.config||(a.config={}),a.config.glTF=u,B}},"animation/stop":{qM:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",UD:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(c,r,D,W,B,t,u){const a=B[B.length-1];return a.config||(a.config={}),a.config.glTF=u,B}},"animation/stopAt":{qM:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",UD:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(c,r)=>[c[0]*r._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(c,r,D,W,B,t,u){const a=B[B.length-1];return a.config||(a.config={}),a.config.glTF=u,B}},"math/switch":{qM:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(c){if(c.configuration&&c.configuration.cases){const r=c.configuration.cases.value;if(!r.every((c=>"number"===typeof c&&/^-?\d+$/.test(c.toString()))))return k.e.Warn("Switch cases should be integers. Using empty array instead."),c.configuration.cases.value=[],{valid:!0};const D=new Set(r);c.configuration.cases.value=Array.from(D)}return{valid:!0}},extraProcessor(c,r,D,W,B){const t=B[0];return t.dataInputs.forEach((c=>{"default"!==c.name&&"case"!==c.name&&(c.name="in_"+c.name)})),t.config||(t.config={}),t.config.treatCasesAsIntegers=!0,B}},"debug/log":{qM:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function fD(c){let r=arguments.length>2?arguments[2]:void 0;return{qM:[c],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((c,r)=>(c[r]={name:r},c)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(c,D,W,B,t){var u;if(r){(u=t[0]).config||(u.config={}),t[0].config.preventIntegerFloatArithmetic=!0;let r=-1;Object.keys(c.values||{}).find((D=>{var W;return void 0!==(null===(W=c.values)||void 0===W?void 0:W[D].type)&&(r=c.values[D].type,!0)})),-1!==r&&(t[0].config.type=B.arrays.types[r].flowGraphType)}return t},validation:c=>r?AD(c):{valid:!0}}}function AD(c){if(c.values){const r=Object.keys(c.values).map((r=>c.values[r].type)).filter((c=>void 0!==c));if(!r.every((c=>c===r[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}KD["math/compose"]=KD["math/matCompose"],KD["math/decompose"]=KD["math/matDecompose"];var hD=D(11646);const LD={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Zr",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class PD{constructor(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=c,this._gltf=r,this._animationTargetFps=D,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const c of this._interactivityGraph.types)this._types.push(LD[c.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const c of this._interactivityGraph.declarations){const r=gD(c);if(!r)throw k.e.Error(["No mapping found for declaration",c]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:r,fullOperationName:c.extension?c.op+":"+c.extension:c.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const c of this._interactivityGraph.variables){const r=this._parseVariable(c);this._staticVariables.push(r)}}_parseVariable(c,r){const D=this._types[c.type];if(!D)throw k.e.Error(["No type found for variable",c]),new Error("Error parsing variables");if(c.value&&c.value.length!==D.length)throw k.e.Error(["Invalid value length for variable",c,D]),new Error("Error parsing variables");const W=c.value||[];if(!W.length)switch(D.flowGraphType){case"boolean":W.push(!1);break;case"FlowGraphInteger":W.push(0);break;case"number":W.push(NaN);break;case"Vector2":W.push(NaN,NaN);break;case"Zr":W.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":W.fill(NaN,0,4);break;case"Matrix":W.fill(NaN,0,16);break;case"Matrix3D":W.fill(NaN,0,9)}return"number"===D.elementType&&"string"===typeof W[0]&&(W[0]=parseFloat(W[0])),{type:D.flowGraphType,value:r?r(W,this):W}}_parseEvents(){if(this._interactivityGraph.events)for(const c of this._interactivityGraph.events){const r={eventId:c.id||"internalEvent_"+this._internalEventsCounter++};c.values&&(r.eventData=Object.keys(c.values).map((r=>{var D;const W=null===(D=c.values)||void 0===D?void 0:D[r];if(!W)throw k.e.Error(["No value found for event key",r]),new Error("Error parsing events");const B=this._types[W.type];if(!B)throw k.e.Error(["No type found for event value",W]),new Error("Error parsing events");const t="undefined"!==typeof W.value?this._parseVariable(W):void 0;return{id:r,type:B.flowGraphType,eventData:!0,value:t}}))),this._events.push(r)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const r of this._interactivityGraph.nodes){if("number"!==typeof r.declaration)throw k.e.Error(["No declaration found for node",r]),new Error("Error parsing nodes");const D=this._mappings[r.declaration];if(!D)throw k.e.Error(["No mapping found for node",r]),new Error("Error parsing nodes");if(D.flowGraphMapping.validation){const W=D.flowGraphMapping.validation(r,this._interactivityGraph,this._gltf);var c;if(!W.valid)throw new Error(`Error validating interactivity node ${null===(c=this._interactivityGraph.declarations)||void 0===c?void 0:c[r.declaration].op} - ${W.error}`)}const W=[];for(const c of D.flowGraphMapping.qM){const B=this._getEmptyBlock(c,D.fullOperationName);this._parseNodeConfiguration(r,B,D.flowGraphMapping,c),W.push(B)}this._nodes.push({qM:W,fullOperationName:D.fullOperationName})}}_getEmptyBlock(c,r){return{uniqueId:(0,hD.c)(),className:c,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:r,metadata:{}}}_parseNodeConfiguration(c,r,D,W){const B=r.config;if(c.configuration){const r=Object.keys(c.configuration);for(const a of r){var t,u;const r=null===(t=c.configuration)||void 0===t?void 0:t[a];if(!r)throw k.e.Error(["No value found for node configuration",a]),new Error("Error parsing node configuration");const H=null===(u=D.configuration)||void 0===u?void 0:u[a];if(H&&H.UD?H.UD===W:0===D.qM.indexOf(W)){const c=(null===H||void 0===H?void 0:H.name)||a;r&&"undefined"!==typeof r.value||"undefined"===typeof(null===H||void 0===H?void 0:H.defaultValue)?r.value.length>=0?B[c]={value:1===r.value.length?r.value[0]:r.value}:k.e.Warn(["Invalid value for node configuration",r]):B[c]={value:H.defaultValue},H&&H.dataTransformer&&(B[c].value=H.dataTransformer([B[c].value],this)[0])}}}}_parseNodeConnections(c){for(let e=0;e<this._nodes.length;e++){var r;const y=null===(r=this._interactivityGraph.nodes)||void 0===r?void 0:r[e];if(!y)throw k.e.Error(["No node found for interactivity node",this._nodes[e]]),new Error("Error parsing node connections");const U=this._nodes[e],N=this._mappings[y.declaration];if(!N)throw k.e.Error(["No mapping found for node",y]),new Error("Error parsing node connections");const g=y.flows||{},z=Object.keys(g).sort();for(const c of z){var D,W,B,t;const r=g[c],x=null===(D=N.flowGraphMapping.outputs)||void 0===D||null===(W=D.flows)||void 0===W?void 0:W[c],M=(null===x||void 0===x?void 0:x.name)||c,E=this._createNewSocketConnection(M,!0);(x&&x.UD&&U.qM.find((c=>c.className===x.UD))||U.qM[0]).signalOutputs.push(E);const m=r.node,Y=this._nodes[m];if(!Y)throw k.e.Error(["No node found for input node id",m]),new Error("Error parsing node connections");const v=ND(Y.fullOperationName);if(!v)throw k.e.Error(["No mapping found for input node",Y]),new Error("Error parsing node connections");let w=null===(B=v.inputs)||void 0===B||null===(t=B.flows)||void 0===t?void 0:t[r.socket||"in"],Z=!1;if(!w)for(const c in null===(u=v.inputs)||void 0===u?void 0:u.flows){var u,a,H;if(c.startsWith("[")&&c.endsWith("]"))Z=!0,w=null===(a=v.inputs)||void 0===a||null===(H=a.flows)||void 0===H?void 0:H[c]}const J=w?Z?w.name.replace("$1",r.socket||""):w.name:r.socket||"in",q=w&&w.UD&&Y.qM.find((c=>c.className===w.UD))||Y.qM[0];let j=q.signalInputs.find((c=>c.name===J));j||(j=this._createNewSocketConnection(J),q.signalInputs.push(j)),j.connectedPointIds.push(E.uniqueId),E.connectedPointIds.push(j.uniqueId)}const S=y.values||{},K=Object.keys(S);for(const r of K){var x,M;const D=S[r];let W=null===(x=N.flowGraphMapping.inputs)||void 0===x||null===(M=x.values)||void 0===M?void 0:M[r],B=!1;if(!W)for(const c in null===(E=N.flowGraphMapping.inputs)||void 0===E?void 0:E.values){var E,m,Y;if(c.startsWith("[")&&c.endsWith("]"))B=!0,W=null===(m=N.flowGraphMapping.inputs)||void 0===m||null===(Y=m.values)||void 0===Y?void 0:Y[c]}const t=W?B?W.name.replace("$1",r):W.name:r,u=this._createNewSocketConnection(t);if((W&&W.UD&&U.qM.find((c=>c.className===W.UD))||U.qM[0]).dataInputs.push(u),void 0!==D.value){const r=this._parseVariable(D,W&&W.dataTransformer);c._connectionValues[u.uniqueId]=r}else{if("undefined"===typeof D.node)throw k.e.Error(["Invalid value for value connection",D]),new Error("Error parsing node connections");{var v,w,Z;const c=D.node,r=D.socket||"value",W=this._nodes[c];if(!W)throw k.e.Error(["No node found for output socket reference",D]),new Error("Error parsing node connections");const B=ND(W.fullOperationName);if(!B)throw k.e.Error(["No mapping found for output socket reference",D]),new Error("Error parsing node connections");let t=null===(v=B.outputs)||void 0===v||null===(w=v.values)||void 0===w?void 0:w[r],a=!1;if(!t)for(const D in null===(J=B.outputs)||void 0===J?void 0:J.values){var J,q,j;if(D.startsWith("[")&&D.endsWith("]"))a=!0,t=null===(q=B.outputs)||void 0===q||null===(j=q.values)||void 0===j?void 0:j[D]}const H=t?a?t.name.replace("$1",r):null===(Z=t)||void 0===Z?void 0:Z.name:r,x=t&&t.UD&&W.qM.find((c=>c.className===t.UD))||W.qM[0];let M=x.dataOutputs.find((c=>c.name===H));M||(M=this._createNewSocketConnection(H,!0),x.dataOutputs.push(M)),u.connectedPointIds.push(M.uniqueId),M.connectedPointIds.push(u.uniqueId)}}}if(N.flowGraphMapping.interBlockConnectors)for(const c of N.flowGraphMapping.interBlockConnectors){const r=c.input,D=c.output,W=c.isVariable;this._connectFlowGraphNodes(r,D,U.qM[c.inputBlockIndex],U.qM[c.outputBlockIndex],W)}if(N.flowGraphMapping.extraProcessor){var X;const r=null===(X=this._interactivityGraph.declarations)||void 0===X?void 0:X[y.declaration];if(!r)throw k.e.Error(["No declaration found for extra processor",y]),new Error("Error parsing node connections");U.qM=N.flowGraphMapping.extraProcessor(y,r,N.flowGraphMapping,this,U.qM,c,this._gltf)}}}_createNewSocketConnection(c,r){return{uniqueId:(0,hD.c)(),name:c,_connectionType:r?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(c,r,D,W,B){const t=B?D.dataInputs:D.signalInputs,u=B?W.dataOutputs:W.signalOutputs,a=t.find((r=>r.name===c))||this._createNewSocketConnection(c),H=u.find((c=>c.name===r))||this._createNewSocketConnection(r,!0);t.find((r=>r.name===c))||t.push(a),u.find((c=>c.name===r))||u.push(H),a.connectedPointIds.push(H.uniqueId),H.connectedPointIds.push(a.uniqueId)}getVariableName(c){return"staticVariable_"+c}serializeToFlowGraph(){const c={uniqueId:(0,hD.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(c);for(let r=0;r<this._staticVariables.length;r++){const D=this._staticVariables[r];c._userVariables[this.getVariableName(r)]=D}return{rightHanded:!0,allBlocks:this._nodes.reduce(((c,r)=>c.concat(r.qM)),[]),executionContexts:[c]}}}const GD="KHR_interactivity";class dD{constructor(c){this._loader=c,this.name=GD,this.enabled=this._loader.isExtensionUsed(GD),this._pathConverter=(0,T.h)(this._loader.ua),c._skipStartAnimationStep=!0;const r=c.babylonScene;r&&function(c){(0,T.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!c.activeCamera)return new B.Quaternion(NaN,NaN,NaN,NaN);const r=B.Quaternion.FromRotationMatrix(c.activeCamera.getWorldMatrix()).normalize();return c.useRightHandedSystem||(r.w*=-1,r.x*=-1),r},type:"Quaternion",getTarget:()=>c.activeCamera}),(0,T.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!c.activeCamera)return new B.Zr(NaN,NaN,NaN);const r=c.activeCamera.getWorldMatrix().getTranslation();return c.useRightHandedSystem||(r.x*=-1),r},type:"Zr",getTarget:()=>c.activeCamera}),(0,T.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:c=>{var r;return(null===(r=c._babylonAnimationGroup)||void 0===r?void 0:r.isPlaying)??!1},type:"boolean",getTarget:c=>c._babylonAnimationGroup}),(0,T.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:c=>{var r;return((null===(r=c._babylonAnimationGroup)||void 0===r?void 0:r.from)??0)/60},type:"number",getTarget:c=>c._babylonAnimationGroup}),(0,T.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:c=>{var r;return((null===(r=c._babylonAnimationGroup)||void 0===r?void 0:r.to)??0)/60},type:"number",getTarget:c=>c._babylonAnimationGroup}),(0,T.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:c=>{var r;return((null===(r=c._babylonAnimationGroup)||void 0===r?void 0:r.getCurrentFrame())??0)/60},type:"number",getTarget:c=>c._babylonAnimationGroup}),(0,T.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:c=>{var r;return((null===(r=c._babylonAnimationGroup)||void 0===r?void 0:r.getCurrentFrame())??0)/60},type:"number",getTarget:c=>c._babylonAnimationGroup})}(r)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var c;if(!this._loader.babylonScene||!this._pathConverter)return;const r=this._loader.babylonScene,D=null===(c=this._loader.ua.extensions)||void 0===c?void 0:c.KHR_interactivity;if(!D)return;const W=new vD.e({qr:r});W.dispatchEventsSynchronously=!1;const B=D.graphs.map((c=>new PD(c,this._loader.ua,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(B.map((async c=>await eD(c,{coordinator:W,pathConverter:this._pathConverter})))),W.start()}}var TD;TD=async()=>(await Promise.resolve().then(D.bind(D,13437))).FlowGraphGLTFDataProvider,kD[`${GD}/${"FlowGraphGLTFDataProvider"}`]=TD,d(GD),G(GD,!0,(c=>new dD(c)));const bD="KHR_node_visibility";(0,T.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:c=>{const r=c._babylonTransformNode;return!r||void 0===r.isVisible||r.isVisible},set:(c,r)=>{var D,W;null===(D=r._primitiveBabylonMeshes)||void 0===D||D.forEach((c=>{c.inheritVisibility=!0})),r._babylonTransformNode&&(r._babylonTransformNode.isVisible=c),null===(W=r._primitiveBabylonMeshes)||void 0===W||W.forEach((r=>{r.isVisible=c}))},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class OD{constructor(c){this.name=bD,this._loader=c,this.enabled=c.isExtensionUsed(bD)}async onReady(){var c;null===(c=this._loader.ua.nodes)||void 0===c||c.forEach((c=>{var r,D,W,B;(null===(r=c._primitiveBabylonMeshes)||void 0===r||r.forEach((c=>{c.inheritVisibility=!0})),null!==(D=c.extensions)&&void 0!==D&&D.KHR_node_visibility)&&(!1===(null===(W=c.extensions)||void 0===W?void 0:W.KHR_node_visibility.visible)&&(c._babylonTransformNode&&(c._babylonTransformNode.isVisible=!1),null===(B=c._primitiveBabylonMeshes)||void 0===B||B.forEach((c=>{c.isVisible=!1}))))}))}dispose(){this._loader=null}}d(bD),G(bD,!0,(c=>new OD(c)));const CD="KHR_node_selectability";zD("event/onSelect",CD,{qM:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",UD:"FlowGraphGetVariableBlock",dataTransformer:c=>["pickedMesh_"+c[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",UD:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(c,r,D,W,B,t,u){var a,H,x,M,E,m;const Y=B[B.length-1];Y.config=Y.config||{},Y.config.glTF=u;const v=null===(a=c.configuration)||void 0===a||null===(H=a.nodeIndex)||void 0===H?void 0:H.value[0];if(void 0===v||"number"!==typeof v)throw new Error("nodeIndex not found in configuration");const k="pickedMesh_"+v;return B[1].config.variable=k,t._userVariables[k]={className:"Mesh",id:null===u||void 0===u||null===(x=u.nodes)||void 0===x||null===(M=x[v]._babylonTransformNode)||void 0===M?void 0:M.id,uniqueId:null===u||void 0===u||null===(E=u.nodes)||void 0===E||null===(m=E[v]._babylonTransformNode)||void 0===m?void 0:m.uniqueId},B}}),(0,T.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:c=>{const r=c._babylonTransformNode;return!r||void 0===r.GH||r.GH},set:(c,r)=>{var D;null===(D=r._primitiveBabylonMeshes)||void 0===D||D.forEach((r=>{r.GH=c}))},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"GH"],type:"boolean"});class pD{constructor(c){this.name=CD,this._loader=c,this.enabled=c.isExtensionUsed(CD)}async onReady(){var c;null===(c=this._loader.ua.nodes)||void 0===c||c.forEach((c=>{var r,D,W;null!==(r=c.extensions)&&void 0!==r&&r.KHR_node_selectability&&!1===(null===(D=c.extensions)||void 0===D?void 0:D.KHR_node_selectability.selectable)&&(null===(W=c._babylonTransformNode)||void 0===W||W.getChildMeshes().forEach((c=>{c.GH=!1})))}))}dispose(){this._loader=null}}d(CD),G(CD,!0,(c=>new pD(c)));const RD="KHR_node_hoverability",sD="targetMeshPointerOver_";zD("event/onHoverIn",RD,{qM:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",UD:"FlowGraphGetVariableBlock",dataTransformer:c=>[sD+c[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",UD:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(c,r,D,W,B,t,u){var a,H,x,M,E,m;const Y=B[B.length-1];Y.config=Y.config||{},Y.config.glTF=u;const v=null===(a=c.configuration)||void 0===a||null===(H=a.nodeIndex)||void 0===H?void 0:H.value[0];if(void 0===v||"number"!==typeof v)throw new Error("nodeIndex not found in configuration");const k=sD+v;return B[1].config.variable=k,t._userVariables[k]={className:"Mesh",id:null===u||void 0===u||null===(x=u.nodes)||void 0===x||null===(M=x[v]._babylonTransformNode)||void 0===M?void 0:M.id,uniqueId:null===u||void 0===u||null===(E=u.nodes)||void 0===E||null===(m=E[v]._babylonTransformNode)||void 0===m?void 0:m.uniqueId},B}});const oD="targetMeshPointerOut_";zD("event/onHoverOut",RD,{qM:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",UD:"FlowGraphGetVariableBlock",dataTransformer:c=>[oD+c[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",UD:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(c,r,D,W,B,t,u){var a,H,x,M,E,m;const Y=B[B.length-1];Y.config=Y.config||{},Y.config.glTF=u;const v=null===(a=c.configuration)||void 0===a||null===(H=a.nodeIndex)||void 0===H?void 0:H.value[0];if(void 0===v||"number"!==typeof v)throw new Error("nodeIndex not found in configuration");const k=oD+v;return B[1].config.variable=k,t._userVariables[k]={className:"Mesh",id:null===u||void 0===u||null===(x=u.nodes)||void 0===x||null===(M=x[v]._babylonTransformNode)||void 0===M?void 0:M.id,uniqueId:null===u||void 0===u||null===(E=u.nodes)||void 0===E||null===(m=E[v]._babylonTransformNode)||void 0===m?void 0:m.uniqueId},B}}),(0,T.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:c=>{const r=c._babylonTransformNode;return!r||void 0===r.pointerOverDisableMeshTesting||r.pointerOverDisableMeshTesting},set:(c,r)=>{var D;null===(D=r._primitiveBabylonMeshes)||void 0===D||D.forEach((r=>{r.pointerOverDisableMeshTesting=!c}))},getTarget:c=>c._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class QD{constructor(c){this.name=RD,this._loader=c,this.enabled=c.isExtensionUsed(RD)}async onReady(){var c;null===(c=this._loader.ua.nodes)||void 0===c||c.forEach((c=>{var r,D,W;null!==(r=c.extensions)&&void 0!==r&&r.KHR_node_hoverability&&!1===(null===(D=c.extensions)||void 0===D?void 0:D.KHR_node_hoverability.hoverable)&&(null===(W=c._babylonTransformNode)||void 0===W||W.getChildMeshes().forEach((c=>{c.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}d(RD),G(RD,!0,(c=>new QD(c)));const lD="ExtrasAsMetadata";class FD{_assignExtras(c,r){if(r.extras&&Object.keys(r.extras).length>0){const D=c.metadata=c.metadata||{};(D.ua=D.ua||{}).extras=r.extras}}constructor(c){this.name=lD,this.enabled=!0,this._loader=c}dispose(){this._loader=null}loadNodeAsync(c,r,D){return this._loader.loadNodeAsync(c,r,(c=>{this._assignExtras(c,r),D(c)}))}loadCameraAsync(c,r,D){return this._loader.loadCameraAsync(c,r,(c=>{this._assignExtras(c,r),D(c)}))}createMaterial(c,r,D){const W=this._loader.createMaterial(c,r,D);return this._assignExtras(W,r),W}}d(lD),G(lD,!1,(c=>new FD(c)));D(13437)},13322:(c,r,D)=>{"use strict";D.d(r,{d:()=>A,f:()=>N,i:()=>U,j:()=>g});var W=D(11494),B=D(11487),t=D(12969),u=D(12135),a=D(12096),H=D(12109),x=D(11509),M=D(11538),E=D(12129),m=D(12218),Y=D(12143),v=D(11719);class k{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.rm=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.dm=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(c){this._environmentTexture=c}getNodes(){let c=[];c=c.concat(this.meshes),c=c.concat(this.lights),c=c.concat(this.cameras),c=c.concat(this.transformNodes);for(const r of this.skeletons)c=c.concat(r.bones);return c}}class w extends k{}class Z{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const c=this.rootNodes;for(const W of c)W.dispose();c.length=0;const r=this.skeletons;for(const W of r)W.dispose();r.length=0;const D=this.animationGroups;for(const W of D)W.dispose();D.length=0}}class J extends k{constructor(c){super(),this._wasAddedToScene=!1,(c=c||M.c.LastCreatedScene)&&(this.qr=c,this.proceduralTextures=[],c.Wa.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=c.getEngine().onContextRestoredObservable.add((()=>{for(const c of this.geometries)c._rebuild();for(const c of this.meshes)c._rebuild();for(const c of this.rm)c.rebuild();for(const c of this.textures)c._rebuild()})))}_topologicalSort(c){const r=new Map;for(const u of c)r.set(u.uniqueId,u);const D={dependsOn:new Map,dependedBy:new Map};for(const u of c){const c=u.uniqueId;D.dependsOn.set(c,new Set),D.dependedBy.set(c,new Set)}for(const u of c){const c=u.uniqueId,W=D.dependsOn.get(c);if(u instanceof E.b){const B=u.sourceMesh;r.has(B.uniqueId)&&(W.add(B.uniqueId),D.dependedBy.get(B.uniqueId).add(c))}const B=D.dependedBy.get(c);for(const t of u.getDescendants()){const W=t.uniqueId;if(r.has(W)){B.add(W);D.dependsOn.get(W).add(c)}}}const W=[],B=[];for(const u of c){const c=u.uniqueId;0===D.dependsOn.get(c).size&&(B.push(u),r.delete(c))}const t=B;for(;t.length>0;){const c=t.shift();W.push(c);const B=D.dependedBy.get(c.uniqueId);for(const W of Array.from(B.values())){const B=D.dependsOn.get(W);B.delete(c.uniqueId),0===B.size&&r.get(W)&&(t.push(r.get(W)),r.delete(W))}}return r.size>0&&(x.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),r.forEach((c=>{x.e.Error(c.name)}))),W}_addNodeAndDescendantsToList(c,r,D,W){if(D&&(!W||W(D))&&!r.has(D.uniqueId)){c.push(D),r.add(D.uniqueId);for(const B of D.getDescendants(!0))this._addNodeAndDescendantsToList(c,r,B,W)}}_isNodeInContainer(c){return c instanceof H.d&&-1!==this.meshes.indexOf(c)||(c instanceof a.e&&-1!==this.transformNodes.indexOf(c)||(c instanceof m.b&&-1!==this.lights.indexOf(c)||c instanceof Y.d&&-1!==this.cameras.indexOf(c)))}_isValidHierarchy(){for(const c of this.meshes)if(c.parent&&!this._isNodeInContainer(c.parent))return x.e.Warn(`Node ${c.name} has a parent that is not in the container.`),!1;for(const c of this.transformNodes)if(c.parent&&!this._isNodeInContainer(c.parent))return x.e.Warn(`Node ${c.name} has a parent that is not in the container.`),!1;for(const c of this.lights)if(c.parent&&!this._isNodeInContainer(c.parent))return x.e.Warn(`Node ${c.name} has a parent that is not in the container.`),!1;for(const c of this.cameras)if(c.parent&&!this._isNodeInContainer(c.parent))return x.e.Warn(`Node ${c.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(c){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],D=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||B.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const W={},t={},a=new Z,H=[],x=[],M={doNotInstantiate:!0,...D},E=[],m=new Set;for(const B of this.transformNodes)null===B.parent&&this._addNodeAndDescendantsToList(E,m,B,M.predicate);for(const B of this.meshes)null===B.parent&&this._addNodeAndDescendantsToList(E,m,B,M.predicate);const Y=this._topologicalSort(E),v=(D,B)=>{if(((r,D)=>{if(W[r.uniqueId]=D.uniqueId,t[D.uniqueId]=D,c&&(D.name=c(r.name)),D instanceof u.e){const c=D;if(c.morphTargetManager){const D=r.morphTargetManager;c.morphTargetManager=D.clone();for(let r=0;r<D.numTargets;r++){const B=D.getTarget(r),u=c.morphTargetManager.getTarget(r);W[B.uniqueId]=u.uniqueId,t[u.uniqueId]=u}}}})(D,B),D.parent){const c=W[D.parent.uniqueId],r=t[c];B.parent=r||D.parent}if(B.position&&D.position&&B.position.t(D.position),B.rotationQuaternion&&D.rotationQuaternion&&B.rotationQuaternion.t(D.rotationQuaternion),B.rotation&&D.rotation&&B.rotation.t(D.rotation),B.qa&&D.qa&&B.qa.t(D.qa),B.material){const u=B;if(u.material)if(r){const r=D.material;if(-1===x.indexOf(r)){let D=r.clone(c?c(r.name):"Clone of "+r.name);if(x.push(r),W[r.uniqueId]=D.uniqueId,t[D.uniqueId]=D,"MultiMaterial"===r.getClassName()){const B=r;for(const r of B.ea)r&&(D=r.clone(c?c(r.name):"Clone of "+r.name),x.push(r),W[r.uniqueId]=D.uniqueId,t[D.uniqueId]=D);B.ea=B.ea.map((c=>c&&t[W[c.uniqueId]]))}}"InstancedMesh"!==u.getClassName()&&(u.material=t[W[r.uniqueId]])}else"MultiMaterial"===u.material.getClassName()?-1===this.qr.multiMaterials.indexOf(u.material)&&this.qr.addMultiMaterial(u.material):-1===this.qr.materials.indexOf(u.material)&&this.qr.addMaterial(u.material)}null===B.parent&&a.rootNodes.push(B)};for(const B of Y)if("InstancedMesh"===B.getClassName()){const c=B,r=c.sourceMesh,D=W[r.uniqueId];v(c,("number"===typeof D?t[D]:r).createInstance(c.name))}else{let c=!0;"Fv"===B.getClassName()||"Node"===B.getClassName()||B.skeleton||!B.getTotalVertices||0===B.getTotalVertices()?c=!1:M.doNotInstantiate&&(c="function"===typeof M.doNotInstantiate?!M.doNotInstantiate(B):!M.doNotInstantiate);const r=c?B.createInstance(`instance of ${B.name}`):B.clone(`Clone of ${B.name}`,null,!0);if(!r)throw new Error(`Could not clone or instantiate node on Asset Container ${B.name}`);v(B,r)}for(const B of this.skeletons){if(M.predicate&&!M.predicate(B))continue;const r=B.clone(c?c(B.name):"Clone of "+B.name);for(const c of this.meshes)if(c.skeleton===B&&!c.isAnInstance){const D=t[W[c.uniqueId]];if(!D||D.isAnInstance)continue;if(D.skeleton=r,-1!==H.indexOf(r))continue;H.push(r);for(const c of r.bones)c._linkedTransformNode&&(c._linkedTransformNode=t[W[c._linkedTransformNode.uniqueId]])}a.skeletons.push(r)}for(const B of this.animationGroups){if(M.predicate&&!M.predicate(B))continue;const r=B.clone(c?c(B.name):"Clone of "+B.name,(c=>t[W[c.uniqueId]]||c));a.animationGroups.push(r)}return a}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||B.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.qr.environmentTexture=this.environmentTexture);for(const c of this.qr._serializableComponents)c.addFromContainer(this);this.qr.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const r=[];for(const D of this.cameras)c&&!c(D)||(this.qr.addCamera(D),r.push(D));for(const D of this.lights)c&&!c(D)||(this.qr.addLight(D),r.push(D));for(const D of this.meshes)c&&!c(D)||(this.qr.aM(D),r.push(D));for(const D of this.skeletons)c&&!c(D)||this.qr.addSkeleton(D);for(const D of this.animations)c&&!c(D)||this.qr.addAnimation(D);for(const D of this.animationGroups)c&&!c(D)||this.qr.addAnimationGroup(D);for(const D of this.multiMaterials)c&&!c(D)||this.qr.addMultiMaterial(D);for(const D of this.materials)c&&!c(D)||this.qr.addMaterial(D);for(const D of this.morphTargetManagers)c&&!c(D)||this.qr.addMorphTargetManager(D);for(const D of this.geometries)c&&!c(D)||this.qr.addGeometry(D);for(const D of this.transformNodes)c&&!c(D)||(this.qr.addTransformNode(D),r.push(D));for(const D of this.actionManagers)c&&!c(D)||this.qr.addActionManager(D);for(const D of this.textures)c&&!c(D)||this.qr.addTexture(D);for(const D of this.reflectionProbes)c&&!c(D)||this.qr.addReflectionProbe(D);for(const D of r)D.parent&&-1===this.qr.getNodes().indexOf(D.parent)&&(D.setParent?D.setParent(null):D.parent=null)}removeAllFromScene(){this._isValidHierarchy()||B.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.qr.environmentTexture&&(this.qr.environmentTexture=null);for(const c of this.qr._serializableComponents)c.removeFromContainer(this)}removeFromScene(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const r of this.cameras)c&&!c(r)||this.qr.removeCamera(r);for(const r of this.lights)c&&!c(r)||this.qr.removeLight(r);for(const r of this.meshes)c&&!c(r)||this.qr.uM(r,!0);for(const r of this.skeletons)c&&!c(r)||this.qr.removeSkeleton(r);for(const r of this.animations)c&&!c(r)||this.qr.removeAnimation(r);for(const r of this.animationGroups)c&&!c(r)||this.qr.removeAnimationGroup(r);for(const r of this.multiMaterials)c&&!c(r)||this.qr.removeMultiMaterial(r);for(const r of this.materials)c&&!c(r)||this.qr.removeMaterial(r);for(const r of this.morphTargetManagers)c&&!c(r)||this.qr.removeMorphTargetManager(r);for(const r of this.geometries)c&&!c(r)||this.qr.removeGeometry(r);for(const r of this.transformNodes)c&&!c(r)||this.qr.removeTransformNode(r);for(const r of this.actionManagers)c&&!c(r)||this.qr.removeActionManager(r);for(const r of this.textures)c&&!c(r)||this.qr.removeTexture(r);for(const r of this.reflectionProbes)c&&!c(r)||this.qr.removeReflectionProbe(r)}dispose(){const c=this.cameras.slice(0);for(const Y of c)Y.dispose();this.cameras.length=0;const r=this.lights.slice(0);for(const Y of r)Y.dispose();this.lights.length=0;const D=this.meshes.slice(0);for(const Y of D)Y.dispose();this.meshes.length=0;const W=this.skeletons.slice(0);for(const Y of W)Y.dispose();this.skeletons.length=0;const B=this.animationGroups.slice(0);for(const Y of B)Y.dispose();this.animationGroups.length=0;const t=this.multiMaterials.slice(0);for(const Y of t)Y.dispose();this.multiMaterials.length=0;const u=this.materials.slice(0);for(const Y of u)Y.dispose();this.materials.length=0;const a=this.geometries.slice(0);for(const Y of a)Y.dispose();this.geometries.length=0;const H=this.transformNodes.slice(0);for(const Y of H)Y.dispose();this.transformNodes.length=0;const x=this.actionManagers.slice(0);for(const Y of x)Y.dispose();this.actionManagers.length=0;const M=this.textures.slice(0);for(const Y of M)Y.dispose();this.textures.length=0;const E=this.reflectionProbes.slice(0);for(const Y of E)Y.dispose();this.reflectionProbes.length=0;const m=this.morphTargetManagers.slice(0);for(const Y of m)Y.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const Y of this.qr._serializableComponents)Y.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.qr.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(c,r,D){if(c&&r)for(const W of c){let c=!0;if(D)for(const r of D)if(W===r){c=!1;break}c&&(r.push(W),W._parentContainer=this)}}moveAllFromScene(c){this._wasAddedToScene=!1,void 0===c&&(c=new w);for(const r in this)Object.prototype.hasOwnProperty.call(this,r)&&(this[r]=this[r]||("_environmentTexture"===r?null:[]),this._moveAssets(this.qr[r],this[r],c[r]));this.environmentTexture=this.qr.environmentTexture,this.removeAllFromScene()}createRootMesh(){const c=new u.e("assetContainerRootMesh",this.qr);for(const r of this.meshes)r.parent||c.addChild(r);return this.meshes.unshift(c),c}mergeAnimationsTo(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.c.LastCreatedScene,r=arguments.length>1?arguments[1]:void 0,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!c)return x.e.Error("No scene available to merge animations to"),[];const W=D||(r=>{let D=null;const W=r.animations.length?r.animations[0].targetProperty:"",B=r.name.split(".").join("").split("_primitive")[0];switch(W){case"position":case"rotationQuaternion":D=c.getTransformNodeByName(r.name)||c.getTransformNodeByName(B);break;case"influence":D=c.getMorphTargetByName(r.name)||c.getMorphTargetByName(B);break;default:D=c.getNodeByName(r.name)||c.getNodeByName(B)}return D}),B=this.getNodes();for(const a of B){const c=W(a);if(null!==c){for(const r of a.animations){const D=c.animations.filter((c=>c.targetProperty===r.targetProperty));for(const r of D){const D=c.animations.indexOf(r,0);D>-1&&c.animations.splice(D,1)}}c.animations=c.animations.concat(a.animations)}}const t=[],u=this.animationGroups.slice();for(const a of u){t.push(a.clone(a.name,W));for(const c of a.animatables)c.stop()}for(const a of r){const r=W(a.target);r&&(c.beginAnimation(r,a.fromFrame,a.toFrame,a.loopAnimation,a.speedRatio,a.onAnimationEnd?a.onAnimationEnd:void 0,void 0,!0,void 0,a.onAnimationLoop?a.onAnimationLoop:void 0),c.stopAnimation(a.target))}return t}populateRootNodes(){this.rootNodes.length=0;for(const c of this.meshes)c.parent||-1!==this.rootNodes.indexOf(c)||this.rootNodes.push(c);for(const c of this.transformNodes)c.parent||-1!==this.rootNodes.indexOf(c)||this.rootNodes.push(c);for(const c of this.lights)c.parent||-1!==this.rootNodes.indexOf(c)||this.rootNodes.push(c);for(const c of this.cameras)c.parent||-1!==this.rootNodes.indexOf(c)||this.rootNodes.push(c)}addAllAssetsToContainer(c){if(!c)return;const r=[],D=new Set;for(r.push(c);r.length>0;){const c=r.pop();if(c instanceof u.e?(c.ka&&-1===this.geometries.indexOf(c.ka)&&this.geometries.push(c.ka),this.meshes.push(c)):c instanceof E.b?this.meshes.push(c):c instanceof a.e?this.transformNodes.push(c):c instanceof m.b?this.lights.push(c):c instanceof Y.d&&this.cameras.push(c),c instanceof H.d){if(c.material&&-1===this.materials.indexOf(c.material)){this.materials.push(c.material);for(const r of c.material.getActiveTextures())-1===this.textures.indexOf(r)&&this.textures.push(r)}c.skeleton&&-1===this.skeletons.indexOf(c.skeleton)&&this.skeletons.push(c.skeleton),c.morphTargetManager&&-1===this.morphTargetManagers.indexOf(c.morphTargetManager)&&this.morphTargetManagers.push(c.morphTargetManager)}for(const W of c.getChildren())D.has(W)||r.push(W);D.add(c)}this.populateRootNodes()}_getByTags(c,r,D){if(void 0===r)return c;const W=[];for(const B in c){const t=c[B];v.b&&v.b.MatchesQuery(t,r)&&(!D||D(t))&&W.push(t)}return W}getMeshesByTags(c,r){return this._getByTags(this.meshes,c,r)}getCamerasByTags(c,r){return this._getByTags(this.cameras,c,r)}getLightsByTags(c,r){return this._getByTags(this.lights,c,r)}getMaterialsByTags(c,r){return this._getByTags(this.materials,c,r).concat(this._getByTags(this.multiMaterials,c,r))}getTransformNodesByTags(c,r){return this._getByTags(this.transformNodes,c,r)}}var q=D(11555);class j{constructor(c){this.byteOffset=0,this.buffer=c}async loadAsync(c){const r=await this.buffer.readAsync(this.byteOffset,c);this._dataView=new DataView(r.buffer,r.byteOffset,r.byteLength),this._dataByteOffset=0}readUint32(){const c=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,c}readUint8Array(c){const r=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,c);return this._dataByteOffset+=c,this.byteOffset+=c,r}readString(c){return(0,q.f)(this.readUint8Array(c))}skipBytes(c){this._dataByteOffset+=c,this.byteOffset+=c}}var X=D(13329);const e="Z2xURg",y={name:"ua",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:c=>-1!==c.indexOf("asset")&&-1!==c.indexOf("version")||c.startsWith("data:base64,"+e)||c.startsWith("data:;base64,"+e)||c.startsWith("data:application/octet-stream;base64,"+e)||c.startsWith("data:model/gltf-binary;base64,"+e)};var U,N,g,z=D(11545),S=D(11550);function K(c,r,D){try{return Promise.resolve(new Uint8Array(c,r,D))}catch(W){return Promise.reject(W)}}!function(c){c[c.AUTO=0]="AUTO",c[c.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(U||(U={})),function(c){c[c.NONE=0]="NONE",c[c.FIRST=1]="FIRST",c[c.ALL=2]="ALL"}(N||(N={})),function(c){c[c.LOADING=0]="LOADING",c[c.READY=1]="READY",c[c.COMPLETE=2]="COMPLETE"}(g||(g={}));class f{constructor(){this.coordinateSystemMode=U.AUTO,this.animationStartMode=N.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=c=>Promise.resolve(c),this.extensionOptions={}}t(c){c&&(this.onParsed=c.onParsed,this.coordinateSystemMode=c.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=c.animationStartMode??this.animationStartMode,this.loadNodeAnimations=c.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=c.loadSkins??this.loadSkins,this.loadMorphTargets=c.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=c.compileMaterials??this.compileMaterials,this.useClipPlane=c.useClipPlane??this.useClipPlane,this.compileShadowGenerators=c.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=c.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=c.useRangeRequests??this.useRangeRequests,this.createInstances=c.createInstances??this.createInstances,this.alwaysComputeBoundingBox=c.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=c.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=c.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=c.skipMaterials??this.skipMaterials,this.useSRGBBuffers=c.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=c.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=c.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=c.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=c.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=c.customRootNode,this.onMeshLoaded=c.onMeshLoaded,this.onSkinLoaded=c.onSkinLoaded,this.onTextureLoaded=c.onTextureLoaded,this.onMaterialLoaded=c.onMaterialLoaded,this.onCameraLoaded=c.onCameraLoaded,this.extensionOptions=c.extensionOptions??this.extensionOptions)}}class A extends f{constructor(c){super(),this.onParsedObservable=new W.c,this.onMeshLoadedObservable=new W.c,this.onSkinLoadedObservable=new W.c,this.onTextureLoadedObservable=new W.c,this.onMaterialLoadedObservable=new W.c,this.onCameraLoadedObservable=new W.c,this.onCompleteObservable=new W.c,this.onErrorObservable=new W.c,this.Wa=new W.c,this.onExtensionLoadedObservable=new W.c,this.validate=!1,this.onValidatedObservable=new W.c,this._loader=null,this._state=null,this._requests=new Array,this.name=y.name,this.extensions=y.extensions,this.onLoaderStateChangedObservable=new W.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.t(c)}set onParsed(c){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),c&&(this._onParsedObserver=this.onParsedObservable.add(c))}set onMeshLoaded(c){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),c&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(c))}set onSkinLoaded(c){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),c&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((r=>c(r.node,r.skinnedNode))))}set onTextureLoaded(c){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),c&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(c))}set onMaterialLoaded(c){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),c&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(c))}set onCameraLoaded(c){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),c&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(c))}set onComplete(c){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(c)}set onError(c){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(c)}set onDispose(c){this._onDisposeObserver&&this.Wa.remove(this._onDisposeObserver),this._onDisposeObserver=this.Wa.add(c)}set onExtensionLoaded(c){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(c)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(c){this._loggingEnabled!==c&&(this._loggingEnabled=c,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(c){this._capturePerformanceCounters!==c&&(this._capturePerformanceCounters=c,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(c){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(c)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const c of this._requests)c.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=c=>Promise.resolve(c),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Wa.notifyObservers(void 0),this.Wa.clear()}loadFile(c,r,D,t,u,a,H,M){if(ArrayBuffer.isView(r))return this._loadBinary(c,r,D,t,H,M),null;this._progressCallback=u;const E=r.name||B.Tools.GetFilename(r);if(a){if(this.useRangeRequests){this.validate&&x.e.Warn("glTF validation is not supported when range requests are enabled");const D={abort:()=>{},onCompleteObservable:new W.c},B={readAsync:(D,W)=>new Promise(((B,t)=>{this._loadFile(c,r,(c=>{B(new Uint8Array(c))}),!0,(c=>{t(c)}),(c=>{c.setRequestHeader("Range",`bytes=${D}-${D+W-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new j(B)).then((c=>{D.onCompleteObservable.notifyObservers(D),t(c)}),H?c=>H(void 0,c):void 0),D}return this._loadFile(c,r,(r=>{this._validate(c,new Uint8Array(r,0,r.byteLength),D,E),this._unpackBinaryAsync(new j({readAsync:(c,D)=>K(r,c,D),byteLength:r.byteLength})).then((c=>{t(c)}),H?c=>H(void 0,c):void 0)}),!0,H)}return this._loadFile(c,r,(r=>{try{this._validate(c,r,D,E),t({json:this._parseJson(r)})}catch{H&&H()}}),!1,H)}_loadBinary(c,r,D,W,B,t){this._validate(c,new Uint8Array(r.buffer,r.byteOffset,r.byteLength),D,t),this._unpackBinaryAsync(new j({readAsync:(c,D)=>function(c,r,D){try{if(r<0||r>=c.byteLength)throw new RangeError("Offset is out of range.");if(r+D>c.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(c.buffer,c.byteOffset+r,D))}catch(W){return Promise.reject(W)}}(r,c,D),byteLength:r.byteLength})).then((c=>{W(c)}),B?c=>B(void 0,c):void 0)}importMeshAsync(c,r,D,W,B,t){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(D),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(D),this._loader.importMeshAsync(c,r,null,D,W,B,t))))}loadAsync(c,r,D,W,B){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(r),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(r),this._loader.loadAsync(c,r,D,W,B))))}loadAssetContainerAsync(c,r,D,W,B){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(r),this.onParsedObservable.clear(),this._log(`Loading ${B||""}`),this._loader=this._getLoader(r);const t=new J(c),u=[];this.onMaterialLoadedObservable.add((c=>{u.push(c)}));const a=[];this.onTextureLoadedObservable.add((c=>{a.push(c)}));const H=[];this.onCameraLoadedObservable.add((c=>{H.push(c)}));const x=[];return this.onMeshLoadedObservable.add((c=>{c.morphTargetManager&&x.push(c.morphTargetManager)})),this._loader.importMeshAsync(null,c,t,r,D,W,B).then((c=>(Array.prototype.push.apply(t.geometries,c.geometries),Array.prototype.push.apply(t.meshes,c.meshes),Array.prototype.push.apply(t.rm,c.rm),Array.prototype.push.apply(t.skeletons,c.skeletons),Array.prototype.push.apply(t.animationGroups,c.animationGroups),Array.prototype.push.apply(t.materials,u),Array.prototype.push.apply(t.textures,a),Array.prototype.push.apply(t.lights,c.lights),Array.prototype.push.apply(t.transformNodes,c.transformNodes),Array.prototype.push.apply(t.cameras,H),Array.prototype.push.apply(t.morphTargetManagers,x),t)))}))}canDirectLoad(c){return y.canDirectLoad(c)}directLoad(c,r){if(r.startsWith("base64,"+e)||r.startsWith(";base64,"+e)||r.startsWith("application/octet-stream;base64,"+e)||r.startsWith("model/gltf-binary;base64,"+e)){const D=(0,z.b)(r);return this._validate(c,new Uint8Array(D,0,D.byteLength)),this._unpackBinaryAsync(new j({readAsync:(c,r)=>K(D,c,r),byteLength:D.byteLength}))}return this._validate(c,r),Promise.resolve({json:this._parseJson(r)})}createPlugin(c){return new A(c[y.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((c,r)=>{this.onCompleteObservable.addOnce((()=>{c()})),this.onErrorObservable.addOnce((c=>{r(c)}))}))}_setState(c){this._state!==c&&(this._state=c,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(g[this._state]))}_loadFile(c,r,D,W,B,t){const u=c._loadFile(r,D,(c=>{this._onProgress(c,u)}),!0,W,B,t);return u.onCompleteObservable.add((()=>{u._lengthComputable=!0,u._total=u._loaded})),this._requests.push(u),u}_onProgress(c,r){if(!this._progressCallback)return;r._lengthComputable=c.lengthComputable,r._loaded=c.loaded,r._total=c.total;let D=!0,W=0,B=0;for(const t of this._requests){if(void 0===t._lengthComputable||void 0===t._loaded||void 0===t._total)return;D=D&&t._lengthComputable,W+=t._loaded,B+=t._total}this._progressCallback({lengthComputable:D,loaded:W,total:D?B:0})}_validate(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),X.c.ValidateAsync(r,D,W,(r=>this.preprocessUrlAsync(D+r).then((r=>c._loadFileAsync(r,void 0,!0,!0).then((c=>new Uint8Array(c,0,c.byteLength))))))).then((c=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(c),this.onValidatedObservable.clear()}),(c=>{this._endPerformanceCounter("Validate JSON"),B.Tools.Warn(`Failed to validate: ${c.message}`),this.onValidatedObservable.clear()})))}_getLoader(c){const r=c.json.asset||{};this._log(`Asset version: ${r.version}`),r.minVersion&&this._log(`Asset minimum version: ${r.minVersion}`),r.generator&&this._log(`Asset generator: ${r.generator}`);const D=A._parseVersion(r.version);if(!D)throw new Error("Invalid version: "+r.version);if(void 0!==r.minVersion){const c=A._parseVersion(r.minVersion);if(!c)throw new Error("Invalid minimum version: "+r.minVersion);if(A._compareVersion(c,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+r.minVersion)}const W={1:A._CreateGLTF1Loader,2:A._CreateGLTF2Loader}[D.major];if(!W)throw new Error("Unsupported version: "+r.version);return W(this)}_parseJson(c){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${c.length}`);const r=JSON.parse(c);return this._endPerformanceCounter("Parse JSON"),r}_unpackBinaryAsync(c){return this._startPerformanceCounter("Unpack Binary"),c.loadAsync(20).then((()=>{const r=c.readUint32();if(1179937895!==r)throw new S.k("Unexpected magic: "+r,S.g.GLTFLoaderUnexpectedMagicError);const D=c.readUint32();this.loggingEnabled&&this._log(`Binary version: ${D}`);const W=c.readUint32();let B;switch(this.useRangeRequests||W===c.buffer.byteLength||x.e.Warn(`Length in header does not match actual data length: ${W} != ${c.buffer.byteLength}`),D){case 1:B=this._unpackBinaryV1Async(c,W);break;case 2:B=this._unpackBinaryV2Async(c,W);break;default:throw new Error("Unsupported version: "+D)}return this._endPerformanceCounter("Unpack Binary"),B}))}_unpackBinaryV1Async(c,r){const D=c.readUint32(),W=c.readUint32();if(0!==W)throw new Error(`Unexpected content format: ${W}`);const B=r-c.byteOffset,t={json:this._parseJson(c.readString(D)),bin:null};if(0!==B){const r=c.byteOffset;t.bin={readAsync:(D,W)=>c.buffer.readAsync(r+D,W),byteLength:B}}return Promise.resolve(t)}_unpackBinaryV2Async(c,r){const D=1313821514,W=5130562,B=c.readUint32();if(c.readUint32()!==D)throw new Error("First chunk format is not JSON");return c.byteOffset+B===r?c.loadAsync(B).then((()=>({json:this._parseJson(c.readString(B)),bin:null}))):c.loadAsync(B+8).then((()=>{const t={json:this._parseJson(c.readString(B)),bin:null},u=()=>{const B=c.readUint32();switch(c.readUint32()){case D:throw new Error("Unexpected JSON chunk");case W:{const r=c.byteOffset;t.bin={readAsync:(D,W)=>c.buffer.readAsync(r+D,W),byteLength:B},c.skipBytes(B);break}default:c.skipBytes(B)}return c.byteOffset!==r?c.loadAsync(8).then(u):Promise.resolve(t)};return u()}))}static _parseVersion(c){if("1.0"===c||"1.0.1"===c)return{major:1,minor:0};const r=(c+"").match(/^(\d+)\.(\d+)/);return r?{major:parseInt(r[1]),minor:parseInt(r[2])}:null}static _compareVersion(c,r){return c.major>r.major?1:c.major<r.major?-1:c.minor>r.minor?1:c.minor<r.minor?-1:0}_logOpen(c){this._log(c),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(c){const r=A._logSpaces.substring(0,2*this._logIndentLevel);x.e.Log(`${r}${c}`)}_logDisabled(c){}_startPerformanceCounterEnabled(c){B.Tools.StartPerformanceCounter(c)}_startPerformanceCounterDisabled(c){}_endPerformanceCounterEnabled(c){B.Tools.EndPerformanceCounter(c)}_endPerformanceCounterDisabled(c){}}A.IncrementalLoading=!0,A.HomogeneousCoordinates=!1,A._logSpaces="                                ",(0,t.c)(new A)},13329:(c,r,D)=>{"use strict";D.d(r,{c:()=>u});var W=D(11487);function B(c,r,D,W){const B={externalResourceFunction:W};return D&&(B.uri="file:"===r?D:r+D),ArrayBuffer.isView(c)?GLTFValidator.validateBytes(c,B):GLTFValidator.validateString(c,B)}function t(){const c=[];onmessage=r=>{const D=r.data;switch(D.id){case"init":importScripts(D.url);break;case"validate":B(D.data,D.rootUrl,D.fileName,(r=>new Promise(((D,W)=>{const B=c.length;c.push({resolve:D,reject:W}),postMessage({id:"getExternalResource",index:B,uri:r})})))).then((c=>{postMessage({id:"validate.resolve",value:c})}),(c=>{postMessage({id:"validate.reject",reason:c})}));break;case"getExternalResource.resolve":c[D.index].resolve(D.value);break;case"getExternalResource.reject":c[D.index].reject(D.reason)}}}class u{static ValidateAsync(c,r,D,u){return"function"===typeof Worker?new Promise(((a,H)=>{const x=`${B}(${t})()`,M=URL.createObjectURL(new Blob([x],{type:"application/javascript"})),E=new Worker(M),m=c=>{E.removeEventListener("error",m),E.removeEventListener("message",Y),H(c)},Y=c=>{const r=c.data;switch(r.id){case"getExternalResource":u(r.uri).then((c=>{E.postMessage({id:"getExternalResource.resolve",index:r.index,value:c},[c.buffer])}),(c=>{E.postMessage({id:"getExternalResource.reject",index:r.index,reason:c})}));break;case"validate.resolve":E.removeEventListener("error",m),E.removeEventListener("message",Y),a(r.value),E.terminate();break;case"validate.reject":E.removeEventListener("error",m),E.removeEventListener("message",Y),H(r.reason),E.terminate()}};if(E.addEventListener("error",m),E.addEventListener("message",Y),E.postMessage({id:"init",url:W.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(c)){const W=c.slice();E.postMessage({id:"validate",data:W,rootUrl:r,fileName:D},[W.buffer])}else E.postMessage({id:"validate",data:c,rootUrl:r,fileName:D})})):(this._LoadScriptPromise||(this._LoadScriptPromise=W.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>B(c,r,D,u))))}}u.Configuration={url:`${W.Tools._DefaultCdnUrl}/gltf_validator.js`}},13888:(c,r,D)=>{"use strict";D.d(r,{b:()=>y});var W=D(11664),B=D(11669),t=D(11717),u=D(11683),a=D(12061),H=D(12008),x=D(11750),M=D(11924),E=D(11637),m=D(11595);D(13080),D(13e3),D(13018),D(13009),D(13023),D(13028),D(13030);const Y="imageProcessingCompatibility",v="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";m.d.IncludesShadersStore[Y]||(m.d.IncludesShadersStore[Y]=v);const k="skyPixelShader",w="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";m.d.ShadersStore[k]||(m.d.ShadersStore[k]=w);D(13097),D(13037),D(13040),D(13051),D(13047);const Z="skyVertexShader",J="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";m.d.ShadersStore[Z]||(m.d.ShadersStore[Z]=J);var q=D(12003),j=D(12050),X=D(12048);class e extends a.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class y extends H.e{constructor(c,r){super(c,r),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new u.Zr(0,100,0),this.useSunPosition=!1,this.cameraOffset=u.Zr.Zero(),this.up=u.Zr.Up(),this.dithering=!1,this._cameraPosition=u.Zr.Zero(),this._skyOrientation=new u.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(c,r){const D=r._drawWrapper;if(this.isFrozen&&D.effect&&D._wasPreviouslyReady)return!0;r.materialDefines||(r.materialDefines=new e);const W=r.materialDefines,B=this.yc();if(this._isReadyForSubMesh(r))return!0;if((0,X.O)(c,B,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,W),(0,X.K)(c,W,!0,!1),W.IMAGEPROCESSINGPOSTPROCESS!==B.imageProcessingConfiguration.applyByPostProcess&&W.markAsMiscDirty(),W.DITHER!==this.dithering&&W.markAsMiscDirty(),W.isDirty){W.markAsProcessed(),B.resetCachedMaterial();const c=new q.c;W.FOG&&c.addFallback(1,"FOG"),W.IMAGEPROCESSINGPOSTPROCESS=B.imageProcessingConfiguration.applyByPostProcess,W.DITHER=this.dithering;const D=[x.d.PositionKind];W.VERTEXCOLOR&&D.push(x.d.ColorKind);const t="sky",u=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,j.c)(u);const a=W.toString();r.setEffect(B.getEngine().createEffect(t,D,u,[],a,c,this.onCompiled,this.onError),W,this._materialContext)}return!(!r.effect||!r.effect.isReady())&&(W._renderId=B.getRenderId(),D._wasPreviouslyReady=!0,!0)}bindForSubMesh(c,r,D){const W=this.yc(),B=D.materialDefines;if(!B)return;const t=D.effect;if(!t)return;this._activeEffect=t,this.bindOnlyWorldMatrix(c),this._activeEffect.setMatrix("viewProjection",W.getTransformMatrix()),this._mustRebind(W,t,D)&&((0,j.d)(t,this,W),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,X.m)(B,t,W)),W.fogEnabled&&r.applyFog&&W.fogMode!==M.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",W.getViewMatrix()),(0,X.f)(W,r,this._activeEffect);const a=W.activeCamera;if(a){const c=a.getWorldMatrix();this._cameraPosition.x=c.m[12],this._cameraPosition.y=c.m[13],this._cameraPosition.z=c.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const c=Math.PI*(this.inclination-.5),r=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(r)*Math.cos(c),this.sunPosition.y=this.distance*Math.sin(-c),this.sunPosition.z=this.distance*Math.sin(r)*Math.cos(c),u.Quaternion.FromUnitVectorsToRef(u.Zr.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(r,this._activeEffect,D)}getAnimatables(){return[]}dispose(c){super.dispose(c)}clone(c){return t.d.Clone((()=>new y(c,this.yc())),this)}serialize(){const c=super.serialize();return c.customType="BABYLON.SkyMaterial",c}getClassName(){return"SkyMaterial"}static Parse(c,r,D){return t.d.Parse((()=>new y(c.name,r)),c,r,D)}}(0,W.e)([(0,B.K)()],y.prototype,"luminance",void 0),(0,W.e)([(0,B.K)()],y.prototype,"turbidity",void 0),(0,W.e)([(0,B.K)()],y.prototype,"rayleigh",void 0),(0,W.e)([(0,B.K)()],y.prototype,"mieCoefficient",void 0),(0,W.e)([(0,B.K)()],y.prototype,"mieDirectionalG",void 0),(0,W.e)([(0,B.K)()],y.prototype,"distance",void 0),(0,W.e)([(0,B.K)()],y.prototype,"inclination",void 0),(0,W.e)([(0,B.K)()],y.prototype,"azimuth",void 0),(0,W.e)([(0,B.J)()],y.prototype,"sunPosition",void 0),(0,W.e)([(0,B.K)()],y.prototype,"useSunPosition",void 0),(0,W.e)([(0,B.J)()],y.prototype,"cameraOffset",void 0),(0,W.e)([(0,B.J)()],y.prototype,"up",void 0),(0,W.e)([(0,B.K)()],y.prototype,"dithering",void 0),(0,E.e)("BABYLON.SkyMaterial",y)},12356:(c,r,D)=>{"use strict";function W(c,r){r.headers=c.headers||{},r.statusMessage=c.statusText,r.statusCode=c.status,r.data=c.response}function B(c,r,D){return new Promise((function(B,t){D=D||{};var u,a,H,x=new XMLHttpRequest,M=D.body,E=D.headers||{};for(u in D.timeout&&(x.timeout=D.timeout),x.ontimeout=x.onerror=function(c){c.timeout="timeout"==c.type,t(c)},x.open(c,r.href||r),x.onload=function(){for(H=x.getAllResponseHeaders().trim().split(/[\r\n]+/),W(x,x);a=H.shift();)a=a.split(": "),x.headers[a.shift().toLowerCase()]=a.join(": ");if((a=x.headers["content-type"])&&~a.indexOf("application/json"))try{x.data=JSON.parse(x.data,D.reviver)}catch(c){return W(x,c),t(c)}(x.status>=400?t:B)(x)},typeof FormData<"u"&&M instanceof FormData||M&&"object"==typeof M&&(E["content-type"]="application/json",M=JSON.stringify(M)),x.withCredentials=!!D.withCredentials,E)x.setRequestHeader(u,E[u]);x.send(M)}))}D.r(r),D.d(r,{del:()=>H,get:()=>t,patch:()=>a,post:()=>u,put:()=>x,send:()=>B});var t=B.bind(B,"GET"),u=B.bind(B,"POST"),a=B.bind(B,"PATCH"),H=B.bind(B,"DELETE"),x=B.bind(B,"PUT")},13983:(c,r,D)=>{"use strict";D.d(r,{b:()=>E});const W=.5*(Math.sqrt(3)-1),B=(3-Math.sqrt(3))/6,t=1/3,u=1/6,a=(Math.sqrt(5)-1)/4,H=(5-Math.sqrt(5))/20,x=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),M=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const E=class{constructor(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const r="function"==typeof c?c:function(c){let r=0,D=0,W=0,B=1;const t=function(){let c=4022871197;return function(r){r=r.toString();for(let D=0;D<r.length;D++){c+=r.charCodeAt(D);let W=.02519603282416938*c;c=W>>>0,W-=c,W*=c,c=W>>>0,W-=c,c+=4294967296*W}return 2.3283064365386963e-10*(c>>>0)}}();r=t(" "),D=t(" "),W=t(" "),r-=t(c),r<0&&(r+=1);D-=t(c),D<0&&(D+=1);W-=t(c),W<0&&(W+=1);return function(){const c=2091639*r+2.3283064365386963e-10*B;return r=D,D=W,W=c-(B=0|c)}}(c);this.p=function(c){const r=new Uint8Array(256);for(let D=0;D<256;D++)r[D]=D;for(let D=0;D<255;D++){const W=D+~~(c()*(256-D)),B=r[D];r[D]=r[W],r[W]=B}return r}(r),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let D=0;D<512;D++)this.perm[D]=this.p[255&D],this.permMod12[D]=this.perm[D]%12}noise2D(c,r){const D=this.permMod12,t=this.perm;let u=0,a=0,H=0;const M=(c+r)*W,E=Math.floor(c+M),m=Math.floor(r+M),Y=(E+m)*B,v=c-(E-Y),k=r-(m-Y);let w,Z;v>k?(w=1,Z=0):(w=0,Z=1);const J=v-w+B,q=k-Z+B,j=v-1+2*B,X=k-1+2*B,e=255&E,y=255&m;let U=.5-v*v-k*k;if(U>=0){const c=3*D[e+t[y]];U*=U,u=U*U*(x[c]*v+x[c+1]*k)}let N=.5-J*J-q*q;if(N>=0){const c=3*D[e+w+t[y+Z]];N*=N,a=N*N*(x[c]*J+x[c+1]*q)}let g=.5-j*j-X*X;if(g>=0){const c=3*D[e+1+t[y+1]];g*=g,H=g*g*(x[c]*j+x[c+1]*X)}return 70*(u+a+H)}noise3D(c,r,D){const W=this.permMod12,B=this.perm;let a,H,M,E;const m=(c+r+D)*t,Y=Math.floor(c+m),v=Math.floor(r+m),k=Math.floor(D+m),w=(Y+v+k)*u,Z=c-(Y-w),J=r-(v-w),q=D-(k-w);let j,X,e,y,U,N;Z>=J?J>=q?(j=1,X=0,e=0,y=1,U=1,N=0):Z>=q?(j=1,X=0,e=0,y=1,U=0,N=1):(j=0,X=0,e=1,y=1,U=0,N=1):J<q?(j=0,X=0,e=1,y=0,U=1,N=1):Z<q?(j=0,X=1,e=0,y=0,U=1,N=1):(j=0,X=1,e=0,y=1,U=1,N=0);const g=Z-j+u,z=J-X+u,S=q-e+u,K=Z-y+2*u,f=J-U+2*u,A=q-N+2*u,h=Z-1+.5,L=J-1+.5,P=q-1+.5,G=255&Y,d=255&v,T=255&k;let b=.6-Z*Z-J*J-q*q;if(b<0)a=0;else{const c=3*W[G+B[d+B[T]]];b*=b,a=b*b*(x[c]*Z+x[c+1]*J+x[c+2]*q)}let O=.6-g*g-z*z-S*S;if(O<0)H=0;else{const c=3*W[G+j+B[d+X+B[T+e]]];O*=O,H=O*O*(x[c]*g+x[c+1]*z+x[c+2]*S)}let C=.6-K*K-f*f-A*A;if(C<0)M=0;else{const c=3*W[G+y+B[d+U+B[T+N]]];C*=C,M=C*C*(x[c]*K+x[c+1]*f+x[c+2]*A)}let p=.6-h*h-L*L-P*P;if(p<0)E=0;else{const c=3*W[G+1+B[d+1+B[T+1]]];p*=p,E=p*p*(x[c]*h+x[c+1]*L+x[c+2]*P)}return 32*(a+H+M+E)}noise4D(c,r,D,W){const B=this.perm;let t,u,x,E,m;const Y=(c+r+D+W)*a,v=Math.floor(c+Y),k=Math.floor(r+Y),w=Math.floor(D+Y),Z=Math.floor(W+Y),J=(v+k+w+Z)*H,q=c-(v-J),j=r-(k-J),X=D-(w-J),e=W-(Z-J);let y=0,U=0,N=0,g=0;q>j?y++:U++,q>X?y++:N++,q>e?y++:g++,j>X?U++:N++,j>e?U++:g++,X>e?N++:g++;const z=y>=3?1:0,S=U>=3?1:0,K=N>=3?1:0,f=g>=3?1:0,A=y>=2?1:0,h=U>=2?1:0,L=N>=2?1:0,P=g>=2?1:0,G=y>=1?1:0,d=U>=1?1:0,T=N>=1?1:0,b=g>=1?1:0,O=q-z+H,C=j-S+H,p=X-K+H,R=e-f+H,s=q-A+2*H,o=j-h+2*H,Q=X-L+2*H,l=e-P+2*H,F=q-G+3*H,I=j-d+3*H,i=X-T+3*H,n=e-b+3*H,V=q-1+4*H,cc=j-1+4*H,rc=X-1+4*H,Dc=e-1+4*H,Wc=255&v,Bc=255&k,tc=255&w,uc=255&Z;let ac=.6-q*q-j*j-X*X-e*e;if(ac<0)t=0;else{const c=B[Wc+B[Bc+B[tc+B[uc]]]]%32*4;ac*=ac,t=ac*ac*(M[c]*q+M[c+1]*j+M[c+2]*X+M[c+3]*e)}let Hc=.6-O*O-C*C-p*p-R*R;if(Hc<0)u=0;else{const c=B[Wc+z+B[Bc+S+B[tc+K+B[uc+f]]]]%32*4;Hc*=Hc,u=Hc*Hc*(M[c]*O+M[c+1]*C+M[c+2]*p+M[c+3]*R)}let xc=.6-s*s-o*o-Q*Q-l*l;if(xc<0)x=0;else{const c=B[Wc+A+B[Bc+h+B[tc+L+B[uc+P]]]]%32*4;xc*=xc,x=xc*xc*(M[c]*s+M[c+1]*o+M[c+2]*Q+M[c+3]*l)}let Mc=.6-F*F-I*I-i*i-n*n;if(Mc<0)E=0;else{const c=B[Wc+G+B[Bc+d+B[tc+T+B[uc+b]]]]%32*4;Mc*=Mc,E=Mc*Mc*(M[c]*F+M[c+1]*I+M[c+2]*i+M[c+3]*n)}let Ec=.6-V*V-cc*cc-rc*rc-Dc*Dc;if(Ec<0)m=0;else{const c=B[Wc+1+B[Bc+1+B[tc+1+B[uc+1]]]]%32*4;Ec*=Ec,m=Ec*Ec*(M[c]*V+M[c+1]*cc+M[c+2]*rc+M[c+3]*Dc)}return 27*(t+u+x+E+m)}}}}]);